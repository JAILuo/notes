{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Messy Notes","text":"<p>\u8fd9\u91cc\u5b58\u653e\u5b66\u4e60\u3001\u751f\u6d3b\u5404\u79cd\u5404\u6837\u7684\u5185\u5bb9\uff0c\u8bfe\u7a0b/\u5b66\u4e60\u7b14\u8bb0\u3001\u6280\u672f\u95ee\u9898\u603b\u7ed3\u3001\u611f\u609f\u3001\u4e1a\u4f59\u7231\u597d\u7b49\u3002</p> <p>\u5199\u5f97\u5f88\u4e71\uff0c\u6bd4\u8f83\u968f\u5fc3\u6240\u6b32\uff0c\u5927\u591a\u662f\u5f53\u65f6\u5b66\u4e60\u7684\u8bb0\u5f55\u3002</p> <p>\u5f53\u6210\u662f\u4ed3\u5e93\u597d\u4e86\uff0c\u6ca1\u6709\u5efa\u535a\u5ba2\u7684\u6253\u7b97\uff0c\u53ef\u80fd\u4f1a\u501f\u52a9\u5927\u578b\u5e73\u53f0\u53d1\u5e03\u4e00\u90e8\u5206\u5185\u5bb9\uff1f\uff08\u672a\u77e5</p>"},{"location":"index.html#from-gdut","title":"From GDUT","text":""},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/STM32%E6%97%B6%E9%92%9F.html","title":"\u5173\u4e8eSTM32\u7684\u65f6\u949f\u914d\u7f6e\u95ee\u9898","text":"<p>\u5728\u73a9STC15\u7684\u65f6\u5019,\u5b83\u5728\u4f7f\u7528\u7684\u65f6\u5019\u5e76\u4e0d\u9700\u8981\u4ec0\u4e48\u65f6\u949f\u914d\u7f6e\u5440\uff0c\u90fd\u662f\u76f4\u63a5IO\u8f93\u51fa, \u8fd9\u662f\u56e0\u4e3a51\u7684\u5916\u90e8\u65f6\u949f\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\u5417\uff1f\u8fd8\u662f\u4f7f\u7528\u7684\u5916\u90e8\u65f6\u949f\u5462\uff1f\u73b0\u5728\u5b66\u4e60STM32,\u90fd\u8981\u5148\u5f00\u542fSTM32\u5916\u8bbe\u6a21\u5757\u65f6\u949f,\u518d\u5bf9\u76f8\u5173\u5916\u8bbe\u8fdb\u884c\u521d\u59cb\u5316\u914d\u7f6e.\u4e4b\u540e\u624d\u80fd\u50cf\u4e4b\u524d\u4e00\u6837\u73a9\u5404\u79cd\u5916\u8bbe. \u914d\u7f6e\u8fd9\u4e9b\u4e0d\u540c\u5f97\u65f6\u949f\u9891\u7387\u6709\u4ec0\u4e48\u7528\u5417?</p> <ul> <li>\u624b\u518c\u548c\u8d44\u6599</li> </ul> <p></p> <p>\u5404\u7c7b\u578b\u7684\u82af\u7247\u7531\u4e0d\u540c\u7684\u7cfb\u7edf\u67b6\u6784\u7ec4\u6210, \u4f46\u5927\u5dee\u4e0d\u5dee, \u90fd\u662f\u7531\u4e3b\u63a7\u603b\u7ebf(\u9a71\u52a8\u5355\u5143)+\u88ab\u63a7\u603b\u7ebf\u7ec4\u6210, \u8fd9\u91cc\u7528STM32f1\u7cfb\u5217\u4e3e\u4f8b</p> <p>\u9006\u8fc7\u6765\u601d\u8003, </p> <p>\u8981\u4f7f\u7528\u5404\u79cd\u5916\u8bbe, \u5c31\u8981\u7ecf\u8fc7\u5404\u79cd\u603b\u7ebf(APB1, APB2\u7b49),</p> <p>\u90a3\u53c8\u8981\u64cd\u4f5c\u4e3b\u63a7\u603b\u7ebf\u3002</p> <p>\u6240\u4ee5\u6709\u4e86\u5927\u4f53\u601d\u8def, \u4e4b\u540e\u6b63\u5411\u63a8\u5bfc.</p> <p>\u901a\u8fc7\u64cd\u4f5c\u603b\u7ebf\u77e9\u9635\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e3b\u63a7\u603b\u7ebf\u5230\u88ab\u63a7\u603b\u7ebf\u7684\u8bbf\u95ee\uff0c\u518d\u64cd\u7eb5AHB\u548cAPB\u6765\u4f7f\u7528\u5916\u8bbe.</p> <p>\u4e4b\u540e\u518d\u67e5\u770b\u624b\u518c\u53ef\u77e5  \u4f7f\u7528\u5916\u8bbe\u4e4b\u524d,\u5fc5\u987b\u8981\u5f00RCC_AHBENR\uff0c\u4e5f\u5c31\u662f\u8981\u5f00\u65f6\u949f</p> <p></p> <p>\u6240\u4ee5,\u5230\u6b64\u4e3a\u6b62\u4e5f\u5927\u6982\u6e05\u695a\u4e86. \u5c31\u662f\u5916\u8bbe\u5de5\u4f5c\u7684\u5bc4\u5b58\u5668\u9700\u8981\u65f6\u949f\u6765\u8c03\u63a7\u54e6,\u4f46\u662f\u4e3a\u4ec0\u4e48\u5bc4\u5b58\u5668\u53c8\u9700\u8981\u65f6\u949f\u5462?(\u5b58\u7591\u6570\u7535)</p> <p>\u90a3\u4e4b\u540e\u518d\u770b\u770b\u6709\u4ec0\u4e48\u4e0d\u540c\u7684\u65f6\u949f\u9891\u7387\u7528\u5904\u5462</p> <ul> <li> <p>\u7528\u5904</p> <ul> <li> <p>\u964d\u4f4e\u529f\u8017</p> <p>\u5404\u4e2a\u6a21\u5757\u7684\u90fd\u6709\u72ec\u7acb\u7684\u5916\u8bbe\u65f6\u949f,\u4e0d\u662f\u6bcf\u4e00\u4e2a\u5916\u8bbe\u90fd\u9700\u8981\u8fd9\u4e48\u9ad8\u9891\u7387\u7684, \u90fd\u7528\u9ad8\u901f\u65f6\u949f\u5f88\u6d6a\u8d39</p> </li> <li> <p>\u517c\u5bb9\u4e0d\u540c\u8bbe\u5907\u7684\u901f\u5ea6</p> <p>\u6709\u4e9b\u8bbe\u5907\u9ad8\u901f,\u6709\u4e9b\u4f4e\u901f</p> </li> </ul> </li> <li> <p>\u603b\u7ed3: \u4e0e51\u533a\u522b</p> <p>\u8bf4\u5230\u5e95,\u8fd8\u662f\u4e3a\u4e86\u529f\u8017\u7684\u95ee\u9898,\u9700\u8981\u54ea\u4e2a\u5916\u8bbe, \u5c31\u6253\u5f00\u54ea\u4e2a\u65f6\u949f, \u4e0d\u7528\u7684\u5173\u95ed. </p> <p>\u4e0d\u50cf51, \u5e38\u56fa\u5b9a\u4e3a12MHz\u7684\u5916\u90e8\u6676\u632f,\u4f7f\u7528\u65b9\u4fbf\u786e\u5b9e\u65b9\u4fbf,\u4f46\u662f\u80fd\u8017\u66f4\u5927, \u8fd8\u662f\u4e0d\u5229\u4e8e\u505a\u4ea7\u54c1</p> <p>\u5bf9\u4e8e\u65f6\u949f, \u6211\u7406\u89e3\u4e3a\u5b83\u662f\u5bc4\u5b58\u5668\u7684\u5f00\u5173, \u7528\u5230\u54ea\u4e2a\u5bc4\u5b58\u5668\u5c31\u6253\u5f00\u90a3\u4e2a\u5f00\u5173</p> </li> <li> <p>\u8865\u5145: \u4e3a\u4ec0\u4e48\u5bc4\u5b58\u5668\u9700\u8981\u65f6\u949f ,\u8be6\u89c1\uff1aD\u89e6\u53d1\u5668, \u300a\u6570\u7535\u300b\u300aMIT 6.004\u300b</p> </li> </ul> <p>\u200b                                                                                                                                                   2023. 07. 27</p>"},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/STM32%E6%97%B6%E9%92%9F.html#rcc","title":"\u5173\u4e8eRCC\u65f6\u949f\u7684\u914d\u7f6e\u987a\u5e8f\u95ee\u9898\uff08\u5b58\u7591\uff1f\uff09","text":"<pre><code>//\u6b63\u786e\uff1a\nRCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);\nRCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);\n\n//\u9519\u8bef\uff1a\nRCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);\nRCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);\n</code></pre> <p>\u96be\u9053\u4e0d\u5e94\u8be5\u662f\u5148\u914d\u7f6e\u76f8\u5173GPIO\u5417?</p> <p>\u5148\u6253\u5f00\u4e86ADC,  \u5373\u5728GPIOA\u6253\u5f00\u603b\u7ebf\u65f6\u949f\u4e4b\u524d\u5c31\u9650\u5236\u4e86 GPIO \u7684\u67d0\u4e9b\u5f15\u811a\u4f9b\u5e94\u7535\u6e90. \u5bfc\u81f4\u82af\u7247\u8fdb\u5165\u786c\u4ef6\u5931\u6548\u72b6\u6001\u3002\u8fd9\u662f\u7531\u4e8e\u5728\u672a\u5f00\u542f GPIO \u6a21\u5f0f\u7684\u60c5\u51b5\u4e0b\uff0cIO \u5f15\u811a\u5c06\u5904\u4e8e\u9ad8\u963b\u6297\u72b6\u6001\uff0c\u8f93\u51fa\u7535\u5e73\u4e0d\u786e\u5b9a\uff0c\u4ece\u800c\u53ef\u80fd\u5f71\u54cd\u82af\u7247\u7684\u6b63\u5e38\u5de5\u4f5c</p>"},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/%E6%9E%B6%E6%9E%84%E7%9F%A5%E8%AF%86.html","title":"\u67b6\u6784\u77e5\u8bc6","text":""},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/%E6%9E%B6%E6%9E%84%E7%9F%A5%E8%AF%86.html#arm","title":"ARM\u67b6\u6784","text":"<p>ARM v8\u5904\u7406\u5668\u6982\u8ff0\u3001\u67b6\u6784\u3001\u53ca\u6280\u672f\u4ecb\u7ecd - \u77e5\u4e4e (zhihu.com)</p> <ul> <li>Cortex-M3\uff1a\u8fd9\u662f\u4e00\u79cd\u4f4e\u529f\u8017\u3001\u9ad8\u6027\u80fd\u7684\u5fae\u63a7\u5236\u5668\u67b6\u6784\uff0c\u9002\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u548c\u7269\u8054\u7f51\u8bbe\u5907\u3002</li> <li>Cortex-M4\uff1a\u4e0eCortex-M3\u76f8\u6bd4\uff0cCortex-M4\u5177\u6709\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u66f4\u591a\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u6570\u5b57\u4fe1\u53f7\u5904\u7406\uff08DSP\uff09\u6269\u5c55\u6307\u4ee4\u96c6\uff0c\u9002\u7528\u4e8e\u9700\u8981\u66f4\u9ad8\u6027\u80fd\u7684\u5e94\u7528\u3002</li> <li>Cortex-A9\uff1a\u8fd9\u662f\u4e00\u79cd\u9762\u5411\u9ad8\u6027\u80fd\u5e94\u7528\u7684\u5e94\u7528\u5904\u7406\u5668\u67b6\u6784\uff0c\u9002\u7528\u4e8e\u667a\u80fd\u624b\u673a\u3001\u5e73\u677f\u7535\u8111\u548c\u5176\u4ed6\u79fb\u52a8\u8bbe\u5907\u3002</li> <li>Cortex-A7\uff1a\u4e0eCortex-A9\u76f8\u6bd4\uff0cCortex-A7\u5177\u6709\u66f4\u4f4e\u7684\u529f\u8017\u548c\u66f4\u5c0f\u7684\u5c3a\u5bf8\uff0c\u9002\u7528\u4e8e\u4f4e\u529f\u8017\u79fb\u52a8\u8bbe\u5907\u3002</li> </ul>"},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/%E6%9E%B6%E6%9E%84%E7%9F%A5%E8%AF%86.html#cortex-m3m4","title":"Cortex-M3/M4","text":"<ul> <li>Cortex-M3\u67b6\u6784\u662f\u4e00\u79cd\u901a\u7528\u3001\u786e\u5b9a\u6027\u768432\u4f4d\u6027\u80fd\u5fae\u63a7\u5236\u5668\u67b6\u6784\u3002\u5b83\u662f\u4e3a\u5404\u79cd\u8bbe\u5907\u7684\u6210\u672c\u654f\u611f\u548c\u529f\u8017\u53d7\u9650\u89e3\u51b3\u65b9\u6848\u800c\u8bbe\u8ba1\u7684\u3002Cortex-M3\u5728\u9762\u79ef\u3001\u6027\u80fd\u548c\u529f\u8017\u4e4b\u95f4\u53d6\u5f97\u4e86\u6700\u4f73\u5e73\u8861\uff0c\u975e\u5e38\u9002\u5408\u5fae\u63a7\u5236\u5668\u3001\u6c7d\u8f66\u8f66\u8eab\u7cfb\u7edf\u3001\u5de5\u4e1a\u63a7\u5236\u7cfb\u7edf\u4ee5\u53ca\u65e0\u7ebf\u7f51\u7edc\u548c\u4f20\u611f\u5668\u7b49\u4ea7\u54c1\u3002     Cortex-M3\u662f\u4e00\u4e2a\u5185\u5b58\u6620\u5c04\u7cfb\u7edf\uff0c\u5177\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u3001\u56fa\u5b9a\u7684\u7ebf\u6027\u5185\u5b58\u6620\u5c04\uff0c\u53ef\u5bfb\u57404GB\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5176\u4e2d\u9884\u5b9a\u4e49\u4e86\u7528\u4e8e\u4ee3\u7801\uff08\u4ee3\u7801\u7a7a\u95f4\uff09\u3001SRAM\uff08\u5185\u5b58\u7a7a\u95f4\uff09\u3001\u5916\u90e8\u5b58\u50a8\u5668/\u8bbe\u5907\u4ee5\u53ca\u5185\u90e8/\u5916\u90e8\u5916\u8bbe\u7684\u4e13\u7528\u5730\u5740\u3002</li> <li>Cortex-M4\u67b6\u6784\u662f\u4e00\u79cd\u4f4e\u6210\u672c\u3001\u9ad8\u6027\u80fd\u7684\u5d4c\u5165\u5f0f\u5904\u7406\u5668\uff0c\u65e8\u5728\u6ee1\u8db3\u6570\u5b57\u4fe1\u53f7\u63a7\u5236\u5e02\u573a\u5bf9\u63a7\u5236\u548c\u4fe1\u53f7\u5904\u7406\u80fd\u529b\u9ad8\u6548\u4e14\u6613\u4e8e\u4f7f\u7528\u7684\u9700\u6c42\u3002\u5b83\u7ed3\u5408\u4e86\u9ad8\u6548\u7684\u4fe1\u53f7\u5904\u7406\u529f\u80fd\u4e0eCortex-M\u7cfb\u5217\u5904\u7406\u5668\u7684\u4f4e\u529f\u8017\u3001\u4f4e\u6210\u672c\u548c\u6613\u7528\u6027\u4f18\u52bf\uff0c\u6ee1\u8db3\u4e86\u8bb8\u591a\u5e02\u573a\u7684\u9700\u6c42\uff0c\u5305\u62ec\u7535\u673a\u63a7\u5236\u3001\u6c7d\u8f66\u3001\u7535\u6e90\u7ba1\u7406\u3001\u5d4c\u5165\u5f0f\u97f3\u9891\u548c\u5de5\u4e1a\u81ea\u52a8\u5316\u7b49\u884c\u4e1a\u3002     Cortex-M4\u67b6\u6784\u4e0eCortex-M3\u67b6\u6784\u5728\u4f53\u7cfb\u7ed3\u6784\u4e0a\u57fa\u672c\u76f8\u540c\uff0c\u552f\u4e00\u7684\u533a\u522b\u662fCortex-M4\u96c6\u6210\u4e86DSP\u5355\u5143\u3002\u8fd9\u4f7f\u5f97Cortex-M4\u67b6\u6784\u975e\u5e38\u9002\u5408\u6570\u5b57\u4fe1\u53f7\u63a7\u5236\u5e94\u7528\uff0c\u4f8b\u5982\u97f3\u9891\u7f16\u7801/\u89e3\u7801\u3001\u6ee4\u6ce2\u548c\u5747\u8861\u7b49\u3002</li> </ul>"},{"location":"ARM/1.%20ARM%E6%9E%B6%E6%9E%84/%E6%9E%B6%E6%9E%84%E7%9F%A5%E8%AF%86.html#_1","title":"\u5173\u4e8e\u901a\u7528\u5bc4\u5b58\u5668","text":"<p>ARM\u67b6\u6784\u4e2d\u7684\u901a\u7528\u5bc4\u5b58\u5668R0-R15</p> <ul> <li>\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668(caller saved registers)</li> <li>\u88ab\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668(callee-saved registers)</li> </ul> <p>\u8fd9\u4e24\u4e2a\u6709\u70b9\u96be\u533a\u5206, \u4e3e\u4e2a\u5b9e\u9645\u4ee3\u7801\u7684\u4f8b\u5b50\u5c31\u6e05\u695a\u4e86.</p> <pre><code>int add(int a, int b) \n{\n    return a + b;\n}\nint main()\n{\n    int result = add(3, 4);\n    // \u5176\u4ed6\u64cd\u4f5c\n    return 0;\n}\n</code></pre> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c<code>main()</code>\u51fd\u6570\u662f\u8c03\u7528\u8005\uff0c<code>add()</code>\u51fd\u6570\u662f\u88ab\u8c03\u7528\u8005\u3002\u5f53<code>main()</code>\u51fd\u6570\u8c03\u7528<code>add()</code>\u51fd\u6570\u65f6\uff0c<code>main()</code>\u51fd\u6570\u4f1a\u5c06\u53c2\u65703\u548c4\u4f20\u9012\u7ed9<code>add()</code>\u51fd\u6570\uff0c\u5e76\u7b49\u5f85<code>add()</code>\u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002</p> <p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u8c03\u7528\u8005\u9700\u8981\u4fdd\u5b58\u4e00\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4ee5\u4fbf\u5728\u51fd\u6570\u8c03\u7528\u7ed3\u675f\u540e\u80fd\u591f\u6062\u590d\u539f\u59cb\u503c\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u5728\u51fd\u6570\u8c03\u7528\u671f\u95f4\u53ef\u80fd\u4f1a\u88ab\u4fee\u6539\u3002\u800c\u88ab\u8c03\u7528\u8005\u9700\u8981\u4fdd\u5b58\u4e00\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5e76\u5728\u51fd\u6570\u8c03\u7528\u7ed3\u675f\u540e\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u5728\u51fd\u6570\u8c03\u7528\u671f\u95f4\u4e0d\u4f1a\u88ab\u4fee\u6539\u3002</p> <p>\u5177\u4f53\u5230\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\uff0c<code>main()</code>\u51fd\u6570\u662f\u8c03\u7528\u8005\uff0c\u5b83\u9700\u8981\u4fdd\u5b58R0\u548cR1\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u7528\u4e8e\u4f20\u9012<code>add()</code>\u51fd\u6570\u7684\u53c2\u6570\u3002\u800c<code>add()</code>\u51fd\u6570\u662f\u88ab\u8c03\u7528\u8005\uff0c\u5b83\u9700\u8981\u4fdd\u5b58R4\u548cR5\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u7528\u4e8e\u5b58\u50a8<code>add()</code>\u51fd\u6570\u7684\u5c40\u90e8\u53d8\u91cf\u548c\u4e34\u65f6\u53d8\u91cf\u3002</p> <p>\u5728ARM\u67b6\u6784\u4e2d\uff0c\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u662fR0-R3\u548cR12\uff0c\u88ab\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u662fR4-R11\u3002\u8fd9\u53ea\u662f\u4e00\u822c\u60c5\u51b5\u4e0b\u7684\u7ea6\u5b9a\uff0c\u5177\u4f53\u7684\u5bc4\u5b58\u5668\u5206\u914d\u53ef\u80fd\u4f1a\u56e0\u7f16\u8bd1\u5668\u3001\u7f16\u8bd1\u9009\u9879\u548c\u51fd\u6570\u8c03\u7528\u7ea6\u5b9a\u800c\u6709\u6240\u4e0d\u540c\u3002</p>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html","title":"ARM\u6c47\u7f16","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#arm","title":"ARM\u786c\u4ef6\u7cfb\u7edf\u7ec4\u6210\u548c\u8fd0\u884c\u539f\u7406","text":"<p>\u8be6\u89c1\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406</p> <p></p> <p>\u5927\u6982\u5bf9\u5185\u5b58/flash\u7684\u4f4d\u7f6e\u6709\u4e2a\u5927\u6982\u5370\u8c61, \u77e5\u9053\u6307\u4ee4\u53d6\u81ea\u54ea\u91cc, \u8c01\u6267\u884c...</p> <p>\u5f02\u6784\u8ba1\u7b97: \u5bf9\u4e8e\u8fd9\u4e9b\u90e8\u4ef6( flash \u5185\u5b58... )\u653e\u5728\u54ea\u91cc? \u73b0\u4ee3\u7684\u82af\u7247\u67b6\u6784\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\u505a\u4e86\u54ea\u4e9b\u67b6\u6784\u7684\u63d0\u5347?</p>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_1","title":"\u5de5\u4f5c\u6a21\u5f0f\u53ca\u5bc4\u5b58\u5668\u6846\u56fe","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_2","title":"\u6846\u56fe","text":"<p>\u5c0f\u4e09\u89d2: \u8868\u793a\u8be5\u6a21\u5f0f\u4e0b\u72ec\u6709\u7684\u5bc4\u5b58\u5668</p> <p>\u5176\u4f59\u7684\u5bc4\u5b58\u5668\u90fd\u662f\u5171\u4eab\u7684, \u5171\u4eab\u7684\u503c...</p>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#cpsr","title":"CPSR\u5bc4\u5b58\u5668","text":"<p>\u76ee\u524d\u7a0b\u5e8f\u72b6\u6001\u5bc4\u5b58\u5668: \u8868\u793a\u5904\u7406\u5668\u7684\u5404\u4e2a\u72b6\u6001/\u6a21\u5f0f</p> <p></p> <p>\u91cd\u70b9\u77e5\u8bc6\u70b9</p> <p></p> <ol> <li> <p>7\u79cd\u6a21\u5f0f\u3002\u91cd\u70b9\u638c\u63e1 User\u6a21\u5f0f\u3001FIQ\u3001IRQ\u3001supervisor\uff08SVC\uff09\u6a21\u5f0f</p> </li> <li> <p>37\u4e2a\u5bc4\u5b58\u5668</p> </li> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09 LR\uff08\u8fde\u63a5\u5bc4\u5b58\u5668\uff1a\u8fd4\u56de\u5730\u5740\uff09</p> </li> <li> <p>\u5806\u6808\u6307\u9488</p> </li> <li> <p>User\u6a21\u5f0f\u6700\u5c11\uff0c\u5176\u4ed6\u7684\u5f02\u5e38\u6a21\u5f0f\u90fd\u591a\u4e86\u4e00\u4e2aSPSR_xx\u5bc4\u5b58\u5668\uff0c\u7528\u4f5c\u4fdd\u5b58\u5404\u79cd\u72b6\u6001</p> </li> <li> <p>ARM\u6307\u4ee4\u96c6\u662f\u4e00\u79cd32\u4f4d\u7684\u6307\u4ee4\u96c6\uff0c\u6bcf\u6761\u6307\u4ee4\u90fd\u662f32\u4f4d\u957f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u6027\u80fd\u8ba1\u7b97\u548c\u5904\u7406\u3002ARM\u6307\u4ee4\u96c6\u7684\u7279\u70b9\u662f\u6307\u4ee4\u96c6\u4e30\u5bcc\uff0c\u64cd\u4f5c\u7075\u6d3b\uff0c\u9002\u5408\u5904\u7406\u590d\u6742\u7684\u8ba1\u7b97\u4efb\u52a1\u3002</p> <p>\uff08\u6bd4\u8f83\u5c11\u7528\uff09Thumb\u6307\u4ee4\u96c6\u662fARM\u5904\u7406\u5668\u7684\u4e00\u79cd\u538b\u7f29\u6307\u4ee4\u96c6\uff0c\u6bcf\u6761\u6307\u4ee4\u53ea\u670916\u4f4d\u957f\uff0c\u53ef\u4ee5\u51cf\u5c0f\u7a0b\u5e8f\u7684\u5b58\u50a8\u7a7a\u95f4\u548c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u901f\u5ea6\u3002Thumb\u6307\u4ee4\u96c6\u7684\u7279\u70b9\u662f\u6307\u4ee4\u96c6\u7b80\u5355\uff0c\u6267\u884c\u901f\u5ea6\u5feb\uff0c\u9002\u5408\u5904\u7406\u7b80\u5355\u7684\u8ba1\u7b97\u4efb\u52a1\u3002</p> </li> <li> <p>0\u52304\u4f4d</p> </li> </ol>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_3","title":"\u6c47\u7f16\u6307\u4ee4\u521d\u7ea7","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_4","title":"\u8f6c\u79fb\u6307\u4ee4","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_5","title":"\u6307\u4ee4\u7684\u5b58\u50a8\u548c\u89e3\u6790","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_6","title":"\u6307\u4ee4\u673a\u5668\u7801","text":"<ul> <li> <p>\u7acb\u5373\u6570\u5408\u6cd5\u6027</p> <pre><code>mov r3, #0x1101  \n// (\u62a5\u9519) \u6e90\u64cd\u4f5c\u6570\u53ea\u670912\u4f4d \u4e3a\u4e86\u8868\u793a\u66f4\u5927\u7684\u6570\u600e\u4e48\u529e\nmov r3, #0x1100000\n// (\u4e0d\u62a5\u9519) \n</code></pre> <p>0000 0001 0001</p> <p>\u524d4\u4f4d\u8868\u793a\u79fb\u4f4d\u503c</p> <p>\u5b66\u4e60\u8fd9\u4e2a\u7acb\u5373\u6570\u5408\u6cd5\u6027\u7684\u76ee\u7684: \u7406\u89e3\u5373\u53ef, \u7f16\u7a0b\u7684\u8bdd\u8fd8\u662f\u7528\u4f2a\u6307\u4ee4</p> <p>\u77e5\u9053\u5b58\u50a8\u5728flash\u4e2d\u6c47\u7f16\u6307\u4ee4\u662f\u4e8c\u8fdb\u5236\u7684, \u800c\u8fd9\u4e9b\u6307\u4ee4\u4e5f\u662f\u50cf\u6570\u636e\u4e00\u6837\u662f\u4e8c\u8fdb\u5236\u7684. </p> <p>\u6c47\u7f16\u6307\u4ee4\u4e2d\u7684\u5404\u79cd\u6a21\u5f0f/\u7acb\u5373\u6570/\u6e90\u5bc4\u5b58\u5668/\u76ee\u7684\u5bc4\u5b58\u5668\u4f7f\u7528\u51e0\u4f4d\u51e0\u4f4d\u7684\u4e8c\u8fdb\u5236\u6570\u6765\u8868\u793a, </p> <p>\u53c8\u56e0\u4e3aARM\u768432\u4f4d\u7684\u6307\u4ee4\u8868\u793a\u7684\u8303\u56f4\u6709\u9650, \u6240\u4ee5\u5bf9\u4e8e\u6e90\u5bc4\u5b58\u5668\u53ea\u5206\u914d\u5230\u4e8612\u4f4d\u7684\u7a7a\u95f4, \u90a3\u600e\u4e48\u7528\u5341\u4e8c\u4f4d\u7684\u7a7a\u95f4\u8868\u793a32\u4f4d\u6570\u5462? \u5c31\u662f\u50cf\u4e0a\u9762\u7684\u64cd\u4f5c\u4e86, 3\u4e2a\u5b57\u8282 \u524d1\u4e00\u4e2a\u5b57\u8282\u8868\u793a\u79fb\u4f4d\u503c(0-15\u7684\u5076\u6570\u503c),\u540e\u4e24\u4e2a\u5b57\u8282\u8868\u793a \u5b9e\u9645\u6570\u5b57 (\u5f53\u7136\u8868\u793a\u7684\u6570\u5b57\u4e5f\u662f\u6709\u5c40\u9650\u7684,\u4f46\u4e5f\u662f\u6269\u5927\u4e86\u53ef\u8868\u793a\u7684\u8303\u56f4)</p> <p>\u53e6\u5916: \u5317\u5927\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u300b\u4e2d\u7684MIPS\u6307\u4ee4\u96c6\u7684I\u578b\u6307\u4ee4\u4e3a\u4e86\u8868\u793a32\u4f4d\u7acb\u5373\u6570\u7684\u529e\u6cd5\uff1a\u5982\u4e0b\u56feMIPS\u4e2d\u6269\u5c55\u621032\u4f4d\u6570: </p> <p>\u8bfe\u7a0b\u539f\u8bdd: </p> <p>\u4ece\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u7684\u683c\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0c\u76ee\u6807\u5730\u5740\u53ea\u80fd\u4f7f\u752816\u4f4d\u7684\u4f4d\u79fb\u91cf\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5c40\u9650\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u5f97\u8003\u8651\u5982\u4f55\u5145\u5206\u53d1\u6325\u8fd916\u4f4d\u7684\u4f5c\u7528\u3002</p> <p>\u5982\u679c\u4ee5\u5f53\u524d\u7684PC\u5bc4\u5b58\u5668\u4e3a\u57fa\u51c6\uff0c\u5728MIPS\u4e2d\uff0c\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4\u5730\u5740\u7684\u5bc4\u5b58\u5668\u79f0\u4e3aPC\uff0c\u7c7b\u4f3c\u4e8eX86\u4e2d\u7684IP\u5bc4\u5b58\u5668\u3002</p> <p>PC\u8fd9\u4e2a\u5bc4\u5b58\u5668\uff0c\u662f\u6307\u541132\u4f4d\u5730\u5740\u7684\uff0c\u5982\u679c\u4ee5\u5b83\u4e3a\u57fa\u51c6\uff0c16\u4f4d\u4f4d\u79fb\u91cf\u53ef\u4ee5\u8868\u793a\u51fa\u5f53\u524d\u6307\u4ee4\u524d\u540e2\u768415\u6b21\u65b9\u5b57\u8282\u8fd9\u4e48\u4e00\u4e2a\u8303\u56f4\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u8981\u6ce8\u610f\u4e00\u70b9\uff0cMIPS\u7684\u6307\u4ee4\u957f\u5ea6\u56fa\u5b9a\u4f4d32\u4e2a\u6bd4\u7279\uff0c\u56e0\u6b64\u6bcf\u6761\u6307\u4ee4\u7684\u4f4d\u7f6e\uff0c\u4e00\u5b9a\u4f1a\u5728\u56db\u4e2a\u5b57\u8282\u5bf9\u9f50\u7684\u5730\u65b9\uff0c\u8fd9\u6837\u5730\u5740\u6700\u4f4e\u4e24\u4f4d\u80af\u5b9a\u4e3a0\u3002\u6240\u4ee5\u6211\u4eec\u5b9e\u9645\u4e0a\u53ef\u4ee5\u7528\u5341\u516d\u4f4d\u7684\u4f4d\u79fb\u91cf\u53bb\u6307\u793a\u6bcf\u56db\u4e2a\u5b57\u8282\u4e3a\u4e00\u4e2a\u5355\u4f4d\u7684\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u76ee\u6807\u5730\u5740\u7684\u8303\u56f4\u6269\u5927\u56db\u500d\uff0c\u53ef\u4ee5\u8fbe\u5230\u524d\u540e128KB\u3002</p> </li> <li> <p>\u4f7f\u7528\u4f2a\u6307\u4ee4: \u8868\u793a\u5f88\u5927\u7684\u6570\u907f\u514d\u5408\u6cd5\u6027\u5224\u65ad: ldr r3,=0x3ffff</p> </li> </ul> <p></p> <pre><code>a\u221a  b\u00d7  c\u221a  d  e\u221a  f\u00d7   \n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_7","title":"\u8df3\u8f6c\u6307\u4ee4","text":"<pre><code>b    main      \u8df3\u8f6c\u5230\u6807\u53f7\u4e3amain\u5730\u4ee3\u7801\u5904 (\u53ea\u80fd\u77ed\u8df3\u8f6c32M) \n\nbl   func      \u8df3\u8f6c\u51fd\u6570func,\u5e76\u4fdd\u5b58\u4e0b\u4e00\u6761\u8981\u6267\u884c\u7684\u6307\u4ee4\u7684\u4f4d\u7f6e\u5230 lr\u5bc4\u5b58\u5668,\n               \u5f53\u8df3\u8f6c\u4ee3\u7801\u7ed3\u675f\u540e,\u7528mor pc,lr\u6307\u4ee4\u8df3\u56de\u6765\n\nbeq  addr     \u76f8\u7b49\u65f6\uff0c\u8df3\u8f6c\u5230\u5730\u5740addr\u5904\n                          \u76f8\u7b49\uff08\u6307CPSR\u5bc4\u5b58\u5668\u4e2d\u7684Z\u6761\u4ef6\u7801\u7f6e\u4f4d\u65f6)\n\nbne  addr     \u4e0d\u7b49\u65f6\uff0c\u8df3\u8f6c\u5230\u5730\u5740addr\n</code></pre> <ul> <li>\u7528 \u6c47\u7f16 \u5b9e\u73b0C\u8bed\u8a00\u529f\u80fd</li> </ul> <pre><code>void main(void)\n{\n    int ret=0;\n    ret=func1(2);   \n    while(1){}  \n}   \nint  func1(int a)\n{\n    if(a==2)\n        return func2(a);\n    else\n        return func3(a);  \n}\nint  func2(int a) \n{    \n    return a+3;\n} \nint func3(int a)\n{    \n    return a-1;\n} \n</code></pre> <pre><code> @\u793a\u4f8b\u4ee3\u7801\n .text\n b   main  @eset \n nop\n NOP\n nop\n nop\n nop\n nop\n nop\nmain: \n  mov r2,#0  @r2 ~ ret\n  mov  r0,#2\n  bl   func1\nmain_end:\n  b   main_end\n\n\nfunc1:      \n  mov  r12,lr  @\u6ce8\u610f\u51fd\u6570\u5d4c\u5957\u8c03\u7528 \u4f1a\u8986\u76d6LR\u5bc4\u5b58\u5668\n  cmp  r0,#2\n  bleq func2\n  blne func3\nfunc1_end:\n  mov  pc,r12 \n\nfunc2:\n  add  r0,#3\nfunc2_end:\n  mov  pc,lr \n\nfunc3:\n  sub  r0,#1\nfunc3_end:\n  mov  pc,lr\n\n  .end\n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_8","title":"\u903b\u8f91\u6307\u4ee4","text":"<pre><code>and    r0,r1,r2       \nand    r0,r1,#0xFF    \u4e0e\n\norr    r0,r1,r2\norr    r0,r1,#0xFF    \u6216\n\nbic    r0,r0,#0x0B    \u6e05\u9664r0\u4e2d\u7684\u4f4d 0\u30011\u3001\u548c 3  \ntst    r0,#0x20       \u6d4b\u8bd5\u7b2c6\u4f4d\u662f\u5426\u4e3a0 \uff0c\u4e3a0\u5219Z\u6807\u5fd7\u7f6e1 \ncmp    r1,r0          \u5c06\u5bc4\u5b58\u5668R1\u7684\u503c\u4e0e\u5bc4\u5b58\u5668R0\u7684\u503c\u76f8\u51cf\uff0c\n                      \u5e76\u6839\u636e\u7ed3\u679c\u8bbe\u7f6eCPSR\u7684\u6807\u5fd7\u4f4d\n</code></pre> <p>\u6d4b\u8bd5: 1.\u5224\u65ad\u5f53\u524d\u5de5\u4f5c\u72b6\u6001\u662f\u5426\u662fARM\u72b6\u6001\uff0c\u662f\u5219\u5207\u6362\u5230user \u5de5\u4f5c\u6a21\u5f0f\uff1f 2.\u4f7f\u80fd\u4e2d\u65ad\u548c\u5feb\u901f\u4e2d\u65ad\uff1f   </p> <pre><code>@ \u793a\u4f8b\u4ee3\u7801\n.text\n b   main  @eset \n nop\n NOP\n nop\n nop\n nop\n nop\n nop\nmain: \n /* mov  r1,#0x03  @ 0000 0011\n  mov  r2,#0x0e  @ 0000 1110\n  orr  r0,r1,r2\n\n  mov  r1,#0x42\n  and  r1,#0xf0  \n\n  mov  r0,#0xff  @1111 0100 \n  bic  r0,#0x0b  @0000 1011\n  mov  r0,#0x56  @0101 0110\n  tst  r0,#0x20  @0010 0000\n\n  mov r0,#4\n  cmp r0,#4\n  */\n  /*\n  mrs r0,cpsr\n  tst r0,#0x20\n  bic r0,#0x1f\n  orr r0,#0x10  @switch user\n  msreq cpsr,r0\n  */\n  mrs r0,cpsr\n  bic r0,#0xc0\n  msr cpsr,r0\n\n\nmain_end:\n  b   main_end\n  .end  \n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_9","title":"\u7b97\u672f\u6307\u4ee4","text":"<pre><code>add     r0,r1,r2       \u9ed8\u8ba4\u662f\u4e0d\u5f71\u54cdCPSR\u7684\u6807\u5fd7\u4f4d\u7684\nadd     r0,#1\n\nsub     r0,r1,#3      \u7c7b\u4f3c  r0= r1 - 3\nsub     r0,#1\n\nsub     r0,r1,r2,LSL#1     \n</code></pre> <ul> <li>\u5ef6\u65f61s</li> </ul> <pre><code>delay1s:    \n    ldr  r4,=0x3FFFF\nloop_delay1s:\n    sub     r4,r4,#1\n    cmp     r4,#0          \n    bne     loop_delay1s\n    mov    pc,lr\n</code></pre> <pre><code> @\u793a\u4f8b\u4ee3\u7801\n .text\n b   main  @eset \n nop\n NOP\n nop\n nop\n nop\n nop\n nop\nmain: \n  /*mov r1,#1\n  mov r2,#2\n  add r0,r1,r2\n\n  add r0,#1\n\n  mov r1,#3\n  mov r2,#1\n  sub r0,r1,r2,lsl#1\n  */\n  mov r0,#1\n  bl  delay_1s\n  mov r1,#2 \nmain_end:\n  b   main_end\n\n\ndelay_1s:\n  @mov  r4,#0xfffff\n  ldr  r4,=0x1fffff\ndelay_loop:  \n  cmp  r4,#0\n  beq  delay_1s_end\n  subne r4,#1\n  b   delay_loop\ndelay_1s_end:\n  mov pc,lr\n\n\n  .end  \n</code></pre> <ul> <li>\u6700\u5927\u516c\u7ea6\u6570</li> </ul> <pre><code>int GCD(int a,int b)\n{         \n    while(1)\n    {\n        if(a==b)\n            break;  \n        if(a&gt;b){\n            a=a-b;\n        }else{\n          b=b-a;    \n        }   \n    }       \n    return a;          \n}   \n</code></pre> <pre><code> .text\n b   main  @eset \n nop\n NOP\n nop\n nop\n nop\n nop\n nop\nmain: \n  mov r0,#9\n  mov r1,#15\n  bl  gcd\nmain_end:\n  b   main_end\n\ngcd:\ngcd_loop:\n  cmp  r0,r1\n  beq  gcd_end\n  subgt  r0,r1\n  sublt  r1,r0\n  b   gcd_loop\n\ngcd_end:\n  mov pc,lr\n\n  .end  \n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_10","title":"\u6c47\u7f16\u6307\u4ee4\u9ad8\u7ea7","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#loadstore","title":"Load/Store\u67b6\u6784","text":"<ul> <li> <p>\u524d\u7d22\u5f15/\u540e\u7d22\u5f15</p> <p>\u6709\u70b9\u7c7b\u4f3ci++\u548c++i</p> <p>\u524d\u7d22\u5f15: \u5730\u5740\u5148\u52a0, \u518d\u8d4b\u503c(++i), \u4f46\u662f\u4e0d\u6539\u53d8\u539f\u6765\u7684r8\u91cc\u9762\u7684\u5185\u5bb9</p> <pre><code>str r0,[r8,#8]     \n</code></pre> <p>\u540e\u7d22\u5f15: \u5730\u5740\u5148\u8d4b\u503c, \u518d\u52a0, **\u8d4b\u503c\u4e4b\u540e, \u5c06r8\u52a08 **     (\u5e38\u7528\u4e8e\u5faa\u73af\u62f7\u8d1d)</p> <pre><code>str r0,[r8],#8   @i++\n</code></pre> </li> <li> <p>\u6c47\u7f16\u5b9e\u73b0\u6570\u636e\u62f7\u8d1d</p> <pre><code>//\u7528\u6c47\u7f16\u5b9e\u73b0C\u5185\u5bb9\nmain()\n{\n    int i=0;\n    const  char buf[]={1,2,3};\n    char destBuf[8];\n    for(i=0,i&lt;3,i++)\n    {\n        destBuf[i] = buf[i];\n    }\n}\n</code></pre> <pre><code>    .text\n    b   main  \n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\nmain: \n         mov r4,#0\n    ldr r7,=buf\n    ldr r8,=destBuf\nloop:\n        cmp  r4,#3\n    beq  main_end\n\n    ldrb  r0,[r7],#1\n    strb  r0,[r8],#1\n\n    add r4,#1\n    b  loop\n\nmain_end:\n    b  main_end\n\nbuf:\n    .byte 1,2,3\n\n    .data\n\ndestBuf:\n    .space 8\n\n    .end\n</code></pre> </li> </ul>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#gnu","title":"GNU\u6c47\u7f16\u4f2a\u6307\u4ee4","text":"<p>\u8ba9\u7f16\u8bd1\u5668\u53bb\u89e3\u91ca\u7684 </p> <p></p> <pre><code>.section               //\u5b9a\u4e49\u5185\u5b58\u6bb5\n.text                  //\u5c06\u5b9a\u4e49\u7b26\u5f00\u59cb\u7684\u4ee3\u7801\u7f16\u8bd1\u5230\u4ee3\u7801\u6bb5\n.data                  //\u6570\u636e\u6bb5\n.if  .else  .endif     //\u6761\u4ef6\u7f16\u8bd1\n.end                   //\u6587\u4ef6\u7ed3\u675f\n\n.byte   0x11, \u2019a\u2019,0    //\u5b9a\u4e49char\u578b\u6570\u7ec4(.byte \u5bf9\u5e941\u5b57\u8282)\n.word  0x12, 0x445566  //\u5b9a\u4e49int\u578b\u6570\u7ec4(. word \u5bf9\u5e944\u5b57\u8282)\n.quad  0x3FA0          //\u5206\u914d8\u5b57\u8282\u7684\u7a7a\u95f4(.quad \u5bf9\u5e948\u5b57\u8282)\n.string  \u201cabcd\\0\u201d      //\u5b9a\u4e49\u5b57\u7b26\u4e32\n.align   4             //2^4 =16 \u5b57\u8282\u5bf9\u9f50\n\n ldr r0, =0xE0028008   //\u8f7d\u5165\u5927\u5e38\u65700xE0028008 \u5230r0\u4e2d\n.equ  GPG3CON, 0XE03001C0     //\u5b9a\u4e49\u5b8f\n.global  _start         //\u58f0\u660e_start \u4e3a\u5168\u5c40\u7b26\u53f7\n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_11","title":"\u6279\u91cf\u64cd\u4f5c\u6307\u4ee4","text":"<pre><code>   ldr    r12,=srcBuf\n   ldr    r13,=dstBuf\n   ldmia  r12!,{r0 - r11}\n   stmia  r13!,{r0 - r11}\n\n  .data\nsrcBuf:\n  .string \"abcdefghijkomnopqrstubwxyz\\0\"\ndstBuf:\n   .space  12*4\n</code></pre>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_12","title":"\u5806\u6808\u64cd\u4f5c\u6307\u4ee4","text":""},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#_13","title":"\u5f02\u5e38\u5904\u7406\uff08\u91cd\u8981\u7406\u89e3\uff09","text":"<ul> <li> <p>\u5f02\u5e38\u548c\u4e2d\u65ad</p> <p>\u4e2d\u65ad\u548c\u5f02\u5e38\u662f\u6709\u5173\u8054\u7684\uff0c\u5b83\u4eec\u90fd\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u5904\u7406\u5916\u90e8\u4e8b\u4ef6\u548c\u5f02\u5e38\u60c5\u51b5\u7684\u673a\u5236\u3002\u53ef\u4ee5\u8bf4\u4e2d\u65ad\u548c\u5f02\u5e38\u662f\u5305\u542b\u5173\u7cfb\uff0c\u56e0\u4e3a\u5f02\u5e38\u662f\u4e2d\u65ad\u7684\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u3002\u5728\u5904\u7406\u5668\u7684\u8bbe\u8ba1\u4e2d\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528\u4e00\u4e2a\u7edf\u4e00\u7684\u4e2d\u65ad/\u5f02\u5e38\u5904\u7406\u673a\u5236\u6765\u5904\u7406\u4e2d\u65ad\u548c\u5f02\u5e38\u3002\u56e0\u6b64\uff0c\u4e2d\u65ad\u548c\u5f02\u5e38\u53ef\u4ee5\u8bf4\u662f\u5e76\u5217\u5b58\u5728\u7684\u3002</p> <p>\u4e2d\u65ad\u662f\u7531\u5916\u90e8\u8bbe\u5907\u6216\u5176\u4ed6\u5904\u7406\u5668\u89e6\u53d1\u7684\uff0c\u800c\u5f02\u5e38\u662f\u7531\u7a0b\u5e8f\u6267\u884c\u4e2d\u7684\u9519\u8bef\u6216\u4e0d\u6b63\u5e38\u60c5\u51b5\u5f15\u8d77\u7684\u3002\u901a\u8fc7\u4e00\u4e9b\u4ee3\u7801\u4f8b\u5b50\u548c\u5b9e\u9645\u60c5\u51b5\u6765\u8bf4\u660e\u8fd9\u4e9b\u6982\u5ff5\u3002</p> <ol> <li>\u4e2d\u65ad\u7684\u4f8b\u5b50\uff1a \u5047\u8bbe\u6709\u4e00\u4e2a\u5916\u90e8\u8bbe\u5907\uff0c\u6bd4\u5982\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53\u5b9a\u65f6\u5668\u8ba1\u65f6\u7ed3\u675f\u65f6\uff0c\u5b83\u53ef\u4ee5\u5411\u5904\u7406\u5668\u53d1\u9001\u4e2d\u65ad\u8bf7\u6c42\uff0c\u4ee5\u901a\u77e5\u5904\u7406\u5668\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f2a\u4ee3\u7801\u4f8b\u5b50\uff1a</li> </ol> <pre><code>// \u5916\u90e8\u8bbe\u5907\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\nvoid externalInterruptHandler() {\n    // \u5904\u7406\u5916\u90e8\u8bbe\u5907\u4e2d\u65ad\n}\n\n// \u4e3b\u7a0b\u5e8f\nint main() {\n    // \u521d\u59cb\u5316\u5916\u90e8\u8bbe\u5907\u4e2d\u65ad\n    initExternalInterrupt(externalInterruptHandler);\n\n    while (1) {\n        // \u6267\u884c\u4e3b\u7a0b\u5e8f\n    }\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5f53\u5916\u90e8\u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42\u88ab\u89e6\u53d1\u65f6\uff0c\u5904\u7406\u5668\u4f1a\u8df3\u8f6c\u5230\u5916\u90e8\u8bbe\u5907\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\u3002</p> <ol> <li>\u5f02\u5e38\u7684\u4f8b\u5b50\uff1a \u5f02\u5e38\u901a\u5e38\u662f\u7531\u7a0b\u5e8f\u6267\u884c\u4e2d\u7684\u9519\u8bef\u6216\u4e0d\u6b63\u5e38\u60c5\u51b5\u5f15\u8d77\u7684\uff0c\u6bd4\u5982\u9664\u96f6\u9519\u8bef\u3001\u5185\u5b58\u8bbf\u95ee\u8d8a\u754c\u7b49\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f2a\u4ee3\u7801\u4f8b\u5b50\uff1a</li> </ol> <pre><code>// \u53ef\u80fd\u5f15\u53d1\u5f02\u5e38\u7684\u4ee3\u7801\nint divide(int a, int b) {\n    if (b == 0) {\n        // \u9664\u96f6\u9519\u8bef\uff0c\u89e6\u53d1\u5f02\u5e38\n        raiseException(DIVIDE_BY_ZERO_EXCEPTION);\n    }\n    return a / b;\n}\n\n// \u4e3b\u7a0b\u5e8f\nint main() {\n    int result;\n    try {\n        result = divide(10, 0);\n    } catch (Exception e) {\n        // \u5904\u7406\u5f02\u5e38\n    }\n    // \u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4ee3\u7801\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5f53\u9664\u96f6\u9519\u8bef\u53d1\u751f\u65f6\uff0c\u4f1a\u89e6\u53d1\u5f02\u5e38\uff0c\u5e76\u4e14\u5904\u7406\u5668\u4f1a\u8df3\u8f6c\u5230\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>\u5f02\u5e38\u5411\u91cf\u8868</p> </li> </ul> <p>\u4e2d\u65ad\u5411\u91cf\u8868\u662f\u4e00\u4e2a\u5b58\u50a8\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5165\u53e3\u5730\u5740\u7684\u8868</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u5f02\u5e38\u5411\u91cf\u8868\u5462\uff1f\u8ba9\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u6574\u4e2a\u5206\u6790\u6d41\u7a0b</p> <ol> <li>\u56e0\u4e3a\u5f02\u5e38\u662f\u968f\u673a\u4ea7\u751f\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u77e5\u9053\u5728\u4ec0\u4e48\u65f6\u5019\u4f1a\u6709\u5f02\u5e38\uff0c\u518d\u52a0\u4e0a\u6709\u5404\u79cd\u5404\u6837\u7684\u5f02\u5e38\uff0c\u6545\u6211\u4eec\u7f16\u5199\u6c47\u7f16\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u77e5\u9053\u5728\u54ea\u91cc\u76f4\u63a5\u5199\u4e00\u6761b\u6307\u4ee4\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u5f02\u5e38\u670d\u52a1\u51fd\u6570\u3002</li> <li>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5206\u6210\u786c\u4ef6\u548c\u8f6f\u4ef6\u4e24\u90e8\u5206\u89e3\u51b3\u3002</li> <li>\u9996\u5148\uff0c\u5224\u65ad\u662f\u4ec0\u4e48\u5f02\u5e38\u7684\u64cd\u4f5c\uff0c\u7531\u786c\u4ef6\u7535\u8def\u6765\u5b9e\u73b0\uff0c\u8fd9\u91cc\u4e0d\u5c55\u5f00\u8bf4\u3002\u5176\u6b21\uff0c\u77e5\u9053\u4e86\u662f\u4ec0\u4e48\u5f02\u5e38\uff0c\u90a3\u6211\u4eec\u8981\u6267\u884c\u4ec0\u4e48\u64cd\u4f5c\u5e94\u5bf9\u5f02\u5e38\u5462\uff1f\u4e5f\u5c31\u662f\u5f02\u5e38\u670d\u52a1\u51fd\u6570\u5728\u54ea\u91cc\u7684\u95ee\u9898\u3002</li> <li>\u90a3\u6211\u4eec\u5c31\u9700\u8981\u4e00\u4e2a\u5730\u65b9\u6765\u5b58\u653e\u5f02\u5e38\u670d\u52a1\u51fd\u6570\u7684\u5730\u5740\uff0c\u4ee5\u4fbf\u5f02\u5e38\u6765\u7684\u65f6\u5019\uff0c\u80fd\u77e5\u9053\u53bb\u54ea\u91cc\u6267\u884c\u5bf9\u5e94\u7684\u670d\u52a1\u51fd\u6570\u3002</li> <li> <p>\u901a\u8fc7\u786c\u4ef6\u5224\u65ad\u51fa\u5c5e\u4e8e\u54ea\u79cd\u5f02\u5e38\u4e4b\u540e\uff0c\u77e5\u9053\u5f02\u5e38\u53f7\uff08\u7d22\u5f15\uff09\uff0c\u5728\u5f02\u5e38\u5411\u91cf\u8868\u91cc\u9762\u627e\u5230\u5bf9\u5e94\u7684\u5f02\u5e38\u670d\u52a1\u51fd\u6570\u5730\u5740\u3002\u4e4b\u540e\u8f7d\u5165PC\uff0c\u6267\u884c\u670d\u52a1\u51fd\u6570\uff0c\u8fd4\u56de\u88ab\u6253\u65ad\u7684\u51fd\u6570</p> </li> <li> <p>\u8f6f\u4e2d\u65ad\u6700\u7b80</p> <p>\u4f5c\u4e3a\u6700\u57fa\u672c\u7684\u6846\u67b6\u5206\u6790\u5176\u4ed6\u7684\u5f02\u5e38/\u4e2d\u65ad</p> <pre><code>    .text\n    @---------vector table\n    b   main    @0x00 reset\n    nop         @0x04 undef         \n    b sirq_hander   @0x08 soft irq\n    nop         @0x0c prefecth abort\n    nop         @0x10 data abort\n    nop     @0x14 reserved\n    nop     @0x18 irq\n    nop     @0x1C fiq\n\n    @ handler vector table\nsirq_hander:                \n        stmfd sp!,{r0-r12,lr}    @\u4fdd\u5b58\u73b0\u573a\n        add  r2,#1\nsirq_hander_end:\n    ldmfd sp!,{r0-r12,pc}        @LR\u8fd4\u56de\u5730\u5740\u7684\u503c\u8981\u7ed9PC,\u4e0d\u7136\u65e0\u6cd5\u8fd4\u56de\u5730\u5740\n\n        @----------app----\nmain: \n    ldr sp,=stack_buf            @\u5b9a\u4e49\u6808\u7a7a\u95f4,\u4f7f\u5806\u6808\u6307\u9488\u6307\u5411\u6808\u5e95,\u4e3a\u4e86\u51fd\u6570\u8981 \n    mov r1,#1\n    mov r2,#2\n    swi 0x1   \n    cmp r2,#2\n    moveq r4,#4\n    movne r4,#6\nmain_end:\n    b  main_end\n\n    .data\n\n        .space 15*4\nstack_buf:              @\u6807\u53f7\u5199\u5728\u4e0b\u9762,\u56e0\u4e3aARM\u7684\u6808\u662f\u5411\u4e0b\u751f\u957f\u7684,\n\n    .end\n</code></pre> </li> <li> <p>\u8f6f\u4e2d\u65ad\u5b8c\u6574</p> </li> </ol> <pre><code>    .text\n    @---------vector table\n    b   main    @0x00 reset\n    nop         @0x04 undef         \n    ldr pc,_sirq_hander @0x08 soft irq  @\u8fd9\u4e00\u6b65\u64cd\u4f5c\u7684\u76ee\u7684,\u4e3a\u4e86\u6269\u5927\u8df3\u8f6c\u5730\u5740\u4e3a32M,\u53ef                        \u80fd\u5c31\u662f\u5f02\u5e38\u670d\u52a1\u51fd\u6570\u653e\u5728\u5185\u5b58\u4e2d\u5f88\u8fdc\u7684\u5730\u65b9\n    nop         @0x0c prefecth abort\n    nop         @0x10 data abort\n    nop      @0x14 reserved\n    nop      @0x18 irq\n    nop      @0x1C fiq\n\n_sirq_hander:\n    .word  sirq_hander\n\n    @ handler vector table\nsirq_hander:\n    stmfd sp!,{r0-r12,lr}\n    ldr r0,[lr,#-4]          @\u83b7\u53d6LR\u7684\u5185\u5bb9,(LR\u5b58\u7740\u8fd4\u56de\u5730\u5740,LR-4\u5c31\u83b7\u5f97\u4e86\u5bf9\u5e94swi\u6307\u4ee4                             \u7684\u5730\u5740,\u518d\u7531[]\u53d6\u51fa\u5730\u5740\u7684\u5185\u5bb9,\u5c31\u662fswi\u6307\u4ee4,\u7531\u4e0b\u56feswi\u6307\u4ee4                             \u7684\u673a\u5668\u7801\u53ef\u77e5,\u8f6f\u4e2d\u65ad\u53f7\u5c31\u5728\u673a\u5668\u7801\u4e2d,\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b8c\u6574\u5730\u5904\u7406\u591a                             \u4e2a\u8f6f\u4e2d\u65ad\u4e86)\n    bic r0,#0xff000000       @\u6e05\u9664\u6700\u9ad8\u4e24\u4f4d,\u7531\u6307\u4ee4\u7684\u673a\u5668\u7801\u53ef\u77e5,\u7acb\u5373\u6570\u6700\u591a\u5c31\u524d6\u4e2a\u5b57\u8282\n    cmp r0,#1                @1\u53f7\u8f6f\u4e2d\u65ad\n    addeq  r2,#1\n    cmp r0,#2                @2\u53f7\u8f6f\u4e2d\u65ad\n    subeq  r2,#1  \n\nsirq_hander_end:\n    ldmfd sp!,{r0-r12,pc}\n    @----------app----\nmain: \n    ldr sp,=stack_buf\n    mov r1,#1\n    mov r2,#2                @LR-4\n    swi 0x1                  @LR\n    cmp r2,#2\n    moveq r4,#4\n    movne r4,#6\n    swi 0x2\n    mov r0,#3   \nmain_end:\n    b  main_end\n\n\n    .data\n\n    .space 15*4\nstack_buf:\n\n    .end\n</code></pre> <p>\u5927\u81f4\u5185\u5bb9\u540c \"\u8f6f\u4e2d\u65ad\u6700\u7b80\"</p> <p></p> <p>**\u8865\u5145\u4e0a\u9762\u7684ARMv7\u7cfb\u5217 Cortex-A5\\A7\\A8\\A9\u7684u-boot\u7684\u5177\u4f53\u683c\u5f0f: **</p> <p></p>"},{"location":"ARM/2.%20ARM%E6%B1%87%E7%BC%96/ARM%E6%B1%87%E7%BC%96.html#arm_1","title":"ARM\u6c47\u7f16\u7684\u6e90\u5934","text":"<p>\u4e0a\u9762\u7b80\u5355\u4ecb\u7ecd </p> <p>\u66f4\u591a\u6df1\u5165\u7684\u3001\u522b\u7684\u6307\u4ee4...\u8be6\u89c1ARM\u5b98\u65b9\u6587\u6863</p> <pre><code>ARM Cortex-A \u7cfb\u5217 ARMv7-A \u7a0b\u5e8f\u5458\u6307\u5357 \n// https://developer.arm.com/documentation/den0013/d  \nArmv7 \u548c\u66f4\u65e9\u7684 Arm \u67b6\u6784\u53c2\u8003\u6307\u5357\u7684\u6307\u4ee4\u96c6\u6c47\u7f16\u6307\u5357 //https://developer.arm.com/documentation/100076/0200/a32-t32-instruction-set-reference/a32-and-t32-instructions    \n\u57fa\u672c\u6c47\u7f16\u8bed\u8a00\u7a0b\u5e8f\u8bbe\u8ba1 \n//https://developer.arm.com/documentation/dui0040/d/Basic-Assembly-Language-Programming    \n</code></pre> <p>\u76ee\u7684: \u6784\u5efa\u77e5\u8bc6\u5730\u56fe \u77e5\u9053\u54ea\u91cc\u80fd\u627e\u5404\u79cd\u8d44\u6599 </p> <ol> <li> <p>\u5b98\u7f51</p> </li> <li> <p>B\u7ad9/YouTube</p> <p>......</p> </li> </ol>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html","title":"Example","text":""},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_1","title":"\u524d\u8a00","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u63a8\u51fa64\u4f4d\u6c47\u7f16?</p>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_2","title":"\u4e09\u5927\u539f\u56e0","text":"<ol> <li> <p>\u5e94\u5bf9\u5927\u5185\u5b58 </p> <p>\u5927\u5185\u5b58(Large Memory): \u7a81\u783432\u4f4d\u673a\u76844G\u7a7a\u95f4\u9650\u5236  -&gt; \u786c\u4ef6\u8d8a\u6765\u8d8a\u5f3a\uff0c\u8f6f\u4ef6\u8d8a\u6765\u8d8a\u590d\u6742 </p> </li> <li> <p>\u865a\u62df\u5316</p> <p>\u865a\u62df\u5316(Virtualization): \u9694\u79bb \u9ad8\u6548  -&gt; \u865a\u62df\u673a  </p> </li> <li> <p>\u5b89\u5168</p> <p>\u5b89\u5168(Security):  \u7269\u7406\u9694\u79bb/\u786c\u4ef6\u9694\u79bb  -&gt; \u4ea4\u6613\u652f\u4ed8\uff0c\u9690\u79c1\u6570\u636e\u5b89\u5168</p> </li> </ol>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#arm64","title":"ARM64\u4f4d\u7684\u521b\u65b0","text":"<ol> <li> <p>\u6267\u884c\u72b6\u6001</p> <ul> <li>AArch64 \u548c AArch32 \u4e24\u79cd\u53ef\u5207\u6362<ul> <li>AArch64: \u65b0\u589eA64(ARM 64bit)\u6307\u4ee4\u96c6 -&gt; \u5927\u5185\u5b58(\u7a81\u78344G\u9650\u5236)</li> <li>AArch32: \u53ef\u7528\u4ee5\u524dA32(ARM 32bit)\u6307\u4ee4\u96c6\u548c T32(Thumb 32bit)\u6307\u4ee4\u96c6 -&gt; \u5411\u524d\u517c\u5bb9</li> </ul> </li> </ul> </li> <li> <p>\u5f02\u5e38\u7ea7\u522b</p> <p>EL0(\u5e94\u7528) &lt; EL1(OS) &lt; EL2(\u865a\u62df\u5316) &lt; EL3(\u5b89\u5168\u56fa\u4ef6) -&gt; \u66ff\u4ee3\u5570\u55e6\u7684\u5de5\u4f5c\u6a21\u5f0f(User\u3001SVC...)</p> </li> <li> <p>\u5b89\u5168\u6a21\u5f0f</p> <p>\u5206\u4e3a\u6b63\u5e38\u4e16\u754c \u548c \u5b89\u5168\u4e16\u754c  -&gt; \u771f\u6b63\u7684\u5b89\u5168(\u7269\u7406\u9694\u79bb,\u5982\u652f\u4ed8\u573a\u666f)  </p> </li> </ol>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_3","title":"\u591a\u6838\u5904\u7406\u5668","text":"<p>\u901a\u7528\u7684CPU+\u7279\u5b9a\u9886\u57df\u7684\u82af\u7247\uff08GPU/NPU/TPU/DSP...\uff09</p> <p>\u5982\u4f55\u534f\u8c03\u591a\u6838\u7684\u901a\u4fe1....</p>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#mmu","title":"\u5185\u5b58\u7ba1\u7406\u5355\u5143MMU","text":""},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#armv8","title":"ARMv8 \u5bc4\u5b58\u5668\u6846\u56fe","text":"<ul> <li> <p>\u901a\u7528\u5bc4\u5b58\u5668</p> <pre><code>X/W  //X\u662f64\u4f4d  W\u662f\u4f4e32\u4f4d\n\nARMv7 \u4e2d\u4f7f\u7528Bank\u6765\u51cf\u5c11\u5f02\u5e38\u7684\u5ef6\u8fdf //\u7136\u800c\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u90fd\u4e0d\u5230\u4e00\u534a\nAArch64 \u6267\u884c\u72b6\u6001\u5177\u6709 31 \u00d7 64 \u4f4d\u901a\u7528\u5bc4\u5b58\u5668 //\u53ef\u5728\u6240\u6709\u65f6\u95f4\u548c\u6240\u6709\u5f02\u5e38\u7ea7\u522b\u8bbf\u95ee \n</code></pre> </li> <li> <p>\u7279\u6b8a\u5bc4\u5b58\u5668</p> <pre><code>XZR     //\u96f6\u5bc4\u5b58\u5668: \u7528\u4f5c\u6e90\u5bc4\u5b58\u5668\u65f6\u8bfb\u4e3a\u96f6\uff0c\u7528\u4f5c\u76ee\u6807\u5bc4\u5b58\u5668\u65f6\u4e22\u5f03\u7ed3\u679c \nSP      //\u5806\u6808\u6307\u9488 (\u6bcf\u4e2a\u5f02\u5e38\u7ea7\u522b\uff0c\u72ec\u6709\u4e00\u4e2a\u526f\u672cSP_ELn)\nPC      //\u7a0b\u5e8f\u8ba1\u6570\u5668\nSPSR    //\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u5b58\u50a8\u5904\u7406\u5668\u72b6\u6001(\u7c7b\u4f3c\u4e8e ARMv7 \u4e2d\u7684 CPSR)\nELR_EL  //\u5f02\u5e38\u94fe\u63a5\u5bc4\u5b58\u5668   \u4fdd\u5b58\u5bfc\u81f4\u5f02\u5e38\u7684\u6307\u4ee4\u7684\u5730\u5740    \n\nPSTATE   //\u53ef\u72ec\u7acb\u8bbf\u95ee\u7684\u5904\u7406\u5668\u72b6\u6001\u7684\u5bc4\u5b58\u5668\u7ec4 (\u53d6\u4ee3 CPSR\u7684\u72b6\u6001\u5b57\u6bb5,\u5c06\u91cc\u9762\u7684\u4f4d\u72ec\u7acb\u51fa\u6765,\u50cf\u64cd\u4f5c\u5bc4\u5b58\u5668\u4e00\u6837,\u64cd\u4f5c\u90a3\u4e9b\u72b6\u6001\u4f4d,\u4e0d\u7528\u4e0e\u6216\u975e\u7b49\u4f4d\u64cd\u4f5c\u4e86,\u907f\u514d\u8bef\u64cd\u4f5c\u5176\u4ed6\u4f4d)\nNZCV  //\u6761\u4ef6\u6807\u5fd7\n      //bit[31:29]: N Z C V  \n      //\u6e90\u5934\uff1a\u641c\u7d22NZCV \u5728https://developer.arm.com/documentation/ddi0595/2021-09/AArch64-Registers\n      //\u72ec\u7acb\u8bbf\u95ee: mrs X0, NZCV      \nDAIF  //\u4e2d\u65ad\u5c4f\u853d\u4f4d(\u4e3a1\u65f6\u5c4f\u853d)\n      //bit[9:6]: D A I F  D(\u65ad\u70b9\u89c2\u5bdf\u70b9)   A:SError  I(IRQ)  F(FIQ)\nCurrentEL //\u5f53\u524d\u7684\u5f02\u5e38\u7ea7\u522b  \n          //bit[3:2]: 00(EL0)  01(EL1) 10(EL2) 11(EL3)      \n          //\u72ec\u7acb\u8bbf\u95ee: mrs x1, CurrentEL        \nSPSel //\u9009\u62e9\u5806\u6808\u6307\u9488\u7684\u5f02\u5e38\u7ea7\u522b \n      //bit[0]:   0(\u90fd\u7528SP_EL0)   1(\u7528\u5bf9\u5e94\u7684SP_ELx) \n</code></pre> </li> <li> <p>\u7cfb\u7edf\u5bc4\u5b58\u5668</p> <p></p> <pre><code>\u5bc4\u5b58\u5668\u624b\u518c // https://developer.arm.com/documentation/ddi0595/2021-09?lang=en\nSCTLR  //\u7cfb\u7edf\u63a7\u5236\u673a\u5668\uff1a \u5982MMU\u3001\u7f13\u5b58\u548c\u5bf9\u9f50\u68c0\u67e5   \nTTBR0_EL1 //\u8f6c\u6362\u8868\u57fa\u5740\u5bc4\u5b58\u56680  -&gt; \u7269\u7406\u7a7a\u95f4 \u6620\u5c04 \u5e94\u7528\u7a7a\u95f4 \nTTBR1_EL1 //\u8f6c\u6362\u8868\u57fa\u5740\u5bc4\u5b58\u56681  -&gt; \u7269\u7406\u7a7a\u95f4 \u6620\u5c04 \u5185\u6838\u7a7a\u95f4\nMPIDR        //\u591a\u5904\u7406\u5668\u5173\u8054\u5bc4\u5b58\u5668\nICC_SRE_EL3  //\u4e2d\u65ad\u63a7\u5236\u5bc4\u5b58\u5668\nESR_EL      //\u5f02\u5e38\u7efc\u5408\u75c7\u5bc4\u5b58\u5668: \u5305\u62ec\u6709\u5173\u5f02\u5e38\u539f\u56e0\u7684\u4fe1\u606f\nHCR_EL      //\u7ba1\u7406\u7a0b\u5e8f\u914d\u7f6e\u5bc4\u5b58\u5668\uff1a \u63a7\u5236\u865a\u62df\u5316\u8bbe\u7f6e\u548c\u6355\u83b7 EL2 \u7684\u5f02\u5e38       \n</code></pre> </li> <li> <p>\u5411\u524d\u517c\u5bb9(ARMv7\u4ee5\u524d)</p> <p></p> <p></p> </li> <li> <p>\u5f02\u5e38\u7ea7\u522b</p> <p></p> <p>\u5c06\u4ee5\u524d\u76847-9\u4e2a\u5de5\u4f5c\u6a21\u5f0f\u8f6c\u5316\u6210\u4e0b\u9762\u56db\u4e2a\u5f02\u5e38\u7ea7\u522b \u540c\u65f6\u8fd8\u5206\u5b89\u5168\u6a21\u5f0f\u548c\u6b63\u5e38\u6a21\u5f0f: </p> <p>EL0:  \u7528\u6237/\u5e94\u7528\u5c42</p> <p>EL1:  \u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7ea7\u522b</p> <p>EL2:  \u865a\u62df\u5316\u522b\u7684\u5e73\u53f0, Nvdia\u4e0a\u8dd1\u522b\u7684\u82af\u7247</p> <p>EL3:  \u5b89\u5168\u6a21\u5f0f/\u5de5\u5382\u53ef\u4fe1\u4efb\u56fa\u4ef6</p> <p>\u901a\u8fc7\u7cfb\u7edf\u5bc4\u5b58\u5668\u64cd\u4f5c  SPSR    //\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u5b58\u50a8\u5904\u7406\u5668\u72b6\u6001(\u7c7b\u4f3c\u4e8e ARMv7 \u4e2d\u7684 CPSR)</p> </li> </ul>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_4","title":"\u5b9e\u9a8c\u73af\u5883\u642d\u5efa","text":"<p>\u7528qemu+ gdb + vscode ---&gt; \u5b9e\u73b0\u7279\u6743\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee</p>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#armv8_1","title":"ARMv8 \u6c47\u7f16\u6307\u4ee4","text":"<pre><code>b.ne    label    //\u4e0d\u7b49\u65f6\u8df3\u8f6c\ncbz w10, 1f  //w10\u503c\u7b49\u4e8e0\u7684\u9002\u5408\uff0c\u8df3\u8f6c\u5bfc1f \nret              //\u5b50\u7a0b\u5e8f\u8fd4\u56de\u6307\u4ee4\uff0c\u8fd4\u56de\u5730\u5740\u9ed8\u8ba4\u4fdd\u5b58\u5728LR\uff08X30\uff09\uff0c\u4ee3\u66ff\u4e86mov pc,lr\n\nldr     x0,=__main\u3000 //\u5927\u8303\u56f4\u7684\u5730\u5740\u8bfb\u53d6\uff1a\u628a\u6807\u53f7__main\uff08\u5730\u5740\uff09\u8bfb\u5165x0\nadr     x0,vector    //\u5c0f\u8303\u56f4\u7684\u5730\u5740\u8bfb\u53d6\uff1a\u628a\u6807\u53f7vector\uff08\u5730\u5740\uff09\u8bfb\u5165x0,\u6807\u53f7\u8ddd\u5f53\u524d\u6307\u4ee4PC\u7684\u504f\u79fb\u5c0f\u4e8e1M\nstp x29, x30, [sp, #-16]!   \n    //\u5165\u6808\uff1a\u628ax29, x30 \u5b58\u50a8\u5230sp-16\u6307\u5411\u7684\u7a7a\u95f4\u540e,sp\u81ea\u51cf16 (\u56e0\u5bc4\u5b58\u5668\u662f8\u5b57\u8282\uff0c\u6808\u662f\u5411\u4e0b\u751f\u957f\u6545\u662f -16\uff09                              \n    //\u7c7b\u4f3c\u524d\u7d22\u5f15\uff1a *(sp-16) = x29,x30   sp=sp-16 \uff08!\u4f7f\u5f97sp\u80fd\u81ea\u66f4\u65b0\uff09  \u628a x29,x30\u770b\u6210\u6574\u4f53              \n    //stp\u53ea\u652f\u63012\u4e2a\u5bc4\u5b58\u5668\uff0c\u4ee3\u66ff\u4e86\u590d\u6742\u7684stmfd  (64\u4f4d\u6c47\u7f16\uff0c\u53d6\u6d88\u4e86\u6279\u91cf\u64cd\u4f5c\u6307\u4ee4)     \nldp     x29, x30, [sp],#16   //\u51fa\u6808: \u628asp\u6307\u5411\u7684\u7a7a\u95f4\u5185\u5bb9\u8f7d\u5165\u5230x29, x30\u540e\uff0csp\u52a016\n                             //\u7c7b\u4f3c\u540e\u7d22\u5f15: x29,x30=*sp  sp=sp+16   \n\nmrs x0, sctlr_el1   //\u8bfbsctlr_el1\u5185\u5bb9\u5230x0  (\u6ce8\uff1a\u7cfb\u7edf\u5bc4\u5b58\u5668\uff0c\u90fd\u901a\u8fc7mrs msr\u6765\u64cd\u4f5c)\nmsr     sctlr_el1, x0   //\u5199x0\u5185\u5bb9\u5230 sctlr_el1\nsvc     #2      //\u7cfb\u7edf\u8c03\u7528\u6307\u4ee4(\u89e6\u53d1\u4e00\u4e2a\u540c\u6b65\u5f02\u5e38,cpu\u5219\u4f1a\u9677\u5165EL1)\n\n.global  _start     //\u58f0\u660e_start \u4e3a\u5168\u5c40\u7b26\u53f7(\u8ba9\u94fe\u63a5\u811a\u672c\u80fd\u770b\u5230)\n.quad  0x3FA0       //\u5728\u5b58\u50a8\u5668\u4e2d\u5206\u914d8\u4e2a\u5b57\u8282\uff0c\u521d\u503c\u8bbe\u4e3a0x3FA0\n.align  4           //2^4 =16 \u5b57\u8282\u5bf9\u9f50\n.macro  myAdd, x,y  //\u5b8f\u51fd\u6570\uff0c \u7c7b\u4f3c myAdd(x, y) \n    add \\x,\\x,\\y\n.endm    \nmyAdd  x0,x2\n</code></pre> <p>\u6307\u4ee4\u96c6\u624b\u518c ISA_A64_xml_v88A-2021-09.pdf   \u6ce8:\u6307\u4ee4\u64cd\u4f5c\u7801\u4ecd\u7136\u662f 32 \u4f4d\u957f </p> <p>\u7f51\u9875\u7248https://developer.arm.com/documentation/ddi0596/2021-09/Base-Instructions</p>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_5","title":"\u51fd\u6570","text":"<pre><code>b.ne    lable    //\u4e0d\u7b49\u65f6\u8df3\u8f6c\u5230\u6807\u53f7\ncbz w10, 1f  //w10\u503c\u7b49\u4e8e0\u7684\u9002\u5408\uff0c\u8df3\u8f6c\u5bfc1f \nret              //\u5b50\u7a0b\u5e8f\u8fd4\u56de\u6307\u4ee4\uff0c\u8fd4\u56de\u5730\u5740\u9ed8\u8ba4\u4fdd\u5b58\u5728LR\uff08X30\uff09\uff0c\u4ee3\u66ff\u4e86mov pc,lr    \n</code></pre> <ul> <li> <p>\u4f8b\u5b50\uff1a\u5ef6\u65f6\u51fd\u6570</p> <pre><code>.globl  _start\n_start:\n    mov x0,#3\n    bl  delay\n\nreset_end:\n    b reset_end\n\ndelay:  \n    ldr  x4,=0x03\nloop_delay:\n    sub     x4,x4,#1\n    cmp     x4,#0\n    cbz     x4,delay_end        \n    b.ne    loop_delay\ndelay_end:      \n    ret   \n</code></pre> </li> </ul>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#_6","title":"\u5b8f\u51fd\u6570","text":"<pre><code>.macro  myAdd, x,y      //\u5b8f\u51fd\u6570\uff0c \u7c7b\u4f3c myAdd(x, y) \n        add     \\x,\\x,\\y\n.endm    \nmyAdd  x0,x2    \n</code></pre> <ul> <li> <p>\u4f8b: \u5b8f\u51fd\u6570\u8df3\u8f6c\u6807\u53f7:</p> <pre><code>.macro  switch_el, xreg, el1_label\n        mrs     \\xreg, CurrentEL\n        cmp     \\xreg, 0x4\n        b.eq    \\el1_label\n.endm    \n\n.globl  _start\n_start:\n    mov     x0, #0x4\n    switch_el x0, 1f\n    mov     x2,#2\nreset_end:\n    b  reset_end    \n\n1:\n    mov x2,#0x30\n    b   reset_end   \n</code></pre> </li> </ul>"},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#armv8_2","title":"ARMv8 \u5f02\u5e38\u5904\u7406","text":""},{"location":"ARM/3.%20ARMv8%2064%E4%BD%8D%E6%B1%87%E7%BC%96/example.html#uboot","title":"UBOOT\u542f\u52a8\u6e90\u7801\u5206\u6790\uff1a\u52a8\u9759\u7ed3\u5408","text":""},{"location":"ARM/4.%20%E7%A1%AC%E4%BB%B6%E6%8E%A7%E5%88%B6/example.html","title":"Example","text":"<p>This is a markdown file.</p>"},{"location":"ARM/5.%20%E4%B8%B2%E8%A1%8C%E6%8E%A5%E5%8F%A3/example.html","title":"Example","text":""},{"location":"ARM/5.%20%E4%B8%B2%E8%A1%8C%E6%8E%A5%E5%8F%A3/example.html#uart","title":"UART","text":""},{"location":"ARM/5.%20%E4%B8%B2%E8%A1%8C%E6%8E%A5%E5%8F%A3/example.html#i2c","title":"I2C","text":""},{"location":"ARM/5.%20%E4%B8%B2%E8%A1%8C%E6%8E%A5%E5%8F%A3/example.html#spi","title":"SPI","text":""},{"location":"ARM/6.%20u-boot/example.html","title":"Example","text":"<p>This is a markdown file.</p>"},{"location":"ARM/6.%20u-boot/1.%20u-boot%E4%BD%BF%E7%94%A8/example.html","title":"Example","text":"<p>This is a markdown file.</p>"},{"location":"ARM/6.%20u-boot/2.%20u-boot%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/example.html","title":"Example","text":"<p>This is a markdown file.</p>"},{"location":"ARM/6.%20u-boot/3.%20u-boot%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/example.html","title":"Example","text":"<p>This is a markdown file.</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html","title":"\u5904\u7406\u5668\u57fa\u672c\u77e5\u8bc6","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_1","title":"\u7b80\u5355\u6982\u8ff0","text":"<ol> <li> <p>\u57fa\u672c\u7ec4\u6210\u90e8\u5206\uff1aCPU\u7684\u57fa\u672c\u7ec4\u6210\u90e8\u5206\u5305\u62ec\u7b97\u672f\u903b\u8f91\u5355\u5143\uff08ALU\uff09\u3001\u63a7\u5236\u5355\u5143\u3001\u5bc4\u5b58\u5668\u548c\u65f6\u949f\u3002ALU\u6267\u884c\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\uff0c\u63a7\u5236\u5355\u5143\u7ba1\u7406\u6307\u4ee4\u7684\u6267\u884c\uff0c\u5bc4\u5b58\u5668\u7528\u4e8e\u6682\u5b58\u6570\u636e\u548c\u6307\u4ee4\uff0c\u65f6\u949f\u63a7\u5236CPU\u7684\u5de5\u4f5c\u65f6\u5e8f\u3002</p> </li> <li> <p>\u6307\u4ee4\u96c6\u67b6\u6784\uff1aCPU\u6267\u884c\u7684\u6307\u4ee4\u7531\u6307\u4ee4\u96c6\u67b6\u6784\uff08ISA\uff09\u5b9a\u4e49\u3002ISA\u51b3\u5b9a\u4e86CPU\u6240\u80fd\u6267\u884c\u7684\u6307\u4ee4\u96c6\u5408\uff0c\u5305\u62ec\u7b97\u672f\u8fd0\u7b97\u3001\u903b\u8f91\u8fd0\u7b97\u3001\u6570\u636e\u4f20\u8f93\u3001\u63a7\u5236\u6d41\u7b49\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5bc4\u5b58\u5668\uff1aCPU\u5185\u90e8\u5305\u542b\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u5305\u62ec\u901a\u7528\u5bc4\u5b58\u5668\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u3001\u6307\u4ee4\u5bc4\u5b58\u5668\uff08IR\uff09\u7b49\u3002\u5bc4\u5b58\u5668\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6570\u636e\u3001\u6307\u4ee4\u5730\u5740\u548c\u6307\u4ee4\u7b49\u3002</p> </li> <li> <p>\u65f6\u949f\u548c\u65f6\u5e8f\uff1aCPU\u7684\u5de5\u4f5c\u53d7\u65f6\u949f\u4fe1\u53f7\u7684\u63a7\u5236\uff0c\u65f6\u949f\u4fe1\u53f7\u51b3\u5b9a\u4e86CPU\u5185\u90e8\u5404\u4e2a\u90e8\u4ef6\u7684\u5de5\u4f5c\u65f6\u5e8f\uff0c\u5305\u62ec\u6307\u4ee4\u7684\u83b7\u53d6\u3001\u8bd1\u7801\u3001\u6267\u884c\u548c\u5199\u56de\u7b49\u64cd\u4f5c\u3002</p> </li> <li> <p>\u6d41\u6c34\u7ebf\uff1a\u73b0\u4ee3CPU\u901a\u5e38\u91c7\u7528\u6d41\u6c34\u7ebf\u6280\u672f\uff0c\u5c06\u6307\u4ee4\u6267\u884c\u8fc7\u7a0b\u5206\u4e3a\u591a\u4e2a\u9636\u6bb5\uff0c\u4f7f\u5f97\u591a\u6761\u6307\u4ee4\u53ef\u4ee5\u540c\u65f6\u5728\u4e0d\u540c\u9636\u6bb5\u6267\u884c\uff0c\u63d0\u9ad8\u4e86CPU\u7684\u6548\u7387\u3002</p> </li> <li> <p>\u7f13\u5b58\uff1aCPU\u5305\u542b\u591a\u7ea7\u7f13\u5b58\uff0c\u5305\u62ecL1\u3001L2\u3001L3\u7f13\u5b58\u7b49\uff0c\u7528\u4e8e\u6682\u5b58\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u548c\u6307\u4ee4\uff0c\u4ee5\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u901f\u5ea6\u3002</p> </li> <li> <p>\u6307\u4ee4\u6267\u884c\uff1aCPU\u6267\u884c\u6307\u4ee4\u7684\u57fa\u672c\u6b65\u9aa4\u5305\u62ec\u6307\u4ee4\u83b7\u53d6\u3001\u6307\u4ee4\u8bd1\u7801\u3001\u6267\u884c\u3001\u5199\u56de\u7b49\u9636\u6bb5\uff0c\u4e0d\u540c\u7684\u6307\u4ee4\u9700\u8981\u7ecf\u8fc7\u4e0d\u540c\u7684\u5904\u7406\u6d41\u7a0b\u3002</p> </li> </ol>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_2","title":"\u5904\u7406\u5668\u8bbe\u8ba1\u6b65\u9aa4","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_3","title":"\u5206\u6790\u6307\u4ee4\u7cfb\u7edf\u3002","text":"<ul> <li> <p>\u6307\u4ee4\u7cfb\u7edf</p> <p>\u6307\u4ee4\u7cfb\u7edf\u662f\u5728\u5904\u7406\u5668\u8bbe\u8ba1\u4e4b\u524d\uff0c\u5c31\u7531\u8f6f\u4ef6\u548c\u786c\u4ef6\u7684\u8bbe\u8ba1\u4eba\u5458\u5171\u540c\u534f\u5546\u51b3\u5b9a\u7684\u3002\u901a\u8fc7\u5206\u6790\u6307\u4ee4\u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u6307\u4ee4\u6240\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u9700\u8981\u901a\u8fc7\u600e\u6837\u7684\u4e00\u4e2a\u7535\u8def\u7684\u7ed3\u6784\uff0c\u8fd9\u5c31\u662f\u6570\u636e\u901a\u8def</p> </li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_4","title":"\u9009\u62e9\u7ec4\u4ef6 \u5efa\u7acb\u901a\u8def","text":"<p>\u5728\u6211\u4eec\u5f97\u5230\u8fd9\u6837\u7684\u9700\u6c42\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e3a\u6570\u636e\u901a\u8def\u9009\u62e9\u5408\u9002\u7684\u96c6\u6210\u7535\u8def\u7ec4\u4ef6\u3002\u6bd4\u5982\u8bf4\u52a0\u6cd5\u5668\u3001\u51cf\u6cd5\u5668\u3001\u5bc4\u5b58\u5668\u7b49\u7b49\uff1b</p> <p>\u9009\u597d\u4e86\u5408\u9002\u7684\u7ec4\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u6309\u7167\u6700\u5f00\u59cb\u5206\u6790\u51fa\u7684\u9700\u6c42\uff0c\u628a\u8fd9\u4e9b\u7ec4\u4ef6\u8fde\u63a5\u8d77\u6765\uff0c\u5c31\u6784\u6210\u4e86\u5b8c\u6574\u7684\u6570\u636e\u901a\u8def\uff1b</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_5","title":"\u5efa\u7acb\u63a7\u5236\u5668","text":"<p>\u4f46\u662f\u4ec5\u6709\u6570\u636e\u901a\u8def\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u63a7\u5236\u8fd9\u4e2a\u6570\u636e\u901a\u8def\u5e94\u8be5\u5982\u4f55\u5de5\u4f5c\u3002\u56e0\u6b64\uff0c\u7b2c4\u6b65\u662f\u8981\u5206\u6790\u6bcf\u6761\u6307\u4ee4\u7684\u5b9e\u73b0\uff0c\u4ee5\u786e\u5b9a\u63a7\u5236\u6570\u636e\u901a\u8def\u5de5\u4f5c\u7684\u63a7\u5236\u4fe1\u53f7\uff1b\u6700\u540e\uff0c\u662f\u628a\u8fd9\u4e9b\u63a7\u5236\u4fe1\u53f7\u6c47\u603b\u8d77\u6765\uff0c\u5f62\u6210\u5b8c\u6574\u7684\u63a7\u5236\u903b\u8f91\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e4b\u4e3a\u63a7\u5236\u5668\u3002</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_6","title":"\u8d85\u6807\u91cf\u548c\u6d41\u6c34\u7ebf","text":"<p>\u6d41\u6c34\u7ebf \uff1a\u63d0\u9ad8\u5e76\u884c\u6027</p> <p>\u8d85\u6807\u91cf\uff1a\u5e76\u884c\u6307\u4ee4\u6267\u884c</p> <p>\u672c\u8d28\u90fd\u662f\u7a7a\u95f4\u4e0a\u7684\u5229\u7528</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_7","title":"\u65e9\u671f\u5904\u7406\u5668","text":"<ul> <li> <p>CPU Core\uff1a\u4e4b\u524d\u8bbe\u8ba1\u7684\u6570\u636e\u901a\u8def</p> <p>\u8fd9\u91cc\u6570\u636e\u901a\u8def\u5305\u542b\u5e7f\u4e00\u70b9</p> <ol> <li>\u5bc4\u5b58\u5668\uff1a\u7528\u4e8e\u6682\u5b58\u6307\u4ee4\u3001\u6570\u636e\u548c\u5730\u5740\u7b49\u4fe1\u606f\u3002</li> <li>\u7b97\u672f\u903b\u8f91\u5355\u5143\uff08ALU\uff09\uff1a\u7528\u4e8e\u6267\u884c\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\uff0c\u6bd4\u5982\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001\u4e58\u6cd5\u3001\u903b\u8f91\u4e0e\u3001\u903b\u8f91\u6216\u7b49\u3002</li> <li>\u63a7\u5236\u5355\u5143\uff1a\u7528\u4e8e\u63a7\u5236\u6570\u636e\u901a\u8def\u4e2d\u5404\u4e2a\u90e8\u4ef6\u7684\u5de5\u4f5c\uff0c\u6839\u636e\u6307\u4ee4\u7684\u8981\u6c42\u6765\u63a7\u5236\u6570\u636e\u901a\u8def\u7684\u64cd\u4f5c\u3002</li> <li>\u6570\u636e\u9009\u62e9\u5668/\u591a\u8def\u590d\u7528\u5668\uff1a\u7528\u4e8e\u9009\u62e9\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e\u6216\u4fe1\u53f7\u3002</li> <li>\u6570\u636e\u5b58\u50a8\u5668\uff08\u5185\u5b58\uff09\uff1a\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u548c\u6307\u4ee4\u3002</li> <li>\u8f93\u5165/\u8f93\u51fa\u63a5\u53e3\uff1a\u7528\u4e8e\u4e0e\u5916\u90e8\u8bbe\u5907\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002</li> <li>\u65f6\u949f\uff1a\u7528\u4e8e\u540c\u6b65\u5404\u4e2a\u90e8\u4ef6\u7684\u5de5\u4f5c\u3002</li> </ol> </li> <li> <p>32KB I-Cache\uff1a\u4e4b\u524d\u8bbe\u8ba1\u7684\u6307\u4ee4\u5b58\u50a8\u5668</p> </li> <li> <p>32KB D-Cache\uff1a\u4e4b\u524d\u8bbe\u8ba1\u7684\u6570\u636e\u5b58\u50a8\u5668</p> </li> <li> <p>256KB L2 Cache</p> </li> <li> <p>\u5341\u516d\u7ea7\u6d41\u6c34\u7ebf\uff1a</p> </li> <li> <p>\u56db\u53d1\u5c04\uff1a\u8d85\u6807\u91cf </p> </li> </ul> <p>\u8fd9\u4e9b\u90e8\u4ef6\u5173\u7cfb\u7d27\u5bc6\uff0c\u5c06\u4e0a\u8ff0\u90e8\u5206\u79f0\u4e4b\u4e3a\u8d85\u6807\u91cf\u5904\u7406\u5668\u6838\u3002</p> <p>\u65e9\u671f\u7684\u5355\u6838\u65f6\u4ee3\uff1a\u4e00\u4e2a\u5904\u7406\u5668\u6838\u9020\u6210\u4e00\u4e2aCPU</p> <p>\uff08\u56db\u53d1\u5c04-\u5341\u516d\u7ea7\u6d41\u6c34\u7ebf)</p> <ul> <li>\u56db\u53d1\u5c04\uff1a\u4e00\u6b21\u6027\u5b8c\u6210\u4e86\u56db\u6761\u6307\u4ee4\uff0c\u53d6\u503c\u8bd1\u7801...\u6267\u884c\u5199\u56de</li> <li>\u5341\u516d\u7ea7\u6d41\u6c34\u7ebf\uff1a\u4ee55\u7ea7\u6d41\u6c34\u7ebf\u4e3a\u57fa\u7840\uff0c\u5c06\u6307\u4ee4\u6267\u884c\u76845\u4e2a\u9636\u6bb5\u5212\u5206\u4e3a16\u4e2a\u90e8\u5206</li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_8","title":"\u73b0\u4ee3\u5904\u7406\u5668","text":"<p>\u591a\u4e2a\u5904\u7406\u5668\u6838 + \u5171\u4eab\u90e8\u4ef6\uff088MB L3 Cache...\uff09+ ... \u6784\u6210\u4e00\u4e2aCPU</p> <p></p> <ul> <li> <p>\u5f53\u6d89\u53ca\u591a\u6838\u548c\u591aCPU\u7cfb\u7edf\u65f6\uff0c\u4ece\u5904\u7406\u5668\u7684\u7ec4\u7ec7\u65b9\u5f0f\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u7ba1\u7406\u5e76\u5229\u7528\u8fd9\u4e9b\u8d44\u6e90\u6765\u7406\u89e3\u3002</p> </li> <li> <p>\u591aCPU\u7cfb\u7edf</p> <ul> <li> <p>\u591aCPU\u7cfb\u7edf\u6307\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a\u72ec\u7acb\u7684\u4e2d\u592e\u5904\u7406\u5668\uff08CPU\uff09\u3002</p> </li> <li> <p>\u6bcf\u4e2aCPU\u90fd\u53ef\u4ee5\u72ec\u7acb\u5730\u6267\u884c\u6307\u4ee4\uff0c\u8fd9\u610f\u5473\u7740\u7cfb\u7edf\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4efb\u52a1\uff0c\u4ece\u800c\u63d0\u9ad8\u6574\u4f53\u6027\u80fd\u3002</p> </li> <li> <p>\u591aCPU\u7cfb\u7edf\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u5de5\u4f5c\uff1a</p> <ul> <li>\u5bf9\u79f0\u591a\u5904\u7406\u5668\uff08SMP\uff09\uff1a\u6bcf\u4e2aCPU\u90fd\u8fde\u63a5\u5230\u5171\u4eab\u7684\u5185\u5b58\u548cI/O\u603b\u7ebf\u3002\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5c06\u4efb\u52a1\u5206\u914d\u7ed9\u4e0d\u540c\u7684CPU\u6765\u5e76\u884c\u6267\u884c\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u7684\u6574\u4f53\u5904\u7406\u80fd\u529b\u3002</li> <li>\u975e\u5bf9\u79f0\u591a\u5904\u7406\u5668\uff08ASMP\uff09\uff1a\u6bcf\u4e2aCPU\u8fde\u63a5\u5230\u81ea\u5df1\u7684\u5185\u5b58\u548cI/O\u603b\u7ebf\u3002\u8fd9\u79cd\u914d\u7f6e\u901a\u5e38\u7528\u4e8e\u5927\u578b\u7cfb\u7edf\uff0c\u5176\u4e2d\u6bcf\u4e2aCPU\u4e13\u95e8\u7528\u4e8e\u6267\u884c\u7279\u5b9a\u7c7b\u578b\u7684\u4efb\u52a1\u3002</li> </ul> </li> </ul> </li> <li> <p>\u591a\u6838\u7cfb\u7edf</p> <ul> <li> <p>\u591a\u6838\u7cfb\u7edf\u662f\u6307\u5355\u4e2aCPU\u96c6\u6210\u4e86\u591a\u4e2a\u5904\u7406\u6838\u5fc3\u3002</p> </li> <li> <p>\u6bcf\u4e2a\u6838\u5fc3\u53ef\u4ee5\u72ec\u7acb\u5730\u6267\u884c\u6307\u4ee4\uff0c\u56e0\u6b64\u591a\u6838\u7cfb\u7edf\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4efb\u52a1\u3002</p> </li> <li> <p>\u591a\u6838\u7cfb\u7edf\u53ef\u4ee5\u901a\u8fc7\u8d85\u7ebf\u7a0b\u6280\u672f\u6765\u6a21\u62df\u591a\u4e2a\u903b\u8f91\u5904\u7406\u5668\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u7684\u5e76\u884c\u5904\u7406\u80fd\u529b\u3002</p> </li> </ul> </li> <li> <p>\u8fdb\u7a0b</p> <ul> <li> <p>\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u6267\u884c\u65f6\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u72ec\u7acb\u7684\u5185\u5b58\u7a7a\u95f4\u548c\u7cfb\u7edf\u8d44\u6e90\u3002</p> </li> <li> <p>\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u72ec\u7acb\u7684\u5730\u5740\u7a7a\u95f4\u548c\u4e0a\u4e0b\u6587\u3002</p> </li> <li> <p>\u591aCPU\u548c\u591a\u6838\u7cfb\u7edf\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u8fdb\u7a0b\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u7684\u5904\u7406\u80fd\u529b\u3002</p> </li> </ul> </li> <li> <p>\u7ebf\u7a0b</p> <ul> <li> <p>\u7ebf\u7a0b\u662f\u8fdb\u7a0b\u5185\u7684\u4e00\u4e2a\u6267\u884c\u5355\u5143\uff0c\u540c\u4e00\u8fdb\u7a0b\u5185\u7684\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u548c\u7cfb\u7edf\u8d44\u6e90\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u53ef\u4ee5\u770b\u4f5c\u662f\u8f7b\u91cf\u7ea7\u7684\u8fdb\u7a0b\uff0c\u5b83\u4eec\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff0c\u5171\u4eab\u8fdb\u7a0b\u7684\u8d44\u6e90\u3002</p> </li> <li> <p>\u591aCPU\u548c\u591a\u6838\u7cfb\u7edf\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u7684\u5e76\u884c\u5904\u7406\u80fd\u529b\u3002</p> </li> </ul> </li> <li> <p>\u4efb\u52a1</p> <ul> <li> <p>\u4efb\u52a1\u901a\u5e38\u662f\u4e00\u4e2a\u66f4\u9ad8\u5c42\u6b21\u7684\u6982\u5ff5\uff0c\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a\u8fdb\u7a0b\u6216\u8005\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u4efb\u52a1\u53ef\u80fd\u662f\u6307\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7684\u4e00\u9879\u5de5\u4f5c\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u8fdb\u7a0b\u6216\u8005\u7ebf\u7a0b\u7684\u6267\u884c\u5b9e\u4f8b\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4efb\u52a1\u7c7b\u4f3c\u4e8e\u7ebf\u7a0b\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\u548c\u7ba1\u7406\u7684\u57fa\u672c\u5355\u4f4d\u3002</p> </li> </ul> </li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_9","title":"\u67b6\u6784/\u5904\u7406\u5668\u6982\u5ff5","text":"<p>\u4ee5\u6700\u4e3a\u5e38\u4f7f\u7528\u7684ARM\u67b6\u6784\u4e3a\u4f8b</p> <p></p> <ul> <li> <p>ARM\u67b6\u6784: ARM\u6307\u4ee4\u96c6\u67b6\u6784 </p> <p>\u5e38\u8bf4\u7684xxx\u67b6\u6784: ARM\u67b6\u6784\u3001MIPS\u67b6\u6784\u3001x86\u67b6\u6784\u3001POWER\u67b6\u6784\u7b49, \u8bf4\u7684\u5c31\u662f\u57fa\u4e8e\u54ea\u79cd\u7cfb\u5217\u7684\u4e0d\u540c\u6307\u4ee4\u96c6,\u5c31\u88ab\u79f0\u4e3axxx\u67b6\u6784</p> <p>\u5f53\u7136ARM\u548cx86\u6307\u4ee4\u96c6\u91cc\u9762\u90fd\u5305\u542b\u4e86\u5f88\u591a\u6307\u4ee4\u96c6\uff08\u9488\u5bf9\u5404\u79cd\u573a\u666f\u3001\u8ba1\u7b97\u5f00\u53d1\u7684\u6307\u4ee4\u96c6\uff09\u3002</p> </li> <li> <p>ARM\u7ed3\u6784\u5904\u7406\u5668: \u91c7\u7528\u4e86ARM\u67b6\u6784\u7684\u5904\u7406\u5668</p> </li> <li> <p>ARM\u5904\u7406\u5668\u82af\u7247: </p> <p>\u8fd9\u4e2a\u6982\u5ff5\u7531\u4e8e\u65f6\u4ee3\u7684\u53d8\u66f4\u53d8\u5f97\u7a0d\u5fae\u6709\u70b9\u96be\u7406\u89e3, \u6240\u4ee5\u60f3\u641e\u6e05\u695a\u5904\u7406\u5668\u7684\u6982\u5ff5, \u90a3\u5c31\u5f97\u4ece\u4ee5\u524d\u7684\u5904\u7406\u5668/CPU\u8bf4\u8d77(\u53c2\u8003\u524d\u9762\u65e9\u671f\u5904\u7406\u5668\u548c\u73b0\u4ee3\u5904\u7406\u5668)</p> <ul> <li>\u65e9\u671f\u5904\u7406\u5668: \u4e00\u4e2a\u5904\u7406\u5668\u6838(CPU) + \u4e00\u4e9b\u7b80\u5355\u7f13\u5b58 \u2014\u2014&gt;\u5904\u7406\u5668</li> <li>\u53d1\u5c55\u4e2d\u7684\u5904\u7406\u5668: \u4e00\u4e2aCPU\u91cc\u591a\u4e2a\u5904\u7406\u5668\u6838/\u591a\u4e2aCPU + \u7f13\u5b58 +\u5171\u4eab\u90e8\u4ef6 \u2014\u2014&gt;\u5904\u7406\u5668(Soc)</li> <li>Soc \u5982\u4e0b: \u5904\u7406\u5668\u6838 + \u5404\u79cdIO\u8bbe\u5907(\u7cfb\u7edf\u5916\u8bbe) + \u56fe\u5f62\u5904\u7406\u5668(GPU) + \u901a\u4fe1\u6a21\u5757 + \u5185\u5b58\u63a7\u5236\u5668+ (NPU/TPU/...)</li> </ul> </li> </ul> <p></p> <p></p> <p>\u8fd9\u91cc\u6216\u8bb8\u4f1a\u5bf9\u5404\u79cd\u5185\u5b58/\u5b58\u50a8\u76f8\u5173\u6982\u5ff5\u611f\u5230\u8ff7\u60d1, \u7edf\u4e00\u518d\u4e0b\u4e00\u7ae0\u603b\u7ed3\u4e00\u4e0b</p> <ul> <li>\u624b\u673a\u7535\u8111\u4e0a\u5e38\u8bf4\u7684\u5185\u5b58/\u5b58\u50a8: 8GB + 256GB</li> <li>\u5904\u7406\u5668\u91cc\u9762\u53c8\u6709\u4e3b\u5b58\u50a8\u5668(\u53d6\u51b3\u4e8e\u82af\u7247\u7684\u6027\u80fd: \u4ece\u51e0\u5341K\u5230\u51e0\u5341M)</li> <li>\u5904\u7406\u5668\u6838\u91cc\u9762\u53c8\u6709\u5404\u79cd\u51e0\u7ea7\u7f13\u5b58cache(L1 L2...)</li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_10","title":"\u5b58\u50a8","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_11","title":"\u5b58\u50a8\u5c42\u6b21\u7ed3\u6784\u548c\u57fa\u672c\u8ba4\u8bc6","text":"<p>\u5bf9\u4e8e\u524d\u9762\u7684\u95ee\u9898:</p> <ul> <li>\u624b\u673a\u7535\u8111\u4e0a\u5e38\u8bf4\u7684\u5185\u5b58/\u5b58\u50a8: 8GB + 256GB</li> <li>\u5904\u7406\u5668\u91cc\u9762\u53c8\u6709\u4e3b\u5b58\u50a8\u5668(\u53d6\u51b3\u4e8e\u82af\u7247\u7684\u6027\u80fd: \u4ece\u51e0\u5341K\u5230\u51e0\u5341M)</li> <li>\u5904\u7406\u5668\u6838\u91cc\u9762\u53c8\u6709\u5404\u79cd\u51e0\u7ea7\u7f13\u5b58cache(L1 L2...)</li> <li>...</li> </ul> <p>\u501f\u52a9\u4e0a\u56fe, \u4e86\u89e3\u5b58\u50a8\u76f8\u5173\u77e5\u8bc6\u53ef\u4ee5\u89e3\u91ca</p> <p>\u4ece\u4e0b\u5f80\u4e0a: </p> <ol> <li> <p>\u624b\u673a\u7684\u5b58\u50a8/PC\u786c\u76d8: \u4f7f\u7528\u78c1\u76d8/\u786c\u76d8(Disk)/flash\u7b49ROM  (256GB 512GB\u5f80\u4e0a)</p> </li> <li> <p>\u624b\u673a\u7684\u5185\u5b58/PC\u7684\u5185\u5b58: \u7531\u4e3b\u5b58(DRAM)\u6784\u6210 (\u76ee\u524d8GB\u5de6\u53f3)</p> </li> <li> <p>\u9ad8\u901f\u7f13\u5b58: \u8fd9\u91cc\u9762\u6982\u5ff5\u8fc7\u591a, \u5206\u4e86\u5f88\u591a\u5c42, \u4f4d\u7f6e\u4e5f\u6709\u4e9b\u4e0d\u540c, \u4e0a\u4e00\u7ae0\u56fe\u4e2d\u7684\u4e3b\u5b58\u50a8\u5668\u6307\u7684\u5c31\u662f\u7f13\u5b58</p> <p>\u5904\u7406\u5668\u5185\u90e8\u6709\u591a\u7ea7\u7f13\u5b58\uff0c\u5305\u62ec\u4e00\u7ea7\u7f13\u5b58\uff08L1 Cache\uff09\u3001\u4e8c\u7ea7\u7f13\u5b58\uff08L2 Cache\uff09\u548c\u4e09\u7ea7\u7f13\u5b58\uff08L3 Cache\uff09\u3002\u8fd9\u4e9b\u7f13\u5b58\u7528\u4e8e\u4e34\u65f6\u5b58\u50a8\u5904\u7406\u5668\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u548c\u6307\u4ee4\uff0c\u4ee5\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u548c\u6574\u4f53\u6027\u80fd\u3002</p> <p>L1\u7f13\u5b58\u901a\u5e38\u662f\u96c6\u6210\u5728\u5904\u7406\u5668\u6838\u5fc3\u5185\u90e8\uff0c\u901f\u5ea6\u6700\u5feb\u4f46\u5bb9\u91cf\u8f83\u5c0f\u3002L2\u548cL3\u7f13\u5b58\u901a\u5e38\u66f4\u5927\uff0c\u4f46\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\uff0c\u540c\u65f6\u4e5f\u66f4\u63a5\u8fd1\u4e3b\u5b58\u50a8\u5668\u3002\u8fd9\u4e9b\u7f13\u5b58\u5c42\u7ea7\u7684\u8bbe\u8ba1\u662f\u4e3a\u4e86\u66f4\u597d\u5730\u5e73\u8861\u901f\u5ea6\u548c\u5bb9\u91cf\u4e4b\u95f4\u7684\u6743\u8861\uff0c\u4ee5\u63d0\u4f9b\u66f4\u9ad8\u6548\u7684\u6570\u636e\u8bbf\u95ee\u3002</p> </li> <li> <p>\u901a\u7528\u5bc4\u5b58\u5668: \u5c31\u5efa\u5728\u5904\u7406\u5668\u6838\u91cc, \u4e0d\u591a\u89e3\u91ca</p> </li> </ol>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#sramdarm","title":"SRAM\u548cDARM\u7ed3\u6784\u548c\u5dee\u522b","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_12","title":"\u7f13\u5b58","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_13","title":"\u5185\u5b58","text":"<p>\u8bc4\u4ef7\u5185\u5b58\u7684\u4e24\u4e2a\u91cd\u8981\u6307\u6807</p> <ul> <li>\u8bbf\u5b58\u5ef6\u8fdf</li> <li>\u8bbf\u5b58\u5e26\u5bbd</li> <li>tRCD CL tRP</li> </ul> <p>\u5e26\u5bbd \u7406\u89e3\u4e3a\u76f4\u63a5\u4e00\u6b21\u6027\u8bfb\u53d6\u591a\u5c11\u4e2a\u6570\u636e\uff0c\u50cfSDR:\u7ecf\u8fc7\u8bbf\u5b58\u5ef6\u8fdf\u540e\u4e00\u6b21\u53d6\u51fa\u4e00\u4e2aByte\u6570\u636e</p> <p>\u4e4b\u540eDDR2 3 4\u4e0d\u65ad\u6539\u8fdb\uff0c\u8bbf\u5b58\u5ef6\u8fdf\u540e\u4e00\u6b21\u8bfb\u4e24\u4e2a/\u56db\u4e2aByte\u3002</p> <p>\u8fd9\u6837\u5b50\u505a\u63d0\u9ad8\u4e86\u8bbf\u5b58\u5e26\u5bbd\uff0c\u4f46\u662f\u4e5f\u52a0\u5927\u4e86\u8bbf\u5b58\u5ef6\u8fdf(\u4e00\u6b21\u53d6\u591a\u4e2a\u6570\u636e\uff0ctRCD \u548cCL\u65f6\u95f4\u4e5f\u4f1a\u589e\u52a0</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_14","title":"\u5b58\u50a8\u5bb9\u91cf\u7684\u8ba1\u7b97","text":"<p>\u8ba1\u7b97\u673a\u5f53\u4e2d\u5927\u591a\u6570\u7684\u5355\u4f4d\u524d\u7f00\u90fd\u8fd8\u662f\u91c7\u7528\u5341\u8fdb\u5236\u7684\u5f62\u5f0f\uff0c\u5e76\u4e14\u7b26\u5408\u56fd\u9645\u5355\u4f4d\u5236\u7684\u8981\u6c42\u3002</p> <p>\u53ea\u6709\u5728\u8ba1\u7b97\u5185\u90e8\u5b58\u50a8\u5668\u5bb9\u91cf\u65f6\uff0c\u91c7\u7528\u4e86\u4e8c\u8fdb\u5236\u7684\u5f62\u5f0f</p> <p></p> <p>\u5bf9\u73b0\u72b6\uff0cIEEE\u7684\u6807\u51c6\u5c06\u4f1a\u4f7f\u7528\u5927\u5bb6\u516c\u8ba4\u7684\u56fd\u9645\u5355\u4f4d\u5236\u524d\u7f00\u7684\u5b9a\u4e49\u3002\u90a3\u4e48mega\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8bf4\u7684\u5146\uff0c\u4e5f\u5c31\u662f\u6307100\u4e07\uff0c\u4e0d\u518d\u67092\u768420\u6b21\u65b9\u8fd9\u6837\u53e6\u4e00\u4e2a\u5b9a\u4e49\u3002\u5f53\u7136\u8fd9\u91cc\u4e5f\u8bf4\u4e86\uff0c\u5982\u679c\u80fd\u591f\u660e\u786e\u6307\u51fa\u662f\u4ee52\u4e3a\u5e95\u7684\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e2a\u4f8b\u5355\u72ec\u5904\u7406\uff0c\u76f4\u5230\u6709\u4e00\u79cd\u65b0\u7684\u6807\u51c6\u4e13\u95e8\u7528\u4e8e\u4e8c\u8fdb\u5236\u7684\u5355\u4f4d\u524d\u7f00\u3002</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_15","title":"\u5904\u7406\u5668\u57fa\u672c\u77e5\u8bc6","text":""},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_16","title":"\u4e0d\u540c\u5355\u4f4d\u7684\u4f7f\u7528\u793a\u4f8b","text":"<ul> <li> <p>\u4f7f\u7528\u4e8c\u8fdb\u5236: 2<sup>10</sup></p> <ol> <li> <p>RAM\u548cROM\u7684\u5b58\u50a8\u5927\u5c0f\uff0c\u5c5e\u4e8e\u8ba1\u7b97\u673a\u5185\u90e8\u5b58\u50a8</p> <p>20K\u7684SRAM/DARM: 20 * 2<sup>10</sup> Byte</p> </li> <li> <p>\u6587\u4ef6\u5927\u5c0f </p> <p>4MB\u7684File: 4 * (2<sup>10</sup>)<sup>2</sup> Byte</p> </li> </ol> </li> <li> <p>\u4f7f\u7528\u4e8c\u8fdb\u5236: 10<sup>3</sup></p> <ol> <li> <p>\u7f51\u7edc\u4f20\u8f93\u901f\u7387:</p> <p>\u6bd4\u5982: \u4ee5\u592a\u7f51\u3001Wi-Fi...</p> <p>100Mbps: 100 * 10<sup>6</sup> bits</p> </li> <li> <p>\u7f51\u7edc\u5e26\u5bbd</p> <p>\u5c45\u6c11\u7f51\u7edc\u5e26\u5bbd 50Mbps :\u540c\u4e0a</p> </li> <li> <p>\u5916\u90e8\u5b58\u50a8</p> <p>\u7279\u522b\u6ce8\u610f: \u786c\u76d8\u5bb9\u91cf\u5386\u53f2\u4e0a\u4f7f\u7528\u4e8c\u8fdb\u5236\u5355\u4f4d\u8fdb\u884c\u6807\u8bb0\u548c\u5e02\u573a\u9500\u552e\uff0c\u4f46\u968f\u7740\u786c\u76d8\u5b58\u50a8\u6280\u672f\u7684\u4e0d\u65ad\u53d1\u5c55\uff0c\u6210\u672c\u548c\u5bb9\u91cf\u7684\u53d1\u5c55\u6781\u5ea6\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u5bb9\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u5927\u5230GB\u4ee5\u4e0a\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u548c\u73b0\u5b9e\u7684\u56fd\u9645\u7269\u7406\u5355\u4f4d\u6709\u51b2\u7a81\uff0c\u6545\u8fd1\u5e74\u6765\u8f6c\u5411\u4f7f\u7528\u5341\u8fdb\u5236\u5355\u4f4d\u3002\u8bc4\u4f30\u786c\u76d8\u5bb9\u91cf\u65f6\uff0c\u5fc5\u987b\u6ce8\u610f\u6240\u4f7f\u7528\u7684\u6d4b\u91cf\u7cfb\u7edf\u3002</p> <p>hard drive\u5bb9\u91cf 512GB: 512 * 10<sup>9</sup> Byte  Q: \u4e3a\u4ec0\u4e48\u4e70\u56de\u6765\u76841T\u786c\u76d8, \u5728\u8ba1\u7b97\u673a\u4e0a\u5b9e\u9645\u663e\u793a\u7684\u5927\u5c0f\u4e0d\u8db31TB\uff1f</p> <p>A: \u539f\u56e0\u5c31\u5728\u4e8e\u8ba1\u7b97\u673a\u5185\u90e8\u548c\u5916\u90e8\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u8ba1\u6570\u5355\u4f4d\u3002</p> </li> </ol> </li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_17","title":"\u4e2d\u65ad\u548c\u5f02\u5e38","text":"<p>\u5185\u5bb9\u8981\u70b9\uff1a\u4e2d\u65ad\u4e0e\u5f02\u5e38\u7684\u5f02\u540c\uff0c\u4e2d\u65ad\u5904\u7406\u7684\u8fc7\u7a0b</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#_18","title":"\u6982\u5ff5\u95ee\u9898","text":"<p>\u6709\u4e9b\u5b9a\u4e49\u4e0d\u540c</p> <p>\u4e2d\u65ad\u548c\u5f02\u5e38\u5728\u5904\u7406\u5668\u7684\u5de5\u4f5c\u4e2d\u90fd\u662f\u7528\u6765\u5904\u7406\u5916\u90e8\u4e8b\u4ef6\u7684\u673a\u5236</p> <p>\u4e2d\u65ad\uff08Interrupt\uff09\u662f\u5904\u7406\u5668\u63a5\u6536\u5230\u6765\u81ea\u5916\u90e8\u8bbe\u5907\uff08\u5982\u952e\u76d8\u3001\u9f20\u6807\u3001\u7f51\u7edc\u63a5\u53e3\u7b49\uff09\u7684\u4fe1\u53f7\uff0c\u901a\u77e5\u5904\u7406\u5668\u9700\u8981\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u4e2d\u65ad\u53ef\u4ee5\u662f\u5185\u90e8\u4e2d\u65ad\uff08\u5982\u65f6\u949f\u4e2d\u65ad\uff09\u6216\u5916\u90e8\u4e2d\u65ad\uff08\u5982I/O\u8bbe\u5907\u4e2d\u65ad\uff09\u3002\u5904\u7406\u5668\u5728\u63a5\u6536\u5230\u4e2d\u65ad\u4fe1\u53f7\u540e\uff0c\u4f1a\u6682\u505c\u5f53\u524d\u4efb\u52a1\uff0c\u4fdd\u5b58\u5f53\u524d\u72b6\u6001\u5e76\u6267\u884c\u76f8\u5e94\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff0c\u7136\u540e\u518d\u8fd4\u56de\u5230\u539f\u6765\u7684\u4efb\u52a1\u3002</p> <p>\u5f02\u5e38\uff08Exception\uff09\u662f\u5904\u7406\u5668\u5728\u6267\u884c\u6307\u4ee4\u65f6\u9047\u5230\u7684\u4e00\u4e9b\u610f\u5916\u60c5\u51b5\uff0c\u6bd4\u5982\u9664\u96f6\u9519\u8bef\u3001\u975e\u6cd5\u6307\u4ee4\u3001\u5185\u5b58\u8bbf\u95ee\u9519\u8bef\u7b49\u3002\u5f02\u5e38\u4f1a\u5bfc\u81f4\u5f53\u524d\u6307\u4ee4\u7684\u6267\u884c\u88ab\u4e2d\u65ad\uff0c\u5904\u7406\u5668\u4f1a\u8df3\u8f6c\u5230\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002\u53c8\u53eb\u5f02\u5e38\u4e2d\u65ad</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u8868\u683c\uff0c\u603b\u7ed3\u4e86\u4e2d\u65ad\u548c\u5f02\u5e38\u7684\u533a\u522b\u4ee5\u53ca\u4f01\u4e1a\u9879\u76ee\u5f00\u53d1\u4f8b\u5b50\uff1a</p> \u533a\u522b \u4e2d\u65ad \u5f02\u5e38 \u89e6\u53d1\u539f\u56e0 \u5916\u90e8\u4e8b\u4ef6\u89e6\u53d1\uff0c\u6765\u81ea\u5916\u90e8\u8bbe\u5907\u7684\u4fe1\u53f7 \u6307\u4ee4\u6267\u884c\u65f6\u9047\u5230\u7684\u610f\u5916\u60c5\u51b5 \u5904\u7406\u65b9\u5f0f \u6682\u505c\u5f53\u524d\u4efb\u52a1\uff0c\u6267\u884c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f \u8df3\u8f6c\u5230\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406 \u4f8b\u5b50 \u9ad8\u6027\u80fd\u7f51\u7edc\u6570\u636e\u5904\u7406\u7cfb\u7edf\u4e2d\u7684\u7f51\u7edc\u63a5\u53e3\u4e2d\u65ad \u64cd\u4f5c\u7cfb\u7edf/\u865a\u62df\u5316\u5e73\u53f0\u4e2d\u7684\u8bbf\u5b58\u5f02\u5e38:\u7a7a\u6307\u9488\u5f15\u7528 <p>\u5f53\u6d89\u53ca\u5230\u9ad8\u6027\u80fd\u7f51\u7edc\u6570\u636e\u5904\u7406\u7cfb\u7edf\u65f6\uff0c\u7f51\u7edc\u63a5\u53e3\u4e2d\u65ad\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\u3002\u5728\u8fd9\u6837\u7684\u7cfb\u7edf\u4e2d\uff0c\u7f51\u7edc\u63a5\u53e3\u4e2d\u65ad\u901a\u5e38\u662f\u7531\u7f51\u7edc\u8bbe\u5907\uff08\u5982\u7f51\u5361\uff09\u53d1\u51fa\u7684\u4fe1\u53f7\uff0c\u8868\u793a\u6709\u6570\u636e\u5305\u5230\u8fbe\u6216\u5176\u4ed6\u7f51\u7edc\u4e8b\u4ef6\u53d1\u751f\u3002\u5904\u7406\u8fd9\u4e9b\u4e2d\u65ad\u4fe1\u53f7\u5bf9\u4e8e\u9ad8\u6027\u80fd\u7f51\u7edc\u5904\u7406\u7cfb\u7edf\u6765\u8bf4\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u4eec\u9700\u8981\u53ca\u65f6\u5730\u5904\u7406\u4f20\u5165\u7684\u6570\u636e\u5305\u4ee5\u786e\u4fdd\u7f51\u7edc\u7684\u7a33\u5b9a\u6027\u548c\u6027\u80fd\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5728\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u7f51\u7edc\u6570\u636e\u5904\u7406\u7cfb\u7edf\u4e2d\uff0c\u5f53\u7f51\u7edc\u63a5\u53e3\u6536\u5230\u4e00\u4e2a\u6570\u636e\u5305\u65f6\uff0c\u5b83\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\u4fe1\u53f7\uff0c\u901a\u77e5\u5904\u7406\u5668\u9700\u8981\u5904\u7406\u8fd9\u4e2a\u6570\u636e\u5305\u3002\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u6d89\u53ca\u5230\u6570\u636e\u5305\u7684\u89e3\u6790\u3001\u9a8c\u8bc1\u3001\u8def\u7531\u9009\u62e9\u7b49\u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u6570\u636e\u5305\u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u5728\u975e\u5e38\u77ed\u7684\u65f6\u95f4\u5185\u5b8c\u6210\uff0c\u4ee5\u786e\u4fdd\u7f51\u7edc\u6570\u636e\u80fd\u591f\u53ca\u65f6\u5730\u88ab\u5904\u7406\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u6574\u4e2a\u7f51\u7edc\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u9760\u6027\u3002</p> <p>\u5728\u53e6\u4e00\u65b9\u9762\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6216\u865a\u62df\u5316\u5e73\u53f0\u4e2d\u7684\u8bbf\u5b58\u5f02\u5e38\u662f\u53e6\u4e00\u4e2a\u5e38\u89c1\u7684\u60c5\u51b5\u3002\u5728\u8fd9\u6837\u7684\u7cfb\u7edf\u4e2d\uff0c\u8bbf\u5b58\u5f02\u5e38\u901a\u5e38\u662f\u7531\u5e94\u7528\u7a0b\u5e8f\u5c1d\u8bd5\u8bbf\u95ee\u65e0\u6548\u7684\u5185\u5b58\u5730\u5740\u3001\u7a7a\u6307\u9488\u5f15\u7528\u6216\u8d8a\u754c\u8bbf\u95ee\u5185\u5b58\u7b49\u60c5\u51b5\u5f15\u8d77\u7684\u3002\u5904\u7406\u8fd9\u4e9b\u8bbf\u5b58\u5f02\u5e38\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6216\u865a\u62df\u5316\u5e73\u53f0\u6765\u8bf4\u4e5f\u662f\u81f3\u5173\u91cd\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u9700\u8981\u786e\u4fdd\u7cfb\u7edf\u80fd\u591f\u53ca\u65f6\u5730\u68c0\u6d4b\u5230\u8fd9\u4e9b\u5f02\u5e38\u60c5\u51b5\uff0c\u5e76\u91c7\u53d6\u76f8\u5e94\u7684\u63aa\u65bd\u6765\u4fdd\u62a4\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u4f01\u4e1a\u7ea7\u7684\u9ad8\u6027\u80fd\u7f51\u7edc\u6570\u636e\u5904\u7406\u7cfb\u7edf\u548c\u64cd\u4f5c\u7cfb\u7edf/\u865a\u62df\u5316\u5e73\u53f0\u4e2d\uff0c\u4e2d\u65ad\u548c\u8bbf\u5b58\u5f02\u5e38\u90fd\u662f\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\u3002\u5b83\u4eec\u786e\u4fdd\u4e86\u7cfb\u7edf\u80fd\u591f\u53ca\u65f6\u5730\u54cd\u5e94\u5916\u90e8\u4e8b\u4ef6\u548c\u5904\u7406\u610f\u5916\u60c5\u51b5\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u7a33\u5b9a\u6027\u3002</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#x86","title":"x86\u5b9e\u6a21\u5f0f\u4e0b\u7684\u4e2d\u65ad\u5411\u91cf\u8868","text":"<p>CS:IP  \u76f8\u5f53\u4e8ePC\u5bc4\u5b58\u5668</p> <p></p> <p></p> <p>\u4e2d\u65ad\u5411\u91cf\u8868\u91cc\u9762\u5b58\u7740\u4e2d\u65ad\u670d\u52a1\u51fd\u6570\uff08\u89e6\u53d1\u5f02\u5e38\u6216\u8005\u4e2d\u65ad\u9700\u8981\u6267\u884c\u7684\u4fee\u590d\u64cd\u4f5c\uff09\u7684\u5165\u53e3\u5730\u5740</p> <ul> <li> <p>\u5177\u4f53\u6d41\u7a0b</p> <p>\u73b0\u5728\u6bd4\u8f83\u6d41\u884c\u7684\u4e2a\u4eba\u8ba1\u7b97\u673a\u7684\u5185\u90e8\u7ed3\u6784\u3002\u5b83\u5982\u679c\u8fd0\u884c\u5728\u5b9e\u6a21\u5f0f\u4e0b\uff0c\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u5feb\u76848086\u3002\u56e0\u6b64\uff0c\u5f53CPU\u590d\u4f4d\u4e4b\u540e\uff0c\u4e5f\u4f1a\u53bb1\u5146\u5730\u5740\u7a7a\u95f4\u7684\u6700\u9ad8\u768416\u4e2aByte\u7684\u4f4d\u7f6e\u53bb\u53d6\u7b2c\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u4e2a\u5730\u5740\u4f1a\u88ab\u5357\u5317\u6865\u82af\u7247\u7ec4\u5f15\u5bfc\u5230BIOS\u82af\u7247\u3002CPU\u6267\u884cBIOS\u82af\u7247\u5f53\u4e2d\u7684\u6307\u4ee4\uff0c\u5bf9\u4e3b\u677f\u4e0a\u7684\u5404\u4e2a\u8bbe\u5907\u8fdb\u884c\u57fa\u672c\u7684\u914d\u7f6e\u3002\u5176\u4e2d\u4e00\u9879\u5de5\u4f5c\uff0c\u5c31\u662f\u5728\u4e3b\u5b58\u5730\u57400\u7684\u5730\u65b9\u6784\u5efa\u51fa\u4e2d\u65ad\u5411\u91cf\u8868\uff0c\u6240\u8c13\u6784\u5efa\u4e2d\u65ad\u5411\u91cf\u8868\uff0c\u4e5f\u5c31\u5411\u4e3b\u5b58\u4e2d\u6700\u4f4e\u7684\u90a31K\u7684\u5b57\u8282\u586b\u5199\u90a3\u4e9b\u4e2d\u65ad\u5411\u91cf\u3002\u6784\u5efa\u597d\u4e86\u4e2d\u65ad\u5411\u91cf\u8868\uff0c\u53c8\u51c6\u5907\u597d\u4e86\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u4e4b\u540e\uff0cCPU\u518d\u9047\u5230\u4e2d\u65ad\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u4e3b\u5b58\u4e2d\u7684\u4e2d\u65ad\u5411\u91cf\u8868\uff0c\u5e76\u8c03\u7528\u5bf9\u5e94\u7684\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u4e86\u3002</p> </li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#x86_1","title":"( \u62d3\u5c55 ) x86\u4fdd\u62a4\u6a21\u5f0f\u4e0b\u7684\u5bfb\u5740\u65b9\u5f0f","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u73b0\u5728\u7684CPU\u5176\u5b9e\u4e3b\u8981\u4e0d\u662f\u8fd0\u884c\u5728\u5b9e\u6a21\u5f0f\u4e0b\uff0c\u5185\u5b58\u4e5f\u5e76\u4e0d\u662f\u4ec5\u4ec5\u53ea\u6709\u4e00\u5146\u4e86\u3002\u6240\u4ee5\uff0cCPU\u5bf9\u5b58\u50a8\u5668\u7684\u8bbf\u95ee\u65b9\u5f0f\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\u3002</p> <p></p> <p>\u6211\u4eec\u4ee5\u6307\u4ee4\u7684\u5bfb\u5740\u4e3a\u4f8b\uff0c\u5728\u5b9e\u6a21\u5f0f\u4e0b\u662f\u7528\u4ee3\u7801\u6bb5\u5bc4\u5b58\u5668CS\u548c\u6307\u4ee4\u6307\u9488\u8ba1\u5b58\u5668IP\u8fdb\u884c\u7ec4\u5408\u3002\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u90fd\u662f16\u4f4d\u7684\uff0c\u5b83\u4eec\u7684\u7ec4\u5408\u7528\u6bb5\u52a0\u504f\u79fb\u7684\u65b9\u5f0f\u4ea7\u751f\u4e00\u4e2a20\u4f4d\u7684\u5730\u5740\u3002</p> <p>\u4f46\u662f\u4ece386\u5f00\u59cb\uff0c\u6307\u4ee4\u6307\u9488\u8ba1\u5b58\u5668\u5c31\u4ece16\u4f4d\u6269\u5c55\u5230\u4e8632\u4f4d\uff0c\u4e5f\u5c31\u662fEIP\u8ba1\u5b58\u5668\u3002\u90a3\u4e48\u5b83\u7684\u5bfb\u5740\u80fd\u529b\u5c31\u6709\u4e862\u768432\u6b21\u65b9\u4e5f\u5c31\u662f4G\u4e2a\u5b57\u8282\u5355\u5143\u3002\u800c\u4ece386\u5f00\u59cb\uff0c32\u4f4d\u7684CPU\u5bf9\u5916\u4e5f\u5c31\u662f32\u4f4d\u7684\u5730\u5740\u7ebf\uff0c\u80fd\u591f\u5bfb\u5740\u7684\u8303\u56f4\u4e5f\u662f2\u768432\u6b21\u65b9\u3002\u5728\u8fd9\u65f6\u5019\uff0c\u6307\u4ee4\u6307\u9488\u5bc4\u5b58\u5668\uff08EIP\uff09\u7684\u5bbd\u5ea6\u548c\u5b9e\u9645\u9700\u8981\u5bfb\u5740\u7684\u8303\u56f4\u5df2\u7ecf\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u4e86\u3002 </p> <p>\u6240\u4ee5\uff0c\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u867d\u7136\u903b\u8f91\u5730\u5740\u8fd8\u662f\u5199\u6210CS\u5bc4\u5b58\u5668\u548cEIP\u5bc4\u5b58\u5668\u7684\u5f62\u5f0f\uff0c\u4f46\u7269\u7406\u5730\u5740\u7684\u4ea7\u751f\u65b9\u5f0f\u5df2\u7ecf\u548c\u5b9e\u6a21\u5f0f\u5b8c\u5168\u4e0d\u540c\u4e86\u3002(\u91c7\u7528\u63cf\u8ff0\u7b26)</p> <p></p> <p>\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u6bb5\u57fa\u5740\u5e76\u4e0d\u662f\u5b58\u653e\u5728CS\u5bc4\u5b58\u5668\u5f53\u4e2d\uff0c\u800c\u662f\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\u3002</p> <p>\u5728\u5185\u5b58\u5f53\u4e2d\u7684\u67d0\u4e2a\u5730\u65b9\uff0c\u5b58\u653e\u7740\u4e00\u5f20\u8868\uff0c\u79f0\u4e3a\u63cf\u8ff0\u7b26\u8868\u3002\u8fd9\u5f20\u8868\u4e00\u5171\u67098192\uff082<sup>13</sup>\uff09\u4e2a\u8868\u9879\uff0c\u6bcf\u4e2a\u8868\u9879\u75318\uff082323\uff09\u4e2a\u5b57\u8282\u6784\u6210\uff0c\u5c31\u88ab\u79f0\u4e3a\u4e00\u4e2a\u63cf\u8ff0\u7b26\u3002\u8fd9\u4e2a\u63cf\u8ff0\u7b26\u5f53\u4e2d\uff0c\u7b2c2\uff0c3\uff0c4\u4e2a\u5b57\u8282\u548c\u7b2c7\u4e2a\u5b57\u8282\u8fd9\u4e00\u51714\u4e2a\u5b57\u8282\u662f\u57fa\u5730\u5740\uff0c\u8fd9\u4e2a\u5730\u5740\u5c31\u5bf9\u5e94\u4e86\u5b9e\u6a21\u5f0f\u4e0b\u4fdd\u5b58\u5728CS\u5bc4\u5b58\u5668\u5f53\u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u63cf\u8ff0\u7b26\u5f53\u4e2d\uff0c\u9664\u4e86\u57fa\u5730\u5740\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u522b\u7684\u5185\u5bb9\u3002\u5982\u6bb5\u754c\u9650\uff0c\u5b83\u6307\u660e\u4e86\u8fd9\u4e2a\u6bb5\u7a76\u7adf\u6709\u591a\u957f\uff1b\u8fd8\u6709\u6743\u9650\u8fd9\u91cc\u9762\u6709\u82e5\u5e72\u4e2a\u6bd4\u7279\uff0c\u6307\u660e\u4e86\u8fd9\u4e2a\u6bb5\u7684\u5185\u5bb9\u662f\u5426\u53ef\u8bfb\uff0c\u662f\u5426\u53ef\u5199\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e9b\u63cf\u8ff0\u7b26\u662f\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0cCPU\u53c8\u662f\u5982\u4f55\u80fd\u8bbf\u95ee\u5230\u5462\uff1f\u6240\u4ee5\uff0c\u5728 CPU\u5f53\u4e2d\u5b9e\u9645\u4e0a\u662f\u4fee\u6539\u4e86CS\u5bc4\u5b58\u5668\u7684\u4f7f\u7528\u65b9\u5f0f\u3002\u6211\u4eec\u53ef\u4ee5\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\u603b\u5171\u67098192\u4e2a\u63cf\u8ff0\u7b26? \u8fd9\u548cCS\u8ba1\u5b58\u5668\u7684\u5bbd\u5ea6\u662f\u6709\u5173\u7cfb\u7684\uff0cCS\u8ba1\u5b58\u5668\u662f16\u4f4d\u5bbd\u7684\u3002\u6240\u4ee5\uff0c\u5b83\u4e00\u5171\u53ef\u4ee5\u5bfb\u57402\u768416\u6b21\u65b9\u4e2a\u5185\u5b58\u5355\u5143\uff0c\u8fd9\u5c31\u662f64K\u3002\u800c\u56e0\u4e3a\u6bcf\u4e2a\u63cf\u8ff0\u7b26\u662f8\u4e2a\u5b57\u8282\uff0c\u6240\u4ee58192\u4e2a\u63cf\u8ff0\u7b26\u521a\u597d\u662f64K\uff088192 * 8=2<sup>13</sup> * 2<sup>3</sup>=2<sup>16</sup>=64K\uff09\u3002\u752816\u4f4d\u7684CS\u5bc4\u5b58\u5668\u5c31\u6b63\u597d\u53ef\u4ee5\u67e5\u627e\u8fd9\u4e48\u591a\u4e2a\u63cf\u8ff0\u7b26\u3002</p> <p>\u8fd9\u4e2a\u63cf\u8ff0\u7b26\u8868\u7684\u5730\u5740\u5e76\u4e0d\u50cf\u5b9e\u6a21\u5f0f\u4e0b\u7684\u4e2d\u65ad\u5411\u91cf\u8868\u90a3\u6837\u76f4\u63a5\u5b58\u653e\u57280\u5730\u5740, \u6240\u4ee5\u60f3\u8981\u627e\u5230\u5bf9\u5e94\u7684\u63cf\u8ff0\u7b26, CPU\u5c31\u5f97\u77e5\u9053\u8fd9\u4e2a\u63cf\u8ff0\u7b26\u8868\u7684\u8d77\u59cb\u5730\u5740. (\u76f8\u5f53\u4e8e\u8ba1\u7b97\u673a\u7ba1\u5bb6\u5728\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u4f4d\u7f6e, \u6211\u9700\u8981\u5728\u5728CPU\u5185\u90e8\u7528\u4e00\u4e2a\u5bc4\u5b58\u5668\u6765\u5b58\u653e\u8fd9\u4e2a\u7ba1\u5bb6\u7684\u4f4d\u7f6e)</p> <p>\u6240\u4ee5CPU\u4e2d\u65b0\u4e86\u8bbe\u7f6e\u4e00\u4e2a\u7684\u5bc4\u5b58\u5668\uff0c\u53ebGDTR\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fd9\u5f20\u63cf\u8ff0\u7b26\u8868\u7684\u8d77\u59cb\u5730\u5740\u3002</p> <p>\u90a3\u4e48\u53c8\u5f97\u95ee\u4e86\uff1f\u8fd9\u4e2aGDTR\u7684\u5185\u5bb9\u662f\u4ece\u54ea\u91cc\u6765\u7684\u5462\uff1f\u5b9e\u9645\u662f\u56e0\u4e3ax86\u7684CPU\u5728\u542f\u52a8\u7684\u65f6\u5019\u90fd\u4f1a\u5148\u8fdb\u5165\u5b9e\u6a21\u5f0f\u3002\u5728\u5b9e\u6a21\u5f0f\u4e0b\uff0c\u4f1a\u5728\u5185\u5b58\u7684\u67d0\u4e00\u4e2a\u5730\u65b9\uff0c\u5148\u628a\u8fd9\u5f20\u63cf\u8ff0\u7b26\u8868\u90fd\u586b\u597d\uff0c\u7136\u540e\u5c06\u8fd9\u5f20\u8868\u7684\u8d77\u59cb\u5730\u5740\u586b\u5230GDTR\u8ba1\u5b58\u5668\u5f53\u4e2d\u53bb\u3002\u8fd9\uff08GDTR\uff09\u4e5f\u662fCPU\u5185\u90e8\u7684\u4e00\u4e2a\u8ba1\u5b58\u5668\uff0c\u53ea\u4e0d\u8fc7\u5b83\u4e0d\u50cfEX\uff0cEDX\u8fd9\u4e9b\u5bc4\u5b58\u5668\u53ef\u4ee5\u7528\u4f5c\u6570\u636e\u7684\u8fd0\u7b97\uff0c\u5b83\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u5bc4\u5b58\u5668\uff0c\u4f46\u4e5f\u662f\u53ef\u4ee5\u7528\u7279\u5b9a\u7684\u6307\u4ee4\u8fdb\u884c\u8bbf\u95ee\u7684\u3002</p> <ul> <li> <p>\u6700\u540e\u603b\u7ed3\u4e00\u4e0b, \u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0bCPU\u8bbf\u95ee\u5185\u5b58\u7684\u6d41\u7a0b:</p> <p>GDTR: \u63cf\u8ff0\u7b26\u8868   CS: \u6bb5\u9009\u62e9\u5b50(\u7b26\u8868\u7684\u504f\u79fb\u5730\u5740) + \u6bb5\u4fe1\u606f</p> </li> <li> <p>CPU\u6bcf\u6b21\u8981\u8bbf\u95ee\u5b58\u50a8\u533a, \u90fd\u5f97\u7528\u5230CS\u548cGDTR\u5bc4\u5b58\u5668.</p> </li> <li>\u6bb5\u9009\u62e9\u5b50\uff1aCPU\u4f7f\u7528\u6bb5\u9009\u62e9\u5b50\uff08\u5b58\u653e\u5728CS\u5bc4\u5b58\u5668\u4e2d\uff09\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u6bb5\u63cf\u8ff0\u7b26\u7684\u7d22\u5f15\u503c\u3002(\u7528\u4e8e\u627e\u52308192\u4e2a\u6bb5\u4e2d\u7684\u54ea\u4e2a\u6bb5)</li> <li>GDT\u8868\u8bbf\u95ee\uff1aCPU\u4f7f\u7528\u6bb5\u63cf\u8ff0\u7b26\u7684\u7d22\u5f15\u503c\u5728\u5168\u5c40\u63cf\u8ff0\u7b26\u8868\uff08GDT\uff09\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u63cf\u8ff0\u7b26\u3002(\u6700\u7ec8\u786e\u5b9a\u6bb5\u63cf\u8ff0\u7b26\u7684\u4f4d\u7f6e)</li> <li>\u7ebf\u6027\u5730\u5740\u8ba1\u7b97\uff1a\u4ece\u6bb5\u63cf\u8ff0\u7b26\u4e2d\u83b7\u53d6\u57fa\u5730\u5740, \u518d\u4eceEIP\u83b7\u5f97\u504f\u79fb\u5730\u5740\uff0c\u4f7f\u7528\u8fd9\u4e9b\u4fe1\u606f\u8ba1\u7b97\u51fa\u7ebf\u6027\u5730\u5740\u3002</li> <li>\u5185\u5b58\u8bbf\u95ee\uff1aCPU\u4f7f\u7528\u7ebf\u6027\u5730\u5740\u6765\u8bbf\u95ee\u5185\u5b58\uff0c\u83b7\u53d6\u60f3\u8981\u7684\u6307\u4ee4\u7f16\u7801\u6216\u6570\u636e\u3002</li> </ul>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#x86_2","title":"x86\u4fdd\u62a4\u6a21\u5f0f\u4e0b\u7684\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868","text":"<p>\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e00\u6b21\u5b58\u50a8\u5668\u7684\u8bbf\u95ee\u90fd\u5fc5\u987b\u8981\u7ecf\u5386\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u90a3\u8bbf\u95ee\u4e2d\u65ad\u5411\u91cf\u8868\u4e5f\u5c31\u4e0d\u4f8b\u5916\u3002\u800c\u4e14\u4e0d\u4f46\u5982\u6b64\uff0c\u4e2d\u65ad\u5411\u91cf\u8868\u7684\u4f4d\u7f6e\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\u3002</p> <p></p> <p>\u7ed3\u5408\u4e0a\u56fe, \u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b, CPU\u5904\u7406\u4e2d\u65ad\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868\u521d\u59cb\u5316\uff1a\u7cfb\u7edf\u521d\u59cb\u5316\uff08BIOS\uff09\u8f6f\u4ef6\u4f1a\u5728\u5efa\u7acb\u597d\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868\u540e\uff0c\u5c06\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868\u7684\u8d77\u59cb\u5730\u5740\u548c\u957f\u5ea6\u586b\u5165IDTR\u5bc4\u5b58\u5668\u3002</p> </li> <li> <p>\u4e2d\u65ad\u7c7b\u578b\u53f7\u67e5\u627e\uff1a\u5f53CPU\u53d1\u751f\u4e2d\u65ad\u65f6\uff0c\u6839\u636e\u4e2d\u65ad\u7c7b\u578b\u53f7\u4e58\u4ee58\u518d\u52a0\u4e0aIDTR\u5bc4\u5b58\u5668\u4e2d\u7684\u5185\u5bb9\uff0c\u5f97\u5230\u5bf9\u5e94\u4e2d\u65ad\u63cf\u8ff0\u7b26\u7684\u5730\u5740\u3002</p> </li> <li> <p>\u4e2d\u65ad\u63cf\u8ff0\u7b26\u5904\u7406\uff1aCPU\u4ece\u4e2d\u65ad\u63cf\u8ff0\u7b26\u4e2d\u83b7\u53d6\u6bb5\u9009\u62e9\u7b26\u548c\u504f\u79fb\u5730\u5740\uff08EIP\uff09\u3002</p> </li> <li> <p>\u6bb5\u57fa\u503c\u8ba1\u7b97\uff1aCPU\u4f7f\u7528\u6bb5\u9009\u62e9\u7b26\u548cGDT\uff08\u5168\u5c40\u63cf\u8ff0\u7b26\u8868\uff09\u4e2d\u5bf9\u5e94\u7684\u6bb5\u63cf\u8ff0\u7b26\uff0c\u627e\u51fa\u5bf9\u5e94\u7684\u6bb5\u57fa\u503c\u3002</p> </li> <li> <p>\u5185\u5b58\u5730\u5740\u8ba1\u7b97\uff1aCPU\u5c06\u6bb5\u57fa\u503c\u4e0e\u504f\u79fb\u5730\u5740\uff08EIP\uff09\u76f8\u52a0\uff0c\u5f97\u5230\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u7684\u5165\u53e3\u5730\u5740\u3002</p> </li> <li> <p>\u4e2d\u65ad\u5904\u7406\uff1aCPU\u4ece\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u7684\u5165\u53e3\u5730\u5740\u53d6\u56de\u6307\u4ee4\uff0c\u5f00\u59cb\u4e2d\u65ad\u7684\u5904\u7406\u3002</p> </li> </ol> <p>\u603b\u7ed3\uff1a\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u5904\u7406\u4e2d\u65ad\u7684\u6d41\u7a0b\u5305\u62ec\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868\u7684\u521d\u59cb\u5316\u3001\u4e2d\u65ad\u7c7b\u578b\u53f7\u7684\u67e5\u627e\u3001\u4e2d\u65ad\u63cf\u8ff0\u7b26\u7684\u5904\u7406\u3001\u6bb5\u57fa\u503c\u7684\u8ba1\u7b97\u3001\u5185\u5b58\u5730\u5740\u7684\u8ba1\u7b97\u4ee5\u53ca\u6700\u7ec8\u7684\u4e2d\u65ad\u5904\u7406\u3002\u6574\u4f53\u4e0a\uff0c\u8fd9\u4e9b\u6b65\u9aa4\u6e05\u6670\u5730\u63cf\u7ed8\u4e86CPU\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\u5904\u7406\u4e2d\u65ad\u7684\u6d41\u7a0b\u3002</p>"},{"location":"Basis%20of%20Proceoosrs/%E5%A4%84%E7%90%86%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86.html#io","title":"IO","text":""},{"location":"Complex%20issues/Complex%20issues.html","title":"Complex issues","text":""},{"location":"Complex%20issues/Complex%20issues.html#_1","title":"\u8ba1\u7b97\u673a\u7cfb\u7edf\u6d41\u7a0b","text":"<p>\u5728\u65ad\u65ad\u7eed\u7eed\u770b\u5b8c\u4e86\u300a\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u6837\u8dd1\u8d77\u6765\u7684\u300b\u3001\u300a\u7a0b\u5e8f\u662f\u600e\u6837\u8dd1\u8d77\u6765\u7684\u300b,\u4e86\u89e3\u4e86\u4e00\u4e9b\u522b\u7684\u77e5\u8bc6\u540e, </p> <p>\u77e5\u9053\u73b0\u5728\u8ba1\u7b97\u673a\u548c\u4ee5\u524d\u7684\u8ba1\u7b97\u673a\u5dee\u522b\u8fd8\u662f\u5f88\u5927\u7684.</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u81ea\u5df1\u7406\u89e3\u53e4\u8001\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf, \u5199\u4e00\u4e2a\u5927\u6982\u6d41\u7a0b\u5de9\u56fa\u7528, \u5e94\u8be5\u6709\u5f88\u591a\u7ec6\u8282\u4e0d\u592a\u5bf9, \u4f46\u53ea\u662f\u5efa\u7acb\u4e00\u4e2a\u5927\u6982\u7684\u6846\u67b6. </p> <p>\u8ba1\u7b97\u673a\u7ec4\u6210 -&gt; \u8ba1\u7b97\u673a\u4e0a\u7535\u542f\u52a8 -&gt; \u7a0b\u5e8f\u8ba9\u8ba1\u7b97\u673a\u8dd1\u8d77\u6765</p>"},{"location":"Complex%20issues/Complex%20issues.html#_2","title":"\u8ba1\u7b97\u673a\u7ec4\u6210","text":""},{"location":"Complex%20issues/Complex%20issues.html#1","title":"1. \u6570\u636e\u8f93\u5165","text":"<p>\u8ba1\u7b97\u673a\u63a5\u6536\u5916\u90e8\u8bbe\u5907\uff08\u952e\u76d8\u3001\u9f20\u6807\u3001\u4f20\u611f\u5668\u7b49\uff09\u6216\u5b58\u50a8\u8bbe\u5907\uff08\u5982\u786c\u76d8\u3001\u5185\u5b58\u7b49\uff09\u4f20\u8f93\u7684\u6570\u636e\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#2","title":"2. \u6570\u636e\u4f20\u8f93","text":"<p>\u6570\u636e\u901a\u8fc7\u603b\u7ebf\u7cfb\u7edf\uff08\u6570\u636e\u603b\u7ebf\u3001\u5730\u5740\u603b\u7ebf\u3001\u63a7\u5236\u603b\u7ebf\uff09\u4f20\u8f93\u5230CPU\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#3-cpu","title":"3. CPU","text":"<p>\u8ba1\u7b97\u673a\u6838\u5fc3\u90e8\u4ef6\uff0c\u8d1f\u8d23\u6267\u884c\u6307\u4ee4\u548c\u5904\u7406\u6570\u636e\u3002</p> <ul> <li> <p>\u6307\u4ee4\u89e3\u7801\uff1aCPU\u89e3\u6790\u6307\u4ee4\uff0c\u786e\u5b9a\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c\u548c\u64cd\u4f5c\u6570\u3002</p> </li> <li> <p>\u5bc4\u5b58\u5668\uff1a\u5bc4\u5b58\u5668\u662fCPU\u5185\u90e8\u7684\u9ad8\u901f\u5b58\u50a8\u5668\uff0c\u7528\u4e8e\u5b58\u50a8\u6307\u4ee4\u548c\u6570\u636e\u3002</p> </li> <li>\u7b97\u672f\u903b\u8f91\u5355\u5143\uff08ALU\uff09\uff1aALU\u6267\u884c\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\uff0c\u5982\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001\u4e58\u6cd5\u3001\u903b\u8f91\u4e0e\u3001\u903b\u8f91\u6216\u7b49\u3002\u63a7\u5236\u5355\u5143\uff1a\u63a7\u5236\u5355\u5143\u534f\u8c03\u548c\u63a7\u5236\u8ba1\u7b97\u673a\u5404\u4e2a\u90e8\u4ef6\u7684\u5de5\u4f5c\uff0c\u5305\u62ec\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\u548c\u65f6\u5e8f\u63a7\u5236\u3002</li> <li>\u5b58\u50a8\u5668\uff1a\u5b58\u50a8\u5668\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u548c\u6307\u4ee4\u3002\u4e3b\u5b58\u50a8\u5668\u5305\u62ec\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668\uff08RAM\uff09\u548c\u53ea\u8bfb\u5b58\u50a8\u5668\uff08ROM\uff09\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#4","title":"4. \u6570\u636e\u5904\u7406","text":"<p>CPU\u6839\u636e\u6307\u4ee4\u548c\u6570\u636e\u5728\u5bc4\u5b58\u5668\u548c\u5185\u5b58\u3001\u5b58\u50a8\u5668\u4e4b\u95f4\u8fdb\u884c\u8bfb\u53d6\u3001\u5199\u5165\u548c\u8fd0\u7b97\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#5","title":"5. \u6570\u636e\u8f93\u51fa","text":"<p>\u5904\u7406\u540e\u7684\u6570\u636e\u901a\u8fc7\u603b\u7ebf\u4f20\u8f93\u5230\u8f93\u51fa\u8bbe\u5907\uff08\u5982\u663e\u793a\u5668\u3001\u6253\u5370\u673a\u7b49\uff09\u6216\u5b58\u50a8\u8bbe\u5907\u8fdb\u884c\u4fdd\u5b58\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_3","title":"\u6307\u9488\u6570\u7ec4\u548c\u6570\u7ec4\u6307\u9488","text":""},{"location":"Complex%20issues/Complex%20issues.html#cpu","title":"CPU\u4e2d\u6709\u5185\u5b58\u5417?","text":""},{"location":"Complex%20issues/Complex%20issues.html#_4","title":"\u65e5\u5e38\u6982\u5ff5","text":"<p>\u5728\u7535\u8111\u548c\u624b\u673a\u7684\u5b58\u50a8\u5bb9\u91cf\u4e2d\uff0c\u901a\u5e38\u4f1a\u63d0\u5230\u4e24\u4e2a\u6570\u5b57\uff0c\u5206\u522b\u8868\u793a\u5185\u5b58\uff08RAM\uff09\u548c\u5b58\u50a8\uff08ROM\u6216\u786c\u76d8\uff09\u7684\u5bb9\u91cf\u3002</p> <ul> <li>\u5185\u5b58\uff08RAM\uff09\uff1a\u5185\u5b58\u662f\u8ba1\u7b97\u673a\u7528\u4e8e\u4e34\u65f6\u5b58\u50a8\u6570\u636e\u548c\u7a0b\u5e8f\u7684\u5730\u65b9\uff0c\u5b83\u5bf9\u4e8e\u8ba1\u7b97\u673a\u7684\u8fd0\u884c\u901f\u5ea6\u548c\u591a\u4efb\u52a1\u5904\u7406\u8d77\u7740\u91cd\u8981\u4f5c\u7528\u3002\u5185\u5b58\u5bb9\u91cf\u901a\u5e38\u4ee5GB\uff08Gigabytes\uff09\u4e3a\u5355\u4f4d\u6765\u8868\u793a\uff0c\u6bd4\u598216GB\u8868\u793a16\u5343\u5146\u5b57\u8282\u7684\u5185\u5b58\u5bb9\u91cf\u3002</li> <li>\u5b58\u50a8\uff08ROM\u6216\u786c\u76d8\uff09\uff1a\u5b58\u50a8\u662f\u7528\u4e8e\u957f\u671f\u5b58\u50a8\u6570\u636e\u548c\u6587\u4ef6\u7684\u5730\u65b9\uff0c\u5305\u62ecROM\uff08\u53ea\u8bfb\u5b58\u50a8\u5668\uff09\u548c\u786c\u76d8\uff08\u673a\u68b0\u786c\u76d8\u6216\u56fa\u6001\u786c\u76d8\uff09\u3002\u5b58\u50a8\u5bb9\u91cf\u901a\u5e38\u4ee5GB\u6216TB\uff08Terabytes\uff09\u4e3a\u5355\u4f4d\u6765\u8868\u793a\uff0c\u6bd4\u5982512GB\u8868\u793a512\u5343\u5146\u5b57\u8282\u7684\u5b58\u50a8\u5bb9\u91cf\u3002</li> </ul> <p>\u5728\u624b\u673a\u4e2d\uff0c\u7c7b\u4f3c\u5730\uff0c8+256\u8868\u793a\u624b\u673a\u7684\u5185\u5b58\u548c\u5b58\u50a8\u5bb9\u91cf\u3002\u5176\u4e2d8\u8868\u793a\u624b\u673a\u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u901a\u5e38\u4ee5GB\u4e3a\u5355\u4f4d\uff0c\u800c256\u8868\u793a\u624b\u673a\u7684\u5b58\u50a8\u5bb9\u91cf\uff0c\u4e5f\u901a\u5e38\u4ee5GB\u4e3a\u5355\u4f4d\u3002\u8fd9\u610f\u5473\u7740\u624b\u673a\u67098GB\u7684\u5185\u5b58\u548c256GB\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5185\u5b58\u548c\u5b58\u50a8\u662f\u4e0d\u540c\u7684\u6982\u5ff5\u3002</p> <p>\u5185\u5b58\u7528\u4e8e\u4e34\u65f6\u5b58\u50a8\u8fd0\u884c\u4e2d\u7684\u6570\u636e\u548c\u7a0b\u5e8f\uff1b\u5b58\u50a8\u7528\u4e8e\u957f\u671f\u5b58\u50a8\u6587\u4ef6\u548c\u6570\u636e\u3002</p> <p>\u5185\u5b58\u5bb9\u91cf\u8f83\u5c0f\uff0c\u4f46\u901f\u5ea6\u8f83\u5feb\uff1b</p> <p>\u5b58\u50a8\u5bb9\u91cf\u8f83\u5927\uff0c\u4f46\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_5","title":"\u4e3a\u4ec0\u4e48\u8981\u6709\u5806\u548c\u6808","text":"<ol> <li>\u4e3a\u4ec0\u4e48\u8981\u8fdb\u884c\u5185\u5b58\u7684\u7ba1\u7406\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u8981\u6709\u6808\uff1f\u6808\u662f\u5fc5\u987b\u7684\u5417\uff1f\u6ca1\u6709\u4ed6\u53ef\u4ee5\u5417\uff1f\uff08\u975e\u5e38\u672c\u8d28\u7684\u4e1c\u897f\uff09</li> <li>\u51fd\u6570\u4e3a\u4ec0\u4e48\u662f\u7406\u6240\u5e94\u5f53\u7684\uff1f\u6a21\u5757 \uff1f\u6c47\u7f16\u5c42\u9762\u7684\u90fd\u6ca1\u6709\u51fd\u6570\uff0c\u53ea\u662f\u8df3\u8f6c\uff1f</li> <li>\u51fd\u6570\u8c03\u7528\u7684\u65f6\u5019\uff0c\u540e\u8fdb\u5148\u51fa---&gt;\u90a3\u5c31\u662f\u6808\u8fd9\u4e2a\u4e1c\u897f\uff0c\u60f3\u7528\u51fd\u6570\u6a21\u5757\u5316\u7684\u5b9e\u73b0\u529f\u80fd\uff0c\u90a3\u5c31\u5f97\u7528\u6808\u6765\u7ba1\u7406\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u4e1c\u897f\uff1f</li> <li>\u5982\u679c\u8bf4\u6211\u4eec\u7684\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u5f88\u91cd\u8981\u7684\uff0c\u90a3\u6808\u8fd9\u4e2a\u4e1c\u897f\u5c31\u662f\u5fc5\u987b\u7684\u4e86\uff0c\u90a3\u603b\u4e0d\u80fd\u6211\u4eec\u6bcf\u6b21\u90fd\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u6808\uff1f\u81ea\u5df1\u7ba1\u7406\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u5404\u79cd\u53d8\u91cf\u7b49\u7b49\uff0c\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u5e2e\u6211\u4eec\u5b9e\u73b0\u597d\u4e86\u6808\u8fd9\u79cd\u64cd\u4f5c\u65b9\u5f0f\uff1f\uff1f\u8fd8\u662f\u7f16\u8bd1\u5668\u5e72\u7684\uff1f</li> <li> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u51fd\u6570\u9012\u5f52\u8fd9\u79cd\u601d\u60f3\uff0c\u51fd\u6570\u81ea\u5df1\u8c03\u7528\u81ea\u5df1\uff0c\u600e\u4e48\u641e\uff1f\u6bd4\u5982\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u6bcf\u6b21\u8c03\u7528\u90fd\u8981\u7b97\u51fa\u4e00\u4e2a\u503c\uff0c\u90a3\u4e0d\u5c31\u5f97</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u6709\u5806\uff1f</p> </li> <li>\u6808\u591a\u8212\u670d\uff0c\u6808\u81ea\u52a8\u5e2e\u6211\u4eec\u7ba1\u7406\u4e86\u5185\u5b58\uff0c\u81ea\u52a8\u521b\u5efa\uff0c\u9000\u51fa\u7684\u65f6\u5019\u81ea\u5df1\u9500\u6bc1</li> <li>\u6709\u4e2a\u95ee\u9898\uff0c\u90a3\u4e00\u63a8\u51fa\u4fe1\u606f\u5c31\u6ca1\u4e86\uff0c\u90a3\u8981\u662f\u6211\u60f3\u5728\u4e0d\u540c\u7684\u51fd\u6570\u4e4b\u95f4\u4f7f\u7528\u4e00\u4e0b\u51fd\u6570\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u4e00\u4e9b\u4e1c\u897f\uff0c\u600e\u4e48\u529e\uff1f</li> <li>\u5806\u5c31\u4e00\u76f4\u4e0d\u4f1a\u6d88\u5931\uff0c\u5806\u5c31\u662f\u7528\u6765\u7ba1\u7406\u8fd9\u79cd\u5927\u7684\u6570\u636e\uff0c\u8de8\u6808\u7684</li> <li>\u5c06\u5806\u60f3\u8c61\u6210\u4e91\u76d8\uff0c\u6bd4\u5982\u6d4f\u89c8\u5668\u5173\u4e86\uff0c\u4f46\u662f\u6211\u4e4b\u95f4\u7684\u4e00\u4e9b\u6570\u636e\u8fd8\u662f\u5728\u7684\u3002</li> <li>\u4f46\u662f\u5806\u7684\u95ee\u9898\uff0c\u53ea\u8981\u6211\u4e0d\u544a\u8bc9\u5806\uff0c\u5806\u5185\u5b58\u5c31\u4e00\u76f4\u5728\u90a3\u91cc\uff0c\u4ed6\u81ea\u5df1\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u5220\u9664\uff0c\u5c31\u9700\u8981\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u7ba1\u7406\uff0c\u6240\u4ee5\uff0c\u5bb9\u6613\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\uff08free\u5fd8\u4e86\uff0cfree\u4e86\u4e24\u6b21\uff09</li> </ol> <p></p> <p>\u90a3\u4e00\u6bb5memory mapping segment \u4e2d\u653e\u7684\u5c31\u662f.so \u5e93\uff0cilbc.so</p> <p>\u4e00\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u9996\u5148\u5185\u5b58\u7a7a\u7684\uff0c\u4e4b\u540e\u64cd\u4f5c\u7cfb\u7edf\u5c06elf\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019PC\u6307\u9488\u662f\u5728 kernel \u624b\u4e0a\u7684\uff0c\u4e4b\u540e\uff0ckernel \u5c06PC\u6307\u5230\u6216\u8005\u4ea4\u7ed9 text \u6bb5\u90a3\u91cc\u7684 main \u51fd\u6570\u90a3\u91cc\uff0c\u7531\u65f6\u949f\u63a7\u5236\u8282\u62cd\uff0cPC\u4e0b\u4e00\u6b65\u505a\u4ec0\u4e48\u4e4b\u540e\u505a\u4ec0\u4e48\uff08\u5982\u679c\u590d\u6742\u4e00\u70b9\uff1a1.\u8fd8\u6709\u4e00\u4e9b\u5404\u79cd\u7a0b\u5e8f\u4e4b\u95f4\u7684\u8c03\u5ea6\uff08\u8fd9\u4e00\u6b65\u5c31\u53c8\u9700\u8981\u865a\u62df\u5185\u5b58\u4e86\u5e2e\u5fd9\u8c03\u63a7\uff0c\u4e0d\u7136\u51e0\u4e2a\u7a0b\u5e8f\u76f4\u63a5\u64cd\u4f5c\u7269\u7406\u5185\u5b58\uff0c\u6709\u51b2\u7a81\uff09\uff0c\u4e00\u4e2a\u65f6\u95f4\u7247\u505a\u8fd9\u4e2a\uff0c\u6765\u4e2a\u4e2d\u65ad\u53c8\u505a\u522b\u7684\u53bb\u4e86\u30022. \u53c8\u6216\u8005\uff0c\u4f60\u9700\u8981\u4e00\u4e9b\u6587\u4ef6\u64cd\u4f5c\uff0c\u9700\u8981\u7528\u5230sys call \u7684\uff0c\u90a3PC\u6307\u9488\u53ef\u80fd\u5c31\u8981\u56dekernel\uff0c \u8ba9kernel\u5e2e\u6211\u5e72\u8fd9\u4e2a\u6d3b\uff09\uff0c\u5b8c\u6210\u4e4b\u540e\uff0c\u5c06\u63a7\u5236\u6743\u4ea4\u56de\u7ed9/\u8df3\u8f6c\u5230 kernel \u7a7a\u95f4\uff0c\u5185\u6838\u5c06\u4f60\u4ea7\u751f\u7684\u5185\u5b58\u4e2d\u7684\u5783\u573e\u641e\u5b9a\u3002</p> <p></p> <p>\u8ba9\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u6709\u4e00\u79cd\u6240\u6709\u7684\u8d44\u6e90\u4e3a\u6211\u6240\u7528\u7684\u611f\u89c9\uff0c\u90a3\u5b83\u4eec\u5c31\u4f1a\u5c3d\u81ea\u5df1\u6700\u5927\u7684\u529b\u5de5\u4f5c\u3002</p> <p>\u5b9e\u9645\u5355\u6838CPU\uff0c\u600e\u4e48\u5207\u6362\u7684\uff1fPC\u6307\u9488\u3002</p> <p>\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u7684\u65f6\u95f4\u5230\u4e86\uff0cPC\u6307\u9488\u8981\u8f6c\u53bb\u7b2c\u4e8c\u4e2a\u8fdb\u7a0b\u7684\u5730\u5740\u4e86\uff0c\u90a3\u4e0a\u4e00\u4e2a\u7684\u8fdb\u7a0b\u7684\u4e1c\u897f\u600e\u4e48\u529e ----&gt; </p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4fdd\u5b58\u6570\u636e/\u5bc4\u5b58\u5668\uff0c\u5185\u5b58(\u6620\u5c04\u8868)\uff08\u4e3a\u4ec0\u4e48\u8981\u4fdd\u5b58\u5185\u5b58\u76f8\u5173\u7684\uff1f\u4e0d\u7136\u5230\u7b2c\u4e8c\u4e2a\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7684\u865a\u62df\u5185\u5b58\u8fd8\u662f\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u7684\uff0c\u6240\u4ee5\u8fd8\u8981\u4fdd\u5b58\u5185\u5b58\u6620\u5c04\u8868\uff09\u3002\u4e0d\u65ad\u6765\u56de\u5207\u6362 ---&gt; \u8fdb\u7a0b\u8c03\u5ea6\u7684\u77e5\u8bc6</p>"},{"location":"Complex%20issues/Complex%20issues.html#stack","title":"\u6808\u7684\u7406\u89e3\uff08Stack\uff09","text":"<p>\u5728\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6808\u548c\u5185\u5b58\u4e2d\u7684\u6808\u8bb2\u7684\u4e0d\u662f\u4e00\u4e2a\u4e1c\u897f\uff0c\u4e0d\u8fc7\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6808\u540c\u6837\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u676f\u5b50\uff0c\u7279\u70b9\u5c31\u662f\u5148\u8fdb\u540e\u51fa\uff0c\u56e0\u4e3a\u5148\u8fdb\u53bb\u7684\u6570\u636e\u88ab\u538b\u5230\u676f\u5e95\u4e0d\u597d\u53d6\u51fa\u6765\u561b\u3002\u800c\u6570\u636e\u7ed3\u6784\u7684\u5806\u5219\u548c\u5185\u5b58\u4e2d\u7684\u5806\u5c31\u5b8c\u5168\u4e0d\u540c\u4e86\uff0c\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5806\u662f\u4e2a\u6811\u5f62\u7ed3\u6784\u3002\u8fd9\u5757\u4e0d\u80fd\u6df7\u6dc6\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_6","title":"\u524d\u8a00","text":"<p>\u5728\u770b\u300a\u6c47\u7f16\u8bed\u8a00\u300b\u3001\u300a\u7a0b\u5e8f\u662f\u600e\u6837\u8dd1\u8d77\u6765\u7684\u300b\u3001\u300a\u5927\u8bdd\u6570\u636e\u7ed3\u6784\u300b\u7684\u65f6\u5019\uff0c</p> <p>\u89c9\u5f97\u6808\u5c31\u662f\u4ece\u4e0b\u5230\u4e0a\u653e\u5165\u5143\u7d20\u7684\u4e00\u79cd\u7ed3\u6784\u3002</p> <p>\u4f46\u662f\u5728\u770b\u4e86\u4e0b\u9762\u7684\u56fe\u540e\uff0c\u53d1\u73b0\u987a\u5e8f\u53c8\u6709\u70b9\u4e0d\u5bf9\uff0c\u5bf9\u6808\u7684\u987a\u5e8f\u8ff7\u8ff7\u7cca\u7cca\uff0c</p> <p>\u7528C\u8bed\u8a00\u6570\u7ec4\u5b9e\u73b0\u6808\uff0c\u6709\u65f6\u5019\u51fa\u73b0++\uff0c\u6709\u65f6\u5019\u53c8\u51fa\u73b0--\uff0c\u7ed9\u6211\u641e\u6655\u4e86</p> <p></p>"},{"location":"Complex%20issues/Complex%20issues.html#_7","title":"\u6838\u5fc3\u89c2\u5ff5","text":"<p>\u201c\u6808\u201d\u9876\u5230\u5e95\u662f\u4e0a\u9762\u8fd8\u662f\u4e0b\u9762\uff1f\u9ad8\u5730\u5740\u8fd8\u662f\u4f4e\u5730\u5740\uff1f - \u77e5\u4e4e (zhihu.com)</p> <p>\u770b\u4e86\u4e00\u4e9b\u535a\u5ba2\u540e\uff0c\u6709\u4e86\u4e00\u4e9b\u7406\u89e3\u3002</p> <p>\u5148\u660e\u786e\u5e76\u4e14\u8bb0\u4f4f\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li>\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6808\u548c\u5185\u5b58\u4e2d\u7684\u6808\u4e0d\u662f\u540c\u4e00\u4e2a\u4e1c\u897f</li> <li>\u4e0d\u540c ISA \u4e0b\uff0c\u6808\u7684\u589e\u957f\u65b9\u5411\u4e0d\u592a\u4e00\u6837\u3002\u6bd4\u5982\u76ee\u524d\u4e3b\u6d41\u7684\u67b6\u6784\uff0cRISC-V \u3001ARM\u3001x86 \u90fd\u662f\u5411\u4e0b\u589e\u957f\u7684\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#_8","title":"\u6570\u636e\u7ed3\u6784\u548c\u5185\u5b58\u4e2d\u7684\u6808","text":"<ul> <li> <p>\u6570\u636e\u7ed3\u6784\u4e2d</p> <p>\u6808\u548c\u5806\u662f\u4e24\u79cd\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\u3002\u6808\u662f\u4e00\u79cd\u540e\u8fdb\u5148\u51fa\uff08LIFO\uff09\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ea\u5141\u8bb8\u5728\u6808\u7684\u9876\u90e8\u8fdb\u884c\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u3002\u5806\u662f\u4e00\u79cd\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u5b58\u50a8\u52a8\u6001\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5806\u662f\u4e2a\u6811\u5f62\u7ed3\u6784\u3002</p> </li> <li> <p>\u5185\u5b58\u4e2d</p> <p>\u6808\u662f\u6307\u8ba1\u7b97\u673a\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u533a\u57df\u3002</p> <p>\u6808\u662f\u4e00\u79cd\u8fde\u7eed\u7684\u5185\u5b58\u533a\u57df\uff0c\u7528\u4e8e\u5b58\u50a8\u51fd\u6570\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3001\u5c40\u90e8\u53d8\u91cf\u548c\u51fd\u6570\u53c2\u6570\u7b49\u3002\u6808\u7684\u5927\u5c0f\u5728\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u5c31\u786e\u5b9a\u4e86\uff0c\u5b83\u7684\u5206\u914d\u548c\u91ca\u653e\u662f\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u5b8c\u6210\u7684\u3002\u6808\u7684\u7279\u70b9\u662f\u9ad8\u6548\u7684\u5206\u914d\u548c\u91ca\u653e\uff0c\u4f46\u662f\u5bb9\u91cf\u6709\u9650\u3002</p> <p>\u6570\u636e\u7ed3\u6784\u7684\u5806\u5219\u548c\u5185\u5b58\u4e2d\u7684\u5806\u5c31\u5b8c\u5168\u4e0d\u540c\u4e86\uff0c\u8fd9\u5757\u4e0d\u80fd\u6df7\u6dc6\u3002</p> </li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#_9","title":"\u6808\u9876/\u6808\u5e95","text":"<p>\u6211\u4eec\u76ee\u524d\u5c31\u9ed8\u8ba4\u4e3a\u6808\u7684\u589e\u957f\u65b9\u5411\uff1a\u9ad8\u5730\u5740-&gt;\u4f4e\u5730\u5740</p> <p></p> <p>\u6211\u4e2a\u4eba\u89c9\u5f97\uff1a\u8fd9\u4e9b\u5185\u5b58\u662f\u7528\u6765\u653e\u4e1c\u897f\u7684\uff0c\u4e0d\u8981\u4e00\u76f4\u5728\u7ea0\u7ed3\u6808\u5806\u5f80\u54ea\u4e2a\u65b9\u5411\u957f\uff0c\u60f3\u60f3\u600e\u4e48\u653e\u6570\u636e\uff08LIFO\uff09</p> <p>\u6211\u4eec\u9009\u62e9\u6808\u533a\u653e\u4e1c\u897f\uff0c\u5148\u4ece\u6808\u7684\u5e95\u90e8\u5f00\u59cb\u653e\u5230\u6808\u7684\u9876\u90e8\uff0c\u4e5f\u5c31\u662f\u4ece\u9ad8\u5730\u5740\u653e\u5230\u4f4e\u5730\u5740\u7684\u7a7a\u95f4\u3002</p> <p>\u6709\u4e9b\u6559\u6750\u5f80\u5f80\u91c7\u7528\u53f3\u8fb9\u7684\u65b9\u5f0f\u8fdb\u884c\u8bb2\u6388\u6808\uff0c\u53ef\u80fd\u662f\u4e3a\u4e86\u66f4\u52a0\u7b26\u5408\u4eba\u7684\u76f4\u89c2\u903b\u8f91</p> <p>\u4f46\u662f\u6211\u4eec\u4e5f\u8981\u6e05\u695a \u65e0\u8bba\u54ea\u79cd\u987a\u5e8f\u90fd\u662f\u6808\u5e95\u5230\u6808\u9876\uff08\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\uff09</p> <p></p> <p>\u518d\u770b\u4e0a\u56fe\u7684\u76f8\u5173\u89e3\u91ca\uff0c\u80fd\u63d2\u5165\u7684\u4e00\u7aef\u662f\u6808\u9876\uff0c\u4f46\u662f\u5230\u6700\u540e\u8fd8\u662f\u653e\u5230\u4e86\u6808\u5e95\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_10","title":"\u6570\u7ec4\u5b9e\u73b0\u6808","text":"<pre><code>Status Push(SqStack *S, SElemType e)\n{\n    if(S-&gt;top == MAXSIZE - 1)\n    {\n        return ERROR;\n    }\n    S-&gt;top++;\n    S-&gt;data[S-&gt;top] = e;\n    return OK;\n}\n</code></pre> <p>\u770b\u8fd9\u4e2a\u7528\u6570\u7ec4\u5b9e\u73b0\u7684\u5165\u6808\u64cd\u4f5c\u53c8\u89c9\u5f97\u6709\u95ee\u9898\uff0c\u4e0d\u662f\u8bf4\u4ece\u9ad8\u5730\u5740\u5411\u4f4e\u5730\u5740\u589e\u957f\u5417\uff1f</p> <p>\u600e\u4e48\u53c8S-&gt;top++\u5462</p> <p>\u6ce8\u610f: C\u8bed\u8a00\u4e2d\u7684\u6570\u7ec4\u770b\u4f5c\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u901a\u8fc7\u4e0b\u6807\u6765\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u3002</p> <pre><code>int a[100];\n</code></pre> <ol> <li> <p>\u6570\u7ec4\u7533\u8bf7\u4e86\u4e00\u7247\u7a7a\u95f4\uff0c\u7a7a\u95f4\u5927\u5c0f\u4e3a100x4 Byte\uff08int\u7c7b\u578b\uff09\u3002\u5185\u5b58\u4e2d\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\u5206\u914d400\u4e2a\u5185\u5b58\u5355\u5143\u3002</p> </li> <li> <p>\u7528C\u8bed\u8a00\u6570\u7ec4\u6765\u5199\u3002\u5176\u4e0b\u6807\u7684\u589e\u957f\u4ece0\u523099\uff0c(\u653e\u5165\u6808\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u6807\u53f7\u4e3a1\uff0c\u4e4b\u540e\u7b2c2\u4e2a...\u8fd9\u91cc\u7684\u4e0b\u6807\u8ba9\u4eba\u611f\u89c9\u597d\u50cf\u662f\u4ece\u4f4e\u5730\u5740\u589e\u957f\u5230\u9ad8\u5730\u5740\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\uff0c\u53ea\u662f\u8fd9\u79cd\u62bd\u8c61\u65b9\u4fbf\u7406\u89e3)</p> <p>\u5b9e\u9645\u4e0a\u5185\u5b58\u7684\u6808\u8fd8\u662f\u7531\u9ad8\u5730\u5740\u5411\u4f4e\u5730\u5740\u589e\u957f\u7684\u3002</p> </li> <li> <p>\u6bd4\u5982\u8bf4\uff0c\u6211\u60f3\u5165\u6808\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u5165\u6808\u4e86\u4e4b\u540e\uff0c\u8fd9\u4e2a\u5143\u7d20\u5e94\u8be5\u5b58\u50a8\u5728\u6808\u5e95\uff0c\u4e5f\u5c31\u662f\u9ad8\u5730\u5740\u90a3\u90e8\u5206\u5440\uff0c\u5b83\u7684\u5730\u5740\u5e94\u8be5\u662f0x00000187 - 0x00000190(a[0]).\u4e4b\u540e\u518d\u5165\u6808\u7b2c\u4e8c\u4e2a\uff0c\u5c31\u5e94\u8be5\u662f0x00000183 - 0x00000186(a[1]) \u4ee5\u6b64\u7c7b\u63a8</p> </li> </ol>"},{"location":"Complex%20issues/Complex%20issues.html#freertos","title":"FreeRTOS \u4e2d\u7684\u6808","text":"<pre><code>volatile int array[100];\nvolatile int temp = 0;\nvolatile int temp1 = 0;\nvolatile int temp2 = 0;\nvolatile int temp3 = 0;\n</code></pre> <p>\u786e\u5b9e\u662f\u5411\u4e0b\u589e\u957f\u7684</p>"},{"location":"Complex%20issues/Complex%20issues.html#efficiency-of-different-integer-sizes-on-a-64-bit-cpu","title":"Efficiency of different integer sizes on a 64-bit CPU","text":"<p>[(https://stackoverflow.com/questions/12447381/efficiency-of-different-integer-sizes-on-a-64-bit-cpu)</p>"},{"location":"Complex%20issues/Complex%20issues.html#_11","title":"\u4e3a\u4ec0\u4e48\u8981\u5c06\u6307\u4ee4\u548c\u6570\u636e\u5206\u5f00\uff1f","text":"<ul> <li>\u67b6\u6784</li> <li>\u7a0b\u5e8f\u7f16\u8bd1</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#_12","title":"\u67b6\u6784","text":"<p>\u54c8\u4f5b\u67b6\u6784\u548c\u51af\u8bfa\u4f9d\u66fc\u67b6\u6784</p>"},{"location":"Complex%20issues/Complex%20issues.html#_13","title":"\u7a0b\u5e8f\u7f16\u8bd1\u7684\u89d2\u5ea6","text":"<p>.text/.code \u6bb5\u548c .data\u548c.bss\u6bb5</p> <ol> <li> <p>\u5b89\u5168</p> <p>ELF\u88ab\u88c5\u8f7d\u5230\u5185\u5b58\u540e\uff0c\u6570\u636e\u548c\u6307\u4ee4\u88ab\u6620\u5c04\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u533a\u57df\uff0c\u6307\u4ee4\u6bb5\u548c\u6570\u636e\u6bb5/</p> <p>\u6307\u4ee4\u6bb5\u53ea\u8bfb\uff0c\u6570\u636e\u6bb5\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\uff1f\uff08\u662f\u5426\u8fd8\u6709\u522b\u7684\u6743\u9650\uff1f\uff09</p> <p>\u9632\u6b62\u7a0b\u5e8f\u7684\u6307\u4ee4\u88ab\u6076\u610f\u66f4\u6539\uff1f</p> </li> <li> <p>\u7f13\u5b58</p> <p>\u56e0\u4e3a\u73b0\u4ee3\u7684CPU\u4f53\u7cfb\u4e2d\uff0c\u7f13\u5b58\u975e\u5e38\u7684\u91cd\u8981\uff08\u8ddf\u4e0a\u5bc4\u5b58\u5668\u7684\u901f\u5ea6\uff09\uff0c\u6240\u4ee5\u9700\u8981\u5c3d\u53ef\u80fd\u5730\u63d0\u9ad8\u7f13\u5b58\u7684\u547d\u4e2d\u7387\uff0c\u4e5f\u5c31\u662fcache hit\u3002</p> <p>\u5c06\u6307\u4ee4\u548c\u6570\u636e\u5206\u79bb\uff0c\u589e\u5f3a\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u7a7a\u95f4\u5c40\u90e8\u6027\u3002\u6240\u4ee5\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6709\u4e00\u4e9b\u7f13\u5b58\u5206\u4e3a\u4e86<code>icache\u3001dcache</code>\uff1f</p> </li> <li> <p>\u591a\u4e2a\u76f8\u540c\u7684\u7a0b\u5e8f\u8fd0\u884c\uff0c\u8282\u7701\u5185\u5b58</p> <p>\u5f53\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u8fd0\u884c\u4e86\u591a\u4e2a\u8be5\u7a0b\u5e8f\u7684\u526f\u672c\uff0c\u4ed6\u4eec\u7684\u6307\u4ee4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5728\u5185\u5b58\u4e2d\u53ea\u9700\u8981\u4fdd\u5b58\u4e00\u4efd\u8be5\u7a0b\u5e8f\u7684\u6307\u4ee4\u90e8\u5206\u3002</p> <p>\u53e6\u5916\uff0c\u56e0\u4e3a\u6307\u4ee4\u7684\u53ea\u8bfb\u5c5e\u6027\uff0c\u90a3\u53ea\u8bfb\u6570\u636e\u5e94\u8be5\u4e5f\u662f\u53ef\u4ee5\u7684\uff1f</p> <p>\u56fe\u6807\u3001\u56fe\u7247\u3001\u6587\u672c\u3001\uff1f\u3002\u3002\u3002</p> <p>\u5171\u4eab\u6307\u4ee4\uff1f </p> </li> </ol> <p>\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\uff0c\u94fe\u63a5\u88c5\u8f7d\u4e0e\u5e93\u76843.2</p>"},{"location":"Complex%20issues/Complex%20issues.html#_14","title":"\u5b66\u4e60\u601d\u60f3","text":"<p>\u522b\u7ba1\u4ed6\u53eb\u4ec0\u4e48\uff0c\u770b\u4ed6\u7528\u6765\u505a\u4ec0\u4e48</p> <p>\u6240\u4ee5\u8fd9\u79cd\u6280\u672f\u540d\u8bcd\u6700\u7ec8\u8fd8\u662f\u5e94\u8be5\u4ece\u4ed6\u4eec\u51fa\u73b0\u7684\u539f\u56e0\u53bb\u7406\u89e3\uff0c\u800c\u4e0d\u5e94\u8be5\u7b80\u5355\u7684\u4ece\u4e00\u4e9b\u5f62\u6001\u3001\u67b6\u6784\u53bb\u89e3\u91ca\u3002\u66f4\u4e0d\u5e94\u8be5\u673a\u68b0\u7684\u641e\u4e00\u4e9b\u6ca1\u6709\u4ec0\u4e48\u610f\u4e49\u7684\u201c\u5b9a\u4e49\u201d\uff0c\u8fd8\u8ba9\u5b66\u751f\u5728\u8003\u8bd5\u7684\u65f6\u5019\u53bb\u56de\u7b54\u3002</p> <p>\u8fd9\u91cc\u4ee5 jyy \u8001\u5e08\u7684\u601d\u60f3\uff0c\u5173\u4e8e\u5b66\u4e60\u4efb\u4f55\u4e00\u4e2a\u77e5\u8bc6\u70b9\uff1a</p> <p></p> <p>\u53e6\u5916\u6211\u4e2a\u4eba\u7684\u4e60\u60ef\uff1a\u4ece\u5386\u53f2\u53d1\u5c55\u7684\u89d2\u5ea6\u6765\u770b\u8fd9\u4e2a\u4e1c\u897f\u51fa\u73b0\u7684\u8fc7\u7a0b\uff0c\u51fa\u73b0\u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\u7684\u3002</p> <p>\u8bb0\u5f97\u4e0a\u9762\u7684\u601d\u60f3\u3002\u8fd8\u6709jyy\u8001\u5e08\u548c\u590f\u865e\u658c\u8001\u5e08\u7684\u601d\u60f3</p> <p>\u5173\u4e8e\u57f9\u517b\u4e00\u4e2a\u5de5\u7a0b\u5e08\u548c\u6280\u672f\u5458</p> <p>\u7ed9\u53c2\u52a0Arm\u676f\u7684\u540c\u5b66\u63d0\u4e2a\u9192 - \u77e5\u4e4e (zhihu.com)</p> <p>\u201c\u6709\u6280\u65e0\u5de5\u201d\u2014\u2014\u76ee\u524d\u5927\u5b66\u5de5\u79d1\u6559\u80b2\u7684\u4e00\u4e9b\u95ee\u9898\u517c\u8bba\u5982\u4f55\u5b66\u4e60SoC\u8bbe\u8ba1 - \u77e5\u4e4e (zhihu.com)</p> <p>\u5982\u4f55\u7cfb\u7edf\u5730\u601d\u8003\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u9879\u76ee\uff0c\u5982\u4f55\u5206\u89e3\uff1f</p> <p>\u63a7\u5236\u529f\u80fd + \u6267\u884c\u529f\u80fd</p> <p></p>"},{"location":"Complex%20issues/Complex%20issues.html#mcu","title":"MCU \u7a0b\u5e8f\u548c\u6570\u636e\u5b58\u50a8\u7a7a\u95f4","text":"<ul> <li> <p>MCU</p> <p>\u4ee3\u7801(text)\u653e\u5728 flash\uff0c\u6570\u636e\uff08.data, .bss, heap, stack, register\uff09\u653e\u5728RAM</p> <p>\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0cCPU \u4e0d\u662f\u53ea\u80fd\u548c RAM \u4ea4\u6d41\u561b\uff1f\u90a3\u662f\u4e0d\u662f\u8fd8\u5f97\u628a flash \u4e2d\u7684\u5185\u5bb9\u642c\u5230 RAM \u4e2d\uff1f\u8fd8\u662f\u8bf4 CPU \u4e5f\u80fd\u548c flash \u76f8\u4e92\u64cd\u4f5c\uff1f</p> <p>\u5e76\u4e0d\u662f\uff0cPC\u6307\u9488\u6307\u5411\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4ece flash \u4e2d\u53d6\u51fa\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4f20\u7ed9 decoder \u5bf9 \u6307\u4ee4\u8fdb\u884c\u89e3\u7801\uff0c\u5c06\u89e3\u7801\u51fa\u6765\u7684\u884c\u4e3a\u4f20\u7ed9 CPU\uff0c\u6267\u884c\u5177\u4f53\u7684\u52a8\u4f5c\u3002</p> </li> <li> <p>MPU</p> <p>MPU \u56e0\u4e3a\u5185\u90e8\u6ca1\u6709\u96c6\u6210\u5185\u5b58\u6bd4\u8f83\u5c11\uff0c\u8981\u52a0\u8f7d\u7684\u7a0b\u5e8f\u5927\u5c0f\u6bd4\u8f83\u5927\uff0c\u6240\u4ee5\u9700\u8981\u5916\u6302 flash\u3002</p> </li> <li> <p>Soc</p> <p>\u96c6\u5408\u4e0a\u8ff0\u4f18\u70b9\u3002</p> </li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd8\u6709\u53e6\u5916\u4e00\u70b9\uff0c\u5c31\u662f MCU \u548c MPU \u7684\u67b6\u6784\u7a0d\u5fae\u4e0d\u540c\uff0cMPU \u6216\u8005\u8bf4 CPU \uff0c\u662f\u57fa\u4e8e\u51af\u8bfa\u4f9d\u66fc\u67b6\u6784\u7684\uff0c\u6307\u4ee4\u548c\u6570\u636e\u5b58\u50a8\u5728\u4e00\u8d77\uff1b\u800cMCU \u5927\u591a\u57fa\u4e8e\u54c8\u4f5b\u67b6\u6784\uff0c\u6307\u4ee4\u548c\u6570\u636e\u5206\u5f00\u5b58\u50a8\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>\u5d4c\u5165\u5f0fMCU \u7a0b\u5e8f\u548c\u6570\u636e\u5b58\u50a8\u7a7a\u95f4\u5206\u914d\u7406\u89e3-\u77e5\u8bc6\u70b9_\u7a0b\u5e8f\u7a7a\u95f4\u548c\u6570\u636e\u7a7a\u95f4\u5728\u8bfb\u5199\u64cd\u4f5c\u7684\u5173\u7cfb-CSDN\u535a\u5ba2</p> <p>\u6d45\u8c08\u5d4c\u5165\u5f0fMCU\u5f00\u53d1\u4e2d\u7684\u4e09\u4e2a\u5e38\u89c1\u8bef\u533a (qq.com)</p>"},{"location":"Complex%20issues/Complex%20issues.html#mcumpu","title":"MCU~MPU\u7684\u542f\u52a8\u6d41\u7a0b\u5927\u81f4\u603b\u7ed3","text":"<p>\u6211\u7684\u4ee3\u7801\uff08\u8fd9\u91cc\u662f\u673a\u5668\u7801\uff0c\u5148\u4e0d\u7ba1\u7f16\u8bd1\u6d41\u7a0b\u5148\uff09\u662f\u600e\u4e48\u4e0b\u8f7d\u5230 MCU \u4e0a\u7684\uff1f\u4e3a\u4ec0\u4e48\u9700\u8981\u4e00\u4e2a\u4e0b\u8f7d\u5668\u8fd9\u6837\u7684\u4e1c\u897f\uff1f \u6211\u5728\u7535\u8111\u4e0a\u7f16\u5199\u7684\u4ee3\u7801\u600e\u4e48\u624d\u80fd\u8fdb\u5165\u5230\u7269\u7406\u8bbe\u5907\u4e2d\uff1f\uff08\u8fd9\u662f\u4e0d\u662f\u9700\u8981\u6211\u81ea\u5df1\u5199\u4e00\u4e2aloader\uff0c\u56e0\u4e3a\u8fd0\u884c\u7a0b\u5e8f\uff0c\u9700\u8981 <code>loader</code> \u628a\u673a\u5668\u7801\u88c5\u8f7d\u5230\u7279\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u8fd9\u662f\u4e0b\u8f7d\u5668\u7684\u529f\u80fd\uff1f\uff09</p> <p>\u53e6\u5916\uff0c\u88c5\u8f7d\u4e4b\u540e\uff0c\u4ece\u5230 MCU \u786c\u4ef6\u4e0a\u7535\u542f\u52a8\u5230  <code>main</code>  \u51fd\u6570\u7684\u6267\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7a76\u7adf\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u4e2a\u8bb2\u5f97\u8fd8\u884c\uff1aSTM32\u542f\u52a8\u8fc7\u7a0b\u6d45\u6790\u8bfe\u5802\u603b\u7ed3</p> <p>\u68b3\u7406\u6d41\u7a0b\uff1a</p> <ol> <li> <p>\u8f6f\u4ef6\u7a0b\u5e8f\u5728 PC \u673a\u4e0a\u7f16\u8bd1\u597d\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>C\u8bed\u8a00-C\u8bed\u8a00\u548c\u786c\u4ef6\u7684\u9082\u9005 - Iriczhao - \u535a\u5ba2\u56ed (cnblogs.com)</p> </li> <li> <p>\u901a\u8fc7\u70e7\u5f55\u5668\u4ece PC \u673a\u4e0a\u4e0b\u8f7d\u5230 MCU \u4e0a\u7684 flash \u4e0a\u3002</p> <p>\u8fd9\u91cc\u6709\u4e9b\u95ee\u9898\uff1a</p> <ul> <li> <p>\u70e7\u5f55\u5668\u3001\u4e0b\u8f7d\u5668\u7684\u539f\u7406</p> </li> <li> <p>\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u88c5\u8f7d\u4e00\u5b9a\u662f\u70e7\u5f55\u5230 flash \u4e0a\u7684\u5417\uff1f\u80fd\u4e0d\u80fd\u70e7\u5f55\u5230 RAM \u4e0a\uff1f</p> <ul> <li>\u901a\u5e38\uff0c\u7f16\u8bd1\u597d\u7684\u8f6f\u4ef6\u7a0b\u5e8f\u662f\u70e7\u5f55\u5230MCU\u7684\u975e\u6613\u5931\u6027\u5b58\u50a8\u5668\uff08\u5982Flash\uff09\u4e0a\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5b58\u50a8\u5668\u80fd\u591f\u5728\u65ad\u7535\u540e\u4fdd\u6301\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u9002\u5408\u5b58\u50a8\u56fa\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u3002</li> <li>\u70e7\u5f55\u5230RAM\u4e0a\u662f\u4e0d\u5e38\u89c1\u7684\uff0c\u56e0\u4e3aRAM\u662f\u6613\u5931\u6027\u5b58\u50a8\u5668\uff0c\u4e00\u65e6\u65ad\u7535\uff0c\u5176\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u4f46\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u5982\u4f7f\u7528RAM\u6267\u884c\u67d0\u4e9b\u7279\u5b9a\u7684\u6d4b\u8bd5\u6216\u8c03\u8bd5\u4efb\u52a1\u65f6\uff0c\u53ef\u80fd\u4f1a\u5c06\u7a0b\u5e8f\u70e7\u5f55\u5230RAM\u4e2d\u3002</li> </ul> </li> <li>\u5177\u4f53\u662f\u70e7\u5f55\u5230 flash \u5185\u5b58\u5730\u5740\u7684\u54ea\u4e00\u90e8\u5206\uff1f\u81ea\u5df1\u80fd\u5426\u63a7\u5236\u88c5\u8f7d\u5230\u54ea\u4e00\u4e2a\u90e8\u5206\u7684\u5730\u5740\uff1f<ul> <li>\u70e7\u5f55\u5230Flash\u7684\u5177\u4f53\u5185\u5b58\u5730\u5740\u901a\u5e38\u7531\u94fe\u63a5\u811a\u672c\u6216\u542f\u52a8\u4ee3\u7801\u51b3\u5b9a\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u94fe\u63a5\u811a\u672c\u6765\u63a7\u5236\u7a0b\u5e8f\u70e7\u5f55\u5230Flash\u7684\u54ea\u4e00\u90e8\u5206\u5730\u5740\u3002</li> </ul> </li> </ul> </li> <li> <p>MCU \u4e0a\u7535\u542f\u52a8\uff0c\u5b8c\u6210\u786c\u4ef6\u521d\u59cb\u5316\uff0c\u68c0\u6d4b\u7535\u6e90\u3001\u65f6\u949f\u3001\u590d\u4f4d\u7b49\u7b49\u7535\u8def\u914d\u7f6e\u3002</p> <ul> <li>MCU\u4e0a\u7535\u542f\u52a8\u65f6\uff0c\u4f1a\u4ece\u9884\u8bbe\u7684\u542f\u52a8\u5730\u5740\uff08\u901a\u5e38\u662f Flash \u7684\u8d77\u59cb\u5730\u5740\uff09\u5f00\u59cb\u6267\u884c\u6307\u4ee4\u3002\u8fd9\u4e2a\u5730\u5740\u88ab\u79f0\u4e3a\u590d\u4f4d\u5411\u91cf\u6216\u542f\u52a8\u5411\u91cf\u3002</li> <li>\u4e0d\u540c\u7684\u5904\u7406\u5668\u67b6\u6784\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u542f\u52a8\u673a\u5236\uff0c\u4f46\u5927\u591a\u6570MCU\u5728\u4e0a\u7535\u6216\u590d\u4f4d\u540e\u4f1a\u81ea\u52a8\u4ece\u9884\u5b9a\u7684\u542f\u52a8\u5730\u5740\u5f00\u59cb\u6267\u884c\u3002</li> </ul> <p>\u50cf MCU \u8fd9\u79cd\u5355\u7247\u673a\uff0c\u76f4\u63a5\u8dd1\u88f8\u673a\u7684\uff0c\u662f\u4e0d\u662f\u5c31\u4e0d\u9700\u8981 <code>bootROM</code> \u8fd9\u79cd\u4e00\u7ea7\u5f15\u5bfc\u7a0b\u5e8f\u6765\u5f15\u5bfc\u7cfb\u7edf\u542f\u52a8\u4e86\uff1f\u76f4\u63a5\u5c31\u901a\u8fc7\u70e7\u5199\u5668\u70e7\u5199\u5230 flash\uff0c\u7136\u540e\u4eceflash\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5f00\u59cb\u65f6\u6307\u4ee4\u3002</p> <p>\u4f46\u662f\u50cf\u54ea\u79cd MPU \u6bd4\u8f83\u590d\u6742\u7684\u3001\u76f8\u5bf9\u9ad8\u6027\u80fd\u7684\u5185\u5bb9\uff0c\u9700\u8981\u8dd1\u5927\u578b\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\uff0c\u662f\u4e0d\u662f\u5c31\u9700\u8981 <code>bootROM</code> \u548c <code>bootloader</code> \u8fd9\u4e9b\u4e00\u4e8c\u7ea7\u5f15\u5bfc\u7a0b\u5e8f\u6765\u5f15\u5bfc \u64cd\u4f5c\u7cfb\u7edf\u7684\u52a0\u8f7d\uff1f</p> <ul> <li>\u5bf9\u4e8e\u88f8\u673a\u8fd0\u884c\u7684MCU\uff0c\u901a\u5e38\u4e0d\u9700\u8981<code>bootROM</code>\u8fd9\u79cd\u4e00\u7ea7\u5f15\u5bfc\u7a0b\u5e8f\u3002\u7a0b\u5e8f\u76f4\u63a5\u70e7\u5f55\u5230Flash\u4e2d\uff0c\u4e0a\u7535\u540e\u4eceFlash\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5f00\u59cb\u6267\u884c\u3002</li> <li>\u5bf9\u4e8e\u9700\u8981\u8fd0\u884c\u5927\u578b\u64cd\u4f5c\u7cfb\u7edf\u7684\u9ad8\u6027\u80fd MPU\uff0c<code>bootROM</code>\u548c<code>bootloader</code>\u662f\u5e38\u89c1\u7684\u3002<code>bootROM</code>\u901a\u5e38\u5305\u542b\u5728MCU\u5185\u90e8\uff0c\u7528\u4e8e\u521d\u59cb\u5316\u786c\u4ef6\u5e76\u52a0\u8f7d<code>bootloader</code>\u3002<code>bootloader</code>\u53ef\u80fd\u5b58\u50a8\u5728\u975e\u6613\u5931\u6027\u5b58\u50a8\u5668\u4e2d\uff0c\u8d1f\u8d23\u66f4\u590d\u6742\u7684\u542f\u52a8\u8fc7\u7a0b\uff0c\u5982\u52a0\u8f7d\u548c\u521d\u59cb\u5316\u64cd\u4f5c\u7cfb\u7edf\u3002</li> </ul> <p>\u8fd9\u91cc\u7b80\u5355\u8bb2\u4e00\u4e0b\u5173\u4e8e\u8fd9\u7c7b\u82af\u7247\u542f\u52a8\u6d41\u7a0b\uff1a</p> <p>Boot ROM \u4f4d\u4e8e\u82af\u7247\u5185\u90e8\u7684\u8d77\u59cb\u5730\u57400x00000000\u5904\uff0c\u5927\u5c0f\u4e3a96KB\u3002\u8fd9\u4e2a\u533a\u57df\u5305\u542b\u4e86\u542f\u52a8\u5f15\u5bfc\u7a0b\u5e8f\uff0c\u5b83\u8d1f\u8d23\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\uff08\u5982 SD \u5361\u3001eMMC\u3001NAND Flash \u7b49\uff09\u52a0\u8f7d\u64cd\u4f5c\u7cfb\u7edf\u6216\u5e94\u7528\u7a0b\u5e8f\u7684\u955c\u50cf\uff0c\u5e76\u5c06\u5176\u590d\u5236\u5230 RAM(\u5916\u90e8\u7684 DDR) \u4e2d\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u955c\u50cf\u7684\u5165\u53e3\u70b9\u5f00\u59cb\u6267\u884c\u3002</p> <p>\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u6d89\u53ca\u5230\u8bfb\u53d6\u5b58\u50a8\u8bbe\u5907\u4e0a\u7684 IVT\uff08Image Vector Table\uff09\u3001Boot Data \u548c DCD\uff08Device Configuration Data\uff09\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u544a\u8bc9 Boot ROM \u5982\u4f55\u52a0\u8f7d\u548c\u9a8c\u8bc1\u955c\u50cf\u6587\u4ef6\u3002</p> <p>\u8fd9\u91cc\u4e5f\u6709\u4e2a\u95ee\u9898\uff0c\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\u52a0\u8f7d\u955c\u50cf\uff0c\u600e\u4e48\u52a0\u8f7d\uff1fCPU \u600e\u4e48\u8bfb\u53d6\u8fd9\u90e8\u5206\u7a0b\u5e8f\u505a\u5230\u7684\uff1f\u8fd9\u90e8\u5206bootROM\u7a0b\u5e8f\u7a76\u7adf\u5199\u4e86\u4ec0\u4e48\uff1f\u642c\u8fd0\u6307\u4ee4\uff1f</p> <p>own version, not official version.</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u4e5f\u5408\u7406\u7684\uff0c\u8fd9\u91cc\u7559\u5751\uff0c\u603b\u7ed3\u6210\u53e6\u4e00\u7bc7\u6587\u7ae0\u3002 </p> </li> <li> <p>\u542f\u52a8\u4ee3\u7801\uff08<code>start.s</code>\uff09\uff1a</p> <ul> <li><code>start.s</code>\u662f\u4e00\u6bb5\u6c47\u7f16\u8bed\u8a00\u7f16\u5199\u7684\u542f\u52a8\u4ee3\u7801\uff0c\u4f4d\u4e8e\u7a0b\u5e8f\u7684\u6700\u5f00\u59cb\u90e8\u5206\u3002\u5b83\u8d1f\u8d23\u8bbe\u7f6e\u521d\u6b65\u7684\u5806\u6808\u6307\u9488\u3001\u6570\u636e\u6bb5\u548cBSS\u6bb5\uff08Block Started by Symbol\uff0cBSS\u6bb5\u7528\u4e8e\u521d\u59cb\u5316\u4e3a\u96f6\u7684\u5168\u5c40\u53d8\u91cf\uff09\uff0c\u5e76\u914d\u7f6e\u4e2d\u65ad\u5411\u91cf\u8868\u3002</li> <li><code>start.s</code>\u8fd8\u4f1a\u8fdb\u884c\u786c\u4ef6\u7684\u8fdb\u4e00\u6b65\u521d\u59cb\u5316\uff0c\u5982\u5185\u5b58\u63a7\u5236\u5668\u3001\u65f6\u949f\u7cfb\u7edf\uff0c\u6216\u8005\u7279\u5b9a\u786c\u4ef6\u5916\u8bbe\u7684\u521d\u59cb\u5316\uff1a GPIO\u3001DMA\u7b49\uff0c\u5e76\u6700\u7ec8\u8c03\u7528C\u8bed\u8a00\u7f16\u5199\u7684<code>main</code>\u51fd\u6570\u3002</li> </ul> </li> <li> <p>\u6267\u884c\u5e94\u7528\u7a0b\u5e8f / \u8fd0\u884c OS </p> </li> <li> <p>\u8ba1\u7b97\u673a\u7ec4\u6210\uff08\u51af\u8bfa\u4f9d\u66fc\u548c\u54c8\u4f5b\u67b6\u6784\uff09</p> </li> <li> <p>MCU \u7684\u5b58\u50a8\u7ed3\u6784</p> <p>\u8d34 <code>keil</code> \u7f16\u8bd1\u540e\u751f\u6210\u7684\u4ee3\u7801\u5927\u5c0f\u56fe</p> </li> <li> <p>MCU \u542f\u52a8\u6d41\u7a0b <code>start.s</code></p> </li> <li> <p>bootloader</p> <p>\u5f15\u5165 <code>bootloader</code> \u552f\u4e00\u7684\u76ee\u7684\u5c31\u662f\u66f4\u65b0\u7cfb\u7edf\uff0c\u5b9e\u73b0 OTA \u5347\u7ea7\uff0c\u5426\u5219\u76f4\u63a5\u901a\u8fc7\u7f16\u7a0b\u5668\u6216\u8005\u70e7\u5f55\u5668\uff08\u901a\u8fc7 JTAG\u3001SWD\uff09\u4e0eMCU\u901a\u4fe1\uff0c\u5c06\u7f16\u8bd1\u540e\u7684 .hex \u6216\u8005 .bin \u70e7\u5f55\u5230 flash \u4e2d\u3002</p> <p>bin\uff0chex\uff0cELF </p> <ol> <li>\u6587\u4ef6\u683c\u5f0f\u548c\u5185\u5bb9\uff1a</li> <li><code>.ELF</code> \u6587\u4ef6\u662f\u4e00\u79cd\u4e8c\u8fdb\u5236\u6587\u4ef6\u683c\u5f0f\uff0c\u7528\u4e8eUnix\u548c\u7c7bUnix\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u6587\u4ef6\u548c\u53ef\u94fe\u63a5\u5bf9\u8c61\u6587\u4ef6\u3002\u5b83\u4e0d\u4ec5\u5305\u542b\u7a0b\u5e8f\u7684\u673a\u5668\u7801\uff0c\u8fd8\u5305\u542b\u7a0b\u5e8f\u7684\u5143\u6570\u636e\uff0c\u5982\u7b26\u53f7\u8868\u3001\u8c03\u8bd5\u4fe1\u606f\u3001\u91cd\u5b9a\u4f4d\u8868\u7b49\u3002</li> <li><code>.hex</code> \u6587\u4ef6\u662f\u4e00\u79cd\u6587\u672c\u6587\u4ef6\u683c\u5f0f\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u5f62\u5f0f\u8868\u793a\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5e76\u5305\u542b\u5730\u5740\u4fe1\u606f\uff0c\u7528\u4e8e\u6307\u5b9a\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u4f4d\u7f6e\u3002</li> <li> <p><code>.bin</code> \u6587\u4ef6\u662f\u4e00\u4e2a\u539f\u59cb\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u901a\u5e38\u4e0d\u5305\u542b\u5730\u5740\u4fe1\u606f\uff0c\u4ec5\u5305\u542b\u53ef\u6267\u884c\u4ee3\u7801\u6216\u6570\u636e\u3002</p> </li> <li> <p>\u7528\u9014\uff1a</p> </li> <li><code>.ELF</code> \u6587\u4ef6\u7528\u4e8e\u8c03\u8bd5\u548c\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7684\u94fe\u63a5\u3002\u5b83\u4eec\u5141\u8bb8\u5f00\u53d1\u8005\u4f7f\u7528\u8c03\u8bd5\u5668\u8fdb\u884c\u6e90\u4ee3\u7801\u7ea7\u7684\u8c03\u8bd5\uff0c\u56e0\u4e3a\u8c03\u8bd5\u5668\u53ef\u4ee5\u5229\u7528 <code>.ELF</code> \u6587\u4ef6\u4e2d\u7684\u7b26\u53f7\u4fe1\u606f\u6765\u6620\u5c04\u7a0b\u5e8f\u6267\u884c\u4e2d\u7684\u5730\u5740\u5230\u6e90\u4ee3\u7801\u3002</li> <li><code>.hex</code> \u6587\u4ef6\u4e3b\u8981\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7684\u7f16\u7a0b\u548c\u70e7\u5f55\uff0c\u5b83\u63d0\u4f9b\u4e86\u5fc5\u8981\u7684\u5730\u5740\u4fe1\u606f\uff0c\u65b9\u4fbf\u70e7\u5f55\u5668\u5c06\u7a0b\u5e8f\u7684\u5404\u4e2a\u90e8\u5206\u70e7\u5f55\u5230\u76ee\u6807\u786c\u4ef6\u7684\u6b63\u786e\u5730\u5740\u3002</li> <li> <p><code>.bin</code> \u6587\u4ef6\u901a\u5e38\u7528\u4e8e\u6700\u7ec8\u4ea7\u54c1\u7684\u5206\u53d1\u548c\u70e7\u5f55\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u5305\u542b\u8c03\u8bd5\u4fe1\u606f\uff0c\u6587\u4ef6\u5927\u5c0f\u66f4\u5c0f\uff0c\u52a0\u8f7d\u901f\u5ea6\u66f4\u5feb\u3002</p> </li> <li> <p>\u8c03\u8bd5\u4fe1\u606f\uff1a</p> </li> <li><code>.ELF</code> \u6587\u4ef6\u5305\u542b\u5b8c\u6574\u7684\u8c03\u8bd5\u4fe1\u606f\uff0c\u8fd9\u5bf9\u4e8e\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7684\u9519\u8bef\u68c0\u6d4b\u548c\u6027\u80fd\u5206\u6790\u81f3\u5173\u91cd\u8981\u3002</li> <li> <p><code>.hex</code> \u548c <code>.bin</code> \u6587\u4ef6\u901a\u5e38\u4e0d\u5305\u542b\u8c03\u8bd5\u4fe1\u606f\u3002<code>.hex</code> \u6587\u4ef6\u4e3b\u8981\u5173\u6ce8\u4e8e\u6570\u636e\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u548c\u5185\u5b58\u5730\u5740\u6620\u5c04\uff0c\u800c <code>.bin</code> \u6587\u4ef6\u4ec5\u5173\u6ce8\u4e8e\u6570\u636e\u672c\u8eab\u3002</p> </li> <li> <p>\u94fe\u63a5\u8fc7\u7a0b\uff1a</p> </li> <li><code>.ELF</code> \u6587\u4ef6\u5728\u94fe\u63a5\u8fc7\u7a0b\u4e2d\u975e\u5e38\u91cd\u8981\uff0c\u94fe\u63a5\u5668\u4f7f\u7528 <code>.ELF</code> \u6587\u4ef6\u6765\u5408\u5e76\u591a\u4e2a\u6a21\u5757\u6216\u5e93\uff0c\u751f\u6210\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</li> <li> <p><code>.hex</code> \u548c <code>.bin</code> \u6587\u4ef6\u901a\u5e38\u4e0d\u76f4\u63a5\u53c2\u4e0e\u94fe\u63a5\u8fc7\u7a0b\uff0c\u5b83\u4eec\u662f\u94fe\u63a5\u540e\u751f\u6210\u7684\u6700\u7ec8\u4ea7\u7269\u6216\u7528\u4e8e\u70e7\u5f55\u7684\u4e2d\u95f4\u4ea7\u7269\u3002</p> </li> <li> <p>\u517c\u5bb9\u6027\uff1a</p> </li> <li><code>.ELF</code> \u6587\u4ef6\u4e0e\u7279\u5b9a\u7684\u5f00\u53d1\u73af\u5883\u548c\u5de5\u5177\u94fe\u7d27\u5bc6\u76f8\u5173\uff0c\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u53ef\u80fd\u652f\u6301\u4e0d\u540c\u7684 <code>.ELF</code> \u6587\u4ef6\u683c\u5f0f\u53d8\u4f53\u3002</li> <li><code>.hex</code> \u6587\u4ef6\u5177\u6709\u8f83\u5e7f\u6cdb\u7684\u517c\u5bb9\u6027\uff0c\u8bb8\u591a\u70e7\u5f55\u5668\u548c\u7f16\u7a0b\u5668\u90fd\u80fd\u591f\u8bc6\u522b\u548c\u5904\u7406 <code>.hex</code> \u683c\u5f0f\u7684\u6587\u4ef6\u3002</li> </ol> <p>\u603b\u7ed3\u6765\u8bf4\uff0c<code>.ELF</code> \u6587\u4ef6\u662f\u5f00\u53d1\u548c\u8c03\u8bd5\u8fc7\u7a0b\u4e2d\u7684\u5173\u952e\u6587\u4ef6\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5143\u6570\u636e\u548c\u8c03\u8bd5\u4fe1\u606f\uff1b</p> <p>\u800c <code>.hex</code> \u548c <code>.bin</code> \u6587\u4ef6\u5219\u66f4\u591a\u5730\u7528\u4e8e\u4ea7\u54c1\u7684\u5206\u53d1\u548c\u70e7\u5f55\uff0c\u5176\u4e2d <code>.hex</code> \u6587\u4ef6\u56e0\u5176\u5730\u5740\u4fe1\u606f\u800c\u5728\u70e7\u5f55\u8fc7\u7a0b\u4e2d\u66f4\u4e3a\u5e38\u7528\u3002</p> <p>\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u5f00\u53d1\u4e2d\uff0c<code>.hex</code> \u6587\u4ef6\u76f8\u8f83\u4e8e <code>.bin</code> \u6587\u4ef6\u66f4\u53d7\u6b22\u8fce\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u539f\u56e0\uff1a</p> <ol> <li>\u5730\u5740\u4fe1\u606f\uff1a<code>.hex</code> \u6587\u4ef6\u5305\u542b\u4e86\u7a0b\u5e8f\u6570\u636e\u53ca\u5176\u5728\u76ee\u6807\u8bbe\u5907\u4e2d\u7684\u5b58\u50a8\u5730\u5740\u4fe1\u606f\uff0c\u8fd9\u4f7f\u5f97\u70e7\u5f55\u8fc7\u7a0b\u66f4\u52a0\u81ea\u52a8\u5316\u548c\u51c6\u786e\u3002\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u624b\u52a8\u6307\u5b9a\u70e7\u5f55\u5730\u5740\uff0c\u56e0\u4e3a <code>.hex</code> \u6587\u4ef6\u5df2\u7ecf\u6307\u660e\u4e86\u6570\u636e\u5e94\u8be5\u5b58\u653e\u5230\u76ee\u6807\u8bbe\u5907\u7684\u54ea\u4e2a\u4f4d\u7f6e\u3002</li> <li>\u53ef\u8bfb\u6027\uff1a<code>.hex</code> \u6587\u4ef6\u662f\u6587\u672c\u6587\u4ef6\uff0c\u53ef\u4ee5\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\u548c\u67e5\u770b\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8005\u7406\u89e3\u548c\u4fee\u6539\u3002\u8fd9\u79cd\u53ef\u8bfb\u6027\u5bf9\u4e8e\u8c03\u8bd5\u548c\u5206\u6790\u7a0b\u5e8f\u975e\u5e38\u6709\u7528\u3002</li> <li>\u70e7\u5f55\u4fbf\u6377\u6027\uff1a\u7531\u4e8e <code>.hex</code> \u6587\u4ef6\u5305\u542b\u4e86\u5730\u5740\u4fe1\u606f\uff0c\u70e7\u5f55\u5668\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u70e7\u5f55\uff0c\u65e0\u9700\u989d\u5916\u7684\u914d\u7f6e\u6b65\u9aa4\u3002\u8fd9\u7b80\u5316\u4e86\u70e7\u5f55\u8fc7\u7a0b\uff0c\u5c24\u5176\u662f\u5728\u6279\u91cf\u70e7\u5f55\u6216\u81ea\u52a8\u5316\u751f\u4ea7\u73af\u5883\u4e2d\u3002</li> <li>\u9519\u8bef\u68c0\u6d4b\uff1a<code>.hex</code> \u6587\u4ef6\u4e2d\u7684\u6bcf\u6761\u8bb0\u5f55\u90fd\u6709\u6821\u9a8c\u548c\uff0c\u53ef\u4ee5\u7528\u6765\u68c0\u6d4b\u6587\u4ef6\u5728\u4f20\u8f93\u6216\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u662f\u5426\u51fa\u73b0\u9519\u8bef\u3002\u8fd9\u79cd\u9519\u8bef\u68c0\u6d4b\u673a\u5236\u6709\u52a9\u4e8e\u786e\u4fdd\u70e7\u5f55\u5230\u8bbe\u5907\u4e2d\u7684\u7a0b\u5e8f\u7684\u5b8c\u6574\u6027\u548c\u53ef\u9760\u6027\u3002</li> <li>\u517c\u5bb9\u6027\uff1a<code>.hex</code> \u6587\u4ef6\u683c\u5f0f\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7684\u7f16\u7a0b\u5668\u548c\u70e7\u5f55\u5668\uff0c\u5177\u6709\u5f88\u597d\u7684\u517c\u5bb9\u6027\u3002\u8fd9\u4f7f\u5f97\u4f7f\u7528 <code>.hex</code> \u6587\u4ef6\u7684\u7a0b\u5e8f\u66f4\u5bb9\u6613\u5728\u4e0d\u540c\u7684\u8bbe\u5907\u548c\u5e73\u53f0\u4e0a\u8fd0\u884c\u3002<ol> <li>\u9644\u52a0\u4fe1\u606f\uff1a<code>.hex</code> \u6587\u4ef6\u53ef\u4ee5\u5305\u542b\u9664\u7a0b\u5e8f\u6570\u636e\u548c\u5730\u5740\u4fe1\u606f\u4e4b\u5916\u7684\u9644\u52a0\u4fe1\u606f\uff0c\u5982\u8d77\u59cb\u5730\u5740\u8bb0\u5f55\u7b49\u3002\u8fd9\u4e9b\u9644\u52a0\u4fe1\u606f\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u5173\u4e8e\u7a0b\u5e8f\u5982\u4f55\u52a0\u8f7d\u548c\u6267\u884c\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002</li> </ol> </li> <li>\u6587\u4ef6\u5927\u5c0f\uff1a\u867d\u7136 <code>.hex</code> \u6587\u4ef6\u7684\u6587\u4ef6\u5927\u5c0f\u53ef\u80fd\u4f1a\u6bd4 <code>.bin</code> \u6587\u4ef6\u5927\uff0c\u56e0\u4e3a\u5b83\u5305\u542b\u4e86\u989d\u5916\u7684\u4fe1\u606f\uff0c\u4f46\u8fd9\u79cd\u5927\u5c0f\u5dee\u5f02\u901a\u5e38\u4e0d\u4f1a\u6210\u4e3a\u9009\u62e9\u6587\u4ef6\u683c\u5f0f\u7684\u51b3\u5b9a\u6027\u56e0\u7d20\uff0c\u5c24\u5176\u662f\u5728\u5b58\u50a8\u7a7a\u95f4\u76f8\u5bf9\u5145\u8db3\u7684\u73b0\u4ee3\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>.hex</code> \u6587\u4ef6\u56e0\u5176\u5305\u542b\u5730\u5740\u4fe1\u606f\u3001\u6613\u4e8e\u9605\u8bfb\u548c\u70e7\u5f55\u3001\u5177\u6709\u9519\u8bef\u68c0\u6d4b\u673a\u5236\u4ee5\u53ca\u826f\u597d\u7684\u517c\u5bb9\u6027\u7b49\u7279\u70b9\uff0c\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u5f00\u53d1\u4e2d\u6bd4 <code>.bin</code> \u6587\u4ef6\u66f4\u53d7\u6b22\u8fce\u3002</p> <p>\u5d4c\u5165\u5f0f--Hex\u6587\u4ef6\u603b\u7ed3\uff1aHex\u6587\u4ef6\u683c\u5f0f\uff0cHex\u6587\u4ef6\u8f6cbin\u6587\u4ef6_iar\u63d0\u51fa\u7684\u7684hex\u8f6cbin\u5de5\u5177</p> <p>Hex\u6587\u4ef6\u89e3\u6790\u7814\u7a76(\u542b\u6e90\u7801) (wuxinyou.github.io)</p> </li> </ol> <p>\u601d\u8003\u9898\uff1a</p> <ul> <li>\u4e3a\u4ec0\u4e48\u6211\u4eec\u80fd\u4ece\u4e32\u53e3\u4e0b\u8f7d\u7a0b\u5e8f\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#doto","title":"DOTO","text":"<p>MPU \u7684 bootROM \u653e\u7684\u662f\u7cfb\u7edf\u542f\u52a8\u65f6\u6240\u9700\u7684\u521d\u59cb\u5316\u4ee3\u7801\uff0c\u5f53\u7cfb\u7edf\u4e0a\u7535\u6216\u8005\u590d\u4f4d\u7684\u65f6\u5019\uff0cMPU \u4ece bootROM \u5f00\u59cb\u6267\u884c\uff0c\u6267\u884c\u4e00\u4e9b\u57fa\u672c\u7684\u521d\u59cb\u5316\uff1a\u8bbe\u7f6e\u65f6\u949f\u3001\u521d\u59cb\u5316\u5185\u5b58\u63a7\u5236\u5668\u7b49\u7b49\uff1b\u7136\u540e\u5b83\u8d1f\u8d23\u5c06\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\u52a0\u8f7d\u955c\u50cf\uff0c\u5e76\u590d\u5236\u5230 DDR \u4e2d\u3002</p> <p>\u8fd9\u91cc\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c\u90a3 MCU-STM32 \u90a3\u4fbf\u662f\u600e\u4e48\u542f\u52a8\u7684\u5462\uff1f\u4ed6\u6709\u6ca1\u6709\u50cf MPU \u90a3\u6837\u7684\u5e26\u6709 bootROM \u7684\u5462\uff1f\u5b9e\u9645\u4e0a\u662f\u6709\u7684\uff0c\u8fd9\u5c31\u4e0d\u5f97\u4e0d\u8bf4\u5230STM32\u7684\u542f\u52a8\u6a21\u5f0f\u4e86\uff0c\u5982\u4e0b\u6587\uff1a</p> <p>\u3010ARM Cortex-M\u5f00\u53d1\u5b9e\u6218\u6307\u5357(\u57fa\u7840\u7bc7)\u3011\u7b2c3\u7ae0 Cortex-M\u542f\u52a8\u6d41\u7a0b\u8be6\u89e3(GCC\u7248) - BruceOu\u7684\u535a\u5ba2</p> <p>\u6df1\u5165\u7406\u89e3MCU\u542f\u52a8\u539f\u7406 - \u77e5\u4e4e (zhihu.com)</p>"},{"location":"Complex%20issues/Complex%20issues.html#_15","title":"\u5173\u4e8e\u79fb\u690d\u8fd9\u4e2a\u6982\u5ff5","text":"<p>\u600e\u4e48\u79fb\u690d\uff01\u79fb\u690d\u5230\u4ec0\u4e48\u4e0a\u53bb\uff1f\u770bb\u7ad9\u4e0a\u7684\u90a3\u4e2a\u56fd\u5916\u7684\u89c6\u9891\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#how-to-understand-bootloader-and-uboot-and-bios-and-uefi","title":"How to understand bootloader and uboot and BIOS and UEFI","text":"<p>\u770b\u77e5\u4e4e\u4e0a\u7684\u56de\u7b54\uff1a</p> <p>DDR\u672c\u8d28\u4e0a\u662f double data rate synchronous dynamic random access memory\u3002</p> <p>\u5373 DDM SDRAM</p> <p>\u8fd9\u91cc\u5f88\u591a\u4eba\u53c8\u5bf9\u8fd9\u4e2aDRAM\u3001SRAM\u3001DDR\u53c8\u641e\u6df7\u4e86</p> <p>\u8fd9\u91cc\u6211\u4eec\u5148\u660e\u786e\u4e00\u70b9\uff0cCPU \u53ea\u80fd\u4e0e RAM \u4e2d\u7684\u6307\u4ee4\u548c\u6570\u636e\u8fdb\u884c\u4ea4\u4e92\u3002\uff08DMA\u90a3\u79cd\u9ad8\u7ea7\u7684\u4e1c\u897f\u5148\u4e0d\u7ba1\uff09\u3002</p> <p>\u9996\u5148\uff0c\u8f6f\u4ef6\u662f\u600e\u4e48\u5b58\u5230\u786c\u4ef6\u91cc\u9762\u7684\uff0c\u5b58\u597d\u4e86\u4e4b\u540e\uff0c\u8981\u662f\u6389\u7535\u5bfc\u81f4\u91cc\u9762\u7684\u7a0b\u5e8f\u4e22\u5931\u600e\u4e48\u529e\uff1f\u663e\u7136\u8981\u542f\u52a8\u786c\u4ef6\u7684\u4ee3\u7801\u5fc5\u987b\u8981\u662f\u975e\u6613\u5931\u7684\u5b58\u50a8\uff1aROM\u4e86\u3002</p> <p>\u770b\u770b\u8fd9\u91cc\uff1a</p> <p>Overview | Bootloading Basics | Adafruit Learning System</p> <p>\u8fd9\u4e2a\u7cfb\u5217\u770b\u5b8c\uff0c\u5c31\u5dee\u4e0d\u591a\u4e86\u3002\u53c8\u4e00\u6b21\u611f\u89c9\u5230\u56fd\u5185\u5916\u8d44\u6599\u7684\u5dee\u8ddd\uff0c\u56fd\u5185\u76f8\u5bf9\u8bb2\u5f97\u597d\u7684\u8d44\u6599\u90fd\u662f\u7ed9\u90a3\u4e9b\u5df2\u7ecf\u5bf9\u8fd9\u4e2a\u6982\u5ff5\u6709\u4e86\u4e00\u70b9\u8ba4\u77e5\u7684\u4eba\u770b\u7684\uff0c\u8fd9\u6837\u4ed6\u4eec\u5c31\u80fd\u5dee\u4e0d\u591a\u52c9\u5f3a\u61c2\u3002\u4f46\u662f\u56fd\u5916\u8fd9\u4e2a\u8d44\u6599\u7ed9\u4e00\u4e2a\u5c0f\u767d\u6765\u770b\uff0c\u90fd\u80fd\u660e\u767d\u8fd9\u662f\u5e72\u4ec0\u4e48\u7684\u3002</p> <p>Bootloader - Wikipedia</p> <p>\u7559\u5751 </p> <p>\u8fd9\u91cc\u8bb2\u7684\u6bd4\u8f83\u597d\u7684\u662f\uff1a</p> <p>\u3010\u86cb\u997c\u5d4c\u5165\u5f0f\u3011\u6211\u63d0\u7740\u978b\u5e26\u62ce\u81ea\u5df1\uff1f\u5d4c\u5165\u5f0f\u82af\u7247\u542f\u52a8\u8fc7\u7a0b\u5168\u89e3\u6790\uff0c\u5f7b\u5e95\u7406\u89e3bootloader</p> <p>bootloader\u5b58\u5728\u7684\u610f\u4e49\u662f\u4ec0\u4e48\uff1f) -- \u6728\u5934\u9f99\u7684\u56de\u7b54\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#what-are-board-support-packagesbsps-and-software-development-kitsdk","title":"What are Board Support Packages(BSPs), and Software Development Kit(SDK)?","text":""},{"location":"Complex%20issues/Complex%20issues.html#bsps","title":"BSPs","text":"<p>Board Support Package (BSP) Development - INTechHouse Guide - InTechHouse</p> <p>What\u2019s the Difference Between a BSP and SDK? | Electronic Design</p> <p>Board support packages (BSPs) \u662f\u4e00\u79cd \u8f6f\u4ef6\u7ec4\u4ef6(software component), \u4e3a \u64cd\u4f5c\u7cfb\u7edf \u548c \u7279\u5b9a\u7684\u8ba1\u7b97\u673a\u5f00\u53d1\u677f\u786c\u4ef6 \u4e4b\u95f4\u63d0\u4f9b\u4e00\u79cd\u63a5\u53e3, \u5e38\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d. BSP \u5305\u62ec\u5f88\u591a software elements, \u5b83\u4eec\u76f8\u4e92\u534f\u540c\u5de5\u4f5c, \u4f7f\u5f97\u64cd\u4f5c\u7cfb\u7edf\u80fd\u591f\u4e0e\u7279\u5b9a\u7684\u786c\u4ef6\u8fdb\u884c\u4ea4\u4e92. \u901a\u5e38\u60c5\u51b5\u4e0b BSP \u5305\u62ec\u5982\u4e0b\u5185\u5bb9:</p> <ul> <li> <p>Boot loader: </p> <p>Boot loader \u662f\u4e00\u6bb5\u4f53\u79ef\u6bd4\u8f83\u5c0f\u7684\u7a0b\u5e8f, \u901a\u5e38\u7528\u4e8e: </p> <ul> <li>CPU board \u786c\u4ef6\u542f\u52a8\u540e\u88c5\u8f7d OS kernel \u4ee5\u53ca\u5404\u79cd \u8f6f\u4ef6\u7ec4\u4ef6. </li> <li>\u786e\u4fdd\u6574\u4e2a\u5b89\u5168\u7684 boot \u8fc7\u7a0b. </li> <li>\u53e6\u5916, boot loader \u8fd8\u80fd\u901a\u8fc7\u7f51\u7edc\u6216\u8005\u5176\u4ed6\u63a5\u53e3\u6765\u66f4\u65b0\u786c\u4ef6\u4e0a\u7684\u539f\u6709\u7684 software image. (\u91cd\u65b0 load)</li> </ul> </li> <li> <p>Device drivers: </p> <p>\u8bbe\u5907\u9a71\u52a8 \u5141\u8bb8\u64cd\u4f5c\u7cfb\u7edf\u8bbf\u95ee\u5404\u79cd\u786c\u4ef6\u7ec4\u4ef6\uff0c\u4f8b\u5982 CPU\u3001\u5185\u5b58\u548c\u5916\u56f4\u8bbe\u5907\u3002</p> </li> <li> <p>Board-specific initialization routines:</p> <p>\u8fd9\u4e9b\u4f8b\u7a0b\u8d1f\u8d23\u914d\u7f6e\u677f\u5b50\u7684\u786c\u4ef6\uff0c\u4f8b\u5982\u8bbe\u7f6e\u5185\u5b58\u6216\u521d\u59cb\u5316\u5916\u8bbe\uff0c\u786e\u4fdd\u786c\u4ef6\u7684\u914d\u7f6e\u4f7f\u64cd\u4f5c\u7cfb\u7edf\u80fd\u591f\u6b63\u5e38\u8fd0\u884c\u3002</p> </li> </ul> <p>\u770b\u8d77\u6765\u90fd\u662f\u8bb2\u4e2a\u5927\u6982, \u6ca1\u6709\u8bb2\u51fa\u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u4e2a\u4e1c\u897f? \u8fd8\u5f15\u51fa\u4e86\u4e00\u5806\u95ee\u9898. </p> <ol> <li> <p>\u4e3a\u4ec0\u4e48 <code>uboot</code> \u7684\u542f\u52a8\u8fc7\u7a0b\u5df2\u7ecf\u521d\u59cb\u5316\u4e86\u67d0\u4e9b\u786c\u4ef6, \u4f46\u662f\u4e3a\u4ec0\u4e48\u5230 kernel \u5c42\u8fd8\u662f\u4f1a\u518d\u521d\u59cb\u5316\u4e00\u904d? \u8fdb\u4e00\u6b65, \u9a71\u52a8\u548c\u521d\u59cb\u5316\u7684\u533a\u522b\u5728\u54ea?  </p> <p>\u4e4b\u524d\u6211\u4e5f\u601d\u8003\u8fc7\u8fd9\u4e2a\u95ee\u9898, \u5f53\u65f6\u60f3\u7684\u5c31\u662f <code>uboot</code> \u8981\u52a0\u8f7d kernel \u9700\u8981\u505a\u4e00\u4e9b\u57fa\u672c\u7684\u786c\u4ef6\u51c6\u5907, \u4f46\u662f\u8fd9\u79cd\u51c6\u5907\u662f\u80fd\u7528\u5c31\u884c, \u80fd\u542f\u52a8\u5c31\u884c\u7684, \u6bd4\u5982 USB \u7b80\u5355\u521d\u59cb\u5316, \u5de5\u4f5c\u5728\u4f4e\u901f\u6a21\u5f0f\u4e0b, \u4f46\u662f\u5728 load kernel \u4e4b\u540e\u5982\u679c\u6211\u4eec\u4e0d\u5bf9\u76f8\u5173\u8bbe\u5907\u521d\u59cb\u5316, \u90a3\u8981\u7528USB \u7684\u5de5\u4f5c\u901f\u5ea6\u5c31\u4e00\u76f4\u90a3\u4e48\u6162\u4e86, \u8fd9\u663e\u7136\u662f\u8ba9\u4eba\u7684\u4f53\u9a8c\u975e\u5e38\u4e0d\u6109\u5feb, \u6240\u4ee5, \u5728 kernel \u5185\u90e8\u81ea\u7136\u5c31\u6709\u76f8\u5173\u786c\u4ef6\u7684\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4e86.</p> <p>\u5f53\u65f6\u7684\u7406\u89e3\u5982\u6b64, \u76f4\u5230\u6253\u7b97\u5f00\u59cb\u5b66\u4e60\u9a71\u52a8\u65f6, \u53d1\u73b0\u5bf9\u4e0a\u9762\u7684\u7406\u89e3\u8fd8\u662f\u6709\u4e9b\u8ff7\u7cca\u7684\u5730\u65b9, \u6211\u5bf9\u9a71\u52a8\u7684\u7406\u89e3\u597d\u50cf\u5c31\u662f\u521d\u59cb\u5316\u4e00\u6837(\u5c31\u50cf <code>xxx_init()</code> \u8fd9\u5c31\u662f\u9a71\u52a8\u4e86, MCU \u57fa\u7840\u4e0d\u592a\u624e\u5b9e...). \u518d\u770b\u5230 \u77e5\u4e4e\u7684\u4e00\u4e9b\u56de\u7b54 uboot\u542f\u52a8\u8fc7\u7a0b\u65e2\u7136\u5df2\u7ecf\u521d\u59cb\u5316\u4e86\u90e8\u5206\u786c\u4ef6\uff0c\u4e3a\u4ec0\u4e48Linux\u5185\u6838\u4e2d\u8fd8\u662f\u6709\u8fd9\u4e9b\u786c\u4ef6\u7684\u9a71\u52a8\u7a0b\u5e8f\uff1f) \u540e, \u6709\u4e86\u66f4\u65b0\u7684\u7406\u89e3.</p> <p>\u4e00\u4f4d\u7b54\u4e3b\u8bf4\u7684\u597d:</p> <p>\u9a71\u52a8\uff0c\u4e0d\u4ec5\u4ec5\u662f\u521d\u59cb\u5316\uff0c\u8fd8\u5b9e\u73b0\u4e86\u4e00\u7ec4\u63a5\u53e3\uff08\u8bfb\u3001\u5199\u3001\u6253\u5f00\u3001\u5173\u95ed\uff09\uff0c\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528\u3002</p> <p>\u5149\u521d\u59cb\u5316\u6709\u5565\u7528\uff0c\u5c31\u50cf\u4f60\u5f00\u8f66\u4e00\u6837\uff0c\u53d1\u52a8\u673a\u53d1\u52a8\u4e86\uff0c\u524d\u706f\u4eae\u4e86\uff0c\u5982\u6b64\u800c\u5df2\u3002\u9a71\u52a8\u4e0d\u4f1a\u81ea\u5df1\u6267\u884c\uff0c\u9a71\u52a8\u90fd\u662f\u88ab\u52a8\u88ab\u7a0b\u5e8f\u8c03\u7528\u3002\u5c31\u50cf\u8f66\u4e0d\u4f1a\u81ea\u5df1\u8dd1\u4e00\u6837\uff0c\u9700\u8981\u53f8\u673a\uff08\u5e94\u7528\u7a0b\u5e8f\uff09\u901a\u8fc7\u8f66\uff08\u9a71\u52a8\uff09\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u53bb\u884c\u9a76\u3001\u5012\u8f66\u3001\u5173\u7a97\u3001\u5173\u95ed\u6253\u5f00\u8f66\u706f\u3002</p> </li> </ol> <p>\u8fd8\u6709\uff0c\u5d4c\u5165\u5f0f\u5f00\u53d1\u5c97\u62db\u8058\u8001\u662f\u5728\u8bf4\u7684\u7cbe\u901auboot\u548c\u5185\u6838\u88c1\u526a\uff0c\u5230\u5e95\u662f\u88c1\u526a\u4e86\u4ec0\u4e48? </p> <p>(99+ \u5c01\u79c1\u4fe1 / 83 \u6761\u6d88\u606f) \u5982\u4f55\u5b66\u597d\u5d4c\u5165\u5f0fLinux\uff1f - \u77e5\u4e4e (zhihu.com)</p> <p>\u95ea\u5149\u5427Linux \u7684\u56de\u7b54\u53ef\u4ee5\u770b\u770b\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#uboot","title":"\u5173\u4e8euboot\u79fb\u690d","text":"<pre><code>int main(int argc, char *argv[])\n{\n    sighandler_t no_more_time;\n\n    signal(SIGALRM, no_more_time);\n    alarm(PROJECT_DEADLINE - toSec (3 * WEEK));\n\n    if (available_money &gt; available_manpower) {\n        Pay consultant to port U-Boot;\n        return 0;\n    }\n\n    Download latest U-Boot source;\n\n    Subscribe to u-boot mailing list;\n\n    if (clueless)\n        email(\"Hi, I am new to U-Boot, how do I get started?\");\n\n    while (learning) {\n        Read the README file in the top level directory;\n        Read https://www.denx.de/wiki/bin/view/DULG/Manual;\n        Read applicable doc/README.*;\n        Read the source, Luke;\n        /* find . -name \"*.[chS]\" | xargs grep -i &lt;keyword&gt; */\n    }\n\n    if (available_money &gt; toLocalCurrency ($2500))\n        Buy a BDI3000;\n    else\n        Add a lot of aggravation and time;\n\n    if (a similar board exists) {   /* hopefully... */\n        cp -a board/&lt;similar&gt; board/&lt;myboard&gt;\n        cp include/configs/&lt;similar&gt;.h include/configs/&lt;myboard&gt;.h\n    } else {\n        Create your own board support subdirectory;\n        Create your own board include/configs/&lt;myboard&gt;.h file;\n    }\n    Edit new board/&lt;myboard&gt; files\n    Edit new include/configs/&lt;myboard&gt;.h\n\n    while (!accepted) {\n        while (!running) {\n            do {\n                Add / modify source code;\n            } until (compiles);\n            Debug;\n            if (clueless)\n                email(\"Hi, I am having problems...\");\n        }\n        Send patch file to the U-Boot email list;\n        if (reasonable critiques)\n            Incorporate improvements from email list code review;\n        else\n            Defend code as written;\n    }\n\n    return 0;\n}\n\nvoid no_more_time (int sig)\n{\n      hire_a_guru();\n}\n</code></pre> <p>[Based on messages by Jerry Van Baren in the U-Boot-Users mailing list, October 2002]</p>"},{"location":"Complex%20issues/Complex%20issues.html#why-ddr-need-training","title":"Why DDR need training?","text":""},{"location":"Complex%20issues/Complex%20issues.html#uartttyserial","title":"UART\u3001TTY\u3001serial \u533a\u522b\uff1f","text":"<p>(99+ \u5c01\u79c1\u4fe1 / 83 \u6761\u6d88\u606f) printf\u662f\u600e\u4e48\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u7684\u5462\uff1f - \u77e5\u4e4e (zhihu.com)</p> <p>\u8fd9\u4e2a\u56de\u7b54\uff0c\u7ed3\u5408jyy\u8001\u5e08\u6700\u5c0fhello world \u548cpa\u4e2d\u8f93\u51fa\u5b57\u7b26\u4e32\u7684\u90a3\u90e8\u5206\u5185\u5bb9\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_16","title":"\u5b58\u50a8\u5668\u7f16\u5740~\u5b58\u50a8\u5668\u6620\u5c04","text":""},{"location":"Complex%20issues/Complex%20issues.html#introduction","title":"Introduction","text":"<p>\u5728\u5b66\u4e60\u5e95\u8f6f\u7684\u8fc7\u7a0b\u4e2d, \u4e00\u76f4\u5bf9\u4e00\u4e9b\u5b58\u50a8\u5668\u5730\u5740\u6620\u5c04\u7684\u6982\u5ff5\u6bd4\u8f83\u597d\u5947, \u800c\u4e14\u5728\u5b66\u4e60\u5404\u9886\u57df\u90fd\u9047\u5230\u4e86\u8fd9\u90e8\u5206\u7684\u77e5\u8bc6:</p> <ul> <li>\u5904\u7406\u5668\u662f\u8981\u548c\u5b58\u50a8\u5668\u548c\u5916\u8bbe\u4e00\u8d77\u534f\u540c\u5de5\u4f5c\u7684\uff0c\u4f46\u662f\u5904\u7406\u5668\u8bbf\u95ee\u7684\u5185\u5b58\u5730\u5740\u600e\u4e48\u77e5\u9053\u4ed6\u8bbf\u95ee\u7684\u662f\u54ea\u4e2a\u5b58\u50a8\u5668\u6216\u8005\u5916\u8bbe(<code>DDR</code>, <code>eMMc</code>, \u4ee5\u53ca\u5404\u79cd\u5916\u8bbe\u7684\u6620\u5c04\u7684\u5bc4\u5b58\u5668, MMIO... )?</li> <li> <p>\u8bbf\u95ee\u5730\u5740 <code>int *p = (int *)0x20000000;</code> \u7136\u540e <code>*p = ?; ? = *p;</code>. \u8fd9\u4e2a\u5730\u5740\u662f\u4ece\u54ea\u91cc\u6765\u7684? \u8c01\u5b9a\u4e49\u7684? \u600e\u4e48\u5b9a\u4e49\u7684? \u6211\u5199\u7684\u4ee3\u7801\u662f\u600e\u4e48\u4e00\u6b65\u6b65\u4ece\u8f6f\u4ef6\u7a0b\u5e8f\u5230\u5b9e\u9645\u786c\u4ef6\u4e0a\u7684? \u901a\u8fc7\u4e86\u54ea\u4e9b\u786c\u4ef6\u8bbe\u5907? \u7ecf\u5386\u4e86\u4e00\u4e2a\u600e\u6837\u7684\u6d41\u7a0b? </p> </li> <li> <p>\u5b66\u4e60 hardware boot \u7684\u65f6\u5019, \u603b\u662f\u4f1a\u770b\u5230\u7a0b\u5e8f\u901a\u8fc7\u5728\u4e00\u4e9b\u5730\u5740\u95f4\u8df3\u6765\u8df3\u53bb, \u4e3a\u4ec0\u90a3\u4e48\u8981\u8df3\u5230\u90a3\u91cc\u53bb? </p> </li> <li>....</li> </ul> <p>\u6bcf\u5f53\u9047\u5230\u7c7b\u4f3c\u95ee\u9898\u7684\u65f6\u5019, \u6211\u7684\u7b2c\u4e00\u60f3\u6cd5\u603b\u662f\u8df3\u8fc7\u53bb, \u544a\u8bc9\u81ea\u5df1\u8fd9\u53c8\u4e0d\u5f71\u54cd\u5199\u4ee3\u7801\u4e0d\u770b\u4e5f\u6ca1\u5565\u4e8b, \u4f46\u6bcf\u5f53\u60f3\u6df1\u5165\u4e86\u89e3\u7a0b\u5e8f\u5bf9\u5e94\u7684\u786c\u4ef6\u7684\u65f6\u5019, \u6211\u603b\u662f\u9003\u4e0d\u5f00\u5b83, \u800c\u4e14\u6211\u5fc3\u91cc\u603b\u662f\u618b\u7740\u4e00\u53e3\u6c14, \u8ba4\u4e3a\u81ea\u5df1\u4e0d\u77e5\u9053\u8fd9\u4e2a\u5185\u90e8\u7ec6\u8282\u8ba9\u6211\u5f88\u4e0d\u723d(\u771f\u89c9\u5f97\u8fd9\u4e60\u60ef\u4e0d\u592a\u597d...), \u56e0\u6b64\u67e5\u9605\u5404\u79cd\u8d44\u6599, \u603b\u7ed3\u81ea\u5df1\u5b66\u4e60\u5230\u7684\u76f8\u5173\u5185\u5bb9. </p>"},{"location":"Complex%20issues/Complex%20issues.html#reference","title":"Reference","text":"<p>Introduction to Memory Mapping - NerdyElectronics</p> <p>\u5b9e\u9645\u4e0a\u770b\u5b8c\u8fd9\u4e00\u7bc7\u7684\u5185\u5bb9, \u518d\u5b9e\u9645\u7ed3\u5408\u67d0\u4e00\u6b3e\u82af\u7247\u7684\u624b\u518c(\u914d\u5408\u4e00\u4e9b\u7a0b\u5e8f\u793a\u4f8b\u4ee5\u53ca Keil \u751f\u6210\u7684 map\u6587\u4ef6)\u5c31\u80fd\u7406\u89e3\u5173\u4e8e memory mapping \u7684\u5185\u5bb9\u4e86. \u6211\u4e0b\u9762\u7684\u5185\u5bb9\u5b9e\u9645\u4e0a\u4e5f\u53ea\u662f\u5bf9\u8fd9\u4e9b\u5199\u51fa\u81ea\u5df1\u7684\u7b14\u8bb0.</p>"},{"location":"Complex%20issues/Complex%20issues.html#concept-of-memory-mapping","title":"Concept of memory mapping","text":""},{"location":"Complex%20issues/Complex%20issues.html#address-space","title":"Address space","text":"<p>\u5728\u5b58\u50a8\u5668\u5382\u5546\u5236\u9020\u597d\u5b58\u50a8\u5668\u540e, \u8fd9\u5757\u5b58\u50a8\u5668\u6700\u7ec8\u662f\u8981\u548c CPU \u8fdb\u884c\u901a\u4fe1\u7684, \u4f46\u662f\u8981\u600e\u4e48\u8bbf\u95ee\u4e0d\u540c\u7c7b\u578b\u5b58\u50a8\u5668\u5c31\u6210\u4e86\u4e00\u4e2a\u95ee\u9898, \u5730\u5740\u7a7a\u95f4\u7f16\u7801\u5c31\u662f\u4e00\u4e2a\u633a\u597d\u7684\u89e3\u51b3\u529e\u6cd5. \u5730\u5740\u7a7a\u95f4\u901a\u5e38\u7531\u5904\u7406\u5668\u7684\u5730\u5740\u603b\u7ebf\u5bbd\u5ea6\u51b3\u5b9a. \u4f8b\u5982, 32\u4f4d\u5904\u7406\u5668\u901a\u5e38\u6709\u4e00\u4e2a 4GB \u7684\u5730\u5740\u7a7a\u95f4(2<sup>32</sup> Byte).</p> <p></p> <p>\u8fd9\u4e2a\u5730\u5740\u7a7a\u95f4\u7f16\u7801\u5c31\u5f88\u50cf\u4e00\u4e2a\u5de8\u5927\u7684\u4e00\u7ef4\u6570\u7ec4 <code>uint8_t a[4GB];</code>, \u6bcf\u4e2a\u6570\u7ec4\u5143\u7d20\u5bb9\u7eb3\u4e00\u4e2a byte, \u5982\u4e0a\u56fe.</p> <p>It\u2019s akin to a large array of slots, each with a unique address, where each slot can hold a byte of data.</p> <p>\u8fdb\u4e00\u6b65, \u5730\u5740\u7a7a\u95f4\u7f16\u7801\u540e\u4e4b\u540e\u4f1a\u518d\u628a\u5730\u5740\u7a7a\u95f4\u8fdb\u884c\u5206\u533a, \u7528\u4e8e\u4e0d\u540c\u7684\u5b58\u50a8\u5668\u548c\u529f\u80fd, \u6bd4\u5982\u7cfb\u7edf\u5185\u5b58, I/O \u7a7a\u95f4, \u5916\u8bbe\u63a7\u5236\u5bc4\u5b58\u5668\u548c\u5916\u90e8\u5b58\u50a8\u5668\u63a5\u53e3.</p> <p>\u8fdb\u4e00\u6b65, \u4e3a\u5404\u79cd\u8bbe\u5907\u8fdb\u884c\u5730\u5740\u5206\u914d. \u901a\u5e38\u5206\u914d\u7531\u5904\u7406\u5668\u7684\u67b6\u6784\u5b9a\u4e49, \u7531\u82af\u7247\u5382\u5546\u8bbe\u8ba1. \u4e00\u822c\u67e5\u9605\u6280\u672f\u624b\u518c\u5373\u53ef\u77e5\u9053.</p> <p>\u4e00\u4e9b\u5e38\u89c1\u7684\u5206\u914d\u65b9\u5f0f:</p> <ul> <li> <p>\u56fa\u5b9a\u6620\u5c04\u4e0e\u52a8\u6001\u6620\u5c04\uff1a</p> <p>\u5728\u8bb8\u591a\u5fae\u63a7\u5236\u5668\u4e2d\uff0c\u5185\u5b58\u6620\u5c04\u662f\u56fa\u5b9a\u7684\uff0c\u7531\u786c\u4ef6\u8bbe\u8ba1\u51b3\u5b9a\u3002\u4f46\u67d0\u4e9b\u7cfb\u7edf\u8fd8\u5141\u8bb8\u52a8\u6001\u6620\u5c04\uff0c\u5176\u4e2d\u8f6f\u4ef6\u53ef\u4ee5\u4fee\u6539\u5185\u5b58\u6620\u5c04\u7684\u67d0\u4e9b\u90e8\u5206\u3002</p> </li> <li> <p>\u5185\u5b58\u548c\u5916\u8bbe\u5206\u914d\uff1a</p> <p>\u4f8b\u5982\uff0c\u8f83\u4f4e\u7684\u5730\u5740\u53ef\u80fd\u4fdd\u7559\u7ed9\u7cfb\u7edf\u5f15\u5bfc ROM\uff0c\u7136\u540e\u662f RAM\uff0c\u7136\u540e\u662f\u7528\u4e8e\u63a7\u5236\u5916\u8bbe\u7684\u7279\u6b8a\u529f\u80fd\u5bc4\u5b58\u5668\u3002\u9ad8\u5730\u5740\u53ef\u4ee5\u4fdd\u7559\u7ed9\u5916\u90e8\u5b58\u50a8\u5668\u63a5\u53e3\u3002</p> </li> <li> <p>\u5730\u5740\u5206\u914d\u793a\u4f8b\uff1a</p> <p>\u8ba9\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u5177\u6709 32 \u4f4d\u5730\u5740\u7a7a\u95f4\u7684\u5047\u8bbe\u5fae\u63a7\u5236\u5668\u3002\u4ece 0x00000000 \u5230 0x1FFFFFFF \u7684\u5730\u5740\u53ef\u4ee5\u7528\u4e8e\u5185\u90e8 RAM\uff0c0x20000000 \u5230 0x3FFFFFFF \u7684\u5730\u5740\u7528\u4e8e\u7cfb\u7edf\u5916\u8bbe\uff0c0x40000000 \u5230 0x5FFFFFFF \u7684\u5730\u5740\u7528\u4e8e\u5916\u90e8\u5b58\u50a8\u5668\u63a5\u53e3\u3002</p> </li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#answer","title":"answer","text":"<p>\u7531\u6b64, \u6211\u53ef\u4ee5\u7b80\u5355\u56de\u7b54\u4e00\u4e0b\u6700\u5f00\u59cb\u7684\u4e00\u4e9b\u95ee\u9898\u4e86: \u901a\u8fc7\u6620\u5c04\u8bbf\u95ee\u5185\u5b58.</p> <ul> <li>\u5f53 CPU \u6267\u884c\u6d89\u53ca\u5185\u5b58\u8bbf\u95ee\u7684\u6307\u4ee4\u65f6\uff0c\u5b83\u5f15\u7528\u5185\u5b58\u6620\u5c04\u3002\u8fd9\u4e2a\u6620\u5c04\u5c31\u50cf\u4e00\u4e2a\u76ee\u5f55\uff0c\u544a\u8bc9 CPU \u6bcf\u4e2a\u5730\u5740\u6307\u5411\u54ea\u91cc\u3002</li> <li>\u5185\u5b58\u63a7\u5236\u5668\u6216\u4e13\u7528\u786c\u4ef6\u5355\u5143(\u603b\u7ebf)\u6839\u636e\u5185\u5b58\u6620\u5c04\u5bf9\u5730\u5740\u8fdb\u884c\u89e3\u7801\u3002\u5b83\u786e\u5b9a\u5730\u5740\u662f\u6307\u5411\u5185\u90e8 RAM \u4f4d\u7f6e\u3001\u5916\u8bbe register \u8fd8\u662f\u5916\u90e8\u5668\u4ef6\u3002</li> <li>\u5982\u679c\u5730\u5740\u6307\u5411\u5185\u90e8\u5b58\u50a8\u5668\uff0c\u5219\u6570\u636e\u4f20\u8f93\u975e\u5e38\u7b80\u5355\u3002\u5bf9\u4e8e\u5916\u90e8\u8bbe\u5907\uff0c\u8be5\u8fc7\u7a0b\u6d89\u53ca SPI\u3001I2C \u7b49\u901a\u4fe1\u534f\u8bae\u6216 NXP \u5fae\u63a7\u5236\u5668\u4e2d\u7684 FlexSPI \u7b49\u4e13\u7528\u63a5\u53e3\u3002</li> <li>\u5185\u5b58\u8bbf\u95ee\u4e0d\u4ec5\u4ec5\u662f\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u3002\u5b83\u8fd8\u6d89\u53ca\u5c06\u8fd9\u4e9b\u4f20\u8f93\u4e0e\u7cfb\u7edf\u7684 clock \u540c\u6b65\uff0c\u5e76\u7ba1\u7406\u8bfb/\u5199\u64cd\u4f5c\u7684\u63a7\u5236\u4fe1\u53f7\u3002</li> </ul> <p>\u5904\u7406\u5668\u8bbf\u95ee\u5b58\u50a8\u5668\u6216\u5916\u8bbe\u65f6\u4f7f\u7528\u7684\u5185\u5b58\u5730\u5740\u6620\u5c04\uff0c\u662f\u4e00\u79cd\u901a\u8fc7\u7279\u5b9a\u7684\u7f16\u7801\u89c4\u5219\u5c06\u7269\u7406\u5b58\u50a8\u5668\u5206\u914d\u5730\u5740\u7684\u884c\u4e3a\u3002\u8fd9\u4e2a\u6620\u5c04\u901a\u5e38\u7531\u786c\u4ef6\u8bbe\u8ba1\u51b3\u5b9a\uff0c\u4f8b\u5982\u5728\u5fae\u63a7\u5236\u5668\uff08MCU\uff09\u4e2d\uff0c\u5185\u5b58\u6620\u5c04\u662f\u56fa\u5b9a\u7684\uff0c\u7531\u786c\u4ef6\u8bbe\u8ba1\u51b3\u5b9a\uff0c\u4f46\u67d0\u4e9b\u7cfb\u7edf\u8fd8\u5141\u8bb8\u52a8\u6001\u6620\u5c04\uff0c\u5176\u4e2d\u8f6f\u4ef6\u53ef\u4ee5\u4fee\u6539\u5185\u5b58\u6620\u5c04\u7684\u67d0\u4e9b\u90e8\u5206\u3002</p> <p>\u5f53\u4f60\u5728\u4ee3\u7801\u4e2d\u5199 <code>int *p = (int *)0x20000000;</code> \u65f6\uff0c\u8fd9\u4e2a\u5730\u5740 <code>0x20000000</code> \u662f\u5728\u5904\u7406\u5668\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u9884\u5148\u5b9a\u4e49\u597d\u7684\uff0c\u5b83\u5bf9\u5e94\u4e8e\u67d0\u4e2a\u7279\u5b9a\u7684\u5b58\u50a8\u5668\u533a\u57df\u6216\u5916\u8bbe\u3002\u8fd9\u4e2a\u5730\u5740\u662f\u7531\u786c\u4ef6\u8bbe\u8ba1\u8005\u5b9a\u4e49\u7684\uff0c\u5e76\u4e14\u5728\u5904\u7406\u5668\u7684\u6587\u6863\u4e2d\u4f1a\u6709\u8bf4\u660e\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u80fd\u6307\u5411\u4e00\u5757\u7279\u5b9a\u7684RAM\u533a\u57df\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5916\u8bbe\u5982UART\u7684\u5bc4\u5b58\u5668\u6620\u5c04\u5730\u5740\u3002</p> <p>\u5f53\u4f60\u6267\u884c <code>*p = ?; ? = *p;</code> \u8fd9\u6837\u7684\u64cd\u4f5c\u65f6\uff0c\u5904\u7406\u5668\u901a\u8fc7\u5730\u5740\u603b\u7ebf\u53d1\u9001\u5730\u5740 <code>0x20000000</code>\uff0c\u7136\u540e\u901a\u8fc7\u6570\u636e\u603b\u7ebf\u5199\u5165\u6216\u8bfb\u53d6\u6570\u636e\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6d89\u53ca\u5230\u7684\u786c\u4ef6\u8bbe\u5907\u5305\u62ec\u5904\u7406\u5668\u7684\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff09\u3001\u5b58\u50a8\u5668\u63a5\u53e3\uff0c\u4ee5\u53ca\u53ef\u80fd\u7684\u603b\u7ebf\u63a5\u53e3\uff08\u5982AMBA AXI\u3001AHB\u3001APB\u7b49\uff09\u3002</p> <p>\u6240\u4ee5\u8bbf\u95ee\u5173\u952e\u5728\u4e8e\u603b\u7ebf\u90e8\u5206, \u5b66\u4e60 ysyx \u7684 \u603b\u7ebf\u90e8\u5206.</p> <p>\u5148\u95ee AI:</p> <p>AHB\uff08Advanced High-performance Bus\uff0c\u5148\u8fdb\u9ad8\u6027\u80fd\u603b\u7ebf\uff09\u3001APB\uff08Advanced Peripheral Bus\uff0c\u5148\u8fdb\u5916\u56f4\u603b\u7ebf\uff09\u548cAMBA\u662fARM\u516c\u53f8\u63d0\u51fa\u7684\u4e00\u7cfb\u5217\u603b\u7ebf\u67b6\u6784\u6807\u51c6\uff0c\u4e3b\u8981\u7528\u4e8e\u7247\u4e0a\u7cfb\u7edf\uff08SoC\uff09\u4e2d\u4e0d\u540c\u6a21\u5757\u95f4\u7684\u901a\u4fe1\u3002</p> <p>AHB \u603b\u7ebf\u662f\u4e00\u79cd\u9ad8\u6027\u80fd\u7684\u603b\u7ebf\uff0c\u652f\u6301\u9ad8\u65f6\u949f\u9891\u7387\u548c\u9ad8\u5e26\u5bbd\u7684\u6570\u636e\u4f20\u8f93\u3002\u5b83\u80fd\u591f\u8fde\u63a5\u9ad8\u6027\u80fd\u6a21\u5757\uff0c\u5982CPU\u3001\u9ad8\u901fRAM\u3001NAND FLASH\u3001DMA\u7b49\u3002AHB\u603b\u7ebf\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a - \u652f\u6301\u7a81\u53d1\uff08Burst\uff09\u4f20\u8f93\u3002 - \u652f\u6301\u6d41\u6c34\u7ebf\u64cd\u4f5c\u3002 - \u652f\u6301\u591a\u4e2a\u4e3b\u8bbe\u5907\u3002 - \u53ef\u914d\u7f6e\u7684\u6570\u636e\u603b\u7ebf\u5bbd\u5ea6\uff0832\u4f4d\u5230128\u4f4d\uff09\u3002 - \u652f\u6301\u5b57\u8282\u3001\u534a\u5b57\u548c\u5b57\u7684\u4f20\u8f93\u3002</p> <p>APB \u603b\u7ebf\u662f\u4e00\u79cd\u4f4e\u5e26\u5bbd\u7684\u603b\u7ebf\uff0c\u4e3b\u8981\u7528\u4e8e\u8fde\u63a5\u4f4e\u901f\u5916\u56f4\u8bbe\u5907\uff0c\u5982UART\u3001I2C\u7b49\u3002APB\u603b\u7ebf\u7684\u7279\u70b9\u5305\u62ec\uff1a - \u6bcf\u4e2a\u4f20\u8f93\u81f3\u5c11\u9700\u8981\u4e24\u4e2a\u65f6\u949f\u5468\u671f\u3002 - \u7b80\u5355\u7684\u975e\u6d41\u6c34\u7ebf\u7ed3\u6784\u3002 - \u5355\u4e3b\u8bbe\u5907\u591a\u4ece\u8bbe\u5907\uff0c\u4e3b\u8bbe\u5907\u901a\u5e38\u662fAPB\u6865\u3002</p> <p>AMBA\uff08Advanced Microcontroller Bus Architecture\uff09\u662f\u4e00\u4e2a\u603b\u7684\u6846\u67b6\uff0c\u5305\u542b\u4e86AHB\u548cAPB\u7b49\u4e0d\u540c\u7684\u603b\u7ebf\u534f\u8bae\u3002AMBA\u5b9a\u4e49\u4e86\u4e09\u79cd\u603b\u7ebf\uff1a 1. AHB\uff1a\u63d0\u4f9b\u9ad8\u541e\u5410\u91cf\u7684\u6570\u636e\u4f20\u8f93\u3002 2. APB\uff1a\u4e3a\u4f4e\u901f\u5916\u56f4\u8bbe\u5907\u8bbe\u8ba1\u3002 3. AXI\uff08Advanced eXtensible Interface\uff09\uff1a\u63d0\u4f9b\u66f4\u9ad8\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\uff0c\u652f\u6301\u70b9\u5bf9\u70b9\u8fde\u63a5\u3002</p> <p>\u5728\u5173\u7cfb\u4e0a\uff0cAHB\u548cAPB\u53ef\u4ee5\u770b\u4f5c\u662fAMBA\u603b\u7ebf\u67b6\u6784\u4e2d\u7684\u4e24\u4e2a\u5c42\u6b21\uff0cAHB\u4f5c\u4e3a\u4e3b\u603b\u7ebf\uff0c\u800cAPB\u5219\u4f5c\u4e3aAHB\u7684\u6269\u5c55\uff0c\u901a\u8fc7\u6865\u63a5\u5668\u8fde\u63a5\u5230AHB\u4e0a\uff0c\u7528\u4e8e\u8fde\u63a5\u4f4e\u901f\u5916\u8bbe\u3002\u8fd9\u6837\u7684\u5206\u5c42\u8bbe\u8ba1\u4f7f\u5f97SoC\u53ef\u4ee5\u6709\u6548\u5730\u7ba1\u7406\u4e0d\u540c\u6027\u80fd\u8981\u6c42\u7684\u6a21\u5757\u95f4\u7684\u901a\u4fe1\u3002</p> <p>\u5177\u4f53\u5230\u4ee3\u7801\u5b9e\u73b0\uff0cAHB\u548cAPB\u7684\u63a5\u53e3\u548c\u64cd\u4f5c\u65b9\u5f0f\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u4ee5\u9002\u5e94\u5b83\u4eec\u5404\u81ea\u7684\u6027\u80fd\u7279\u70b9\u548c\u4f7f\u7528\u573a\u666f\u3002\u4f8b\u5982\uff0cAHB\u53ef\u80fd\u4f1a\u6d89\u53ca\u5230\u590d\u6742\u7684\u63e1\u624b\u4fe1\u53f7\u548c\u7a81\u53d1\u4f20\u8f93\u63a7\u5236\uff0c\u800cAPB\u5219\u53ef\u80fd\u66f4\u7b80\u5355\uff0c\u53ea\u6d89\u53ca\u5230\u57fa\u672c\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p>\u4ee5\u4e0a\u4fe1\u606f\u7efc\u5408\u4e86\u591a\u4e2a\u641c\u7d22\u7ed3\u679c\uff0c\u5305\u62ec\u5bf9AHB\u548cAPB\u7684\u4ecb\u7ecd\u548c\u5bf9\u6bd4         \u3002</p> <p>\u5728\u5b66\u4e60\u786c\u4ef6\u542f\u52a8\uff08boot\uff09\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u5728\u4e0d\u540c\u7684\u5730\u5740\u95f4\u8df3\u8f6c\uff0c\u8fd9\u662f\u56e0\u4e3a\u542f\u52a8\u4ee3\u7801\u53ef\u80fd\u4f4d\u4e8e\u4e0d\u540c\u7684\u5b58\u50a8\u533a\u57df\uff0c\u5982ROM\u3001RAM\u6216\u5916\u90e8\u5b58\u50a8\u5668\u3002\u8fd9\u4e9b\u5730\u5740\u901a\u5e38\u6709\u7279\u5b9a\u7684\u529f\u80fd\u548c\u7528\u9014\uff0c\u4f8b\u5982\uff0c\u67d0\u4e9b\u5730\u5740\u53ef\u80fd\u7528\u4e8e\u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f\uff0c\u800c\u5176\u4ed6\u7684\u53ef\u80fd\u7528\u4e8e\u5b58\u50a8\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u3002</p> <p>\u5728SoC\u8bbe\u8ba1\u4e2d\uff0c\u591a\u4e2aMCU\u6216\u5904\u7406\u5668\u6838\u5fc3\u53ef\u80fd\u9700\u8981\u5171\u4eab\u8d44\u6e90\uff0c\u5982\u5185\u5b58\u3001\u5916\u8bbe\u6216\u5b58\u50a8\u5668\u3002SoC\u8bbe\u8ba1\u901a\u5e38\u91c7\u7528\u5171\u4eab\u603b\u7ebf\u67b6\u6784\u3001\u4ea4\u53c9\u5f00\u5173\u3001\u5185\u5b58\u6620\u5c04\u7b49\u673a\u5236\u6765\u5b9e\u73b0\u8d44\u6e90\u5171\u4eab\u3002</p> <p>MMU\u662f\u5b9e\u73b0\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u8f6c\u6362\u7684\u5173\u952e\u786c\u4ef6\uff0c\u5b83\u5305\u542bTLB\uff08Translation Lookaside Buffer\uff09\u548cTWU\uff08Table Walk Unit\uff09\u4e24\u4e2a\u5b50\u6a21\u5757\u3002TLB\u662f\u4e00\u4e2a\u9ad8\u901f\u7f13\u5b58\uff0c\u7528\u4e8e\u7f13\u5b58\u9875\u8868\u8f6c\u6362\u7684\u7ed3\u679c\uff0c\u800cTWU\u662f\u9875\u8868\u904d\u5386\u6a21\u5757\uff0c\u8d1f\u8d23\u67e5\u8be2\u9875\u8868\u4ee5\u5b8c\u6210\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u8f6c\u6362\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u4ece\u8f6f\u4ef6\u7a0b\u5e8f\u5230\u5b9e\u9645\u786c\u4ef6\u7684\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a 1. \u7f16\u5199\u4ee3\u7801\u65f6\uff0c\u7a0b\u5e8f\u5458\u4f7f\u7528\u903b\u8f91\u5730\u5740\u8fdb\u884c\u64cd\u4f5c\u3002 2. \u7f16\u8bd1\u5668\u5c06\u903b\u8f91\u5730\u5740\u7f16\u8bd1\u6210\u5904\u7406\u5668\u53ef\u4ee5\u7406\u89e3\u7684\u673a\u5668\u8bed\u8a00\u3002 3. \u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u548c\u5904\u7406\u5668\u7684MMU\u5c06\u903b\u8f91\u5730\u5740\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u3002 4. MMU\u901a\u8fc7\u9875\u8868\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002 5. \u7269\u7406\u5730\u5740\u901a\u8fc7\u5730\u5740\u603b\u7ebf\u53d1\u9001\u5230\u5b58\u50a8\u5668\u6216\u5916\u8bbe\u3002 6. \u6570\u636e\u901a\u8fc7\u6570\u636e\u603b\u7ebf\u8fd4\u56de\u5230\u5904\u7406\u5668\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cMMU\u8d77\u5230\u4e86\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528\uff0c\u5b83\u4e0d\u4ec5\u8d1f\u8d23\u5730\u5740\u8f6c\u6362\uff0c\u8fd8\u8d1f\u8d23\u5185\u5b58\u4fdd\u62a4\u3001\u7f13\u5b58\u7ba1\u7406\u7b49\u4efb\u52a1\u3002</p> <ul> <li> <p>Cortex-M3 I-Code,D-Code,\u7cfb\u7edf\u603b\u7ebf\u53ca\u5176\u4ed6\u603b\u7ebf\u63a5\u53e3_m3 \u7f16\u8bd1\u533a\u5206 \u5982\u4f55d\u603b\u7ebf,s\u603b\u7ebf-CSDN\u535a\u5ba2</p> <p>STM32\u4e2d\uff0cI-Code Bus\u4e0eD-Code Bus\u9ed8\u8ba4\u6620\u5c04\u52300x00000000 ~ 0x1FFFFFFF\u5185\u5b58\u5730\u5740\u6bb5\uff1bAHB\u7cfb\u7edf\u603b\u7ebf\u9ed8\u8ba4\u6620\u5c04\u52300x20000000 ~ 0xDFFFFFFF\u548c0xE0100000 ~ 0xFFFFFFFF\u4e24\u4e2a\u5185\u5b58\u5730\u5740\u6bb5\uff1bAPB\u5916\u8bbe\u603b\u7ebf\u9ed8\u8ba4\u6620\u5c04\u52300xE0040000 ~ 0xE00FFFFF\u5185\u5b58\u5730\u5740\u6bb5\uff0c\u4f46\u7531\u4e8eTPIU\u3001ETM\u4ee5\u53caROM\u8868\u5360\u7528\u90e8\u5206\u7a7a\u95f4\uff0c\u5b9e\u9645\u53ef\u7528\u5730\u5740\u533a\u95f4\u4e3a0xE0042000~0xE00FF000</p> <p>\u914d\u5408\u4e0a\u6587\u7406\u89e3.</p> </li> <li> <p>\u3010\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3011\u5b58\u50a8\u5668\u6620\u5c04\u4e0e\u5bc4\u5b58\u5668\u6620\u5c04\u539f\u7406 - \u76ae\u76ae\u7965 - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u64cd\u4f5c\u786c\u4ef6\u7684\u672c\u8d28\u5c31\u662f\u5728\u64cd\u4f5c\u5bc4\u5b58\u5668.</p> <p>\u5728\u5b58\u50a8\u5668\u6620\u5c04\u7684\u57fa\u7840\u4e4b\u4e0a(\u5212\u5206\u4e86\u5730\u5740\u7a7a\u95f4\u7528\u4e8e\u4e0d\u540c\u7684\u5b58\u50a8\u5668\u548c\u8bbe\u5907), \u901a\u8fc7\u7ed9\u5206\u914d\u597d\u7684\u5730\u5740\u7684\u7279\u6709\u529f\u80fd\u7684\u5185\u5b58\u5355\u5143\u53d6\u522b\u540d\u7684\u8fc7\u7a0b\u5373\u4e3a\u5bc4\u5b58\u5668\u6620\u5c04.</p> <ul> <li> <p>\u5177\u4f53\u4f8b\u5b501: \u7ed3\u5408 PA \u4e2d\u5404\u4e2a\u8bbe\u5907 MMIO\u6765\u7406\u89e3. </p> <ul> <li> <p>MMIO \u4f5c\u4e3a\u7b2c\u4e00\u5c42: \u4e0a\u9762\u7684\u5b58\u50a8\u5668\u6620\u5c04, \u76f4\u63a5\u901a\u8fc7\u8bbf\u95ee\u5185\u5b58\u5730\u5740\u7684\u65b9\u5f0f\u8bbf\u95ee\u786c\u4ef6\u8bbe\u5907.</p> </li> <li> <p>\u5177\u4f53\u4f8b\u5b502: GPIO \u5916\u8bbe</p> <p>\u4ee5GPIO\u5bc4\u5b58\u5668CRL\u4e3a\u4f8b\uff0c\u5148\u7ed9\u51faCRL\u5b9a\u4e49:</p> <pre><code>typedef struct\n{\n  __IO uint32_t CRL;\n  __IO uint32_t CRH;\n  __IO uint32_t IDR;\n  __IO uint32_t ODR;\n  __IO uint32_t BSRR;\n  __IO uint32_t BRR;\n  __IO uint32_t LCKR;\n} GPIO_TypeDef;\n</code></pre> <p>\u4f7f\u7528: GPIOA-&gt;CRL=0x0000 0000\u8fd9\u79cd\u5199\u6cd5, \u8868\u793a\u5c0616\u8fdb\u5236\u65700\u8d4b\u503c\u7ed9GPIOA\u7684CRL\u5bc4\u5b58\u5668\u6240\u5728\u7684\u5b58\u50a8\u5355\u5143. \u800cGPIOA-&gt;CRL\u5c31\u6784\u9020\u4e86\u4e00\u4e2a\u5bc4\u5b58\u5668\u6620\u5c04. \u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>#define PERIPH_BASE      ((uint32_t)0x40000000) \n</code></pre> <p>\u5b58\u50a8\u5668\u7ea7\u522b\u7684\u6620\u5c04\uff0c\u5c06\u5916\u8bbe\u57fa\u5730\u5740\u6620\u5c04\u52300x40000000. \u4e3a\u7b2c\u4e00\u5c42</p> <pre><code>#define APB2PERIPH_BASE       (PERIPH_BASE + 0x10000)\n</code></pre> <p>\u8fd9\u91cc\u5bf9\u5916\u8bbe\u57fa\u5730\u5740\u8fdb\u884c\u504f\u79fb\u91cf\u4e3a0x10000\u7684\u5730\u5740\u504f\u79fb\uff0c\u504f\u79fb\u5230APB2\u603b\u7ebf\u5bf9\u5e94\u5916\u8bbe\u533a\u3002</p> <pre><code>#define GPIOA_BASE            (APB2PERIPH_BASE + 0x0800)\n</code></pre> <p>\u8fd9\u91cc\u5bf9APB2\u5916\u8bbe\u57fa\u5730\u5740\u8fdb\u884c\u504f\u79fb\u91cf\u4e3a0x0800\u7684\u5730\u5740\u504f\u79fb\uff0c\u504f\u79fb\u5230GPIOA\u5bf9\u5e94\u533a\u57df\u3002</p> <pre><code>#define GPIOA               ((GPIO_TypeDef *) GPIOA_BASE)\n</code></pre> <p>\u8fd9\u91cc\u5c06GPIOA\u5b8f\u5b9a\u4e49\u4e3aGPIOA\u57fa\u5730\u5740\u7ecf\u8fc7\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u4e3a<code>GPIO_TypeDef</code>\u7684\u6307\u9488\uff0c\u8fd9\u6837\u7684\u4f5c\u7528\u662f\u4f7fGPIOA\u7ed3\u6784\u4f53\u5185\u5bf9\u5e94\u7684\u6210\u5458\u6309\u987a\u5e8f\u586b\u5145\u5185\u5b58\u533a\u57df\uff0c\u56e0\u6b64GPIOA\u7684CRL\u5bc4\u5b58\u5668\u5c31\u662f\u4f5c\u4e3aGPIOA\u57fa\u5730\u5740\u540e\u7684\u7b2c\u4e00\u4e2a\u5185\u5b58\u5757\uff0cGPIOA-&gt;CRL\u7684\u672c\u8d28\u5c31\u662f\u8fd9\u4e2a\u5185\u5b58\u5757\u7684\u5730\u5740\uff0c\u6216\u8005\u8bf4\u662f\u7528GPIOA-&gt;CRL\u7ed9\u8fd9\u4e2a\u5730\u5740\u53d6\u4e86\u4e2a\u5f62\u8c61\u7684\u522b\u540d\uff0c\u5373\u5bc4\u5b58\u5668\u6620\u5c04\u3002</p> </li> </ul> </li> </ul> </li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#isa","title":"\u4e0d\u540c ISA \u4e0b\u6709\u5173\u6808\u7684\u77e5\u8bc6","text":""},{"location":"Complex%20issues/Complex%20issues.html#_17","title":"\u57fa\u7840\u77e5\u8bc6","text":"<ul> <li>\u6808\u9876\u3001\u6808\u5e95\u7684\u5224\u65ad</li> <li>\u6808\u5e27\u7684\u6982\u5ff5 ---&gt; \u8fdb\u4e00\u6b65\u8865\u5145\u72b6\u6001\u673a\u7684</li> </ul> <p>\u770b\u4e4b\u524d\u6570\u636e\u7ed3\u6784\u7684\u7b14\u8bb0</p> <p>\u5728\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\u67b6\u6784\uff08ISA\uff09\u4e2d\uff0c\u6808\u7684\u64cd\u4f5c\u548c\u5bc4\u5b58\u5668\u4f7f\u7528\u6709\u6240\u4e0d\u540c\u3002\u4ee5\u4e0b\u662f\u4e2a\u4eba\u5173\u4e8e x86\u3001ARM\u548c RISC-V \u67b6\u6784\u4e2d\u6808\u7684\u76f8\u5173\u5185\u5bb9\u7684\u603b\u7ed3\uff1a</p>"},{"location":"Complex%20issues/Complex%20issues.html#x86","title":"x86\u67b6\u6784","text":"<ul> <li>\u76f8\u5173\u5bc4\u5b58\u5668\uff1a<code>rsp</code> \uff08register stack pointer \u6808\u9876\u5bc4\u5b58\u5668\uff08\u6808\u6307\u9488\uff09\uff0c\u6307\u5411\u6808\u9876\u5143\u7d20\uff09\uff0c<code>rbp</code> register base pointer\uff08\u6808\u5e27\u6307\u9488\uff09\uff0c\u6307\u5411\u5f53\u524d\u6808\u5e27\u7684\u6808\u5e95\u5730\u5740</li> <li>\u5165\u6808\u6307\u4ee4\uff1a<code>push</code></li> <li>\u51fa\u6808\u6307\u4ee4\uff1a<code>pop</code></li> <li>\u6808\u7684\u589e\u957f\u65b9\u5411\uff1a\u5411\u4e0b\u589e\u957f\uff08\u5373\u5730\u5740\u51cf\u5c0f\uff09</li> <li>\u6808\u5e27\uff1a\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u4f1a\u5728\u6808\u4e0a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6808\u5e27\u3002\u6808\u5e27\u901a\u5e38\u5305\u62ec\u8fd4\u56de\u5730\u5740\u3001\u53c2\u6570\u3001\u5c40\u90e8\u53d8\u91cf\u548c\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u503c\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#arm","title":"ARM\u67b6\u6784","text":"<ul> <li>\u76f8\u5173\u5bc4\u5b58\u5668\uff1a<code>sp</code>\uff08\u6808\u6307\u9488\uff0c\u6307\u5411\u5373\u5c06\u5165\u6808\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\uff09\uff0c<code>lr</code>\uff08\u94fe\u63a5\u5bc4\u5b58\u5668\uff0c\u5b58\u50a8\u8fd4\u56de\u5730\u5740\uff09</li> <li>\u5165\u6808\u6307\u4ee4\uff1a<code>stmfd</code>\uff08Store Multiple Full Descending\uff09\u3001<code>stmdb</code>\uff08Store Multiple Full Descending with Base register write-back\uff09</li> <li>\u51fa\u6808\u6307\u4ee4\uff1a<code>ldmfd</code>\uff08Load Multiple Full Descending\uff09\u3001<code>ldmdb</code>\uff08Load Multiple Full Descending with Base register write-back\uff09</li> <li>\u6808\u7684\u589e\u957f\u65b9\u5411\uff1a\u5411\u4e0b\u589e\u957f</li> <li>\u6808\u5e27\uff1aARM\u67b6\u6784\u4e2d\uff0c\u6808\u5e27\u7684\u5efa\u7acb\u548c\u9500\u6bc1\u901a\u5e38\u901a\u8fc7<code>stmdb</code>\u548c<code>ldmfd</code>\u6307\u4ee4\u6765\u5b8c\u6210\uff0c\u8fd9\u4e9b\u6307\u4ee4\u53ef\u4ee5\u540c\u65f6\u5b8c\u6210\u591a\u4e2a\u5bc4\u5b58\u5668\u7684\u5165\u6808\u548c\u51fa\u6808\u64cd\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u66f4\u65b0\u6808\u6307\u9488<code>sp</code>\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#risc-v","title":"RISC-V\u67b6\u6784","text":"<ul> <li>\u76f8\u5173\u5bc4\u5b58\u5668\uff1a<code>sp</code>\uff08\u6808\u6307\u9488\uff0c\u6307\u5411\u6808\u9876\uff09\u3001<code>fp</code>\uff08\u6808\u5e27\u6307\u9488\uff0c\u5982\u679c\u542f\u7528\uff0c\u90a3\u5c31\u662f\u6808\u5e95\uff09</li> <li>\u5165\u6808\u6307\u4ee4\uff1a<code>sw</code>\uff08Store Word\uff09\uff0c<code>sd</code>\uff08Store Double\uff09</li> <li>\u51fa\u6808\u6307\u4ee4\uff1a<code>lw</code>\uff08Load Word\uff09\uff0c<code>ld</code>\uff08Load Double\uff09</li> <li>\u6808\u7684\u589e\u957f\u65b9\u5411\uff1a\u5411\u4e0b\u589e\u957f</li> <li>\u6808\u5e27\uff1aRISC-V\u4e2d\uff0c\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u5982\u679c\u9700\u8981\u4fdd\u5b58\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u4f1a\u4f7f\u7528<code>addi</code>\u6307\u4ee4\u8c03\u6574<code>sp</code>\uff0c\u7136\u540e\u4f7f\u7528<code>sw</code>\u6307\u4ee4\u4fdd\u5b58\u5bc4\u5b58\u5668\u503c\u3002\u6062\u590d\u65f6\u4f7f\u7528<code>lw</code>\u6307\u4ee4\u3002</li> </ul>"},{"location":"Complex%20issues/Complex%20issues.html#_18","title":"\u6a21\u62df\u6808\u64cd\u4f5c\u7684\u6c47\u7f16\u7a0b\u5e8f","text":"<p>\u5728\u4e0d\u540c\u7684ISA\u5e73\u53f0\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7b80\u5355\u7684\u6c47\u7f16\u7a0b\u5e8f\u6765\u6a21\u62df\u6808\u64cd\u4f5c\uff1a</p> <p>x86\u6c47\u7f16\uff1a <pre><code>section .bss\nstack resb 16          ; \u9884\u755916\u5b57\u8282\u7684\u6808\u7a7a\u95f4\n\nsection .text\nglobal _start\n\n_start:\n    mov eax, 0x1234     ; \u5c06\u503c0x1234\u653e\u5165eax\u5bc4\u5b58\u5668\n    push eax            ; \u5c06eax\u7684\u503c\u538b\u5165\u6808\u4e2d\n    mov eax, 0x5678     ; \u5c06\u503c0x5678\u653e\u5165eax\u5bc4\u5b58\u5668\n    push eax            ; \u5c06eax\u7684\u503c\u538b\u5165\u6808\u4e2d\n    pop ebx             ; \u5c06\u6808\u9876\u503c\u5f39\u51fa\u5230ebx\u5bc4\u5b58\u5668\n    pop ecx             ; \u5c06\u6808\u9876\u503c\u5f39\u51fa\u5230ecx\u5bc4\u5b58\u5668\n    ; \u6b64\u65f6ebx = 0x5678, ecx = 0x1234\n    ; \u63a5\u4e0b\u6765\u662f\u9000\u51fa\u7a0b\u5e8f\u7684\u4ee3\u7801...\n</code></pre></p> <p>ARM\u6c47\u7f16\uff1a <pre><code>.text\n.global _start\n_start:\n    ldr r0, =0x1234    ; \u5c06\u503c0x1234\u52a0\u8f7d\u5230r0\u5bc4\u5b58\u5668\n    push {r0}          ; \u5c06r0\u7684\u503c\u538b\u5165\u6808\u4e2d\n    ldr r0, =0x5678    ; \u5c06\u503c0x5678\u52a0\u8f7d\u5230r0\u5bc4\u5b58\u5668\n    push {r0}          ; \u5c06r0\u7684\u503c\u538b\u5165\u6808\u4e2d\n    pop {r1}           ; \u5c06\u6808\u9876\u503c\u5f39\u51fa\u5230r1\u5bc4\u5b58\u5668\n    pop {r2}           ; \u5c06\u6808\u9876\u503c\u5f39\u51fa\u5230r2\u5bc4\u5b58\u5668\n    ; \u6b64\u65f6r1 = 0x5678, r2 = 0x1234\n    ; \u63a5\u4e0b\u6765\u662f\u9000\u51fa\u7a0b\u5e8f\u7684\u4ee3\u7801...\n</code></pre></p> <p>RISC-V\u6c47\u7f16\uff1a <pre><code>.section .text\n.globl _start\n\n_start:\n    li a0, 0x1234      ; \u5c06\u503c0x1234\u52a0\u8f7d\u5230a0\u5bc4\u5b58\u5668\n    sd a0, -16(sp)      ; \u5c06a0\u7684\u503c\u538b\u5165\u6808\u4e2d\uff0csp\u51cf\u53bb8\uff08\u56e0\u4e3asd\u662f\u53cc\u5b57\uff0c64\u4f4d\uff09\n    li a0, 0x5678      ; \u5c06\u503c0x5678\u52a0\u8f7d\u5230a0\u5bc4\u5b58\u5668\n    sd a0, -16(sp)      ; \u5c06a0\u7684\u503c\u538b\u5165\u6808\u4e2d\n    lw a1, 16(sp)       ; \u5c06\u6808\u9876\u503c\u52a0\u8f7d\u5230a1\u5bc4\u5b58\u5668\n    lw a2, 8(sp)        ; \u5c06\u4e0b\u4e00\u4e2a\u6808\u9876\u503c\u52a0\u8f7d\u5230a2\u5bc4\u5b58\u5668\n    ; \u6b64\u65f6a1 = 0x5678, a2 = 0x1234\n    ; \u63a5\u4e0b\u6765\u662f\u9000\u51fa\u7a0b\u5e8f\u7684\u4ee3\u7801...\n</code></pre></p> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u793a\u4f8b\u7a0b\u5e8f\u9700\u8981\u6839\u636e\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u548c\u5de5\u5177\u94fe\u8fdb\u884c\u9002\u5f53\u7684\u8c03\u6574\u624d\u80fd\u8fd0\u884c\u3002</p> <p>TODO</p>"},{"location":"Complex%20issues/Complex%20issues.html#other","title":"other","text":""},{"location":"Complex%20issues/Complex%20issues.html#-","title":"\u5173\u4e8e\u82af\u7247\u5b57\u957f\u548c\u5730\u5740 ---&gt; \u5730\u5740\u6620\u5c04","text":"<ul> <li>\u4e00\u4e2a16\u4f4d\u5b57\u957f\u7684\u82af\u7247\uff0cCPU\u53d1\u4e00\u4e2a\u5730\u5740\u7ed9\u5185\u5b58\u8fc7\u53bb\u540e\uff0c\u5185\u5b58\u4f1a\u8fd4\u56de2\u4e2a\u5b57\u8282\u7684\u6570\u636e\u3002\u8fd9\u662f\u56e0\u4e3a\u572816\u4f4d\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u5730\u5740\u5355\u5143\u53ef\u4ee5\u5b58\u50a82\u4e2a\u5b57\u8282\u7684\u6570\u636e\u3002CPU\u5728\u8bfb\u53d6\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u5730\u5740\u7ebf\u53d1\u9001\u7684\u5730\u5740\u6765\u83b7\u53d6\u5bf9\u5e94\u5730\u5740\u5355\u5143\u4e2d\u7684\u6570\u636e\uff0c\u6bcf\u6b21\u8bfb\u53d6\u4e00\u4e2a\u5730\u5740\u5355\u5143\u7684\u6570\u636e\uff0c\u53732\u4e2a\u5b57\u8282\u3002</li> <li>\u5728CPU\u5c42\u9762\u4e0a\uff0c\u4e00\u4e2a\u5b57\u8282\u901a\u5e38\u4f5c\u4e3a\u4e00\u4e2a\u5b58\u50a8\u5355\u5143\uff0c\u5373\u6700\u5c0f\u7684\u53ef\u5bfb\u5740\u5185\u5b58\u5355\u5143\u3002\u5f53CPU\u53d1\u51fa\u4e00\u4e2a\u5730\u5740\u65f6\uff0c\u5185\u5b58\u6761\u4f1a\u8fd4\u56de\u8be5\u5730\u5740\u5355\u5143\u4e2d\u7684\u6570\u636e\uff0c\u5305\u62ec1\u4e2a\u5b57\u8282\u6216\u591a\u4e2a\u5b57\u8282\uff0c\u53d6\u51b3\u4e8e\u7cfb\u7edf\u7684\u5b57\u957f\u548c\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\u3002</li> </ul> <p>\u5f53CPU\u8fde\u7eed\u53d1\u51fa\u591a\u4e2a\u5730\u5740\u65f6\uff0c\u6bcf\u6b21\u53d1\u51fa\u7684\u5730\u5740\u5bf9\u5e94\u7684\u6570\u636e\u662f\u4e0d\u540c\u7684\u3002\u4f8b\u5982\uff0c\u5f53CPU\u5148\u53d1\u51fa\u5730\u57400x0\u83b7\u53d6\u6570\u636e\u540e\uff0c\u518d\u53d1\u51fa\u5730\u57400x1\u83b7\u53d6\u6570\u636e\u65f6\uff0c\u8fd9\u4e24\u6b21\u83b7\u53d6\u7684\u6570\u636e\u662f\u4e0d\u540c\u7684\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u5730\u5740\u5bf9\u5e94\u4e0d\u540c\u7684\u6570\u636e\u3002\u7cfb\u7edf\u4f1a\u6839\u636e\u5730\u5740\u7ebf\u53d1\u9001\u7684\u5730\u5740\u6765\u83b7\u53d6\u76f8\u5e94\u7684\u6570\u636e\uff0c\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u6570\u636e\u51b2\u7a81\uff0c\u7cfb\u7edf\u4f1a\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u5730\u5740-\u6570\u636e\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u6839\u636eCPU\u53d1\u51fa\u7684\u5730\u5740\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u3002CPU\u548c\u5185\u5b58\u4e4b\u95f4\u4f1a\u901a\u8fc7\u603b\u7ebf\u8fdb\u884c\u901a\u4fe1\uff0c\u5e76\u5728\u603b\u7ebf\u534f\u8bae\u4e2d\u89c4\u5b9a\u5982\u4f55\u6b63\u786e\u5904\u7406\u5730\u5740\u548c\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u7684\u51c6\u786e\u6027\u548c\u4e00\u81f4\u6027\u3002</p> <p>\u5728\u82af\u7247\u901a\u4fe1\u4e2d\uff0cCPU\u53d1\u51fa\u7684\u5730\u5740\u7ebf\u548c\u5185\u5b58\u6761\u82af\u7247\u7684\u5730\u5740\u7ebf\u901a\u5e38\u4e0d\u4f1a\u76f4\u63a5\u76f8\u8fde\u3002\u901a\u5e38\u4f1a\u901a\u8fc7\u603b\u7ebf\uff08\u5982\u6570\u636e\u603b\u7ebf\u3001\u5730\u5740\u603b\u7ebf\u3001\u63a7\u5236\u603b\u7ebf\uff09\u6765\u8fdb\u884c\u901a\u4fe1\u3002CPU\u901a\u8fc7\u5730\u5740\u7ebf\u53d1\u9001\u5730\u5740\u4fe1\u606f\uff0c\u5185\u5b58\u6761\u82af\u7247\u6839\u636e\u63a5\u6536\u5230\u7684\u5730\u5740\u4fe1\u606f\u8fd4\u56de\u76f8\u5e94\u7684\u6570\u636e\u3002</p> <p>\u53cd\u4f8b\u5982\u4e0a\uff01</p> <p>\u5173\u4e8e\u5b57\u8282\u548c\u82af\u7247\u5b57\u8282\u7684\u5173\u7cfb</p> <p>\u8fd9\u91cc\u8fd8\u53ef\u4ee5\u770b\u770b\u5173\u4e8e\u6f58\u6c38\u96c4\u8001\u5e08\u7684\u6570\u7535\u6559\u6750\u3002\u5728\u7ec4\u5408\u903b\u8f91\u7535\u8def\u7684\u5b58\u50a8\u90a3\u4e00\u8282\uff1f</p> <p>\u4f60\u5bf9C\u8bed\u8a00\u7c7b\u578b\u7684\u4f7f\u7528\uff0c\u591f\u5730\u9053\u5417\uff1f_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"Complex%20issues/Complex%20issues.html#cpu_1","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u5185\u5b58\u5bf9\u9f50\u8fd9\u4e2a\u4e1c\u897f\uff1f\u2014\u2014\u501f\u52a9\u5185\u5b58\u548c CPU \u7684\u53d1\u5c55\u8fc7\u7a0b","text":"<p>\u5148\u660e\u767d\u4e00\u4e9b\u89c2\u70b9\uff0c\u8fd9\u91cc\u8ba8\u8bba\u7684\u662f\u5173\u4e8e\u7f16\u7a0b\u8bed\u8a00\u5c42\u9762\u7684\u5185\u5b58\u5bf9\u9f50\u89c4\u5219\u3002</p> <p>\u90a3\u4e5f\u5c31\u662f\u8bf4\u4e3a\u4ec0\u4e48\u4f1a\u8bbe\u8ba1\u51fa\u8fd9\u4e2a\u89c4\u5219\uff0c\u5177\u4f53\u5f97\u4e86\u89e3 CPU \u548c\u5185\u5b58\u4e4b\u95f4\u4ea4\u4e92\u7684\u786c\u4ef6\u8bbe\u8ba1\u624d\u77e5\u9053\u3002\u6240\u4ee5\uff0c\u4e0b\u9762 b \u7ad9 up \u4e3b\u7b80\u5355\u4ecb\u7ecd\u4e86\uff1a</p> <p>\u4ee5 32 \u4f4d OS \u4e3a\u4f8b\uff0c\u4e0d\u540c\u7684\u786c\u4ef6\u5173\u4e8e\u5185\u5b58\u5bf9\u9f50\u6709\u5dee\u5f02\u3002</p> <p>\u7f16\u7a0b\u8bed\u8a00\u5c42\u9762\uff1a</p> <p></p> <p>\u5982\u679c\u5185\u5b58\u4e0d\u5bf9\u9f50\uff0c\u90a3 CPU \u7684\u8bbf\u95ee \u5185\u5b58/\u7f13\u5b58 \u5c31\u9700\u8981\u4e24\u6b21\u8bbf\u95ee\u62fc\u63a5\u3002</p> <p></p> <p>\u5177\u4f53\u786c\u4ef6\u8bbe\u8ba1\uff1a</p> <p>\u56e0\u4e3a\u5185\u5b58\u6761\u7684\u8bbe\u8ba1\uff0c\u6240\u4ee5\u8bbe\u8ba1\u4e86\u5185\u5b58\u5bf9\u9f50\u89c4\u5219\u3002\uff08\u786c\u4ef6\u8bbe\u8ba1\u4e0e\u8f6f\u4ef6\u76f8\u914d\u5408\uff09</p> <p>\u9996\u5148\u770b\u770b\u7b80\u5355\u7684\u5185\u5b58\u6761\u7684\u7ed3\u6784\uff1a</p> <p></p> <p></p> <p></p> <p></p> <p>\u4e00\u4e2a chip\uff0c8 \u4e2a bank/array\u3002\u6bcf\u6b21\u90fd\u4ecearray\u91cc\u8bfb\u53d6\u4e00\u4e2abit\u51fa\u6765\uff0c\u7b97\u51fa\u6765\u5c31\u662f\u4e00\u4e2abyte\u4e86\u3002\u518d\u52a0\u4e0a\u6709\u56db\u4e2a chip  \uff0c\u90a3\u5c31\u662f 4byte</p> <p></p> <p></p> <p></p> <p>\u5730\u5740\u603b\u7ebf\u4f4d\u6570\u4e0d\u591f\u591a\uff08\u6027\u80fd\u4e0e\u6570\u91cf\u7684\u5e73\u8861\uff09-&gt; </p> <p>\u53ea\u80fd\u540c\u65f6\u8bbf\u95ee 32 \u4e2a\u201c\u76f8\u5bf9\u5730\u5740\u201d\u76f8\u540c\u7684\u6570\u636e\u4f4d -&gt;</p> <p>\u53ea\u80fd\u4ece\u88ab 4 \u6574\u9664\u7684\u5730\u5740\u5f00\u59cb\u8bbf\u95ee\u63a5\u4e0b\u6765\u7684\u56db\u4e2a\u5b57\u8282 -&gt;</p> <p>\u5c3d\u91cf\u8ba9\u6570\u636e\u4e00\u6b21\u5c31\u80fd\u8bfb\u53d6\u5b8c\u6210\uff08\u901f\u5ea6\u5feb\u597d\u554a\uff09-&gt;</p> <p>\u8bbe\u7f6e\u4e86\u5185\u5b58\u5bf9\u9f50\u7684\u89c4\u5219</p> <p>\u603b\u7ed3\uff1a\u5185\u5b58\u5bf9\u9f50\u7684\u76f4\u63a5\u539f\u56e0\uff1a\u4e3a\u4e86\u66f4\u9ad8\u7684\u8bbf\u95ee\u6548\u7387\u3001\u66f4\u597d\u7684\u7f13\u5b58\u4f18\u5316\u3002</p> <p>\u6839\u672c\u539f\u56e0\uff1a\u5bf9\u5f53\u524d\u56e0\u5730\u5740\u603b\u7ebf\u9650\u5236\u5bfc\u81f4\u7684\u5185\u5b58\u5bfb\u5740\u201c\u4e0d\u81ea\u7531\u201d\u7684\u4e00\u79cd\u59a5\u534f\u3002</p> <p>\u5c31\u662f\u4e3a\u4e86\u914d\u5408\u786c\u4ef6\uff0c\u786c\u4ef6\u8bbe\u8ba1\u53d8\u7b80\u5355\uff0c\u6548\u7387\u4e5f\u9ad8\uff1b\u6216\u8005\u8bf4\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u5229\u7528\u5e76\u884c\u7684\u4f18\u52bf\u3002</p> <ul> <li> <p>\u989d\u5916\u8865\u5145\uff1a</p> <p>\u7f13\u5b58\u4e0d\u5bf9\u9f50\u7684\u65f6\u5019\uff0cCPU \u5185\u90e8\u4e5f\u662f\u8981\u8fdb\u884c\u62fc\u63a5\u64cd\u4f5c\u7684\uff08\u56e0\u4e3a\u5c31\u662f\u4eceDDR\u4e2d\u642c\u7684\uff09\u3002</p> <p>CPU (\u5bc4\u5b58\u5668) \u662f\u548c\u7f13\u5b58\u6253\u4ea4\u9053\u3002</p> <p></p> </li> </ul> <p>\u7ecf\u8fc7\u4e0a\u9762 b \u7ad9 up \u4e3b\u7684\u8bb2\u89e3\uff0c\u4e2a\u4eba\u603b\u7ed3\u3002</p> <p>\u9996\u5148\u4ece\u5f00\u59cb\u8bbe\u8ba1</p> <p>\u8ba1\u7b97\u673a\u4e2d\u6bcf\u4e2a\u6a21\u5757\u5e76\u975e\u72ec\u7acb\u5de5\u4f5c, \u4e0d\u540c\u7684\u6a21\u5757\u4e4b\u95f4\u9700\u8981\u8fdb\u884c\u6570\u636e\u4ea4\u6362: CPU\u548c\u5185\u5b58\u63a7\u5236\u5668\u4e4b\u95f4, \u5185\u5b58\u63a7\u5236\u5668\u548c\u5185\u5b58\u9897\u7c92\u4e4b\u95f4, \u53d6\u6307\u5355\u5143\u548c\u8bd1\u7801\u5355\u5143\u4e4b\u95f4\u7b49\u7b49,\u90fd\u9700\u8981\u901a\u8fc7\u4e00\u5957\u7ea6\u5b9a\u7684\u534f\u8bae\u8fdb\u884c\u901a\u4fe1. \u8f6f\u4ef6\u540c\u6837\u5982\u6b64, \u5728\u6211\u4eec\u4f7f\u7528\u7684 DiffTest \u4e2d, NEMU\u9700\u8981\u4e0eSpike\u901a\u4fe1, NPC\u4e5f\u9700\u8981\u4e0eNEMU\u901a\u4fe1\u624d\u80fd\u5b9e\u73b0\u76f8\u5e94\u7684\u529f\u80fd.</p> <p>\u7559\u5751\uff1a\u8fd9\u91cc\u5728\u5b8c\u6210\u4e86 ysyx \u7684\u603b\u7ebf\u90e8\u5206\u518d\u56de\u6765\u8bbe\u8ba1\u770b\u770b\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#cache-store-buffer","title":"cache \u548c \u5bc4\u5b58\u5668\u4e4b\u95f4\u8fd8\u6709\u4e00\u5c42store buffer","text":""},{"location":"Complex%20issues/Complex%20issues.html#_19","title":"[\u5982\u4f55\u7406\u89e3\uff1a\u7a0b\u5e8f\u3001\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u534f\u7a0b\uff1f]","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684\u56de\u7b54\uff1a</p> <p>\u7a0b\u5e8f\u662f\u9759\u6001\u7684\uff0c\u6ca1\u6709\u88ab\u8fd0\u884c\uff0c\u800c\u8fdb\u7a0b\u662f\u52a8\u6001\u7684\uff0c\u662f\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u6b63\u5728\u6267\u884c\u7684\u7a0b\u5e8f\uff0c\u5b83\u5177\u6709\u4e00\u4e9b\u7a0b\u5e8f\u4e0d\u5177\u6709\u7684\u52a8\u6001\u7684\u7279\u70b9\uff0c\u8b6c\u5982\u5f53\u524d\u7684\u5806\u6808\u72b6\u6001\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\u7b49\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709\u7ebf\u7a0b\uff1f\u56e0\u4e3a\u8fdb\u7a0b\u88ab\u8bbe\u8ba1\u6210\u5177\u6709\u72ec\u7acb\u7684\u5185\u5b58\u5730\u5740\u7a7a\u95f4\uff08\u5185\u6838\u7684\u672c\u8d28\u4f5c\u7528\u4e4b\u4e00\u5c31\u662fisolation\uff09\uff0c\u6240\u4ee5\u6bcf\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u5c31\u8981\u5206\u914d\u65b0\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u800c\u5728\u5b9e\u9645\u4e2d\u6211\u4eec\u5e38\u5e38\u9700\u8981\u591a\u4e2a\u5e76\u53d1\u7684\u6267\u884c\u5b9e\u4f53\u5171\u4eab\u4e00\u4e9b\u6570\u636e\u5e76\u884c\u5b9e\u73b0\u534f\u4f5c\uff0c\u6240\u4ee5\u5c31\u6709\u4e86\u4e00\u79cd\u66f4\u8f7b\u91cf\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u662f\u5171\u4eab\u5185\u5b58\uff08\u548cpage table\uff09\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u65b9\u4fbf\u4ed6\u4eec\u5728\u5404\u81ea\u72ec\u7acb\u5de5\u4f5c\u7684\u65f6\u5019\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u6765\u534f\u4f5c\u3002</p> <p>\u5e76\u53d1\uff08concurrency\uff09\u548c\u5e76\u884c\uff08parallelism\uff09\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u4f7f\u7528\u7684\u4e0a\u4e0b\u6587\u548c\u540d\u8bcd\u7684connotation\u4e0d\u592a\u4e00\u6837\u3002Concurrency\u4e00\u822c\u5f3a\u8c03\u7684\u662f\u7ebf\u7a0b\u4e4b\u95f4\u7684\u4ea4\u4e92\uff08\u540c\u65f6\u505a\u591a\u4e2a\u4e0d\u540c\u7684\u4e8b\u60c5\uff09\uff0c\u8b6c\u5982\u5982\u4f55\u540c\u6b65\u4e0d\u540c\u7684\u6267\u884c\u5355\u5143\uff0cconcurrency\u5f80\u5f80\u548c\u4e00\u81f4\u6027\u3001protocol\u6709\u5173\u3002Parallelism\u5e38\u5e38\u88ab\u52a8\u8bcd\u5316\uff08Parallelize\uff09\uff0c\u4f7f\u7528\u7684\u4e0a\u4e0b\u6587\u4e00\u822c\u662f\uff1a\u5982\u4f55parallelize\u4e00\u4e2a\u7b97\u6cd5\u3001\u4e00\u4e2a\u5faa\u73af\uff08\u5c06\u4e00\u4e2a\u4efb\u52a1\u5e76\u884c\u5316\u4ece\u800c\u6700\u5feb\u901f\u5730\u5b8c\u6210\u5b83\uff09\u7b49\u7b49\uff0c\u5f80\u5f80\u548cdependence graph\u6709\u5173\uff0c\u5206\u6790\u4f9d\u8d56\u5173\u7cfb\uff0c\u4ece\u800c\u5e76\u884c\u5316\u3002</p> <p>\u9ad8\u5e76\u53d1\u5f80\u5f80\u610f\u5473\u7740\u9700\u8981\u7684\u7ebf\u7a0b\u7279\u522b\u7279\u522b\u591a\uff0c\u8fdc\u591a\u4e8eCPU\u7684\u6838\u5fc3\u6570\uff0c\u5f80\u5f80\u548c\u534f\u7a0b\u6216\u8005\u7528\u6237\u6001\u7ebf\u7a0b\u6709\u5173\u3002\u4e3a\u4ec0\u4e48\uff1f\u56e0\u4e3a\u5728\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u5207\u6362\u7684\u5f00\u9500\u5c31\u4f1a\u683c\u5916\u660e\u663e\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u4f18\u5316\u6765\u964d\u4f4e\u8fd9\u79cd\u5f00\u9500\u3002</p> <p>\u60f3\u60f3\u8fdb\u7a0b\u662f\u600e\u4e48\u63d0\u51fa\u6765\u7684\uff0c\u5176\u5b9e\u662f\u4f9d\u6258\u4e8e\u591a\u9053\u7a0b\u5e8f\u3001\u865a\u62df\u5730\u5740\u76f8\u5173\u7684\u5185\u5bb9\u3002</p> <p></p> <p></p> <p>\u5f88\u597d\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u662f\u90a3\u79cd\u76f4\u63a5\u80cc\u516b\u80a1\u7684\u3002</p> <p>\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u5148\u660e\u786e\u4e00\u4e2a\u8ba4\u77e5\uff0c\u5f88\u591a\u65f6\u5019\u5728\u8bb2\u89e3\u6982\u5ff5\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u5728\u4ecb\u7ecd\u4e00\u79cd\u5b9e\u73b0\uff0c\u4f46\u4e5f\u53ea\u662f\u4e00\u79cd\u662f\u5b9e\u73b0\u3002</p> <p>\u590f\u865e\u658c\u4e00\u79cd\u81ea\u7136\u5bfc\u51fa\u7684OS\u6559\u5b66\u65b9\u6cd5-\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u7bc7</p> <p>\u73b0\u4ee3\u5e94\u7528\u7ea7\u7684\u9700\u6c42\uff08\u6216\u8005\u522b\u8bf4\u73b0\u4ee3\u4e86\uff0c\u81ea\u4ece2005\u5e74\u524d\u540eintel\u63a8\u51fa\u591a\u6838\u5904\u7406\u5668\u5c31\u6709\u4e86\uff09\uff1a\u8981\u4f7f\u7528\u591a\u4e2aCPU\u6838\u3001\u5171\u4eab\u8d44\u6e90\uff08\u5185\u5b58\u3001\u6253\u5f00\u7684\u6587\u4ef6\u3001\u7f51\u7edc...\uff09\uff0c\u56e0\u4e3a\u5185\u5b58\u7a7a\u95f4\u548cCPU\u72b6\u6001\u662f\u4e0d\u540c\u7684\u4e1c\u897f\uff0c\u53ef\u4ee5\u89e3\u8026  --&gt; \u63d0\u51fa\u7ebf\u7a0b</p> <p></p>"},{"location":"Complex%20issues/Complex%20issues.html#_20","title":"\u5e76\u53d1\u3001\u5e76\u884c\u3001\u9ad8\u5e76\u53d1","text":""},{"location":"Complex%20issues/Complex%20issues.html#_21","title":"\u4e3a\u4ec0\u4e48\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\uff1f\u94fe\u8868\u548c\u987a\u5e8f\u8868 \u7684\u6309\u503c\u67e5\u627e\u63d2\u5165\u64cd\u4f5c\u8c01\u66f4\u5feb\u4e00\u70b9","text":"<p>\u4e4b\u540e\u7684\u6309\u7167\u8ba1\u7b97\u673a\u7cfb\u7edf\uff08\u64cd\u4f5c\u7cfb\u7edf\u3001\u5e95\u5c42\u786c\u4ef6\u3001\u4e0a\u5c42\u3001\u7f16\u8bd1\u539f\u7406\u3001\u5185\u5b58/cache\u7b49\u7b49\uff09\u7684\u89c6\u89d2\u601d\u8003\u4e4b\u540e\uff0c\u7531\u7cfb\u7edf\u7684\u5404\u4e2a\u56e0\u7d20\u6765\u5f71\u54cd\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0d\u5355\u5355\u4ece\u4e00\u4e2a\u65b9\u9762\u5c31\u80fd\u56de\u7b54\u51fa\u6bd4\u8f83\u6ee1\u610f\u7684\u7b54\u6848\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#4096","title":"\u4e3a\u4ec0\u4e48\u5f88\u591a\u65f6\u5019\u8bfb\u6587\u4ef6\u76f4\u63a5\u8bfb4096\u4e2a\u5b57\u7b26\uff1f","text":"<p>\u5728C/C++\u7f16\u7a0b\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u9009\u62e9\u4e00\u6b21\u6027\u8bfb\u53d64096\u4e2a\u5b57\u7b26\uff08\u6216\u8005\u5176\u4ed6\u56fa\u5b9a\u5927\u5c0f\u7684\u5b57\u8282\u6570\uff09\u7684\u539f\u56e0\u6709\u51e0\u70b9\uff1a</p> <ol> <li> <p>\u6027\u80fd\u8003\u8651\uff1a\u4e00\u6b21\u6027\u8bfb\u53d6\u8f83\u5927\u7684\u6570\u636e\u5757\u53ef\u4ee5\u51cf\u5c11I/O\u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u8bfb\u53d6\u6587\u4ef6\u7684\u6548\u7387\u3002\u76f8\u6bd4\u4e8e\u6bcf\u6b21\u8bfb\u53d6\u4e00\u4e2a\u5b57\u7b26\u6216\u8005\u4e00\u4e2a\u5b57\u8282\uff0c\u4e00\u6b21\u6027\u8bfb\u53d6\u66f4\u591a\u7684\u5b57\u7b26\u53ef\u4ee5\u51cf\u5c11\u7cfb\u7edf\u8c03\u7528\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u8bfb\u53d6\u901f\u5ea6\u3002</p> </li> <li> <p>\u51cf\u5c11\u7cfb\u7edf\u8c03\u7528\uff1a\u6587\u4ef6I/O\u901a\u5e38\u662f\u6bd4\u8f83\u6162\u7684\u64cd\u4f5c\uff0c\u6d89\u53ca\u5230\u7cfb\u7edf\u8c03\u7528\u548c\u78c1\u76d8\u8bbf\u95ee\u3002\u4e00\u6b21\u6027\u8bfb\u53d6\u8f83\u5927\u7684\u6570\u636e\u5757\u53ef\u4ee5\u51cf\u5c11\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570\uff0c\u51cf\u5c11\u4e86\u7cfb\u7edf\u8c03\u7528\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> </li> <li> <p>\u7f13\u51b2\u533a\u5927\u5c0f\uff1a\u4e00\u6b21\u6027\u8bfb\u53d64096\u4e2a\u5b57\u7b26\u901a\u5e38\u662f\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u662f4096\u5b57\u8282\uff08\u53734KB\uff09\uff0c\u8fd9\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u901a\u8fc7\u4e00\u6b21\u6027\u8bfb\u53d6\u6574\u4e2a\u7f13\u51b2\u533a\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u6700\u5927\u9650\u5ea6\u5730\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7f13\u51b2\u673a\u5236\uff0c\u51cf\u5c11\u8bfb\u53d6\u6570\u636e\u7684\u6b21\u6570\u3002</p> </li> <li> <p>\u7b80\u5316\u4ee3\u7801\u903b\u8f91\uff1a\u4e00\u6b21\u6027\u8bfb\u53d6\u56fa\u5b9a\u5927\u5c0f\u7684\u6570\u636e\u5757\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\u903b\u8f91\uff0c\u51cf\u5c11\u9519\u8bef\u7684\u53ef\u80fd\u6027\u3002\u901a\u8fc7\u56fa\u5b9a\u5927\u5c0f\u7684\u8bfb\u53d6\u64cd\u4f5c\uff0c\u53ef\u4ee5\u66f4\u5bb9\u6613\u5730\u7ba1\u7406\u8bfb\u53d6\u7684\u6570\u636e\uff0c\u5904\u7406\u8fb9\u754c\u60c5\u51b5\u7b49\u3002</p> </li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9009\u62e9\u4e00\u6b21\u6027\u8bfb\u53d6\u591a\u5c11\u6570\u636e\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u548c\u9700\u6c42\u3002\u6709\u65f6\u5019\u53ef\u80fd\u9700\u8981\u6839\u636e\u6587\u4ef6\u7684\u5927\u5c0f\u3001\u78c1\u76d8\u6027\u80fd\u3001\u5185\u5b58\u9650\u5236\u7b49\u56e0\u7d20\u6765\u786e\u5b9a\u5408\u9002\u7684\u8bfb\u53d6\u5927\u5c0f\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#buffer-cache","title":"\u600e\u4e48\u7406\u89e3\u7f13\u51b2\u533a\u548c\u7f13\u5b58 buffer \u548c cache","text":"<p>\u7f13\u51b2\u533a\u548c\u7f13\u5b58\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u6709\u4e00\u4e9b\u76f8\u4f3c\u4e4b\u5904\uff0c\u4f46\u5b83\u4eec\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u65b9\u5f0f\u7565\u6709\u4e0d\u540c\u3002</p> <ol> <li>\u7f13\u51b2\u533a\uff08Buffer\uff09\uff1a</li> <li>\u5b9a\u4e49\uff1a\u7f13\u51b2\u533a\u662f\u4e00\u79cd\u4e34\u65f6\u5b58\u50a8\u6570\u636e\u7684\u533a\u57df\uff0c\u901a\u5e38\u7528\u4e8e\u4e34\u65f6\u5b58\u653e\u6570\u636e\uff0c\u4ee5\u4fbf\u5728\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u5904\u7406\u6216\u4f20\u8f93\u3002\u5728\u7f16\u7a0b\u4e2d\uff0c\u7f13\u51b2\u533a\u901a\u5e38\u662f\u7528\u6765\u6682\u65f6\u5b58\u50a8\u6570\u636e\uff0c\u4ee5\u4fbf\u7a0b\u5e8f\u80fd\u591f\u6709\u6548\u5730\u5904\u7406\u6216\u4f20\u8f93\u8fd9\u4e9b\u6570\u636e\u3002</li> <li> <p>\u4f5c\u7528\uff1a\u7f13\u51b2\u533a\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u7528\u6765\u5e73\u8861\u6570\u636e\u7684\u751f\u4ea7\u548c\u6d88\u8d39\u901f\u5ea6\uff0c\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u5ef6\u8fdf\u6216\u963b\u585e\u3002\u901a\u8fc7\u4f7f\u7528\u7f13\u51b2\u533a\uff0c\u53ef\u4ee5\u63d0\u9ad8\u6570\u636e\u4f20\u8f93\u7684\u6548\u7387\u3002</p> </li> <li> <p>\u7f13\u5b58\uff08Cache\uff09\uff1a</p> </li> <li>\u5b9a\u4e49\uff1a\u7f13\u5b58\u662f\u4e00\u79cd\u9ad8\u901f\u4e34\u65f6\u5b58\u50a8\uff0c\u7528\u4e8e\u5b58\u653e\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u6216\u6307\u4ee4\uff0c\u4ee5\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u3002\u5728\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u7f13\u5b58\u901a\u5e38\u7528\u4e8e\u5b58\u50a8CPU\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u51cf\u5c11\u5bf9\u4e3b\u5b58\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\u3002</li> <li>\u4f5c\u7528\uff1a\u7f13\u5b58\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\uff0c\u901a\u8fc7\u5b58\u50a8\u70ed\u70b9\u6570\u636e\uff0c\u51cf\u5c11\u5bf9\u6162\u901f\u5b58\u50a8\u4ecb\u8d28\uff08\u5982\u4e3b\u5b58\uff09\u7684\u8bbf\u95ee\uff0c\u4ece\u800c\u52a0\u5feb\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u3002</li> </ol> <p>\u867d\u7136\u7f13\u51b2\u533a\u548c\u7f13\u5b58\u90fd\u662f\u7528\u4e8e\u4e34\u65f6\u5b58\u50a8\u6570\u636e\uff0c\u4f46\u5b83\u4eec\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u573a\u666f\u6709\u6240\u4e0d\u540c\u3002\u7f13\u51b2\u533a\u901a\u5e38\u7528\u4e8e\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u4e34\u65f6\u5b58\u50a8\uff0c\u800c\u7f13\u5b58\u4e3b\u8981\u7528\u4e8e\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u3002\u5728\u7406\u89e3\u7f13\u51b2\u533a\u65f6\uff0c\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u4e00\u4e2a\u4e34\u65f6\u5b58\u50a8\u6570\u636e\u7684\u533a\u57df\uff0c\u7528\u4e8e\u5728\u6570\u636e\u4f20\u8f93\u6216\u5904\u7406\u8fc7\u7a0b\u4e2d\u4e34\u65f6\u5b58\u653e\u6570\u636e\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#_22","title":"\u5f15\u7528\u548c\u5b9a\u4e49\u7684\u533a\u522b\uff1f","text":"<p>\u4e00\u4e2a\u662f\u7f16\u8bd1\uff08\u5b9a\u4e49\uff09\u8981\u7528\u5230\u5230\uff0c\u4e00\u4e2a\u662f\u94fe\u63a5\uff08\u5f15\u7528\uff09\u8981\u7528\u5230\u7684\u3002</p>"},{"location":"Complex%20issues/Complex%20issues.html#cpu_2","title":"\u5173\u4e8e\u63cf\u8ff0CPU\u7684\u901f\u5ea6\u7684\u6307\u6807","text":"<p>29 | CISC\u548cRISC\uff1a\u4e3a\u4ec0\u4e48\u624b\u673a\u82af\u7247\u90fd\u662fARM\uff1f-\u6df1\u5165\u6d45\u51fa\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406-\u6781\u5ba2\u65f6\u95f4 (geekbang.org)</p> <p>03 | \u901a\u8fc7\u4f60\u7684CPU\u4e3b\u9891\uff0c\u6211\u4eec\u6765\u8c08\u8c08\u201c\u6027\u80fd\u201d\u7a76\u7adf\u662f\u4ec0\u4e48\uff1f-\u6df1\u5165\u6d45\u51fa\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406-\u6781\u5ba2\u65f6\u95f4 (geekbang.org)</p> <p>04 | \u7a7f\u8d8a\u529f\u8017\u5899\uff0c\u6211\u4eec\u8be5\u4ece\u54ea\u4e9b\u65b9\u9762\u63d0\u5347\u201c\u6027\u80fd\u201d\uff1f-\u6df1\u5165\u6d45\u51fa\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406-\u6781\u5ba2\u65f6\u95f4 (geekbang.org)</p>"},{"location":"Complex%20issues/Complex%20issues.html#ctrlc","title":"\u4e3a\u4ec0\u4e48CTRL+C\u8fd9\u79cd\u64cd\u4f5c\u80fd\u6682\u505c\u7a0b\u5e8f\u7684\u8fd0\u884c\uff1f\u8fd9\u662f\u4ec0\u4e48\uff1f","text":"<p>NEMU/NPC \u7684 Ctrl+C \u9000\u51fa - \u5f20\u627f\u8bd1 - \u4e00\u751f\u4e00\u82af\u53cc\u5468\u5206\u4eab\u4f1a_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p></p>"},{"location":"Complex%20issues/Complex%20issues.html#_23","title":"\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u83b7\u53d6\u548c\u5e94\u7528\u66f4\u65b0, \u600e\u4e48\u505a\u5230? \u5176\u5185\u90e8\u7684\u7269\u7406\u539f\u7406\u662f\u4ec0\u4e48?","text":"<p>OTA\uff08Over-The-Air\uff09\u5347\u7ea7\u6280\u672f\u5141\u8bb8\u8bbe\u5907\u901a\u8fc7\u65e0\u7ebf\u7f51\u7edc\u8fdc\u7a0b\u66f4\u65b0\u56fa\u4ef6\u6216\u8f6f\u4ef6\uff0c\u800c\u65e0\u9700\u7269\u7406\u8fde\u63a5\u3002\u8fd9\u9879\u6280\u672f\u5728\u7269\u8054\u7f51\uff08IoT\uff09\u8bbe\u5907\u3001\u667a\u80fd\u624b\u673a\u3001\u6c7d\u8f66\u3001\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7b49\u9886\u57df\u5f97\u5230\u4e86\u5e7f\u6cdb\u5e94\u7528\u3002</p> <p>\u5b89\u5168\u5730\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u83b7\u53d6\u548c\u5e94\u7528\u66f4\u65b0\u7684\u8fc7\u7a0b\u901a\u5e38\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li> <p>\u6570\u636e\u52a0\u5bc6\uff1a\u4f7f\u7528\u5f3a\u52a0\u5bc6\u7b97\u6cd5\uff08\u5982 AES\u3001RSA\uff09\u5bf9\u4f20\u8f93\u7684\u56fa\u4ef6\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u4ee5\u9632\u6b62\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u88ab\u622a\u83b7\u548c\u7be1\u6539\u3002</p> </li> <li> <p>\u8eab\u4efd\u9a8c\u8bc1\uff1a\u901a\u8fc7\u6570\u5b57\u8bc1\u4e66\u6216\u7528\u6237\u540d\u548c\u5bc6\u7801\u7b49\u65b9\u5f0f\u9a8c\u8bc1\u8bbe\u5907\u548c\u670d\u52a1\u5668\u7684\u8eab\u4efd\uff0c\u786e\u4fdd\u6570\u636e\u53ea\u80fd\u7531\u6388\u6743\u7684\u8bbe\u5907\u548c\u670d\u52a1\u5668\u4ea4\u6362\u3002</p> </li> <li> <p>\u56fa\u4ef6\u7b7e\u540d\uff1a\u56fa\u4ef6\u5728\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e4b\u524d\u88ab\u7b7e\u540d\uff0c\u8bbe\u5907\u5728\u4e0b\u8f7d\u56fa\u4ef6\u540e\u4f1a\u9a8c\u8bc1\u7b7e\u540d\uff0c\u4ee5\u786e\u4fdd\u56fa\u4ef6\u7684\u5b8c\u6574\u6027\u548c\u6765\u6e90\u7684\u771f\u5b9e\u6027\u3002</p> </li> <li> <p>\u4f20\u8f93\u5b89\u5168\u534f\u8bae\uff1a\u4f7f\u7528\u5b89\u5168\u4f20\u8f93\u534f\u8bae\uff08\u5982 HTTPS\u3001TLS/SSL\uff09\u6765\u4fdd\u62a4\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u5b89\u5168\u6027\u3002</p> </li> <li> <p>\u5b8c\u6574\u6027\u6821\u9a8c\uff1a\u901a\u8fc7\u54c8\u5e0c\u51fd\u6570\uff08\u5982 SHA-256\uff09\u8ba1\u7b97\u56fa\u4ef6\u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u5728\u4e0b\u8f7d\u540e\u8fdb\u884c\u5339\u914d\uff0c\u4ee5\u786e\u4fdd\u56fa\u4ef6\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u672a\u88ab\u7be1\u6539\u3002</p> </li> <li> <p>\u9519\u8bef\u68c0\u6d4b\u548c\u91cd\u8bd5\u673a\u5236\uff1a\u5728\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u9519\u8bef\u68c0\u6d4b\uff0c\u5982\u679c\u53d1\u73b0\u9519\u8bef\u5219\u91cd\u65b0\u4e0b\u8f7d\uff0c\u4ee5\u786e\u4fdd\u56fa\u4ef6\u6587\u4ef6\u7684\u5b8c\u6574\u6027\u3002</p> </li> <li> <p>\u65ad\u70b9\u7eed\u4f20\uff1a\u5982\u679c\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u65ad\uff0c\u53ef\u4ee5\u4ece\u4e2d\u65ad\u7684\u5730\u65b9\u7ee7\u7eed\u4e0b\u8f7d\uff0c\u800c\u4e0d\u662f\u91cd\u65b0\u5f00\u59cb\u3002</p> </li> <li> <p>\u56de\u6eda\u673a\u5236\uff1a\u5982\u679c\u66f4\u65b0\u5931\u8d25\uff0c\u7cfb\u7edf\u53ef\u4ee5\u56de\u6eda\u5230\u4e4b\u524d\u7684\u7a33\u5b9a\u7248\u672c\uff0c\u4ee5\u4fdd\u8bc1\u8bbe\u5907\u7684\u53ef\u7528\u6027\u3002</p> </li> </ol> <p>\u7269\u7406\u539f\u7406\u65b9\u9762\uff0cOTA\u66f4\u65b0\u4e3b\u8981\u5229\u7528\u4e86\u65e0\u7ebf\u901a\u4fe1\u6280\u672f\uff0c\u901a\u8fc7\u7535\u78c1\u6ce2\u6765\u4f20\u8f93\u6570\u636e\u3002\u7535\u78c1\u6ce2\u662f\u7531\u7535\u573a\u548c\u78c1\u573a\u4ea4\u66ff\u53d8\u5316\u800c\u4ea7\u751f\u7684\u6ce2\u52a8\u73b0\u8c61\uff0c\u5b83\u4eec\u4ee5\u5149\u901f\u5728\u7a7a\u95f4\u4e2d\u4f20\u64ad\u3002\u65e0\u7ebf\u901a\u4fe1\u8bbe\u5907\uff08\u5982 Wi-Fi\u3001\u84dd\u7259\u3001\u79fb\u52a8\u6570\u636e\u7f51\u7edc\uff09\u901a\u8fc7\u8c03\u5236\u548c\u89e3\u8c03\u6280\u672f\uff0c\u5c06\u6570\u5b57\u4fe1\u53f7\u8f6c\u6362\u4e3a\u7535\u78c1\u6ce2\u5e76\u8fdb\u884c\u4f20\u8f93\u3002\u8fd9\u4e9b\u7535\u78c1\u6ce2\u88ab\u63a5\u6536\u8bbe\u5907\u6355\u83b7\uff0c\u5e76\u8f6c\u6362\u56de\u6570\u5b57\u4fe1\u53f7\u4ee5\u4f9b\u5904\u7406\u3002</p> <p>\u5728\u5b9e\u65bdOTA\u66f4\u65b0\u65f6\uff0c\u901a\u5e38\u4f1a\u6d89\u53ca\u5230\u65e0\u7ebf\u901a\u4fe1\u7684\u5b89\u5168\u4fdd\u969c\u63aa\u65bd\uff0c\u5305\u62ec\u4f7f\u7528\u52a0\u5bc6\u534f\u8bae\u3001\u7269\u7406\u5c42\u5b89\u5168\u63aa\u65bd\u3001\u7f51\u7edc\u5b89\u5168\u63aa\u65bd\u4ee5\u53ca\u8bbe\u5907\u5b89\u5168\u63aa\u65bd\u3002\u8fd9\u4e9b\u63aa\u65bd\u5171\u540c\u786e\u4fdd\u4e86\u65e0\u7ebf\u901a\u4fe1\u7684\u5b89\u5168\u6027\uff0c\u4ece\u800c\u4f7f\u5f97OTA\u66f4\u65b0\u53ef\u4ee5\u5b89\u5168\u5730\u8fdb\u884c\u3002</p>"},{"location":"Complex%20issues/Process%20of%20boot/process%20of%20boot.html","title":"Process of boot","text":"<p>\u8fd9\u91cc\u7b80\u5355\u8bb2\u4e00\u4e0b\u5173\u4e8e\u8fd9\u7c7b\u82af\u7247\u542f\u52a8\u6d41\u7a0b\uff1a</p> <p>Boot ROM \u4f4d\u4e8e\u82af\u7247\u5185\u90e8\u7684\u8d77\u59cb\u5730\u57400x00000000\u5904\uff0c\u5927\u5c0f\u4e3a96KB\u3002\u8fd9\u4e2a\u533a\u57df\u5305\u542b\u4e86\u542f\u52a8\u5f15\u5bfc\u7a0b\u5e8f\uff0c\u5b83\u8d1f\u8d23\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\uff08\u5982 SD \u5361\u3001eMMC\u3001NAND Flash \u7b49\uff09\u52a0\u8f7d\u64cd\u4f5c\u7cfb\u7edf\u6216\u5e94\u7528\u7a0b\u5e8f\u7684\u955c\u50cf\uff0c\u5e76\u5c06\u5176\u590d\u5236\u5230 RAM(\u5916\u90e8\u7684 DDR) \u4e2d\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u955c\u50cf\u7684\u5165\u53e3\u70b9\u5f00\u59cb\u6267\u884c\u3002</p> <p>\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u6d89\u53ca\u5230\u8bfb\u53d6\u5b58\u50a8\u8bbe\u5907\u4e0a\u7684 IVT\uff08Image Vector Table\uff09\u3001Boot Data \u548c DCD\uff08Device Configuration Data\uff09\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u544a\u8bc9 Boot ROM \u5982\u4f55\u52a0\u8f7d\u548c\u9a8c\u8bc1\u955c\u50cf\u6587\u4ef6\u3002</p> <p>\u8fd9\u91cc\u4e5f\u6709\u4e2a\u95ee\u9898\uff0c\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\u52a0\u8f7d\u955c\u50cf\uff0c\u600e\u4e48\u52a0\u8f7d\uff1fCPU \u600e\u4e48\u8bfb\u53d6\u8fd9\u90e8\u5206\u7a0b\u5e8f\u505a\u5230\u7684\uff1f\u8fd9\u90e8\u5206bootROM\u7a0b\u5e8f\u7a76\u7adf\u5199\u4e86\u4ec0\u4e48\uff1f\u642c\u8fd0\u6307\u4ee4\uff1f</p> <p>own version, not official version.</p> <p>\u8fd9\u91cc\u5927\u5bb6\u53ef\u80fd\u4f1a\u6709\u70b9\u60f3\u6cd5\uff0c\u8fd9\u4e2a MPU \u7684\u5185\u90e8\u4e5f\u6709 SRAM \u548cROM \u5440\uff0c\u8fd9\u548c\u524d\u9762\u7684 MCU \u53c8\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u50cf MCU \u90a3\u6837\u5c06\u4ee3\u7801\u4e0b\u8f7d\u5230ROM\u91cc\uff0c\u7136\u540edata \u653e\u5230 RAM \u91cc\u5462\uff1f</p> <p>\u8fd9\u91cc\u6211\u4eec\u5c31\u6682\u4e14\u8ba4\u4e3a\uff0cMPU \u8fd9\u8fb9\u4e00\u822c\u8981\u8fd0\u884c\u6bd4\u8f83\u5927\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528\u4e00\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u786c\u4ef6\u8bbe\u5907\uff08memory controller\uff09\uff0c\u6240\u4ee5\u5728\u542f\u52a8\u7684\u65f6\u5019\u9700\u8981\u4e00\u4e9b\u4ee3\u7801\u6765\u521d\u59cb\u5316\u4ed6\u4eec\uff0c\u800c\u7531\u4e8e\u6210\u672c\u95ee\u9898\uff0cCPU core \u5df2\u7ecf\u5f88\u8d35\u4e86\uff0c\u5982\u679c\u8fd8\u5728\u91cc\u9762\u5c06\u80fd\u8ddf\u4e0a CPU \u901f\u5ea6 \u7684 SRAM \u6269\u5927\u5bb9\u91cf\uff0c\u6210\u672c\u81ea\u7136\u53d7\u4e0d\u4e86\u3002\u6240\u4ee5\uff0cMPU\u5185\u90e8\u7684 ROM \u4e5f\u88ab\u8f83\u4e3a bootROM \u7528\u4e8e\u5b58\u653e\u542f\u52a8\u4ee3\u7801\u3001\u5185\u90e8 SRAM \u7528\u4f5c\u7f13\u51b2\u3001\u4f4e\u529f\u8017\u4fdd\u5b58\u5230\u4e00\u4e9b\u6570\u636e\u7b49\u7b49\u3002\u518d\u8fdb\u4e00\u6b65\u6df1\u5165\u5c31\u6709\u4e86 multi-stage bootloader</p> <p>\u90a3\u6211\u4eec\u8bf4\u7684 MCU(STM32) \u6709\u6ca1\u6709\u50cf bootROM \u4e00\u6837\u7684\u8fd9\u79cd\u4e1c\u897f\u5462\uff1f\u53ef\u4ee5\u8bf4\u6709\u4ed6\u8fd9\u79cd\u529f\u80fd\u7684\u5668\u4ef6\uff0c\u5c31\u662f\u7cfb\u7edf\u5b58\u50a8\u5668\uff0c\u4e00\u822c\u7528\u4e8e\u7684\u662f\u4e32\u53e3\u4e0b\u8f7d\u4ee3\u7801\u7684\u529f\u80fd\u7684\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u4e5f\u5408\u7406\u7684\uff0c\u8fd9\u91cc\u7559\u5751\uff0c\u603b\u7ed3\u6210\u53e6\u4e00\u7bc7\u6587\u7ae0\u3002 </p>"},{"location":"Complex%20issues/Process%20of%20boot/process%20of%20boot.html#doto","title":"DOTO","text":"<p>MPU \u7684 bootROM \u653e\u7684\u662f\u7cfb\u7edf\u542f\u52a8\u65f6\u6240\u9700\u7684\u521d\u59cb\u5316\u4ee3\u7801\uff0c\u5f53\u7cfb\u7edf\u4e0a\u7535\u6216\u8005\u590d\u4f4d\u7684\u65f6\u5019\uff0cMPU \u4ece bootROM \u5f00\u59cb\u6267\u884c\uff0c\u6267\u884c\u4e00\u4e9b\u57fa\u672c\u7684\u521d\u59cb\u5316\uff1a\u8bbe\u7f6e\u65f6\u949f\u3001\u521d\u59cb\u5316\u5185\u5b58\u63a7\u5236\u5668\u7b49\u7b49\uff1b\u7136\u540e\u5b83\u8d1f\u8d23\u5c06\u4ece\u6307\u5b9a\u7684\u542f\u52a8\u8bbe\u5907\u52a0\u8f7d\u955c\u50cf\uff0c\u5e76\u590d\u5236\u5230 DDR \u4e2d\u3002</p> <p>\u8fd9\u91cc\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c\u90a3 MCU-STM32 \u90a3\u4fbf\u662f\u600e\u4e48\u542f\u52a8\u7684\u5462\uff1f\u4ed6\u6709\u6ca1\u6709\u50cf MPU \u90a3\u6837\u7684\u5e26\u6709 bootROM \u7684\u5462\uff1f\u5b9e\u9645\u4e0a\u662f\u6709\u7684\uff0c\u8fd9\u5c31\u4e0d\u5f97\u4e0d\u8bf4\u5230STM32\u7684\u542f\u52a8\u6a21\u5f0f\u4e86\uff0c\u5982\u4e0b\u6587\uff1a</p> <p>\u3010ARM Cortex-M\u5f00\u53d1\u5b9e\u6218\u6307\u5357(\u57fa\u7840\u7bc7)\u3011\u7b2c3\u7ae0 Cortex-M\u542f\u52a8\u6d41\u7a0b\u8be6\u89e3(GCC\u7248) - BruceOu\u7684\u535a\u5ba2</p> <p>\u6df1\u5165\u7406\u89e3MCU\u542f\u52a8\u539f\u7406 - \u77e5\u4e4e (zhihu.com)</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html","title":"Toolchain","text":""},{"location":"Complex%20issues/Toolchains/toolchain.html#_1","title":"\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe","text":""},{"location":"Complex%20issues/Toolchains/toolchain.html#toolchain","title":"Toolchain","text":"<p>\u6211\u4eec\u5e38\u8bf4\u7684\u5de5\u5177\u94fe\u662f\u7f16\u8bd1\u6240\u9700\u7684\u7f16\u8bd1\u5668\u3001\u57fa\u672c\u5de5\u5177\u548c\u5e93\u8fd9\u4e00\u96c6\u5408\uff0c\u5f53\u7136\u8fd8\u80fd\u5305\u62ec\u6784\u5efa\u5de5\u5177\u3001\u5e38\u7528\u7684\u5f00\u53d1\u4eba\u5458\u5e93\u7b49\u7b49\u3002</p> <p>Toolchains: A horror story. Real world examples of how a seemingly\u2026 | by Ruvinda Dhambarage | Medium</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#what-is-cross-compiling","title":"what is cross compiling","text":"<p>Toolchains: A horror story. Real world examples of how a seemingly\u2026 | by Ruvinda Dhambarage | Medium</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#target-triple","title":"Target triple","text":"<p>A master guide to Linux cross compiling</p> <p>\u4f7f\u7528\u76ee\u6807\u4e09\u5143\u7ec4\u6765\u63cf\u8ff0 Unix \u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff1a</p> <p><code>ISA-Vendor-OperatingSystem</code></p> <p><code>[arch]-[vendor]-[os]-[libc/abi])</code> </p> <p>ISA\u5e38\u89c1\u7684\u90a3\u51e0\u4e2a\uff0cx86_64\u3001arm\u3001riscv64...</p> <p>\u4f9b\u5e94\u5546Vendor\u901a\u5e38\u88ab\u6807\u8bb0\u4e3a <code>unknown</code>\u3001<code>none</code>\u3001\u6216\u8005\u76f4\u63a5\u7701\u7565\u3002</p> <p>\u800c <code>OperatingSystem</code> \u5f80\u5f80\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u5b83\u63cf\u8ff0\u4e86\u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u73af\u5883\u7ec6\u8282\uff1a\u901a\u5e38\u5305\u62ec <code>kernel type</code>\u3001C \u5e93\u548c ABI\uff08C\u5e93\u548c ABI \u901a\u5e38\u7ed3\u5408\u5728\u4e00\u8d77\uff09\u3002\u7efc\u5408\u8d77\u6765\u4e3a\uff1a <code>kernel-ClibABI</code>\u3002</p> <p>\u5982\u4e0b\u4f8b\u5b50\uff1a</p> <pre><code>|           Target Triple            |    CPU/ISA     | Vendor | Kernel  | C lib |   ABI   |\n|------------------------------------|----------------|--------|---------|-------|---------|\n| x86_64-linux-gnu                   | x86_64         | -      | Linux   | GNU   | -       |\n| arm-cortex_a8-poky-linux-gnueabihf | Cortex A8      | Yocto  | Linux   | GNU   | EABI-HF |\n| armeb-unknown-linux-musleabi       | ARM Big Endian | -      | Linux   | musl  | EABI    |\n| x86_64-freebsd                     | x86_64         | -      | FreeBSD | -     | -       |\n</code></pre> <p>\u5728\u4e09\u5143\u7ec4\u540e\u9762\u8ddf\u7740\u5404\u79cd\u7f16\u8bd1\u5de5\u5177\uff1a<code>triple-gcc</code>\u3001<code>triple-objdump</code>...</p> <p>\u81ea\u5df1\u9047\u5230\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>ARM:<ul> <li>arm-linux-gcc\uff1a\u8fd9\u662f\u4e00\u4e2a\u8f83\u8001\u7684\u547d\u540d\u65b9\u5f0f\uff0c\u7528\u4e8e\u7f16\u8bd1\u8fd0\u884c\u5728ARM\u67b6\u6784\u4e0a\u7684Linux\u7cfb\u7edf\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u901a\u5e38\u94fe\u63a5\u5230glibc\u5e93\u3002</li> <li>arm-linux-gnueabi-gcc\uff1a\u8fd9\u4e2a\u7f16\u8bd1\u5668\u7528\u4e8e\u7f16\u8bd1\u8fd0\u884c\u5728ARM\u67b6\u6784\u4e0a\u7684Linux\u7cfb\u7edf\u5e94\u7528\u7a0b\u5e8f\uff0c\u9002\u7528\u4e8e\u4efb\u4f55CPU\u578b\u53f7\uff0c\u94fe\u63a5\u5230GNU EABI\u5e93\u3002</li> <li>arm-linux-gnueabihf-gcc\uff1a\u4e0e<code>arm-linux-gnueabi-gcc</code>\u7c7b\u4f3c\uff0c\u4f46\u9ed8\u8ba4\u4f7f\u7528hard\u6d6e\u70b9ABI\uff0c\u9002\u7528\u4e8e\u6709FPU\u7684ARM\u67b6\u6784\u3002</li> <li>arm-none-eabi-gcc\uff1a\u7528\u4e8e\u7f16\u8bd1\u4e0d\u4f9d\u8d56\u64cd\u4f5c\u7cfb\u7edf\u7684ARM\u67b6\u6784\u5e94\u7528\u7a0b\u5e8f\uff0c\u901a\u5e38\u7528\u4e8e\u88f8\u673a\u73af\u5883\uff0c\u94fe\u63a5 newlib \u7b49\u3002</li> <li>arm-none-linux-gnueabi-gcc\uff1a\u7528\u4e8e\u7f16\u8bd1\u8fd0\u884c\u5728ARM\u67b6\u6784\u4e0a\u7684Linux\u7cfb\u7edf\u5e94\u7528\u7a0b\u5e8f\uff0c\u9002\u7528\u4e8e\u4efb\u4f55CPU\u578b\u53f7\uff0c\u94fe\u63a5\u5230GNU EABI\u5e93\u3002</li> </ul> </li> <li>RISC-V<ul> <li>riscv64-unknown-linux-gnu-gcc\uff1a\u8fd9\u662f\u4e00\u4e2a64\u4f4d\u7684RISC-V\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u7528\u4e8e\u7f16\u8bd1\u8fd0\u884c\u5728Linux\u7cfb\u7edf\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u94fe\u63a5\u5230glibc\u5e93\u3002</li> <li>riscv64-unknown-elf-gcc\uff1a\u8fd9\u662f\u4e00\u4e2a64\u4f4d\u7684RISC-V\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u7528\u4e8e\u7f16\u8bd1\u4e0d\u4f9d\u8d56\u64cd\u4f5c\u7cfb\u7edf\u7684\u88f8\u673a\u5e94\u7528\u7a0b\u5e8f\uff0c\u94fe\u63a5\u5230newlib\u5e93\u3002</li> <li>riscv-none-embed-gcc\uff1a\u8fd9\u662f\u4e3a\u88f8\u673a\uff08bare-metal\uff09\u5d4c\u5165\u5f0f\u7cfb\u7edf\u800c\u751f\u6210\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u4f7f\u7528newlib\u6216newlib-nano\u5e93\uff0c\u80fd\u591f\u4e3a\u5d4c\u5165\u5f0f\u7cfb\u7edf\u751f\u6210\u66f4\u52a0\u4f18\u5316\u7684\u4ee3\u7801\u4f53\u79ef\u3002</li> </ul> </li> </ul> <p>\u4e00\u4e9b\u542f\u53d1\uff1a</p> <p>arm-none-eabi-gcc \u4e00\u822c\u9002\u7528\u7528\u4e8e Arm Cortex-M/Cortex-R \u5e73\u53f0\uff0c\u5b83\u4f7f\u7528\u7684\u662f newlib \u5e93\u3002</p> <p>arm-linux-gnueabi-gcc \u548c aarch64-linux-gnu-gcc \u9002\u7528\u4e8e Arm Cortex-A \u7cfb\u5217\u82af\u7247\uff0c\u524d\u8005\u9488\u5bf9 32 \u4f4d\u82af\u7247\uff0c\u540e\u8005\u9488\u5bf9 64 \u4f4d\u82af\u7247\uff0c\u5b83\u4f7f\u7528\u7684\u662f glibc \u5e93\u3002\u53ef\u4ee5\u7528\u6765\u7f16\u8bd1 u-boot\u3001linux kernel \u4ee5\u53ca\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u53e6\u5916\u9700\u8981\u8865\u5145\u4e00\u70b9\u7684\u662f\uff0c32 \u4f4d\u7684 Arm \u548c 64 \u4f4d\u7684 Arm\uff0c\u5b83\u4eec\u7684\u6307\u4ee4\u96c6\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u5de5\u5177\u94fe\u3002\u5f53\u7136\uff0cArm64 \u4e3a\u4e86\u4fdd\u8bc1\u524d\u5411\u517c\u5bb9\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a 32 \u4f4d\u7684\u517c\u5bb9\u6a21\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u7528 arm-linux-gnueabi-gcc \u7f16\u8bd1\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u662f\u53ef\u4ee5\u76f4\u63a5\u5728Arm64 \u7684\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\uff0c\u4f46\u662f Linux Kernel \u548c U-Boot \u5c31\u4e0d\u884c\uff0c\u9664\u975e\u4f60\u63d0\u524d\u628a CPU \u5207\u6362\u5230 32 \u4f4d\u6a21\u5f0f\u3002\u66fe\u7ecf\u6709\u4e2a\u9879\u76ee\u4f7f\u7528\u4e86\u4e00\u9897\u56db\u6838\u7684 Arm64 \u82af\u7247\uff0c\u4f46\u662f\u5185\u5b58\u53ea\u670964M\uff0c\u4e3a\u4e86\u8282\u7701\u7a7a\u95f4\uff0c\u5728 CPU \u8fd0\u884c\u5230 U-Boot \u4e4b\u524d\uff0c\u6211\u4eec\u5c31\u628a\u5b83\u5207\u5230\u4e86 32 \u4f4d\u6a21\u5f0f\uff0c\u540e\u9762\u7684 U-Boot\u3001Linux Kernel\uff0c\u5e94\u7528\u5168\u90e8\u90fd\u7528 32 \u4f4d\u7f16\u8bd1\uff0c\u52a0\u4e0a Thumb \u6307\u4ee4\u96c6\uff0c\u8282\u7701\u4e86\u4e0d\u5c11\u7a7a\u95f4\u3002\u4e00\u6b21\u641e\u5b9a Arm Linux \u4ea4\u53c9\u7f16\u8bd1</p> <p>\u4f46\u662f C lib \u548c ABI \u7a76\u7adf\u662f\u5565\uff1f</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#abi-c-lib","title":"ABI &amp; C lib","text":""},{"location":"Complex%20issues/Toolchains/toolchain.html#abiapplication-binary-interface","title":"ABI\uff08application binary interface\uff09","text":"<p>\u6765\u81ea Wikipedia\uff1a</p> <p>In computer software, an application binary interface (ABI) is an interface between two binary program modules. Often, one of these modules is a library or operating system facility, and the other is a program that is being run by a user.</p> <p>\u5373\u6d89\u53ca\u5230\u673a\u5668\u7801\u5c42\u9762\uff0c\u4e24\u4efd\u4e8c\u8fdb\u5236\u6587\u4ef6\u600e\u4e48\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u8fd9\u600e\u4e48\u8bbf\u95ee\u5bf9\u65b9\u7684\u6570\u636e\u5185\u5bb9\u3002</p> <p>\u5177\u4f53\u5185\u5bb9\uff1a</p> <ul> <li>ISA\uff1a\u5bc4\u5b58\u5668\u6587\u4ef6\u7684\u7ed3\u6784\u3001\u6808\u5982\u4f55\u7ec4\u7ec7\u3001\u5185\u5b58\u8bbf\u95ee\u7684\u7c7b\u578b</li> <li>\u5904\u7406\u5668\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u3001\u5e03\u5c40\u548c\u5bf9\u9f50</li> <li>\u8c03\u7528\u7ea6\u5b9a\uff1a\u5982\u4f55\u4f20\u9012\u53c2\u6570\u3001\u8fd4\u56de\u503c\uff1a\uff08\u505a\u5b8c PA \u5e94\u8be5\u5f88\u719f\u6089\uff0c\u5c31\u662f\u63cf\u8ff0\u7236\u5b50\u51fd\u6570\u5982\u4f55\u7f16\u8bd1\u94fe\u63a5\u7684\uff09<ul> <li>\u51fd\u6570\u53c2\u6570\u7528\u6808\u4f20\u9012\u8fd8\u662f\u7528\u6808</li> <li>\u54ea\u4e9b\u5bc4\u5b58\u5668\u7528\u4e8e\u5b58\u653e\u51fd\u6570\u53c2\u6570</li> <li>Whether the first function parameter passed on the stack is pushed first or last\uff08\u6709\u70b9\u8ff7\u7cca\uff09</li> <li>\u8c03\u7528\u8005\u8fd8\u662f\u88ab\u8c03\u7528\u8005\u6e05\u9664\u6808</li> <li>\u6808\u7684\u5e03\u5c40</li> </ul> </li> <li>\u5e94\u7528\u7a0b\u5e8f\u5982\u4f55\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528</li> <li>\u5728\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edfABI\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u6807\u6587\u4ef6\u3001\u5e93\u7b49\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f</li> </ul> <p>\u5177\u4f53\u4f8b\u5b50\u6765\u8bf4\uff1aSystem V generic ABI + RISC-V</p> <p></p> <p>\u6765\u6e90\uff1a\u300aRISCV\u4f53\u7cfb\u7ed3\u6784\u7f16\u7a0b\u300b</p> <ul> <li> <p>\u6808\u7ec4\u7ec7\uff1aRISC-V\u4f7f\u7528\u6807\u51c6\u7684Callee-saved\u548cCaller-saved\u5bc4\u5b58\u5668\u7ea6\u5b9a\uff0c\u4ee5\u53ca\u7279\u5b9a\u7684\u6808\u5e27\u5e03\u5c40\u3002</p> <ul> <li> <p>RISC-V\u6ca1\u6709\u63d0\u4f9b\u7279\u70b9\u7684\u5165\u6808\u3001\u51fa\u6808\u6307\u4ee4\u3002</p> </li> <li> <p>\u4e24\u79cd\u6808\u7ec4\u7ec7</p> <ul> <li> <p>\u4e0d\u4f7f\u7528 FP</p> <p></p> </li> <li> <p>\u4f7f\u7528 FP</p> <p></p> </li> </ul> </li> </ul> </li> <li> <p>\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1a\u4f8b\u5982\uff0cRISC-V\u53ef\u80fd\u4f1a\u89c4\u5b9a <code>int</code> \u7c7b\u578b\u4e3a32\u4f4d\u621664\u4f4d\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5b9e\u73b0\u3002</p> </li> <li> <p>\u4e8c\u8fdb\u5236\u683c\u5f0f\uff1aRISC-V\u901a\u5e38\u4f1a\u4f7f\u7528ELF\u683c\u5f0f\uff0cABI\u4f1a\u5b9a\u4e49\u7279\u5b9a\u7684ELF\u5934\u90e8\u548c\u8282\uff08section\uff09\u7684\u8981\u6c42\u3002</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406</p> <p>\u5728RISC-V \u4f53\u7cfb\u7ed3\u6784\u4e2d\uff0c\u5f02\u5e38\u5904\u7406\u548c\u4e2d\u65ad\u5904\u7406\u90fd\u5c5e\u4e8e\u5f02\u5e38\u3002\u5177\u4f53\u770b\u624b\u518c</p> </li> <li> <p>EABI</p> <p>\u8fd9\u91cc\u518d\u8865\u5145 EABI \u5d4c\u5165\u5f0f\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3\u6307\u5b9a\u4e86\u6587\u4ef6\u683c\u5f0f\u3001\u6570\u636e\u7c7b\u578b\u3001\u5bc4\u5b58\u5668\u4f7f\u7528\u3001\u5806\u79ef\u7ec4\u7ec7\u4f18\u5316\u548c\u5728\u4e00\u4e2a\u5d4c\u5165\u5f0f\u8f6f\u4ef6\u4e2d\u7684\u53c2\u6570\u7684\u6807\u51c6\u7ea6\u5b9a\u3002 \u5f00\u53d1\u8005\u4f7f\u7528\u81ea\u5df1\u7684\u6c47\u7f16\u8bed\u8a00\u4e5f\u53ef\u4ee5\u4f7f\u7528EABI\u4f5c\u4e3a\u4e0e\u517c\u5bb9\u7684\u7f16\u8bd1\u5668\u751f\u6210\u7684\u6c47\u7f16\u8bed\u8a00\u7684\u63a5\u53e3\u3002 \u652f\u6301EABI\u7684\u7f16\u8bd1\u5668\u521b\u5efa\u7684\u76ee\u6807\u6587\u4ef6\u53ef\u4ee5\u548c\u4f7f\u7528\u7c7b\u4f3c\u7f16\u8bd1\u5668\u4ea7\u751f\u7684\u4ee3\u7801\u517c\u5bb9\uff0c\u8fd9\u6837\u5141\u8bb8\u5f00\u53d1\u8005\u94fe\u63a5\u4e00\u4e2a\u7531\u4e0d\u540c\u7f16\u8bd1\u5668\u4ea7\u751f\u7684\u5e93\u3002 EABI\u4e0e\u5173\u4e8e\u901a\u7528\u8ba1\u7b97\u673a\u7684ABI\u7684\u4e3b\u8981\u533a\u522b\u662f\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u5141\u8bb8\u4f7f\u7528\u7279\u6743\u6307\u4ee4\uff0c\u4e0d\u9700\u8981\u52a8\u6001\u94fe\u63a5\uff08\u6709\u65f6\u662f\u7981\u6b62\u7684\uff09\uff0c\u548c\u66f4\u7d27\u51d1\u7684\u5806\u6808\u5e27\u7ec4\u7ec7\u7528\u6765\u8282\u7701\u5185\u5b58\u3002\u5e7f\u6cdb\u4f7f\u7528EABI\u7684\u6709Power PC\u548cARM.</p> </li> </ul>"},{"location":"Complex%20issues/Toolchains/toolchain.html#c-library","title":"C library","text":"<p>C\u5e93\uff08\u4e5f\u79f0\u4e3aC\u8bed\u8a00\u8fd0\u884c\u65f6\u5e93\uff09\u662f\u4e00\u7ec4\u9884\u5148\u7f16\u5199\u597d\u7684\u4ee3\u7801\uff0c\u5b83\u4eec\u5b9e\u73b0\u4e86C\u8bed\u8a00\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684\u51fd\u6570\u548c\u8bbe\u65bd\u3002\u8fd9\u4e9b\u5e93\u4e3aC\u8bed\u8a00\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e86\u4e00\u5957\u901a\u7528\u7684\u3001\u53ef\u91cd\u7528\u7684\u4ee3\u7801\u6765\u6267\u884c\u5e38\u89c1\u7684\u4efb\u52a1\uff0c\u6bd4\u5982\u8f93\u5165\u8f93\u51fa\u3001\u5b57\u7b26\u4e32\u5904\u7406\u3001\u6570\u5b66\u8ba1\u7b97\u3001\u5185\u5b58\u7ba1\u7406\u3001\u6570\u636e\u5904\u7406\u7b49.</p> <ol> <li>\u6807\u51c6\u5e93\u51fd\u6570\uff1a\u8fd9\u4e9b\u662fISO C\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1a<ul> <li>\u8f93\u5165\u8f93\u51fa\u51fd\u6570\uff08\u5982<code>printf</code>\u3001<code>scanf</code>\u3001<code>fgets</code>\u3001<code>fputs</code>\uff09</li> <li>\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\uff08\u5982<code>strcpy</code>\u3001<code>strlen</code>\u3001<code>strcmp</code>\u3001<code>strcat</code>\uff09</li> <li>\u6570\u5b66\u8ba1\u7b97\u51fd\u6570\uff08\u5982<code>sin</code>\u3001<code>cos</code>\u3001<code>pow</code>\u3001<code>sqrt</code>\uff09</li> <li>\u52a8\u6001\u5185\u5b58\u7ba1\u7406\u51fd\u6570\uff08\u5982<code>malloc</code>\u3001<code>calloc</code>\u3001<code>realloc</code>\u3001<code>free</code>\uff09</li> <li>\u5176\u4ed6\u5b9e\u7528\u51fd\u6570\uff08\u5982<code>rand</code>\u3001<code>srand</code>\u3001<code>abs</code>\u3001<code>atoi</code>\uff09</li> </ul> </li> <li>\u7cfb\u7edf\u7ea7\u652f\u6301\u51fd\u6570\uff1a\u8fd9\u4e9b\u51fd\u6570\u63d0\u4f9b\u4e86\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u4f8b\u5982\u6587\u4ef6\u64cd\u4f5c\u3001\u8fdb\u7a0b\u63a7\u5236\u3001\u4fe1\u53f7\u5904\u7406\u7b49\u3002</li> <li>\u542f\u52a8\u548c\u7ec8\u6b62\u4ee3\u7801\uff1aC\u8fd0\u884c\u65f6\u5e93\u901a\u5e38\u5305\u542b\u4e86\u7a0b\u5e8f\u542f\u52a8\u65f6\uff08\u5982<code>main</code>\u51fd\u6570\u4e4b\u524d\uff09\u548c\u7ec8\u6b62\u65f6\uff08\u5982<code>main</code>\u51fd\u6570\u4e4b\u540e\uff09\u6267\u884c\u7684\u4ee3\u7801\u3002\u8fd9\u5305\u62ec\u4e86\u521d\u59cb\u5316\u5168\u5c40\u53d8\u91cf\u3001\u5206\u914d\u5185\u5b58\u3001\u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u91ca\u653e\u8d44\u6e90\u7b49\u3002</li> <li>\u6d6e\u70b9\u6570\u5b66\u652f\u6301\uff1a\u63d0\u4f9b\u4e86\u6d6e\u70b9\u6570\u7684\u683c\u5f0f\u5316\u8f93\u5165\u8f93\u51fa\u3001\u6d6e\u70b9\u5f02\u5e38\u5904\u7406\u7b49\u529f\u80fd\u3002</li> <li>\u672c\u5730\u5316\u548c\u56fd\u9645\u5316\u652f\u6301\uff1a\u63d0\u4f9b\u4e86\u591a\u8bed\u8a00\u652f\u6301\uff0c\u5305\u62ec\u5b57\u7b26\u96c6\u8f6c\u6362\u3001\u672c\u5730\u5316\u5b57\u7b26\u4e32\u5904\u7406\u7b49\u3002</li> <li>\u8c03\u8bd5\u652f\u6301\uff1a\u63d0\u4f9b\u4e86\u8c03\u8bd5\u5de5\u5177\u548c\u51fd\u6570\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u8bca\u65ad\u7a0b\u5e8f\u4e2d\u7684\u95ee\u9898\u3002</li> </ol> <p>\u5728 \u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840\u4e2d\uff0c\u5982\u679c\u662f\u6709 OS \u7684\u73af\u5883\uff0c\u6211\u4eec\u77e5\u9053\u5b9e\u9645\u7684 <code>printf</code> \u4f9d\u8d56\u4e8e OS \u5411 lib \u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528 <code>write, brk</code> \u7b49\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u7cfb\u7edf\u8c03\u7528\u662f OS \u3001app/user \u4e4b\u95f4\u7684\u63a5\u53e3\uff0c\u4e3a\u7684\u5c31\u662fuser\u80fd\u591f\u64cd\u4f5c\u4e00\u4e9b\u786c\u4ef6\u8bbe\u5907\uff0c\u5177\u4f53\u5230 <code>printf</code> \u5c31\u662f\u6211\u4eec\u7684\u7ec8\u7aef\u3002\u4f46\u6211\u4eec\u4e5f\u5f04\u8fc7\u5d4c\u5165\u5f0f\uff0c\u90a3\u4e2a\u65f6\u5019\u4e5f\u7528\u5230\u4e86<code>printf</code>\uff0c\u4f46\u662f\u6211\u4eec\u505a\u7684\u662f\u4e32\u53e3\u91cd\u5b9a\u5411\u7684\u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0c\u5e76\u4e0d\u662f\u5728\u6709 OS \u7684\u73af\u5883\u4e0b\u624d\u80fd\u7528 C \u5e93\uff0c\u5728 bare-meatal \u4e0b\u6211\u4eec\u4f9d\u65e7\u80fd\u591f\u4f7f\u7528\uff0c\u53ea\u4e0d\u8fc7\u662f\u8bf4\u6211\u4eec\u9700\u8981\u81ea\u5df1\u505a\u4e00\u90e8\u5206\u7684\u64cd\u4f5c\u6765\u76f4\u63a5\u63a7\u5236\u786c\u4ef6\uff0c\u5c31\u50cf <code>printf</code> \u548c\u4e32\u53e3\u91cd\u5b9a\u5411\uff1b\u66f4\u6709\u751a\u8005\uff0c\u4f7f\u7528\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0I/O\u64cd\u4f5c\uff0c\u800c\u4e0d\u4f9d\u8d56\u4e8e\u6807\u51c6\u5e93\u4e2d\u7684\u6587\u4ef6\u6d41\u64cd\u4f5c\u51fd\u6570\uff0c\u5f53\u7136\u5de5\u4f5c\u91cf\u7a0d\u5927\uff0c\u5e94\u8be5\u6ca1\u4eba\u8fd9\u4e48\u505a\uff1f\u6240\u4ee5\uff0c\u5728\u88f8\u673a\u73af\u5883\u4e0b\uff0c\u540c\u6837\u4e5f\u662f\u6709\u4ed6\u4eba\u5b9e\u73b0\u597d\u7684 C \u8fd0\u884c\u5e93\uff1aNewlib\u3002\u5b83\u65e8\u5728\u4e3a\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u7684 bare-metal \u73af\u5883\u63d0\u4f9b\u57fa\u672c\u7684 C \u5e93\u529f\u80fd\uff0c\u5e93\u4e2d\u7684\u51fd\u6570\u5bf9\u8fd0\u884c\u65f6\u73af\u5883\u7684\u8981\u6c42\u6781\u4f4e\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\uff0c\u6211\u4eec\u4e0d\u5fc5\u4e3a\u4e86\u914d\u5408 C \u5e93\u800c\u5728 bare-metal \u4e0a\u5b9e\u73b0\u989d\u5916\u7684\u529f\u80fd\u3002Newlib \u63d0\u4f9b\u4e86\u4e00\u7ec4\u201cstub\u201d\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u6a21\u62df\u4e86\u7cfb\u7edf\u8c03\u7528\uff0c\u4f7f\u5f97 Newlib \u53ef\u4ee5\u5728\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u73af\u5883\u4e2d\u5de5\u4f5c\u3002\u800c glibc \u548c uClibc \u90fd\u9700\u8981\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5e95\u5c42\u652f\u6301\u3002</p> <p>\u6240\u4ee5\uff0c\u5173\u4e8e ABI \u548c C \u5e93\u7684\u5173\u7cfb\u81ea\u5df1\u5927\u6982\u53ef\u4ee5\u603b\u7ed3\u4e00\u90e8\u5206\uff1a</p> <ul> <li>C\u5e93\u53ef\u4ee5\u662fABI\u7684\u4e00\u90e8\u5206\uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0cC\u5e93\u7684\u63a5\u53e3\u548c\u884c\u4e3a\u53ef\u80fd\u88ab\u5305\u542b\u5728ABI\u7684\u5b9a\u4e49\u4e2d\uff0c\u7279\u522b\u662f\u5f53C\u5e93\u51fd\u6570\u4f5c\u4e3a\u7cfb\u7edf\u7ea7\u63a5\u53e3\u65f6\u3002</li> <li>C\u5e93\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8eABI\uff1aC\u5e93\u7684\u51fd\u6570\u9700\u8981\u9075\u5faa\u7279\u5b9a\u7684ABI\u6765\u5b9e\u73b0\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u80fd\u591f\u88ab\u4e0d\u540c\u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\u6b63\u786e\u8c03\u7528\u3002\u4f8b\u5982\uff0cC\u5e93\u4e2d\u7684<code>printf</code>\u51fd\u6570\u7684\u5b9e\u73b0\u9700\u8981\u9075\u5faa\u5e73\u53f0\u7684ABI\u4e2d\u7684\u8c03\u7528\u7ea6\u5b9a\u548c\u5bc4\u5b58\u5668\u4f7f\u7528\u89c4\u5219\uff0c\u4e0d\u8fc7\u8fd9\u5e94\u8be5\u662f\u7f16\u8bd1\u5668\u5de5\u4f5c\u9700\u8981\u505a\u7684\u3002</li> <li>ABI\u4e0d\u4ec5\u9650\u4e8eC\u5e93\uff1aABI\u6db5\u76d6\u4e86\u6240\u6709\u4e8c\u8fdb\u5236\u63a5\u53e3\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8eC\u5e93\u3002\u5b83\u8fd8\u5b9a\u4e49\u4e86\u5176\u4ed6\u8bed\u8a00\u8fd0\u884c\u65f6\u5e93\u3001\u7cfb\u7edf\u8c03\u7528\u3001\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002</li> </ul> <p>\u8fd8\u662f\u914d\u5408ABI\u4f8b\u5b50\uff1a</p> <p><code>kimi</code>\uff1a</p> <ol> <li>\u51fd\u6570\u8c03\u7528\u7ea6\u5b9a\uff1a<ul> <li>\u5728RISC-V Linux\u5e73\u53f0\u4e0a\uff0cABI\u5b9a\u4e49\u4e86\u51fd\u6570\u53c2\u6570\u7684\u4f20\u9012\u65b9\u5f0f\u3002\u4f8b\u5982\uff0cRISC-V\u7684\u8c03\u7528\u7ea6\u5b9a\u53ef\u80fd\u89c4\u5b9a\u524d\u51e0\u4e2a\u6574\u6570\u6216\u6307\u9488\u53c2\u6570\u901a\u8fc7\u5bc4\u5b58\u5668<code>a0</code>, <code>a1</code>, <code>a2</code>, <code>a3</code>\u7b49\u4f20\u9012\uff0c\u8d85\u51fa\u7684\u53c2\u6570\u901a\u8fc7\u6808\u4f20\u9012\u3002</li> <li><code>printf</code>\u51fd\u6570\u7684\u5b9e\u73b0\u9700\u8981\u9075\u5faa\u8fd9\u4e00\u89c4\u5219\uff0c\u4ee5\u786e\u4fdd\u6b63\u786e\u5730\u4ece\u5bc4\u5b58\u5668\u6216\u6808\u4e2d\u8bfb\u53d6\u53c2\u6570\u3002</li> </ul> </li> <li>\u5bc4\u5b58\u5668\u4f7f\u7528\uff1a<ul> <li>ABI\u53ef\u80fd\u89c4\u5b9a\u4e86\u54ea\u4e9b\u5bc4\u5b58\u5668\u7528\u4e8e\u4f20\u9012\u51fd\u6570\u53c2\u6570\uff0c\u54ea\u4e9b\u5bc4\u5b58\u5668\u7528\u4e8e\u8fd4\u56de\u503c\u3002\u4f8b\u5982\uff0c<code>a0</code>\u53ef\u80fd\u88ab\u7528\u4e8e\u4f20\u9012<code>printf</code>\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08\u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff09\uff0c\u800c\u8fd4\u56de\u503c\uff08\u4f8b\u5982\uff0c\u6253\u5370\u7684\u5b57\u7b26\u6570\uff09\u53ef\u80fd\u88ab\u5b58\u50a8\u5728<code>a7</code>\u5bc4\u5b58\u5668\u4e2d\u3002</li> </ul> </li> <li>\u6808\u5e03\u5c40\uff1a<ul> <li>ABI\u5b9a\u4e49\u4e86\u6808\u7684\u5e03\u5c40\u548c\u5bf9\u9f50\u8981\u6c42\u3002\u5728RISC-V Linux\u5e73\u53f0\u4e0a\uff0c\u6808\u901a\u5e38\u662f\u5411\u53f3\u589e\u957f\u7684\uff08\u5373\u5411\u4f4e\u5730\u5740\u65b9\u5411\u589e\u957f\uff09\uff0c\u5e76\u4e14\u53ef\u80fd\u8981\u6c42\u7279\u5b9a\u7684\u5bf9\u9f50\u65b9\u5f0f\uff0c\u598216\u5b57\u8282\u5bf9\u9f50\u3002</li> </ul> </li> <li>\u7cfb\u7edf\u8c03\u7528\uff1a<ul> <li>\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u7cfb\u7edf\u8c03\u7528\u662f\u901a\u8fc7\u7279\u5b9a\u7684\u6307\u4ee4\u548c\u5bc4\u5b58\u5668\u8fdb\u884c\u7684\u3002ABI\u5b9a\u4e49\u4e86\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7\u548c\u53c2\u6570\u3002\u4f8b\u5982\uff0c<code>a7</code>\u5bc4\u5b58\u5668\u53ef\u80fd\u88ab\u7528\u4e8e\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u800c\u5176\u4ed6\u5bc4\u5b58\u5668\u7528\u4e8e\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\u3002</li> </ul> </li> <li>\u6d6e\u70b9\u652f\u6301\uff1a<ul> <li>\u5982\u679cRISC-V\u5904\u7406\u5668\u652f\u6301\u6d6e\u70b9\u64cd\u4f5c\uff0cABI\u5c06\u5b9a\u4e49\u5982\u4f55\u4f20\u9012\u6d6e\u70b9\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u6d6e\u70b9\u53c2\u6570\u53ef\u80fd\u901a\u8fc7\u6d6e\u70b9\u5bc4\u5b58\u5668<code>fa0</code>, <code>fa1</code>\u7b49\u4f20\u9012\u3002</li> </ul> </li> <li>C\u5e93\u51fd\u6570\u7684\u7279\u5b9a\u884c\u4e3a\uff1a<ul> <li>ABI\u53ef\u80fd\u89c4\u5b9a\u4e86C\u5e93\u4e2d\u67d0\u4e9b\u51fd\u6570\u7684\u7279\u5b9a\u884c\u4e3a\u3002\u4f8b\u5982\uff0c<code>strlen</code>\u51fd\u6570\u7684\u5b9e\u73b0\u9700\u8981\u9075\u5faaABI\u4e2d\u5173\u4e8e\u5185\u5b58\u8bbf\u95ee\u7684\u89c4\u5219\uff0c\u4ee5\u786e\u4fdd\u6b63\u786e\u5730\u8ba1\u7b97\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</li> </ul> </li> <li>\u4e8c\u8fdb\u5236\u683c\u5f0f\uff1a<ul> <li>\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\u901a\u5e38\u4f7f\u7528ELF\uff08Executable and Linkable Format\uff09\u683c\u5f0f\u3002ABI\u5b9a\u4e49\u4e86ELF\u6587\u4ef6\u7684\u5e03\u5c40\uff0c\u5305\u62ec\u5982\u4f55\u5b58\u50a8\u7b26\u53f7\u8868\u3001\u91cd\u5b9a\u4f4d\u4fe1\u606f\u548c\u5176\u4ed6\u5143\u6570\u636e\u3002</li> </ul> </li> <li>C\u5e93\u4f5c\u4e3a\u7cfb\u7edf\u7ea7\u63a5\u53e3\uff1a<ul> <li>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0cC\u5e93\u51fd\u6570\u53ef\u80fd\u88ab\u7528\u4f5c\u7cfb\u7edf\u7ea7\u63a5\u53e3\u3002\u4f8b\u5982\uff0c<code>malloc</code>\u548c<code>free</code>\u51fd\u6570\u53ef\u80fd\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u4ee5\u7ba1\u7406\u52a8\u6001\u5185\u5b58\u5206\u914d\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cABI\u53ef\u80fd\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u51fd\u6570\u7684\u63a5\u53e3\u548c\u884c\u4e3a\u3002</li> </ul> </li> </ol> <p>\u4e00\u4e9b\u6587\u6863\uff1aC Library - OSDev Wiki</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#toolchain-example","title":"Toolchain example","text":"<p>\u4e0d\u7ba1\u662f\u88f8\u673a\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fearm-none-eabi\uff0c\u8fd8\u662fLinux\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fearm-linux-gnueabi\uff0c\u5176\u5b9e\u6ca1\u6709\u672c\u8d28\u7684\u533a\u522b\uff0c\u5de5\u5177\u94fe\u90fd\u80fd\u7f16\u8bd1\u6210\u76f8\u5e94\u67b6\u6784\u7684\u6307\u4ee4\u3001\u94fe\u63a5\u751f\u6210\u53ef\u6267\u884c\u4ee3\u7801\u3002\u53ea\u4e0d\u8fc7</p> <p>arm-none-eabi\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u975eLinux\u63a5\u53e3\u7684C\u5e93\uff0c\u9002\u5408\u4e8e\u88f8\u673a\u5f00\u53d1\uff0c\u65e0\u6cd5\u5f00\u53d1\u57fa\u4e8eLinux\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>arm-linux-gnueabi\u9ed8\u8ba4\u4f7f\u7528\u7684\u662fLinux\u63a5\u53e3\u7684C\u5e93\uff0c\u9002\u5408\u4e8eLinux\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5982\u679c\u7528C\u8bed\u8a00\u5f00\u53d1\uff0c\u5982\u679c\u91cd\u65b0\u5b9e\u73b0C\u5e93\u5f80\u5f80\u4e0d\u73b0\u5b9e\uff0c\u9700\u8981\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u652f\u6301\u6807\u51c6C\u5e93\u3002</p> <p>\u5bf9\u4e8earm\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u4e00\u822c\u4f1a\u652f\u6301\u4e09\u4e2a\u6700\u57fa\u672c\u7684\u5e93(\u9759\u6001\u5e93\u4e3a\u4f8b)\uff1alibgcc.a\u3001 libc.a\u3001 libm.a\u3002</p> <p>SofTool.CN Notes: libgcc.a \uff1a \u5728\u7f16\u8bd1gcc\u65f6\u4ea7\u751f\uff0c\u63d0\u4f9b\u5e73\u53f0\u76f8\u5173\u7684\u5e95\u5c42\u8fd0\u884c\u5e93\uff0c\u5927\u591a\u6570\u7528\u4e8e\u76ee\u6807\u5904\u7406\u5668\u7684\u7b97\u672f\u8fd0\u7b97\u3002\u5982\u5bf9\u4e8earm9\uff0c\u4e0d\u652f\u6301\u786c\u4ef6\u9664\u6cd5\uff0c\u786c\u4ef6\u6d6e\u70b9\uff0c\u4ee3\u7801\u4e2d\u4efb\u4f55\u9664\u6cd5\u3001\u6d6e\u70b9\u76f8\u5173\u64cd\u4f5c\u90fd\u5e94\u8be5\u53bb\u94fe\u63a5libgcc.a\uff0c\u7531libgcc.a\u63d0\u4f9b\u9664\u6cd5\u3001\u6d6e\u70b9\u64cd\u4f5c\u7684\u8f6f\u4ef6\u6a21\u62df\u5b9e\u73b0\u3002\u4f46\u5bf9\u4e8e\u652f\u6301\u786c\u4ef6\u9664\u6cd5\u3001\u786c\u4ef6\u6d6e\u70b9\u7684cortex-a\u67b6\u6784cpu\uff0c\u65e0\u9700libgcc.a\u63d0\u4f9b\u8f6f\u5b9e\u73b0\uff0c\u7f16\u8bd1\u5668\u76f4\u63a5\u751f\u6210\u9664\u6cd5\u6216\u6d6e\u70b9\u6307\u4ee4\uff0c\u5904\u7406\u901f\u5ea6\u662f\u8f6f\u5b9e\u73b0\u8fdc\u8fdc\u4e0d\u53ca\u7684\u3002 libc.a \uff1a C\u8bed\u8a00\u6807\u51c6\u51fd\u6570\u5e93 libm.a \uff1a \u6570\u5b66\u5904\u7406\u5e93</p> <p>\u7528\u4e8e\u88f8\u673a\u5f00\u53d1\u4ee5\u53ca\u7528\u4e8eLinux\u5e94\u7528\u5f00\u53d1\u7684Arm\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u5b9e\u8d28\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u91c7\u7528\u5e93\u7684\u7b56\u7565\u5dee\u5f02\u3002\u7406\u8bba\u4e0a\u53ea\u8981\u7528\u88f8\u673a\u5f00\u53d1\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7f16\u8bd1\u4e00\u4e2a\u57fa\u4e8e\u67d0\u4e2aLinux\u5185\u6838\u5934\u7684C\u5e93(\u5982: glibc)\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5b9e\u73b0Linux\u5e94\u7528\u7a0b\u5e8f\u7684\u7f16\u7a0b\u3002\u540c\u6837\uff0cLinux\u5e94\u7528\u5f00\u53d1\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u53ea\u8981\u518d\u7f16\u8bd1\u4e00\u4e2a\u57fa\u4e8e\u88f8\u673a\u5f00\u53d1\u7684C\u5e93(\u5982: newlib)\uff0c\u5373\u53ef\u5b9e\u73b0\u6807\u51c6\u7684\u88f8\u673a\u7f16\u7a0b\uff0c\u4e0ewindows\u4e0bmdk\u3001iar\u7b49\u88f8\u673a\u5f00\u53d1\u65e0\u5f02\u3002</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#_2","title":"\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u539f\u7406","text":"<p>https://crosstool-ng.github.io/Adocs/toolchain-construction/</p> <p>\u52a0\u62ff\u5927\u7f16\u8bd1\u3002</p> <p>The key to cross compiling is understanding what these terms means in relation to the different types of things that you will be building.</p> <p>Build machine: where the code is built Host machine: where the built code runs Target machine (only relevant for compiler tools): where the binaries spit out by the built code runs</p> <p>Again, target triples will be used to describe these systems.</p> <p>e.g. Lets say I am using a Linux PC (x86_64-linux-gnu) to cross compile a CMake application called \u201cAwesome\u201d to run on a BeagleBone Black SBC (armv7-linux-gnueabihf) using a GCC cross compiler. In this example:</p> <pre><code>| Component |    Type     | Build  |  Host  | Target |\n|-----------|-------------|--------|--------|--------|\n| GCC       | Compiler    | x86_64 | x86_64 | armv7  |\n| CMake     | Build tool  | x86_64 | x86_64 | N/A    |\n| Awesome   | Application | x86_64 | armv7  | N/A    |\n</code></pre> <p>Your key take away here should be that the build/host/target label changes depending on what you are building. A common n00b mistake is to use the same host/target triple values used to build GCC when building applications that run on your embedded device, like for example Busybox. In this example the host for GCC is x86 but the host for Busybox is ARM. Understanding this fundamental is half the battle of cross compiling!</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#project-example","title":"Project example","text":"<p>\u4ea4\u53c9\u7f16\u8bd1\u5b66\u4e60\u7b14\u8bb0\uff08\u4e8c\uff09\u2014\u2014\u4ea4\u53c9\u7f16\u8bd1\u5668\u7684\u547d\u540d\u89c4\u5219-\u817e\u8baf\u4e91\u5f00\u53d1\u8005\u793e\u533a-\u817e\u8baf\u4e91 (tencent.com)</p> <p>\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u5305\u62ec\u54ea\u4e9b\uff1f</p> <p>Arm Compiler Software Development Guide</p> <ol> <li> <p>C\u5e93\u5305\u62ec\u54ea\u4e9b\uff1f</p> <p>newlibc\uff1fglibc\uff1fmusl\uff1f</p> <p>How a toolchain is constructed (crosstool-ng.github.io)</p> </li> <li> <p>C\u6807\u51c6\u5e93\u548c\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u5173\u7cfb</p> <p>\u7f16\u8bd1\u5de5\u5177\u94fe\u5305\u62ec\u4e86C\u6807\u51c6\u5e93\uff1f</p> </li> <li> <p>abi\u662f\u4ec0\u4e48\uff1f\u80fd\u4e0d\u80fd\u4e3e\u4e00\u4e9b\u5177\u4f53\u4f8b\u5b50\uff1feabi\u5462</p> <p>C\u5e93\u548cABI\u4e4b\u95f4\u7684\u5173\u7cfb\uff1f</p> </li> <li> <p>\u600e\u4e48\u5728\u88f8\u673a\u4e0a\u79fb\u690d\u6807\u51c6\u5e93\uff1fC\u8bed\u8a00\uff1f</p> <p>02_\u6784\u5efa\u6807\u51c6C\u5e93newlib - Linux \u5d4c\u5165\u5f0f\u5f00\u53d1 (softool.cn)</p> <p>\u5982\u4f55\u628a C \u8bed\u8a00\u79fb\u690d\u5230 RISC-V \u88f8\u673a\u4e0a (risehere.net)</p> <p>\u57fa\u4e8eRISC-V rv32i\u7684\u88f8\u673aC\u8bed\u8a00\u4ee3\u7801\u6267\u884c_riscv32-unknown-elf-objcopy-CSDN\u535a\u5ba2</p> <p>\u4e3a\u88f8\u673a\u7f16\u5199 C \u8bed\u8a00\u7a0b\u5e8f\uff0c\u4e0d\u80fd\u5f15\u7528\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\uff1f\u5982 printf</p> <p>\u5728\u88f8\u673a\u73af\u5883\u4e0b\u7f16\u5199C\u8bed\u8a00\u7a0b\u5e8f\u65f6\uff0c\u901a\u5e38\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\uff0c\u5982<code>printf</code>\uff0c\u539f\u56e0\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\uff1a\u88f8\u673a\u73af\u5883\u610f\u5473\u7740\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u652f\u6301\u3002\u6807\u51c6\u5e93\u4e2d\u7684\u8bb8\u591a\u51fd\u6570\uff0c\u5982<code>printf</code>\uff0c\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u4f8b\u5982\u8f93\u51fa\u6d41\u91cd\u5b9a\u5411\u548c\u8bbe\u5907\u7ba1\u7406\uff0c\u8fd9\u4e9b\u5728\u88f8\u673a\u73af\u5883\u4e2d\u662f\u4e0d\u53ef\u7528\u7684\u3002</p> </li> <li> <p>\u7f3a\u4e4f\u5e93\u5b9e\u73b0\uff1a\u5728\u88f8\u673a\u73af\u5883\u4e2d\uff0c\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5e93\u5b9e\u73b0\uff0c\u56e0\u6b64\u5373\u4f7f\u4ee3\u7801\u4e2d\u8c03\u7528\u4e86<code>printf</code>\uff0c\u7f16\u8bd1\u5668\u4e5f\u65e0\u6cd5\u627e\u5230\u5176\u5b9e\u73b0\uff0c\u5bfc\u81f4\u94fe\u63a5\u9519\u8bef\u3002</p> </li> <li> <p>\u8d44\u6e90\u9650\u5236\uff1a\u88f8\u673a\u73af\u5883\u901a\u5e38\u8d44\u6e90\u6709\u9650\uff0c\u800c\u6807\u51c6\u5e93\u51fd\u6570\u53ef\u80fd\u4f1a\u5360\u7528\u8f83\u591a\u7684\u5185\u5b58\u548c\u5904\u7406\u80fd\u529b\u3002\u5728\u8d44\u6e90\u53d7\u9650\u7684\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u53ef\u80fd\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002</p> </li> <li> <p>\u786c\u4ef6\u4f9d\u8d56\u6027\uff1a\u88f8\u673a\u7a0b\u5e8f\u76f4\u63a5\u4e0e\u786c\u4ef6\u4ea4\u4e92\u3002\u4f8b\u5982\uff0c<code>printf</code>\u51fd\u6570\u901a\u5e38\u9700\u8981\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff0c\u4f46\u5728\u88f8\u673a\u73af\u5883\u4e2d\uff0c\u53ef\u80fd\u6ca1\u6709\u63a7\u5236\u53f0\u8bbe\u5907\uff0c\u800c\u662f\u9700\u8981\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\uff08\u5982UART\u6216LCD\u63a7\u5236\u5668\uff09\u6765\u5b9e\u73b0\u8f93\u51fa\u3002</p> </li> <li> <p>\u521d\u59cb\u5316\u8fc7\u7a0b\uff1a\u8bb8\u591a\u6807\u51c6\u5e93\u51fd\u6570\u5728\u7b2c\u4e00\u6b21\u8c03\u7528\u524d\u9700\u8981\u521d\u59cb\u5316\u3002\u5728\u88f8\u673a\u73af\u5883\u4e2d\uff0c\u8fd9\u79cd\u521d\u59cb\u5316\u901a\u5e38\u9700\u8981\u7a0b\u5e8f\u5458\u624b\u52a8\u5b8c\u6210\uff0c\u6216\u8005\u5b8c\u5168\u907f\u514d\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u3002</p> </li> <li> <p>\u53ef\u9884\u6d4b\u6027\uff1a\u5728\u5b9e\u65f6\u7cfb\u7edf\u4e2d\uff0c\u7a0b\u5e8f\u7684\u884c\u4e3a\u9700\u8981\u9ad8\u5ea6\u53ef\u9884\u6d4b\u3002\u6807\u51c6\u5e93\u51fd\u6570\u53ef\u80fd\u4f1a\u5f15\u5165\u975e\u786e\u5b9a\u6027\u884c\u4e3a\uff0c\u5982\u52a8\u6001\u5185\u5b58\u5206\u914d\u548c\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u5728\u5b9e\u65f6\u7cfb\u7edf\u4e2d\u662f\u4e0d\u53ef\u53d6\u7684\u3002</p> </li> </ol> <p>\u5c3d\u7ba1\u5982\u6b64\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u5728\u88f8\u673a\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e00\u4e9b\u6807\u51c6\u5e93\u51fd\u6570\uff0c\u4f46\u901a\u5e38\u9700\u8981\u8fdb\u884c\u7279\u5b9a\u7684\u914d\u7f6e\u548c\u4fee\u6539\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u4f7f\u7528\u88f8\u673a\u5e93\u7248\u672c\uff1a\u4e00\u4e9b\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86\u4e13\u4e3a\u88f8\u673a\u73af\u5883\u8bbe\u8ba1\u7684\u5e93\u7248\u672c\uff0c\u5982newlib\u7684nano\u7248\u672c\u6216mingw-libgcc\u3002</li> <li>\u81ea\u5df1\u5b9e\u73b0\u51fd\u6570\uff1a\u4f60\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u6240\u9700\u7684\u5e93\u51fd\u6570\uff0c\u4f8b\u5982\uff0c\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684<code>printf</code>\u51fd\u6570\uff0c\u76f4\u63a5\u5411UART\u6216\u5176\u4ed6\u786c\u4ef6\u63a5\u53e3\u53d1\u9001\u6570\u636e\u3002</li> <li>\u9759\u6001\u5185\u5b58\u5206\u914d\uff1a\u907f\u514d\u4f7f\u7528\u52a8\u6001\u5185\u5b58\u5206\u914d\u51fd\u6570\uff0c\u5982<code>malloc</code>\u548c<code>free</code>\uff0c\u6539\u7528\u9759\u6001\u6216\u5168\u5c40\u53d8\u91cf\u3002</li> <li>\u7b80\u5316\u7684I/O\u64cd\u4f5c\uff1a\u4f7f\u7528\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0I/O\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u4f9d\u8d56\u4e8e\u6807\u51c6\u5e93\u4e2d\u7684\u6587\u4ef6\u6d41\u64cd\u4f5c\u51fd\u6570\u3002</li> </ul> <p>\u603b\u4e4b\uff0c\u5728\u88f8\u673a\u7f16\u7a0b\u4e2d\uff0c\u7a0b\u5e8f\u5458\u9700\u8981\u5bf9\u7a0b\u5e8f\u7684\u884c\u4e3a\u6709\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\uff0c\u5e76\u4e14\u901a\u5e38\u9700\u8981\u907f\u514d\u4f7f\u7528\u6807\u51c6\u5e93\u4e2d\u90a3\u4e9b\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u51fd\u6570\u3002</p> </li> </ol>"},{"location":"Complex%20issues/Toolchains/toolchain.html#ways-to-cross-compile","title":"Ways to cross compile","text":"<p>Now that we have covered the fundamentals, lets jump to the actual how-to</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#1-with-a-standalone-toolchain","title":"1. With a standalone toolchain","text":"<p>This is the manual, traditional way to cross build.</p> <p>Step one: Get a toolchain. You can get a precompiled toolchain from your silicon vendor (e.g. for BeagleBone black) or from a project like Linaro. Alternatively you can build one yourself with something like crosstool-ng.</p> <p>Step two: Install any host tools that will be required (e.g. CMake)</p> <p>Step three: Cross build and install any libraries that will be required (e.g. OpenSSL, SQLite, etc..). You will need to install the compile time dependencies (i.e. headers and static libs) to the toolchain\u2019s sysroot and install any runtime dependencies (i.e. shared libs) on the target device. Note that you can and should avoid the runtime dependencies by preferring to statically link your dependencies.</p> <p>Pro tips:</p> <ul> <li>Use a Docker image for the cross building. It helps to isolate the various host tools and libraries needed so that you don\u2019t accidentally brick your work laptop by installing an ARM build of OpenSSL on your PC. Definitely not a personal experience \ud83d\ude1b</li> <li>Modern languages like Rust and GO lang have \u201cin-built\u201d support for cross compiling and is generally very easy to setup.</li> <li>If you are actively developing a C++/CMake applications, try using Conan. It helps a lot to abstract the cross building process, making the build process less error prone and repeatable. It has the added advantage making onboarding easier.</li> </ul>"},{"location":"Complex%20issues/Toolchains/toolchain.html#2-with-an-embedded-build-system-yocto-or-buildroot","title":"2. With an Embedded build system: Yocto or Buildroot","text":"<p>I will admit that this is akin to using a bazooka to kill a fly. But then, if you already have a bazooka lying around, it\u2019s not the worst idea in the world.</p> <p>An embedded build system\u2019s primary job is to build a custom distro or root filesystem for an embedded device. This involves cross compiling numerous applications. So you can leverage the same build infrastructure to do your standalone cross builds as well.</p> <p>The chances are high that someone has already added support for what you are trying to build in Yocto or buildroot. Which means that the build configuration and dependencies are already available. This can be a life saver for packages with complex dependencies or for packages that need a lot of configuration updates to support cross builds. The obvious con here is that it is a lot harder to setup; especially if you have no prior experience with these build systems.</p>"},{"location":"Complex%20issues/Toolchains/toolchain.html#3-build-on-qemu","title":"3. Build on QEMU","text":"<p>Here is a neat trick! You can cheat with an ARM QEMU virtual machine on your developer machine to do \u201cnative\u201d builds that will produce binaries that will run on your target embedded device. Take care to configure the QEMU hardware and the native toolchain that you will be using to match with your target device. Also, be aware that the build speed won\u2019 t be great due to the ARM to x86 translation. But otherwise this is a totally viable option, especially for esoteric packages/build systems that has no support for cross compiling.</p> <p>DevOps for Embedded C/C++. How to spot and fix the red flags in\u2026 | by Ruvinda Dhambarage | Medium</p>"},{"location":"Course/GeekTime/%E6%89%8B%E5%86%99python%E8%99%9A%E6%8B%9F%E6%9C%BA/first.html","title":"First","text":"<p>\u5173\u4e8epython \u865a\u62df\u673a\u7684\u5b9e\u73b0\uff0c\u5176\u5185\u5bb9/\u6982\u5ff5\uff1a</p> <p>CPython\u53ef\u4ee5\u7406\u89e3\u4e3a\u662fC\u8bed\u8a00\u5b9e\u73b0\u7684python runtime\u73af\u5883\u5417\uff08\u6216\u8005\u8bf4CPython\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u79cdpython\u865a\u62df\u673a\uff1f\uff09\uff1fCPthon\u4e2d\u7684\u7f16\u8bd1\u5668\u5c06py\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff08.pyc\u6587\u4ef6\uff09\uff0c\u7136\u540eCPython\u4e2d\u7684\u89e3\u91ca\u5668\u518d\u5c06\u5b57\u8282\u7801\u6267\u884c\uff1f</p> <ol> <li>CPython \u4f5c\u4e3a Python Runtime \u73af\u5883\uff1a</li> <li> <p>CPython \u662f\u7528 C \u8bed\u8a00\u7f16\u5199\u7684\uff0c\u5b83\u662f Python \u8bed\u8a00\u7684\u5b98\u65b9\u5b9e\u73b0\u3002\u5b83\u63d0\u4f9b\u4e86 Python \u8bed\u8a00\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u5305\u62ec\u5185\u5b58\u7ba1\u7406\u3001\u5783\u573e\u56de\u6536\u3001\u5bf9\u8c61\u6a21\u578b\u7b49\u6838\u5fc3\u529f\u80fd\u3002\u5728\u8fd9\u4e2a\u73af\u5883\u4e2d\uff0cPython \u4ee3\u7801\u5f97\u4ee5\u6267\u884c\u3002</p> </li> <li> <p>CPython \u4f5c\u4e3a Python \u865a\u62df\u673a\uff1a</p> </li> <li> <p>\u53ef\u4ee5\u5c06 CPython \u89c6\u4e3a\u4e00\u79cd Python \u865a\u62df\u673a\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u6267\u884c Python \u4ee3\u7801\u6240\u9700\u7684\u6240\u6709\u57fa\u7840\u8bbe\u65bd\u3002\u8fd9\u4e2a\u865a\u62df\u673a\u8d1f\u8d23\u7ba1\u7406 Python \u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u5305\u62ec\u5b57\u8282\u7801\u7684\u6267\u884c\u3001\u5185\u5b58\u5206\u914d\u3001\u5783\u573e\u56de\u6536\u7b49\u3002</p> </li> <li> <p>CPython \u4e2d\u7684\u7f16\u8bd1\u8fc7\u7a0b\uff1a</p> </li> <li> <p>\u5728 CPython \u4e2d\uff0c\u5185\u7f6e\u4e86\u4e00\u4e2a\u7f16\u8bd1\u5668\uff0c\u5b83\u8d1f\u8d23\u5c06 <code>.py</code> \u6587\u4ef6\u4e2d\u7684\u6e90\u4ee3\u7801\u8f6c\u6362\u6210\u5b57\u8282\u7801\u3002\u8fd9\u4e2a\u7f16\u8bd1\u8fc7\u7a0b\u662f\u81ea\u52a8\u8fdb\u884c\u7684\uff0c\u5f53\u60a8\u8fd0\u884c\u4e00\u4e2a Python \u811a\u672c\u65f6\uff0cCPython \u4f1a\u81ea\u52a8\u5c06\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u3002</p> </li> <li> <p>CPython \u4e2d\u7684\u89e3\u91ca\u6267\u884c\u8fc7\u7a0b\uff1a</p> </li> <li>\u7f16\u8bd1\u751f\u6210\u7684\u5b57\u8282\u7801\u968f\u540e\u7531 CPython \u7684\u89e3\u91ca\u5668\u6267\u884c\u3002\u8fd9\u4e2a\u89e3\u91ca\u5668\u9010\u884c\u89e3\u91ca\u5e76\u6267\u884c\u5b57\u8282\u7801\uff0c\u5c06\u5176\u8f6c\u6362\u6210\u673a\u5668\u7801\u5e76\u8fd0\u884c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u52a8\u6001\u7684\uff0c\u5373\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u8fdb\u884c\u3002</li> </ol> <p>\u56e0\u6b64\uff0cCPython \u65e2\u5305\u542b\u4e86\u7f16\u8bd1\u5668\u7684\u529f\u80fd\uff08\u5c06\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff09\uff0c\u4e5f\u5305\u542b\u4e86\u89e3\u91ca\u5668\u7684\u529f\u80fd\uff08\u6267\u884c\u5b57\u8282\u7801\uff09\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97 CPython \u80fd\u591f\u63d0\u4f9b\u8de8\u5e73\u53f0\u6267\u884c\u7684\u80fd\u529b\uff0c\u540c\u65f6\u4fdd\u6301\u4e86 Python \u8bed\u8a00\u7684\u52a8\u6001\u7279\u6027\u548c\u7075\u6d3b\u6027\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0cCPython \u662f\u7528 C \u8bed\u8a00\u5b9e\u73b0\u7684 Python \u8fd0\u884c\u65f6\u73af\u5883\uff0c\u4e5f\u53ef\u4ee5\u88ab\u89c6\u4e3a\u4e00\u79cd Python \u865a\u62df\u673a\u3002\u5b83\u8d1f\u8d23\u7f16\u8bd1\u6e90\u4ee3\u7801\u548c\u6267\u884c\u5b57\u8282\u7801\uff0c\u63d0\u4f9b\u4e86 Python \u7a0b\u5e8f\u8fd0\u884c\u6240\u9700\u7684\u5168\u90e8\u529f\u80fd\u3002</p> <p>\u90a3\u8fd9\u79cd\u65b9\u5f0f\u53c8\u548c\u4f20\u7edf\u7684C/C++\u7f16\u8bd1\u4f53\u7cfb\u7684\u533a\u522b\uff1f\u5bf9\u4e8eC/C++\uff0c\u9884\u5904\u7406\u5668\u3001\u8bcd\u6cd5\u5206\u6790\u3001\u6587\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u3001\u5e73\u53f0\u6709\u5173/\u65e0\u5173\u4f18\u5316\u3001\u6307\u4ee4\u9009\u62e9\u3001\u8c03\u5ea6\u548c\u5bc4\u5b58\u5668\u5206\u914d\uff08\u597d\u50cf\u8fd8\u6709C\u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b\uff1a\u9884\u5904\u7406\u5668\u3001\u7f16\u8bd1\u3001\u6c47\u7f16\u3001\u8fde\u63a5\u3001\u88c5\u8f7d\u3002\u8fd9\u4e2a\u548c\u4e0a\u9762\u5173\u7cfb/\u533a\u522b\uff1f\uff09 \u800cpython\u53c8\u662f\u4ec0\u4e48\u6837\u7684\u7f16\u8bd1\u4f53\u7cfb\u5462\uff1f\u548c\u4e0a\u9762\u7684C/C++\u7f16\u8bd1\u4f53\u7cfb\u7684\u5f02\u540c\uff1f\u524d\u7aef\u5e94\u8be5\u7c7b\u4f3c\uff1f</p> <p>\u786e\u5b9e\uff0cPython \u548c\u4f20\u7edf\u7684 C/C++ \u7f16\u8bd1\u4f53\u7cfb\u5728\u7f16\u8bd1\u548c\u6267\u884c\u6d41\u7a0b\u4e0a\u6709\u4e00\u4e9b\u663e\u8457\u7684\u4e0d\u540c\u3002\u8ba9\u6211\u4eec\u5148\u56de\u987e\u4e00\u4e0b C/C++ \u7684\u7f16\u8bd1\u6d41\u7a0b\uff0c\u7136\u540e\u5bf9\u6bd4 Python \u7684\u7f16\u8bd1\u4f53\u7cfb\u3002</p>"},{"location":"Course/GeekTime/%E6%89%8B%E5%86%99python%E8%99%9A%E6%8B%9F%E6%9C%BA/first.html#cc","title":"C/C++ \u7f16\u8bd1\u6d41\u7a0b\uff1a","text":"<ol> <li>\u9884\u5904\u7406\u5668\uff08Preprocessor\uff09\uff1a</li> <li> <p>\u5904\u7406\u6e90\u4ee3\u7801\u4e2d\u7684\u9884\u5904\u7406\u6307\u4ee4\uff0c\u5982\u5b8f\u5b9a\u4e49\u7684\u5c55\u5f00\u3001\u6761\u4ef6\u7f16\u8bd1\u6307\u4ee4\u3001\u6587\u4ef6\u5305\u542b\u7b49\u3002</p> </li> <li> <p>\u7f16\u8bd1\u5668\u524d\u7aef\uff08Front End\uff09\uff1a</p> </li> <li>\u5305\u62ec\u8bcd\u6cd5\u5206\u6790\uff08Lexical Analysis\uff09\uff1a\u5c06\u6e90\u4ee3\u7801\u8f6c\u6362\u6210\u4e00\u7cfb\u5217\u7684\u6807\u8bb0\uff08Tokens\uff09\u3002</li> <li>\u8bed\u6cd5\u5206\u6790\uff08Syntax Analysis\uff09\uff1a\u6839\u636e\u8bed\u6cd5\u89c4\u5219\u5c06\u6807\u8bb0\u7ec4\u7ec7\u6210\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09\u3002</li> <li> <p>\u8bed\u4e49\u5206\u6790\uff08Semantic Analysis\uff09\uff1a\u68c0\u67e5\u7c7b\u578b\u3001\u4f5c\u7528\u57df\u7b49\u8bed\u4e49\u89c4\u5219\uff0c\u751f\u6210\u4e2d\u95f4\u8868\u793a\uff08IR\uff09\u3002</p> </li> <li> <p>\u7f16\u8bd1\u5668\u540e\u7aef\uff08Back End\uff09\uff1a</p> </li> <li>\u5305\u62ec\u4f18\u5316\uff08Optimization\uff09\uff1a\u5bf9\u4e2d\u95f4\u8868\u793a\u8fdb\u884c\u4f18\u5316\u3002</li> <li>\u6307\u4ee4\u9009\u62e9\uff08Instruction Selection\uff09\uff1a\u5c06\u4f18\u5316\u540e\u7684 IR \u8f6c\u6362\u6210\u7279\u5b9a\u5e73\u53f0\u7684\u673a\u5668\u7801\u3002</li> <li> <p>\u4ee3\u7801\u751f\u6210\uff08Code Generation\uff09\uff1a\u5305\u62ec\u8c03\u5ea6\u548c\u5bc4\u5b58\u5668\u5206\u914d\u7b49\u3002</p> </li> <li> <p>\u6c47\u7f16\uff08Assembly\uff09\uff1a</p> </li> <li> <p>\u5c06\u7f16\u8bd1\u5668\u751f\u6210\u7684\u6c47\u7f16\u4ee3\u7801\u8f6c\u6362\u6210\u673a\u5668\u7801\u3002</p> </li> <li> <p>\u94fe\u63a5\uff08Linking\uff09\uff1a</p> </li> <li> <p>\u5c06\u591a\u4e2a\u76ee\u6807\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\u94fe\u63a5\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> </li> <li> <p>\u88c5\u8f7d\uff08Loading\uff09\uff1a</p> </li> <li>\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</li> </ol>"},{"location":"Course/GeekTime/%E6%89%8B%E5%86%99python%E8%99%9A%E6%8B%9F%E6%9C%BA/first.html#python","title":"Python \u7f16\u8bd1\u4f53\u7cfb\uff1a","text":"<ol> <li>\u7f16\u8bd1\u5668\u524d\u7aef\uff08Front End\uff09\uff1a</li> <li> <p>\u7c7b\u4f3c\u4e8e C/C++\uff0cPython \u4e5f\u6709\u8bcd\u6cd5\u5206\u6790\u548c\u8bed\u6cd5\u5206\u6790\u9636\u6bb5\uff0c\u5c06\u6e90\u4ee3\u7801\u8f6c\u6362\u6210 AST\u3002</p> </li> <li> <p>\u7f16\u8bd1\u5668\u540e\u7aef\uff08Back End\uff09\uff1a</p> </li> <li> <p>Python \u5c06 AST \u8f6c\u6362\u6210\u5b57\u8282\u7801\uff0c\u8fd9\u662f\u4e00\u79cd\u4e2d\u95f4\u72b6\u6001\u7684\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8f6c\u6362\u6210\u673a\u5668\u7801\u3002</p> </li> <li> <p>\u5b57\u8282\u7801\u4f18\u5316\uff1a</p> </li> <li> <p>Python \u53ef\u4ee5\u5bf9\u5b57\u8282\u7801\u8fdb\u884c\u4f18\u5316\uff0c\u4f8b\u5982\u4f7f\u7528 <code>peephole</code> \u4f18\u5316\u3002</p> </li> <li> <p>\u5b57\u8282\u7801\u6267\u884c\uff1a</p> </li> <li> <p>\u5b57\u8282\u7801\u7531 Python \u89e3\u91ca\u5668\u6267\u884c\uff0c\u89e3\u91ca\u5668\u9010\u884c\u89e3\u91ca\u5e76\u6267\u884c\u5b57\u8282\u7801\uff0c\u5c06\u5176\u8f6c\u6362\u6210\u673a\u5668\u7801\u5e76\u8fd0\u884c\u3002</p> </li> <li> <p>\u52a8\u6001\u7f16\u8bd1\uff1a</p> </li> <li>Python \u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u7f16\u8bd1\u6e90\u4ee3\u7801\uff0c\u8fd9\u610f\u5473\u7740\u5728\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u65b0\u7684\u6216\u4fee\u6539\u8fc7\u7684\u4ee3\u7801\u53ef\u4ee5\u88ab\u7f16\u8bd1\u548c\u6267\u884c\u3002</li> </ol>"},{"location":"Course/GeekTime/%E6%89%8B%E5%86%99python%E8%99%9A%E6%8B%9F%E6%9C%BA/first.html#_1","title":"\u5f02\u540c\u70b9\uff1a","text":"<ul> <li>\u7f16\u8bd1\u76ee\u6807\uff1aC/C++ \u76f4\u63a5\u7f16\u8bd1\u6210\u673a\u5668\u7801\uff0c\u800c Python \u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff0c\u8fd9\u662f\u4e00\u79cd\u5e73\u53f0\u65e0\u5173\u7684\u4e2d\u95f4\u4ee3\u7801\u3002</li> <li>\u6267\u884c\u65f6\u673a\uff1aC/C++ \u7684\u7f16\u8bd1\u8fc7\u7a0b\u5728\u7a0b\u5e8f\u8fd0\u884c\u524d\u5b8c\u6210\uff0c\u800c Python \u7684\u5b57\u8282\u7801\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u6267\u884c\u3002</li> <li>\u4f18\u5316\uff1aC/C++ \u7684\u4f18\u5316\u901a\u5e38\u5728\u7f16\u8bd1\u65f6\u5b8c\u6210\uff0c\u800c Python \u7684\u4f18\u5316\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\uff0c\u4f8b\u5982\u901a\u8fc7\u5373\u65f6\u7f16\u8bd1\uff08JIT\uff09\u6280\u672f\u3002</li> <li>\u52a8\u6001\u6027\uff1aPython \u7684\u8fd0\u884c\u65f6\u73af\u5883\u66f4\u52a0\u52a8\u6001\uff0c\u652f\u6301\u52a8\u6001\u7c7b\u578b\u68c0\u67e5\u548c\u4ee3\u7801\u4fee\u6539\uff0c\u800c C/C++ \u5728\u7f16\u8bd1\u65f6\u5927\u90e8\u5206\u7c7b\u578b\u548c\u7ed3\u6784\u5df2\u7ecf\u786e\u5b9a\u3002</li> <li>\u8de8\u5e73\u53f0\uff1aPython \u7684\u5b57\u8282\u7801\u53ef\u4ee5\u5728\u4efb\u4f55\u652f\u6301 Python \u89e3\u91ca\u5668\u7684\u5e73\u53f0\u4e0a\u8fd0\u884c\uff0c\u800c C/C++ \u7684\u673a\u5668\u7801\u662f\u4e0e\u5e73\u53f0\u76f8\u5173\u7684\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0cPython \u7684\u7f16\u8bd1\u4f53\u7cfb\u66f4\u52a0\u7075\u6d3b\u548c\u52a8\u6001\uff0c\u800c C/C++ \u7684\u7f16\u8bd1\u4f53\u7cfb\u5219\u66f4\u6ce8\u91cd\u6027\u80fd\u548c\u9759\u6001\u7c7b\u578b\u68c0\u67e5\u3002Python \u7684\u5b57\u8282\u7801\u548c\u865a\u62df\u673a\u6a21\u578b\u63d0\u4f9b\u4e86\u8de8\u5e73\u53f0\u6267\u884c\u7684\u80fd\u529b\uff0c\u800c C/C++ \u7684\u76f4\u63a5\u7f16\u8bd1\u5230\u673a\u5668\u7801\u5219\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u6027\u80fd\u4f18\u5316\u3002</p> <p>\u52a8\u6001\u7f16\u8bd1\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f</p>"},{"location":"Course/GeekTime/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1.html","title":"\u603b\u4f53\u8bbe\u8ba1","text":"<p>\u9996\u5148\u5927\u81f4\u5c06\u6211\u4eec\u7684\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5206\u4e3a\u4e09\u4e2a\u5927\u5c42\uff0c\u5206\u522b\u662f\uff1a</p> <ol> <li>\u5185\u6838\u63a5\u53e3\u5c42\u3002</li> <li>\u5185\u6838\u529f\u80fd\u5c42\u3002</li> <li> <p>\u5185\u6838\u786c\u4ef6\u5c42\u3002</p> </li> <li> <p>\u5185\u6838\u63a5\u53e3\u5c42\uff0c\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u63a5\u53e3\uff0c\u4e3b\u8981\u6709\u4e24\u70b9\u5185\u5bb9\uff0c\u5982\u4e0b\uff1a</p> <ol> <li>\u5b9a\u4e49\u4e86\u4e00\u5957 UNIX \u63a5\u53e3\u7684\u5b50\u96c6\uff0c\u6211\u4eec\u51fa\u4e8e\u5b66\u4e60\u548c\u7814\u7a76\u7684\u76ee\u7684\uff0c\u4f7f\u7528 UNIX \u63a5\u53e3\u7684\u5b50\u96c6\uff0c\u4f18\u70b9\u4e4b\u4e00\u662f\u63a5\u53e3\u5c11\uff0c\u53ea\u6709\u51e0\u4e2a\uff0c\u5e76\u4e14\u8fd9\u51e0\u4e2a\u63a5\u53e3\u53c8\u80fd\u5927\u81f4\u5b9a\u4e49\u51fa\u64cd\u4f5c\u7cfb\u7edf\u7684\u529f\u80fd\u3002</li> <li>\u8fd9\u5957\u63a5\u53e3\u7684\u4ee3\u7801\uff0c\u5c31\u662f\u68c0\u67e5\u5176\u53c2\u6570\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u53c2\u6570\u6709\u95ee\u9898\u5c31\u8fd4\u56de\u76f8\u5173\u7684\u9519\u8bef\uff0c\u63a5\u7740\u8c03\u7528\u4e0b\u5c42\u5b8c\u6210\u529f\u80fd\u7684\u6838\u5fc3\u4ee3\u7801\u3002</li> </ol> </li> <li> <p>\u5185\u6838\u529f\u80fd\u5c42\uff0c\u4e3b\u8981\u5b8c\u6210\u5404\u79cd\u5b9e\u9645\u529f\u80fd\uff0c\u8fd9\u4e9b\u529f\u80fd\u6309\u7167\u5176\u7c7b\u522b\u53ef\u4ee5\u5206\u6210\u5404\u79cd\u6a21\u5757\uff0c\u5f53\u7136\u8fd9\u4e9b\u529f\u80fd\u6a21\u5757\u6700\u7ec8\u4f1a\u7528\u5177\u4f53\u7684\u7b97\u6cd5\u3001\u6570\u636e\u7ed3\u6784\u3001\u4ee3\u7801\u53bb\u5b9e\u73b0\u5b83\uff0c\u5185\u6838\u529f\u80fd\u5c42\u7684\u6a21\u5757\u5982\u4e0b\uff1a</p> <ol> <li>\u8fdb\u7a0b\u7ba1\u7406\uff0c\u4e3b\u8981\u662f\u5b9e\u73b0\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u8c03\u5ea6\u8fdb\u7a0b\uff0c\u5f53\u7136\u8fd9\u8981\u8bbe\u8ba1\u51e0\u5957\u6570\u636e\u7ed3\u6784\u7528\u4e8e\u8868\u793a\u8fdb\u7a0b\u548c\u7ec4\u7ec7\u8fdb\u7a0b\uff0c\u8fd8\u8981\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u8fdb\u7a0b\u8c03\u5ea6\u7b97\u6cd5\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\uff0c\u5728\u5185\u6838\u529f\u80fd\u5c42\u4e2d\u53ea\u6709\u5185\u5b58\u6c60\u7ba1\u7406\uff0c\u5206\u4e24\u79cd\u5185\u5b58\u6c60\uff1a\u9875\u9762\u5185\u5b58\u6c60\u548c\u4efb\u610f\u5927\u5c0f\u7684\u5185\u5b58\u6c60\uff0c\u4f60\u73b0\u5728\u53ef\u80fd\u4e0d\u660e\u767d\u4ec0\u4e48\u662f\u5185\u5b58\u6c60\uff0c\u8fd9\u91cc\u5148\u6709\u4e2a\u5370\u8c61\u5c31\u884c\uff0c\u540e\u9762\u8bfe\u7a0b\u7814\u7a76\u5b83\u7684\u65f6\u5019\u518d\u8be6\u7ec6\u4ecb\u7ecd\u3002</li> </ol> </li> <li> <p>\u5185\u6838\u786c\u4ef6\u5c42\uff0c\u4e3b\u8981\u5305\u62ec\u4e00\u4e2a\u5177\u4f53\u786c\u4ef6\u5e73\u53f0\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u5982\u4e0b\uff1a</p> <ol> <li>\u521d\u59cb\u5316\uff0c\u521d\u59cb\u5316\u4ee3\u7801\u662f\u5185\u6838\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u6700\u5148\u9700\u8981\u8fd0\u884c\u7684\u4ee3\u7801\uff0c\u4f8b\u5982\u521d\u59cb\u5316\u5c11\u91cf\u7684\u8bbe\u5907\u3001CPU\u3001\u5185\u5b58\u3001\u4e2d\u65ad\u7684\u63a7\u5236\u3001\u5185\u6838\u7528\u4e8e\u7ba1\u7406\u7684\u6570\u636e\u7ed3\u6784\u7b49\u3002</li> <li>CPU \u63a7\u5236\uff0c\u63d0\u4f9b CPU \u6a21\u5f0f\u8bbe\u5b9a\u3001\u5f00\u3001\u5173\u4e2d\u65ad\u3001\u8bfb\u5199 CPU \u7279\u5b9a\u5bc4\u5b58\u5668\u7b49\u529f\u80fd\u7684\u4ee3\u7801\u3002</li> <li>\u4e2d\u65ad\u5904\u7406\uff0c\u4fdd\u5b58\u4e2d\u65ad\u65f6\u673a\u5668\u7684\u4e0a\u4e0b\u6587\uff0c\u8c03\u7528\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\uff0c\u64cd\u4f5c\u4e2d\u65ad\u63a7\u5236\u5668\u7b49\u3002</li> <li>\u7269\u7406\u5185\u5b58\u7ba1\u7406\uff0c\u63d0\u4f9b\u5206\u914d\u3001\u91ca\u653e\u5927\u5757\u5185\u5b58\uff0c\u5185\u5b58\u7a7a\u95f4\u6620\u5c04\uff0c\u64cd\u4f5c MMU\u3001Cache \u7b49\u3002</li> <li>\u5e73\u53f0\u5176\u5b83\u76f8\u5173\u7684\u529f\u80fd\uff0c\u6709\u4e9b\u786c\u4ef6\u5e73\u53f0\u4e0a\u6709\u4e9b\u7279\u6b8a\u7684\u529f\u80fd\uff0c\u9700\u8981\u989d\u5916\u5904\u7406\u4e00\u4e0b\u3002</li> </ol> <p>\u5982\u679c\u4e0a\u8ff0\u6587\u5b57\u8ba9\u4f60\u770b\u5f97\u5934\u6655\uff0c\u6211\u4eec\u6765\u753b\u5e45\u56fe\uff0c\u53ef\u80fd\u5c31\u4f1a\u597d\u5f88\u591a\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u5f53\u7136\u8fd9\u91cc\u6ca1\u6709\u753b\u51fa\u7528\u6237\u7a7a\u95f4\u7684\u5e94\u7528\u8fdb\u7a0b\uff0cAPI \u63a5\u53e3\u4ee5\u4e0b\u7684\u4e3a\u5185\u6838\u7a7a\u95f4\uff0c\u8fd9\u624d\u662f\u8bbe\u8ba1\u3001\u5f00\u53d1\u5185\u6838\u7684\u91cd\u70b9\uff1a</p> </li> </ol> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html","title":"1. \u6307\u4ee4\u4e0e\u8fd0\u7b97","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#05","title":"05 | \u8ba1\u7b97\u673a\u6307\u4ee4\uff1a\u8ba9\u6211\u4eec\u8bd5\u8bd5\u7528\u7eb8\u5e26\u7f16\u7a0b","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#06-ifelsegoto","title":"06 | \u6307\u4ee4\u8df3\u8f6c\uff1a\u539f\u6765if...else\u5c31\u662fgoto","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#07-stack-overflow","title":"07 | \u51fd\u6570\u8c03\u7528\uff1a\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751fstack overflow\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_1","title":"\u5f15\u5165","text":"<p>\u51fd\u6570\u8c03\u7528\uff0c\u628a\u540e\u9762\u8981\u8df3\u56de\u6765\u6267\u884c\u7684\u6307\u4ee4\u5730\u5740\u7ed9\u8bb0\u5f55\u4e0b\u6765\uff0c\u50cf\u8bb2 PC \u5bc4\u5b58\u5668\u4e00\u6837\uff0c\u4e13\u95e8\u8bbe\u7acb\u4e00\u4e2a\u201c\u7a0b\u5e8f\u8c03\u7528\u5bc4\u5b58\u5668\u201d\uff0c\u6765\u5b58\u50a8\u63a5\u4e0b\u6765\u8981\u8df3\u8f6c\u56de\u6765\u6267\u884c\u7684\u6307\u4ee4\u5730\u5740\u3002\u7b49\u5230\u51fd\u6570\u8c03\u7528\u7ed3\u675f\uff0c\u4ece\u8fd9\u4e2a\u5bc4\u5b58\u5668\u91cc\u53d6\u51fa\u5730\u5740\uff0c\u518d\u8df3\u8f6c\u5230\u8fd9\u4e2a\u8bb0\u5f55\u7684\u5730\u5740\uff0c\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u4f46\u662f\u5bc4\u5b58\u5668\u662f\u4e0d\u591f\u7528\u7684\uff0c\u6240\u4ee5\u79d1\u5b66\u5bb6\u7684\u89e3\u51b3\u529e\u6cd5\uff1a\u5728\u5185\u5b58\u91cc\u9762\u5f00\u8f9f\u4e00\u6bb5\u7a7a\u95f4\uff0c\u7528\u6808\u8fd9\u4e2a\u540e\u8fdb\u5148\u51fa\uff08LIFO\uff0cLast In First Out\uff09\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u6808\u5c31\u50cf\u4e00\u4e2a\u4e52\u4e53\u7403\u6876\uff0c\u6bcf\u6b21\u7a0b\u5e8f\u8c03\u7528\u51fd\u6570\u4e4b\u524d\uff0c\u90fd\u628a\u8c03\u7528\u8fd4\u56de\u540e\u7684\u5730\u5740\u5199\u5728\u4e00\u4e2a\u4e52\u4e53\u7403\u4e0a\uff0c\u7136\u540e\u585e\u8fdb\u8fd9\u4e2a\u7403\u6876\u3002\u8fd9\u4e2a\u64cd\u4f5c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u538b\u6808\u3002\u5982\u679c\u51fd\u6570\u6267\u884c\u5b8c\u4e86\uff0c\u6211\u4eec\u5c31\u4ece\u7403\u6876\u91cc\u53d6\u51fa\u6700\u4e0a\u9762\u7684\u90a3\u4e2a\u4e52\u4e53\u7403\uff0c\u5f88\u663e\u7136\uff0c\u8fd9\u5c31\u662f\u51fa\u6808\u3002</p> <p>\u76f8\u5f53\u4e8e\u52a0\u5165\u4e86\u4e00\u4e2a\u201c\u8bb0\u5fc6\u201d\u7684\u529f\u80fd\uff0c\u80fd\u5728\u8df3\u8f6c\u53bb\u8fd0\u884c\u65b0\u7684\u6307\u4ee4\u4e4b\u540e\uff0c\u518d\u56de\u5230\u8df3\u51fa\u53bb\u7684\u4f4d\u7f6e\uff0c\u80fd\u591f\u5b9e\u73b0\u66f4\u52a0\u4e30\u5bcc\u548c\u7075\u6d3b\u7684\u6307\u4ee4\u6267\u884c\u6d41\u7a0b</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_2","title":"\u533a\u5206\u6808\u5e95\u548c\u6808\u9876\u7684\u95ee\u9898","text":"<p>\u8be6\u89c1\u81ea\u5df1\u7b14\u8bb0 \u300a\u8ba1\u7b97\u673a\u5e95\u5c42\u300b\u2014\u2014\u6808\u7684\u7406\u89e3</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#stack-overflow","title":"stack overflow","text":"<ul> <li>\u5982\u679c\u51fd\u6570\u8c03\u7528\u5c42\u6570\u592a\u591a\uff0c\u6211\u4eec\u5f80\u6808\u91cc\u538b\u5165\u5b83\u5b58\u4e0d\u4e0b\u7684\u5185\u5bb9\uff0c\u7a0b\u5e8f\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u5c31\u4f1a\u9047\u5230\u6808\u6ea2\u51fa\u7684\u9519\u8bef\uff0c\u8fd9\u5c31\u662f\u5927\u540d\u9f0e\u9f0e\u7684\u201cstack  overflow\u201d\u3002</li> <li>\u9012\u5f52\u5c42\u6570\u8fc7\u591a</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_3","title":"\u51fd\u6570\u5185\u8054\u4f18\u5316","text":"<p>\u7b80\u5355\u7406\u89e3\u8fd1\u4f3c\u4e3a\u5c06\u51fd\u6570\u5f53\u6210\u5b8f\u5c55\u5f00\uff0c\u4f46\u8fd8\u662f\u6709\u5dee\u5f02</p> <ul> <li> <p>\u64cd\u4f5c</p> <ul> <li> <p>\u7f16\u8bd1\u5668 -O\u4f18\u5316</p> <pre><code>$ gcc -g -c -O function_example_inline.c\n$ objdump -d -M intel -S function_example_inline.o\n</code></pre> </li> <li> <p>inline\u5173\u952e\u5b57</p> </li> </ul> </li> <li> <p>\u540e\u679c</p> <ul> <li> <p>\u51cf\u5c11\u51fd\u6570\u8c03\u7528\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u6027\u80fd\uff0cCPU\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\u53d8\u5c11\uff0c\u65e0\u9700\u6839\u636e\u5730\u5740\u8df3\u8f6c\u7684\u8fc7\u7a0b\u4e86\uff0c\u51cf\u5c11\u538b\u6808/\u51fa\u6808\u8fc7\u7a0b\uff0c</p> <p>Tips\uff1a\u4e3a\u4ec0\u4e48\u51cf\u5c11\u538b\u6808/\u51fa\u6808\u64cd\u4f5c\u80fd\u63d0\u5347\u6027\u80fd\uff1f</p> <p>\u6808\u4f5c\u4e3a\u4e00\u79cd\u62bd\u8c61\u6570\u636e\u7ed3\u6784\u6700\u7ec8\u8fd8\u662f\u5728\u5185\u5b58\u4e0a\u4f53\u73b0\u51fa\u6765\u7684\uff0c\u800c\u76f8\u5bf9\u4e8eCPU\u7684\u5185\u90e8\u64cd\u4f5c\uff0c\u4e0e\u5185\u5b58\u7684\u64cd\u4f5c\u662f\u6bd4\u8f83\u6162\u7684\uff0c\u5982\u679c\u65e0\u6cd5\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u4e2d\uff0c\u53cd\u590d\u64cd\u4f5c\u4e3b\u5185\u5b58\u662f\u5f88\u6162\u7684\u3002</p> </li> <li> <p>\u53ef\u4ee5\u590d\u7528\u7684\u7a0b\u5e8f\u6307\u4ee4\u5728\u8c03\u7528\u5b83\u7684\u5730\u65b9\u5b8c\u5168\u5c55\u5f00\u540e\uff0c\u5982\u679c\u4e00\u4e2a\u5185\u8054\u51fd\u6570\u5728\u5f88\u591a\u5730\u65b9\u90fd\u88ab\u8c03\u7528\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c55\u5f00\u5f88\u591a\u6b21\uff0c\u6574\u4e2a\u7a0b\u5e8f\u5360\u7528\u7684\u7a7a\u95f4\u5c31\u4f1a\u53d8\u5927\u3002\uff08\u81ea\u884c\u6743\u8861\uff0c\u6216\u8005\u4ea4\u7ed9\u7f16\u8bd1\u5668\u505a\u7684\u66f4\u597d\uff09</p> </li> </ul> </li> <li> <p>\u53f6\u5b50\u51fd\u6570/\u8fc7\u7a0b</p> <p>\u4e0d\u4f1a\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u7684\u51fd\u6570\uff0c\u53ea\u80fd\u88ab\u8c03\u7528\u3002</p> </li> <li> <p>\u6df1\u5165\u5b66\u4e60</p> <p>\u3010C++\u3011 \u5185\u8054\u51fd\u6570\u8be6\u89e3\uff08\u641e\u6e05\u5185\u8054\u7684\u672c\u8d28\u53ca\u7528\u6cd5\uff09_c++\u5185\u8054\u51fd\u6570-CSDN\u535a\u5ba2</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_4","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u5728\u7a0b\u5e8f\u6808\u91cc\u9762\uff0c\u9664\u4e86\u6211\u4eec\u8df3\u8f6c\u524d\u7684\u6307\u4ee4\u5730\u5740\u5916\uff0c\u8fd8\u9700\u8981\u4fdd\u7559\u54ea\u4e9b\u4fe1\u606f\uff0c\u624d\u80fd\u5728\u6211\u4eec\u5728\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u4e4b\u540e\uff0c\u8df3\u8f6c\u56de\u5230\u6307\u4ee4\u5730\u5740\u7684\u65f6\u5019\uff0c\u7ee7\u7eed\u6267\u884c\u5b8c\u51fd\u6570\u8c03\u7528\u4e4b\u540e\u7684\u6307\u4ee4\u5462\uff1f</p> <ol> <li>\u51fd\u6570\u8c03\u7528\u524d\u7684\u7a0b\u5e8f\u72b6\u6001\uff0c\u5305\u62ec\u5bc4\u5b58\u5668\u7684\u503c\u3001\u5c40\u90e8\u53d8\u91cf\u7684\u503c\u7b49\u3002</li> <li>\u51fd\u6570\u8c03\u7528\u65f6\u9700\u8981\u7528\u5230\u7684\u53c2\u6570\u503c\u3002</li> <li>\u51fd\u6570\u8c03\u7528\u540e\u9700\u8981\u8fd4\u56de\u7684\u503c\u3002</li> <li>\u51fd\u6570\u8c03\u7528\u65f6\u7684\u8fd4\u56de\u5730\u5740\uff0c\u5373\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u540e\u9700\u8981\u8df3\u8f6c\u56de\u7684\u6307\u4ee4\u5730\u5740\u3002</li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#08-elflinuxwindows","title":"08 | ELF\u548c\u9759\u6001\u94fe\u63a5\uff1a\u4e3a\u4ec0\u4e48\u7a0b\u5e8f\u65e0\u6cd5\u540c\u65f6\u5728Linux\u548cWindows\u4e0b\u8fd0\u884c\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_5","title":"\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b","text":"<ol> <li> <p>\u9884\u5904\u7406\uff1a</p> </li> <li> <p><code>c        gcc -E  //\u8fdb\u884c\u9884\u5904\u7406\uff0c\u751f\u6210.i\u6587\u4ef6</code></p> </li> <li> <p>\u63a5\u53d7\uff1a.c\u6587\u4ef6</p> </li> <li> <p>\u4ea7\u751f\uff1a.i\u6587\u4ef6</p> </li> <li> <p>\u63cf\u8ff0\uff1a\u5728\u9884\u5904\u7406\u9636\u6bb5\uff0cC\u9884\u5904\u7406\u5668\u4f1a\u5904\u7406\u6e90\u4ee3\u7801\uff0c\u5305\u62ec\u5c55\u5f00\u5b8f\u5b9a\u4e49\u3001\u5305\u542b\u5934\u6587\u4ef6\u3001\u5220\u9664\u6ce8\u91ca\u7b49\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u7ecf\u8fc7\u9884\u5904\u7406\u7684\u4e2d\u95f4\u6587\u4ef6\u3002</p> </li> <li> <p>\u7f16\u8bd1\uff1a</p> </li> <li> <p><code>c        gcc -S  //\u8fdb\u884c\u9884\u5904\u7406\uff0c\u751f\u6210.s\u6587\u4ef6</code></p> </li> <li> <p>\u63a5\u53d7\uff1a.i\u6587\u4ef6</p> </li> <li> <p>\u4ea7\u751f\uff1a.s\u6587\u4ef6</p> </li> <li> <p>\u63cf\u8ff0\uff1a\u7f16\u8bd1\u5668\u5c06\u9884\u5904\u7406\u540e\u7684\u6587\u4ef6\u8f6c\u6362\u4e3a\u6c47\u7f16\u4ee3\u7801\uff0c\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u7b49\u64cd\u4f5c\uff0c\u7136\u540e\u751f\u6210\u4e00\u4e2a\u6c47\u7f16\u4ee3\u7801\u6587\u4ef6\u3002</p> </li> <li> <p>\u6c47\u7f16\uff1a</p> <ul> <li><code>c       gcc -c //\u8fdb\u884c\u6c47\u7f16\uff0c\u751f\u6210.o\u6587\u4ef6\uff08Linux\u4e0b\u4e3aELF\u6587\u4ef6\uff09       gcc -o //\u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u540d</code></li> </ul> </li> <li> <p>\u63a5\u53d7\uff1a.s\u6587\u4ef6</p> </li> <li> <p>\u4ea7\u751f\uff1a.o\u6587\u4ef6\uff08Linux\u4e0b\u4e3aELF\u6587\u4ef6\uff09</p> </li> <li> <p>\u63cf\u8ff0\uff1a\u6c47\u7f16\u5668\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u8bed\u8a00\u6307\u4ee4\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u76ee\u6807\u6587\u4ef6\u3002</p> </li> <li> <p>\u94fe\u63a5\uff1a</p> <ul> <li><code>c       gcc -l&lt;library&gt;  //\u94fe\u63a5\u5e93\u6587\u4ef6 \u5982-lm\u94fe\u63a5\u6570\u5b66\u5e93</code></li> </ul> </li> <li> <p>\u63a5\u53d7\uff1a.o\u6587\u4ef6\u3001\u5e93\u6587\u4ef6</p> </li> <li> <p>\u4ea7\u751f\uff1a\u53ef\u6267\u884c\u6587\u4ef6\uff08Linux\u4e0b\u4e3aELF\u6587\u4ef6\uff09</p> </li> <li> <p>\u63cf\u8ff0\uff1a\u94fe\u63a5\u5668\u5c06\u76ee\u6807\u6587\u4ef6\u4e0e\u5e93\u6587\u4ef6\u8fdb\u884c\u94fe\u63a5\uff0c\u89e3\u6790\u7b26\u53f7\u5f15\u7528\uff0c\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u5305\u62ec\u5bf9\u5e93\u51fd\u6570\u7684\u94fe\u63a5\uff0c\u7b26\u53f7\u89e3\u6790\uff0c\u91cd\u5b9a\u4f4d\u7b49\u64cd\u4f5c\u3002</p> </li> <li> <p>\u88c5\u8f7d\uff1a</p> </li> <li>\u63cf\u8ff0\uff1a\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u88c5\u8f7d\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u804c\u8d23\uff0c\u901a\u8fc7\u88c5\u8f7d\u5668\uff0c\u5b83\u4f1a\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u53d8\u6210\u6307\u4ee4\u548c\u6570\u636e\uff0c\u5e76\u5f00\u59cb\u6267\u884c\u3002</li> </ol> <p>\u9884\u5904\u7406\u5668 --&gt; \u7f16\u8bd1\u5668 --&gt; \u6c47\u7f16\u5668 --&gt;\u94fe\u63a5\u5668 --&gt; (\u64cd\u4f5c\u7cfb\u7edf)\u88c5\u8f7d\u5668</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#elf","title":"ELF\u6587\u4ef6\u4e0e\u94fe\u63a5","text":"<ul> <li> <p>ELF\uff08Execuatable and Linkable File Format\uff09\u53ef\u6267\u884c\u4e0e\u53ef\u94fe\u63a5\u6587\u4ef6\u683c\u5f0f</p> <ol> <li>File Header\uff1a\u8868\u793a\u8fd9\u4e2a\u6587\u4ef6\u7684\u57fa\u672c\u5c5e\u6027\uff0c\u6bd4\u5982\u662f\u5426\u662f\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5bf9\u5e94\u7684 CPU\u3001\u64cd\u4f5c\u7cfb\u7edf\u7b49\u7b49\u3002</li> <li>.text Section\uff1a\u4ee3\u7801\u6bb5\u6216\u8005\u6307\u4ee4\u6bb5\uff08Code Section\uff09\uff0c\u7528\u6765\u4fdd\u5b58\u7a0b\u5e8f\u7684\u4ee3\u7801\u548c\u6307\u4ee4\u3002</li> <li>.rel.text Section\uff1a\u91cd\u5b9a\u4f4d\u8868\uff08Relocation Table\uff09\uff0c\u91cd\u5b9a\u4f4d\u8868\u91cc\uff0c\u4fdd\u7559\u5f53\u524d\u7684\u6587\u4ef6\u91cc\u9762\u54ea\u4e9b\u8df3\u8f6c\u5730\u5740\u662f\u6211\u4eec\u4e0d\u77e5\u9053\u7684\u3002\u6bd4\u5982\u5728 main \u51fd\u6570\u91cc\u9762\u8c03\u7528\u4e86 scanf \u548c printf \u8fd9\u4e24\u4e2a\u51fd\u6570\uff0c\u4f46\u5728\u94fe\u63a5\u53d1\u751f\u4e4b\u524d\uff0c\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u8be5\u8df3\u8f6c\u5230\u54ea\u91cc\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5c31\u4f1a\u5b58\u50a8\u5728\u91cd\u5b9a\u4f4d\u8868\u91cc\u3002</li> <li>.symtab Section\uff1a\u7b26\u53f7\u8868\uff08Symbol Table\uff09\uff0c\u7b26\u53f7\u8868\u4fdd\u7559\u4e86\u5f53\u524d\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49\u7684\u51fd\u6570\u540d\u79f0\u548c\u5bf9\u5e94\u5730\u5740\u7684\u5730\u5740\u7c3f\u3002</li> </ol> <p>\u8865\u5145\uff1aELF\u662f\u4e00\u79cd\u6587\u4ef6\u683c\u5f0f\u7684\u6807\u51c6\uff0c</p> <p>ELF\u6587\u4ef6\u6709\u4e09\u7c7b:</p> <p>\u53ef\u91cd\u5b9a\u5411\u6587\u4ef6\u3001\u53ef\u6267\u884c\u6587\u4ef6\u3001\u5171\u4eab\u76ee\u6807\u6587\u4ef6\u3002</p> <p>\u4ee3\u7801\u7ecf\u8fc7\u9884\u5904\u7406\u3001\u7f16\u8bd1\u3001\u6c47\u7f16\u540e\u5f62\u6210\u53ef\u91cd\u5b9a\u5411\u6587\u4ef6\uff0c</p> <p>\u53ef\u91cd\u5b9a\u5411\u6587\u4ef6\u7ecf\u8fc7\u94fe\u63a5\u540e\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> </li> <li> <p>\u94fe\u63a5</p> </li> </ul> <p></p> <ol> <li>\u6784\u5efa\u5168\u5c40\u7b26\u53f7\u8868\uff1a\u94fe\u63a5\u5668\u4f1a\u626b\u63cf\u6240\u6709\u8f93\u5165\u7684\u76ee\u6807\u6587\u4ef6\uff0c\u7136\u540e\u628a\u6240\u6709\u7b26\u53f7\u8868\u91cc\u7684\u4fe1\u606f\u6536\u96c6\u8d77\u6765\uff0c\u6784\u6210\u4e00\u4e2a\u5168\u5c40\u7684\u7b26\u53f7\u8868\u3002</li> <li>\u4fee\u6b63\uff1a\u7136\u540e\u518d\u6839\u636e\u91cd\u5b9a\u4f4d\u8868\uff0c\u628a\u6240\u6709\u4e0d\u786e\u5b9a\u8981\u8df3\u8f6c\u5730\u5740\u7684\u4ee3\u7801\uff0c\u6839\u636e\u7b26\u53f7\u8868\u91cc\u9762\u5b58\u50a8\u7684\u5730\u5740\uff0c\u8fdb\u884c\u4e00\u6b21\u4fee\u6b63\u3002</li> <li>\u5408\u5e76\u76ee\u6807\u6587\u4ef6(ELF)\uff1a\u628a\u6240\u6709\u7684\u76ee\u6807\u6587\u4ef6\u7684\u5bf9\u5e94\u6bb5\u8fdb\u884c\u4e00\u6b21\u5408\u5e76\uff0c\u53d8\u6210\u4e86\u6700\u7ec8\u7684\u53ef\u6267\u884c\u4ee3\u7801\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u9762\u7684\u51fd\u6570\u8c03\u7528\u7684\u5730\u5740\u90fd\u662f\u6b63\u786e\u7684\u3002</li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_6","title":"\u603b\u7ed3","text":"<p>\u4e3a\u4ec0\u4e48\u7a0b\u5e8f\u65e0\u6cd5\u540c\u65f6\u5728Linux\u548cWindows\u4e0b\u8fd0\u884c\uff1f</p> <p>\u5176\u4e2d\u4e00\u4e2a\u91cd\u8981\u7684\u539f\u56e0\u5728\u4e8e\u4e24\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u4e0d\u4e00\u6837\u3002</p> <p>Windows \u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u662f\u4e00\u79cd\u53eb\u4f5c PE\uff08Portable Executable Format\uff09\uff08.exe\uff09\u7684\u6587\u4ef6\u683c\u5f0f\u3002Linux \u4e0b\u7684\u88c5\u8f7d\u5668\u53ea\u80fd\u89e3\u6790 ELF \u683c\u5f0f\u800c\u4e0d\u80fd\u89e3\u6790 PE \u683c\u5f0f\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_7","title":"\u8bfe\u540e\u601d\u8003","text":"<ol> <li>\u5bf9\u4e8e\u5355\u7247\u673a\u8fd9\u79cd\u88f8\u673a\u7f16\u7a0b\u3001RTOS\uff0c\u76f4\u63a5\u8fd0\u884c\u5728\u786c\u4ef6\u4e0a\u7684\u5176\u53ef\u6267\u884c\u7a0b\u5e8f\u5e94\u8be5\u4e0d\u662fELF\u3001PE\u8fd9\u79cd\u6587\u4ef6\u683c\u5f0f\uff0c\u5e94\u8be5\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6/\u5341\u516d\u8fdb\u5236\u6587\u4ef6\uff08.bin/.hex\uff09\uff0c\u4e5f\u5c31\u662f\u76f4\u8fbe\u786c\u4ef6\uff08\u7a0b\u5e8f\u88c5\u8f7d\u90a3\u4e00\u6b65\u7684\u7a0b\u5ea6\uff09\uff0c\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u6765\u5e2e\u4f60\u8c03\u63a7\u3002</li> <li>\u518d\u5bf9\u4e8e\u540c\u4e00\u7cfb\u5217\u7684CPU\uff0c\u5176\u6307\u4ee4\u96c6\u4e00\u6837\uff0c\u4f46\u662f\u8fd0\u884c\u7684OS\u4e0d\u540c\uff0c\u4e5f\u5c31\u662f\u7ba1\u5bb6\u4e0d\u540c\uff0c\u4e0d\u540c\u7684\u7ba1\u5bb6\u4f1a\u6709\u4e0d\u540c\u7684\u65b9\u5f0f\uff08ELF/PE\uff09\u76f4\u63a5\u548c\u786c\u4ef6\u4ea4\u6d41\u3002</li> <li>\u7ed3\u8bba\uff1aELF/PE\u8fd9\u79cd\u53ef\u6267\u884c\u7a0b\u5e8f\u662f\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u9ad8\u5ea6\u7ed1\u5b9a\u7684\u3002</li> </ol> <p>\u5bf9\u4e8e\u6700\u5f00\u59cb\u7684CPU\u4e0a\u7535\u65f6\uff0c\u5148\u4eceBIOS\u90a3\u91cc\u8bfb\u53d6\u76f8\u5173\u5185\u5bb9\uff0c\u8bfb\u53d6\u7684\u4e5f\u662f\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u4e4b\u540e\u4ea4\u7ed9bootloader\uff0c\u542f\u52a8\u64cd\u4f5c\u7cfb\u7edf\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#09-640k","title":"09 | \u7a0b\u5e8f\u88c5\u8f7d\uff1a\u201c640K\u5185\u5b58\u201d\u771f\u7684\u4e0d\u591f\u7528\u4e48\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#-","title":"\u7a0b\u5e8f\u88c5\u8f7d--&gt;\u5185\u5b58\u5206\u6bb5--&gt;\u5185\u5b58\u4ea4\u6362","text":"<p>\u88c5\u8f7d\u5668\u9700\u8981\u6ee1\u8db3\u7684\u8981\u6c42</p> <ol> <li>\u53ef\u6267\u884c\u7a0b\u5e8f\u52a0\u8f7d\u540e\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5e94\u8be5\u662f\u8fde\u7eed\u7684\u3002</li> <li>\u9700\u8981\u540c\u65f6\u52a0\u8f7d\u5f88\u591a\u4e2a\u7a0b\u5e8f\uff0c\u5e76\u4e14\u4e0d\u80fd\u8ba9\u7a0b\u5e8f\u81ea\u5df1\u89c4\u5b9a\u5728\u5185\u5b58\u4e2d\u52a0\u8f7d\u7684\u4f4d\u7f6e</li> </ol> <p>\u51fa\u73b0\u4e86\u4e00\u7cfb\u5217\u95ee\u9898\u5e76\u9010\u6b65\u53d1\u5c55\u51fa\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u88c5\u8f7d</p> <p>\u5728\u5185\u5b58\u91cc\u9762\uff0c\u627e\u5230\u4e00\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u5206\u914d\u7ed9\u88c5\u8f7d\u7684\u7a0b\u5e8f\uff0c\u7136\u540e\u628a\u8fd9\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5730\u5740\uff08\u7269\u7406\u5185\u5b58\u5730\u5740\uff09\uff0c\u548c\u6574\u4e2a\u7a0b\u5e8f\u6307\u4ee4\u91cc\u6307\u5b9a\u7684\u5185\u5b58\u5730\u5740\uff08\u865a\u62df\u5185\u5b58\u5730\u5740\uff09\u505a\u4e00\u4e2a\u6620\u5c04\u3002</p> </li> <li> <p>\u865a\u62df\u5185\u5b58\u5730\u5740\u548c\u7269\u7406\u5185\u5b58\u5730\u5740</p> <p>\u7a0b\u5e8f\u6267\u884c\u9700\u8981\u77e5\u9053\u5185\u5b58\u5730\u5740\uff0c\u6240\u4ee5\u6709\u4e86\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684\u5dee\u522b\u3002</p> </li> <li> <p>\u6620\u5c04\u8868</p> <p>\u7a0b\u5e8f\u91cc\u6709\u6307\u4ee4\u548c\u5404\u79cd\u5185\u5b58\u5730\u5740\uff0c\u53ea\u9700\u8981\u5173\u5fc3\u865a\u62df\u5185\u5b58\u5730\u5740\u3002\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5b83\u770b\u5230\u7684\u90fd\u662f\u540c\u6837\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>\u5173\u952e\u5728\u4e8e\u7ef4\u62a4\u4e00\u4e2a\u865a\u62df\u5185\u5b58\u5230\u7269\u7406\u5185\u5b58\u7684\u6620\u5c04\u8868\uff0c\u8fd9\u6837\u5b9e\u9645\u7a0b\u5e8f\u6307\u4ee4\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7\u865a\u62df\u5185\u5b58\u5730\u5740\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\uff0c\u7136\u540e\u6267\u884c\u3002</p> <p>\u56e0\u4e3a\u662f\u865a\u62df\u5185\u5b58\u5730\u5740\u4e0d\u53d8\u4e14\u8fde\u7eed\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u7ef4\u62a4\u6620\u5c04\u5173\u7cfb\u7684\u8d77\u59cb\u5730\u5740\u548c\u5bf9\u5e94\u7684\u7a7a\u95f4\u5927\u5c0f\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u201c\u865a\u62df\u5730\u5740\u8fde\u7eed\uff0c\u7269\u7406\u5730\u5740\u4e0d\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u3002 malloc\u51fa\u6765\u7684\u7a7a\u95f4\uff0c\u53ea\u662f\u5728\u865a\u62df\u5185\u5b58\u4e2d\u662f\u8fde\u7eed\u7684\u3002\u800c\u4ece\u5b9e\u9645\u7684\u7269\u7406\u7a7a\u95f4\u5230\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u8fd8\u6709\u4e00\u4e2a\u6620\u5c04\u7684\u5173\u7cfb\u3002\u8fd9\u4e2a\u6620\u5c04\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u63a7\u5236\u7684\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4ece\u865a\u62df\u5730\u5740\u65e0\u6cd5\u53cd\u67e5\u5230\u7269\u7406\u5730\u5740\u3002</p> <p>\u5bf9\u4e8e\u8fde\u7eed\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5f97\u77e5\u662f\u5426\u7269\u7406\u8fde\u7eed\u3002\u4f46\u7531\u4e8e\u6620\u5c04\u7684\u4e0d\u786e\u5b9a\u6027\uff0c\u5f53\u7533\u8bf7\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4\uff0c\u5c24\u5176\u662f\u6bd4\u8f83\u5927\u7684\u5185\u5b58\u957f\u5ea6\u60c5\u51b5\u4e0b\uff0c\u7269\u7406\u5730\u5740\u4e0d\u8fde\u7eed\u7684\u53ef\u80fd\u6027\u8fd8\u662f\u76f8\u5f53\u5927\u7684\u3002 \u4e8b\u5b9e\u4e0a\uff0c\u5927\u591a\u6570\u7684\u7f16\u7a0b\u4e0d\u9700\u8981\u5173\u6ce8\u7269\u7406\u7a7a\u95f4\u662f\u5426\u8fde\u7eed\u3002\u201d</p> </li> <li> <p>\u5185\u5b58\u5206\u6bb5</p> <p>\u4e3a\u4e86\u89e3\u51b3\u88c5\u8f7d\u5668\u5728\u52a0\u8f7d\u7a0b\u5e8f\u65f6\u9700\u8981\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u5f15\u5165\u4e86\u5206\u6bb5\u6280\u672f\u3002\u5206\u6bb5\u6280\u672f\u5c06\u7a0b\u5e8f\u7684\u903b\u8f91\u5730\u5740\u7a7a\u95f4\u5206\u4e3a\u591a\u4e2a\u6bb5\uff0c\u6bcf\u4e2a\u6bb5\u53ef\u4ee5\u5177\u6709\u4e0d\u540c\u7684\u957f\u5ea6\u548c\u6743\u9650\u3002</p> <p></p> </li> <li> <p>\u5185\u5b58\u788e\u7247\u95ee\u9898\u7684\u51fa\u73b0</p> <p>\u5185\u5b58\u5206\u6bb5\u6280\u672f\u53c8\u5e26\u6765\u4e86\u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\uff0c\u5f71\u54cd\u4e86\u5185\u5b58\u7684\u5229\u7528\u6548\u7387\u3002</p> </li> <li> <p>\u5185\u5b58\u4ea4\u6362</p> <p>\u4e3a\u4e86\u89e3\u51b3\u5185\u5b58\u788e\u7247\u95ee\u9898\uff0c\u5f15\u5165\u4e86\u5185\u5b58\u4ea4\u6362\u6280\u672f\u3002</p> <p>\u5185\u5b58\u4ea4\u6362\u6280\u672f\u5c06\u4e0d\u5e38\u7528\u7684\u5185\u5b58\uff08\u6bb5/\u9875\uff09\u6682\u65f6\u5199\u5165\u78c1\u76d8\uff0c\u4ee5\u91ca\u653e\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u628a Python \u7a0b\u5e8f\u5360\u7528\u7684\u90a3 256MB \u5185\u5b58\u5199\u5230\u786c\u76d8\u4e0a\uff0c\u7136\u540e\u518d\u4ece\u786c\u76d8\u4e0a\u8bfb\u56de\u6765\u5230\u5185\u5b58\u91cc\u9762\u3002</p> <p>\u8bfb\u56de\u6765\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u628a\u5b83\u52a0\u8f7d\u5230\u539f\u6765\u7684\u4f4d\u7f6e\uff0c\u800c\u662f\u7d27\u7d27\u8ddf\u5728\u90a3\u5df2\u7ecf\u88ab\u5360\u7528\u7684 512MB \u5185\u5b58\u540e\u9762\u3002</p> <p>\u8fd9\u6837\u5c31\u6709\u4e86\u8fde\u7eed\u7684 256MB \u5185\u5b58\u7a7a\u95f4\uff0c\u5c31\u53ef\u4ee5\u53bb\u52a0\u8f7d\u4e00\u4e2a\u65b0\u7684 200MB \u7684\u7a0b\u5e8f\u3002</p> <p>\u5982\u679c\u4f60\u81ea\u5df1\u5b89\u88c5\u8fc7 Linux \u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f60\u5e94\u8be5\u9047\u5230\u8fc7\u5206\u914d\u4e00\u4e2a swap \u786c\u76d8\u5206\u533a\u7684\u95ee\u9898\u3002\u8fd9\u5757\u5206\u51fa\u6765\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u5176\u5b9e\u5c31\u662f\u4e13\u95e8\u7ed9 Linux \u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u5185\u5b58\u4ea4\u6362\u7528\u7684\u3002</p> </li> <li> <p>\u5185\u5b58\u4ea4\u6362\u7684\u95ee\u9898</p> <p>\u786c\u76d8\u7684\u8bbf\u95ee\u901f\u5ea6\u8981\u6bd4\u5185\u5b58\u6162\u5f88\u591a\uff0c\u800c\u6bcf\u4e00\u6b21\u5185\u5b58\u4ea4\u6362\uff0c\u6211\u4eec\u90fd\u9700\u8981\u628a\u4e00\u5927\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u6570\u636e\u5199\u5230\u786c\u76d8\u4e0a\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5185\u5b58\u4ea4\u6362\u7684\u65f6\u5019\uff0c\u4ea4\u6362\u7684\u662f\u4e00\u4e2a\u5f88\u5360\u5185\u5b58\u7a7a\u95f4\u7684\u7a0b\u5e8f\uff0c\u8fd9\u6837\u6574\u4e2a\u673a\u5668\u90fd\u4f1a\u663e\u5f97\u5361\u987f\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_8","title":"\u5185\u5b58\u5206\u9875","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u5185\u5b58\u788e\u7247\u548c\u5185\u5b58\u4ea4\u6362\u7684\u7a7a\u95f4\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u53c8\u63d0\u51fa\u4e86\u5185\u5b58\u5206\u9875\u6280\u672f\uff0c\u5373\u5f53\u9700\u8981\u8fdb\u884c\u5185\u5b58\u4ea4\u6362\u7684\u65f6\u5019\uff0c\u8ba9\u9700\u8981\u4ea4\u6362\u5199\u5165\u6216\u8005\u4ece\u78c1\u76d8\u88c5\u8f7d\u7684\u6570\u636e\u66f4\u5c11\u4e00\u70b9\uff0c\u51cf\u5c11\u4e00\u4e9b\u5185\u5b58\u788e\u7247\u3002</p> <p>\u5185\u5b58\u5206\u9875\uff1a\u5c06\u7269\u7406\u5185\u5b58\u4e0e\u865a\u62df\u5185\u5b58\u90fd\u5206\u5272\u4e3a\u56fa\u5b9a\u5927\u5c0f\u7684\u7247\u6bb5\uff0c\u79f0\u4e4b\u4e3a\u9875\u3002\uff08Linux\u4e0b\u901a\u5e38\u8bbe\u7f6e\u4e3a4KB\uff09</p> <p>\u6709\u4e86\u5185\u5b58\u5206\u9875\u6280\u672f\u4e4b\u540e\uff0c\u5c31\u4e0d\u50cf\u4e4b\u524d\u90a3\u6837\uff0c\u518d\u62ff\u6574\u6bb5\u8fde\u7eed\u5185\u5b58\u7684\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5185\u5b58\u6765\u8fdb\u884c\u5185\u5b58\u4ea4\u6362\u4e86\uff0c\u800c\u662f\u91c7\u7528\u66f4\u52a0\u5c0f\u7684\u9875\u7684\u5f62\u5f0f\u3002</p> <p>\u53c8\u56e0\u4e3a\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u65e9\u5df2\u5212\u5206\u597d\uff088GB\u7269\u7406\u5185\u5b58\u7684\u9875\u7684\u4e2a\u6570\u4e3a\uff1a 8G/4KB =8 * 1024M/4KB =8 * 1024 * 1024KB/4KB =2097152 \u9875\uff09\uff0c\u4e5f\u5c31\u6ca1\u6709\u4e0d\u80fd\u4f7f\u7528\u7684\u788e\u7247\u4e86\uff0c\u53ea\u6709\u88ab\u91ca\u653e\u51fa\u6765\u76844KB\u7684\u9875\u4e86\u3002\u5373\u4f7f\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u9700\u8981\u8ba9\u6b63\u5728\u8fd0\u884c\u7684\u7a0b\u5e8f\u901a\u8fc7\u5185\u5b58\u4ea4\u6362\u8ba9\u51fa\u4e00\u4e9b\u5185\u5b58\u7684\u9875\u7684\u65f6\u5019\uff0c\u4e00\u6b21\u6027\u5199\u5165\u78c1\u76d8\u7684\u4e5f\u5c31\u53ea\u6709\u51e0\u4e2a\u9875\u4e86\uff0c\u4e0d\u4f1a\u82b1\u592a\u591a\u7684\u65f6\u95f4\u5bfc\u81f4\u673a\u5668\u88ab\u5185\u5b58\u4ea4\u6362\u7684\u8fc7\u7a0b\u5361\u4f4f\u3002</p> <p>\u6ce8\u610f\uff1a\u5185\u5b58\u5206\u9875\uff0c\u5728\u865a\u62df\u5185\u5b58\u4e0a\uff0c\u5bf9\u7a0b\u5e8f\u6765\u8bf4\u662f\u8fde\u7eed\u7684\u5f88\u591a\u9875\uff1b\u800c\u5728\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u5c31\u4e0d\u9700\u8981\u50cf\u865a\u62df\u5185\u5b58\u90a3\u6837\u8fde\u7740\u653e\u4e86\uff0c\u800c\u662f\u53ef\u4ee5</p> <p></p> <p>\u66f4\u8fdb\u4e00\u6b65\u5730\uff0c\u5206\u9875\u7684\u65b9\u5f0f\u4f7f\u5f97\u6211\u4eec\u5728\u52a0\u8f7d\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u9700\u8981\u4e00\u6b21\u6027\u90fd\u628a\u7a0b\u5e8f\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u4e2d\u3002</p> <p>\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5728\u8fdb\u884c\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u7684\u9875\u4e4b\u95f4\u7684\u6620\u5c04\u4e4b\u540e\uff0c\u5e76\u4e0d\u771f\u7684\u628a\u9875\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\uff0c\u800c\u662f\u53ea\u5728\u7a0b\u5e8f\u8fd0\u884c\u4e2d\uff0c\u9700\u8981\u7528\u5230\u5bf9\u5e94\u865a\u62df\u5185\u5b58\u9875\u91cc\u9762\u7684\u6307\u4ee4\u548c\u6570\u636e\u65f6\uff0c\u518d\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\u9762\u53bb\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff1a</p> <p>\u5f53\u8981\u8bfb\u53d6\u7279\u5b9a\u7684\u9875\uff0c\u5374\u53d1\u73b0\u6570\u636e\u5e76\u6ca1\u6709\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e6\u53d1\u4e00\u4e2a\u6765\u81ea\u4e8e CPU \u7684\u7f3a\u9875\u9519\u8bef\uff08Page Fault\uff09\u3002\u6211\u4eec\u7684\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6355\u6349\u5230\u8fd9\u4e2a\u9519\u8bef\uff0c\u7136\u540e\u5c06\u5bf9\u5e94\u7684\u9875\uff0c\u4ece\u5b58\u653e\u5728\u786c\u76d8\u4e0a\u7684\u865a\u62df\u5185\u5b58\u91cc\u8bfb\u53d6\u51fa\u6765\uff0c\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\u3002\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c\u90a3\u4e9b\u8fdc\u5927\u4e8e\u6211\u4eec\u5b9e\u9645\u7269\u7406\u5185\u5b58\u7684\u7a0b\u5e8f\u3002\u540c\u65f6\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u4efb\u4f55\u7a0b\u5e8f\u90fd\u4e0d\u9700\u8981\u4e00\u6b21\u6027\u52a0\u8f7d\u5b8c\u6240\u6709\u6307\u4ee4\u548c\u6570\u636e\uff0c\u53ea\u9700\u8981\u52a0\u8f7d\u5f53\u524d\u9700\u8981\u7528\u5230\u5c31\u884c\u4e86\u3002\uff08Linus\u81ea\u4f20\u91cc\u7684\u5206\u9875\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u5b50\u5c31\u53ef\u4ee5\u8fd0\u884c\u6bd4\u5185\u5b58\u7a7a\u95f4\u8fd8\u8981\u5927\u7684\u7a0b\u5e8f\u4e86\uff09</p> <ul> <li> <p>\u8865\u5145</p> <p>\u4e0d\u5b58\u5728\u5185\u5b58\u788e\u7247\u6307\u7684\u662f\u4e0d\u5b58\u5728\u5916\u90e8\u5185\u5b58\u788e\u7247\uff0c\u5185\u90e8\u5185\u5b58\u788e\u7247\u8fd8\u662f\u6709\u7684\uff0c\u6709\u7684\u9875\u7a7a\u95f4\u5e76\u672a\u5b8c\u5168\u5360\u6ee1\u3002\u6240\u4ee5\u5185\u5b58\u5206\u9875\u5176\u5b9e\u4e5f\u5c31\u662f\u5185\u5b58\u5206\u6bb5\u5206\u7684\u66f4\u52a0\u5c0f\u4e86\uff0c\u66f4\u52a0\u5408\u7406\u4e86\u3002</p> </li> </ul> <p>\u201d\u5185\u5b58\u5206\u9875\u4f7f\u5f97\u6620\u5c04\u7684\u57fa\u672c\u5355\u5143\u4ece\u6bb5\u53d8\u6210\u4e86\u89c4\u8303\u7684\uff0c\u5bb9\u6613\u5904\u7406\u7684\u9875\u201c</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_9","title":"\u603b\u7ed3","text":"<ul> <li> <p>\u865a\u62df\u5185\u5b58\u5411\u4e0a\uff1a</p> <p>\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4ece\u6b64\u7a0b\u5e8f\u4e0d\u9700\u8981\u8003\u8651\u4e0d\u540c\u73af\u5883\u4e0b\u4e0d\u540c\u5730\u5740\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u5728\u4efb\u4f55\u73af\u5883\u4e0b\uff0c\u7a0b\u5e8f\u7684\u5730\u5740\u90fd\u662f\u4ece0\u5f00\u59cb\u7684\u3002 </p> </li> <li> <p>\u865a\u62df\u5185\u5b58\u5411\u4e0b\uff1a\u53ef\u4ee5\u548c\u7269\u7406\u5730\u5740\u8fdb\u884c\u66f4\u52a0\u590d\u6742\u7684\u7ea6\u5b9a\uff0c\u4e3a\u4e86\u51cf\u5c11\u4ea4\u6362\u6b21\u6570\uff0c\u53ef\u4ee5\u96c6\u4e2d\u7ba1\u7406\u5185\u5b58\u4ea4\u6362\u3002\u4e1c\u897f\u53ea\u8981\u80fd\u591f\u96c6\u4e2d\u7ba1\u7406\uff0c\u5c31\u6709\u673a\u4f1a\u63d0\u9ad8\u6548\u7387\u4e86\u3002 </p> </li> <li> <p>\u5206\u5c42\u8bbe\u8ba1\u7684\u601d\u8def\u518d\u4e00\u6b21\u62ef\u6551\u4e86\u7a0b\u5e8f\u5458\u3002\u901a\u8fc7\u865a\u62df\u5185\u5b58\u3001\u5185\u5b58\u4ea4\u6362\u548c\u5185\u5b58\u5206\u9875\u8fd9\u4e09\u4e2a\u6280\u672f\u7684\u7efc\u5408\u5e94\u7528\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u4e0d\u9700\u8981\u8003\u8651\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\u3001\u5927\u5c0f\u548c\u5f53\u524d\u5206\u914d\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u4ece\u800c\u89e3\u51b3\u4e86\u7a0b\u5e8f\u52a0\u8f7d\u65f6\u9047\u5230\u7684\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u548c\u591a\u7a0b\u5e8f\u52a0\u8f7d\u4f4d\u7f6e\u7684\u95ee\u9898\u3002</p> </li> </ul> <p>\u7efc\u5408\u4ee5\u4e0a\u53d1\u5c55\u8fc7\u7a0b\uff0c\u6700\u7ec8\u603b\u7ed3\u51fa\u4e00\u4e2a\u5408\u7406\u7684\u89e3\u51b3\u65b9\u6848\uff1a\u901a\u8fc7\u865a\u62df\u5185\u5b58\u3001\u5185\u5b58\u4ea4\u6362\u548c\u5185\u5b58\u5206\u9875\u7684\u7ec4\u5408\u5e94\u7528\uff0c\u89e3\u51b3\u4e86\u7a0b\u5e8f\u52a0\u8f7d\u65f6\u9047\u5230\u7684\u5185\u5b58\u4e0d\u8db3\u3001\u5185\u5b58\u788e\u7247\u548c\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u80fd\u591f\u8fd0\u884c\u5728\u8fdc\u5927\u4e8e\u5b9e\u9645\u7269\u7406\u5185\u5b58\u7684\u7a0b\u5e8f\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_10","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u5728 Java \u8fd9\u6837\u4f7f\u7528\u865a\u62df\u673a\u7684\u7f16\u7a0b\u8bed\u8a00\u91cc\u9762\uff0c\u6211\u4eec\u5199\u7684\u7a0b\u5e8f\u662f\u600e\u4e48\u88c5\u8f7d\u5230\u5185\u5b58\u91cc\u9762\u6765\u7684\u5462\uff1f\u5b83\u4e5f\u548c\u6211\u4eec\u8bb2\u7684\u4e00\u6837\uff0c\u662f\u901a\u8fc7\u5185\u5b58\u5206\u9875\u548c\u5185\u5b58\u4ea4\u6362\u7684\u65b9\u5f0f\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\u9762\u6765\u7684\u4e48\uff1f</p> <p>jvm\u5df2\u7ecf\u662f\u4e0a\u5c42\u5e94\u7528\uff0c\u65e0\u9700\u8003\u8651\u7269\u7406\u5206\u9875\uff0c\u4e00\u822c\u66f4\u76f4\u63a5\u662f\u8003\u8651\u5bf9\u8c61\u672c\u8eab\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u7269\u7406\u786c\u4ef6\u7ba1\u7406\u7edf\u4e00\u7531\u627f\u8f7djvm\u7684\u64cd\u7eb5\u7cfb\u7edf\u53bb\u89e3\u51b3\u5427</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#10","title":"10 | \u52a8\u6001\u94fe\u63a5\uff1a\u7a0b\u5e8f\u5185\u90e8\u7684\u201c\u5171\u4eab\u5355\u8f66\u201d","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_11","title":"\u6765\u7531","text":"<p>\u4e0a\u4e00\u8282\u4e3a\u4e86\u89e3\u51b3\u5185\u5b58\u4e0d\u591f\u7528\u7684\u95ee\u9898\uff0c\u6765\u4e86\u5404\u79cd\u82b1\u62db\u3002</p> <p>\u5982\u679c\u6211\u4eec\u80fd\u591f\u8ba9\u540c\u6837\u529f\u80fd\u7684\u4ee3\u7801\uff0c\u5728\u4e0d\u540c\u7684\u7a0b\u5e8f\u91cc\u9762\uff0c\u4e0d\u9700\u8981\u5404\u5360\u4e00\u4efd\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u6837\u5b50\u4e5f\u80fd\u8282\u7701\u4e00\u5b9a\u7a7a\u95f4\u3002</p> <p>\u8fd9\u4e2a\u601d\u8def\u5c31\u5f15\u5165\u4e00\u79cd\u65b0\u7684\u94fe\u63a5\u65b9\u6cd5\uff0c\u53eb\u4f5c\u52a8\u6001\u94fe\u63a5\uff08Dynamic Link\uff09\u3002\u76f8\u5e94\u7684\uff0c\u4e4b\u524d\u8bf4\u7684\u5408\u5e76\u4ee3\u7801\u6bb5\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u9759\u6001\u94fe\u63a5\uff08Static Link\uff09\u3002</p> <p>\u5728\u52a8\u6001\u94fe\u63a5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u60f3\u8981\u201c\u94fe\u63a5\u201d\u7684\uff0c\u4e0d\u662f\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u7684\u76ee\u6807\u6587\u4ef6\u4ee3\u7801\uff0c\u800c\u662f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u5171\u4eab\u5e93\uff08Shared Libraries\uff09\u3002</p> <p>\u987e\u540d\u601d\u4e49\uff0c\u8fd9\u91cc\u7684\u5171\u4eab\u5e93\u91cd\u5728\u201c\u5171\u4eab\u201c\u8fd9\u4e24\u4e2a\u5b57\u3002</p> <p>\u8fd9\u4e2a\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u5171\u4eab\u5e93\u4f1a\u88ab\u5f88\u591a\u4e2a\u7a0b\u5e8f\u7684\u6307\u4ee4\u8c03\u7528\u5230\u3002\u5728 Windows \u4e0b\uff0c\u8fd9\u4e9b\u5171\u4eab\u5e93\u6587\u4ef6\u5c31\u662f.dll \u6587\u4ef6\uff0c\u4e5f\u5c31\u662f Dynamic-Link Library\uff08DLL\uff0c\u52a8\u6001\u94fe\u63a5\u5e93\uff09\u3002\u5728 Linux \u4e0b\uff0c\u8fd9\u4e9b\u5171\u4eab\u5e93\u6587\u4ef6\u5c31\u662f.so \u6587\u4ef6\uff0c\u4e5f\u5c31\u662f Shared Object\uff08\u4e00\u822c\u6211\u4eec\u4e5f\u79f0\u4e4b\u4e3a\u52a8\u6001\u94fe\u63a5\u5e93\uff09</p> <p>\u8fd9\u4e24\u5927\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u7684\u6587\u4ef6\u540d\u540e\u7f00\uff0c\u4e00\u4e2a\u7528\u4e86\u201c\u52a8\u6001\u94fe\u63a5\u201d\u7684\u610f\u601d\uff0c\u53e6\u4e00\u4e2a\u7528\u4e86\u201c\u5171\u4eab\u201d\u7684\u610f\u601d\uff0c\u6b63\u597d\u8986\u76d6\u4e86\u4e24\u65b9\u9762\u7684\u542b\u4e49\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_12","title":"\u5730\u5740","text":"<ul> <li> <p>\u5730\u5740\u65e0\u5173/\u5730\u5740\u76f8\u5173</p> <p>\u8981\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\u5171\u4eab\u4ee3\u7801\uff0c\u6709\u4e00\u5b9a\u7684\u8981\u6c42\uff0c\u5c31\u662f\u8fd9\u4e9b\u673a\u5668\u7801\u5fc5\u987b\u662f\u201c\u5730\u5740\u65e0\u5173\u201d\u7684\uff0c\u5171\u4eab\u5e93\u4e2d\u5982\u679c\u51fa\u73b0\u5730\u5740\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u90a3\u4e48\u8fd0\u884c\u65f6\u8df3\u8f6c\u7684\u5730\u5740\u662f\u7edd\u5bf9\u6307\u4ee4\uff0c\u5c31\u65e0\u6cd5\u590d\u7528\u4e86\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7f16\u8bd1\u51fa\u6765\u7684\u5171\u4eab\u5e93\u6587\u4ef6\u7684\u6307\u4ee4\u4ee3\u7801\uff0c\u662f\u5730\u5740\u65e0\u5173\u7801\uff08Position-Independent Code\uff09\u3002\uff08-fPIC\uff09</p> <p>\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0c\u8fd9\u6bb5\u4ee3\u7801\uff0c\u65e0\u8bba\u52a0\u8f7d\u5728\u54ea\u4e2a\u5185\u5b58\u5730\u5740\uff0c\u90fd\u80fd\u591f\u6b63\u5e38\u6267\u884c\u3002\u5982\u679c\u4e0d\u662f\u8fd9\u6837\u7684\u4ee3\u7801\uff0c\u5c31\u662f\u5730\u5740\u76f8\u5173\u7684\u4ee3\u7801</p> <ul> <li>\u5927\u90e8\u5206\u51fd\u6570\u5e93\u5176\u5b9e\u90fd\u53ef\u4ee5\u505a\u5230\u5730\u5740\u65e0\u5173\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u63a5\u53d7\u7279\u5b9a\u7684\u8f93\u5165\uff0c\u8fdb\u884c\u786e\u5b9a\u7684\u64cd\u4f5c\uff0c\u7136\u540e\u7ed9\u51fa\u8fd4\u56de\u7ed3\u679c\u5c31\u597d\u4e86\u3002\u65e0\u8bba\u662f\u5b9e\u73b0\u4e00\u4e2a\u5411\u91cf\u52a0\u6cd5\uff0c\u8fd8\u662f\u5b9e\u73b0\u4e00\u4e2a\u6253\u5370\u7684\u51fd\u6570\uff0c\u8fd9\u4e9b\u4ee3\u7801\u903b\u8f91\u548c\u8f93\u5165\u7684\u6570\u636e\u5728\u5185\u5b58\u91cc\u9762\u7684\u4f4d\u7f6e\u5e76\u4e0d\u91cd\u8981\u3002</li> <li>\u5173\u4e8e\u7edd\u5bf9\u5730\u5740\uff1a\u4e4b\u524d\u8bb2\u8fc7\u7684\u91cd\u5b9a\u4f4d\u8868\u3002\u5728\u7a0b\u5e8f\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u5c31\u5df2\u7ecf\u628a\u51fd\u6570\u8c03\u7528\u540e\u8981\u8df3\u8f6c\u8bbf\u95ee\u7684\u5730\u5740\u786e\u5b9a\u4e0b\u6765\u4e86\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u8fd9\u4e2a\u51fd\u6570\u52a0\u8f7d\u5230\u4e00\u4e2a\u4e0d\u540c\u7684\u5185\u5b58\u5730\u5740\uff0c\u8df3\u8f6c\u5c31\u4f1a\u5931\u8d25\u3002</li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_13","title":"\u5b9e\u73b0\u52a8\u6001\u94fe\u63a5","text":"<ul> <li> <p>\u5bf9\u4e8e\u6240\u6709\u52a8\u6001\u94fe\u63a5\u5171\u4eab\u5e93\u7684\u7a0b\u5e8f\uff0c\u5171\u4eab\u5e93\u7528\u7684\u90fd\u662f\u540c\u4e00\u6bb5\u7269\u7406\u5185\u5b58\u5730\u5740\uff0c\u4f46\u5728\u4e0d\u540c\u7684\u5e94\u7528\u7a0b\u5e8f\u91cc\uff0c\u5b83\u6240\u5728\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u6211\u4eec\u6ca1\u529e\u6cd5\u3001\u4e5f\u4e0d\u5e94\u8be5\u8981\u6c42\uff0c\u52a8\u6001\u94fe\u63a5\u5171\u4eab\u5e93\u7684\u4e0d\u540c\u7a0b\u5e8f\uff0c\u5fc5\u987b\u628a\u8fd9\u4e2a\u5171\u4eab\u5e93\u6240\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u53d8\u6210\u4e00\u81f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5199\u7684\u7a0b\u5e8f\u5c31\u5fc5\u987b\u660e\u786e\u5730\u77e5\u9053\u5185\u90e8\u7684\u5185\u5b58\u5730\u5740\u5206\u914d\u3002</p> </li> </ul> <p></p> <p>\u90a3\u4e00\u6bb5memory mapping segment \u4e2d\u653e\u7684\u5c31\u662f.so \u5e93\uff0cilbc.so</p> <ul> <li> <p>\u600e\u4e48\u6837\u624d\u80fd\u505a\u5230\uff0c\u52a8\u6001\u5171\u4eab\u5e93\u7f16\u8bd1\u51fa\u6765\u7684\u4ee3\u7801\u6307\u4ee4\uff0c\u90fd\u662f\u5730\u5740\u65e0\u5173\u7801\u5462\uff1f</p> <ul> <li> <p>\u52a8\u6001\u4ee3\u7801\u5e93\u7684\u5185\u90e8\u53d8\u91cf\u548c\u51fd\u6570</p> </li> <li> <p>(\u5916\u90e8)\u94fe\u63a5\u52a8\u6001\u5e93</p> </li> </ul> <ul> <li> <p>\u52a8\u6001\u4ee3\u7801\u5e93\u7684\u5185\u90e8\u53d8\u91cf\u548c\u51fd\u6570\uff1a\u4f7f\u7528\u76f8\u5bf9\u5730\u5740\uff08Relative Address\uff09</p> <ul> <li> <p>\u5404\u79cd\u6307\u4ee4\u4e2d\u4f7f\u7528\u5230\u7684\u5185\u5b58\u5730\u5740\uff0c\u7ed9\u51fa\u662f\u4e00\u4e2a\u76f8\u5bf9\u4e8e\u5f53\u524d\u6307\u4ee4\u504f\u79fb\u91cf\u7684\u5185\u5b58\u5730\u5740\u3002</p> </li> <li> <p>\u56e0\u4e3a\u6574\u4e2a\u5171\u4eab\u5e93\u662f\u653e\u5728\u4e00\u6bb5\u8fde\u7eed\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u4e2d\u7684\uff08\u8fd9\u91cc\u6700\u540e\u653e\u5230\u5e95\u7269\u7406\u5185\u5b58\u7684\u4f4d\u7f6e\u8fd8\u662f\u4e00\u6837\u7684\uff09\uff0c\u65e0\u8bba\u88c5\u8f7d\u5230\u54ea\u4e00\u6bb5\u5730\u5740\uff0c\u4e0d\u540c\u6307\u4ee4\u4e4b\u95f4\u7684\u76f8\u5bf9\u5730\u5740\u90fd\u662f\u4e0d\u53d8\u7684\u3002</p> <p>\u5728\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\uff0c\u76f8\u5bf9\u5730\u5740\u6307\u7684\u662f\u5730\u5740\u6570\u636e\u76f8\u5bf9\u4e8e\u67d0\u4e2a\u57fa\u51c6\u5730\u5740\u7684\u504f\u79fb\u91cf\u3002\u5f53\u7a0b\u5e8f\u52a0\u8f7d\u52a8\u6001\u94fe\u63a5\u5e93\u65f6\uff0c\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u6839\u636e\u57fa\u51c6\u5730\u5740\u548c\u76f8\u5bf9\u5730\u5740\u8ba1\u7b97\u51fa\u5b9e\u9645\u7684\u5185\u5b58\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0\u5bf9\u5e93\u51fd\u6570\u6216\u6a21\u5757\u7684\u8c03\u7528\u3002</p> <p>\u76f8\u5bf9\u5730\u5740\u7684\u4f7f\u7528\u53ef\u4ee5\u4f7f\u5f97\u52a8\u6001\u94fe\u63a5\u5e93\u66f4\u52a0\u7075\u6d3b\uff0c\u5b83\u4eec\u4e0d\u4f9d\u8d56\u4e8e\u56fa\u5b9a\u7684\u7edd\u5bf9\u5730\u5740\uff0c\u800c\u662f\u6839\u636e\u57fa\u51c6\u5730\u5740\u8fdb\u884c\u8ba1\u7b97\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u5e93\u51fd\u6570\u6216\u6a21\u5757\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5185\u5b58\u5730\u5740\u4e0a\u52a0\u8f7d\u800c\u4e0d\u9700\u8981\u4fee\u6539\u5176\u5185\u90e8\u7684\u5730\u5740\u6570\u636e\u3002</p> </li> </ul> </li> <li> <p>(\u5916\u90e8)\u94fe\u63a5\u52a8\u6001\u5e93\uff1a\u4f7f\u7528PLT \u548c GOT\u89e3\u51b3</p> <ul> <li> <p>PLT\uff1a\u7a0b\u5e8f\u94fe\u63a5\u8868\uff08Procedure Link Table\uff09</p> <pre><code>;\u8c03\u7528show_me_the meney\u51fd\u6570\uff0c\u91cc\u9762\u6709printf()\ncall   400550 &lt;show_me_the_money@plt&gt;\n;\u8868\u793a\u6211\u4eec\u9700\u8981\u4eceplt\u91cc\u9762\u627e\u76f8\u5173\u4fe1\u606f\uff0cplt\u5bf9\u5e94\u7684\u5730\u5740\u662f400550\n</code></pre> <p>\u5173\u952e\uff1a\u8bb0\u5f55\u6307\u4ee4\u5728\u5f53\u524d\u7a0b\u5e8f\u7684\u865a\u62df\u5185\u5b58\u5730\u5740</p> </li> <li> <p>GOT\uff1a\u5168\u5c40\u504f\u79fb\u8868\uff08Global Offset Table\uff09</p> <pre><code>;400550 \u8fd9\u4e2a\u5730\u5740\uff0c\u91cc\u9762\u53c8\u8fdb\u884c\u4e86\u4e00\u6b21\u8df3\u8f6c\uff0c\u8df3\u8f6c\u6307\u5b9a\u7684\u8df3\u8f6c\u5730\u5740\u4e3aGLOBAL_OFFSET_TABLE+0x18\uff0c\n400550:       ff 25 12 05 20 00       jmp    QWORD PTR [rip+0x200512]       \n# 600a68 &lt;_GLOBAL_OFFSET_TABLE_+0x18&gt;\n</code></pre> <p>\u867d\u7136\u5171\u4eab\u5e93\u7684\u4ee3\u7801\u90e8\u5206\u7684\u7269\u7406\u5185\u5b58\u662f\u5171\u4eab\u3001\u76f8\u540c\u7684\uff0c\u4f46\u662f\u6570\u636e\u90e8\u5206\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u90fd\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u52a8\u6001\u94fe\u63a5\u7684\u65f6\u5019\u9700\u8981\u533a\u5206\u5f00\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u52a8\u6001\u94fe\u63a5\u5230\u7684\u52a8\u6001\u5e93\uff0c\u90fd\u4f1a\u5728data section\u52a0\u8f7d\u4e00\u4efd\u81ea\u5df1\u7684GOT\uff0c\u5728\u4e0d\u540c\u5730\u65b9\u8c03\u7528\u5171\u4eab\u5e93\u7684\u6307\u4ee4\uff0c\u90fd\u4f1a\u53bb\u67e5\u8be2GOT\uff0c\u6765\u627e\u5230\u5f53\u524d\u8fd0\u884c\u7a0b\u5e8f\u7684\u865a\u62df\u5185\u5b58\u91cc\u7684\u5bf9\u5e94\u7684\u4f4d\u7f6e\u3002</p> <p>GOT \u8868\u91cc\u7684\u6570\u636e\uff0c\u5219\u662f\u5728\u4e0d\u540c\u7a0b\u5e8f\u52a0\u8f7d\u4e00\u4e2a\u4e2a\u5171\u4eab\u5e93\u7684\u65f6\u5019\u5199\u8fdb\u53bb\u7684\u3002</p> <p>\u4e0d\u540c\u7684\u8fdb\u7a0b\uff0c\u8c03\u7528\u540c\u6837\u7684 lib.so\uff0c\u5404\u81ea GOT \u91cc\u9762\u6307\u5411\u6700\u7ec8\u52a0\u8f7d\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u91cc\u9762\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u662f\u4e0d\u540c\u7684\u3002</p> <p></p> <p>\u8fd9\u6837\uff0c\u867d\u7136\u4e0d\u540c\u7684\u7a0b\u5e8f\u8c03\u7528\u7684\u540c\u6837\u7684\u52a8\u6001\u5e93\uff0c\u5404\u81ea\u7684\u5185\u5b58\u5730\u5740\u662f\u72ec\u7acb\u7684\uff0c\u8c03\u7528\u7684\u53c8\u90fd\u662f\u540c\u4e00\u4e2a\u52a8\u6001\u5e93\uff0c\u4f46\u662f\u4e0d\u9700\u8981\u53bb\u4fee\u6539\u52a8\u6001\u5e93\u91cc\u9762\u7684\u4ee3\u7801\u6240\u4f7f\u7528\u7684\u5730\u5740\uff0c\u800c\u662f\u5404\u4e2a\u7a0b\u5e8f\u5404\u81ea\u7ef4\u62a4\u597d\u81ea\u5df1\u7684 GOT\uff0c\u80fd\u591f\u627e\u5230\u5bf9\u5e94\u7684\u52a8\u6001\u5e93\u5c31\u597d\u4e86\u3002</p> <p>\u5173\u952e\uff1a\u8bb0\u5f55\u504f\u79fb\u91cf</p> </li> <li> <p>\u5177\u4f53\u8fc7\u7a0b </p> <ul> <li> <p>PLT\u8bb0\u5f55\u4e86\u4e00\u6761\u6307\u4ee4\u5728\u5f53\u524d\u7a0b\u5e8f\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u7684\u5730\u5740</p> </li> <li> <p>GOT\u8bb0\u5f55\u4e86\u8be5\u6307\u4ee4\u5728\u6574\u4e2a\u7a0b\u5e8f\u4e2d\u7684\u504f\u79fb\u91cf\uff0c\u662f\u8fd0\u884c\u65f6\u786e\u5b9a\u7684\u800c\u4e0d\u662f\u7f16\u8bd1\u65f6\u3002\u4e3a\u4ec0\u4e48\u8981\u8bb0\u5f55\u504f\u79fb\u91cf\uff1f\uff08\u60f3\u60f3\u5730\u5740\u65e0\u5173\uff09</p> </li> <li>\u56e0\u4e3a\u4e00\u4e2a\u7a0b\u5e8f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u65f6\u5019\u662f\u8fde\u7eed\u5730\u5740\u7684\uff0c\u6240\u4ee5\u504f\u79fb\u91cf\u8fd9\u4e2a\u76f8\u5bf9\u5730\u5740\u53ef\u4ee5\u5f88\u597d\u7684\u8bb0\u5f55\u6307\u4ee4\u7684\u5730\u5740\u3002</li> </ul> </li> </ul> <p>\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u3001\u4e0d\u4fee\u6539\u4ee3\u7801\uff0c\u800c\u662f\u901a\u8fc7\u4fee\u6539\u201c\u5730\u5740\u6570\u636e\u201d\u6765\u8fdb\u884c\u5173\u8054\u7684\u529e\u6cd5\u3002\u5b83\u6709\u70b9 C \u8bed\u8a00\u91cc\u9762\u7528\u51fd\u6570\u6307\u9488\u6765\u8c03\u7528\u5bf9\u5e94\u7684\u51fd\u6570\uff0c\u5e76\u4e0d\u662f\u901a\u8fc7\u9884\u5148\u5df2\u7ecf\u786e\u5b9a\u597d\u7684\u51fd\u6570\u540d\u79f0\u6765\u8c03\u7528\uff0c\u800c\u662f\u5229\u7528\u5f53\u65f6\u5b83\u5728\u5185\u5b58\u91cc\u9762\u7684\u52a8\u6001\u5730\u5740\u6765\u8c03\u7528\u3002</p> </li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_14","title":"\u603b\u7ed3","text":"<p>\u5728\u9759\u6001\u94fe\u63a5\u548c\u7a0b\u5e8f\u88c5\u8f7d\u4e4b\u540e\uff0c\u5229\u7528\u52a8\u6001\u94fe\u63a5\u628a\u5185\u5b58\u5229\u7528\u5230\u4e86\u6781\u81f4\u3002</p> <p>\u540c\u6837\u529f\u80fd\u7684\u4ee3\u7801\u751f\u6210\u7684\u5171\u4eab\u5e93\uff0c\u6211\u4eec\u53ea\u8981\u5728\u5185\u5b58\u91cc\u9762\u4fdd\u7559\u4e00\u4efd\u5c31\u597d\u4e86\u3002</p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u4e0d\u4ec5\u80fd\u591f\u505a\u5230\u4ee3\u7801\u5728\u5f00\u53d1\u9636\u6bb5\u7684\u590d\u7528\uff0c\u4e5f\u80fd\u505a\u5230\u4ee3\u7801\u5728\u8fd0\u884c\u9636\u6bb5\u7684\u590d\u7528\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u8fdb\u884c Linux \u4e0b\u7684\u7a0b\u5e8f\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e00\u76f4\u4f1a\u7528\u5230\u5404\u79cd\u5404\u6837\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002C \u8bed\u8a00\u7684\u6807\u51c6\u5e93\u5c31\u5728 1MB \u4ee5\u4e0a\u3002</p> <p>\u6211\u4eec\u64b0\u5199\u4efb\u4f55\u4e00\u4e2a\u7a0b\u5e8f\u53ef\u80fd\u90fd\u9700\u8981\u7528\u5230\u8fd9\u4e2a\u5e93\uff0c\u5e38\u89c1\u7684 Linux \u670d\u52a1\u5668\u91cc\uff0c/usr/bin \u4e0b\u9762\u5c31\u6709\u4e0a\u5343\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002\u5982\u679c\u6bcf\u4e00\u4e2a\u90fd\u628a\u6807\u51c6\u5e93\u9759\u6001\u94fe\u63a5\u8fdb\u6765\u7684\uff0c\u51e0 GB \u4e43\u81f3\u51e0\u5341 GB \u7684\u78c1\u76d8\u7a7a\u95f4\u4e00\u4e0b\u5b50\u5c31\u7528\u51fa\u53bb\u4e86\u3002\u5982\u679c\u6211\u4eec\u670d\u52a1\u7aef\u7684\u591a\u8fdb\u7a0b\u5e94\u7528\u8981\u5f00\u4e0a\u5343\u4e2a\u8fdb\u7a0b\uff0c\u51e0 GB \u7684\u5185\u5b58\u7a7a\u95f4\u4e5f\u4f1a\u4e00\u4e0b\u5b50\u5c31\u7528\u51fa\u53bb\u4e86\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5728\u8fc7\u53bb\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u8f83\u5c11\u7684\u65f6\u5019\u66f4\u52a0\u663e\u8457\u3002\u901a\u8fc7\u52a8\u6001\u94fe\u63a5\u8fd9\u4e2a\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8bf4\u5f7b\u5e95\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u5c31\u50cf\u5171\u4eab\u5355\u8f66\u4e00\u6837\uff0c\u5982\u679c\u4ed4\u7ec6\u7ecf\u8425\uff0c\u662f\u4e00\u4e2a\u5f88\u6709\u793e\u4f1a\u4ef7\u503c\u7684\u4e8b\u60c5\uff0c\u4f46\u662f\u5982\u679c\u7c97\u66b4\u5730\u628a\u5b83\u53d8\u6210\u65e0\u9650\u5236\u5730\u590d\u5236\u751f\u4ea7\uff0c\u7ed9\u6bcf\u4e2a\u4eba\u9020\u4e00\u8f86\uff0c\u53ea\u4f1a\u5728\u7cfb\u7edf\u5185\u5236\u9020\u5927\u91cf\u65e0\u7528\u7684\u5783\u573e\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_15","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>\u50cf\u52a8\u6001\u94fe\u63a5\u8fd9\u6837\u901a\u8fc7\u4fee\u6539\u201c\u5730\u5740\u6570\u636e\u201d\u6765\u8fdb\u884c\u95f4\u63a5\u8df3\u8f6c\uff0c\u53bb\u8c03\u7528\u4e00\u5f00\u59cb\u4e0d\u80fd\u786e\u5b9a\u4f4d\u7f6e\u4ee3\u7801\u7684\u601d\u8def\uff0c\u5728\u54ea\u91cc\u8fd8\u89c1\u8fc7\uff1f</p> <p>Nested vectored interrupt controller\uff0c\u5373\u5d4c\u5957\u5411\u91cf\u4e2d\u65ad\u63a7\u5236\u5668\uff08NVIC\uff09\u3002STM32\u4e2d\u7684NVIC\u8be6\u89e3-CSDN\u535a\u5ba2</p> </li> </ul> <p>\u200b    </p> <ul> <li> <p>\u8c03\u7528\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u51fd\u6570\u7684\u5177\u4f53\u8fc7\u7a0b</p> <ol> <li>\u5f53\u8c03\u7528show\u51fd\u6570\uff0c\u9996\u5148\u627e\u5230show\u51fd\u6570\u81ea\u5df1\u7684PLT\uff08\u865a\u62df\u5730\u5740\uff09\uff0c\u77e5\u9053\u6307\u4ee4\u7684\u5730\u5740\uff0c</li> <li>\u7136\u540e\u627e\u5230\u8be5\u6761\u6307\u4ee4\u540e\u518d\u53bb\u5171\u4eab\u5e93\u7684GOT\u4e2d\u627e\u5230\u8fd9\u4e2a\u6307\u4ee4\uff0c\u627e\u5230\u8fd9\u4e2a\u6307\u4ee4\u5728so\u4e2d\u7684\u504f\u79fb\u91cf\uff0c</li> <li>\u6839\u636e\u865a\u62df\u5730\u5740\u548c\u504f\u79fb\u91cf\u786e\u5b9a\u6700\u7ec8\u7684\u5171\u4eab\u5e93\u4ee3\u7801\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\uff08xxxx+xxxx\uff09\uff0c</li> <li>(\u53ef\u4e0d\u770b) \u6839\u636e\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u627e\u5230\u4ee3\u7801\u5b9e\u9645\u5b58\u653e\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u8fd0\u884c\u3002 </li> </ol> </li> <li> <p>\u5728\u7f16\u8bd1\u3001\u6c47\u7f16\u3001\u94fe\u63a5\u3001\u88c5\u8f7d\u8fd9\u51e0\u4e2a\u9636\u6bb5\uff0c\u600e\u4e48\u4e0e\u5e93\u76f8\u5173\u5462</p> <ol> <li>\u7f16\u8bd1\u9636\u6bb5\uff1a\u5728\u7f16\u8bd1\u9636\u6bb5\uff0c\u7f16\u8bd1\u5668\u4f1a\u5c06\u6e90\u4ee3\u7801\u8f6c\u6362\u4e3a\u6c47\u7f16\u4ee3\u7801\u3002\u5982\u679c\u6e90\u4ee3\u7801\u4e2d\u5f15\u7528\u4e86\u5e93\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u6216\u53d8\u91cf\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u6b64\u9636\u6bb5\u68c0\u67e5\u51fd\u6570\u7684\u58f0\u660e\u548c\u53d8\u91cf\u7684\u5b9a\u4e49\u662f\u5426\u5339\u914d\uff0c\u5e76\u751f\u6210\u76f8\u5e94\u7684\u8c03\u7528\u6216\u8bbf\u95ee\u4ee3\u7801\u3002\u5982\u679c\u5e93\u6587\u4ef6\u7684\u5934\u6587\u4ef6\u88ab\u5305\u542b\u5728\u6e90\u4ee3\u7801\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f1a\u4f7f\u7528\u5934\u6587\u4ef6\u4e2d\u7684\u58f0\u660e\u4fe1\u606f\u3002</li> <li>\u6c47\u7f16\u9636\u6bb5\uff1a\u5728\u6c47\u7f16\u9636\u6bb5\uff0c\u6c47\u7f16\u5668\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u6362\u4e3a\u76ee\u6807\u6587\u4ef6\u3002\u5982\u679c\u6c47\u7f16\u4ee3\u7801\u4e2d\u5f15\u7528\u4e86\u5e93\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u6216\u53d8\u91cf\uff0c\u6c47\u7f16\u5668\u4f1a\u751f\u6210\u76f8\u5e94\u7684\u5f15\u7528\u6307\u4ee4\uff0c\u5e76\u5728\u94fe\u63a5\u9636\u6bb5\u89e3\u6790\u8fd9\u4e9b\u5f15\u7528\u3002</li> <li>\u94fe\u63a5\u9636\u6bb5\uff1a\u5728\u94fe\u63a5\u9636\u6bb5\uff0c\u94fe\u63a5\u5668\u5c06\u76ee\u6807\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u548c\u53d8\u91cf\u7b26\u53f7\u89e3\u6790\u5e76\u8fdb\u884c\u7b26\u53f7\u89e3\u6790\u3002\u5982\u679c\u7a0b\u5e8f\u5f15\u7528\u4e86\u5e93\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u6216\u53d8\u91cf\uff0c\u94fe\u63a5\u5668\u4f1a\u5c06\u8fd9\u4e9b\u5f15\u7528\u4e0e\u5e93\u6587\u4ef6\u4e2d\u7684\u5b9a\u4e49\u8fdb\u884c\u5173\u8054\uff0c\u5e76\u751f\u6210\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</li> <li>\u88c5\u8f7d\u9636\u6bb5\uff1a\u5728\u88c5\u8f7d\u9636\u6bb5\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u8fd0\u884c\u3002\u5982\u679c\u7a0b\u5e8f\u4f9d\u8d56\u4e8e\u52a8\u6001\u94fe\u63a5\u5e93\uff08.dll/.so\uff09\uff0c\u5219\u5728\u8fd0\u884c\u65f6\u4f1a\u6839\u636e\u9700\u8981\u52a0\u8f7d\u76f8\u5e94\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002</li> </ol> </li> <li> <p>\u7528\u81ea\u5df1\u7684\u8bdd\u63cf\u8ff0\u52a8\u6001\u94fe\u63a5\u548c\u9759\u6001\u94fe\u63a5</p> <p>\u9759\u6001\u94fe\u63a5\u548c\u52a8\u6001\u94fe\u63a5\u662f\u7528\u4e8e\u5c06\u7a0b\u5e8f\u4e0e\u5e93\u6587\u4ef6\u8fde\u63a5\u5728\u4e00\u8d77\u7684\u4e24\u79cd\u4e0d\u540c\u65b9\u5f0f\u3002</p> <p>\u9759\u6001\u94fe\u63a5\u662f\u6307\u5728\u7f16\u8bd1\u65f6\u5c06\u7a0b\u5e8f\u6240\u9700\u7684\u5e93\u6587\u4ef6\u7684\u4ee3\u7801\u548c\u6570\u636e\u590d\u5236\u5230\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u3002\u8fd9\u610f\u5473\u7740\u53ef\u6267\u884c\u6587\u4ef6\u5305\u542b\u4e86\u6240\u6709\u6240\u9700\u7684\u5e93\u6587\u4ef6\u7684\u4ee3\u7801\u548c\u6570\u636e\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u5916\u90e8\u7684\u5e93\u6587\u4ef6\u3002\u9759\u6001\u94fe\u63a5\u7684\u4f18\u70b9\u662f\u7a0b\u5e8f\u7684\u79fb\u690d\u6027\u66f4\u597d\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u4f9d\u8d56\u5916\u90e8\u7684\u5e93\u6587\u4ef6\uff1b\u4f46\u7f3a\u70b9\u662f\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4f53\u79ef\u8f83\u5927\uff0c\u4e14\u5982\u679c\u5e93\u6587\u4ef6\u66f4\u65b0\u6216\u4fee\u590d\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u6574\u4e2a\u7a0b\u5e8f\u3002</p> <p>\u52a8\u6001\u94fe\u63a5\u662f\u6307\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u624d\u5c06\u7a0b\u5e8f\u6240\u9700\u7684\u5e93\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002\u53ef\u6267\u884c\u6587\u4ef6\u53ea\u5305\u542b\u7a0b\u5e8f\u7684\u4ee3\u7801\u548c\u6570\u636e\uff0c\u800c\u5e93\u6587\u4ef6\u5b58\u50a8\u5728\u72ec\u7acb\u7684\u6587\u4ef6\u4e2d\uff0c\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u52a0\u8f7d\u8fd9\u4e9b\u5e93\u6587\u4ef6\u3002\u52a8\u6001\u94fe\u63a5\u7684\u4f18\u70b9\u662f\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4f53\u79ef\u8f83\u5c0f\uff0c\u4e14\u5e93\u6587\u4ef6\u7684\u66f4\u65b0\u548c\u4fee\u590d\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u6574\u4e2a\u7a0b\u5e8f\uff1b\u4f46\u7f3a\u70b9\u662f\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u9700\u8981\u4f9d\u8d56\u5916\u90e8\u7684\u5e93\u6587\u4ef6\uff0c\u53ef\u80fd\u4f1a\u53d7\u5230\u5e93\u6587\u4ef6\u7248\u672c\u517c\u5bb9\u6027\u7b49\u95ee\u9898\u7684\u5f71\u54cd\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#11","title":"11 | \u4e8c\u8fdb\u5236\u7f16\u7801\uff1a\u201c\u624b\u6301\u4e24\u628a\u951f\u65a4\u62f7\uff0c\u53e3\u4e2d\u75be\u547c\u70eb\u70eb\u70eb\u201d\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_16","title":"\u5b57\u7b26\u96c6\u548c\u5b57\u7b26\u7f16\u7801","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_17","title":"\u4e71\u7801","text":"<p>\u540c\u6837\u7684\u6587\u672c\uff0c\u91c7\u7528\u4e0d\u540c\u7684\u7f16\u7801\u5b58\u50a8\u4e0b\u6765\u3002\u5982\u679c\u53e6\u5916\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u7528\u4e00\u79cd\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\u6765\u8fdb\u884c\u89e3\u7801\u548c\u5c55\u793a\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e71\u7801</p> <p>\u9996\u5148\uff0c\u201c\u951f\u65a4\u62f7\u201d\u7684\u6765\u6e90\u662f\u8fd9\u6837\u7684\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u7528 Unicode \u7f16\u7801\u8bb0\u5f55\u4e00\u4e9b\u6587\u672c\uff0c\u7279\u522b\u662f\u4e00\u4e9b\u9057\u7559\u7684\u8001\u5b57\u7b26\u96c6\u5185\u7684\u6587\u672c\uff0c\u4f46\u662f\u8fd9\u4e9b\u5b57\u7b26\u5728 Unicode \u4e2d\u53ef\u80fd\u5e76\u4e0d\u5b58\u5728\u3002\u4e8e\u662f\uff0cUnicode \u4f1a\u7edf\u4e00\u628a\u8fd9\u4e9b\u5b57\u7b26\u8bb0\u5f55\u4e3a U+FFFD \u8fd9\u4e2a\u7f16\u7801\u3002\u5982\u679c\u7528 UTF-8 \u7684\u683c\u5f0f\u5b58\u50a8\u4e0b\u6765\uff0c\u5c31\u662f\\xef\\xbf\\xbd\u3002\u5982\u679c\u8fde\u7eed\u4e24\u4e2a\u8fd9\u6837\u7684\u5b57\u7b26\u653e\u5728\u4e00\u8d77\uff0c\\xef\\xbf\\xbd\\xef\\xbf\\xbd\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u7a0b\u5e8f\u628a\u8fd9\u4e2a\u5b57\u7b26\uff0c\u7528 GB2312 \u7684\u65b9\u5f0f\u8fdb\u884c decode\uff0c\u5c31\u4f1a\u53d8\u6210\u201c\u951f\u65a4\u62f7\u201d\u3002\u8fd9\u5c31\u597d\u6bd4\u6211\u4eec\u7528 GB2312 \u8fd9\u672c\u5bc6\u7801\u672c\uff0c\u53bb\u89e3\u5bc6\u522b\u4eba\u7528 UTF-8 \u52a0\u5bc6\u7684\u4fe1\u606f\uff0c\u81ea\u7136\u6ca1\u529e\u6cd5\u8bfb\u51fa\u6709\u7528\u7684\u4fe1\u606f\u3002</p> <p>\u800c\u201c\u70eb\u70eb\u70eb\u201d\uff0c\u5219\u662f\u56e0\u4e3a\u5982\u679c\u4f60\u7528\u4e86 Visual Studio \u7684\u8c03\u8bd5\u5668\uff0c\u9ed8\u8ba4\u4f7f\u7528 MBCS \u5b57\u7b26\u96c6\u3002\u201c\u70eb\u201d\u5728\u91cc\u9762\u662f\u7531 0xCCCC \u6765\u8868\u793a\u7684\uff0c\u800c 0xCC \u53c8\u6070\u597d\u662f\u672a\u521d\u59cb\u5316\u7684\u5185\u5b58\u7684\u8d4b\u503c\u3002\u4e8e\u662f\uff0c\u5728\u8bfb\u5230\u6ca1\u6709\u8d4b\u503c\u7684\u5185\u5b58\u5730\u5740\u6216\u8005\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u7535\u8111\u5c31\u5f00\u59cb\u5927\u53eb\u201c\u70eb\u70eb\u70eb\u201d\u4e86\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_18","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li>\u539f\u7801 \u53cd\u7801 \u8865\u7801</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#12","title":"12 | \u7406\u89e3\u7535\u8def\uff1a\u4ece\u7535\u62a5\u673a\u5230\u95e8\u7535\u8def\uff0c\u6211\u4eec\u5982\u4f55\u505a\u5230\u201c\u5343\u91cc\u4f20\u4fe1\u201d\uff1f","text":"<p>\u901a\u4fe1\u539f\u7406\uff1f</p> <p>\u7ee7\u7535\u5668\uff1f\uff08\u7535\u9a7f\uff09---&gt;WiFi</p> <p>\u6bd4\u5982\u8bf4\uff0c\u4f60\u5728\u5bb6\u91cc\u7528 WiFi\uff0c\u5982\u679c\u4f60\u7684\u5c4b\u5b50\u6bd4\u8f83\u5927\uff0c\u53ef\u80fd\u67d0\u4e9b\u623f\u95f4\u7684\u4fe1\u53f7\u5c31\u4e0d\u597d\u3002\u4f60\u53ef\u4ee5\u9009\u7528\u652f\u6301\u201c\u4e2d\u7ee7\u201d\u7684 WiFi \u8def\u7531\u5668\uff0c\u5728\u4fe1\u53f7\u8870\u51cf\u7684\u5730\u65b9\uff0c\u589e\u52a0\u4e00\u4e2a WiFi \u8bbe\u5907\uff0c\u63a5\u6536\u539f\u6765\u7684 WiFi \u4fe1\u53f7\uff0c\u518d\u91cd\u65b0\u4ece\u5f53\u524d\u8282\u70b9\u4f20\u8f93\u51fa\u53bb\u3002\u8fd9\u79cd\u4e2d\u7ee7\u5bf9\u5e94\u7684\u82f1\u6587\u540d\u8bcd\u548c\u7ee7\u7535\u5668\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u53eb Relay\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#13","title":"13 | \u52a0\u6cd5\u5668\uff1a\u5982\u4f55\u50cf\u642d\u4e50\u9ad8\u4e00\u6837\u642d\u7535\u8def\uff08\u4e0a\uff09\uff1f","text":"<p>\u57fa\u672c\u7535\u8def --&gt; \u95e8\u7535\u8def --&gt; \u5168\u52a0\u5668 --&gt; \u52a0\u6cd5\u5668\uff0c</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#14","title":"14 | \u4e58\u6cd5\u5668\uff1a\u5982\u4f55\u50cf\u642d\u4e50\u9ad8\u4e00\u6837\u642d\u7535\u8def\uff08\u4e0b\uff09\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_19","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>\u4e3a\u4ec0\u4e48\u6676\u4f53\u7ba1\u7684\u6570\u91cf\u589e\u52a0\u53ef\u4ee5\u4f18\u5316\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u6027\u80fd\uff1f</p> <p></p> <p>\u4ece\u6700\u7b80\u5355\u7684\u987a\u5e8f\u6267\u884c\u7684\u52a0\u6cd5\u5668/\u4e58\u6cd5\u5668\u6765\u770b\uff0c\u987a\u5e8f\u6267\u884c\u7b26\u5408\u4eba\u8111\u7684\u601d\u7ef4\uff0c\u4f46\u662f\u901f\u5ea6\u5f88\u6162\uff0c\u6bcf\u4e00\u6b21\u8ba1\u7b97\u90fd\u8981\u5fcd\u53d7\u524d\u4e00\u6b21\u7684\u95e8\u5ef6\u8fdf\uff0c\u6240\u4ee5\u60f3\u8fdb\u4e00\u6b65\u4f18\u5316\u3002</p> <p>\u7531\u4e8e\u7535\u8def\u5929\u7136\u7684\u5e76\u884c\u6027\uff0c\u5404\u79cd\u8fd0\u7b97\u80fd\u540c\u65f6\u8fdb\u884c\uff0c\u901f\u5ea6\u5c31\u80fd\u63d0\u5347\u3002</p> <p>\u4e3a\u4e86\u8fbe\u5230\u4e0a\u56fe\u6548\u679c\uff08\u4e0a\u56fe\u7684\u95e8\u7535\u8def\u5c55\u5f00\uff09\uff0c\u5145\u5206\u5229\u7528\u7535\u8def\u5e76\u884c\u6027\uff0c\u8ba9\u6bcf\u6b21\u8fd0\u7b97\u7684\u6bcf\u4e00\u6b65\u90fd\u6709\u4e00\u4e2a\u52a0\u6cd5\u6a21\u5757\u53ef\u4ee5\u7528\uff0c\u4e0d\u9700\u8981\u7b49\u7740\u524d\u9762\u7684\u8fd0\u7b97\u7b97\u5b8c\u4e86\u624d\u8f6e\u5230\u81ea\u5df1\uff08\u8fd9\u4e00\u6b65\u7684\u8ba1\u7b97\uff09\uff0c\u6240\u4ee5\u534a\u52a0\u5668\u5c31\u8981\u591a\u9020\u51e0\u4e2a\uff0c\u6676\u4f53\u7ba1\u6570\u91cf\u4e0a\u53bb\u4e86\uff0c\u4f46\u662f\u6027\u80fd\u66f4\u4e0a\u53bb\u4e86\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#_20","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7 ALU \u548c\u95e8\u7535\u8def\uff0c\u642d\u5efa\u51fa\u6765\u4e86\u4e58\u6cd5\u5668\u3002\u5982\u679c\u613f\u610f\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5f88\u591a\u5728\u751f\u6d3b\u4e2d\u4e0d\u5f97\u4e0d\u987a\u5e8f\u6267\u884c\u7684\u4e8b\u60c5\uff0c\u901a\u8fc7\u7b80\u5355\u5730\u8fde\u7ed3\u4e00\u4e0b\u7ebf\u8def\uff0c\u5c31\u53d8\u6210\u5e76\u884c\u6267\u884c\u4e86\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u786c\u4ef6\u7535\u8def\u6709\u4e00\u4e2a\u5f88\u5927\u7684\u7279\u70b9\uff0c\u90a3\u5c31\u662f\u4fe1\u53f7\u90fd\u662f\u5b9e\u65f6\u4f20\u8f93\u7684\u3002</p> <p>\u6211\u4eec\u4e5f\u770b\u5230\u4e86\u4e24\u79cd\u8bbe\u8ba1\u7535\u8def\u7684\u601d\u8def</p> <ul> <li>\u7528\u66f4\u5c11\u66f4\u7b80\u5355\u7cbe\u5de7\u7684\u7535\u8def\u8bbe\u8ba1\uff0c\u4f46\u662f\u9700\u8981\u66f4\u957f\u7684\u95e8\u5ef6\u8fdf\u548c\u65f6\u949f\u5468\u671f\uff1b</li> <li>\u7528\u66f4\u590d\u6742\u7684\u7535\u8def\uff0c\u4f46\u662f\u66f4\u77ed\u7684\u95e8\u5ef6\u8fdf\u548c\u65f6\u949f\u5468\u671f\u6765\u8ba1\u7b97\u4e00\u4e2a\u590d\u6742\u7684\u6307\u4ee4\uff0c</li> <li>\u5176\u5b9e\u5c31\u662f\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u4e2d RISC \u548c CISC \u7684\u7ecf\u5178\u5386\u53f2\u8def\u7ebf\u4e4b\u4e89\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#15-bit","title":"15 | \u6d6e\u70b9\u6570\u548c\u5b9a\u70b9\u6570\uff08\u4e0a\uff09\uff1a\u600e\u4e48\u7528\u6709\u9650\u7684Bit\u8868\u793a\u5c3d\u53ef\u80fd\u591a\u7684\u4fe1\u606f\uff1f","text":"<ul> <li> <p>\u8bfe\u540e\u601d\u8003</p> <p>\u4e3a\u4ec0\u4e48\u8ba1\u7b97\u673a\u4e2d0.3+0.6= 0.89999999....</p> <p>\u56e0\u4e3a\u6d6e\u70b9\u6570\u662f\u4e00\u4e2a\u8fd1\u4f3c\u8ba1\u7b97\uff0c0-1.0\u4e2d\uff0c\u53ea\u67090.5\u80fd\u88ab\u7cbe\u786e\u8868\u793a</p> </li> <li></li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html#16","title":"16 | \u6d6e\u70b9\u6570\u548c\u5b9a\u70b9\u6570\uff08\u4e0b\uff09\uff1a\u6df1\u5165\u7406\u89e3\u6d6e\u70b9\u6570\u5230\u5e95\u6709\u4ec0\u4e48\u7528\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html","title":"2. \u5904\u7406\u5668","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#17-cpu","title":"17 | \u5efa\u7acb\u6570\u636e\u901a\u8def\uff08\u4e0a\uff09\uff1a\u6307\u4ee4+\u8fd0\u7b97=CPU","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#18-cpu","title":"18 | \u5efa\u7acb\u6570\u636e\u901a\u8def\uff08\u4e2d\uff09\uff1a\u6307\u4ee4+\u8fd0\u7b97=CPU","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#19-cpu","title":"19 | \u5efa\u7acb\u6570\u636e\u901a\u8def\uff08\u4e0b\uff09\uff1a\u6307\u4ee4+\u8fd0\u7b97=CPU","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#20-cpu","title":"20 | \u9762\u5411\u6d41\u6c34\u7ebf\u7684\u6307\u4ee4\u8bbe\u8ba1\uff08\u4e0a\uff09\uff1a\u4e00\u5fc3\u591a\u7528\u7684\u73b0\u4ee3CPU","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#21-4","title":"21 | \u9762\u5411\u6d41\u6c34\u7ebf\u7684\u6307\u4ee4\u8bbe\u8ba1\uff08\u4e0b\uff09\uff1a\u5954\u817e4\u662f\u600e\u4e48\u5931\u8d25\u7684\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_1","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>\u4e3a\u4ec0\u4e48\u63d0\u5347\u6d41\u6c34\u7ebf\u7ea7\u6570\u80fd\u63d0\u5347\u4e3b\u9891</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u4f7f\u52b2\u5728\u4e00\u4e2aCPU\u4e0a\u5806\u591a\u51e0\u4e2a\u6838\u5fc3\uff1f</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#22-hazard","title":"22 | \u5192\u9669\u548c\u9884\u6d4b\uff08\u4e00\uff09\uff1ahazard\u662f\u201c\u5371\u201d\u4e5f\u662f\u201c\u673a\u201d","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#23","title":"23 | \u5192\u9669\u548c\u9884\u6d4b\uff08\u4e8c\uff09\uff1a\u6d41\u6c34\u7ebf\u91cc\u7684\u63a5\u529b\u8d5b","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#24-cpu","title":"24 | \u5192\u9669\u548c\u9884\u6d4b\uff08\u4e09\uff09\uff1aCPU\u91cc\u7684\u201c\u7ebf\u7a0b\u6c60\u201d","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#25","title":"25 | \u5192\u9669\u548c\u9884\u6d4b\uff08\u56db\uff09\uff1a\u4eca\u5929\u4e0b\u96e8\u4e86\uff0c\u660e\u5929\u8fd8\u4f1a\u4e0b\u96e8\u4e48\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#26-superscalarvliwcpu1","title":"26 | Superscalar\u548cVLIW\uff1a\u5982\u4f55\u8ba9CPU\u7684\u541e\u5410\u7387\u8d85\u8fc71\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#27-simd","title":"27 | SIMD\uff1a\u5982\u4f55\u52a0\u901f\u77e9\u9635\u4e58\u6cd5\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#28","title":"28 | \u5f02\u5e38\u548c\u4e2d\u65ad\uff1a\u7a0b\u5e8f\u51fa\u9519\u4e86\u600e\u4e48\u529e\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#29-ciscriscarm","title":"29 | CISC\u548cRISC\uff1a\u4e3a\u4ec0\u4e48\u624b\u673a\u82af\u7247\u90fd\u662fARM\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#30-gpugpu","title":"30 | GPU\uff08\u4e0a\uff09\uff1a\u4e3a\u4ec0\u4e48\u73a9\u6e38\u620f\u9700\u8981\u4f7f\u7528GPU\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#31-gpugpu","title":"31 | GPU\uff08\u4e0b\uff09\uff1a\u4e3a\u4ec0\u4e48\u6df1\u5ea6\u5b66\u4e60\u9700\u8981\u4f7f\u7528GPU\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#32-fpgaasic","title":"32 | FPGA\u548cASIC\uff1a\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u7684\u9ec4\u91d1\u65f6\u4ee3","text":"<p>\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u7684\u9ec4\u91d1\u65f6\u4ee3</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#fpgafield-programmable-gate-array","title":"FPGA\uff1a\u73b0\u573a\u53ef\u7f16\u7a0b\u95e8\u9635\u5217\uff08Field-Programmable Gate Array\uff09","text":"<p>\u8bbe\u8ba1\u66f4\u7b80\u5355\u4e00\u70b9\u513f\u7684\u4e13\u7528\u4e8e\u7279\u5b9a\u529f\u80fd\u7684\u82af\u7247\uff0c\u5c11\u4e0d\u4e86\u8981\u51e0\u4e2a\u6708\u3002\u800c\u8bbe\u8ba1\u4e00\u4e2a CPU\uff0c\u5f80\u5f80\u8981\u4ee5\u201c\u5e74\u201d\u6765\u8ba1\u3002</p> <p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u786c\u4ef6\u5de5\u7a0b\u5e08\u4eec\u8981\u8bbe\u8ba1\u3001\u9a8c\u8bc1\u5404\u79cd\u5404\u6837\u7684\u6280\u672f\u65b9\u6848\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u5404\u79cd\u5404\u6837\u7684 Bug\u3002\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u9a8c\u8bc1\u4e00\u4e2a\u65b9\u6848\uff0c\u90fd\u8981\u5355\u72ec\u8bbe\u8ba1\u751f\u4ea7\u4e00\u5757\u82af\u7247\uff0c\u90a3\u8fd9\u4e2a\u4ee3\u4ef7\u4e5f\u592a\u9ad8\u4e86\u3002</p> <p>\u6211\u4eec\u80fd\u4e0d\u80fd \u4e0d\u7528\u5355\u72ec\u5236\u9020\u4e00\u5757\u4e13\u95e8\u7684\u82af\u7247\u6765\u9a8c\u8bc1\u786c\u4ef6\u8bbe\u8ba1\u5462\uff1f</p> <p>\u80fd\u4e0d\u80fd\u8bbe\u8ba1\u4e00\u4e2a\u786c\u4ef6\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u7a0b\u5e8f\u4ee3\u7801\uff0c\u6765\u64cd\u4f5c\u8fd9\u4e2a\u786c\u4ef6\u4e4b\u524d\u7684\u7535\u8def\u8fde\u7ebf\uff0c\u901a\u8fc7\u201c\u7f16\u7a0b\u201d\u8ba9\u8fd9\u4e2a\u786c\u4ef6\u53d8\u6210\u6211\u4eec\u8bbe\u8ba1\u7684\u7535\u8def\u8fde\u7ebf\u7684\u82af\u7247\u5462\uff1f</p> <ul> <li>P \u4ee3\u8868 Programmable\uff0c\u5373\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u901a\u8fc7\u7f16\u7a0b\u6765\u63a7\u5236\u7684\u786c\u4ef6\u3002</li> <li>G \u4ee3\u8868 Gate \u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5b83\u5c31\u4ee3\u8868\u82af\u7247\u91cc\u9762\u7684\u95e8\u7535\u8def\u3002\u6211\u4eec\u80fd\u591f\u53bb\u8fdb\u884c\u7f16\u7a0b\u7ec4\u5408\u7684\u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u4e00\u4e2a\u95e8\u7535\u8def\u3002</li> <li>A \u4ee3\u8868\u7684 Array\uff0c\u53eb\u4f5c\u9635\u5217\uff0c\u8bf4\u7684\u662f\u5728\u4e00\u5757 FPGA \u4e0a\uff0c\u5bc6\u5bc6\u9ebb\u9ebb\u5217\u4e86\u5927\u91cf Gate \u8fd9\u6837\u7684\u95e8\u7535\u8def\u3002</li> <li>F \u8868\u793a\u73b0\u573a\uff0c\u5b83\u5176\u5b9e\u662f\u8bf4\uff0c\u4e00\u5757 FPGA \u8fd9\u6837\u7684\u677f\u5b50\uff0c\u53ef\u4ee5\u5728\u201c\u73b0\u573a\u201d\u591a\u6b21\u8fdb\u884c\u7f16\u7a0b\u3002\u5b83\u4e0d\u50cf PAL\uff08Programmable Array Logic\uff0c\u53ef\u7f16\u7a0b\u9635\u5217\u903b\u8f91\uff09\u8fd9\u6837\u66f4\u53e4\u8001\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u53ea\u80fd\u201c\u7f16\u7a0b\u201d\u4e00\u6b21\uff0c\u628a\u9884\u5148\u5199\u597d\u7684\u7a0b\u5e8f\u4e00\u6b21\u6027\u70e7\u5f55\u5230\u786c\u4ef6\u91cc\u9762\uff0c\u4e4b\u540e\u5c31\u4e0d\u80fd\u518d\u4fee\u6539\u4e86\u3002</li> </ul> <p>\u8fd9\u4e48\u770b\u6765\uff0c\u5176\u5b9e\u201cFPGA\u201d\u8fd9\u6837\u7684\u7ec4\u5408\uff0c\u57fa\u672c\u4e0a\u89e3\u51b3\u4e86\u6211\u4eec\u524d\u9762\u8bf4\u7684\u60f3\u8981\u8bbe\u8ba1\u786c\u4ef6\u7684\u95ee\u9898\u3002\u6211\u4eec\u53ef\u4ee5\u50cf\u8f6f\u4ef6\u4e00\u6837\u5bf9\u786c\u4ef6\u7f16\u7a0b\uff0c\u53ef\u4ee5\u53cd\u590d\u70e7\u5f55\uff0c\u8fd8\u6709\u6d77\u91cf\u7684\u95e8\u7535\u8def\uff0c\u53ef\u4ee5\u7ec4\u5408\u5b9e\u73b0\u590d\u6742\u7684\u82af\u7247\u529f\u80fd\u3002</p> <p>\u8f6f\u4ef6\u6539\u53d8\u4e16\u754c\uff1aFPGA\u8fd9\u4e2a\u4f8b\u5b50</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_2","title":"\u5177\u4f53\u7f16\u7a0b","text":"<ol> <li> <p>\u5b58\u50a8\u529f\u80fd\u6362\u7ec4\u5408\u903b\u8f91</p> <p>\u5728\u5b9e\u73b0 CPU \u7684\u529f\u80fd\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5b8c\u6210\u5404\u79cd\u5404\u6837\u7684\u7535\u8def\u903b\u8f91\u3002</p> <p>\u5728 FPGA \u91cc\uff0c\u8fd9\u4e9b\u57fa\u672c\u7684\u7535\u8def\u903b\u8f91\uff0c\u4e0d\u662f\u91c7\u7528\u5e03\u7ebf\u8fde\u63a5\u7684\u65b9\u5f0f\u8fdb\u884c\u7684\uff0c\u800c\u662f\u9884\u5148\u6839\u636e\u6211\u4eec\u5728\u8f6f\u4ef6\u91cc\u9762\u8bbe\u8ba1\u7684\u903b\u8f91\u7535\u8def\uff0c\u7b97\u51fa\u5bf9\u5e94\u7684\u771f\u503c\u8868\uff0c\u7136\u540e\u76f4\u63a5\u5b58\u5230\u4e00\u4e2a\u53eb\u4f5c LUT\uff08Look-Up Table\uff0c\u67e5\u627e\u8868\uff09\u7684\u7535\u8def\u91cc\u9762\u3002</p> <p>\u8fd9\u4e2a LUT \u5462\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u5757\u5b58\u50a8\u7a7a\u95f4\uff0c\u91cc\u9762\u5b58\u50a8\u4e86\u201c\u7279\u5b9a\u7684\u8f93\u5165\u4fe1\u53f7\u4e0b\uff0c\u5bf9\u5e94\u8f93\u51fa 0 \u8fd8\u662f 1\u201d\u3002</p> <p>\u53ef\u4ee5\u60f3\u8c61\u6210\u8fd9\u662f\u4e00\u5f2099 x 99\u4e58\u6cd5\u8868\uff0c\u8f93\u5165\u4e24\u4e2a\u6570\u76f8\u4e58\uff0c\u6839\u636e\u67e5\u8868\u5f97\u5230\u7ed3\u679c\uff0c\u4e0d\u7528\u4f60\u7b97\u4e86\u3002\uff08\u5df2\u7ecf\u5728\u8bbe\u8ba1\u903b\u8f91\u7535\u8def\u7684\u65f6\u5019\u7b97\u597d\u4e86\uff09</p> </li> <li> <p>\u5bf9\u4e8e\u9700\u8981\u5b9e\u73b0\u7684\u65f6\u5e8f\u903b\u8f91\u7535\u8def\uff0c\u5728 FPGA \u91cc\u9762\u76f4\u63a5\u653e\u4e0a D \u89e6\u53d1\u5668\uff0c\u4f5c\u4e3a\u5bc4\u5b58\u5668\u3002</p> <p>\u8fd9\u4e2a\u548c CPU \u91cc\u7684\u89e6\u53d1\u5668\u6ca1\u6709\u4ec0\u4e48\u672c\u8d28\u4e0d\u540c\u3002</p> <p>\u4e0d\u8fc7\uff0c\u6211\u4eec\u4f1a\u628a\u5f88\u591a\u4e2a LUT \u7684\u7535\u8def\u548c\u5bc4\u5b58\u5668\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u53d8\u6210\u4e00\u4e2a\u53eb\u4f5c\u903b\u8f91\u7c07\uff08Logic Cluster\uff09\u7684\u4e1c\u897f\u3002\uff08\u7ec4\u5408\u903b\u8f91 + \u65f6\u5e8f\u903b\u8f91\uff09</p> <p>\u5728 FPGA \u91cc\uff0c\u8fd9\u6837\u7ec4\u5408\u4e86\u591a\u4e2a LUT \u548c\u5bc4\u5b58\u5668\u7684\u8bbe\u5907\uff0c\u4e5f\u88ab\u53eb\u505a CLB\uff08Configurable Logic Block\uff0c\u53ef\u914d\u7f6e\u903b\u8f91\u5757\uff09\u3002</p> <p>\u901a\u8fc7\u914d\u7f6e CLB \u5b9e\u73b0\u7684\u529f\u80fd\u6709\u70b9\u513f\u50cf\u4e4b\u524d\u8bb2\u8fc7\u7684\u5168\u52a0\u5668\u3002</p> <p>\u5b83\u5df2\u7ecf\u5728\u6700\u57fa\u7840\u7684\u95e8\u7535\u8def\u4e0a\u505a\u4e86\u7ec4\u5408\uff0c\u80fd\u591f\u63d0\u4f9b\u66f4\u590d\u6742\u4e00\u70b9\u7684\u529f\u80fd\u3002\u66f4\u590d\u6742\u7684\u82af\u7247\u529f\u80fd\uff0c\u6211\u4eec\u4e0d\u7528\u518d\u4ece\u95e8\u7535\u8def\u642d\u8d77\uff0c\u53ef\u4ee5\u901a\u8fc7 CLB \u7ec4\u5408\u642d\u5efa\u51fa\u6765\u3002\uff08\u642d\u79ef\u6728\uff09</p> </li> <li> <p>FPGA \u901a\u8fc7\u53ef\u7f16\u7a0b\u903b\u8f91\u5e03\u7ebf\uff0c\u6765\u8fde\u63a5\u5404\u4e2a\u4e0d\u540c\u7684 CLB\uff0c\u6700\u7ec8\u5b9e\u73b0\u60f3\u8981\u5b9e\u73b0\u7684\u82af\u7247\u529f\u80fd\u3002</p> <p></p> <p>\u8fd9\u4e2a\u53ef\u7f16\u7a0b\u903b\u8f91\u5e03\u7ebf\uff0c\u53ef\u4ee5\u628a\u5b83\u5f53\u6210\u6211\u4eec\u7684\u94c1\u8def\u7f51\u3002</p> <p>\u6574\u4e2a\u94c1\u8def\u7cfb\u7edf\u5df2\u7ecf\u94fa\u597d\u4e86\uff0c\u4f46\u662f\u6574\u4e2a\u94c1\u8def\u7f51\u91cc\u9762\uff0c\u8bbe\u8ba1\u4e86\u5f88\u591a\u4e2a\u9053\u5c94\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u9053\u5c94\uff0c\u6765\u786e\u5b9a\u4e0d\u540c\u7684\u5217\u8f66\u7ebf\u8def\u3002</p> <p>\u6545\uff0c\u6211\u4eec\u5b9e\u9645 \u201c\u7f16\u7a0b\u201d \u5728\u505a\u7684\uff0c\u5c31\u662f\u62e8\u52a8\u50cf\u9053\u5c94\u4e00\u6837\u7684\u5404\u4e2a\u7535\u8def\u5f00\u5173\uff0c\u6700\u7ec8\u5b9e\u73b0\u4e0d\u540c CLB \u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u5b8c\u6210\u6211\u4eec\u60f3\u8981\u7684\u82af\u7247\u529f\u80fd\u3002</p> </li> </ol> <p>\u901a\u8fc7 LUT \u548c\u5bc4\u5b58\u5668\uff0c\u6211\u4eec\u80fd\u591f\u7ec4\u5408\u51fa\u5f88\u591a CLB\uff0c\u800c\u901a\u8fc7\u8fde\u63a5\u4e0d\u540c\u7684 CLB\uff0c\u6700\u7ec8\u6709\u4e86\u6211\u4eec\u60f3\u8981\u7684\u82af\u7247\u529f\u80fd\u3002</p> <p>\u6700\u5173\u952e\u7684\u662f\uff0c\u8fd9\u4e2a\u7ec4\u5408\u8fc7\u7a0b\u662f\u53ef\u4ee5\u201c\u7f16\u7a0b\u201d\u63a7\u5236\u7684\u3002\u800c\u4e14\u8fd9\u4e2a\u7f16\u7a0b\u51fa\u6765\u7684\u8f6f\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u540e\u7eed\u6539\u5199\uff0c\u91cd\u65b0\u5199\u5165\u5230\u786c\u4ef6\u91cc\u3002</p> <p>\u8ba9\u540c\u4e00\u4e2a\u786c\u4ef6\u5b9e\u73b0\u4e0d\u540c\u7684\u82af\u7247\u529f\u80fd\u3002\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0cFPGA \u4e5f\u662f\u201c\u8f6f\u4ef6\u541e\u566c\u4e16\u754c\u201d\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#asicapplication-specific-integrated-circuit","title":"ASIC\uff1a\u4e13\u7528\u96c6\u6210\u7535\u8def\uff08Application-Specific Integrated Circuit\uff09","text":"<p>\u4e3a\u5404\u79cd\u573a\u666f\u4e13\u95e8\u8bbe\u8ba1\u7684\u82af\u7247\u3002</p> <p>\u56e0\u4e3a ASIC \u662f\u9488\u5bf9\u4e13\u95e8\u7528\u9014\u8bbe\u8ba1\u7684\uff0c\u6240\u4ee5\u5b83\u7684\u7535\u8def\u66f4\u7cbe\u7b80\uff0c\u5355\u7247\u7684\u5236\u9020\u6210\u672c\u4e5f\u6bd4 CPU \u66f4\u4f4e\u3002</p> <p>\u800c\u4e14\uff0c\u56e0\u4e3a\u7535\u8def\u7cbe\u7b80\uff0c\u6240\u4ee5\u901a\u5e38\u80fd\u8017\u8981\u6bd4\u7528\u6765\u505a\u901a\u7528\u8ba1\u7b97\u7684 CPU \u66f4\u4f4e\u3002\u800c\u6211\u4eec\u4e0a\u4e00\u8bb2\u6240\u8bf4\u7684\u65e9\u671f\u7684\u56fe\u5f62\u52a0\u901f\u5361GPU\uff0c\u5176\u5b9e\u5c31\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u79cd ASIC\u3002</p> <p>\u56e0\u4e3a ASIC \u7684\u751f\u4ea7\u5236\u9020\u6210\u672c\uff0c\u4ee5\u53ca\u80fd\u8017\u4e0a\u7684\u4f18\u52bf\uff0c\u8fc7\u53bb\u51e0\u5e74\u91cc\uff0c\u6709\u4e0d\u5c11\u516c\u53f8\u8bbe\u8ba1\u548c\u5f00\u53d1 ASIC \u7528\u6765\u201c\u6316\u77ff\u201d\u3002</p> <p>\u8fd9\u4e2a\u201c\u6316\u77ff\u201d\uff0c\u8bf4\u7684\u5176\u5b9e\u5c31\u662f\u8bbe\u8ba1\u4e13\u95e8\u7684\u6570\u503c\u8ba1\u7b97\u82af\u7247\uff0c\u7528\u6765\u201c\u6316\u201d\u6bd4\u7279\u5e01\u3001ETH \u8fd9\u6837\u7684\u6570\u5b57\u8d27\u5e01\u3002</p> <p></p> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#fpga-asic","title":"FPGA \u548c ASIC \u7684\u5dee\u5f02","text":"<p>\u80fd\u4e0d\u80fd\u7528 FPGA \u6765\u505a ASIC \u7684\u4e8b\u60c5\u5462\uff1f\u53ef\u4ee5\u7684\uff0c\u6211\u4eec\u5bf9 FPGA \u8fdb\u884c\u201c\u7f16\u7a0b\u201d\uff0c\u5176\u5b9e\u5c31\u662f\u628a FPGA \u7684\u7535\u8def\u53d8\u6210\u4e86\u4e00\u4e2a ASIC\u3002</p> <p>\u8fd9\u6837\u7684\u82af\u7247\uff0c\u5f80\u5f80\u5728\u6210\u672c\u548c\u529f\u8017\u4e0a\u4f18\u4e8e\u9700\u8981\u505a\u901a\u7528\u8ba1\u7b97\u7684 CPU \u548c GPU\u3002</p> <p>\u90a3\u4e3a\u4ec0\u4e48\u6211\u4eec\u5e72\u8106\u4e0d\u8981\u7528 ASIC \u4e86\uff0c\u5168\u90fd\u7528 FPGA \u4e0d\u5c31\u597d\u4e86\u4e48\uff1f\u5176\u5b9e FPGA \u4e00\u6837\u6709\u7f3a\u70b9\uff0c\u90a3\u5c31\u662f\u5b83\u7684\u786c\u4ef6\u4e0a\u6709\u70b9\u513f\u201c\u6d6a\u8d39\u201d\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#fpga","title":"FPGA \u7684\u4f18\u52a3","text":"<ul> <li> <p>\u7f3a\u70b9</p> <p>\u6bcf\u4e00\u4e2a LUT \u7535\u8def\uff0c\u5176\u5b9e\u90fd\u662f\u4e00\u4e2a\u5c0f\u5c0f\u7684\u201c\u6d6a\u8d39\u201d\u3002\u4e00\u4e2a LUT \u7535\u8def\u8bbe\u8ba1\u51fa\u6765\u4e4b\u540e\uff0c\u65e2\u53ef\u4ee5\u5b9e\u73b0\u4e0e\u95e8\uff0c\u53c8\u53ef\u4ee5\u5b9e\u73b0\u6216\u95e8\uff0c\u81ea\u7136\u7528\u5230\u7684\u6676\u4f53\u7ba1\u6570\u91cf\uff0c\u6bd4\u5355\u7eaf\u8fde\u6b7b\u7684\u4e0e\u95e8\u6216\u8005\u6216\u95e8\u7684\u8981\u591a\u5f97\u591a\u3002</p> <p>\u540c\u65f6\uff0c\u56e0\u4e3a\u7528\u7684\u6676\u4f53\u7ba1\u591a\uff0c\u5b83\u7684\u80fd\u8017\u4e5f\u6bd4\u5355\u7eaf\u8fde\u6b7b\u7684\u7535\u8def\u8981\u5927\uff0c\u5355\u7247 FPGA \u7684\u751f\u4ea7\u5236\u9020\u7684\u6210\u672c\u4e5f\u6bd4 ASIC \u8981\u9ad8\u4e0d\u5c11\u3002</p> </li> <li> <p>\u4f18\u70b9</p> <p>FPGA\u6ca1\u6709\u786c\u4ef6\u7814\u53d1\u6210\u672c\u3002</p> <p>ASIC \u7684\u7535\u8def\u8bbe\u8ba1\uff0c\u9700\u8981\u4eff\u771f\u3001\u9a8c\u8bc1\uff0c\u8fd8\u9700\u8981\u7ecf\u8fc7\u6d41\u7247\uff08Tape out\uff09\uff0c\u53d8\u6210\u4e00\u4e2a\u5370\u5237\u7684\u7535\u8def\u7248\uff0c\u6700\u7ec8\u53d8\u6210\u82af\u7247\u3002\u8fd9\u6574\u4e2a\u4ece\u7814\u53d1\u5230\u4e0a\u5e02\u7684\u8fc7\u7a0b\uff0c\u6700\u4f4e\u82b1\u8d39\u4e5f\u8981\u51e0\u4e07\u7f8e\u5143\uff0c\u9ad8\u7684\u8bdd\uff0c\u4f1a\u5728\u51e0\u5343\u4e07\u4e43\u81f3\u6570\u4ebf\u7f8e\u5143\u3002\u66f4\u4f55\u51b5\uff0c\u6574\u4e2a\u8bbe\u8ba1\u8fd8\u6709\u5931\u8d25\u7684\u53ef\u80fd\u3002</p> </li> </ul> <p>\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u8bbe\u8ba1\u7684\u4e13\u7528\u82af\u7247\uff0c\u53ea\u662f\u8981\u5236\u9020\u51e0\u5343\u7247\uff0c\u90a3\u4e70\u51e0\u5343\u7247\u73b0\u6210\u7684 FPGA\uff0c\u53ef\u80fd\u8fdc\u6bd4\u82b1\u4e0a\u51e0\u767e\u4e07\u7f8e\u5143\uff0c\u6765\u8bbe\u8ba1\u3001\u5236\u9020 ASIC \u8981\u7ecf\u6d4e\u5f97\u591a\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_3","title":"\u5177\u4f53\u4f7f\u7528","text":"<p>\u5230\u5e95\u4f7f\u7528 ASIC \u8fd9\u6837\u7684\u4e13\u7528\u82af\u7247\uff0c\u8fd8\u662f\u91c7\u7528 FPGA \u8fd9\u6837\u53ef\u7f16\u7a0b\u7684\u901a\u7528\u786c\u4ef6\uff0c\u6838\u5fc3\u7684\u51b3\u7b56\u56e0\u7d20\u8fd8\u662f\u6210\u672c\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u4e2a\u6210\u672c\uff0c\u4e0d\u53ea\u662f\u5355\u4e2a\u82af\u7247\u7684\u751f\u4ea7\u5236\u9020\u6210\u672c\uff0c\u8fd8\u8981\u8003\u8651\u603b\u4f53\u62e5\u6709\u6210\u672c\uff08Total Cost of Ownership\uff09\u3002</p> <p>\u5373\uff0c\u9664\u4e86\u751f\u4ea7\u6210\u672c\u4e4b\u5916\uff0c\u6211\u4eec\u8981\u628a\u7814\u53d1\u6210\u672c\u4e5f\u7b97\u8fdb\u53bb\u3002</p> <p>\u5982\u679c\u6211\u4eec\u53ea\u5236\u9020\u4e86\u4e00\u7247\u82af\u7247\uff0c\u90a3\u4e48\u6210\u672c\u4e3a\uff1a</p> <p>\u200b                                   \u201c\u8fd9\u679a\u82af\u7247\u7684\u6210\u672c + \u4e3a\u4e86\u8fd9\u679a\u82af\u7247\u5efa\u7684\u751f\u4ea7\u7ebf\u7684\u6210\u672c + \u82af\u7247\u7684\u7814\u53d1\u6210\u672c\u201d</p> <p>\u800c\u4e0d\u53ea\u662f\uff1a</p> <p>\u200b                                   \u201c\u82af\u7247\u7684\u539f\u6750\u6599\u6c99\u5b50\u7684\u6210\u672c + \u751f\u4ea7\u7684\u7535\u8d39\u201d\u3002</p> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_4","title":"\u603b\u7ed3\u7c7b\u6bd4","text":"<p>\u6211\u4eec\u65e5\u5e38\u8f6f\u4ef6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u9700\u8981\u505a\u540c\u6837\u7684\u51b3\u7b56\u3002</p> <p>\u5f88\u591a\u6211\u4eec\u9700\u8981\u7684\u529f\u80fd\uff0c\u53ef\u80fd\u5728\u5e02\u9762\u4e0a\u5df2\u7ecf\u6709\u5f00\u6e90\u7684\u8f6f\u4ef6\u53ef\u4ee5\u5b9e\u73b0\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u5f00\u6e90\u7684\u8f6f\u4ef6\u4e4b\u4e0a\u505a\u914d\u7f6e\u6216\u8005\u5f00\u53d1\u63d2\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u81ea\u5df1\u4ece\u5934\u5f00\u59cb\u5199\u4ee3\u7801\u3002</p> <ul> <li> <p>\u5728\u5f00\u6e90\u8f6f\u4ef6\u6216\u8005\u662f\u4e70\u6765\u7684\u5546\u4e1a\u8f6f\u4ef6\u4e0a\u542f\u52a8\uff0c\u5f80\u5f80\u80fd\u5f88\u5feb\u8ba9\u4ea7\u54c1\u4e0a\u7ebf\u3002</p> </li> <li> <p>\u5982\u679c\u4ece\u5934\u5f00\u59cb\u5199\u4ee3\u7801\uff0c\u5f80\u5f80\u4f1a\u6709\u4e00\u7b14\u4e0d\u5730\u7684 NRE \u6210\u672c\uff0c\u4e5f\u5c31\u662f\u7814\u53d1\u6210\u672c\u3002\u4f46\u662f\u901a\u5e38\u6211\u4eec\u81ea\u5df1\u5199\u7684\u4ee3\u7801\uff0c\u80fd\u591f 100% \u8d34\u8fd1\u6211\u4eec\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u540e\u7eed\u968f\u7740\u4e1a\u52a1\u9700\u6c42\u7684\u6539\u9020\u6210\u672c\u4f1a\u66f4\u4f4e\u3002\u5982\u679c\u8981\u5927\u89c4\u6a21\u90e8\u7f72\u5f88\u591a\u670d\u52a1\u5668\u7684\u8bdd\uff0c\u670d\u52a1\u5668\u7684\u6210\u672c\u4f1a\u66f4\u4f4e\u3002</p> <p>\u5b66\u4f1a\u4ece TCO \u548c NRE \u7684\u6210\u672c\u53bb\u8861\u91cf\u505a\u51b3\u7b56</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_5","title":"\u63a8\u8350\u9605\u8bfb","text":"<p>A New Golden Age for Computer Architecture | February 2019 | Communications of the ACM</p> <p>A New Golden Age for Computer Architecture - EECS at Berkeley</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#_6","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u9664\u4e86 FPGA\u3001ASIC \u4e4b\u5916\uff0c\u4f60\u6700\u8fd1\u5173\u6ce8\u5230\u4ec0\u4e48\u65b0\u7684\u3001\u6709\u610f\u601d\u7684\u786c\u4ef6\u5462\uff1f</p> <ul> <li>\u8fb9\u7f18\u8ba1\u7b97\u8bbe\u5907</li> <li>\u91cf\u5b50\u8ba1\u7b97\u8bbe\u5907</li> <li></li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#33-tpuasic","title":"33 | \u89e3\u8bfbTPU\uff1a\u8bbe\u8ba1\u548c\u62c6\u89e3\u4e00\u5757ASIC\u82af\u7247","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html#34","title":"34 | \u7406\u89e3\u865a\u62df\u673a\uff1a\u4f60\u5728\u4e91\u4e0a\u62ff\u5230\u7684\u8ba1\u7b97\u673a\u662f\u4ec0\u4e48\u6837\u7684\uff1f","text":"<p>\u200b   </p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html","title":"3. \u5b58\u50a8\u4e0eIO\u7cfb\u7edf","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#35","title":"35 | \u5b58\u50a8\u5668\u5c42\u6b21\u7ed3\u6784\u5168\u666f\uff1a\u6570\u636e\u5b58\u50a8\u7684\u5927\u91d1\u5b57\u5854\u957f\u4ec0\u4e48\u6837\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_1","title":"\u603b\u7ed3","text":"<ul> <li>Storage hierarchy \u5b58\u50a8\u5c42\u6b21\u7ed3\u6784</li> </ul> <p>\u5bc4\u5b58\u5668--&gt;CPU cache(SRAM)--&gt;\u5185\u5b58(DRAM)--&gt;\u786c\u76d8(SSD(\u57fa\u4e8eNAND...)\u3001HDD)</p> <ul> <li>CPU \u6bd4\u55bb\u6210\u9ad8\u901f\u8fd0\u8f6c\u7684\u5927\u8111\uff0c\u90a3\u4e48\u548c\u5927\u8111\u540c\u6b65\u7684\u5bc4\u5b58\u5668\uff08Register\uff09\uff0c\u5c31\u5b58\u653e\u7740\u6211\u4eec\u5f53\u4e0b\u6b63\u5728\u601d\u8003\u548c\u5904\u7406\u7684\u6570\u636e\u3002</li> <li>L1-L3 \u7684 CPU Cache\uff0c\u597d\u6bd4\u5b58\u653e\u5728\u6211\u4eec\u5927\u8111\u4e2d\u7684\u77ed\u671f\u5230\u957f\u671f\u7684\u8bb0\u5fc6\u3002\u6211\u4eec\u9700\u8981\u5c0f\u5c0f\u82b1\u8d39\u4e00\u70b9\u65f6\u95f4\uff0c\u5c31\u80fd\u8c03\u53d6\u5e76\u8fdb\u884c\u5904\u7406\u3002</li> <li>\u81ea\u5df1\u7684\u4e66\u684c\u4e66\u67b6\u5c31\u597d\u6bd4\u8ba1\u7b97\u673a\u7684\u5185\u5b58\uff0c\u80fd\u653e\u4e0b\u66f4\u591a\u7684\u4e66\u4e5f\u5c31\u662f\u6570\u636e\uff0c\u4f46\u662f\u627e\u8d77\u6765\u548c\u770b\u8d77\u6765\u5c31\u8981\u6162\u4e0a\u4e0d\u5c11\u3002</li> <li>\u56fe\u4e66\u9986\u66f4\u50cf\u786c\u76d8\u8fd9\u4e2a\u5916\u5b58\uff0c\u80fd\u591f\u653e\u4e0b\u66f4\u591a\u7684\u6570\u636e\uff0c\u627e\u8d77\u6765\u4e5f\u66f4\u8d39\u65f6\u95f4\u3002</li> <li>\u4ece\u5bc4\u5b58\u5668\u3001CPU Cache\uff0c\u5230\u5185\u5b58\u3001\u786c\u76d8\uff0c\u8fd9\u6837\u4e00\u5c42\u5c42\u4e0b\u6765\u7684\u5b58\u50a8\u5668\uff0c\u901f\u5ea6\u8d8a\u6765\u8d8a\u6162\uff0c\u7a7a\u95f4\u8d8a\u6765\u8d8a\u5927\uff0c\u4ef7\u683c\u4e5f\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_2","title":"\u63a8\u8350\u6587\u7ae0\uff1a","text":"<ul> <li> <p>Peter Novig \u7684 Teach Yourself Programming in Ten Years (norvig.com)</p> <p>\u5728\u4e86\u89e3\u4e00\u4e9b\u6709\u5173\u5b58\u50a8\u7684\u6570\u636e\u4e4b\u540e\u8bfb\u4e00\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u3002\u8fd9\u4e9b\u6570\u5b57\u968f\u7740\u6469\u5c14\u5b9a\u5f8b\u7684\u53d1\u5c55\u5728\u4e0d\u65ad\u7f29\u5c0f\uff0c\u4f46\u662f\u5728\u6570\u91cf\u7ea7\u4e0a\u4ecd\u7136\u6709\u7740\u5f88\u5f3a\u7684\u53c2\u8003\u4ef7\u503c\u3002</p> </li> <li> <p>Jeff Dean \u7684Slide 1 (googleusercontent.com)</p> <p>\u8fd9\u4efd PPT \u4e2d\u4e0d\u4ec5\u603b\u7ed3\u4e86\u8fd9\u4e9b\u6570\u5b57\uff0c\u8fd8\u6709\u5927\u91cf\u7684\u786c\u4ef6\u6545\u969c\u3001\u9ad8\u53ef\u7528\u548c\u7cfb\u7edf\u67b6\u6784\u7684\u8840\u6cea\u7ecf\u9a8c\u3002\u5c3d\u7ba1\u8fd9\u662f\u4e00\u4efd 10 \u5e74\u524d\u7684 PPT\uff0c\u4f46\u4e5f\u975e\u5e38\u503c\u5f97\u9605\u8bfb\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#36","title":"36 | \u5c40\u90e8\u6027\u539f\u7406\uff1a\u6570\u636e\u5e93\u6027\u80fd\u8ddf\u4e0d\u4e0a\uff0c\u52a0\u4e2a\u7f13\u5b58\u5c31\u597d\u4e86\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_3","title":"\u603b\u7ed3","text":"<p>\u9047\u5230\u6027\u80fd\u74f6\u9888\u3001\u7ed3\u6784\u5192\u9669/\u6570\u636e\u5192\u9669\uff1a\u52a0\u4e2a\u7f13\u5b58\uff01\uff01</p> <ul> <li>\u5c40\u90e8\u6027\u539f\u7406<ul> <li>\u65f6\u95f4\u5c40\u90e8\u6027\uff1a\u5982\u679c\u4e00\u4e2a\u6570\u636e\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5b83\u5728\u77ed\u65f6\u95f4\u5185\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u3002</li> <li>\u7a7a\u95f4\u5c40\u90e8\u6027\uff1a\u5982\u679c\u4e00\u4e2a\u6570\u636e\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u548c\u5b83\u76f8\u90bb\u7684\u6570\u636e\u4e5f\u5f88\u5feb\u4f1a\u88ab\u8bbf\u95ee\u3002</li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_4","title":"\u5982\u4f55\u82b1\u6700\u5c11\u7684\u94b1\u88c5\u4e0b\u4e9a\u9a6c\u900a\u6240\u6709\u7684\u5546\u54c1","text":"<p>\u5c06\u88ab\u8bbf\u95ee\u7684\u591a\u7684\u5546\u54c1\u653e\u5728\u5185\u5b58/\u7f13\u5b58\uff0c\u51b7\u95e8\u7684\u6216\u8005\u5185\u5b58\u4e2d\u957f\u65f6\u95f4\u6ca1\u88ab\u8bbf\u95ee\u7684\u5546\u54c1\u653e\u786c\u76d8\u3002</p> <p>\uff08LRU\u7b97\u6cd5\uff1aleast recently used\uff09</p> <p>\u4f30\u7b97\u65f6\u95f4</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#37-4","title":"37 | \u9ad8\u901f\u7f13\u5b58\uff08\u4e0a\uff09\uff1a\u201c4\u6beb\u79d2\u201d\u7a76\u7adf\u503c\u591a\u5c11\u94b1\uff1f","text":"<ul> <li> <p>\u7531\u5b58\u50a8\u5c42\u6b21\u7ed3\u6784</p> <p>\u7f13\u5b58\uff1a\u4e0a\u4e00\u7ea7\u7684\u5b58\u50a8\u8bbe\u5907\u662f\u8fd9\u4e00\u7ea7\u7684\u7f13\u5b58</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u7f13\u5b58</p> <p>\u5185\u5b58\u901f\u5ea6\u8ddf\u4e0d\u4e0aCPU\u53d1\u5c55\u4e86\uff0c\u4f46\u662f\u5185\u5b58\u6709\u5f88\u91cd\u8981\uff0c\u9700\u8981\u5f25\u8865\u6027\u80fd\u5dee\u5f02</p> </li> <li> <p>\u4f8b\u5b50\uff1a</p> <pre><code>int[] arr = new int[64 * 1024 * 1024];\n\n\n// \u5faa\u73af1\nfor (int i = 0; i &lt; arr.length; i++) arr[i] *= 3;  //\u8017\u65f6\uff1a50ms\n\n\n// \u5faa\u73af2\nfor (int i = 0; i &lt; arr.length; i += 16) arr[i] *= 3 //\u8017\u65f6\uff1a46ms\n</code></pre> </li> </ul> <p>\u8fd0\u884c\u7a0b\u5e8f\u7684\u65f6\u95f4\u4e3b\u8981\u82b1\u5728\u4e86\u5c06\u5bf9\u5e94\u7684\u6570\u636e\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u51fa\u6765\uff0c\u52a0\u8f7d\u5230 CPU Cache \u91cc\u3002</p> <p>CPU \u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5230 CPU Cache \u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\u6765\u8bfb\u53d6\u6570\u636e\u7684\uff0c\u800c\u4e0d\u662f\u6309\u7167\u5355\u4e2a\u6570\u7ec4\u5143\u7d20\u6765\u8bfb\u53d6\u6570\u636e\u7684\u3002\uff08\u7a7a\u95f4\u5c40\u90e8\u6027\uff0c\u6839\u636eCPU\u8bbe\u8ba1\u6765\u89c4\u5b9acache line \u7684\u5927\u5c0f\uff09</p> <p>\u8fd9\u6837\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\u7684\u6570\u636e\uff0c\u5728 CPU Cache \u91cc\u9762\uff0c\u6211\u4eec\u628a\u5b83\u53eb\u4f5c Cache Line\uff08\u7f13\u5b58\u5757\uff09\u3002</p> <p>\u73b0\u4ee3 CPU \u8fdb\u884c\u6570\u636e\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u65e0\u8bba\u6570\u636e\u662f\u5426\u5df2\u7ecf\u5b58\u50a8\u5728 Cache \u4e2d\uff0cCPU \u59cb\u7ec8\u4f1a\u9996\u5148\u8bbf\u95ee Cache\u3002</p> <p>\u53ea\u6709\u5f53 CPU \u5728 Cache \u4e2d\u627e\u4e0d\u5230\u6570\u636e\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u53bb\u8bbf\u95ee\u5185\u5b58\uff0c\u5e76\u5c06\u8bfb\u53d6\u5230\u7684\u6570\u636e\u5199\u5165 Cache \u4e4b\u4e2d\u3002\uff08\u5176\u4e2dcache\u547d\u4e2d\u7387\u572895%\u4ee5\u4e0a\uff09</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#cache","title":"\u76f4\u63a5\u6620\u5c04cache\u7684\u6570\u636e\u7ed3\u6784","text":"<p>CPU \u5982\u4f55\u77e5\u9053\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u6570\u636e\uff0c\u5b58\u50a8\u5728 Cache \u7684\u54ea\u4e2a\u4f4d\u7f6e\u5462</p> <p>\u76f4\u63a5\u6620\u5c04cache\uff1a\u786e\u4fdd\u4efb\u4f55\u4e00\u4e2a\u5185\u5b58\u5757\u7684\u5730\u5740\uff0c\u59cb\u7ec8\u6620\u5c04\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684 CPU Cache \u5730\u5740\uff08Cache Line\uff09\u3002\uff08 \u901a\u8fc7\u53d6\u6a21\u8fd0\u7b97\u83b7\u5f97\uff09</p> <p>\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u7684\u4e3b\u5185\u5b58\u88ab\u5206\u6210 0\uff5e31 \u53f7\u8fd9\u6837 32 \u4e2a\u5757\u3002\u6211\u4eec\u4e00\u5171\u6709 8 \u4e2a\u7f13\u5b58\u5757\u3002\u7528\u6237\u60f3\u8981\u8bbf\u95ee\u7b2c 21 \u53f7\u5185\u5b58\u5757\u3002\u5982\u679c 21 \u53f7\u5185\u5b58\u5757\u5185\u5bb9\u5728\u7f13\u5b58\u5757\u4e2d\u7684\u8bdd\uff0c\u5b83\u4e00\u5b9a\u5728 5 \u53f7\u7f13\u5b58\u5757\uff0821 mod 8 = 5\uff09\u4e2d\u3002</p> <p></p> <p>\u8fdb\u4e00\u6b65\u6280\u5de7\uff1a</p> <p>\u628a\u7f13\u5b58\u5757\u7684\u6570\u91cf\u8bbe\u7f6e\u6210 2 \u7684 N \u6b21\u65b9\u3002\u8fd9\u6837\u5728\u8ba1\u7b97\u53d6\u6a21\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u53d6\u5730\u5740\u7684\u4f4e N \u4f4d\uff0c\u4e5f\u5c31\u662f\u4e8c\u8fdb\u5236\u91cc\u9762\u7684\u540e\u51e0\u4f4d\u3002\uff08\u4e0b\u56fe101\uff09</p> <p></p> <p>\u4f46\u662f\u9664\u4e86 21 \u53f7\u5185\u5b58\u5757\u5916\uff0c13 \u53f7\u30015 \u53f7\u7b49\u5f88\u591a\u5185\u5b58\u5757\u7684\u6570\u636e\uff0c\u90fd\u5bf9\u5e94\u7740 5 \u53f7\u7f13\u5b58\u5757\u4e2d\u3002\u600e\u4e48\u77e5\u90535\u53f7\u7f13\u5b58\u5757\u4e2d\u5bf9\u5e94\u523021\u53f7\u5185\u5b58\u5757\u5462\uff1f</p> <p>--&gt;\u5728\u7f13\u5b58\u5757\u4e2d\uff0c\u7528\u4e00\u4e2a\u7ec4\u6807\u8bb0\uff08tag\uff09\u8bb0\u5f55\u662f\u54ea\u4e00\u4e2a\u5185\u5b58\u5757\u3002\u7531\u4e8e\u7f13\u5b58\u5757\u5df2\u7ecf\u8bb0\u5f55\u4e86\u5185\u5b58\u5757\u7684\u4f4e\u4e09\u4f4d\u5730\u5740\uff0c\u5219tag\u53ea\u9700\u8981\u8bb0\u5f55\u4f4e\u4e8c\u4f4d\u5c31\u53ef\u4ee5</p> <p>\u9664\u4e86\u7ec4\u6807\u8bb0\uff0c\u7f13\u5b58\u5757\u4e2d\u8fd8\u6709\u4e24\u4e2a\u6570\u636e\u3002\u4e00\u4e2a\u81ea\u7136\u662f\u4ece\u4e3b\u5185\u5b58\u4e2d\u52a0\u8f7d\u6765\u7684\u5b9e\u9645\u5b58\u653e\u7684\u6570\u636e\uff0c\u53e6\u4e00\u4e2a\u662f\u6709\u6548\u4f4d\uff08valid bit\uff09</p> <ul> <li>\u6709\u6548\u4f4d\uff0c\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684\u7f13\u5b58\u5757\u4e2d\u7684\u6570\u636e\u662f\u5426\u662f\u6709\u6548\u7684\uff0c\u786e\u4fdd\u4e0d\u662f\u673a\u5668\u521a\u521a\u542f\u52a8\u65f6\u5019\u7684\u7a7a\u6570\u636e\u3002\u5982\u679c\u6709\u6548\u4f4d\u662f 0\uff0c\u65e0\u8bba\u5176\u4e2d\u7684\u7ec4\u6807\u8bb0\u548c Cache Line \u91cc\u7684\u6570\u636e\u5185\u5bb9\u662f\u4ec0\u4e48\uff0cCPU \u90fd\u4e0d\u4f1a\u7ba1\u8fd9\u4e9b\u6570\u636e\uff0c\u800c\u8981\u76f4\u63a5\u8bbf\u95ee\u5185\u5b58\uff0c\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u3002</li> <li> <p>CPU \u5728\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u8981\u8bfb\u53d6\u4e00\u6574\u4e2a Block\uff0c\u800c\u662f\u8bfb\u53d6\u4e00\u4e2a\u4ed6\u9700\u8981\u7684\u6570\u636e\u7247\u6bb5\u3002\u8fd9\u6837\u7684\u6570\u636e\uff0c\u6211\u4eec\u53eb\u4f5c CPU \u91cc\u7684\u4e00\u4e2a\u5b57\uff08Word\uff09\u3002\u5177\u4f53\u662f\u54ea\u4e2a\u5b57\uff0c\u5c31\u7528\u8fd9\u4e2a\u5b57\u5728\u6574\u4e2a Block \u91cc\u9762\u7684\u4f4d\u7f6e\u6765\u51b3\u5b9a\u3002\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u6211\u4eec\u53eb\u4f5c\u504f\u79fb\u91cf\uff08Offset\uff09\u3002</p> </li> <li> <p>\u603b\u7ed3\uff1a</p> <p>\u4e00\u4e2a\u5185\u5b58\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u6700\u7ec8\u5305\u62ec</p> <p>\u9ad8\u4f4d\u4ee3\u8868\u7684\u7ec4\u6807\u8bb0\u3001</p> <p>\u4f4e\u4f4d\u4ee3\u8868\u7684\u7d22\u5f15\uff0c</p> <p>\u5728\u5bf9\u5e94\u7684 Data Block \u4e2d\u5b9a\u4f4d\u5bf9\u5e94\u5b57\u7684\u4f4d\u7f6e\u504f\u79fb\u91cf\u3002</p> <p></p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#cache_1","title":"\u76f4\u63a5\u6620\u5c04cache\u7684\u8bfb\u53d6\u6570\u636e\u8fc7\u7a0b","text":"<ol> <li>\u6839\u636e\u5185\u5b58\u5730\u5740\u7684\u4f4e\u4f4d\uff0c\u8ba1\u7b97\u5728 Cache \u4e2d\u7684\u7d22\u5f15\uff1b</li> <li>\u5224\u65ad\u6709\u6548\u4f4d\uff0c\u786e\u8ba4 Cache \u4e2d\u7684\u6570\u636e\u662f\u6709\u6548\u7684\uff1b</li> <li>\u5bf9\u6bd4\u5185\u5b58\u8bbf\u95ee\u5730\u5740\u7684\u9ad8\u4f4d\uff0c\u548c Cache \u4e2d\u7684\u7ec4\u6807\u8bb0\uff0c\u786e\u8ba4 Cache \u4e2d\u7684\u6570\u636e\u5c31\u662f\u6211\u4eec\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u6570\u636e\uff0c\u4ece Cache Line \u4e2d\u8bfb\u53d6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u5757\uff08Data Block\uff09\uff1b</li> <li>\u6839\u636e\u5185\u5b58\u5730\u5740\u7684 Offset \u4f4d\uff0c\u4ece Data Block \u4e2d\uff0c\u8bfb\u53d6\u5e0c\u671b\u8bfb\u53d6\u5230\u7684\u5b57\u3002</li> </ol> <p>\u5982\u679c\u5728 2\u30013 \u8fd9\u4e24\u4e2a\u6b65\u9aa4\u4e2d\uff0cCPU \u53d1\u73b0\uff0cCache \u4e2d\u7684\u6570\u636e\u5e76\u4e0d\u662f\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u5730\u5740\u7684\u6570\u636e\uff0c\u90a3 CPU \u5c31\u4f1a\u8bbf\u95ee\u5185\u5b58\uff0c\u5e76\u628a\u5bf9\u5e94\u7684 Block Data \u66f4\u65b0\u5230 Cache Line \u4e2d\uff0c\u540c\u65f6\u66f4\u65b0\u5bf9\u5e94\u7684\u6709\u6548\u4f4d\u548c\u7ec4\u6807\u8bb0\u7684\u6570\u636e\u3002</p> <p>\u8865\u5145\uff1a\u8fd8\u6709\u5168\u76f8\u8054cache\uff08\u7528\u5728TLB\uff09</p> <p>\u73b0\u4ee3\u7684CPU\u5f88\u5c11\u4f7f\u7528\u76f4\u63a5\u6620\u5c04cache\uff0c\u5927\u591a\u7528\u7ec4\u76f8\u8054cache</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_5","title":"\u63a8\u8350\u9605\u8bfb","text":"<p>CPU\u548c\u5185\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\uff1a</p> <p>What Every Programmer Should Know About Memory (freebsd.org)</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_6","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>\u5bf9\u4e8e\u4e8c\u7ef4\u6570\u7ec4\u7684\u8bbf\u95ee\uff0c\u6309\u884c\u8fed\u4ee3\u548c\u6309\u5217\u8fed\u4ee3\u7684\u8bbf\u95ee\u6027\u80fd\u662f\u4e00\u6837\u7684\u5417\uff1f\u4f60\u53ef\u4ee5\u5199\u4e00\u4e2a\u7a0b\u5e8f\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u5e76\u601d\u8003\u4e00\u4e0b\u539f\u56e0\u3002</p> <p>\u4ee5C\u8bed\u8a00\u4e3a\u4f8b\uff1a</p> <pre><code>//array1.c\n#include &lt;stdio.h&gt;\n\nint array[10240][10240];\n\nint main(int argc, char *argv[])\n{\n    int x,y;\n    for(x = 0; x &lt; 10240; x ++)\n    {\n        for(y = 0; y &lt; 10240; y ++)\n        {\n            array[x][y] = 1234;\n        }\n    }\n    return 0;\n}\n\n//array2.c\n#include &lt;stdio.h&gt; \nint array[10240][10240]; \nint main(int argc, char *argv[])\n{\n    int x,y;\n    for(x = 0; x &lt; 10240; x ++)\n    {\n        for(y = 0; y &lt; 10240; y ++)\n        {\n            array[y][x] = 1234;\n        }\n    }\n    return 0;\n}\n\n/* \u521d\u6b65\u5b9e\u9a8c */\njai@JAI:~/performance/ex1$ time ./array1\n\nreal    0m0.523s\nuser    0m0.069s\nsys 0m0.447s\n\njai@JAI:~/performance/ex1$ time ./array2\n\nreal    0m3.106s\nuser    0m2.583s\nsys 0m0.501s\n</code></pre> <p>\u4f7f\u7528perf\u5de5\u5177\u67e5\u770bL1 dcache\u7684\u547d\u4e2d\u7387</p> <p>\u9996\u5148\uff0cC\u8bed\u8a00\u6570\u7ec4\u662f\u5b58\u653e\u5728\u5730\u5740\u8fde\u7eed\u7684\u5185\u5b58\u4e2d\u7684\uff0c\u6b64\u5916\uff0cC\u8bed\u8a00\u7684\u591a\u7ef4\u6570\u7ec4\u662f\u6309\u884c\u8fd0\u884c\u5b58\u50a8\u7684\u3002</p> <p>\u8fd8\u6709cache line\u8bfb\u53d6\u7684\u95ee\u9898\uff0cC\u8bed\u8a00\u662f\u4ece\u5185\u5b58\u4e2d\u4e00\u884c\u4e00\u884c\u5730\u8bfb\u53d6\u6570\u636e\u5230\u9ad8\u901f\u7f13\u5b58\u4e2d\uff0c\u4e5f\u5c31\u662f\u884c\u8fed\u4ee3\uff0c\u4f7f\u5f97array1.c\u8fdb\u884c\u8d4b\u503c\u7684\u65f6\u5019\u76f4\u63a5\u4ece\u9ad8\u901f\u7f13\u5b58\u4e2d\u53d6\u5f97\u6570\u636e\u5c31\u884c\uff0c\u8fd9\u5c31\u4f7f\u5f97array1.c\u8fd0\u884c\u65f6\u95f4\u66f4\u6162\uff0c\u6027\u80fd\u66f4\u597d\u70b9\u3002</p> <p>\u8ba1\u7b97\u673a\u5185\u5b58\u4e2d\uff0c\u6570\u636e\u901a\u5e38\u4ee5\u8fde\u7eed\u7684\u5757\u8fdb\u884c\u5b58\u50a8\u3002\u5f53\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u5185\u5b58\u7684\u5206\u5757\u7ed3\u6784\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u4e2d\u3002\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u5229\u7528\u5c40\u90e8\u6027\u539f\u7406\uff0c\u5176\u4e2d\u7a0b\u5e8f\u503e\u5411\u4e8e\u91cd\u590d\u8bbf\u95ee\u76f8\u90bb\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</p> <p>\u5728array1.c\u4e2d\uff0c\u6309\u7167array[x] [y]\u7684\u987a\u5e8f\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\uff0c\u8fd9\u7b26\u5408\u4e86\u5185\u5b58\u8fde\u7eed\u5b58\u50a8\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u5728\u5185\u5b58\u8bbf\u95ee\u65f6\u53ef\u4ee5\u66f4\u597d\u5730\u5229\u7528\u7f13\u5b58\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> <p>\u800c\u5728array2.c\u4e2d\uff0c\u6309\u7167array[y] [x]\u7684\u987a\u5e8f\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\uff0c\u8fd9\u6837\u7684\u8bbf\u95ee\u65b9\u5f0f\u5bfc\u81f4\u4e86\u5bf9\u5185\u5b58\u7684\u4e0d\u8fde\u7eed\u8bbf\u95ee\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f13\u5b58\u672a\u547d\u4e2d\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u589e\u52a0\u4e86\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\u3002</p> <p>\u8865\u5145</p> <p>\u4e0d\u540c\u7f16\u7a0b\u8bed\u8a00\u5728\u5904\u7406\u591a\u7ef4\u6570\u7ec4\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u8fd9\u6d89\u53ca\u5230\u4e86\u6570\u7ec4\u7684\u5b58\u50a8\u987a\u5e8f\uff0c\u901a\u5e38\u79f0\u4e3a\u6570\u7ec4\u7684\u5b58\u50a8\u5e03\u5c40\u3002</p> <p>\u5728C/C++\u4e2d\uff0c\u591a\u7ef4\u6570\u7ec4\u901a\u5e38\u662f\u6309\u884c\u4e3b\u5e8f\uff08row-major order\uff09\u5b58\u50a8\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u53d8\u5316\u65f6\uff0c\u5185\u5b58\u5730\u5740\u8fde\u7eed\u53d8\u5316\uff1b\u800c\u5728Fortran\u548cMATLAB\u7b49\u8bed\u8a00\u4e2d\uff0c\u591a\u7ef4\u6570\u7ec4\u901a\u5e38\u662f\u6309\u5217\u4e3b\u5e8f\uff08column-major order\uff09\u5b58\u50a8\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u7d22\u5f15\u53d8\u5316\u65f6\uff0c\u5185\u5b58\u5730\u5740\u8fde\u7eed\u53d8\u5316\u3002</p> <p>\u8fd9\u79cd\u5dee\u5f02\u662f\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u548c\u8bed\u8a00\u8bbe\u8ba1\u7684\u4e0d\u540c\u800c\u4ea7\u751f\u7684\u3002\u5728C\u8bed\u8a00\u4e2d\uff0c\u6570\u7ec4\u7684\u5b58\u50a8\u987a\u5e8f\u4e0e\u5185\u5b58\u7684\u7ebf\u6027\u7ed3\u6784\u76f8\u5339\u914d\uff0c\u8fd9\u4f7f\u5f97\u6309\u884c\u4e3b\u5e8f\u5b58\u50a8\u7684\u65b9\u5f0f\u66f4\u52a0\u9ad8\u6548\u3002\u800c\u5728Fortran\u4e2d\uff0c\u6309\u5217\u4e3b\u5e8f\u5b58\u50a8\u7684\u65b9\u5f0f\u66f4\u5bb9\u6613\u4e0e\u6570\u5b66\u548c\u79d1\u5b66\u8ba1\u7b97\u7684\u4e60\u60ef\u76f8\u5951\u5408\u3002</p> <p>\u8fd9\u79cd\u5dee\u5f02\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5728\u4e0d\u540c\u8bed\u8a00\u4e2d\u5904\u7406\u591a\u7ef4\u6570\u7ec4\u65f6\u7684\u6027\u80fd\u5dee\u5f02\uff0c\u7279\u522b\u662f\u5728\u6d89\u53ca\u5927\u89c4\u6a21\u6570\u636e\u7684\u79d1\u5b66\u8ba1\u7b97\u548c\u6570\u636e\u5904\u7406\u65f6\u3002\u56e0\u6b64\uff0c\u5728\u8de8\u8bed\u8a00\u5f00\u53d1\u6216\u8005\u6570\u636e\u4ea4\u6362\u7684\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u6ce8\u610f\u591a\u7ef4\u6570\u7ec4\u7684\u5b58\u50a8\u987a\u5e8f\uff0c\u4ee5\u907f\u514d\u6027\u80fd\u635f\u5931\u6216\u8005\u9519\u8bef\u7684\u7ed3\u679c\u3002</p> </li> <li> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5173\u4e8e\u4e0a\u9762cache line\u8bfb\u53d6\u548cMMU\u7684\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u5728\u8fdb\u884c\u4ece\u5185\u5b58\u8bfb\u5230cache\u91cc\uff0c\u4f9d\u7167\u7684\u662f\u7269\u7406\u5730\u5740\u662f\u5417\uff1f\u548c\u865a\u62df\u5185\u5b58\u5730\u5740\u6ca1\u5173\u7cfb\uff1f</p> <p>MMU</p> <p>MMU\u5185\u5b58\u7ba1\u7406\u5355\u5143\u8d1f\u8d23\u5c06\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u3002</p> <p>\u865a\u62df\u5730\u5740\u662f\u7a0b\u5e8f\u4f7f\u7528\u7684\u5730\u5740\uff0c\u800c\u7269\u7406\u5730\u5740\u5219\u662f\u5b9e\u9645\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>\u5f53\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u7684\u65f6\u5019\uff0cMMU\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\uff0c\u7136\u540e\u8fdb\u884c\u5185\u5b58\u8bbf\u95ee\u3002</p> <p>cache\u00a0line</p> <p>\u5f53\u6570\u636e\u4ece\u5185\u5b58\u8bfb\u53d6\u5230\u7f13\u5b58\u4e2d\u65f6\uff0c\u901a\u5e38\u662f\u6309\u7167\u7269\u7406\u5730\u5740\u6765\u8fdb\u884c\u6570\u636e\u5757\u7684\u5b58\u50a8\u548c\u8bbf\u95ee\u7684\u3002</p> <p>\u56e0\u4e3a\u7f13\u5b58\u7684\u76ee\u7684\u662f\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u901f\u5ea6\uff0c\u800c\u7269\u7406\u5730\u5740\u662f\u5185\u5b58\u4e2d\u6570\u636e\u7684\u5b9e\u9645\u4f4d\u7f6e\u3002</p> <p>\u603b\u7ed3</p> <p>\u865a\u62df\u5185\u5b58\u662f\u4e00\u79cd\u901a\u8fc7MMU\u5c06\u7a0b\u5e8f\u4e2d\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u7684\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u63d0\u4f9b\u66f4\u5927\u7684\u5730\u5740\u7a7a\u95f4\u548c\u66f4\u597d\u7684\u5185\u5b58\u7ba1\u7406\u3002</p> <p>\u5728\u865a\u62df\u5185\u5b58\u7cfb\u7edf\u4e2d\uff0c\u7a0b\u5e8f\u4f7f\u7528\u7684\u5730\u5740\u662f\u865a\u62df\u5730\u5740\uff0c\u800c\u7f13\u5b58\u548c\u5185\u5b58\u64cd\u4f5c\u662f\u9488\u5bf9\u7269\u7406\u5730\u5740\u8fdb\u884c\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6570\u636e\u4ece\u5185\u5b58\u8bfb\u53d6\u5230\u7f13\u5b58\u4e2d\u65f6\uff0c\u6d89\u53ca\u5230\u7684\u662f\u7269\u7406\u5730\u5740\uff0c\u800c\u4e0e\u865a\u62df\u5185\u5b58\u5730\u5740\u5e76\u6ca1\u6709\u76f4\u63a5\u7684\u5173\u7cfb\u3002</p> <p>\u865a\u62df\u5185\u5b58\u5730\u5740\u7684\u8f6c\u6362\u662f\u5728\u5185\u5b58\u8bbf\u95ee\u4e4b\u524d\u8fdb\u884c\u7684\uff0c\u800c\u7f13\u5b58\u7684\u5de5\u4f5c\u662f\u57fa\u4e8e\u7269\u7406\u5730\u5740\u8fdb\u884c\u7684\u3002</p> <p>\uff08\u66f4\u8fdb\u4e00\u6b65\u67e5\u770b 41 \u8282\u7684\u8bfe\u540e\u9898\u548c\u201c[\u8865\u5145]\u201d\uff09</p> </li> <li> <p>\u5173\u4e8ecache \u548c\u4e94\u7ea7\u6d41\u6c34\u7ebf\u7684\u6307\u4ee4\u9884\u53d6\u7684\u6027\u80fd\u63d0\u5347</p> </li> <li> <p>Q\uff1a\u4e3a\u4ec0\u4e48\u5728\u5199\u591a\u91cdfor\u5faa\u73af\u7684\u65f6\u5019\uff0c\u5faa\u73af\u6b21\u6570\u591a\u7684\u5927\u5faa\u73af\u8981\u5199\u91cc\u9762\uff0c\u5c0f\u5faa\u73af\u5199\u5916\u9762\uff1f </p> <p>A\uff1a\u6211\u731c\u4f60\u9047\u5230\u7684\u95ee\u9898\u662f\u591a\u7ef4\u6570\u7ec4\u5b58\u50a8\u7ed3\u6784\u5e26\u6765\u7684Cache Line\u7684\u6027\u80fd\u5dee\u5f02\u95ee\u9898\uff1f\u5982\u679c\u662f\u8fd9\u79cd\u60c5\u51b5\u662f\u56e0\u4e3acache line\uff0cCPU\u4ece\u5185\u5b58\u52a0\u8f7d\u6570\u636e\u4f1a\u4e00\u4e2a\u4e00\u4e2aCache Line\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u91cc\u9762\u3002\u5982\u679c\u662f\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4f1a\u5728\u540e\u9762\u7684\u9ad8\u901f\u7f13\u5b58\u90e8\u5206\u4e13\u95e8\u8bb2\u89e3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>Q\uff1a\u8c22\u8c22\u8001\u5e08\u7684\u56de\u590d\uff0c\u6211\u5fd8\u4e86\u8d34\u4ee3\u7801\u4e86\uff0c\u9700\u8981\u4f18\u5316\u7684\u4ee3\u7801\u5982\u4e0b.\u7f51\u4e0a\u8bf4\u628a\u5927\u7684for\u5faa\u73af\u5199\u91cc\u9762\u662f\u4e3a\u4e86\u63d0\u9ad8CPU\u6d41\u6c34\u7ebf\u7684\u5206\u652f\u9884\u6d4b\u7684\u51c6\u786e\u7387\uff0c\u4f46\u662f\u6211\u5bf9\u8fd9\u4e2a\u4e0d\u662f\u5f88\u6e05\u695a\u3002</p> <pre><code>for\uff08i=0;i&lt;1000;i++\uff09{\n        for\uff08j=0;j&lt;100;j++\uff09{\n                for\uff08k=0;k&lt;10;k++\uff09{\n                       printf(\u201c%d\u201d,i+j+k);\n                }\n        }\n}\n</code></pre> <p>A\uff1a\u7684\u786e\u662f\uff0c\u4e00\u4e2a\u662f\u6bcf100\u6b21\u731c\u9519\u4e00\u6b21\uff0c\u4e00\u4e2a\u662f10\u6b21\u731c\u9519\u4e00\u6b21\uff0c\u6027\u80fd\u4e0a\u4f1a\u6709\u5dee\u522b\uff0c\u4f60\u53ef\u4ee5\u81ea\u5df1\u5199\u4e2a\u7a0b\u5e8f\u7edf\u8ba1\u4e00\u4e0b\u65f6\u95f4\u8bd5\u8bd5</p> <p>\u5728\u7f16\u5199\u591a\u91cd\u5faa\u73af\u65f6\uff0c\u5c06\u5faa\u73af\u6b21\u6570\u591a\u7684\u5927\u5faa\u73af\u653e\u5728\u5185\u5c42\uff0c\u800c\u5faa\u73af\u6b21\u6570\u5c11\u7684\u5c0f\u5faa\u73af\u653e\u5728\u5916\u5c42\uff0c\u662f\u4e3a\u4e86\u5229\u7528CPU\u6d41\u6c34\u7ebf\u7684\u7279\u6027\u4ee5\u53ca\u63d0\u9ad8\u5206\u652f\u9884\u6d4b\u7684\u51c6\u786e\u6027\uff0c\u4ece\u800c\u4f18\u5316\u7a0b\u5e8f\u6027\u80fd\u3002</p> <p>CPU\u6d41\u6c34\u7ebf\u662f\u4e00\u79cd\u6307\u4ee4\u6267\u884c\u6280\u672f\uff0c\u5c06\u6307\u4ee4\u6267\u884c\u8fc7\u7a0b\u62c6\u5206\u6210\u591a\u4e2a\u9636\u6bb5\uff0c\u4f7f\u5f97\u591a\u6761\u6307\u4ee4\u53ef\u4ee5\u540c\u65f6\u5728\u4e0d\u540c\u9636\u6bb5\u6267\u884c\uff0c\u4ece\u800c\u63d0\u9ad8CPU\u7684\u6548\u7387\u3002\u5f53\u5faa\u73af\u6b21\u6570\u591a\u7684\u5927\u5faa\u73af\u653e\u5728\u5185\u5c42\u65f6\uff0cCPU\u53ef\u4ee5\u66f4\u597d\u5730\u5229\u7528\u6d41\u6c34\u7ebf\u5e76\u884c\u6267\u884c\u591a\u4e2a\u6307\u4ee4\uff0c\u56e0\u4e3a\u5185\u5c42\u5faa\u73af\u7684\u8fed\u4ee3\u6b21\u6570\u591a\uff0c\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u7684\u6307\u4ee4\u4f9bCPU\u6267\u884c\uff0c\u51cf\u5c11\u6d41\u6c34\u7ebf\u7684\u505c\u987f\u3002</p> <p>\u53e6\u5916\uff0c\u73b0\u4ee3CPU\u5728\u6267\u884c\u5faa\u73af\u65f6\u4f1a\u8fdb\u884c\u5206\u652f\u9884\u6d4b\uff0c\u5373\u9884\u6d4b\u4e0b\u4e00\u6b21\u5faa\u73af\u7684\u6761\u4ef6\u5224\u65ad\u7ed3\u679c\uff0c\u4ee5\u4fbf\u63d0\u524d\u52a0\u8f7d\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\u3002\u5982\u679c\u5185\u5c42\u5faa\u73af\u7684\u8fed\u4ee3\u6b21\u6570\u8f83\u5927\uff0c\u5206\u652f\u9884\u6d4b\u7684\u51c6\u786e\u7387\u4f1a\u66f4\u9ad8\uff0c\u56e0\u4e3a\u5faa\u73af\u6b21\u6570\u5c11\u7684\u5c0f\u5faa\u73af\u5728\u5916\u5c42\u5faa\u73af\u4e2d\uff0c\u66f4\u5bb9\u6613\u88ab\u6b63\u786e\u9884\u6d4b\u3002</p> <p>\u56e0\u6b64\uff0c\u5c06\u5faa\u73af\u6b21\u6570\u591a\u7684\u5927\u5faa\u73af\u653e\u5728\u5185\u5c42\uff0c\u5faa\u73af\u6b21\u6570\u5c11\u7684\u5c0f\u5faa\u73af\u653e\u5728\u5916\u5c42\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5229\u7528CPU\u6d41\u6c34\u7ebf\u5e76\u884c\u6027\u548c\u63d0\u9ad8\u5206\u652f\u9884\u6d4b\u7684\u51c6\u786e\u6027\uff0c\u4ece\u800c\u4f18\u5316\u7a0b\u5e8f\u6027\u80fd\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#38","title":"38 | \u9ad8\u901f\u7f13\u5b58\uff08\u4e0b\uff09\uff1a\u4f60\u786e\u5b9a\u4f60\u7684\u6570\u636e\u66f4\u65b0\u4e86\u4e48\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#volatilejava","title":"volatile\u5173\u952e\u5b57\uff08\u4ee5JAVA\u5185\u5b58\u6a21\u578b\u4e3a\u4f8b\uff0c\u5206\u6790\u7f13\u5b58\u540c\u6b65\uff09","text":"<p>volatile\u4f1a\u786e\u4fdd\u6211\u4eec\u5bf9\u4e8e\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bfb\u53d6\u548c\u5199\u5165\uff0c\u90fd\u4e00\u5b9a\u4f1a\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u91cc\uff0c\u800c\u4e0d\u662f\u4ece Cache \u91cc\u9762\u8bfb\u53d6\u3002\uff08\u5ffd\u7565\u7f13\u5b58\u7684\u5b58\u5728\uff09</p> <pre><code>//\u4f8b\u5b50\npublic class VolatileTest {\n    private static volatile int COUNTER = 0;\n\n    public static void main(String[] args) {\n        new ChangeListener().start();\n        new ChangeMaker().start();\n    }\n\n    static class ChangeListener extends Thread {\n        @Override\n        public void run() {\n            int threadValue = COUNTER;\n            while ( threadValue &lt; 5){\n                if( threadValue!= COUNTER){\n                    System.out.println(\"Got Change for COUNTER : \" + COUNTER + \"\");\n                    threadValue= COUNTER;\n                }\n            }\n        }\n    }\n\n    static class ChangeMaker extends Thread{\n        @Override\n        public void run() {\n            int threadValue = COUNTER;\n            while (COUNTER &lt;5){\n                System.out.println(\"Incrementing COUNTER to : \" + (threadValue+1) + \"\");\n                COUNTER = ++threadValue;\n                try {\n                    Thread.sleep(500);\n                } catch (InterruptedException e) { e.printStackTrace(); }\n            }\n        }\n    }\n}\n\n//\u7ed3\u679c\nIncrementing COUNTER to : 1\nGot Change for COUNTER : 1\nIncrementing COUNTER to : 2\nGot Change for COUNTER : 2\nIncrementing COUNTER to : 3\nGot Change for COUNTER : 3\nIncrementing COUNTER to : 4\nGot Change for COUNTER : 4\nIncrementing COUNTER to : 5\nGot Change for COUNTER : 5\n\n//\u4f46\u662f\u53bb\u6389private static volatile int COUNTER = 0\u91cc\u7684 volatile\uff1a\nIncrementing COUNTER to : 1\nIncrementing COUNTER to : 2\nIncrementing COUNTER to : 3\nIncrementing COUNTER to : 4\nIncrementing COUNTER to : 5\n\n//\u4fee\u6539\uff0c\u52a0\u4e0a\u4f11\u77205ms \u8ba9ChangeListener\u4e0d\u518d\u5fd9\u7b49\u5f85\nstatic class ChangeListener extends Thread {\n    @Override\n    public void run() {\n        int threadValue = COUNTER;\n        while ( threadValue &lt; 5){\n            if( threadValue!= COUNTER){\n                System.out.println(\"Sleep 5ms, Got Change for COUNTER : \" + COUNTER + \"\");\n                threadValue= COUNTER;\n            }\n            try {\n                Thread.sleep(5);\n            } catch (InterruptedException e) { e.printStackTrace(); }\n        }\n    }\n}\n</code></pre> <p>\u4f7f\u7528volatile\u5173\u952e\u5b57\uff0c\u786e\u4fdd\u6570\u636e\u7684\u8bfb\u5199\u90fd\u6765\u81ea\u5185\u5b58</p> <p>\u5206\u6790</p> <ol> <li> <p>\u65e0volatile\uff1a</p> <p>\u9996\u5148\uff0c\u5728\u6700\u5f00\u59cb\u7684\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u7a0b\u521b\u5efa\u4e86\u4e00\u4e2a\u7684\u53d8\u91cf(\u5047\u8bbe\u6ca1\u6709volatile)\uff0c\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u3002</p> <p>\u7136\u540e\u521b\u5efa\u4e86\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u6b64\u65f6\u4f1a\u5c06\u4e24\u4e2a\u53d8\u91cf\u7684\u503c\u62f7\u8d1d\u5230\u4e24\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u5404\u81ea\u5b58\u50a8\u533a\u57df\uff0c\u6216\u8005\u8bf4\u81ea\u5df1\u7684\u201d\u7f13\u5b58\u201c\u4e2d\u3002</p> <p>\u5728\u4e24\u4e2a\u7ebf\u7a0b\u4e2d\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u64cd\u4f5c\u7684\u5b9e\u9645\u4e0a\u90fd\u662f\u8fd9\u4e2a\u53d8\u91cf\u7684\u526f\u672c\u3002</p> <p>\u5982\u679c\u7ebf\u7a0b\u4e00\u76f4\u90fd\u5904\u4e8e\u8fd9\u4e2a\u5fd9\u7b49\u5f85\u7684\u5faa\u73af\u4e2d\uff0c\u90a3CPU\u4e5f\u6ca1\u6709\u673a\u4f1a\u5c06\u8fd9\u4e2a\u53d8\u91cf\u7684\u526f\u672c\u540c\u6b65\u5230\u5185\u5b58\u4e2d(\u8fd9\u91cc\u662f\u4e0d\u662f\u67e5\u770bcache\u6709\u6548\u4f4d\u662f\u5426\u4e3a1\uff1f)\uff0c\u8fd9\u6837\u5c31\u5bfc\u81f4\u4e86\u76d1\u542c\u7684\u90a3\u4e2a\u7ebf\u7a0b\u4e00\u76f4\u5728\u7528\u7684counter\u53d8\u91cf\u90fd\u662f\u526f\u672c\uff0c\u4e00\u76f4\u65e0\u6cd5\u53d8\u5316\u3002</p> <p>\u56e0\u6b64\u4e5f\u5c31\u5bfc\u81f4\u4e86\u6253\u5370\u65e0\u6cd5\u8f93\u51fa\u3002</p> </li> <li> <p>\u52a0\u4e0avolatile\uff1a</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u52a0\u4e0avolatile\uff0c\u64cd\u4f5c\u7684\u5c31\u662f\u8fdb\u7a0b\u4e0b\u4e24\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u4e2d\u7684counter\u53d8\u91cf\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u5f97\u76d1\u542c\u7ebf\u7a0b\u7684\u76d1\u542c\u6709\u6548\uff0c\u53ef\u4ee5\u6b63\u786e\u8f93\u51fa\u3002</p> </li> <li> <p>\u6216\u8005\u4e0d\u52a0volatile\uff0c\u8ba9\u76d1\u542c\u7ebf\u7a0bsleep5ms</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u76d1\u542c\u7ebf\u7a0b\u5c31\u4f1a\u8ba9\u51faCPU\u8d44\u6e90\u53bb\u5c06\u4e24\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u53d8\u91cf\u540c\u6b65\u5230\u5171\u4eab\u7684\u8fdb\u7a0b\u5185\u5b58\u4e2d\uff0c\u4e00\u6837\u53ef\u4ee5\u8fbe\u5230\u76d1\u542c\u6548\u679c\u3002</p> </li> </ol> <p>\u8865\u5145\uff1a</p> <p>\u5bf9\u4e8e\u7ebf\u7a0b\u6765\u8bf4\uff0c\u5b83\u7684\u7f13\u5b58\u6307\u7684\u662f\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\u65f6\u90fd\u4f1a\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u5185\u5b58\u5305\u542b\u4e86\u7ebf\u7a0b\u6267\u884c\u6240\u9700\u7684\u6570\u636e\uff0c\u5305\u62ec\u7ebf\u7a0b\u6808\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\u548c\u672c\u5730\u53d8\u91cf\u7b49\u3002\u8fd9\u4e2a\u5de5\u4f5c\u5185\u5b58\u662f\u7ebf\u7a0b\u72ec\u4eab\u7684\uff0c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5de5\u4f5c\u5185\u5b58\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002</p> <p>\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u4e4b\u95f4\u6ca1\u6709\u4e00\u5c42\u5185\u5b58\u7a7a\u95f4\u3002\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u540c\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u4eec\u53ef\u4ee5\u8bbf\u95ee\u76f8\u540c\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u8fd9\u610f\u5473\u7740\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u4e0d\u540c\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u5168\u5c40\u53d8\u91cf\u3001\u9759\u6001\u53d8\u91cf\u7b49\u6570\u636e\u3002\u4f46\u662f\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u7f13\u5b58\u5728\u5404\u81ea\u7684CPU\u6838\u5fc3\u7684\u7f13\u5b58\u4e2d\uff0c\u6240\u4ee5\u9700\u8981\u8003\u8651\u7ebf\u7a0b\u95f4\u7684\u6570\u636e\u4e00\u81f4\u6027\u548c\u53ef\u89c1\u6027\u7684\u95ee\u9898\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u7684\u6570\u636e\uff0c\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u6216\u8005 CPU \u6838\u91cc\u9762\u53bb\u66f4\u65b0\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u7ebf\u7a0b\u6216 CPU \u6838\u6709\u7740\u81ea\u5df1\u5404\u81ea\u7684\u7f13\u5b58\uff0c\u5f88\u6709\u53ef\u80fd\u5728 A \u7ebf\u7a0b\u7684\u66f4\u65b0\uff0c\u5230 B \u7ebf\u7a0b\u91cc\u9762\u662f\u770b\u4e0d\u89c1\u7684\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_7","title":"\u9ad8\u901f\u7f13\u5b58\u7684\u5199\u5165","text":"<p>\u8fd9\u4e2a\u5c42\u7ea7\u7ed3\u6784\uff0c\u5c31\u597d\u50cf\u6211\u4eec\u5728 Java \u5185\u5b58\u6a21\u578b\u91cc\u9762\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u7ebf\u7a0b\u6808\u3002\u7ebf\u7a0b\u5728\u8bfb\u53d6 COUNTER \u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u4ece\u672c\u5730\u7684\u7ebf\u7a0b\u6808\u7684 Cache \u526f\u672c\u91cc\u9762\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4ece\u4e3b\u5185\u5b58\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u3002\u5982\u679c\u6211\u4eec\u5bf9\u4e8e\u6570\u636e\u4ec5\u4ec5\u53ea\u662f\u8bfb\uff0c\u95ee\u9898\u8fd8\u4e0d\u5927\u3002\uff08\u4e0a\u4e00\u8bb2\uff09</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u6570\u636e\uff0c\u4e0d\u5149\u8981\u8bfb\uff0c\u8fd8\u8981\u53bb\u5199\u5165\u4fee\u6539\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6709\u4e24\u4e2a\u95ee\u9898\u6765\u4e86\u3002</p> <ol> <li>\u5199\u5165 Cache \u7684\u6027\u80fd\u4e5f\u6bd4\u5199\u5165\u4e3b\u5185\u5b58\u8981\u5feb\uff0c\u90a3\u6211\u4eec\u5199\u5165\u7684\u6570\u636e\uff0c\u5230\u5e95\u5e94\u8be5\u5199\u5230 Cache \u91cc\u8fd8\u662f\u4e3b\u5185\u5b58\u5462\uff1f\u5982\u679c\u6211\u4eec\u76f4\u63a5\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\uff0cCache \u91cc\u7684\u6570\u636e\u662f\u5426\u4f1a\u5931\u6548\u5462\uff1f</li> <li>\u8981\u662f\u5199\u5165\u6570\u636e\u76f4\u63a5\u5199\u8fdbcache\uff0c\u90a3\u4e3b\u5185\u5b58\u91cc\u5b58\u7684\u539f\u6765\u7684\u6570\u636e\u662f\u5426\u4f1a\u5931\u6548\uff1f\u591a\u7ebf\u7a0b/\u591a\u6838\u5fc3\u7f13\u5b58\u4e00\u81f4\u6027\uff08\u4e0b\u4e00\u8bb2\uff09</li> </ol> <p>\u89e3\u51b3\u7b2c\u4e00\u79cd\u7684\u4e24\u79cd\u7b56\u7565\uff1a\u5199\u76f4\u8fbe\u3001\u5199\u56de</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_8","title":"\u5199\u76f4\u8fbe","text":"<p>\u5728\u8fd9\u4e2a\u7b56\u7565\u91cc\uff0c\u6bcf\u4e00\u6b21\u6570\u636e\u90fd\u8981\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\u9762\u3002\u5728\u5199\u76f4\u8fbe\u7684\u7b56\u7565\u91cc\u9762\uff0c\u5199\u5165\u524d\uff0c\u6211\u4eec\u4f1a\u5148\u53bb\u5224\u65ad\u6570\u636e\u662f\u5426\u5df2\u7ecf\u5728 Cache \u91cc\u9762\u4e86\u3002\u5982\u679c\u6570\u636e\u5df2\u7ecf\u5728 Cache \u91cc\u9762\u4e86\uff0c\u6211\u4eec\u5148\u628a\u6570\u636e\u5199\u5165\u66f4\u65b0\u5230 Cache \u91cc\u9762\uff0c\u518d\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\u9762\uff1b\u5982\u679c\u6570\u636e\u4e0d\u5728 Cache \u91cc\uff0c\u6211\u4eec\u5c31\u53ea\u66f4\u65b0\u4e3b\u5185\u5b58\u3002</p> <p>\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u662f\u901f\u5ea6\u6162</p> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_9","title":"\u5199\u56de","text":"<p>\u4e0d\u518d\u662f\u6bcf\u6b21\u90fd\u628a\u6570\u636e\u5199\u5165\u5230\u4e3b\u5185\u5b58\uff0c\u800c\u662f\u53ea\u5199\u5230 CPU Cache \u91cc\u3002\u53ea\u6709\u5f53 CPU Cache \u91cc\u9762\u7684\u6570\u636e\u8981\u88ab\u201c\u66ff\u6362\u201d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u624d\u628a\u6570\u636e\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\u9762\u53bb\u3002</p> <p></p> <ul> <li> <p>\u5177\u4f53\u8fc7\u7a0b</p> <ol> <li> <p>\u5982\u679c\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u5c31\u5728 CPU Cache \u91cc\u9762\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ea\u662f\u66f4\u65b0 CPU Cache \u91cc\u9762\u7684\u6570\u636e\u3002\u540c\u65f6\uff0c\u6807\u8bb0 CPU Cache \u91cc\u7684\u8fd9\u4e2a Block \u662f\u810f\uff08Dirty\uff09\u7684\u3002</p> <p>\u6240\u8c13\u810f\u7684\uff0c\u5c31\u662f\u6307\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u7684 CPU Cache \u91cc\u9762\u7684\u8fd9\u4e2a Block \u7684\u6570\u636e\uff0c\u548c\u4e3b\u5185\u5b58\u662f\u4e0d\u4e00\u81f4\u7684\u3002</p> </li> <li> <p>\u5982\u679c\u8981\u5199\u5165\u7684\u6570\u636e\u6240\u5bf9\u5e94\u7684 Cache Block \u91cc\uff0c\u653e\u7684\u662f\u522b\u7684\u5185\u5b58\u5730\u5740\u7684\u6570\u636e\uff0c\u90a3\u5c31\u8981\u770b Cache Block \u91cc\u9762\u7684\u6570\u636e\u6709\u6ca1\u6709\u88ab\u6807\u8bb0\u6210\u810f\u7684\u3002</p> <ol> <li>\u5982\u679c\u662f\u810f\u7684\u8bdd\uff0c\u6211\u4eec\u8981\u5148\u628a\u8fd9\u4e2a Cache Block \u91cc\u9762\u7684\u6570\u636e\uff0c\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\u9762\u3002\u7136\u540e\uff0c\u518d\u628a\u5f53\u524d\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u5199\u5165\u5230 Cache \u91cc\uff0c\u540c\u65f6\u628a Cache Block \u6807\u8bb0\u6210\u810f\u7684\u3002</li> <li>\u5982\u679c Block \u91cc\u9762\u7684\u6570\u636e\u6ca1\u6709\u88ab\u6807\u8bb0\u6210\u810f\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u628a\u6570\u636e\u5199\u5165\u5230 Cache \u91cc\u9762\uff0c\u7136\u540e\u518d\u628a Cache Block \u6807\u8bb0\u6210\u810f\u7684\u5c31\u597d\u4e86\u3002</li> </ol> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_10","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>volatile\u8fd9\u4e2a\u5173\u952e\u5b57\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f\u5728\u4e0d\u540c\u8bed\u8a00\u4e2d\uff1f\u4ece\u5185\u5b58\u89d2\u5ea6\u548c\u7f16\u8bd1\u5668\u89d2\u5ea6\u6765\u5206\u6790\uff1f</p> <ol> <li> <p>\u5185\u5b58\u89d2\u5ea6</p> <p>volatile\u4f1a\u786e\u4fdd\u5bf9\u4e8e\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bfb\u53d6\u548c\u5199\u5165\uff0c\u90fd\u4e00\u5b9a\u4f1a\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u91cc\uff0c\u800c\u4e0d\u662f\u4ece Cache \u91cc\u9762\u8bfb\u53d6\u3002\uff08\u5ffd\u7565\u7f13\u5b58\u7684\u5b58\u5728\uff09</p> </li> <li> <p>\u7f16\u8bd1\u5668\u4f18\u5316</p> <p>\u544a\u8bc9\u7f16\u8bd1\u5668\u548c\u8fd0\u884c\u73af\u5883\u4e0d\u8981\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u8fdb\u884c\u4f18\u5316</p> </li> </ol> </li> <li> <p>\u65e2\u7136 volatile \u5173\u952e\u5b57\uff0c\u4f1a\u8ba9\u6240\u6709\u7684\u6570\u636e\u5199\u5165\u90fd\u8981\u5230\u4e3b\u5185\u5b58\u3002\u4f60\u53ef\u4ee5\u8bd5\u7740\u5199\u4e00\u4e2a\u5c0f\u7684\u7a0b\u5e8f\uff0c\u770b\u770b\u4f7f\u7528 volatile \u5173\u952e\u5b57\u548c\u4e0d\u4f7f\u7528 volatile \u5173\u952e\u5b57\uff0c\u5728\u6570\u636e\u5199\u5165\u7684\u6027\u80fd\u4e0a\u4f1a\u4e0d\u4f1a\u6709\u5dee\u5f02\uff0c\u4ee5\u53ca\u8fd9\u4e2a\u5dee\u5f02\u5230\u5e95\u4f1a\u6709\u591a\u5927\u3002</p> </li> <li></li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#39-mesicpu","title":"39 | MESI\u534f\u8bae\uff1a\u5982\u4f55\u8ba9\u591a\u6838CPU\u7684\u9ad8\u901f\u7f13\u5b58\u4fdd\u6301\u4e00\u81f4\uff1f","text":"<p>CPU Cache \u89e3\u51b3\u7684\u662f\u5185\u5b58\u8bbf\u95ee\u901f\u5ea6\u548c CPU \u7684\u901f\u5ea6\u5dee\u8ddd\u592a\u5927\u7684\u95ee\u9898\u3002</p> <p>\u591a\u6838 CPU \u63d0\u4f9b\u7684\u662f\uff0c\u4e3b\u9891\u96be\u4ee5\u63d0\u5347\u65f6\uff0c\u901a\u8fc7\u589e\u52a0 CPU \u6838\u5fc3\u6765\u63d0\u5347 CPU \u7684\u541e\u5410\u7387\u7684\u529e\u6cd5\u3002</p> <p>\u628a\u591a\u6838\u548c CPU Cache \u4e24\u8005\u4e00\u7ed3\u5408\uff0c\u5e26\u6765\u4e86\u5c31\u4e00\u4e2a\u65b0\u7684\u6311\u6218\u3002</p> <p>\u56e0\u4e3a CPU \u7684\u6bcf\u4e2a\u6838\u5404\u6709\u5404\u7684\u7f13\u5b58\uff0c\u4e92\u76f8\u4e4b\u95f4\u7684\u64cd\u4f5c\u53c8\u662f\u5404\u81ea\u72ec\u7acb\u7684\uff0c\u5c31\u4f1a\u5e26\u6765\u7f13\u5b58\u4e00\u81f4\u6027\uff08Cache Coherence\uff09\u7684\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\uff1aMESI\u2014\u2014\u7ef4\u62a4\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u534f\u8bae\u3002\u8fd9\u4e2a\u534f\u8bae\u4e0d\u4ec5\u53ef\u4ee5\u7528\u5728 CPU Cache \u4e4b\u95f4\uff0c\u4e5f\u53ef\u4ee5\u5e7f\u6cdb\u7528\u4e8e\u5404\u79cd\u9700\u8981\u4f7f\u7528\u7f13\u5b58\uff0c\u540c\u65f6\u7f13\u5b58\u4e4b\u95f4\u9700\u8981\u540c\u6b65\u7684\u573a\u666f\u4e0b\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_11","title":"\u89e3\u91ca","text":"<p>\u6bd4\u65b9\u8bf4\uff0ciPhone \u964d\u4ef7\u4e86\uff0c\u6211\u4eec\u8981\u628a iPhone \u6700\u65b0\u7684\u4ef7\u683c\u66f4\u65b0\u5230\u5185\u5b58\u91cc\u3002</p> <p>\u4e3a\u4e86\u6027\u80fd\u95ee\u9898\uff0c\u5b83\u91c7\u7528\u4e86\u5199\u56de\u7b56\u7565\uff0c\u5148\u628a\u6570\u636e\u5199\u5165\u5230 L2 Cache \u91cc\u9762\uff0c\u7136\u540e\u628a Cache Block \u6807\u8bb0\u6210\u810f\u7684\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6570\u636e\u5176\u5b9e\u5e76\u6ca1\u6709\u88ab\u540c\u6b65\u5230 L3 Cache \u6216\u8005\u4e3b\u5185\u5b58\u91cc\u30021 \u53f7\u6838\u5fc3\u5e0c\u671b\u5728\u8fd9\u4e2a Cache Block \u8981\u88ab\u4ea4\u6362\u51fa\u53bb\u7684\u65f6\u5019\uff0c\u6570\u636e\u624d\u5199\u5165\u5230\u4e3b\u5185\u5b58\u91cc\u3002\u5982\u679c\u6211\u4eec\u7684 CPU \u53ea\u6709 1 \u53f7\u6838\u5fc3\u8fd9\u4e00\u4e2a CPU \u6838\uff0c\u90a3\u8fd9\u5176\u5b9e\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u65c1\u8fb9\u8fd8\u6709\u4e00\u4e2a 2 \u53f7\u6838\u5fc3\u5462\uff01\u8fd9\u4e2a\u65f6\u5019\uff0c2 \u53f7\u6838\u5fc3\u5c1d\u8bd5\u4ece\u5185\u5b58\u91cc\u9762\u53bb\u8bfb\u53d6 iPhone \u7684\u4ef7\u683c\uff0c\u7ed3\u679c\u8bfb\u5230\u7684\u662f\u4e00\u4e2a\u9519\u8bef\u7684\u4ef7\u683c\u3002\u8fd9\u662f\u56e0\u4e3a\uff0ciPhone \u7684\u4ef7\u683c\u521a\u521a\u88ab 1 \u53f7\u6838\u5fc3\u66f4\u65b0\u8fc7\u3002\u4f46\u662f\u8fd9\u4e2a\u66f4\u65b0\u7684\u4fe1\u606f\uff0c\u53ea\u51fa\u73b0\u5728 1 \u53f7\u6838\u5fc3\u7684 L2 Cache \u91cc\uff0c\u800c\u6ca1\u6709\u51fa\u73b0\u5728 2 \u53f7\u6838\u5fc3\u7684 L2 Cache \u6216\u8005\u4e3b\u5185\u5b58\u91cc\u9762\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u6240\u8c13\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\uff0c1 \u53f7\u6838\u5fc3\u548c 2 \u53f7\u6838\u5fc3\u7684\u7f13\u5b58\uff0c\u5728\u8fd9\u4e2a\u65f6\u5019\u662f\u4e0d\u4e00\u81f4\u7684\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_12","title":"\u89e3\u51b3\u65b9\u6848\u673a\u5236","text":"<p>\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ul> <li> <p>\u5199\u4f20\u64ad\uff08Write Propagation\uff09\u3002\u5728\u4e00\u4e2a CPU \u6838\u5fc3\u91cc\uff0c\u6211\u4eec\u7684 Cache \u6570\u636e\u66f4\u65b0\uff0c\u5fc5\u987b\u80fd\u591f\u4f20\u64ad\u5230\u5176\u4ed6\u7684\u5bf9\u5e94\u8282\u70b9\u7684 Cache Line \u91cc\u3002</p> </li> <li> <p>\u4e8b\u52a1\u7684\u4e32\u884c\u5316\uff08Transaction Serialization\uff09\u3002\u6211\u4eec\u5728\u4e00\u4e2a CPU \u6838\u5fc3\u91cc\u9762\u7684\u8bfb\u53d6\u548c\u5199\u5165\uff0c\u5728\u5176\u4ed6\u7684\u8282\u70b9\u770b\u8d77\u6765\uff0c\u987a\u5e8f\u662f\u4e00\u6837\u7684\u3002\uff08\u6709\u4e24\u70b9\u8981\u6c42\uff09</p> <p>\u7406\u89e3\uff1a</p> <p>\u6709\u56db\u4e2a\u6838\u5fc3\uff0c1\u30012\u53f7\u6838\u5fc3\u6309\u987a\u5e8f\u6539\u53d8iphone\u4ef7\u683c\uff0c1\u53f7\uff1a\u53d8\u4e3a6000\uff1b2\u53f7\uff1a\u53d8\u4e3a5000\uff1b</p> <p>\u4f46\u662f3\u30014\u53f7\u6838\u5fc3\u63a5\u6536\u5230\u6539\u53d8\u987a\u5e8f\u4e0d\u540c\uff0c3\u53f7\u5148\u63a5\u6536\u52302\u53f7\u7684\u53d8\u5316\u53d8\u4e3a5000\uff0c\u518d\u53d8\u4e3a6000\uff0c\u800c4\u53f7\u5219\u76f8\u53cd\u3002\u6ca1\u6709\u505a\u5230\u4e32\u884c\u5316\u3002</p> <p></p> <ul> <li>CPU \u6838\u5fc3\u5bf9\u4e8e\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u540c\u6b65\u901a\u4fe1\u7ed9\u5230\u5176\u4ed6 CPU \u6838\u5fc3\u3002</li> <li>\u5982\u679c\u4e24\u4e2a CPU \u6838\u5fc3\u91cc\u6709\u540c\u4e00\u4e2a\u6570\u636e\u7684 Cache\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a Cache \u6570\u636e\u7684\u66f4\u65b0\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u201c\u9501\u201d\u7684\u6982\u5ff5\u3002\u53ea\u6709\u62ff\u5230\u4e86\u5bf9\u5e94 Cache Block \u7684\u201c\u9501\u201d\u4e4b\u540e\uff0c\u624d\u80fd\u8fdb\u884c\u5bf9\u5e94\u7684\u6570\u636e\u66f4\u65b0\u3002</li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#mesi","title":"\u603b\u7ebf\u55c5\u63a2\u673a\u5236\u548cMESI\u534f\u8bae","text":"<p>\u603b\u7ebf\u55c5\u63a2\u8fd9\u4e2a\u7b56\u7565\uff0c\u672c\u8d28\u4e0a\u662f\u628a\u6240\u6709\u7684\u8bfb\u5199\u8bf7\u6c42\u90fd\u901a\u8fc7\u603b\u7ebf\uff08Bus\uff09\u5e7f\u64ad\u7ed9\u6240\u6709\u7684 CPU \u6838\u5fc3\uff0c\u7136\u540e\u8ba9\u5404\u4e2a\u6838\u5fc3\u53bb\u201c\u55c5\u63a2\u201d\u8fd9\u4e9b\u8bf7\u6c42\uff0c\u518d\u6839\u636e\u672c\u5730\u7684\u60c5\u51b5\u8fdb\u884c\u54cd\u5e94\u3002</p> <p>\u57fa\u4e8e\u603b\u7ebf\u55c5\u63a2\u673a\u5236\uff0c\u5176\u5b9e\u8fd8\u53ef\u4ee5\u5206\u6210\u5f88\u591a\u79cd\u4e0d\u540c\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u3002\u4e0d\u8fc7\u5176\u4e2d\u6700\u5e38\u7528\u7684\u662fMESI \u534f\u8bae\u3002\u548c\u5f88\u591a\u73b0\u4ee3\u7684 CPU \u6280\u672f\u4e00\u6837\uff0cMESI \u534f\u8bae\u4e5f\u662f\u5728 Pentium \u65f6\u4ee3\uff0c\u88ab\u5f15\u5165\u5230 Intel CPU \u4e2d\u7684\u3002</p> <ul> <li> <p>\u4e24\u79cd\u534f\u8bae</p> <ol> <li> <p>MESI \u534f\u8bae\uff0c\u662f\u4e00\u79cd\u53eb\u4f5c\u5199\u5931\u6548\uff08Write Invalidate\uff09\u7684\u534f\u8bae\u3002\u5728\u5199\u5931\u6548\u534f\u8bae\u91cc\uff0c\u53ea\u6709\u4e00\u4e2a CPU \u6838\u5fc3\u8d1f\u8d23\u5199\u5165\u6570\u636e\uff0c\u5176\u4ed6\u7684\u6838\u5fc3\uff0c\u53ea\u662f\u540c\u6b65\u8bfb\u53d6\u5230\u8fd9\u4e2a\u5199\u5165\u3002\u5728\u8fd9\u4e2a CPU \u6838\u5fc3\u5199\u5165 Cache \u4e4b\u540e\uff0c\u5b83\u4f1a\u53bb\u5e7f\u64ad\u4e00\u4e2a\u201c\u5931\u6548\u201d\u8bf7\u6c42\u544a\u8bc9\u6240\u6709\u5176\u4ed6\u7684 CPU \u6838\u5fc3\u3002\u5176\u4ed6\u7684 CPU \u6838\u5fc3\uff0c\u53ea\u662f\u53bb\u5224\u65ad\u81ea\u5df1\u662f\u5426\u4e5f\u6709\u4e00\u4e2a\u201c\u5931\u6548\u201d\u7248\u672c\u7684 Cache Block\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u4e5f\u6807\u8bb0\u6210\u5931\u6548\u7684\u5c31\u597d\u4e86\u3002\u76f8\u5bf9\u4e8e\u5199\u5931\u6548\u534f\u8bae\uff0c</p> </li> <li> <p>\u8fd8\u6709\u4e00\u79cd\u53eb\u4f5c\u5199\u5e7f\u64ad\uff08Write Broadcast\uff09\u7684\u534f\u8bae\u3002\u5728\u90a3\u4e2a\u534f\u8bae\u91cc\uff0c\u4e00\u4e2a\u5199\u5165\u8bf7\u6c42\u5e7f\u64ad\u5230\u6240\u6709\u7684 CPU \u6838\u5fc3\uff0c\u540c\u65f6\u66f4\u65b0\u5404\u4e2a\u6838\u5fc3\u91cc\u7684 Cache\u3002</p> <p></p> </li> <li> <p>\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u5199\u5e7f\u64ad\u5728\u5b9e\u73b0\u4e0a\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5199\u5e7f\u64ad\u9700\u8981\u5360\u7528\u66f4\u591a\u7684\u603b\u7ebf\u5e26\u5bbd\uff08\u53ef\u80fd\u6709\u4e9b\u6838\u5fc3\u4e0d\u9700\u8981\u8fd9\u4e2a\u66f4\u65b0\u7684\u6570\u636e\uff09\u3002</p> <p>\u5199\u5931\u6548\u53ea\u9700\u8981\u544a\u8bc9\u5176\u4ed6\u7684 CPU \u6838\u5fc3\uff0c\u54ea\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u7684\u7f13\u5b58\u5931\u6548\u4e86\uff0c\u4f46\u662f\u5199\u5e7f\u64ad\u8fd8\u9700\u8981\u628a\u5bf9\u5e94\u7684\u6570\u636e\u4f20\u8f93\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\u3002</p> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#mesi_1","title":"MESI\u5177\u4f53\u5185\u5bb9","text":"<p>\u5206\u522b\u8868\u793acache line\u7684\u56db\u79cd\u6807\u8bb0</p> <ul> <li> <p>M\uff1a\u4ee3\u8868\u5df2\u4fee\u6539\uff08Modified\uff09</p> </li> <li> <p>E\uff1a\u4ee3\u8868\u72ec\u5360\uff08Exclusive\uff09</p> </li> <li> <p>S\uff1a\u4ee3\u8868\u5171\u4eab\uff08Shared\uff09</p> </li> <li> <p>I\uff1a\u4ee3\u8868\u5df2\u5931\u6548\uff08Invalidated\uff09</p> </li> </ul> <ol> <li> <p>\u5df2\u4fee\u6539\u548c\u5df2\u5931\u6548</p> <ol> <li>\u5df2\u4fee\u6539\uff0c\u5c31\u662f\u4e4b\u524d\u8bb2\u8fc7\u7684\uff1a\u201c\u810f\u201d\u7684 Cache Block\u3002Cache Block \u91cc\u9762\u7684\u5185\u5bb9\u6211\u4eec\u5df2\u7ecf\u66f4\u65b0\u8fc7\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u5199\u56de\u5230\u4e3b\u5185\u5b58\u91cc\u9762\u3002</li> <li>\u5df2\u5931\u6548\uff0c\u81ea\u7136\u662f\u8fd9\u4e2a Cache Block \u91cc\u9762\u7684\u6570\u636e\u5df2\u7ecf\u5931\u6548\u4e86\uff0c\u7f13\u5b58\u5757\u91cc\u7684\u5185\u5bb9\u8fd8\u6ca1\u6765\u5f97\u53ca\u66f4\u65b0\uff0c\u4e0d\u53ef\u4ee5\u76f8\u4fe1\u8fd9\u4e2a Cache Block \u91cc\u9762\u7684\u6570\u636e\u3002</li> </ol> </li> <li> <p>\u72ec\u5360\u548c\u5171\u4eab\uff08\u91cd\u70b9\u7cbe\u534e\uff09</p> <p>\u65e0\u8bba\u662f\u72ec\u5360\u72b6\u6001\u8fd8\u662f\u5171\u4eab\u72b6\u6001\uff0c\u7f13\u5b58\u91cc\u9762\u7684\u6570\u636e\u90fd\u662f\u201c\u5e72\u51c0\u201d\u7684\u3002\u8fd9\u4e2a\u201c\u5e72\u51c0\u201d\uff0c\u81ea\u7136\u5bf9\u5e94\u7684\u662f\u524d\u9762\u6240\u8bf4\u7684\u201c\u810f\u201d\u7684\uff0c\u5373\uff0c\u6b64\u65f6Cache Block \u91cc\u9762\u7684\u6570\u636e\u548c\u4e3b\u5185\u5b58\u91cc\u9762\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u5177\u4f53\u533a\u522b\uff1a</p> <ol> <li> <p>\u5728\u72ec\u5360\u72b6\u6001\u4e0b\uff0c\u5bf9\u5e94\u7684 Cache Line \u53ea\u52a0\u8f7d\u5230\u4e86\u5f53\u524d CPU \u6838\u6240\u62e5\u6709\u7684 Cache \u91cc\u3002\u5176\u4ed6\u7684 CPU \u6838\uff0c\u5e76\u6ca1\u6709\u52a0\u8f7d\u5bf9\u5e94\u7684\u6570\u636e\u5230\u81ea\u5df1\u7684 Cache \u91cc\u3002</p> <p>\u5982\u679c\u6b64\u65f6\u8981\u5411\u72ec\u5360\u7684 Cache Block \u5199\u6570\u636e\uff0c\u53ef\u4ee5\u81ea\u7531\u5730\u5199\u5165\uff0c\u65e0\u9700\u544a\u77e5\u5176\u4ed6 CPU \u6838\u3002</p> </li> <li> <p>\u5728\u72ec\u5360\u72b6\u6001\u4e0b\u7684Cache line\u91cc\u7684\u6570\u636e\uff0c\u5982\u679c\u6536\u5230\u4e86\u4e00\u4e2a\u6765\u81ea\u4e8e\u603b\u7ebf\u7684\u8bfb\u53d6\u5bf9\u5e94\u7f13\u5b58\u7684\u8bf7\u6c42\uff08\u56e0\u4e3a\u53e6\u5916\u4e00\u4e2a CPU \u6838\u5fc3\uff0c\u4e5f\u628a\u5bf9\u5e94\u7684 Cache Block\uff0c\u4ece\u5185\u5b58\u91cc\u9762\u52a0\u8f7d\u5230\u4e86\u81ea\u5df1\u7684 Cache \u91cc\u6765\u3002\uff09\uff0c\u5b83\u4f1a\u9996\u5148\u5c06\u81ea\u5df1\u7684\u6570\u636e\u5199\u56de\u5230\u5185\u5b58\uff0c\u7136\u540e\u5176\u4ed6CPU\u6838\u5fc3\u6839\u636e\u9700\u8981\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u5b83\u4eec\u7684\u7f13\u5b58\u4e2d\uff0c\u8fd9\u65f6\u6570\u636e\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5171\u4eab\u72b6\u6001\u3002</p> <p>\u5728\u5171\u4eab\u72b6\u6001\u4e0b\uff0c\u56e0\u4e3a\u540c\u6837\u7684\u6570\u636e\u5728\u591a\u4e2a CPU \u6838\u5fc3\u7684 Cache \u91cc\u90fd\u6709\u3002\u6240\u4ee5\uff0c\u5f53\u6211\u4eec\u60f3\u8981\u66f4\u65b0 Cache \u91cc\u9762\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\uff0c\u800c\u662f\u8981\u5148\u5411\u6240\u6709\u7684\u5176\u4ed6 CPU \u6838\u5fc3\u5e7f\u64ad\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8981\u6c42\u5148\u628a\u5176\u4ed6 CPU \u6838\u5fc3\u91cc\u9762\u7684 Cache\uff0c\u90fd\u53d8\u6210\u65e0\u6548\u7684\u72b6\u6001\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5f53\u524d Cache \u91cc\u9762\u7684\u6570\u636e\u3002\u8fd9\u4e2a\u5e7f\u64ad\u64cd\u4f5c\uff0c\u4e00\u822c\u53eb\u4f5c RFO\uff08Request For Ownership\uff09\uff0c\u4e5f\u5c31\u662f\u83b7\u53d6\u5f53\u524d\u5bf9\u5e94 Cache Block \u6570\u636e\u7684\u6240\u6709\u6743\u3002</p> </li> <li> <p>\u8fd9\u4e2a\u64cd\u4f5c\u6709\u70b9\u513f\u50cf\u6211\u4eec\u5728\u591a\u7ebf\u7a0b\u91cc\u9762\u7528\u5230\u7684\u8bfb\u5199\u9501\u3002</p> <p>\u5728\u5171\u4eab\u72b6\u6001\u4e0b\uff0c\u5927\u5bb6\u90fd\u53ef\u4ee5\u5e76\u884c\u53bb\u8bfb\u5bf9\u5e94\u7684\u6570\u636e\u3002\u4f46\u662f\u5982\u679c\u8981\u5199\uff0c\u6211\u4eec\u5c31\u9700\u8981\u901a\u8fc7\u4e00\u4e2a\u9501\uff0c\u83b7\u53d6\u5f53\u524d\u5199\u5165\u4f4d\u7f6e\u7684\u6240\u6709\u6743\u3002</p> </li> </ol> </li> <li> <p>\u5173\u4e8eMESI\u7684\u6709\u9650\u72b6\u6001\u673a\u8868\u793a</p> <p>\u6ce8\u610f: \u5bf9\u4e8e\u4e0d\u540c\u72b6\u6001\u89e6\u53d1\u7684\u4e8b\u4ef6\u64cd\u4f5c\uff0c\u53ef\u80fd\u6765\u81ea\u4e8e\u5f53\u524d CPU \u6838\u5fc3\uff0c\u4e5f\u53ef\u80fd\u6765\u81ea\u603b\u7ebf\u91cc\u5176\u4ed6 CPU \u6838\u5fc3\u5e7f\u64ad\u51fa\u6765\u7684\u4fe1\u53f7\u3002</p> <p></p> </li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_13","title":"\u63a8\u8350\u9605\u8bfb","text":"<p>\u300a\u5927\u8bdd\u8ba1\u7b97\u673a\u300b6.9\u7ae0</p> <p>\u3010\u6280\u672f\u6742\u8c08\u3011\u7f13\u5b58\u4e00\u81f4\u6027_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_14","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>MESI \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u5176\u5b9e\u662f\u5bf9\u4e8e MSI \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u7684\u4e00\u4e2a\u4f18\u5316\u3002\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u7814\u7a76\u4e00\u4e0b\uff0c\u4ec0\u4e48\u662f MSI \u534f\u8bae\uff0c\u4ee5\u53ca MESI \u76f8\u5bf9\u4e8e MSI \u534f\u8bae\uff0c\u7a76\u7adf\u505a\u4e86\u54ea\u4e9b\u4f18\u5316\uff1f</p> <p>MSI (Modified, Shared, Invalid) \u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u662f\u4e00\u79cd\u7528\u4e8e\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e2d\u7ef4\u62a4\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u534f\u8bae\u3002\u5728MSI\u534f\u8bae\u4e2d\uff0c\u6bcf\u4e2a\u7f13\u5b58\u884c\u6709\u4e09\u79cd\u72b6\u6001\uff1aModified\uff08\u4fee\u6539\u72b6\u6001\uff09\u3001Shared\uff08\u5171\u4eab\u72b6\u6001\uff09\u548cInvalid\uff08\u65e0\u6548\u72b6\u6001\uff09\u3002</p> <p>\u5728MSI\u534f\u8bae\u4e2d\uff0c\u5f53\u4e00\u4e2a\u5904\u7406\u5668\u4fee\u6539\u4e86\u4e00\u4e2a\u7f13\u5b58\u884c\u7684\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u5c06\u8be5\u7f13\u5b58\u884c\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3aModified\uff0c\u5e76\u4e14\u901a\u77e5\u5176\u4ed6\u5904\u7406\u5668\u8be5\u7f13\u5b58\u884c\u7684\u72b6\u6001\u5df2\u7ecf\u53d8\u4e3aInvalid\u3002\u5f53\u4e00\u4e2a\u5904\u7406\u5668\u9700\u8981\u8bfb\u53d6\u4e00\u4e2a\u5171\u4eab\u7684\u7f13\u5b58\u884c\u65f6\uff0c\u5b83\u4f1a\u5c06\u8be5\u7f13\u5b58\u884c\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3aShared\uff0c\u5e76\u4e14\u901a\u77e5\u5176\u4ed6\u5904\u7406\u5668\u5b83\u5df2\u7ecf\u62e5\u6709\u4e86\u8be5\u7f13\u5b58\u884c\u7684\u526f\u672c\u3002\u5f53\u4e00\u4e2a\u5904\u7406\u5668\u4e0d\u518d\u9700\u8981\u4e00\u4e2a\u7f13\u5b58\u884c\u65f6\uff0c\u5b83\u4f1a\u5c06\u8be5\u7f13\u5b58\u884c\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3aInvalid\uff0c\u5e76\u4e14\u901a\u77e5\u5176\u4ed6\u5904\u7406\u5668\u8be5\u7f13\u5b58\u884c\u5df2\u7ecf\u65e0\u6548\u3002</p> <p>MESI\uff08Modified, Exclusive, Shared, Invalid\uff09\u534f\u8bae\u662f\u5bf9MSI\u534f\u8bae\u7684\u4f18\u5316\u3002\u76f8\u5bf9\u4e8eMSI\u534f\u8bae\uff0cMESI\u534f\u8bae\u5f15\u5165\u4e86\u201cExclusive\u201d\u72b6\u6001\u3002\u5728MESI\u534f\u8bae\u4e2d\uff0c\u5f53\u4e00\u4e2a\u7f13\u5b58\u884c\u5904\u4e8eExclusive\u72b6\u6001\u65f6\uff0c\u8868\u793a\u8be5\u7f13\u5b58\u884c\u53ea\u5b58\u5728\u4e8e\u5f53\u524d\u7684\u7f13\u5b58\u4e2d\uff0c\u5176\u4ed6\u7f13\u5b58\u4e2d\u6ca1\u6709\u8be5\u7f13\u5b58\u884c\u7684\u526f\u672c\u3002\u8fd9\u4e2a\u72b6\u6001\u7684\u5f15\u5165\u53ef\u4ee5\u51cf\u5c11\u5728\u8bfb\u53d6\u64cd\u4f5c\u65f6\u7684\u4e00\u4e9b\u603b\u7ebf\u901a\u4fe1\u5f00\u9500\u3002\u5f53\u4e00\u4e2a\u5904\u7406\u5668\u9700\u8981\u8bfb\u53d6\u4e00\u4e2a\u7f13\u5b58\u884c\u65f6\uff0c\u5982\u679c\u8be5\u7f13\u5b58\u884c\u5904\u4e8eExclusive\u72b6\u6001\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u9700\u8981\u5411\u5176\u4ed6\u5904\u7406\u5668\u53d1\u9001\u4efb\u4f55\u901a\u77e5\u3002\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u8bfb\u53d6\u64cd\u4f5c\u7684\u6548\u7387\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0cMESI\u76f8\u5bf9\u4e8eMSI\u534f\u8bae\u7684\u4f18\u5316\u4e3b\u8981\u4f53\u73b0\u5728\u5f15\u5165\u4e86Exclusive\u72b6\u6001\uff0c\u51cf\u5c11\u4e86\u8bfb\u53d6\u64cd\u4f5c\u65f6\u7684\u4e00\u4e9b\u603b\u7ebf\u901a\u4fe1\u5f00\u9500\uff0c\u63d0\u9ad8\u4e86\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u7684\u6548\u7387\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#40","title":"40 | \u7406\u89e3\u5185\u5b58\uff08\u4e0a\uff09\uff1a\u865a\u62df\u5185\u5b58\u548c\u5185\u5b58\u4fdd\u62a4\u662f\u4ec0\u4e48\uff1f","text":"<p>\u865a\u62df\u5185\u5b58\u5730\u5740\u7a76\u7adf\u662f\u600e\u4e48\u8f6c\u6362\u6210\u7269\u7406\u5185\u5b58\u5730\u5740\uff1f </p> <p>\u76f4\u63a5\u60f3\u6cd5\uff1a\u5efa\u7acb\u4e00\u5f20\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u4e4b\u95f4\u7684\u6620\u5c04\u8868\uff0c\u5b9e\u73b0\u865a\u62df\u5730\u5740\u91cc\u7684\u9875\u5230\u7269\u7406\u5730\u5740\u7684\u9875\u7684\u4e00\u4e00\u6620\u5c04\u3002\u8fd9\u4e2a\u6620\u5c04\u8868\u5373\u4e3a\u9875\u8868</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_15","title":"\u7b80\u5355\u9875\u8868","text":"<p>\u9875\u8868\uff1a\u5c06\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u5206\u4e3a \u9875\u53f7 \u548c \u504f\u79fb\u91cf\u3002\uff08\u4ee532\u4f4d\u5730\u5740\u4e3a\u4f8b\uff09</p> <p>\u524d\u9762\u7684\u9ad8\u4f4d\uff0c\u4e3a\u865a\u62df\u5185\u5b58\u5730\u5740\u7684\u9875\u53f7\u3002</p> <p>\u540e\u9762\u7684\u4f4e\u4f4d\uff0c\u5c31\u662f\u7269\u7406\u5185\u5b58\u5730\u5740\u4e2d\u9875\u8868\u91cc\u9762\u7684\u504f\u79fb\u91cf\u3002</p> <p>\u505a\u5730\u5740\u8f6c\u6362\u7684\u9875\u8868\uff0c\u53ea\u9700\u4fdd\u7559\u865a\u62df\u5185\u5b58\u5730\u5740\u7684\u9875\u53f7\u548c\u7269\u7406\u5185\u5b58\u5730\u5740\u7684\u9875\u53f7\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u5373\u53ef\u3002</p> <p>\u540c\u4e00\u4e2a\u9875\u91cc\u9762\u7684\u5185\u5b58\uff0c\u5728\u7269\u7406\u5c42\u9762\u662f\u8fde\u7eed\u7684\u3002\u4ee5\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u662f 4K \u5b57\u8282\uff084KB\uff09\u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981 20 \u4f4d\u7684\u9ad8\u4f4d\uff0c12 \u4f4d\u7684\u4f4e\u4f4d\u3002</p> <p>\u9875\u53f7\u662f20\u4f4d\uff0c\u53e6\u591612\u4f4d\u662f\u504f\u79fb\u5730\u5740\u3002 \u6bcf\u9875\u5927\u5c0f\u662f4KB\uff0c4K=2<sup>12</sup>bit\uff0c\u6240\u4ee5\u8981\u57284KB\u7684\u9875\u9762\u91cc\u9762\u8fdb\u884c\u5bfb\u5740\uff0c\u504f\u79fb\u91cf\u662f12\u4f4d\u3002 \u8981\u8868\u793a4GB\u7684\u5185\u5b58\uff0c4GB = 2<sup>32</sup> = 2<sup>20</sup> * 2^12\uff0c\u6240\u4ee5\u9700\u8981 2<sup>20</sup>\u9875\uff0c\u6240\u4ee5\u9875\u53f7\u662f20\u4f4d\u3002</p> <p></p> <p>\u5185\u5b58\u5730\u5740\u8f6c\u6362</p> <ol> <li>\u628a\u865a\u62df\u5185\u5b58\u5730\u5740\uff0c\u5207\u5206\u6210\u9875\u53f7\u548c\u504f\u79fb\u91cf\u7684\u7ec4\u5408\uff1b</li> <li>\u4ece\u9875\u8868\u91cc\u9762\uff0c\u67e5\u8be2\u51fa\u865a\u62df\u9875\u53f7\uff0c\u5bf9\u5e94\u7684\u7269\u7406\u9875\u53f7\uff1b</li> <li>\u6240\u4ee5\uff1a\u7269\u7406\u9875\u53f7+\u504f\u79fb\u91cf\uff0c\u5c31\u5f97\u5230\u4e86\u7269\u7406\u5185\u5b58\u5730\u5740\u3002</li> </ol> <p>\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f==\u5360\u7a7a\u95f4\u5927\uff1a==</p> <ul> <li>64\u4f4d\u5730\u5740\uff1a\u9700\u89812<sup>52</sup>\u4e2a\u9875\u7684\u5730\u5740\uff0c\u54ea\u6015\u662f32\u4f4d\uff0c\u4e5f\u9700\u89812<sup>20</sup>\u4e2a\u9875\u7684\u5730\u5740</li> <li>\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u5373\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u9700\u8981\u4e00\u4e2a\u9875\u8868</li> </ul> <p>---&gt; \u6539\u8fdb\u4f7f\u7528\u591a\u7ea7\u9875\u8868\uff1a\u53ea\u5b58\u50a8\u7528\u5230\u7684\u9875\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u5373\u53ef\uff08\u90a3\u4e3a\u4ec0\u4e48\u4e0d\u7528\u54c8\u5e0c\u8868\uff09</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_16","title":"\u591a\u7ea7\u9875\u8868","text":"<p>\u8fdb\u7a0b\u7684\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u662f\u600e\u4e48\u5206\u914d\u7684\u3002\u5728\u6574\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5730\u5740\u7a7a\u95f4\uff0c\u901a\u5e38\u662f\u201c\u4e24\u5934\u5b9e\u3001\u4e2d\u95f4\u7a7a\u201d\u3002</p> <p>\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5185\u5b58\u5730\u5740\u4ece\u9876\u90e8\u5f80\u4e0b\uff0c\u4e0d\u65ad\u5206\u914d\u5360\u7528\u7684\u6808\u7684\u7a7a\u95f4\u3002\u800c\u5806\u7684\u7a7a\u95f4\uff0c\u5185\u5b58\u5730\u5740\u5219\u662f\u4ece\u5e95\u90e8\u5f80\u4e0a\uff0c\u662f\u4e0d\u65ad\u5206\u914d\u5360\u7528\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u4e00\u4e2a\u5b9e\u9645\u7684\u7a0b\u5e8f\u8fdb\u7a0b\u91cc\u9762\uff0c\u865a\u62df\u5185\u5b58\u5360\u7528\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u901a\u5e38\u662f\u4e24\u6bb5\u8fde\u7eed\u7684\u7a7a\u95f4\u3002\u800c\u4e0d\u662f\u5b8c\u5168\u6563\u843d\u7684\u968f\u673a\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>\u8865\u5145</p> <p>\u865a\u62df\u5185\u5b58\u7684\u8fde\u7eed\u6027\u662f\u6307\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u6808\u548c\u5806\u5404\u81ea\u7684\u5730\u5740\u7a7a\u95f4\u662f\u8fde\u7eed\u7684\uff0c\u800c\u4e0d\u662f\u968f\u673a\u5206\u5e03\u7684\u3002</p> <p>\u5047\u8bbe\u4e00\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5927\u5c0f\u4e3a4GB\uff0c\u5176\u4e2d\u6808\u548c\u5806\u5404\u81ea\u5360\u75281GB\u3002\u8fd9\u610f\u5473\u7740\u6808\u7684\u865a\u62df\u5730\u5740\u8303\u56f4\u53ef\u80fd\u662f0x00000000\u52300x3FFFFFFF\uff0c\u800c\u5806\u7684\u865a\u62df\u5730\u5740\u8303\u56f4\u53ef\u80fd\u662f0xC0000000\u52300xFFFFFFFF\u3002</p> <p>\u4e0d\u8fde\u7eed\u7684\u865a\u62df\u5185\u5b58\uff1a\u5df2\u7ecf\u5206\u914d\u597d\u7684\u5185\u5b58\u5757\u4e4b\u95f4\u5b58\u5728\u7740\u4e00\u4e9b\u968f\u673a\u5206\u5e03\u7684\u672a\u5206\u914d\u7a7a\u95f4\u3002\uff08\u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u53d1\u751f\u5728\u52a8\u6001\u5185\u5b58\u5206\u914d\u65f6\uff0c\u7531\u4e8e\u5185\u5b58\u7684\u5206\u914d\u548c\u91ca\u653e\u5bfc\u81f4\u4e86\u5185\u5b58\u7a7a\u95f4\u7684\u788e\u7247\u5316\u3002\uff09</p> <p>\u5373\uff1a\u8fde\u7eed\uff0c\u6307\u7684\u662f\u5185\u90e8\u7684\u8fde\u7eed\u6216\u8005\u5185\u5b58\u5757\u7684\u8fde\u7eed\u3002 \u4e0d\u8fde\u7eed\u5c31\u662f\u6307\u51fa\u73b0\u5185\u5b58\u788e\u7247</p> <p>\u4fdd\u8bc1\u865a\u62df\u5185\u5b58\u7684\u8fde\u7eed\u6027\uff1a</p> <ol> <li>\u5185\u5b58\u6c60\uff1a\u4f7f\u7528\u5185\u5b58\u6c60\u6280\u672f\u53ef\u4ee5\u9884\u5148\u5206\u914d\u4e00\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u5e76\u5728\u9700\u8981\u65f6\u4ece\u5185\u5b58\u6c60\u4e2d\u5206\u914d\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u788e\u7247\u5316\uff0c\u4ece\u800c\u63d0\u9ad8\u8fde\u7eed\u6027\u3002</li> <li>\u5185\u5b58\u538b\u7f29\uff1a\u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u5185\u5b58\u538b\u7f29\u6280\u672f\uff0c\u53ef\u4ee5\u5728\u5185\u5b58\u788e\u7247\u5316\u4e25\u91cd\u65f6\u5bf9\u5185\u5b58\u8fdb\u884c\u538b\u7f29\uff0c\u4ece\u800c\u4f7f\u5f97\u788e\u7247\u5316\u7684\u5185\u5b58\u5757\u80fd\u591f\u91cd\u65b0\u6574\u7406\u6210\u8fde\u7eed\u7684\u7a7a\u95f4\u3002</li> <li>\u667a\u80fd\u5185\u5b58\u5206\u914d\u7b97\u6cd5\uff1a\u8bbe\u8ba1\u667a\u80fd\u7684\u5185\u5b58\u5206\u914d\u7b97\u6cd5\uff0c\u80fd\u591f\u66f4\u597d\u5730\u7ba1\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u51cf\u5c11\u788e\u7247\u5316\uff0c\u4ece\u800c\u63d0\u9ad8\u8fde\u7eed\u6027\u3002</li> <li>\u5927\u9875\u5185\u5b58\uff1a\u4f7f\u7528\u5927\u9875\u5185\u5b58\u53ef\u4ee5\u51cf\u5c11\u9875\u8868\u7684\u6570\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5185\u5b58\u788e\u7247\u5316\u7684\u53ef\u80fd\u6027\u3002</li> <li>\u907f\u514d\u9891\u7e41\u5730\u8fdb\u884c\u52a8\u6001\u5185\u5b58\u5206\u914d</li> </ol> <p>\u591a\u7ea7\u9875\u8868\u7279\u522b\u9002\u5408\u7ba1\u7406\u8fde\u7eed\u7684\u7684\u5185\u5b58\u5730\u5740\u5206\u5e03\u3002</p> <p>\u6bb5\u3001\u9875\u3001\u9875\u6846\u3001\u9875\u8868\u3001\u9875\u8868\u9879_\u9875\u8868\u3001\u9875\u6846\u53f7-CSDN\u535a\u5ba2</p> <p></p> <p>\u5206\u6790</p> <p>\u9875\u53f7\u88ab\u62c6\u6210\u56db\u4e2a\u90e8\u5206\uff0c\u5269\u4e0b\u90a3\u4e2a\u504f\u79fb\u91cf\u4e0d\u53d8</p> <p>\u4e00\u4e2a\u8fdb\u7a0b\u4f1a\u6709\u4e00\u4e2a 4 \u7ea7\u9875\u8868\u3002</p> <ol> <li>\u5148\u901a\u8fc7 4 \u7ea7\u9875\u8868\u7d22\u5f15\uff0c\u627e\u5230 4 \u7ea7\u9875\u8868\u91cc\u9762\u5bf9\u5e94\u7684\u6761\u76ee\uff08Entry\uff09\u3002\u8fd9\u4e2a\u6761\u76ee\u91cc\u5b58\u653e\u7684\u662f\u4e00\u5f20 3 \u7ea7\u9875\u8868\u7684\u5730\u5740\u3002\uff084 \u7ea7\u9875\u9762\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u6761\u76ee\uff0c\u90fd\u5bf9\u5e94\u7740\u4e00\u5f20 3 \u7ea7\u9875\u8868\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u80fd\u6709\u591a\u5f20 3 \u7ea7\u9875\u8868\u3002\uff09</li> <li>\u627e\u5230\u5bf9\u5e94\u8fd9\u5f20 3 \u7ea7\u9875\u8868\u4e4b\u540e\uff0c\u518d\u7528 3 \u7ea7\u7d22\u5f15\u53bb\u627e\u5230\u5bf9\u5e94\u7684 3 \u7ea7\u7d22\u5f15\u7684\u6761\u76ee\u30023 \u7ea7\u7d22\u5f15\u7684\u6761\u76ee\u518d\u4f1a\u6307\u5411\u4e00\u4e2a 2 \u7ea7\u9875\u8868\u3002</li> <li>\u540c\u6837\u7684\uff0c2 \u7ea7\u9875\u8868\u91cc\u6211\u4eec\u53ef\u4ee5\u7528 2 \u7ea7\u7d22\u5f15\u6307\u5411\u4e00\u4e2a 1 \u7ea7\u9875\u8868\u3002\u800c\u6700\u540e\u4e00\u5c42\u7684 1 \u7ea7\u9875\u8868\u91cc\u9762\u7684\u6761\u76ee\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u5185\u5bb9\u5c31\u662f\u7269\u7406\u9875\u53f7\u4e86\u3002</li> <li>\u5728\u62ff\u5230\u4e86\u7269\u7406\u9875\u53f7\u4e4b\u540e\uff0c\u53ef\u4ee5\u7528\u201c\u9875\u53f7 + \u504f\u79fb\u91cf\u201d\u7684\u65b9\u5f0f\uff0c\u6765\u83b7\u53d6\u6700\u7ec8\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\u3002</li> <li>\u6211\u4eec\u53ef\u80fd\u6709\u5f88\u591a\u5f20 1 \u7ea7\u9875\u8868\u30012 \u7ea7\u9875\u8868\uff0c\u4e43\u81f3 3 \u7ea7\u9875\u8868\u3002\u4f46\u662f\uff0c\u56e0\u4e3a\u5b9e\u9645\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u901a\u5e38\u662f\u8fde\u7eed\u7684\uff0c\u6211\u4eec\u5f88\u53ef\u80fd\u53ea\u9700\u8981\u5f88\u5c11\u7684 2 \u7ea7\u9875\u8868\uff0c\u751a\u81f3\u53ea\u9700\u8981 1 \u5f20 3 \u7ea7\u9875\u8868\u5c31\u591f\u4e86\u3002</li> </ol> <p>\u8865\u51451</p> <p>\u5728\u591a\u7ea7\u9875\u8868\u4e2d\uff0c</p> <p>\u7d22\u5f15\u503c\u7528\u6765\u5728\u5f53\u524d\u7ea7\u7684\u9875\u8868\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u6761\u76ee\uff0c</p> <p>\u800c\u6bcf\u4e2a\u6761\u76ee\u4e2d\u5b58\u50a8\u7740\u4e0b\u4e00\u7ea7\u9875\u8868\u7684\u5730\u5740\u3002</p> <p>\u5373\uff0c\u7d22\u5f15\u503c\u7528\u6765\u5b9a\u4f4d\u5f53\u524d\u7ea7\u9875\u8868\u4e2d\u7684\u6761\u76ee\uff0c\u800c\u6bcf\u4e2a\u6761\u76ee\u4e2d\u5b58\u50a8\u7740\u4e0b\u4e00\u7ea7\u9875\u8868\u7684\u5730\u5740\u3002</p> <p>\u6700\u540e\u4e00\u7ea7\u7684\u6761\u76ee\u4e2d\u5b58\u50a8\u7740\u7269\u7406\u9875\u7684\u5730\u5740\u3002</p> <p>\u6240\u4ee5\uff0c\u591a\u7ea7\u9875\u8868\u4e3a\u9010\u7ea7\u7d22\u5f15\uff0c\u6700\u7ec8\u5c06\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u3002</p> <p>\u591a\u7ea7\u9875\u8868\u7c7b\u4f3c\u4e8e\u591a\u53c9\u6811\uff0c\u53c8\u53eb\u4e3a\u9875\u8868\u6811 </p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_17","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li>\u5728\u5b9e\u9645\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u5230\u7269\u7406\u5185\u5b58\u5730\u5740\u7684\u5730\u5740\u8f6c\u6362\u7684\u8fc7\u7a0b\u91cc\uff0c\u5e76\u6ca1\u6709\u91c7\u7528\u54c8\u5e0c\u8868\uff0c\u800c\u662f\u91c7\u7528\u4e86\u591a\u7ea7\u9875\u8868\u7684\u89e3\u51b3\u65b9\u6848\u3002\u90a3\u4f7f\u7528\u591a\u7ea7\u9875\u8868\uff0c\u5bf9\u4e8e\u54c8\u5e0c\u8868\u6709\u54ea\u4e9b\u4f18\u70b9\uff0c\u53c8\u6709\u54ea\u4e9b\u7f3a\u70b9\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#41-tlb","title":"41 | \u7406\u89e3\u5185\u5b58\uff08\u4e0b\uff09\uff1a\u89e3\u6790TLB\u548c\u5185\u5b58\u4fdd\u62a4","text":"<p>\u673a\u5668\u6307\u4ee4\u91cc\u9762\u7684\u5185\u5b58\u5730\u5740\u90fd\u662f\u865a\u62df\u5185\u5b58\u5730\u5740\u3002</p> <p>\u7a0b\u5e8f\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u90fd\u6709\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5730\u5740\u8f6c\u6362\u6765\u83b7\u5f97\u6700\u7ec8\u7684\u5b9e\u9645\u7269\u7406\u5730\u5740\u3002</p> <p>\u6211\u4eec\u6bcf\u4e00\u4e2a\u6307\u4ee4\u90fd\u5b58\u653e\u5728\u5185\u5b58\u91cc\u9762\uff0c\u6bcf\u4e00\u6761\u6570\u636e\u90fd\u5b58\u653e\u5728\u5185\u5b58\u91cc\u9762\u3002\u56e0\u6b64\uff0c\u201c\u5730\u5740\u8f6c\u6362\u201d\u662f\u4e00\u4e2a\u975e\u5e38\u9ad8\u9891\u7684\u52a8\u4f5c\u3002</p> <p>\u5e94\u5bf9\u5730\u5740\u8f6c\u6362\u5e26\u6765\u7684\u95ee\u9898</p> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_18","title":"\u6027\u80fd\u95ee\u9898","text":"<p>\u65e2\u7136\u865a\u62df\u8f6c\u6362\u6210\u7269\u7406\u9700\u8981\u8bbf\u95ee\u591a\u6b21\u5185\u5b58\uff0c\u90a3\u80fd\u4e0d\u80fd\u52a0\u4e2a\u7f13\u5b58\uff1f\u7f13\u5b58\u8981\u5145\u5206\u5229\u7528 \u201d\u65f6\u95f4\u5c40\u90e8\u6027\u201c \u548c \u201d\u7a7a\u95f4\u5c40\u90e8\u6027\u201c\u624d\u884c\u3002\u597d\u50cf\u5173\u4e8e\u8fd9\u4e9b\u8f6c\u6362\u90fd\u662f\u8981\u6d89\u53ca\u5230\u90fd\u662f\u8981\u6d89\u53ca\u5230CPU\u5c42\u9762\u7684\u6307\u4ee4\u7684\uff0c\u90a3\u6307\u4ee4\u53c8\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5e94\u8be5\u662f\u53ef\u4ee5\u7528\u7f13\u5b58\u7684\uff0c\u8fd8\u771f\u884c\uff1a\u7528\u4e86TLB</p> <p>\u7a0b\u5e8f\u6240\u9700\u8981\u4f7f\u7528\u7684\u6307\u4ee4\uff0c\u90fd\u987a\u5e8f\u5b58\u653e\u5728\u865a\u62df\u5185\u5b58\u91cc\u9762\u3002\u6211\u4eec\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4e5f\u662f\u4e00\u6761\u6761\u987a\u5e8f\u6267\u884c\u4e0b\u53bb\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5bf9\u4e8e\u6307\u4ee4\u5730\u5740\u7684\u8bbf\u95ee\uff0c\u5b58\u5728\u524d\u9762\u51e0\u8bb2\u6240\u8bf4\u7684\u201c\u7a7a\u95f4\u5c40\u90e8\u6027\u201d\u548c\u201c\u65f6\u95f4\u5c40\u90e8\u6027\u201d\uff0c\u800c\u9700\u8981\u8bbf\u95ee\u7684\u6570\u636e\u4e5f\u662f\u4e00\u6837\u7684\u3002\u6211\u4eec\u8fde\u7eed\u6267\u884c\u4e86 5 \u6761\u6307\u4ee4\u3002\u56e0\u4e3a\u5185\u5b58\u5730\u5740\u90fd\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u8fd9 5 \u6761\u6307\u4ee4\u901a\u5e38\u90fd\u5728\u540c\u4e00\u4e2a\u201c\u865a\u62df\u9875\u201d\u91cc\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#tlbtranslation-lookaside-buffer","title":"TLB\uff1a\u5730\u5740\u53d8\u6362\u9ad8\u901f\u7f13\u51b2\uff08Translation-Lookaside Buffer\uff09","text":"<p>TLB \u548c\u524d\u9762\u7684 CPU \u7684\u9ad8\u901f\u7f13\u5b58\u7c7b\u4f3c</p> <ul> <li>\u53ef\u4ee5\u5206\u6210\u6307\u4ee4\u7684 TLB \u548c\u6570\u636e\u7684 TLB\uff0c\u4e5f\u5c31\u662f ITLB \u548c DTLB\u3002</li> <li>\u4e5f\u53ef\u4ee5\u6839\u636e\u5927\u5c0f\u5bf9\u5b83\u8fdb\u884c\u5206\u7ea7\uff0c\u53d8\u6210 L1\u3001L2 \u8fd9\u6837\u591a\u5c42\u7684 TLB\u3002</li> <li>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u70b9\u548c CPU \u91cc\u7684\u9ad8\u901f\u7f13\u5b58\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u6211\u4eec\u9700\u8981\u7528\u810f\u6807\u8bb0\u8fd9\u6837\u7684\u6807\u8bb0\u4f4d\uff0c\u6765\u5b9e\u73b0\u201c\u5199\u56de\u201d\u8fd9\u6837\u7f13\u5b58\u7ba1\u7406\u7b56\u7565\u3002</li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u4e2a\u7f13\u5b58\u65f6\u5b58\u8f6c\u6362\u597d\u7684\u7269\u7406\u5730\u5740</p> <p>\u4e3a\u4e86\u6027\u80fd\uff0c\u6574\u4e2a\u5185\u5b58\u8f6c\u6362\u8fc7\u7a0b\u4e5f\u8981\u7531\u786c\u4ef6\u6765\u6267\u884c\u3002</p> <p>\u5728 CPU \u82af\u7247\u91cc\u9762\u88c5\u4e86\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff0cMemory Management Unit\uff09\u82af\u7247\uff0c\u7528\u6765\u5b8c\u6210\u5730\u5740\u8f6c\u6362\u3002</p> <p>\u548c TLB \u7684\u8bbf\u95ee\u548c\u4ea4\u4e92\uff0c\u90fd\u662f\u7531\u8fd9\u4e2a MMU \u63a7\u5236\u7684\u3002</p> <p></p> <p>(\u901a\u5e38TLB\u662fMMU\u7684\u4e00\u90e8\u5206\uff0c\u4f5c\u4e3aMMU\u7684\u9ad8\u901f\u7f13\u5b58)</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_19","title":"\u5185\u5b58\u4fdd\u62a4\u548c\u5b89\u5168\u95ee\u9898","text":"<p>\u65e0\u8bba\u662f CPU \u8fd9\u6837\u7684\u786c\u4ef6\uff0c\u8fd8\u662f\u64cd\u4f5c\u7cfb\u7edf\u8fd9\u6837\u7684\u8f6f\u4ef6\uff0c\u90fd\u592a\u590d\u6742\u4e86\uff0c\u96be\u514d\u8fd8\u662f\u4f1a\u88ab\u9ed1\u5ba2\u4eec\u627e\u5230\u5404\u79cd\u5404\u6837\u7684\u6f0f\u6d1e\u3002\u5c31\u50cf\u6211\u4eec\u5728\u8f6f\u4ef6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5e38\u5e38\u4f1a\u6709\u4e00\u4e2a\u201c\u515c\u5e95\u201d\u7684\u9519\u8bef\u5904\u7406\u65b9\u6848\u4e00\u6837\uff0c\u5728\u5bf9\u4e8e\u5185\u5b58\u7684\u7ba1\u7406\u91cc\u9762\uff0c\u8ba1\u7b97\u673a\u4e5f\u6709\u4e00\u4e9b\u6700\u5e95\u5c42\u7684\u5b89\u5168\u4fdd\u62a4\u673a\u5236\u3002</p> <p>\u8fd9\u4e9b\u673a\u5236\u7edf\u79f0\u4e3a\u5185\u5b58\u4fdd\u62a4\uff08Memory Protection\uff09\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#executable-space-protection","title":"\u53ef\u6267\u884c\u7a7a\u95f4\u4fdd\u62a4\uff08Executable Space Protection\uff09","text":"<p>\u5728\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u4e2d\uff0c\u6709\u4e00\u5757\u533a\u57df\u5b58\u653e\u7740\u7a0b\u5e8f\u7684\u6307\u4ee4\uff08\u4ee3\u7801\u533a\uff09\uff0c\u53e6\u4e00\u5757\u533a\u57df\u5b58\u653e\u7740\u7a0b\u5e8f\u7684\u6570\u636e\u3002</p> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cCPU\u53ea\u5e94\u8be5\u6267\u884c\u4ee3\u7801\u533a\u57df\u4e2d\u7684\u6307\u4ee4\u3002\u53ef\u6267\u884c\u7a7a\u95f4\u4fdd\u62a4\u7684\u76ee\u7684\u5c31\u662f\u9650\u5236CPU\u53ea\u80fd\u6267\u884c\u88ab\u6807\u8bb0\u4e3a\u201c\u53ef\u6267\u884c\u201d\u7684\u5185\u5b58\u533a\u57df\uff0c\u800c\u5bf9\u4e8e\u5176\u4ed6\u533a\u57df\uff0c\u6bd4\u5982\u6570\u636e\u533a\u57df\uff0c\u4e0d\u7ed9\u4e88\u201c\u53ef\u6267\u884c\u201d\u7684\u6743\u9650\u3002</p> <p>\u9ed1\u5ba2\u53ef\u80fd\u5c1d\u8bd5\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\uff0c\u6bd4\u5982\u5728\u7a0b\u5e8f\u7684\u6570\u636e\u533a\u57df\u4e2d\u63d2\u5165\u4e00\u4e9b\u7279\u5236\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u8bd5\u56fe\u6b3a\u9a97CPU\u5c06\u5176\u5f53\u4f5c\u6307\u4ee4\u6267\u884c\u3002\u8fd9\u88ab\u79f0\u4e3a\u4ee3\u7801\u6ce8\u5165\u6216\u4ee3\u7801\u6267\u884c\u653b\u51fb\u3002</p> <p>\u4e3a\u4e86\u9632\u8303\u8fd9\u7c7b\u653b\u51fb\uff0c\u53ef\u6267\u884c\u7a7a\u95f4\u4fdd\u62a4\u786e\u4fdd\u53ea\u6709\u88ab\u660e\u786e\u6807\u8bb0\u4e3a\u201c\u53ef\u6267\u884c\u201d\u7684\u533a\u57df\u624d\u80fd\u88abCPU\u6267\u884c\u3002</p> <p>\u56e0\u6b64\uff0c\u901a\u8fc7\u63a7\u5236\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u6267\u884c\u6743\u9650\uff0c\u53ef\u6267\u884c\u7a7a\u95f4\u4fdd\u62a4\u673a\u5236\u963b\u6b62\u4e86\u5bf9\u6570\u636e\u533a\u57df\u8fdb\u884c\u975e\u6cd5\u6267\u884c\u7684\u5c1d\u8bd5\u3002\u5373\u4fbf\u9ed1\u5ba2\u5728\u6570\u636e\u533a\u57df\u4e2d\u63d2\u5165\u4e86\u7279\u5236\u7684\u6570\u636e\uff0c\u7531\u4e8e\u6ca1\u6709\u201c\u53ef\u6267\u884c\u201d\u7684\u6743\u9650\uff0cCPU\u5c06\u62d2\u7edd\u6267\u884c\u8fd9\u4e9b\u6570\u636e\u4f5c\u4e3a\u6307\u4ee4\u3002</p> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u8bf4\u7684\u6570\u636e\u533a\u57df\u7684\u5185\u5bb9 \u201c\u4e0d\u53ef\u6267\u884c\u201d\uff0cCPU\u662f\u53ef\u4ee5\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u7684\uff0c\u4f46\u662f\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u88ab\u5f53\u505a\u6307\u4ee4\u6765\u6267\u884c\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cCPU\u53ef\u4ee5\u8bbf\u95ee\u6570\u636e\u533a\u57df\u7684\u5185\u5bb9\uff0c\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\uff0c\u4f46\u4e0d\u4f1a\u5c06\u8fd9\u4e9b\u6570\u636e\u4f5c\u4e3a\u6307\u4ee4\u6765\u6267\u884c\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\u53ef\u4ee5\u786e\u4fdd\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\uff0c\u9632\u6b62\u6076\u610f\u4ee3\u7801\u6ce8\u5165\u6216\u6267\u884c\u653b\u51fb\u3002</p> <ul> <li>\u4e3e\u4f8b\uff1a</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_20","title":"\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316","text":"<p>\u5176\u4ed6\u4eba\u3001\u8fdb\u7a0b\u3001\u7a0b\u5e8f\uff0c\u4f1a\u53bb\u4fee\u6539\u6389\u7279\u5b9a\u8fdb\u7a0b\u7684\u6307\u4ee4\u3001\u6570\u636e\uff0c\u7136\u540e\uff0c\u8ba9\u5f53\u524d\u8fdb\u7a0b\u53bb\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\uff0c\u9020\u6210\u7834\u574f\u3002</p> <p>\u8981\u60f3\u4fee\u6539\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u6240\u5728\u7684\u4f4d\u7f6e\u624d\u884c\u3002</p> <p>\u539f\u5148\u6211\u4eec\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5e03\u5c40\u7a7a\u95f4\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u4efb\u4f55\u7b2c\u4e09\u65b9\u5f88\u5bb9\u6613\u5c31\u80fd\u77e5\u9053\u6307\u4ee4\u5728\u54ea\u91cc\uff0c\u7a0b\u5e8f\u6808\u5728\u54ea\u91cc\uff0c\u6570\u636e\u5728\u54ea\u91cc\uff0c\u5806\u53c8\u5728\u54ea\u91cc\u3002\u8fd9\u4e2a\u5176\u5b9e\u4e3a\u60f3\u8981\u641e\u7834\u574f\u7684\u4eba\u521b\u9020\u4e86\u5f88\u5927\u7684\u4fbf\u5229\u3002</p> <p>\u800c\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\u8fd9\u4e2a\u673a\u5236\uff0c\u5c31\u662f\u8ba9\u8fd9\u4e9b\u533a\u57df\u7684\u4f4d\u7f6e\u4e0d\u518d\u56fa\u5b9a\uff0c\u5728\u5185\u5b58\u7a7a\u95f4\u968f\u673a\u53bb\u5206\u914d\u8fd9\u4e9b\u8fdb\u7a0b\u91cc\u4e0d\u540c\u90e8\u5206\u6240\u5728\u7684\u5185\u5b58\u7a7a\u95f4\u5730\u5740\u3002</p> <p>\u8ba9\u7834\u574f\u8005\u731c\u4e0d\u51fa\u6765\u3002\u731c\u4e0d\u51fa\u6765\u5462\uff0c\u81ea\u7136\u5c31\u6ca1\u6cd5\u627e\u5230\u60f3\u8981\u4fee\u6539\u7684\u5185\u5bb9\u7684\u4f4d\u7f6e\u3002</p> <p>\u5982\u679c\u53ea\u662f\u968f\u4fbf\u505a\u70b9\u4fee\u6539\uff0c\u7a0b\u5e8f\u53ea\u4f1a crash \u6389\uff0c\u800c\u4e0d\u4f1a\u53bb\u6267\u884c\u8ba1\u5212\u4e4b\u5916\u7684\u4ee3\u7801\u3002</p> <p></p> <ul> <li> <p>\u4e3e\u4f8b \u201c\u968f\u673a\u5316\u201d\uff1a</p> <ol> <li> <p>\u5bc6\u7801\u5b58\u50a8</p> <pre><code>$password = \"goodmorning12345\";\n// \u6211\u4eec\u7684\u5bc6\u7801\u662f\u660e\u6587\u5b58\u50a8\u7684\n\n$hashed_password = hash('sha256', password);\n// \u5bf9\u5e94\u7684hash\u503c\u662f 054df97ac847f831f81b439415b2bad05694d16822635999880d7561ee1b77ac\n// \u4f46\u662f\u8fd9\u4e2ahash\u503c\u91cc\u53ef\u4ee5\u7528\u5f69\u8679\u8868\u76f4\u63a5\u201c\u731c\u51fa\u6765\u201d\u539f\u59cb\u7684\u5bc6\u7801\u5c31\u662fgoodmorning12345\n\n\n$salt = \"#21Pb$Hs&amp;Xi923^)?\";\n$salt_password = $salt.$password;\n$hashed_salt_password = hash('sha256', salt_password);\n// \u8fd9\u4e2ahash\u540e\u7684slat\u56e0\u4e3a\u6709\u90e8\u5206\u968f\u673a\u7684\u5b57\u7b26\u4e32\uff0c\u4e0d\u4f1a\u5728\u5f69\u8679\u8868\u91cc\u9762\u51fa\u73b0\u3002\n// 261e42d94063b884701149e46eeb42c489c6a6b3d95312e25eee0d008706035f\n</code></pre> <p>\u5728\u6570\u636e\u5e93\u91cc\uff0c\u7ed9\u6bcf\u4e00\u4e2a\u7528\u6237\u540d\u751f\u6210\u4e00\u4e2a\u968f\u673a\u7684\u3001\u4f7f\u7528\u4e86\u5404\u79cd\u7279\u6b8a\u5b57\u7b26\u7684\u76d0\u503c\uff08Salt\uff09\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u7684\u54c8\u5e0c\u503c\u5c31\u4e0d\u518d\u662f\u4ec5\u4ec5\u4f7f\u7528\u5bc6\u7801\u6765\u751f\u6210\u7684\u4e86\uff0c\u800c\u662f\u5bc6\u7801\u548c\u76d0\u503c\u653e\u5728\u4e00\u8d77\u751f\u6210\u7684\u5bf9\u5e94\u7684\u54c8\u5e0c\u503c\u3002\u54c8\u5e0c\u503c\u7684\u751f\u6210\u4e2d\uff0c\u5305\u62ec\u4e86\u4e00\u4e9b\u7c7b\u4f3c\u4e8e\u201c\u4e71\u7801\u201d\u7684\u968f\u673a\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u901a\u8fc7\u5f69\u8679\u8868\u78b0\u649e\u6765\u731c\u51fa\u5bc6\u7801\u7684\u529e\u6cd5\u5c31\u7528\u4e0d\u4e86\u4e86\u3002 </p> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_21","title":"\u63a8\u8350\u9605\u8bfb","text":"<ul> <li>\u5bf9\u4e8e\u5185\u5b58\u4fdd\u62a4\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7Memory protection - Wikipedia\u91cc\u9762\u7684\u76f8\u5173\u6761\u76ee\u6765\u8fdb\u4e00\u6b65\u4e86\u89e3\u76f8\u5173\u7684\u4fe1\u606f\u3002</li> <li>\u53e6\u5916\uff0c2017 \u5e74\u66b4\u9732\u51fa\u6765\u7684\u5e7d\u7075\u6f0f\u6d1e - \u7ef4\u57fa\u767e\u79d1\uff0c\u81ea\u7531\u7684\u767e\u79d1\u5168\u4e66 (wikipedia.org)\u548c Meltdown \u6f0f\u6d1e\u7684\u76f8\u5173\u539f\u7406\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728 Wikipedia \u91cc\u9762\u627e\u5230\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6765\u4e86\u89e3\u4e00\u4e0b\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_22","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>\u6307\u4ee4\u548c\u6570\u636e\uff0c\u5728CPU\u6267\u884c\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u4e0d\u4e5f\u662f\u9700\u8981\u7528\u5230\u6570\u636e\u533a\u57df\u91cc\u7684\u6570\u636e\u5417\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u8bf4\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cCPU\u53ea\u5e94\u8be5\u6267\u884c\u4ee3\u7801\u533a\u57df\u4e2d\u7684\u6307\u4ee4\u5462\uff1f</p> <p>\u8fd8\u662f\u8bf4\u5728\u6307\u4ee4\u8fd0\u884c\u4e2d\uff0c\u4e5f\u4f1a\u53bb\u4f7f\u7528\u6570\u636e\u533a\u57df\uff0c\u5e76\u4e0d\u662f\u8bf4\u5b8c\u5168\u53ea\u6267\u884c\u6307\u4ee4\uff1f </p> <p>\u7b54\uff1a\u5e76\u4e0d\u662f\u8bf4\u4e0d\u7528\uff0c\u8fd9\u91cc\u8bf4\u7684\u6570\u636e\u533a\u57df\u7684\u5185\u5bb9 \u201c\u4e0d\u53ef\u6267\u884c\u201d\uff0cCPU\u662f\u53ef\u4ee5\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u7684\uff0c\u4f46\u662f\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u88ab\u5f53\u505a\u6307\u4ee4\u6765\u6267\u884c\u3002</p> </li> <li> <p>\u5c5e\u4e8e\u865a\u62df\u5730\u5740\u8c03\u63a7\u548c\u7269\u7406\u5730\u5740\u8c03\u63a7\u7684\u6709\u54ea\u4e9b\uff1a</p> <ol> <li> <p>\u81ea\u5df1\u7684\u56de\u7b54\uff1a</p> <ul> <li> <p>\u865a\u62df\u5730\u5740\u8c03\u63a7\uff1a</p> <p>Addresses as used by the software</p> <ul> <li>Load/Store instruction \uff08RISC\uff09</li> <li>Any instruction accessing memory</li> </ul> </li> <li> <p>\u7269\u7406\u5730\u5740\u8c03\u63a7\uff1a</p> <p>Addresses\u00a0as\u00a0used\u00a0by\u00a0the\u00a0hardware</p> <ul> <li>DMA\u3001peripherals</li> </ul> </li> </ul> </li> <li> <p>GPT\uff1a</p> <ul> <li> <p>\u865a\u62df\u5730\u5740\u8c03\u63a7\uff1a</p> <ol> <li>\u5230\u53ef\u6267\u884c\u6587\u4ef6\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u4e4b\u524d\u90fd\u662f\u548c\u865a\u62df\u5730\u5740\u76f8\u5173\u3002</li> <li>\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff1a\u6bcf\u4e2a\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u5305\u62ec\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u3001\u5806\u3001\u6808\u7b49\u3002\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u865a\u62df\u5185\u5b58\u7ba1\u7406\u6765\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u63d0\u4f9b\u72ec\u7acb\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u8ba4\u4e3a\u81ea\u5df1\u72ec\u5360\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u3002</li> <li>\u865a\u62df\u5185\u5b58\uff1a\u865a\u62df\u5185\u5b58\u662f\u4e00\u79cd\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u673a\u5236\uff0c\u5b83\u5141\u8bb8\u7a0b\u5e8f\u8bbf\u95ee\u6bd4\u7269\u7406\u5185\u5b58\u66f4\u5927\u7684\u5730\u5740\u7a7a\u95f4\u3002\u901a\u8fc7\u865a\u62df\u5185\u5b58\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u5c06\u90e8\u5206\u6570\u636e\u4ece\u7269\u7406\u5185\u5b58\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\uff0c\u4ece\u800c\u91ca\u653e\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u3002MMU\u8d1f\u8d23\u5c06\u865a\u62df\u5185\u5b58\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u6216\u78c1\u76d8\u4e0a\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</li> </ol> </li> <li> <p>\u7269\u7406\u5730\u5740\u8c03\u63a7</p> <ol> <li>\u4e3b\u5b58\u50a8\u5668\uff1a\u4e3b\u5b58\u50a8\u5668\u662f\u8ba1\u7b97\u673a\u4e2d\u7528\u4e8e\u5b58\u50a8\u7a0b\u5e8f\u548c\u6570\u636e\u7684\u7269\u7406\u5185\u5b58\uff0c\u5b83\u7531\u4e00\u7cfb\u5217\u7684\u5b58\u50a8\u5355\u5143\u7ec4\u6210\u3002MMU\u8d1f\u8d23\u5c06\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u4e3b\u5b58\u50a8\u5668\u7684\u7269\u7406\u5730\u5740\uff0c\u4ee5\u4fbf\u5b9e\u9645\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</li> <li>\u7f13\u5b58\uff1a\u73b0\u4ee3\u8ba1\u7b97\u673a\u7cfb\u7edf\u901a\u5e38\u5305\u542b\u591a\u7ea7\u7f13\u5b58\uff0c\u5305\u62ecL1\u3001L2\u3001L3\u7f13\u5b58\u7b49\u3002MMU\u8d1f\u8d23\u5c06\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7f13\u5b58\u7684\u7269\u7406\u5730\u5740\uff0c\u4ee5\u52a0\u901f\u5bf9\u5185\u5b58\u7684\u8bbf\u95ee\u3002</li> </ol> </li> <li> <p>\u603b\u7ed3</p> <p>\u7a0b\u5e8f\u4e2d\u7684\u6307\u4ee4\u901a\u5e38\u4f7f\u7528\u865a\u62df\u5730\u5740\uff0c\u5f53\u7a0b\u5e8f\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u65f6\u5019\uff0c\u5185\u5b58\u4f1a\u5c06\u7a0b\u5e8f\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u53bb\uff0c\u4e4b\u540e\u548c\u786c\u4ef6\u8fdb\u884c\u4ea4\u4e92\u4e86\uff0c\u90fd\u662f\u4f7f\u7528\u7684\u7269\u7406\u5730\u5740\u4e86\u3002</p> </li> </ul> </li> </ol> </li> <li> <p>cache\u548cMMU\u7684\u987a\u5e8f \u5148MMU\u8f6c\u6362\u5730\u5740 \u7136\u540e\u53bbcache\u770b\u65f6\u5019\u547d\u4e2d\uff1f\u8fd8\u662f\u53cd\u8fc7\u6765\uff1f</p> <p>\uff08\u4ed4\u7ec6\u770b\u6027\u80fd\u95ee\u9898\u90a3\u4e00\u8282\u7684\u56fe\uff09</p> <p>MMU \u5148\u8f6c\u6362\u5730\u5740\uff0c\u7136\u540e CPU \u7f13\u5b58\u8fdb\u884c\u547d\u4e2d\u68c0\u67e5</p> <ol> <li>\u5f53 CPU \u9700\u8981\u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u5730\u5740\u65f6\uff0c\u5b83\u9996\u5148\u5c06\u5730\u5740\u53d1\u9001\u5230 MMU \u8fdb\u884c\u5730\u5740\u8f6c\u6362\u3002</li> <li>MMU \u4f1a\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740(\u5982\u679c\u542f\u7528\u4e86MMU\u7684\u8bdd)\uff0c\u7136\u540e\u5c06\u7269\u7406\u5730\u5740\u8fd4\u56de\u7ed9 CPU\u3002</li> <li>\u4e00\u65e6 CPU \u83b7\u5f97\u4e86\u7269\u7406\u5730\u5740\uff0c\u5b83\u4f1a\u5c06\u8be5\u5730\u5740\u53d1\u9001\u5230 CPU \u7f13\u5b58\u8fdb\u884c\u547d\u4e2d\u68c0\u67e5\u3002<ol> <li>\u5982\u679c\u7f13\u5b58\u4e2d\u5df2\u7ecf\u6709\u4e86\u8fd9\u4e2a\u7269\u7406\u5730\u5740\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u53d1\u751f\u4e86\u7f13\u5b58\u547d\u4e2d\uff0cCPU \u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u9700\u8981\u8bbf\u95ee\u4e3b\u5b58\u3002</li> <li>\u5982\u679c\u7f13\u5b58\u4e2d\u6ca1\u6709\u547d\u4e2d\uff0c\u90a3\u4e48 CPU \u5c31\u9700\u8981\u4ece\u4e3b\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06\u8fd9\u4e9b\u6570\u636e\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\u4ee5\u5907\u5c06\u6765\u7684\u8bbf\u95ee\u3002</li> </ol> </li> </ol> <p>\u5177\u4f53\u770b\uff1a[\u8865\u5145] MMU\u5b9e\u9645\u5de5\u4f5c</p> </li> <li> <p>\u9664\u4e86\u7684\u53ef\u6267\u884c\u7a7a\u95f4\u4fdd\u62a4\u548c\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\u4e4b\u5916\uff0c\u4f60\u8fd8\u77e5\u9053\u5176\u4ed6\u5185\u5b58\u4fdd\u62a4\u7b56\u7565\u5417\uff1f\u4f60\u60f3\u5230\u7684\u8fd9\u4e9b\u5185\u5b58\u4fdd\u62a4\u7b56\u7565\uff0c\u548c\u4f60\u65e5\u5e38\u7684\u5f00\u53d1\u5de5\u4f5c\u4e2d\uff0c\u662f\u5426\u4e5f\u6709\u7c7b\u4f3c\u601d\u8def\u7684\u5e94\u7528\u5462\uff1f</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#cpucachetlbmmu","title":"[\u8865\u5145] CPU\u6838\u3001cache\u3001TLB(MMU)\u534f\u540c\u5de5\u4f5c","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_23","title":"\u8d44\u6599","text":"<ol> <li>\u6559\u6750</li> <li>MMU\u548ccache\u8be6\u89e3\uff08TLB\u673a\u5236\uff09_mmu cache tlb-CSDN\u535a\u5ba2</li> <li>\u4e00\u6587\u641e\u61c2MMU\u5de5\u4f5c\u539f\u7406 - \u77e5\u4e4e (zhihu.com)</li> <li>Cache\u4e0eMMU\u7684\u7231\u6068\u7ea0\u7f20_\u6709cache\u4e00\u5b9a\u8981\u6709mmu\u5417-CSDN\u535a\u5ba2</li> <li>\u5904\u7406\u5668\u8bbf\u95ee\u5185\u5b58\u65f6\uff0cCPU\u6838\u3001cache\u3001MMU\u5982\u4f55\u534f\u540c\u5de5\u4f5c_x86 cpu core \u4e0e mmu \u5982\u4f55\u901a\u4fe1-CSDN\u535a\u5ba2</li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#mmu","title":"MMU\u548c\u5185\u5b58\u63a7\u5236\u5668","text":"<p>(89 \u5c01\u79c1\u4fe1 / 80 \u6761\u6d88\u606f) \u5185\u5b58\u63a7\u5236\u5668\u548ccpu\u7684\u95ee\u9898\uff1f - \u77e5\u4e4e (zhihu.com)</p> <p>\u5c0f\u7b14\u8bb0\u2014\u2014\u5185\u5b58\u63a7\u5236\u5668-CSDN\u535a\u5ba2</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#linux","title":"Linux\u5185\u5b58\u7ba1\u7406","text":"<ol> <li>Meaning of Paging or Swapping:</li> <li>Paging: Paging is a memory management scheme used by operating systems to store and retrieve data from secondary storage (usually disk) when it is not currently in RAM. The system divides physical memory into fixed-size blocks called pages and maintains a mapping between logical addresses used by processes and physical addresses in memory. When a process accesses data that is not in RAM, a page fault occurs, and the operating system swaps the required page from disk to RAM.</li> <li> <p>Swapping: Swapping is the process of moving an entire process or parts of a process from main memory (RAM) to secondary storage (disk) and vice versa. When the system is low on physical memory, it may swap out less frequently accessed pages or entire processes to disk to free up space for more active processes. Swapping helps prevent memory exhaustion and allows the system to continue running multiple processes efficiently.</p> </li> <li> <p>\"\u5206\u9875\" in Chinese: Yes, \"\u5206\u9875\" is the Chinese term for \"paging\" in the context of memory management. It refers to the process of dividing memory into fixed-size pages to facilitate efficient memory allocation and management. In the context of virtual memory systems, \"\u5206\u9875\" plays a crucial role in mapping logical addresses to physical memory locations and enabling the system to handle memory requests from processes effectively.</p> </li> </ol> <p></p> <p></p> <p></p> <p></p> <p></p> <p>direct one-to-one mapping</p> <p>\u4e5f\u662f\u4e3a\u4ec0\u4e48 Kernel Logic Address  \u4f7f\u5f97\u4ece PA \u5230 VA \u66f4\u52a0\u5bb9\u6613\uff0c\u4e0d\u9700\u8981\u4ec0\u4e48\u9875\u8868\u590d\u6742\u7684\u4e1c\u897f\uff0c\u76f4\u63a5\u4e00\u5bf9\u4e00\uff0cfix mapping</p> <p></p> <p></p> <p>\u5185\u6838\u8fdb\u7a0b\u4e5f\u6709\u81ea\u5df1\u7684\u6808\uff0c\u5e76\u4e14\u548c\u7528\u6237\u7a7a\u95f4\u7684\u533a\u522b\u5f00\u4e86\uff0c\u5b58\u5728\u4e8e\u5185\u6838\u5185\u5b58\u533a\uff08\u9ad8\u4f4d\u7684\uff09</p> <p>Logical memory, also known as virtual memory, can never be swapped out because it represents the entire address space that a process can use, including both the physical memory (RAM) and the swap space on disk. </p> <p>Swapping out logical memory would essentially mean removing a portion of the address space that a process expects to be available for its execution(even in kernel), leading to inconsistencies and potential crashes in the system.</p> <p>Regarding the statement \"Note that ... system\", it is correct that not all physical addresses need to correspond to a kernel logical address. This means that the kernel may not be actively using every byte of memory on the system at all times. The kernel manages memory allocation and deallocation efficiently, ensuring that only necessary memory regions are mapped to logical addresses for processes to use.</p> <p></p> <p>DMA: contiguous buffers while was being transfering </p> <p></p> <p></p> <p></p> <p><code>vmalloc</code> for High memory</p> <p>on a 64-bit system, all memory is low memory. </p> <p></p> <p></p> <p></p> <p></p> <p>User:</p> <p></p> <p></p> <p></p> <p></p> <p>In the context of operating systems and computer architecture, a context switch refers to the process of saving the current state of a process or thread and loading the state of another process or thread so that the CPU can switch between executing different tasks. During a context switch, the operating system saves the current execution context of the process being preempted and restores the execution context of the process being resumed.</p> <p>Here's a simplified explanation of what is saved and restored during a context switch using a real operating system like Linux:</p> <ol> <li> <p>Registers: Registers are small, fast storage locations within the CPU that hold data temporarily during program execution. During a context switch, the operating system saves and restores the contents of the CPU registers to ensure that the state of the process is preserved. This includes general-purpose registers, program counter (instruction pointer), stack pointer, and other special-purpose registers.</p> </li> <li> <p>Program Counter (PC): The program counter holds the memory address of the next instruction to be executed. Saving and restoring the program counter is crucial during a context switch to resume execution of the process from the correct point.</p> </li> <li> <p>Stack Pointer (SP): The stack pointer points to the top of the stack, which is used for function calls, local variables, and other data storage. Saving and restoring the stack pointer ensures that the process can continue using the correct stack space.</p> </li> <li> <p>Process Control Block (PCB): The PCB is a data structure maintained by the operating system for each process, containing information about the process's state, memory allocation, open files, and other relevant details. During a context switch, the operating system updates the PCB of the current process and loads the PCB of the next process to be executed.</p> </li> <li> <p>Memory Management Unit (MMU): The MMU is responsible for translating virtual addresses used by processes into physical addresses in memory. The operating system updates the MMU configuration to reflect the memory mappings of the new process being switched in.</p> </li> </ol> <p>By saving and restoring these components during a context switch, the operating system ensures that processes can share the CPU efficiently and maintain isolation from each other. This mechanism allows multitasking and multiprocessing systems to run multiple processes concurrently while providing each process with its own execution environment.</p> <p>MMU</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_24","title":"\u534f\u540c\u5de5\u4f5c","text":"<p>\u6765\u81ea\u535a\u5ba2</p> <p></p> <ol> <li>\u9996\u5148CPU\u6838\u5fc3\uff08ARM\uff09\u53d1\u51faVA\uff0c\u4f20\u7ed9TLB\uff08\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4f20\u7ed9TLB\uff0c\u5b9e\u9645\u4e0a\u662f\u4f20\u7ed9MMU\uff0c\u5230\u4f46\u662fTLB\u53ef\u4ee5\u770b\u6210\u662fMMU\u7684\u9ad8\u901f\u7f13\u5b58[ \u4ecb\u4e8eCPU\u6838\u5fc3\u548c\u7269\u7406\u5185\u5b58\u95f4 ]\uff0c\u4f5c\u4e3aMMU\u7684\u4e00\u90e8\u5206\uff09\u3002TLB\u4e2d\u7f13\u5b58\u7740\u6700\u8fd1\u67e5\u627e\u8fc7\u7684VA\u5bf9\u5e94\u7684\u9875\u8868\u9879\uff08\u9875\u8868\u4e2d\u7684\u4e00\u9879\uff0c\u7c7b\u4f3c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff09\uff0c\u5982\u679c\u7f13\u5b58\u4e86\u5f53\u524dVA\u7684\u7269\u7406\u6620\u5c04\uff0c\u90a3\u5c31\u65e0\u9700\u505atranslation table walk\u4e86\uff0c\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u62ff\uff1b\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u5c31\u5f97\u76f4\u63a5\u53bb\u7269\u7406\u5185\u5b58\u4e2d\u8bfb\u51fa\u9875\u8868\u9879\uff0c\u83b7\u53d6\u7269\u7406\u5185\u5b58\u3002</li> <li>\u9875\u8868\u9879\u4e2d\u4e0d\u4ec5\u4fdd\u5b58\u7740\u7269\u7406\u9875\u9762\u7684\u57fa\u5730\u5740\uff0c\u8fd8\u4fdd\u5b58\u7740\u6743\u9650\u548c\u662f\u5426\u5141\u8bb8cache\u7684\u6807\u5fd7\u3002<ol> <li>MMU\u9996\u5148\u68c0\u67e5\u6743\u9650\u4f4d\uff0c\u5982\u679c\u6ca1\u6709\u8bbf\u95ee\u6743\u9650\uff0c\u5c31\u5f15\u53d1\u4e00\u4e2a\u5f02\u5e38\uff08abort\uff09\u7ed9CPU\u5185\u6838\u3002</li> <li>\u7136\u540e\u68c0\u67e5\u662f\u5426\u5141\u8bb8cache\uff0c<ol> <li>\u5982\u679c\u4e0d\u5141\u8bb8cache\uff0c\u90a3\u76f4\u63a5\u53d1\u51faPA\u4ece\u7269\u7406\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5230CPU\u5185\u6838\u3002</li> <li>\u5982\u679c\u5141\u8bb8cache\u5c31\u542f\u52a8cache\u548cCPU\u5185\u6838\u4e92\u64cd\u4f5c\u3002</li> <li>\u5982\u679c\u5141\u8bb8cache\uff0c\u5219\u4ee5VA\u4e3a\u7d22\u5f15\u5230cache\u4e2d\u67e5\u627e\u662f\u5426\u7f13\u5b58\u4e86\u8981\u8bfb\u53d6\u7684\u6570\u636e\uff0c\u5982\u679ccache\u4e2d\u5df2\u7ecf\u7f13\u5b58\u4e86\u8be5\u6570\u636e(\u79f0\u4e3acache hit)\u5219\u76f4\u63a5\u8fd4\u56de\u7ed9CPU\u5185\u6838\uff0c\u5982\u679ccache\u4e2d\u6ca1\u6709\u7f13\u5b58\u8be5\u6570\u636e(\u79f0\u4e3acache miss)\uff0c\u5219\u53d1\u51faPA\u4ece\u7269\u7406\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u7f13\u5b58\u5230cache\u4e2d\uff0c\u540c\u65f6\u8fd4\u56de\u7ed9CPU\u5185\u6838\u3002\u4f46\u662fcache\u5e76\u4e0d\u662f\u53ea\u53bbCPU\u5185\u6838\u6240\u9700\u8981\u7684\u6570\u636e\uff0c\u800c\u662f\u628a\u76f8\u90bb\u7684\u6570\u636e\u90fd\u53bb\u4e0a\u6765\u7f13\u5b58\uff0c\u8fd9\u79f0\u4e3a\u4e00\u4e2acache line\u3002ARM920T\u7684cache line\u662f32\u4e2a\u5b57\u8282\uff0c\u4f8b\u5982CPU\u5185\u6838\u8981\u8bfb\u53d6\u5730\u57400x30000134 ~ 0x3000137\u76844\u4e2a\u5b57\u8282\u6570\u636e\uff0ccache\u4f1a\u628a\u5730\u57400x30000120 ~ 0x3000137(\u5bf9\u9f50\u523032\u5b57\u8282\u5730\u5740\u8fb9\u754c)\u768432\u5b57\u8282\u90fd\u53d6\u4e0a\u6765\u7f13\u5b58\u3002\uff08\u56fe\u4e2d\u76844\uff09</li> </ol> </li> </ol> </li> </ol> <p>\u81ea\u5df1\u7406\u89e3</p> <ul> <li> <p>\u660e\u786e\u77e5\u8bc6\uff1a</p> </li> <li> <p>\u9996\u5148TLB\u662f\u7528\u4e8e\u52a0\u901f\u865a\u62df\u5185\u5b58\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5185\u5b58\u5730\u5740\u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u4fdd\u5b58\u4e86\u6700\u8fd1\u51e0\u6b21VA\u5230PA\u7684\u6620\u5c04\uff08\u4e5f\u5c31\u662f\u9875\u8868\u9879\uff09\uff0c\u5f53CPU\u53d1\u51faVA\u5185\u5b58\u8bbf\u95ee\u7684\u65f6\u5019\uff0cTLB\u9996\u5148\u4f1a\u88ab\u67e5\u8be2\uff0c\u5982\u679cTLB\u4e2d\u5b58\u50a8\u4e86\u7528\u5230\u7684VA\u5230PA\u7684\u6620\u5c04\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f4\u63a5\u63d0\u4f9b\u7269\u7406\u5730\u5740\uff0c\u65e0\u9700\u8bbf\u95ee\u5185\u5b58\uff0c\u52a0\u5feb\u901f\u5ea6\u3002</p> </li> <li> <p>cache\u662f\u52a0\u901f\u5bf9\u5185\u5b58\u6570\u636e\u7684\u8bbf\u95ee\u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u4ed6\u4fdd\u5b58\u4e86\u6700\u8fd1\u8bbf\u95ee\u8fc7\u7684\u5185\u5b58\u6570\u636e\u3002</p> <p>\u5f53CPU\u53d1\u51fa\u5185\u5b58\u8bbf\u95ee\u7684\u65f6\u5019\uff0ccache\u4f1a\u88ab\u67e5\u8be2\uff0c\u5982\u679c\u9700\u8981\u5230\u7684\u6570\u636e\u5728cache\u4e2d\u88ab\u627e\u5230\u4e86\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u63d0\u4f9b\u7ed9CPU\u6838\uff0c\u63d0\u9ad8\u4e86\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u3002</p> </li> </ul> <p>\u6ce8\u610f\u5230CPU\u53d1\u51fa\u5185\u5b58\u8bbf\u95ee\u7684\u65f6\u5019\uff0ccache\u548cTLB\u90fd\u4f1a\u88ab\u67e5\u8be2\uff1f\u662f\u7684\uff0c\u6709\u987a\u5e8f\u3002</p> <p>\u4e0b\u9762\u603b\u7ed3CPU\u8bbf\u95ee\u5185\u5b58\u987a\u5e8f\uff0c</p> <ul> <li>\u4f7f\u7528MMU\u7684\u8bdd</li> <li>\u9996\u5148\u5f53CPU\u6838\u53d1\u51fa\u5185\u5b58\u5730\u5740\u8bbf\u95ee\u8bf7\u6c42\u3002\u9996\u5148\uff0c\u5411TLB\u67e5\u8be2<ol> <li>\u5982\u679cTLB\u4e2d\u627e\u5230\u4e86VA\u548cPA\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8f6c\u6362\u6210\u7269\u7406\u5730\u5740\u3002\u63a5\u7740\uff0c\u7528\u8fd9\u4e2a\u7269\u7406\u5730\u5740\uff0c\u8fdb\u5165\u5230cache\u4e2d\u67e5\u627e\u8981\u7528\u5230\u7684\u6570\u636e\u548c\u6307\u4ee4\uff08\u5982\u679c\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u8981\u53bb\u5185\u5b58\u53d6\u6570\u636e\u548c\u6307\u4ee4\uff09\u7ed9CPU\u6838\u5fc3</li> <li>\u5982\u679cTLB\u672a\u547d\u4e2d\uff0c\u90a3\u4e48\u9700\u8981\u5148\u8fdb\u884c\u5185\u5b58\u5730\u5740\u8f6c\u6362\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u7528\u5230\u9875\u8868\u4e86\uff08\u9875\u8868\u7531\u4e8e\u7a7a\u95f4\u76f8\u5bf9\u5927\uff0c\u901a\u5e38\u5b58\u50a8\u518d\u5185\u5b58\u4e2d\uff09\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u53bb\u5185\u5b58\u8fdb\u884c\u627e\u5230\u9875\u8868\u9879\u3002\u8f6c\u6362\u5f97\u5230\u7269\u7406\u5730\u5740\uff0c\u83b7\u53d6\u8981\u7528\u5230\u7684\u6570\u636e\u548c\u6307\u4ee4\u3002\uff08\u7559\u5751\uff1a\u90a3\u8fd9\u4e2a\u6570\u636e\u5728\u5185\u5b58\u4e2d\u8fd8\u662fcache\u4e2d\uff1f\u8981\u662f\u90fd\u5728\uff0c\u7528\u54ea\u4e2a\uff1f\u7f13\u5b58\u4e00\u81f4\u6027\uff1f\uff09</li> </ol> </li> </ul> <p>\uff08\u4e0a\u9762\u8fd9\u90e8\u5206\u662f\u5173\u4e8eMMU\u5185\u90e8\u786c\u4ef6\u7684\u95ee\u9898\uff0c\u4e4b\u540e\u8981\u5c31\u662f\u770bLinux\u5185\u6838\u4e2d\u5185\u5b58\u7ba1\u7406\u90a3\u90e8\u5206\u4e2d\u7684\u4ee3\u7801\u4e86\uff0cmalloc\u5177\u4f53\u662f\u600e\u4e48\u5206\u914d\u7684\uff0c\u770b\u91cc\u9762\u7684\u5404\u79cd\u7ed3\u6784\u4f53\uff09</p> <p>task_struct --&gt; mm_struct --&gt; vm_area_struct</p> <ul> <li>\u603b\u7ed3</li> </ul> <p>TLB\u548cCache\u53ef\u4ee5\u534f\u540c\u5de5\u4f5c\uff0c\u63d0\u9ad8\u6574\u4e2a\u7cfb\u7edf\u7684\u6027\u80fd</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_25","title":"\u8f85\u52a9\u56fe\u89e3","text":"<p>\u518d\u66f4\u65b0\uff0c\u5b9e\u9645\u4e0a\u9762\u7684\u5185\u5bb9\u4e00\u90e8\u5206\u662f\u6211\u81ea\u5df1\u5bf9\u63a8\u65ad\u51fa\u6765\u7684\uff0c\u5177\u4f53\u8fd8\u6709\u66f4\u8fdb\u4e00\u6b65\u7684\u89c4\u8303\u540d\u79f0\u53eb\u6cd5\uff0c\u8fd9\u4e5f\u662f\u6211\u5728\u5b66\u4e60\u7b28\u53d4\u7684\u300aRISCV\u4f53\u7cfb\u7ed3\u6784\u7f16\u7a0b\u4e0e\u5b9e\u8df5\u300b\u4e00\u4e66\u7684\u7b2c\u5341\u4e00\u7ae0\u4e86\u89e3\u5230\uff0c\u80af\u5b9a\u662f\u6709\u76f8\u5173\u8bba\u6587\u8d44\u6599\u66f4\u52a0\u51c6\u786e\u3001\u8be6\u7ec6\u5730\u8bb2\u89e3\u7684\uff0c\u4e0a\u9762\u5c31\u5f53\u6210\u662f\u4ee5\u524d\u7684\u6211\u4e00\u6b21\u6b21\u6478\u7d22\u5b66\u4e60\u5427\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#42","title":"42 | \u603b\u7ebf\uff1a\u8ba1\u7b97\u673a\u5185\u90e8\u7684\u9ad8\u901f\u516c\u8def","text":"<p>\u597d\u4e86\uff0c\u4f60\u73b0\u5728\u660e\u767d\u8ba1\u7b97\u673a\u91cc\u7684\u603b\u7ebf\u3001\u5404\u79cd\u4e0d\u540c\u7684\u603b\u7ebf\u5230\u5e95\u662f\u4ec0\u4e48\u610f\u601d\u4e86\u5427\uff1f\u5e0c\u671b\u8fd9\u4e00\u8bb2\u80fd\u591f\u5e2e\u4f60\u5398\u6e05\u8ba1\u7b97\u673a\u603b\u7ebf\u7684\u77e5\u8bc6\u70b9\u3002\u73b0\u5728\u6211\u4eec\u4e00\u8d77\u6765\u603b\u7ed3\u68b3\u7406\u4e00\u4e0b\u8fd9\u8282\u7684\u5185\u5bb9\u3002\u8fd9\u4e00\u8bb2\uff0c\u6211\u4e3a\u4f60\u8bb2\u89e3\u4e86\u8ba1\u7b97\u673a\u91cc\u5404\u4e2a\u4e0d\u540c\u7684\u7ec4\u4ef6\u4e4b\u95f4\u7528\u6765\u901a\u4fe1\u7684\u6e20\u9053\uff0c\u4e5f\u5c31\u662f\u603b\u7ebf\u3002\u603b\u7ebf\u7684\u8bbe\u8ba1\u601d\u8def\uff0c\u6838\u5fc3\u662f\u4e3a\u4e86\u51cf\u5c11\u591a\u4e2a\u6a21\u5757\u4e4b\u95f4\u4ea4\u4e92\u7684\u590d\u6742\u6027\u548c\u8026\u5408\u5ea6\u3002\u5b9e\u9645\u4e0a\uff0c\u603b\u7ebf\u8fd9\u4e2a\u8bbe\u8ba1\u601d\u8def\u5728\u6211\u4eec\u7684\u8f6f\u4ef6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4e5f\u7ecf\u5e38\u4f1a\u88ab\u7528\u5230\u3002\u4e8b\u4ef6\u603b\u7ebf\u5c31\u662f\u6211\u4eec\u5e38\u89c1\u7684\u4e00\u4e2a\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u901a\u5e38\u4e8b\u4ef6\u603b\u7ebf\u4e5f\u4f1a\u548c\u8ba2\u9605\u8005\u53d1\u5e03\u8005\u6a21\u5f0f\u7ed3\u5408\u8d77\u6765\uff0c\u6210\u4e3a\u5927\u578b\u7cfb\u7edf\u7684\u5404\u4e2a\u677e\u8026\u5408\u7684\u6a21\u5757\u4e4b\u95f4\u4ea4\u4e92\u7684\u4e00\u79cd\u4e3b\u8981\u6a21\u5f0f\u3002\u5728\u5b9e\u9645\u7684\u786c\u4ef6\u5c42\u9762\uff0c\u603b\u7ebf\u5176\u5b9e\u5c31\u662f\u4e00\u7ec4\u8fde\u63a5\u7535\u8def\u7684\u7ebf\u8def\u3002\u56e0\u4e3a\u4e0d\u540c\u8bbe\u5907\u4e4b\u95f4\u7684\u901f\u5ea6\u6709\u5dee\u5f02\uff0c\u6240\u4ee5\u4e00\u53f0\u8ba1\u7b97\u673a\u91cc\u9762\u5f80\u5f80\u4f1a\u6709\u591a\u4e2a\u603b\u7ebf\u3002\u5e38\u89c1\u7684\u5c31\u6709\u5728 CPU \u5185\u90e8\u548c\u9ad8\u901f\u7f13\u5b58\u901a\u4fe1\u7684\u672c\u5730\u603b\u7ebf\uff0c\u4ee5\u53ca\u548c\u5916\u90e8 I/O \u8bbe\u5907\u4ee5\u53ca\u5185\u5b58\u901a\u4fe1\u7684\u524d\u7aef\u603b\u7ebf\u3002\u524d\u7aef\u603b\u7ebf\u901a\u5e38\u4e5f\u88ab\u53eb\u4f5c\u7cfb\u7edf\u603b\u7ebf\u3002\u5b83\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a I/O \u6865\u63a5\u5668\uff0c\u62c6\u5206\u6210\u4e24\u4e2a\u603b\u7ebf\uff0c\u5206\u522b\u6765\u548c I/O \u8bbe\u5907\u4ee5\u53ca\u5185\u5b58\u901a\u4fe1\u3002\u81ea\u7136\uff0c\u8fd9\u6837\u62c6\u5f00\u7684\u4e24\u4e2a\u603b\u7ebf\uff0c\u5c31\u53eb\u4f5c I/O \u603b\u7ebf\u548c\u5185\u5b58\u603b\u7ebf\u3002\u603b\u7ebf\u672c\u8eab\u7684\u7535\u8def\u529f\u80fd\uff0c\u53c8\u53ef\u4ee5\u62c6\u5206\u6210\u7528\u6765\u4f20\u8f93\u6570\u636e\u7684\u6570\u636e\u7ebf\u3001\u7528\u6765\u4f20\u8f93\u5730\u5740\u7684\u5730\u5740\u7ebf\uff0c\u4ee5\u53ca\u7528\u6765\u4f20\u8f93\u63a7\u5236\u4fe1\u53f7\u7684\u63a7\u5236\u7ebf\u3002\u603b\u7ebf\u662f\u4e00\u4e2a\u5404\u4e2a\u63a5\u5165\u7684\u8bbe\u5907\u516c\u7528\u7684\u7ebf\u8def\uff0c\u6240\u4ee5\u81ea\u7136\u4f1a\u5728\u5404\u4e2a\u8bbe\u5907\u4e4b\u95f4\u4e89\u593a\u603b\u7ebf\u6240\u6709\u6743\u7684\u60c5\u51b5\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u673a\u5236\u6765\u51b3\u5b9a\u8ba9\u8c01\u6765\u4f7f\u7528\u603b\u7ebf\uff0c\u8fd9\u4e2a\u51b3\u7b56\u673a\u5236\u5c31\u662f\u603b\u7ebf\u88c1\u51b3\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_26","title":"\u6765\u7531","text":"<p>\u8ba9\u8ba1\u7b97\u673a\u91cc\u9762\u7684\u5404\u4e2a\u786c\u4ef6\u8bbe\u5907\uff08CPU\u3001\u5185\u5b58\u3001\u5404\u79cdIO\u8bbe\u5907\uff09\u8fdb\u884c\u901a\u4fe1\uff1a</p> <ul> <li> <p>\u5404\u4e2a\u8bbe\u5907\u90fd\u4e92\u76f8\u901a\u4fe1\uff0c\u5f88\u590d\u6742\uff1a\u590d\u6742\u5ea6\u4e3a O(N<sup>2</sup>)</p> </li> <li> <p>\u6539\u8fdb\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u516c\u7528\u7684\u7ebf\u8def\uff1abus\uff08\u516c\u4ea4\u8f66\u8fd9\u4e2a\u610f\u601d\u5f88\u5f62\u8c61\uff09\uff1a</p> <ul> <li> <p>CPU \u60f3\u8981\u548c\u4ec0\u4e48\u8bbe\u5907\u901a\u4fe1\uff0c\u901a\u4fe1\u7684\u6307\u4ee4\u662f\u4ec0\u4e48\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u662f\u4ec0\u4e48\uff0c\u90fd\u53d1\u9001\u5230\u8fd9\u4e2a\u7ebf\u8def\u4e0a\uff1b\u8bbe\u5907\u8981\u5411 CPU \u53d1\u9001\u7684\u4fe1\u606f\u4e5f\u53d1\u9001\u5230\u8fd9\u4e2a\u7ebf\u8def\u4e0a\u3002</p> <p></p> </li> </ul> </li> <li> <p>\u5bf9\u5e94\u7684\u8bbe\u8ba1\u601d\u8def\uff1a</p> <ul> <li> <p>\u6211\u4eec\u5728\u505a\u5927\u578b\u7cfb\u7edf\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u7528\u5230\u4e00\u79cd\u53eb\u4f5c\u4e8b\u4ef6\u603b\u7ebf\uff08Event Bus\uff09\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002</p> <p>\u5728\u4e8b\u4ef6\u603b\u7ebf\u8fd9\u4e2a\u8bbe\u8ba1\u6a21\u5f0f\u91cc\uff0c\u5404\u4e2a\u6a21\u5757\u89e6\u53d1\u5bf9\u5e94\u7684\u4e8b\u4ef6\uff0c\u5e76\u628a\u4e8b\u4ef6\u5bf9\u8c61\u53d1\u9001\u5230\u603b\u7ebf\u4e0a\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u6a21\u5757\u90fd\u662f\u4e00\u4e2a\u53d1\u5e03\u8005\uff08Publisher\uff09\u3002\u800c\u5404\u4e2a\u6a21\u5757\u4e5f\u4f1a\u628a\u81ea\u5df1\u6ce8\u518c\u5230\u603b\u7ebf\u4e0a\uff0c\u53bb\u76d1\u542c\u603b\u7ebf\u4e0a\u7684\u4e8b\u4ef6\uff0c\u5e76\u6839\u636e\u4e8b\u4ef6\u7684\u5bf9\u8c61\u7c7b\u578b\u6216\u8005\u662f\u5bf9\u8c61\u5185\u5bb9\uff0c\u6765\u51b3\u5b9a\u81ea\u5df1\u662f\u5426\u8981\u8fdb\u884c\u7279\u5b9a\u7684\u5904\u7406\u6216\u8005\u54cd\u5e94\u3002</p> <p>\u8fd9\u6837\u5b50\u603b\u7ebf\u4e0a\u7684\u5404\u4e2a\u6a21\u5757\u5c31\u662f\u677e\u8026\u5408\u7684\u3002\u6a21\u5757\u4e92\u76f8\u4e4b\u95f4\u5e76\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\u3002\u65e0\u8bba\u4ee3\u7801\u7684\u7ef4\u62a4\uff0c\u8fd8\u662f\u672a\u6765\u7684\u6269\u5c55\uff0c\u90fd\u4f1a\u5f88\u65b9\u4fbf\u3002</p> </li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_27","title":"\u4e09\u79cd\u7ebf\u8def\u548c\u591a\u603b\u7ebf\u67b6\u6784","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_28","title":"\u591a\u603b\u7ebf\u67b6\u6784","text":"<p>\u73b0\u4ee3CPU\u91cc\u6709\u591a\u6761\u603b\u7ebf\uff0c\u9996\u5148CPU\u548c\u5185\u5b58\u548c\u9ad8\u901f\u7f13\u5b58\u4e4b\u95f4\uff1a\u53cc\u72ec\u7acb\u603b\u7ebf\uff1a</p> <ul> <li> <p>\u672c\u5730\u603b\u7ebf\uff08Local Bus\uff09\uff1a\u901f\u5ea6\u5feb</p> <p>\u7528\u4e8eCPU\u548c\u524d\u9762\u8bb2\u7684\u9ad8\u901f\u7f13\u5b58\u901a\u4fe1</p> </li> <li> <p>\u524d\u7aef\u603b\u7ebf\uff08Front-side Bus\uff09\uff1a\u901f\u5ea6\u76f8\u5bf9\u6162</p> <p>\u7528\u6765\u548c\u4e3b\u5185\u5b58\u4ee5\u53ca\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u901a\u4fe1\uff0c\u6545\u524d\u7aef\u603b\u7ebf\u4e5f\u6709\u5f88\u591a\u522b\u540d\uff1a\u5904\u7406\u5668\u603b\u7ebf\uff08Processor Bus\uff09\u3001\u5185\u5b58\u603b\u7ebf\uff08Mmeory Bus\uff09</p> </li> </ul> <p>\u7531\u4e8e\u73b0\u4ee3CPU\u4e00\u4e9b\u603b\u7ebf\u540d\u8bcd\u6df7\u4e71\uff0c\u8fd9\u91cc\u8fdb\u4e00\u6b65\u603b\u7ed3CPU\u7684\u603b\u7ebf\uff1a</p> <ul> <li>\u524d\u7aef\u603b\u7ebf\uff1a\u5b9e\u9645\u4e3a\u7cfb\u7edf\u603b\u7ebf<ul> <li>CPU\u91cc\u7684\u5185\u5b58\u63a5\u53e3\uff0c\u5185\u5b58\u63a7\u5236\u5668\uff08memory controller\uff09\u548c\u7cfb\u7edf\u603b\u7ebf\u76f8\u8fde\uff1b</li> <li>\u7136\u540e\u7cfb\u7edf\u603b\u7ebf\u518d\u63a5 I/O \u6865\u63a5\u5668\uff1b</li> <li>I/O \u6865\u63a5\u5668\u4e00\u8fb9\u63a5\u5165\u901a\u8fc7\u5185\u5b58\u603b\u7ebf\u548c\u5185\u5b58\u76f8\u8fde\uff0c\u53e6\u4e00\u8fb9\u63a5\u5165 I/O\u603b\u7ebf\uff0c\u8fde\u63a5 I/O\u8bbe\u5907\u3002</li> </ul> </li> </ul> <p>\u5b9e\u9645\u66f4\u590d\u6742\uff1a\u8fd8\u6709 PCI \u603b\u7ebf\u3001ISA \u603b\u7ebf...</p> <p>PCI\uff08Peripheral Component Interconnect\uff09\u603b\u7ebf\u662f\u4e00\u79cd\u7528\u4e8e\u8fde\u63a5\u8ba1\u7b97\u673a\u5185\u90e8\u5404\u79cd\u8bbe\u5907\u7684\u6807\u51c6\u603b\u7ebf\uff0c\u5b83\u63d0\u4f9b\u4e86\u9ad8\u5e26\u5bbd\u548c\u7075\u6d3b\u6027\uff0c\u652f\u6301\u70ed\u63d2\u62d4\u548c\u5373\u63d2\u5373\u7528\u529f\u80fd\u3002PCI \u603b\u7ebf\u901a\u5e38\u7528\u4e8e\u8fde\u63a5\u663e\u5361\u3001\u7f51\u5361\u3001\u58f0\u5361\u7b49\u5916\u90e8\u8bbe\u5907\uff0c\u4ee5\u53ca\u4e00\u4e9b\u5185\u90e8\u8bbe\u5907\u5982\u786c\u76d8\u63a7\u5236\u5668\u3001USB \u63a7\u5236\u5668\u7b49\u3002</p> <p></p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_29","title":"\u4e09\u79cd\u7ebf\u8def","text":"<p>\u5728\u7269\u7406\u5c42\u9762\uff0c\u5176\u5b9e\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a\u603b\u7ebf\u770b\u4f5c\u4e00\u7ec4\u201c\u7535\u7ebf\u201d\u3002\u4e0d\u8fc7\u5462\uff0c\u8fd9\u4e9b\u7535\u7ebf\u4e4b\u95f4\u4e5f\u662f\u6709\u5206\u5de5\u7684\uff0c\u6211\u4eec\u901a\u5e38\u6709\u4e09\u7c7b\u7ebf\u8def\u3002</p> <ul> <li>\u6570\u636e\u603b\u7ebf\uff08Data Bus\uff09\uff0c\u7528\u6765\u4f20\u8f93\u5b9e\u9645\u7684\u6570\u636e\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u5b9e\u9645\u4e0a\u4e86\u516c\u4ea4\u8f66\u7684\u201c\u4eba\u201d\u3002</li> <li>\u5730\u5740\u603b\u7ebf\uff08Address Bus\uff09\uff0c\u7528\u6765\u786e\u5b9a\u5230\u5e95\u628a\u6570\u636e\u4f20\u8f93\u5230\u54ea\u91cc\u53bb\uff0c\u662f\u5185\u5b58\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u8fd8\u662f\u67d0\u4e00\u4e2a I/O \u8bbe\u5907\u3002\u8fd9\u4e2a\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u62ff\u4e86\u4e2a\u7eb8\u6761\uff0c\u5199\u4e0b\u4e86\u4e0a\u9762\u7684\u4eba\u8981\u4e0b\u8f66\u7684\u7ad9\u70b9\u3002</li> <li>\u63a7\u5236\u603b\u7ebf\uff08Control Bus\uff09\uff0c\u7528\u6765\u63a7\u5236\u5bf9\u4e8e\u603b\u7ebf\u7684\u8bbf\u95ee\u3002\u867d\u7136\u6211\u4eec\u628a\u603b\u7ebf\u6bd4\u55bb\u6210\u4e86\u4e00\u8f86\u516c\u4ea4\u8f66\u3002\u90a3\u4e48\u6709\u4eba\u60f3\u8981\u505a\u516c\u4ea4\u8f66\u7684\u65f6\u5019\uff0c\u9700\u8981\u544a\u8bc9\u516c\u4ea4\u8f66\u53f8\u673a\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u7684\u63a7\u5236\u4fe1\u53f7\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#bus-arbitraction","title":"\u603b\u7ebf\u88c1\u51b3\uff08Bus Arbitraction\uff09","text":"<p>\u5c3d\u7ba1\u603b\u7ebf\u51cf\u5c11\u4e86\u8bbe\u5907\u4e4b\u95f4\u7684\u8026\u5408\uff0c\u4e5f\u964d\u4f4e\u4e86\u7cfb\u7edf\u8bbe\u8ba1\u7684\u590d\u6742\u5ea6\uff0c</p> <p>\u4f46\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u4e00\u4e2a\u65b0\u95ee\u9898\uff0c\u90a3\u5c31\u662f \u603b\u7ebf\u4e0d\u80fd\u540c\u65f6\u7ed9\u591a\u4e2a\u8bbe\u5907\u63d0\u4f9b\u901a\u4fe1\u529f\u80fd\u3002</p> <p>\u6211\u4eec\u7684\u603b\u7ebf\u662f\u5f88\u591a\u4e2a\u8bbe\u5907\u516c\u7528\u7684\uff0c\u90a3\u591a\u4e2a\u8bbe\u5907\u90fd\u60f3\u8981\u7528\u603b\u7ebf\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u673a\u5236\uff0c\u53bb\u51b3\u5b9a\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5230\u5e95\u628a\u603b\u7ebf\u7ed9\u54ea\u4e00\u4e2a\u8bbe\u5907\u7528\u3002\u8fd9\u4e2a\u673a\u5236\uff0c\u5c31\u53eb\u4f5c\u603b\u7ebf\u88c1\u51b3\uff08Bus Arbitraction\uff09\u3002\u603b\u7ebf\u88c1\u51b3\u7684\u4e0d\u540c\u673a\u5236\u5b9e\u73b0\uff1a\u88c1\u51b3\u5668Arbiter (electronics) - Wikipedia</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_30","title":"\u63a8\u8350\u9605\u8bfb","text":"<ul> <li> <p>\u603b\u7ebf\u662f\u4e00\u4e2a\u62bd\u8c61\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5b83\u4e0d\u4ec5\u5728\u6211\u4eec\u8ba1\u7b97\u673a\u7684\u786c\u4ef6\u8bbe\u8ba1\u91cc\u51fa\u73b0\u3002\u5728\u65e5\u5e38\u7684\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u4e5f\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f60\u53ef\u4ee5\u53bb\u8bfb\u4e00\u8bfb Google \u5f00\u6e90\u7684 Java \u7684\u4e00\u4e2a\u5e38\u7528\u7684\u5de5\u5177\u5e93 EventBusExplained \u00b7 google/guava Wiki \u00b7 GitHub\u7684\u76f8\u5173\u8d44\u6599\u548c\u4ee3\u7801\uff0c\u8fdb\u4e00\u6b65\u7406\u89e3\u4e8b\u4ef6\u603b\u7ebf\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u770b\u770b\u5728\u8f6f\u4ef6\u5c42\u9762\u600e\u4e48\u5b9e\u73b0\u5b83\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u8ba1\u7b97\u673a\u786c\u4ef6\u5c42\u9762\u7684\u603b\u7ebf\uff0c\u5f88\u591a\u6559\u79d1\u4e66\u91cc\u8bb2\u5f97\u90fd\u6bd4\u8f83\u5c11\uff0c\u4f60\u53ef\u4ee5\u53bb\u8bfb\u4e00\u8bfb Wiki \u91cc\u9762</p> <p>\u603b\u7ebf\u548c\u7cfb\u7edf\u603b\u7ebf-System bus - Wikipedia\u7684\u76f8\u5173\u6761\u76ee\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_31","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>2008 \u5e74\u4e4b\u540e\uff0c\u6211\u4eec\u7684 Intel CPU \u5176\u5b9e\u5df2\u7ecf\u6ca1\u6709\u524d\u7aef\u603b\u7ebf\u4e86\u3002</p> <p>Intel \u53d1\u660e\u4e86\u5feb\u901f\u901a\u9053\u4e92\u8054-Intel QuickPath Interconnect - Wikipedia\uff08Intel Quick Path Interconnect\uff0c\u7b80\u79f0\u4e3a QPI\uff09\u6280\u672f\uff0c\u66ff\u4ee3\u4e86\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u3002\u8fd9\u4e2a QPI \u6280\u672f\uff0c\u4f60\u53ef\u4ee5\u641c\u7d22\u548c\u7ffb\u9605\u4e00\u4e0b\u76f8\u5173\u8d44\u6599\uff0c\u4e86\u89e3\u4e00\u4e0b\u5b83\u5f15\u5165\u4e86\u4ec0\u4e48\u65b0\u7684\u8bbe\u8ba1\u7406\u5ff5\u3002</p> <p>Intel QuickPath Interconnect (QPI)\u6280\u672f\u662f\u82f1\u7279\u5c14\u57282008\u5e74\u5f00\u59cb\u4f7f\u7528\u7684\u4e00\u79cd\u70b9\u5bf9\u70b9\u5904\u7406\u5668\u4e92\u8fde\u6280\u672f\uff0c\u7528\u6765\u66ff\u4ee3\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u3002QPI\u5f15\u5165\u4e86\u4e00\u4e9b\u65b0\u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u5176\u4e2d\u4e00\u4e9b\u5173\u952e\u7684\u65b9\u9762\u5305\u62ec\uff1a</p> <ol> <li>\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\uff1a\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u662f\u4e00\u79cd\u5171\u4eab\u603b\u7ebf\u7ed3\u6784\uff0c\u591a\u4e2a\u7ec4\u4ef6\u9700\u8981\u901a\u8fc7\u540c\u4e00\u6761\u603b\u7ebf\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u62e5\u5835\u548c\u6027\u80fd\u74f6\u9888\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5982\u679c\u591a\u4e2a\u7ec4\u4ef6\u540c\u65f6\u8bd5\u56fe\u901a\u8fc7\u524d\u7aef\u603b\u7ebf\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7ade\u4e89\u548c\u5ef6\u8fdf\u3002\u800cQPI\u91c7\u7528\u4e86\u70b9\u5bf9\u70b9\u8fde\u63a5\uff0c\u5904\u7406\u5668\u4e4b\u95f4\u53ef\u4ee5\u76f4\u63a5\u901a\u4fe1\uff0c\u907f\u514d\u4e86\u5171\u4eab\u603b\u7ebf\u7684\u74f6\u9888\uff0c\u63d0\u9ad8\u4e86\u6570\u636e\u4f20\u8f93\u6548\u7387\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u5728\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e2d\u53ef\u80fd\u4f1a\u9047\u5230\u6269\u5c55\u6027\u53d7\u9650\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6240\u6709\u5904\u7406\u5668\u90fd\u8981\u901a\u8fc7\u540c\u4e00\u6761\u603b\u7ebf\u8fdb\u884c\u901a\u4fe1\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5982\u679c\u7cfb\u7edf\u9700\u8981\u589e\u52a0\u66f4\u591a\u7684\u5904\u7406\u5668\uff0c\u524d\u7aef\u603b\u7ebf\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u66f4\u591a\u5904\u7406\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u9700\u6c42\u3002\u800cQPI\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u53ef\u6269\u5c55\u6027\uff0c\u80fd\u591f\u652f\u6301\u66f4\u591a\u5904\u7406\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u548c\u534f\u4f5c\uff0c\u4f7f\u5f97\u591a\u5904\u7406\u5668\u7cfb\u7edf\u80fd\u591f\u66f4\u6709\u6548\u5730\u6269\u5c55\u548c\u5de5\u4f5c\u3002</li> <li>\u5e26\u5bbd\u548c\u6027\u80fd\uff1a\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u7684\u5e26\u5bbd\u53d7\u9650\uff0c\u56e0\u4e3a\u6240\u6709\u7ec4\u4ef6\u90fd\u8981\u901a\u8fc7\u540c\u4e00\u6761\u603b\u7ebf\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5373\u4f7f\u603b\u7ebf\u7684\u5e26\u5bbd\u5f88\u9ad8\uff0c\u4f46\u662f\u5f53\u591a\u4e2a\u7ec4\u4ef6\u540c\u65f6\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u65f6\uff0c\u4ecd\u7136\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u74f6\u9888\u3002\u800cQPI\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u6570\u636e\u4f20\u8f93\u5e26\u5bbd\uff0c\u5904\u7406\u5668\u4e4b\u95f4\u80fd\u591f\u66f4\u5feb\u5730\u4ea4\u6362\u6570\u636e\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u6574\u4f53\u7684\u6027\u80fd\u3002</li> </ol> <p>\u73b0\u4ee3CPU\u7684\u5185\u90e8\u5927\u591a\u4f7f\u7528\u57fa\u4e8eQPI\u6216\u7c7b\u4f3c\u6280\u672f\u7684\u70b9\u5bf9\u70b9\u4e92\u8fde\u6280\u672f\uff0c\u8fd9\u79cd\u6280\u672f\u53ef\u4ee5\u66f4\u597d\u5730\u6ee1\u8db3\u591a\u6838\u5904\u7406\u5668\u7684\u9ad8\u901f\u6570\u636e\u4f20\u8f93\u9700\u6c42\u3002\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u5df2\u7ecf\u9010\u6e10\u88ab\u6dd8\u6c70\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u6ee1\u8db3\u73b0\u4ee3CPU\u5bf9\u4e8e\u66f4\u9ad8\u5e26\u5bbd\u3001\u66f4\u597d\u53ef\u6269\u5c55\u6027\u548c\u66f4\u9ad8\u6027\u80fd\u7684\u9700\u6c42\u3002</p> <p>\u8fdb\u4e00\u6b65\u8be2\u95ee\uff1a</p> <ol> <li> <p>\u70b9\u5bf9\u70b9\u8fde\u63a5\u5177\u4f53\u4f8b\u5b50\uff1a</p> <p>\u4e3e\u4f8b\u6765\u8bf4\u660eQPI\u7684\u70b9\u5bf9\u70b9\u8fde\u63a5\uff1a\u60f3\u8c61\u4e00\u4e0b\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u5c31\u50cf\u662f\u4e00\u6761\u72ed\u7a84\u7684\u5355\u884c\u9053\uff0c\u6240\u6709\u7684\u8f66\u8f86\u90fd\u5fc5\u987b\u5171\u7528\u8fd9\u6761\u9053\u8def\uff0c\u5bb9\u6613\u9020\u6210\u4ea4\u901a\u62e5\u5835\u3002\u800cQPI\u7684\u70b9\u5bf9\u70b9\u8fde\u63a5\u5c31\u50cf\u662f\u57ce\u5e02\u4e2d\u7684\u591a\u6761\u5bbd\u655e\u7684\u9ad8\u901f\u516c\u8def\uff0c\u6bcf\u8f86\u8f66\u90fd\u53ef\u4ee5\u76f4\u63a5\u5230\u8fbe\u76ee\u7684\u5730\uff0c\u907f\u514d\u4e86\u4ea4\u901a\u62e5\u5835\uff0c\u63d0\u9ad8\u4e86\u4ea4\u901a\u6548\u7387\u3002</p> </li> <li> <p>\u7cfb\u7edf\u9700\u8981\u589e\u52a0\u66f4\u591a\u7684\u5904\u7406\u5668\uff0c\u524d\u7aef\u603b\u7ebf\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u66f4\u591a\u5904\u7406\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u9700\u6c42\u6307\u7684\u662f\u591a\u6838CPU\u5417</p> <p>\u662f\u7684\uff0c\u5f53\u7cfb\u7edf\u9700\u8981\u589e\u52a0\u66f4\u591a\u7684\u5904\u7406\u5668\u65f6\uff0c\u5c31\u4f1a\u6d89\u53ca\u5230\u591a\u4e2aCPU\u6838\u5fc3\u3002\u5728\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u7ed3\u6784\u4e2d\uff0c\u968f\u7740\u5904\u7406\u5668\u6570\u91cf\u7684\u589e\u52a0\uff0c\u6240\u6709\u5904\u7406\u5668\u90fd\u5fc5\u987b\u901a\u8fc7\u540c\u4e00\u6761\u603b\u7ebf\u8fdb\u884c\u901a\u4fe1\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u901a\u4fe1\u74f6\u9888\u548c\u6027\u80fd\u4e0b\u964d\u3002\u800c\u91c7\u7528QPI\u7b49\u70b9\u5bf9\u70b9\u8fde\u63a5\u6280\u672f\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u652f\u6301\u591a\u4e2a\u5904\u7406\u5668\u4e4b\u95f4\u7684\u76f4\u63a5\u901a\u4fe1\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u53ef\u6269\u5c55\u6027\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48QPI\u80fd\u63d0\u4f9b\u66f4\u9ad8\u7684\u6570\u636e\u4f20\u8f93\u5e26\u5bbd\uff1f</p> <p>QPI\u80fd\u63d0\u4f9b\u66f4\u9ad8\u7684\u6570\u636e\u4f20\u8f93\u5e26\u5bbd\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u91c7\u7528\u4e86\u9ad8\u901f\u7684\u4e32\u884c\u8fde\u63a5\u6280\u672f\u3002\u4f20\u7edf\u7684\u524d\u7aef\u603b\u7ebf\u901a\u5e38\u91c7\u7528\u5e76\u884c\u6570\u636e\u4f20\u8f93\uff0c\u968f\u7740\u603b\u7ebf\u5bbd\u5ea6\u7684\u589e\u52a0\uff0c\u6210\u672c\u548c\u590d\u6742\u5ea6\u4e5f\u968f\u4e4b\u589e\u52a0\u3002\u800cQPI\u91c7\u7528\u4e86\u4e32\u884c\u8fde\u63a5\uff0c\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u5b9e\u73b0\u9ad8\u901f\u6570\u636e\u4f20\u8f93\uff0c\u540c\u65f6\u4e5f\u66f4\u5bb9\u6613\u6269\u5c55\u5230\u66f4\u9ad8\u7684\u5e26\u5bbd\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u6570\u636e\u4f20\u8f93\u6548\u7387\u548c\u7cfb\u7edf\u6574\u4f53\u6027\u80fd\u3002</p> <p>\uff08\u8fd9\u4e5f\u53cd\u6620\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u540c\u7b49\u6761\u4ef6\u4e0b\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4e32\u884c\u901a\u4fe1\u8981\u6bd4\u5e76\u884c\u901a\u4fe1\u8981\u5feb\uff09</p> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#43-01","title":"43 | \u8f93\u5165\u8f93\u51fa\u8bbe\u5907\uff1a\u6211\u4eec\u5e76\u4e0d\u662f\u53ea\u80fd\u7528\u706f\u6ce1\u663e\u793a\u201c0\u201d\u548c\u201c1\u201d","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_32","title":"\u63a5\u53e3\u548c\u8bbe\u5907","text":"<p>\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u5e76\u4e0d\u662f\u4e00\u4e2a\u8bbe\u5907\uff0c\u5927\u90e8\u5206\u7684 I/O \u8bbe\u5907\u7531\u4e24\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a</p> <ul> <li>\u63a5\u53e3\uff08interface\uff09</li> <li>\u5b9e\u9645\u7684 I/O \u8bbe\u5907 \uff08Actual I/O Device\uff09</li> </ul> <p>\u786c\u4ef6\u8bbe\u5907\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u76f4\u63a5\u63a5\u5165\u5230\u603b\u7ebf\u4e0a\u548cCPU\u8fdb\u884c\u901a\u4fe1\u7684\uff0c\u800c\u662f\u901a\u8fc7\u63a5\u53e3\uff0c\u7528\u63a5\u53e3\u8fde\u63a5\u5230\u603b\u7ebf\u4e0a\uff0c\u518d\u901a\u8fc7\u603b\u7ebf\u548cCPU\u901a\u4fe1</p> <p></p> <p>SATA \u786c\u76d8\uff0c\u6574\u4e2a\u7eff\u8272\u7535\u8def\u677f\u548c\u9ec4\u8272\u7684\u9f7f\u72b6\u90e8\u5206\u5c31\u662f\u63a5\u53e3\u7535\u8def\uff0c\u9ec4\u8272\u9f7f\u72b6\u7684\u5c31\u662f\u548c\u4e3b\u677f\u5bf9\u63a5\u7684\u63a5\u53e3\uff0c\u7eff\u8272\u7684\u7535\u8def\u677f\u5c31\u662f\u63a7\u5236\u7535\u8def\u3002</p> <p>\u5e73\u65f6\u542c\u8bf4\u7684\u5e76\u884c\u63a5\u53e3\uff08Parallel Interface\uff09\u3001\u4e32\u884c\u63a5\u53e3\uff08Serial Interface\uff09\u3001USB \u63a5\u53e3\uff0c\u90fd\u662f==\u8ba1\u7b97\u673a\u4e3b\u677f==\u4e0a\u5185\u7f6e\u7684\u5404\u4e2a\u63a5\u53e3\u3002</p> <p>\u6211\u4eec\u7684\u5b9e\u9645\u786c\u4ef6\u8bbe\u5907\uff0c\u6bd4\u5982\uff0c\u4f7f\u7528\u5e76\u53e3\u7684\u6253\u5370\u673a\u3001\u4f7f\u7528\u4e32\u53e3\u7684\u8001\u5f0f\u9f20\u6807\u6216\u8005\u4f7f\u7528 USB \u63a5\u53e3\u7684 U \u76d8\uff0c\u90fd\u8981\u63d2\u5165\u5230\u8fd9\u4e9b\u63a5\u53e3\u4e0a\uff0c\u624d\u80fd\u548c CPU \u5de5\u4f5c\u4ee5\u53ca\u901a\u4fe1\u7684\u3002</p> <p>\u63a5\u53e3\u672c\u8eab\u5c31\u662f\u4e00\u5757\u7535\u8def\u677f\u3002CPU \u5176\u5b9e\u4e0d\u662f\u548c\u5b9e\u9645\u7684\u786c\u4ef6\u8bbe\u5907\u6253\u4ea4\u9053\uff0c\u800c\u662f\u548c\u8fd9\u4e2a\u63a5\u53e3\u7535\u8def\u677f\u6253\u4ea4\u9053\u3002</p> <p>\u6211\u4eec\u5e73\u65f6\u8bf4\u7684\uff0c\u8bbe\u5907\u91cc\u9762\u7684\u4e09\u7c7b\u5bc4\u5b58\u5668\uff0c\u5176\u5b9e\u90fd\u5728\u8fd9\u4e2a\u8bbe\u5907\u7684\u63a5\u53e3\u7535\u8def\u4e0a\uff0c\u800c\u4e0d\u5728\u5b9e\u9645\u7684\u8bbe\u5907\u4e0a\u3002\uff1a</p> <ul> <li>\u72b6\u6001\u5bc4\u5b58\u5668\uff08Status Register\uff09</li> <li>\u547d\u4ee4\u5bc4\u5b58\u5668\uff08Command Register\uff09</li> <li>\u6570\u636e\u5bc4\u5b58\u5668\uff08Data Register\uff09</li> </ul> <p>\u4e0a\u4e16\u7eaa 90 \u5e74\u4ee3\u7684\u65f6\u5019\uff0c\u5927\u5bb6\u7528\u7684\u786c\u76d8\u90fd\u53eb\u4f5c IDE \u786c\u76d8\u3002</p> <p>\u8fd9\u4e2a IDE \u4e0d\u662f\u50cf IntelliJ \u6216\u8005 WebStorm \u8fd9\u6837\u7684\u8f6f\u4ef6\u5f00\u53d1\u96c6\u6210\u73af\u5883\uff08Integrated Development Environment\uff09\u7684 IDE\uff0c\u800c\u662f\u4ee3\u8868\u7740\u96c6\u6210\u8bbe\u5907\u7535\u8def\uff08Integrated Device Electronics\uff09\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bbe\u5907\u7684\u63a5\u53e3\u7535\u8def\u76f4\u63a5\u5728\u8bbe\u5907\u4e0a\uff0c\u800c\u4e0d\u5728\u4e3b\u677f\u4e0a\u3002\u6211\u4eec\u9700\u8981\u901a\u8fc7\u4e00\u4e2a\u7ebf\u7f06\uff0c\u628a\u96c6\u6210\u4e86\u63a5\u53e3\u7684\u8bbe\u5907\u8fde\u63a5\u5230\u4e3b\u677f\u4e0a\u53bb\u3002</p> <p>\u628a\u63a5\u53e3\u548c\u5b9e\u9645\u8bbe\u5907\u5206\u79bb\uff0c\u8fd9\u4e2a\u505a\u6cd5\u5b9e\u9645\u4e0a\u6765\u81ea\u4e8e\u8ba1\u7b97\u673a\u8d70\u5411\u5f00\u653e\u67b6\u6784\uff08Open Architecture\uff09\u7684\u65f6\u4ee3\u3002</p> <p>\u5f53\u6211\u4eec\u8981\u5bf9\u8ba1\u7b97\u673a\u5347\u7ea7\uff0c\u6211\u4eec\u4e0d\u4f1a\u6254\u6389\u65e7\u7684\u8ba1\u7b97\u673a\uff0c\u76f4\u63a5\u4e70\u4e00\u53f0\u5168\u65b0\u7684\u8ba1\u7b97\u673a\uff0c\u800c\u662f\u53ef\u4ee5\u5355\u72ec\u5347\u7ea7\u786c\u76d8\u8fd9\u6837\u7684\u8bbe\u5907\uff0c\u5373\u4e70\u65b0\u7684\u786c\u76d8\u66ff\u6362\u6389\u5c31\u5f97\u5c31\u884c\u3002</p> <p>\u5404\u79cd\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684\u5236\u9020\u5546\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u63a5\u53e3\u7684\u63a7\u5236\u534f\u8bae\uff0c\u6765\u8bbe\u8ba1\u548c\u5236\u9020\u786c\u76d8\u3001\u9f20\u6807\u3001\u952e\u76d8\u3001\u6253\u5370\u673a\u4e43\u81f3\u5176\u4ed6\u79cd\u79cd\u5916\u8bbe\u3002\u6b63\u662f\u8fd9\u6837\u7684\u5206\u5de5\u534f\u4f5c\uff0c\u5e26\u6765\u4e86 PC \u65f6\u4ee3\u7684\u7e41\u8363\u3002</p> <p>\u5176\u5b9e\uff0c\u5728\u8f6f\u4ef6\u7684\u8bbe\u8ba1\u6a21\u5f0f\u91cc\u4e5f\u6709\u8fd9\u6837\u7684\u601d\u8def\u3002\u9762\u5411\u5bf9\u8c61\u91cc\u7684\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\u7684\u63a5\u53e3\uff0c\u5c31\u662f Interface\u3002</p> <p>\u5982\u679c\u4f60\u505a iOS \u7684\u5f00\u53d1\uff0cObjective-C \u91cc\u9762\u7684 Protocol \u5176\u5b9e\u4e5f\u662f\u8fd9\u4e2a\u610f\u601d\u3002</p> <p>\u800c Adaptor \u8bbe\u8ba1\u6a21\u5f0f\uff0c\u66f4\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u3001\u7528\u6765\u89e3\u51b3\u4e0d\u540c\u5916\u90e8\u5e94\u7528\u548c\u7cfb\u7edf\u201c\u9002\u914d\u201d\u95ee\u9898\u7684\u65b9\u6848\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8ba1\u7b97\u673a\u7684\u8f6f\u4ef6\u548c\u786c\u4ef6\uff0c\u5728\u903b\u8f91\u62bd\u8c61\u4e0a\uff0c\u5176\u5b9e\u662f\u76f8\u901a\u7684\u3002\u5982\u679c\u4f60\u7528\u7684\u662f Windows \u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f60\u53ef\u4ee5\u6253\u5f00\u8bbe\u5907\u7ba1\u7406\u5668\uff0c\u91cc\u9762\u6709\u5404\u79cd\u5404\u79cd\u7684 Devices\uff08\u8bbe\u5907\uff09\u3001Controllers\uff08\u63a7\u5236\u5668\uff09\u3001Adaptors\uff08\u9002\u914d\u5668\uff09\u3002</p> <p>\u8fd9\u4e9b\u5176\u5b9e\u90fd\u662f\u5bf9\u4e8e\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u4e0d\u540c\u89d2\u5ea6\u7684\u63cf\u8ff0\u3002</p> <ul> <li> <p>\u53eb Devices\uff0c\u770b\u91cd\u7684\u662f\u5b9e\u9645\u7684 I/O \u8bbe\u5907\u672c\u8eab\u3002</p> </li> <li> <p>\u53eb Controllers\uff0c\u770b\u91cd\u7684\u662f\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u63a5\u53e3\u91cc\u9762\u7684\u63a7\u5236\u7535\u8def\u3002</p> </li> <li> <p>\u53eb Adaptors\uff0c\u5219\u662f\u770b\u91cd\u63a5\u53e3\u4f5c\u4e3a\u4e00\u4e2a\u9002\u914d\u5668\u540e\u9762\u53ef\u4ee5\u63d2\u4e0a\u4e0d\u540c\u7684\u5b9e\u9645\u8bbe\u5907\u3002</p> </li> </ul> <p>\u8fd9\u4e9b\u8bf4\u7684\u90fd\u662f\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684\u63a5\u53e3\u90e8\u5206</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#cpu-io","title":"CPU \u5982\u4f55\u63a7\u5236 I/O \u8bbe\u5907","text":"<p>\u65e0\u8bba\u662f\u5185\u7f6e\u5728\u4e3b\u677f\u4e0a\u7684\u63a5\u53e3\uff0c\u8fd8\u662f\u96c6\u6210\u5728\u8bbe\u5907\u4e0a\u7684\u63a5\u53e3\uff1a\u9664\u4e86\u6709\u4e09\u7c7b\u5bc4\u5b58\u5668\u4e4b\u5916\uff0c\u8fd8\u6709\u5bf9\u5e94\u7684\u63a7\u5236\u7535\u8def\u3002</p> <p>\u6b63\u662f\u901a\u8fc7\u8fd9\u4e2a\u63a7\u5236\u7535\u8def\uff0cCPU \u624d\u80fd\u901a\u8fc7\u5411\u8fd9\u4e2a\u63a5\u53e3\u7535\u8def\u677f\u4f20\u8f93\u4fe1\u53f7\uff0c\u6765\u63a7\u5236\u5b9e\u9645\u7684\u786c\u4ef6\u3002</p> <p></p> <p>\u5177\u4f53\u914d\u5408\u5bc4\u5b58\u5668\u4f5c\u7528\uff08\u4ee5\u6253\u5370\u673a\u4e3a\u4f8b\uff09\uff1a</p> <ol> <li> <p>\u9996\u5148\u6570\u636e\u5bc4\u5b58\u5668\uff08Data Register\uff09\u3002CPU \u5411 I/O \u8bbe\u5907\u5199\u5165\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e\uff0c\u6bd4\u5982\u8981\u6253\u5370\u7684\u5185\u5bb9\u662f\u201cGeekTime\u201d\uff0c\u6211\u4eec\u5c31\u8981\u5148\u53d1\u9001\u4e00\u4e2a\u201cG\u201d\u7ed9\u5230\u5bf9\u5e94\u7684 I/O \u8bbe\u5907\u3002</p> </li> <li> <p>\u7136\u540e\u662f\u547d\u4ee4\u5bc4\u5b58\u5668\uff08Command Register\uff09\u3002CPU \u53d1\u9001\u4e00\u4e2a\u547d\u4ee4\uff0c\u544a\u8bc9\u6253\u5370\u673a\uff0c\u8981\u8fdb\u884c\u6253\u5370\u5de5\u4f5c\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6253\u5370\u673a\u91cc\u9762\u7684\u63a7\u5236\u7535\u8def\u4f1a\u505a\u4e24\u4e2a\u52a8\u4f5c\u3002\u7b2c\u4e00\u4e2a\uff0c\u662f\u53bb\u8bbe\u7f6e\u6211\u4eec\u7684\u72b6\u6001\u5bc4\u5b58\u5668\u91cc\u9762\u7684\u72b6\u6001\uff0c\u628a\u72b6\u6001\u8bbe\u7f6e\u6210 not-ready\u3002\u7b2c\u4e8c\u4e2a\uff0c\u5c31\u662f\u5b9e\u9645\u64cd\u4f5c\u6253\u5370\u673a\u8fdb\u884c\u6253\u5370\u3002</p> </li> <li> <p>\u800c\u72b6\u6001\u5bc4\u5b58\u5668\uff08Status Register\uff09\uff0c\u5c31\u662f\u544a\u8bc9\u4e86\u6211\u4eec\u7684 CPU\uff0c\u73b0\u5728\u8bbe\u5907\u5df2\u7ecf\u5728\u5de5\u4f5c\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\uff0cCPU \u4f60\u518d\u53d1\u9001\u6570\u636e\u6216\u8005\u547d\u4ee4\u8fc7\u6765\uff0c\u90fd\u662f\u6ca1\u6709\u7528\u7684\u3002\u76f4\u5230\u524d\u9762\u7684\u52a8\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u72b6\u6001\u5bc4\u5b58\u5668\u91cd\u65b0\u53d8\u6210\u4e86 ready \u72b6\u6001\uff0c\u6211\u4eec\u7684 CPU \u624d\u80fd\u53d1\u9001\u4e0b\u4e00\u4e2a\u5b57\u7b26\u548c\u547d\u4ee4\u3002</p> <p>\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\uff0c\u6253\u5370\u673a\u91cc\u901a\u5e38\u4e0d\u53ea\u6709\u6570\u636e\u5bc4\u5b58\u5668\uff0c\u8fd8\u4f1a\u6709\u6570\u636e\u7f13\u51b2\u533a\u3002\u6211\u4eec\u7684 CPU \u4e5f\u4e0d\u662f\u771f\u7684\u4e00\u4e2a\u5b57\u7b26\u4e00\u4e2a\u5b57\u7b26\u8fd9\u6837\u4ea4\u7ed9\u6253\u5370\u673a\u53bb\u6253\u5370\u7684\uff0c\u800c\u662f\u4e00\u6b21\u6027\u628a\u6574\u4e2a\u6587\u6863\u4f20\u8f93\u5230\u6253\u5370\u673a\u7684\u5185\u5b58\u6216\u8005\u6570\u636e\u7f13\u51b2\u533a\u91cc\u9762\u4e00\u8d77\u6253\u5370\u7684\u3002</p> </li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#cpu","title":"\u4fe1\u53f7\u4e0e\u5730\u5740\uff1a\u63a5\u53e3\u548cCPU\u7684\u901a\u4fe1\u65b9\u5f0f","text":"<p>CPU \u9700\u8981\u5f80\u603b\u7ebf\u4e0a\u53d1\u9001\u4e00\u4e2a\u4ec0\u4e48\u4fe1\u53f7\u624d\u80fd\u548c I/O \u63a5\u53e3\u4e0a\u7684\u8bbe\u5907\u901a\u4fe1\uff1f</p> <p>\u5f53\u7136\u662f CPU \u652f\u6301\u7684\u673a\u5668\u6307\u4ee4\u3002</p> <p>\u4f46\u662fMIPS\u3001RISC-V\u3001ARM\u597d\u50cf\u6ca1\u6709\u8fd9\u79cd\uff0cx86\u597d\u50cf\u6709\uff08in\u3001out\u6307\u4ee4\uff1f\uff09</p> <p>\u90a3RISC\u67b6\u6784\u7684\u7528\u4ec0\u4e48\u548c I/O \u63a5\u53e3\u4e0a\u7684\u8bbe\u5907\u901a\u4fe1\u5462\uff1f --\u4f7f\u7528 \"\u5185\u5b58\u5730\u5740\" MMIO...</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#mmiopmio","title":"MMIO\u548cPMIO","text":"<ul> <li> <p>\u5185\u5b58\u6620\u5c04IO\uff08Memory-Mapped I/O\uff0c\u7b80\u79f0 MMIO\uff09</p> <p>\u4e3a\u4e86\u8ba9\u5df2\u7ecf\u8db3\u591f\u590d\u6742\u7684 CPU \u5c3d\u53ef\u80fd\u7b80\u5355\uff0c\u8ba1\u7b97\u673a\u4f1a\u628a I/O \u8bbe\u5907\u7684\u5404\u4e2a\u5bc4\u5b58\u5668\uff0c\u4ee5\u53ca I/O \u8bbe\u5907\u5185\u90e8\u7684\u5185\u5b58\u5730\u5740\uff0c\u90fd\u6620\u5c04\u5230\u4e3b\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u3002</p> <p>\u4e3b\u5185\u5b58\u7684\u5730\u5740\u7a7a\u95f4\u91cc\uff0c\u4f1a\u7ed9\u4e0d\u540c\u7684 I/O \u8bbe\u5907\u9884\u7559\u4e00\u6bb5\u4e00\u6bb5\u7684\u5185\u5b58\u5730\u5740\u3002</p> </li> </ul> <p>CPU \u60f3\u8981\u548c I/O \u8bbe\u5907\u901a\u4fe1\u7684\u65f6\u5019\u5462\uff0c\u5c31\u5f80 I/O \u8bbe\u5907\u6620\u5c04\u7684\u5730\u5740\u53d1\u9001\u6570\u636e\u3002</p> <p>\u8fd9\u4e9b\u5730\u5740\u4fe1\u606f\uff0c\u5c31\u662f\u901a\u8fc7\u4e0a\u4e00\u8bb2\u7684\u5730\u5740\u7ebf\u6765\u53d1\u9001\u7684\uff0c\u800c\u5bf9\u5e94\u7684\u6570\u636e\u4fe1\u606f\u81ea\u7136\u901a\u8fc7\u6570\u636e\u7ebf\u6765\u53d1\u9001\u7684\u4e86\u3002\uff08\u524d\u7aef\u603b\u7ebf/\u5feb\u901f\u901a\u9053\u4e92\u8054\uff09</p> <p>\u800c I/O \u8bbe\u5907\uff0c\u5c31\u4f1a\u76d1\u63a7\u5730\u5740\u7ebf\uff0c\u5e76\u4e14\u5728 CPU \u5f80\u81ea\u5df1\u5730\u5740\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u628a\u5bf9\u5e94\u7684\u6570\u636e\u7ebf\u91cc\u9762\u4f20\u8f93\u8fc7\u6765\u7684\u6570\u636e\uff0c\u63a5\u5165\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\u91cc\u9762\u7684\u5bc4\u5b58\u5668\u548c\u5185\u5b58\u91cc\u9762\u6765\u3002</p> <p>CPU \u65e0\u8bba\u662f\u5411 I/O \u8bbe\u5907\u53d1\u9001\u547d\u4ee4\u3001\u67e5\u8be2\u72b6\u6001\u8fd8\u662f\u4f20\u8f93\u6570\u636e\uff0c</p> <p></p> <ul> <li> <p>\u7aef\u53e3\u6620\u5c04 I/O\uff08Port-Mapped I/O\uff0c\u7b80\u79f0 PMIO\uff09</p> <p>\u867d\u7136 intel CPU \u4e5f\u652f\u6301MMIO\uff0c\u4f46\u662f\u5b83\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u7684\u6307\u4ee4\uff08in\u3001out\uff09\uff0c\u6765\u652f\u6301\u7aef\u53e3\u6620\u5c04 I/O \u6216\u8005\u4e5f\u53ef\u4ee5\u53eb\u72ec\u7acb\u8f93\u5165\u8f93\u51fa\uff08Isolated I/O\uff09\u3002</p> <p>\u5176\u5b9e PMIO \u7684\u901a\u4fe1\u65b9\u5f0f\u548c MMIO \u5dee\u4e0d\u591a\uff0c\u6838\u5fc3\u7684\u533a\u522b\u5728\u4e8e\uff1a</p> <p>PMIO \u91cc\u9762\u8bbf\u95ee\u7684\u8bbe\u5907\u5730\u5740\uff0c\u4e0d\u518d\u662f\u5728\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u91cc\u9762\uff0c\u800c\u662f\u4e00\u4e2a\u4e13\u95e8\u7684\u7aef\u53e3\uff08Port\uff09\u3002</p> <p>\u8fd9\u4e2a\u7aef\u53e3\u5e76\u4e0d\u662f\u6307\u4e00\u4e2a\u786c\u4ef6\u4e0a\u7684\u63d2\u53e3\uff0c\u800c\u662f\u548c CPU \u901a\u4fe1\u7684\u4e00\u4e2a\u62bd\u8c61\u6982\u5ff5\u3002</p> </li> <li> <p>\u603b\u7ed3</p> <p>\u65e0\u8bba\u662f PMIO \u8fd8\u662f MMIO\uff0cCPU \u90fd\u4f1a\u4f20\u9001\u4e00\u6761\u4e8c\u8fdb\u5236\u7684\u6570\u636e\uff0c\u7ed9\u5230 I/O \u8bbe\u5907\u7684\u5bf9\u5e94\u5730\u5740\u3002</p> <p>\u8bbe\u5907\u81ea\u5df1\u672c\u8eab\u7684\u63a5\u53e3\u7535\u8def\uff0c\u518d\u53bb\u89e3\u7801\u8fd9\u4e2a\u6570\u636e\u3002\u89e3\u7801\u4e4b\u540e\u7684\u6570\u636e\u5462\uff0c\u5c31\u4f1a\u53d8\u6210\u8bbe\u5907\u652f\u6301\u7684\u4e00\u6761\u6307\u4ee4\uff0c\u518d\u53bb\u901a\u8fc7\u63a7\u5236\u7535\u8def\u53bb\u64cd\u4f5c\u5b9e\u9645\u7684\u786c\u4ef6\u8bbe\u5907\u3002</p> <p>\u5bf9\u4e8e CPU \u6765\u8bf4\uff0c\u5b83\u5e76\u4e0d\u9700\u8981\u5173\u5fc3\u8bbe\u5907\u672c\u8eab\u80fd\u591f\u652f\u6301\u54ea\u4e9b\u64cd\u4f5c\u3002\u5b83\u8981\u505a\u7684\uff0c\u53ea\u662f\u5728\u603b\u7ebf\u4e0a\u4f20\u8f93\u4e00\u6761\u6761\u6570\u636e\u5c31\u597d\u4e86\u3002</p> <p></p> <p>\u8bbe\u5907\u7ba1\u7406\u5668\u91cc\u9762\u7684\u8d44\u6e90\uff08Resource\uff09\u4fe1\u606f\u3002</p> <ul> <li>Memory Range\uff0c\u8fd9\u4e2a\u5c31\u662f\u8bbe\u5907\u5bf9\u5e94\u6620\u5c04\u5230\u7684\u5185\u5b58\u5730\u5740\uff0c\u4e5f\u5c31\u662fMMIO \u7684\u8bbf\u95ee\u65b9\u5f0f\u3002</li> <li>\u8fd8\u6709 I/O Range\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u6240\u8bf4\u7684 PMIO\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u7aef\u53e3\u6765\u8bbf\u95ee I/O \u8bbe\u5907\u7684\u5730\u5740\u3002</li> <li>\u6700\u540e IRQ\uff0c\u4e5f\u5c31\u662f\u4f1a\u6765\u81ea\u4e8e\u8fd9\u4e2a\u8bbe\u5907\u7684\u4e2d\u65ad\u4fe1\u53f7\u4e86\u3002</li> <li>\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u901a\u5e38\u4f1a\u6839\u636e\u8bbe\u5907\u7684\u7279\u6027\u548c\u7cfb\u7edf\u7684\u8bbe\u8ba1\u6765\u786e\u5b9a\u4f7f\u7528\u54ea\u79cd\u901a\u4fe1\u65b9\u5f0f\u3002\u4e0d\u540c\u7684\u8bbe\u5907\u53ef\u80fd\u4f1a\u91c7\u7528\u4e0d\u540c\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u800c\u4e14\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u540c\u65f6\u4f7f\u7528 MMIO\u3001PMIO \u548c\u4e2d\u65ad\u6765\u4e0e\u8bbe\u5907\u8fdb\u884c\u901a\u4fe1\u3002\u56e0\u6b64\uff0c\u5e76\u4e0d\u662f\u53ea\u6709\u4e00\u4e2a\u65b9\u5f0f\u4f1a\u8d77\u4f5c\u7528\uff0c\u800c\u662f\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u5408\u9002\u7684\u901a\u4fe1\u65b9\u5f0f\u3002</li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_33","title":"\u63a8\u8350\u9605\u8bfb","text":"<p>\u5317\u4eac\u5927\u5b66\u5728 Coursera \u8ba1\u7b97\u673a\u7ec4\u6210 Computer Organization - \u7b2c\u4e5d\u8bb2 \u8f93\u5165\u8f93\u51fa\u8bbe\u5907 - \u7b2c 10 \u5468 | Coursera</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_34","title":"\u8bfe\u540e\u601d\u8003","text":"<ul> <li> <p>CPU \u7684\u6307\u4ee4\u3001\u603b\u7ebf\u548c I/O \u8bbe\u5907\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u5177\u4f53\u63cf\u8ff0\u4e00\u4e0b</p> <p>\u9996\u5148 CPU \u548c\u5404\u79cd I/O \u8bbe\u5907\u901a\u4fe1\u65f6\uff0c\u6211\u4eec\u5206\u6790\u4e24\u8fb9\uff1aCPU \u548c I/O\u8bbe\u5907\u3002</p> <ul> <li> <p>I/O \u8bbe\u5907</p> <p>\u6211\u4eec\u5c06 I/O \u8bbe\u5907\u62c6\u5206\u6210\uff1aCPU \u901a\u4fe1\u7684\u63a5\u53e3\u7535\u8def\u548c\u5b9e\u9645\u7684 I/O \u8bbe\u5907\u672c\u8eab\u3002</p> <p>\u63a5\u53e3\u7535\u8def\u91cc\u9762\u6709\u5bf9\u5e94\u7684\u72b6\u6001\u5bc4\u5b58\u5668\u3001\u547d\u4ee4\u5bc4\u5b58\u5668\u3001\u6570\u636e\u5bc4\u5b58\u5668\u3001\u6570\u636e\u7f13\u51b2\u533a\u548c\u8bbe\u5907\u5185\u5b58\u7b49\u7b49\u3002</p> <p>\u63a5\u53e3\u7535\u8def\u901a\u8fc7\u603b\u7ebf\u548c CPU \u901a\u4fe1\uff0c\u63a5\u6536\u6765\u81ea CPU \u7684\u6307\u4ee4\u548c\u6570\u636e\u3002</p> <p>\u800c\u63a5\u53e3\u7535\u8def\u4e2d\u7684\u63a7\u5236\u7535\u8def\uff0c\u518d\u89e3\u7801\u63a5\u6536\u5230\u7684\u6307\u4ee4\uff0c\u5b9e\u9645\u53bb\u64cd\u4f5c\u5bf9\u5e94\u7684\u786c\u4ef6\u8bbe\u5907\u3002</p> </li> <li> <p>CPU</p> <p>RISC\u67b6\u6784\u5e76\u6ca1\u6709\u6269\u5c55\u6307\u4ee4\u96c6\u6765\u548c I/O\u8bbe\u5907\u901a\u4fe1\uff0c\u800c\u662f\u4f7f\u7528 MMIO/PMIO</p> <p>\u5bf9 CPU \u6765\u8bf4\uff0c\u5b83\u770b\u5230\u7684\u5e76\u4e0d\u662f\u4e00\u4e2a\u4e2a\u7279\u5b9a\u7684\u8bbe\u5907\uff0c\u800c\u662f\u4e00\u4e2a\u4e2a\u5185\u5b58\u5730\u5740\u6216\u8005\u7aef\u53e3\u5730\u5740\u3002</p> <p>CPU \u53ea\u662f\u5411\u8fd9\u4e9b\u5730\u5740\u4f20\u8f93\u6570\u636e\u6216\u8005\u8bfb\u53d6\u6570\u636e\u3002</p> <p>\u6240\u9700\u8981\u7684\u6307\u4ee4\u548c\u64cd\u4f5c\u5185\u5b58\u5730\u5740\u7684\u6307\u4ee4\u5176\u5b9e\u6ca1\u6709\u4ec0\u4e48\u672c\u8d28\u5dee\u522b\u3002 \uff08ld \u3001store....\uff09</p> <p>\u901a\u8fc7\u8f6f\u4ef6\u5c42\u9762\u5bf9\u4e8e\u4f20\u8f93\u7684\u547d\u4ee4\u6570\u636e\u7684\u5b9a\u4e49\uff0c\u800c\u4e0d\u662f\u63d0\u4f9b\u7279\u6b8a\u7684\u65b0\u7684\u6307\u4ee4\uff0c\u6765\u5b9e\u9645\u64cd\u4f5c\u5bf9\u5e94\u7684 I/O \u786c\u4ef6\u3002</p> </li> </ul> </li> <li> <p>\u6211\u4eec\u8fd8\u662f\u56de\u5230\uff0c\u8fd9\u8282\u5f00\u59cb\u7684\u65f6\u5019\u540c\u5b66\u7559\u8a00\u7684\u95ee\u9898\u3002\u5982\u679c\u4f60\u4e70\u7684\u662f\u4e00\u4e2a\u5e26\u65e0\u7ebf\u63a5\u6536\u5668\u7684\u84dd\u7259\u9f20\u6807\uff0c\u4f60\u9700\u8981\u628a\u84dd\u7259\u63a5\u6536\u5668\u63d2\u5728\u7535\u8111\u7684 USB \u63a5\u53e3\u4e0a\uff0c\u7136\u540e\u4f60\u7684\u9f20\u6807\u4f1a\u548c\u8fd9\u4e2a\u84dd\u7259\u63a5\u6536\u5668\u8fdb\u884c\u901a\u4fe1\u3002\u90a3\u4e48\uff0c\u4f60\u80fd\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u7684 CPU \u548c\u84dd\u7259\u9f20\u6807\u8fd9\u4e2a\u8f93\u5165\u8bbe\u5907\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u600e\u6837\u7684\u5417\uff1f</p> <ul> <li> <p>\u65e0\u7ebf\u901a\u4fe1\u662f\u901a\u8fc7\u65e0\u7ebf\u7535\u6ce2\u6765\u4f20\u8f93\u6570\u636e\u7684\u4e00\u79cd\u901a\u4fe1\u65b9\u5f0f\u3002\u5728\u84dd\u7259\u6280\u672f\u4e2d\uff0c\u84dd\u7259\u8bbe\u5907\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u901a\u8fc7\u65e0\u7ebf\u7535\u6ce2\u6765\u5b9e\u73b0\u7684\u3002\u84dd\u7259\u9f20\u6807\u901a\u8fc7\u84dd\u7259\u534f\u8bae\u6808\u4e0e\u84dd\u7259\u63a5\u6536\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u7136\u540e\u901a\u8fc7\u84dd\u7259\u534f\u8bae\u6808\u4f7f\u7528\u65e0\u7ebf\u7535\u6ce2\u5c06\u6570\u636e\u4f20\u8f93\u5230\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u3002\u5728\u65e0\u7ebf\u901a\u4fe1\u4e2d\uff0c\u6570\u636e\u88ab\u8f6c\u6362\u6210\u65e0\u7ebf\u7535\u6ce2\uff0c\u5e76\u901a\u8fc7\u7a7a\u6c14\u4e2d\u7684\u65e0\u7ebf\u4fe1\u9053\u4f20\u8f93\u5230\u63a5\u6536\u7aef\u3002</p> <p>\u65e0\u7ebf\u901a\u4fe1\u7684\u7279\u70b9\u5305\u62ec\uff1a</p> <ol> <li>\u65e0\u7ebf\u4f20\u8f93\u4ecb\u8d28\uff1a\u6570\u636e\u901a\u8fc7\u65e0\u7ebf\u7535\u6ce2\u5728\u7a7a\u6c14\u4e2d\u4f20\u8f93\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u7535\u7f06\u6216\u5bfc\u7ebf\u3002</li> <li>\u4fe1\u9053\u7ba1\u7406\uff1a\u65e0\u7ebf\u901a\u4fe1\u9700\u8981\u8fdb\u884c\u4fe1\u9053\u7ba1\u7406\uff0c\u4ee5\u907f\u514d\u5e72\u6270\u548c\u51b2\u7a81\uff0c\u786e\u4fdd\u6570\u636e\u80fd\u591f\u53ef\u9760\u5730\u4f20\u8f93\u3002</li> <li>\u5b89\u5168\u6027\uff1a\u7531\u4e8e\u65e0\u7ebf\u4fe1\u53f7\u53ef\u4ee5\u88ab\u7a83\u542c\u548c\u5e72\u6270\uff0c\u56e0\u6b64\u65e0\u7ebf\u901a\u4fe1\u9700\u8981\u91c7\u53d6\u52a0\u5bc6\u548c\u8ba4\u8bc1\u7b49\u63aa\u65bd\u6765\u4fdd\u969c\u901a\u4fe1\u5b89\u5168\u3002</li> </ol> </li> <li> <p>\u84dd\u7259\u3001WiFi \u65e0\u7ebf\u7f51\u5361\u7b49\u8bbe\u5907\u90fd\u5c5e\u4e8e\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\uff0c\u5b83\u4eec\u901a\u8fc7\u65e0\u7ebf\u901a\u4fe1\u4e0e\u8ba1\u7b97\u673a\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002</p> </li> <li> <p>CPU \u548c\u84dd\u7259\u9f20\u6807\u901a\u4fe1\uff1a</p> <ol> <li> <p>\u901a\u4fe1\u5efa\u7acb</p> <p>\u5c06\u84dd\u7259\u63a5\u6536\u5668\u63d2\u5165\u5230\u8ba1\u7b97\u673a\u7684 USB \u63a5\u53e3\u4e0a\u65f6\uff0c\u63a5\u6536\u5668\u4f1a\u4e0e\u8ba1\u7b97\u673a\u7cfb\u7edf\u8fdb\u884c\u901a\u4fe1\uff1b\uff08\u8981\u6709\u84dd\u7259\u9a71\u52a8\u7a0b\u5e8f\uff09</p> <p>CPU\u4e00\u7aef\uff0c\u5c06\u8fd9\u4e2a\u84dd\u7259\u9f20\u6807\u7684\u5404\u4e2a\u5bc4\u5b58\u5668\u3001\u6570\u636e\u7f13\u51b2\u533a \u4ee5\u53ca \u84dd\u7259\u9f20\u6807\u5185\u90e8\u7684\u5185\u5b58\u5730\u5740\u90fd\u6620\u5c04\u5230\u4e3b\u5185\u5b58\u5730\u5740\u4e0a\u3002 </p> <p>\u7136\u540e\u84dd\u7259\u9f20\u6807\u901a\u8fc7\u84dd\u7259\u534f\u8bae\u6808\u4e0e\u84dd\u7259\u63a5\u6536\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5efa\u7acb\u901a\u4fe1\u94fe\u8def\u3002</p> </li> <li> <p>\u6570\u636e\u4f20\u8f93</p> <p>\u84dd\u7259\u9f20\u6807\u901a\u8fc7\u65e0\u7ebf\u7535\u6ce2\u5c06\u6570\u636e\u4f20\u8f93\u5230\u84dd\u7259\u63a5\u6536\u5668\uff08\u901a\u4fe1\u63a5\u53e3\uff09\uff0c\u84dd\u7259\u63a5\u6536\u5668\u5c06\u6570\u636e\u4f20\u8f93\u5230\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u3002</p> </li> <li> <p>\u6570\u636e\u5904\u7406</p> <p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u84dd\u7259\u9a71\u52a8\u7a0b\u5e8f\u8d1f\u8d23\u5904\u7406\u4ece\u84dd\u7259\u9f20\u6807\u63a5\u6536\u7684\u6570\u636e\uff0c\u8f6c\u6362\u6210\u673a\u5668\u6307\u4ee4\uff0c\u5e76\u5c06\u5176\u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\u3002</p> </li> </ol> </li> </ul> </li> <li> <p>\u5173\u4e8e\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\uff0c\u5982\u4f55\u4e8e\u8fd9\u4e00\u8bb2\u7684MMIO\u548cPMIO\u8054\u7cfb\u8d77\u6765\u5462\uff1f</p> <p>cpu\u7ed9\u5b9a\u4f4e16\u4f4d\uff0864kb\u5185\u7684\uff09\u53ef\u505a\u4e3a\u7aef\u53e3\uff0c\u7269\u7406\u8bbe\u5907\u5f00\u53d1\u5546\u53ef\u4ee5\u901a\u8fc7\u7aef\u53e3\u65b9\u5f0f\u76f4\u63a5\u4e0ecpu\u6c9f\u901a\uff08\u53ef\u7ed5\u8fc7\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u5730\u5740\uff0c\u4f46\u4f30\u8ba1\u4f1a\u5f15\u53d1\u4e2d\u65ad\u65b9\u5f0f\u6765\u88ab\u64cd\u4f5c\u7cfb\u7edf\u77e5\u6089\uff1f\uff09\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u5907\u8f6f\u4ef6\u52a0\u8f7d\u5728\u5185\u5b58\u4e0a\u901a\u8fc7\u8fdb\u7a0b/\u7ebf\u7a0b\uff0c\u6765\u4e0ecpu\u6c9f\u901a\uff08\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u5730\u5740\uff09 </p> <p>\u5c31\u662fMMIO PMIO</p> <p>\u5728Linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u4e2d\uff0cMMIO\u548cPMIO\u662f\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u56e0\u4e3a\u5b83\u4eec\u5b9a\u4e49\u4e86\u8bbe\u5907\u5982\u4f55\u4e0eCPU\u8fdb\u884c\u901a\u4fe1\u3002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u4e86\u89e3\u5e76\u6b63\u786e\u5904\u7406\u8bbe\u5907\u7684I/O\u8bbf\u95ee\u65b9\u5f0f\uff0c\u4ee5\u786e\u4fdd\u8bbe\u5907\u53ef\u4ee5\u6b63\u786e\u5730\u4e0e\u7cfb\u7edf\u8fdb\u884c\u901a\u4fe1\u3002</p> <ol> <li>MMIO\uff08\u5185\u5b58\u6620\u5c04I/O\uff09\uff1a \u5728Linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u8bbe\u5907\u4f7f\u7528MMIO\u65b9\u5f0f\u4e0eCPU\u901a\u4fe1\uff0c\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u5c06\u4f1a\u6620\u5c04\u5230\u7cfb\u7edf\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u4e2d\u3002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u5185\u5b58\u6620\u5c04\u673a\u5236\u5c06\u8bbe\u5907\u5bc4\u5b58\u5668\u6620\u5c04\u5230\u5185\u6838\u7a7a\u95f4\u4e2d\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u5bc4\u5b58\u5668\u3002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u5185\u6838\u63d0\u4f9b\u7684\u51fd\u6570\uff08\u5982ioremap\uff09\u6765\u5efa\u7acb\u5185\u5b58\u6620\u5c04\uff0c\u7136\u540e\u901a\u8fc7\u8bfb\u5199\u5185\u5b58\u5730\u5740\u7684\u65b9\u5f0f\u4e0e\u8bbe\u5907\u8fdb\u884c\u901a\u4fe1\u3002</li> <li>PMIO\uff08\u7aef\u53e3\u6620\u5c04I/O\uff09\uff1a \u5982\u679c\u8bbe\u5907\u4f7f\u7528PMIO\u65b9\u5f0f\u4e0eCPU\u901a\u4fe1\uff0c\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u5c06\u4f1a\u6620\u5c04\u5230CPU\u7684\u7aef\u53e3\u5730\u5740\u7a7a\u95f4\u4e2d\u3002\u5728Linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u4e2d\uff0c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u7279\u6b8a\u7684\u7aef\u53e3\u8bbf\u95ee\u6307\u4ee4\uff08inb\u3001outb\u7b49\uff09\u6765\u8bfb\u5199\u8bbe\u5907\u5bc4\u5b58\u5668\u3002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u786e\u4fdd\u5728\u5185\u6838\u7a7a\u95f4\u4e2d\u6b63\u786e\u7ba1\u7406\u5bf9\u8bbe\u5907\u7aef\u53e3\u7684\u8bbf\u95ee\uff0c\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u5b89\u5168\u95ee\u9898\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cLinux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u9700\u8981\u6839\u636e\u8bbe\u5907\u7684I/O\u8bbf\u95ee\u65b9\u5f0f\uff08MMIO\u6216PMIO\uff09\u6765\u7f16\u5199\u76f8\u5e94\u7684\u8bbf\u95ee\u4ee3\u7801\uff0c\u4ee5\u786e\u4fdd\u8bbe\u5907\u53ef\u4ee5\u6b63\u786e\u5730\u4e0eCPU\u8fdb\u884c\u901a\u4fe1\u3002\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u4e86\u89e3\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u6620\u5c04\u65b9\u5f0f\uff0c\u5e76\u4f7f\u7528\u9002\u5f53\u7684\u65b9\u6cd5\u6765\u8bbf\u95ee\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u4ee5\u5b9e\u73b0\u5bf9\u8bbe\u5907\u7684\u63a7\u5236\u548c\u901a\u4fe1\u3002MMIO\u548cPMIO\u662fLinux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u4e2d\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u5f00\u53d1\u4eba\u5458\u9700\u8981\u6df1\u5165\u7406\u89e3\u5e76\u6b63\u786e\u5904\u7406\u8fd9\u4e9b\u6982\u5ff5\uff0c\u4ee5\u786e\u4fdd\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u548c\u53ef\u9760\u6027\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u4e86\u89e3\u8bbe\u5907\u5730\u5740\u662f\u5fc5\u8981\u7684\u3002\u800c\u4e14\u4e3a\u4ec0\u4e48\u8bbe\u5907\u5730\u5740\u5e94\u8be5\u9075\u5faa\u67d0\u79cd\u6807\u51c6\uff0c\u907f\u514d\u4e0e\u7269\u7406\u5730\u5740\u51b2\u7a81\uff1f</p> <p>\u8bbe\u5907\u5730\u5740\u901a\u5e38\u6307\u7684\u662f\u5404\u79cdIO\u8bbe\u5907\u7ecf\u8fc7MMIO\uff08\u5185\u5b58\u6620\u5c04IO\uff09\u6216\u8005PMIO\uff08\u7aef\u53e3\u6620\u5c04IO\uff09\u6620\u5c04\u5f97\u5230\u7684\u8bbe\u5907\u5185\u5b58\u5730\u5740\u3002\u8fd9\u4e9b\u5730\u5740\u5c5e\u4e8e\u865a\u62df\u5730\u5740\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\uff0c\u5e76\u4e0d\u76f4\u63a5\u5bf9\u5e94\u7269\u7406\u5185\u5b58\u7684\u5730\u5740\u3002</p> <p>\u5982\u679c\u8bbe\u5907\u5730\u5740\u6807\u51c6\u4e0d\u7edf\u4e00\uff0cCPU\u53ef\u80fd\u4f1a\u6309\u7167\u8bbe\u5907\u5730\u5740\u5bfb\u5740\u4f18\u5148\u539f\u5219\uff0c\u5141\u8bb8\u8986\u76d6\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u907f\u514d\u53ef\u80fd\u7684\u5730\u5740\u51b2\u7a81\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e86\u89e3\u8bbe\u5907\u5730\u5740\u7684\u89c4\u8303\uff0c\u5e76\u8fdb\u884c\u9002\u5f53\u7684\u7ba1\u7406\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u901a\u5e38\u4f4d\u4e8e\u5185\u5b58\u5730\u5740\u7684\u9ad8\u4f4d\uff0c\u8fd9\u91cc\u6307\u7684\u662f\u865a\u62df\u5730\u5740\u3002\u5c06\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u653e\u7f6e\u5728\u9ad8\u4f4d\u53ef\u4ee5\u786e\u4fdd\u5b83\u4e0d\u4f1a\u53d7\u5230\u8bbe\u5907\u5730\u5740\u7684\u5f71\u54cd\uff0c\u4ece\u800c\u907f\u514d\u5730\u5740\u51b2\u7a81\u95ee\u9898\u3002</p> <p>\u8bbe\u5907\u5730\u5740\u5bfb\u5740\u6709\u9650\u539f\u5219\u662f\u6307\u5f53CPU\u8bbf\u95ee\u8bbe\u5907\u5bc4\u5b58\u5668\u65f6\uff0c\u53ef\u80fd\u4f1a\u6309\u7167\u8bbe\u5907\u5730\u5740\u7684\u4f18\u5148\u7ea7\u89c4\u5219\u6765\u786e\u5b9a\u8bbf\u95ee\u54ea\u4e00\u4e2a\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u3002\u5982\u679c\u591a\u4e2a\u8bbe\u5907\u7684\u5730\u5740\u8303\u56f4\u5b58\u5728\u91cd\u53e0\uff0cCPU\u53ef\u80fd\u4f1a\u6309\u7167\u67d0\u79cd\u4f18\u5148\u7ea7\u89c4\u5219\u6765\u9009\u62e9\u8bbf\u95ee\u54ea\u4e00\u4e2a\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\uff0c\u4ece\u800c\u53ef\u80fd\u5bfc\u81f4\u67d0\u4e9b\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u88ab\u8986\u76d6\u6216\u8bbf\u95ee\u51b2\u7a81\u7684\u60c5\u51b5\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5047\u8bbe\u7cfb\u7edf\u4e2d\u6709\u4e24\u4e2a\u8bbe\u5907A\u548c\u8bbe\u5907B\uff0c\u5b83\u4eec\u7684\u5730\u5740\u8303\u56f4\u5b58\u5728\u91cd\u53e0\uff0c\u5373\u8bbe\u5907A\u7684\u5730\u5740\u8303\u56f4\u662f0x1000-0x2000\uff0c\u8bbe\u5907B\u7684\u5730\u5740\u8303\u56f4\u662f0x1500-0x2500\u3002\u5f53CPU\u8bbf\u95ee\u5730\u57400x1800\u65f6\uff0c\u6839\u636e\u8bbe\u5907\u5730\u5740\u5bfb\u5740\u6709\u9650\u539f\u5219\uff0cCPU\u53ef\u80fd\u4f1a\u6309\u7167\u4f18\u5148\u7ea7\u89c4\u5219\u9009\u62e9\u8bbf\u95ee\u8bbe\u5907A\u7684\u5bc4\u5b58\u5668\uff0c\u56e0\u4e3a\u8bbe\u5907A\u7684\u5730\u5740\u8303\u56f4\u66f4\u65e9\u88ab\u5b9a\u4e49\u3002\u8fd9\u6837\u5c31\u53ef\u80fd\u5bfc\u81f4\u8bbe\u5907B\u7684\u5bc4\u5b58\u5668\u88ab\u8986\u76d6\u6216\u8bbf\u95ee\u51b2\u7a81\u7684\u60c5\u51b5\u53d1\u751f\u3002</p> <p>\u5728\u5b9e\u9645\u7684\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\uff0c\u4e3a\u4e86\u907f\u514d\u8bbe\u5907\u5730\u5740\u5bfb\u5740\u6709\u9650\u539f\u5219\u53ef\u80fd\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u901a\u5e38\u4f1a\u8981\u6c42\u8bbe\u5907\u7684\u5730\u5740\u8303\u56f4\u662f\u72ec\u7acb\u4e14\u4e0d\u91cd\u53e0\u7684\uff0c\u4ee5\u786e\u4fddCPU\u53ef\u4ee5\u6b63\u786e\u5730\u8bbf\u95ee\u8bbe\u5907\u7684\u5bc4\u5b58\u5668\u800c\u4e0d\u4f1a\u51fa\u73b0\u51b2\u7a81\u3002\u6b64\u5916\uff0c\u5728\u8bbe\u5907\u5730\u5740\u5206\u914d\u65f6\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u786c\u4ef6\u8bbe\u8ba1\u6216\u8f6f\u4ef6\u7f16\u7a0b\u7684\u65b9\u5f0f\u6765\u786e\u4fdd\u8bbe\u5907\u5730\u5740\u7684\u552f\u4e00\u6027\u548c\u72ec\u7acb\u6027\uff0c\u4ee5\u907f\u514d\u53ef\u80fd\u7684\u5730\u5740\u51b2\u7a81\u95ee\u9898\u3002</p> <p>\u67d0\u79cd\u6807\u51c6\u6307\u7684\u662f\u8bbe\u5907\u5730\u5740\u5e94\u8be5\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u8303\uff0c\u4ee5\u786e\u4fdd\u4e0d\u4f1a\u4e0e\u7269\u7406\u5185\u5b58\u5730\u5740\u53d1\u751f\u51b2\u7a81\u3002\u8fd9\u6837\u7684\u6807\u51c6\u53ef\u4ee5\u5305\u62ec\u8bbe\u5907\u5730\u5740\u7684\u8303\u56f4\u3001\u5206\u914d\u65b9\u5f0f\u3001\u8bbf\u95ee\u6743\u9650\u7b49\u5185\u5bb9\u3002\u9075\u5faa\u6807\u51c6\u53ef\u4ee5\u5e2e\u52a9\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1\u8005\u66f4\u597d\u5730\u7ba1\u7406\u8bbe\u5907\u5730\u5740\uff0c\u786e\u4fdd\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u3002</p> <p>\u5f53\u6d89\u53ca\u8bbe\u5907\u5730\u5740\u6807\u51c6\u65f6\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5b9e\u9645\u4f8b\u5b50\uff0c\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u7ba1\u7406\u8fd9\u4e9b\u8bbe\u5907\u5730\u5740\u4ee5\u786e\u4fdd\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\uff1a</p> <ol> <li>PCI\u8bbe\u5907\uff1aPCI\u8bbe\u5907\u901a\u5e38\u5177\u6709\u552f\u4e00\u7684\u8bbe\u5907\u5730\u5740\u8303\u56f4\uff0c\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7PCI\u914d\u7f6e\u7a7a\u95f4\u6765\u8bc6\u522b\u548c\u5206\u914d\u8bbe\u5907\u5730\u5740\u3002\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636ePCI\u89c4\u8303\u6765\u7ba1\u7406\u8bbe\u5907\u5730\u5740\u7684\u5206\u914d\uff0c\u907f\u514d\u4e0e\u7269\u7406\u5185\u5b58\u5730\u5740\u51b2\u7a81\u3002\u4f8b\u5982\uff0cWindows\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4f7f\u7528PCI\u914d\u7f6e\u7a7a\u95f4\u6765\u5206\u914d\u8bbe\u5907\u5730\u5740\uff0c\u5e76\u786e\u4fdd\u6bcf\u4e2aPCI\u8bbe\u5907\u90fd\u6709\u72ec\u7acb\u7684\u5730\u5740\u7a7a\u95f4\u3002</li> <li>USB\u8bbe\u5907\uff1aUSB\u8bbe\u5907\u6709\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e86\u89e3USB\u89c4\u8303\u6765\u7ba1\u7406USB\u8bbe\u5907\u5730\u5740\u3002USB\u8bbe\u5907\u5730\u5740\u901a\u5e38\u662f\u7531USB\u4e3b\u63a7\u5236\u5668\u5206\u914d\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u534f\u8c03\u548c\u7ba1\u7406\u8fd9\u4e9b\u5730\u5740\uff0c\u4ee5\u786e\u4fdd\u4e0e\u5176\u4ed6\u5185\u5b58\u5730\u5740\u4e0d\u53d1\u751f\u51b2\u7a81\u3002\u4f8b\u5982\uff0cLinux\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636eUSB\u89c4\u8303\u6765\u7ba1\u7406USB\u8bbe\u5907\u5730\u5740\uff0c\u4ee5\u786e\u4fdd\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u3002</li> <li>\u7f51\u7edc\u8bbe\u5907\uff1a\u7f51\u7edc\u8bbe\u5907\u4e5f\u6709\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4f8b\u5982\u7f51\u5361\u7684MAC\u5730\u5740\u3002\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e86\u89e3\u7f51\u7edc\u8bbe\u5907\u7684\u5730\u5740\u8303\u56f4\u548c\u5206\u914d\u65b9\u5f0f\uff0c\u4ee5\u786e\u4fdd\u6b63\u786e\u5730\u4e0e\u7f51\u7edc\u8bbe\u5907\u901a\u4fe1\u5e76\u907f\u514d\u5730\u5740\u51b2\u7a81\u3002\u4f8b\u5982\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4f7f\u7528ARP\uff08\u5730\u5740\u89e3\u6790\u534f\u8bae\uff09\u6765\u7ba1\u7406\u7f51\u7edc\u8bbe\u5907\u7684\u5730\u5740\u5206\u914d\uff0c\u4ee5\u786e\u4fdd\u6bcf\u4e2a\u8bbe\u5907\u90fd\u6709\u552f\u4e00\u7684\u5730\u5740\u3002</li> </ol> </li> <li> <p>\u8bb2PPT\u7684\u65f6\u5019\uff0c\u6309\u4e0b\u7a7a\u683c\u8ba9\u5e7b\u706f\u7247\u653e\u6620\u4e0b\u4e00\u7ae0\uff0c\u8fd9\u5176\u4e2d\u6d89\u53ca\u5230\u7684\u8ba1\u7b97\u673a\u8fc7\u7a0b\u6709\u54ea\u4e9b</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#44-io_waitio","title":"44 | \u7406\u89e3IO_WAIT\uff1aI/O\u6027\u80fd\u5230\u5e95\u662f\u600e\u4e48\u56de\u4e8b\u513f\uff1f","text":"<p>\u5927\u90e8\u5206\u7a0b\u5e8f\u5458\u5f00\u53d1\u7684\u90fd\u662f\u5e94\u7528\u7cfb\u7edf\u3002</p> <p>\u5728\u5f00\u53d1\u5e94\u7528\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9047\u5230\u7684\u6027\u80fd\u74f6\u9888\u5927\u90e8\u5206\u90fd\u5728 I/O \u4e0a\u3002</p> <p>\u901a\u8fc7\u5185\u5b58\u3001\u7f13\u5b58\u80fd\u89e3\u51b3\u4e00\u5b9a\u7684\u6027\u80fd\u95ee\u9898\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u95ee\u9898\u90fd\u80fd\u9760\u5229\u7528\u5185\u5b58\u6216\u8005 CPU Cache \u505a\u4e00\u5c42\u7f13\u5b58\u6765\u89e3\u51b3\u3002</p> <p>\u7279\u522b\u662f\u5728\u8fd9\u4e2a\u201c\u5927\u6570\u636e\u201d\u7684\u65f6\u4ee3\u3002\u6211\u4eec\u5728\u786c\u76d8\u4e0a\u5b58\u50a8\u4e86\u8d8a\u6765\u8d8a\u591a\u7684\u6570\u636e\uff0c\u4e00\u4e2a MySQL \u6570\u636e\u5e93\u7684\u5355\u8868\u6709\u4e2a\u51e0\u5343\u4e07\u6761\u8bb0\u5f55\uff0c\u65e9\u5df2\u7ecf\u4e0d\u7b97\u662f\u4ec0\u4e48\u7f55\u89c1\u73b0\u8c61\u4e86\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u7528\u5185\u5b58\u5f53\u7f13\u5b58\uff0c\u5b58\u50a8\u7a7a\u95f4\u662f\u4e0d\u591f\u7528\u7684\u3002\u5927\u90e8\u5206\u65f6\u95f4\uff0c\u6211\u4eec\u7684\u8bf7\u6c42\u8fd8\u662f\u8981\u6253\u5230\u786c\u76d8\u4e0a\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#io","title":"IO \u6027\u80fd\u3001\u987a\u5e8f\u8bbf\u95ee\u548c\u968f\u673a\u8bbf\u95ee","text":"<p>\u5982\u679c\u53bb\u770b\u786c\u76d8\u5382\u5546\u7684\u6027\u80fd\u62a5\u544a\uff0c\u901a\u5e38\u4f60\u4f1a\u770b\u5230\u4e24\u4e2a\u6307\u6807\uff1a</p> <ul> <li>\u54cd\u5e94\u65f6\u95f4\uff08Response Time\uff09\uff0c\u7c7b\u4f3cCPU\u7684\u54cd\u5e94\u65f6\u95f4\u3002</li> <li>\u6570\u636e\u4f20\u8f93\u7387\uff08Data Transfer Rate\uff09\u3002\u7c7b\u4f3cCPU\u7684\u541e\u5410\u7387\u3002</li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_35","title":"\u6570\u636e\u4f20\u8f93\u7387 \u548c \u54cd\u5e94\u65f6\u95f4","text":"<ul> <li> <p>\u6570\u636e\u4f20\u8f93\u7387</p> <p>\u73b0\u5728\u5e38\u7528\u7684\u786c\u76d8\u6709\u4e24\u79cd\u3002</p> <p>\u4e00\u79cd\u662f HDD \u786c\u76d8\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u673a\u68b0\u786c\u76d8\u3002</p> <p>\u53e6\u4e00\u79cd\u662f SSD \u786c\u76d8\uff0c\u4e00\u822c\u4e5f\u88ab\u53eb\u4f5c\u56fa\u6001\u786c\u76d8\u3002</p> <p>\u73b0\u5728\u7684 HDD \u786c\u76d8\uff0c\u7528\u7684\u662f SATA 3.0 \u7684\u63a5\u53e3\u3002</p> <p>\u800c SSD \u786c\u76d8\u5462\uff0c\u901a\u5e38\u4f1a\u7528\u4e24\u79cd\u63a5\u53e3\uff0c\u4e00\u90e8\u5206\u7528\u7684\u4e5f\u662f SATA 3.0 \u7684\u63a5\u53e3\uff1b\u53e6\u4e00\u90e8\u5206\u5462\uff0c\u7528\u7684\u662f PCI Express \u7684\u63a5\u53e3\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u5e38\u7528\u7684 SATA 3.0 \u7684\u63a5\u53e3\uff0c\u5e26\u5bbd\u662f 6Gb/s\u3002\u8fd9\u91cc\u7684\u201cb\u201d\u662f\u6bd4\u7279\u3002\u8fd9\u4e2a\u5e26\u5bbd\u76f8\u5f53\u4e8e\u6bcf\u79d2\u53ef\u4ee5\u4f20\u8f93 768MB \u7684\u6570\u636e\u3002\u800c\u6211\u4eec\u65e5\u5e38\u7528\u7684 HDD \u786c\u76d8\u7684\u6570\u636e\u4f20\u8f93\u7387\uff0c\u5dee\u4e0d\u591a\u5728 200MB/s \u5de6\u53f3\u3002</p> <p>HDD\u786c\u76d8\uff1a</p> <p></p> <p>\u4f5c\u8005\u7535\u8111\u4e0a\uff0c\u8fd0\u884c AS SSD \u6d4b\u7b97 SATA \u63a5\u53e3 SSD \u786c\u76d8\u6027\u80fd\u7684\u7ed3\u679c\uff0c\u7b2c\u4e00\u884c\u7684 Seq \u5c31\u662f\u987a\u5e8f\u8bfb\u5199\u786c\u76d8\u5f97\u5230\u7684\u6570\u636e\u4f20\u8f93\u7387\u7684\u5b9e\u9645\u7ed3\u679c\u3002</p> <p>\u5f53\u6211\u4eec\u6362\u6210 SSD \u7684\u786c\u76d8\uff0c\u6027\u80fd\u81ea\u7136\u4f1a\u597d\u4e0a\u4e0d\u5c11\u3002\u6bd4\u5982\uff0c\u4e00\u5757 Crucial MX500 \u7684 SSD \u786c\u76d8\u3002\u5b83\u7684\u6570\u636e\u4f20\u8f93\u901f\u7387\u80fd\u5230\u5dee\u4e0d\u591a 500MB/s\uff08\u4e0d\u540c\u7535\u8111\u4e0a\uff09\uff0c\u6bd4 HDD \u7684\u786c\u76d8\u5feb\u4e86\u4e00\u500d\u4e0d\u6b62\u3002\u4e0d\u8fc7 SATA \u63a5\u53e3\u7684\u786c\u76d8\uff0c\u5dee\u4e0d\u591a\u5230\u8fd9\u4e2a\u901f\u5ea6\uff0c\u6027\u80fd\u4e5f\u5c31\u5230\u9876\u4e86\u3002\u56e0\u4e3a SATA \u63a5\u53e3\u7684\u901f\u5ea6\u4e5f\u5c31\u8fd9\u4e48\u5feb\u3002</p> <p>SSD\uff1aPCIE\u63a5\u53e3\u7684</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u5b9e\u9645 SSD \u786c\u76d8\u80fd\u591f\u66f4\u5feb\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6362\u7528 PCI Express \u7684\u63a5\u53e3\u3002\u4f5c\u8005\u7535\u8111\u7684\u7cfb\u7edf\u76d8\u5c31\u662f\u4e00\u5757\u4f7f\u7528\u4e86 PCI Express \u7684\u4e09\u661f SSD \u786c\u76d8\u3002\u5b83\u7684\u6570\u636e\u4f20\u8f93\u7387\uff0c\u5728\u8bfb\u53d6\u7684\u65f6\u5019\u5c31\u80fd\u505a\u5230 2GB/s \u5de6\u53f3\uff0c\u5dee\u4e0d\u591a\u662f HDD \u786c\u76d8\u7684 10 \u500d\uff0c\u800c\u5728\u5199\u5165\u7684\u65f6\u5019\u4e5f\u80fd\u6709 1.2GB/s\u3002</p> </li> <li> <p>\u54cd\u5e94\u65f6\u95f4</p> <p>\u53e6\u4e00\u4e2a\u6211\u4eec\u5173\u5fc3\u7684\u6307\u6807\u54cd\u5e94\u65f6\u95f4\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5728 AS SSD \u7684\u6d4b\u8bd5\u7ed3\u679c\u91cc\u9762\u770b\u5230\uff0c\u5c31\u662f\u4e0a\u56fe\u7684 Acc.Time \u6307\u6807\u3002</p> <p>Acc Time</p> <p>This is Access Time. How long it took the drive to be ready with the request. Read would be the drive ready to start sending the data and write would be the drive starting to take the data from the PC.</p> <p>\u8bbf\u95ee\u65f6\u95f4\uff1a\u5176\u5b9e\u5c31\u662f\u786c\u76d8\u9a71\u52a8\u5668\u53ef\u4ee5\u771f\u6b63\u4f20\u8f93\u6570\u636e\u524d\uff0c\u82b1\u8d39\u7684\u4e00\u7cfb\u5217\u51c6\u5907\u65f6\u95f4\u3002\uff08\u6709\u70b9\u7c7b\u4f3c\u4e8e\u6570\u7535\u91cc\u7684 t<sup>cd</sup> (\u6c61\u67d3\u5ef6\u8fdf\u65f6\u95f4)\uff09</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_36","title":"\u987a\u5e8f\u8bbf\u95ee\u548c\u968f\u673a\u8bbf\u95ee","text":"<p>\u5149\u770b\u54cd\u5e94\u65f6\u95f4\u548c\u541e\u5410\u7387\u8fd9\u4e24\u4e2a\u6307\u6807\uff0c\u4f3c\u4e4e\u6211\u4eec\u7684\u786c\u76d8\u6027\u80fd\u5f88\u4e0d\u9519\u3002</p> <p>\u5373\u4f7f\u662f\u5ec9\u4ef7\u7684 HDD \u786c\u76d8\uff0c\u63a5\u6536\u4e00\u4e2a\u6765\u81ea CPU \u7684\u8bf7\u6c42\uff0c\u4e5f\u80fd\u591f\u5728\u51e0\u6beb\u79d2\u65f6\u95f4\u8fd4\u56de\u3002\u4e00\u79d2\u949f\u80fd\u591f\u4f20\u8f93\u7684\u6570\u636e\uff0c\u4e5f\u6709 200MB \u5de6\u53f3\u3002</p> <p>\u4f60\u60f3\u4e00\u60f3\uff0c\u6211\u4eec\u5e73\u65f6\u5f80\u6570\u636e\u5e93\u91cc\u5199\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f 1KB \u5de6\u53f3\u7684\u5927\u5c0f\u3002\u6211\u4eec\u62ff 200MB \u53bb\u9664\u4ee5 1KB\uff0c\u90a3\u5dee\u4e0d\u591a\u6bcf\u79d2\u949f\u53ef\u4ee5\u63d2\u5165 20 \u4e07\u6761\u6570\u636e\u5462\u3002\u4f46\u662f\u8fd9\u4e2a\u8ba1\u7b97\u51fa\u6765\u7684\u6570\u5b57\uff0c\u4f3c\u4e4e\u548c\u6211\u4eec\u65e5\u5e38\u7684\u7ecf\u9a8c\u4e0d\u7b26\u5408\u554a\uff1f\u8fd9\u53c8\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u5b9e\u9645\u4e0a\uff1a\u5728\u987a\u5e8f\u8bfb\u5199\u548c\u968f\u673a\u8bfb\u5199\u7684\u60c5\u51b5\u4e0b\uff0c\u786c\u76d8\u7684\u6027\u80fd\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u3002</p> <p>\u6211\u4eec\u56de\u5934\u770b\u4e00\u4e0b\u4e0a\u9762\u7684 AS SSD \u7684\u6027\u80fd\u6307\u6807\uff0c\u91cc\u9762\u6709\u4e00\u4e2a\u201c4K\u201d\u7684\u6307\u6807\u3002</p> <p>\u8fd9\u4e2a\u6307\u6807\u5c31\u662f\u7a0b\u5e8f\u53bb==\u968f\u673a\u8bfb\u53d6\u78c1\u76d8==\u4e0a\u67d0\u4e00\u4e2a 4KB \u5927\u5c0f\u7684\u6570\u636e\uff0c\u4e00\u79d2\u4e4b\u5185\u53ef\u4ee5\u8bfb\u53d6\u5230\u591a\u5c11\u6570\u636e\uff0c\u6570\u636e\u4f20\u8f93\u7387\u5219\u662f\u987a\u5e8f\u7684\u3002</p> <p>\u5728\u8fd9\u4e2a\u6307\u6807\u4e0a\uff0c\u6211\u4eec\u4f7f\u7528 SATA 3.0 \u63a5\u53e3\u7684\u786c\u76d8\u548c PCI Express \u63a5\u53e3\u7684\u786c\u76d8\uff0c\u6027\u80fd\u5dee\u5f02\u53d8\u5f97\u5f88\u5c0f\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\uff0c\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u63a5\u53e3\u672c\u8eab\u7684\u901f\u5ea6\u5df2\u7ecf\u4e0d\u662f\u6211\u4eec\u786c\u76d8\u8bbf\u95ee\u901f\u5ea6\u7684\u74f6\u9888\u4e86\u3002</p> <p>\u66f4\u91cd\u8981\u7684\u662f\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u5373\u4f7f\u6211\u4eec\u7528 PCI Express \u7684\u63a5\u53e3\uff0c\u5728\u968f\u673a\u8bfb\u5199\u7684\u65f6\u5019\uff0c\u6570\u636e\u4f20\u8f93\u7387\u4e5f\u53ea\u80fd\u5230 40MB/s \u5de6\u53f3\uff0c\u662f\u987a\u5e8f\u8bfb\u5199\u60c5\u51b5\u4e0b\u7684\u51e0\u5341\u5206\u4e4b\u4e00\u3002</p> <p>\u200b                                                                     40MB / 4KB = 10,000\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u79d2\u4e4b\u5185\uff0c\u8fd9\u5757 SSD \u786c\u76d8\u53ef\u4ee5\u968f\u673a\u8bfb\u53d6 1 \u4e07\u6b21\u7684 4KB \u7684\u6570\u636e\u3002\u5982\u679c\u662f\u5199\u5165\u7684\u8bdd\u5462\uff0c\u4f1a\u66f4\u591a\u4e00\u4e9b\uff0c90MB /4KB \u5dee\u4e0d\u591a\u662f 2 \u4e07\u591a\u6b21\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#iops","title":"IOPS","text":"<p>\u6bcf\u79d2\u8bfb\u5199\u7684\u6b21\u6570\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3aIOPS\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u7684\u6b21\u6570\u3002</p> <p>\u6bd4\u8d77\u54cd\u5e94\u65f6\u95f4\uff0c\u6211\u4eec\u66f4\u5173\u6ce8 IOPS \u8fd9\u4e2a\u6027\u80fd\u6307\u6807\u3002IOPS\u3001DTR\uff08Data Transfer Rate\uff0c\u6570\u636e\u4f20\u8f93\u7387\uff09\u624d\u662f\u8f93\u5165\u8f93\u51fa\u6027\u80fd\u7684\u6838\u5fc3\u6307\u6807\u3002 </p> <p>\u56e0\u4e3a\uff0c\u6211\u4eec\u5728\u5b9e\u9645\u7684\u5e94\u7528\u5f00\u53d1\u5f53\u4e2d\uff0c\u5bf9\u4e8e\u6570\u636e\u7684\u8bbf\u95ee\uff0c\u66f4\u591a\u7684\u662f\u968f\u673a\u8bfb\u5199\uff0c\u800c\u4e0d\u662f\u987a\u5e8f\u8bfb\u5199\u3002</p> <p>\u6211\u4eec\u5e73\u65f6\u6240\u8bf4\u7684\u670d\u52a1\u5668\u627f\u53d7\u7684\u201c\u5e76\u53d1\u201d\uff0c\u5176\u5b9e\u662f\u5728\u8bf4\uff0c\u4f1a\u6709\u5f88\u591a\u4e2a\u4e0d\u540c\u7684\u8fdb\u7a0b\u548c\u8bf7\u6c42\u6765\u8bbf\u95ee\u670d\u52a1\u5668\u3002</p> <p>\u81ea\u7136\uff0c\u5b83\u4eec\u5728\u786c\u76d8\u4e0a\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u662f\u5f88\u96be\u987a\u5e8f\u653e\u5728\u4e00\u8d77\u7684\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u968f\u673a\u8bfb\u5199\u7684 IOPS \u624d\u662f\u670d\u52a1\u5668\u6027\u80fd\u7684\u6838\u5fc3\u6307\u6807\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#io_wait","title":"\u5982\u4f55\u5b9a\u4f4d IO_WAIT","text":"<p>\u6211\u4eec\u770b\u5230\uff0c\u5373\u4f7f\u662f\u7528\u4e0a\u4e86 PCI Express \u63a5\u53e3\u7684 SSD \u786c\u76d8\uff0cIOPS \u4e5f\u5c31\u662f\u5728 2 \u4e07\u5de6\u53f3\u3002\u800c\u6211\u4eec\u7684 CPU \u7684\u4e3b\u9891\u901a\u5e38\u5728 2GHz \u4ee5\u4e0a\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u53ef\u4ee5\u505a 20 \u4ebf\u6b21\u64cd\u4f5c\u3002\u5373\u4f7f CPU \u5411\u786c\u76d8\u53d1\u8d77\u4e00\u6761\u8bfb\u5199\u6307\u4ee4\uff0c\u9700\u8981\u5f88\u591a\u4e2a\u65f6\u949f\u5468\u671f\uff0c\u4e00\u79d2\u949f CPU \u80fd\u591f\u6267\u884c\u7684\u6307\u4ee4\u6570\uff0c\u548c\u6211\u4eec\u786c\u76d8\u80fd\u591f\u8fdb\u884c\u7684\u64cd\u4f5c\u6570\uff0c\u4e5f\u6709\u597d\u51e0\u4e2a\u6570\u91cf\u7ea7\u7684\u5dee\u5f02\u3002</p> <p>\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\uff0c\u6211\u4eec\u5728\u5e94\u7528\u5f00\u53d1\u7684\u65f6\u5019\u5f80\u5f80\u4f1a\u8bf4\u201c\u6027\u80fd\u74f6\u9888\u5728 I/O \u4e0a\u201d\u3002\u56e0\u4e3a\u5f88\u591a\u65f6\u5019\uff0cCPU \u6307\u4ee4\u53d1\u51fa\u53bb\u4e4b\u540e\uff0c\u4e0d\u5f97\u4e0d\u53bb\u201c\u7b49\u201d\u6211\u4eec\u7684 I/O \u64cd\u4f5c\u5b8c\u6210\uff0c\u624d\u80fd\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u5b9e\u9645\u9047\u5230\u670d\u52a1\u7aef\u7a0b\u5e8f\u7684\u6027\u80fd\u95ee\u9898\u7684\u65f6\u5019\uff0c\u6211\u4eec\u600e\u4e48\u77e5\u9053\u8fd9\u4e2a\u95ee\u9898\u662f\u4e0d\u662f\u6765\u81ea\u4e8e CPU \u7b49 I/O \u6765\u5b8c\u6210\u64cd\u4f5c\u5462\uff1f</p> <p>\u901a\u8fc7 top\u3001iostat\u3001iotop\u3001stress\u8fd9\u4e9b\u547d\u4ee4\uff0c\u4e00\u8d77\u6765\u770b\u770b CPU \u5230\u5e95\u6709\u6ca1\u6709\u5728\u7b49\u5f85 io \u64cd\u4f5c\u3002</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_37","title":"\u5206\u6790","text":"<ul> <li> <p>top \u547d\u4ee4</p> <p>\u67e5\u770b\u670d\u52a1\u8d1f\u8f7d</p> <p></p> <p>\u6709\u4e00\u884c\u662f\u4ee5 %CPU \u5f00\u5934\u7684\u3002\u8fd9\u4e00\u884c\u91cc\uff0c\u6709\u4e00\u4e2a\u53eb\u4f5c wa \u7684\u6307\u6807\uff0c\u8fd9\u4e2a\u6307\u6807\u5c31\u4ee3\u8868\u7740 iowait\uff0c\u4e5f\u5c31\u662f CPU \u7b49\u5f85 IO \u5b8c\u6210\u64cd\u4f5c\u82b1\u8d39\u7684\u65f6\u95f4\u5360 CPU \u7684\u767e\u5206\u6bd4\u3002\u4e0b\u4e00\u6b21\uff0c\u5f53\u4f60\u81ea\u5df1\u7684\u670d\u52a1\u5668\u9047\u5230\u6027\u80fd\u74f6\u9888\uff0cload \u5f88\u5927\u7684\u65f6\u5019\uff0c\u4f60\u5c31\u53ef\u4ee5\u901a\u8fc7 top \u770b\u4e00\u770b\u8fd9\u4e2a\u6307\u6807\u3002</p> </li> <li> <p>iostat \u547d\u4ee4</p> <p>\u770b\u5b9e\u9645\u7684\u786c\u76d8\u8bfb\u5199\u60c5\u51b5\u3002</p> <p></p> <p>\u4f60\u4f1a\u770b\u5230\uff0c\u8fd9\u4e2a\u547d\u4ee4\u91cc\uff0c\u4e0d\u4ec5\u6709 iowait \u8fd9\u4e2a CPU \u7b49\u5f85\u65f6\u95f4\u7684\u767e\u5206\u6bd4\uff0c\u8fd8\u6709\u4e00\u4e9b\u66f4\u52a0\u5177\u4f53\u7684\u6307\u6807\uff0c\u5e76\u4e14\u5b83\u8fd8\u662f\u6309\u7167\u4f60\u673a\u5668\u4e0a\u5b89\u88c5\u7684\u591a\u5757\u4e0d\u540c\u7684\u786c\u76d8\u5212\u5206\u7684\u3002</p> <p>\u8fd9\u91cc\u7684 tps \u6307\u6807\uff0c\u5176\u5b9e\u5c31\u5bf9\u5e94\u7740\u6211\u4eec\u4e0a\u9762\u6240\u8bf4\u7684\u786c\u76d8\u7684 IOPS \u6027\u80fd\u3002</p> <p>\u800c kB_read/s \u548c kB_wrtn/s \u6307\u6807\uff0c\u5c31\u5bf9\u5e94\u7740\u6211\u4eec\u7684\u6570\u636e\u4f20\u8f93\u7387\u7684\u6307\u6807\u3002</p> <p>\u77e5\u9053\u5b9e\u9645\u786c\u76d8\u8bfb\u5199\u7684 tps\u3001kB_read/s \u548c kb_wrtn/s \u7684\u6307\u6807\uff0c\u6211\u4eec\u57fa\u672c\u4e0a\u53ef\u4ee5\u5224\u65ad\u51fa\uff0c\u673a\u5668\u7684\u6027\u80fd\u662f\u4e0d\u662f\u5361\u5728 I/O \u4e0a\u4e86\u3002</p> <p>\u6bd4\u5982\uff1a</p> <p>\u5bf9\u4e8eSSD\uff0c\u5982\u679c\u6bcf\u79d2\u8bfb\u5199\u6570\u636e\u91cf\u8fdc\u4f4e\u4e8e\u786c\u76d8\u7684\u6807\u79f0\u6027\u80fd\uff08\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2aSSD\u6807\u79f0\u8bfb\u5199\u901f\u5ea6\u4e3a500MB/s\uff0c\u4f46\u5b9e\u9645\u53ea\u8fbe\u5230\u51e0\u5341MB/s\uff09\uff0c\u5219\u53ef\u80fd\u5b58\u5728I/O\u9650\u5236\u3002 \u5bf9\u4e8eHDD\uff0c\u7531\u4e8e\u5b83\u4eec\u7684IOPS\u901a\u5e38\u5728100\u5de6\u53f3\uff0c\u5982\u679c\u6bcf\u79d2\u7684\u8bfb\u5199\u8bf7\u6c42\u6b21\u6570\u63a5\u8fd1\u6216\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u4e14\u54cd\u5e94\u65f6\u95f4\uff08await\uff09\u663e\u8457\u589e\u52a0\uff0c\u4e5f\u53ef\u80fd\u8868\u660eI/O\u53d7\u9650\u3002</p> </li> <li> <p>iotop \u547d\u4ee4</p> <p>\u90a3\u4e48\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u662f\u8981\u627e\u51fa\u5230\u5e95\u662f\u54ea\u4e00\u4e2a\u8fdb\u7a0b\u662f\u8fd9\u4e9b I/O \u8bfb\u5199\u7684\u6765\u6e90\u4e86\u3002\u4f7f\u7528\u201ciotop\u201d\u8fd9\u4e2a\u547d\u4ee4\u3002</p> <p>\u56fe\u7247\uff1a</p> <p>\u901a\u8fc7 iotop \u8fd9\u4e2a\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u662f\u54ea\u4e00\u4e2a\u8fdb\u7a0b\u5b9e\u9645\u5360\u7528\u4e86\u5927\u91cf I/O\uff0c\u90a3\u4e48\u4f60\u5c31\u53ef\u4ee5\u6709\u7684\u653e\u77e2\uff0c\u53bb\u4f18\u5316\u5bf9\u5e94\u7684\u7a0b\u5e8f\u4e86\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_38","title":"\u6a21\u62df\u7cfb\u7edf","text":"<ul> <li> <p>stress\u547d\u4ee4</p> <p>$ stress -i 2</p> <p>$ top</p> <p>$ stress -i 2\u7528\u6765\u8fd0\u884c\u4e00\u4e2a\u540d\u4e3astress\u7684\u5de5\u5177\uff0c\u5e76\u8bbe\u7f6e\u5176\u5de5\u4f5c\u6a21\u5f0f\u4e3a\u6bcf2\u79d2\u6267\u884c\u4e00\u6b21\u8fed\u4ee3\u3002</p> <p>\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u7528\u6765\u6a21\u62df\u7cfb\u7edf\u7684\u538b\u529b\uff0c\u5305\u62ecCPU\u3001\u5185\u5b58\u3001I/O\u7b49\u65b9\u9762\u7684\u538b\u529b\u3002-i 2\u8868\u793a\u6a21\u62dfI/O\u65b9\u9762\u7684\u538b\u529b\u3002</p> <p>\u56fe\u7247</p> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#io_1","title":"\u603b\u7ed3\uff1a\u5224\u65ad\u6027\u80fd\u662f\u5426\u53d7\u5230I/O\u9650\u5236","text":"<ol> <li>\u67e5\u770bCPU\u7b49\u5f85I/O\u7684\u60c5\u51b5\uff1a<ul> <li>\u4f7f\u7528 <code>top</code> \u547d\u4ee4\u67e5\u770bCPU\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u679c\u53d1\u73b0CPU\u7684 <code>iowait</code> / <code>wa</code> \uff08\u6216 <code>IO-wait</code>\uff09\u767e\u5206\u6bd4\u5f88\u9ad8\uff0c\u8fd9\u901a\u5e38\u610f\u5473\u7740CPU\u5728\u7b49\u5f85I/O\u64cd\u4f5c\u5b8c\u6210\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>iostat</code> \u547d\u4ee4\u5206\u6790I/O\u6027\u80fd\uff1a<ul> <li><code>iostat</code> \u53ef\u4ee5\u63d0\u4f9b\u5173\u4e8eI/O\u64cd\u4f5c\u7684\u8be6\u7ec6\u7edf\u8ba1\u4fe1\u606f\uff0c\u5305\u62ec IOPS \u6bcf\u79d2\u7684\u8bfb\u5199\u8bf7\u6c42\u6b21\u6570\uff08tps\uff09\u3001\u6bcf\u79d2\u8bfb\u53d6\u7684\u6570\u636e\u91cf\uff08kB_read/s\uff09\u548c\u6bcf\u79d2\u5199\u5165\u7684\u6570\u636e\u91cf\uff08kb_wrtn/s\uff09\u3002</li> <li>\u5982\u679c\u53d1\u73b0 <code>iostat</code> \u8f93\u51fa\u7684 <code>%system</code>  /  <code>%iowait</code> \uff08\u8bbe\u5907\u5229\u7528\u7387\uff09\u63a5\u8fd1\u6216\u8fbe\u5230100%\uff0c\u6216\u8005 <code>await</code>\uff08\u5e73\u5747\u7b49\u5f85\u65f6\u95f4\uff09\u5f88\u9ad8\uff0c\u8fd9\u901a\u5e38\u8868\u660eI/O\u5b50\u7cfb\u7edf\u6b63\u5728\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002</li> </ul> </li> <li>\u5177\u4f53\u7684I/O\u6027\u80fd\u6307\u6807\uff1a<ul> <li>kB_read/s \u548c kb_wrtn/s\uff1a\u8fd9\u4e9b\u6307\u6807\u7684\u5177\u4f53\u6570\u503c\u53d6\u51b3\u4e8e\u5e94\u7528\u573a\u666f\u548c\u786c\u76d8\u7c7b\u578b\uff08HDD\u6216SSD\uff09\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5bf9\u4e8eSSD\uff0c\u8fd9\u4e9b\u503c\u53ef\u4ee5\u975e\u5e38\u9ad8\uff0c\u800c\u5bf9\u4e8eHDD\uff0c\u5219\u76f8\u5bf9\u8f83\u4f4e\u3002</li> <li>\u5bf9\u4e8eSSD\uff0c\u5982\u679c\u6bcf\u79d2\u8bfb\u5199\u6570\u636e\u91cf\u8fdc\u4f4e\u4e8e\u786c\u76d8\u7684\u6807\u79f0\u6027\u80fd\uff08\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2aSSD\u6807\u79f0\u8bfb\u5199\u901f\u5ea6\u4e3a500MB/s\uff0c\u4f46\u5b9e\u9645\u53ea\u8fbe\u5230\u51e0\u5341MB/s\uff09\uff0c\u5219\u53ef\u80fd\u5b58\u5728I/O\u9650\u5236\u3002</li> <li>\u5bf9\u4e8eHDD\uff0c\u7531\u4e8e\u5b83\u4eec\u7684IOPS\u901a\u5e38\u5728100\u5de6\u53f3\uff0c\u5982\u679c\u6bcf\u79d2\u7684\u8bfb\u5199\u8bf7\u6c42\u6b21\u6570\u63a5\u8fd1\u6216\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u4e14\u54cd\u5e94\u65f6\u95f4\uff08await\uff09\u663e\u8457\u589e\u52a0\uff0c\u4e5f\u53ef\u80fd\u8868\u660eI/O\u53d7\u9650\u3002</li> </ul> </li> <li>IOPS\u4e0eCPU\u6027\u80fd\u5bf9\u6bd4\uff1a<ul> <li>\u5982\u679cIOPS\u8fdc\u4f4e\u4e8eCPU\u7684\u6027\u80fd\uff08\u4f8b\u5982\uff0cCPU\u6bcf\u79d2\u80fd\u6267\u884c\u6570\u4ebf\u6b21\u64cd\u4f5c\uff0c\u800cIOPS\u53ea\u6709\u51e0\u5343\u6216\u51e0\u4e07\uff09\uff0c\u90a3\u4e48I/O\u53ef\u80fd\u4f1a\u6210\u4e3a\u74f6\u9888\u3002</li> </ul> </li> <li>\u5b9a\u4f4d\u5177\u4f53\u8fdb\u7a0b\uff1a<ul> <li>\u4f7f\u7528 <code>iotop</code> \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u662f\u54ea\u4e2a\u8fdb\u7a0b\u5728\u8fdb\u884c\u5927\u91cf\u7684I/O\u64cd\u4f5c\u3002</li> </ul> </li> <li>\u8865\u5145<ul> <li>\u5982\u679c\u9700\u8981\u5177\u4f53\u7684\u6570\u503c\u4f5c\u4e3a\u53c2\u8003\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u901a\u7528\u7684\u6307\u5bfc\u539f\u5219\uff1a<ul> <li>\u5bf9\u4e8eSSD\uff1a<ul> <li>kB_read/s \u548c kb_wrtn/s \u5e94\u8be5\u63a5\u8fd1\u6216\u8fbe\u5230\u786c\u76d8\u7684\u6807\u79f0\u6027\u80fd\u3002</li> <li>IOPS\u901a\u5e38\u5e94\u8be5\u9ad8\u4e8e\u51e0\u5343\uff0c\u5bf9\u4e8e\u9ad8\u6027\u80fdSSD\uff0c\u53ef\u80fd\u9ad8\u8fbe\u6570\u4e07\u3002</li> </ul> </li> <li>\u5bf9\u4e8eHDD\uff1a<ul> <li>kB_read/s \u548c kb_wrtn/s \u5e94\u8be5\u8003\u8651\u5230HDD\u7684\u8f6c\u901f\u548c\u7f13\u5b58\u5927\u5c0f\u3002</li> <li>IOPS\u901a\u5e38\u5728100\u5de6\u53f3\uff0c\u4f46\u5177\u4f53\u53d6\u51b3\u4e8e\u786c\u76d8\u7684\u7c7b\u578b\u548c\u914d\u7f6e\u3002</li> </ul> </li> </ul> </li> </ul> </li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_39","title":"\u63a8\u8350\u9605\u8bfb","text":"<p>Understanding IOPS, latency and storage performance (louwrentius.com)</p>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_40","title":"\u8bfe\u540e\u601d\u8003","text":"<p>AS SSD Benchmark Download Free - 2.0.7316 | TechSpot</p> <ul> <li> <p>\u5728\u4e0a\u9762\u7684\u6027\u80fd\u6307\u6807\u4e0a\uff0c\u8bb2\u89e3\u4e86 Seq\uff0c4K \u4ee5\u53ca Acc.Time \u8fd9\u4e09\u4e2a\u6307\u6807\uff0c4K-Thrd \u8fd9\u4e2a\u6307\u6807\u53c8\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6d4b\u8bd5\u8fd9\u4e2a\u6307\u6807\u5bf9\u5e94\u7684\u5e94\u7528\u573a\u666f\u53c8\u662f\u600e\u4e48\u6837\u7684\u5462\uff1f</p> <p>4k-thrd\uff1a\u968f\u673a64\u961f\u5217\u6df1\u5ea6\u6d4b\u8bd5\uff0c\u968f\u673a\u751f\u5c4264\u4e2a16M\u7684\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f1G\u6587\u4ef6\uff0c\u4ee54K\u4e3a\u5355\u4f4d\uff0c\u5bf964\u4e2a\u6587\u4ef6\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u7684\u6d4b\u8bd5\uff0c\u6700\u540e\u53d6\u5e73\u5747\u6570\u4e3a\u7ed3\u679c</p> </li> <li> <p>\u600e\u4e48\u63a7\u5236\u78c1\u76d8\u7684\u987a\u5e8f\u8bfb\u5199\u548c\u968f\u673a\u8bfb\u5199\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684API\uff1f\u5728\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u662f\u4e0d\u662f\u6709\u6240\u4e0d\u540c\uff0c\u6bd4\u5982Windows\u548cLinux\u3002</p> <ul> <li> <p>\u5728Linux\u7cfb\u7edf\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528<code>ioprio_set()</code>\u51fd\u6570\u6765\u8bbe\u7f6e\u78c1\u76d8I/O\u64cd\u4f5c\u7684\u4f18\u5148\u7ea7\uff0c\u4ece\u800c\u63a7\u5236\u78c1\u76d8\u7684\u987a\u5e8f\u8bfb\u5199\u548c\u968f\u673a\u8bfb\u5199\u3002\u8be5\u51fd\u6570\u53ef\u4ee5\u5728<code>sys/resource.h</code>\u5934\u6587\u4ef6\u4e2d\u627e\u5230\u3002\u901a\u8fc7\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u53ef\u4ee5\u5f71\u54cd\u78c1\u76d8I/O\u64cd\u4f5c\u7684\u8c03\u5ea6\u987a\u5e8f\uff0c\u4ece\u800c\u5b9e\u73b0\u63a7\u5236\u78c1\u76d8\u7684\u8bfb\u5199\u6a21\u5f0f\u3002</p> </li> <li> <p>\u5728Windows\u7cfb\u7edf\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528<code>SetFilePointer()</code>\u51fd\u6570\u548c<code>ReadFile()</code>\u3001<code>WriteFile()</code>\u51fd\u6570\u6765\u5b9e\u73b0\u987a\u5e8f\u8bfb\u5199\u548c\u968f\u673a\u8bfb\u5199\u3002\u901a\u8fc7\u8bbe\u7f6e\u6587\u4ef6\u6307\u9488\u7684\u4f4d\u7f6e\u548c\u8bfb\u5199\u64cd\u4f5c\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u63a7\u5236\u78c1\u76d8I/O\u7684\u987a\u5e8f\u548c\u968f\u673a\u6027\u3002</p> </li> <li> <p>\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u548cI/O\u8c03\u5ea6\u673a\u5236\u53ef\u80fd\u4e0d\u540c\uff0c\u6240\u4ee5\u5728\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u5dee\u5f02\u3002\u56e0\u6b64\uff0c\u5728\u7f16\u5199\u8de8\u5e73\u53f0\u7684\u7a0b\u5e8f\u65f6\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u7684\u64cd\u4f5c\u7cfb\u7edf\u6765\u9009\u62e9\u5408\u9002\u7684API\u6765\u63a7\u5236\u78c1\u76d8\u7684\u8bfb\u5199\u884c\u4e3a\u3002</p> </li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#45-google","title":"45 | \u673a\u68b0\u786c\u76d8\uff1aGoogle\u65e9\u671f\u7528\u8fc7\u7684\u201c\u9ed1\u79d1\u6280\u201d","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#46-ssdkpi","title":"46 | SSD\u786c\u76d8\uff08\u4e0a\uff09\uff1a\u5982\u4f55\u5b8c\u6210\u6027\u80fd\u4f18\u5316\u7684KPI\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#47-ssdkpi","title":"47 | SSD\u786c\u76d8\uff08\u4e0b\uff09\uff1a\u5982\u4f55\u5b8c\u6210\u6027\u80fd\u4f18\u5316\u7684KPI\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#48-dmakafka","title":"48 | DMA\uff1a\u4e3a\u4ec0\u4e48Kafka\u8fd9\u4e48\u5feb\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#49","title":"49 | \u6570\u636e\u5b8c\u6574\u6027\uff08\u4e0a\uff09\uff1a\u786c\u4ef6\u574f\u4e86\u600e\u4e48\u529e\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#49_1","title":"49 | \u6570\u636e\u5b8c\u6574\u6027\uff08\u4e0a\uff09\uff1a\u786c\u4ef6\u574f\u4e86\u600e\u4e48\u529e\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#51","title":"51 | \u5206\u5e03\u5f0f\u8ba1\u7b97\uff1a\u5982\u679c\u6240\u6709\u4eba\u7684\u5927\u8111\u90fd\u8054\u7f51\u4f1a\u600e\u6837\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html#_41","title":"\u9ad8\u901f\u7f13\u5b58","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html","title":"\u5e94\u7528","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html#52-dmpmongodb","title":"52 | \u8bbe\u8ba1\u5927\u578bDMP\u7cfb\u7edf\uff08\u4e0a\uff09\uff1aMongoDB\u5e76\u4e0d\u662f\u4ec0\u4e48\u7075\u4e39\u5999\u836f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html#53-dmpssddba","title":"53 | \u8bbe\u8ba1\u5927\u578bDMP\u7cfb\u7edf\uff08\u4e0b\uff09\uff1aSSD\u62ef\u6551\u4e86\u6240\u6709\u7684DBA","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html#54-disruptorcpu","title":"54 | \u7406\u89e3Disruptor\uff08\u4e0a\uff09\uff1a\u5e26\u4f60\u4f53\u4f1aCPU\u9ad8\u901f\u7f13\u5b58\u7684\u98ce\u9a70\u7535\u63a3","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html#55-disruptorcpu","title":"55 | \u7406\u89e3Disruptor\uff08\u4e0b\uff09\uff1a\u4e0d\u9700\u8981\u6362\u6321\u548c\u8e29\u5239\u8f66\u7684CPU\uff0c\u6709\u591a\u5feb\uff1f","text":""},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%BA%8C%E5%91%A8%E7%9B%AE/%E7%BB%BC%E8%BF%B0/examplemd.html","title":"Examplemd","text":"<p>\u5173\u4e8e\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u7684\u5185\u5bb9\uff0c\u6211\u5c06\u5176\u7406\u89e3\u4e3a\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\u4f17\u591a\u79d1\u76ee\u7684\u201c\u7eb2\u8981\u201d\uff0c\u8fd9\u95e8\u8bfe\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u77e5\u8bc6\u70b9\u6df1\u5165\u6316\u6398\u4e0b\u53bb\uff0c\u90fd\u53ef\u4ee5\u53d8\u6210\u8ba1\u7b97\u673a\u79d1\u5b66\u91cc\u7684\u4e00\u95e8\u6838\u5fc3\u8bfe\u7a0b\u3002</p> <p></p> <p>\u5982\uff1a</p> <ol> <li> <p>\u4ece\u9ad8\u7ea7\u8bed\u8a00\u53d8\u6210\u8ba1\u7b97\u673a\u6307\u4ee4\uff1a</p> <p>\u300a\u7f16\u8bd1\u539f\u7406\u300b\u3001\u300a\u64cd\u4f5c\u7cfb\u7edf\u300b...</p> </li> <li> <p>\u8ba1\u7b97\u80cc\u540e\u7684\u786c\u4ef6\u5b9e\u73b0\uff1a</p> <p>\u300a\u6570\u5b57\u903b\u8f91\u300b ---&gt; \u300a\u5904\u7406\u5668\u8bbe\u8ba1\u300b</p> <p>\u6211\u4e2a\u4eba\u5c06\u6570\u5b57\u903b\u8f91\u548c\u6570\u5b57\u7535\u8def\u533a\u5206\u5f00\u6765\u3002</p> <p>\u4e8c\u8005\u867d\u8bf4\u90fd\u662f\u6570\u7535\uff0c\u4f46\u8fd8\u662f\u6709\u4e2a\u4eba\u89c9\u5f97\u8fd8\u662f\u6709\u4e00\u5b9a\u7684\u5dee\u5f02\u3002</p> <p>\u6bd4\u5982\uff0c\u6570\u5b57\u903b\u8f91\u91cd\u8ba1\u7b97\u673a\u5185\u90e8\u5668\u4ef6\u7684\u8fde\u63a5\u548c\u5b9e\u73b0\uff0c\u4f1a\u5b66\u4e60Verilog\u7b49HDL\uff0c\u6211\u4eec\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u52a0\u6cd5\u5668\u3001\u5bc4\u5b58\u5668\uff08\u89e6\u53d1\u5668\uff09\u3001\u6d41\u6c34\u7ebf\u5904\u7406\u5668\u7b49\u7b49\u3002</p> <p>\u800c\u6570\u5b57\u7535\u8def\uff0c\u5219\u66f4\u591a\u7684\u662f\u4f7f\u7528\u76f8\u5173\u903b\u8f91\u82af\u7247\u6765\u5e2e\u52a9\u6211\u5b9e\u73b0\u66f4\u591a\u786c\u4ef6\u4e0a\u7684\u529f\u80fd\uff0c\u4e3b\u8981\u662f\u548c\u5d4c\u5165\u5f0f\u6216\u8005\u786c\u4ef6\u6709\u6bd4\u8f83\u5927\u7684\u76f8\u5173\u6027\uff0c\u6bd4\u5982\u8bf4\u4f7f\u7528\u67d0\u4e9b\u903b\u8f91\u82af\u7247\u6765\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u4e00\u4e9b\u529f\u80fd\uff1a74HC595\u3002</p> <p>74HC595\uff1a\u662f\u4e00\u79cd8\u4f4d\u79fb\u4f4d\u5bc4\u5b58\u5668\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e32\u884c\u6570\u636e\u8f6c\u6362\u4e3a\u5e76\u884c\u8f93\u51fa\uff0c\u5e38\u7528\u4e8e\u63a7\u5236LED\u70b9\u9635\u5c4f\u7b49\u9700\u8981\u591a\u4e2a\u63a7\u5236\u4fe1\u53f7\u7684\u5e94\u7528\u300274HC595\u5177\u6709\u4e32\u884c\u6570\u636e\u8f93\u5165\u3001\u65f6\u949f\u8f93\u5165\u3001\u6570\u636e\u9501\u5b58\u548c\u5e76\u884c\u6570\u636e\u8f93\u51fa\u7b49\u529f\u80fd\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u7ea7\u8054\u591a\u4e2a\u82af\u7247\u6765\u6269\u5c55\u8f93\u51fa\u4f4d\u6570\u3002</p> <p>\u3010\u7269\u8054\u7f51\u3011\u8d85\u8be6\u7ec6\u768474HC595\u5e94\u7528\u6307\u5357\uff08\u4ee5stm32\u63a7\u5236\u70b9\u9635\u5c4f\u4e3a\u4f8b\u5b50\uff09_74hc595\u82af\u7247\u4f7f\u7528_74hc195\u8fde\u63a5-CSDN\u535a\u5ba2</p> </li> <li> <p>\u6df1\u5165CPU\u548c\u5b58\u50a8\u5668\u7684\u4f18\u5316</p> <p>\u300a\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u300b</p> </li> <li> <p>\u8ba1\u7b97\u548c\u6570\u5b66\u548c\u57fa\u7840</p> <p>\u300a\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\u300b\u91cd\u8981\u3002\u5efa\u8bae\u597d\u597d\u5b66\u3002</p> <p>\u81f3\u4e8e\u8bf4\u597d\u597d\u5b66\u5230\u4ec0\u4e48\u7a0b\u5ea6\uff0c\u6211\u5148\u60f3\u60f3\uff0c\u6bd5\u7adf\u73b0\u5728\u4e0d\u662f\u8bf4\u5b8c\u5168\u8ba9\u4f60\u624b\u5199\u4e00\u4e9b\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u8ba9\u4f60\u6709\u8fd9\u4e2a\u5206\u6790\u601d\u8def\u3002</p> <ol> <li> <p>\u79bb\u6563\u6570\u5b66\uff1a\u79bb\u6563\u6570\u5b66\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u57fa\u77f3\u4e4b\u4e00\uff0c\u5b83\u5305\u62ec\u4e86\u5982\u96c6\u5408\u8bba\u3001\u56fe\u8bba\u3001\u903b\u8f91\u3001\u6570\u8bba\u548c\u4ee3\u6570\u7ed3\u6784\u7b49\u4e3b\u9898\u3002\u8fd9\u4e9b\u6982\u5ff5\u5728\u7b97\u6cd5\u8bbe\u8ba1\u3001\u6570\u636e\u7ed3\u6784\u3001\u7f51\u7edc\u8bbe\u8ba1\u3001\u5bc6\u7801\u5b66\u548c\u8f6f\u4ef6\u5de5\u7a0b\u4e2d\u6709\u5e7f\u6cdb\u5e94\u7528\u3002</p> </li> <li> <p>\u7b97\u6cd5\u7406\u8bba\uff1a\u7b97\u6cd5\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u6838\u5fc3\uff0c\u800c\u7b97\u6cd5\u7406\u8bba\u63d0\u4f9b\u4e86\u5206\u6790\u7b97\u6cd5\u6027\u80fd\uff08\u5982\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\uff09\u7684\u6570\u5b66\u5de5\u5177\u3002\u5b83\u4e0e\u8ba1\u7b97\u590d\u6742\u6027\u7406\u8bba\u5bc6\u5207\u76f8\u5173\uff0c\u540e\u8005\u7814\u7a76\u89e3\u51b3\u7279\u5b9a\u95ee\u9898\u7684\u6700\u6709\u6548\u7b97\u6cd5\u7684\u6781\u9650\u3002</p> </li> <li> <p>\u4fe1\u606f\u8bba\uff1a\u7531\u514b\u52b3\u5fb7\u00b7\u9999\u519c\u521b\u7acb\u7684\u4fe1\u606f\u8bba\u6d89\u53ca\u6570\u636e\u7684\u7f16\u7801\u3001\u5b58\u50a8\u548c\u4f20\u8f93\u3002\u5b83\u5bf9\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u8bb8\u591a\u9886\u57df\u90fd\u6709\u5f71\u54cd\uff0c\u5305\u62ec\u6570\u636e\u538b\u7f29\u3001\u52a0\u5bc6\u3001\u901a\u4fe1\u7cfb\u7edf\u548c\u4fe1\u53f7\u5904\u7406\u3002</p> </li> <li> <p>\u6570\u503c\u5206\u6790\uff1a\u6570\u503c\u5206\u6790\u63d0\u4f9b\u4e86\u7528\u4e8e\u89e3\u51b3\u5de5\u7a0b\u548c\u79d1\u5b66\u95ee\u9898\u7684\u6570\u5b66\u6a21\u578b\u7684\u6570\u503c\u89e3\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u5728\u8ba1\u7b97\u673a\u6a21\u62df\u3001\u6570\u503c\u4f18\u5316\u548c\u79d1\u5b66\u8ba1\u7b97\u4e2d\u975e\u5e38\u91cd\u8981\u3002</p> </li> <li> <p>\u6982\u7387\u8bba\u548c\u7edf\u8ba1\u5b66\uff1a\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u6982\u7387\u8bba\u548c\u7edf\u8ba1\u5b66\u7528\u4e8e\u6570\u636e\u5206\u6790\u3001\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\u3001\u968f\u673a\u8fc7\u7a0b\u5efa\u6a21\u548c\u7edf\u8ba1\u63a8\u65ad\u3002</p> </li> <li> <p>\u7ebf\u6027\u4ee3\u6570\uff1a\u7ebf\u6027\u4ee3\u6570\u5bf9\u4e8e\u8ba1\u7b97\u673a\u56fe\u5f62\u5b66\u3001\u673a\u5668\u5b66\u4e60\u3001\u6570\u636e\u5206\u6790\u548c\u91cf\u5b50\u8ba1\u7b97\u7b49\u9886\u57df\u81f3\u5173\u91cd\u8981\uff0c\u5b83\u63d0\u4f9b\u4e86\u5411\u91cf\u7a7a\u95f4\u3001\u7ebf\u6027\u53d8\u6362\u548c\u77e9\u9635\u7406\u8bba\u7b49\u5de5\u5177\u3002</p> </li> <li> <p>\u5fae\u79ef\u5206\uff1a\u5fae\u79ef\u5206\u5728\u8ba1\u7b97\u673a\u8f85\u52a9\u8bbe\u8ba1\uff08CAD\uff09\u3001\u52a8\u753b\u3001\u6a21\u62df\u548c\u4f18\u5316\u95ee\u9898\u4e2d\u6709\u5e94\u7528\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u6d89\u53ca\u51fd\u6570\u8fde\u7eed\u6027\u548c\u6781\u9650\u6982\u5ff5\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u96c6\u5408\u8bba\uff1a\u5b83\u4e3a\u8ba1\u7b97\u673a\u79d1\u5b66\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f62\u5f0f\u5316\u7684\u6846\u67b6\uff0c\u7528\u4e8e\u8ba8\u8bba\u5bf9\u8c61\u7684\u96c6\u5408\u4ee5\u53ca\u8fd9\u4e9b\u96c6\u5408\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> </li> <li> <p>\u4ee3\u6570\uff1a\u62bd\u8c61\u4ee3\u6570\u4e2d\u7684\u7fa4\u3001\u73af\u3001\u57df\u7b49\u6982\u5ff5\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u7f16\u7801\u7406\u8bba\u3001\u4ee3\u6570\u51e0\u4f55\u548c\u5bf9\u79f0\u6027\u7834\u7f3a\u4e2d\u6709\u6240\u5e94\u7528\u3002</p> </li> <li> <p>\u62d3\u6251\u5b66\uff1a\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u62d3\u6251\u5b66\u53ef\u4ee5\u7528\u6765\u7814\u7a76\u7f51\u7edc\u7684\u7ed3\u6784\uff0c\u4ee5\u53ca\u5728\u8ba1\u7b97\u673a\u56fe\u5f62\u5b66\u548c\u6570\u636e\u5206\u6790\u4e2d\u7684\u7a7a\u95f4\u5173\u7cfb\u3002</p> </li> <li> <p>\u903b\u8f91\u5b66\uff1a\u903b\u8f91\u5b66\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u57fa\u7840\uff0c\u7279\u522b\u662f\u5728\u4eba\u5de5\u667a\u80fd\u3001\u5f62\u5f0f\u5316\u9a8c\u8bc1\u548c\u7b97\u6cd5\u7684\u63a8\u7406\u65b9\u9762\u3002</p> </li> <li> <p>\u6570\u8bba\uff1a\u6570\u8bba\u5728\u7b97\u6cd5\u8bbe\u8ba1\u3001\u5bc6\u7801\u5b66\u548c\u8ba1\u7b97\u673a\u5b89\u5168\u4e2d\u626e\u6f14\u7740\u91cd\u8981\u89d2\u8272\uff0c\u7279\u522b\u662f\u7d20\u6570\u548c\u6a21\u7b97\u672f\u7684\u6982\u5ff5\u3002 </p> </li> </ol> <p>\u4e0a\u9762\u8fd9\u4e9b\u6570\u5b66\u65b9\u9762\u6211\u4e2a\u4eba\u89c9\u5f97\u6709\u5b66\u4e60\u4e00\u4e9b\u6700\u57fa\u672c\u7684\u5373\u53ef\uff0c\u6bd4\u5982\u5fae\u79ef\u5206\u3001\u7ebf\u6027\u4ee3\u6570\u3001\u6982\u7387\u8bba\u3001\u79bb\u6563\u6570\u5b66\u7b49\u7b49\uff0c\u4e0d\u4e86\u89e3\u6682\u65f6\u4e5f\u53ef\u4ee5\uff0c\u6bd5\u7adf\u4e0d\u662f\u5b8c\u5168\u505a\u76f8\u5173\u7684\u7b97\u6cd5\u548c\u975e\u5e38\u975e\u5e38\u6df1\u5165\u8ba1\u7b97\u7684\u672c\u8d28\uff0c\u6709\u76f8\u5173\u6570\u5b66\u57fa\u7840\u5373\u53ef\uff0c\u80fd\u770b\u61c2\u4e00\u4e9b\u5373\u53ef\u3002</p> <p>\u8fd9\u91cc\u8bf4\u7684\u5b66\u4e60\u4e00\u4e9b\u7684\u7a0b\u5ea6\u7a76\u7adf\u662f\u591a\u5c11\uff0c\u6211\u4e5f\u4e0d\u6e05\u695a\uff0c\u4f46\u662f\u6211\u4e5f\u5728\u4e86\u89e3\u3002</p> </li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%BA%8C%E5%91%A8%E7%9B%AE/%E7%BB%BC%E8%BF%B0/examplemd.html#_1","title":"\u5b66\u4e60\u65b9\u6cd5","text":"<p>\u8fd9\u91cc\u5f85\u66f4\u65b0\uff0c\u4f46\u662f\u6211\u60f3\u7684\u662f\u8981\u53c2\u8003 Linus \u7684 STFW, RTFM, RTFSC \u548c <code>ysyx</code> \u7684\u76f8\u5173\u5185\u5bb9\uff1f</p> <ol> <li> <p>\u5b66\u4f1a\u63d0\u95ee\u81ea\u5df1\u6765\u4e32\u8054\u77e5\u8bc6\u70b9\u3002</p> <p>\u5b66\u5b8c\u4e00\u4e2a\u77e5\u8bc6\u70b9\u4e4b\u540e\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u4e24\u4e2a\u65b9\u9762\uff0c\u95ee\u4e00\u4e0b\u81ea\u5df1\u3002\u6211\u5199\u7684\u7a0b\u5e8f\uff0c\u662f\u600e\u6837\u4ece\u8f93\u5165\u7684\u4ee3\u7801\uff0c\u53d8\u6210\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u5e76\u5f97\u5230\u6700\u7ec8\u7ed3\u679c\u7684\uff1f\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u8ba1\u7b97\u5668\u5c42\u9762\u5230\u5e95\u7ecf\u5386\u4e86\u54ea\u4e9b\u6b65\u9aa4\uff0c\u6709\u54ea\u4e9b\u5730\u65b9\u662f\u53ef\u4ee5\u4f18\u5316\u7684\uff1f\u65e0\u8bba\u662f\u7a0b\u5e8f\u7684\u7f16\u8bd1\u3001\u94fe\u63a5\u3001\u88c5\u8f7d\u548c\u6267\u884c\uff0c\u4ee5\u53ca\u8ba1\u7b97\u65f6\u9700\u8981\u7528\u5230\u7684\u903b\u8f91\u7535\u8def\u3001ALU\uff0c\u4e43\u81f3 CPU \u81ea\u53d1\u4e3a\u4f60\u505a\u7684\u6d41\u6c34\u7ebf\u3001\u6307\u4ee4\u7ea7\u5e76\u884c\u548c\u5206\u652f\u9884\u6d4b\uff0c\u8fd8\u6709\u5bf9\u5e94\u8bbf\u95ee\u5230\u7684\u786c\u76d8\u3001\u5185\u5b58\uff0c\u4ee5\u53ca\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u90fd\u5bf9\u5e94\u7740\u6211\u4eec\u5b66\u4e60\u4e2d\u7684\u4e00\u4e2a\u4e2a\u77e5\u8bc6\u70b9\u3002\u5efa\u8bae\u4f60\u81ea\u5df1\u8111\u5b50\u91cc\u8fc7\u4e00\u904d\uff0c\u6700\u597d\u662f\u53e3\u5934\u8868\u8ff0\u4e00\u904d\u6216\u8005\u5199\u4e0b\u6765\uff0c\u8fd9\u6837\u5bf9\u4f60\u5f7b\u5e95\u638c\u63e1\u8fd9\u4e9b\u77e5\u8bc6\u70b9\u90fd\u4f1a\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p> </li> <li> <p>\u5176\u6b21\uff0c\u5199\u4e00\u4e9b\u793a\u4f8b\u7a0b\u5e8f\u6765\u9a8c\u8bc1\u77e5\u8bc6\u70b9\u3002\u8ba1\u7b97\u673a\u79d1\u5b66\u662f\u4e00\u95e8\u5b9e\u8df5\u7684\u5b66\u79d1\u3002\u8ba1\u7b97\u673a\u7ec4\u6210\u4e2d\u7684\u5927\u91cf\u539f\u7406\u548c\u8bbe\u8ba1\uff0c\u90fd\u5bf9\u5e94\u7740\u201c\u6027\u80fd\u201d\u8fd9\u4e2a\u8bcd\u3002\u56e0\u6b64\uff0c\u901a\u8fc7\u628a\u5bf9\u5e94\u7684\u77e5\u8bc6\u70b9\uff0c\u53d8\u6210\u4e00\u4e2a\u4e2a\u6027\u80fd\u5bf9\u6bd4\u7684\u793a\u4f8b\u4ee3\u7801\u7a0b\u5e8f\u8bb0\u5f55\u4e0b\u6765\uff0c\u662f\u628a\u8fd9\u4e9b\u77e5\u8bc6\u70b9\u878d\u6c47\u8d2f\u901a\u7684\u597d\u65b9\u6cd5\u3002\u56e0\u4e3a\uff0c\u76f8\u6bd4\u4e8e\u5f3a\u8bb0\u786c\u80cc\u77e5\u8bc6\u70b9\uff0c\u4e00\u4e2a\u6709\u7740\u660e\u786e\u6027\u80fd\u5bf9\u6bd4\u7684\u793a\u4f8b\u7a0b\u5e8f\uff0c\u4f1a\u5728\u4f60\u8111\u6d77\u91cc\u7559\u4e0b\u66f4\u6df1\u523b\u7684\u5370\u8c61\u3002\u5f53\u4f60\u60f3\u8981\u56de\u987e\u8fd9\u4e9b\u77e5\u8bc6\u70b9\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u7a0b\u5e8f\u4e5f\u66f4\u5bb9\u6613\u63d0\u793a\u4f60\u628a\u5b83\u4ece\u8111\u6d77\u6df1\u5904\u91cc\u9762\u627e\u51fa\u6765\u3002</p> </li> <li> <p>\u6700\u540e\uff0c\u901a\u8fc7\u548c\u8ba1\u7b97\u673a\u786c\u4ef6\u53d1\u5c55\u7684\u5386\u53f2\u505a\u5bf9\u7167\u3002\u8ba1\u7b97\u673a\u7684\u53d1\u5c55\u5e76\u4e0d\u662f\u4e00\u8e74\u800c\u5c31\u7684\u3002\u4ece\u7b2c\u4e00\u53f0\u7535\u5b50\u8ba1\u7b97\u673a ENIAC\uff08Electronic Numerical Integrator And Computer\uff0c\u7535\u5b50\u6570\u503c\u79ef\u5206\u8ba1\u7b97\u673a\uff09\u7684\u53d1\u660e\u5230\u73b0\u5728\uff0c\u5df2\u7ecf\u6709 70 \u591a\u5e74\u4e86\u3002\u73b0\u4ee3\u8ba1\u7b97\u673a\u7528\u7684\u5404\u4e2a\u6280\u672f\uff0c\u90fd\u662f\u8ddf\u968f\u5b9e\u9645\u5e94\u7528\u4e2d\u9047\u5230\u7684\u6311\u6218\uff0c\u4e00\u4e2a\u4e2a\u53d1\u660e\u3001\u6253\u78e8\uff0c\u6700\u540e\u4fdd\u7559\u4e0b\u6765\u7684\u3002\u8fd9\u5f53\u4e2d\u4e0d\u4ec5\u4ec5\u6709\u5b66\u672f\u5c42\u9762\u7684\u78b0\u649e\uff0c\u66f4\u6709\u5927\u91cf\u5546\u4e1a\u5c42\u9762\u7684\u4ea4\u950b\u3002\u901a\u8fc7\u4e86\u89e3\u5145\u6ee1\u620f\u5267\u6027\u548c\u6545\u4e8b\u6027\u7684\u8ba1\u7b97\u673a\u786c\u4ef6\u53d1\u5c55\u53f2\uff0c\u8ba9\u4f60\u66f4\u5bb9\u6613\u7406\u89e3\u8ba1\u7b97\u673a\u7ec4\u6210\u4e2d\u5404\u79cd\u539f\u7406\u7684\u7531\u6765\u3002</p> </li> </ol>"},{"location":"Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%BA%8C%E5%91%A8%E7%9B%AE/%E7%BB%BC%E8%BF%B0/examplemd.html#_2","title":"\u5173\u4e8e\u5b66\u4e60\u8d44\u6599\u7684\u95ee\u9898","text":"<p>\u89c6\u9891\u8fd8\u662f\u4e66\u7c4d\uff1f</p> <p>\u8981\u5bf9\u521d\u5b66\u8005\u53cb\u597d\uff0c\u7136\u540e\u8fd8\u80fd\u6bd4\u8f83\u5feb\u7684\u8fc7\u6e21\u8fdb\u9636\uff1f</p> <ul> <li> <p>Linux</p> </li> <li> <p>C</p> </li> <li> <p>C++</p> </li> <li> <p>Hardware</p> </li> <li> <p>Data structure</p> </li> <li> <p>OS</p> </li> <li> <p>Computer organization</p> </li> <li> <p>Computer architecture</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html","title":"1. MiniCPU\u8bbe\u8ba1","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_1","title":"\u524d\u8a00","text":"<ul> <li>\u4f7f\u7528 Verilog \u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00</li> <li>\u57fa\u4e8e RV32I \u6307\u4ee4\u96c6\uff0c\u8bbe\u8ba1\u4e00\u4e2a 32 \u4f4d\u4e94\u7ea7\u6d41\u6c34\u7ebf\u7684\u5904\u7406\u5668\u6838\u3002( \u53d6\u503c --&gt; \u8bd1\u7801 --&gt; \u6267\u884c --&gt; \u8bbf\u5b58 --&gt; \u5199\u56de )</li> <li>\u8be5\u5904\u7406\u5668\u6838\u5305\u62ec\u6307\u4ee4\u63d0\u53d6\u5355\u5143\u3001\u6307\u4ee4\u8bd1\u7801\u5355\u5143\u3001\u6574\u578b\u6267\u884c\u5355\u5143\u3001\u8bbf\u95ee\u5b58\u50a8\u5668\u548c\u5199\u56de\u7ed3\u679c\u7b49\u5355\u5143\u6a21\u5757\uff0c\u652f\u6301\u8fd0\u884c\u5927\u591a\u6570 RV32I \u7684\u57fa\u7840\u6307\u4ee4\u3002</li> <li>\u6700\u540e\uff0c\u7f16\u5199\u7b80\u5355\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u653e\u5728\u8bbe\u8ba1\u51fa\u6765\u7684\u5904\u7406\u5668\u4e0a\u8fd0\u884c\u3002</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#verilog","title":"Verilog","text":"<p>\u533a\u522b\u4e8e\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_2","title":"\u8bbe\u8ba1\u601d\u60f3\uff1a","text":"<ul> <li> <p>\u6a21\u5757\u5316</p> <ul> <li> <p>\u5bf9\u6574\u4e2a\u82af\u7247\u7cfb\u7edf\u505a\u597d\u89c4\u5212</p> </li> <li> <p>\u5728\u5199\u5177\u4f53\u7684 Verilog \u4ee3\u7801\u4e4b\u524d\uff0c\u628a\u7cfb\u7edf\u5212\u5206\u6210\u51e0\u4e2a\u5927\u7684\u57fa\u672c\u7684\u529f\u80fd\u6a21\u5757\u3002</p> </li> <li> <p>\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\u518d\u6309\u4e00\u5b9a\u7684\u89c4\u5219\uff0c\u5212\u5206\u51fa\u4e0b\u4e00\u4e2a\u5c42\u6b21\u7684\u57fa\u672c\u5355\u5143\u3002</p> </li> </ul> <p>Verilog \u8bed\u8a00\u7684 module \u6a21\u5757\u5316\uff1a\u4e0a\u4e00\u5c42\u6a21\u5757\u5bf9\u4e0b\u4e00\u5c42\u5b50\u6a21\u5757\u8fdb\u884c\u4f8b\u5316, \u81ea\u9876\u5411\u4e0b,\u50cf\u7f16\u7a0b\u8bed\u8a00\u7684\u51fd\u6570\u8c03\u7528\u4e00\u6837\u3002\u6839\u636e\u5305\u542b\u7684\u5b50\u529f\u80fd\u6a21\u5757\u4e00\u76f4\u4f8b\u5316\u4e0b\u53bb\uff0c\u6700\u7ec8\u5f62\u6210 hierarchy \u7ed3\u6784\u3002</p> </li> </ul> <p></p> <ul> <li> <p>\u4ee3\u7801\u5bf9\u5e94\u7535\u8def</p> <p>\u7528 Verilog \u7684\u65f6\u5019\uff0c\u5fc5\u987b\u7406\u89e3\u6bcf\u6761\u8bed\u53e5\u5b9e\u8d28\u4e0a\u5bf9\u5e94\u7740\u4ec0\u4e48\u7535\u8def\uff0c\u5e76\u4e14\u8981\u4ece\u7535\u8def\u7684\u89d2\u5ea6\u6765\u601d\u8003\u5b83\u4e3a\u4f55\u8981\u8fd9\u6837\u8bbe\u8ba1\uff0c</p> <p>\u5982\uff1a</p> <ul> <li>\u58f0\u660e\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u5982\u679c\u6307\u5b9a\u662f\u4e00\u4e2a reg\uff0c\u90a3\u4e48\u8fd9\u4e2a\u53d8\u91cf\u5c31\u6709\u5bc4\u5b58\u6570\u503c\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u7efc\u5408\u51fa\u6765\u4e00\u4e2a\u5b9e\u9645\u7684\u5bc4\u5b58\u5668\uff1b</li> <li>\u5982\u679c\u6307\u5b9a\u662f\u4e00\u6bb5 wire\uff0c\u90a3\u4e48\u5b83\u5c31\u53ea\u80fd\u4f20\u9012\u6570\u636e\uff0c\u53ea\u662f\u8868\u793a\u4e00\u6761\u7ebf\u3002</li> <li>\u5728 Verilog \u91cc\u5199\u4e00\u4e2a\u5224\u65ad\u8bed\u53e5\uff0c\u53ef\u80fd\u5c31\u5bf9\u5e94\u4e86\u4e00\u4e2a MUX\uff08\u6570\u636e\u9009\u62e9\u5668\uff09\uff0c\u5199\u4e00\u4e2a for \u53ef\u80fd\u5c31\u662f\u628a\u4e00\u6bb5\u7535\u8def\u91cd\u590d\u597d\u51e0\u904d\u3002</li> <li>always \u5757\uff0c\u5b83\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e00\u4e2a\u4fe1\u53f7\u5728\u67d0\u4e2a\u503c\u6216\u67d0\u4e2a\u8df3\u53d8\u7684\u65f6\u5019\uff0c\u6267\u884c\u5757\u91cc\u7684\u4ee3\u7801\uff08\u7c7b\u4f3c\u4e2d\u65ad/\u5f02\u5e38\uff09</li> </ul> <p>\u6240\u4ee5\u4f60\u662f\u5728\u8bbe\u8ba1\u7535\u8def\uff0c\u4e0d\u662f\u5728\u7f16\u7a0b</p> </li> <li> <p>\u5e76\u884c\u6027\u548c\u5e76\u53d1\u6027</p> <p>\u7535\u8def\u4e2d\u7684\u591a\u4e2a\u5143\u4ef6\u53ef\u4ee5\u540c\u65f6\u5de5\u4f5c</p> <ul> <li> <p>\u5728 Verilog \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e76\u884c\u8d4b\u503c\u8bed\u53e5\u6765\u8868\u793a\u591a\u4e2a\u4fe1\u53f7\u7684\u5e76\u884c\u64cd\u4f5c\uff0c\u4ece\u800c\u5b9e\u73b0\u786c\u4ef6\u7684\u5e76\u884c\u8ba1\u7b97\u548c\u5904\u7406\u3002</p> <p></p> </li> </ul> </li> <li> <p>\u65f6\u5e8f\u548c\u72b6\u6001\u673a</p> <p>\u65f6\u5e8f\u662f\u6307\u7535\u8def\u4e2d\u7684\u4fe1\u53f7\u4f20\u8f93\u548c\u89e6\u53d1\u7684\u987a\u5e8f\u548c\u65f6\u95f4\u5173\u7cfb</p> <p>\u72b6\u6001\u673a\u5219\u662f\u63cf\u8ff0\u4e86\u7535\u8def\u5728\u4e0d\u540c\u72b6\u6001\u4e0b\u7684\u884c\u4e3a\u548c\u8f6c\u79fb\u6761\u4ef6</p> <ul> <li>\u5728 Verilog \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u65f6\u949f\u4fe1\u53f7\u548c\u89e6\u53d1\u5668\u6765\u5b9e\u73b0\u65f6\u5e8f\u63a7\u5236\uff0c\u4f7f\u7528\u72b6\u6001\u673a\u6a21\u5757\u6765\u63cf\u8ff0\u7535\u8def\u7684\u72b6\u6001\u548c\u72b6\u6001\u8f6c\u79fb</li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_3","title":"\u8bbe\u8ba1\u6d41\u7a0b","text":"<p>\u76f8\u5173\u5355\u8bcd\uff1a</p> <p>\uff08Architecture Specification\uff09\u67b6\u6784\u89c4\u8303</p> <p>\uff08Design &amp; RTL\uff09Register Transfer Level \u5bc4\u5b58\u5668\u7ea7\u8bbe\u8ba1</p> <p>\uff08Pre-Silicon Simulation\uff09\u6d41\u7247\u524d\u4eff\u771f\uff08\u4eff\u771f\uff09</p> <p>\uff08Logic Synthesis/Netlist\uff09\u903b\u8f91\u7efc\u5408/\u95e8\u7ea7\u7f51\u8868</p> <p>\uff08placement &amp; routing\uff09\u5e03\u7ebf</p> <p>\uff08post-Silicon Verification\uff09\u6d41\u7247\u540e\u9a8c\u8bc1</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_4","title":"\u8bed\u6cd5\u5feb\u901f\u5165\u95e8","text":"<p>\u8981\u60f3\u719f\u6089\u786c\u4ef6\u8bed\u8a00\uff0c\u6700\u5173\u952e\u7684\u5c31\u662f\u505a\u597d\u601d\u8def\u8f6c\u6362\u3002</p> <p>\u786c\u4ef6\u8bed\u8a00\u8ddf\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u672c\u8d28\u7684\u4e0d\u540c\u5c31\u662f\uff0c\u4f7f\u7528 Verilog \u7684\u65f6\u5019\uff0c\u5fc5\u987b\u7406\u89e3\u6bcf\u6761\u8bed\u53e5\u5b9e\u8d28\u4e0a\u5bf9\u5e94\u7684\u4ec0\u4e48\u7535\u8def\uff0c\u5e76\u4e14\u8981\u4ece\u7535\u8def\u7684\u89d2\u5ea6\u6765\u601d\u8003\u5b83\u4e3a\u4f55\u8981\u8fd9\u6837\u8bbe\u8ba1\uff0c\u800c\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u901a\u5e38\u53ea\u8981\u5b9e\u73b0\u529f\u80fd\u5c31\u884c\u3002</p> <pre><code>module counter(\n  //\u7aef\u53e3\u5b9a\u4e49\n  input                   reset_n,  //\u590d\u4f4d\u7aef\uff0c\u4f4e\u6709\u6548\n  input                   clk,       //\u8f93\u5165\u65f6\u949f\n  output [3:0]            cnt,      //\u8ba1\u6570\u8f93\u51fa\n  output                  cout     //\u6ea2\u51fa\u4f4d\n);  \n\nreg [3:0]               cnt_r ;      //\u8ba1\u6570\u5668\u5bc4\u5b58\u5668\n\nalways@(posedge clk or negedge reset_n) begin\n  if(!reset_n) begin                  //\u590d\u4f4d\u65f6\uff0c\u8ba1\u65f6\u5f520\n      cnt_r        &lt;= 4'b0000 ;\n    end\n    else if (cnt_r==4'd9) begin      //\u8ba1\u65f610\u4e2acycle\u65f6\uff0c\u8ba1\u65f6\u5f520\n      cnt_r        &lt;=4'b0000;\n    end\n  else begin                      \n      cnt_r        &lt;= cnt_r + 1'b1 ; //\u8ba1\u65f6\u52a01\n  end\nend\n\n  assign  cout = (cnt_r==4'd9) ;       //\u8f93\u51fa\u5468\u671f\u4f4d\n  assign  cnt  = cnt_r ;               //\u8f93\u51fa\u5b9e\u65f6\u8ba1\u65f6\u5668\n\nendmodule\n</code></pre> <ul> <li> <p>\u6a21\u5757\u7ed3\u6784</p> <pre><code>module counter(\n  //\u7aef\u53e3\u5b9a\u4e49\n  input                   reset_n,  //\u590d\u4f4d\u7aef\uff0c\u4f4e\u6709\u6548\n  input                   clk,       //\u8f93\u5165\u65f6\u949f\n  output [3:0]            cnt,      //\u8ba1\u6570\u8f93\u51fa\n  output                  cout     //\u6ea2\u51fa\u4f4d\n);  \n\n...\nendmodule\n</code></pre> </li> <li> <p>\u6570\u636e\u7c7b\u578b</p> <pre><code>parameter SIZE  =  2\u2019b01;\nreg [3:0]               cnt_r;\nwire [1:0] cout_w;\n</code></pre> <ul> <li> <p>\u4f4d\u5bbd\u4e3a 4 bit \u7684\u5bc4\u5b58\u5668 reg \u7c7b\u578b\u4fe1\u53f7\uff0c\u4fe1\u53f7\u540d\u79f0\u4e3a cnt_r\u3002</p> <p>\u5bc4\u5b58\u5668 reg \u7c7b\u578b\u8868\u793a\u62bd\u8c61\u6570\u636e\u5b58\u50a8\u5355\u5143\uff0c\u5b83\u5bf9\u5e94\u7684\u662f\u4e00\u79cd\u5bc4\u5b58\u5668\u7535\u8def\u3002</p> <p>reg \u9ed8\u8ba4\u521d\u59cb\u503c\u4e3a X\uff08\u4e0d\u786e\u5b9a\u503c\uff09\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0creg \u7535\u8def\u5728\u4e0a\u7535\u4e4b\u540e\uff0c\u8f93\u51fa\u9ad8\u7535\u5e73\u8fd8\u662f\u4f4e\u7535\u5e73\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u4e00\u822c\u662f\u5728\u7cfb\u7edf\u590d\u4f4d\u4fe1\u53f7\u6709\u6548\u65f6\uff0c\u7ed9\u5b83\u8d4b\u4e00\u4e2a\u786e\u5b9a\u503c\u3002\u6bd4\u5982\u4f8b\u5b50\u4e2d\u7684 cnt_r\uff0c\u5728\u590d\u4f4d\u4fe1\u53f7 reset_n \u7b49\u4e8e\u4f4e\u7535\u5e73\u65f6\uff0c\u5c31\u4f1a\u7ed9 cnt_r \u8d4b\u201c0\u201d\u503c\u3002</p> <p>reg \u7c7b\u578b\u53ea\u80fd\u5728 always \u548c inital \u8bed\u53e5\u4e2d\u88ab\u8d4b\u503c</p> <p>\u6ce8\u610f\uff1areg\u4ec5\u4ec5\u662f\u8bed\u6cd5\u5b9a\u4e49\uff0c\u4e0d\u7b49\u4e8e\u7535\u8def\u4e2d\u5bc4\u5b58\u5668\uff1b</p> <p>\u53ea\u6709\u65f6\u5e8f\u7535\u8def\u4e2dreg\u53d8\u91cf\u624d\u4f1a\u88ab\u903b\u8f91\u7efc\u5408\u5de5\u5177\u8ba4\u4e3a\u662f\u5bc4\u5b58\u5668 \u5982\u4e0b\uff1a</p> <ul> <li> <p>\u5982\u679c\u63cf\u8ff0\u8bed\u53e5\u662f\u65f6\u5e8f\u903b\u8f91\uff0c\u5373 always \u8bed\u53e5\u4e2d\u5e26\u6709\u65f6\u949f\u4fe1\u53f7\uff0c\u5bc4\u5b58\u5668\u53d8\u91cf\u5bf9\u5e94\u4e3a\u89e6\u53d1\u5668\u7535\u8def\u3002</p> <p>\u6bd4\u5982\u4e0a\u8ff0\u5b9a\u4e49\u7684 cnt_r\uff0c\u5c31\u662f\u5728\u5e26 clk \u65f6\u949f\u4fe1\u53f7\u7684 always \u5757\u4e2d\u88ab\u8d4b\u503c\uff0c\u6240\u4ee5\u5b83\u5bf9\u5e94\u7684\u662f\u89e6\u53d1\u5668\u7535\u8def\uff1b </p> </li> <li> <p>\u5982\u679c\u63cf\u8ff0\u8bed\u53e5\u662f\u7ec4\u5408\u903b\u8f91\uff0c\u5373 always \u8bed\u53e5\u4e0d\u5e26\u6709\u65f6\u949f\u4fe1\u53f7\uff0c\u5bc4\u5b58\u5668\u53d8\u91cf\u5bf9\u5e94\u4e3a\u9501\u5b58\u5668\u7535\u8def\u3002</p> </li> </ul> </li> <li> <p>wire \u7c7b\u578b\u8868\u793a\u7ed3\u6784\u5b9e\u4f53\uff08\u4f8b\u5982\u5404\u79cd\u903b\u8f91\u95e8\uff09\u4e4b\u95f4\u7684\u7269\u7406\u8fde\u7ebf\u3002</p> <p>wire \u7c7b\u578b\u4e0d\u80fd\u5b58\u50a8\u6570\u503c\uff0c\u5b83\u7684\u503c\u662f\u7531\u9a71\u52a8\u5b83\u7684\u5143\u4ef6\u6240\u51b3\u5b9a\u7684\u3002</p> <p>\u9a71\u52a8\u7ebf\u7f51\u7c7b\u578b\u53d8\u91cf\u7684\u6709\u903b\u8f91\u95e8\u3001\u8fde\u7eed\u8d4b\u503c\u8bed\u53e5\u3001assign \u7b49\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u9a71\u52a8\u5143\u4ef6\u8fde\u63a5\u5230\u7ebf\u7f51\u4e0a\uff0c\u7ebf\u7f51\u5c31\u9ed8\u8ba4\u4e3a\u9ad8\u963b\u6001\u201cZ\u201d\u3002 </p> <p>\u51e1\u662f\u5728always initial \u8bed\u53e5\u4e2d\u590d\u5236\u5230\u53d8\u91cf\uff0c\u4e00\u5b9a\u662freg\u578b</p> <p>\u51e1\u662f\u5728assign\u00a0\u8bed\u53e5\u4e2d\u590d\u5236\u7684\u53d8\u91cf\uff0c\u4e00\u5b9a\u662fwire\u578b</p> <p>\u603b\u7ed3\uff1a</p> <p>wire\u578b\uff1a\u8868\u793a\u7535\u8def\u6a21\u5757\u91cd\u70b9\u8fde\u7ebf\uff0c\u4eff\u771f\u6ce2\u5f62\u4e0d\u53ef\u89c1</p> <p>reg\u578b\uff1a\u5360\u7528\u4eff\u771f\u73af\u5883\u7684\u7269\u7406\u5185\u5b58\uff0c\u4f1a\u663e\u793a\u5728\u4eff  \u771f\u6ce2\u5f62\u4e2d</p> </li> <li> <p>\u5e38\u91cf\u53c2\u6570 parameter\u58f0\u660e\u4e00\u4e2a\u6807\u8bc6\u7b26\uff0c\u7b26\u53f7\u5e38\u91cf</p> <p>\u8fd9\u4e2a\u5e38\u91cf\uff0c\u5c31\u662f\u7535\u8def\u4e2d\u4e00\u4e32\u7531\u9ad8\u4f4e\u7535\u5e73\u6392\u5217\u7ec4\u6210\u7684\u4e00\u4e2a\u56fa\u5b9a\u6570\u503c\u3002</p> </li> </ul> </li> <li> <p>\u6570\u636e\u8868\u8fbe</p> </li> </ul> <pre><code> cnt_r        &lt;= 4'b0000 ;\n</code></pre> <p>\u7ed9\u5bc4\u5b58\u5668 cnt_r \u8d4b 4\u2019b0000 \u7684\u503c\u3002\u5176\u4e2d\u7684\u903b\u8f91\u201c0\u201d\u4f4e\u7535\u5e73\uff0c\u5bf9\u5e94\u7535\u8def\u63a5\u5730\uff08GND\uff09\u3002\u540c\u6837\u7684\uff0c\u903b\u8f91\u201c1\u201d\u5219\u8868\u793a\u9ad8\u7535\u5e73\uff0c\u5bf9\u5e94\u7535\u8def\u63a5\u7535\u6e90 VCC\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u7279\u6b8a\u7684\u201cX\u201d\u548c\u201cZ\u201d\u503c\u3002\u903b\u8f91\u201cX\u201d\u8868\u793a\u7535\u5e73\u672a\u77e5\uff0c\u8f93\u5165\u7aef\u5b58\u5728\u591a\u79cd\u8f93\u5165\u60c5\u51b5\uff0c\u53ef\u80fd\u662f\u9ad8\u7535\u5e73\uff0c\u4e5f\u53ef\u80fd\u662f\u4f4e\u7535\u5e73\uff1b\u903b\u8f91\u201cZ\u201d\u8868\u793a\u9ad8\u963b\u6001\uff0c\u5916\u90e8\u6ca1\u6709\u6fc0\u52b1\u4fe1\u53f7\uff0c\u662f\u4e00\u4e2a\u60ac\u7a7a\u72b6\u6001\u3002\u5f53\u7136\uff0c\u4e3a\u4e86\u4ee3\u7801\u7684\u7b80\u6d01\u660e\u4e86\uff0cVerilog \u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u683c\u5f0f\uff0c\u8868\u793a\u540c\u6837\u7684\u6570\u503c\u3002\u6bd4\u5982\u8981\u8868\u793a 4 \u4f4d\u5bbd\u7684\u6570\u503c\u201c10\u201d\uff0c\u4e8c\u8fdb\u5236\u5199\u6cd5\u4e3a 4\u2019b1010\uff0c\u5341\u8fdb\u5236\u5199\u6cd5\u4e3a 4\u2019d10\uff0c\u5341\u516d\u8fdb\u5236\u5199\u6cd5\u4e3a 4\u2019ha\u3002</p> <p>\u4f46\u662f\u6570\u636e\u5728\u5b9e\u9645\u5b58\u50a8\u65f6\u8fd8\u662f\u7528\u4e8c\u8fdb\u5236\uff0c\u4f4d\u5bbd\u8868\u793a\u50a8\u5b58\u65f6\u4e8c\u8fdb\u5236\u5360\u7528\u5bbd\u5ea6\u3002</p> <ul> <li> <p>\u8fd0\u7b97\u7b26</p> <p>\u57fa\u672cC\u8bed\u8a00</p> </li> <li> <p>\u6761\u4ef6\u3001\u5206\u652f\u3001\u5faa\u73af</p> <p>\u8bed\u6cd5\u57fa\u672c\u540cC\u8bed\u8a00\uff0c\u5c0f\u533a\u522b\u4e0d\u7ba1\uff0c\u76f4\u63a5\u4e0a\u624b\u770b\u4ee3\u7801\u7528\u8d77\u6765\u5373\u53ef\u3002</p> <p>\u8fd9\u91cc\u91cd\u70b9\u6765\u5bf9\u6bd4\u4e0d\u540c\u4e4b\u5904\uff0c\u4e5f\u5c31\u662f\u7528 Verilog \u5bf9\u4e8e\u6761\u4ef6\u3001\u5206\u652f\u8bed\u53e5\u6709\u4ec0\u4e48  \u4e0d\u540c\u3002</p> <p>\u7528 if \u8bbe\u8ba1\u7684\u8bed\u53e5\u6240\u5bf9\u5e94\u7535\u8def\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u4e5f\u5c31\u662f\u591a\u7ea7\u4e32\u8054\u7684 MUX \u7535\u8def\u3002</p> <p>\u800c case \u8bed\u53e5\u5bf9\u5e94\u7684\u7535\u8def\u662f\u6ca1\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u662f\u4e00\u4e2a\u591a\u8f93\u5165\u7684 MUX \u7535\u8def\u3002\uff08\u591a\u8def\u9009\u62e9\u5668\uff09</p> <p>\u8bbe\u8ba1\u65f6\uff0c\u53ea\u8981\u6211\u4eec\u5408\u7406\u4f7f\u7528\u8fd9\u4e24\u4e2a\u8bed\u53e5\uff0c\u5c31\u53ef\u4ee5\u4f18\u5316\u7535\u8def\u65f6\u5e8f\u6216\u8005\u8282\u7701\u786c\u4ef6\u7535\u8def\u8d44\u6e90\u3002</p> <p>\u5faa\u73af\u8bed\u53e5\uff0c\u4e00\u5171\u67094 \u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f while\uff0cfor\uff0crepeat \u548c forever \u5faa\u73af\u3002\u6ce8\u610f\uff0c\u5faa\u73af\u8bed\u53e5\u53ea\u80fd\u5728 always \u5757\u6216 initial \u5757\u4e2d\u4f7f\u7528\u3002</p> </li> <li> <p>\u8fc7\u7a0b\u7ed3\u6784</p> <ul> <li> <p>always</p> <p>always\u53ef\u4ee5\u7b80\u5355\u7684\u770b\u4f5cwhile\uff08event\uff09\uff0c\u5373\u5f53\u4e8b\u4ef6\u53d1\u751f\u7684\u65f6\u5019\uff0c\u5c31\u6267\u884calways\u8bed\u53e5\u3002</p> <p>\u6839\u636e\u4e8b\u4ef6event\u4e2d\u662f\u5426\u5305\u542b\u65f6\u5e8f\u4e8b\u4ef6\uff0calways\u5206\u4e3a\u4e24\u79cd\u903b\u8f91\uff1a\u65f6\u5e8f\u903b\u8f91\u548c\u7ec4\u5408\u903b\u8f91\u3002</p> <ol> <li> <p>\u65f6\u5e8f\u903b\u8f91\u8868\u793aalways\u53ea\u4f1a\u5728\u5bf9\u5e94\u7684\u4fe1\u53f7\u51fa\u73b0\u8fb9\u6cbf\u4e8b\u4ef6\u65f6\uff0c\u624d\u4f1a\u6267\u884c\u5bf9\u5e94\u7684\u4ee3\u7801\u3002</p> <p>\u5982\u679c\u6709\u591a\u4e2a\u4fe1\u53f7\u4ee5or\u8fde\u63a5\uff0c\u8fd9\u4e9b\u5bf9\u5e94\u7684\u4e8b\u4ef6\u88ab\u79f0\u4e3a\u654f\u611f\u4e8b\u4ef6\u5217\u8868\uff0c\u5982\u4e0b\uff1a</p> <pre><code>always @ (edge eventA or edge eventB) begin\n    [multiple statements]\nend\n</code></pre> <p>\u5176\u4e2dedge\u53ef\u4ee5\u662fnegedge\uff08\u4e0b\u964d\u6cbf\uff09\u548cposedge\uff08\u4e0a\u5347\u6cbf\uff09\u3002</p> </li> <li> <p>\u7ec4\u5408\u903b\u8f91\u901a\u5e38\u7528\u6765\u76d1\u542c\u4fe1\u53f7\u6c34\u5e73\u4e8b\u4ef6\u7684\u53d1\u751f\u3002\u5f53\u654f\u611f\u4fe1\u53f7\u51fa\u73b0\u7535\u5e73\u7684\u53d8\u5316\u65f6\u5c31\u4f1a\u6267\u884calways\u8bed\u53e5\u3002</p> <p>\u4f8b\u5982always @(a or b or c)\uff0ca\u3001b\u3001c\u5747\u4e3a\u53d8\u91cf\uff0c\u5f53\u5176\u4e2d\u4e00\u4e2a\u53d1\u751f\u53d8\u5316\u65f6\u90fd\u4f1a\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002\u4f8b\u5982\uff1a</p> <pre><code>always@(a,b) begin\n    out = a&amp;b;\nend\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2dalways\u7684\u654f\u611f\u4e8b\u4ef6\u5217\u8868\u4e3aa b\u53d1\u751f\u7535\u5e73\u53d8\u5316\uff0c\u5373\u5f53ab\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u53d1\u751f\u53d8\u5316\uff0c\u90fd\u4f1a\u8d4b\u4e88out\u65b0\u503c\u3002</p> <p>\u6709\u7684\u65f6\u5019\u654f\u611f\u4e8b\u4ef6\u53d8\u91cf\u8f83\u591a\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5199\u6bd4\u8f83\u9ebb\u70e6\uff0c\u8fd8\u6709\u4e00\u79cd\u7279\u6b8a\u7684\u7528\u6cd5\uff0calways @\uff08*\uff09\uff0c\u6b64\u65f6\u7684\u654f\u611f\u5217\u8868\u662fmodule\u4e2d\u6240\u6709\u5177\u6709\u5f62\u53c2\u7684\u4fe1\u53f7\uff0c\u5176\u4e2d\u4efb\u4f55\u4fe1\u53f7\u53d1\u751f\u53d8\u5316\u90fd\u4f1a\u89e6\u53d1always\u8bed\u53e5\u3002\u4e0a\u8ff0\u4ee3\u7801\u5c31\u53ef\u4ee5\u5199\u6210\uff1a</p> <pre><code>always @(*) begin\n    out = a&amp;b;\nend\n</code></pre> </li> </ol> <p></p> </li> <li> <p>tips</p> <p>always \u5757\u5185\u4e0d\u80fd\u4f7f\u7528 wire\u3001</p> </li> <li> <p>initial</p> <p>initial\u8bed\u53e5\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u5e38\u7528\u4e8e\u4ea7\u751f\u4eff\u771f\u6d4b\u8bd5\u4fe1\u53f7\uff0c\u6216\u5bf9\u67d0\u4e9b\u53d8\u91cf\u8d4b\u521d\u503c\u3002</p> <p>\u5982\u679cmodule\u4e2d\u6709\u591a\u4e2ainitial\u8bed\u53e5\uff0c\u8fd9\u4e9b\u8bed\u53e5\u4e4b\u95f4\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u90fd\u662f\u4ece0\u65f6\u523b\u5f00\u59cb\u5e76\u884c\u6267\u884c\uff0c\u5e76\u6ca1\u6709\u987a\u5e8f\u4e4b\u5206\u3002</p> </li> <li> <p>\u963b\u585e/\u975e\u963b\u585e\u8d4b\u503c</p> <p>\u5982\u679c\u73b0\u5728\u8df3\u56de\u53bb\u770b\u4e4b\u524d\u7684\u4ee3\u7801\uff0c\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u6ce8\u91ca\uff1a</p> <pre><code>\u2026\u2026                   \n  cnt_r        &lt;= cnt_r + 1'b1 ;       //\u8ba1\u6570\u52a01 // \u975e\u963b\u585e\u8d4b\u503c\n\u2026\u2026  \n  assign  cout = (cnt_r==4'd9) ;       //\u8f93\u51fa\u5468\u671f\u4f4d // \u963b\u585e\u8d4b\u503c\n  assign  cnt  = cnt_r ;               //\u8f93\u51fa\u5b9e\u65f6\u8ba1\u65f6\u5668 // \u963b\u585e\u8d4b\u503c\n\u2026\u2026\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u5bf9\u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\u65f6\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a=\uff08\u963b\u585e\u8d4b\u503c\uff09\u548c&lt;=\uff08\u975e\u963b\u585e\u8d4b\u503c\uff09\u3002</p> <p>\u4e24\u8005\u7684\u533a\u522b\u5c31\u5728\u4e8e</p> <ol> <li>\u963b\u585e\u8d4b\u503c\u4f1a\u7acb\u5373\u8ba1\u7b97\u53f3\u624b\u8bed\u53e5\u503c\uff08RHS\uff09\u5e76\u7acb\u5373\u8d4b\u503c\u7ed9\u5de6\u624b\u8bed\u53e5\uff08LHS\uff09\uff0c \u800c\u4e14\u8fd9\u884c\u4ee3\u7801\u4e4b\u540e\u7684\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u53ea\u6709\u5b83\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u624d\u80fd\u591f\u7ee7\u7eed\u8fdb\u884c\u3002</li> <li>\u975e\u963b\u585e\u8d4b\u503c\u5c06\u8d4b\u503c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff1a\u8ba1\u7b97\u53f3\u8fb9RHS\uff0c\u66f4\u65b0\u5de6\u8fb9\uff08LHS\uff09\uff0c\u5e76\u4e14\u5176\u4ed6\u8bed\u53e5\u4e0d\u4f1a\u88ab\u5176\u6240\u963b\u585e\u3002\u975e\u963b\u585e\u8d4b\u503c\u53ea\u80fd\u7528\u4e8e\u5bf9\u5bc4\u5b58\u5668\u4fe1\u53f7\u8fdb\u884c\u8d4b\u503c\u3002</li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u963b\u585e\u8d4b\u503c\u53ef\u80fd\u4f1a\u9020\u6210\u6570\u636e\u7ade\u4e89\uff0c\u4f8b\u5982\u5b9e\u73b0\u5728\u4e0a\u5347\u6cbf\u65f6\u4ea4\u6362\u4e24\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\uff1a</p> <pre><code>always @(posedge clk) begin\n    a = b ;\nend\n\nalways @(posedge clk) begin\n    b = a;\nend\n</code></pre> <p>\u5982\u679c\u91c7\u7528\u4e0a\u8ff0\u963b\u585e\u8d4b\u503c\uff0c\u6700\u540ea b\u7684\u503c\u90fd\u4f1a\u76f8\u7b49\uff0c\u800c\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u4ea4\u6362\u3002\u4f46\u662f\u5982\u679c\u4f7f\u7528\u975e\u963b\u585e\u8d4b\u503c\u5c31\u6ca1\u6709\u8fd9\u4e2a\u987e\u8651\uff1a</p> <pre><code>always @(posedge clk) begin\n    a &lt;= b ;\nend\n\nalways @(posedge clk) begin\n    b &lt;= a;\nend\n</code></pre> </li> </ul> </li> <li> <p>assign</p> <p>\u5728Verilog\u4e2d\uff0c<code>assign</code>\u8bed\u53e5\u7528\u4e8e\u7ed9\u4e00\u4e2a\u7ebf\u7f51\uff08wire\uff09\u6216\u5bc4\u5b58\u5668\uff08reg\uff09\u8d4b\u503c\u3002</p> <p>\u5b83\u4e3b\u8981\u7528\u4e8e\u8fde\u63a5\u903b\u8f91\u95e8\u3001\u6a21\u5757\u5b9e\u4f8b\u6216\u4fe1\u53f7\uff0c\u4ece\u800c\u5b9e\u73b0\u7ec4\u5408\u903b\u8f91\u6216\u8fde\u7ebf\u529f\u80fd\u3002\uff08\u4e3b\u8981\u7528\u4e8e\u63cf\u8ff0\u7ec4\u5408\u903b\u8f91\u7535\u8def\uff09</p> <p><code>assign</code>\u8bed\u53e5\u5728Verilog\u4e2d\u662f\u4e00\u79cd\u8fde\u7eed\u8d4b\u503c\u8bed\u53e5\uff0c\u5b83\u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u90fd\u4f1a\u91cd\u65b0\u8ba1\u7b97\u5e76\u66f4\u65b0\u8d4b\u503c\u7ed3\u679c\u3002</p> <p><code>assign</code>\u8bed\u53e5\u901a\u5e38\u7528\u4e8e\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ol> <li>\u8fde\u63a5\u8f93\u5165\u8f93\u51fa\u7aef\u53e3\uff1a\u5c06\u6a21\u5757\u7684\u8f93\u5165\u8f93\u51fa\u7aef\u53e3\u4e0e\u5176\u4ed6\u4fe1\u53f7\u6216\u5bc4\u5b58\u5668\u8fde\u63a5\u8d77\u6765\u3002</li> <li>\u8fde\u63a5\u903b\u8f91\u95e8\uff1a\u5c06\u903b\u8f91\u95e8\u7684\u8f93\u51fa\u4e0e\u5176\u4ed6\u4fe1\u53f7\u8fde\u63a5\u8d77\u6765\u3002</li> <li>\u8fde\u63a5\u591a\u4e2a\u6a21\u5757\u5b9e\u4f8b\uff1a\u5c06\u591a\u4e2a\u6a21\u5757\u5b9e\u4f8b\u7684\u8f93\u51fa\u8fde\u63a5\u5230\u67d0\u4e2a\u4fe1\u53f7\u4e0a\u3002</li> <li>\u8fde\u63a5\u5185\u90e8\u4fe1\u53f7\uff1a\u5c06\u5185\u90e8\u4fe1\u53f7\u8fde\u63a5\u5230\u5176\u4ed6\u4fe1\u53f7\u6216\u5bc4\u5b58\u5668\u4e0a\u3002</li> </ol> <p>\u793a\u4f8b\uff1a <pre><code>module Adder (\n    input [3:0] A, B,\n    output [4:0] Sum\n);\n\nassign Sum = A + B;\n\nendmodule\n</code></pre></p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c<code>assign Sum = A + B;</code>\u8bed\u53e5\u5c06\u8f93\u5165\u7aef\u53e3A\u548cB\u7684\u503c\u76f8\u52a0\uff0c\u5e76\u5c06\u7ed3\u679c\u8d4b\u503c\u7ed9\u8f93\u51fa\u7aef\u53e3Sum\u3002\u8fd9\u6837\uff0c\u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\uff0cSum\u7684\u503c\u90fd\u4f1a\u6839\u636eA\u548cB\u7684\u503c\u91cd\u65b0\u8ba1\u7b97\u5e76\u66f4\u65b0\u3002</p> <p></p> </li> </ul> <p>verilog\u4e2dassign\u548calways@(*)\u7684\u533a\u522b\u548c\u6613\u5ffd\u7565\u7684\u70b9_verilog alway\u4fe1\u53f7 \u4fe1\u53f7\u4e3ax\u7684\u65f6\u5019-CSDN\u535a\u5ba2</p> <p>assign\u8bed\u53e5\u548calways@(*)\u7684\u5dee\u522b\uff08\u7ec4\u5408\u903b\u8f91\u5e38\u7528\u7684\u4e24\u79cd\u63cf\u8ff0\uff09\uff1a</p> <ol> <li> <p>\u88abassign\u8d4b\u503c\u7684\u4fe1\u53f7\u5b9a\u4e49\u4e3awire\u578b\uff0c\u88abalways@(*)\u7ed3\u6784\u5757\u4e0b\u7684\u4fe1\u53f7\u5b9a\u4e49\u4e3areg\u578b\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684reg\u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u89e6\u53d1\u5668\uff0c\u53ea\u6709\u654f\u611f\u5217\u8868\u4e3a\u4e0a\u5347\u6cbf\u89e6\u53d1\u7684\u5199\u6cd5\u624d\u4f1a\u7efc\u5408\u4e3a\u89e6\u53d1\u5668\uff0c\u5728\u4eff\u771f\u65f6\u624d\u5177\u6709\u89e6\u53d1\u5668\u7684\u7279\u6027\u3002</p> </li> <li> <p>\u7ec6\u5fae\u5dee\u522b\uff1a</p> <pre><code>wire a;\nreg b;\n\nassign a = 1'b0;\nalways@(*)\n    b = 1'b0;\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528vcs\u4eff\u771f\u65f6a\u5c06\u4f1a\u6b63\u5e38\u9a71\u52a8\u4e3a0\uff0c \u4f46\u662fb\u5374\u662f\u4e0d\u5b9a\u6001\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f</p> <p><code>verilog</code>\u89c4\u5b9a\uff0calways@( * )\u4e2d\u7684 <code>*</code>\u662f\u6307\u8be5always\u5757\u5185\u7684\u6240\u6709\u8f93\u5165\u4fe1\u53f7\u7684\u53d8\u5316\u4e3a\u654f\u611f\u5217\u8868\uff0c\u4e5f\u5c31\u662f\u4eff\u771f\u65f6\u53ea\u6709\u5f53always@(* )\u5757\u5185\u7684\u8f93\u5165\u4fe1\u53f7\u4ea7\u751f\u53d8\u5316\uff0c\u8be5\u5757\u5185\u63cf\u8ff0\u7684\u4fe1\u53f7\u624d\u4f1a\u4ea7\u751f\u53d8\u5316\uff0c</p> <p>\u800c\u50cf<code>always@(*) b = 1'b0;</code> \u8fd9\u79cd\u5199\u6cd5\u7531\u4e8e1'b0\u4e00\u76f4\u6ca1\u6709\u53d8\u5316\uff0c\u6240\u4ee5b\u7684\u4fe1\u53f7\u72b6\u6001\u4e00\u76f4\u6ca1\u6709\u6539\u53d8\uff0c\u7531\u4e8eb\u662f\u7ec4\u5408\u903b\u8f91\u8f93\u51fa\uff0c\u6240\u4ee5\u590d\u4f4d\u65f6\u6ca1\u6709\u660e\u786e\u7684\u503c\uff08\u4e0d\u5b9a\u6001\uff09\uff0c\u800c\u53c8\u56e0\u4e3aalways@(*)\u5757\u5185\u6ca1\u6709\u654f\u611f\u4fe1\u53f7\u53d8\u5316\uff0c\u56e0\u6b64b\u7684\u4fe1\u53f7\u72b6\u6001\u4e00\u76f4\u4fdd\u6301\u4e3a\u4e0d\u5b9a\u6001\u3002</p> <p>\u4e8b\u5b9e\u4e0a\u8be5\u8bed\u53e5\u7684\u7efc\u5408\u7ed3\u679c\u6709\u53ef\u80fd\u8ddfassign\u4e00\u6837\uff08\u672c\u4eba\u6ca1\u6709\u53bb\u5c1d\u8bd5\uff09\uff0c\u4f46\u662f\u5728\u529f\u80fd\u4eff\u771f\u65f6\u5c31\u5dee\u4e4b\u5343\u91cc\u4e86\u3002</p> </li> </ol> <p>\u5728 always @(*) \uff0c\u7ec4\u5408\u903b\u8f91\u5757\u4e2d\uff0c\u5de6\u8fb9\u7684\u53d8\u91cf\u8d4b\u503c\u4f7f\u7528reg\u7c7b\u578b\u7684\uff0c\u800c assign \u7684\u5de6\u8fb9\u53d8\u91cf\u4f7f\u7528 wire \u7c7b\u578b\u7684\u3002</p> <p>For combinational always blocks, always use a sensitivity list of <code>(*)</code>. Explicitly listing out the signals is error-prone (if you miss one), and is ignored for hardware synthesis. If you explicitly specify the sensitivity list and miss a signal, the synthesized hardware will still behave as though <code>(*)</code> was specified, but the simulation will not and not match the hardware's behaviour. (In SystemVerilog, use <code>always_comb</code>.)</p> <p>A note on wire vs. reg: The left-hand-side of an assign statement must be a net type (e.g., <code>wire</code>), while the left-hand-side of a procedural assignment (in an always block) must be a variable type (e.g., <code>reg</code>). These types (wire vs. reg) have nothing to do with what hardware is synthesized, and is just syntax left over from Verilog's use as a hardware simulation language.</p> <ul> <li> <p>\u51fd\u6570</p> <pre><code>    function [31:0] reverse;\n        input   [31:0]  in;\n        integer i;\n\n        for(i = 0; i &lt; 32; i++) begin\n            reverse[i] = in[31 - i];\n        end\n    endfunction\n</code></pre> <p>\u5728Verilog\u4e2d\uff0c<code>function</code>\u5173\u952e\u5b57\u7528\u4e8e\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\uff0c\u8fd9\u4e0eC\u8bed\u8a00\u4e2d\u7684\u51fd\u6570\u7c7b\u4f3c\uff0c\u4f46\u662f\u6709\u4e00\u4e9b\u533a\u522b\u3002\u51fd\u6570<code>reverse</code>\u662f\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5b83\u63a5\u53d7\u4e00\u4e2a32\u4f4d\u7684\u8f93\u5165<code>in</code>\uff0c\u5e76\u901a\u8fc7\u5faa\u73af\u5c06\u5176\u4f4d\u53cd\u8f6c\u3002</p> <p>Verilog\u4e2d\u7684\u51fd\u6570\u4e0d\u80fd\u5305\u542b<code>always</code>\u6216<code>assign</code>\u8bed\u53e5\uff0c\u5b83\u4eec\u901a\u5e38\u7528\u4e8e\u6267\u884c\u7b80\u5355\u7684\u8ba1\u7b97\u6216\u903b\u8f91\u64cd\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u88ab<code>always</code>\u6216<code>initial</code>\u5757\u8c03\u7528\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>reverse</code>\u51fd\u6570\u5c06\u8f93\u5165\u7684\u6bcf\u4e00\u4f4d\u4ece\u6700\u9ad8\u4f4d\u5230\u6700\u4f4e\u4f4d\u8fdb\u884c\u53cd\u8f6c\u3002</p> </li> </ul> <p>\u7279\u522b\u6ce8\u610f</p> <p>\u5728\u53ef\u7efc\u5408\u63cf\u8ff0\u91cc\uff0c\u53ea\u4f7f\u7528\u4e00\u4e0b\u56db\u4e2a\u5173\u952e\u5b57</p> <p><code>always</code> <code>if-else</code> <code>assign</code> <code>case</code></p> <p>\u5982\u679c\u7528\u5230\u4e86\u522b\u7684\uff0c\u90a3\u4e00\u5b9a\u662f\u4f60\u81ea\u5df1\u7684\u95ee\u9898</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_5","title":"\u7535\u8def\u63a5\u63cf\u8ff0\u65b9\u6cd5\uff08\u91cd\u8981\uff09","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#muxmultiplexing-hardware","title":"\u591a\u8def\u9009\u62e9\u5668\uff1aMUX\uff08Multiplexing Hardware\uff09","text":"<p>\u5982\u679c\u6709\u591a\u8def\uff0c\u591a\u4e2aif//\u6216\u8005case</p> <p>\u7535\u8def &lt;\u00a0== &gt; Verilog\u4ee3\u7801</p> <p>==&gt; \u53d8\u5f62</p> <p></p> <p>\u6ce8\u610f\u4e0a\u8ff0\u4e24\u79cd\u7535\u8def\u7684\u533a\u522b\uff0c\u5148\u9009\u540e\u52a0 / \u5148\u52a0\u540e\u9009</p> <p>\u7528\u5148\u9009\u540e\u52a0\u53ef\u4ee5\u5c11\u4e00\u4e2a\u52a0\u6cd5\u5668\uff0c\u8bbe\u8ba1\u51fa\u6765\u7684\u7535\u8def\u7684\u9762\u79ef\u66f4\u5c0f\uff0c</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_6","title":"\u89e6\u53d1\u5668\u548c\u9501\u5b58\u5668","text":"<p>Latch \u53ef\u4ee5\u76f4\u63a5\u7406\u89e3\u6210\u7ec4\u5408\u903b\u8f91\u7684\u7535\u8def\uff0c\u5c31\u662f\u8f93\u51fa\u8ddf\u968f\u8f93\u5165\uff08\u53ea\u662f\u4f1a\u6709\u5ef6\u8fdf\uff09</p> <p>\u5728\u8bbe\u8ba1\u65f6\u5e8f\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u5199latch</p> <p></p> <p></p> <p></p> <p>\u843d\u540e\u7684\u591a\u5c11\u4e2a\u65f6\u949f\u5468\u671f\u7531\u4f60\u81ea\u5df1\u8bbe\u8ba1</p> <p>\u5199\u7684\u65f6\u5e8f\u662f\u4ec0\u4e48\u6837\u7684\uff0c\u5c31\u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u7684</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_7","title":"\u7ec4\u5408\u903b\u8f91","text":"<p>\u5173\u4e8e\u4ec0\u4e48\u65f6\u5019\u7528 = \u548c &lt;=</p> <p>\u76f4\u63a5\u8bb0\u4f4f\uff1a</p> <p>\u7ec4\u5408\u903b\u8f91\u7528 =\uff08\u963b\u585e\u8d4b\u503c\uff09</p> <p>\u65f6\u5e8f\u903b\u8f91\u7528 &lt;= \uff08\u975e\u963b\u585e\u8d4b\u503c\uff09</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_8","title":"\u65f6\u5e8f\u903b\u8f91","text":"<p>\u7ec4\u5408\u903b\u8f91 + \u89e6\u53d1\u5668</p> <p></p> <p>\u200b    </p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_9","title":"\u5b58\u50a8\u5668","text":"<p>\u7406\u89e3\u6210\u4e8c\u7ef4\u6570\u7ec4</p> <p></p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_10","title":"\u6d41\u6c34\u7ebf\u8bbe\u8ba1","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_11","title":"\u53c2\u6570\u5316","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_12","title":"\u6a21\u5757\u5b9e\u4f8b\u5316","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_13","title":"\u4ee3\u7801\u89c4\u8303","text":"<p>Verilog\u4ee3\u7801\u89c4\u8303 - \u6570\u5b57\u903b\u8f91\u8bbe\u8ba1\uff082023\u79cb\u5b63\uff09  \u54c8\u5de5\u5927\uff08\u6df1\u5733\uff09 (gitee.io)</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#hdl","title":"HDL \u5237\u9898","text":"<ul> <li> <p>\u6761\u4ef6\u8fd0\u7b97\u7b26</p> <p>\u540c C \u8bed\u8a00\u3002</p> </li> <li> <p>\u7f29\u51cf\u8fd0\u7b97\u7b26</p> <p>\u662f\u7684\uff0c\u60a8\u8fd9\u6837\u5199\u662f\u53ef\u4ee5\u7684\u3002\u5728Verilog\u4e2d\uff0c<code>^</code> \u7528\u4f5c\u6309\u4f4d\u5f02\u6216\uff08XOR\uff09\u64cd\u4f5c\u7b26\u3002\u5f53\u5e94\u7528\u4e8e\u4e00\u4e2a\u5411\u91cf\u65f6\uff0c\u5b83\u5c06\u5bf9\u5411\u91cf\u4e2d\u7684\u6bcf\u4e00\u4f4d\u6267\u884c\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\uff0c\u5e76\u4ea7\u751f\u4e00\u4e2a\u5411\u91cf\u4f5c\u4e3a\u7ed3\u679c\u3002\u7136\u800c\uff0c\u5f53\u60a8\u4f7f\u7528 <code>^</code> \u64cd\u4f5c\u7b26\u5bf9\u4e00\u4e2a\u5411\u91cf\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u7ed3\u679c\u5411\u91cf\u7684\u957f\u5ea6\u5c06\u4e0e\u8f93\u5165\u5411\u91cf\u7684\u957f\u5ea6\u76f8\u540c\u3002</p> <p>\u5728\u60a8\u7684\u4f8b\u5b50\u4e2d\uff0c<code>in</code> \u662f\u4e00\u4e2a8\u4f4d\u5bbd\u7684\u8f93\u5165\u5411\u91cf\uff0c\u5982\u679c\u60a8\u76f4\u63a5\u4f7f\u7528 <code>^in</code>\uff0c\u7ed3\u679c <code>parity</code> \u5c06\u662f\u4e00\u4e2a8\u4f4d\u5bbd\u7684\u5411\u91cf\uff0c\u800c\u4e0d\u662f1\u4f4d\u3002\u4f46\u662f\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u7f29\u51cf\u64cd\u4f5c\u7b26 <code>^</code> \u6765\u5bf9\u6574\u4e2a\u5411\u91cf\u6267\u884c\u7f29\u51cf\u5f02\u6216\u64cd\u4f5c\uff0c\u8fd9\u6837\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5355\u6bd4\u7279\u7684\u8f93\u51fa\uff0c\u8868\u793a\u6574\u4e2a\u5411\u91cf\u7684\u5f02\u6216\u7ed3\u679c\u3002\u7f29\u51cf\u5f02\u6216\u64cd\u4f5c\u7684\u7ed3\u679c\u662f1\u4f4d\u5bbd\u7684\uff0c\u8868\u793a\u8f93\u5165\u5411\u91cf\u4e2d1\u7684\u5947\u5076\u6027\uff1a</p> <ul> <li>\u5982\u679c\u8f93\u5165\u5411\u91cf\u4e2d\u6709\u5947\u6570\u4e2a1\uff0c\u5219\u7ed3\u679c\u4e3a1\uff08\u5947\u6570\u4e2a1\u4ea7\u751f\u5076\u6570\u4e2a0\uff09\u3002</li> <li>\u5982\u679c\u8f93\u5165\u5411\u91cf\u4e2d\u6709\u5076\u6570\u4e2a1\uff0c\u5219\u7ed3\u679c\u4e3a0\uff08\u5076\u6570\u4e2a1\u4ea7\u751f\u5076\u6570\u4e2a0\uff09\u3002</li> </ul> <p>\u8fd9\u662f\u7f29\u51cf\u5f02\u6216\u64cd\u4f5c\u7b26\u7684\u7528\u6cd5\uff0c\u5b83\u5c06\u4ea7\u751f\u4e00\u4e2a\u5355\u6bd4\u7279\u7684\u5947\u5076\u6821\u9a8c\u4f4d\uff1a</p> <pre><code>input [7:0] in,\noutput parity;\n\nassign parity = ^in; // \u4f7f\u7528\u7f29\u51cf\u5f02\u6216\u64cd\u4f5c\u7b26\u6765\u8ba1\u7b978\u4f4d\u8f93\u5165\u7684\u5947\u5076\u6027\n</code></pre> <p>\u8fd9\u6837\uff0c<code>parity</code> \u5c06\u662f\u4e00\u4e2a1\u4f4d\u5bbd\u7684\u8f93\u51fa\uff0c\u8868\u793a\u8f93\u5165\u5411\u91cf\u7684\u5947\u5076\u6027\u3002\u8fd9\u662f\u8ba1\u7b97\u5947\u5076\u6821\u9a8c\u4f4d\u7684\u5e38\u89c1\u65b9\u6cd5\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u68c0\u6d4b\u6570\u636e\u4e2d\u662f\u5426\u51fa\u73b0\u9519\u8bef\u7684\u60c5\u51b5\u4e0b\u3002</p> </li> <li> <p>\u53cd\u8f6c\u6bcf\u4e00\u4f4d</p> </li> <li> <p>1\u7684\u8ba1\u6570\u5668</p> <pre><code>module top_module( \n    input [254:0] in,\n    output [7:0] out );\n\n    int i;\n\n    always @(*) begin\n        out = 8'd0;\n        for (i = 0; i &lt; 255; i++) begin \n            out += (in[i] == 1'b1);\n        end\n    end\n\n\nendmodule\n</code></pre> <p>\u867d\u7136\u8fc7\u4e86\uff0c\u53ef\u80fd\u6709\u95ee\u9898\u3002</p> </li> <li> <p>\u5b9e\u4f8b\u5316 100\u4e2a\u52a0\u6cd5\u5668</p> <p>Create a 100-bit binary ripple-carry adder by instantiating 100 full adders. The adder adds two 100-bit numbers and a carry-in to produce a 100-bit sum and carry out. To encourage you to actually instantiate full adders, also output the carry-out from each full adder in the ripple-carry adder. cout[99] is the final carry-out from the last full adder, and is the carry-out you usually see.</p> <pre><code>module top_module( \n    input [99:0] a, b,\n    input cin,\n    output [99:0] cout,\n    output [99:0] sum );\n\n    genvar i;\n    generate \n        for (i = 0; i &lt; 100; i++) begin: full_adder\n            if (i == 0) begin \n                assign {cout[0], sum[0]} = a[0] + b[0] + cin; \n            end else begin \n                assign {cout[i], sum[i]} = a[i] + b[i] + cout[i -1];\n            end\n        end\n    endgenerate\n\nendmodule\n</code></pre> <p>\u7528\u7528chisel\uff1f</p> </li> <li> <p>\u5b9e\u4f8b\u5316 100\u4e2a BCD \u52a0\u6cd5\u5668</p> <p>\u5728Verilog\u4e2d\uff0c<code>generate</code> \u548c <code>endgenerate</code> \u662f\u7528\u4e8e\u521b\u5efa\u5faa\u73af\u7ed3\u6784\u6216\u6761\u4ef6\u5b9e\u4f8b\u5316\u7684\u8bed\u6cd5\u3002\u8fd9\u79cd\u7ed3\u6784\u5141\u8bb8\u4f60\u91cd\u590d\u76f8\u540c\u7684\u786c\u4ef6\u6a21\u5757\u591a\u6b21\uff0c\u6216\u8005\u6839\u636e\u4e0d\u540c\u7684\u6761\u4ef6\u6765\u5b9e\u4f8b\u5316\u4e0d\u540c\u7684\u6a21\u5757\u3002\u8fd9\u5728\u521b\u5efa\u5927\u578b\u6570\u7ec4\u6216\u6839\u636e\u4e0d\u540c\u6761\u4ef6\u751f\u6210\u4e0d\u540c\u6a21\u5757\u65f6\u975e\u5e38\u6709\u7528\u3002</p> <pre><code>module top_module( \n    input [399:0] a, b,\n    input cin,\n    output cout,\n    output [399:0] sum );\n\n    wire [99:0] cin_cout;\n    genvar i;\n    generate \n        for (i = 0; i &lt; 100; i++) begin: full_adder\n            if (i == 0) begin \n                bcd_fadd adder1(\n                    .a(a[3:0]),\n                    .b(b[3:0]),\n                    .cin(cin),\n                    .cout(cin_cout[0]),\n                    .sum(sum[3:0])\n                );\n            end else begin \n                bcd_fadd adder2(\n                    .a(a[4 * i + 3:i * 4]),\n                    .b(b[4 * i + 3:i * 4]),\n                    .cin(cin_cout[i - 1]),\n                    .cout(cin_cout[i]),\n                    .sum(sum[4 * i + 3:i * 4])\n                );\n            end\n        end\n        assign cout = cin_cout[99];\n    endgenerate\n\nendmodule\n</code></pre> </li> <li> <p>\u5dee\u4f4d\u6bd4\u8f83</p> <p>You are given a four-bit input vector in[3:0]. We want to know some relationships between each bit and its neighbour:</p> <ul> <li>out_both: Each bit of this output vector should indicate whether both the corresponding input bit and its neighbour to the left (higher index) are '1'. For example, <code>out_both[2]</code> should indicate if <code>in[2]</code> and <code>in[3]</code> are both 1. Since <code>in[3]</code> has no neighbour to the left, the answer is obvious so we don't need to know <code>out_both[3]</code>.</li> <li>out_any: Each bit of this output vector should indicate whether any of the corresponding input bit and its neighbour to the right are '1'. For example, <code>out_any[2]</code> should indicate if either <code>in[2]</code> or <code>in[1]</code> are 1. Since <code>in[0]</code> has no neighbour to the right, the answer is obvious so we don't need to know <code>out_any[0]</code>.</li> <li>out_different: Each bit of this output vector should indicate whether the corresponding input bit is different from its neighbour to the left. For example, <code>out_different[2]</code> should indicate if <code>in[2]</code> is different from <code>in[3]</code>. For this part, treat the vector as wrapping around, so <code>in[3]</code>'s neighbour to the left is <code>in[0]</code>.</li> </ul> <pre><code>module top_module( \n    input [3:0] in,\n    output [2:0] out_both,\n    output [3:1] out_any,\n    output [3:0] out_different );\n\n\n    assign out_both = in[3:1] &amp; in[2:0];\n    assign out_any = in[3:1] | in[2:0];\n    assign out_different = {in[0], in[3:1]} ^ in;\n\n\nendmodule\n</code></pre> <p>\u540e\u9762\u7684100\u4f4d\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u5c31\u662fVerilog \u7684\u80fd\u529b\u5417\uff1f\u4e0d\u540c\u4e8eC\uff0cVerilog \u5bf9bit\u7684\u64cd\u4f5c\uff08\u5207\u7247\u64cd\u4f5c\uff09\u66f4\u52a0\u7075\u6d3b\uff0c\u60f3\u77e5\u9053chisel\u6709\u4ec0\u4e48\u522b\u7684\u597d\u73a9\u7684\u3002</p> </li> <li> <p>\u9009\u62e9\u5668</p> <pre><code>module top_module (\n    input [15:0] a,\n    input [15:0] b,\n    input [15:0] c,\n    input [15:0] d,\n    input [15:0] e,\n    input [15:0] f,\n    input [15:0] g,\n    input [15:0] h,\n    input [15:0] i,\n    input [3:0] sel,\n    output logic [15:0] out\n);\n\n    // Case statements can only be used inside procedural blocks (always block)\n    // This is a combinational circuit, so use a combinational always @(*) block.\n    always @(*) begin\n        out = '1;       // '1 is a special literal syntax for a number with all bits set to 1.\n                        // '0, 'x, and 'z are also valid.\n                        // I prefer to assign a default value to 'out' instead of using a\n                        // default case.\n        case (sel)\n            4'h0: out = a;\n            4'h1: out = b;\n            4'h2: out = c;\n            4'h3: out = d;\n            4'h4: out = e;\n            4'h5: out = f;\n            4'h6: out = g;\n            4'h7: out = h;\n            4'h8: out = i;\n        endcase\n    end\n\nendmodule\n</code></pre> </li> <li> <p>256 bit -&gt; 1bit</p> <p>Create a 1-bit wide, 256-to-1 multiplexer. The 256 inputs are all packed into a single 256-bit input vector. sel=0 should select <code>in[0]</code>, sel=1 selects bits <code>in[1]</code>, sel=2 selects bits <code>in[2]</code>, etc.</p> <p>Expected solution length: Around 1 line.</p> <pre><code>module top_module( \n    input [255:0] in,\n    input [7:0] sel,\n    output out );\n\n    assign out = in[sel];\n\nendmodule\n</code></pre> </li> <li> <p>256 bit -&gt; 4bit</p> <p>Create a 4-bit wide, 256-to-1 multiplexer. The 256 4-bit inputs are all packed into a single 1024-bit input vector. sel=0 should select bits <code>in[3:0]</code>, sel=1 selects bits <code>in[7:4]</code>, sel=2 selects bits <code>in[11:8]</code>, etc.</p> <p>Expected solution length: Around 1\u20135 lines.</p> <pre><code>module top_module( \n    input [1023:0] in,\n    input [7:0] sel,\n    output [3:0] out );\n\n\n    // new syntax\n    //assign out = in[sel * 4 +: 4];\n\n    //second way\n    assign out = {in[sel * 4 + 3], in[sel * 4 + 2], in[sel * 4 + 1], in[sel * 4]};\n\nendmodule\n</code></pre> <p>\u8fd9\u79cd\u5199\u6cd5\u662fverilog 2001\u6807\u51c6\u4e2d\u65b0\u589e\u52a0\u7684\uff0c\u662f\u5411\u91cf\u90e8\u5206\u9009\u62e9\u7684\u610f\u601d\uff0c\u5982\u679csel\u7b49\u4e8e0\uff0cin[sel * 4 +: 4]\u4ee3\u8868\u4ece0\u5f00\u59cb\u5411\u4e0a\u65704\u4f4d\uff0c\u5373in[3:0]\uff0c\u5efa\u8bae\u5927\u5bb6\u5b66\u4e60\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5728sel\u4f4d\u5bbd\u8f83\u5927\u662f\u53ef\u4ee5\u6709\u6548\u51cf\u5c0f\u5de5\u4f5c\u91cf\u3002</p> </li> <li> <p>3-bits full adder</p> <p>Now that you know how to build a full adder, make 3 instances of it to create a 3-bit binary ripple-carry adder. The adder adds two 3-bit numbers and a carry-in to produce a 3-bit sum and carry out. To encourage you to actually instantiate full adders, also output the carry-out from each full adder in the ripple-carry adder. cout[2] is the final carry-out from the last full adder, and is the carry-out you usually see.</p> <pre><code>module top_module( \n    input [2:0] a, b,\n    input cin,\n    output [2:0] cout,\n    output [2:0] sum );\n\n    full_adder adder_1(\n        .a(a[0]),\n        .b(b[0]),\n        .cin(cin),\n        .cout(cout[0]),\n        .sum(sum[0])\n    );\n\n    full_adder adder_2(\n        .a(a[1]),\n        .b(b[1]),\n        .cin(cout[0]),\n        .cout(cout[1]),\n        .sum(sum[1])\n    );    \n\n    full_adder adder_3(\n        .a(a[2]),\n        .b(b[2]),\n        .cin(cout[1]),\n        .cout(cout[2]),\n        .sum(sum[2])\n    );        \n\nendmodule\n\n\nmodule full_adder(\n    input a,\n    input b,\n    input cin,\n    output cout,\n    output sum\n);\n    assign cout = ((a ^ b) &amp; cin) | (a &amp; b);\n    assign sum = a ^ b ^ cin;\nendmodule\n</code></pre> </li> <li> <p>overflow</p> <p>\u4e3a\u4e86\u68c0\u6d4b8\u4f4d2\u7684\u8865\u6570\u8868\u793a\u7684\u6709\u7b26\u53f7\u6570\u76f8\u52a0\u65f6\u662f\u5426\u6ea2\u51fa\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\uff1a</p> <ol> <li>\u901a\u8fc7\u7b26\u53f7\u6bd4\u8f83\uff1a\u68c0\u67e5 <code>a</code> \u548c <code>b</code> \u7684\u7b26\u53f7\u662f\u5426\u76f8\u540c\uff0c\u4ee5\u53ca\u7ed3\u679c <code>s</code> \u7684\u7b26\u53f7\u662f\u5426\u4e0d\u540c\u3002\u5982\u679c\u662f\u8fd9\u6837\uff0c\u5c31\u53d1\u751f\u4e86\u6ea2\u51fa\u3002</li> <li>\u4f7f\u7528\u8fdb\u4f4d\u4f4d\uff1a\u57288\u4f4d\u52a0\u6cd5\u4e2d\uff0c\u5982\u679c\u6700\u9ad8\u4f4d\u7684\u8fdb\u4f4d\uff08\u6765\u81ea\u4f4d7\u5230\u4f4d8\u7684\u8fdb\u4f4d\uff09\u4e0e\u6b21\u9ad8\u5730\u4f4d\uff08\u4f4d7\uff09\u7684\u8fdb\u4f4d\u4e0d\u540c\uff0c\u90a3\u4e48\u5c31\u4f1a\u6ea2\u51fa\u3002</li> </ol> <pre><code>module top_module (\n    input [7:0] a,\n    input [7:0] b,\n    output [7:0] s,\n    output overflow\n); //\n\n    assign s = a + b;\n\n    assign overflow = (a[7] == b[7]) &amp;&amp; (a[7] != s[7]);\n\n    //assign overflow = (a[7] &amp; b[7] &amp; ~s[7]) | (~a[7] &amp; ~b[7] &amp; s[7]);\n\nendmodule\n</code></pre> </li> <li> <p>100 bits fuller-adder</p> <pre><code>module top_module( \n    input [99:0] a, b,\n    input cin,\n    output cout,\n    output [99:0] sum );\n\n    wire [98:0] tmp_cout;\n    genvar i;\n    generate \n        for (i = 0; i &lt; 100; i++) begin : adder\n            if (i == 0) begin \n                full_adder adder_0(\n                    .a(a[0]),\n                    .b(b[0]),\n                    .cin(cin),\n                    .cout(tmp_cout[0]),\n                    .sum(sum[0])\n                );\n            end else if (i == 99) begin\n                full_adder adder_1(\n                    .a(a[99]),\n                    .b(b[99]),\n                    .cin(tmp_cout[98]),\n                    .cout(cout),\n                    .sum(sum[99])\n                );\n            end else begin\n                full_adder adder_2(\n                    .a(a[i]),\n                    .b(b[i]),\n                    .cin(tmp_cout[i - 1]),\n                    .cout(tmp_cout[i]),\n                    .sum(sum[i])\n                );\n            end\n        end\n\n    endgenerate\n\nendmodule\n\n\nmodule full_adder(\n    input a,\n    input b,\n    input cin,\n    output cout,\n    output sum\n);\n    assign cout = ((a ^ b) &amp; cin) | (a &amp; b);\n    assign sum = a ^ b ^ cin;\nendmodule\n</code></pre> </li> <li> <p>BCD adder</p> <pre><code>module bcd_fadd(\n    input [3:0] a,\n    input [3:0] b,\n    input     cin,\n    output   cout,\n    output [3:0] sum\n);\n\n    // \u5b9a\u4e49\u4e2d\u95f4\u53d8\u91cf\n    wire [3:0] temp_sum;\n    wire [2:0] temp_cout;\n\n    // \u5b9e\u73b04\u4e2a1\u4f4d\u5168\u52a0\u5668\n    genvar i;\n    generate\n        for (i = 0; i &lt; 4; i++) begin : bcd_adder\n            full_adder fa(\n                .a(a[i]),\n                .b(b[i]),\n                .cin((i == 0) ? cin : temp_cout[i-1]),\n                .cout(temp_cout[i]),\n                .sum(temp_sum[i])\n            );\n        end\n    endgenerate\n\n    // \u68c0\u67e5\u662f\u5426\u6709\u8fdb\u4f4d\u9700\u8981\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u9ad8\u4f4d\n    assign cout = (temp_cout[3] | cin) &amp; !(temp_sum[3] &amp; temp_sum[2] &amp; temp_sum[1] &amp; temp_sum[0]);\n\n    // \u4fee\u6b63sum\u4ee5\u786e\u4fdd\u5b83\u662fBCD\u683c\u5f0f\n    assign sum = temp_sum + 4'b1000 * (!(temp_sum &lt; 4'b1001) &amp; (temp_cout[3] | cin));\n\nendmodule\n\nmodule full_adder(\n    input a, b, cin,\n    output sum, cout\n);\n    assign {cout, sum} = a + b + cin;\nendmodule\n</code></pre> </li> <li> <p>\u4e0a\u5347\u6cbf\u68c0\u6d4b\u7535\u8def</p> <pre><code>module top_module (\n    input clk,\n    input [7:0] in,\n    output [7:0] pedge\n);\n    reg [7:0] in_last;\n\n    always @(posedge clk) begin\n        in_last &lt;= in;\n    end\n\n    always@(posedge clk)begin\n        // \u68c0\u6d4b\u5230\u6b63\u8df3\u53d8\n        pedge &lt;= in &amp; ~in_last;\n    end\n\n\n\nendmodule\n</code></pre> <ul> <li><code>in_last</code> \u662f\u4e00\u4e2a\u5bc4\u5b58\u5668\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u4e0a\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u7684 <code>in</code> \u4fe1\u53f7\u7684\u503c\u3002</li> <li>\u5728\u6bcf\u4e2a\u65f6\u949f\u4e0a\u5347\u6cbf\uff0c<code>in_last</code> \u88ab\u66f4\u65b0\u4e3a\u5f53\u524d\u7684 <code>in</code> \u503c\u3002</li> <li>\u7136\u540e\uff0c\u901a\u8fc7\u6bd4\u8f83\u5f53\u524d\u7684 <code>in</code> \u503c\u548c <code>in_last</code>\uff0c\u68c0\u6d4b\u6bcf\u4e00\u4f4d\u662f\u5426\u53d1\u751f\u4e86\u6b63\u8df3\u53d8\u3002</li> <li>\u5982\u679c\u68c0\u6d4b\u5230\u6b63\u8df3\u53d8\uff08\u5373\u5f53\u524d\u4f4d\u662f1\uff0c\u800c\u4e0a\u4e00\u4e2a\u5468\u671f\u662f0\uff09\uff0c\u5219\u5c06 <code>pedge</code> \u5bf9\u5e94\u7684\u4f4d\u8bbe\u7f6e\u4e3a1\u3002 <code>in &amp; ~in_last;</code></li> <li><code>pedge</code> \u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u5f00\u59cb\u65f6\u88ab\u91cd\u7f6e\uff0c\u4ee5\u786e\u4fdd\u53ea\u53cd\u6620\u6700\u8fd1\u4e00\u6b21\u7684\u8df3\u53d8\u3002</li> </ul> <p>\u540c\u7406\uff0c\u4e0b\u964d\u6cbf\u68c0\u6d4b\uff1a <code>~in &amp; in_last</code></p> </li> <li> <p>\u53cc\u8fb9\u6cbf\u68c0\u6d4b</p> <pre><code>module top_module (\n    input clk,\n    input [7:0] in,\n    output [7:0] anyedge\n);\n\n    reg [7:0] in_last;\n    always@(posedge clk)begin\n        in_last &lt;= in;\n    end\n\n    always@(posedge clk)begin\n        anyedge = in ^ in_last;\n    end\n\nendmodule\n</code></pre> <p>\u8ba1\u7b97 <code>in</code> \u548c <code>in_last</code> \u7684\u6309\u4f4d\u5f02\u6216\uff08XOR\uff09\u3002</p> <p>\u5f02\u6216\u64cd\u4f5c\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u4f4d\u5411\u91cf\uff0c\u5176\u4e2d\u6bcf\u4e00\u4f4d\u8868\u793a\u8f93\u5165\u5728\u76f8\u5e94\u4f4d\u4e0a\u662f\u5426\u53d1\u751f\u4e86\u53d8\u5316\uff1a</p> <ul> <li>\u5982\u679c\u8f93\u5165\u4f4d\u6ca1\u6709\u53d8\u5316\uff08\u4fdd\u63010\u62161\uff09\uff0c\u5219\u8be5\u4f4d\u7ed3\u679c\u4e3a0\u3002</li> <li>\u5982\u679c\u8f93\u5165\u4f4d\u53d1\u751f\u4e86\u53d8\u5316\uff08\u4ece0\u53d8\u4e3a1\u6216\u4ece1\u53d8\u4e3a0\uff09\uff0c\u5219\u8be5\u4f4d\u7ed3\u679c\u4e3a1\u3002</li> </ul> </li> <li> <p>\u8fb9\u6cbf\u6355\u83b7\u5bc4\u5b58\u5668</p> <p>For each bit in a 32-bit vector, capture when the input signal changes from 1 in one clock cycle to 0 the next. \"Capture\" means that the output will remain 1 until the register is reset (synchronous reset).</p> <p>Each output bit behaves like a SR flip-flop: The output bit should be set (to 1) the cycle after a 1 to 0 transition occurs. The output bit should be reset (to 0) at the positive clock edge when reset is high. If both of the above events occur at the same time, reset has precedence. In the last 4 cycles of the example waveform below, the 'reset' event occurs one cycle earlier than the 'set' event, so there is no conflict here.</p> <p>In the example waveform below, reset, in[1] and out[1] are shown again separately for clarity.</p> <p></p> <p>\u9898\u76ee\u8981\u6c42\u7684\u4e0d\u53ea\u662f\u4e0b\u964d\u6cbf\u68c0\u6d4b\uff0c\u5373\u8f93\u51fa\u4e0d\u53ea\u662f\u8109\u51b2\u4fe1\u53f7\uff0c\u800c\u662f\u68c0\u6d4b\u5230\u4e00\u6b21\u4e0b\u964d\u6cbf\u5c31\u4e00\u76f4\u5c06\u8f93\u51fa\u4fdd\u6301\u4e3a\u9ad8\u7535\u5e73\u3002</p> <pre><code>module top_module (\n    input clk,\n    input reset,\n    input [31:0] in,\n    output [31:0] out\n);\n    reg [31:0] in_last;\n    always @(posedge clk) begin\n         in_last &lt;= in;\n    end\n\n    always @(posedge clk) begin\n        if (reset) begin\n            out &lt;= 32'b0; \n        end else begin\n            // \u4f7f\u7528 | \u6216\u8d4b\u503c\u64cd\u4f5c\u7b26\u6765\u66f4\u65b0 out\uff0c\u8fd9\u6837\u5982\u679c out \u4e2d\u7684\u67d0\u4f4d\u5df2\u7ecf\u662f1\uff0c\u5b83\u5c06\u4fdd\u6301\u4e3a1\u3002\n            out &lt;= out | (~in &amp; in_last);\n        end\n    end\n\nendmodule\n</code></pre> <ul> <li>\u5b58\u50a8\u4e0a\u4e00\u4e2a\u5468\u671f\u7684\u8f93\u5165\u503c\uff1ain_last</li> <li>\u5982\u679c <code>reset</code> \u4fe1\u53f7\u5728\u4efb\u4f55\u65f6\u949f\u5468\u671f\u4e3a\u9ad8\uff0c\u5219 <code>out</code> \u5e94\u7acb\u5373\u88ab\u6e05\u96f6\u3002\u8fd9\u5e94\u8be5\u5728\u68c0\u67e5\u8f93\u5165\u4fe1\u53f7\u53d8\u5316\u4e4b\u524d\u5b8c\u6210\u3002</li> <li>\u4fdd\u6301\u8f93\u51fa\u72b6\u6001\uff0c\u4f7f\u7528 <code>|=</code> \uff08\u6216\u8d4b\u503c\uff09\u64cd\u4f5c\u7b26\u6765\u66f4\u65b0 <code>out</code>\uff0c\u8fd9\u6837\u5982\u679c <code>out</code> \u4e2d\u7684\u67d0\u4f4d\u5df2\u7ecf\u662f1\uff0c\u5b83\u5c06\u4fdd\u6301\u4e3a1\u3002\u77e5\u9053\u590d\u4f4d\u4e8b\u4ef6\u53d1\u751f\u3002</li> <li>\u5728\u590d\u4f4d\u6761\u4ef6\u4e4b\u5916\uff0c\u4f7f\u7528 <code>(~in) &amp; in_last</code> \u6765\u68c0\u6d4b1\u52300\u7684\u8f6c\u6362\u3002</li> <li>\u786e\u4fdd\u590d\u4f4d\u4f18\u5148\uff0c\u5e76\u5728\u68c0\u6d4b\u52301\u52300\u7684\u8f6c\u6362\u540e\u4fdd\u6301\u8f93\u51fa\u72b6\u6001\uff0c\u76f4\u5230\u590d\u4f4d\u4e8b\u4ef6\u53d1\u751f\u3002</li> </ul> </li> <li> <p>\u6a21\u62df\u53cc\u8fb9\u6cbf\u89e6\u53d1\uff1a<code>Dualedge</code></p> <p>\u4ee3\u7801\u5206\u6790\uff1a\u4e0d\u540c\u5c31\u7528 \u5f02\u6216\u3002</p> <ul> <li>\u7b2c\u4e00\u4e2a <code>always</code> \u5757\u5728 <code>clk</code> \u7684\u4e0a\u5347\u6cbf\u89e6\u53d1\uff0c\u66f4\u65b0 <code>q_neg</code> \u7684\u503c\u3002\u5b83\u4f7f\u7528 <code>q_pos</code> \u548c\u5f53\u524d\u7684\u8f93\u5165 <code>d</code> \u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\uff0c\u5c06\u7ed3\u679c\u5b58\u50a8\u5728 <code>q_neg</code> \u4e2d\u3002</li> <li>\u7b2c\u4e8c\u4e2a <code>always</code> \u5757\u5728 <code>clk</code> \u7684\u4e0b\u964d\u6cbf\u89e6\u53d1\uff0c\u66f4\u65b0 <code>q_pos</code> \u7684\u503c\u3002\u5b83\u4f7f\u7528 <code>q_neg</code> \u548c\u5f53\u524d\u7684\u8f93\u5165 <code>d</code> \u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\uff0c\u5c06\u7ed3\u679c\u5b58\u50a8\u5728 <code>q_pos</code> \u4e2d\u3002</li> <li><code>assign</code> \u8bed\u53e5\u5c06 <code>q</code> \u7684\u503c\u8bbe\u7f6e\u4e3a <code>q_pos</code> \u548c <code>q_neg</code> \u7684\u5f02\u6216\u7ed3\u679c\u3002</li> </ul> <p>\u8fd9\u79cd\u65b9\u6cd5\u80fd\u591f\u5b9e\u73b0\u53cc\u6cbf\u89e6\u53d1\u7684\u6548\u679c\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u89e6\u53d1\u5668\u5728\u65f6\u949f\u4fe1\u53f7\u7684\u76f8\u53cd\u8fb9\u7f18\u89e6\u53d1\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u72b6\u6001\u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u5185\u76f8\u4e92\u66f4\u65b0\u3002\u8fd9\u6837\uff0c\u65e0\u8bba\u65f6\u949f\u4fe1\u53f7\u662f\u4e0a\u5347\u8fd8\u662f\u4e0b\u964d\uff0c\u8f93\u5165 <code>d</code> \u7684\u53d8\u5316\u90fd\u80fd\u88ab\u6355\u6349\u5e76\u53cd\u6620\u5230\u8f93\u51fa <code>q</code>\u3002</p> <pre><code>module top_module (\n    input clk,\n    input d,\n    output q\n);\n\n    reg q_pos;\n    reg q_neg;\n    always @(posedge clk) begin\n        q_neg &lt;= q_pos ^ d; \n    end\n\n    always @(negedge clk) begin\n        q_pos &lt;= q_neg ^ d; \n    end \n\n    assign q = q_pos ^ q_neg;\n\n\nendmodule\n\n\nothers:\n    /*\n    //second way\n    always@(posedge clk)begin\n        q_d1 &lt;= d;\n    end\n\n    always@(negedge clk)begin\n        q_d2 &lt;= d;\n    end\n\n    assign q = clk ? q_d1 : q_d2;\n    */\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u6700\u540e\u4e00\u4e2a <code>always</code> \u5757\u7528\u4e8e\u786e\u4fdd <code>q</code> \u59cb\u7ec8\u662f <code>q_pos</code> \u548c <code>q_neg</code> \u7684\u6700\u65b0\u5f02\u6216\u7ed3\u679c\u3002\u8fd9\u4e2a <code>always</code> \u5757\u5bf9 <code>q_pos</code> \u6216 <code>q_neg</code> \u7684\u4efb\u4f55\u53d8\u5316\u90fd\u654f\u611f\uff0c\u4f46\u5b83\u4e0d\u4f1a\u5728\u65f6\u949f\u8fb9\u6cbf\u89e6\u53d1\uff0c\u56e0\u6b64\u4e0d\u4f1a\u8fdd\u53cdFPGA\u7684\u65f6\u949f\u7ea6\u675f\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u7684\u4e00\u4e2a\u5173\u952e\u70b9\u662f\u786e\u4fdd <code>q_pos</code> \u548c <code>q_neg</code> \u5728\u4e0d\u540c\u7684\u65f6\u949f\u8fb9\u7f18\u66f4\u65b0\uff0c\u8fd9\u6837\u5b83\u4eec\u5c31\u4e0d\u4f1a\u540c\u65f6\u6539\u53d8\uff0c\u4ece\u800c\u907f\u514d\u4e86\u7ade\u4e89\u6761\u4ef6\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5141\u8bb8 <code>q</code> \u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u7684\u4e0a\u5347\u6cbf\u548c\u4e0b\u964d\u6cbf\u90fd\u53cd\u6620\u51fa <code>d</code> \u7684\u6700\u65b0\u72b6\u6001\u3002</p> <p>\u8fd9\u91cc\u6ce8\u610f\uff1a</p> <ul> <li> <p>\u5bf9\u4e8e\u53cc\u6cbf\u68c0\u6d4b\uff0c\u4e00\u5b9a\u4e0d\u80fd\u4f7f\u7528 <code>always@(posedge clk or negedge clk)</code>\u8fd9\u79cd\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u4e0d\u53ef\u7efc\u5408\u7684\u3002</p> </li> <li> <p>\u53e6\u5916\uff1aothers \u7684\u65b9\u6cd5\u4f1a\u5728 <code>modelsim</code> \u548c <code>vivado</code> \u4e2d\u4eff\u771f\u4f1a\u4ea7\u751f\u6bdb\u523a\uff0c\u4e0d\u5efa\u8bae\u7528\u3002</p> </li> </ul> </li> <li> <p>4\u4f4d\u4e8c\u8fdb\u5236\u8ba1\u6570\u5668</p> <pre><code>   always@(posedge clk)begin\n        if(reset)begin\n            q &lt;= 4'd0;\n        end\n        else begin\n            q &lt;= q + 1'b1;\n        end\n    end\n</code></pre> <p>\u8ba1\u523015\u6e05\u96f6\uff0c\u61d2\u5f97\u6e05\u4e86\u3002</p> </li> <li> <p>\u5341\u8fdb\u5236\u8ba1\u6570</p> <pre><code>module top_module(\n    input clk,\n    input reset,\n    output reg [3:0] q);\n\n    always @(posedge clk)\n        if (reset || q == 9)    // Count to 10 requires rolling over 9-&gt;0 instead of the more natural 15-&gt;0\n            q &lt;= 0;\n        else\n            q &lt;= q+1;\n\nendmodule\n</code></pre> </li> <li> <p>1\u8ba1\u523010</p> <pre><code>module top_module (\n    input clk,\n    input reset,\n    output [3:0] q);\n\n    always @(posedge clk) begin\n        if (reset || q == 4'd10) begin\n            q &lt;= 4'b1; \n        end else begin\n            q &lt;= q + 1'b1;\n        end\n    end\n\n\nendmodule\n</code></pre> </li> <li> <p>pause counter</p> <pre><code>module top_module (\n    input clk,\n    input slowena,\n    input reset,\n    output [3:0] q);\n\n    always @(posedge clk)\n        if (reset) begin \n            q &lt;= 0;\n        end else if (slowena) begin\n            if (q == 4'd9) begin\n                q &lt;= 1'b0;\n            end else begin\n                q &lt;= q + 1'b1;\n            end\n        end\n\nendmodule\n</code></pre> </li> <li> <p>1-12\u8ba1\u6570\u5668</p> <p>Design a 1-12 counter with the following inputs and outputs:</p> <ul> <li>Reset Synchronous active-high reset that forces the counter to 1</li> <li>Enable Set high for the counter to run</li> <li>Clk Positive edge-triggered clock input</li> <li>Q[3:0] The output of the counter</li> <li>c_enable, c_load, c_d[3:0] Control signals going to the provided 4-bit counter, so correct operation can be verified.</li> </ul> <p>You have the following components available:</p> <ul> <li>the 4-bit binary counter (count4) below, which has Enable and synchronous parallel-load inputs (load has higher priority than enable). The count4 module is provided to you. Instantiate it in your circuit.</li> <li>logic gates</li> </ul> <pre><code>module count4(\n    input clk,\n    input enable,\n    input load,\n    input [3:0] d,\n    output reg [3:0] Q\n);\n</code></pre> <p>The c_enable, c_load, and c_d outputs are the signals that go to the internal counter's enable, load, and d inputs, respectively. Their purpose is to allow these signals to be checked for correctness.</p> <pre><code>module top_module (\n    input clk,\n    input reset,\n    input enable,\n    output [3:0] Q,\n    output c_enable,\n    output c_load,\n    output [3:0] c_d\n); //\n\n    assign c_enable = enable;\n    assign c_load = reset | ((Q == 4'd12) &amp;&amp; enable == 1'b1);\n    assign c_d = c_load ? 4'd1 : 4'd0;\n\n    count4 u_counter (clk, c_enable, c_load, c_d, Q);\n\nendmodule\n</code></pre> </li> <li> <p>1000\u8ba1\u6570\u5668</p> <p>From a 1000 Hz clock, derive a 1 Hz signal, called OneHertz, that could be used to drive an Enable signal for a set of hour/minute/second counters to create a digital wall clock. Since we want the clock to count once per second, the OneHertz signal must be asserted for exactly one cycle each second. Build the frequency divider using modulo-10 (BCD) counters and as few other gates as possible. Also output the enable signals from each of the BCD counters you use (c_enable[0] for the fastest counter, c_enable[2] for the slowest).</p> <p>The following BCD counter is provided for you. Enable must be high for the counter to run. Reset is synchronous and set high to force the counter to zero. All counters in your circuit must directly use the same 1000 Hz signal.</p> <pre><code>module bcdcount (\n    input clk,\n    input reset,\n    input enable,\n    output reg [3:0] Q\n);\n</code></pre> <pre><code>module top_module (\n    input clk,\n    input reset,\n    output OneHertz,\n    output [2:0] c_enable\n); //\n\n    wire [3:0] one, ten, hundred;\n\n    bcdcount counter0 (clk, reset, c_enable[0], one/*, ... */);\n    bcdcount counter1 (clk, reset, c_enable[1], ten/*, ... */);\n    bcdcount counter2 (clk, reset, c_enable[2], hundred/*, ... */);    \n\n    assign c_enable = {one == 4'd9 &amp;&amp; ten == 4'd9, one == 4'd9, 1'b1};\n    assign OneHertz = (one == 4'd9 &amp;&amp; ten == 4'd9 &amp;&amp; hundred == 4'd9);\n\nendmodule\n</code></pre> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_14","title":"\u5b66\u4e60\u8d44\u6599","text":"<p>\u4ece\u7535\u8def\u8bbe\u8ba1\u7684\u89d2\u5ea6\u5165\u95e8VerilogHDL_bilibili</p> <p>1.1 Verilog \u6559\u7a0b | \u83dc\u9e1f\u6559\u7a0b (runoob.com)</p> <p>Verilog\u8bed\u6cd5 | \u6559\u7a0b (ustc.edu.cn)</p> <p>\u300aVerilog HDL\u9ad8\u7ea7\u6570\u5b57\u8bbe\u8ba1\u300b</p> <p>HDLBits (01xz.net)</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#risc-v","title":"RISC-V\u6307\u4ee4\u96c6","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_15","title":"\u57fa\u7840\u6307\u4ee4\u96c6\u548c\u6269\u5c55\u6307\u4ee4\u96c6","text":"<p>\u8981\u6ee1\u8db3\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u57fa\u672c\u8fd0\u884c\uff0cRV32G \u6307\u4ee4\u96c6\u6216\u8005 RV64G \u6307\u4ee4\u96c6\u5c31\u591f\u4e86\uff08G \u662f\u901a\u7528\u7684\u610f\u601d \uff0c\u800c I \u53ea\u662f\u6574\u6570\u6307\u4ee4\u96c6\uff0cG \u5305\u542b I\uff09\uff0c\u6ce8\u610f RV32G \u6307\u4ee4\u96c6\u6216\u8005 RV64G \u6307\u4ee4\u96c6\uff0c\u53ea\u6709\u5bc4\u5b58\u5668\u4f4d\u5bbd\u548c\u5bfb\u5740\u7a7a\u95f4\u5927\u5c0f\u4e0d\u540c\uff0c\u8fd9\u4e9b\u6307\u4ee4\u6309\u7167\u529f\u80fd\u53ef\u4ee5\u5206\u4e3a\u5982\u4e0b\u51e0\u7c7b\u3002</p> <ol> <li>\u6574\u6570\u8fd0\u7b97\u6307\u4ee4\uff1a\u5b9e\u73b0\u7b97\u672f\u3001\u903b\u8f91\u3001\u6bd4\u8f83\u7b49\u8fd0\u7b97\u64cd\u4f5c\u3002</li> <li>\u5206\u652f\u8f6c\u79fb\u6307\u4ee4\uff1a\u5b9e\u73b0\u6761\u4ef6\u8f6c\u79fb\u3001\u65e0\u6761\u4ef6\u8f6c\u79fb\u7b49\u64cd\u4f5c\u3002</li> <li>\u52a0\u8f7d\u5b58\u50a8\u6307\u4ee4\uff1a\u5b9e\u73b0\u5b57\u8282\u3001\u534a\u5b57\u3001\u5b57\u3001\u53cc\u5b57\uff08RV64I\uff09\u7684\u52a0\u8f7d\u3001\u5b58\u50a8\u64cd\u4f5c\uff0c\u91c7\u7528\u7684\u90fd\u662f\u5bc4\u5b58\u5668\u76f8\u5bf9\u5bfb\u5740\u65b9\u5f0f\u3002</li> <li>\u63a7\u5236\u4e0e\u72b6\u6001\u5bc4\u5b58\u5668\u8bbf\u95ee\u6307\u4ee4\uff1a\u5b9e\u73b0\u5bf9\u7cfb\u7edf\u63a7\u5236\u4e0e\u7cfb\u7edf\u72b6\u6001\u5bc4\u5b58\u5668\u7684\u539f\u5b50\u8bfb - \u5199\u3001\u539f\u5b50\u8bfb - \u4fee\u6539\u3001\u539f\u5b50\u8bfb - \u6e05\u96f6\u7b49\u64cd\u4f5c\u3002</li> <li>\u7cfb\u7edf\u8c03\u7528\u6307\u4ee4\uff1a\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\u529f\u80fd\u3002</li> <li>\u539f\u5b50\u6307\u4ee4\uff1a\u7528\u4e8e\u73b0\u5728\u4f60\u80fd\u770b\u5230\u7684\u5404\u79cd\u540c\u6b65\u9501\u3002</li> <li> <p>\u5355\u53cc\u6d6e\u70b9\u6307\u4ee4\uff1a\u7528\u4e8e\u5b9e\u73b0\u6d6e\u70b9\u8fd0\u7b97\u64cd\u4f5c\u3002</p> </li> <li> <p>\u6307\u4ee4\u96c6\u547d\u540d\u6a21\u5f0f</p> <pre><code>RV[###][abc\u2026\u2026xyz]\n</code></pre> <p></p> </li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#risc-v_1","title":"RISC-V \u7279\u6743\u7ea7","text":"<p>\u4e00\u4e2a RISC-V \u786c\u4ef6\u7ebf\u7a0b\uff08hart\uff09\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a CPU \u5185\u7684\u72ec\u7acb\u7684\u53ef\u6267\u884c\u6838\u5fc3\uff0c\u5728\u4efb\u4e00\u65f6\u523b\uff0c\u53ea\u80fd\u8fd0\u884c\u5728\u67d0\u4e00\u4e2a\u7279\u6743\u7ea7\u4e0a\uff0c\u8fd9\u4e2a\u7279\u6743\u7ea7\u7531 CSR\uff08\u63a7\u5236\u548c\u72b6\u6001\u5bc4\u5b58\u5668\uff09\u6307\u5b9a\u548c\u914d\u7f6e\u3002\u5177\u4f53\u5206\u7ea7\u5982\u4e0b\uff1a</p> <ol> <li>\u673a\u5668\u7279\u6743\u7ea7\uff08M\uff09\uff1aRISC-V \u4e2d hart \u53ef\u4ee5\u6267\u884c\u7684\u6700\u9ad8\u6743\u9650\u6a21\u5f0f\u3002\u5728 M \u6a21\u5f0f\u4e0b\u8fd0\u884c\u7684 hart\uff0c\u5bf9\u5185\u5b58\u3001I/O \u548c\u4e00\u4e9b\u5fc5\u8981\u7684\u5e95\u5c42\u529f\u80fd\uff08\u542f\u52a8\u548c\u7cfb\u7edf\u914d\u7f6e\uff09\u6709\u7740\u5b8c\u5168\u7684\u63a7\u5236\u6743\u3002\u56e0\u6b64\uff0c\u5b83\u662f\u552f\u4e00\u4e00\u4e2a\u6240\u6709\u6807\u51c6 RISC-V CPU \u90fd\u5fc5\u987b\u5b9e\u73b0\u7684\u6743\u9650\u7ea7\u3002\u5b9e\u9645\u4e0a\uff0c\u666e\u901a\u7684 RISC-V \u5fae\u63a7\u5236\u5668\u4ec5\u652f\u6301\u673a\u5668\u7279\u6743\u7ea7\u3002</li> <li>\u865a\u62df\u673a\u76d1\u89c6\u7279\u6743\u7ea7\uff08H\uff09\uff1a\u4e3a\u4e86\u652f\u6301\u865a\u62df\u673a\u76d1\u89c6\u5668\u800c\u5b9a\u4e49\u7684\u7279\u6743\u7ea7\u3002</li> <li>\u7ba1\u7406\u5458\u7279\u6743\u7ea7\uff08S\uff09\uff1a\u4e3b\u8981\u7528\u4e8e\u652f\u6301\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5982 Linux\u3001FreeBSD \u548c Windows\u3002</li> <li>\u7528\u6237\u5e94\u7528\u7279\u6743\u7ea7\uff08U\uff09\uff1a\u7528\u4e8e\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u540c\u6837\u4e5f\u9002\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3002</li> </ol> <p>\u597d\u4e86\uff0c\u5173\u4e8e RISC-V \u7684\u7279\u6743\u7ea7\uff0c\u4f60\u4e86\u89e3\u8fd9\u4e9b\uff0c\u5728\u73b0\u9636\u6bb5\u5df2\u7ecf\u8db3\u591f\u4e86\u3002\u9700\u8981\u628a\u63e1\u7684\u91cd\u70b9\u662f\uff0c\u7279\u6743\u7ea7\u8d77\u5230\u4e86\u600e\u6837\u7684\u4f5c\u7528\u3002\u6709\u4e86\u7279\u6743\u7ea7\u7684\u5b58\u5728\uff0c\u5c31\u7ed9\u6307\u4ee4\u52a0\u4e0a\u4e86\u6743\u529b\uff0c\u4ece\u800c\u53bb\u63a7\u5236\u7528\u6307\u4ee4\u7f16\u5199\u7684\u7a0b\u5e8f\u3002\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u5e72\u5e94\u7528\u7a0b\u5e8f\u8be5\u5e72\u7684\u4e8b\u60c5\uff0c\u4e0d\u80fd\u8d8a\u6743\u64cd\u4f5c\u3002\u64cd\u4f5c\u7cfb\u7edf\u5219\u62e5\u6709\u66f4\u9ad8\u7684\u6743\u529b\uff0c\u80fd\u5bf9\u7cfb\u7edf\u7684\u8d44\u6e90\u8fdb\u884c\u7ba1\u7406\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#rv32i","title":"RV32I","text":"<p>RV32I \u5305\u542b\u7684\u6307\u4ee4\u662f\u56fa\u5b9a\u7684\uff0c\u6c38\u8fdc\u4e0d\u4f1a\u6539\u53d8\u3002\u8fd9\u4e3a\u7f16\u8bd1\u5668\u8bbe\u8ba1\u4eba\u5458\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1\u4eba\u5458\u548c\u6c47\u7f16\u8bed\u8a00\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684\u57fa\u7840\u77e5\u8bc6\u6846\u67b6\u3002</p> <p></p> <p>\u547d\u540d\u89c4\u5219</p> <p>\u4ece\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u4e9b\u5b57\u6bcd\u5e26\u6709\u4e0b\u5212\u7ebf\u3002\u6211\u4eec\u628a\u5e26\u6709\u4e0b\u5212\u7ebf\u7684\u5b57\u6bcd\u4ece\u5de6\u5230\u53f3\u8fde\u63a5\u8d77\u6765\uff0c\u5c31\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a RV32I \u7684\u6307\u4ee4\u3002</p> <p>\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6307\u4ee4\u540d\u79f0\uff0c\u96c6\u5408\u6807\u5fd7{}\u5185\u5217\u4e3e\u4e86\u6307\u4ee4\u7684\u6240\u6709\u53d8\u4f53\uff0c\u53d8\u4f53\u7528\u52a0\u4e0b\u5212\u7ebf\u7684\u5b57\u6bcd\u6216\u4e0b\u5212\u7ebf\u5b57\u7b26 _ \u8868\u793a\u3002\u5982\u679c\u5927\u62ec\u53f7\u5185\u53ea\u6709\u4e0b\u5212\u7ebf\u5b57\u7b26 _\uff0c\u5219\u8868\u793a\u5bf9\u4e8e\u6b64\u6307\u4ee4\u53d8\u4f53\u4e0d\u9700\u7528\u5b57\u6bcd\u8868\u793a\u3002</p> <p>\u6211\u4eec\u518d\u7ed3\u5408\u4f8b\u5b50\u52a0\u6df1\u4e00\u4e0b\u7406\u89e3\uff1a</p> <p></p> <ul> <li> <p>RV32I\u7684\u6307\u4ee4\u683c\u5f0f</p> <p></p> </li> </ul> <p>\u4e0d\u8981\u5c0f\u770b\u8fd9\u4e9b\u6307\u4ee4\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u5b83\u4eec\u5230\u5e95\u6709\u54ea\u4e9b\u4f18\u52bf\u3002</p> <p>\u8fd9\u4e9b\u6307\u4ee4\u683c\u5f0f\u89c4\u6574\u6709\u5e8f\uff0c\u7ed3\u6784\u7b80\u5355\u3002\u56e0\u4e3a\u6307\u4ee4\u53ea\u6709\u516d\u79cd\u683c\u5f0f\uff0c\u5e76\u4e14\u6240\u6709\u7684\u6307\u4ee4\u90fd\u662f 32 \u4f4d\u957f\u5ea6\u7684\uff0c\u6240\u4ee5\u8fd9\u4e9b\u6307\u4ee4\u89e3\u7801\u8d77\u6765\u5c31\u6bd4\u8f83\u7b80\u5355\uff0c\u53ef\u4ee5\u7b80\u5316\u89e3\u7801\u7535\u8def\uff0c\u63d0\u9ad8 CPU \u7684\u6027\u80fd\u529f\u8017\u6bd4\u3002\u4e0a\u56fe\u4e2d\u7684 <code>opcode</code> \u4ee3\u8868\u6307\u4ee4\u64cd\u4f5c\u7801\uff0c<code>imm</code> \u4ee3\u8868\u7acb\u5373\u6570\uff0c<code>funct3</code> \u548c <code>funct7</code> \u4ee3\u8868\u6307\u4ee4\u5bf9\u5e94\u7684\u529f\u80fd\uff0c<code>rs1</code>\u3001<code>rs2</code> \u548c <code>rd</code> \u5219\u5206\u522b\u4ee3\u8868\u6e90\u5bc4\u5b58\u5668 1\u3001\u6e90\u5bc4\u5b58\u5668 2 \u4ee5\u53ca\u76ee\u6807\u5bc4\u5b58\u5668\u3002</p> <p>RISC-V \u7684\u4e00\u4e2a\u6307\u4ee4\u4e2d\u53ef\u4ee5\u63d0\u4f9b\u4e09\u4e2a\u5bc4\u5b58\u5668\u64cd\u4f5c\u6570\uff0c\u800c\u4e0d\u662f\u50cf x86 \u4e00\u6837\uff0c\u8ba9\u6e90\u64cd\u4f5c\u6570\u548c\u76ee\u7684\u64cd\u4f5c\u6570\u5171\u4eab\u4e00\u4e2a\u5b57\u6bb5\uff0c\u56e0\u6b64\u76f8\u6bd4 x86 \u6307\u4ee4\uff0cRISC-V \u51cf\u5c11\u4e86\u8f6f\u4ef6\u7684\u7a0b\u5e8f\u64cd\u4f5c\u3002</p> <ul> <li> <p>RV32I\u768432\u4e2a\u901a\u7528\u5bc4\u5b58\u5668</p> <p></p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#rv32i_1","title":"RV32I\u7684\u5404\u7c7b\u6307\u4ee4","text":"<ul> <li> <p>\u7b97\u672f\u4e0e\u903b\u8f91\u6307\u4ee4</p> <p>\u5728 RV32I \u7684\u6307\u4ee4\u4e2d\uff0c\u5305\u62ec</p> <ul> <li>\u7b97\u672f\u6307\u4ee4\uff08<code>add</code>, <code>sub</code>\uff09</li> <li>\u6570\u503c\u6bd4\u8f83\u6307\u4ee4\uff08<code>slt</code>\uff09</li> <li>\u903b\u8f91\u6307\u4ee4\uff08<code>and</code>, <code>or</code>, <code>xor</code>\uff09</li> <li>\u79fb\u4f4d\u6307\u4ee4 \uff08<code>sll</code>, <code>srl</code>, <code>sra</code>\uff09</li> </ul> <p>\u7acb\u5373\u6570\u7248\u672c\uff1a</p> <p></p> <p>\u5bc4\u5b58\u5668\u64cd\u4f5c\u7248\u672c\uff1a</p> <p></p> </li> <li> <p><code>Load</code> \u548c <code>Store</code></p> <p>\u5728 RISC-V \u6307\u4ee4\u96c6\u4e2d\uff0c\u5bf9\u5185\u5b58\u7684\u8bfb\u5199\u53ea\u80fd\u901a\u8fc7 LOAD \u6307\u4ee4\u548c STORE \u6307\u4ee4\u5b9e\u73b0\u3002\u800c\u5176\u4ed6\u7684\u6307\u4ee4\uff0c\u90fd\u53ea\u80fd\u4ee5\u5bc4\u5b58\u5668\u4e3a\u64cd\u4f5c\u5bf9\u8c61\u3002</p> <p></p> </li> <li> <p>\u5206\u652f\u8df3\u8f6c\u6307\u4ee4</p> <ul> <li> <p>\u6709\u6761\u4ef6\u5206\u652f\u8df3\u8f6c</p> <p>RV32I \u4e2d\u7684\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u662f\u901a\u8fc7\u6bd4\u8f83\u4e24\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5e76\u6839\u636e\u6bd4\u8f83\u7ed3\u679c\u8fdb\u884c\u5206\u652f\u8df3\u8f6c\u3002</p> <p>\u6bd4\u8f83\u53ef\u4ee5\u662f\uff1a\u76f8\u7b49\uff08<code>beq</code>\uff09\uff0c\u4e0d\u76f8\u7b49 \uff08<code>bne</code>\uff09\uff0c\u5927\u4e8e\u7b49\u4e8e\uff08<code>bge</code>\uff09\uff0c\u6216\u5c0f\u4e8e\uff08<code>blt</code>\uff09\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c</p> <ul> <li>\u5927\u4e8e\u7b49\u4e8e\uff08<code>bge</code>\uff09\uff0c\u548c\u5c0f\u4e8e\uff08<code>blt</code>\uff09\u5219\u8df3\u8f6c\u6307\u4ee4\u4e3a\u6709\u7b26\u53f7\u6570\u6bd4\u8f83\uff0c</li> <li>RV32I \u4e5f\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u65e0\u7b26\u53f7\u6570\u7684\u6bd4\u8f83\u6307\u4ee4\uff0c\u5206\u522b\u4e3a <code>bgeu</code> \u548c <code>bltu</code>\u3002</li> <li>\u5269\u4e0b\u7684\u4e24\u4e2a\u6bd4\u8f83\u5173\u7cfb\uff08\u5927\u4e8e\u548c\u5c0f\u4e8e\u7b49\u4e8e\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u5730\u4ea4\u6362\u4e24\u4e2a\u64cd\u4f5c\u6570\u4f4d\u7f6e\uff0c\u6765\u5b8c\u6210\u76f8\u540c\u7684\u6bd4\u8f83\u3002\u4f8b\u5982\uff0c x &lt; y \u53ef\u4ee5\u8868\u793a\u4e3a y &gt; x \uff0c\u540c\u6837\u7684\uff0c x \u2264 y \u4e5f\u8868\u793a\u4e3a y \u2265 x\u3002</li> </ul> <p></p> </li> <li> <p>\u65e0\u6761\u4ef6\u8df3\u8f6c</p> <p>\u9664\u4e86\u6709\u6761\u4ef6\u5206\u652f\u8df3\u8f6c\uff0cRV32I \u8fd8\u63d0\u4f9b\u4e86\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\uff0c\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u8fd8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u76f4\u63a5\u8df3\u8f6c\u548c\u95f4\u63a5\u8df3\u8f6c\u8fd9\u4e24\u79cd\u6307\u4ee4\u3002</p> <ul> <li> <p>JAL</p> <p>\u76f4\u63a5\u8df3\u8f6c\u6307\u4ee4 JAL \u5982\u4e0b\u56fe\u6240\u793a\u3002RISC-V \u4e3a JAL \u6307\u4ee4\u4e13\u95e8\u5b9a\u4e49\u4e86 J-TYPE \u683c\u5f0f\u3002</p> <p>JAL \u6307\u4ee4\u7684\u6267\u884c\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\u3002\u9996\u5148\uff0c\u5b83\u4f1a\u628a 20 \u4f4d\u7acb\u5373\u6570\u505a\u7b26\u53f7\u4f4d\u6269\u5c55\uff0c\u5e76\u5de6\u79fb\u4e00\u4f4d\uff0c\u4ea7\u751f\u4e00\u4e2a 32 \u4f4d\u7684\u7b26\u53f7\u6570\u3002\u7136\u540e\uff0c\u5c06\u8be5 32 \u4f4d\u7b26\u53f7\u6570\u548c PC \u76f8\u52a0\u6765\u4ea7\u751f\u76ee\u6807\u5730\u5740\uff08\u8fd9\u6837\uff0cJAL \u53ef\u4ee5\u4f5c\u4e3a\u77ed\u8df3\u8f6c\u6307\u4ee4\uff0c\u8df3\u8f6c\u81f3 PC\u00b11 MB \u7684\u5730\u5740\u8303\u56f4\u5185\uff09\u3002</p> <p>\u540c\u65f6\uff0cJAL \u4e5f\u4f1a\u628a\u7d27\u968f\u5176\u540e\u7684\u90a3\u6761\u6307\u4ee4\u7684\u5730\u5740\uff0c\u5b58\u5165\u76ee\u6807\u5bc4\u5b58\u5668\u4e2d\u3002\u8fd9\u6837\uff0c\u5982\u679c\u76ee\u6807\u5bc4\u5b58\u5668\u662f\u96f6\uff0c\u5219 JAL \u5c31\u7b49\u540c\u4e8e GOTO \u6307\u4ee4\uff1b\u5982\u679c\u76ee\u6807\u5bc4\u5b58\u5668\u4e0d\u4e3a\u96f6\uff0cJAL \u53ef\u4ee5\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u7684\u529f\u80fd\u3002</p> </li> <li> <p>JALR</p> <p></p> <p>\u95f4\u63a5\u8df3\u8f6c\u6307\u4ee4 JALR \u5982\u4e0a\u56fe\u6240\u793a\u3002JALR \u6307\u4ee4\u4f1a\u628a 12 \u4f4d\u7acb\u5373\u6570\u548c\u6e90\u5bc4\u5b58\u5668\u76f8\u52a0\uff0c\u5e76\u628a\u76f8\u52a0\u7684\u7ed3\u679c\u672b\u4f4d\u6e05\u96f6\uff0c\u4f5c\u4e3a\u65b0\u7684\u8df3\u8f6c\u5730\u5740\u3002\u540c\u65f6\uff0c\u548c JAL \u6307\u4ee4\u4e00\u6837\uff0cJALR \u4e5f\u4f1a\u628a\u7d27\u968f\u5176\u540e\u7684\u90a3\u6761\u6307\u4ee4\u7684\u5730\u5740\uff0c\u5b58\u5165\u5230\u76ee\u6807\u5bc4\u5b58\u5668\u4e2d\u3002</p> </li> </ul> </li> </ul> </li> <li> <p>\u5176\u4ed6\u6307\u4ee4</p> <p>\u9664\u4e86\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u548c\u901a\u7528\u5bc4\u5b58\u5668\u5730\u5740\u7a7a\u95f4\u5916\uff0cRISC-V \u4e2d\u8fd8\u5b9a\u4e49\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u63a7\u5236\u4e0e\u72b6\u6001\u5bc4\u5b58\u5668\uff08Control Status Register\uff0cCSR\uff09\u5730\u5740\u7a7a\u95f4\u3002\u6bcf\u4e2a\u5904\u7406\u5668\u5b9e\u73b0\u7684 CSR \u4f1a\u56e0\u8bbe\u8ba1\u76ee\u6807\u4e0d\u540c\u800c\u6709\u5dee\u5f02\uff0c\u4f46\u8fd9\u4e9b CSR \u7684\u8bbf\u95ee\u65b9\u5f0f\u5374\u662f\u4e00\u81f4\u7684\uff0c\u8bbf\u95ee\u8fd9\u4e9b CSR \u7684\u6307\u4ee4\u5b9a\u4e49\u5728\u4e86\u7528\u6237\u6307\u4ee4\u96c6\u4e2d\uff08Zicsr \u6307\u4ee4\u96c6\u6269\u5c55\uff09\u3002</p> <p></p> <p>\u6709\u4e86\u4e0a\u56fe\u8fd9\u4e9b CSR \u6307\u4ee4\uff0c\u80fd\u591f\u8ba9\u6211\u4eec\u8f7b\u677e\u8bbf\u95ee\u4e00\u4e9b\u7a0b\u5e8f\u6027\u80fd\u8ba1\u6570\u5668\u3002\u8fd9\u4e9b\u8ba1\u6570\u5668\u5305\u62ec\u7cfb\u7edf\u65f6\u95f4\u3001\u65f6\u95f4\u5468\u671f\u4ee5\u53ca\u6267\u884c\u7684\u6307\u4ee4\u6570\u76ee\u3002</p> </li> </ul> <p>\u5728 RISC-V \u6307\u4ee4\u96c6\u4e2d\uff0c\u8fd8\u6709\u5176\u4ed6\u7684\u4e00\u4e9b\u6307\u4ee4\uff0c\u4f8b\u5982\u7528\u4e8e\u7cfb\u7edf\u8c03\u7528\u7684 <code>ecall</code> \u6307\u4ee4\uff0c\u5728\u8c03\u8bd5\u65f6\u7528\u4e8e\u5c06\u63a7\u5236\u8f6c\u79fb\u5230\u8c03\u8bd5\u73af\u5883\u7684 <code>ebreak</code> \u6307\u4ee4\u7b49\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u6269\u5c55\u7684\u6307\u4ee4\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00\u8bb2\u4e86\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_16","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpucpu","title":"\u624b\u5199CPU\uff08\u4e00\uff09\uff1aCPU\u67b6\u6784\u8bbe\u8ba1\u4e0e\u53d6\u6307\u4ee4\u5b9e\u73b0","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_17","title":"\u67b6\u6784","text":"<ol> <li> <p>\u53d6\u6307\u9636\u6bb5\uff08Instruction Fetch\uff09\uff1a</p> <p>\u53d6\u6307\u9636\u6bb5\u662f\u6307\u5c06\u6307\u4ee4\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u53d6\u51fa\u6765\u7684\u8fc7\u7a0b\u3002\u7a0b\u5e8f\u6307\u9488\u5bc4\u5b58\u5668\u7528\u6765\u6307\u5b9a\u5f53\u524d\u6307\u4ee4\u5728\u5b58\u50a8\u5668\u4e2d\u7684\u4f4d\u7f6e\u3002\u8bfb\u53d6\u4e00\u6761\u6307\u4ee4\u540e\uff0c\u7a0b\u5e8f\u6307\u9488\u5bc4\u5b58\u5668\u4f1a\u6839\u636e\u6307\u4ee4\u7684\u957f\u5ea6\u81ea\u52a8\u9012\u589e\uff0c\u6216\u8005\u6539\u5199\u6210\u6307\u5b9a\u7684\u5730\u5740\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>pre_if.v</code>(\u6307\u4ee4\u9884\u8bfb\u53d6\u6a21\u5757)</li> <li><code>if_id.v</code>(\u53d6\u503c\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul> </li> <li> <p>\u8bd1\u7801\u9636\u6bb5\uff08Instruction Decode\uff09\uff1a</p> <p>\u6307\u4ee4\u8bd1\u7801\u662f\u6307\u5c06\u5b58\u50a8\u5668\u4e2d\u53d6\u51fa\u7684\u6307\u4ee4\u8fdb\u884c\u7ffb\u8bd1\u7684\u8fc7\u7a0b\u3002\u6307\u4ee4\u8bd1\u7801\u5668\u5bf9\u6307\u4ee4\u8fdb\u884c\u62c6\u5206\u548c\u89e3\u91ca\uff0c\u8bc6\u522b\u51fa\u6307\u4ee4\u7c7b\u522b\u4ee5\u53ca\u6240\u9700\u7684\u5404\u79cd\u64cd\u4f5c\u6570\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>decode.v</code>(\u8bd1\u7801\u6a21\u5757)</li> <li><code>id_ex_ctrl.v(</code>\u8bd1\u7801\u63a7\u5236\u6a21\u5757)</li> <li><code>id_ex</code>(\u8bd1\u7801\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul> </li> <li> <p>\u6267\u884c\u9636\u6bb5\uff08Instruction Execute\uff09\uff1a</p> <p>\u6307\u4ee4\u6267\u884c\u662f\u6307\u5bf9\u6307\u4ee4\u8fdb\u884c\u771f\u6b63\u8fd0\u7b97\u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\u6307\u4ee4\u662f\u4e00\u6761\u52a0\u6cd5\u8fd0\u7b97\u6307\u4ee4\uff0c\u5219\u5bf9\u64cd\u4f5c\u6570\u8fdb\u884c\u76f8\u52a0\u64cd\u4f5c\uff1b\u5982\u679c\u662f\u4e00\u6761\u4e58\u6cd5\u8fd0\u7b97\u6307\u4ee4\uff0c\u5219\u8fdb\u884c\u4e58\u6cd5\u8fd0\u7b97\u3002\u5728\u201c\u6267\u884c\u201d\u9636\u6bb5\u6700\u5173\u952e\u7684\u6a21\u5757\u4e3a\u7b97\u672f\u903b\u8f91\u5355\u5143\uff08Arithmetic Logical Unit\uff0cALU\uff09\uff0c\u5b83\u662f\u5b9e\u65bd\u5177\u4f53\u8fd0\u7b97\u7684\u786c\u4ef6\u529f\u80fd\u5355\u5143\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>ALUCtrl.v</code>(\u6267\u884c\u63a7\u5236\u6a21\u5757)</li> <li><code>gen_regs.v</code>(\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757)</li> <li><code>alu.v</code>(\u6267\u884c\u6a21\u5757)</li> </ul> </li> <li> <p>\u8bbf\u5b58\u9636\u6bb5\uff08Memory Access\uff09\uff1a</p> <p>\u8bbf\u5b58\u662f\u6307\u5b58\u50a8\u5668\u8bbf\u95ee\u6307\u4ee4\u5c06\u6570\u636e\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u51fa\uff0c\u6216\u5199\u5165\u5b58\u50a8\u5668\u7684\u8fc7\u7a0b\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>forwarding.v</code>(\u6570\u636e\u524d\u9012\u6a21\u5757)</li> <li><code>ex_mem_ctrl.v</code>(\u8bbf\u5b58\u63a7\u5236\u6a21\u5757)</li> <li><code>ex_mem.v</code>(\u8bbf\u5b58\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul> </li> <li> <p>\u5199\u56de\u9636\u6bb5\uff08Write-Back\uff09\uff1a</p> <p>\u5199\u56de\u662f\u6307\u5c06\u6307\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u5199\u56de\u901a\u7528\u5bc4\u5b58\u5668\u7684\u8fc7\u7a0b\u3002\u5982\u679c\u662f\u666e\u901a\u8fd0\u7b97\u6307\u4ee4\uff0c\u8be5\u7ed3\u679c\u503c\u6765\u81ea\u4e8e\u201c\u6267\u884c\u201d\u9636\u6bb5\u8ba1\u7b97\u7684\u7ed3\u679c\uff1b\u5982\u679c\u662f\u5b58\u50a8\u5668\u8bfb\u6307\u4ee4\uff0c\u8be5\u7ed3\u679c\u6765\u81ea\u4e8e\u201c\u8bbf\u5b58\u201d\u9636\u6bb5\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u53d6\u51fa\u6765\u7684\u6570\u636e\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>hazard.v</code>(\u63a7\u5236\u5192\u9669\u6a21\u5757)</li> <li><code>mem_wb_ctrl.v</code>(\u5199\u56de\u63a7\u5236\u6a21\u5757)</li> <li><code>mem_wb.v</code>(\u5199\u56de\u6570\u636e\u6a21\u5757)</li> </ul> </li> <li> <p>[\u8865\u5145] \u7cfb\u7edf\u603b\u7ebf\u3001ROM\u3001RAM\u3001UART</p> </li> </ol> <p>\u76f8\u5173\u4ee3\u7801\u6a21\u5757\uff1a</p> <ul> <li><code>sys_bus</code>(\u7cfb\u7edf\u603b\u7ebf)</li> <li><code>imem</code>(ROM)</li> <li><code>dmem.v</code>(RAM)</li> <li><code>uart_tx.v</code>\u3001<code>uart_rx.v</code>(UART)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_18","title":"\u6307\u4ee4\u9884\u8bfb\u53d6\u6a21\u5757\u8bbe\u8ba1","text":"<pre><code>module pre_if(\n    input [31:0] instr,\n    input [31:0] pc,\n\n    output [31:0] pre_pc,\n)\n\n    wire is_bxx = (instr[6:0] == `OPCODE_BRANCH);\n    wire is_jal = (instr[6:0] == `OPCODE_JAL);\n\n    // B\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n    wire [31:0] bimm  = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};\n    // J\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n    wire [31:0] jimm  = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};\n\n    // \u6307\u4ee4\u5730\u5740\u7684\u504f\u79fb\u91cf\n    wire [31:0] addr = is_jal ? jimm : (is_bxx &amp;&amp; bimm[31]) ? bimm : 4;\n\n    assign pre_pc = pc + addr;\n\nendmodule\n</code></pre> <p>8\u30019\u884c\uff1a\u6839\u636e\u6307\u4ee4\u7684\u4f4e 7 \u4f4d\u64cd\u4f5c\u7801\uff0c\u5224\u65ad\u662f\u5426\u662f\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u6216\u662f\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u3002</p> <p></p> <p>\u4ece\u8fd9\u5f20\u8868\u683c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u64cd\u4f5c\u7801\uff0c\u4e5f\u5c31\u662f\u6307\u4ee4\u4e2d\u7684\u4f4e 7 \u4f4d\u6570\u90fd\u662f 7\u2019b1100011\u3002\u6839\u636e\u8fd9\u4e00\u7279\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u6307\u4ee4\u89e3\u7801\u4e4b\u524d\uff0c\u5224\u65ad\u51fa\u63a5\u4e0b\u6765\u53ef\u80fd\u4f1a\u53d1\u751f\u8df3\u8f6c\u3002</p> <p>\u6211\u4eec\u7ed3\u5408\u4ee3\u7801\u6765\u770b\u770b\u3002\u4e0b\u9762\u7684 Verilog \u8bed\u53e5\u5c31\u662f\u8df3\u8f6c\u6307\u4ee4\u7684\u5224\u65ad\uff0c\u5176\u4e2d\u7684`OPCODE_BRANCH \u5df2\u7ecf\u901a\u8fc7\u5b8f\u5b9a\u4e49\u4e3a 7\u2019b1100011\u3002</p> <p>\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u6267\u884c\u65f6\u662f\u5426\u53d1\u751f\u8df3\u8f6c\uff0c\u8981\u6839\u636e\u76f8\u5173\u7684\u6570\u636e\u6765\u5224\u65ad\uff0c\u8fd9\u5c31\u9700\u8981\u6307\u4ee4\u6267\u884c\u4e4b\u540e\u624d\u80fd\u77e5\u9053\u662f\u5426\u9700\u8981\u8df3\u8f6c\uff08\u5177\u4f53\u5982\u4f55\u5224\u65ad\uff0c\u6211\u4eec\u540e\u9762\u5199\u56de\u6a21\u5757\u90a3\u8282\u8bfe\u518d\u5c55\u5f00\uff09\u3002</p> <p></p> <p>\u4f46\u662f\uff0c\u6211\u4eec\u7684 CPU \u662f\u591a\u7ea7\u6d41\u6c34\u7ebf\u67b6\u6784\uff0c\u4e00\u6761\u6307\u4ee4\u6267\u884c\u9700\u8981\u591a\u4e2a\u65f6\u949f\u5468\u671f\u3002\u5982\u679c\u8981\u7b49\u5230\u8df3\u8f6c\u6307\u4ee4\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u518d\u53bb\u53d6\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u5c31\u4f1a\u964d\u4f4e\u6211\u4eec\u7684\u6307\u4ee4\u6267\u884c\u6548\u7387\u3002\u800c\u6307\u4ee4\u9884\u8bfb\u53d6\u6a21\u5757\u521a\u597d\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4e0d\u7ba1\u6307\u4ee4\u662f\u5426\u8df3\u8f6c\uff0c\u90fd\u63d0\u524d\u628a\u8df3\u8f6c\u4e4b\u540e\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u53d6\u51fa\u6765\uff0c\u4ee5\u5907\u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u9636\u6bb5\u4f7f\u7528\uff0c\u8fd9\u5c31\u63d0\u9ad8\u4e86 CPU \u7684\u6267\u884c\u6548\u7387\u3002</p> <p>\u4ee5\u4e0b\u4ee3\u7801\u5c31\u662f\u6839\u636e\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u683c\u5f0f\uff0c\u5bf9\u6307\u4ee4\u4e2d\u7684\u7acb\u5373\u6570\u8fdb\u884c\u62fc\u63a5\uff0c\u4e3a\u6307\u4ee4\u8df3\u8f6c\u65f6\u7684 PC \u63d0\u4f9b\u504f\u79fb\u91cf\u3002</p> <pre><code>    // B\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n    wire [31:0] bimm  = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};\n    // J\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n    wire [31:0] jimm  = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};\n</code></pre> <p></p> <p>\u8fd9\u4e24\u53e5\u4ee3\u7801\u4f7f\u7528\u4e86Verilog\u4e2d\u7684concatenation\u64cd\u4f5c\u7b26{{}}, \u7528\u4e8e\u62fc\u63a5\u591a\u4e2a\u4fe1\u53f7\u6216\u4f4d\u3002\u8ba9\u6211\u8be6\u7ec6\u89e3\u91ca\u4e00\u4e0b\uff1a</p> <ol> <li>{{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0}\uff1a</li> <li>{{20{instr[31]}}}\uff1a\u8fd9\u90e8\u5206\u8868\u793a\u5c06instr[31]\u91cd\u590d20\u6b21\uff0c\u5373\u5c06instr[31]\u6269\u5c55\u621020\u4f4d\uff0c\u5f62\u6210\u4e00\u4e2a20\u4f4d\u7684\u5411\u91cf\u3002</li> <li>instr[7]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c7\u4f4d\u3002</li> <li>instr[30:25]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c30\u4f4d\u5230\u7b2c25\u4f4d\uff08\u51716\u4f4d\uff09\u3002</li> <li>instr[11:8]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c11\u4f4d\u5230\u7b2c8\u4f4d\uff08\u51714\u4f4d\uff09\u3002</li> <li> <p>1'b0\uff1a\u8868\u793a\u4e00\u4e2a\u5355\u72ec\u76840\u4f4d\u3002    \u7efc\u5408\u8d77\u6765\uff0c\u8fd9\u6761\u8bed\u53e5\u7684\u4f5c\u7528\u662f\u5c06\u4e0a\u8ff0\u51e0\u90e8\u5206\u6309\u987a\u5e8f\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a32\u4f4d\u7684\u7acb\u5373\u6570bimm\u3002</p> </li> <li> <p>{{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0}\uff1a</p> </li> <li>{{12{instr[31]}}}\uff1a\u8fd9\u90e8\u5206\u8868\u793a\u5c06instr[31]\u91cd\u590d12\u6b21\uff0c\u5373\u5c06instr[31]\u6269\u5c55\u621012\u4f4d\uff0c\u5f62\u6210\u4e00\u4e2a12\u4f4d\u7684\u5411\u91cf\u3002</li> <li>instr[19:12]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c19\u4f4d\u5230\u7b2c12\u4f4d\uff08\u51718\u4f4d\uff09\u3002</li> <li>instr[20]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c20\u4f4d\u3002</li> <li>instr[30:21]\uff1a\u8868\u793a\u53d6instr\u7684\u7b2c30\u4f4d\u5230\u7b2c21\u4f4d\uff08\u517110\u4f4d\uff09\u3002</li> <li>1'b0\uff1a\u8868\u793a\u4e00\u4e2a\u5355\u72ec\u76840\u4f4d\u3002    \u7efc\u5408\u8d77\u6765\uff0c\u8fd9\u6761\u8bed\u53e5\u7684\u4f5c\u7528\u662f\u5c06\u4e0a\u8ff0\u51e0\u90e8\u5206\u6309\u987a\u5e8f\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a32\u4f4d\u7684\u7acb\u5373\u6570jimm\u3002</li> </ol> <p>\u8fd9\u6837\u7684\u62fc\u63a5\u64cd\u4f5c\u662f\u4e3a\u4e86\u4ece\u6307\u4ee4\u4e2d\u63d0\u53d6\u51fa\u7279\u5b9a\u7684\u4f4d\uff0c\u5e76\u6309\u7167\u7279\u5b9a\u7684\u987a\u5e8f\u7ec4\u5408\u6210\u65b0\u7684\u4fe1\u53f7\uff0c\u4ee5\u4fbf\u540e\u7eed\u7684\u8ba1\u7b97\u548c\u5904\u7406\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_19","title":"\u53d6\u6307\u6570\u636e\u901a\u8def\u6a21\u5757","text":"<p>\u7531\u4e0a\u8ff0\u7684\u6307\u4ee4\u9884\u8bfb\u53d6\u6a21\u5757\u628a\u6307\u4ee4\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u53d6\u4e4b\u540e\uff0c\u9700\u8981\u628a\u5b83\u53d1\u9001\u7ed9\u8bd1\u7801\u6a21\u5757\u8fdb\u884c\u7ffb\u8bd1\u3002\u4f46\u662f\uff0c\u9884\u8bfb\u53d6\u6a21\u5757\u8bfb\u51fa\u7684\u6307\u4ee4\uff0c\u5e76\u4e0d\u662f\u5168\u90e8\u90fd\u80fd\u53d1\u9001\u540e\u7eed\u6a21\u5757\u53bb\u6267\u884c\u3002</p> <p>\u4f8b\u5982\u4e0a\u9762\u7684\u6761\u4ef6\u5206\u652f\u6307\u4ee4\uff0c\u5728\u6307\u4ee4\u5b8c\u6210\u4e4b\u524d\u5c31\u628a\u540e\u7eed\u7684\u6307\u4ee4\u9884\u8bfb\u53d6\u51fa\u6765\u4e86\u3002\u5982\u679c\u6307\u4ee4\u6267\u884c\u4e4b\u540e\u53d1\u73b0\u8df3\u8f6c\u7684\u6761\u4ef6\u4e0d\u6210\u7acb\uff0c\u8fd9\u65f6\u9884\u8bfb\u53d6\u7684\u6307\u4ee4\u5c31\u662f\u65e0\u6548\u7684\uff0c\u9700\u8981\u5bf9\u6d41\u6c34\u7ebf\u8fdb\u884c\u51b2\u5237\uff08flush\uff09\uff0c\u628a\u65e0\u6548\u7684\u6307\u4ee4\u90fd\u6e05\u9664\u6389\u3002</p> <p>\u53d6\u6307\u901a\u8def\u6a21\u5757 if_id \u4e3b\u8981\u4ea7\u751f 3 \u4e2a\u4fe1\u53f7\u3002\u9996\u5148\u662f\u7ed9\u540e\u9762\u89e3\u7801\u6a21\u5757\u63d0\u4f9b\u7684\u6307\u4ee4\u4fe1\u53f7 reg_instr\u3002\u5982\u679c\u6d41\u6c34\u7ebf\u6ca1\u6709\u53d1\u751f\u51b2\u7a81\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u53d1\u51fa\u6e05\u9664\u4fe1\u53f7 flush\uff0c\u5219\u628a\u9884\u8bfb\u53d6\u7684\u6307\u4ee4\u4fdd\u5b58\uff0c\u5426\u5219\u628a\u6307\u4ee4\u6e05\u201c0\u201d\u3002</p> <pre><code>  //\u6307\u4ee4\u901a\u8def\n  always @(posedge clock) begin\n    if (reset) begin \n      reg_instr &lt;= 32'h0; \n    end else if (flush) begin \n      reg_instr &lt;= 32'h0; \n    end else if (valid) begin \n      reg_instr &lt;= in_instr; \n    end\n  end\n</code></pre> <p>\u7b2c\u4e8c\u4e2a\u662f\u66f4\u65b0 PC \u503c\uff0c\u5982\u679c\u6307\u4ee4\u6e05\u9664\u4fe1\u53f7 flush=\u201c0\u201d\uff0c\u5219\u628a\u5f53\u524d\u6307\u4ee4\u5bf9\u5e94\u7684 PC \u503c\u4fdd\u5b58\u4e3a reg_pc\uff0c\u5426\u5219\u5c31\u628a reg_pc \u6e05\u201c0\u201d\u3002</p> <pre><code>  //PC\u503c\u901a\u8def\n  always @(posedge clock) begin\"\"\n    if (reset) begin \n      reg_pc &lt;= 32'h0; \n    end else if (flush) begin \n      reg_pc &lt;= 32'h0; \n    end else if (valid) begin \n      reg_pc &lt;= in_pc; \n    end\n  end\n</code></pre> <p>\u6700\u540e\u4e00\u4e2a\u662f\u6d41\u6c34\u7ebf\u51b2\u5237\u7684\u6807\u5fd7\u4fe1\u53f7 reg_noflush\u3002\u5f53\u9700\u8981\u8fdb\u884c\u6d41\u6c34\u7ebf\u51b2\u5237\u65f6\uff0creg_noflush=\u201c0\u201d\uff0c\u5426\u5219 reg_noflush=\u201c1\u201d\u3002</p> <pre><code>  //\u6d41\u6c34\u7ebf\u51b2\u5237\u6807\u5fd7\u4f4d\n  always @(posedge clock) begin  \n    if (reset) begin \n      reg_noflush &lt;= 1'h0; \n    end else if (flush) begin \n      reg_noflush &lt;= 1'h0; \n    end else if (valid) begin \n      reg_noflush &lt;= in_noflush; \n    end\n  end\n</code></pre> <p>\u641e\u5b9a\u3002</p> <ul> <li> <p>\u603b\u7ed3</p> <p>\u53d6\u503c\u9636\u6bb5\u5c31\u662f\u628a\u5b58\u50a8\u5668\u91cc\u9762\u7684\u6307\u4ee4\u8bfb\u51fa\uff0c\u5e76\u4f20\u9012\u7ed9\u540e\u9762\u7684\u8bd1\u7801\u6a21\u5757\u8fdb\u884c\u5904\u7406\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_20","title":"\u76f8\u5173\u4ee3\u7801","text":"<ul> <li><code>pre_if.v</code>(\u6307\u4ee4\u9884\u8bfb\u53d6\u6a21\u5757)</li> <li><code>if_id.v</code>(\u53d6\u503c\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpu","title":"\u624b\u5199CPU\uff08\u4e8c\uff09\uff1a\u6307\u4ee4\u8bd1\u7801\u6a21\u5757","text":"<p>\u6307\u4ee4\u8bd1\u7801\u7535\u8def\u7ffb\u8bd1\u51fa\u6307\u4ee4\u4e2d\u643a\u5e26\u7684\u6267\u884c\u4fe1\u606f</p> <p>\u7531\u8bd1\u7801\u6570\u636e\u901a\u8def\u8d1f\u8d23\u628a\u8bd1\u7801\u540e\u7684\u6307\u4ee4\u4fe1\u606f\u53d1\u9001\u7ed9\u5bf9\u5e94\u7684\u6307\u4ee4\u5355\u5143</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_21","title":"\u8bd1\u7801\u6a21\u5757\u8bbe\u8ba1","text":"<p>\u6307\u4ee4\u683c\u5f0f\u4e0d\u540c\uff0c\u6307\u4ee4\u8bd1\u7801\u6a21\u5757\u7ffb\u8bd1\u6307\u4ee4\u7684\u5de5\u4f5c\u673a\u5236\u5374\u662f\u7edf\u4e00\u7684\u3002\u9996\u5148\u8bd1\u7801\u7535\u8def\u4f1a\u7ffb\u8bd1\u51fa\u6307\u4ee4\u4e2d\u643a\u5e26\u7684\u5bc4\u5b58\u5668\u7d22\u5f15\u3001\u7acb\u5373\u6570\u5927\u5c0f\u7b49\u6267\u884c\u4fe1\u606f\u3002</p> <p>\u867d\u7136\u5de5\u4f5c\u673a\u5236\u4e00\u81f4\uff0c\u5f97\u5230\u7684\u5bc4\u5b58\u5668\u7d22\u5f15\u3001\u7acb\u5373\u6570\u90fd\u662f\u90a3\u4e9b\uff0c\u4f46\u662f\u4e4b\u540e\u6309\u7167\u4ec0\u4e48\u6837\u7684\u65e2\u5b9a\u987a\u5e8f\u5212\u5206\u6307\u4ee4\u7684\u7c7b\u578b\u5462\uff1f\u4ec0\u4e48\u6837\u7684\u987a\u5e8f\u4fbf\u4e8e\u6211\u4eec\u89e3\u7801\u7684CPU\u8bbe\u8ba1\uff1f</p> <pre><code>    `OPCODE_LUI    :   dec_array &lt;= DEC_LUI;   \n    `OPCODE_AUIPC  :   dec_array &lt;= DEC_AUIPC; \n    `OPCODE_JAL    :   dec_array &lt;= DEC_JAL; \n    `OPCODE_JALR   :   dec_array &lt;= DEC_JALR;   \n    `OPCODE_BRANCH :   dec_array &lt;= DEC_BRANCH; \n    `OPCODE_LOAD   :   dec_array &lt;= DEC_LOAD;   \n    `OPCODE_STORE  :   dec_array &lt;= DEC_STORE;  \n    `OPCODE_ALUI   :   dec_array &lt;= DEC_ALUI;  \n    `OPCODE_ALUR   :   dec_array &lt;= DEC_ALUR;  \n</code></pre> <p>\u50cf\u8fd9\u6837\uff0c\u5212\u5206\u6210\u8fd9\u4e9b\u6307\u4ee4\uff1f\u8fd8\u662f\u5212\u5206\u6210R\u3001I\u3001S\u3001B\u3001U\u3001J\uff1f\u8fd8\u662f\u6309\u7167\u4ec0\u4e48\u7b97\u6570\u3001\u903b\u8f91\u3001\u8df3\u8f6c\u7b49\u7b49\uff1f\u8fd8\u662f\u6309\u7167\u5bc4\u5b58\u5668\u3001\u7acb\u5373\u6570\uff0c\u518d\u5206\u51fa\u4e00\u4e9b\u6307\u4ee4\uff1f</p> <p>\u54ea\u4e00\u79cd\u65b9\u4fbf\u6211\u4eec\u8bbe\u8ba1CPU\u6216\u8005\u8bf4\u5b9e\u9645\u751f\u4ea7\u4e2d\uff0c\u54ea\u4e00\u79cd\u66f4\u5408\u9002\u5462\uff1f\u5b9e\u9645\u5f00\u53d1\u7684\u4eba\u5458\u5b83\u4eec\u662f\u600e\u4e48\u5212\u5206\u7684\uff1f</p> <p>\u63a5\u7740\uff0c\u5728\u89e3\u51b3\u6570\u636e\u53ef\u80fd\u5b58\u5728\u7684\u6570\u636e\u5192\u9669\uff08\u8fd9\u4e2a\u6982\u5ff5\u540e\u9762\u7b2c\u4e5d\u8282\u8bfe\u4f1a\u8bb2\uff09\u4e4b\u540e\uff0c\u7531\u8bd1\u7801\u6570\u636e\u901a\u8def\u8d1f\u8d23\u628a\u8bd1\u7801\u540e\u7684\u6307\u4ee4\u4fe1\u606f\uff0c\u53d1\u9001\u7ed9\u5bf9\u5e94\u7684\u6267\u884c\u5355\u5143\u53bb\u6267\u884c\u3002</p> <p></p> <pre><code>module decode (\n  input  [31:0] instr,      //\u6307\u4ee4\u6e90\u7801\n\n  output  [4:0] rs1_addr,    //\u6e90\u5bc4\u5b58\u5668rs1\u7d22\u5f15\n  output  [4:0] rs2_addr,    //\u6e90\u5bc4\u5b58\u5668rs2\u7d22\u5f15\n  output  [4:0] rd_addr,    //\u76ee\u6807\u5bc4\u5b58\u5668rd\u7d22\u5f15\n  output  [2:0] funct3,      //\u529f\u80fd\u7801funct3\n  output  [6:0] funct7,      //\u529f\u80fd\u7801funct7\n  output        branch,\n  output [1:0]  jump,\n  output        mem_read,\n  output        mem_write,\n  output        reg_write,\n  output        to_reg,\n  output [1:0]  result_sel,\n  output        alu_src,\n  output        pc_add,\n  output [6:0]  types,\n  output [1:0]  alu_ctrlop,\n  output        valid_inst,\n  output [31:0] imm\n);\n\nlocalparam DEC_INVALID = 21'b0;\n\nreg [20:0] dec_array;\n\n//---------- decode rs1\u3001rs2 -----------------\nassign rs1_addr = instr[19:15]; \nassign rs2_addr = instr[24:20];\n\n//---------- decode rd -----------------------\nassign rd_addr = instr[11:7]; \n\n//---------- decode funct3\u3001funct7 -----------\nassign funct7 = instr[31:25]; \nassign funct3 = instr[14:12]; \n\n\n// ----------------------------- decode signals ---------------------------------\n//                        20     19-18  17       16        15        14     13-12      11      10     9--------3  2---1      0\n//                        branch jump   memRead  memWrite  regWrite  toReg  resultSel  aluSrc  pcAdd     RISBUJZ  aluctrlop  validInst\nlocalparam DEC_LUI     = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b01,     1'b0,   1'b0,  7'b0000100, 2'b00,     1'b1};\nlocalparam DEC_AUIPC   = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b1,   1'b1,  7'b0000100, 2'b00,     1'b1};\nlocalparam DEC_JAL     = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b10,     1'b0,   1'b0,  7'b0000010, 2'b00,     1'b1};\nlocalparam DEC_JALR    = {1'b0,  2'b11, 1'b0,    1'b0,     1'b1,     1'b0,  2'b10,     1'b1,   1'b0,  7'b0100000, 2'b00,     1'b1};\nlocalparam DEC_BRANCH  = {1'b1,  2'b00, 1'b0,    1'b0,     1'b0,     1'b0,  2'b00,     1'b0,   1'b0,  7'b0001000, 2'b10,     1'b1};\nlocalparam DEC_LOAD    = {1'b0,  2'b00, 1'b1,    1'b0,     1'b1,     1'b1,  2'b00,     1'b1,   1'b0,  7'b0100000, 2'b00,     1'b1};\nlocalparam DEC_STORE   = {1'b0,  2'b00, 1'b0,    1'b1,     1'b0,     1'b0,  2'b00,     1'b1,   1'b0,  7'b0010000, 2'b00,     1'b1};\nlocalparam DEC_ALUI    = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b1,   1'b0,  7'b0100000, 2'b01,     1'b1};\nlocalparam DEC_ALUR    = {1'b0,  2'b00, 1'b0,    1'b0,     1'b1,     1'b0,  2'b00,     1'b0,   1'b0,  7'b1000000, 2'b01,     1'b1};\n\nassign  {branch, jump, mem_read, mem_write, reg_write, to_reg, result_sel, alu_src, pc_add, types, alu_ctrlop, valid_inst} = dec_array;\n\nalways @(*) begin    //\u53c2\u6570\u592a\u591a\u7528@(*)\u8868\u793a\n    case(instr[6:0])    //\u770b\u4e0a\u4e00\u7ea7pre_if\u6a21\u5757\u4f20\u8fc7\u6765\u7684\u6307\u4ee4 \u8bc6\u522b\u6307\u4ee4\u7684\u7c7b\u578b\n    `OPCODE_LUI    :   dec_array &lt;= DEC_LUI;   \n    `OPCODE_AUIPC  :   dec_array &lt;= DEC_AUIPC; \n    `OPCODE_JAL    :   dec_array &lt;= DEC_JAL; \n    `OPCODE_JALR   :   dec_array &lt;= DEC_JALR;   \n    `OPCODE_BRANCH :   dec_array &lt;= DEC_BRANCH; \n    `OPCODE_LOAD   :   dec_array &lt;= DEC_LOAD;   \n    `OPCODE_STORE  :   dec_array &lt;= DEC_STORE;  \n    `OPCODE_ALUI   :   dec_array &lt;= DEC_ALUI;  \n    `OPCODE_ALUR   :   dec_array &lt;= DEC_ALUR;  \n    default        :  begin\n                 dec_array &lt;= DEC_INVALID;\n    end\n  endcase\nend\n\n// -------------------- IMM -------------------------\n//\u63d0\u53d6\u7acb\u5373\u6570\nwire [31:0] Iimm = {{21{instr[31]}}, instr[30:20]};\nwire [31:0] Simm = {{21{instr[31]}}, instr[30:25], instr[11:7]};\nwire [31:0] Bimm = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};\nwire [31:0] Uimm = {instr[31:12], 12'b0};\nwire [31:0] Jimm = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};   \n\nassign imm = {32{types[5]}} &amp; Iimm\n           | {32{types[4]}} &amp; Simm\n           | {32{types[3]}} &amp; Bimm\n           | {32{types[2]}} &amp; Uimm\n           | {32{types[1]}} &amp; Jimm;\n\nendmodule\n</code></pre> <ul> <li> <p>\u7b2c 28 \u884c\u5230 37 \u884c\u8d1f\u8d23\u5b8c\u6210\u6307\u4ee4\u7684\u6e90\u5bc4\u5b58\u5668\u3001\u76ee\u6807\u5bc4\u5b58\u5668\u30013 \u4f4d\u64cd\u4f5c\u7801\u548c 7 \u4f4d\u64cd\u4f5c\u7801\u7684\u8bd1\u7801</p> <p>\u5982\u4e0a\u4ee3\u7801</p> <p></p> <p>\u5404\u79cd\u6307\u4ee4\u7c7b\u578b\u7684\u4e0a\u9762\u8fd9\u4e9b\u5185\u5bb9\u7684\u4f4d\u7f6e\u6bd4\u8f83\u56fa\u5b9a\u3002\u56e0\u6b64\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u4f4d\u7f6e\u7279\u70b9\uff0c\u76f4\u63a5\u4ece\u6307\u4ee4\u4e2d\u622a\u53d6\uff0c\u4ece\u800c\u5f97\u5230\u5b83\u4eec\u76f8\u5e94\u7684\u4fe1\u606f\u3002</p> </li> <li> <p>\u7b2c 40 \u884c\u81f3 73 \u884c\u8d1f\u8d23\u5b8c\u6210\u6307\u4ee4\u683c\u5f0f\u7c7b\u578b\u7684\u8bc6\u522b\uff08\u6307\u4ee4\u63a7\u5236\u4fe1\u53f7\uff09 </p> <pre><code>output [6:0]  types,\n</code></pre> <p>\u8bd1\u7801\u7684\u8fc7\u7a0b\u5c31\u662f\u5148\u8bc6\u522b\u6307\u4ee4\u7684\u4f4e 7 \u4f4d\u64cd\u4f5c\u7801 instr[6:0]\uff0c</p> <p>\u6839\u636e\u64cd\u4f5c\u7801\u5bf9\u5e94\u7684\u4ee3\u7801\u6807\u8bc6\uff0c\u4ea7\u751f\u5206\u652f\u4fe1\u53f7 branch\u3001\u8df3\u8f6c\u4fe1\u53f7 jump\u3001\u8bfb\u5b58\u50a8\u5668\u4fe1\u53f7 mem_read\u2026\u2026\u8fd9\u4e9b\u8bd1\u7801\u4e4b\u540e\u7684\u6307\u4ee4\u63a7\u5236\u4fe1\u606f\u3002</p> <p>\u7136\u540e\uff0c\u628a\u8bd1\u7801\u5f97\u5230\u7684\u4fe1\u606f\u4ea4\u5230 CPU \u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u7ea7\u53bb\u6267\u884c\u3002</p> </li> <li> <p>\u7b2c 75 \u884c\u81f3 87 \u884c\u8d1f\u8d23\u5b8c\u6210\u7acb\u5373\u6570\u8bd1\u7801\uff08\u6307\u4ee4\u6570\u636e\u4fe1\u606f\uff09</p> <p>\u548c <code>pre_if.v</code> \u7c7b\u4f3c</p> <p>\u8fd9\u6bb5Verilog\u4ee3\u7801\u662f\u7528\u6765\u63d0\u53d6RISC-V\u6307\u4ee4\u4e2d\u7684\u7acb\u5373\u6570\uff08immediate value\uff09\u90e8\u5206\u7684\u3002\u8ba9\u6211\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e9b\u4ee3\u7801\u7684\u542b\u4e49\uff1a</p> <p><code>wire [31:0] Iimm = {{21{instr[31]}}, instr[30:20]};</code> \u8fd9\u884c\u4ee3\u7801\u4e2d\u7684<code>Iimm</code>\u662f\u4e00\u4e2a32\u4f4d\u7684wire\u7c7b\u578b\u53d8\u91cf\uff0c\u5b83\u7684\u503c\u7531<code>instr</code>\u4e2d\u7684\u7279\u5b9a\u4f4d\u7ec4\u6210\u3002<code>{{21{instr[31]}}, instr[30:20]}</code>\u8fd9\u90e8\u5206\u7684\u610f\u601d\u662f\uff0c\u5c06<code>instr[31]</code>\u91cd\u590d21\u6b21\uff0c\u7136\u540e\u518d\u52a0\u4e0a<code>instr[30:20]</code>\u7684\u503c\u3002\u6240\u4ee5<code>Iimm</code>\u7684\u503c\u7531<code>instr[31]</code>\u91cd\u590d21\u6b21\u548c<code>instr[30:20]</code>\u7684\u503c\u7ec4\u6210\u3002</p> <p><code>wire [31:0] Simm = {{21{instr[31]}}, instr[30:25], instr[11:7]};</code> \u540c\u6837\u5730\uff0c<code>Simm</code>\u4e5f\u662f\u4e00\u4e2a32\u4f4d\u7684wire\u7c7b\u578b\u53d8\u91cf\uff0c\u5b83\u7684\u503c\u7531<code>instr</code>\u4e2d\u7684\u7279\u5b9a\u4f4d\u7ec4\u6210\u3002<code>{{21{instr[31]}}, instr[30:25], instr[11:7]}</code>\u8868\u793a<code>instr[31]</code>\u91cd\u590d21\u6b21\uff0c\u52a0\u4e0a<code>instr[30:25]</code>\u7684\u503c\uff0c\u518d\u52a0\u4e0a<code>instr[11:7]</code>\u7684\u503c\u3002</p> <p>\u7c7b\u4f3c\u5730\uff0c<code>Bimm</code>\u3001<code>Uimm</code>\u548c<code>Jimm</code>\u7684\u8d4b\u503c\u4e5f\u662f\u6839\u636e<code>instr</code>\u4e2d\u7684\u7279\u5b9a\u4f4d\u7ec4\u6210\u7684\u3002\u8fd9\u4e9b\u64cd\u4f5c\u4e3b\u8981\u662f\u6839\u636eRISC-V\u6307\u4ee4\u7684\u683c\u5f0f\u548c\u7acb\u5373\u6570\u7684\u4f4d\u7f6e\u6765\u63d0\u53d6\u7acb\u5373\u6570\u7684\u503c\u3002</p> <p>\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u91cd\u590d\u67d0\u4e2a\u4f4d\u591a\u6b21\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u5728RISC-V\u6307\u4ee4\u96c6\u4e2d\uff0c\u7acb\u5373\u6570\u7684\u4f4d\u6570\u53ef\u80fd\u4e0d\u8db332\u4f4d\uff0c\u9700\u8981\u8fdb\u884c\u6269\u5c55\u4ee5\u5339\u914d32\u4f4d\u7684\u5bc4\u5b58\u5668\u3002\u8fd9\u79cd\u64cd\u4f5c\u53ef\u4ee5\u786e\u4fdd\u63d0\u53d6\u7684\u7acb\u5373\u6570\u5728\u4f7f\u7528\u65f6\u5177\u6709\u6b63\u786e\u7684\u4f4d\u6570\u548c\u683c\u5f0f\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_22","title":"\u8bd1\u7801\u63a7\u5236\u6a21\u5757\u8bbe\u8ba1","text":"<p>\u524d\u9762\u7684\u8bd1\u7801\u6a21\u5757\u5f97\u5230\u7684\u6307\u4ee4\u4fe1\u53f7\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\u3002</p> <ul> <li>\u4e00\u7c7b\u662f\u7531\u6307\u4ee4\u7684\u64cd\u4f5c\u7801\u7ecf\u8fc7\u8bd1\u7801\u540e\u4ea7\u751f\u7684\u6307\u4ee4\u6267\u884c\u63a7\u5236\u4fe1\u53f7\uff0c\u5982\u8df3\u8f6c\u64cd\u4f5c jump \u4fe1\u53f7\u3001\u5b58\u50a8\u5668\u8bfb\u53d6 mem_read \u4fe1\u53f7\u7b49\uff1b</li> <li>\u53e6\u4e00\u7c7b\u662f\u4ece\u6307\u4ee4\u6e90\u7801\u4e2d\u63d0\u53d6\u51fa\u6765\u7684\u6570\u636e\u4fe1\u606f\uff0c\u5982\u7acb\u5373\u6570\u3001\u5bc4\u5b58\u5668\u7d22\u5f15\u3001\u529f\u80fd\u7801\u7b49\u3002</li> </ul> <p>\u4e3a\u4e86\u80fd\u5bf9\u6d41\u6c34\u7ebf\u66f4\u597d\u5730\u5b9e\u65bd\u63a7\u5236\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981==\u628a\u8bd1\u7801\u540e\u7684\u6570\u636e\u548c\u63a7\u5236\u4fe1\u53f7\u5206\u5f00\u5904\u7406==\u3002\u9996\u5148\u6765\u770b\u8bd1\u7801\u63a7\u5236\u6a21\u5757\u7684\u5b9e\u73b0\uff1a</p> <pre><code>module id_ex_ctrl(\n  input        clk,\n  input        reset,\n  input        in_ex_ctrl_itype,\n  input  [1:0] in_ex_ctrl_alu_ctrlop,\n  input  [1:0] in_ex_ctrl_result_sel,\n  input        in_ex_ctrl_alu_src,\n  input        in_ex_ctrl_pc_add,\n  input        in_ex_ctrl_branch,\n  input  [1:0] in_ex_ctrl_jump,\n  input        in_mem_ctrl_mem_read,\n  input        in_mem_ctrl_mem_write,\n  input  [1:0] in_mem_ctrl_mask_mode,\n  input        in_mem_ctrl_sext,\n  input        in_wb_ctrl_to_reg,\n  input        in_wb_ctrl_reg_write,\n  input        in_noflush,\n  input        flush,\n  input        valid,\n  output       out_ex_ctrl_itype,\n  output [1:0] out_ex_ctrl_alu_ctrlop,\n  output [1:0] out_ex_ctrl_result_sel,\n  output       out_ex_ctrl_alu_src,\n  output       out_ex_ctrl_pc_add,\n  output       out_ex_ctrl_branch,\n  output [1:0] out_ex_ctrl_jump,\n  output       out_mem_ctrl_mem_read,\n  output       out_mem_ctrl_mem_write,\n  output [1:0] out_mem_ctrl_mask_mode,\n  output       out_mem_ctrl_sext,\n  output       out_wb_ctrl_to_reg,\n  output       out_wb_ctrl_reg_write,\n  output       out_noflush\n);\n\n  reg  reg_ex_ctrl_itype; \n  reg [1:0] reg_ex_ctrl_alu_ctrlop; \n  reg [1:0] reg_ex_ctrl_result_sel; \n  reg  reg_ex_ctrl_alu_src; \n  reg  reg_ex_ctrl_pc_add; \n  reg  reg_ex_ctrl_branch; \n  reg [1:0] reg_ex_ctrl_jump; \n  reg  reg_mem_ctrl_mem_read; \n  reg  reg_mem_ctrl_mem_write; \n  reg [1:0] reg_mem_ctrl_mask_mode; \n  reg  reg_mem_ctrl_sext; \n  reg  reg_wb_ctrl_to_reg; \n  reg  reg_wb_ctrl_reg_write; \n  reg  reg_noflush; \n\n  \u2026\u2026\u2026\u2026\u2026\u2026    //\u7531\u4e8e\u8fd9\u91cc\u7684\u4ee3\u7801\u8f83\u957f\uff0c\u7ed3\u6784\u76f8\u4f3c\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\u4e00\u90e8\u5206\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_noflush &lt;= 1'h0; \n    end else if (flush) begin \n      reg_noflush &lt;= 1'h0; \n    end else if (valid) begin \n      reg_noflush &lt;= in_noflush; \n    end\n  end\nendmodule\n</code></pre> <p>\u4e0a\u4e00\u8282\u8bfe\u5b66\u4e60\u53d6\u6307\u6a21\u5757\u7684\u65f6\u5019\u6211\u4eec\u8bf4\u8fc7\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u53d6\u51fa\u6765\u7684\u6307\u4ee4\uff0c\u90fd\u80fd\u591f\u7ed9\u5230\u6267\u884c\u5355\u5143\u53bb\u6267\u884c\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u5f53\u6307\u4ee4\u53d1\u751f\u51b2\u7a81\u65f6\uff0c\u9700\u8981\u5bf9\u6d41\u6c34\u7ebf\u8fdb\u884c\u51b2\u5237\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u6e05\u9664\u6d41\u6c34\u7ebf\u4e2d\u7684\u6307\u4ee4\u3002\u540c\u6837\u7684\uff0c\u8bd1\u7801\u9636\u6bb5\u7684\u6307\u4ee4\u4fe1\u53f7\u4e5f\u9700\u8981\u6e05\u9664\u3002\u8bd1\u7801\u63a7\u5236\u6a21\u5757\u5c31\u662f\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u529f\u80fd\uff0c\u5f53\u6307\u4ee4\u6e05\u9664\u4fe1\u53f7 flush \u6709\u6548\u65f6\uff0c\u628a\u8bd1\u7801\u6a21\u5757\u4ea7\u751f\u7684 jump\u3001branch\u3001mem_read\u3001mem_write\u3001reg_write\u2026\u2026\u8fd9\u4e9b\u63a7\u5236\u4fe1\u53f7\u5168\u90e8\u6e05\u201c0\u201d\u3002\u5426\u5219\uff0c\u5c31\u628a\u8fd9\u4e9b\u63a7\u5236\u4fe1\u53f7\u53d1\u9001\u7ed9\u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u7ea7\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_23","title":"\u8bd1\u7801\u6570\u636e\u901a\u8def\u6a21\u5757\u8bbe\u8ba1","text":"<p>\u548c\u8bd1\u7801\u6a21\u5757\u7c7b\u4f3c\uff0c\u8bd1\u7801\u6570\u636e\u901a\u8def\u6a21\u5757\u4f1a\u6839\u636e CPU \u76f8\u5173\u63a7\u5236\u6a21\u5757\u4ea7\u751f\u7684\u6d41\u6c34\u7ebf\u51b2\u5237\u63a7\u5236\u4fe1\u53f7\uff0c\u51b3\u5b9a\u8981\u4e0d\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u53d1\u9001\u7ed9\u540e\u7eed\u6a21\u5757\u3002</p> <p>\u5176\u4e2d\uff0c\u8bd1\u7801\u5f97\u5230\u7684\u6570\u636e\u4fe1\u606f\u5305\u62ec\u7acb\u5373\u6570 <code>imm</code>\u3001\u6e90\u5bc4\u5b58\u5668\u7d22\u5f15 <code>rs1</code> \u548c <code>rs2</code>\u3001\u76ee\u6807\u5bc4\u5b58\u5668\u7d22\u5f15 <code>rd</code> \u4ee5\u53ca\u529f\u80fd\u7801 <code>funct3</code> \u548c <code>funct7</code>\u3002\u5177\u4f53\u7684\u8bbe\u8ba1\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>module id_ex(\n  input         clk,\n  input         reset,\n  input  [4:0]  in_rd_addr,\n  input  [6:0]  in_funct7,\n  input  [2:0]  in_funct3,\n  input  [31:0] in_imm,\n  input  [31:0] in_rs2_data,\n  input  [31:0] in_rs1_data,\n  input  [31:0] in_pc,\n  input  [4:0]  in_rs1_addr,\n  input  [4:0]  in_rs2_addr,\n  input         flush,\n  input         valid,\n  output [4:0]  out_rd_addr,\n  output [6:0]  out_funct7,\n  output [2:0]  out_funct3,\n  output [31:0] out_imm,\n  output [31:0] out_rs2_data,\n  output [31:0] out_rs1_data,\n  output [31:0] out_pc,\n  output [4:0]  out_rs1_addr,\n  output [4:0]  out_rs2_addr\n);\n  reg [4:0] reg_rd_addr; \n  reg [6:0] reg_funct7; \n  reg [2:0] reg_funct3; \n  reg [31:0] reg_imm; \n  reg [31:0] reg_rs2_data; \n  reg [31:0] reg_rs1_data; \n  reg [31:0] reg_pc; \n  reg [4:0] reg_rs1_addr; \n  reg [4:0] reg_rs2_addr; \n\n  \u2026\u2026\u2026\u2026  //\u7531\u4e8e\u4ee3\u7801\u8f83\u957f\uff0c\u7ed3\u6784\u76f8\u4f3c\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\u4e00\u90e8\u5206\uff0c\u5b8c\u6574\u4ee3\u7801\u4f60\u53ef\u4ee5\u4eceGitee\u4e0a\u83b7\u53d6\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_rs2_addr &lt;= 5'h0; \n    end else if (flush) begin \n      reg_rs2_addr &lt;= 5'h0; \n    end else if (valid) begin \n      reg_rs2_addr &lt;= in_rs2_addr; \n    end\n  end\n\nendmodule\n</code></pre> <p>\u6211\u4eec\u4ee5\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u7d22\u5f15\u5730\u5740 reg_rd_addr \u4fe1\u53f7\u4e3a\u4f8b\uff0c\u5206\u6790\u4e00\u4e0b\u5b83\u662f\u600e\u4e48\u6d41\u901a\u7684\u3002</p> <p>\u5f53\u6d41\u6c34\u7ebf\u51b2\u5237\u4fe1\u53f7 flush \u6709\u6548\u65f6\uff0c\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u7d22\u5f15\u5730\u5740 reg_rd_addr \u76f4\u63a5\u6e05\u201c0\u201d\uff0c\u5426\u5219\u5f53\u4fe1\u53f7\u6709\u6548\u6807\u5fd7 valid \u4e3a\u201c1\u201d\u65f6\uff0c\u628a\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u7d22\u5f15\u5730\u5740\u4f20\u9012\u7ed9\u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u7ea7\u3002</p> <pre><code>  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_rd_addr &lt;= 5'h0; \n    end else if (flush) begin \n      reg_rd_addr &lt;= 5'h0; \n    end else if (valid) begin \n      reg_rd_addr &lt;= in_rd_addr; \n    end\n  end\n</code></pre>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_24","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_25","title":"\u76f8\u5173\u4ee3\u7801","text":"<ul> <li><code>decode.v</code>(\u8bd1\u7801\u6a21\u5757)</li> <li><code>id_ex_ctrl.v(</code>\u8bd1\u7801\u63a7\u5236\u6a21\u5757)</li> <li><code>id_ex</code>(\u8bd1\u7801\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpu_1","title":"\u624b\u5199CPU\uff08\u4e09\uff09\uff1a\u6307\u4ee4\u6267\u884c\u6a21\u5757","text":"<p>\u91cd\u70b9\u4e0eALU\u76f8\u5173</p> <p></p> <p>\u4e0a\u56fe\u5c31\u662f ALU \u6a21\u5757\u7684\u8bbe\u8ba1\u6846\u56fe\u3002\u5728 ALU \u6a21\u5757\u4e2d\uff0c\u6307\u4ee4\u53ef\u4ee5\u5206\u6210\u4e09\u7c7b\u6765\u5904\u7406\uff1a</p> <ol> <li>\u7b2c\u4e00\u7c7b\u662f\u666e\u901a\u7684 ALU \u6307\u4ee4\uff0c\u5305\u62ec\u903b\u8f91\u8fd0\u7b97\u3001\u79fb\u4f4d\u64cd\u4f5c\u7b49\u6307\u4ee4\uff1b</li> <li>\u7b2c\u4e8c\u7c7b\u6307\u4ee4\u8d1f\u8d23\u5b8c\u6210\u5b58\u50a8\u5668\u8bbf\u95ee\u6307\u4ee4 Load \u548c Store \u7684\u5730\u5740\u751f\u6210\u5de5\u4f5c\uff1b</li> <li>\u7b2c\u4e09\u7c7b\u662f\u8d1f\u8d23\u5206\u652f\u8df3\u8f6c\u6307\u4ee4\u7684\u7ed3\u679c\u89e3\u6790\u548c\u6267\u884c\u3002\u8fd9\u5c31\u662f\u6d41\u6c34\u7ebf\u6267\u884c\u9636\u6bb5\u7684\u6838\u5fc3\u6a21\u5757 ALU \u7684\u8bbe\u8ba1\u601d\u8def\u3002</li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_26","title":"\u6267\u884c\u63a7\u5236\u6a21\u5757","text":"<p>\u7531\u8bd1\u7801\u9636\u6bb5\u4f20\u5165\u7684<code>aluCtrlOp[2 : 1]</code></p> <p></p> <p>\u6839\u636e 2 \u4f4d\u6267\u884c\u7c7b\u578b\u5b57\u6bb5 <code>aluCrtlOp</code>\uff0c\u4ee5\u53ca\u6307\u4ee4\u8bd1\u7801\u5f97\u5230\u7684\u64cd\u4f5c\u7801 funct7 \u548c funct3\uff0c\u5c31\u53ef\u4ee5\u8bbe\u8ba1\u6211\u4eec\u7684\u6267\u884c\u63a7\u5236\u6a21\u5757\u4e86\u3002\u7ed3\u5408\u524d\u9762\u7684\u8868\u683c\uff0c\u6211\u4eec\u6765\u770b\u770b\u6267\u884c\u63a7\u5236\u6a21\u5757\u5982\u4f55\u6839\u636e <code>aluCrtlOp</code> \u4fe1\u53f7\u505a\u5224\u65ad\uff1a</p> <p>\u5982\u679c <code>aluCrtlOp</code> \u7b49\u4e8e\uff0800\uff09\uff0c\u5bf9\u5e94\u7684\u6307\u4ee4\u7c7b\u578b\u5c31\u662f Load \u548c Store \u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u52a0\u6cd5\u8fd0\u7b97\u6765\u8ba1\u7b97\u8bbf\u5b58\u5730\u5740\uff1b</p> <p>\u5982\u679c <code>aluCrtlOp</code> \u7b49\u4e8e\uff0801\uff09\uff0c\u76f8\u5e94\u7684\u6307\u4ee4\u7c7b\u578b\u5c31\u662f ALUI/ALUR\uff0c\u540c\u6837\u4e5f\u662f\u6839\u636e\u8f93\u5165\u7684 funct7 \u548c funct3 \u5b57\u6bb5\u51b3\u5b9a\u6267\u884c\u54ea\u4e9b\u7b97\u672f\u8fd0\u7b97\uff0c\u6bd4\u5982\u52a0\u51cf\u8fd0\u7b97\u3001\u79fb\u4f4d\u64cd\u4f5c\u7b49\uff1b</p> <p>\u5982\u679c\u7c7b\u578b\u5b57\u6bb5\u7b49\u4e8e\uff0810\uff09\uff0c\u5c31\u5bf9\u5e94\u7740\u5206\u652f\u8df3\u8f6c\u6307\u4ee4\uff0c\u6d41\u6c34\u7ebf\u5c31\u4f1a\u76f8\u5e94\u53bb\u5b8c\u6210\u6761\u4ef6\u5206\u652f\u7684\u89e3\u6790\u5de5\u4f5c\u3002</p> <p>\u6700\u540e\u4e00\u5217\uff1a\u8868\u793a\u6269\u5c55\u6307\u4ee4\u518d\u7528</p> <pre><code>module ALUCtrl (\n    input [2:0]  funct3,\n    input [6:0]  funct7,\n    input [1:0]  aluCtrlOp,\n    input        itype,\n    output reg [3:0] aluOp  //\u7ed9\u540e\u9762ALU\u6a21\u5757\uff0c\u9009\u62e9\u5bf9alun1\u548calun2\u8fdb\u884c\u54ea\u79cd\u903b\u8f91\u8fd0\u7b97\n);\n    always @(*) begin\n      case(aluCtrlOp)\n        2'b00:  aluOp &lt;= `ALU_OP_ADD;           // Load/Store\n        2'b01:  begin\n          if(itype &amp; funct3[1:0] != 2'b01)\n            aluOp &lt;= {1'b0, funct3};\n          else\n            aluOp &lt;= {funct7[5], funct3};   // normal ALUI/ALUR\n        end\n        2'b10:  begin\n          case(funct3)                    // bxx\n            `BEQ_FUNCT3:  aluOp &lt;= `ALU_OP_EQ;\n            `BNE_FUNCT3:  aluOp &lt;= `ALU_OP_NEQ;\n            `BLT_FUNCT3:  aluOp &lt;= `ALU_OP_SLT;\n            `BGE_FUNCT3:  aluOp &lt;= `ALU_OP_GE;\n            `BLTU_FUNCT3: aluOp &lt;= `ALU_OP_SLTU;\n            `BGEU_FUNCT3: aluOp &lt;= `ALU_OP_GEU;\n            default:      aluOp &lt;= `ALU_OP_XXX;\n          endcase\n          end\n        default: aluOp &lt;= `ALU_OP_XXX;\n      endcase\n    end\nendmodule\n</code></pre> <p>\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53 <code>aluCtrlOp</code> \u7b49\u4e8e\uff0801\uff09\u65f6\uff0c\u9700\u8981\u6839\u636e funct3 \u548c funct7 \u4ea7\u751f ALU \u7684\u64cd\u4f5c\u7801\u3002</p> <p>\u5728\u524d\u9762\u7684\u8bd1\u7801\u6a21\u5757\u4e2d\uff0c\u5df2\u7ecf\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86 I \u578b\u6307\u4ee4\u7c7b\u578b\u7684\u5224\u65ad\u4fe1\u53f7 <code>itype</code>\u3002</p> <p>\u5982\u679c\u662f <code>itype</code> \u4fe1\u53f7\u7b49\u4e8e\u201c1\u201d\uff0c\u64cd\u4f5c\u7801\u76f4\u63a5\u7531 funct3 \u548c\u9ad8\u4f4d\u8865\u201c0\u201d\u7ec4\u6210\uff1b\u5982\u679c\u4e0d\u662f I \u578b\u6307\u4ee4\uff0cALU \u64cd\u4f5c\u7801\u5219\u8981\u7531 funct3 \u548c funct7 \u7684\u7b2c\u4e94\u4f4d\u7ec4\u6210\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u7684\u4e09\u7c7b\u6307\u4ee4\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u4e2a 4 \u4f4d\u7684 ALU \u64cd\u4f5c\u4fe1\u53f7 aluOp\uff0c\u4e3a\u540e\u9762\u7684 ALU \u6a21\u5757\u505a\u76f8\u5173\u903b\u8f91\u8fd0\u884c\u63d0\u4f9b\u64cd\u4f5c\u7801\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_27","title":"\u901a\u7528\u5bc4\u5b58\u5668","text":"<p>\u6307\u4ee4\u5927\u591a\u4e0e\u5bc4\u5b58\u5668\u76f8\u5173\uff0c\u5148\u5b9e\u73b0\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757\uff08\u7c7b\u4f3c\u4e8eMIPS\u91cc\u9762\u7684\u5bc4\u5b58\u5668\u5806\uff1f\uff09</p> <p>R\u5f62\u6307\u4ee4add, rd, rs1, rs2  </p> <p>\u5bf9\u5e94\u5230\u6bcf\u6761\u6307\u4ee4\uff0c\u5219\u9700\u8981\u4ece\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757\u4e2d\u8bfb\u53d6\u5176\u4e2d\u4e24\u4e2a\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u636e\uff0c\u4e4b\u540e\u8fd8\u8981\u628a\u8fd0\u7b97\u7ed3\u679c\u5199\u5165\u53e6\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u3002</p> <p>\u6bcf\u8bfb\u53d6\u4e00\u4e2a\u5bc4\u5b58\u5668\uff0c\u5c31\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u5bc4\u5b58\u5668\u7d22\u5f15\uff08\u5bc4\u5b58\u5668\u7684\u5730\u5740\uff09\uff0c\u5e76\u8f93\u51fa\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u3002</p> <p>\u4e24\u4e2a\u64cd\u4f5c\u6570\u5bf9\u5e94\u7684\u5bc4\u5b58\u5668\u9700\u8981\u540c\u65f6\u8bfb\u53d6\uff0c\u6240\u4ee5\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757\u9700\u8981\u4e24\u4e2a\u8bfb\u5730\u5740\u63a5\u53e3\u548c\u4e24\u4e2a\u8bfb\u6570\u636e\u8f93\u51fa\u63a5\u53e3\u3002</p> <p>\u6b64\u5916\uff0c\u5904\u4e8e\u6d41\u6c34\u7ebf\u4e0a\u7684\u6307\u4ee4\u662f\u5e76\u53d1\u6267\u884c\u7684\uff0c\u5728\u8bfb\u53d6\u901a\u7528\u5bc4\u5b58\u5668\u7684\u540c\u65f6\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u5199\u5165\u6570\u636e\u5230\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u5957\u5199\u5730\u5740\u548c\u5199\u6570\u636e\u63a5\u53e3\u3002\u56e0\u6b64\uff0c\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757\u7684\u8bbe\u8ba1\u6846\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u4e2a\u4eba\u7406\u89e3\uff1a</p> <p>RISC-V\u4e2d\u7684\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u5bc4\u5b58\u5668\u6587\u4ef6\uff08\u5bc4\u5b58\u5668\u5806\uff09\uff0c\u7528\u4e8e\u5b58\u50a8\u548c\u7ba1\u7406\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6570\u636e\u3002\u5b83\u901a\u5e38\u5305\u62ec\u591a\u4e2a\u5bc4\u5b58\u5668\uff0c\u6bcf\u4e2a\u5bc4\u5b58\u5668\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u5730\u5740\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e\u3002</p> <ul> <li> <p>\u5bf9\u4e8e\u8f93\u5165</p> <ul> <li>read address1\u548cread address2\u7528\u4e8e\u9009\u62e9\u8981\u8bfb\u53d6\u7684\u5bc4\u5b58\u5668\u5730\u5740\uff08\u4e3a\u4ec0\u4e48\u8bfb\u4e24\u4e2a\uff0c\u6709\u4e9b\u6307\u4ee4\u4e24\u4e2a\u6e90\u64cd\u4f5c\u6570\u9700\u8981\u4e24\u4e2a\u5bc4\u5b58\u5668\uff09</li> <li>write address\u7528\u4e8e\u9009\u62e9\u8981\u5199\u5165\u7684\u5bc4\u5b58\u5668\u5730\u5740</li> <li>write data\u7528\u4e8e\u5199\u5165\u6570\u636e\u5230\u9009\u5b9a\u7684\u5bc4\u5b58\u5668\u3002</li> </ul> </li> <li> <p>\u5bf9\u4e8e\u8f93\u51fa</p> <ul> <li>read data1\u548cread data2\u7528\u4e8e\u8f93\u51fa\u4ece\u9009\u5b9a\u7684\u5bc4\u5b58\u5668\u8bfb\u53d6\u7684\u6570\u636e\u3002</li> </ul> </li> <li> <p>\u5206\u6790\u4e00\u6761\u6307\u4ee4</p> <p>\u5982\u679c\u73b0\u5728\u8bfb\u53d6\u4e00\u4e2a\u5bc4\u5b58\u5668\uff0c\u90a3\u4e48\u9996\u5148\u9700\u8981\u6307\u5b9a\u8981\u8bfb\u53d6\u5bc4\u5b58\u5668\u5806\u91cc\u7684\u54ea\u4e24\u4e2a\u5bc4\u5b58\u5668\uff08\u901a\u8fc7read address\uff09\uff0c\u7136\u540e\u8f93\u51fa\uff08\u901a\u8fc7read data\uff09\u3002\u53ef\u80fd\u8fd9\u4e2a\u65f6\u5019\u7531\u4e8e\u6307\u4ee4\u6d41\u6c34\u7ebf\uff0c\u53c8\u4f1a\u5bf9\u8fd9\u4e2a\u5bc4\u5b58\u5668\u8fdb\u884c\u5199\u5165\uff0c\u90a3\u5c31\u9700\u8981write data\u548cwrite address\u3002\u8fd9\u5c31\u8ba9\u8fd9\u4e2a\u5bc4\u5b58\u5668\u6a21\u5757\u540c\u65f6\u6709\u4e86\u56db\u4e2a\u8f93\u5165 \u4e24\u4e2a\u8f93\u51fa\u3002</p> </li> </ul> <pre><code>module gen_regs (\n    input  clk,\n    input  reset,\n    input  wen,\n    input  [4:0] regRAddr1, regRAddr2, regWAddr,\n    input  [31:0] regWData,\n    output [31:0] regRData1,\n    output [31:0] regRData2\n);\n    integer ii;\n    reg [31:0] regs[31:0];\n\n    // write registers\n    always @(posedge clk or posedge reset) begin\n        if(reset) begin\n            for(ii=0; ii&lt;32; ii=ii+1)\n                regs[ii] &lt;= 32'b0;\n        end\n        else if(wen &amp; (|regWAddr)) \n                regs[regWAddr] &lt;= regWData;\n    end\n\n    // read registers\n    assign regRData1 = wen &amp; (regWAddr == regRAddr1) ? regWData\n                    : ((regRAddr1 != 5'b0) ? regs[regRAddr1] : 32'b0);\n    assign regRData2 = wen &amp; (regWAddr == regRAddr2) ? regWData\n                    : ((regRAddr2 != 5'b0) ? regs[regRAddr2] : 32'b0);\nendmodule\n</code></pre> <p>\u8fd9\u91cc\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5199\u63a7\u5236\u4f7f\u80fd\u4fe1\u53f7 wen\u3002\uff08write enable\uff09</p> <p>\u56e0\u4e3a\u5199\u5bc4\u5b58\u5668\u662f\u8fb9\u6cbf\u89e6\u53d1\u7684\uff0c\u5728\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5185\u5199\u5165\u7684\u5bc4\u5b58\u5668\u6570\u636e\uff0c\u9700\u8981\u5728\u4e0b\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u624d\u80fd\u628a\u5199\u5165\u7684\u6570\u636e\u8bfb\u53d6\u51fa\u6765\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8\u8bfb\u5199\u6548\u7387\uff0c\u5728\u5bf9\u540c\u4e00\u4e2a\u5bc4\u5b58\u5668\u8fdb\u884c\u8bfb\u5199\u65f6\uff0c\u5982\u679c\u5199\u4f7f\u80fd wen \u6709\u6548\uff0c\u5c31\u76f4\u63a5\u628a\u5199\u5165\u5bc4\u5b58\u5668\u7684\u6570\u636e\u9001\u7ed9\u8bfb\u6570\u636e\u63a5\u53e3\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5185\uff0c\u8bfb\u51fa\u5f53\u524d\u8981\u5199\u5165\u7684\u5bc4\u5b58\u5668\u6570\u636e\u4e86\u3002\uff08\u76f4\u63a5\u8d8a\u8fc7\uff0c\u6709\u70b9\u50cf\u5927\u8bdd\u8ba1\u7b97\u673a\u7684\u6d41\u6c34\u7ebf\u90a3\u4e00\u7ae0\u7684\u5f00\u5934\u90e8\u5206\uff09</p> <p>\u6ce8\uff1a</p> <p>\u200b 2<sup>5</sup>=32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668</p> <p>\u200b \u5176\u4e2d\uff0c\u8fd8\u6709\u4e00\u4e2a\u5bc4\u5b58\u5668\u6bd4\u8f83\u7279\u6b8a\uff0c\u4ece\u4ee3\u7801\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u5b83\u7684\u7279\u6b8a\u5904\u7406\uff0c\u5373\u8bfb\u5730\u5740 regRAddr1 = 5\u2019b0 \u65f6\u7684\u5bc4\u5b58\u5668\u3002\u6211\u4eec\u628a\u7b2c\u4e00\u4e2a\u5bc4\u5b58\u5668\u53eb\u505a 0 \u503c\u5bc4\u5b58\u5668\uff0c\u56e0\u4e3a\u5728 RISC-V \u6307\u4ee4\u67b6\u6784\u4e2d\u5c31\u89c4\u5b9a\u597d\u4e86\uff0c\u7b2c\u4e00\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u5fc5\u987b\u7f16\u7801\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u628a\u5199\u5165\u8be5\u5bc4\u5b58\u5668\u7684\u6570\u636e\u5ffd\u7565\uff0c\u800c\u5728\u8bfb\u53d6\u65f6\u6c38\u8fdc\u8f93\u51fa\u4e3a 0\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#alu","title":"ALU\u6a21\u5757\u8bbe\u8ba1","text":"<pre><code>module alu (\n  input  [31:0] alu_data1_i,\n  input  [31:0] alu_data2_i,\n  input  [ 3:0] alu_op_i,\n  output [31:0] alu_result_o\n);\n\n  reg  [31:0] result;\n\n  wire [31:0] sum    = alu_data1_i + ((alu_op_i[3] | alu_op_i[1]) ? -alu_data2_i : alu_data2_i);\n  wire        neq    = |sum;\n  wire        cmp    = (alu_data1_i[31] == alu_data2_i[31]) ? sum[31]\n                     : alu_op_i[0] ? alu_data2_i[31] : alu_data1_i[31];\n  wire [ 4:0] shamt  = alu_data2_i[4:0];\n  wire [31:0] shin   = alu_op_i[2] ? alu_data1_i : reverse(alu_data1_i);\n  wire [32:0] shift  = {alu_op_i[3] &amp; shin[31], shin};\n  wire [32:0] shiftt = ($signed(shift) &gt;&gt;&gt; shamt);\n  wire [31:0] shiftr = shiftt[31:0];\n  wire [31:0] shiftl = reverse(shiftr);\n\n  always @(*) begin\n    case(alu_op_i)\n      `ALU_OP_ADD:    result &lt;= sum;\n      `ALU_OP_SUB:    result &lt;= sum;\n      `ALU_OP_SLL:    result &lt;= shiftl;\n      `ALU_OP_SLT:    result &lt;= cmp;\n      `ALU_OP_SLTU:   result &lt;= cmp;\n      `ALU_OP_XOR:    result &lt;= (alu_data1_i ^ alu_data2_i);\n      `ALU_OP_SRL:    result &lt;= shiftr;\n      `ALU_OP_SRA:    result &lt;= shiftr;\n      `ALU_OP_OR:     result &lt;= (alu_data1_i | alu_data2_i);\n      `ALU_OP_AND:    result &lt;= (alu_data1_i &amp; alu_data2_i);\n\n      `ALU_OP_EQ:     result &lt;= {31'b0, ~neq};\n      `ALU_OP_NEQ:    result &lt;= {31'b0, neq};\n      `ALU_OP_GE:     result &lt;= {31'b0, ~cmp};\n      `ALU_OP_GEU:    result &lt;= {31'b0, ~cmp};\n      default:        begin \n                      result &lt;= 32'b0; \n        end\n    endcase\n  end\n\n  function [31:0] reverse;\n    input [31:0] in;\n    integer i;\n    for(i=0; i&lt;32; i=i+1) begin\n      reverse[i] = in[31-i];\n    end\n  endfunction  \n\n  assign alu_result_o = result;\n\nendmodule\n</code></pre> <p>ALU \u6a21\u5757\u7684\u603b\u4f53\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u91cc\u9762\u8fd9\u6bb5\u4ee3\u7801\uff08\u7b2c 10 \u884c\uff5e\u7b2c 19 \u884c\uff09\u4e0d\u597d\u7406\u89e3\uff0c\u522b\u62c5\u5fc3\uff0c\u6211\u8fd9\u91cc\u4e13\u95e8\u62ff\u51fa\u6765\u7ed9\u4f60\u8bb2\u4e00\u4e0b\u3002 </p> <pre><code>wire [31:0] sum    = aluIn1 + ((aluOp[3] | aluOp[1]) ? -aluIn2 : aluIn2);\nwire        neq    = |sum;\nwire        cmp    = (aluIn1[31] == aluIn2[31]) ? sum[31]\n                    : aluOp[0] ? aluIn2[31] : aluIn1[31];\n</code></pre> <ol> <li> <p>sum \u4fe1\u53f7\u662f\u4e24\u4e2a\u6e90\u64cd\u4f5c\u6570\u7684\u548c\uff0c\u4e0d\u8fc7\u5f53\u8fd0\u7b97\u7801 aluOp \u7684\u7b2c 3 \u4f4d\u548c\u7b2c 1 \u4f4d\u4e3a\u201c1\u201d\u65f6\u505a\u7684\u662f\u76f8\u51cf\u8fd0\u7b97\uff0c\u8fd9\u662f\u4e3a\u51cf\u6cd5\u6307\u4ee4\u6216\u8005\u540e\u9762\u7684\u6bd4\u8f83\u5927\u5c0f\u800c\u51c6\u5907\u7684\u8fd0\u7b97\u3002\u4f60\u53ef\u4ee5\u5bf9\u7167\u4e0a\u9762\u7684 ALU \u8fd0\u7b97\u8868\u683c\u6765\u7406\u89e3\u3002</p> </li> <li> <p>neq \u4fe1\u53f7\u8868\u793a\u7684\u662f\u6bd4\u8f83\u4e24\u4e2a\u64cd\u4f5c\u6570\u662f\u5426\u76f8\u7b49\uff0c\u8fd9\u5c31\u662f\u6839\u636e\u524d\u9762\u7684\u4e24\u4e2a\u64cd\u4f5c\u76f8\u51cf\u7684\u7ed3\u679c\u5224\u65ad\uff0c\u5982\u679c\u5b83\u4eec\u7684\u5dee\u4e0d\u4e3a\u201c0\u201d\uff0c\u4e5f\u5c31\u662f sum \u4fe1\u53f7\u6309\u4f4d\u4e0e\u4e4b\u540e\u4e0d\u4e3a\u201c0\u201d\uff0c\u5219\u8868\u793a\u4e24\u4e2a\u64cd\u4f5c\u6570\u4e0d\u76f8\u7b49\u3002</p> </li> <li> <p>cmp \u4fe1\u53f7\u8868\u793a\u4e24\u4e2a\u64cd\u4f5c\u6570\u7684\u5927\u5c0f\u6bd4\u8f83\uff0c\u5982\u679c\u5b83\u4eec\u7684\u6700\u9ad8\u4f4d\uff08\u4e5f\u5c31\u662f\u7b26\u53f7\u4f4d\uff09\u76f8\u7b49\uff0c\u5219\u6839\u636e\u4e24\u4e2a\u64cd\u4f5c\u6570\u76f8\u51cf\u7684\u5dee\u503c\u7684\u7b26\u53f7\u4f4d\uff08\u4e5f\u662f\u6570\u503c\u7684\u6700\u9ad8\u4f4d\uff09\u5224\u65ad\u3002\u5982\u679c\u662f\u6b63\u6570\uff0c\u8868\u793a\u6e90\u64cd\u4f5c\u6570 1 \u5927\u4e8e\u6e90\u64cd\u4f5c\u6570 2\uff0c\u5426\u5219\u8868\u793a\u6e90\u64cd\u4f5c\u6570 1 \u5c0f\u4e8e\u6e90\u64cd\u4f5c\u6570 2\u3002\u5982\u679c\u5b83\u4eec\u7684\u6700\u9ad8\u4f4d\u4e0d\u76f8\u7b49\uff0c\u5219\u6839\u636e ALU \u8fd0\u7b97\u63a7\u5236\u7801 aluOp \u7684\u6700\u4f4e\u4f4d\u5224\u65ad\u3002\u5982\u679c aluOp \u6700\u4f4e\u4f4d\u4e3a\u201c1\u201d\uff0c\u8868\u793a\u662f\u65e0\u7b26\u53f7\u6570\u6bd4\u8f83\uff0c\u76f4\u63a5\u53d6\u64cd\u4f5c\u6570 2 \u7684\u6700\u9ad8\u4f4d\u4f5c\u4e3a\u6bd4\u8f83\u7ed3\u679c\u3002\u5982\u679c aluOp \u6700\u4f4e\u4f4d\u4e3a\u201c0\u201d\uff0c\u8868\u793a\u662f\u6709\u7b26\u53f7\u6570\u6bd4\u8f83\uff0c\u76f4\u63a5\u53d6\u64cd\u4f5c\u6570 1 \u7684\u6700\u9ad8\u4f4d\u4f5c\u4e3a\u6bd4\u8f83\u7ed3\u679c\u3002</p> </li> </ol> <p>\u79fb\u4f4d\u64cd\u4f5c\u76f8\u5173\u7684\u4ee3\u7801\uff0c</p> <pre><code>  wire [ 4:0] shamt  = aluIn2[4:0];\n  wire [31:0] shin   = aluOp[2] ? aluIn1 : reverse(aluIn1);\n  wire [32:0] shift  = {aluOp[3] &amp; shin[31], shin};\n  wire [32:0] shiftt = ($signed(shift) &gt;&gt;&gt; shamt);\n  wire [31:0] shiftr = shiftt[31:0];\n  wire [31:0] shiftl = reverse(shiftr);\n</code></pre> <ol> <li> <p>shamt \u4fe1\u53f7\u662f\u53d6\u81ea\u6e90\u64cd\u4f5c\u6570 2 \u7684\u4f4e\u4e94\u4f4d\uff0c\u8868\u793a\u6e90\u64cd\u4f5c\u6570 1 \u9700\u8981\u79fb\u591a\u5c11\u4f4d\uff082<sup>5</sup>=32\uff09\u3002</p> </li> <li> <p>shin \u4fe1\u53f7\u662f\u53d6\u51fa\u8981\u79fb\u4f4d\u7684\u6570\u503c\uff0c\u6839\u636e aluOp \u5224\u65ad\u662f\u5de6\u79fb\u8fd8\u662f\u53f3\u79fb\uff0c\u5982\u679c\u662f\u53f3\u79fb\u5c31\u76f4\u63a5\u7b49\u4e8e\u6e90\u64cd\u4f5c\u6570 1\uff0c\u5982\u679c\u662f\u5de6\u79fb\u5c31\u5148\u5bf9\u6e90\u64cd\u4f5c\u6570\u7684\u5404\u4f4d\u6570\u505a\u955c\u50cf\u5904\u7406\u3002</p> </li> <li> <p>shift \u4fe1\u53f7\u662f\u6839\u636e aluOp \u5224\u65ad\u662f\u7b97\u672f\u53f3\u79fb\u8fd8\u662f\u903b\u8f91\u53f3\u79fb\uff0c\u5982\u679c\u662f\u7b97\u672f\u53f3\u79fb\uff0c\u5219\u5728\u6700\u9ad8\u4f4d\u8865\u4e00\u4e2a\u7b26\u53f7\u4f4d\u3002</p> </li> <li> <p>shiftt \u4fe1\u53f7\u662f\u53f3\u79fb\u4e4b\u540e\u7684\u7ed3\u679c\uff0c\u8fd9\u91cc\u7528\u5230\u4e86$signed() \u51fd\u6570\u5bf9\u79fb\u4f4d\u524d\u7684\u6570\u636e shift \u8fdb\u884c\u4e86\u4fee\u9970\uff0c$signed() \u7684\u4f5c\u7528\u662f\u51b3\u5b9a\u5982\u4f55\u5bf9\u64cd\u4f5c\u6570\u6269\u4f4d\u8fd9\u4e2a\u95ee\u9898\u3002</p> </li> <li> <p>\u5de6\u79fb\u7684\u7ed3\u679c shiftl\uff0c\u662f\u7531\u53f3\u79fb\u540e\u7684\u7ed3\u679c\u8fdb\u884c\u4f4d\u7f6e\u53d6\u53cd\u5f97\u5230\u7684\u3002\u56e0\u4e3a\u5bf9\u4e8e\u9700\u8981\u5de6\u79fb\u7684\u64cd\u4f5c\u6570\uff0c\u5728\u524d\u9762\u5df2\u7ecf\u505a\u4e86\u4f4d\u7f6e\u53d6\u53cd\uff0c\u6240\u4ee5\u79fb\u4f4d\u64cd\u4f5c\u65f6\u4e5f\u662f\u8fdb\u884c\u53f3\u79fb\u5904\u7406\uff0c\u6700\u540e\u628a\u7ed3\u679c\u518d\u4e00\u6b21\u505a\u4f4d\u7f6e\u53d6\u53cd\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>(\u7531\u6b64\u53ef\u89c1RISC-V\u7684\u54f2\u5b66\uff0c\u80fd\u7528\u5df2\u7ecf\u5b9e\u73b0\u7684\u7535\u8def\uff0c\u5c31\u4e0d\u518d\u521b\u9020\u65b0\u7684\u7535\u8def)</p> </li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_28","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_29","title":"\u76f8\u5173\u4ee3\u7801","text":"<ul> <li><code>ALUCtrl.v</code>(\u6267\u884c\u63a7\u5236\u6a21\u5757)</li> <li><code>gen_regs.v</code>(\u901a\u7528\u5bc4\u5b58\u5668\u6a21\u5757)</li> <li><code>alu.v</code>(\u6267\u884c\u6a21\u5757)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpucpu_1","title":"\u624b\u5199CPU\uff08\u56db\uff09\uff1aCPU\u6d41\u6c34\u7ebf\u7684\u8bbf\u5b58\u9636\u6bb5","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_30","title":"\u6d41\u6c34\u7ebf\u6570\u636e\u5192\u9669","text":"<p>\u6307\u4ee4\u5728\u6d41\u6c34\u7ebf\u4e2d\u91cd\u53e0\u6267\u884c\u65f6\uff0c\u540e\u9762\u7684\u6307\u4ee4\u9700\u8981\u7528\u5230\u524d\u9762\u7684\u6307\u4ee4\u7684\u6267\u884c\u7ed3\u679c\uff0c\u800c\u524d\u9762\u7684\u6307\u4ee4\u7ed3\u679c\u5c1a\u672a\u5199\u56de\uff0c\u7531\u6b64\u5bfc\u81f4\u7684\u51b2\u7a81\u5c31\u53eb\u6570\u636e\u5192\u9669\u3002</p> <pre><code>add  x2,x0,x1\nsub x6,x2,x3\n</code></pre> <p>\u89e3\u51b3\uff1a</p> <ol> <li>\u6570\u636e\u524d\u9012</li> <li>nop\u7a7a\u6ce1</li> <li>\u6307\u4ee4\u91cd\u6392</li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_31","title":"\u6570\u636e\u524d\u9012\u6a21\u5757\u8bbe\u8ba1","text":"<p>\u628a\u6d41\u6c34\u7ebf\u4e2d\u540e\u9762\u9636\u6bb5\u4ea7\u751f\u7684\u6570\u636e\u5411\u524d\u4f20\u9012\u7684\u8fc7\u7a0b</p> <p></p> <p>\u6d41\u6c34\u7ebf\u6839\u636e\u5f53\u524d\u6307\u4ee4\u7684\u8bd1\u7801\u4fe1\u53f7\uff0c\u9009\u62e9\u8bfb\u53d6\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6570\u636e\u4f5c\u4e3a\u6267\u884c\u6a21\u5757\u7684\u64cd\u4f5c\u6570\uff0c\u6216\u8005\u9009\u62e9\u6765\u81ea\u524d\u9012\u6a21\u5757\u7684\u6570\u636e\u4f5c\u4e3a\u6267\u884c\u6a21\u5757\u7684\u64cd\u4f5c\u6570\u3002</p> <pre><code>- module forwarding (\n      input [4:0] rs1,\n      input [4:0] rs2,        //\u6307\u4ee4\u8bd1\u7801\u540e\u5f97\u5230\u7684\u4e24\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u7d22\u5f15\n      input [4:0] exMemRd,    //\u6765\u81ea\u8bbf\u5b58\u6a21\u5757\u7684\u5bf9\u901a\u7528\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee\u5730\u5740\n      input       exMemRw,    //\u8bbf\u5b58\u9636\u6bb5\u5bf9\u901a\u7528\u5bc4\u5b58\u5668\u7684\u5199\u4f7f\u80fd\u63a7\u5236\u4fe1\u53f7\n      input [4:0] memWBRd,    //\u5199\u56de\u6a21\u5757\u5bf9\u901a\u7528\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee\u5730\u5740\n      input       memWBRw,    //\u5199\u56de\u6a21\u5757\u5bf9\u901a\u7528\u5bc4\u5b58\u5668\u7684\u5199\u4f7f\u80fd\u63a7\u5236\u4fe1\u53f7\u4fe1\u53f7  \n                              //\u8fd9\u56db\u4e2a\u53ef\u4ee5\u7528\u4e8e\u5224\u65ad\u662f\u5426\u53d1\u751f\u6570\u636e\u5192\u9669\n      input        mem_wb_ctrl_data_toReg,\n      input [31:0] mem_wb_readData,\n      input [31:0] mem_wb_data_result,\n      input [31:0] id_ex_data_regRData1,    \n    input [31:0] id_ex_data_regRData2,   //\u6d41\u6c34\u7ebf\u4e0d\u53d1\u751f\u6570\u636e\u5192\u9669\uff0c\u7528\u6307\u4ee4\u8bd1\u7801\u4e4b\u540e\u8bfb\u51fa\u7684\u4e24\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6570\u636e\n      input [31:0] ex_mem_data_result,      //\u6307\u4ee4\u6267\u884c\u540e\u8bbf\u5b58\u9636\u6bb5\u9700\u8981\u5199\u5230\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6570\u636e\n\n      output [31:0] forward_rs1_data,\n      output [31:0] forward_rs2_data\n    );\n      //\u68c0\u67e5\u662f\u5426\u53d1\u751f\u6570\u636e\u5192\u9669\n      //\u5982\uff1a\u4e0a\u56fe\u7684\u5f53\u524d\u6307\u4ee4\uff0csub\u7684\u4e24\u4e2a\u6e90\u64cd\u4f5c\u6570x2 x3\uff0c\u9009\u62e9\u54ea\u4e24\u4e2a\u5bc4\u5b58\u5668\u4e3ars1 rs2\n      //exMemRd\u548cmemWBRd\uff0c\u4e3a\u4e0a\u4e00\u6761\u6307\u4ee4add\u7684\u6267\u884c\u7ed3\u679cx2\u901a\u7528\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee\u5730\u5740\n      wire [1:0] forward_rs1_sel = (exMemRw &amp; (rs1 == exMemRd) &amp; (exMemRd != 5'b0)) ? 2'b01\n                                  :(memWBRw &amp; (rs1 == memWBRd) &amp; (memWBRd != 5'b0)) ? 2'b10\n                                  : 2'b00;\n\n      wire [1:0] forward_rs2_sel = (exMemRw &amp; (rs2 == exMemRd) &amp; (exMemRd != 5'b0)) ? 2'b01\n                                  :(memWBRw &amp; (rs2 == memWBRd) &amp; (memWBRd != 5'b0)) ? 2'b10\n                                  : 2'b00;\n\n      //\u56de\u5199\u9636\u6bb5\uff0c\u9700\u8981\u66f4\u65b0\u5230\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6570\u636e\n      wire [31:0] regWData = mem_wb_ctrl_data_toReg ? mem_wb_readData : mem_wb_data_result; \n\n      //\u6839\u636e\u6570\u636e\u5192\u9669\u7684\u7c7b\u578b\u9009\u62e9\u524d\u9012\u7684\u6570\u636e\n      assign forward_rs1_data = (forward_rs1_sel == 2'b00) ? id_ex_data_regRData1 :\n                                (forward_rs1_sel == 2'b01) ? ex_mem_data_result   :\n                                (forward_rs1_sel == 2'b10) ? regWData : 32'h0; \n\n      assign forward_rs2_data = (forward_rs2_sel == 2'b00) ? id_ex_data_regRData2 :\n                                (forward_rs2_sel == 2'b01) ? ex_mem_data_result   :\n                                (forward_rs2_sel == 2'b10) ? regWData : 32'h0; \n\nendmodule\n</code></pre> <p>\u8fd9\u4e2a\u6a21\u5757\u901a\u8fc7\u6bd4\u8f83\u5f53\u524d\u6307\u4ee4\u9700\u8981\u8bfb\u53d6\u7684\u5bc4\u5b58\u5668\u5730\u5740\u4e0e\u6267\u884c\u9636\u6bb5\u548c\u5185\u5b58\u8bbf\u95ee\u9636\u6bb5\u5c06\u8981\u5199\u5165\u7684\u5730\u5740\uff0c\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u8fdb\u884c\u6570\u636e\u524d\u9012\u3002</p> <ul> <li>\u5982\u679c\u9700\u8981\uff0c\u5b83\u4f1a\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u6e90\u8fdb\u884c\u524d\u9012\uff0c\u4ee5\u907f\u514d\u7531\u4e8e\u6570\u636e\u5192\u9669\u5bfc\u81f4\u7684\u6027\u80fd\u635f\u5931\u3002</li> <li>\u5982\u679c\u4e0d\u9700\u8981\u524d\u9012\uff0c\u5b83\u4f1a\u76f4\u63a5\u4f7f\u7528\u8bd1\u7801\u9636\u6bb5\u8bfb\u53d6\u7684\u5bc4\u5b58\u5668\u6570\u636e\u3002</li> </ul> <p>\u6b64\u5916\uff0c\u8be5\u6a21\u5757\u8fd8\u8003\u8651\u4e86\u5199\u56de\u9636\u6bb5\u7684\u6570\u636e\uff0c\u5982\u679c\u5185\u5b58\u8bbf\u95ee\u9636\u6bb5\u6709\u5199\u64cd\u4f5c\uff0c\u5e76\u4e14\u76ee\u6807\u5730\u5740\u4e0e\u5f53\u524d\u6307\u4ee4\u8bfb\u53d6\u7684\u5730\u5740\u76f8\u540c\uff0c\u90a3\u4e48\u5b83\u4f1a\u4f7f\u7528\u5199\u56de\u9636\u6bb5\u7684\u6570\u636e\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_32","title":"\u8bbf\u5b58\u63a7\u5236\u6a21\u5757\u8bbe\u8ba1","text":"<pre><code>module ex_mem_ctrl(\n  input        clk,\n  input        reset,\n  input        in_mem_ctrl_memRead,   //memory\u8bfb\u63a7\u5236\u4fe1\u53f7\n  input        in_mem_ctrl_memWrite,  //memory\u5199\u63a7\u5236\u4fe1\u53f7\n  input  [1:0] in_mem_ctrl_maskMode,  //mask\u6a21\u5f0f\u9009\u62e9\n  input        in_mem_ctrl_sext,      //\u7b26\u53f7\u6269\u5c55\n  input        in_wb_ctrl_toReg,      //\u5199\u56de\u5bc4\u5b58\u5668\u7684\u6570\u636e\u9009\u62e9\uff0c\u201c1\u201d\u65f6\u4e3amem\u8bfb\u53d6\u7684\u6570\u636e\n  input        in_wb_ctrl_regWrite,   //\u5bc4\u5b58\u5668\u5199\u63a7\u5236\u4fe1\u53f7\n  input        flush,                 //\u6d41\u6c34\u7ebf\u6570\u636e\u51b2\u5237\u4fe1\u53f7\n  output       out_mem_ctrl_memRead,\n  output       out_mem_ctrl_memWrite,\n  output [1:0] out_mem_ctrl_maskMode,\n  output       out_mem_ctrl_sext,\n  output       out_wb_ctrl_toReg,\n  output       out_wb_ctrl_regWrite\n);\n\n  reg  reg_mem_ctrl_memRead; \n  reg  reg_mem_ctrl_memWrite; \n  reg [1:0] reg_mem_ctrl_maskMode; \n  reg  reg_mem_ctrl_sext; \n  reg  reg_wb_ctrl_toReg; \n  reg  reg_wb_ctrl_regWrite; \n\n  assign out_mem_ctrl_memRead = reg_mem_ctrl_memRead; \n  assign out_mem_ctrl_memWrite = reg_mem_ctrl_memWrite; \n  assign out_mem_ctrl_maskMode = reg_mem_ctrl_maskMode; \n  assign out_mem_ctrl_sext = reg_mem_ctrl_sext; \n  assign out_wb_ctrl_toReg = reg_wb_ctrl_toReg; \n  assign out_wb_ctrl_regWrite = reg_wb_ctrl_regWrite; \n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_mem_ctrl_memRead &lt;= 1'h0; \n    end else if (flush) begin \n      reg_mem_ctrl_memRead &lt;= 1'h0; \n    end else begin \n      reg_mem_ctrl_memRead &lt;= in_mem_ctrl_memRead; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_mem_ctrl_memWrite &lt;= 1'h0; \n    end else if (flush) begin \n      reg_mem_ctrl_memWrite &lt;= 1'h0; \n    end else begin \n      reg_mem_ctrl_memWrite &lt;= in_mem_ctrl_memWrite; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_mem_ctrl_maskMode &lt;= 2'h0; \n    end else if (flush) begin \n      reg_mem_ctrl_maskMode &lt;= 2'h0; \n    end else begin \n      reg_mem_ctrl_maskMode &lt;= in_mem_ctrl_maskMode; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_mem_ctrl_sext &lt;= 1'h0; \n    end else if (flush) begin \n      reg_mem_ctrl_sext &lt;= 1'h0; \n    end else begin \n      reg_mem_ctrl_sext &lt;= in_mem_ctrl_sext; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_wb_ctrl_toReg &lt;= 1'h0; \n    end else if (flush) begin \n      reg_wb_ctrl_toReg &lt;= 1'h0; \n    end else begin \n      reg_wb_ctrl_toReg &lt;= in_wb_ctrl_toReg; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_wb_ctrl_regWrite &lt;= 1'h0; \n    end else if (flush) begin \n      reg_wb_ctrl_regWrite &lt;= 1'h0; \n    end else begin \n      reg_wb_ctrl_regWrite &lt;= in_wb_ctrl_regWrite; \n    end\n  end\n\nendmodule\n</code></pre> <ol> <li> <p>reg_mem_ctrl_memRead: \u8fd9\u4e2a\u65f6\u5e8f\u903b\u8f91\u5757\u7528\u4e8e\u66f4\u65b0\u5185\u5b58\u63a7\u5236\u6a21\u5757\u4e2d\u7684memRead\u5bc4\u5b58\u5668\u3002</p> <ul> <li>\u5f53\u590d\u4f4d\u4fe1\u53f7\u4e3a1\u65f6\uff0c\u5c06memRead\u5bc4\u5b58\u5668\u7684\u503c\u7f6e\u4e3a0\uff1b</li> <li>\u5f53\u6d41\u6c34\u7ebf\u7684\u51b2\u5237\u63a7\u5236flush\u4fe1\u53f7\u4e3a1\u65f6\uff0c\u4e5f\u5c06 <code>memRead</code> \u5bc4\u5b58\u5668\u7684\u503c\u7f6e\u4e3a0\uff1b</li> <li>\u5426\u5219\uff0c\u5c31\u628a\u4e0a\u4e00\u9636\u6bb5\u9001\u8fc7\u6765\u7684\u63a7\u5236\u4fe1\u53f7\uff08\u6bd4\u5982\u5b58\u50a8\u5668\u8bfb\u63a7\u5236\u4fe1\u53f7 <code>memRead</code>\u3001\u5b58\u50a8\u5668\u5199\u63a7\u5236\u4fe1\u53f7 <code>memWrite</code>\u2026\u2026\u7b49\uff09\uff0c\u901a\u8fc7\u5bc4\u5b58\u5668\u4fdd\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u53d1\u9001\u7ed9\u5b58\u50a8\u5668\u8bfb\u5199\u63a7\u5236\u6a21\u5757\uff08<code>dmem_rw.v</code>\uff09\u6216\u8005\u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u7ea7\u4f7f\u7528\u3002</li> </ul> </li> <li> <p><code>reg_mem_ctrl_memWrite;      reg_mem_ctrl_maskMode;     reg_mem_ctrl_sext;      reg_wb_ctrl_toReg;      reg_wb_ctrl_regWrite;</code></p> <p>\u540c1\u7684\u65f6\u5e8f\u903b\u8f91</p> </li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_33","title":"\u8bbf\u5b58\u6570\u636e\u901a\u8def\u6a21\u5757","text":"<p>\u628a\u8bbf\u5b58\u9636\u6bb5\u8bfb\u53d6\u5230\u7684\u5b58\u50a8\u5668\u6570\u636e\uff0c\u6216\u8005\u662f\u6307\u4ee4\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u53d1\u9001\u6d41\u6c34\u7ebf\u7684\u4e0b\u4e00\u7ea7\u5904\u7406\u3002</p> <p>\u7531\u4e8e\u4e0b\u4e00\u7ea7\u4e5f\u5c31\u662f\u6d41\u6c34\u7ebf\u7684\u6700\u540e\u4e00\u7ea7\u2014\u2014\u5199\u56de\uff0c\u6240\u4ee5\u8bbf\u5b58\u7684\u6570\u636e\u901a\u8def\u4e3b\u8981\u5305\u62ec\u8981\u5199\u56de\u7684\u901a\u7528\u5bc4\u5b58\u5668\u5730\u5740 regWAddr\u3001\u8bbf\u95ee\u5b58\u50a8\u5668\u8bfb\u53d6\u7684\u6570\u636e regRData2\u3001\u6307\u4ee4\u8fd0\u7b97\u7684\u7ed3\u679c result \u7b49\u3002</p> <pre><code>module ex_mem(\n  input         clk,\n  input         reset,\n  input  [4:0]  in_regWAddr,    //\u5199\u56de\u5bc4\u5b58\u5668\u7684\u5730\u5740\n  input  [31:0] in_regRData2,   //\u8bfb\u5b58\u50a8\u5668\u7684\u6570\u636e\n  input  [1:0]  ex_result_sel,  //\u6267\u884c\u7ed3\u679c\u9009\u62e9\n  input  [31:0] id_ex_data_imm, //\u6307\u4ee4\u7acb\u5373\u6570\n  input  [31:0] alu_result,     //ALU\u8fd0\u7b97\u7ed3\u679c\n  input  [31:0] in_pc,          //\u5f53\u524dPC\u503c\n  input         flush,          //\u6d41\u6c34\u7ebf\u6570\u636e\u51b2\u5237\u63a7\u5236\u4fe1\u53f7\n  output [4:0]  data_regWAddr,\n  output [31:0] data_regRData2,\n  output [31:0] data_result,\n  output [31:0] data_pc\n);\n  reg [4:0] reg_regWAddr; \n  reg [31:0] reg_regRData2; \n  reg [31:0] reg_result; \n  reg [31:0] reg_pc; \n\n  wire [31:0] resulet_w = (ex_result_sel == 2'h0) ? alu_result :\n                          (ex_result_sel == 2'h1) ? id_ex_data_imm :\n                          (ex_result_sel == 2'h2) ? (in_pc +32'h4) : 32'h0;\n  assign data_regWAddr = reg_regWAddr; \n  assign data_regRData2 = reg_regRData2; \n  assign data_result = reg_result; \n  assign data_pc = reg_pc; \n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_regWAddr &lt;= 5'h0; \n    end else if (flush) begin \n      reg_regWAddr &lt;= 5'h0; \n    end else begin \n      reg_regWAddr &lt;= in_regWAddr; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_regRData2 &lt;= 32'h0; \n    end else if (flush) begin \n      reg_regRData2 &lt;= 32'h0; \n    end else begin \n      reg_regRData2 &lt;= in_regRData2; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_result &lt;= 32'h0; \n    end else if (flush) begin \n      reg_result &lt;= 32'h0; \n    end else begin \n      reg_result &lt;= resulet_w; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_pc &lt;= 32'h0; \n    end else if (flush) begin \n      reg_pc &lt;= 32'h0; \n    end else begin \n      reg_pc &lt;= in_pc; \n    end\n  end\nendmodule\n</code></pre> <p>21-23\u884c</p> <p>ex_result_sel \u5c31\u662f\u5bf9\u6d41\u6c34\u7ebf\u6267\u884c\u9636\u6bb5\u7684\u7ed3\u679c\u8fdb\u884c\u9009\u62e9\u3002</p> <p>\u5f53\uff08ex_result_sel == 2\u2019h0\uff09\u65f6\uff0c\u5c31\u9009\u62e9 ALU \u7684\u8fd0\u7b97\u7ed3\u679c\uff1b</p> <p>\u5f53\uff08ex_result_sel == 2\u2019h1\uff09\u65f6\uff0c\u5c31\u4f1a\u9009\u62e9\u6307\u4ee4\u89e3\u7801\u5f97\u5230\u7684\u7acb\u5373\u6570\uff08\u5176\u5b9e\u5c31\u662f\u5bf9\u5e94 LUI \u6307\u4ee4\uff09\uff1b</p> <p>\u5f53\uff08ex_result_sel == 2\u2019h2\uff09\u65f6\uff0c\u9009\u62e9 PC \u52a0 4 \u7684\u503c\uff0c\u4e5f\u5c31\u662f\u4e0b\u4e00\u4e2a PC \u7684\u503c\u3002</p> <p>\u540e\u976229\u884c\u5230\u6700\u540e\uff0c\u548c\u4e0a\u9762\u7684\u8bbf\u5b58\u63a7\u5236\u6a21\u5757\u7c7b\u4f3c\u7684\u903b\u8f91</p> <ul> <li> <p>\u8865\u5145</p> <p>\u9501\u3001\u5185\u5b58\u5c4f\u969c\u7b49\u6982\u5ff5\u5176\u5b9e\u8bf4\u5230\u5e95\u5c31\u662f\u57fa\u4e8e\u8bbf\u5b58\u9636\u6bb5\u8fdb\u884c\u7684\u7279\u6027\u5316\u64cd\u4f5c</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_34","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_35","title":"\u76f8\u5173\u4ee3\u7801","text":"<ul> <li><code>forwarding.v</code>(\u6570\u636e\u524d\u9012\u6a21\u5757)</li> <li><code>ex_mem_ctrl.v</code>(\u8bbf\u5b58\u63a7\u5236\u6a21\u5757)</li> <li><code>ex_mem.v</code>(\u8bbf\u5b58\u6570\u636e\u901a\u8def\u6a21\u5757)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpucpu_2","title":"\u624b\u5199CPU\uff08\u4e94\uff09\uff1aCPU\u6d41\u6c34\u7ebf\u5199\u56de\u6a21\u5757","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_36","title":"\u6d41\u6c34\u7ebf\u63a7\u5236\u5192\u9669","text":"<p>beq bne</p> <p>\u5047\u5982\u5728\u6d41\u6c34\u7ebf\u53d6\u51fa\u5206\u652f\u6307\u4ee4\u540e\uff0c\u7d27\u8ddf\u7740\u5728\u4e0b\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5c31\u4f1a\u53d6\u4e0b\u4e00\u6761\u6307\u4ee4\u3002\u4f46\u662f\uff0c\u6d41\u6c34\u7ebf\u5e76\u4e0d\u77e5\u9053\u4e0b\u4e00\u6761\u6307\u4ee4\u5e94\u8be5\u4ece\u54ea\u91cc\u53d6\uff0c\u56e0\u4e3a\u5b83\u521a\u4ece\u5b58\u50a8\u5668\u4e2d\u53d6\u51fa\u5206\u652f\u6307\u4ee4\uff0c\u8fd8\u4e0d\u80fd\u786e\u5b9a\u4e0a\u4e00\u6761\u5206\u652f\u6307\u4ee4\u662f\u5426\u4f1a\u53d1\u751f\u8df3\u8f6c\u3002</p> <p>\u4e0a\u9762\u8fd9\u79cd\u6d41\u6c34\u7ebf\u9700\u8981\u6839\u636e\u4e0a\u4e00\u6761\u6307\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u51b3\u5b9a\u4e0b\u4e00\u6b65\u884c\u4e3a\u7684\u60c5\u51b5\uff0c\u5c31\u662f\u6d41\u6c34\u7ebf\u4e2d\u7684\u63a7\u5236\u5192\u9669</p> <ul> <li> <p>\u89e3\u51b3\uff1a\u63a7\u5236\u5192\u9669\uff1f</p> <ol> <li> <p>\u6d41\u6c34\u7ebf\u505c\u987f\uff08\u65e0\u6cd5\u6839\u9664\uff0c\u53c8\u5f71\u54cd\u6d41\u6c34\u7ebf\u6027\u80fd\uff09</p> </li> <li> <p>\u53ea\u80fd\u4f18\u5316 --&gt; \u5206\u652f\u9884\u6d4b</p> <p>\u5177\u4f53\u601d\u8def\u662f\u8fd9\u6837\u7684\uff0c\u5f53\u6bcf\u6b21\u9047\u5230\u6761\u4ef6\u5206\u652f\u6307\u4ee4\u65f6\uff0c\u9884\u6d4b\u5206\u652f\u4f1a\u53d1\u751f\u8df3\u8f6c\uff0c\u76f4\u63a5\u5728\u5206\u652f\u6307\u4ee4\u7684\u4e0b\u4e00\u6761\u53d6\u8df3\u8f6c\u540e\u76f8\u5e94\u5730\u5740\u7684\u6307\u4ee4\u3002\u5982\u679c\u5206\u652f\u53d1\u751f\u8df3\u8f6c\u7684\u6982\u7387\u662f 50%\uff0c\u90a3\u4e48\u8fd9\u79cd\u4f18\u5316\u65b9\u5f0f\u5c31\u53ef\u4ee5\u51cf\u5c11\u4e00\u534a\u7531\u63a7\u5236\u5192\u9669\u5e26\u6765\u7684\u6027\u80fd\u635f\u5931\u3002</p> <p>\u7b2c\u4e00\u8bfe\u4e2d\u7684if_pre.v\u5c31\u662f\u8fd9\u4e2a\u529f\u80fd</p> <pre><code> wire is_bxx = (instr[6:0] == `OPCODE_BRANCH);   //\u6761\u4ef6\u6311\u8f6c\u6307\u4ee4\u7684\u64cd\u4f5c\u7801\n wire is_jal = (instr[6:0] == `OPCODE_JAL) ;     //\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u64cd\u4f5c\u7801\n\n //B\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n wire [31:0] bimm  = {{20{instr[31]}}, instr[7], instr[30:25], instr[11:8], 1'b0};\n //J\u578b\u6307\u4ee4\u7684\u7acb\u5373\u6570\u62fc\u63a5\n wire [31:0] jimm  = {{12{instr[31]}}, instr[19:12], instr[20], instr[30:21], 1'b0};\n\n //\u6307\u4ee4\u5730\u5740\u7684\u504f\u79fb\u91cf\n wire [31:0] adder = is_jal ? jimm : (is_bxx &amp; bimm[31]) ? bimm : 4;\n\n assign pre_pc = pc + adder;\n</code></pre> <p>\u82e5\u4e0d\u8df3\u8f6c\uff0c\u76f4\u63a5\u5c06\u6d41\u6c34\u7ebf\u4e2d\u5904\u4e8e\u53d6\u6307\u3001\u8bd1\u7801\u548c\u6267\u884c\u9636\u6bb5\u7684\u6307\u4ee4\u6e05\u9664\u3002</p> <p>\u6709\u6ca1\u6709\u66f4\u52a0\u4f18\u5316\u7684\u529f\u80fd\uff1f</p> <p>\u4e3a\u4e86\u6539\u8fdb\u5206\u652f\u9884\u6d4b\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u5c40\u90e8\u5206\u652f\u9884\u6d4b\u5668\uff08Local Branch Predictor\uff09\u3002\u5c40\u90e8\u5206\u652f\u9884\u6d4b\u5668\u901a\u5e38\u57fa\u4e8e\u5f53\u524d\u6307\u4ee4\u7684\u5c40\u90e8\u5386\u53f2\u6765\u9884\u6d4b\u5206\u652f\u7684\u8d70\u5411\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u5c40\u90e8\u5206\u652f\u9884\u6d4b\u5668\u7684\u5b9e\u73b0\u793a\u4f8b\uff1a</p> <pre><code>module hazard_unit #(\n    parameter BRANCH_HISTORY_BITS = 2 // \u5206\u652f\u5386\u53f2\u4f4d\u6570\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8c03\u6574\n) (\n    input  [31:0] pc,                  // \u5f53\u524d\u7a0b\u5e8f\u8ba1\u6570\u5668\n    input  [4:0]  rs1,                 // \u6e90\u5bc4\u5b58\u56681\n    input  [4:0]  rs2,                 // \u6e90\u5bc4\u5b58\u56682\n    input          alu_result,          // ALU\u7ed3\u679c\uff0c\u7528\u4e8e\u6bd4\u8f83\n    input          id_ex_branch,        // \u5206\u652f\u6307\u4ee4\u6807\u5fd7\n    input          id_ex_jump,          // \u8df3\u8f6c\u6307\u4ee4\u6807\u5fd7\n    input  [1:0]  id_ex_imm,            // \u7acb\u5373\u6570\uff0c\u7528\u4e8e\u6bd4\u8f83\n    input          id_ex_memRead,       // \u5185\u5b58\u8bfb\u53d6\u6807\u5fd7\n    input          id_ex_memWrite,      // \u5185\u5b58\u5199\u5165\u6807\u5fd7\n    input  [4:0]  id_ex_rd,             // \u76ee\u6807\u5bc4\u5b58\u5668\n    output reg [1:0] branch_history,    // \u5206\u652f\u5386\u53f2\u5bc4\u5b58\u5668\n    output reg       pcFromTaken,        // \u5206\u652f\u9884\u6d4b\u7ed3\u679c\n    output reg       stalling          // \u662f\u5426\u9700\u8981\u6682\u505c\u6d41\u6c34\u7ebf\n);\n\n// \u5c40\u90e8\u5206\u652f\u9884\u6d4b\u5668\u7684\u72b6\u6001\u5bc4\u5b58\u5668\nreg [BRANCH_HISTORY_BITS-1:0] local_history;\n\n// \u66f4\u65b0\u5206\u652f\u5386\u53f2\nalways @(posedge clk or posedge reset) begin\n    if (reset) begin\n        local_history &lt;= 0;\n    end else begin\n        // \u5982\u679c\u662f\u5206\u652f\u6216\u8df3\u8f6c\u6307\u4ee4\uff0c\u66f4\u65b0\u5386\u53f2\n        if (id_ex_branch || id_ex_jump) begin\n            local_history &lt;= local_history &gt;&gt; 1; // \u53f3\u79fb\u4e00\u4f4d\uff0c\u4e3a\u65b0\u7684\u5386\u53f2\u4fe1\u606f\u817e\u51fa\u7a7a\u95f4\n            if (alu_result != id_ex_imm) begin\n                local_history[0] &lt;= 1'b1; // \u5982\u679cALU\u7ed3\u679c\u4e0e\u7acb\u5373\u6570\u4e0d\u76f8\u7b49\uff0c\u9884\u6d4b\u5206\u652f\u5c06\u88ab\u6267\u884c\n            end\n        end\n    end\nend\n\n// \u6839\u636e\u5c40\u90e8\u5206\u652f\u5386\u53f2\u9884\u6d4b\u5206\u652f\u7684\u8d70\u5411\nassign branch_history = local_history;\nassign pcFromTaken = (local_history != 0) ? 1'b1 : 1'b0; // \u5982\u679c\u5386\u53f2\u975e\u96f6\uff0c\u9884\u6d4b\u5206\u652f\u5c06\u88ab\u6267\u884c\nassign stalling = (id_ex_branch || id_ex_jump) &amp;&amp; (local_history == 0); // \u5982\u679c\u5386\u53f2\u4e3a\u96f6\uff0c\u4e14\u662f\u5206\u652f\u6216\u8df3\u8f6c\u6307\u4ee4\uff0c\u9700\u8981\u6682\u505c\u6d41\u6c34\u7ebf\n\nendmodule\n</code></pre> <p>\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a<code>hazard_unit</code>\u7684\u6a21\u5757\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u5c40\u90e8\u5206\u652f\u9884\u6d4b\u5668\u3002\u8be5\u9884\u6d4b\u5668\u4f7f\u7528\u4e00\u4e2a\u5c40\u90e8\u5386\u53f2\u5bc4\u5b58\u5668<code>local_history</code>\u6765\u8bb0\u5f55\u6700\u8fd1\u7684\u5206\u652f\u884c\u4e3a\u3002\u6bcf\u6b21\u5206\u652f\u6216\u8df3\u8f6c\u6307\u4ee4\u6267\u884c\u65f6\uff0c\u6211\u4eec\u90fd\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u5386\u53f2\u5bc4\u5b58\u5668\u3002\u5982\u679cALU\u7684\u7ed3\u679c\u4e0e\u7acb\u5373\u6570\u4e0d\u76f8\u7b49\uff0c\u6211\u4eec\u9884\u6d4b\u5206\u652f\u5c06\u88ab\u6267\u884c\uff0c\u5426\u5219\u9884\u6d4b\u5206\u652f\u4e0d\u4f1a\u6267\u884c\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5316\u7684\u5206\u652f\u9884\u6d4b\u5668\uff0c\u5b83\u4e0d\u8003\u8651\u5f88\u591a\u53ef\u80fd\u5f71\u54cd\u9884\u6d4b\u51c6\u786e\u6027\u7684\u56e0\u7d20\uff0c\u5982\u5206\u652f\u76ee\u6807\u5730\u5740\u3001\u7a0b\u5e8f\u7684\u5faa\u73af\u7ed3\u6784\u7b49\u3002\u5728\u5b9e\u9645\u7684\u5904\u7406\u5668\u8bbe\u8ba1\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u66f4\u590d\u6742\u7684\u5206\u652f\u9884\u6d4b\u7b56\u7565\uff0c\u5982\u5168\u5c40\u5206\u652f\u9884\u6d4b\u5668\u3001\u53cc\u5411\u5206\u652f\u9884\u6d4b\u5668\u3001\u57fa\u4e8e\u673a\u5668\u5b66\u4e60\u7684\u9884\u6d4b\u5668\u7b49\u3002</p> <p>\u6b64\u5916\uff0c\u4e3a\u4e86\u63d0\u9ad8\u5206\u652f\u9884\u6d4b\u7684\u51c6\u786e\u6027\uff0c\u8fd8\u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u7b56\u7565\uff1a</p> <ul> <li>\u4f7f\u7528\u66f4\u5927\u7684\u5206\u652f\u5386\u53f2\u8868\uff08BHT\uff09\u6765\u8bb0\u5f55\u66f4\u957f\u7684\u5206\u652f\u5386\u53f2\u3002</li> <li>\u5b9e\u73b0\u5206\u652f\u76ee\u6807\u7f13\u51b2\u533a\uff08BTB\uff09\u6765\u5feb\u901f\u83b7\u53d6\u5206\u652f\u76ee\u6807\u5730\u5740\u3002</li> <li>\u7ed3\u5408\u591a\u79cd\u5206\u652f\u9884\u6d4b\u6280\u672f\uff0c\u5982\u5c40\u90e8\u5206\u652f\u9884\u6d4b\u548c\u5168\u5c40\u5206\u652f\u9884\u6d4b\u3002</li> <li>\u4f7f\u7528\u9971\u548c\u8ba1\u6570\u5668\u6765\u907f\u514d\u5206\u652f\u9884\u6d4b\u5668\u88ab\u9891\u7e41\u7684\u5206\u652f\u884c\u4e3a\u6240\u8bef\u5bfc\u3002</li> </ul> <p>\u8bf7\u6839\u636e\u4f60\u7684\u5177\u4f53\u9700\u6c42\u548c\u8bbe\u8ba1\u76ee\u6807\u6765\u9009\u62e9\u5408\u9002\u7684\u5206\u652f\u9884\u6d4b\u7b56\u7565\uff0c\u5e76\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8fdb\u884c\u8c03\u6574\u548c\u4f18\u5316\u3002</p> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_37","title":"\u63a7\u5236\u5192\u9669\u6a21\u5757","text":"<p>\u8fd9\u6bb5\u4ee3\u7801\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a <code>hazard</code> \u7684\u6a21\u5757\uff0c\u5b83\u662f\u5904\u7406\u5668\u6d41\u6c34\u7ebf\u4e2d\u7528\u4e8e\u68c0\u6d4b\u548c\u5904\u7406\u6570\u636e\u5192\u9669\uff08Data Hazards\uff09\u548c\u63a7\u5236\u5192\u9669\uff08Control Hazards\uff09\u7684\u5355\u5143\u3002\u8be5\u6a21\u5757\u901a\u8fc7\u5206\u6790\u5f53\u524d\u6307\u4ee4\u7684\u72b6\u6001\u548c\u5176\u4ed6\u4fe1\u53f7\u6765\u51b3\u5b9a\u662f\u5426\u9700\u8981\u63d2\u5165\u6c14\u6ce1\uff08Stall\uff09\u3001\u6e05\u96f6\uff08Flush\uff09\u6d41\u6c34\u7ebf\u6216\u8005\u66f4\u65b0\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u3002</p> <pre><code>module hazard (\n  input  [4:0]  rs1,\n  input  [4:0]  rs2,\n  input         alu_result_0,\n  input  [1:0]  id_ex_jump,\n  input         id_ex_branch,\n  input         id_ex_imm_31,\n  input         id_ex_memRead,\n  input         id_ex_memWrite,\n  input  [4:0]  id_ex_rd,\n  input  [1:0]  ex_mem_maskMode,\n  input         ex_mem_memWrite,\n\n  output reg    pcFromTaken,    //\u5206\u652f\u6307\u4ee4\u6267\u884c\u7ed3\u679c\uff0c\u5224\u65ad\u662f\u5426\u4e0e\u9884\u6d4b\u65b9\u5411\u4e00\u6837\n  output reg    pcStall,        //\u7a0b\u5e8f\u8ba1\u6570\u5668\u505c\u6b62\u4fe1\u53f7,\u6d41\u6c34\u7ebf\u4e0d\u8bfb\u53d6\u65b0\u7684\u6307\u4ee4\n  output reg    IF_ID_stall,    //\u6d41\u6c34\u7ebfIF_ID\u6bb5\u505c\u6b62\u4fe1\u53f7\n  output reg    ID_EX_stall,    //\u6d41\u6c34\u7ebfID_EX\u6bb5\u505c\u6b62\u4fe1\u53f7\n  output reg    ID_EX_flush,    //\u6d41\u6c34\u7ebfID_EX\u6bb5\u6e05\u96f6\u4fe1\u53f7\n  output reg    EX_MEM_flush,   //\u6d41\u6c34\u7ebfEX_MEM\u6bb5\u6e05\u96f6\u4fe1\u53f7\n  output reg    IF_ID_flush     //\u6d41\u6c34\u7ebfIF_ID\u6bb5\u6e05\u96f6\u4fe1\u53f7\n);\n\n    // \u6761\u4ef6\u5206\u652f\u6307\u4ee4\u7684\u6761\u4ef6\u6bd4\u8f83\u7ed3\u679c\n  wire branch_do = ((alu_result_0 &amp; ~id_ex_imm_31) | (~alu_result_0 &amp; id_ex_imm_31));\n    // \u786e\u8ba4\u5206\u652f\u6307\u4ee4\u8df3\u8f6c\u7684\u4fe1\u53f7\n  wire ex_mem_taken = id_ex_jump[0] | (id_ex_branch &amp; branch_do);\n\n  wire id_ex_memAccess = id_ex_memRead | id_ex_memWrite; \n\n  wire ex_mem_need_stall = ex_mem_memWrite &amp; (ex_mem_maskMode == 2'h0 | ex_mem_maskMode == 2'h1); \n\n  always @(*) begin\n    if(id_ex_memAccess &amp;&amp; ex_mem_need_stall) begin\n      pcFromTaken  &lt;= 0;\n      pcStall      &lt;= 1;\n      IF_ID_stall  &lt;= 1;\n      IF_ID_flush  &lt;= 0;\n      ID_EX_stall  &lt;= 1;\n      ID_EX_flush  &lt;= 0;\n      EX_MEM_flush &lt;= 1;\n    end\n    else if(ex_mem_taken) begin \n      pcFromTaken  &lt;= 1;\n      pcStall      &lt;= 0; \n      IF_ID_flush  &lt;= 1;\n      ID_EX_flush  &lt;= 1;\n      EX_MEM_flush &lt;= 0;\n    end\n    else if(id_ex_memRead &amp; (id_ex_rd == rs1 || id_ex_rd == rs2)) begin\n      pcFromTaken &lt;= 0;\n      pcStall     &lt;= 1;\n      IF_ID_stall &lt;= 1;\n      ID_EX_flush &lt;= 1;\n    end\n    else begin\n      pcFromTaken    &lt;= 0;  \n      pcStall        &lt;= 0; \n      IF_ID_stall    &lt;= 0;\n      ID_EX_stall    &lt;= 0;\n      ID_EX_flush    &lt;= 0;\n      EX_MEM_flush   &lt;= 0;  \n      IF_ID_flush    &lt;= 0;\n    end\n  end\nendmodule\n</code></pre> <ul> <li> <p>\u4ec0\u4e48\u65f6\u5019\u4ea7\u751f\u4e0a\u9762\u7684\u63a7\u5236\u4fe1\u53f7\uff1f\u4e09\u79cd\u60c5\u51b5</p> <ol> <li> <p>\u6570\u636e\u76f8\u5173\u6027\u95ee\u9898</p> <p>\u6570\u636e\u76f8\u5173\u6307\u7684\u662f\u6307\u4ee4\u4e4b\u95f4\u5b58\u5728\u7684\u4f9d\u8d56\u5173\u7cfb\u3002\u5f53\u4e24\u6761\u6307\u4ee4\u4e4b\u95f4\u5b58\u5728\u76f8\u5173\u5173\u7cfb\u65f6\uff0c\u5b83\u4eec\u5c31\u4e0d\u80fd\u5728\u6d41\u6c34\u7ebf\u4e2d\u91cd\u53e0\u6267\u884c\u3002\u4f8b\u5982\uff0c\u524d\u4e00\u6761\u6307\u4ee4\u662f\u8bbf\u5b58\u6307\u4ee4 Store\uff0c\u540e\u4e00\u6761\u4e5f\u662f Load \u6216\u8005 Store \u6307\u4ee4\uff0c\u56e0\u4e3a\u6211\u4eec\u91c7\u7528\u7684\u662f\u540c\u6b65 RAM\uff0c\u9700\u8981\u5148\u8bfb\u51fa\u518d\u5199\u5165\uff0c\u5360\u7528\u4e24\u4e2a\u65f6\u949f\u5468\u671f\uff0c\u6240\u4ee5\u8fd9\u65f6\u8981\u628a\u4e4b\u540e\u7684\u6307\u4ee4\u505c\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u3002</p> <pre><code>    if(ID_EX_memAccess &amp;&amp; EX_MEM_need_stall) begin\n      pcFromTaken  &lt;= 0;\n      pcStall      &lt;= 1;\n      IF_ID_stall  &lt;= 1;\n      IF_ID_flush  &lt;= 0;\n      ID_EX_stall  &lt;= 1;\n      ID_EX_flush  &lt;= 0;\n      EX_MEM_flush &lt;= 1;\n    end\n</code></pre> </li> <li> <p>\u5206\u652f\u9884\u6d4b\u5931\u8d25</p> <p>\u5f53\u5206\u652f\u6307\u4ee4\u6267\u884c\u4e4b\u540e\uff0c\u5982\u679c\u53d1\u73b0\u5206\u652f\u8df3\u8f6c\u7684\u65b9\u5411\u4e0e\u9884\u6d4b\u65b9\u5411\u4e0d\u4e00\u81f4\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u51b2\u5237\u6d41\u6c34\u7ebf\uff0c\u6e05\u9664\u5904\u4e8e\u53d6\u6307\u3001\u8bd1\u7801\u9636\u6bb5\u7684\u6307\u4ee4\u6570\u636e\uff0c\u66f4\u65b0 PC \u503c\u3002</p> <pre><code> // \u5206\u652f\u9884\u6d4b\u5931\u8d25\uff0c\u9700\u8981\u51b2\u5237\u6d41\u6c34\u7ebf\uff0c\u66f4\u65b0pc\u503c\n    else if(EX_MEM_taken) begin \n      pcFromTaken  &lt;= 1; \n      pcStall      &lt;= 0; \n      IF_ID_flush  &lt;= 1;\n      ID_EX_flush  &lt;= 1;\n      EX_MEM_flush &lt;= 0; \n    end\n</code></pre> </li> <li> <p>\u6570\u636e\u5192\u9669\u95ee\u9898</p> <p>\u5f53\u524d\u4e00\u6761\u6307\u4ee4\u662f Load\uff0c\u540e\u4e00\u6761\u6307\u4ee4\u7684\u6e90\u5bc4\u5b58\u5668 rs1 \u548c rs2 \u4f9d\u8d56\u4e8e\u524d\u4e00\u6761\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u51fa\u6765\u7684\u503c\uff0c\u9700\u8981\u628a Load \u6307\u4ee4\u4e4b\u540e\u7684\u6307\u4ee4\u505c\u987f\u4e00\u4e2a\u65f6\u949f\u5468\u671f\uff0c\u800c\u4e14\u8fd8\u8981\u51b2\u5237 ID _EX \u9636\u6bb5\u7684\u6307\u4ee4\u6570\u636e\u3002</p> <pre><code>    else if(ID_EX_memRead &amp; (ID_EX_rd == rs1 || ID_EX_rd == rs2)) begin\n      pcFromTaken &lt;= 0;\n      pcStall     &lt;= 1;\n      IF_ID_stall &lt;= 1;\n      ID_EX_flush &lt;= 1;\n    end\n</code></pre> </li> </ol> </li> </ul> <p>\u5728\u5904\u7406\u5668\u7684\u6d41\u6c34\u7ebf\u8bbe\u8ba1\u4e2d\uff0c\u63a9\u7801\u6a21\u5f0f\uff08Mask Mode\uff09\u901a\u5e38\u4e0e\u5185\u5b58\u8bbf\u95ee\u64cd\u4f5c\u4e2d\u7684\u5b57\uff08Word\uff09\u3001\u534a\u5b57\uff08Halfword\uff09\u6216\u5b57\u8282\uff08Byte\uff09\u7ea7\u522b\u7684\u8bfb\u5199\u6709\u5173\u3002</p> <p>\u63a9\u7801\u6a21\u5f0f\u7528\u4e8e\u6307\u5b9a\u5185\u5b58\u64cd\u4f5c\u7684\u5927\u5c0f\uff08\u5bbd\u5ea6\uff09\uff0c\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u5730\u5904\u7406\u5730\u5740\u672a\u5bf9\u9f50\u7684\u60c5\u51b5\u3002</p> <p>\u5728RISC-V\u7b49\u5904\u7406\u5668\u67b6\u6784\u4e2d\uff0c\u5185\u5b58\u8bbf\u95ee\u6307\u4ee4\u53ef\u4ee5\u6307\u5b9a\u4e0d\u540c\u7684\u63a9\u7801\u6a21\u5f0f\uff0c\u8fd9\u4e9b\u6a21\u5f0f\u51b3\u5b9a\u4e86\u5982\u4f55\u5904\u7406\u5185\u5b58\u4e2d\u7684\u5b57\u8282\u3001\u534a\u5b57\u6216\u5b57\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u5b57\uff08Word\uff09\uff1a\u901a\u5e38\u662f32\u4f4d\u5bbd\u3002\u5728\u8fdb\u884c\u5b57\u7ea7\u522b\u7684\u5185\u5b58\u8bbf\u95ee\u65f6\uff0c\u5982\u679c\u5730\u5740\u662f\u5bf9\u9f50\u7684\uff08\u5373\u5730\u5740\u7684\u6700\u4f4e\u4e24\u4f4d\u662f0\uff09\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u8be5\u5730\u5740\u3002</li> <li>\u534a\u5b57\uff08Halfword\uff09\uff1a\u901a\u5e38\u662f16\u4f4d\u5bbd\u3002\u5728\u8fdb\u884c\u534a\u5b57\u7ea7\u522b\u7684\u5185\u5b58\u8bbf\u95ee\u65f6\uff0c\u5982\u679c\u5730\u5740\u7684\u6700\u4f4e\u4f4d\u662f0\uff08\u4f46\u4e0d\u4e00\u5b9a\u662f\u5076\u6570\uff09\uff0c\u5219\u53ef\u4ee5\u8bbf\u95ee\u8be5\u5730\u5740\u3002</li> <li>\u5b57\u8282\uff08Byte\uff09\uff1a\u901a\u5e38\u662f8\u4f4d\u5bbd\u3002\u5728\u8fdb\u884c\u5b57\u8282\u7ea7\u522b\u7684\u5185\u5b58\u8bbf\u95ee\u65f6\uff0c\u4efb\u4f55\u5730\u5740\u90fd\u53ef\u4ee5\u8bbf\u95ee\uff0c\u4f46\u53ef\u80fd\u9700\u8981\u5904\u7406\u7b26\u53f7\u6269\u5c55\u6216\u5176\u4ed6\u8f6c\u6362\u3002</li> </ul> <p>\u63a9\u7801\u6a21\u5f0f\u901a\u5e38\u7531\u6307\u4ee4\u4e2d\u7684\u7279\u5b9a\u4f4d\u6765\u6307\u5b9a\uff0c\u5b83\u544a\u8bc9\u5904\u7406\u5668\u5728\u6267\u884c\u5185\u5b58\u64cd\u4f5c\u65f6\u5e94\u8be5\u4f7f\u7528\u54ea\u79cd\u8bbf\u95ee\u5927\u5c0f\u3002\u5728\u6d41\u6c34\u7ebf\u8bbe\u8ba1\u4e2d\uff0c\u63a9\u7801\u6a21\u5f0f\u5bf9\u4e8e\u786e\u4fdd\u6570\u636e\u6b63\u786e\u6027\u548c\u5904\u7406\u6f5c\u5728\u7684\u6570\u636e\u5192\u9669\u975e\u5e38\u91cd\u8981\u3002</p> <p>\u5728\u60a8\u63d0\u4f9b\u7684\u4ee3\u7801\u6bb5\u4e2d\uff0c<code>ex_mem_maskMode</code>\u662f\u4e00\u4e2a\u4e24\u4f4d\u7684\u8f93\u5165\u4fe1\u53f7\uff0c\u5b83\u6307\u793a\u5f53\u524d\u6267\u884c\u7684\u5185\u5b58\u64cd\u4f5c\u4f7f\u7528\u7684\u63a9\u7801\u6a21\u5f0f\u3002\u5982\u679c\u63a9\u7801\u6a21\u5f0f\u6307\u793a\u6b63\u5728\u8fdb\u884c\u5b57\u6216\u534a\u5b57\u7ea7\u522b\u7684\u5185\u5b58\u8bbf\u95ee\uff0c\u5e76\u4e14\u540c\u65f6\u5b58\u5728\u5185\u5b58\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u53ef\u80fd\u9700\u8981\u63d2\u5165\u6c14\u6ce1\u6765\u7b49\u5f85\u5199\u64cd\u4f5c\u5b8c\u6210\uff0c\u4ee5\u786e\u4fdd\u540e\u7eed\u7684\u8bfb\u53d6\u64cd\u4f5c\u4e0d\u4f1a\u8bfb\u53d6\u5230\u672a\u66f4\u65b0\u7684\u6570\u636e\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6d41\u6c34\u7ebf\u7684\u4e0d\u540c\u9636\u6bb5\u4f1a\u88ab\u6682\u505c\uff08\u901a\u8fc7\u8bbe\u7f6e<code>stall</code>\u4fe1\u53f7\uff09\uff0c\u5e76\u4e14\u53ef\u80fd\u9700\u8981\u6e05\u96f6\u67d0\u4e9b\u9636\u6bb5\uff08\u901a\u8fc7\u8bbe\u7f6e<code>flush</code>\u4fe1\u53f7\uff09\uff0c\u4ee5\u907f\u514d\u6570\u636e\u5192\u9669\u548c\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002</p> <p>\u5c31\u6709\u70b9\u50cfx86\u6c47\u7f16\u7684WORD PTR \u5173\u952e\u5b57\u4e86\u662f\u5427</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_38","title":"\u5199\u56de\u63a7\u5236\u6a21\u5757","text":"<p>\u9009\u62e9\u5b58\u50a8\u5668\u8bfb\u53d6\u56de\u6765\u7684\u6570\u636e\u4f5c\u4e3a\u5199\u56de\u7684\u7ed3\u679c\uff0c\u6216\u8005\u9009\u62e9\u6d41\u6c34\u7ebf\u6267\u884c\u8fd0\u7b97\u4e4b\u540e\u4ea7\u751f\u7684\u6570\u636e\u4f5c\u4e3a\u5199\u56de\u7ed3\u679c</p> <pre><code>module mem_wb_ctrl(\n  input   clk,\n  input   reset,\n  input   in_wb_ctrl_toReg,\n  input   in_wb_ctrl_regWrite,\n\n  output  data_wb_ctrl_toReg,\n  output  data_wb_ctrl_regWrite\n);\n\n  reg  reg_wb_ctrl_toReg; \n  reg  reg_wb_ctrl_regWrite; \n\n  assign data_wb_ctrl_toReg = reg_wb_ctrl_toReg; \n  assign data_wb_ctrl_regWrite = reg_wb_ctrl_regWrite; \n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_wb_ctrl_toReg &lt;= 1'h0; \n    end else begin \n      reg_wb_ctrl_toReg &lt;= in_wb_ctrl_toReg; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_wb_ctrl_regWrite &lt;= 1'h0; \n    end else begin \n      reg_wb_ctrl_regWrite &lt;= in_wb_ctrl_regWrite; \n    end\n  end\n\nendmodule\n</code></pre> <ul> <li>\u4e24\u4e2a\u5173\u952e\u4fe1\u53f7<ol> <li>\u5199\u56de\u5bc4\u5b58\u5668\u7684\u6570\u636e\u9009\u62e9\u4fe1\u53f7 wb_ctrl_toReg<ol> <li>\u5f53\u8fd9\u4e2a\u4fe1\u53f7\u4e3a\u201c1\u201d\u65f6\uff0c\u9009\u62e9\u4ece\u5b58\u50a8\u5668\u8bfb\u53d6\u7684\u6570\u503c\u4f5c\u4e3a\u5199\u56de\u6570\u636e\uff0c</li> <li>\u4e3a\u201c0\u201d\u628a\u6d41\u6c34\u7ebf\u7684\u8fd0\u7b97\u7ed3\u679c\u4f5c\u4e3a\u5199\u56de\u6570\u636e\u3002</li> </ol> </li> <li>\u5bc4\u5b58\u5668\u7684\u5199\u63a7\u5236\u4fe1\u53f7 wb_ctrl_regWrite\uff0c<ol> <li>\u5f53\u8fd9\u4e2a\u4fe1\u53f7\u4e3a\u201c1\u201d\u65f6\uff0c\u5f00\u59cb\u5f80\u76ee\u6807\u5bc4\u5b58\u5668\u5199\u56de\u6307\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u3002</li> </ol> </li> </ol> </li> </ul> <p>\u8fd9\u4e2a\u6a21\u5757\u7684\u4e3b\u8981\u529f\u80fd\u662f\u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u66f4\u65b0\u5176\u5185\u90e8\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4ee5\u5b58\u50a8\u6765\u81eaEX-MEM\u9636\u6bb5\u7684\u63a7\u5236\u4fe1\u53f7\u3002\u8fd9\u4e9b\u63a7\u5236\u4fe1\u53f7\u6307\u793a\u662f\u5426\u5e94\u8be5\u5c06\u6570\u636e\u5199\u56de\u5bc4\u5b58\u5668\uff0c\u4ee5\u53ca\u662f\u5426\u5e94\u8be5\u6267\u884c\u5bc4\u5b58\u5668\u7684\u5199\u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c<code>mem_wb_ctrl</code>\u6a21\u5757\u786e\u4fdd\u4e86\u5728\u5199\u56de\u9636\u6bb5\uff0c\u6570\u636e\u80fd\u591f\u6839\u636e\u4e4b\u524d\u7684\u6267\u884c\u7ed3\u679c\u548c\u63a7\u5236\u4fe1\u53f7\u6b63\u786e\u5730\u5199\u5165\u5230\u76ee\u6807\u5bc4\u5b58\u5668\u4e2d\u3002\u5982\u679c\u53d1\u751f\u590d\u4f4d\uff0c\u6240\u6709\u7684\u63a7\u5236\u4fe1\u53f7\u90fd\u4f1a\u88ab\u6e05\u96f6\uff0c\u4ee5\u786e\u4fdd\u6d41\u6c34\u7ebf\u80fd\u591f\u4ece\u5df2\u77e5\u7684\u521d\u59cb\u72b6\u6001\u91cd\u65b0\u5f00\u59cb\u6267\u884c\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_39","title":"\u5199\u56de\u6570\u636e\u901a\u8def\u6a21\u5757","text":"<p>\u5199\u56de\u6570\u636e\u901a\u8def\u6a21\u5757\u4ea7\u751f\u7684\u4fe1\u53f7\u4e3b\u8981\u5305\u62ec</p> <ul> <li> <p>\u5199\u56de\u76ee\u6807\u5bc4\u5b58\u5668\u7684\u5730\u5740 reg_WAddr</p> </li> <li> <p>\u6d41\u6c34\u7ebf\u6267\u884c\u8fd0\u7b97\u540e\u7684\u7ed3\u679c\u6570\u636e result</p> </li> <li> <p>\u4ece\u5b58\u50a8\u5668\u8bfb\u53d6\u7684\u6570\u636e readData</p> </li> </ul> <pre><code>module mem_wb(\n  input         clk,\n  input         reset,\n  input  [4:0]  in_regWAddr,\n  input  [31:0] in_result,\n  input  [31:0] in_readData,\n  input  [31:0] in_pc,\n\n  output [4:0]  data_regWAddr,\n  output [31:0] data_result,\n  output [31:0] data_readData,\n  output [31:0] data_pc\n);\n\n  reg [4:0]  reg_regWAddr; \n  reg [31:0] reg_result; \n  reg [31:0] reg_readData; \n  reg [31:0] reg_pc; \n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_regWAddr &lt;= 5'h0; \n    end else  begin \n      reg_regWAddr &lt;= in_regWAddr; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_result &lt;= 32'h0; \n    end else begin \n      reg_result &lt;= in_result; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin\n    if (reset) begin \n      reg_readData &lt;= 32'h0; \n    end else begin \n      reg_readData &lt;= in_readData; \n    end\n  end\n\n  always @(posedge clk or posedge reset) begin    \n    if (reset) begin \n      reg_pc &lt;= 32'h0; \n    end else  begin \n      reg_pc &lt;= in_pc; \n    end\n  end\n\n  assign data_regWAddr = reg_regWAddr; \n  assign data_result = reg_result; \n  assign data_readData = reg_readData; \n  assign data_pc = reg_pc; \n\nendmodule\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <p>\u5199\u56de\u9636\u6bb5\u7684\u6a21\u5757\u6ca1\u6709\u4e86\u6d41\u6c34\u7ebf\u7684\u505c\u6b62\u63a7\u5236\u4fe1\u53f7 stall \u548c\u6d41\u6c34\u7ebf\u7684\u51b2\u5237\u63a7\u5236\u4fe1\u53f7 flush\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5199\u56de\u9636\u6bb5\u7684\u6570\u636e\u7ecf\u8fc7\u4e86\u6570\u636e\u5192\u9669\u548c\u63a7\u5236\u5192\u9669\u6a21\u5757\u7684\u5904\u7406\uff0c\u5df2\u7ecf\u53ef\u4ee5\u786e\u4fdd\u6d41\u6c34\u7ebf\u4ea7\u751f\u7684\u7ed3\u679c\u65e0\u8bef\u4e86\uff0c\u6240\u4ee5\u5199\u56de\u9636\u6bb5\u7684\u6570\u636e\u4e0d\u53d7\u505c\u6b62\u4fe1\u53f7 stall \u548c\u6e05\u96f6\u4fe1\u53f7 flush \u7684\u63a7\u5236\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_40","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_41","title":"\u76f8\u5173\u4ee3\u7801","text":"<ul> <li><code>hazard.v</code>(\u63a7\u5236\u5192\u9669\u6a21\u5757)</li> <li><code>mem_wb_ctrl.v</code>(\u5199\u56de\u63a7\u5236\u6a21\u5757)</li> <li><code>mem_wb.v</code>(\u5199\u56de\u6570\u636e\u6a21\u5757)</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#cpucpu_3","title":"\u624b\u5199CPU\uff08\u516d\uff09\uff1a\u8ba9CPU\u8dd1\u8d77\u6765","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#_42","title":"\u7cfb\u7edf\u603b\u7ebf\u8bbe\u8ba1","text":"<p>\u603b\u7ebf\u662f\u8fde\u63a5\u591a\u4e2a\u90e8\u4ef6\u7684\u4fe1\u606f\u4f20\u8f93\u7ebf\uff0c\u5b83\u662f\u5404\u90e8\u4ef6\u5171\u4eab\u7684\u4f20\u8f93\u4ecb\u8d28\u3002</p> <p>\u5728\u67d0\u4e00\u65f6\u523b\uff0c\u53ea\u5141\u8bb8\u6709\u4e00\u4e2a\u90e8\u4ef6\u5411\u603b\u7ebf\u53d1\u9001\u4fe1\u606f\uff0c\u800c\u591a\u4e2a\u90e8\u4ef6\u53ef\u4ee5\u540c\u65f6\u4ece\u603b\u7ebf\u4e0a\u63a5\u6536\u76f8\u540c\u7684\u4fe1\u606f\u3002</p> <p>MiniCPU \u7684\u7cfb\u7edf\u603b\u7ebf\u7528\u6765\u8fde\u63a5 CPU \u5185\u6838\u4e0e\u5916\u8bbe\uff0c\u5b8c\u6210\u4fe1\u606f\u4f20\u8f93\u7684\u529f\u80fd\u3002</p> <p>\u7cfb\u7edf\u603b\u7ebf\u5728\u6574\u4e2a MiniCPU \u4e2d\u662f\u4e00\u4e2a\u5f88\u5173\u952e\u7684\u6a21\u5757\u3002\u4f60\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff0c\u603b\u7ebf\u5c31\u662f CPU \u5185\u6838\u8ddf\u5176\u4ed6\u5916\u8bbe\u90e8\u4ef6\u7684\u201c\u8054\u7edc\u5458\u201d\u3002</p> <p>\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff0c\u603b\u7ebf\u53ef\u4ee5\u4ece ROM \u4e2d\u8bfb\u53d6\u6307\u4ee4\uff0c\u518d\u4ea4\u7ed9 CPU \u53bb\u6267\u884c\uff1b</p> <p>CPU \u8fd0\u884c\u7a0b\u5e8f\u65f6\u7684\u53d8\u91cf\uff0c\u4e5f\u4f1a\u4ea4\u7531\u603b\u7ebf\u4fdd\u5b58\u5230 RAM \u4e2d\uff1b</p> <p>\u7528\u6765\u5b9e\u73b0\u82af\u7247\u4e0e\u5916\u90e8\u901a\u4fe1\u7684 UART \u6a21\u5757\uff0c\u4e5f\u9700\u8981\u901a\u8fc7\u603b\u7ebf\u8ddf CPU \u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u2026\u2026</p> <pre><code>module sys_bus (\n    // cpu -&gt; imem\n    input  [31:0] cpu_imem_addr,\n    output [31:0] cpu_imem_data,\n    output [31:0] imem_addr,              \n    input  [31:0] imem_data, \n\n    // cpu -&gt; bus\n    input  [31:0] cpu_dmem_addr,        \n    input  [31:0] cpu_dmem_data_in,     \n    input         cpu_dmem_wen,        \n    output reg [31:0] cpu_dmem_data_out,\n\n    // bus -&gt; ram \n    input  [31:0] dmem_read_data,     \n    output [31:0] dmem_write_data,    \n    output [31:0] dmem_addr,           \n    output reg    dmem_wen,\n\n    // bus -&gt; rom \n    input  [31:0] dmem_rom_read_data,\n    output [31:0] dmem_rom_addr, \n\n    // bus -&gt; uart\n    input  [31:0] uart_read_data,   \n    output [31:0] uart_write_data,   \n    output [31:0] uart_addr,         \n    output reg    uart_wen\n);\n    assign imem_addr = cpu_imem_addr;\n    assign cpu_imem_data = imem_data;\n    assign dmem_addr = cpu_dmem_addr;\n    assign dmem_write_data = cpu_dmem_data_in;\n    assign dmem_rom_addr = cpu_dmem_addr;\n    assign uart_addr = cpu_dmem_addr;\n    assign uart_write_data = cpu_dmem_data_in;\n\n    always @(*) begin\n        case (cpu_dmem_addr[31:28])\n            4'h0: begin                //ROM\n                cpu_dmem_data_out &lt;= dmem_rom_read_data;\n                dmem_wen &lt;= 0;\n                uart_wen &lt;= 0;\n            end\n            4'h1: begin               // RAM\n                dmem_wen &lt;= cpu_dmem_wen;\n                cpu_dmem_data_out &lt;= dmem_read_data;\n                uart_wen &lt;= 0;\n            end\n            4'h2: begin               // uart io\n                uart_wen &lt;= cpu_dmem_wen;\n                cpu_dmem_data_out &lt;= uart_read_data;\n                dmem_wen &lt;= 0;\n            end\n            default:   begin\n                dmem_wen &lt;= 0;\n                uart_wen &lt;= 0;\n                cpu_dmem_data_out &lt;= 0;\n            end\n        endcase\n    end\nendmodule\n</code></pre> <p></p> <p>CPU \u5185\u6838\u5177\u6709\u7cfb\u7edf\u603b\u7ebf\u7684\u63a7\u5236\u6743\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u603b\u7ebf\uff0c\u53d1\u8d77\u5bf9\u5916\u8bbe\u7684\u8bbf\u95ee\uff0c\u800c\u5916\u8bbe\u53ea\u80fd\u54cd\u5e94\u4ece CPU \u5185\u6838\u53d1\u6765\u7684\u5404\u79cd\u603b\u7ebf\u547d\u4ee4\u3002</p> <p>\u56e0\u6b64\uff0c\u6bcf\u4e2a\u5916\u8bbe\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u5740\uff0c\u4f5c\u4e3a CPU \u8bbf\u95ee\u7279\u5b9a\u5916\u8bbe\u7684\u6807\u8bc6\u3002</p> <p>\u4ee5\u4e0b\u5c31\u662f\u7ed9\u4ece\u8bbe\u5907\u5206\u914d\u7684\u5730\u5740\u7a7a\u95f4\uff1a</p> <p>// \u8bbe\u5907\u5730\u5740\u7a7a\u95f4</p> <p>// 0x0000_0000 -ROM (word to byte )</p> <p>// 0x1000_0000 -RAM (word to byte )</p> <p>// 0x2000_0000 -uart (word to byte )</p> <p>// 0x3000_0000 -other(word to byte )</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#rom","title":"ROM\u7684\u5b9e\u73b0","text":"<pre><code>module imem (\n    input  [11:0] addr1,\n    output [31:0] imem_o1,\n    input  [11:0] addr2,\n    output [31:0] imem_o2\n);\n    reg [31:0] imem_reg[0:4096];\n\n    assign imem_o1 = imem_reg[addr1];\n    assign imem_o2 = imem_reg[addr2];\n\nendmodule\n</code></pre> <p>\u4e3a\u4e86\u65b9\u4fbf\u5b66\u4e60\u548c\u4eff\u771f\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u5bc4\u5b58\u5668\uff08reg\uff09\u4e34\u65f6\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6307\u4ee4\u5b58\u50a8\u5668 imem\uff0c\u5e76\u5728\u4eff\u771f\u7684\u9876\u5c42\uff08tb_top.v\uff09\u4f7f\u7528\u4e86$readmemh\uff08\uff09\u51fd\u6570\uff0c\u628a\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u6307\u4ee4\u8bfb\u5165\u5230 imem \u4e2d\uff0c\u4ee5\u4fbf CPU \u5185\u90e8\u8bfb\u53d6\u5e76\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u8bbe\u7f6e\u7684\u5b58\u50a8\u5668\u5728\u529f\u80fd\u4e0a\u662f\u53ea\u8bfb\u7684\u3002\u4ee5\u4e0b\u5c31\u662f\u4eff\u771f\u7684\u9876\u5c42\uff08tb_top.v\uff09\u8c03\u7528 $ readmemh\uff08\uff09\u51fd\u6570\u7684\u8bed\u53e5\u3002</p> <pre><code>$readmemh(`HEXFILE, MiniCPU.u_imem.imem_reg);\n</code></pre> <p>\u51fd\u6570\u91cc\u9762\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u662f\u5b58\u653e\u4e8c\u8fdb\u5236\u6307\u4ee4\u7684\u6587\u4ef6\uff08HEXFILE\uff09\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u5b9e\u73b0 ROM \u529f\u80fd\u7684\u5bc4\u5b58\u5668\uff08imem_reg\uff09\u3002</p> <p>\u8fd9\u6761\u8bed\u53e5\u53ef\u4ee5\u5728\u6211\u4eec\u542f\u52a8 CPU \u4eff\u771f\u65f6\uff0c\u628a\u4e8c\u8fdb\u5236\u7684\u6307\u4ee4\u4e00\u6b21\u6027\u8bfb\u5165\u5230 imem \u4e2d\uff0c\u8fd9\u6837 CPU \u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u5c31\u53ef\u4ee5\u53d6 imem \u4e2d\u7684\u6307\u4ee4\u53bb\u6267\u884c\u4e86\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#ram","title":"\u968f\u673a\u8bbf\u95ee\u5b58\u50a8\u5668RAM","text":"<p>\u548c ROM \u4e00\u6837\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5bf9\u8bbe\u8ba1\u7684 MiniCPU \u8fdb\u884c\u4eff\u771f\u9a8c\u8bc1\uff0c\u6211\u4eec\u8fd8\u662f\u7528\u5bc4\u5b58\u5668\uff08reg\uff09\u4e34\u65f6\u6784\u5efa\u4e86\u4e00\u4e2a\u6570\u636e\u5b58\u50a8\u5668 dmem\uff0c\u4f5c\u4e3a MiniCPU \u4e2d\u7684 RAM \u4f7f\u7528\u3002\u867d\u7136\u4e34\u65f6\u6784\u5efa\u7684\u5b58\u50a8\u5668\u548c\u5b9e\u9645\u7684 RAM \u6709\u70b9\u5dee\u522b\uff0c\u4f46\u6211\u4eec\u8fd8\u5728\u521d\u671f\u5b66\u4e60\u9636\u6bb5\uff0c\u8fd9\u5df2\u7ecf\u8db3\u591f\u4e86\u3002</p> <pre><code>module dmem(\n    input [11:0] addr,\n    input we,\n    input [31:0] din,\n    input clk,\n\n    output reg [31:0] dout\n);\n    reg [31:0] dmem_reg[0:4095];\n\n    always @(posedge clk) begin\n        if(we) begin\n            dmem_reg[addr] &lt;= din;\n        end\n            dout &lt;= dmem_reg[addr];\n    end\nendmodule\n</code></pre>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html#uart","title":"\u5916\u8bbeUART\u8bbe\u8ba1","text":"<ul> <li> <p>UART \u7684\u5168\u79f0\u53eb\u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668\uff08Universal Asynchronous Receiver/Transmitter\uff09\uff0c\u5b83\u662f\u4e00\u79cd\u4e32\u884c\u3001\u5f02\u6b65\u3001\u5168\u53cc\u5de5\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u662f\u7535\u5b50\u8bbe\u5907\u95f4\u8fdb\u884c\u5f02\u6b65\u901a\u4fe1\u7684\u5e38\u7528\u6a21\u5757\u3002</p> <p>UART \u8d1f\u8d23\u5bf9\u7cfb\u7edf\u603b\u7ebf\u7684\u5e76\u884c\u6570\u636e\u548c\u4e32\u884c\u53e3\u4e0a\u7684\u4e32\u884c\u6570\u636e\u8fdb\u884c\u8f6c\u6362\uff0c\u901a\u4fe1\u53cc\u65b9\u91c7\u7528\u76f8\u540c\u7684\u6ce2\u7279\u7387\u3002</p> <p>\u5728\u4e0d\u4f7f\u7528\u65f6\u949f\u4fe1\u53f7\u7ebf\u7684\u60c5\u51b5\u4e0b\uff0c\u4ec5\u7528\u4e00\u6839\u6570\u636e\u53d1\u9001\u4fe1\u53f7\u7ebf\u548c\u4e00\u6839\u6570\u636e\u63a5\u6536\u4fe1\u53f7\u7ebf\uff08Rx \u548c Tx\uff09\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e24\u4e2a\u8bbe\u5907\u95f4\u7684\u901a\u4fe1\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u628a UART \u79f0\u4e3a\u5f02\u6b65\u4e32\u884c\u901a\u4fe1\u3002</p> </li> <li> <p>\u4e32\u884c\u901a\u4fe1\u662f\u6307\uff0c\u5229\u7528\u4e00\u6761\u4f20\u8f93\u7ebf\u5c06\u6570\u636e\u6309\u987a\u5e8f\u4e00\u4f4d\u4f4d\u4f20\u9001\u7684\u8fc7\u7a0b\u3002</p> <p>UART \u7684\u53d1\u9001\u6a21\u5757\u4f1a\u628a\u6765\u81ea CPU \u603b\u7ebf\u7684\u5e76\u884c\u6570\u636e\u8f6c\u6362\u4e3a\u4e32\u884c\u6570\u636e\uff0c</p> <p>\u518d\u4ee5\u4e32\u884c\u65b9\u5f0f\u5c06\u5176\u53d1\u9001\u5230\u53e6\u4e00\u4e2a\u8bbe\u5907\u7684 UART \u63a5\u6536\u7aef\u3002</p> <p>\u7136\u540e\u7531 UART \u7684\u63a5\u6536\u6a21\u5757\u628a\u4e32\u884c\u6570\u636e\u8f6c\u6362\u4e3a\u5e76\u884c\u6570\u636e\uff0c\u4ee5\u4fbf\u63a5\u6536\u8bbe\u5907\u5b58\u50a8\u548c\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u3002</p> </li> </ul> <p>UART \u4f20\u8f93\u6570\u636e\u5305\u62ec\u8d77\u59cb\u4f4d\u3001\u6570\u636e\u4f4d\u3001\u5947\u5076\u6821\u9a8c\u4f4d\u3001\u505c\u6b62\u4f4d\u548c\u7a7a\u95f2\u4f4d\u3002UART \u6570\u636e\u4f20\u8f93\u7ebf\u901a\u5e38\u5728\u4e0d\u4f20\u8f93\u6570\u636e\u65f6\u4fdd\u6301\u5728\u9ad8\u7535\u5e73\u3002</p> <ul> <li>\u8d77\u59cb\u4f4d\u662f\u5728\u6570\u636e\u7ebf\u4e0a\u5148\u53d1\u51fa\u4e00\u4e2a\u903b\u8f91\u4f4e\u7535\u5e73\u201c0\u201d\u4fe1\u53f7\uff0c\u8868\u793a\u6570\u636e\u4f20\u8f93\u7684\u5f00\u59cb\u3002</li> <li>\u6570\u636e\u4f4d\u662f\u7531 5~8 \u4f4d\u903b\u8f91\u9ad8\u4f4e\u7535\u5e73\u8868\u793a\u7684\u201c1\u201d\u6216\u201c0\u201d\u4fe1\u53f7\u3002</li> <li>\u6821\u9a8c\u4f4d\u5728\u4f20\u8f93\u7684\u6570\u636e\u4f4d\u7684\u540e\u9762\u52a0 1bit\uff0c\u8868\u793a\u201c1\u201d\u7684\u4f4d\u6570\u5e94\u4e3a\u5076\u6570\uff08\u5076\u6821\u9a8c\uff09\u6216\u5947\u6570\uff08\u5947\u6821\u9a8c\uff09\u3002</li> <li>\u505c\u6b62\u4f4d\u662f\u4e00\u4e2a\u6570\u636e\u4f4d\u5bbd\u7684 1 \u500d\u30011.5 \u500d\u3001\u6216\u8005 2 \u500d\u7684\u9ad8\u7535\u5e73\u4fe1\u53f7\uff0c\u5b83\u662f\u4e00\u6b21\u6570\u636e\u4f20\u8f93\u7684\u7ed3\u675f\u6807\u5fd7\u3002</li> <li>\u7a7a\u95f2\u4f4d\u662f\u6570\u636e\u4f20\u8f93\u7ebf\u5904\u4e8e\u903b\u8f91\u9ad8\u7535\u5e73\u72b6\u6001\uff0c\u8868\u793a\u5f53\u524d\u7ebf\u8def\u4e0a\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u6ca1\u6709\u6570\u636e\u4f20\u9001\u3002</li> </ul> <p>\u5177\u4f53\u5b9e\u73b0</p> <pre><code>module uart_tx(\ninput           clk         , // Top level system clock input.\ninput           resetn      , // Asynchronous active low reset.\noutput          uart_txd    , // UART transmit pin.\noutput          uart_tx_busy, // Module busy sending previous item.\ninput           uart_tx_en  , // Send the data on uart_tx_data\ninput   [7:0]   uart_tx_data  // The data to be sent\n);\n    ......//\u5177\u4f53\u770b\u6e90\u7801\n</code></pre> <pre><code>module uart_rx(\ninput         clk          , // Top level system clock input.\ninput         resetn       , // Asynchronous active low reset.\ninput         uart_rxd     , // UART Recieve pin.\ninput         uart_rx_en   , // Recieve enable\noutput        uart_rx_break, // Did we get a BREAK message?\noutput        uart_rx_valid, // Valid data recieved and available.\noutput reg  [7:0] uart_rx_data   // The recieved data.\n);\n    ......//\u5177\u4f53\u770b\u6e90\u7801\n</code></pre>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html","title":"3. \u5e94\u7528\u548c\u5185\u5b58","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#0","title":"0 | \u6982\u8ff0","text":"<p>\u6b64\u7b14\u8bb0\u4e3a\u81ea\u5df1\u5b66\u4e60<code>GeekTime</code>\u65f6\uff0c\u7c97\u7565\u7684\u6982\u62ec\u5185\u5bb9\uff0c\u53ea\u7528\u4f5c\u57fa\u7840\u5165\u95e8\uff0c\u672a\u6df1\u5165\u5b66\u4e60\u67d0\u4e00\u4e2a\u4e13\u9898\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6b64\u7b14\u8bb0\u5c3d\u91cf\u5c11\u6d89\u53ca\u4ee3\u7801\uff0c\u53ea\u505a\u7406\u8bba\u8865\u5145\u3002</p> <p>\u6bcf\u5199\u5b8c\u4e00\u7ae0\u77e5\u8bc6\u70b9\uff0c\u5c3d\u91cf\u914d\u5408Linux\u7cfb\u7edf\u7f16\u7a0b\u7684\u4ee3\u7801\u5199\u5199\u4ee3\u7801\uff0c\u7406\u89e3\u4ee3\u7801\u5b9e\u73b0\u3002</p> <p>\u6216\uff0c\u5feb\u901f\u8fc7\u5b8c\u6bcf\u4e00\u70b9\uff0c\u6709\u4e2a\u5927\u6982\uff0c\u518d\u5f00\u59cb\u6572\u4ee3\u7801\uff0c\u518d\u56de\u5934\u8fb9\u770b\u8fb9\u5199\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#1","title":"1\uff5c\u5185\u5b58\u5730\u5740\u7a7a\u95f4\uff1a\u7a0b\u5e8f\u4e2d\u5730\u5740\u7684\u4e09\u79cd\u4ea7\u751f\u65b9\u5f0f","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#cpu","title":"CPU\u600e\u4e48\u8bbf\u95ee\u5185\u5b58","text":"<p>CPU\u901a\u8fc7\u5185\u5b58\u5730\u5740\u6765\u8bbf\u95ee\u5185\u5b58</p> <p>CPU \u901a\u8fc7\u5730\u5740\u8bbf\u95ee\u5185\u5b58\uff0c\u5730\u5740\u7684\u672c\u8d28\u662f\u6574\u6570\u6570\u636e\uff0c\u800c\u6574\u6570\u6570\u636e\u7684\u672c\u8d28\u662f\u7535\u5b50\u4fe1\u53f7\u7684\u7ec4\u5408\u3002</p> <p></p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_1","title":"\u5185\u5b58\u5730\u5740\u4ece\u54ea\u91cc\u6765","text":"<ol> <li>\u94fe\u63a5\u5668\uff08\u4e3b\u8981\u770b\u8fd9\u4e2a\uff09</li> <li>\u76f4\u63a5\u5b9a\u4e49</li> <li>\u52a8\u6001\u5206\u914d\u5185\u5b58\u3002</li> </ol> <p>C\u8bed\u8a00main\u51fd\u6570\u8c03\u7528\u6c47\u7f16\u4ee3\u7801<code>sw_ins</code>\uff0c\u5bf9 word \u53d8\u91cf\u505a\u4fee\u6539\uff0c\u628a\u5b83\u4ece 0xffffffff \u4fee\u6539\u4e3a 0\u3002</p> <pre><code>; ls.S\u6587\u4ef6\n.text\n.globl sw_ins\n#a0\u5185\u5b58\u5730\u5740\n#a1\u50a8\u5b58\u7684\u503c\nsw_ins:\n    sw a1, 0(a0)       #\u50a8\u5b58a1\u5230a0+0\u5730\u5740\u5904\n    jr ra              #\u8fd4\u56de\n\n; main.c\u6587\u4ef6\nunsigned int word = 0xffffffff;\nint main()\n{\n    sw_ins((unsigned int)&amp;word, 0);\n    return 0;\n}\n</code></pre> <p>\u7814\u7a76\u4ee3\u7801\u7684\u7f16\u8bd1\u540e\u7684\u94fe\u63a5\u8fc7\u7a0b</p> <pre><code>// \u8f93\u51fa\u683c\u5f0f\nOUTPUT_FORMAT(elf32-littleriscv)\n// \u914d\u7f6e\u5185\u5b58\u7a7a\u95f4\uff0c\u8d77\u59cb\u5730\u5740\u4e3a0x10000\uff0c\u957f\u5ea6\u4e3a0x50000\nMEMORY\n{\n  RAM (xrw) : ORIGIN = 0x10000 , LENGTH = 0x50000\n}\n// \u5b9a\u4e49\u8f93\u51fa\u8282\nSECTIONS\n{\n    // \u5b9a\u4e49text\u8282\u5305\u542b\u94fe\u63a5\u6587\u4ef6\u7684\u6240\u6709\u4ee5.text\u5f00\u5934\u7684\u8282\n  .text :\n  {\n    *(.text) *(.text.*)\n  } &gt; RAM\n    // \u5b9a\u4e49data\u8282\u5305\u542b\u94fe\u63a5\u6587\u4ef6\u7684\u6240\u6709\u4ee5.data\u3001.sdata\u3001.sdata2\u3001.rodata\u5f00\u5934\u7684\u8282\n  .data :\n  {\n      *(.data .data.*) *(.sdata .sdata.*) *(.sdata2.*) *(.rodata) *(.rodata*)\n  } &gt; RAM\n    // \u5b9a\u4e49bss\u8282\u5305\u542b\u94fe\u63a5\u6587\u4ef6\u7684\u6240\u6709\u4ee5.bss\u3001.sbss\u3001.common\u5f00\u5934\u7684\u8282\n  .bss :\n    {\n        *(.sbss*) *(.bss*) *(COMMON*)\n  } &gt; RAM\n}\n</code></pre> <p>\u94fe\u63a5\u811a\u672c\u4e2d\uff1a</p> <ol> <li> <p>Id.lds \u6587\u4ef6\u9996\u5148\u914d\u7f6e\u4e86\u4e00\u4e2a\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u7a7a\u95f4\u4ece 0x10000 \u5730\u5740\u5f00\u59cb\uff0c\u4e00\u5171\u6709 0x50000 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u7136\u540e\uff0c\u94fe\u63a5\u5668\u628a\u6240\u6709\u53c2\u4e0e\u94fe\u63a5\u6587\u4ef6\u91cc\uff0c\u4ee5.text\u3001.data\u3001.sdata\u3001.bss\u3001.sbss\u3001.COMMON \u5f00\u5934\u7684\u8282\uff0c\u6309\u7167\u4e0a\u8ff0\u94fe\u63a5\u811a\u672c\u7684\u987a\u5e8f\uff0c\u5408\u5e76\u6210\u53ef\u6267\u884c\u7a0b\u5e8f\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u7684\u5730\u5740\u4ece 0x10000 \u5730\u5740\u5f00\u59cb\uff0c\u5230 0x60000 \u7ed3\u675f\u3002</p> </li> <li> <p>\u8fd9\u4e2a\u5408\u5e76\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u5bf9\u7b26\u53f7\u8fdb\u884c\u7ed1\u5b9a\u548c\u5730\u5740\u91cd\u5b9a\u4f4d\uff0c\u5982\u4e0b\u56fe\u5c55\u793a\u8fc7\u7a0b\u3002</p> <p></p> </li> </ol> <ul> <li> <p>\u603b\u7ed3</p> <ol> <li> <p>\u94fe\u63a5\u5668\u6240\u505a\u7684\u5de5\u4f5c\u5c31\u662f\u6839\u636e lds \u6587\u4ef6\u4e2d\u7684\u5b9a\u4e49\uff0c\u5b8c\u6210\u201c\u5408\u5e76\u540c\u7c7b\u9879\u201d\u7684\u6574\u7406\u5de5\u4f5c\uff0c</p> <p>\u5373\uff0c\u628a\u76f8\u540c\u7684\u8282\u5408\u5e76\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u8282\u3002</p> <p>\u6bd4\u5982 ls.o \u7684.text \u8282\u4e0e main.o \u7684.text \u8282\u5408\u5e76\u6210 main.elf \u7684.text \u8282\uff0c\u800c.data\u3001.bss \u8282\u4e5f\u662f\u7c7b\u4f3c\u7684\u5408\u5e76\u8fc7\u7a0b\uff0c\u5408\u5e76\u4e4b\u540e\u8fdb\u884c\u7a0b\u5e8f\u91cd\u5b9a\u4f4d\u3002</p> </li> <li> <p>\u7a0b\u5e8f\u91cd\u5b9a\u4f4d\u4e5f\u53eb\u5206\u914d\u5185\u5b58\u5730\u5740\u3002</p> <p>\u5982 main.elf \u7a0b\u5e8f\u8981\u4ece\u5185\u5b58\u5730\u5740 0x10000 \u5f00\u59cb\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5730\u5740\u5f00\u59cb\u5b58\u653e\u7684\u662f.text \u8282\uff0c\u5373\u6307\u4ee4\u90e8\u5206\uff0c.data \u8282\u653e\u5728.text \u8282\u4e4b\u540e\u3002\u94fe\u63a5\u5668\u6839\u636e.text \u8282\u7684\u5927\u5c0f\uff0c\u5c31\u80fd\u7b97\u51fa.data \u8282\u7684\u5f00\u59cb\u5730\u5740\u3002</p> <p>\u6bd4\u5982\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u5c31\u662f 0x10030\u3002.data \u8282\u4e2d\u6709\u4e00\u4e2a\u53d8\u91cf word \u662f\u4e00\u4e2a\u5b57\u5927\u5c0f\uff0c\u6240\u4ee5 word \u53d8\u91cf\u5730\u5740\u4f1a\u4ece 0x10030 \u5f00\u59cb\u5b58\u653e\uff0c\u5360\u7528 4 \u5b57\u8282\uff0c\u4e0b\u4e00\u4e2a\u53d8\u91cf\u5730\u5740\u5c06\u4ece 0x10034 \u5f00\u59cb\u3002</p> <p>\u65e2\u7136 word \u53d8\u91cf\u5b58\u653e\u5185\u5b58\u5730\u5740\u662f 0x10030\uff0c\u90a3\u4e48\u94fe\u63a5\u5668\u5c31\u9700\u8981\u4fee\u6539\u6307\u4ee4\uff0c\u5177\u4f53\u5c31\u662f\u4fee\u6539\u6307\u4ee4\u4e2d\u8868\u793a word \u53d8\u91cf\u5730\u5740\u7684\u6570\u636e\uff0c\u8ba9\u5730\u5740\u6570\u636e\u53d8\u6210 0x10030\uff0c\u6216\u8005\u901a\u8fc7\u4e00\u79cd\u8ba1\u7b97\u65b9\u5f0f\u5f97\u5230 0x10030\uff0c\u8fd9\u6837\u7a0b\u5e8f\u4e2d\u7684\u76f8\u5173\u6307\u4ee4\u624d\u80fd\u6700\u7ec8\u8bbf\u95ee\u5230 word \u53d8\u91cf\u3002</p> <p>\u8fd9\u4e5f\u662f\u5728 main.o \u4e2d\u7684 main \u51fd\u6570\u91cc\uff0c\u4e00\u4e9b\u6307\u4ee4\u6570\u636e\u4e0e main.elf \u4e2d\u7684 main \u51fd\u6570\u6307\u4ee4\u6570\u636e\u4e0d\u4e00\u6837\u7684\u539f\u56e0\u3002</p> </li> <li> <p>\u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u7684\u5730\u65b9\uff0cmain \u51fd\u6570\u4e2d\u8c03\u7528\u4e86 sw_ins \u51fd\u6570\uff0c\u94fe\u63a5\u5668\u4e5f\u8981\u8fdb\u884c\u5904\u7406\uff0c\u786e\u4fdd jalr \u6307\u4ee4\u80fd\u8df3\u8f6c\u5230 sw_ins \u51fd\u6570\u7684\u5730\u5740\u4e0a\uff0c\u5373 0x10000 \u5730\u5740\u3002</p> <p>\u200b                                   \u94fe\u63a5\u5668\u94fe\u63a5\u591a\u4e2a\u7a0b\u5e8f\u6a21\u5757\uff0c\u4e14\u5206\u914d\u7a0b\u5e8f\u5728\u4e2d\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u5730\u5740</p> </li> </ol> </li> <li> <p>\u53e6\u5916\u4e24\u79cd</p> <pre><code>int main()\n{\n    // \u628a\u6574\u65700x20000\u5f3a\u5236\u8f6c\u6362\u4e3aint\u7c7b\u578b\u7684\u6307\u9488\n    int *p = (int*)0x20000;\n    *p = 0;\n    // \u52a8\u6001\u5206\u914d\u4e00\u4e2aint\u7c7b\u578b\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5176\u9996\u5730\u5740\u8fd4\u56de\u7ed9addr\u6307\u9488\n    void* addr = malloc(sizeof(int));\n    return 0;\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u5c31\u662f\u8ba9 p \u76f4\u63a5\u6307\u5411 0x20000 \u5730\u5740\uff0c\u7136\u540e\u5411\u8fd9\u4e2a\u5730\u5740\u4e0a\u5199\u5165 0\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u64cd\u4f5c\u6781\u5176\u5371\u9669\uff0c\u9664\u975e\u4f60\u786e\u5207\u5730\u77e5\u9053\u81ea\u5df1\u5728\u5e72\u4ec0\u4e48\uff0c\u56e0\u4e3a 0x20000 \u53ef\u80fd\u662f\u5176\u5b83\u91cd\u8981\u6570\u636e\uff0c\u4e5f\u53ef\u80fd\u4e0d\u662f\u771f\u6b63\u7684\u5185\u5b58\u5355\u5143\uff0c\u800c\u662f\u8bbe\u5907\u5bc4\u5b58\u5668\uff0c\u66f4\u53ef\u80fd\u4ec0\u4e48\u4e5f\u6ca1\u6709\uff0c\u5373\u8fd9\u4e2a\u5730\u5740\u6ca1\u6709\u8fde\u63a5\u4efb\u4f55\u6709\u6548\u8bbe\u5907\u3002</p> <p>\u52a8\u6001\u5206\u914d\u5185\u5b58\u5730\u5740\u76f8\u5bf9\u53ef\u9760\uff0c\u4f46\u4e5f\u6709\u95ee\u9898\uff0c\u9700\u8981\u81ea\u5df1\u91ca\u653e\u548c\u5185\u5b58\u788e\u7247</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_2","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#2","title":"2\uff5c\u865a\u5b9e\u7ed3\u5408\uff1a\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_3","title":"\u76f8\u5173\u6982\u5ff5","text":"<p>\u81ea\u5df1\u770b\u4e66</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#1_1","title":"\u865a\u5b9e\u7ed3\u54081\uff1a\u4ee3\u7801\u5206\u6790","text":"<p>\u7b80\u5355\u4e86\u89e3malloc\u7684\u5185\u5bb9</p> <pre><code>#include \"stdio.h\"\n#include \"stdlib.h\"\nvoid func_b()\n{\n    //\u5206\u914d\u5185\u5b58\uff0c\u8fd4\u56de\u5176\u5730\u5740\n    int* p = (int*)malloc(sizeof(int));\n    if(p)\n    {\n        printf(\"\u5185\u5b58\u5730\u5740:%p\\n\", p);\n        //\u5411\u8be5\u5730\u5740\u5199\u5165\u6570\u636e\n        *p = 0xABABBABA;\n        printf(\"\u5185\u5b58\u5730\u5740:%p\u5904\u7684\u503c:%x\\n\", p, *p);\n    }\n    return;    \n}\nint main()\n{\n    func_b();\n    return 0;\n}\n</code></pre> <p>malloc \u51fd\u6570\u5728\u5185\u90e8\u6700\u7ec8\u4f1a\u8c03\u7528 Linux \u5185\u6838\u7684 API \u51fd\u6570\uff0c\u5728\u8be5\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u5206\u914d\u4e00\u5c0f\u5757\u865a\u62df\u5185\u5b58\uff0c\u8fd4\u56de\u5176\u9996\u5730\u5740\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u7528\u4e00\u5e45\u56fe\u6765\u4e3a\u4f60\u5c55\u793a\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u7531\u4e8e\u4ee3\u7801\u4f18\u5316\u7684\u539f\u56e0\uff0cmalloc \u51fd\u6570\u5e76\u4e0d\u662f\u6bcf\u6b21\u8c03\u7528\uff0c\u90fd\u4f1a\u5bfc\u81f4 Linux \u5185\u6838\u5efa\u7acb\u4e00\u4e2a vm_area_struct \u6570\u636e\u7ed3\u6784\u3002</p> <p>\u6211\u4eec\u5047\u5b9a malloc \u51fd\u6570\u5bfc\u81f4 Linux \u5185\u6838\u5efa\u7acb\u4e86\u4e00\u4e2a vm_area_struct \u6570\u636e\u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u4e2d\u6709\u63cf\u8ff0\u865a\u62df\u5185\u5b58\u7684\u5f00\u59cb\u5730\u5740\u3001\u5927\u5c0f\u3001\u5c5e\u6027\u7b49\u76f8\u5173\u5b57\u6bb5\uff0c\u8868\u793a\u5df2\u7ecf\u5206\u914d\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u8bb8\u591a\u4e2a\u8fd9\u6837\u7684\u7ed3\u6784\u53ef\u4ee5\u4e00\u8d77\u8868\u793a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5206\u914d\u60c5\u51b5\u3002</p> <p>\u4f46\u662f\uff0c\u4ece vm_area_struct \u6570\u636e\u7ed3\u6784\u4e2d\u8fd4\u56de\u7684\u5730\u5740\uff0c\u4ecd\u7136\u662f\u865a\u62df\u7684\u3001\u662f\u5047\u7684\uff0c\u662f\u4e0d\u80fd\u7d22\u5f15\u5230\u5185\u5b58\u5355\u5143\u7684\uff0c\u76f4\u5230\u8bbf\u95ee\u8be5\u5730\u5740\u65f6\uff0c\u4f1a\u53d1\u751f\u53e6\u4e00\u4e2a\u6545\u4e8b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d CPU \u62ff\u7740\u4e00\u4e2a\u865a\u62df\u5730\u5740\u8bbf\u95ee\u5185\u5b58\uff0c\u9996\u5148\u4f1a\u7ecf\u8fc7 MMU\uff0c\u5bf9\u4e8e\u8c03\u7528 malloc \u51fd\u6570\u7684\u60c5\u51b5\u662f\u8be5\u865a\u62df\u5730\u5740\u6ca1\u6709\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\uff0c\u6240\u4ee5\u4f1a\u901a\u77e5 CPU \u8be5\u5730\u5740\u7981\u6b62\u8bbf\u95ee\u3002\uff08\u8be6\u89c1 \u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u300b\u7684\u7b14\u8bb0\uff09</p> <p>\u4e0a\u56fe\u4e2d 1 \u5230 4 \u4e2a\u6b65\u9aa4\u4e3a\u786c\u4ef6\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\uff08\u8fd9\u4e00\u6b65\u5b9e\u9645\u4e0a\u770bTLB\u4e2d\u662f\u5426\u5b58\u50a8\u4e86\u8fd9\u4e2a\u5bf9\u5e94\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u4e86\uff0c\u4e5f\u5c31\u662fMMU\u4e2d\u7684TLB\u8fd9\u4e2a\u786c\u4ef6\u4e86\uff09</p> <p>\u7136\u540e CPU \u4e2d\u65ad\u5230 Linux \u5185\u6838\u5730\u5740\u9519\u8bef\u5904\u7406\u7a0b\u5e8f\uff0c\u8f6f\u4ef6\u5f00\u59cb\u5de5\u4f5c\uff0c</p> <p>\u4e5f\u5c31\u662f\u8bf4 Linux \u5185\u6838\u4f1a\u5bf9\u7167\u7740\u5f53\u524d\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c</p> <p>\u53bb\u67e5\u627e\u5bf9\u5e94\u7684 vm_area_struct \u6570\u636e\u7ed3\u6784\uff0c\u627e\u4e0d\u5230\u5c31\u8bc1\u660e\u865a\u62df\u5730\u5740\u672a\u5206\u914d\uff0c\u76f4\u63a5\u7ed3\u675f\uff0c\u8fdb\u7a0b\u4f1a\u53d1\u51fa\u6bb5\u9519\u8bef\uff1b</p> <p>\u82e5\u662f\u627e\u5230\u4e86\uff0c\u5219\u8bc1\u660e\u865a\u62df\u5730\u5740\u5df2\u7ecf\u5206\u914d\uff0c\u63a5\u7740\u4f1a\u5206\u914d\u7269\u7406\u5185\u5b58\uff0c\u5efa\u7acb\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u63a5\u7740\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u4e86\u3002</p> <p>\u5b9e\u9645\u60c5\u51b5\u6bd4\u56fe\u4e2d\u7684\u590d\u6742\uff0c\u8fd9\u91cc\u53ea\u7406\u6e05\u695a malloc \u51fd\u6570\u7684\u903b\u8f91\uff0c\u5e76\u4e14\u660e\u786e malloc \u662f\u8fd4\u56de\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u5c31\u53ef\u4ee5\u4e86\u3002!</p> <p>\u5047\u5982\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff0c\u90a3\u518d\u770b\u770b\u4e0a\u9762\u7684\u5185\u5bb9\u548c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u90a3\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u7a0b\u5e8f\u7684\u5185\u5b58\u6539\u53d8\u4e86\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u7684\u5185\u5b58\uff01</p> <p>\u6240\u4ee5\u9700\u8981\u865a\u62df\u5185\u5b58\u6765\u9694\u79bb\u4fdd\u62a4\u3002</p> <pre><code>void mymemset(void* start, char val, int size)\n{\n    char* buf = (char*)start;\n    for(int i = 0; i &lt; size; i++)\n    {\n        buf[i] = val;\n    }\n    return;\n}\n</code></pre> <p></p> <p>\u6bcf\u4e2a\u5e94\u7528\uff0c\u90fd\u8ba4\u4e3a\u81ea\u5df1\u62e5\u6709\u6574\u4e2a\u5185\u5b58\uff0c\u8fd9\u4e00\u70b9\u53ef\u4ee5\u4ece\u6240\u6709\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u76f8\u540c\u7684\u94fe\u63a5\u811a\u672c\u8fdb\u884c\u94fe\u63a5\u5f97\u5230\u4f50\u8bc1\u3002\u5404\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 malloc \u51fd\u6570\uff0c\u53ef\u80fd\u5f97\u5230\u76f8\u540c\u5730\u5740\uff0c\u662f\u53e6\u4e00\u4e2a\u4f50\u8bc1\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#2_1","title":"\u865a\u5b9e\u7ed3\u54082\uff1a\u786c\u4ef6\u5b9e\u73b0","text":"<p>\u4f7f\u7528\u9875\u8868</p> <p>MMU</p> <p>TLB</p> <p>\u8fdb\u4e00\u6b65\u67e5\u770b\uff08\u8be6\u89c1 \u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u300b\u7684\u7b14\u8bb0\uff0c\u90a3\u91cc\u5199\u7684\u66f4\u597d\uff0c\u4e0d\u8d58\u8ff0\u4e86\uff09</p> <ul> <li> <p>\u53c2\u8003\u56fe\u7247</p> <p></p> <p></p> <p></p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#3","title":"3\uff5c\u5806&amp;\u6808\uff1a\u5806\u4e0e\u6808\u7684\u533a\u522b\u548c\u5e94\u7528","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#4","title":"4\uff5c\u5ef6\u8fdf\u5206\u914d\uff1a\u63d0\u9ad8\u5185\u5b58\u5229\u7528\u7387\u7684\u4e09\u79cd\u673a\u5236","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#5linux","title":"5\uff5c\u5e94\u7528\u5185\u5b58\u7ba1\u7406\uff1aLinux\u7684\u5e94\u7528\u4e0e\u5185\u5b58\u7ba1\u7406","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#6","title":"6\uff5c\u8fdb\u7a0b\u8c03\u5ea6\uff1a\u5e94\u7528\u4e3a\u4ec0\u4e48\u80fd\u5e76\u884c\u6267\u884c\uff1f","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#shell","title":"shell","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u7a0b\u5e8f\u3002</p> <p>\u3010\u6280\u672f\u6742\u8c08\u3011shell\u548cterminal_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_4","title":"\u8fdb\u7a0b","text":"<p>\u8fdb\u884c\u4e2d\u7684\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u662f\u9759\u6001\u7684\u3001\u6b7b\u7684\uff0c\u8981\u60f3\u8ba9\u4ed6\u8dd1\u8d77\u6765\uff0c\u90a3\u5c31\u5f97\u4f9d\u9760\u8ba1\u7b97\u673a\u6765\u8c03\u5ea6\u4e86\uff0c\u8dd1\u8d77\u6765\u7684\u7a0b\u5e8f\u5c31\u53eb\u505a\u8fdb\u7a0b\u3002</p> <p>\u4e0b\u9762\u5177\u4f53\u4ece\u4e09\u4e2a\u89d2\u5ea6\u6765\u7406\u89e3\uff1a\u5e94\u7528\u7a0b\u5e8f\u89d2\u5ea6\u3001\u8d44\u6e90\u7ba1\u7406\u89d2\u5ea6\u3001\u4ee3\u7801\u5b9e\u73b0\u89d2\u5ea6</p> <ul> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u89d2\u5ea6</p> <p>\u8fdb\u7a0b\u53ef\u4ee5\u6bd4\u4f5c\u64cd\u4f5c\u7cfb\u7edf\u5236\u4f5c\u7684\u4e00\u4e2a\u76d2\u5b50\u3002</p> <p>\u8fd9\u4e2a\u76d2\u5b50\u80fd\u88c5\u4e0b\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u800c\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u5728\u8fd9\u4e2a\u76d2\u5b50\u91cc\u505a\u4e00\u4e9b\u7b80\u5355\u7684\u5de5\u4f5c\u3002\u76d2\u5b50\u4e4b\u5916\u7684\u5de5\u4f5c\u5c31\u8981\u8bf7\u793a\u64cd\u4f5c\u7cfb\u7edf\u4ecb\u5165\uff0c\u5e76\u4ee3\u66ff\u5e94\u7528\u53bb\u5b8c\u6210\u76f8\u5e94\u7684\u5de5\u3002</p> <p>\u8fd9\u79cd\u76d2\u5b50\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5236\u4f5c\u5f88\u591a\uff0c\u4e0d\u540c\u5e94\u7528\u5404\u81ea\u4f7f\u7528\u81ea\u5df1\u7684\u76d2\u5b50\uff0c\u4e5f\u53ef\u4ee5\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u5185\u90e8\u4f7f\u7528\u591a\u4e2a\u76d2\u5b50\u88c5\u5165\u540c\u4e00\u4e2a\u5e94\u7528\u3002\u5176\u903b\u8f91\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u6ce8\u610f\uff1a\u4e00\u4e2a\u5e94\u7528\u53ef\u80fd\u5360\u4e86\u591a\u4e2a\u8fdb\u7a0b</p> <p>\u7406\u8bba\u4e0a\u80fd\u5236\u4f5c\u65e0\u9650\u4e2a\u8fdb\u7a0b\uff0c\u4f46\u662f\u8ba1\u7b97\u673a\u8d44\u6e90\u6709\u9650\uff0c\u6240\u4ee5\u518d\u4ece\u8d44\u6e90\u7ba1\u7406\u89d2\u5ea6\u6765\u770b\u770b\u3002</p> </li> <li> <p>\u8d44\u6e90\u7ba1\u7406\u89d2\u5ea6</p> <p>\u5728\u8ba1\u7b97\u673a\u4e2d\uff0cCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u5404\u79cd\u8f93\u5165\u3001\u8f93\u51fa\u8bbe\u5907\u751a\u81f3\u6587\u4ef6\u6570\u636e\u90fd\u53ef\u4ee5\u770b\u6210\u662f\u8d44\u6e90\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u662f\u8fd9\u4e9b\u8d44\u6e90\u7684\u7ba1\u7406\u8005\u3002\u5e94\u7528\u7a0b\u5e8f\u8981\u60f3\u4f7f\u7528\u8fd9\u4e9b\u201c\u8d44\u672c\u201d\uff0c\u5c31\u8981\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u3002</p> <p>\u6bd4\u65b9\u8bf4\uff0c\u5e94\u7528\u7a0b\u5e8f\u5360\u7528\u4e86\u591a\u5c11\u5185\u5b58\uff0c\u4f7f\u7528\u4e86\u591a\u5c11\u7f51\u7edc\u94fe\u63a5\u548c\u901a\u4fe1\u7aef\u53e3\uff0c\u6253\u5f00\u591a\u5c11\u6587\u4ef6\u7b49\uff0c\u8fd9\u4e9b\u4f7f\u7528\u7684\u8d44\u6e90\u901a\u901a\u8981\u8bb0\u5f55\u5728\u6848\u3002\u8bb0\u5f55\u5728\u54ea\u91cc\u6bd4\u8f83\u5408\u9002\u5462\uff1f</p> <p>\u5f53\u7136\u662f==\u4ee3\u8868\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u6d3b\u52a8\u5b9e\u4f53==\u2014\u2014\u8fdb\u7a0b\u4e4b\u4e2d\u6700\u4e3a\u7a33\u59a5\u3002</p> <p>\u7531\u6b64\uff0c\u6211\u4eec\u63a8\u5bfc\u51fa\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5e94\u8be5\u5305\u542b\u4e86\u8981\u7528\u5230\u7684\u8d44\u6e90\uff0c\u5373\u5b83\u5206\u914d\u5230\u7684\u5185\u5b58\uff0c\u901a\u5e38\u5305\u62ec\u865a\u62df\u5185\u5b58\u7684\u4e00\u4e2a\u533a\u57df\u3002</p> <p>\u6211\u4eec\u68b3\u7406\u4e00\u4e0b\u8fd9\u4e2a\u533a\u57df\u91cc\u5b58\u653e\u4e86\u54ea\u4e9b\u5185\u5bb9\uff1a</p> <ul> <li> <p>\u53ef\u8fd0\u884c\u4ee3\u7801\uff1b\u4fdd\u5b58\u8be5\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u4e2d\u9014\u4ea7\u751f\u7684\u6570\u636e\uff0c\u6bd4\u5982\u8f93\u5165\u3001\u8f93\u51fa\u3001\u8c03\u7528\u6808\u3001\u5806\uff1b</p> </li> <li> <p>\u5206\u914d\u7ed9\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u6587\u4ef6\u63cf\u8ff0\u8868\u3001\u6570\u636e\u6e90\u548c\u6570\u636e\u7ec8\u7aef\uff1b</p> </li> <li> <p>\u5b89\u5168\u7279\u6027\uff0c\u5373\u64cd\u4f5c\u7cfb\u7edf\u5141\u8bb8\u8be5\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u5e94\u7528\u7a0b\u5e8f\u62e5\u6709\u8005\u3001\u5e94\u7528\u7a0b\u5e8f\u7684\u6743\u9650\u96c6\u5408\u3002</p> </li> <li> <p>\u5904\u7406\u5bc4\u5b58\u5668\u3001MMU \u9875\u8868\u5185\u5bb9\uff1b</p> </li> <li> <p>\u2026\u2026</p> <p></p> </li> </ul> <p>\u603b\u7ed3\uff1a\u53ef\u4ee5\u770b\u4f5c\u64cd\u4f5c\u7cfb\u7edf\u7528\u6765\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u8d44\u6e90\u7684\u5bb9\u5668\uff0c\u901a\u8fc7\u8fdb\u7a0b\u5c31\u80fd\u63a7\u5236\u548c\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u4e00\u4e2a\u8fdb\u7a0b\u8bb0\u5f55\u4e86\u4e00\u4e2a\u5e94\u7528\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u7528\u5230\u7684\u6240\u6709\u8d44\u6e90\uff0c\u90a3\u64cd\u4f5c\u7cfb\u7edf\u5230\u5e95\u662f\u901a\u8fc7\u4ec0\u4e48\u6837\u7684\u673a\u5236\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u5462\uff1f\u4e0b\u9762\u4ece\u4ee3\u7801\u5b9e\u73b0\u7684\u89d2\u5ea6\u6765\u770b\u770b\u3002</p> </li> <li> <p>\u4ee3\u7801\u5b9e\u73b0\u89d2\u5ea6</p> <p>\u7269\u7406\u4e16\u754c\u8d44\u6e90 --&gt; </p> <p>\u8ba1\u7b97\u673a\u7a0b\u5e8f\u7684\u8d44\u6e90\uff08\u8fdb\u7a0b id\u3001\u8fdb\u7a0b\u72b6\u6001\u3001\u5730\u5740\u7a7a\u95f4\u3001\u5806\u6808\u3001CPU\u4e0a\u4e0b\u6587...\uff09 --&gt;</p> <p>\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5  --&gt; \uff08\u5177\u4f53\u5e94\u7528\uff09</p> <p>Linux\u4e2d\u7684\u5177\u4f53\u5b9e\u73b0</p> <pre><code>struct task_struct {\n    struct thread_info thread_info;//\u5904\u7406\u5668\u7279\u6709\u6570\u636e\uff0cCPU\u4e0a\u4e0b\u6587 \n    volatile long   state;       //\u8fdb\u7a0b\u72b6\u6001 \n    void            *stack;      //\u8fdb\u7a0b\u5185\u6838\u6808\u5730\u5740 \n    refcount_t      usage;       //\u8fdb\u7a0b\u4f7f\u7528\u8ba1\u6570\n    int             on_rq;       //\u8fdb\u7a0b\u662f\u5426\u5728\u8fd0\u884c\u961f\u5217\u4e0a\n    int             prio;        //\u52a8\u6001\u4f18\u5148\u7ea7\n    int             static_prio; //\u9759\u6001\u4f18\u5148\u7ea7\n    int             normal_prio; //\u53d6\u51b3\u4e8e\u9759\u6001\u4f18\u5148\u7ea7\u548c\u8c03\u5ea6\u7b56\u7565\n    unsigned int    rt_priority; //\u5b9e\u65f6\u4f18\u5148\u7ea7\n    const struct sched_class    *sched_class;//\u6307\u5411\u5176\u6240\u5728\u7684\u8c03\u5ea6\u7c7b\n    struct sched_entity         se;//\u666e\u901a\u8fdb\u7a0b\u7684\u8c03\u5ea6\u5b9e\u4f53\n    struct sched_rt_entity      rt;//\u5b9e\u65f6\u8fdb\u7a0b\u7684\u8c03\u5ea6\u5b9e\u4f53\n    struct sched_dl_entity      dl;//\u91c7\u7528EDF\u7b97\u6cd5\u8c03\u5ea6\u5b9e\u65f6\u8fdb\u7a0b\u7684\u8c03\u5ea6\u5b9e\u4f53\n    struct sched_info       sched_info;//\u7528\u4e8e\u8c03\u5ea6\u5668\u7edf\u8ba1\u8fdb\u7a0b\u7684\u8fd0\u884c\u4fe1\u606f \n    struct list_head        tasks;//\u6240\u6709\u8fdb\u7a0b\u7684\u94fe\u8868\n    struct mm_struct        *mm;  //\u6307\u5411\u8fdb\u7a0b\u5185\u5b58\u7ed3\u6784\n    struct mm_struct        *active_mm;\n    pid_t               pid;            //\u8fdb\u7a0bid\n    struct task_struct __rcu    *parent;//\u6307\u5411\u5176\u7236\u8fdb\u7a0b\n    struct list_head        children; //\u94fe\u8868\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u662f\u5b83\u7684\u5b50\u8fdb\u7a0b\n    struct list_head        sibling;  //\u7528\u4e8e\u628a\u5f53\u524d\u8fdb\u7a0b\u63d2\u5165\u5230\u5144\u5f1f\u94fe\u8868\u4e2d\n    struct task_struct      *group_leader;//\u6307\u5411\u5176\u6240\u5728\u8fdb\u7a0b\u7ec4\u7684\u9886\u5934\u8fdb\u7a0b\n    u64             utime;   //\u7528\u4e8e\u8bb0\u5f55\u8fdb\u7a0b\u5728\u7528\u6237\u6001\u4e0b\u6240\u7ecf\u8fc7\u7684\u8282\u62cd\u6570\n    u64             stime;   //\u7528\u4e8e\u8bb0\u5f55\u8fdb\u7a0b\u5728\u5185\u6838\u6001\u4e0b\u6240\u7ecf\u8fc7\u7684\u8282\u62cd\u6570\n    u64             gtime;   //\u7528\u4e8e\u8bb0\u5f55\u4f5c\u4e3a\u865a\u62df\u673a\u8fdb\u7a0b\u6240\u7ecf\u8fc7\u7684\u8282\u62cd\u6570\n    unsigned long           min_flt;//\u7f3a\u9875\u7edf\u8ba1 \n    unsigned long           maj_flt;\n    struct fs_struct        *fs;    //\u8fdb\u7a0b\u76f8\u5173\u7684\u6587\u4ef6\u7cfb\u7edf\u4fe1\u606f\n    struct files_struct     *files;//\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\n    struct vm_struct        *stack_vm_area;//\u5185\u6838\u6808\u7684\u5185\u5b58\u533a\n  };\n\nstruct mm_struct {\n        struct vm_area_struct *mmap; //\u865a\u62df\u5730\u5740\u533a\u95f4\u94fe\u8868VMAs\n        struct rb_root mm_rb;   //\u7ec4\u7ec7vm_area_struct\u7ed3\u6784\u7684\u7ea2\u9ed1\u6811\u7684\u6839\n        unsigned long task_size;    //\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5927\u5c0f\n        pgd_t * pgd;        //\u6307\u5411MMU\u9875\u8868\n        atomic_t mm_users; //\u591a\u4e2a\u8fdb\u7a0b\u5171\u4eab\u8fd9\u4e2amm_struct\n        atomic_t mm_count; //mm_struct\u7ed3\u6784\u672c\u8eab\u8ba1\u6570 \n        atomic_long_t pgtables_bytes;//\u9875\u8868\u5360\u7528\u4e86\u591a\u4e2a\u9875\n        int map_count;      //\u591a\u5c11\u4e2aVMA\n        spinlock_t page_table_lock; //\u4fdd\u62a4\u9875\u8868\u7684\u81ea\u65cb\u9501\n        struct list_head mmlist; //\u6302\u5165mm_struct\u7ed3\u6784\u7684\u94fe\u8868\n        //\u8fdb\u7a0b\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u5f00\u59cb\u3001\u7ed3\u675f\u5730\u5740\uff0c\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\u7684\u5f00\u59cb\u3001\u7ed3\u675f\u5730\u5740 \n        unsigned long start_code, end_code, start_data, end_data;\n        //\u8fdb\u7a0b\u5e94\u7528\u7a0b\u5e8f\u5806\u533a\u7684\u5f00\u59cb\u3001\u5f53\u524d\u5730\u5740\u3001\u6808\u5f00\u59cb\u5730\u5740 \n        unsigned long start_brk, brk, start_stack;\n        //\u8fdb\u7a0b\u5e94\u7528\u7a0b\u5e8f\u53c2\u6570\u533a\u5f00\u59cb\u3001\u7ed3\u675f\u5730\u5740\n        unsigned long arg_start, arg_end, env_start, env_end;\n};\n</code></pre> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_5","title":"\u591a\u8fdb\u7a0b","text":"<p>\u5b9e\u9645\u751f\u6d3b\u4e2d\u80af\u5b9a\u662f\u591a\u4e2a\u4efb\u52a1\u4e00\u8d77\u6765\u7684\uff0c\u8ba1\u7b97\u673a\u4e5f\u662f\u3002</p> <p>\u6bd4\u5982\u952e\u76d8\u3001\u663e\u793a\u5668\u3001\u9f20\u6807..... </p> <p>\u8fd8\u6709\uff0cCPU core \u5e94\u8be5\u6bcf\u4e00\u523b\u53ea\u80fd\u6267\u884c\u4e00\u4ef6\u4e8b\u5462\uff1f</p> <p>\u5177\u4f53\u600e\u4e48\u5b89\u6392\u8fd9\u4e48\u591a\u4e2a\u5e94\u7528\uff08\u8fdb\u7a0b\uff09\u3001\u6bcf\u4e00\u523b\u5462\uff1f\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684 CPU \u4e0a\u4e0b\u6587\uff0c\u6765\u4fdd\u62a4\u8fdb\u7a0b\u7684\u6267\u884c\u72b6\u6001\u548c\u8f68\u8ff9\u3002\u6211\u4eec\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5bf9\u5176 CPU \u4e0a\u4e0b\u6587\u4fdd\u5b58\u548c\u52a0\u8f7d\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u8fdb\u7a0b\u7684\u8c03\u5ea6\u3002</p> <p>\u6709\u591a\u79cd\u8fdb\u7a0b\u8c03\u5ea6\u7684\u7b97\u6cd5\uff0c\u8fd9\u91cc\u4e0d\u8ba8\u8bba\uff0c\u7406\u89e3\u601d\u8def\u4e3a\u4e3b\u3002</p> <p></p> <p>\u8fdb\u7a0b\u8c03\u5ea6\u6d89\u53ca\u5230\u7ed9\u8fdb\u7a0b\u8bbe\u7f6e\u76f8\u5e94\u7684\u72b6\u6001\uff0c\u6211\u4eec\u770b\u770b\u901a\u5e38\u8fdb\u7a0b\u6709\u54ea\u4e9b\u72b6\u6001\u3002\u4eba\u6709\u751f\u8001\u75c5\u6b7b\uff0c\u8fdb\u7a0b\u4e5f\u662f\u4e00\u6837\u3002\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u5efa\u7acb\u5230\u8fd0\u884c\uff0c\u8fd8\u53ef\u80fd\u56e0\u4e3a\u8d44\u6e90\u95ee\u9898\u4e0d\u5f97\u4e0d\u6682\u505c\u8fd0\u884c\uff0c\u6700\u540e\u8fdb\u7a0b\u8fd8\u8981\u9000\u51fa\u7cfb\u7edf\u3002\u8fd9\u4e9b\u8fc7\u7a0b\uff0c\u6211\u4eec\u79f0\u4e3a\u8fdb\u7a0b\u7684\u751f\u547d\u5468\u671f\u3002</p> <p></p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#-","title":"\u591a\u6838\u591a\u8fdb\u7a0b --&gt;\u5bf9\u79f0\u591a\u5904\u7406\u5668\u7cfb\u7edf","text":"<p>\u5355\u4e2a CPU \u6027\u80fd\u7ec8\u7a76\u6709\u9650\uff0c\u518d\u600e\u4e48\u63d0\u5347\u4e5f\u96be\u641e\uff0c\u6240\u4ee5\u591a\u6838\u4e00\u8d77\u6765\uff1f\uff08\u6709\u70b9\u50cf\u90a3\u4e2a\u670d\u52a1\u5668\u51e0\u79cd\u90e8\u7f72\u65b9\u5f0f\uff09</p> <p>\u6240\u4ee5 --&gt; SMP: \u5bf9\u79f0\u591a\u5904\u7406\u5668\u7cfb\u7edf</p> <p>SMP \u662f\u4e00\u79cd\u5e94\u7528\u5341\u5206\u5e7f\u6cdb\u7684\u5e76\u884c\u6280\u672f\uff0c\u5b83\u5728\u4e00\u4e2a\u8ba1\u7b97\u673a\u4e0a\u6c47\u96c6\u4e86\u4e00\u7ec4\u5904\u7406\u5668\uff08\u591a CPU\uff09\uff0c\u5404 CPU \u4e4b\u95f4\u5171\u4eab\u5185\u5b58\u4ee5\u53ca\u603b\u7ebf\u7ed3\u6784\u3002</p> <p></p> <p>\u4e00\u4e2a\u82af\u7247\u4e0a\u5c01\u88c5\u4e86\u56db\u4e2a CPU \u5185\u6838\uff0c\u6bcf\u4e2a CPU \u5185\u6838\u90fd\u6709\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u6267\u884c\u5355\u5143\uff1b</p> <p>\u5728\u4e00\u4e2a\u6267\u884c\u5355\u5143\u4e0a\u5b9e\u73b0\u4e86\u4e24\u4e2a\u786c\u4ef6\u7ebf\u7a0b\uff0c\u8fd9\u91cc\u786c\u4ef6\u7ebf\u7a0b\u5c31\u662f\u4e00\u5957\u72ec\u7acb\u7684\u5bc4\u5b58\u5668\uff0c\u7531\u6267\u884c\u5355\u5143\u8c03\u5ea6\uff0c\u5c31\u50cf\u662f\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\u8fdb\u7a0b\u3002\uff08\u8d85\u7ebf\u7a0b\u6280\u672f\uff09</p> <p>\u53ea\u662f\u8fd9\u91cc\u7531\u786c\u4ef6\u5b8c\u6210\uff0c\u8f6f\u4ef6\u5f00\u53d1\u4eba\u5458\u4e0d\u77e5\u9053\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1\u8005\u53ea\u611f\u89c9\u5230\u8fd9\u662f\u4e00\u9897\u903b\u8f91 CPU\uff0c\u53ef\u4ee5\u7528\u6765\u6267\u884c\u7a0b\u5e8f\u3002</p> <p>\u4f46\u662f\uff0c\u53c8\u5e26\u6765\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u600e\u4e48\u8c03\u5ea6\uff1f\u66f4\u96be\u4e86\u5427\uff1f</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_6","title":"\u591a\u6838\u5fc3\u8c03\u5ea6","text":"<p>\u6709\u54ea\u4e9b\u95ee\u9898\uff1f\u600e\u4e48\u89e3\u51b3</p> <ul> <li> <p>\u6570\u636e\u7ade\u4e89\u95ee\u9898\uff1a\u5bf9\u7cfb\u7edf\u4e2d\u7684\u5168\u5c40\u6570\u636e\u7684\u8bfb\u5199\uff0c\u540c\u4e00\u65f6\u95f4\u4e0b\u6709\u591a\u4e2a CPU \u80fd\u6267\u884c\u8fdb\u7a0b\u3002\uff08\u591a\u8fdb\u7a0b\u4e5f\u6709\uff09</p> <ul> <li>\u89e3\u51b3<ul> <li>\u539f\u5b50\u53d8\u91cf</li> <li>\u81ea\u65cb\u9501</li> <li>\u4fe1\u53f7\u91cf</li> <li>RCU</li> <li>...</li> </ul> </li> </ul> </li> <li> <p>\u8fdb\u7a0b\u8c03\u5ea6\uff1a\u8ba9 CPU \u5fd9\u8d77\u6765</p> <ul> <li> <p>\u89e3\u51b3\uff1a\uff08\u4ee5\u5168\u5c40\u8fdb\u7a0b\u961f\u5217\u4e3a\u4f8b\uff09</p> <ul> <li>\u5355\u6838 CPU \u4e00\u822c\u4f7f\u7528\u5168\u5c40\u8fdb\u7a0b\u961f\u5217\uff0c\u7cfb\u7edf\u6240\u6709\u8fdb\u7a0b\u90fd\u6302\u8f7d\u5230\u8fd9\u4e2a\u961f\u5217\u4e0a\uff0c\u8fdb\u7a0b\u8c03\u5ea6\u5668\u6bcf\u6b21\u4ece\u8be5\u961f\u5217\u4e2d\u83b7\u53d6\u8fdb\u7a0b\u8ba9 CPU \u6267\u884c\u3002</li> <li>\u591a\u6838\u4e0b\u5982\u679c\u4f7f\u7528\u5168\u5c40\u961f\u5217\u9700\u8981\u540c\u6b65\uff0c\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u6240\u4ee5\u591a\u6838\u4e0b\u4e00\u822c\u662f\u6bcf\u4e2a CPU \u6838\u5fc3\u4e00\u4e2a\u961f\u5217</li> </ul> <p></p> <p>\u8865\u5145\uff1a\u5173\u4e8e\u8c03\u5ea6</p> <ol> <li>Multi-level Feedback Queue: This scheduling algorithm uses multiple queues with different priorities. Processes move between these queues based on their behavior and resource requirements. It allows for both time-sharing and real-time processing.</li> <li>Round Robin Scheduling: In this method, each process is assigned a fixed time slice, and the scheduler rotates between processes in a circular queue. It ensures fairness in CPU allocation.</li> <li>Priority Scheduling: Processes are assigned priorities, and the scheduler selects the process with the highest priority for execution. Preemptive priority scheduling allows higher priority tasks to interrupt lower priority tasks.</li> <li>Shortest Job Next (SJN) Scheduling: Also known as Shortest Job First (SJF) scheduling, this algorithm selects the process with the shortest burst time next for execution. It minimizes the average waiting time for processes.</li> <li>Multi-Processor Scheduling: In systems with multiple processors, the scheduler must efficiently distribute processes among the available CPUs to maximize throughput and resource utilization.</li> <li>Deadline-Based Scheduling: Real-time operating systems often use this method to ensure that tasks meet their deadlines. Tasks are scheduled based on their deadlines to meet timing constraints.</li> <li>Fair Share Scheduling: This method ensures that each user or group gets a fair share of system resources. It is commonly used in multi-user systems to prevent any single user from monopolizing resources.</li> </ol> </li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_7","title":"\u603b\u7ed3","text":"<p>\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf\u7528\u4e8e\u523b\u753b\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u52a8\u6001\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u7528\u4e8e\u7ba1\u7406\u548c\u5206\u914d\u8d44\u6e90\u7684\u5355\u5143\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u5b9e\u4f53\u3002</p> <p>\u8fdb\u7a0b\u5177\u5907\u56db\u5927\u7279\u6027\u3002</p> <ul> <li>\u52a8\u6001\u7279\u6027\u3002\u8fdb\u7a0b\u7684\u672c\u8d28\u662f\u7a0b\u5e8f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u6b21\u6267\u884c\u8fc7\u7a0b\uff0c\u8fdb\u7a0b\u662f\u52a8\u6001\u5efa\u7acb\u3001\u52a8\u6001\u6d88\u4ea1\u7684\uff0c\u6709\u81ea\u5df1\u7684\u72b6\u6001\u548c\u751f\u547d\u5468\u671f\u3002</li> <li>\u5e76\u884c\u7279\u6027\u3002\u4efb\u4f55\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u540c\u5176\u4ed6\u8fdb\u7a0b\u4e00\u8d77\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5e76\u884c\u6267\u884c\uff0c\u5c3d\u7ba1\u5728\u5355 CPU \u4e0a\u662f\u4f2a\u5e76\u884c\u3002</li> <li>\u72ec\u7acb\u7279\u6027\u3002\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u548c\u7ba1\u7406\u8d44\u6e90\u7684\u72ec\u7acb\u5355\u5143\uff0c\u540c\u65f6\u8fdb\u7a0b\u4e5f\u662f\u4e00\u4e2a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u72ec\u7acb\u8c03\u5ea6\u548c\u6267\u884c\u7684\u57fa\u672c\u5b9e\u4f53\u3002</li> <li>\u5f02\u6b65\u7279\u6027\u3002\u7531\u4e8e\u8fdb\u7a0b\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u7684\u8d44\u6e90\u800c\u88ab\u5236\u7ea6\uff0c\u4f7f\u8fdb\u7a0b\u5177\u6709\u6267\u884c\u7684\u95f4\u65ad\u6027\uff0c\u5373\u8fdb\u7a0b\u4e4b\u95f4\u6309\u5404\u81ea\u72ec\u7acb\u7684\u3001\u4e0d\u53ef\u9884\u77e5\u7684\u901f\u5ea6\u5411\u524d\u63a8\u8fdb\u6267\u884c\u3002</li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_8","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u591a\u4e2a\u4e0d\u540c\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u76f8\u540c\u7684\u7a0b\u5e8f\u5417\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u4e0d\u540c\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u76f8\u540c\u7a0b\u5e8f\u7684\u7247\u6bb5\uff0c\u4f46\u80fd\u4e0d\u80fd\u5305\u542b\u76f8\u540c\u7a0b\u5e8f\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u7684\u652f\u6301\uff01 \u6bd4\u5982\u6709\u7684\u5b89\u5353\u624b\u673a\u53ef\u4ee5\u540c\u5f00\u4e24\u4e2a\u5fae\u4fe1\uff0c\u4f46ios\u53ea\u80fd\u4e00\u4e2a\uff01 \u5728\u7406\u8bba\u4e0a\uff0c\u4e0d\u540c\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u76f8\u540c\u7684\u7a0b\u5e8f\uff0c\u4f46\u5728\u73b0\u5b9e\u4e2d\u9700\u8981\u8f6f\u786c\u4ef6\u7684\u652f\u6301\uff01\uff08\u5305\u62ec\u8bbe\u5907\u95f4\u7684\u5207\u6362\u5229\u7528\uff09</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#7linuxipc","title":"7\uff5c\u5e94\u7528\u95f4\u901a\u4fe1\uff08\u4e00\uff09\uff1a\u8be6\u89e3Linux\u8fdb\u7a0bIPC","text":"<p>\u6211\u4eec\u4e86\u89e3\u8fdb\u7a0b\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\u3001\u9694\u79bb\u7684\uff0c\u8fd9\u79cd\u5b89\u6392\uff0c\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7edd\u5bf9\u4e0d\u53ef\u4ee5\u4e92\u76f8\u201c\u4fb5\u72af\u201d\u5404\u81ea\u7684\u9886\u5730\u3002</p> <p>\u4f46\u662f\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u6709\u65f6\u9700\u8981\u4e92\u76f8\u901a\u4fe1\uff0c\u4e92\u76f8\u534f\u4f5c\uff0c\u624d\u80fd\u5b8c\u6210\u76f8\u5173\u7684\u529f\u80fd\u3002</p> <p>\u8fd9\u5c31\u4e0d\u5f97\u4e0d\u7531\u64cd\u4f5c\u7cfb\u7edf\u4ecb\u5165\uff0c\u5b9e\u73b0\u4e00\u79cd\u901a\u4fe1\u673a\u5236\u3002\u5728\u8fd9\u79cd\u901a\u4fe1\u673a\u5236\u7684\u76d1\u7ba1\u4e4b\u4e0b\uff0c\u8ba9\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u5b9e\u73b0\u901a\u4fe1\u3002</p> <p>Linux \u5b9e\u73b0\u4e86\u8bf8\u5982\u7ba1\u9053\u3001\u4fe1\u53f7\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\uff0c \u5373Linux IPC \uff08\u5957\u63a5\u5b57\u6682\u65f6\u4e0d\u8bb2\uff09</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_9","title":"\u7ba1\u9053","text":"<p>\u4f60\u7684\u8f93\u51fa\u662f\u522b\u4eba\u7684\u8f93\u5165\uff0c\u901a\u8fc7\u4e00\u6761\u7ba1\u5b50\u76f8\u8fde\u3002\u53cc\u5411\u7684\uff1f</p> <p>Linux \u4e2d\u7ba1\u9053\u4f5c\u4e3a\u6700\u53e4\u8001\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u5b83\u80fd\u628a\u4e00\u4e2a\u8fdb\u7a0b\u4ea7\u751f\u7684\u6570\u636e\u8f93\u9001\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u8fd9\u91cc\u76f4\u63a5\u4e0a\u4ee3\u7801\uff1a</p> <pre><code>int main()\n{\n  pid_t pid;\n  int rets;\n  int fd[2];\n  char r_buf[1024] = {0};\n  char w_buf[1024] = {0};\n  // \u628a\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u5199\u5165w_buf\u6570\u7ec4\u4e2d\n  sprintf(w_buf, \"\u8fd9\u662f\u7236\u8fdb\u7a0b id = %d\\n\", getpid());\n  // \u5efa\u7acb\u7ba1\u9053\n  if(pipe(fd) &lt; 0)\n  {\n    perror(\"\u5efa\u7acb\u7ba1\u9053\u5931\u8d25\\n\");\n  }\n  // \u5efa\u7acb\u5b50\u8fdb\u7a0b\n  pid = fork();\n  if(pid &gt; 0)\n  {\n    // \u5199\u5165\u7ba1\u9053\n    write(fd[1], w_buf, strlen(w_buf));\n    // \u7b49\u5f85\u5b50\u8fdb\u7a0b\u9000\u51fa \n    wait(&amp;rets);\n  }\n  else if(pid == 0)\n  {  \n    // \u65b0\u8fdb\u7a0b\n    printf(\"\u8fd9\u662f\u5b50\u8fdb\u7a0b id = %d\\n\", getpid());\n    // \u8bfb\u53d6\u7ba1\u9053\n        read(fd[0], r_buf, strlen(w_buf));\n        printf(\"\u7ba1\u9053\u8f93\u51fa:%s\\n\", r_buf);\n  }\n  return 0;\n}\n</code></pre> <p>\u4e0a\u56fe\uff0c\u5b50\u8fdb\u7a0b\u901a\u8fc7\u7ba1\u9053\u83b7\u53d6\u4e86\u7236\u8fdb\u7a0b\u5199\u5165\u7684\u4fe1\u606f\u3002</p> <p>\u901a\u8fc7 pipe \u548c fork \u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5728\u7236\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u5efa\u7acb\u7ba1\u9053\u3002Why\uff1f</p> <p>\u628a\u7ba1\u9053\u60f3\u8c61\u6210\u4e00\u4e2a\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u7684\u3001\u5171\u4eab\u7684\u7279\u6b8a\u6587\u4ef6\uff0c\u5c31\u5f88\u597d\u7406\u89e3\u4e86\u3002\u4e0d\u8fc7\u4f60\u8981\u6ce8\u610f\uff0c\u8be5\u6587\u4ef6\u6709\u4e24\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4e00\u4e2a\u662f\u4e13\u7528\u4e8e\u8bfb\uff0c\u4e00\u4e2a\u4e13\u7528\u4e8e\u5199\u3002\u6211\u518d\u7ed9\u4f60\u753b\u4e00\u5e45\u56fe\u5e2e\u4f60\u68b3\u7406\u903b\u8f91\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li> <p>\u5206\u6790</p> <p>\u4e0a\u56fe\u4e2d pipe \u51fd\u6570\u4f1a\u4f7f Linux \u5728\u7236\u8fdb\u7a0b\u4e2d\u5efa\u7acb\u4e00\u4e2a\u6587\u4ef6\u548c\u4e24\u4e2a file \u7ed3\u6784\uff0c\u5206\u522b\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u3002</p> <p>\u8c03\u7528 fork \u4e4b\u540e\uff0c\u7531\u4e8e\u590d\u5236\u4e86\u7236\u8fdb\u7a0b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u5b50\u8fdb\u7a0b\u4e5f\u5177\u5907\u4e86\u8fd9\u4e24\u4e2a file \u7ed3\u6784\uff0c\u5e76\u4e14\u90fd\u6307\u5411\u540c\u4e00\u4e2a inode \u7ed3\u6784\u3002</p> <p>inode \u7ed3\u6784\u5728 Linux \u4e2d\u4ee3\u8868\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a inode \u4f1a\u5206\u914d\u4e00\u4e9b\u5185\u5b58\u9875\u9762\u6765\u7f13\u5b58\u6570\u636e\u3002</p> <p>\u4f46\u5bf9\u4e8e\u7ba1\u9053\u6587\u4ef6\u6765\u8bf4\uff0c\u8fd9\u4e9b\u9875\u9762\u4e2d\u7684\u6570\u636e\u4e0d\u4f1a\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7ba1\u9053\u662f\u7528\u6587\u4ef6\u53e5\u67c4\u7d22\u5f15\uff0c\u5e76\u4f7f\u7528\u6587\u4ef6\u8bfb\u5199\u51fd\u6570\u6765\u8bfb\u5199\u7ba1\u9053\uff0c\u56e0\u4e3a\u7ba1\u9053\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u5185\u5b58\u4e2d\u7684\u6587\u4ef6\u3002</p> </li> <li> <p>\u7ba1\u9053\u8bfb\u5199</p> <p>\u548c\u8bfb\u5199\u6587\u4ef6\u4e00\u6837\uff0c\u8bfb\u5199\u7ba1\u9053\u4e5f\u6709\u76f8\u5e94\u7684\u89c4\u5219\uff1a</p> <ul> <li>\u5f53\u7ba1\u9053\u4e2d\u6ca1\u6709\u6570\u636e\u53ef\u8bfb\u65f6\uff0c\u8fdb\u7a0b\u8c03\u7528 read \u65f6\u4f1a\u963b\u585e\uff0c\u5373\u8fdb\u7a0b\u6682\u505c\u6267\u884c\uff0c\u4e00\u76f4\u7b49\u5230\u7ba1\u9053\u6709\u6570\u636e\u5199\u5165\u4e3a\u6b62\u3002\uff08\u7c7b\u6bd4\u4e4b\u524d\u5b66\u8fc7\u7684 <code>FreeRTOS</code> \u7684\u961f\u5217\uff09</li> <li>\u5f53\u7ba1\u9053\u4e2d\u7684\u6570\u636e\u88ab\u5199\u6ee1\u7684\u65f6\u5019\uff0c\u8fdb\u7a0b\u8c03\u7528 write \u65f6\u963b\u585e\uff0c\u76f4\u5230\u6709\u5176\u5b83\u8fdb\u7a0b\u4ece\u7ba1\u9053\u4e2d\u8bfb\u8d70\u6570\u636e\u3002</li> </ul> <p>\u5982\u679c\u6240\u6709\u7ba1\u9053\u5199\u5165\u7aef\u5bf9\u5e94\u7684\u6587\u4ef6\u53e5\u67c4\u88ab\u5173\u95ed\uff0c\u5219\u8fdb\u7a0b\u8c03\u7528 read \u65f6\u5c06\u8fd4\u56de 0\uff1b\u5982\u679c\u6240\u6709\u7ba1\u9053\u7684\u8bfb\u53d6\u7aef\u5bf9\u5e94\u7684\u6587\u4ef6\u53e5\u67c4\u88ab\u5173\u95ed\uff0c\u5219\u4f1a\u8c03\u7528 write\uff0c\u4ece\u800c\u4ea7\u751f SIGPIPE \u4fe1\u53f7\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u8c03\u7528 write \u8fdb\u7a0b\u9000\u51fa\u3002</p> <p>\u4e0a\u8ff0\u89c4\u5219\u7531 Linux \u5185\u6838\u7ef4\u62a4\uff0c\u5e94\u7528\u5f00\u53d1\u4eba\u5458\u4e0d\u7528\u64cd\u5fc3\u3002\u5982\u679c\u8981\u5199\u5165\u7684\u6570\u636e\u91cf\u5c0f\u4e8e\u7ba1\u9053\u5185\u90e8\u7f13\u51b2\u65f6\uff0cLinux \u5185\u6838\u5c06\u4fdd\u8bc1\u8fd9\u6b21\u5199\u5165\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002\u4f46\u662f\u5f53\u8981\u5199\u5165\u7684\u6570\u636e\u91cf\u5927\u4e8e\u7ba1\u9053\u5185\u90e8\u7f13\u51b2\u65f6\uff0cLinux \u5185\u6838\u5c06\u4e0d\u518d\u4fdd\u8bc1\u6b64\u6b21\u5199\u5165\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u53ef\u80fd\u4f1a\u5206\u6279\u6b21\u5199\u5165\u3002</p> <p>\u8fd9\u4e9b\u8bfb\u5199\u89c4\u5219\uff0c\u90fd\u662f\u57fa\u4e8e\u7ba1\u9053\u8bfb\u5199\u7aef\u662f\u963b\u585e\u72b6\u6001\u4e0b\u7684\u60c5\u51b5\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528 <code>fcntl</code> \u8c03\u7528\uff0c\u628a\u7ba1\u9053\u7684\u8bfb\u5199\u7aef\u8bbe\u7f6e\u975e\u963b\u585e\u72b6\u6001\u3002\u8fd9\u6837\u8c03\u7528 write \u548c read \u4e0d\u6ee1\u8db3\u6761\u4ef6\u65f6\uff0c\u5c06\u76f4\u63a5\u8fd4\u56de\u76f8\u5e94\u7684\u9519\u8bef\u7801\uff0c\u800c\u4e0d\u662f\u963b\u585e\u8fdb\u7a0b\u3002</p> </li> </ul> <p>\u7ba1\u9053\u662f\u4e00\u79cd\u975e\u5e38\u7b80\u5355\u7684\u901a\u4fe1\u673a\u5236\uff0c\u7531\u4e8e\u6570\u636e\u5728\u5176\u4e2d\u50cf\u6c34\u4e00\u6837\uff0c\u4ece\u6c34\u7ba1\u7684\u4e00\u7aef\u6d41\u52a8\u5230\u53e6\u4e00\u7aef\uff0c\u6545\u800c\u5f97\u540d\u7ba1\u9053\u3002</p> <p>\u6ce8\u610f\uff0c\u7ba1\u9053\u53ea\u80fd\u4ece\u4e00\u7aef\u6d41\u5411\u53e6\u4e00\u7aef\uff0c\u4e0d\u80fd\u540c\u65f6\u5bf9\u6d41\u3002\uff08\u5355\u5411\u6027\uff09</p> <p>\u4e4b\u6240\u4ee5\u8bf4\u7ba1\u9053\u7b80\u5355\uff0c\u6b63\u662f\u56e0\u4e3a\u5b83\u662f\u4e00\u79cd\u57fa\u4e8e\u4e24\u4e2a\u8fdb\u7a0b\u95f4\u7684\u5171\u4eab\u5185\u5b58\u6587\u4ef6\u5b9e\u73b0\u7684\uff0c\u53ef\u4ee5\u7ee7\u627f\u6587\u4ef6\u64cd\u4f5c\u7684 api \u63a5\u53e3\uff0c\u8fd9\u4e5f\u7b26\u5408 Linux \u7cfb\u7edf\u4e00\u5207\u7686\u6587\u4ef6\u7684\u8bbe\u8ba1\u601d\u60f3\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_10","title":"\u4fe1\u53f7","text":"<p>Linux \u4fe1\u53f7\uff0c\u4e5f\u662f\u79cd\u53e4\u8001\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u7684\u4fe1\u53f7\u6211\u4eec\u4e0d\u80fd\u6309\u7167\u5b57\u9762\u610f\u601d\u6765\u7406\u89e3\u3002Linux \u4fe1\u53f7\u662f\u4e00\u79cd\u5f02\u6b65\u4e8b\u4ef6\u901a\u77e5\u673a\u5236\uff0c\u7c7b\u4f3c\u4e8e\u8ba1\u7b97\u673a\u5e95\u5c42\u7684\u786c\u4ef6\u4e2d\u65ad\u3002</p> <p>\u751f\u6d3b\u4f8b\u5b50\u7406\u89e3\uff1a\u95f9\u949f\uff0c\u95f9\u949f\u4f1a\u5728\u65e2\u5b9a\u7684\u65f6\u95f4\u63d0\u9192\u4f60\u201c\u8be5\u8d77\u5e8a\u5566\u201d\u3002\u95f9\u949f\u53d1\u51fa\u58f0\u97f3\uff0c\u7c7b\u4f3c\u4e8e\u4ea7\u751f\u4fe1\u53f7\uff0c\u4f60\u56e0\u4e3a\u95f9\u949f\u58f0\u97f3\u88ab\u53eb\u9192\uff0c\u7136\u540e\u5173\u6389\u95f9\u949f\u5e76\u8d77\u5e8a\uff0c\u5f00\u59cb\u4e00\u5929\u7684\u7f8e\u597d\u751f\u6d3b\uff0c\u8fd9\u5c31\u7c7b\u4f3c\u4e8e\u5904\u7406\u4fe1\u53f7\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u4fe1\u53f7\u662f Linux \u64cd\u4f5c\u7cfb\u7edf\u4e3a\u8fdb\u7a0b\u8bbe\u8ba1\u7684\u4e00\u79cd\u8f6f\u4ef6\u4e2d\u65ad\u673a\u5236\uff0c\u7528\u6765\u901a\u77e5\u8fdb\u7a0b\u53d1\u751f\u4e86\u5f02\u6b65\u4e8b\u4ef6\u3002</p> <p>\u4e8b\u4ef6\u6765\u6e90\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u4f7f\u5f97\u8fdb\u7a0b\u4e0e\u8fdb\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u53d1\u9001\u4fe1\u53f7\uff1b\u4e5f\u53ef\u4ee5\u662f Linux \u5185\u6838\u672c\u8eab\uff0c\u56e0\u4e3a\u67d0\u4e9b\u5185\u90e8\u4e8b\u4ef6\u800c\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff0c\u901a\u77e5\u8fdb\u7a0b\u53d1\u751f\u4e86\u67d0\u4e2a\u4e8b\u4ef6\u3002</p> <p>\u4ece\u8fdb\u7a0b\u6267\u884c\u7684\u884c\u4e3a\u6765\u8bf4\uff0c\u4fe1\u53f7\u80fd\u6253\u65ad\u8fdb\u7a0b\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4ee3\u7801\uff0c\u8f6c\u800c\u6267\u884c\u53e6\u4e00\u6bb5\u4ee3\u7801\u3002\u4fe1\u53f7\u6765\u4e34\u7684\u65f6\u95f4\u548c\u4fe1\u53f7\u4f1a\u4e0d\u4f1a\u6765\u4e34\uff0c\u5bf9\u4e8e\u8fdb\u7a0b\u800c\u8a00\u662f\u4e0d\u53ef\u9884\u77e5\u7684\uff0c\u8fd9\u8bf4\u660e\u4e86\u4fe1\u53f7\u7684\u5f02\u6b65\u7279\u6027\u3002</p> <p>\u7b80\u5355\u5b9e\u9a8c\uff1a\u7528\u5b9a\u65f6\u5668\u5728\u65e2\u5b9a\u7684\u65f6\u95f4\u70b9\u4ea7\u751f\u4fe1\u53f7\uff0c\u53d1\u9001\u7ed9\u5f53\u524d\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u4f7f\u8fdb\u7a0b\u7ed3\u675f\u8fd0\u884c\u3002</p> <pre><code>void handle_timer(int signum, siginfo_t *info, void *ucontext)\n{\n  printf(\"handle_timer \u4fe1\u53f7\u7801:%d\\n\", signum);\n  printf(\"\u8fdb\u7a0b:%d \u9000\u51fa!\\n\", getpid());\n  // \u6b63\u5e38\u9000\u51fa\u8fdb\u7a0b \n  exit(0);\n  return; \n}\nint main()\n{\n  struct sigaction sig;\n  // \u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u56de\u8c03\u51fd\u6570\n  sig.sa_sigaction = handle_timer;\n  sig.sa_flags = SA_SIGINFO;\n  // \u5b89\u88c5\u5b9a\u65f6\u5668\u4fe1\u53f7\n  sigaction(SIGALRM, &amp;sig, NULL);\n  // \u8bbe\u7f6e4\u79d2\u540e\u4ea7\u751f\u4fe1\u53f7SIGALRM\u4fe1\u53f7\n  alarm(4);\n  while(1)\n  {\n    ;// \u6b7b\u5faa\u73af\u9632\u6b62\u8fdb\u7a0b\u9000\u51fa\n  }\n  return 0;\n}\n</code></pre> <ol> <li>\u8bbe\u7f6e\u76f8\u5173\u4fe1\u53f7\uff1a\u9996\u5148main \u51fd\u6570\u4e2d\u901a\u8fc7 <code>sigaction</code> \u7ed3\u6784\u8bbe\u7f6e\u76f8\u5173\u4fe1\u53f7\uff0c\u4f8b\u5982\u4fe1\u53f7\u5904\u7406\u56de\u8c03\u51fd\u6570\u548c\u4e00\u4e2a\u4fe1\u53f7\u6807\u5fd7\u3002</li> <li>\u5b89\u88c5\u4fe1\u53f7\uff1a\u901a\u8fc7 <code>sigaction</code> \u51fd\u6570\u628a\u4fe1\u53f7\u4fe1\u606f\u4f20\u9012\u7ed9 Linux \u5185\u6838\uff0cLinux \u5185\u6838\u4f1a\u5728\u8fd9\u4e2a\u8fdb\u7a0b\u4e0a\uff0c\u6839\u636e\u4fe1\u53f7\u4fe1\u606f\u5b89\u88c5\u597d\u4fe1\u53f7\u3002</li> <li>\u4ea7\u751f\u4fe1\u53f7\uff1a<code>alarm</code> \u51fd\u6570\u4f1a\u8ba9 Linux \u5185\u6838\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5230\u4e86\u7279\u5b9a\u7684\u65f6\u95f4\u70b9\u540e\uff0c\u5185\u6838\u53d1\u73b0\u65f6\u95f4\u8fc7\u671f\u4e86\u5c31\u4f1a\u7ed9\u8fdb\u7a0b\u53d1\u51fa\u4e00\u4e2a SIGALRM \u4fe1\u53f7\uff0c\u7531 Linux \u5185\u6838\u67e5\u770b\u8be5\u8fdb\u7a0b\u662f\u5426\u5b89\u88c5\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u4ee5\u53ca\u662f\u5426\u5c4f\u853d\u4e86\u8be5\u4fe1\u53f7\u3002\u786e\u5b9a\u4e4b\u540e\uff0cLinux \u5185\u6838\u4f1a\u4fdd\u5b58\u8fdb\u7a0b\u5f53\u524d\u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u6784\u5efa\u4e00\u4e2a\u6267\u884c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u6808\u5e27\uff0c\u8ba9\u8fdb\u7a0b\u8fd4\u56de\u5230\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u8fd0\u884c\u3002</li> </ol> <p>\u5185\u6838\u4ea7\u751f SIGALRM \u4fe1\u53f7\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c handle_timer \u51fd\u6570\uff08\u7531\u5185\u6838\u5f02\u6b65\u8c03\u7528\uff09\u3002</p> <ol> <li> <p>\u5728 handle_timer \u51fd\u6570\u4e2d\u8f93\u51fa\u4e86\u4fe1\u53f7\u7801\uff0c\u7136\u540e\u5c31\u8c03\u7528 exit \u9000\u51fa\u8fdb\u7a0b\u4e86\u3002</p> <ul> <li> <p>\u4fe1\u53f7\u79cd\u7c7b</p> <p></p> <p></p> <p>\u4e0a\u9762\u90fd\u662f Linux \u7684\u6807\u51c6\u4fe1\u53f7\uff0c\u5b83\u4eec\u5927\u591a\u6570\u6765\u6e90\u4e8e\u952e\u76d8\u8f93\u5165\u3001\u786c\u4ef6\u6545\u969c\u3001\u7cfb\u7edf\u8c03\u7528\u3001\u5e94\u7528\u7a0b\u5e8f\u81ea\u8eab\u7684\u975e\u6cd5\u8fd0\u7b97\u3002\u4e00\u65e6\u4fe1\u53f7\u4ea7\u751f\u4e86\uff0c\u8fdb\u7a0b\u5c31\u4f1a\u6709\u4e09\u79cd\u9009\u62e9\uff1a\u5ffd\u7565\u3001\u6355\u6349\u3001\u6267\u884c\u9ed8\u8ba4\u64cd\u4f5c\u3002\u5176\u5b9e\u5927\u591a\u6570\u5e94\u7528\u5f00\u53d1\u8005\u90fd\u91c7\u7528\u5ffd\u7565\u4fe1\u53f7\u6216\u8005\u6267\u884c\u4fe1\u53f7\u9ed8\u8ba4\u52a8\u4f5c\uff0c\u8fd9\u662f\u4e00\u79cd\u201c\u4fe1\u53f7\u6765\u4e86\uff0c\u6211\u4e0d\u7ba1\u201d\u7684\u59ff\u6001\u3002</p> <p>\u4e00\u822c\u4fe1\u53f7\u7684\u9ed8\u8ba4\u52a8\u4f5c\u5c31\u662f\u5ffd\u7565\uff0c\u6709\u4e00\u4e9b\u4fe1\u53f7\u7684\u9ed8\u8ba4\u52a8\u4f5c\u53ef\u80fd\u662f\u7ec8\u6b62\u8fdb\u7a0b\u3001\u7ec8\u6b62\u8fdb\u7a0b\u5e76\u4fdd\u5b58\u5185\u5b58\u4fe1\u606f\u3001\u505c\u6b62\u8fdb\u7a0b\u3001\u6062\u590d\u8fdb\u7a0b\uff0c\u4f60\u53ef\u4ee5\u81ea\u5df1\u5bf9\u7167\u4e0a\u8868\uff0c\u770b\u770b\u5177\u4f53\u662f\u54ea\u4e9b\u4fe1\u53f7\u3002\u8fd8\u6709\u4e00\u4e9b\u4fe1\u53f7\uff0c\u6bd4\u5982 SIGKILL\u3001SIGSTOP\uff0c\u5b83\u662f\u4e0d\u80fd\u7531\u5e94\u7528\u81ea\u5df1\u6355\u6349\u5904\u7406\u7684\uff0c\u4e5f\u4e0d\u80fd\u88ab\u5ffd\u7565\uff0c\u53ea\u80fd\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u7684\u9ed8\u8ba4\u64cd\u4f5c\u3002\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u89c4\u5b9a\u5462\uff1f</p> <p>\u6211\u4eec\u60f3\u4e00\u60f3\uff0c\u5982\u679c SIGKILL\u3001SIGSTOP \u4fe1\u53f7\u80fd\u88ab\u6355\u6349\u548c\u5ffd\u7565\uff0c\u90a3\u4e48\u8d85\u7ea7\u7528\u6237\u548c\u7cfb\u7edf\u81ea\u5df1\u5c31\u6ca1\u6709\u53ef\u9760\u7684\u624b\u6bb5\u4f7f\u8fdb\u7a0b\u7ec8\u6b62\u6216\u505c\u6b62\u4e86\u3002</p> </li> </ul> </li> </ol> <p>\u90a3\u5177\u4f53\u600e\u4e48\u7ed9\u5176\u4ed6\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff1f\u5982\u4f55\u5728\u4fe1\u53f7\u4e2d\u4f20\u9001\u4fe1\u606f --&gt;</p> <pre><code>static pid_t subid;\n\nvoid handle_sigusr1(int signum, siginfo_t *info, void *ucontext)\n{\n  printf(\"handle_sigusr1 \u4fe1\u53f7\u7801:%d\\n\", signum);\n  //\u5224\u65ad\u662f\u5426\u6709\u6570\u636e\n  if (ucontext != NULL)\n  {\n    //\u4fdd\u5b58\u53d1\u9001\u8fc7\u6765\u7684\u4fe1\u606f\n    printf(\"\u4f20\u9012\u8fc7\u6765\u7684\u5b50\u8fdb\u7a0bID:%d\\n\", info-&gt;si_int);\n    printf(\"\u53d1\u9001\u4fe1\u53f7\u7684\u7236\u8fdb\u7a0bID:%d\\n\", info-&gt;si_pid);\n    // \u63a5\u6536\u6570\u636e\n    printf(\"\u5bf9\u6bd4\u4f20\u9012\u8fc7\u6765\u7684\u5b50\u8fdb\u7a0bID:%d == Getpid:%d\\n\", info-&gt;si_value.sival_int, getpid());\n  }\n  // \u9000\u51fa\u8fdb\u7a0b\n  exit(0);\n  return;\n}\n\nint subprocmain()\n{\n  struct sigaction sig;\n  // \u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\n  sig.sa_sigaction = handle_sigusr1;\n  sig.sa_flags = SA_SIGINFO;\n  // \u5b89\u88c5\u4fe1\u53f7\n  sigaction(SIGUSR1, &amp;sig, NULL);\n  // \u9632\u6b62\u5b50\u8fdb\u7a0b\u9000\u51fa\n  while (1)\n  {\n    pause(); // \u8fdb\u7a0b\u8f93\u5165\u7761\u7720\uff0c\u7b49\u5f85\u4efb\u4e00\u4fe1\u53f7\u5230\u6765\u5e76\u5524\u9192\u8fdb\u7a0b\n  }\n  return 0;\n}\n\nvoid handle_timer(int signum, siginfo_t *info, void *ucontext)\n{\n  printf(\"handle_timer \u4fe1\u53f7\u7801:%d\\n\", signum);\n  union sigval value;\n  // \u53d1\u9001\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u53d1\u9001\u6307\u9488\n  value.sival_int = subid; // \u5b50\u8fdb\u7a0b\u7684id\n  // \u8c03\u7528sigqueue\uff0c\u5411\u5b50\u8fdb\u7a0b\u53d1\u51faSIGUSR1\u4fe1\u53f7\n  sigqueue(value.sival_int, SIGUSR1, value);\n  return; \n}\n\nint main()\n{\n  pid_t pid;\n  // \u5efa\u7acb\u5b50\u8fdb\u7a0b\n  pid = fork();\n  if (pid &gt; 0)\n  {\n    // \u8bb0\u5f55\u65b0\u5efa\u5b50\u8fdb\u7a0b\u7684id\n    subid = pid;\n    struct sigaction sig;\n    // \u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\n    sig.sa_sigaction = handle_timer;\n    sig.sa_flags = SA_SIGINFO;\n    // \u5b89\u88c5\u4fe1\u53f7\n    sigaction(SIGALRM, &amp;sig, NULL);\n    alarm(4);// 4\u79d2\u540e\u53d1\u51faSIGALRM\u4fe1\u53f7\n    while (1)\n    {\n      pause(); // \u8fdb\u7a0b\u8f93\u5165\u7761\u7720\uff0c\u7b49\u5f85\u4efb\u4e00\u4fe1\u53f7\u5230\u6765\u5e76\u5524\u9192\u8fdb\u7a0b\n    }\n  }\n  else if (pid == 0)\n  {\n    // \u65b0\u8fdb\u7a0b\n    subprocmain();\n  }\n  return 0;\n}\n</code></pre> <p>\u9996\u5148\u6211\u4eec\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u8c03\u7528 fork \u5efa\u7acb\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u3002\u63a5\u7740\u5b50\u8fdb\u7a0b\u5f00\u59cb\u6267\u884c <code>subprocmain</code> \u51fd\u6570\uff0c\u5e76\u5728\u5176\u4e2d\u5b89\u88c5\u4e86 SIGUSR1 \u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8ba9\u5b50\u8fdb\u7a0b\u8fdb\u5165\u7761\u7720\u3002</p> <p>4 \u79d2\u949f\u540e\u4e3b\u8fdb\u7a0b\u4ea7\u751f\u4e86 SIGALRM \u4fe1\u53f7\uff0c\u5e76\u6267\u884c\u4e86\u5176\u5904\u7406\u51fd\u6570 handle_timer\uff0c\u5728\u8be5\u51fd\u6570\u4e2d\u8c03\u7528 <code>sigqueue</code> \u51fd\u6570\uff0c\u5411\u5b50\u8fdb\u7a0b\u53d1\u51fa SIGUSR1 \u4fe1\u53f7\uff0c\u540c\u65f6\u4f20\u9012\u4e86\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u6700\u540e\uff0c\u5b50\u8fdb\u7a0b\u6267\u884c handle_sigusr1 \u51fd\u6570\u5904\u7406\u4e86 SIGUSR1 \u4fe1\u53f7\uff0c\u6253\u5370\u76f8\u5e94\u4fe1\u606f\u540e\u9000\u51fa\u3002</p> <p>\u7b2c\u4e00\u4e2a SIGALRM \u4fe1\u53f7\u662f Linux \u5185\u6838\u4e2d\u7684\u5b9a\u65f6\u5668\u4ea7\u751f\uff1b\u800c\u7b2c\u4e8c\u4e2a SIGUSR1 \u4fe1\u53f7\u662f\u6211\u4eec\u8c03\u7528 <code>sigqueue</code> \u51fd\u6570\u624b\u52a8\u4ea7\u751f\u7684\u3002</p> <p><code>sigqueue</code> \u7684\u51fd\u6570\u539f\u578b\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>typedef union sigval {\n  int sival_int;\n  void *sival_ptr;\n} sigval_t;\n\n// pid \u53d1\u9001\u4fe1\u53f7\u7ed9\u54ea\u4e2a\u8fdb\u7a0b\uff0c\u5c31\u662f\u54ea\u4e2a\u8fdb\u7a0bid\n// sig \u53d1\u9001\u4fe1\u53f7\u7684\u4fe1\u53f7\u7801\n// \u9644\u52a0value\u503c\uff08\u6574\u6570\u6216\u6307\u9488\uff09\n// \u51fd\u6570\u6210\u529f\u8fd4\u56de0\uff0c\u5931\u8d25\u8fd4\u56de-1\nint sigqueue(pid_t pid, int sig, const union sigval value);\n</code></pre> <ul> <li> <p>\u603b\u7ed3</p> <p>\u4fe1\u53f7\u662f Linux \u5185\u6838\u57fa\u4e8e\u4e00\u4e9b\u7279\u5b9a\u7684\u4e8b\u4ef6\uff0c\u5e76\u4e14\u8fd9\u4e9b\u4e8b\u4ef6\u8981\u8ba9\u8fdb\u7a0b\u611f\u77e5\u5230\uff0c\u4ece\u800c\u5b9e\u73b0\u7684\u4e00\u79cd\u5185\u6838\u4e0e\u8fdb\u7a0b\u4e4b\u95f4\u3001\u8fdb\u7a0b\u4e0e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5f02\u6b65\u901a\u4fe1\u673a\u5236\u3002</p> <p>\u7406\u89e3\uff1a</p> <p>\u65e0\u8bba\u662f\u786c\u4ef6\u4e8b\u4ef6\u8fd8\u662f\u7cfb\u7edf\u8c03\u7528\u89e6\u53d1\u4fe1\u53f7\uff0c\u90fd\u4f1a\u6f14\u53d8\u6210\u8bbe\u7f6e\u8fdb\u7a0b\u6570\u636e\u7ed3\u6784 task_struct \u4e2d pending \u5bf9\u5e94\u7684\u4f4d\u3002</p> <p>\u8fd9\u5176\u4e2d\u6bcf\u4e2a\u4f4d\u5bf9\u5e94\u4e00\u4e2a\u4fe1\u53f7\uff0c\u8bbe\u7f6e\u4e86 pending \u4e2d\u7684\u4f4d\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u8981\u770b\u4e00\u770b\uff0cblocked \u4e2d\u5bf9\u5e94\u7684\u4f4d\u662f\u4e0d\u662f\u4e5f\u88ab\u8bbe\u7f6e\u4e86\uff1a</p> <ul> <li>\u5982\u679c blocked \u4e2d\u5bf9\u5e94\u7684\u4f4d\u4e5f\u88ab\u8bbe\u7f6e\u4e86\uff0c\u5c31\u4e0d\u80fd\u89e6\u53d1\u4fe1\u53f7\uff08\u8fd9\u662f\u7ed9\u4fe1\u53f7\u63d0\u4f9b\u4e00\u79cd\u963b\u585e\u7b56\u7565\uff0c\u5bf9\u4e8e\u6709\u4e9b\u4fe1\u53f7\u6ca1\u6709\u7528\uff0c\u5982 SIGKILL\u3001SIGSTOP \u7b49\uff09\uff1b</li> <li>\u5426\u5219\u5c31\u4f1a\u89e6\u53d1\u8be5\u4f4d\u5bf9\u5e94\u7684 action\uff0c\u6839\u636e\u5176\u4e2d\u7684\u6807\u5fd7\u4f4d\u67e5\u770b\u662f\u5426\u6355\u83b7\u4fe1\u53f7\uff0c\u8fdb\u800c\u8c03\u7528\u5176\u4e2d sa_handler \u5bf9\u5e94\u7684\u51fd\u6570\u3002</li> </ul> <p>\u90a3\u600e\u4e48\u5224\u65ad\u4fe1\u53f7\u6700\u7ec8\u662f\u4e0d\u662f\u62b5\u8fbe\u4e86\u5462\uff1f\u5176\u8868\u73b0\u4e3a\u5f02\u6b65\u8c03\u7528\u4e86\u8fdb\u7a0b\u67d0\u4e2a\u51fd\u6570\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_11","title":"\u603b\u7ed3","text":"<p>\u8fdb\u7a0b\u4e4b\u95f4\u8981\u534f\u4f5c\uff0c\u5c31\u8981\u6709\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0cLinux \u5b9e\u73b0\u4e86\u591a\u79cd\u901a\u4fe1\u673a\u5236\uff0c\u91cd\u70b9\u7814\u7a76\u7ba1\u9053\u548c\u4fe1\u53f7</p> <p>\u7ba1\u9053\u80fd\u8fde\u63a5\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6570\u636e\u4ece\u7ba1\u9053\u7684\u4e00\u7aef\u6d41\u5411\u7ba1\u9053\u53e6\u4e00\u7aef\u7684\u8fdb\u7a0b\u3002\u5982\u679c\u7ba1\u9053\u7a7a\u4e86\u5219\u8bfb\u8fdb\u7a0b\u4f11\u7720\uff0c\u7ba1\u9053\u6ee1\u4e86\u5219\u5199\u8fdb\u7a0b\u4f11\u7720\u3002\u8fd9\u4e9b\u540c\u6b65\u624b\u6bb5\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u5b8c\u6210\uff0c\u5bf9\u7528\u6237\u662f\u900f\u660e\u7684\u3002shell \u4e2d\u5e38\u4f7f\u7528\u201c|\u201d\u5728\u4e24\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u5efa\u7acb\u7ba1\u9053\uff0c\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u51fa\u6570\u636e\uff0c\u6210\u4e3a\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8f93\u5165\u6570\u636e\u3002\u9664\u4e86\u7ba1\u9053\uff0c\u4fe1\u53f7\u4e5f\u662f Linux \u4e0b\u7ecf\u5178\u7684\u901a\u4fe1\u65b9\u5f0f\u3002</p> <p>\u4fe1\u53f7\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u603b\u662f\u5f02\u6b65\u5730\u6253\u65ad\u8fdb\u7a0b\uff0c\u4f7f\u5f97\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u8f6c\u800c\u53bb\u5904\u7406\u4fe1\u53f7\u3002\u4fe1\u53f7\u6765\u6e90\u786c\u4ef6\u3001\u7cfb\u7edf\uff0c\u548c\u5176\u5b83\u8fdb\u7a0b\u3002\u53d1\u9001\u4fe1\u53f7\u65f6\uff0c\u4e5f\u80fd\u643a\u5e26\u4e00\u4e9b\u6570\u636e\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_12","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u8bf7\u6982\u8ff0\u4e00\u4e0b\u7ba1\u9053\u548c\u4fe1\u53f7\u8fd9\u4e24\u79cd\u901a\u4fe1\u673a\u5236\u7684\u4e0d\u540c\u3002</p> <p>\u7ba1\u9053\uff1a\u539f\u7406\u4e0a\u662f\u901a\u8fc7\u5171\u4eab\u6587\u4ef6\u6765\u5b9e\u73b0\u7684\uff0c\u4f18\u70b9\u662f\u80fd\u591f\u4f20\u8f93\u4efb\u610f\u4fe1\u606f\uff0c\u7f3a\u70b9\u662f\u53ea\u80fd\u5355\u5411\u4f20\u8f93\u3002</p> <p>\u4fe1\u53f7\uff1a\u539f\u7406\u4e0a\u662f\u901a\u8fc7\u4e2d\u65ad\u6765\u5b9e\u73b0\u7684\uff0c\u4f18\u70b9\u662f\u5f02\u6b65\u901a\u4fe1\u5e76\u4e14\u67d0\u4e9b\u4fe1\u53f7\u53ef\u4ee5\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7f3a\u70b9\u662f\u53ea\u80fd\u4f20\u9012\u56fa\u5b9a\u7684\u4fe1\u53f7</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#8-linuxipc","title":"8 \uff5c\u5e94\u7528\u95f4\u901a\u4fe1\uff08\u4e8c\uff09\uff1a\u8be6\u89e3Linux\u8fdb\u7a0bIPC","text":"<p>\u5728\u5927\u578b\u5546\u4e1a\u7cfb\u7edf\u4e2d\uff0c\u901a\u5e38\u4f1a\u628a\u529f\u80fd\u62c6\u5206\u6210\u51e0\u5927\u6a21\u5757\uff0c\u6a21\u5757\u4ee5\u5e94\u7528\u5f62\u5f0f\u5b58\u5728\uff0c\u5c31\u9700\u8981\u6d88\u606f\u961f\u5217\u548c\u5185\u5b58\u5171\u4eab\u6765\u4f7f\u6a21\u5757\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u548c\u534f\u4f5c\uff0c\u8fd9\u5c31\u662f\u5229\u7528\u901a\u4fe1\u673a\u5236\u5c06\u5e94\u7528\u89e3\u8026\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_13","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u6d88\u606f\u961f\u5217\u662f Linux \u63d0\u4f9b\u7684\u4e00\u79cd\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u6cd5\uff0c\u5b83\u80fd\u8ba9\u8fdb\u7a0b\u4e4b\u95f4\u4e92\u76f8\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u8fd9\u4e9b\u6d88\u606f\u7684\u5f62\u5f0f\u7531\u8fdb\u7a0b\u81ea\u5df1\u51b3\u5b9a\uff0c\u53ef\u4ee5\u662f\u6587\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u7684\uff0c\u683c\u5f0f\u53ef\u4ee5\u968f\u610f\uff0c\u53ea\u8981\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8ba4\u8bc6\u5c31\u884c\u3002</p> <ul> <li> <p>\u6982\u5ff5\uff1a</p> <p>\u4f60\u53ef\u4ee5\u628a\u6d88\u606f\u60f3\u8c61\u6210\u4e00\u4e2a\u6570\u636e\u8bb0\u5f55\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8bb0\u5f55\u5177\u6709\u7279\u5b9a\u7684\u683c\u5f0f\u4ee5\u53ca\u7279\u5b9a\u7684\u987a\u5e8f\u3002</p> <p>\u6d88\u606f\u961f\u5217\u5b9e\u8d28\u5c31\u662f\u4e00\u4e2a\u201c\u6536\u7eb3\u201d\u6d88\u606f\u7684\u94fe\u8868\uff0c\u6d88\u606f\u4f1a\u4f9d\u6b21\u6302\u5165\u8fd9\u4e2a\u53eb\u505a\u961f\u5217\u7684\u94fe\u8868\u4e2d\uff0c\u4e00\u4e2a\u94fe\u8868\u8282\u70b9\u5c31\u5bf9\u5e94\u7740\u4e00\u4e2a\u6d88\u606f\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\uff0c\u8c01\u6709\u6743\u64cd\u4f5c\u8fd9\u4e2a\u6d88\u606f\u961f\u5217\uff1f</p> <p>\u7b54\u6848\u662f\uff1a\u5bf9\u6d88\u606f\u961f\u5217\u6709\u5199\u6743\u9650\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5411\u5176\u4e2d\u63d2\u5165\u65b0\u7684\u6d88\u606f\u3001\u5bf9\u6d88\u606f\u961f\u5217\u6709\u8bfb\u6743\u9650\u7684\u8fdb\u7a0b\uff0c\u5219\u53ef\u4ee5\u4ece\u5176\u4e2d\u8bfb\u51fa\u6d88\u606f\u3002</p> <p></p> <p>Linux \u91c7\u7528\u6d88\u606f\u961f\u5217\u6765\u5b9e\u73b0\u6d88\u606f\u4f20\u9012\uff0c\u65b0\u7684\u6d88\u606f\u603b\u662f\u653e\u5728\u961f\u5217\u7684\u672b\u5c3e\uff0c\u4f46\u63a5\u6536\u7684\u65f6\u5019\u901a\u5e38\u662f\u4ece\u961f\u5217\u5934\u5f00\u59cb\uff0c\u4e5f\u53ef\u4ee5\u4ece\u4e2d\u95f4\u62bd\u53d6\u3002\uff08\u7c7bFIFO\uff09\uff08\u60f3\u8c61\u6210\u4f20\u9001\u5e26\uff09</p> <p>\u53e6\u5916\uff0c\u6d88\u606f\u961f\u5217\u53d1\u9001\u6d88\u606f\u7684\u65b9\u5f0f\u53ef\u4ee5\u662f\u540c\u6b65\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u5f02\u6b65\u7684\uff1a</p> <ul> <li>\u5728\u540c\u6b65\u65b9\u5f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53d1\u9001\u65b9\u5728\u6d88\u606f\u961f\u5217\u4e3a\u6ee1\u65f6\uff0c\u8981\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002\u63a5\u6536\u65b9\u5728\u6d88\u606f\u961f\u5217\u4e3a\u7a7a\u65f6\uff0c\u4e5f\u8981\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</li> <li>\u800c\u5f02\u6b65\u65b9\u5f0f\u4e2d\uff0c\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u90fd\u4e0d\u5fc5\u7b49\u5f85\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u3002</li> </ul> </li> <li> <p>\u6d88\u606f\u961f\u5217\u4f7f\u7528\u6b65\u9aa4\uff1a</p> <ol> <li>\u5efa\u7acb\u6d88\u606f\u961f\u5217</li> <li>\u53d1\u9001\u6d88\u606f</li> <li>\u63a5\u6536\u6d88\u606f\u3002</li> </ol> <p>\u5bf9\u5e94\u4e09\u4e2a\u63a5\u53e3\u51fd\u6570</p> <pre><code>//\u83b7\u53d6\u5df2\u7ecf\u5b58\u5728\u7684\u6d88\u606f\u961f\u5217\uff0c\u6216\u8005\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u6d88\u606f\u961f\u5217\n// __key\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\n// __msgflg\u662f\u5efa\u7acb\u6d88\u606f\u961f\u5217\u7684\u6807\u5fd7\u548c\u6743\u9650\n//\u8fd4\u56de-1 \u8868\u793a\u5931\u8d25\uff0c\u5176\u4ed6\u6b63\u6574\u6570\u4e3a\u6d88\u606f\u961f\u5217\u6807\u8bc6\uff0c\u50cf\u6587\u4ef6\u53e5\u67c4\u4e00\u6837\nint msgget (key_t __key, int __msgflg);\n\n//\u5411__msqid\u8868\u793a\u7684\u6d88\u606f\u961f\u5217\uff0c\u53d1\u9001\u4e00\u4e2a\u65b0\u7684\u6d88\u606f\n// __msqid\u8868\u793a\u6d88\u606f\u961f\u5217\n// __msgp\u8868\u793a\u6d88\u606f\u7ed3\u6784\n// __msgsz\u8868\u793a\u6d88\u606f\u5927\u5c0f\n// __msgflg\u540c\u6b65\u3001\u5f02\u6b65\u7b49\u6807\u5fd7\n//\u8fd4\u56de-1 \u8868\u793a\u5931\u8d25\uff0c\u5176\u4ed6\u8868\u793a\u53d1\u9001\u6210\u529f\nint msgsnd (int __msqid, const void *__msgp, size_t __msgsz, int __msgflg);\n\n//\u5728__msqid\u8868\u793a\u7684\u6d88\u606f\u961f\u5217\uff0c\u63a5\u6536\u6d88\u606f\n// __msqid\u8868\u793a\u6d88\u606f\u961f\u5217\n// __msgp\u8868\u793a\u6d88\u606f\u7ed3\u6784\uff0c\u7528\u4e8e\u63a5\u6536\u6d88\u606f\u5185\u5bb9\n// __msgsz\u8868\u793a\u63a5\u6536\u6d88\u606f\u5927\u5c0f\n// __msgtyp\u8868\u793a\u63a5\u6536\u6d88\u606f\u7c7b\u578b\n// __msgflg\u540c\u6b65\u3001\u5f02\u6b65\u7b49\u6807\u5fd7\n//\u8fd4\u56de-1 \u8868\u793a\u5931\u8d25\uff0c\u5176\u4ed6\u8868\u793a\u6210\u529f\u63a5\u6536\u6d88\u606f\u7684\u5927\u5c0f\nssize_t msgrcv (int __msqid, void *__msgp, size_t __msgsz, long int __msgtyp, int __msgflg);\n</code></pre> <p>Linux \u5185\u6838\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7f13\u5b58\u4e86\u6240\u6709\u7684\u6d88\u606f\u961f\u5217\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 <code>msgget</code> \u51fd\u6570\u80fd\u6253\u5f00\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u6d88\u606f\u961f\u5217\u3002</p> <p>\u53ea\u6709\u5728 Linux \u5185\u6838\u91cd\u542f\u6216\u8005\u663e\u793a\u5220\u9664\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u65f6\uff0c\u8fd9\u4e2a\u6d88\u606f\u961f\u5217\u624d\u4f1a\u771f\u6b63\u88ab\u5220\u9664\u3002</p> <p>\u8bb0\u5f55\u6d88\u606f\u961f\u5217\u7684\u6570\u636e\u7ed3\u6784\uff08<code>struct ipc_ids</code>\uff09\u4f4d\u4e8e Linux \u5185\u6838\u4e2d\uff0cLinux \u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u6d88\u606f\u961f\u5217\u90fd\u80fd\u5728\u8be5\u7ed3\u6784\u4e2d\u8bbf\u95ee\u3002\u5728\u6700\u65b0\u7248\u672c\uff082.6 \u4ee5\u4e0a\u7684\u7248\u672c\uff09\u7684 Linux \u4e2d\uff0c<code>pc_ids</code> \u5305\u542b\u5728 <code>ipc_namespace</code> \u7ed3\u6784\u4f53\u4e2d\uff0c\u800c\u4e14 Linux \u53c8\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>ipc_namespace</code>\u7ed3\u6784\u7684\u5168\u5c40\u53d8\u91cf <code>init_ipc_ns</code>\uff0c\u7528\u6765\u4fdd\u5b58 <code>ipc_namespace</code> \u7ed3\u6784\u7684\u5b9e\u4f8b\u3002\u8fd9\u91cc\u6211\u5c31\u4e0d\u518d\u5f80\u4e0b\u5c55\u5f00\u4e86\uff0c\u4f60\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u884c\u7814\u7a76\u3002</p> </li> <li> <p>\u5b9e\u6218\u7ec3\u4e60</p> <p>\u7528 Linux \u6d88\u606f\u961f\u5217\u673a\u5236\uff0c\u5efa\u7acb\u4e00\u4e2a\u201c\u81ea\u8bf4\u81ea\u8bdd\u201d\u7684\u804a\u5929\u8f6f\u4ef6\u3002</p> <ol> <li>\u9996\u5148\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u5efa\u7acb\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff1b</li> <li>\u7136\u540e\u5efa\u7acb\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5728\u5b50\u8fdb\u7a0b\u4e2d\u7b49\u5f85\u4e3b\u8fdb\u7a0b\u53d1\u8fc7\u6765\u7684\u6d88\u606f\uff0c\u5e76\u663e\u793a\u51fa\u6765\uff1b</li> <li>\u6700\u540e\uff0c\u4e3b\u8fdb\u7a0b\u7b49\u5f85\u7528\u6237\u8f93\u5165\u6d88\u606f\uff0c\u5e76\u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u6d88\u606f\u961f\u5217\u3002</li> </ol> <ol> <li> <p>\u9996\u5148\u5efa\u7acb\u6d88\u606f\u961f\u5217\u3002\u5177\u4f53\u5c31\u662f\u8c03\u7528 <code>msgget</code> \u51fd\u6570\uff0c\u8fd8\u8981\u63d0\u4f9b\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u7684\u952e\uff0c\u8fd9\u4e2a\u952e\u7528\u4e8e\u8868\u793a\u8be5\u6d88\u606f\u961f\u5217\u7684\u552f\u4e00\u540d\u5b57\u3002\u5f53\u8fd9\u4e2a\u952e\u5bf9\u5e94\u7684\u6d88\u606f\u961f\u5217\u5b58\u5728\u7684\u65f6\u5019\uff0c<code>msgget</code> \u51fd\u6570\u5c06\u8fd4\u56de\u8be5\u6d88\u606f\u961f\u5217\u7684\u6807\u8bc6\uff1b\u5982\u679c\u8fd9\u4e2a\u961f\u5217\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u7136\u540e\u8fd4\u56de\u8fd9\u4e2a\u6d88\u606f\u961f\u5217\u7684\u6807\u8bc6\u3002</p> <pre><code>//\u6d88\u606f\u7c7b\u578b\n#define MSG_TYPE (041375)\n//\u6d88\u606f\u961f\u5217\u952e\n#define MSG_KEY (752364)\n//\u6d88\u606f\u5927\u5c0f\n#define MSG_SIZE (256)\nint main()\n{\n  pid_t pid;\n  msgid = msgget(MSG_KEY, IPC_CREAT | 0666);\n  if (msgid &lt; 0)\n  {\n    perror(\"\u5efa\u7acb\u6d88\u606f\u961f\u5217\u51fa\u9519\\n\");\n  }\n  // \u5efa\u7acb\u5b50\u8fdb\u7a0b\n  pid = fork();\n  if (pid &gt; 0)\n  {\n      // \u8bb0\u5f55\u65b0\u5efa\u5b50\u8fdb\u7a0b\u7684ID\n      subid = pid;\n      send_main(msgid);\n  }\n  else if (pid == 0)\n  {\n      // \u65b0\u7684\u5b50\u8fdb\u7a0b\n      receive_main(msgid);\n  }\n  return 0;\n}\n</code></pre> <p>\u7ed3\u5408\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c<code>msgget</code> \u51fd\u6570\u7684 <code>__mflg</code> \u53c2\u6570\u662f <code>IPC_CREAT | 0666</code>\uff0c\u5176\u4e2d\u7684 IPC_CREAT \u8868\u793a\u6ca1\u6709 MSG_KEY \u5bf9\u5e94\u7684\u6d88\u606f\u961f\u5217\u5c31\u65b0\u5efa\u4e00\u4e2a\uff0c0666 \u5219\u8868\u793a\u8be5\u6d88\u606f\u961f\u5217\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u5373\u6240\u6709\u7528\u6237\u53ef\u8bfb\u5199\u3002</p> </li> <li> <p>\u6210\u529f\u5efa\u7acb\u6d88\u606f\u961f\u5217\u540e\uff0c\u5f00\u59cb\u8c03\u7528 fork \u51fd\u6570\u5efa\u7acb\u5b50\u8fdb\u7a0b\u3002</p> <p>\u5b50\u8fdb\u7a0b\u7684\u4efb\u52a1\uff1a</p> <pre><code>//\u6d88\u606f\u4f53\ntypedef struct Msg\n{\n  long type;\n  char body[MSG_SIZE];\n} msg_t;\n//\u5b50\u8fdb\u7a0b\u8fd0\u884c\u7684\u51fd\u6570 \u7528\u4e8e\u63a5\u6536\u6d88\u606f\nint receive_main(int mid)\n{\n  msg_t msg;\n  while (1)\n  {\n    ssize_t sz = msgrcv(mid, &amp;msg, MSG_SIZE, MSG_TYPE, MSG_NOERROR);\n    if (sz &lt; 0)\n    {\n      perror(\"\u83b7\u53d6\u6d88\u606f\u5931\u8d25\");\n    }\n    printf(\"\u65b0\u6d88\u606f:%s\\n\", msg.body);\n\n    //\u5224\u65ad\u662fexit\u5c31\u9000\u51fa\n    if (strncmp(\"exit\", msg.body, 4) == 0)\n    {\n      printf(\"\u7ed3\u675f\u804a\u5929\\n\");\n      exit(0);\n    }\n  }\n  return 0;\n}\n</code></pre> <p>\u5b50\u8fdb\u7a0b\u4e2d\uff0c\u5728\u4e00\u4e2a\u5faa\u73af\u91cc\u8c03\u7528\u4e86 <code>msgrcv</code> \u51fd\u6570\uff0c\u63a5\u6536 mid \u6807\u8bc6\u7684\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\uff0c\u5b58\u653e\u5728 msg \u7ed3\u6784\u4f53\u4e2d\uff0c\u6d88\u606f\u7684\u5927\u5c0f\u548c\u7c7b\u578b\u90fd\u4e0e\u53d1\u9001\u6d88\u606f\u4e00\u6837\uff0cMSG_NOERROR \u8868\u793a\u6d88\u606f\u592a\u5927\u4e5f\u4e0d\u4f1a\u51fa\u9519\u3002\u968f\u540e\u6253\u5370\u51fa\u6d88\u606f\u5185\u5bb9\uff0c\u5982\u679c\u662f exit \u7684\u6d88\u606f\u5185\u5bb9\uff0c\u5219\u7ed3\u675f\u5b50\u8fdb\u7a0b\u3002</p> </li> <li> <p>\u6709\u4e86\u63a5\u6536\u6d88\u606f\u7684\u4ee3\u7801\uff0c\u8fd8\u5f97\u6709\u53d1\u9001\u4ee3\u7801\u7684\u7a0b\u5e8f\uff1a</p> <pre><code>int send_main(int mid)\n{\n  msg_t msg;\n  while (1)\n  {\n        // \u8bbe\u7f6e\u6d88\u606f\u7c7b\u578b\n    msg.type = MSG_TYPE;\n        // \u83b7\u53d6\u7528\u6237\u8f93\u5165\u5e76\u653e\u5728\u6d88\u606f\u4f53\u4e2d\n    scanf(\"%[^\\n]%*c\", msg.body);\n        // \u53d1\u9001\u6d88\u606f\n    msgsnd(mid, &amp;msg, MSG_SIZE, 0);\n    //\u5224\u65ad\u662fexit\u5c31\u9000\u51fa\n    if (strncmp(\"exit\", msg.body, 4) == 0)\n    {\n      return 0;\n    }\n  }\n  return 0;\n}\n</code></pre> <p>\u5bf9\u7167\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u53d1\u9001\u4ee3\u7801\u7684\u5c31\u662f send_main \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u7531\u4e3b\u8fdb\u7a0b\u8c03\u7528\uff0c\u5b83\u4f1a\u5728\u4e00\u4e2a\u5faa\u73af\u4e2d\u8bbe\u7f6e\u6d88\u606f\u7c7b\u578b\u540e\uff0c\u83b7\u53d6\u7528\u6237\u8f93\u5165\u7684\u6d88\u606f\u5185\u5bb9\u5e76\u653e\u5165 msg \u6d88\u606f\u7ed3\u6784\u4f53\u4e2d\u3002\u7136\u540e\uff0c\u8c03\u7528 <code>msgsnd</code>\u51fd\u6570\u5411 mid \u6807\u8bc6\u7684\u6d88\u606f\u961f\u5217\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u606f\u6765\u81ea\u4e8e msg \u7ed3\u6784\u4f53\u53d8\u91cf\uff0c\u6307\u5b9a MSG_SIZE \u4e3a\u6d88\u606f\u5927\u5c0f\uff0c\u5e76\u4e14\u4ee5\u540c\u6b65\u65b9\u5f0f\u53d1\u9001\u6d88\u606f\u3002</p> </li> </ol> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_14","title":"\u5171\u4eab\u5185\u5b58","text":"<ul> <li> <p>\u6982\u5ff5</p> <p>\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5b9e\u5219\u662f\u8fdb\u7a0b\u95f4\u4f20\u8f93\u6570\u636e\uff0c\u4e3a\u4e86\u5b9e\u73b0\u66f4\u9ad8\u6548\u7387\u7684\u901a\u4fe1\uff0cLinux \u5b9e\u73b0\u4e86\u5171\u4eab\u5185\u5b58\u8fd9\u4e00\u673a\u5236\u3002</p> <p>\u5171\u4eab\u5185\u5b58\u662f\u628a\u540c\u4e00\u5757\u7269\u7406\u5185\u5b58\u6620\u5c04\u5230\u4e0d\u540c\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f53\u4e2d\uff0c\u4e0d\u540c\u8fdb\u7a0b\u76f4\u63a5\u901a\u8fc7\u4fee\u6539\u5404\u81ea\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f53\u4e2d\u7684\u5185\u5bb9\uff0c\u5373\u53ef\u901a\u4fe1\u3002</p> <p>\u5171\u4eab\u5185\u5b58\u51e0\u4e4e\u4e0d\u9700\u8981\u8fdb\u884c\u5185\u5b58\u6570\u636e\u62f7\u8d1d\u5c31\u80fd\u5b9e\u73b0\uff0c\u5373\u6570\u636e\u4ece\u8fdb\u7a0b A \u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u4e2d\u5199\u5165\u6570\u636e\uff0c\u7acb\u5373\u5c31\u80fd\u88ab\u8fdb\u7a0b B \u611f\u77e5\u3002</p> <p>\u5176\u5b83\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u9700\u8981\u7ecf\u8fc7 Linux \u5185\u6838\u8fd9\u79cd\u4e2d\u8f6c\u7ad9\u8fdb\u884c\u591a\u6b21\u7684\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c\u624d\u53ef\u4ee5\u3002</p> <p>\u56e0\u6b64\uff0c\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u901a\u4fe1\u6bd4\u8f83\u9ad8\u6548\u3002</p> <p>Linux \u5185\u6838\u63d0\u4f9b\u4e86\u4e24\u79cd\u5171\u4eab\u5185\u5b58\u7684\u5b9e\u73b0\uff0c\u4e00\u79cd\u662f\u57fa\u4e8e\u7269\u7406\u5185\u5b58\u6620\u5c04\uff0c\u53e6\u4e00\u79cd\u662f\u57fa\u4e8e <code>mmap</code> \u6587\u4ef6\u6620\u5c04\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u4eec\u4ec5\u4ec5\u8ba8\u8bba\u57fa\u4e8e\u7269\u7406\u5185\u5b58\u6620\u5c04\u7684\u5b9e\u73b0\uff0c\u5b83\u4e0e\u6d88\u606f\u961f\u5217\u5f88\u50cf\u3002</p> <p>Linux \u5185\u6838\u4f1a\u5efa\u7acb\u4e00\u4e2a <code>shmid_kernel</code> \u7ed3\u6784\uff0c\u901a\u8fc7 <code>ipc_namespace</code> \u7ed3\u6784\u7684\u5168\u5c40\u53d8\u91cf <code>init_ipc_ns</code> \u7ed3\u6784\uff0c\u5c31\u80fd\u627e\u5230\u7cfb\u7edf\u4e2d\u6240\u6709\u7684 <code>shmid_kernel</code> \u7ed3\u6784\u3002\u8be5 <code>shmid_kernel</code> \u7ed3\u6784\u4f1a\u5173\u8054\u5230\u4e00\u7ec4\u7269\u7406\u5185\u5b58\u9875\u9762\uff0c\u6700\u540e\u8fd9\u7ec4\u7269\u7406\u5185\u5b58\u9875\u9762\uff0c\u4f1a\u6620\u5c04\u5230\u5404\u81ea\u8fdb\u7a0b\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u4e2d\u7684\u76f8\u5173\u533a\u57df\u3002</p> <p></p> </li> <li> <p>\u4f7f\u7528\uff1a</p> <p>\u5177\u4f53\u6b65\u9aa4\uff1a\u5efa\u7acb\u5171\u4eab\u5185\u5b58\u533a ---&gt; \u7ed1\u5b9a\u8fdb\u7a0b\u5185\u5b58\u533a  \uff08\u63a5\u53e3\u51fd\u6570\uff09</p> <pre><code>//\u83b7\u53d6\u5df2\u7ecf\u5b58\u5728\u7684\u5171\u4eab\u5185\u5b58\uff0c\u6216\u8005\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u5171\u4eab\u5185\u5b58\n// __key\u662f\u4e00\u4e2a\u6574\u6570\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\n// __size\u662f\u5efa\u7acb\u5171\u4eab\u5185\u5b58\u7684\u5927\u5c0f\n// __shmflg\u662f\u5efa\u7acb\u5171\u4eab\u5185\u5b58\u7684\u6807\u5fd7\u548c\u6743\u9650\n//\u8fd4\u56de-1 \u8868\u793a\u5931\u8d25\uff0c\u5176\u4ed6\u6b63\u6574\u6570\u4e3a\u5171\u4eab\u5185\u5b58\u6807\u8bc6\uff0c\u50cf\u6587\u4ef6\u53e5\u67c4\u4e00\u6837\nint shmget (key_t __key, size_t __size, int __shmflg);\n// \u7ed1\u5b9a\u8fdb\u7a0b\u5185\u5b58\u5730\u5740\u5230__shmid\u7684\u5171\u4eab\u5185\u5b58\n// __shmid\u8868\u793a\u5efa\u7acb\u7684\u5171\u4eab\u5185\u5b58\n// __shmaddr\u7ed1\u5b9a\u7684\u5730\u5740\uff0c\u4f20NULL\u5219\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\n// __shmflg\u662f\u7ed1\u5b9a\u5730\u5740\u533a\u95f4\u7684\u8bfb\u5199\u6743\u9650\n// \u8fd4\u56de-1,\u8868\u793a\u5931\u8d25\uff0c\u5176\u5b83\u662f\u6210\u529f\u7ed1\u5b9a\u7684\u5730\u5740\nvoid *shmat (int __shmid, const void *__shmaddr, int __shmflg);\n// \u89e3\u9664\u7ed1\u5b9a\u5185\u5b58\u5730\u5740\n// __shmaddr\u4e3a\u4e4b\u524d\u7ed1\u5b9a\u7684\u5730\u5740\n// \u8fd4\u56de-1,\u8868\u793a\u5931\u8d25\nint shmdt (const void *__shmaddr);\n</code></pre> <p>\u8fdb\u4e00\u6b65\uff1a</p> <ol> <li> <p>\u4e3b\u8fdb\u7a0b\u4e2d\u5efa\u7acb\u5171\u4eab\u5185\u5b58\u3001\u521b\u5efa\u7236\u5b50\u8fdb\u7a0b\uff1a</p> <pre><code>#define SHM_KEY (752364)\n#define SHM_BODY_SIZE (4096-8)\n#define SHM_STATUS (SHM_BODY_SIZE)\ntypedef struct SHM\n{\n  long status;\n  char body[SHM_BODY_SIZE];\n} shm_t;\nint main()\n{\n  pid_t pid;\n    // \u5efa\u7acb\u5171\u4eab\u5185\u5b58\n  shmid = shmget(SHM_KEY, sizeof(shm_t), IPC_CREAT | 0666);\n  if (shmid &lt; 0)\n  {\n    perror(\"\u5efa\u7acb\u5171\u4eab\u5185\u5b58\u51fa\u9519\\n\");\n  }\n  // \u5efa\u7acb\u5b50\u8fdb\u7a0b\n  pid = fork();\n  if (pid &gt; 0)\n  {\n    // \u4e3b\u8fdb\u7a0b\n    send_main(shmid);\n  }\n  else if (pid == 0)\n  {\n    // \u65b0\u7684\u5b50\u8fdb\u7a0b\n    receive_main(shmid);\n  }\n  return 0;\n}\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u8c03\u7528\u4e86 <code>shmget</code> \u51fd\u6570\u4f20\u5165\u4e86 IPC_CREAT\uff0c\u8868\u793a\u6ca1\u6709 SHM_KEY \u5bf9\u5e94\u7684\u5171\u4eab\u5185\u5b58\uff0c\u5c31\u5efa\u7acb\u4e00\u5757\u5171\u4eab\u5185\u5b58\uff0c\u5927\u5c0f\u4e3a <code>shm</code> \u7ed3\u6784\u4f53\u7684\u5927\u5c0f\u3002</p> </li> <li> <p>\u7236\u8fdb\u7a0b\u5f00\u59cb\u6267\u884c send_main \u51fd\u6570\uff0c\u5b50\u8fdb\u7a0b\u8fd0\u884c receive_main \u51fd\u6570</p> <pre><code>int receive_main(int mid)\n{\n  // \u7ed1\u5b9a\u5171\u4eab\u5185\u5b58\n  int ok = 0;\n  shm_t* addr = shmat(mid, NULL, 0);\n  if ((long)addr &lt; 0)\n  {\n    perror(\"\u7ed1\u5b9a\u5171\u4eab\u5185\u5b58\u5931\u8d25\\n\");\n  }\n  printf(\"\u5b50\u8fdb\u7a0b\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u7684\u5730\u5740:%p\\n\", addr);\n  while (1)\n  {\n    if(addr-&gt;status == SHM_STATUS)\n    {\n      for (int i = 0; i &lt; SHM_BODY_SIZE; i++)\n      {\n        if (addr-&gt;body[i] != (char)0xff)\n        {\n          printf(\"\u68c0\u67e5\u5171\u4eab\u6570\u636e\u5931\u8d25:%x\\n\", addr-&gt;body[i]);\n        }\n        else\n        {\n          ok++;\n        }\n      }\n      printf(\"\u68c0\u67e5\u5171\u4eab\u6570\u636e\u6210\u529f:%d\\n\", ok);\n      return 0;\n    }\n    sleep(2);\n  }\n  return 0;\n}\n\nint send_main(int mid)\n{\n  // \u7ed1\u5b9a\u5171\u4eab\u5185\u5b58\n  shm_t* addr = shmat(mid, NULL, 0);\n  if ((long)addr &lt; 0)\n  {\n    perror(\"\u7ed1\u5b9a\u5171\u4eab\u5185\u5b58\u5931\u8d25\\n\");\n  }\n  printf(\"\u4e3b\u8fdb\u7a0b\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u7684\u5730\u5740:%p\\n\", addr);\n  memset(addr, 0xff, sizeof(shm_t));\n  // \u76f8\u5f53\u4e8e\u540c\u6b65\u901a\u77e5\u5b50\u8fdb\u7a0b\u6570\u636e\u5df2\u7ecf\u5199\u5165\n  addr-&gt;status = SHM_STATUS;\n  // \u7b49\u5f85\u5b50\u8fdb\u7a0b\u9000\u51fa\n  wait(NULL);\n  return 0;\n}\n</code></pre> <p>\u5bf9\u7167\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2a\u51fd\u6570\u90fd\u662f\u8c03\u7528 <code>shmat</code> \u51fd\u6570\uff0c\u5b83\u4eec\u4e3a\u5404\u81ea\u8fdb\u7a0b\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u865a\u62df\u5185\u5b58\u5730\u5740\uff0c\u5e76\u57fa\u4e8e\u8be5\u5730\u5740\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u3002\u5728 <code>send_main</code> \u51fd\u6570\u4e2d\uff0c\u5148\u628a\u5171\u4eab\u7684\u5185\u5b58\u5199\u5165 0xff\u3002\u6700\u540e\uff0c\u8bbe\u7f6e <code>status</code> \u5b57\u6bb5\u7528\u6765\u540c\u6b65\uff0c\u56e0\u4e3a Linux \u5bf9\u5171\u4eab\u4e0d\u63d0\u4f9b\u4efb\u4f55\u540c\u6b65\u673a\u5236\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u81ea\u5df1\u5904\u7406\u3002<code>receive_main</code> \u51fd\u6570\u4e2d\u4f1a\u5faa\u73af\u68c0\u67e5 <code>status</code> \u5b57\u6bb5\uff0c\u5982\u679c\u662f <code>SHM_STATUS</code>\uff0c\u5c31\u5bf9 <code>addr-&gt;body</code>\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u4e2a\u4e2a\u68c0\u67e5\uff0c\u5e76\u4e14\u8bb0\u5f55\u68c0\u67e5\u7ed3\u679c\u3002</p> </li> </ol> </li> <li> <p>\u603b\u7ed3\uff1a</p> <p>\u5171\u4eab\u5185\u5b58\uff1a\u901a\u8fc7\u628a\u7269\u7406\u5185\u5b58\u9875\u9762\u6620\u5c04\u5230\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u4e2d\uff0c\u4f7f\u5176\u8bbf\u95ee\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\uff0c\u6570\u636e\u4e0d\u9700\u8981\u5728\u5404\u8fdb\u7a0b\u4e4b\u95f4\u590d\u5236\uff0c\u8fd9\u662f\u4e00\u79cd\u6027\u80fd\u975e\u5e38\u9ad8\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html#_15","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u8fdb\u7a0b\u95f4\u901a\u4fe1\u54ea\u4e9b\u662f\u540c\u6b65\u7684\uff0c\u54ea\u4e9b\u662f\u5f02\u6b65\u7684\uff1f</p> <ol> <li>\u7ba1\u9053\uff08Pipe\uff09\uff1a<ul> <li>\u540c\u6b65\uff1a\u7ba1\u9053\u662f\u4e00\u79cd\u540c\u6b65\u901a\u4fe1\u65b9\u5f0f\uff0c\u53d1\u9001\u65b9\u53d1\u9001\u6570\u636e\u540e\u4f1a\u4e00\u76f4\u7b49\u5f85\u63a5\u6536\u65b9\u8bfb\u53d6\u6570\u636e\u3002</li> </ul> </li> <li>\u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\uff1a<ul> <li>\u540c\u6b65\u6216\u5f02\u6b65\uff1a\u6d88\u606f\u961f\u5217\u53ef\u4ee5\u662f\u540c\u6b65\u6216\u5f02\u6b65\u7684\uff0c\u53d6\u51b3\u4e8e\u53d1\u9001\u6d88\u606f\u65f6\u7684\u64cd\u4f5c\u3002\u5728\u540c\u6b65\u6a21\u5f0f\u4e0b\uff0c\u53d1\u9001\u65b9\u53d1\u9001\u6d88\u606f\u540e\u4f1a\u7b49\u5f85\u63a5\u6536\u65b9\u786e\u8ba4\uff1b\u5728\u5f02\u6b65\u6a21\u5f0f\u4e0b\uff0c\u53d1\u9001\u65b9\u53d1\u9001\u6d88\u606f\u540e\u4e0d\u4f1a\u7b49\u5f85\u63a5\u6536\u65b9\u786e\u8ba4\u3002</li> </ul> </li> <li>\u5171\u4eab\u5185\u5b58\uff08Shared Memory\uff09\uff1a<ul> <li>\u540c\u6b65\uff1a\u5171\u4eab\u5185\u5b58\u662f\u4e00\u79cd\u540c\u6b65\u901a\u4fe1\u65b9\u5f0f\uff0c\u56e0\u4e3a\u8bfb\u5199\u5171\u4eab\u5185\u5b58\u9700\u8981\u4f7f\u7528\u540c\u6b65\u673a\u5236\uff08\u5982\u4fe1\u53f7\u91cf\uff09\u6765\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002</li> </ul> </li> <li>\u4fe1\u53f7\u91cf\uff08Semaphore\uff09\uff1a<ul> <li>\u540c\u6b65\uff1a\u4fe1\u53f7\u91cf\u7528\u4e8e\u63a7\u5236\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c\u9700\u8981\u4f7f\u7528\u540c\u6b65\u673a\u5236\u6765\u786e\u4fdd\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u4e92\u65a5\u548c\u540c\u6b65\u3002</li> </ul> </li> <li>\u5957\u63a5\u5b57\uff08Socket\uff09\uff1a<ul> <li>\u540c\u6b65\u6216\u5f02\u6b65\uff1a\u5957\u63a5\u5b57\u901a\u4fe1\u53ef\u4ee5\u662f\u540c\u6b65\u6216\u5f02\u6b65\u7684\uff0c\u53d6\u51b3\u4e8e\u5957\u63a5\u5b57\u7684\u8bbe\u7f6e\u548c\u64cd\u4f5c\u3002\u5728\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u5957\u63a5\u5b57\u901a\u4fe1\u662f\u540c\u6b65\u7684\uff1b\u5728\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u5957\u63a5\u5b57\u901a\u4fe1\u662f\u5f02\u6b65\u7684\u3002</li> </ul> </li> </ol>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html","title":"4. IO\u4e0e\u6587\u4ef6","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#0","title":"0 | \u6982\u8ff0","text":"<p>\u6b64\u7b14\u8bb0\u4e3a\u81ea\u5df1\u5b66\u4e60<code>GeekTime</code>\u65f6\uff0c\u7c97\u7565\u7684\u6982\u62ec\u5185\u5bb9\uff0c\u53ea\u7528\u4f5c\u57fa\u7840\u5165\u95e8\uff0c\u672a\u6df1\u5165\u5b66\u4e60\u67d0\u4e00\u4e2a\u4e13\u9898\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6b64\u7b14\u8bb0\u5c3d\u91cf\u5c11\u6d89\u53ca\u4ee3\u7801\uff0c\u53ea\u505a\u7406\u8bba\u8865\u5145\u3002</p> <p>\u6bcf\u5199\u5b8c\u4e00\u7ae0\u77e5\u8bc6\u70b9\uff0c\u5c3d\u91cf\u914d\u5408Linux\u7cfb\u7edf\u7f16\u7a0b\u7684\u4ee3\u7801\u5199\u5199\u4ee3\u7801\uff0c\u7406\u89e3\u4ee3\u7801\u5b9e\u73b0\u3002</p> <p>\u6216\uff0c\u5feb\u901f\u8fc7\u5b8c\u6bcf\u4e00\u70b9\uff0c\u6709\u4e2a\u5927\u6982\uff0c\u518d\u5f00\u59cb\u6572\u4ee3\u7801\uff0c\u518d\u56de\u5934\u8fb9\u770b\u8fb9\u5199\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#1io-cacheio","title":"1\uff5c\u5916\u8bbe\u901a\u4fe1\uff1aIO Cache\u4e0eIO\u8c03\u5ea6","text":"<p>\u4e00\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\uff0c\u65e0\u8bba\u662f PC\uff0c\u8fd8\u662f\u624b\u673a\uff0c\u9664\u4e86\u6709 CPU \u548c RAM\uff0c\u8fd8\u6709\u5404\u79cd\u5916\u8bbe\uff0c\u5982\u952e\u9f20\u3001\u786c\u76d8\u3001\u663e\u5361\u3001\u4ee5\u592a\u7f51\u5361\u3001\u58f0\u5361\u7b49\u5404\u79cd USB \u6269\u5c55\u8bbe\u5907\u3002\u8fd9\u4e9b\u8bbe\u5907\u72ec\u7acb\u5728 CPU \u548c\u5185\u5b58\u4e4b\u5916\uff0c\u7edf\u79f0\u4e3a\u5916\u8bbe\u3002</p> <p>\u4f46\u662f\uff0c\u5916\u8bbe\u901a\u4fe1\u7684\u901f\u5ea6\u3001\u5927\u5c0f\u3001\u6570\u636e\u7c7b\u578b\u548c\u4f20\u8f93\u65b9\u5f0f\u5404\u4e0d\u76f8\u540c\uff0c\u6240\u4ee5\u4e3a\u4e86\u5b9e\u73b0\u7cfb\u7edf\u7684\u6574\u4f53\u6548\u7387\u6700\u5927\u5316\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u4e86 IO Cache \u548c IO \u8c03\u5ea6\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u7814\u7a76\u5b83\u4eec\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#io-cache","title":"IO Cache","text":"<p>\u987e\u540d\u601d\u4e49\uff0cCache \u5373\u4e3a\u7f13\u5b58\uff0cIO \u662f\u6307\u4ee4\u5916\u8bbe\u4f20\u8f93\uff08IN/OUT\uff09\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3 IO Cache\uff1a</p> <p>\u628a\u5916\u8bbe\u7684 IO \u64cd\u4f5c\u7684\u6570\u636e\u4fdd\u5b58\u8d77\u6765\uff0c\u5f53\u91cd\u65b0\u6267\u884c IO \u64cd\u4f5c\u65f6\uff0c\u5148\u4ece\u4e4b\u524d\u4fdd\u5b58\u7684\u5730\u65b9\u5f00\u59cb\u67e5\u627e\uff0c\u82e5\u627e\u5230\u9700\u8981\u7684\u6570\u636e\uff0c\u5373\u4e3a\u547d\u4e2d\uff0c\u8fd9\u65f6\u5c31\u4e0d\u8981\u53bb\u64cd\u4f5c\u5916\u8bbe\u4e86\uff1b\u82e5\u6ca1\u6709\u547d\u4e2d\u5c31\u53bb\u64cd\u4f5c\u5916\u8bbe\u3002</p> <p>\u5176\u4e2d\u7684\u6570\u636e\uff0c\u4f1a\u6839\u636e IO \u64cd\u4f5c\u9891\u7387\u8fdb\u884c\u7ec4\u7ec7\uff0c\u628a\u64cd\u4f5c\u6700\u9891\u7e41\u7684\u5185\u5bb9\u653e\u5728\u6700\u5bb9\u6613\u627e\u5230\u7684\u4f4d\u7f6e\uff0c\u8fbe\u5230\u6027\u80fd\u6700\u4f18\u5316\u3002\uff08\u65f6\u95f4\u5c40\u90e8\u6027\uff09</p> <pre><code>free -m\n</code></pre> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684 buff/cache\uff0c\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684 IO Cache \u5360\u7528\u7684\u5185\u5b58\u3002\u6240\u8c13 IO Cache\uff0c\u4e0d\u8fc7\u662f\u64cd\u4f5c\u7cfb\u7edf\u57fa\u4e8e\u67d0\u79cd\u7b97\u6cd5\u7ba1\u7406\u7684\u4e00\u5757==\u5185\u5b58==\u7a7a\u95f4\uff0c\u7528\u8be5\u5185\u5b58\u7a7a\u95f4\u7f13\u5b58 IO \u8bbe\u5907\u7684\u6570\u636e\uff0c\u5e94\u7528\u591a\u6b21\u8bfb\u5199\u5916\u8bbe\u6570\u636e\u4f1a\u66f4\u65b9\u4fbf\uff0c\u800c\u4e0d\u9700\u8981\u53cd\u590d\u53d1\u8d77 IO \u64cd\u4f5c\u3002</p> <p>\u5bc4\u5b58\u5668 &gt; \u786c\u4ef6Cache &gt; \u5185\u5b58\u8bbe\u5907 &gt; I/O\u8bbe\u5907 /\u786c\u76d8</p> <p>\u65e9\u671f\u7684 Cache \u662f\u4f4d\u4e8e CPU \u548c\u5185\u5b58\u4e4b\u95f4\u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u7531\u4e8e\u786c\u4ef6\u5b9e\u73b0\u7684 Cache \u82af\u7247\u7684\u901f\u5ea6\u4ec5\u6b21\u4e8e CPU\uff0c\u800c\u5185\u5b58\u901f\u5ea6\u8fdc\u5c0f\u4e8e CPU\uff0cCache \u53ea\u662f\u4e3a\u4e86\u7f13\u5b58\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u52a0\u5feb CPU \u7684\u6027\u80fd\uff0c\u907f\u514d CPU \u7b49\u5f85\u5185\u5b58\u3002</p> <p>\u800c Buffer \u662f\u5728\u5185\u5b58\u4e2d\u7531\u8f6f\u4ef6\u5b9e\u73b0\u7684\uff0c\u7528\u4e8e\u7f13\u5b58 IO \u8bbe\u5907\u7684\u6570\u636e\uff0c\u7f13\u89e3\u7531\u4e8e IO \u8bbe\u5907\u8fc7\u6162\u5e26\u6765\u7cfb\u7edf\u6027\u80fd\u4e0b\u964d\u3002</p> <p>\u4f46\u662f\u73b0\u5728 Buffer \u548c Cache \u6210\u4e86\u5728\u8ba1\u7b97\u673a\u6280\u672f\u4e2d\u88ab\u7528\u6ee5\u7684\u4e24\u4e2a\u540d\u8bcd\u3002</p> <p>\u5728 Linux \u7684\u5185\u5b58\u7ba1\u7406\u4e2d\uff0cBuffer \u6307 Linux \u5185\u5b58\u7684 Buffer Cache\uff0c\u800c Cache \u662f\u6307 Linux \u5185\u5b58\u4e2d\u7684 Page Cache\uff0c\u7ffb\u8bd1\u6210\u4e2d\u6587\u53ef\u4ee5\u53eb\u505a\u7f13\u51b2\u533a\u7f13\u5b58\u548c\u9875\u9762\u7f13\u5b58\uff0c\u7528\u6765\u7f13\u5b58 IO \u8bbe\u5907\u7684\u8bfb\u3001\u5199\u6570\u636e\u3002</p> <p>\u8865\u5145\u4e00\u53e5\uff0c\u8fd9\u91cc\u7684 IO \u8bbe\u5907\uff0c\u4e3b\u8981\u6307\u7684\u662f\u5757\u8bbe\u5907\u6587\u4ef6\u548c\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u666e\u901a\u6587\u4ef6\u3002</p> <p>\u5757\u8bbe\u5907\uff0c\u5b83\u662f\u6307\u6309\u7167\u56fa\u5b9a\u5927\u5c0f\uff08\u5757\u5927\u5c0f\uff09\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u7684\u8bbe\u5907\uff0c\u6bd4\u5982\u786c\u76d8\u3001SSD\u7b49\u5b58\u50a8\u8bbe\u5907\u3002\u5757\u8bbe\u5907\u4ee5\u5757\uff08block\uff09\u4e3a\u5355\u4f4d\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u5199\uff0c\u800c\u4e0d\u662f\u6309\u5b57\u8282\u6216\u4f4d\u8fdb\u884c\u64cd\u4f5c\u3002\u5757\u8bbe\u5907\u901a\u5e38\u7528\u4e8e\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u5982\u64cd\u4f5c\u7cfb\u7edf\u3001\u6587\u4ef6\u7cfb\u7edf\u7b49\u90fd\u4f1a\u4f7f\u7528\u5757\u8bbe\u5907\u6765\u5b58\u50a8\u6570\u636e\u3002</p> <p>\uff08\u9009\u770b\uff09</p> <p>Buffer Cache\u548cPage Cache\u662f\u4e24\u79cd\u4e0d\u540c\u7684==\u7f13\u5b58IO\u8bbe\u5907==\u7684\u673a\u5236\uff0c\u5b83\u4eec\u90fd\u7528\u4e8e\u7f13\u5b58IO\u8bbe\u5907\u7684\u6570\u636e\uff0c\u4f46\u5177\u4f53\u7684\u4f5c\u7528\u548c\u5b9e\u73b0\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\u3002\u518d\u8865\u5145\u4e00\u4e2aTLB\u3002</p> <ol> <li>Buffer Cache\uff08\u7f13\u51b2\u533a\u7f13\u5b58\uff09\uff1a<ul> <li>Buffer Cache\u662f\u7528\u6765\u7f13\u5b58\u5757\u8bbe\u5907\u7684\u6570\u636e\u7684\uff0c\u5757\u8bbe\u5907\u5305\u62ec\u786c\u76d8\u3001SSD\u7b49\u5b58\u50a8\u8bbe\u5907\u3002</li> <li>\u5f53\u6570\u636e\u9700\u8981\u4ece\u5757\u8bbe\u5907\u8bfb\u53d6\u5230\u5185\u5b58\u4e2d\u65f6\uff0c\u4f1a\u5148\u7ecf\u8fc7Buffer Cache\uff0c\u5982\u679c\u6570\u636e\u5728Buffer Cache\u4e2d\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u4eceBuffer Cache\u4e2d\u8bfb\u53d6\uff0c\u907f\u514d\u4e86\u9891\u7e41\u8bbf\u95ee\u5757\u8bbe\u5907\u7684\u5f00\u9500\u3002</li> <li>Buffer Cache\u662f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u662f\u4e00\u79cd\u8f6f\u4ef6\u5b9e\u73b0\u7684\u7f13\u5b58\u673a\u5236\uff0c\u7528\u6765\u63d0\u9ad8IO\u8bbe\u5907\u7684\u8bfb\u5199\u6027\u80fd\u3002</li> </ul> </li> <li> <p>Page Cache\uff08\u9875\u9762\u7f13\u5b58\uff09\uff1a</p> <ul> <li> <p>Page Cache\u7528\u4e8e\u7f13\u5b58\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u666e\u901a\u6587\u4ef6\u7684\u6570\u636e\uff0c\u5305\u62ec\u5e38\u89c1\u7684\u6587\u672c\u6587\u4ef6\u3001\u56fe\u7247\u7b49\u3002</p> </li> <li> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bbf\u95ee\u6587\u4ef6\u65f6\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u4f1a\u88ab\u7f13\u5b58\u5728Page Cache\u4e2d\uff0c\u4e0b\u6b21\u518d\u6b21\u8bbf\u95ee\u76f8\u540c\u6587\u4ef6\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ecePage Cache\u4e2d\u8bfb\u53d6\uff0c\u800c\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u53bb\u78c1\u76d8\u4e0a\u8bfb\u53d6\u6587\u4ef6\u3002</p> </li> <li> <p>Page Cache\u4e5f\u662f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u662f\u4e00\u79cd\u8f6f\u4ef6\u5b9e\u73b0\u7684\u7f13\u5b58\u673a\u5236\uff0c\u7528\u6765\u63d0\u9ad8\u6587\u4ef6\u7cfb\u7edf\u7684\u8bfb\u5199\u6027\u80fd\u3002</p> </li> <li>TLB\uff08Translation Lookaside Buffer\uff09\u662f\u7528\u4e8e\u52a0\u901f\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u8f6c\u6362\u7684\u786c\u4ef6\u7f13\u5b58\uff0c\u4f4d\u4e8eCPU\u548c\u5185\u5b58\u4e4b\u95f4\uff0c\u7528\u6765\u7f13\u5b58\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u3002TLB\u4e3b\u8981\u662f\u4e3a\u4e86\u52a0\u901f\u5730\u5740\u8f6c\u6362\u8fc7\u7a0b\uff0c\u800c\u4e0d\u662f\u7528\u6765\u7f13\u5b58IO\u8bbe\u5907\u7684\u6570\u636e\u3002</li> </ul> </li> </ol> <p>\u603b\u7ed3\uff1a</p> <p>\u867d\u7136Buffer Cache\u548cPage Cache\u90fd\u88ab\u79f0\u4e3aCache\uff0c\u4f46\u5b83\u4eec\u5b9e\u9645\u4e0a\u8fd8\u662f\u5728\u5185\u5b58\u5c42\u9762\u64cd\u4f5c\u7684\uff0c\u90fd\u662f\u8f6f\u4ef6\u5c42\u9762\u5b9e\u73b0\u7684\u7f13\u5b58\u673a\u5236\u6765\u63d0\u5347\u6027\u80fd\u3002\u800c\u4e0d\u662f\u76f4\u63a5\u901a\u8fc7\u786c\u4ef6Cache\u3002\u4e24\u79cdCache\u80fd\u63d0\u5347\u90a3\u6027\u80fd\u7684\u539f\u56e0\uff1a</p> <ol> <li> <p>\u51cf\u5c11IO\u8bbf\u95ee\u6b21\u6570\uff1a\u901a\u8fc7\u5728\u5185\u5b58\u4e2d\u7f13\u5b58IO\u8bbe\u5907\u7684\u6570\u636e\uff0c\u5f53\u9700\u8981\u8bfb\u53d6\u6216\u5199\u5165\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u9996\u5148\u5c1d\u8bd5\u4eceCache\u4e2d\u83b7\u53d6\uff0c\u907f\u514d\u4e86\u9891\u7e41\u5730\u8bbf\u95ee\u6162\u901f\u7684IO\u8bbe\u5907\uff0c\u4ece\u800c\u51cf\u5c11\u4e86IO\u8bbf\u95ee\u6b21\u6570\uff0c\u63d0\u9ad8\u4e86\u6570\u636e\u8bbf\u95ee\u7684\u6548\u7387\u3002</p> </li> <li> <p>\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u65f6\u95f4\uff1a\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u8fdc\u5feb\u4e8eIO\u8bbe\u5907\uff0c\u901a\u8fc7\u4f7f\u7528Cache\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u6570\u636e\uff0c\u53ef\u4ee5\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u7684\u65f6\u95f4\uff0c\u52a0\u5feb\u6570\u636e\u7684\u8bfb\u53d6\u548c\u5199\u5165\u901f\u5ea6\u3002</p> </li> <li> <p>\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u7684\u5c40\u90e8\u6027\uff1aCache\u53ef\u4ee5\u5229\u7528\u5c40\u90e8\u6027\u539f\u7406\uff0c\u5c06\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u63d0\u9ad8\u4e86\u6570\u636e\u8bbf\u95ee\u7684\u5c40\u90e8\u6027\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u4e86\u8bbf\u95ee\u6548\u7387\u3002</p> </li> </ol> <p>\u5b9e\u9645\u7684Cache\uff08\u6bd4\u5982CPU\u7684Cache\uff09\u4e5f\u662f\u901a\u8fc7\u7c7b\u4f3c\u7684\u539f\u7406\u6765\u63d0\u9ad8\u6027\u80fd\u7684\uff0c\u901a\u8fc7\u5728\u9ad8\u901f\u7f13\u5b58\u4e2d\u7f13\u5b58\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u51cf\u5c11\u5bf9\u4e3b\u5b58\u6216\u5176\u4ed6\u6162\u901f\u5b58\u50a8\u8bbe\u5907\u7684\u8bbf\u95ee\uff0c\u4ece\u800c\u63d0\u9ad8\u6570\u636e\u8bbf\u95ee\u7684\u901f\u5ea6\u3002</p> <p>\u5728\u5f53\u524d\u7684 Linux \u5185\u6838\u4e2d\uff0cBuffer Cache \u5efa\u7acb Page Cache \u4e4b\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u73b0\u4ee3 Linux \u7684\u5b9e\u73b0\u4e2d\uff0c\u8fdc\u6bd4\u4e0a\u56fe\u753b\u5f97\u8981\u590d\u6742\u5f97\u591a\uff0c\u4e0d\u8fc7\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8\u8fd9\u4e2a\u5c42\u6b21\u7ed3\u6784\u5c31\u884c\u4e86\u3002</p> <p>Buffer Cache \u4e2d\u6709\u591a\u4e2a\u5c0f\u5757\u7ec4\u6210\uff0c\u5757\u5927\u5c0f\u901a\u5e38\u4e3a 512 \u5b57\u8282\uff0c\u5728 Linux \u5185\u6838\u4e2d\u7528\u4e00\u4e2a <code>struct Bio</code> \u7ed3\u6784\u6765\u63cf\u8ff0\u5757\uff0c\u800c\u4e00\u4e2a\u7269\u7406\u5185\u5b58\u9875\u4e2d\u5b58\u5728\u591a\u4e2a\u5757\uff0c\u591a\u4e2a <code>struct Bio</code> \u7ed3\u6784\u5f62\u6210 Buffer Cache\uff0c\u591a\u4e2a\u8fd9\u79cd\u9875\u5c31\u5f62\u6210\u4e86 Page Cache\u3002</p> <p>\u53cd\u8fc7\u6765\u770b\uff0c\u5757\u66f4\u52a0\u63a5\u8fd1\u5185\u5b58\u3002</p> <p>\u5757\u9897\u7c92\u5ea6\u66f4\u5c0f ---&gt; \u5f88\u591a\u4e2a\u5757\u5305\u6210\u4e00\u4e2a\u9875 ---&gt; \u5f88\u591a\u4e2a\u9875\u5305\u6210\u5185\u5b58</p> <p>\u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u6bd4\u8f83\u5c0f\uff0c\u66f4\u9002\u5408\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7f13\u5b58\u548c\u7ba1\u7406\u3002</p> <p>\u800c\u9875\u5219\u662f\u5185\u5b58\u7ba1\u7406\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u901a\u5e38\u7528\u4e8e\u7ba1\u7406\u5185\u5b58\u4e2d\u7684\u6570\u636e\u548c\u4ea4\u6362\u3002</p> <p>\u5728\u64cd\u4f5c\u7cfb\u7edf\u7406\u8bba\u4e2d\uff0c\u8fd9\u4e00\u5957\u5b9e\u73b0\u673a\u5236\u88ab\u62bd\u8c61\u4e3a IO Cache\u3002</p> <p>\u5404\u79cd\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8ff0\u7684\u5b9e\u73b0\u7684\u53eb\u6cd5\u4e0d\u540c\uff0c\u5728\u6b64\u4e0d\u5fc5\u5c55\u5f00\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u660e\u767d\u5b83\u4eec\u80fd\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u8bbe\u5907\u6570\u636e\u5c31\u884c\u4e86\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cLinux \u5185\u6838\u4e2d\u7684 IO \u64cd\u4f5c\uff0c\u4f1a\u4ece\u4e0a\u81f3\u4e0b\u7ecf\u8fc7\u4e09\u5927\u903b\u8f91\u5c42\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ol> <li>\u6587\u4ef6\u7cfb\u7edf\u5c42\u3002\u56e0\u4e3a Linux \u4e2d\u4e07\u7269\u7686\u4e3a\u6587\u4ef6\uff0cIO \u64cd\u4f5c\u9996\u5148\u4f1a\u7ecf\u8fc7\u6587\u4ef6\u7cfb\u7edf\uff0cLinux \u4e3a\u4e86\u517c\u5bb9\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5bf9\u6587\u4ef6\u3001\u76ee\u5f55\u7b49\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61\u8fdb\u884c\u4e86\u62bd\u8c61\uff0c\u5f62\u6210\u4e86 VFS \u5c42\uff0c\u4e5f\u662f IO \u64cd\u4f5c\u7ecf\u5386\u7684\u7b2c\u4e00\u5c42\u3002</li> <li>\u5757\u5c42\u3002Linux \u5185\u6838\u628a\u5404\u79cd\u8bbe\u5907\u5206\u6210\u5757\u8bbe\u5907\uff0c\u5b57\u7b26\u8bbe\u5907\u3001\u7f51\u7edc\u8bbe\u5907\u548c\u786c\u76d8\u90fd\u5c5e\u4e8e\u5757\u8bbe\u5907\uff0c\u5757\u5c42\u4e3b\u8981\u8d1f\u8d23\u7ba1\u7406\u5757\u8bbe\u5907\u7684 IO \u961f\u5217\uff0c\u5bf9 IO \u8bf7\u6c42\u8fdb\u884c\u5408\u5e76\u3001\u6392\u5e8f\u7b49\u64cd\u4f5c\u3002</li> <li>\u8bbe\u5907\u5c42\u3002\u5177\u4f53\u8bbe\u5907\u9a71\u52a8\u901a\u8fc7 DMA \u4e0e\u5185\u5b58\u4ea4\u4e92\uff0c\u5b8c\u6210\u6570\u636e\u548c\u5177\u4f53\u8bbe\u5907\u4e4b\u95f4\u7684\u4ea4\u6362\uff0c\u6b64\u4f8b\u5b50\u4e2d\u7684\u8bbe\u5907\u4e3a\u786c\u76d8\u3002</li> </ol> <p></p> <p>IO \u64cd\u4f5c\u5728\u5230\u8fbe Linux \u7684 VFS \u5c42\u540e\uff0c\u4f1a\u6839\u636e\u76f8\u5e94\u7684 IO \u64cd\u4f5c\u6807\u5fd7\u786e\u5b9a\u662f <code>DirectIO</code> \u8fd8\u662f <code>BufferedIO</code>\u3002</p> <p>\u5982\u679c\u662f<code>DirectIO</code>\uff1a\u5219\u4e0d\u7ecf\u8fc7 Cache\uff0c\u76f4\u63a5\u7531\u5757\u5c42\u53d1\u9001\u5230\u8bbe\u5907\u5c42\uff0c\u5b8c\u6210 IO \u64cd\u4f5c\uff1b</p> <p>\u5982\u679c\u662f<code>BufferIO</code>\uff1a\u5219 IO \u64cd\u4f5c\u5230\u8fbe Page Cache \u4e4b\u540e\u5c31\u8fd4\u56de\u4e86\u3002</p> <p>\u5728\u67d0\u4e00\u65f6\u523b\uff0cLinux \u4f1a\u542f\u52a8 <code>pdflush</code> \u7ebf\u7a0b\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u626b\u63cf <code>PageCache</code>\u4e2d\u7684\u810f\u9875\uff0c\u8fdb\u800c\u627e\u5230\u5bf9\u5e94\u7684 Bio \u7ed3\u6784\uff0c\u7136\u540e\u628a Bio \u7ed3\u6784\u53d1\u9001\u7ed9\u5757\u5c42\u7684 IO \u8c03\u5ea6\u5668\uff0c\u8c03\u5ea6\u5668\u4f1a\u5bf9 bio \u8fdb\u884c\u5408\u5e76\u3001\u6392\u5e8f\uff0c\u4ee5\u63d0\u9ad8 IO \u6548\u7387\u3002</p> <p>\u4e4b\u540e\uff0c\u8c03\u7528\u8bbe\u5907\u5c42\u7684\u76f8\u5173\u51fd\u6570\u5c06 Bio \u8f6c\u53d1\u5230\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u5904\u7406\uff0c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u51fd\u6570\u5bf9 IO \u8bf7\u6c42\u961f\u5217\u4e2d\u6bcf\u4e2a Bio \u8fdb\u884c\u5206\u522b\u5904\u7406\uff0c\u6839\u636e Bio \u4e2d\u7684\u4fe1\u606f\u5411\u78c1\u76d8\u63a7\u5236\u5668\u53d1\u9001\u547d\u4ee4\u3002</p> <p>\u5904\u7406\u5b8c\u6210\u540e\uff0c\u8c03\u7528 Bio \u5b8c\u6210\u51fd\u6570\u4ee5\u901a\u77e5\u4e0a\u5c42\u5b8c\u6210\u4e86\u64cd\u4f5c\u3002</p> <p>\u8fd9\u4fbf\u662f\u4e00\u4e2a IO \u64cd\u4f5c\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#io","title":"IO\u8c03\u5ea6","text":"<ul> <li> <p>IO\u8c03\u5ea6\u5668</p> <p>\u5728\u524d\u9762\uff0c\u6211\u4eec\u5df2\u7ecf\u660e\u767d\u4e86 IO Cache \u7684\u6982\u5ff5\uff0c\u5b83\u672c\u8d28\u662f\u628a IO \u64cd\u4f5c\u7684\u6570\u636e\uff0c\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4f7f\u5f97\u5728\u8bfb\u53d6\u5916\u8bbe\u6570\u636e\u65f6\u80fd\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\uff0c\u6216\u8005\u6570\u636e\u7f13\u5b58\u5230\u4e00\u5b9a\u91cf\u65f6\uff0c\u7531\u4e00\u4e2a\u7279\u5b9a\u4efb\u52a1\u5728\u4ee5\u540e\u7684\u67d0\u4e2a\u65f6\u95f4\u6279\u91cf\u5730\u5199\u5165\u5916\u8bbe\uff0c\u8fd9\u4e0d\u4f46\u4f1a\u63d0\u9ad8\u7cfb\u7edf\u6574\u4f53\u541e\u5410\u91cf\uff0c\u8fd8\u80fd\u4fdd\u62a4\u8bbe\u5907\u4ee5\u5ef6\u957f\u5bff\u547d\u3002</p> <p>\u6211\u4eec\u628a IO \u64cd\u4f5c\u7f13\u5b58\u8d77\u6765\u4e86\uff0c\u8fd9\u6837\u64cd\u4f5c\u7cfb\u7edf\u5c31\u5bf9 IO \u64cd\u4f5c\u6709\u4e86\u63a7\u5236\u6743\uff0c\u5177\u4f53\u70b9\u8bf4\u5c31\u662f\u53ef\u4ee5\u5bf9 IO \u64cd\u4f5c\u8fdb\u884c\u8c03\u5ea6\u3002</p> <p>\u6211\u5148\u4e0d\u76f4\u63a5\u8bf4\u660e IO \u8c03\u5ea6\u662f\u5e72\u4ec0\u4e48\u7684\uff0c\u5148\u7ed3\u5408\u4f8b\u5b50\u5e26\u4f60\u4e00\u8d77\u5206\u6790\u770b\u770b\u3002</p> <ol> <li> <p>\u6211\u4eec\u4ece\u8f6f\u4ef6\u5c42\u9762\u6765\u770b\u4e00\u4e2a\u573a\u666f\uff1a\u5047\u5982\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5f80\u786c\u76d8\u4e2d\u5199\u5165 1GB \u5927\u5c0f\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5f88\u8c03\u76ae\uff0c\u5b83\u6bcf\u6b21\u53ea\u5199\u5165\u4e00\u4e2a\u5b57\u8282\u3002\u5982\u679c\u6ca1\u6709 IO Cache \u548c IO \u8c03\u5ea6\uff0c\u53ef\u4ee5\u60f3\u89c1\uff0c\u8fd9\u9700\u8981\u53d1\u751f\u591a\u5c11\u6b21 IO \u64cd\u4f5c\u624d\u80fd\u5b8c\u6210\uff0c\u5982\u679c\u786c\u4ef6\u80fd\u8bf4\u8bdd\uff0c\u4f30\u8ba1\u8981\u9a82\u4eba\u3002</p> </li> <li> <p>\u518d\u6765\u8bf4\u8bf4\u786c\u4ef6\u81ea\u5df1\u7ed3\u6784\u7684\u95ee\u9898\uff0c\u8fd9\u91cc\u4ee5\u673a\u68b0\u786c\u76d8\u4e3a\u4e3b\u3002\u5343\u4e07\u4e0d\u8981\u611f\u89c9\u673a\u68b0\u786c\u76d8\u5df2\u7ecf\u6dd8\u6c70\u4e86\uff0c\u5176\u5b9e\u5728\u5f88\u591a\u670d\u52a1\u5668\u4e0a\u4ecd\u7136\u5927\u91cf\u4f7f\u7528\u5b83\u3002\u786c\u76d8\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a</p> <p>\u4e00\u4e2a\u786c\u76d8\u4e2d\u6709\u591a\u4e2a\u76d8\u7247\uff0c\u4e00\u4e2a\u76d8\u7247\u4e0a\u6709\u591a\u4e2a\u540c\u5fc3\u5706\u7ec4\u6210\u7684\u591a\u6761\u78c1\u9053\uff0c\u6bcf\u6761\u78c1\u9053\u4e0a\u6709\u591a\u4e2a\u6247\u533a\uff0c\u4e00\u4e2a\u6247\u533a 512 \u5b57\u8282\uff0c\u78c1\u5934\u6765\u56de\u79fb\u52a8\u7ecf\u8fc7\u591a\u4e2a\u540c\u5fc3\u5706\u5f62\u6210\u7684\u67f1\u9762\u5b9a\u4f4d\u5230\u4e00\u4e2a\u6247\u533a\u3002\u5f88\u663e\u7136\uff0c\u627e\u5230\u4e00\u4e2a\u6247\u533a\u82b1\u8d39\u7684\u65f6\u95f4\u7b49\u4e8e\u78c1\u5934\u79fb\u52a8\u65f6\u95f4\u52a0\u4e0a\u76d8\u7247\u65cb\u8f6c\u7684\u65f6\u95f4\u3002\u8fd9\u4e9b\u8fd0\u52a8\u90fd\u662f\u673a\u68b0\u8fd0\u52a8\uff0c\u662f\u975e\u5e38\u7f13\u6162\u7684\u3002</p> </li> </ol> <p>\u4ee5\u4e0a\u4e24\u4e2a\u573a\u666f\uff0c\u63d0\u9192\u6211\u4eec\u6709\u4e24\u4e2a\u95ee\u9898\u9700\u8981\u8003\u8651\uff0c\u4e00\u662f\u600e\u4e48\u964d\u4f4e IO \u64cd\u4f5c\u6b21\u6570\uff0c\u4e8c\u662f\u5982\u4f55\u4f18\u5316\u786c\u76d8\u5bfb\u5740\u3002</p> <p>\u60f3\u89e3\u51b3\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9 IO \u64cd\u4f5c\u8fdb\u884c\u7f13\u5b58\u548c\u5408\u5e76\uff1b</p> <p>\u800c\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9 IO \u64cd\u4f5c\u8fdb\u884c\u6392\u5e8f\uff0c\u80fd\u8ba9\u786c\u76d8\u78c1\u5934\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u5b9a\u4f4d\u6247\u533a</p> <p>\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u7684\u5c31\u662f IO \u8c03\u5ea6\u5668\u3002</p> </li> <li> <p>\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u6709\u4e86 IO \u8c03\u5ea6\u5668\uff0c\u8fd8\u5f97\u6709\u76f8\u5e94\u7684\u8c03\u5ea6\u7b97\u6cd5\u3002</p> <p>IO \u8c03\u5ea6\u5668\u63d0\u4f9b\u4e86\u591a\u79cd\u8c03\u5ea6\u7b97\u6cd5\u6765\u9002\u5e94\u4e0d\u540c\u7684 IO \u8bf7\u6c42\u573a\u666f\u3002</p> <p>\u6709\u7684\u573a\u666f\u9700\u8981\u7684\u662f\u63d0\u9ad8 IO \u541e\u5410\u91cf\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u540e\u53f0\u7684\u50a8\u5b58\u5f15\u64ce\uff1b\u6709\u7684\u573a\u666f\u5219\u662f\u8981\u964d\u4f4e IO \u54cd\u5e94\u65f6\u95f4\uff0c\u6bd4\u5982\u6e38\u620f\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u4e09\u79cd\u79cd\u8c03\u5ea6\u7b97\u6cd5\uff1a</p> <ul> <li> <p><code>Noop</code> \u7b97\u6cd5\u3002</p> <p><code>Noop</code> \u662f\u6700\u7b80\u5355\u7684 IO \u8c03\u5ea6\u7b97\u6cd5\uff0c\u5176\u5b9e\u53ef\u4ee5\u8bf4\u5b83\u662f\u6ca1\u6709\u201c\u8c03\u5ea6\u201d\u7684 IO \u8c03\u5ea6\uff0c\u56e0\u4e3a <code>Noop</code> \u4f1a\u628a\u6240\u6709\u7684 IO \u8bf7\u6c42\uff0c\u51e0\u4e4e\u6309\u7167\u5148\u6765\u540e\u5230\u7684\u987a\u5e8f\u653e\u5165\u5148\u8fdb\u5148\u51fa\u961f\u5217\u4e4b\u4e2d\u3002</p> <p>\u4e4b\u6240\u4ee5\u8bf4\u201c\u51e0\u4e4e\u201d\uff0c\u662f\u56e0\u4e3a <code>Noop</code> \u5728\u5148\u8fdb\u5148\u51fa\u961f\u5217\u7684\u57fa\u7840\u4e0a\uff0c\u8fd8\u505a\u4e86\u76f8\u90bb IO \u64cd\u4f5c\u7684\u5408\u5e76\uff0c\u800c\u4e0d\u662f\u5b8c\u5b8c\u5168\u5168\u6309\u7167\u5148\u8fdb\u5148\u51fa\u7684\u89c4\u5219\u6ee1\u8db3 IO \u64cd\u4f5c\u3002</p> <p>\u4e00\u4e2a\u4e2a Bio \u7ed3\u6784\u8fdb\u5165 <code>Noop IO</code> \u8c03\u5ea6\u5668\uff0c\u4ea7\u751f <code>request</code> \u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4e2d\u5305\u542b Bio \u94fe\u8868\u3002</p> <p><code>Noop IO</code> \u8c03\u5ea6\u5668\u628a\u6247\u533a\u76f8\u90bb\u7684 Bio \u5408\u5e76\u5728\u4e00\u8d77\u5f62\u6210 <code>request</code> \u7ed3\u6784\uff0c\u7136\u540e\u5c06 <code>requset</code> \u7ed3\u6784\u6302\u8f7d\u5230\u5757\u8bbe\u5907\u7684 <code>requset_queue</code> \u4e2d\uff0c\u5757\u8bbe\u5907\u901a\u5e38\u662f\u4f60\u7684\u786c\u76d8\u3002</p> </li> <li> <p>CFQ (Completely Fair Queuing) \u7b97\u6cd5</p> <p>\u7531\u4e8e\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u4e0a\uff0c\u786c\u76d8\u5bfb\u5740\u82b1\u53bb\u4e86\u7edd\u5927\u591a\u6570\u7684 IO \u64cd\u4f5c\u7684\u65f6\u95f4\uff0c\u6240\u4ee5\u8981\u4f18\u5316\u786c\u76d8\u5bfb\u5740\u6240\u82b1\u7684\u65f6\u95f4\u3002</p> <p>CFQ \u8c03\u5ea6\u5668\u7684\u51fa\u53d1\u70b9\u5c31\u662f\u5bf9 IO \u64cd\u4f5c\u6247\u533a\u5730\u5740\u8fdb\u884c\u6392\u5e8f\uff0c\u6bd4\u5982\u786c\u76d8\u65cb\u8f6c\u5230 1 \u53f7\u6247\u533a\uff0c\u5f88\u5feb\u5c31\u65cb\u8f6c\u5230 2 \u53f7\u6247\u533a\uff0c\u5982\u679c\u4f60\u5148\u8bbf\u95ee 2 \u53f7\u6247\u533a\u518d\u6b21\u8bbf\u95ee 1 \u53f7\u6247\u533a\uff0c\u5219\u8981\u7b49\u5230\u786c\u76d8\u65cb\u8f6c\u4e00\u5468\u540e\uff0c\u624d\u80fd\u5230\u8fbe 1 \u53f7\u6247\u533a\u3002</p> <p>CFQ \u8c03\u5ea6\u5668\u5bf9\u5176\u8fdb\u884c\u6392\u5e8f\u540e\uff0c\u5c31\u80fd\u901a\u8fc7\u5c3d\u91cf\u5c11\u7684\u786c\u76d8\u65cb\u8f6c\u6b21\u6570\uff0c\u6765\u6ee1\u8db3\u5c3d\u53ef\u80fd\u591a\u7684 IO \u64cd\u4f5c\u3002CFQ \u8c03\u5ea6\u5668\u7b97\u6cd5\u6267\u884c\u903b\u8f91\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u770b\u5230\u5728 CFQ \u8c03\u5ea6\u5668\u4e0b\uff0c\u5c06\u591a\u4e2a BIO \u7ed3\u6784\u751f\u6210 <code>requset</code> \u7ed3\u6784\u65f6\uff0c\u4f1a\u6309\u7167\u6247\u533a\u5730\u5740\u5347\u5e8f\u6302\u8f7d\u5230\u5757\u8bbe\u5907\u7684 <code>requset_queue</code> \u4e2d\uff0c\u8fd9\u4f1a\u4f7f\u673a\u68b0\u786c\u76d8\u7684\u541e\u5410\u91cf\u5927\u5927\u63d0\u9ad8\u3002</p> <p>\u4e5f\u6709\u95ee\u9898\uff1a</p> <p>\u76f8\u6bd4 <code>Noop</code> \u8c03\u5ea6\u5668\uff0c\u4e0d\u77e5\u9053\u4f60\u6709\u6ca1\u6709\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\uff1a\u5148\u6765\u7684 IO \u64cd\u4f5c\u5e76\u4e0d\u4e00\u5b9a\u80fd\u88ab\u6ee1\u8db3\uff0c\u8fd8\u53ef\u80fd\u4f1a\u51fa\u73b0\u997f\u6b7b\u7684\u60c5\u51b5\u3002\u6bd4\u5982\uff0c\u5148\u6765\u4e00\u4e2a IO \u64cd\u4f5c\u6247\u533a\u5730\u5740\u662f 1000\uff0c\u7136\u540e\u4e0d\u505c\u5730\u8fdb\u5165\u6247\u533a\u5730\u5740\u5c0f\u4e8e 1000 \u7684 IO \u64cd\u4f5c\uff0c\u5c31\u4f1a\u51fa\u73b0\u997f\u6b7b\u73b0\u8c61\u3002</p> </li> <li> <p><code>Deadline</code> \u7b97\u6cd5</p> <p>Deadline \u8c03\u5ea6\u5668\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7ea2\u9ed1\u6811\u4ee5\u53ca\u4e24\u4e2a\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u4e24\u4e2a\u7ea2\u9ed1\u6811\u5206\u522b\u5bf9\u8bfb\u3001\u5199\u7684 IO \u64cd\u4f5c\u6309\u7167\u5176\u6247\u533a\u5730\u5740\u6392\u5e8f\uff0c\u540c\u65f6\u7ed9\u6bcf\u4e2a IO \u64cd\u4f5c\u6dfb\u52a0\u8d85\u65f6\u65f6\u95f4\uff0c\u5e76\u63d2\u5165\u5230\u5bf9\u5e94\u7684\uff08\u8bfb\u3001\u5199\uff09\u5148\u8fdb\u5148\u51fa\u7684\u961f\u5217\u5c3e\u90e8\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u4e00\u4e2a IO \u64cd\u4f5c\u4f1a\u540c\u65f6\u6302\u5728\u7ea2\u9ed1\u6811\u548c\u5148\u8fdb\u5148\u51fa\u961f\u5217\u4e2d\u3002</p> <p>\u5f53 Deadline \u8c03\u5ea6\u5668\u5728\u53d1\u9001\u4e00\u4e2a IO \u64cd\u4f5c\u65f6\uff0c\u4f1a\u7efc\u5408\u8003\u8651 IO \u64cd\u4f5c\u662f\u5426\u8d85\u65f6\u3001\u662f\u5426\u9965\u997f\uff0c\u7531\u6b64\u51b3\u5b9a\u5230\u5e95\u53d1\u9001\u54ea\u4e2a IO \u64cd\u4f5c\uff0c\u53d1\u9001 IO \u64cd\u4f5c\u4e4b\u540e\u4f1a\u5c06\u8be5 IO \u64cd\u4f5c\u540c\u65f6\u5728\u7ea2\u9ed1\u6811\u548c\u5148\u8fdb\u5148\u51fa\u961f\u5217\u4e2d\u5220\u9664\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u8bfb\u5199\u961f\u5217\u5206\u5f00\uff0c\u540c\u65f6\u7528\u7ea2\u9ed1\u6811\u5bf9\u5176\u6392\u5e8f\uff0c\u800c\u4e14\u8fd8\u52a0\u5165\u4e86\u8d85\u65f6\u673a\u5236\u3002</p> <p>\u786c\u76d8\u9a71\u52a8\u4f1a\u627e Deadline IO \u8c03\u5ea6\u5668\u83b7\u53d6 IO request\uff0cDeadline IO \u8c03\u5ea6\u5668\u6839\u636e\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\u5206\u914d request\uff0c\u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86 CFQ IO \u8c03\u5ea6\u5668\u7684\u7f3a\u9677\uff0c\u7531\u4e8e\u8bfb\u5199\u5206\u5f00\u4e14\u8bfb\u4f18\u5148\u4e8e\u5199\uff0c\u5bfc\u81f4\u8be5\u7b97\u6cd5\u975e\u5e38\u9002\u5408\u6570\u636e\u5e93\u8fd9\u79cd\u968f\u673a\u8bfb\u5199\u7684\u573a\u666f\u3002</p> </li> </ul> <p>IO \u8c03\u5ea6\u5668\u7b97\u6cd5\u591a\u79cd\u591a\u6837\uff0c\u90a3\u4e48\u8981\u600e\u4e48\u9009\u62e9\u5462\uff1f\u5176\u5b9e\u9009\u62e9 IO \u8c03\u5ea6\u5668\u7b97\u6cd5\uff0c\u65e2\u8981\u8003\u8651\u786c\u4ef6\u7279\u6027\uff0c\u4e5f\u8981\u8003\u8651\u5e94\u7528\u7a0b\u5e8f\u573a\u666f\u3002</p> <p>\u5728\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u4e0a\uff0cCFQ\u3001Deadline \u7b97\u6cd5\u662f\u4e0d\u9519\u7684\u9009\u62e9\uff1b\u5bf9\u4e8e\u4e13\u5c5e\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\uff0cDeadline IO \u8c03\u5ea6\u5668\u7684 IO \u541e\u5410\u91cf\u548c IO \u54cd\u5e94\u65f6\u95f4\u7efc\u5408\u6027\u80fd\u90fd\u8868\u73b0\u975e\u5e38\u597d\u3002</p> <p>\u7136\u800c\u5728\u65b0\u5174\u7684\u56fa\u6001\u786c\u76d8\uff0c\u6bd4\u5982 SSD\u3001<code>NVMe</code> \u4e0a\uff0c\u6700\u7b80\u5355\u7684 NOOP IO \u8c03\u5ea6\u5668\u53cd\u800c\u662f\u6700\u597d\u7684 IO \u8c03\u5ea6\u5668\u3002</p> <p>\u56e0\u4e3a CFQ \u548c Deadline \u8c03\u5ea6\u7b97\u6cd5\uff0c\u6700\u4e3b\u8981\u662f\u4e3a\u7f29\u77ed\u673a\u68b0\u786c\u76d8\u5bfb\u5740\u65f6\u95f4\u800c\u4f18\u5316\u7684\uff1b\u800c\u56fa\u6001\u786c\u76d8\u6ca1\u6709\u6240\u8c13\u7684\u673a\u68b0\u8fd0\u52a8\u5bfb\u5740\u90e8\u4ef6\u9700\u8981\u7684\u65f6\u95f4\uff0c\u800c\u4e14\u5f88\u5feb\u80fd\u51c6\u5907\u597d\u6570\u636e\uff0c\u6240\u4ee5 IO \u54cd\u5e94\u65f6\u95f4\u975e\u5e38\u77ed\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_1","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_2","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u4ec0\u4e48\u8981\u5f00\u53d1 IO Cache\uff1f</p> <p>\u6587\u4ef6\u7cfb\u7edf\u6709ntfs\u548cext4\uff0c\u5f88\u591a\u6e38\u620f\u8f6f\u4ef6\u53ea\u652f\u6301ntfs\u683c\u5f0f\uff0c\u7531\u4e8e\u78c1\u76d8\u8fd0\u884c\u6548\u7387\u8fdc\u4f4e\u4e8ecpu\uff0c\u597d\u7684\u7b97\u6cd5\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u63d0\u9ad8\u78c1\u76d8\u7684\u5229\u7528\u6548\u7387\uff08\u5305\u62ec\u8df3\u8fc7\u78c1\u7247\u4e2d\u7684\u574f\u70b9\uff09 io cache\u662f\u5fc5\u987b\u7684\uff0c\u5c31\u597d\u6bd4\u5982\u628ad\u76d8\u7684\u6587\u4ef6a\u526a\u5207\u5230c\u76d8\u4e2d\uff0c\u89c2\u5bdf\u53ef\u4ee5\u5f97\u77e5\uff0c\u5047\u5982\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6545\u610f\u5173\u673a\u7b49\uff0c\u518d\u6b21\u5f00\u673a\u6587\u4ef6a\u8fd8\u5728d\u76d8\u3002\u9884\u8ba1cpu\u662f\u4f20\u8f93\u5b8c\u518d\u5220\u9664\uff0c\u8fd9\u6837\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u78c1\u76d8\u788e\u7247\uff08\u7279\u522b\u7684\u51cf\u5c11\u4e0d\u80fd\u88ab\u7cfb\u7edf\u8bc6\u522b\u7684\u788e\u7247\u5197\u4f59\u5b58\u5728\uff09\uff0cio cache\u4e5f\u65b9\u4fbf\u64cd\u4f5c\u7cfb\u7edf\u90e8\u5206\u60c5\u51b5\u4e0b\u5ef6\u8fdf\u5e94\u5bf9\u786c\u4ef6\u9700\u6c42\uff01</p> <ol> <li> <p>\u63d0\u9ad8\u6027\u80fd\uff1aCPU\u7684\u8fd0\u884c\u901f\u5ea6\u8fdc\u8fdc\u5feb\u4e8e\u78c1\u76d8\u7b49IO\u8bbe\u5907\u7684\u901f\u5ea6\u3002\u901a\u8fc7\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u78c1\u76d8\u6570\u636e\uff0c\u53ef\u4ee5\u51cf\u5c11\u5bf9\u6162\u901fIO\u8bbe\u5907\u7684\u9891\u7e41\u8bbf\u95ee\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u6574\u4f53\u7684\u6027\u80fd\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662fCPU\u592a\u5feb\u4e86\uff0c\u4f46\u662f\u78c1\u76d8\u8bbe\u5907\u592a\u6162\u4e86\u3002</p> </li> <li> <p>\u51cf\u5c11IO\u8bbf\u95ee\u6b21\u6570\uff1a\u901a\u8fc7IO Cache\uff0c\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u6570\u636e\u8bbf\u95ee\u90fd\u9700\u8981\u76f4\u63a5\u8bbf\u95ee\u78c1\u76d8\uff0c\u4ece\u800c\u51cf\u5c11\u4e86IO\u8bbf\u95ee\u6b21\u6570\uff0c\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684IO\u8d1f\u8f7d\uff0c\u63d0\u9ad8\u4e86\u6570\u636e\u8bbf\u95ee\u6548\u7387\u3002</p> </li> <li> <p>\u4f18\u5316\u78c1\u76d8\u5229\u7528\u6548\u7387\uff1aIO Cache\u53ef\u4ee5\u5e2e\u52a9\u4f18\u5316\u78c1\u76d8\u7684\u5229\u7528\u6548\u7387\uff0c\u5305\u62ec\u8df3\u8fc7\u78c1\u76d8\u4e2d\u7684\u574f\u70b9\u3001\u51cf\u5c11\u78c1\u76d8\u788e\u7247\u7b49\u3002\u8fd9\u4e9b\u4f18\u5316\u53ef\u4ee5\u63d0\u9ad8\u6570\u636e\u8bfb\u5199\u7684\u6548\u7387\uff0c\u51cf\u5c11\u6570\u636e\u8bbf\u95ee\u7684\u5ef6\u8fdf\u3002</p> </li> <li> <p>\u63d0\u9ad8\u7cfb\u7edf\u7a33\u5b9a\u6027\uff1a\u901a\u8fc7IO Cache\uff0c\u53ef\u4ee5\u7f13\u5b58\u4e00\u90e8\u5206\u6570\u636e\u5728\u5185\u5b58\u4e2d\uff0c\u5373\u4f7f\u53d1\u751f\u610f\u5916\u5173\u673a\u7b49\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u51cf\u5c11\u6570\u636e\u7684\u4e22\u5931\u98ce\u9669\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002</p> </li> </ol> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1IO Cache\u7684\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u9ad8\u7cfb\u7edf\u6027\u80fd\u3001\u51cf\u5c11IO\u8bbf\u95ee\u6b21\u6570\u3001\u4f18\u5316\u78c1\u76d8\u5229\u7528\u6548\u7387\u548c\u63d0\u9ad8\u7cfb\u7edf\u7a33\u5b9a\u6027\u3002\u901a\u8fc7\u5728\u5185\u5b58\u4e2d\u7f13\u5b58IO\u6570\u636e\uff0c\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u7ba1\u7406\u548c\u52a0\u901f\u6570\u636e\u8bbf\u95ee\u8fc7\u7a0b\uff0c\u4ece\u800c\u63d0\u5347\u7cfb\u7edf\u6574\u4f53\u7684\u6027\u80fd\u548c\u7528\u6237\u4f53\u9a8c\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#2iolinux","title":"2\uff5cIO\u7ba1\u7406\uff1aLinux\u5982\u4f55\u7ba1\u7406\u591a\u4e2a\u5916\u8bbe\uff1f","text":"<p>Linux \u662f\u5982\u4f55\u7ba1\u7406\u591a\u4e2a IO \u5916\u8bbe\u7684\u3002\u5148\u4ece\u4f8b\u5b50\u51fa\u53d1\uff0c\u4e86\u89e3\u4e00\u4e0b\u8bbe\u5907\u5728 Linux \u4e2d\u7684\u4e0e\u4f17\u4e0d\u540c\uff0c\u7136\u540e\u770b\u770b\u8bbe\u5907\u5206\u7c7b\u53ca\u63a5\u53e3\uff0c\u5206\u6790\u4e00\u4e0b\u5e94\u7528\u5f00\u53d1\u4eba\u5458\u5e94\u8be5\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\uff0c\u6700\u540e\u518d\u5b9e\u73b0\u4e00\u4e2a\u8bbe\u5907\u52a0\u6df1\u7406\u89e3</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_3","title":"\u6587\u4ef6\u548c\u5916\u8bbe\u7684\u5173\u7cfb","text":"<pre><code>#define KB_DEVICE_FILE \"/dev/input/event3\"\n\nint main(int argc, char *argv[])\n{\n  int fd = -1, ret = -1;\n  struct input_event in;\n  char *kbstatestr[] = {\"\u5f39\u8d77\", \"\u6309\u4e0b\"};\n  char *kbsyn[] = {\"\u5f00\u59cb\", \"\u952e\u76d8\", \"\u7ed3\u675f\"};\n  //\u7b2c\u4e00\u6b65\uff1a\u6253\u5f00\u6587\u4ef6(\u9996\u5148\u8981\u77e5\u9053\u76ee\u5f55\u5427)\n  fd = open(KB_DEVICE_FILE, O_RDONLY);\n  if (fd &lt; 0)\n  {\n    perror(\"\u6253\u5f00\u6587\u4ef6\u5931\u8d25\");\n    return -1;\n  }\n  while (1)\n  {\n    //\u7b2c\u4e8c\u6b65\uff1a\u8bfb\u53d6\u4e00\u4e2aevent\u4e8b\u4ef6\u5305\n    ret = read(fd, &amp;in, sizeof(struct input_event));\n    if (ret != sizeof(struct input_event))\n    {\n      perror(\"\u8bfb\u53d6\u6587\u4ef6\u5931\u8d25\");\n      break;\n    }\n    //\u7b2c\u4e09\u6b65\uff1a\u89e3\u6790event\u5305\n    if (in.type == 1)\n    {\n      printf(\"------------------------------------\\n\");\n      printf(\"\u72b6\u6001:%s \u7c7b\u578b:%s \u7801:%d \u65f6\u95f4:%ld\\n\", kbstatestr[in.value], kbsyn[in.type], in.code, in.time.tv_usec);\n      if (in.code == 46)\n      {\n        break;\n      }\n    }\n  }\n  //\u7b2c\u56db\u6b65\uff1a\u5173\u95ed\u6587\u4ef6\n  close(fd);\n  return 0;\n}\n</code></pre> <p>\u4f60\u6309\u4e0b\u952e\u76d8\u4e0a\u4e00\u4e2a\u952e\uff0c\u7ec8\u7aef\u4e2d\u5b83\u5c31\u4f1a\u8f93\u51fa\u4e00\u884c\uff0c\u677e\u5f00\u952e\u53c8\u4f1a\u8f93\u51fa\u4e00\u884c\uff0c\u8f93\u51fa\u201c\u6309\u4e0b\u201d\u6216\u201c\u5f39\u8d77\u201d\u7684\u72b6\u6001\u3001\u952e\u76d8\u7801\u4ee5\u53ca\u6309\u4e0b\u5f39\u8d77\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u8fd9\u4e9b\u6570\u636e\u7cbe\u786e\u5730\u53cd\u6620\u4e86\u952e\u76d8\u6309\u952e\u52a8\u4f5c\u3002</p> <p>\u4e00\u4e2a\u6587\u4ef6\u5c31\u80fd\u53cd\u6620\u952e\u76d8\u7684\u52a8\u4f5c\u548c\u6570\u636e\uff0c\u96be\u9053\u4e0d\u5947\u602a\u5417\uff1f</p> <p>\u539f\u6765 /dev/input/event3 \u8fd9\u4e2a\u6587\u4ef6\u5c31\u4ee3\u8868\u952e\u76d8\uff0c\u8fd9\u4e2a\u6587\u4ef6\u662f\u7279\u6b8a\u7684\u8bbe\u5907\u6587\u4ef6\uff0c\u8bbf\u95ee\u8fd9\u79cd\u6587\u4ef6\u5c31\u662f\u8bbf\u95ee IO \u786c\u4ef6\u8bbe\u5907\u3002</p> <p>\u5176\u5b9e\uff0cdev \u76ee\u5f55\u4e0b\u5168\u90e8\u7684\u6587\u4ef6\u90fd\u662f\u8bbe\u5907\u6587\u4ef6\uff0c\uff08\u719f\u6089\u7684 Linux \u8bbe\u8ba1\u54f2\u5b66\u2014\u2014\u4e00\u5207\u7686\u6587\u4ef6\u3002\uff09</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728 dev \u76ee\u5f55\u4e0b\u627e\u5230\u7cfb\u7edf\u7684\u6240\u6709\u8bbe\u5907\uff0c\u5b83\u4eec\u90fd\u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u5728\u7684\u3002\u4ece\u8fd9\u79cd\u89d2\u5ea6\u770b\uff0c\u6587\u4ef6\u662f\u62bd\u8c61\u7684\uff0c\u662f\u4e00\u79cd\u8d44\u6e90\u5bf9\u8c61\u7684\u6807\u8bc6\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u8bbe\u5907\u7684\u64cd\u4f5c\u5b8c\u5168\u7b26\u5408\u6587\u4ef6\u7684\u64cd\u4f5c\u65b9\u5f0f\u3002</p> <p>\u8bbe\u5907\u8f93\u5165\u3001\u8f93\u51fa\u6570\u636e\u7684\u64cd\u4f5c\u5bf9\u5e94\u6587\u4ef6\u7684\u8bfb\u5199\uff0c\u8bbe\u5907\u7684\u542f\u52a8\u6216\u8005\u505c\u6b62\u5219\u5bf9\u5e94\u6587\u4ef6\u6253\u5f00\u6216\u5173\u95ed\u3002(<code>open()</code>, <code>read()</code>, <code>write()</code>, <code>close()</code>)</p> <p>\u4f46\u662f\u8bbe\u5907\u7684\u64cd\u4f5c\u4e0d\u53ea\u6709\u8f93\u5165\u8f93\u51fa\u6570\u636e\uff0c\u8fd8\u6709\u8bbe\u7f6e\u8bbe\u5907\u529f\u80fd\u3001\u914d\u7f6e\u8bbe\u5907\u7535\u6e90\u7b49\u64cd\u4f5c\u3002\u4f8b\u5982\u8bbe\u7f6e\u58f0\u5361\u97f3\u91cf\u3001\u8bbe\u7f6e\u5904\u7406\u5668\u8fdb\u5165\u5f85\u673a\u72b6\u6001\u4ee5\u51cf\u5c11\u529f\u8017\u7b49\u7b49\u3002\u600e\u4e48\u64cd\u4f5c\u7684\u5462\uff1f</p> <p>\u6587\u4ef6\u8fd8\u6709\u4e00\u4e2a\u64cd\u4f5c\u2014\u2014<code>ioctl</code>\uff0c\u901a\u8fc7\u5b83\u6765\u7ed9\u8bbe\u5907\u53d1\u9001\u547d\u4ee4\u6216\u8005\u8bbe\u7f6e\u76f8\u5173\u529f\u80fd\u3002\u8fd9\u6837\u4e00\u4e2a\u8bbe\u5907\u7684\u6240\u6709\u64cd\u4f5c\u5c31\u548c\u6587\u4ef6\u5bf9\u4e0a\u4e86\u3002\u4e0d\u8fc7\u53ef\u4e0d\u8981\u60f3\u7740\u7528\u8fd9\u79cd\u65b9\u6848\u5e72\u574f\u4e8b\u54e6\uff0c\u6bd4\u5982\u83b7\u53d6\u522b\u4eba\u8f93\u5165\u7684\u654f\u611f\u4fe1\u606f\u3002</p> <p>In the context of Linux device drivers, the <code>ioctl</code> system call is used to communicate with device drivers and perform device-specific operations that are not covered by the standard read and write operations. This system call provides a way to send control commands to a device driver, allowing user-space applications to interact with hardware peripherals in a flexible and extensible manner.</p> <p>The <code>ioctl</code> system call is commonly used in Linux device drivers to implement custom functionality, retrieve device information, configure device settings, and perform various control operations that are specific to a particular device.</p> <p>Here is an overview of how <code>ioctl</code> is typically used in a Linux device driver perspective:</p> <ol> <li> <p>Driver Implementation: In the device driver code, you need to define the <code>ioctl</code> handler function to handle specific control commands. This function is registered with the device driver and is responsible for interpreting the control commands sent by user-space applications.</p> </li> <li> <p>User-Space Interface: User-space applications can use the <code>ioctl</code> system call to send control commands to the device driver. The application specifies the device file descriptor, the control command, and any required arguments for the command.</p> </li> <li> <p>Handling Control Commands: When the <code>ioctl</code> system call is invoked by a user-space application, the kernel forwards the control command to the <code>ioctl</code> handler function in the device driver. The handler function processes the command, performs the necessary operations, and returns the result to the application.</p> </li> <li> <p>Return Values: The <code>ioctl</code> handler function typically returns a status code or result to indicate the success or failure of the operation. User-space applications can check the return value to determine the outcome of the control command.</p> </li> </ol> <p>Here is a simplified example to illustrate how <code>ioctl</code> can be used in a Linux device driver:</p> <pre><code>#include &lt;linux/fs.h&gt;\n#include &lt;linux/ioctl.h&gt;\n\n#define MY_IOCTL_CMD  _IOW('k', 1, int)  // Define a custom ioctl command\n\nstatic long my_driver_ioctl(struct file *filp, unsigned int cmd, unsigned long arg) {\n    int value;\n\n    switch (cmd) {\n        case MY_IOCTL_CMD:\n            // Process the custom ioctl command\n            if (copy_from_user(&amp;value, (int __user *)arg, sizeof(int)) != 0) {\n                return -EFAULT;\n            }\n\n            // Perform operations based on the value\n            printk(KERN_INFO \"Received value from user-space: %d\\n\", value);\n\n            // Return a result to user-space\n            return 0;\n        default:\n            return -ENOTTY;  // Not a valid ioctl command\n    }\n}\n</code></pre> <p>In this example, <code>my_driver_ioctl</code> is the handler function for the custom <code>ioctl</code> command <code>MY_IOCTL_CMD</code>. When a user-space application sends this command to the device driver, the driver processes the command and performs the specified operations.</p> <p>By using <code>ioctl</code>, Linux device drivers can provide a versatile interface for user-space applications to interact with hardware peripherals and perform device-specific operations efficiently.</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_4","title":"\u8bbe\u5907\u5206\u7c7b","text":"<p>\u60f3\u4e00\u4e0b\uff0c\u4f60\u9700\u8981\u7ba1\u7406\u4f60\u5bb6\u91cc\u7684\u65e5\u5e38\u7528\u54c1\uff0c\u4f60\u901a\u5e38\u4f1a\u600e\u4e48\u505a\uff1f\u4f60\u662f\u4e0d\u662f\u9996\u5148\u4f1a\u5bf9\u8fd9\u4e9b\u7269\u54c1\u8fdb\u884c\u5206\u7c7b\u3002\u4f60\u53ef\u80fd\u4f1a\u6309\u7269\u54c1\u7684\u529f\u80fd\u7528\u9014\u5206\u7c7b\uff0c\u4e5f\u53ef\u80fd\u6309\u7269\u54c1\u5f52\u5c5e\u4e8e\u54ea\u4f4d\u5bb6\u5ead\u6210\u5458\u6765\u5206\u7c7b\u3002</p> <p>\u5bf9\u4e8e Linux \u8fd9\u4e2a\u8ba1\u7b97\u673a\u5927\u603b\u7ba1\u4e5f\u662f\u5982\u6b64\uff0c\u4ec0\u4e48\u8bbe\u5907\u6709\u4ec0\u4e48\u529f\u80fd\u3001\u662f\u7528\u6765\u505a\u4ec0\u4e48\u7684\u3001\u6709\u591a\u5c11\u4e2a\u8fd9\u79cd\u7c7b\u578b\u7684\u8bbe\u5907\u3001\u5b83\u4eec\u63a5\u5165\u7cfb\u7edf\u7684\u65b9\u5f0f\u662f\u4ec0\u4e48\u2026\u2026\u8fd9\u4e9b\u4fe1\u606f\uff0cLinux \u90fd\u9700\u8981\u4e86\u89e3\u5f97\u975e\u5e38\u6e05\u695a\u624d\u53ef\u4ee5\u3002</p> <p>\u5728\u4e86\u89e3 Linux \u5982\u4f55\u5bf9\u8bbe\u5907\u8fdb\u884c\u5206\u7c7b\u4e4b\u524d\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u4e86\u89e3\u4e00\u4e0b\u5e38\u89c4\u60c5\u51b5\u4e0b\u7cfb\u7edf\u4e2d\u90fd\u6709\u54ea\u4e9b\u8bbe\u5907\u3002</p> <p></p> <p>\u5b9e\u9645\u60c5\u51b5\u53ef\u80fd\u6bd4\u56fe\u4e2d\u6709\u66f4\u591a\u6216\u8005\u66f4\u5c11\u7684\u603b\u7ebf\u548c\u8bbe\u5907\u3002</p> <p>\u5404\u79cd\u8bbe\u5907\u901a\u8fc7\u603b\u7ebf\u76f8\u8fde\u3002\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u4f4f\uff0c\u8ba1\u7b97\u673a\u4e2d\u6709\u5f88\u591a\u7684\u8bbe\u5907\u3002</p> <p>Linux \u4f1a\u628a\u8fd9\u4e9b\u8bbe\u5907\u5206\u6210\u51e0\u7c7b\uff0c\u5206\u522b\u662f\uff1a\u7f51\u7edc\u8bbe\u5907\u3001\u5757\u8bbe\u5907\u3001\u5b57\u7b26\u8bbe\u5907\u3001\u6742\u9879\u8bbe\u5907\u4ee5\u53ca\u4f2a\u8bbe\u5907\u3002\u5177\u4f53\u60c5\u51b5\u4f60\u53ef\u4ee5\u53c2\u8003\u6211\u540e\u9762\u68b3\u7406\u7684\u793a\u610f\u56fe\uff1a</p> <p></p> <ul> <li> <p>\u7f51\u7edc\u8bbe\u5907</p> <p>\u7f51\u7edc\u8bbe\u5907\u5728 Linux \u4e0a\u88ab\u62bd\u8c61\u6210\u4e00\u4e2a\u63a5\u53e3\u8bbe\u5907\uff0c\u76f8\u5f53\u4e8e\u7f51\u7ebf\u63d2\u53e3\uff0c\u4efb\u4f55\u7f51\u7edc\u901a\u4fe1\u90fd\u8981\u7ecf\u8fc7\u7f51\u7edc\u63a5\u53e3\u3002</p> <p>\u63a5\u53e3\u5c31\u662f\u80fd\u4e0e\u5176\u4ed6\u4e3b\u673a\u4ea4\u6362\u6570\u636e\u7684\u8bbe\u5907\uff0c\u50cf\u662f\u7535\u5b50\u4fe1\u53f7\u4ece\u7f51\u53e3\u6d41\u5230\u53e6\u4e00\u4e2a\u7f51\u53e3\u4e00\u6837\u3002</p> <p>Linux \u4f7f\u7528\u4e00\u5957\u4f20\u8f93\u6570\u636e\u5305\u7684\u51fd\u6570\u6765\u4e0e\u7f51\u7edc\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u901a\u4fe1\uff0c\u5b83\u4eec\u4e0e\u5b57\u7b26\u8bbe\u5907\u548c\u5757\u8bbe\u5907\u6216\u8005\u6587\u4ef6\u7684 read() \u548c write() \u63a5\u53e3\u4e0d\u540c\uff0c\u6240\u4ee5\u7f51\u7edc\u8bbe\u5907\u5728 Linux \u4e2d\u662f\u4e00\u4e2a\u72ec\u7279\u7684\u5b58\u5728\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u63a5\u53e3\u5bf9\u5e94\u4e8e\u7269\u7406\u7f51\u5361\uff0c\u4f46\u4e5f\u53ef\u80fd\u662f\u7eaf\u8f6f\u4ef6\u5b9e\u73b0\u7684\uff0c\u6bd4\u5982\u8f93\u5165 <code>ifconfig</code> \u547d\u4ee4\u67e5\u770b\u7f51\u53e3\u65f6\uff0c\u4f1a\u8f93\u51fa\u4e00\u4e2a eth0\u3001\u4e00\u4e2a lo \u7b49\u4fe1\u606f\uff1alo \u5c31\u662f\u7f51\u7edc\u56de\u73af\uff08loopback\uff09\u63a5\u53e3\u3002</p> <p>Linux \u4f1a\u7ed9\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u540d\u5b57\uff0c\u6bd4\u5982 eth0\u3001eth1 \u7b49\uff0c\u65b9\u4fbf\u5176\u5b83\u8f6f\u4ef6\u8bbf\u95ee\u8fd9\u4e9b\u63a5\u53e3\uff0c\u4f46\u8fd9\u4e2a\u540d\u5b57\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u5e76\u6ca1\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u3002</p> </li> <li> <p>\u5757\u8bbe\u5907</p> <p>\u5757\u8bbe\u5907\u8fd9\u79cd\u8bbe\u5907\u7c7b\u578b\u4e5f\u662f Linux \u4e0b\u7684\u4e00\u4e2a\u5927\u7c7b\u3002</p> <p>\u5757\u8bbe\u5907\u7684\u7279\u70b9\u662f\u80fd\u6309\u4e00\u5757\u4e00\u5757\u7684\u65b9\u5f0f\u4f20\u8f93\u6570\u636e\uff0c\u800c\u4e14\u80fd\u968f\u673a\u8bbf\u95ee\u8bbe\u5907\u4e2d\u7684\u4efb\u4e00\u5730\u5740\uff0c\u5177\u4f53\u662f\u901a\u8fc7 /dev \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u7cfb\u7edf\u8282\u70b9\u6765\u8bbf\u95ee\u3002</p> <p>\u5e38\u89c1\u7684\u5757\u8bbe\u5907\u5305\u62ec\u786c\u76d8\u3001flash\u3001SSD\u3001U \u76d8\u3001SD \u5361\u7b49\u3002</p> <p>\u5757\u8bbe\u5907\u4e0a\u901a\u5e38\u80fd\u591f\u5b89\u88c5\u6587\u4ef6\u7cfb\u7edf\uff0c\u5373\u80fd\u88ab\u683c\u5f0f\u5316\u3002\u6bd4\u5982\u4f60\u7684\u673a\u5668\u4e0a\u6709\u4e00\u5757\u786c\u76d8\uff0c\u786c\u76d8\u4e0a\u6709 4 \u4e2a\u5206\u533a\u3002\u90a3\u4e48\u5728 Linux \u7cfb\u7edf\u4e2d\u7684\u8868\u73b0\u5c31\u662f\u8fd9\u6837\u7684\uff1a</p> <p>\u8fd9\u4e9b\u8bbe\u5907\u6587\u4ef6\u53ef\u4ee5\u50cf\u8bbf\u95ee\u666e\u901a\u6587\u4ef6\u4e00\u6837\u4f7f\u7528\uff0c\u4f60\u53ea\u8981\u8ba1\u7b97\u597d\u786c\u76d8\u5730\u5740\uff0c\u5c31\u80fd\u628a\u6570\u636e\u5199\u5165\u5230\u786c\u76d8\u6247\u533a\u4e2d\u3002</p> <p>\u6bd4\u65b9\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 <code>cat /dev/sda1 &gt; sda1.bk</code> \u547d\u4ee4\uff0c\u5bf9\u786c\u76d8\u7684\u5206\u533a\u4e00\u8fdb\u884c\u5907\u4efd\u3002</p> </li> <li> <p>\u5b57\u7b26\u8bbe\u5907</p> <p>\u5b57\u7b26\u8bbe\u5907\u4e5f\u662f Linux \u4e0b\u7684\u4e00\u4e2a\u57fa\u7840\u7c7b\u8bbe\u5907\uff0c\u6bd4\u5982\u952e\u76d8\u3001\u9f20\u6807\uff0c\u4e32\u53e3\uff0c\u58f0\u5361\u7b49\u90fd\u5c5e\u4e8e\u5b57\u7b26\u8bbe\u5907\u3002</p> <p>\u5b57\u7b26\u8bbe\u5907\u662f\u987a\u5e8f\u8bbf\u95ee\u7684\uff0c\u4e0d\u80fd\u968f\u673a\u8bbf\u95ee\uff0c\u5b83\u53ea\u80fd\u50cf\u662f\u8bbf\u95ee\u5b57\u7b26\u6570\u636e\u5b57\u8282\u6d41\u4e00\u6837\u88ab\u8bbf\u95ee\uff0c\u53ea\u6709\u5728\u8bbe\u5907\u54cd\u5e94\u540e\u624d\u80fd\u8bfb\u5230\u76f8\u5e94\u4fe1\u606f\uff0c\u8fd9\u4e9b\u529f\u80fd\u7531\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4fdd\u8bc1\u548c\u7ef4\u62a4\u3002</p> <p>\u5b57\u7b26\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\u901a\u5e38\u8981\u5b9e\u73b0\u6253\u5f00\u3001\u5173\u95ed\u3001\u8bfb\u53d6\u548c\u5199\u5165\u56de\u8c03\u51fd\u6570\uff0c\u4f9b Linux \u4f7f\u7528\u3002</p> <p>Linux \u4f1a\u5c06\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u8c03\u7528\uff0c\u8f6c\u53d1\u7ed9\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u56de\u8c03\u51fd\u6570\u3002</p> <p>\u5b57\u7b26\u8bbe\u5907\u7684\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u90fd\u5728 /dev \u76ee\u5f55\u4e0b\uff0c\u6bcf\u4e00\u4e2a\u6587\u4ef6\u5bf9\u5e94\u4e00\u4e2a\u5b57\u7b26\u8bbe\u5907\u6216\u8005\u5757\u8bbe\u5907\u3002</p> <p>\u6211\u4eec\u5728 /dev \u76ee\u5f55\u4e0b\u53ef\u4ee5\u4f7f\u7528 ls -l \u547d\u4ee4\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\uff0c\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u4e3a\u201cc\u201d\u7684\u5373\u4e3a\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u4e3a\u201cb\u201d\u7684\u5373\u4e3a\u5757\u8bbe\u5907\u6587\u4ef6\u3002</p> </li> <li> <p>\u6742\u9879\u8bbe\u5907\u548c\u4f2a\u8bbe\u5907 </p> <p>\u6742\u9879\u8bbe\u5907\u548c\u4f2a\u8bbe\u5907\u90fd\u662f\u57fa\u4e8e\u5b57\u7b26\u8bbe\u5907\u5b9e\u73b0\u7684\uff0c\u672c\u8d28\u4e0a\u662f\u5c5e\u4e8e\u5b57\u7b26\u8bbe\u5907\u3002</p> <p>\u800c\u4f2a\u8bbe\u5907\u5219\u4e0e\u5176\u5b83\u8bbe\u5907\u4e0d\u540c\uff0c\u5b83\u4e0d\u5bf9\u5e94\u7269\u7406\u786c\u4ef6\uff0c\u53ea\u662f\u901a\u8fc7\u8f6f\u4ef6\u5b9e\u73b0\u4e86\u4e00\u4e9b\u529f\u80fd\uff1a</p> <ul> <li>\u6bd4\u5982\u8bfb\u53d6 random \u8bbe\u5907\u80fd\u4ea7\u751f\u4e00\u4e2a\u968f\u673a\u6570\uff1b</li> <li>\u518d\u6bd4\u5982\u628a\u6570\u636e\u5199\u5165 null \u8bbe\u5907\uff0c\u6570\u636e\u4f1a\u6709\u53bb\u65e0\u56de\uff0c\u76f4\u63a5\u88ab\u4e22\u5f03\uff1b</li> <li>\u8fd8\u6709\u901a\u8fc7\u8bfb\u53d6 <code>kmsg</code> \u8bbe\u5907\uff0c\u83b7\u53d6\u5185\u6838\u8f93\u51fa\u7684\u4fe1\u606f\u3002</li> </ul> </li> <li> <p>\u8865\u5145</p> <p>\u6709\u65f6\u5019\u6211\u4eec\u5bf9\u4e8e\u8fd9\u4e9b\u8fd8\u6709\u522b\u7684\u5206\u6cd5\uff0c\u6bd4\u8f83\u6df7\u4e71\uff0c\u6bd4\u5982\uff0c\u603b\u7ebf\u8bbe\u5907\uff08SPI\u3001I2C\u3001UART\uff09\uff0c\u53c8\u6709\u4ec0\u4e48\u5e73\u53f0\u8bbe\u5907\uff0c\u6709\u4e9b\u6982\u62ec\u4f1a\u91cd\u590d\uff0c\u77e5\u9053\u5373\u53ef\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_5","title":"\u521b\u9020\u4e00\u4e2a\u8bbe\u5907","text":"<p>\u6bcf\u79cd\u8bbe\u5907\u90fd\u6709\u81ea\u5df1\u7684\u7f16\u7a0b\u63a7\u5236\u65b9\u5f0f\uff0c\u6240\u4ee5 Linux \u5185\u6838\u624d\u7528\u5206\u800c\u6cbb\u4e4b\u7684\u65b9\u6cd5\uff0c\u628a\u63a7\u5236\u8bbe\u5907\u4ee3\u7801\u72ec\u7acb\u51fa\u6765\uff0c\u5f62\u6210\u5185\u6838\u9a71\u52a8\u7a0b\u5e8f\u6a21\u5757\u3002</p> <p>\u8fd9\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u6a21\u5757\u7531\u9a71\u52a8\u5f00\u53d1\u4eba\u5458\u6216\u8bbe\u5907\u5382\u5546\u5f00\u53d1\uff0c\u4f1a\u6309\u7167 Linux \u5185\u6838\u7684\u89c4\u5219\u6765\u7f16\u5199\uff0c\u5e76\u63d0\u4f9b\u76f8\u5e94\u63a5\u53e3\u4f9b Linux \u5185\u6838\u8c03\u7528\u3002</p> <p>\u8fd9\u4e9b\u6a21\u5757\u65e2\u80fd\u548c Linux \u5185\u6838\u9759\u6001\u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u4e5f\u80fd\u52a8\u6001\u52a0\u8f7d\u5230 Linux \u5185\u6838\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86 Linux \u5185\u6838\u548c\u4f17\u591a\u7684\u8bbe\u5907\u9a71\u52a8\u7684\u89e3\u8026\u3002</p> <p>\u6709\u4e2a\u95ee\u9898\uff0c\u4e00\u4e2a\u9a71\u52a8\u7a0b\u5e8f\u65e2\u53ef\u4ee5\u662f Linux \u5185\u6838\u7684\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\uff0c\u4e5f\u80fd\u4ee3\u8868\u6216\u8005\u8868\u793a\u4e00\u4e2a\u8bbe\u5907\u662f\u5426\u5b58\u5728\uff0c\u90a3Linux \u5185\u6838\u6240\u611f\u77e5\u7684\u8bbe\u5907\uff0c\u4e00\u5b9a\u8981\u4e0e\u7269\u7406\u8bbe\u5907\u4e00\u4e00\u5bf9\u5e94\u5417\uff1f</p> <p>\u6211\u4eec\u62ff\u50a8\u5b58\u8bbe\u5907\u6765\u4e3e\u4f8b\uff0c\u5176\u5b9e\u4e0d\u7ba1\u5b83\u662f\u673a\u68b0\u786c\u76d8\uff0c\u8fd8\u662f TF \u5361\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5b83\u90fd\u53ef\u4ee5\u5411 Linux \u5185\u6838\u8868\u660e\u5b83\u662f\u50a8\u5b58\u8bbe\u5907\u3002</p> <p>\u4f46\u662f\uff0c\u5b83\u5b8c\u5168\u6709\u53ef\u80fd\u7533\u8bf7\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u6765\u50a8\u5b58\u6570\u636e\uff0c\u4e0d\u5fc5\u8bbf\u95ee\u771f\u6b63\u7684\u50a8\u5b58\u8bbe\u5907\u3002</p> <p>\u6240\u4ee5\uff0cLinux \u5185\u6838\u6240\u611f\u77e5\u7684\u8bbe\u5907\uff0c\u5e76\u4e0d\u9700\u8981\u548c\u7269\u7406\u8bbe\u5907\u5bf9\u5e94\uff0c\u8fd9\u53d6\u51b3\u4e8e\u9a71\u52a8\u7a0b\u5e8f\u81ea\u8eab\u7684\u884c\u4e3a\u3002</p> <p>\u6240\u4ee5\uff0c\u521b\u9020\u4e00\u4e2a\u8bbe\u5907\uff0c\u7b49\u540c\u4e8e\u7f16\u5199\u4e00\u4e2a\u5bf9\u5e94\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>Linux \u5185\u6838\u53ea\u662f\u548c\u9a71\u52a8\u7a0b\u5e8f\u4ea4\u4e92\uff0c\u800c\u4e0d\u9700\u8981\u7cfb\u7edf\u4e2d\u6709\u771f\u5b9e\u5b58\u5728\u7684\u7269\u7406\u8bbe\u5907\uff0c\u53ea\u8981\u9a71\u52a8\u7a0b\u5e8f\u544a\u8bc9 Linux \u5185\u6838\u662f\u4ec0\u4e48\u8bbe\u5907\u5c31\u884c\u3002</p> <p>\u660e\u767d\u4e86\u9a71\u52a8\u7a0b\u5e8f\u7684\u539f\u7406\uff0c\u6211\u4eec\u8fd9\u5c31\u6765\u5199\u4e00\u4e2a\u9a71\u52a8\u7a0b\u5e8f\u3002\u5148\u4ece Linux \u5185\u6838\u6a21\u5757\u6846\u67b6\u5f00\u59cb\uff1a</p> <pre><code>#include &lt;linux/module.h&gt;\n#include &lt;linux/init.h&gt;\n//\u5f00\u59cb\u521d\u59cb\u5316\u51fd\u6570\nstatic int __init miscdrv_init(void)\n{\n    printk(KERN_EMERG \"INIT misc dev\\n\");\n    return 0;\n}\n//\u9000\u51fa\u51fd\u6570\nstatic void  __exit miscdrv_exit(void)\n{\n    printk(KERN_EMERG \"EXIT,misc\\n\");\n}\n\nmodule_init(miscdrv_init);\nmodule_exit(miscdrv_exit);\n//\u7248\u6743\u4fe1\u606f\u548c\u4f5c\u8005 \nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"LMOS\");\n</code></pre> <p>\u4ece\u8fd9\u4e2a\u4f8b\u5b50\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e00\u4e2a\u5185\u6838\u6a21\u5757\u5fc5\u987b\u8981\u5177\u5907\u4e24\u4e2a\u51fd\u6570\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u5f00\u59cb\u521d\u59cb\u5316\u51fd\u6570\uff0c\u5728\u5185\u6838\u6a21\u5757\u52a0\u8f7d\u5230 Linux \u5185\u6838\u4e4b\u540e\u3002\u9996\u5148\u5c31\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\uff0c\u5b83\u7684\u4f5c\u7528\u901a\u5e38\u662f\u521b\u9020\u8bbe\u5907\u3002</li> <li>\u53e6\u4e00\u4e2a\u662f\u9000\u51fa\u51fd\u6570\uff0c\u5185\u6838\u6a21\u5757\u9000\u51fa\u5230 Linux \u5185\u6838\u4e4b\u524d\uff0c\u9996\u5148\u5c31\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\uff0c\u7528\u4e8e\u91ca\u653e\u7cfb\u7edf\u8d44\u6e90\u3002</li> </ul> <p>\u6709\u4e86 Linux \u5185\u6838\u6a21\u5757\u4e4b\u540e\uff0c\u6211\u4eec\u73b0\u5728\u8fd8\u4e0d\u80fd\u8c03\u7528\u5b83\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u521b\u9020\u8bbe\u5907\uff0c\u5bf9\u5e94\u7528\u7a0b\u5e8f\u800c\u8a00\u662f\u65e0\u6cd5\u4f7f\u7528\u7684\u3002</p> <p>\u90a3\u4e48\u600e\u4e48\u521b\u5efa\u4e00\u4e2a\u8bbe\u5907\u5462\uff1fLinux \u5185\u6838\u7684\u9a71\u52a8\u6846\u67b6\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u63a5\u53e3\u548c\u65b9\u6cd5\uff0c\u53ea\u9700\u8981\u6309\u7167\u63a5\u53e3\u6807\u51c6\u8c03\u7528\u5b83\u5c31\u884c\u4e86\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u521b\u9020\u4e00\u4e2a\u6742\u9879\u8bbe\u5907\uff0c\u5c31\u9700\u8981\u8c03\u7528 <code>misc_register</code> \u51fd\u6570\u3002</p> <p>\u6211\u4eec\u53ea\u8981\u7ed9\u8fd9\u4e2a\u51fd\u6570\u63d0\u4f9b\u4e00\u4e2a\u6742\u9879\u8bbe\u5907\u7ed3\u6784\u4f53\u4f5c\u4e3a\u53c2\u6570\uff0c\u5c31\u80fd\u5728 Linux \u5185\u6838\u4e2d\u521b\u9020\u5e76\u6ce8\u518c\u4e00\u4e2a\u6742\u9879\u8bbe\u5907\u3002\u5982\u4e0b</p> <pre><code>#define DEV_NAME  \"miscdevtest\"\n// \u6587\u4ef6\u64cd\u4f5c\u65b9\u6cd5\u7ed3\u6784\u4f53\nstatic const  struct file_operations misc_fops = {\n  .read     = misc_read,  //\u8bfb\u56de\u8c03\u51fd\u6570\n  .write    = misc_write, //\u5199\u56de\u8c03\u51fd\u6570\n  .release  = misc_release, //\u5173\u95ed\u56de\u8c03\u51fd\u6570\n    .open     = misc_open,   //\u6253\u5f00\u56de\u8c03\u51fd\u6570\n};\n// \u6742\u9879\u8bbe\u5907\u7ed3\u6784\u4f53\nstatic struct miscdevice  misc_dev =  {\n    .fops  =  &amp;misc_fops,         // \u8bbe\u5907\u6587\u4ef6\u64cd\u4f5c\u65b9\u6cd5\n    .minor =  255,                // \u6b21\u8bbe\u5907\u53f7\n    .name  =  DEV_NAME,           // \u8bbe\u5907\u540d/dev/\u4e0b\u7684\u8bbe\u5907\u8282\u70b9\u540d\n};\n\nstatic int __init miscdrv_init(void)\n{\n    misc_register(&amp;misc_dev);//\u521b\u9020\u6742\u9879\u8bbe\u5907\n    printk(KERN_EMERG \"INIT misc dev\\n\");\n    return 0;\n}\n</code></pre> <p>\u5bf9\u7167\u8fd9\u6bb5\u4ee3\u7801\uff0c\u6211\u4eec\u770b\u5230\uff0cLinux \u7528\u4e00\u4e2a <code>miscdevice</code> (miscellaneous device) \u7ed3\u6784\u4f53\u8868\u793a\u4e00\u4e2a\u6742\u9879\u8bbe\u5907\uff0c\u5176\u5b9e\u5b83\u5185\u90e8\u5305\u542b\u4e86\u7528\u4e8e\u8868\u793a\u5b57\u7b26\u8bbe\u5907\u7684 <code>cdev</code> \u7ed3\u6784\u4f53\uff0c\u6240\u4ee5\u6742\u9879\u8bbe\u5907\u5c31\u662f\u5b57\u7b26\u8bbe\u5907\u3002</p> <p>\u5176\u5b9e <code>miscdevice</code> \u7ed3\u6784\u4f53\u8fd8\u6709\u5f88\u591a\u6210\u5458\uff0c\u4e0d\u8fc7\u90a3\u4e9b\u6211\u4eec\u4e0d\u7528\u5904\u7406\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4ee5\u4e0b\u4e09\u4e2a\u6210\u5458\u5373\u53ef\uff1a</p> <ol> <li>\u8bbe\u5907\u6587\u4ef6\u64cd\u4f5c\u65b9\u6cd5\u7ed3\u6784\uff0c\u5b83\u662f\u4e00\u4e9b\u51fd\u6570\u6307\u9488\uff1b</li> <li>\u6b21\u8bbe\u5907\u53f7\uff0c\u6211\u4eec\u8bbe\u7f6e\u6210\u6700\u5927\u503c\uff0c\u5373 255\uff0c\u8ba9\u7cfb\u7edf\u81ea\u52a8\u5904\u7406\uff1b</li> <li>\u8bbe\u5907\u540d\u79f0\uff0c\u5c31\u662f\u5728 dev \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540d\u3002</li> </ol> <p>\u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u6700\u540e\u53ea\u8981\u5728 Linux \u5185\u6838\u6a21\u5757\u7684\u521d\u59cb\u5316 <code>miscdrv_init</code> \u51fd\u6570\u4e2d\uff0c\u8c03\u7528 <code>misc_register</code> \u51fd\u6570\u5c31\u884c\u4e86\u3002</p> <p>\u8fd9\u91cc\u6bd4\u8f83\u91cd\u8981\u7684\u662f\u6587\u4ef6\u64cd\u4f5c\u65b9\u6cd5\u7ed3\u6784\u4f53\u4e2d\u7684\u56de\u8c03\u51fd\u6570\uff0c\u5b83\u4eec\u662f\u5b8c\u6210\u8bbe\u5907\u529f\u80fd\u7684\u4e3b\u8981\u51fd\u6570\uff0c</p> <p>\u5e94\u7528\u7a0b\u5e8f\u5bf9\u8bbe\u5907\u6587\u4ef6\u7684\u6253\u5f00\u3001\u5173\u95ed\u3001\u8bfb\u3001\u5199\u7b49\u64cd\u4f5c\uff0c\u90fd\u4f1a\u88ab Linux \u5185\u6838\u5206\u53d1\u8c03\u7528\u5230\u8fd9\u4e9b\u51fd\u6570\uff1a</p> <ul> <li>\u5728\u6253\u5f00\u51fd\u6570\u4e2d\uff0c\u4f60\u53ef\u4ee5\u8ba9\u8bbe\u5907\u52a0\u7535\u5de5\u4f5c\u8d77\u6765\u3002</li> <li>\u800c\u5728\u8bfb\u3001\u5199\u51fd\u6570\u4e2d\uff0c\u4f60\u53ef\u4ee5\u5411\u8bbe\u5907\u4f20\u8f93\u6570\u636e\u3002</li> </ul> <p>Linux \u5185\u6838\u5e76\u4e0d\u5728\u610f\u4f60\u5728\u8fd9\u4e9b\u51fd\u6570\u505a\u4e86\u4ec0\u4e48\uff0c\u4e5f\u4e0d\u5728\u4e4e\u8fd9\u4e9b\u64cd\u4f5c\u662f\u4e0d\u662f\u76f4\u63a5\u4f5c\u7528\u4e8e\u7269\u7406\u8bbe\u5907\uff0cLinux \u5185\u6838\u53ea\u5728\u4e4e\u662f\u5426\u6709\u8fd9\u4e9b\u51fd\u6570\u6216\u8005\u8fd9\u4e9b\u51fd\u6570\u7684\u6267\u884c\u72b6\u6001\u662f\u4ec0\u4e48\u3002</p> <pre><code>//\u8bfb\u56de\u8c03\u51fd\u6570\nstatic ssize_t misc_read (struct file *pfile, char __user *buff, size_t size, loff_t *off)\n{\n  printk(KERN_EMERG \"line:%d,%s is call\\n\", __LINE__, __FUNCTION__);\n  return 0;\n}\n//\u5199\u56de\u8c03\u51fd\u6570 \nstatic ssize_t misc_write(struct file *pfile, const char __user *buff, size_t size, loff_t *off)\n{\n  printk(KERN_EMERG \"line:%d,%s is call\\n\", __LINE__, __FUNCTION__);\n  return 0;\n}\n//\u6253\u5f00\u56de\u8c03\u51fd\u6570\nstatic int  misc_open(struct inode *pinode, struct file *pfile)\n{\n  printk(KERN_EMERG \"line:%d,%s is call\\n\", __LINE__, __FUNCTION__);\n  return 0;\n}\n//\u5173\u95ed\u56de\u8c03\u51fd\u6570\nstatic int misc_release(struct inode *pinode, struct file *pfile)\n{\n  printk(KERN_EMERG \"line:%d,%s is call\\n\", __LINE__, __FUNCTION__);\n  return 0;\n}\n</code></pre> <p>\u4e0a\u8ff0\u5404\u79cd\u64cd\u4f5c\u7684\u56de\u8c03\u51fd\u6570\u975e\u5e38\u7b80\u5355\uff0c\u90fd\u53ea\u8c03\u7528\u4e86 <code>printk</code> \u51fd\u6570\u6253\u5370\u5185\u6838 log\uff0c\u8fd9\u4e9b log \u4fe1\u606f\u53ef\u4ee5\u5728 <code>/dev/kmsg</code> \u8bbe\u5907\u6587\u4ef6\u4e2d\u8bfb\u53d6\u3002</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e2a\u8bbe\u5907\u80fd\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u6211\u4eec\u8fd8\u8981\u5199\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5bf9\u5176\u8bbf\u95ee\uff0c\u5373\u5bf9\u5176\u8fdb\u884c\u6253\u5f00\u3001\u8bfb\u3001\u5199\u3001\u5173\u95ed\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#define DEV_NAME \"/dev/miscdevtest\"\nint main(void)\n{\n    char buf[] = {0, 0, 0, 0};\n    int i = 0;\n    int fd;\n    //\u6253\u5f00\u8bbe\u5907\u6587\u4ef6 O_RDWR,  O_RDONLY, O_WRONLY,\n    fd = open(DEV_NAME, O_RDWR);\n    if (fd &lt; 0)\n    {\n        printf(\"\u6253\u5f00 :%s \u5931\u8d25!\\n\", DEV_NAME);\n    }\n    //\u5199\u6570\u636e\u5230\u8bbe\u5907\n    write(fd, buf, 4);\n    //\u4ece\u8bbe\u5907\u8bfb\u53d6\u6570\u636e\n    read(fd, buf, 4);\n    //\u5173\u95ed\u8bbe\u5907 \u53ef\u4ee5\u4e0d\u8c03\u7528\uff0c\u7a0b\u5e8f\u5173\u95ed\u65f6\u7cfb\u7edf\u81ea\u52a8\u8c03\u7528\n    close(fd);\n    return 0;\n}\n</code></pre> <p>\u6211\u66ff\u4f60\u628a\u6240\u6709\u7684\u4ee3\u7801\u90fd\u51c6\u5907\u597d\u4e86\uff08\u53ef\u4ee5\u4ece\u8bfe\u7a0b\u914d\u5957\u4ee3\u7801\u83b7\u53d6\uff09\uff0c\u6211\u4eec\u5728\u5de5\u7a0b\u76ee\u5f55\u4e0b make \u4e00\u4e0b\u5c31\u53ef\u4ee5\u7f16\u8bd1\u597d\u4e86\u3002</p> <p>\u6210\u529f\u7f16\u8bd1\u540e\uff0c\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a <code>miscdrv.ko</code>\uff0c\u8fd9\u662f\u7f16\u8bd1\u597d\u7684 Linux \u5185\u6838\u6a21\u5757\u6587\u4ef6\uff1b\u8fd8\u6709\u4e00\u4e2a\u662f App \u6587\u4ef6\uff0c\u8fd9\u4e2a\u662f\u5e94\u7528\u7a0b\u5e8f\u3002\u6211\u4eec\u5728\u6d4b\u8bd5\u4e4b\u524d\uff0c\u5148\u6253\u5f00\u4e00\u4e2a\u7ec8\u7aef\uff0c\u5728\u5176\u4e2d\u8f93\u5165 <code>sudo cat /dev/kmsg</code>\uff0c\u4ee5\u4fbf\u89c2\u5bdf\u7ed3\u679c\u3002\u7136\u540e\u518d\u6253\u5f00\u4e00\u4e2a\u7ec8\u7aef\uff0c\u5728\u5176\u4e2d\u8f93\u5165 <code>sudo insmod miscdrv.ko</code>\uff0c\u628a <code>miscdrv.ko</code> \u8fd9\u4e2a Linux \u5185\u6838\u6a21\u5757\u5b89\u88c5\u52a0\u8f7d\u5230\u7cfb\u7edf\u4e2d\u3002\u52a0\u8f7d\u597d\u4e86\u6211\u4eec\u8f93\u5165 <code>sudo ./app</code>\uff0c\u5c31\u53ef\u4ee5\u770b\u7ed3\u679c\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u622a\u56fe\uff0c\u6211\u4eec\u770b\u5230\u53f3\u8fb9\u7ec8\u7aef\u901a\u8fc7\u8bfb\u53d6 <code>/dev/kmsg</code> \u8bbe\u5907\u8f93\u51fa\u4e86\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u8fd9\u8bf4\u660e\u6211\u4eec\u7684\u8bbe\u5907\u5de5\u4f5c\u6b63\u5e38\u3002</p> <p>\u53ea\u4e0d\u8fc7\u6211\u4eec\u8fd9\u4e2a\u8bbe\u5907\u6ca1\u6709\u5b8c\u6210\u4efb\u4f55\u529f\u80fd\uff0c\u4e5f\u6ca1\u6709\u5bf9\u5e94\u771f\u6b63\u7684\u7269\u7406\u8bbe\u5907\uff0c\u4f46\u662f\u5374\u771f\u5b9e\u5730\u53cd\u6620\u4e86\u8bbe\u5907\u7684\u5de5\u4f5c\u6d41\u7a0b\u3002</p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u7406\u89e3\u4e86 Linux \u7ba1\u7406\u8bbe\u5907\u7684\u6838\u5fc3\u673a\u5236\uff1a\u8d2f\u5f7b\u4e00\u5207\u7686\u6587\u4ef6\u7684\u601d\u60f3\uff0cLinux \u5185\u6838\u4f1a\u5728\u76f8\u5e94\u76ee\u5f55\u4e0b\uff0c\u5efa\u7acb\u7279\u6b8a\u7684\u6587\u4ef6\u8282\u70b9\uff0c\u7528\u6587\u4ef6\u7684\u5f62\u5f0f\u8868\u793a\u4e00\u4e2a\u8bbe\u5907\u3002</p> <p>\u800c\u5185\u6838\u64cd\u63a7\u8bbe\u5907\u7684\u65b9\u5f0f\uff0c\u5b9e\u8d28\u4e0a\u5c31\u662f\u628a\u6587\u4ef6\u64cd\u4f5c\u8f6c\u53d1\u7ed9\u5bf9\u5e94\u7684\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u56de\u8c03\u51fd\u6570\u6765\u5904\u7406\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_6","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_7","title":"\u8bfe\u540e\u601d\u8003","text":"<p>What 's the interface for the Linux network communication?</p> <p>In Linux, network communication is facilitated through the use of sockets. Sockets provide an interface for communication between processes on the same host or between processes on different hosts over a network. The most commonly used types of sockets in Linux are:</p> <ol> <li> <p>Internet Sockets (AF_INET):</p> <ul> <li>Internet sockets, also known as IPv4 sockets, are used for communication over the Internet using the Internet Protocol (IP). They are identified by the address family <code>AF_INET</code>. IPv4 sockets use IP addresses to identify hosts on the network.</li> </ul> </li> <li> <p>IPv6 Sockets (AF_INET6):</p> <ul> <li>IPv6 sockets are used for communication using the IPv6 protocol. They are identified by the address family <code>AF_INET6</code>. IPv6 sockets support the use of IPv6 addresses, which provide a larger address space compared to IPv4.</li> </ul> </li> <li> <p>Unix Domain Sockets (AF_UNIX):</p> <ul> <li>Unix domain sockets are used for communication between processes on the same host. They do not use network communication protocols and are identified by the address family <code>AF_UNIX</code>. Unix domain sockets use file system paths as addresses for communication.</li> </ul> </li> <li> <p>Packet Sockets (AF_PACKET):</p> <ul> <li>Packet sockets allow direct access to network packets at the link layer. They are identified by the address family <code>AF_PACKET</code> and are often used for low-level network monitoring and packet manipulation.</li> </ul> </li> </ol> <p>In Linux, network communication using sockets is typically performed using system calls such as <code>socket()</code>, <code>bind()</code>, <code>listen()</code>, <code>connect()</code>, <code>send()</code>, and <code>recv()</code>. These system calls allow processes to create and manage sockets, establish connections, send and receive data over the network.</p> <p>Programs written in C or other programming languages can utilize the socket interface provided by the Linux kernel to implement various network communication protocols such as TCP/IP, UDP, and more. Libraries like <code>libpcap</code> and <code>libnet</code> provide additional functionality for network packet capture and manipulation.</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#3iotop-iostat","title":"3\uff5c<code>iotop</code> \u4e0e <code>iostat</code> \u547d\u4ee4\uff1a\u804a\u804a\u547d\u4ee4\u80cc\u540e\u7684\u6545\u4e8b\u4e0e\u5de5\u4f5c\u539f\u7406","text":"<p>\u4eec\u5b66\u4e60\u4e86 IO Cache\u3001IO \u8c03\u5ea6\u548c IO \u7ba1\u7406\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u4f46\u600e\u6837\u5ea6\u91cf\u548c\u68c0\u6d4b\u4e00\u4e2a\u5e94\u7528\u4f7f\u7528 IO \u7684\u60c5\u51b5\u5462\uff1f</p> <p>\u901a\u8fc7\u4e24\u5927\u76d1\u63a7 IO \u64cd\u4f5c\u7684\u795e\u5668\u2014\u2014<code>iostat</code> \u4e0e <code>iotop</code>\uff0c</p> <p>\u5728 Linux \u7cfb\u7edf\u4e0a\uff0c<code>iostat</code> \u548c <code>iotop</code> \u8fd9\u4e24\u4e2a IO \u6570\u636e\u5de5\u5177\u975e\u5e38\u5e38\u7528\u3002</p> <p>\u5b83\u4eec\u90fd\u662f\u6027\u80fd\u5206\u6790\u9886\u57df\u4e2d\u4e0d\u53ef\u7f3a\u5c11\u7684\u5de5\u5177\u6027\u8f6f\u4ef6\uff0c\u4e5f\u7ecf\u5e38\u88ab Linux \u7f51\u7edc\u670d\u52a1\u5668\u8fd0\u7ef4\u4eba\u5458\uff0c\u7528\u4e8e\u5206\u6790\u67d0\u4e9b\u670d\u52a1\u5668\u7684 IO \u7c7b\u6027\u80fd\u4e0e\u6545\u969c\u3002</p> <p>\u8ba9\u4f60\u638c\u63e1\u5b89\u88c5\u3001\u4f7f\u7528\u5b83\u4eec\u7684\u65b9\u6cd5\u4ee5\u53ca\u5b83\u4eec\u7684\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#iostat-iotop","title":"\u5b89\u88c5\u548c\u4ecb\u7ecd <code>iostat</code> &amp; <code>iotop</code>","text":"<ul> <li> <p>\u5b89\u88c5</p> <ul> <li><code>iostat</code> \u53ef\u4ee5\u7528\u6765\u5206\u6790 Linux \u7cfb\u7edf\u6574\u4f53 IO \u7684\u4f7f\u7528\u60c5\u51b5\uff1b</li> <li><code>iotop</code> \u4f5c\u4e3a <code>iostat</code> \u589e\u5f3a\u7248\u548c\u529f\u80fd\u5347\u7ea7\u7248\uff0c\u53ef\u4ee5\u5206\u6790 Linux \u7cfb\u7edf\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528 IO \u7684\u60c5\u51b5\u3002</li> </ul> <p>\u5728\u6211\u4eec\u65e5\u5e38\u4f7f\u7528\u7684 Linux \u53d1\u884c\u7248\u4e2d\uff0c\u662f\u4e0d\u5305\u542b <code>iostat</code> \u4e0e <code>iotop</code> \u4e24\u4e2a IO \u5de5\u5177\u8f6f\u4ef6\u5305\u7684\uff0c\u9700\u8981\u6211\u4eec\u81ea\u884c\u5b89\u88c5\u5b83\u4eec\u624d\u53ef\u4ee5\u4f7f\u7528\u3002</p> <p>\u4e0d\u8fc7\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u76f4\u63a5\u5b89\u88c5 <code>iostat</code>\uff0c\u8fd9\u6837\u4f1a\u63d0\u793a\u627e\u4e0d\u5230 <code>iostat</code> \u8f6f\u4ef6\u5305\uff0c\u56e0\u4e3a\u5b83\u662f\u5305\u542b\u5728 <code>sysstat</code> \u8f6f\u4ef6\u5305\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u5148\u5b89\u88c5 <code>sysstat</code>\uff1b\u800c <code>iotop</code> \u5374\u662f\u72ec\u7acb\u7684\u8f6f\u4ef6\u5305\uff0c\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\u3002</p> <pre><code>//\u5b89\u88c5iostat\nsudo apt-get install sysstat\n//\u5b89\u88c5iotop\nsudo apt-get install iotop\n</code></pre> </li> <li> <p><code>iostat</code></p> <ul> <li> <p>\u4f7f\u7528</p> <p><code>iostat</code> \u547d\u4ee4\uff0c\u662f\u7528\u6765\u5c55\u793a\u7cfb\u7edf\u4e2d\u7684 IO \u8bbe\u5907\u548c CPU \u4f7f\u7528\u60c5\u51b5\u7684\u3002</p> <p>\u5b83\u7684\u6700\u5927\u4f18\u52bf\u5728\u4e8e\u80fd\u6c47\u62a5\u6240\u6709\u5757\u8bbe\u5907\u6d3b\u52a8\u7684\u7edf\u8ba1\u60c5\u51b5\uff0c\u540c\u65f6\u4e5f\u80fd\u6c47\u62a5\u51fa CPU \u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u4f46\u662f <code>iostat</code> \u547d\u4ee4\u6709\u4e00\u4e2a\u7f3a\u9677\uff0c\u5c31\u662f\u5b83\u4e0d\u80fd\u5bf9\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u8fdb\u884c\u6df1\u5165\u5206\u6790\uff0c\u53ea\u80fd\u5206\u6790\u7cfb\u7edf\u7684\u6574\u4f53\u60c5\u51b5\u3002\u6211\u4eec\u5148\u6765\u770b <code>iostat</code> \u5982\u4f55\u4f7f\u7528\uff0c\u5b83\u7684\u4f7f\u7528\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>iostat [\u9009\u9879] [\u53c2\u6570]\n</code></pre> <p>\u201c[]\u201d\u4e2d\u7684\u5185\u5bb9\u53ef\u4ee5\u7701\u7565\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u7ec8\u7aef\u4e2d\u8f93\u5165 <code>iostat</code>\uff0c\u5c31\u4f1a\u8f93\u51fa\u76f8\u5173\u7684\u5168\u90e8\u4fe1\u606f\u3002\u4f46\u662f\u6211\u4eec\u5982\u679c\u8981\u89c2\u5bdf\u7279\u5b9a\u4fe1\u606f\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u76f8\u5173\u9009\u9879\u4e86\uff0c\u5e38\u7528\u7684\u90e8\u5206\u9009\u9879\uff1a</p> <p></p> <p>\u4e86\u89e3\u4e86\u9009\u9879\uff0c\u8fd8\u6709\u4e2a\u53c2\u6570\u6211\u4eec\u53ef\u80fd\u7528\u5f97\u4e0a\uff0c\u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u4e3a\u8bbe\u5907\u540d\uff0c\u6bd4\u5982 <code>/dev/sda</code>\u3002\u5982\u679c\u4e0d\u5e26\u53c2\u6570\uff0c\u5c31\u4f1a\u9ed8\u8ba4\u663e\u793a\u6240\u6709 IO \u50a8\u5b58\u8bbe\u5907\u7684\u60c5\u51b5\u3002</p> <p>\u7ec3\u4e60\uff1a\u4f7f\u7528 <code>iostat</code> \u547d\u4ee4\u770b\u770b\u6211\u4eec\u81ea\u5df1\u673a\u5668\u4e0a\u7684 IO \u8bbe\u5907\uff0c\u4e3b\u8981\u662f\u786c\u76d8\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 <code>iostat -d -m -p -x</code>\u8fd9\u4e2a\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u6240\u6709\u786c\u76d8\u53ca\u5176\u5206\u533a\u7684\u4fe1\u606f\uff1a</p> <p></p> <p></p> <p>\u5408\u5e76\u8bfb\u5199\u64cd\u4f5c\uff1a \u591a\u4e2a\u8bfb\u5199\u64cd\u4f5c\u5408\u5e76\u6210\u4e00 \u4e2a</p> <p>\u5173\u4e8e\u8bfb\u5199\u8bf7\u6c42\u5904\u7406\u7b49\u5f85\u65f6\u95f4\uff1aCPU\u8fdc\u5feb\u4e8eI/O\u8bbe\u5907\uff0c\u54ea\u6015\u662f\u7528\u4e86PCIE\u7684SSD\u786c\u76d8\uff0c\u5176\u6bcf\u79d2\u64cd\u4f5c\u8f93\u5165\u8f93\u51fa\u6b21\u6570\u4e5f\u53ea\u67092\u4e07\u6b21\u5de6\u53f3\uff0c\u4f46\u662fCPU\u7684\u4e3b\u9891\u5f80\u5f80\u51e0GHz\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5e94\u7528\u5f00\u53d1\u7684\u65f6\u5019\u5f80\u5f80\u4f1a\u8bf4\u201c\u6027\u80fd\u74f6\u9888\u5728 I/O \u4e0a\u201d\u3002</p> <p>\u5f88\u591a\u65f6\u5019\uff0cCPU \u6307\u4ee4\u53d1\u51fa\u53bb\u4e4b\u540e\uff0c\u4e0d\u5f97\u4e0d\u53bb\u201c\u7b49\u201d\u6211\u4eec\u7684 I/O \u64cd\u4f5c\u5b8c\u6210\uff0c\u624d\u80fd\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u6709\u4e86\u8fd9\u4e9b\u91cf\u5316\u6570\u636e\uff0c\u6211\u4eec\u5c31\u80fd\u5224\u65ad\u6bcf\u4e2a\u786c\u76d8\u5206\u533a\u7684 IO \u4f7f\u7528\u60c5\u51b5\uff0c\u4ece\u800c\u5206\u6790\u51fa\u54ea\u4e2a\u8bbe\u5907\u5360\u7528 IO \u8bf7\u6c42\u91cf\u9ad8\u6216\u8005\u4f4e\u3001\u5360\u7528\u65f6\u95f4\u591a\u5c11\u3001\u8bfb\u53d6\u6216\u8005\u5199\u5165\u7684\u6570\u636e\u91cf\u6709\u591a\u5c11\u3002</p> <p>\u8fd9\u6837\uff0c\u6027\u80fd\u74f6\u9888\u51fa\u73b0\u5728\u54ea\u4e2a\u8bbe\u5907\u4e0a\uff0c\u6211\u4eec\u5fc3\u4e2d\u5c31\u6709\u6570\u4e86\u3002</p> </li> <li> <p>\u5185\u90e8\u539f\u7406</p> </li> </ul> <p><code>iostat</code> \u547d\u4ee4\u53ea\u662f\u4e00\u4e2a\u5e94\u7528\u8f6f\u4ef6\uff0c\u5b83\u7684\u529f\u80fd\u5c31\u662f\u8ba1\u7b97\u7edf\u8ba1\u6570\u636e\u5e76\u4e14\u663e\u793a\u3002IO \u8bbe\u5907\u64cd\u4f5c\u7684\u6570\u636e\u80af\u5b9a\u6765\u6e90\u4e8e\u5185\u6838\uff0c\u90a3 <code>iostat</code> \u600e\u4e48\u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u5c31\u6210\u4e86\u5173\u952e\u3002</p> <p>\u6211\u4eec\u5148\u624b\u52a8\u8bfb\u53d6\u4e00\u4e9b\u6587\u4ef6\uff1a</p> <p>\u5bf9\u6bd4 <code>iostat</code> \u4ea7\u751f\u7684\u6570\u636e\uff0c\u662f\u4e0d\u662f\u611f\u89c9\u548c\u4e0a\u9762\u8bfb\u53d6\u7684\u4e09\u4e2a\u6587\u4ef6\u5f97\u5230\u7684\u6570\u636e\u5f88\u76f8\u4f3c\uff1f\u662f\u7684\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5c31\u662f <code>iostat</code> \u547d\u4ee4\u7684\u6570\u636e\u6765\u6e90\uff0c\u4e3b\u8981\u7684\u6570\u636e\u6765\u6e90\u662f <code>/proc/diskstats</code> \u6587\u4ef6\uff0c\u5b83\u8bb0\u5f55\u7740\u5757\u8bbe\u5907 IO \u64cd\u4f5c\u7684\u5168\u90e8\u7edf\u8ba1\u4fe1\u606f\u3002</p> <p></p> <pre><code>\u4e0b\u9762\u662f `/proc/diskstats` \u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u7684**\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a\u5757\u8bbe\u5907\u6216\u8005\u5757\u8bbe\u5907\u7684\u5206\u533a**\uff0c\u603b\u5171 20 \u5217\u6570\u636e\uff0c\u6bcf\u4e00\u5217\u7684\u5185\u5bb9\u5982\u4e0b\u8868\uff1a\n</code></pre> <p></p> <p>Linux \u5757\u8bbe\u5907\u5c42\u5728\u5904\u7406\u6bcf\u4e2a IO \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u66f4\u65b0\u8fd9\u4e9b\u6570\u636e\u3002\u5177\u4f53\u7684\u6d41\u7a0b\u8fd9\u91cc\u4e0d\u5c55\u5f00\u4e86\uff0c<code>iostat</code> \u53ea\u4f7f\u7528\u4e86\u5176\u4e2d\u90e8\u5206\u6570\u636e\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e9b\u6570\u636e\u662f\u7ebf\u6027\u589e\u52a0\u7684\uff0c<code>iostat</code> \u53ea\u9700\u8981\u7ecf\u8fc7\u591a\u6b21\u91c7\u96c6\uff0c\u8fdb\u884c\u7b80\u5355\u7684\u8fd0\u7b97\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p><code>iostat</code> \u53ea\u662f\u8d1f\u8d23\u7684\u5de5\u4f5c\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u91c7\u96c6\u6570\u636e\u5e76\u8ba1\u7b97\u663e\u793a\u3002</p> <p>\u6211\u4eec\u901a\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684 IO \u8bf7\u6c42\u6570\u636e\u3001\u5199\u5165\u548c\u8bfb\u53d6\u7684\u6570\u636e\u91cf\u3001IO \u8bf7\u6c42\u7b49\u5f85\u65f6\u95f4\u7b49\u7b49\u8fd9\u4e9b\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u8bc4\u4f30\u4e00\u4e2a\u8bbe\u5907\u7684 IO \u6027\u80fd\u4e86\u3002</p> </li> <li> <p><code>iotop</code></p> <p>\u6211\u4eec\u524d\u9762\u521a\u5b66\u8fc7\u7684 <code>iostat</code> \u8fd9\u4e2a IO \u5de5\u5177\uff0c\u53ea\u80fd\u6536\u96c6\u91cf\u5316\u5230\u6bcf\u4e2a\u5757\u8bbe\u5907\u7684\u8bfb\u5199\u60c5\u51b5\uff0c\u4f46\u5982\u679c\u6211\u4eec\u60f3\u77e5\u9053\u6bcf\u4e2a\u8fdb\u7a0b\u662f\u5982\u4f55\u4f7f\u7528 IO \u7684\u5c31\u505a\u4e0d\u5230\uff0c\u8fd9\u5c31\u8981\u7528\u5230 <code>iotop</code> \u547d\u4ee4\u4e86\u3002</p> <p><code>iotop</code> \u547d\u4ee4\u662f\u4e00\u4e2a top \u7c7b\u5de5\u5177\uff0c\u53ef\u4ee5\u76d1\u89c6\u78c1\u76d8 I/O \u4f7f\u7528\u72b6\u51b5\uff0c\u8fd8\u53ef\u4ee5\u4f5c\u4e3a <code>iostat</code> \u7684\u5347\u7ea7\u5de5\u5177\u4f7f\u7528\u3002</p> <p><code>iotop</code> \u547d\u4ee4\u5177\u6709\u4e0e Linux \u7cfb\u7edf\u81ea\u5e26\u7684 top \u76f8\u4f3c\u7684 UI\uff0c\u53ea\u662f top \u66f4\u5173\u6ce8\u8fdb\u7a0b\uff0c\u800c <code>iotop</code> \u66f4\u5173\u6ce8 IO\u3002</p> <p><code>iotop</code> \u547d\u4ee4\u5b83\u662f\u4f7f\u7528 Python \u8bed\u8a00\u7f16\u5199\u800c\u6210\uff0c\u9700\u8981\u7528 Python2.5 \u4ee5\u4e0a\u7684\u7248\u672c\u548c Linux \u5185\u6838 2.6 \u4ee5\u4e0a\u7684\u7248\u672c\u3002</p> <p>\u50cf <code>iostat</code>\u4e00\u6837\uff0c\u6211\u4eec\u4e00\u8d77\u770b\u770b <code>iotop</code> \u5982\u4f55\u4f7f\u7528\uff0c\u5b83\u7684\u4f7f\u7528\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>sudo iotop [\u9009\u9879]\n</code></pre> <p>\u201c[]\u201d\u4e2d\u7684\u5185\u5bb9\u53ef\u4ee5\u7701\u7565\uff0c\u76f4\u63a5\u5728\u7ec8\u7aef\u4e2d\u8f93\u5165 <code>iotop</code> \u5c31\u4f1a\u8f93\u51fa\u76f8\u5173\u7684\u5168\u90e8\u4fe1\u606f\uff0c\u8fd9\u4e00\u70b9\u4e0e <code>iostat</code> \u76f8\u540c\uff0c\u4f46\u662f\u6211\u4eec\u5982\u679c\u8981\u89c2\u5bdf\u7279\u5b9a\u4fe1\u606f\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u76f8\u5173\u9009\u9879\u4e86\u3002\u6211\u7ed9\u4f60\u5217\u4e86\u4e00\u4e2a\u8868\u68b3\u7406\u9009\u9879\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <ul> <li> <p>\u4f7f\u7528\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u5c55\u793a\u4e86\u6240\u6709\u8fdb\u7a0b\u8bfb\u5199\u786c\u76d8\u7684\u60c5\u51b5\uff0c\u5934\u90e8\u7684\u6570\u636e\u663e\u793a\u4e86\u6bcf\u4e00\u79d2\u949f\uff0c\u6240\u6709\u786c\u76d8\u548c\u5f53\u524d\u786c\u76d8\u7684\u8bfb\u5199\u6570\u636e\u91cf\u3002\u800c\u4e0b\u9762\u7684\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u4e00\u884c\u7684\u7b2c\u4e00\u5217\u5c31\u662f\u8fdb\u7a0b id\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8f93\u5165\u201cp\u201d\u5207\u6362\u4e3a\u7ebf\u7a0b id\uff0c\u90a3\u4e00\u884c\u5c31\u8868\u793a\u4e00\u4e2a\u7ebf\u7a0b\u3002\u540e\u9762\u51e0\u5217\u7684\u76f8\u5173\u8bf4\u660e\uff1a</p> <p></p> <p>\u6709\u4e86\u8fd9\u4e9b\u91cf\u5316\u6570\u636e\uff0c\u6211\u4eec\u5c31\u80fd\u5224\u65ad\u54ea\u4e9b\u8fdb\u7a0b\u662f IO \u578b\u8fdb\u7a0b\uff0c\u54ea\u4e9b\u8fdb\u7a0b\u662f\u8ba1\u7b97\u578b\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u8bbf\u95ee IO \u7684\u6570\u636e\u4e00\u76ee\u4e86\u7136\u3002</p> <p>\u6839\u636e\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u8fd8\u80fd\u8fdb\u4e00\u6b65\u5206\u6790\u51fa\u54ea\u4e2a\u8fdb\u7a0b\u4f7f\u7528 IO \u7684\u91cf\u662f\u9ad8\u6216\u8005\u4f4e\u3001\u5360\u7528\u65f6\u95f4\u591a\u5c11\u3001\u8fdb\u7a0b\u4f18\u5148\u7ea7\u591a\u5c11\u3002</p> <p>IO \u6027\u80fd\u74f6\u9888\u51fa\u73b0\u5728\u54ea\u4e2a\u8fdb\u7a0b\u4e0a\uff0c\u9700\u8981\u4f18\u5316\u54ea\u4e2a\u8fdb\u7a0b\u7684 IO \u6a21\u578b\uff0c\u6211\u4eec\u5fc3\u4e2d\u5c31\u6709\u5e95\u4e86\u3002</p> </li> <li> <p>\u5185\u90e8\u539f\u7406</p> <p>\u4e0e <code>iostat</code> \u547d\u4ee4\u4e00\u6837\uff0c<code>iotop</code> \u53ea\u662f\u4e00\u4e2a\u5e94\u7528\u8f6f\u4ef6\uff0c\u7528\u6765\u7edf\u8ba1\u6240\u6709\u8fdb\u7a0b\u7684 IO \u6570\u636e\u5e76\u663e\u793a\u3002</p> <p>\u8fdb\u7a0b\u548c IO \u64cd\u4f5c\u6570\u636e\u5fc5\u5b9a\u6765\u6e90\u4e8e Linux \u5185\u6838\uff0c\u90a3 <code>iotop</code> \u600e\u4e48\u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u5462\uff1f\u5728 Linux \u4e0a\u8fd9\u4e9b\u5185\u6838\u6570\u636e\uff0c\u90fd\u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u63d0\u4f9b\u7684\uff0c\u5373\u8981\u83b7\u53d6\u4ec0\u4e48\u6570\u636e\uff0c\u5c31\u8bfb\u53d6\u4ec0\u4e48\u6587\u4ef6\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u60f3\u6cd5\uff0c\u4e0b\u9762\u6211\u4eec\u8bd5\u9a8c\u4e00\u4e0b\uff0c\u770b\u770b <code>iotop</code> \u662f\u4e0d\u662f\u4e5f\u662f\u8bfb\u53d6\u4e86\u4e00\u4e9b /proc \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5462\u3002\u5176\u5b9e <code>iotop</code> \u662f\u5f00\u6e90\u7684\uff0c\u6211\u4eec\u4e0d\u59a8\u4e0b\u8f7d\u5b83\u7684\u4ee3\u7801\u6765\u7814\u7a76\u4e00\u4e0b\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>class ProcessList(DumpableObject):\n    def __init__(self, taskstats_connection, options):\n        # {pid: ProcessInfo}\n        self.processes = {}\n        self.taskstats_connection = taskstats_connection\n        self.options = options\n        self.timestamp = time.time()\n        self.vmstat = vmstat.VmStat()\n\n        # A first time as we are interested in the delta\n        self.update_process_counts()\n\n    def get_process(self, pid):\n        \"\"\"Either get the specified PID from self.processes or build a new\n        ProcessInfo if we see this PID for the first time\"\"\"\n        process = self.processes.get(pid, None)\n        if not process:\n            process = ProcessInfo(pid)\n            self.processes[pid] = process\n\n        if process.is_monitored(self.options):\n            return process\n\n    def list_tgids(self):\n        if self.options.pids:\n            return self.options.pids\n\n        tgids = os.listdir('/proc')\n        if self.options.processes:\n            return [int(tgid) for tgid in tgids if '0' &lt;= tgid[0] &lt;= '9']\n\n        tids = []\n        for tgid in tgids:\n            if '0' &lt;= tgid[0] &lt;= '9':\n                try:\n                    tids.extend(map(int, os.listdir('/proc/' + tgid + '/task')))\n                except OSError:\n                    # The PID went away\n                    pass\n        return tids\n\n    def list_tids(self, tgid):\n        if not self.options.processes:\n            return [tgid]\n\n        try:\n            tids = map(int, os.listdir('/proc/%d/task' % tgid))\n        except OSError:\n            return []\n\n        if self.options.pids:\n            tids = list(set(self.options.pids).intersection(set(tids)))\n\n        return tids\n\n    def update_process_counts(self):\n        new_timestamp = time.time()\n        self.duration = new_timestamp - self.timestamp\n        self.timestamp = new_timestamp\n\n        for tgid in self.list_tgids():\n            process = self.get_process(tgid)\n            if not process:\n                continue\n            for tid in self.list_tids(tgid):\n                thread = process.get_thread(tid, self.taskstats_connection)\n                stats = self.taskstats_connection.get_single_task_stats(thread)\n                if stats:\n                    thread.update_stats(stats)\n                    thread.mark = False\n\n        return self.vmstat.delta()\n</code></pre> <p>\u6211\u4eec\u6765\u68b3\u7406\u4e00\u4e0b\u4e0a\u8ff0\u4ee3\u7801\u90fd\u505a\u4e86\u4ec0\u4e48\u3002\u5728 <code>ProcessList</code> \u7c7b\u7684\u6784\u9020\u65b9\u6cd5 <code>__init__</code> \u4e2d\uff0c\u4f1a\u8c03\u7528 <code>update_process_counts</code> \u65b9\u6cd5\uff0c\u63a5\u7740\u5728\u5176\u4e2d\u8c03\u7528 <code>list_tgids</code> \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u6253\u5f00 /proc \u76ee\u5f55\u83b7\u53d6\u6240\u6709\u4ee5\u6570\u5b57\u547d\u540d\u7684\u76ee\u5f55\u540d\u79f0\uff0c\u90a3\u5c31\u662f TGID\u3002</p> <p>TGID \u5c31\u662f\u7ebf\u7a0b\u7ec4 ID\uff0c\u5bf9\u4e8e\u540c\u4e00\u8fdb\u7a0b\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\uff0cTGID \u90fd\u662f\u4e00\u81f4\u7684\uff0c\u4e5f\u5c31\u662f\u8be5\u8fdb\u7a0b\u7684\u8fdb\u7a0b ID\u3002</p> <p>\u63a5\u7740\u5faa\u73af\u8c03\u7528 get_process \u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u4f1a\u6784\u9020 <code>ProcessInfo</code> \u5bf9\u8c61\u4ee5\u83b7\u53d6\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u6570\u636e\u3002</p> <p><code>ProcessInfo</code> \u7c7b\u7684\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a </p> <pre><code>class ProcessInfo(DumpableObject):\n    def __init__(self, pid):\n        self.pid = pid\n        self.uid = None\n        self.user = None\n        self.threads = {} # {tid: ThreadInfo}\n        self.stats_delta = Stats.build_all_zero()\n        self.stats_accum = Stats.build_all_zero()\n        self.stats_accum_timestamp = time.time()\n\n    def get_uid(self):\n        if self.uid:\n            return self.uid\n        try:\n            uid = os.stat('/proc/%d' % self.pid)[stat.ST_UID]\n        except OSError:\n            # The process disappeared\n            uid = None\n        if uid != self.uid:\n            # Maybe the process called setuid()\n            self.user = None\n            self.uid = uid\n        return uid\n\n    def get_user(self):\n        uid = self.get_uid()\n        if uid is not None and not self.user:\n            try:\n                self.user = safe_utf8_decode(pwd.getpwuid(uid).pw_name)\n            except KeyError:\n                self.user = str(uid)\n        return self.user or '{none}'\n\n    def get_proc_status_name(self):\n        try:\n            first_line = open('/proc/%d/status' % self.pid).readline()\n        except IOError:\n            return '{no such process}'\n        prefix = 'Name:\\t'\n        if first_line.startswith(prefix):\n            name = first_line[6:].strip()\n        else:\n            name = ''\n        if name:\n            name = '[%s]' % name\n        else:\n            name = '{no name}'\n        return name\n\n    def get_cmdline(self):\n        # A process may exec, so we must always reread its cmdline\n        try:\n            proc_cmdline = open('/proc/%d/cmdline' % self.pid)\n            cmdline = proc_cmdline.read(4096)\n        except IOError:\n            return '{no such process}'\n        #\u2026\u2026\n        return safe_utf8_decode(cmdline)\n\n    def did_some_io(self, accumulated):\n        if accumulated:\n            return not self.stats_accum.is_all_zero()\n        for t in self.threads.itervalues():\n            if not t.stats_delta.is_all_zero():\n                return True\n        return False\n\n    def get_ioprio(self):\n        priorities = set(t.get_ioprio() for t in self.threads.itervalues())\n        if len(priorities) == 1:\n            return priorities.pop()\n        return '?dif'\n\n    def set_ioprio(self, ioprio_class, ioprio_data):\n        for thread in self.threads.itervalues():\n            thread.set_ioprio(ioprio_class, ioprio_data)\n\n    def ioprio_sort_key(self):\n        return ioprio.sort_key(self.get_ioprio())\n\n    def get_thread(self, tid, taskstats_connection):\n        thread = self.threads.get(tid, None)\n        if not thread:\n            thread = ThreadInfo(tid, taskstats_connection)\n            self.threads[tid] = thread\n        return thread\n\n    def update_stats(self):\n        stats_delta = Stats.build_all_zero()\n        for tid, thread in self.threads.items():\n            if thread.mark:\n                del self.threads[tid]\n            else:\n                stats_delta.accumulate(thread.stats_delta, stats_delta)\n\n        nr_threads = len(self.threads)\n        if not nr_threads:\n            return False\n\n        stats_delta.blkio_delay_total /= nr_threads\n        stats_delta.swapin_delay_total /= nr_threads\n\n        self.stats_delta = stats_delta\n        self.stats_accum.accumulate(self.stats_delta, self.stats_accum)\n\n        return True\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\uff0c\u65e0\u4e00\u4f8b\u5916\u90fd\u662f\u4ece /proc \u76ee\u5f55\u4e0b\u90a3\u4e9b\u6570\u5b57\u547d\u540d\u7684\u5b50\u76ee\u5f55\u91cc\u83b7\u53d6\u6570\u636e\u3002\u6211\u4eec\u4e0d\u59a8\u6253\u5f00 proc \u76ee\u5f55\u89c2\u5bdf\u4e00\u4e0b\uff0c\u5e76\u4e14\u6211\u4eec\u8fd8\u8981\u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684\u3001\u6570\u5b57\u547d\u540d\u7684\u5b50\u76ee\u5f55\u8fdb\u5165\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u8fd9\u662f\u8c37\u6b4c\u6d4f\u89c8\u5668\u7684\u8fdb\u7a0b\uff0c\u91cc\u9762\u5305\u542b\u5f88\u591a\u5b50\u76ee\u5f55\uff0c\u8fd9\u4e9b\u5b50\u76ee\u5f55\u4e2d\u5305\u62ec\u4e86\u8fdb\u7a0b\u7684\u72b6\u6001\u3001\u5c5e\u6027\u3001\u5e94\u7528\u7a0b\u5e8f\u547d\u4ee4\u3001\u6253\u5f00\u7684\u6587\u4ef6\u3001IO\u3001\u7f51\u7edc\u3001\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u3001\u5de5\u4f5c\u76ee\u5f55\u3001\u6743\u9650\u3001\u8c03\u5ea6\u4fe1\u606f\u7b49\u5927\u91cf\u4fe1\u606f\u6570\u636e\u3002</p> <p>\u5173\u4e8e\u8fdb\u7a0b\u7684\u6240\u6709\u4fe1\u606f\uff0c\u6211\u4eec\u4ece\u8fd9\u91cc\u90fd\u53ef\u4ee5\u627e\u5230\u3002\u800c <code>iotop</code> \u4e5f\u6b63\u662f\u4ece\u8fd9\u91cc\u83b7\u53d6\u6570\u636e\uff0c\u7136\u540e\u8ba1\u7b97\u548c\u663e\u793a\u7684\uff0c\u8fd9\u5c31\u662f <code>iotop</code> \u7684\u5de5\u4f5c\u539f\u7406\u3002</p> </li> </ul> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_8","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_9","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u8bf7\u8bf4\u4e00\u8bf4 <code>iostat</code> \u4e0e <code>iotop</code> \u7684\u4e0d\u540c\u4e4b\u5904\uff1f</p> <p><code>iostat</code> \u7528\u4e8e\u5757\u8bbe\u5907\u6d3b\u52a8\u7684\u7edf\u8ba1\u60c5\u51b5\uff0c\u50cf\u786c\u76d8\u3001flash \u7b49\uff0c\u540c\u65f6\u4e5f\u80fd\u6c47\u62a5\u51fa CPU \u4f7f\u7528\u60c5\u51b5\uff0c\u4f46\u662f\u53ea\u80fd\u770b\u7cfb\u7edf\u6574\u4f53\u7684IO\u8d44\u6e90\u5f00\u9500\uff0c\u65e0\u6cd5\u770b\u67d0\u4e2a\u5e94\u7528\u6216\u8005\u8fdb\u7a0b\u7684IO\u4f7f\u7528\u60c5\u51b5\u3002\u5728User\u6743\u9650\u5373\u53ef\u7528</p> <p>\u800c <code>iotop</code> \u5219\u53ef\u4ee5\u770b\u6bcf\u4e2a\u8fdb\u7a0b\u7684 I/O\u4f7f\u7528\u60c5\u51b5\uff0c\u5e76\u4e14\u662f\u5728root\u6743\u9650\u7528\u7684\u3002</p> <p>Your understanding is mostly correct, but let's further clarify the differences between <code>iostat</code> and <code>iotop</code>:</p> <p>iostat: - Purpose: <code>iostat</code> is a system monitoring tool that reports CPU utilization and I/O statistics for block devices (such as hard disks, SSDs, etc.). - Overall System View: It provides an overview of the system's I/O performance, including disk throughput, I/O operations per second, and CPU utilization. - User Permission: <code>iostat</code> can be run with user-level permissions and does not require root access. - Focus: It focuses on the system-level I/O activity and does not provide detailed information about individual processes or applications generating I/O.</p> <p>iotop: - Purpose: <code>iotop</code> is a utility that specifically monitors and displays I/O usage information for individual processes. - Per-Process View: It shows real-time I/O usage statistics for each running process, allowing you to identify which processes are consuming the most I/O resources. - Root Access: <code>iotop</code> requires root privileges to run because it accesses sensitive system information about individual processes. - Focus: It is useful for pinpointing I/O-intensive processes that may be causing performance issues or bottlenecks on the system.</p> <p>In summary, while both <code>iostat</code> and <code>iotop</code> provide insights into I/O activity, <code>iostat</code> offers a system-wide view of I/O performance, including CPU utilization, while <code>iotop</code> focuses on per-process I/O usage, helping you identify and troubleshoot specific process-level I/O issues.</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#4","title":"4\uff5c\u6587\u4ef6\u4ed3\u5e93\uff1a\u521d\u8bc6\u6587\u4ef6\u4e0e\u6587\u4ef6\u7cfb\u7edf","text":"<p>Linux \u4e4b\u4e0b\u4e00\u5207\u7686\u6587\u4ef6</p> <p>\u6570\u636e\u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u50a8\u5b58\u4e0b\u6765\u7684\uff0c\u800c\u6587\u4ef6\u6570\u91cf\u4e00\u591a\uff0c\u5c31\u9700\u8981\u6587\u4ef6\u7cfb\u7edf\u6765\u7ba1\u7406\u6587\u4ef6\uff0c\u800c\u6587\u4ef6\u7cfb\u7edf\u6b63\u662f\u5efa\u7acb\u5728\u4e4b\u524d\u6211\u4eec\u5b66\u8fc7\u7684 IO \u5757\u8bbe\u5907\u4e4b\u4e0a\uff0c\u4eca\u5929\u6211\u5c31\u5e26\u4f60\u4e86\u89e3\u4e00\u4e0b\u4ec0\u4e48\u662f\u6587\u4ef6\uff0c\u4ec0\u4e48\u662f\u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_10","title":"\u4ec0\u4e48\u662f\u6587\u4ef6","text":"<p>\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u6211\u4eec\u63d0\u5230\u7684\u6587\u4ef6\u901a\u5e38\u662f\u6307\u516c\u6587\u3001\u4fe1\u4ef6\uff0c\u800c\u8ba1\u7b97\u673a\u4e2d\u7684\u6587\u4ef6\u4e0e\u65e5\u5e38\u89c1\u5230\u7684\u6587\u4ef6\u8f7d\u4f53\u4e0d\u540c\uff0c\u662f\u4ee5\u8ba1\u7b97\u673a\u786c\u76d8\u4e3a\u8f7d\u4f53\u3001\u5b58\u50a8\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u4fe1\u606f\u96c6\u5408\u3002\u8fd9\u4e9b\u4fe1\u606f\u96c6\u5408\u7684\u5448\u73b0\u5f62\u5f0f\u975e\u5e38\u591a\u6837\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u6587\u6863\u3001\u56fe\u7247\u3001\u97f3\u4e50\u3001\u89c6\u9891\u3001\u5e94\u7528\u7a0b\u5e8f\u7b49\u3002\u6587\u4ef6\u901a\u5e38\u7531\u6587\u4ef6\u540d\u8fdb\u884c\u6807\u8bc6\u548c\u7d22\u5f15\u3002</p> <pre><code>int main()\n{\n    int fd = -1;\n    // \u6253\u5f00\u5e76\u5efa\u7acb\u6587\u4ef6,\u6240\u6709\u7528\u6237\u53ef\u8bfb\u5199\n    fd = open(\"empty.file\", O_RDWR|O_CREAT, S_IRWXU|S_IRWXO|S_IRWXG);\n    if(fd &lt; 0)\n    {\n        printf(\"\u5efa\u7acb\u6587\u4ef6\u5931\u8d25\\n\");\n        return -1;\n    }\n    // \u5173\u95ed\u6587\u4ef6\n    close(fd);\n    return 0;\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3a <code>empty.file</code> \u7684\u6587\u4ef6\u3002</p> <p>\u4f46\u662f\u6ce8\u610f\uff0c\u6211\u4eec\u5e76\u6ca1\u5411\u8be5\u6587\u4ef6\u4e2d\u5199\u5165\u4efb\u4f55\u6570\u636e\uff0c\u5e76\u4e14\u4f60\u53ef\u4ee5\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u770b\u5230\uff0c\u8be5\u6587\u4ef6\u7684\u5927\u5c0f\u4e3a 0\u3002</p> <p>\u8fd9\u8bf4\u660e\u4e86\u6587\u4ef6\u4e0d\u4e00\u5b9a\u8981\u6709\u6570\u636e\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u6807\u8bc6\uff0c</p> <p>\u8fd9\u4e2a\u6807\u8bc6\u53ef\u4ee5\u65e2\u6807\u8bc6\u6570\u636e\u3001\u8bbe\u5907\uff0c\u8fd8\u53ef\u4ee5\u6807\u8bc6\u63a5\u53e3\uff08\u5982 /proc \u76ee\u5f55\u4e0b\u7684\u90a3\u4e9b\u6587\u4ef6\uff0c\u5176\u5b9e\u5185\u6838\u63d0\u4f9b\u7ed9\u8fdb\u7a0b\u7684\u3001\u7528\u6765\u8bbf\u95ee\u7279\u6b8a\u6570\u636e\u7684\u63a5\u53e3\uff09\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u518d\u7ed9\u6587\u4ef6\u4e0b\u4e2a\u5b9a\u4e49\uff0c\u5c31\u53ef\u4ee5\u8bf4\u6587\u4ef6\u4ece\u5e7f\u4e49\u4e0a\u5c31\u662f\u4e00\u79cd\u8d44\u6e90\u6807\u8bc6\u6216\u8005\u5bf9\u8c61\u6807\u8bc6\u3002</p> <pre><code>int main()\n{\n    struct stat filestat;\n    int fd = -1;\n    char ch[] = {0, 1, 0xff, 'L', 'M', 'O', 'S'};\n    // \u6253\u5f00\u5e76\u5efa\u7acb\u6587\u4ef6,\u6240\u6709\u7528\u6237\u53ef\u8bfb\u5199\n    fd = open(\"empty.file\", O_RDWR|O_CREAT, S_IRWXU|S_IRWXO|S_IRWXG);\n    if(fd &lt; 0)\n    {\n        printf(\"\u5efa\u7acb\u6587\u4ef6\u5931\u8d25\\n\");\n        return -1;\n    }\n    // \u5411\u6587\u4ef6\u4e2d\u5199\u51653\u4e2a\u5b57\u8282\uff0c0\uff0c1\uff0c0xff\uff0c\u5b83\u4eec\u6765\u6e90\u4e8ech\u6570\u7ec4\n    write(fd, ch, 3);\n    // \u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\uff0c\u6bd4\u5982\u6587\u4ef6\u5927\u5c0f\n    fstat(fd, &amp;filestat);\n    printf(\"\u6587\u4ef6\u5927\u5c0f:%ld\\n\", filestat.st_size);\n    // \u5173\u95ed\u6587\u4ef6\n    close(fd);\n    return 0;\n}\n\n//\u7ed3\u679c\uff1a\u6587\u4ef6\u5927\u5c0f\u4e3a 3\n</code></pre> <p>\u4ece\u72ed\u4e49\u8bf4\uff0c\u5e38\u89c4\u6587\u4ef6\u662f\u4e00\u4e2a\u4fe1\u606f\u6570\u636e\u96c6\u5408\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002</p> <p>\u518d\u8fdb\u4e00\u6b65\uff1a</p> <p>\u6240\u8c13\u666e\u901a\u6587\u4ef6\u7684\u7ed3\u6784\uff0c\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u53ef\u4ee5\u52a8\u6001\u589e\u957f\u7684\u7ebf\u6027\u5b57\u8282\u6570\u7ec4\u3002</p> <p>\u65e0\u8bba\u6587\u4ef6\u662f\u4ec0\u4e48\u7c7b\u578b\u6216\u8005\u591a\u5927\u7684\u6570\u636e\uff0c\u90fd\u4f1a\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u5b57\u8282\uff0c\u5360\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5b57\u8282\u7a7a\u95f4\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u7406\u89e3\u4e86\u6587\u4ef6\u662f\u4e00\u79cd\u6807\u8bc6\uff0c\u4e5f\u63a8\u7406\u51fa\u4e86\u6587\u4ef6\u50a8\u5b58\u6570\u636e\u7684\u7ed3\u6784\u662f\u4ec0\u4e48\u6837\u5b50\uff0c</p> <p>\u4f46\u662f\u8be5\u600e\u4e48\u63cf\u8ff0\u4e00\u4e2a\u6587\u4ef6\u5462\uff1f</p> <p>\u63cf\u8ff0\u4e00\u4e2a\u6587\u4ef6\u81ea\u8eab\u4e5f\u9700\u8981\u5f88\u591a\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u4fe1\u606f\u79f0\u4e3a\u6587\u4ef6\u5143\u4fe1\u606f\u3002\u6bd4\u5982\u4e0a\u9762\u7528\u6765\u8868\u793a\u6587\u4ef6\u5927\u5c0f\u7684\u4fe1\u606f\uff0c\u5c31\u662f\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u3002\u4e0d\u8fc7\uff0c\u6587\u4ef6\u4e0d\u5149\u6709\u5927\u5c0f\u7684\u4fe1\u606f\uff0c\u8fd8\u6709\u5176\u5b83\u522b\u7684\u5143\u4fe1\u606f\u3002</p> <pre><code>int main()\n{\n    struct stat filestat;\n    int fd = -1;\n    char ch[] = {0, 1, 0xff, 'L', 'M', 'O', 'S'};\n    // \u6253\u5f00\u5e76\u5efa\u7acb\u6587\u4ef6,\u6240\u6709\u7528\u6237\u53ef\u8bfb\u5199\n    fd = open(\"empty.file\", O_RDWR|O_CREAT, S_IRWXU|S_IRWXO|S_IRWXG);\n    if(fd &lt; 0)\n    {\n        printf(\"\u5efa\u7acb\u6587\u4ef6\u5931\u8d25\\n\");\n        return -1;\n    }\n    // \u5411\u6587\u4ef6\u4e2d\u5199\u51657\u4e2a\u5b57\u8282\uff0c0\uff0c1\uff0c0xff\uff0cL\uff0cM\uff0cO\uff0cS\u5b83\u4eec\u6765\u6e90\u4e8ech\u6570\u7ec4\n    write(fd, ch, 7);\n    // \u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\uff0c\u6bd4\u5982\u6587\u4ef6\u5927\u5c0f\n    fstat(fd, &amp;filestat);\n    printf(\"\u6587\u4ef6\u5927\u5c0f:%ld\\n\", filestat.st_size);\n    printf(\"\u6587\u4ef6\u6a21\u5f0f:%d\\n\", filestat.st_mode);\n    printf(\"\u6587\u4ef6\u8282\u70b9\u53f7:%ld\\n\", filestat.st_ino);\n    printf(\"\u6587\u4ef6\u6240\u5728\u8bbe\u5907\u53f7:%ld\\n\", filestat.st_dev);\n    printf(\"\u6587\u4ef6\u7279\u6b8a\u8bbe\u5907\u53f7:%ld\\n\", filestat.st_rdev);\n    printf(\"\u6587\u4ef6\u8fde\u63a5\u6570:%ld\\n\", filestat.st_nlink);\n    printf(\"\u6587\u4ef6\u6240\u5c5e\u7528\u6237:%d\\n\", filestat.st_uid);\n    printf(\"\u6587\u4ef6\u6240\u5c5e\u7528\u6237\u7ec4:%d\\n\", filestat.st_gid);\n    printf(\"\u6587\u4ef6\u6700\u540e\u8bbf\u95ee\u65f6\u95f4:%ld\\n\", filestat.st_atime);\n    printf(\"\u6587\u4ef6\u6700\u540e\u4fee\u6539\u65f6\u95f4:%ld\\n\", filestat.st_mtime);\n    printf(\"\u6587\u4ef6\u72b6\u6001\u6539\u5a08\u65f6\u95f4:%ld\\n\", filestat.st_ctime);\n    printf(\"\u6587\u4ef6\u5bf9\u5e94\u7684\u5757\u5927\u5c0f:%ld\\n\", filestat.st_blksize);\n    printf(\"\u6587\u4ef6\u5360\u7528\u591a\u5c11\u5757:%ld\\n\", filestat.st_blocks);\n    // \u5173\u95ed\u6587\u4ef6\n    close(fd);\n    return 0;\n}\n</code></pre> <ul> <li> <p><code>dev</code> \u8868\u793a\u6587\u4ef6\u6240\u5728\u7684\u8bbe\u5907\u53f7\uff0c</p> </li> <li> <p><code>rdev</code> \u5219\u662f\u5f53\u6587\u4ef6\u662f\u8bbe\u5907\u7c7b\u578b\u65f6\u7684\u8bbe\u5907\u53f7\u3002</p> </li> <li> <p>\u6587\u4ef6\u6a21\u5f0f\u80fd\u8868\u793a\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u3002</p> </li> <li> <p>\u6587\u4ef6\u8282\u70b9\u5219\u8868\u793a\u8be5\u6587\u4ef6\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u5bf9\u5e94\u7684 <code>inode</code>\u53f7\u7801\u3002</p> <ul> <li> <p><code>inode</code> \u662f\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6807\u8bc6\u4e00\u4e2a\u6587\u4ef6\u7684\u5143\u4fe1\u606f\uff0c\u4e0a\u9762\u4ee3\u7801\u8fd9\u4e9b\u4fe1\u606f\u5927\u591a\u90fd\u6765\u81ea <code>inode</code> \u7ed3\u6784\uff0c</p> <p>\u8fd9\u4e9b\u4fe1\u606f\u8bbf\u95ee\u3001\u4fee\u6539\u3001\u72b6\u6001\u6539\u53d8\u7684\u65f6\u95f4\u662f\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u3002\u4e0a\u9762\u7684\u6570\u636e\u76f8\u540c\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u5728\u4e00\u77ac\u95f4\u5b8c\u6210\u4e86\u6587\u4ef6\u7684\u521b\u5efa\u548c\u4fee\u6539\u3002</p> </li> </ul> </li> <li> <p>\u7528\u6237 id \u548c\u7528\u6237\u7ec4 id \u5219\u8868\u793a\u8be5\u6587\u4ef6\u662f\u54ea\u4e2a\u7528\u6237\u5efa\u7acb\u7684\uff0c\u5c5e\u4e8e\u54ea\u4e2a\u7528\u6237\u7ec4\u3002</p> </li> </ul> <p>---&gt; \u603b\u7ed3\uff1a</p> <p>\u4e0a\u9762\u7684\u5404\u79cd\u4fe1\u606f\uff0c\u90fd\u662f\u4e00\u4e2a\u666e\u901a\u6587\u4ef6\u5b83\u81ea\u8eab\u7684\u4fe1\u606f\uff0c\u4f46\u662f\u6587\u4ef6\uff0c\u4f60\u8fd8\u9700\u8981\u653e\u4e1c\u897f\u653e\u6570\u636e\u5440\uff01\u7528\u4ec0\u4e48\uff1f\u7d22\u5f15\uff01\u6307\u9488\uff01</p> <p>\u6240\u4ee5\u601d\u8003\uff1a\u5bf9\u4e8e\u4efb\u4f55\u4e1c\u897f\uff0c\u90fd\u5e94\u8be5\u6709\u5b83\u81ea\u5df1\u7684\u5c5e\u6027\uff0c\u6240\u4ee5\u63cf\u8ff0\u4e00\u4e2a\u4e1c\u897f\u65f6\uff0c\u5e94\u8be5\u4e3a \u81ea\u8eab\u5c5e\u6027 + \u5176\u529f\u80fd\u3002</p> <p>\u6587\u4ef6\u3001\u6587\u4ef6\u7cfb\u7edf\u90fd\u662f\u8fd9\u6837\uff0c\u522b\u7684\u9886\u57df\u5e94\u8be5\u4e5f\u662f</p> <p>\u6587\u4ef6\u81ea\u8eab\u6570\u636e\u7ed3\u6784\u56fe\uff1a</p> <p></p> <p>\u7531\u4e0a\u56fe\u53ef\u77e5\uff0c\u4e00\u4e2a\u666e\u901a\u6587\u4ef6\u5fc5\u987b\u6709\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u4e00\u4e2a\u90e8\u5206\u4e3a\u6587\u4ef6\u5143\u6570\u636e\uff0c\u4e00\u90e8\u5206\u4e3a\u6587\u4ef6\u50a8\u5b58\u7684\u6570\u636e\u3002</p> <p>\u6587\u4ef6\u5728\u786c\u76d8\u4e0a\u4ee5\u5757\u4e3a\u5355\u4f4d\u50a8\u5b58\uff0c\u8fd9\u4e9b\u5757\u7684\u5757\u53f7\u5728\u5143\u4fe1\u606f\u4e2d\u6309\u7167\u987a\u5e8f\u7d22\u5f15\u8d77\u6765\uff0c\u5c31\u662f\u6574\u4e2a\u6587\u4ef6\u7684\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u6570\u636e\u6587\u4ef6\u3002</p> <p>\u666e\u901a\u6570\u636e\u6587\u4ef6\u7684\u4fe1\u606f\u90fd\u5b58\u5728\u50a8\u5b58\u8bbe\u5907\u4e0a\uff0c\u8fd9\u4e2a\u8bbe\u5907\u901a\u5e38\u662f\u786c\u76d8\u6216\u786c\u76d8\u5206\u533a\uff08\u786c\u76d8\u7684\u4e00\u90e8\u5206\uff09\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_11","title":"\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u6211\u4eec\u53ea\u8981\u786e\u5b9a\u5143\u6570\u636e\u548c\u6587\u4ef6\u6570\u636e\u5206\u522b\u653e\u5728\u54ea\u4e9b\u6247\u533a\u5c31\u53ef\u4ee5\uff0c\u65e0\u8bba\u662f\u67e5\u627e\u3001\u8bfb\u5199\u3001\u5220\u9664\uff0c\u600e\u4e48\u5904\u7406\u90fd\u5f88\u5bb9\u6613\u3002</p> <p>\u4e0d\u5e78\u7684\u662f\uff0c\u6587\u4ef6\u4e0d\u53ef\u80fd\u53ea\u6709\u4e00\u4e2a\uff0c\u800c\u662f\u6709\u6210\u5343\u4e0a\u4e07\u751a\u81f3\u66f4\u591a\uff0c\u6240\u4ee5\u8fd9\u5c31\u5fc5\u987b\u8981\u8bbe\u8ba1\u51fa\u4e00\u5957\u7cfb\u7edf\u65b9\u6848\uff0c\u6765\u89e3\u51b3\u591a\u4e2a\u6587\u4ef6\u7684\u64cd\u4f5c\u7ba1\u7406\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u804a\u804a\u6587\u4ef6\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u4e00\u4e2a\u5de8\u5927\u7684\u529f\u80fd\u6a21\u5757\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf\u662f\u64cd\u4f5c\u7cfb\u7edf\u5728\u5b58\u50a8\u8bbe\u5907\uff08\u5e38\u89c1\u7684\u662f\u786c\u76d8\u3001U \u76d8\u3001CD\uff0c\u6216\u8005\u5176\u5206\u533a\uff09\u4e0a\u6784\u5efa\u7684\u50a8\u5b58\u6587\u4ef6\u65b9\u6cd5\u548c\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u5728\u5b58\u50a8\u8bbe\u5907\u4e0a\u7ec4\u7ec7\u6587\u4ef6\u7684\u65b9\u6cd5\u3002\uff08\u4e5f\u5c31\u662f\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff09</p> <p>\u7531\u4e8e\u8fd9\u4e2a\u529f\u80fd\u6a21\u5757\u89c4\u6a21\u5f88\u5927\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e13\u95e8\u8d77\u4e86\u4e00\u4e2a\u540d\u79f0\uff0c\u628a\u8d1f\u8d23\u7ba1\u7406\u548c\u5b58\u50a8\u6587\u4ef6\u7684\u529f\u80fd\u6a21\u5757\u79f0\u4e3a\u6587\u4ef6\u7ba1\u7406\u7cfb\u7edf\uff0c\u7b80\u79f0\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u662f</p> <ul> <li>\u6587\u4ef6\u7cfb\u7edf\u7684\u63a5\u53e3</li> <li>\u5bf9\u6587\u4ef6\u64cd\u4f5c\u548c\u7ba1\u7406\u7684\u529f\u80fd\u96c6</li> <li>\u6587\u4ef6\u53ca\u5176\u5c5e\u6027\u3002</li> </ul> <p>\u4ece\u64cd\u4f5c\u7cfb\u7edf\u89d2\u5ea6\u6765\u770b\uff0c\u6587\u4ef6\u7cfb\u7edf\u7684\u804c\u8d23\u662f\u7ec4\u7ec7\u548c\u5206\u914d\u5b58\u50a8\u8bbe\u5907\u7684\u7a7a\u95f4\u3001\u6587\u4ef6\u5b58\u50a8\uff0c\u4ee5\u53ca\u5bf9\u5b58\u5165\u7684\u6587\u4ef6\u8fdb\u884c\u4fdd\u62a4\u548c\u68c0\u7d22\u3002</p> <p>\u5177\u4f53\u70b9\u6765\u8bf4\uff0c\u6587\u4ef6\u7cfb\u7edf\u7ed9\u7528\u6237\u63d0\u4f9b\u4e86\u6587\u4ef6\u76f8\u5173\u64cd\u4f5c\u7684\u4e00\u6761\u9f99\u670d\u52a1\uff0c\u5305\u62ec\u4e3a\u7528\u6237\u5efa\u7acb\u3001\u5b58\u5165\u3001\u8bfb\u51fa\u3001\u4fee\u6539\u3001\u8f6c\u50a8\u6587\u4ef6\uff0c\u63a7\u5236\u6587\u4ef6\u7684\u5b58\u53d6\u8bfb\u53d6\u6587\u4ef6\uff0c\u5f53\u7528\u6237\u4e0d\u518d\u4f7f\u7528\u65f6\u8fd8\u4f1a\u5220\u9664\u6587\u4ef6\u3002</p> <p>\u4e00\u4e2a\u786c\u76d8\u4e2d\u7684\u5404\u4e2a\u5206\u533a\u4e0a\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u662f\u5728\u4f7f\u7528\u4e4b\u524d\uff0c\u6211\u4eec\u8981\u5bf9\u8be5\u5206\u533a\u8fdb\u884c\u683c\u5f0f\u5316\u3002</p> <p>\u6240\u8c13\u683c\u5f0f\u5316\uff0c\u5c31\u662f\u5411\u8be5\u5206\u533a\u5199\u5165\u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5206\u914d\u5206\u533a\u4e2d\u76f8\u5173\u6247\u533a\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u6709\u4e86\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u548c\u4fe1\u606f\uff0c\u7528\u6237\u5e94\u7528\u624d\u80fd\u5728\u6587\u4ef6\u7cfb\u7edf\u91cc\u5b58\u653e\u6587\u4ef6\u3002</p> <p>\u867d\u7136\u6587\u4ef6\u7cfb\u7edf\u7684\u6838\u5fc3\u6570\u636e\u7ed3\u6784\uff0c\u73b0\u5728\u6211\u4eec\u8fd8\u6ca1\u6cd5\u76f4\u89c2\u5730\u611f\u53d7\u5230\uff0c\u4f46\u662f\u5b83\u5728\u4e0a\u5c42\u4e3a\u7528\u6237\u6216\u8005\u8fdb\u7a0b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u903b\u8f91\u89c6\u56fe\uff0c\u4e5f\u5c31\u662f\u76ee\u5f55\u7ed3\u6784\uff0c\u4e00\u4e2a\u5012\u7f6e\u7684\u6811\u5f62\u7ed3\u6784\u3002</p> <p>\u6811\u7684\u5206\u652f\u7ed3\u6784\u4e0a\u662f\u76ee\u5f55\u6216\u8005\u6587\u4ef6\u3002\u4ece\u6700\u4e0a\u5c42\u7684 /\uff08\u6839\uff09\u76ee\u5f55\u5f00\u59cb\uff0c\u5c31\u80fd\u627e\u5230\u6bcf\u4e2a\u6587\u4ef6\u3001\u6bcf\u4e2a\u76ee\u5f55\u548c\u6bcf\u4e2a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002\u76ee\u5f55\u5bf9\u6587\u4ef6\u8fdb\u884c\u5206\u5c42\u5206\u7c7b\uff0c\u76ee\u7684\u662f\u65b9\u4fbf\u7528\u6237\u5bf9\u4f17\u591a\u6587\u4ef6\u505a\u7ba1\u7406\u3002\u6839\u636e\u4e0b\u9762\u8def\u5f84\u80fd\u627e\u5230\u4efb\u610f\u6587\u4ef6\uff1a</p> <p>/home/user1/file1\uff0c\u6839\u201c/\u201d\u76ee\u5f55\u4e0b\u201chome\u201d\u76ee\u5f55\u91cc\u7684\u201cfile1\u201d\u6587\u4ef6\u3002</p> <p></p> <p>\u60f3\u60f3\u770b\uff0c\u4f60\u73b0\u5728\u77e5\u9053\u4e86\u6587\u4ef6\u7cfb\u7edf\u7684\u903b\u8f91\u7ed3\u6784\uff0c\u4f60\u4f1a\u600e\u4e48\u8bbe\u8ba1\uff1f</p> <p>\u600e\u4e48\u5c06\u73b0\u5b9e\u751f\u6d3b\u4e2d\u5404\u79cd\u9519\u7efc\u590d\u6742\u7684\u6570\u636e\u653e\u5165\u8ba1\u7b97\u673a\u5462\uff1f</p> <ol> <li>\u5c06\u73b0\u5b9e\u751f\u6d3b\u4e2d\u7684\u6570\u636e\u7ec4\u7ec7\u6210\u5404\u79cd\u903b\u8f91\u7ed3\u6784</li> <li>\u5c06\u903b\u8f91\u7ed3\u6784\u7684\u6570\u636e\u6620\u5c04\u5230\u8ba1\u7b97\u673a\u7684\u7269\u7406\u7ed3\u6784\uff08\u5b58\u50a8\u7ed3\u6784\uff09\u4e2d</li> </ol> <p>\u6211\u4eec\u5148\u5f97\u8bbe\u8ba1\u63cf\u8ff0\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4fe1\u606f\u7684\u7ed3\u6784\uff0c\u5176\u6b21\u8981\u6709\u63cf\u8ff0\u76ee\u5f55\u7684\u4fe1\u606f\u7ed3\u6784\uff0c\u7136\u540e\u662f\u63cf\u8ff0\u6587\u4ef6\u5143\u4fe1\u606f\u7ed3\u6784\uff0c\u6700\u540e\u522b\u5fd8\u4e86\u6587\u4ef6\u6570\u636e\u5757\u7ed3\u6784\u3002</p> <p>\u5176\u5b9e\uff0cLinux \u4e0a\u4f17\u591a\u6587\u4ef6\u7cfb\u7edf\u90fd\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\uff0c\u5373\u4f7f\u5404\u6587\u4ef6\u7cfb\u7edf\u5728\u7ec6\u8282\u4e0a\u6709\u4e9b\u53d8\u5316\uff0c\u4f46\u662f\u90fd\u5177\u6709\u7c7b\u4f3c\u7684\u901a\u7528\u7ed3\u6784\uff0c</p> <p>\u5176\u4e2d\u5fc3\u6982\u5ff5\u79bb\u4e0d\u5f00<code>\u8d85\u7ea7\u5757</code>\u3001<code>\u76ee\u5f55\u7ed3\u6784</code>\u3001<code>inode \u8282\u70b9</code>\u3001<code>\u6570\u636e\u5757</code>\u3002\u4e0b\u9762\u6211\u4eec\u5206\u522b\u8fdb\u884c\u8ba8\u8bba\u3002</p> <ul> <li> <p>\u6570\u636e\u5757</p> <p>\u6587\u4ef6\u7cfb\u7edf\u6570\u636e\u7ed3\u6784\u4e5f\u662f\u5b58\u653e\u5728\u6570\u636e\u5757\u4e2d\u7684\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e48\u591a\u6587\u4ef6\u7cfb\u7edf\u8bbe\u8ba1\uff0c\u6587\u4ef6\u7cfb\u7edf\u9996\u5148\u4f1a\u628a\u786c\u76d8\u6216\u8005\u786c\u76d8\u5206\u533a\u5212\u5206\u4e3a\u4e00\u4e2a\u4e2a\u6570\u636e\u5757\uff0c\u6bcf\u4e2a\u6570\u636e\u5757\u5927\u5c0f\u662f\u786c\u76d8\u6247\u533a\u7684\u6574\u6570\u500d\uff0c\u5178\u578b\u7684\u6570\u636e\u5757\u5927\u5c0f\u662f 1024 \u5b57\u8282\u6216\u8005 4096 \u5b57\u8282\u3002</p> <p>\u8fd9\u4e2a\u5927\u5c0f\uff0c\u65e2\u53ef\u4ee5\u5728\u683c\u5f0f\u5316\u786c\u76d8\u6216\u8005\u786c\u76d8\u5206\u533a\u521b\u5efa\u6587\u4ef6\u7cfb\u7edf\u7684\u65f6\u5019\u51b3\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u7531\u7ba1\u7406\u5458\u624b\u52a8\u6307\u5b9a\uff0c\u8fd8\u53ef\u4ee5\u5728\u6587\u4ef6\u7cfb\u7edf\u7684\u521b\u5efa\u65f6\u6839\u636e\u786c\u76d8\u5206\u533a\u7684\u5927\u5c0f\uff0c\u52a8\u6001\u9009\u62e9\u4e00\u4e2a\u8f83\u5408\u7406\u7684\u503c\u3002</p> </li> <li> <p>\u8d85\u7ea7\u5757</p> <p>\u8d85\u7ea7\u5757\u4e00\u822c\u4f1a\u653e\u5728\u786c\u76d8\u5206\u533a\u7684\u7b2c\u4e00\u4e2a/\u7b2c\u4e8c\u4e2a\u6570\u636e\u5757\u4e2d\u3002\u8d85\u7ea7\u5757\u4e2d\u7684\u6570\u636e\u662f \u63cf\u8ff0\u6587\u4ef6\u7cfb\u7edf \u7684\u63a7\u5236\u4fe1\u606f\uff0c\u4e0d\u662f\u63cf\u8ff0\u6587\u4ef6\u7684\uff08\u522b\u641e\u6df7\uff09</p> <p>\u6709\u5173\u8be5\u6587\u4ef6\u7cfb\u7edf\u7684\u5927\u90e8\u5206\u4fe1\u606f\u90fd\u4fdd\u5b58\u5728\u8d85\u7ea7\u5757\u4e2d\uff1a</p> <ul> <li>\u6bd4\u5982\u786c\u76d8\u5206\u533a\u4e2d\u6709\u591a\u5c11\u4e2a\u6570\u636e\u5757\uff0c\u6bcf\u4e2a\u6570\u636e\u5757\u7684\u5927\u5c0f\u3001\u6709\u591a\u5c11\u4e2a\u7a7a\u95f2\u6570\u636e\u5757\u3001\u6587\u4ef6\u7cfb\u7edf\u72b6\u6001\u3001\u6709\u591a\u5c11\u76ee\u5f55\u6216\u8005\u6587\u4ef6\u3001\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u3001UUID\u3001\u4f4d\u56fe\u4fe1\u606f\u7b49\u3002</li> </ul> <p>\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u548c\u63cf\u8ff0\u4e00\u4e2a\u53ef\u6b63\u5e38\u5de5\u4f5c\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> </li> <li> <p>\u76ee\u5f55\u7ed3\u6784\uff08\u6587\u4ef6\u540d\u79f0 + <code>inode</code>\u53f7\uff09</p> <p>\u76ee\u5f55\u7ed3\u6784\u5f88\u7b80\u5355\uff0c\u91cc\u9762\u5c31\u662f\u6587\u4ef6\u540d\u79f0\u548c <code>inode</code> \u53f7\u7ec4\u6210\u7684\u76ee\u5f55\u9879\uff1a\u4e00\u4e2a\u76ee\u5f55\u9879\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a\u76ee\u5f55\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p>\u6240\u6709\u7684\u76ee\u5f55\u9879\u5171\u540c\u7ec4\u6210\u4e86\u76ee\u5f55\u6587\u4ef6\uff08\u7279\u6b8a\u7684\u6587\u4ef6\uff09\u3002</p> <p>\u6839\u636e\u76ee\u5f55\u9879\u7684 <code>inode</code> \u8282\u70b9\u53f7\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u7684 <code>inode</code>\u3002</p> </li> <li> <p><code>inode</code></p> <p>\u4e4b\u524d\u8bb2\u8fc7\uff0c\u6587\u4ef6\uff1a\u6587\u4ef6\u5143\u6570\u636e(\u81ea\u8eab\u6570\u636e) + \u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u3002</p> <p>\u6587\u4ef6\u7684\u6570\u636e\u90fd\u653e\u5728\u6570\u636e\u5757\u91cc\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u4f7f\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u6587\u4ef6\u7684\u5143\u4fe1\u606f\uff0c\u8fd9\u79cd\u5b58\u50a8\u6587\u4ef6\u5143\u4fe1\u606f\u7684\u6570\u636e\u7ed3\u6784\u53eb\u505a <code>inode</code>\uff08\u5373\u7d22\u5f15\u8282\u70b9\uff0c\u4e5f\u7ecf\u5e38\u53eb\u4f5c <code>inode</code> \u8282\u70b9\uff09\u3002</p> <p>\u6bcf\u4e00\u4e2a\u6587\u4ef6\u90fd\u6709\u5bf9\u5e94\u7684 <code>inode</code>\uff0c<code>inode</code> \u5305\u542b\u4e86\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u9664\u4e86\u6587\u4ef6\u540d\u4ee5\u5916\u7684\u6240\u6709\u6587\u4ef6\u4fe1\u606f\uff0c\u90fd\u4fdd\u5b58\u5728 <code>inode</code> \u4e4b\u4e2d\uff0c\uff08\u6587\u4ef6\u540d\u79f0\u5728\u76ee\u5f55\u6761\u76ee\u4e2d\uff09\uff0c\u4e3b\u8981\u6709\u6587\u4ef6\u7684\u5b57\u8282\u6570\u3001\u6587\u4ef6\u7684\u6240\u5c5e <code>uid</code>\u3001\u6587\u4ef6\u7684\u6240\u5c5e\u7ec4 <code>GID</code>\u3001\u6587\u4ef6\u7684\u8bfb\u3001\u5199\u3001\u6267\u884c\u6743\u9650\uff0c\u4ee5\u53ca\u6587\u4ef6\u7684\u521b\u5efa\u3001\u4fee\u6539\u65f6\u95f4\u7b49\u3002</p> <ul> <li> <p>\u548c\u6570\u636e\u5757\u7684\u5173\u7cfb\uff1a</p> <p>\u6700\u91cd\u8981\u7684\u662f\uff0c<code>inode</code> \u8282\u70b9\u4e2d\u5305\u62ec\u6570\u636e\u5757\u7684\u5730\u5740\uff0c\u7528\u4e8e\u7d22\u5f15\u6587\u4ef6\u5bf9\u5e94\u7684\u6570\u636e\u3002</p> <p>\u4f46 <code>inode</code> \u8282\u70b9\u4e2d\u53ea\u6709\u5c11\u91cf\u6570\u636e\u5757\u6570\u7684\u5730\u5740\uff0c\u5982\u679c\u9700\u8981\u66f4\u591a\uff0c\u5c31\u9700\u8981\u52a8\u6001\u5206\u914d\u6307\u5411\u6570\u636e\u5757\u7684\u5730\u5740\u7a7a\u95f4\u3002\u8fd9\u4e9b\u52a8\u6001\u5206\u914d\u7684\u6570\u636e\u5757\u662f\u95f4\u63a5\u5730\u5740\u6570\u636e\u5757\uff0c\u4e3a\u4e86\u627e\u5230\u6570\u636e\u5757\uff0c\u5fc5\u987b\u5148\u627e\u5230\u95f4\u63a5\u5730\u5740\u6570\u636e\u5757\u7684\uff0c\u7136\u540e\u4ece\u91cc\u9762\u627e\u5230\u6587\u4ef6\u7684\u6570\u636e\u5757\u5730\u5740\u3002</p> <p>\u8fd9\u4e2a\u95f4\u63a5\u5730\u5740\u5757\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u4e8c\u91cd\u6307\u9488\uff0c\u5c31\u662f\u5728\u4e00\u5757\u5730\u65b9\u5b58\u50a8\u4e86\u771f\u5b9e\u5b58\u50a8\u6570\u636e\u7684\u5730\u5740\uff0c\u7136\u540e\u53ef\u4ee5\u5148\u62ff\u5230\u5b58\u6570\u636e\u5730\u5740\u7684\u5730\u5740\uff0c\u83b7\u53d6\u5230\u6570\u636e\u5730\u5740\uff0c\u518d\u53bb\u6570\u636e\u3002\u800c <code>inode</code> \u91cc\u7684\u76f4\u63a5\u5730\u5740\uff0c\u5c31\u6ca1\u6709\u5f00\u59cb\u90a3\u4e00\u6b65\uff0c\u76f4\u63a5\u62ff\u5730\u5740\uff0c\u53d6\u6570\u636e\u3002</p> </li> <li> <p>\u5173\u4e8e <code>struct stat</code> \u548c <code>inode</code></p> <p>In Linux, the <code>struct stat</code> and <code>inode</code> are closely related concepts, but they serve different purposes in the file system.</p> <ul> <li> <p>The <code>struct stat</code> is a data structure used by system calls to retrieve information about a file, such as its size, permissions, timestamps, and other attributes. When a program calls functions like <code>stat()</code> or <code>fstat()</code>, the operating system populates a <code>struct stat</code> object with metadata about the specified file.</p> </li> <li> <p>On the other hand, an <code>inode</code> (index node) is a data structure used by the file system to store information about a file on disk. Each file in a Unix-like file system is represented by an <code>inode</code>, which contains metadata such as file size, ownership, permissions, timestamps, and pointers to the actual data blocks on disk.</p> </li> </ul> <p>The relationship between <code>struct stat</code> and <code>inode</code> can be understood as follows: - When a program requests file information using <code>stat()</code> or <code>fstat()</code>, the operating system reads the <code>inode</code> of the file from disk and populates a <code>struct stat</code> object with the relevant information stored in the <code>inode</code>. - The <code>struct stat</code> object in memory provides a convenient way for programs to access and manipulate file attributes without directly interacting with the low-level <code>inode</code> data structures.</p> <p>In summary, while both <code>struct stat</code> and <code>inode</code> store file information, they serve different roles: <code>struct stat</code> is used by programs to access file metadata in memory, while <code>inodes</code> are used by the file system to store detailed file information on disk. (software and hardware) / (Bottom and upper floors)</p> <p>(Alternative: if you have learnt the C++)analogous classes and objects(instances):</p> <p>In C++, a class serves as a blueprint or template for creating objects. It defines the structure and behavior of objects of that class. </p> <p>When you create an object of a class, you are instantiating that class to create a specific instance with its own set of data.</p> <p>Similarly, in Linux: - The <code>struct stat</code> serves as a template or data structure definition for storing file information in memory. - When a program requests file information using functions like <code>stat()</code> or <code>fstat()</code>,      - The operating system first read s the <code>inode</code> of the specific file from disk to attain some detailed metadata about the file, such as its size, ownership, and pointers to the data blocks on disk.     - And uses the <code>struct stat</code> template to create an instance (object) in memory that holds the metadata of the specified file.</p> <p>In this analogy: - The <code>struct stat</code> can be seen as the class definition that specifies the fields and structure of the file metadata. - Each time file information is retrieved and stored in memory, it creates an instance of the <code>struct stat</code> object with the specific attributes of that file.</p> <p>Just like how you can create multiple objects of a class in C++, the operating system can create multiple instances of the <code>struct stat</code> object to hold information about different files. Each instance (object) of <code>struct stat</code> represents the metadata of a specific file, similar to how objects represent specific instances of a class in C++.</p> </li> </ul> </li> </ul> <p>\u6709\u4e86\u4e0a\u8ff0\u56db\u5927\u6838\u5fc3\u7ed3\u6784\uff0c\u5c31\u53ef\u4ee5\u8868\u793a\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e86\u3002</p> <p>\u5176\u5b9e Linux \u5bf9 <code>\u8d85\u7ea7\u5757\u7ed3\u6784</code>\u3001<code>\u76ee\u5f55\u7ed3\u6784</code>\uff0c<code>inode \u7ed3\u6784</code> \u3001<code>\u6570\u636e\u5757</code>\uff0c\u8fd8\u505a\u4e86\u8fdb\u4e00\u6b65\u62bd\u8c61\uff0c\u628a\u8fd9\u4e9b\u7ed3\u6784\u52a0\u5165\u4e86\u64cd\u4f5c\u51fd\u6570\u96c6\u5408,</p> <p>\u5f62\u6210\u4e86 VFS\uff0c\u5373\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u53ea\u8981\u8f6f\u4ef6\u6a21\u5757\u80fd\u63d0\u4f9b\u4e0a\u8ff0\u56db\u5927\u6838\u5fc3\u7ed3\u6784\u7684\u64cd\u4f5c\u51fd\u6570\u96c6\u5408\uff0c\u751f\u6210\u8d85\u7ea7\u5757\u7ed3\u6784\uff0c\u5c31\u53ef\u4ee5\u5f62\u6210\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5b9e\u4f8b\uff0c\u5b89\u88c5\u5230 VFS \u4e2d\u3002</p> <p>\u6709\u4e86 VFS \u5c42\u5c31\u53ef\u4ee5\u5411\u4e0a\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u5411\u4e0b\u517c\u5bb9\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u8ba9 Linux \u80fd\u591f\u540c\u65f6\u5b89\u88c5\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u67b6\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f60\u6709\u6ca1\u6709\u53d1\u73b0\uff1f\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u9886\u57df\u7684\u5f88\u591a\u95ee\u9898\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u4e00\u4e2a\u4e2d\u95f4\u7684\u62bd\u8c61\u5c42\u6765\u89e3\u51b3\u3002</p> <p>\u4e0a\u56fe\u4e2d Linux \u7684 VFS \u5c42\u5c31\u662f\u5e94\u7528\u548c\u8bb8\u591a\u6587\u4ef6\u7cfb\u7edf\u4e4b\u95f4\u7684\u62bd\u8c61\u5c42\u3002VFS \uff0c\u5411\u4e0b\u89c4\u8303\u4e86\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u8981\u63a5\u5165 VFS \u5fc5\u9700\u8981\u5b9e\u73b0\u7684\u673a\u5236\u3002</p> <p>\u4e3a\u6b64\uff0cVFS \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u6570\u636e\u7ed3\u6784\uff0c\u5982 <code>files</code>\u3001<code>superblock</code>\u3001<code>dentry</code>\u3001<code>inode</code> \u7ed3\u6784\uff0c\u8fd8\u89c4\u5b9a\u4e86\u5177\u4f53\u6587\u4ef6\u7cfb\u7edf\u5e94\u8be5\u5b9e\u73b0\u751f\u6210\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u7684\u56de\u8c03\u51fd\u6570\u3002</p> <p>\u8fd9\u6837\uff0c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757\u5c31\u53ef\u4ee5\u88ab\u5b89\u88c5\u5230 VFS \u4e2d\u4e86\u3002\u64cd\u4f5c\u5177\u4f53\u6587\u4ef6\u65f6\uff0cVFS \u4f1a\u6839\u636e\u9700\u8981\u8c03\u7528\u5177\u4f53\u6587\u4ef6\u7cfb\u7edf\u7684\u51fd\u6570\u3002</p> <p>\u4ece\u6b64\u6587\u4ef6\u7cfb\u7edf\u7684\u7ec6\u8282\u5c31\u88ab VFS \u5c4f\u853d\u4e86\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u8c03\u7528\u6807\u51c6\u7684\u63a5\u53e3\u5c31\u884c\u4e86\u3002</p> <p>\u4e5f\u6b63\u56e0\u5982\u6b64\uff0cLinux \u53ef\u4ee5\u652f\u6301 EXT\u3001XFS\u3001BTRFS\u3001FAT\u3001NTFS \u7b49\u591a\u8fbe\u5341\u51e0\u79cd\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u4e0d\u7ba1\u5728\u4ec0\u4e48\u50a8\u5b58\u8bbe\u5907\u4e0a\u4f7f\u7528\u4ec0\u4e48\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e5f\u4e0d\u7ba1\u8bbf\u95ee\u4ec0\u4e48\u6587\u4ef6\uff0c\u90fd\u53ef\u4ee5\u7edf\u4e00\u5730\u4f7f\u7528\u4e00\u5957\u7c7b\u4f3c open()\u3001read()\u3001write()\u3001close() \u7684\u63a5\u53e3\u3002</p> <p>\u5982\u8981\u6df1\u5165\u5b66\u4e60\uff0c\u770b\u300a\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u6218\u300b45\u8bb2\u7684\u7b2c\u4e09\u5341\u4e94\u8282\u8bfe35 | \u77a7\u4e00\u77a7Linux\uff1a\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u5982\u4f55\u7ba1\u7406\u6587\u4ef6\uff1f-\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u621845\u8bb2-\u6781\u5ba2\u65f6\u95f4 (geekbang.org)</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_12","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_13","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u601d\u8003\u9898\u4e00\u822c\u7684 Linux \u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u90fd\u6709\u54ea\u4e9b\u5185\u90e8\u7ed3\u6784\uff1f</p> <p>\u8d85\u7ea7\u5757\u3001\u76ee\u5f55\u7ed3\u6784\u3001\u6570\u636e\u5757\u3001<code>inode</code>\u7ed3\u70b9</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#5linuxlinux","title":"5\uff5cLinux\u6587\u4ef6\u7cfb\u7edf\uff08\u4e00\uff09\uff1aLinux\u5982\u4f55\u5b58\u653e\u6587\u4ef6\uff1f","text":"<p>\u63a5\u4e0b\u6765\u7684\u4e24\u8282\u8bfe\uff0c\u6211\u4eec\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60 Linux \u4e0a\u7684\u4e00\u4e2a\u5177\u4f53\u7684\u6587\u4ef6\u7cfb\u7edf\u2014\u2014Ext3\uff0c\u641e\u6e05\u695a\u4e86\u6587\u4ef6\u7a76\u7adf\u662f\u5982\u4f55\u5b58\u653e\u7684\u3002</p> <p>\u6211\u4eec\u5148\u5efa\u7acb\u4e00\u4e2a\u865a\u62df\u786c\u76d8\uff0c\u5e76\u5728\u4e0a\u9762\u5efa\u7acb\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u6765\u5bf9\u7167\u4ee3\u7801\u5b9e\u4f8b\uff0c\u6df1\u5165\u8ba4\u8bc6 Ext3</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_14","title":"\u5efa\u7acb\u865a\u62df\u786c\u76d8","text":"<p>\u6211\u4eec\u9009\u62e9\u865a\u62df\u786c\u76d8\uff0c\u5728\u8fd9\u4e2a\u865a\u62df\u786c\u76d8\u4e0a\u64cd\u4f5c\uff0c\u8fd9\u6837\u600e\u4e48\u6298\u817e\u90fd\u4e0d\u4f1a\u6709\u4e8b\u3002</p> <p>\u5176\u5b9e\u6211\u4eec\u662f\u7528 Linux \u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u6765\u6a21\u62df\u786c\u76d8\u7684\uff0c\u5199\u5165\u786c\u76d8\u7684\u6570\u636e\u53ea\u662f\u5199\u5165\u4e86\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <p>\u6240\u4ee5\u5efa\u7acb\u865a\u62df\u786c\u76d8\uff0c\u5c31\u76f8\u5f53\u4e8e\u751f\u6210\u4e00\u4e2a\u5bf9\u5e94\u7684\u6587\u4ef6\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u8981\u5efa\u7acb\u4e00\u4e2a 100MB \u7684\u786c\u76d8\uff0c\u5c31\u610f\u5473\u7740\u6211\u4eec\u8981\u751f\u6210 100MB \u7684\u5927\u6587\u4ef6\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u7528 Linux \u4e0b\u7684 dd \u547d\u4ee4\uff08\u7528\u6307\u5b9a\u5927\u5c0f\u7684\u5757\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u5728\u62f7\u8d1d\u7684\u540c\u65f6\u8fdb\u884c\u6307\u5b9a\u7684\u8f6c\u6362\uff09\u751f\u6210 100MB \u7684\u7eaf\u4e8c\u8fdb\u5236\u7684\u6587\u4ef6\uff08\u5c31\u662f\u5411 1\uff5e100M \u5b57\u8282\u7684\u6587\u4ef6\u91cc\u9762\u586b\u5145\u4e3a 0 \uff09\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>dd bs=512 if=/dev/zero of=hd.img count=204800\n\n;bs:\u8868\u793a\u5757\u5927\u5c0f\uff0c\u8fd9\u91cc\u662f512\u5b57\u8282\n;if\uff1a\u8868\u793a\u8f93\u5165\u6587\u4ef6\uff0c/dev/zero\u5c31\u662fLinux\u4e0b\u4e13\u95e8\u8fd4\u56de0\u6570\u636e\u7684\u8bbe\u5907\u6587\u4ef6\uff0c\u8bfb\u53d6\u5b83\u5c31\u8fd4\u56de0\n;of\uff1a\u8868\u793a\u8f93\u51fa\u6587\u4ef6\uff0c\u5373\u6211\u4eec\u7684\u786c\u76d8\u6587\u4ef6\n;count\uff1a\u8868\u793a\u8f93\u51fa\u591a\u5c11\u5757\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u5c31\u8981\u5728\u865a\u62df\u786c\u76d8\u4e0a\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u4e86\uff0c\u6240\u8c13\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u5c31\u662f\u5bf9\u865a\u62df\u786c\u76d8\u653e\u8fdb\u884c\u683c\u5f0f\u5316\u3002</p> <p>\u53ef\u662f\uff0c\u95ee\u9898\u6765\u4e86\u2014\u2014\u865a\u62df\u786c\u76d8\u6bd5\u7adf\u662f\u4e2a\u6587\u4ef6\uff0c\u5982\u4f55\u8ba9 Linux \u5728\u4e00\u4e2a\u6587\u4ef6\u4e0a\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u5462\uff1f\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u8981\u5206\u6210\u4e24\u6b65\u6765\u89e3\u51b3\u3002</p> <ul> <li> <p>\u7b2c\u4e00\u6b65\uff0c\u628a\u865a\u62df\u786c\u76d8\u6587\u4ef6\u53d8\u6210 Linux \u4e0b\u7684\u56de\u73af\u8bbe\u5907\uff0c\u8ba9 Linux \u4ee5\u4e3a\u8fd9\u662f\u4e2a\u8bbe\u5907\u3002\u4e0b\u9762\u6211\u4eec\u7528 <code>losetup</code> \u547d\u4ee4\uff0c\u5c06 <code>hd.img</code> \u8fd9\u4e2a\u6587\u4ef6\u53d8\u6210 Linux \u7684\u56de\u73af\u8bbe\u5907\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>sudo losetup /dev/loop0 hd.img\n</code></pre> </li> <li> <p>\u7b2c\u4e8c\u6b65\uff0c\u7531\u4e8e\u56de\u73af\u8bbe\u5907\u5c31\u662f Linux \u4e0b\u7684\u5757\u8bbe\u5907\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u662f\u786c\u76d8\u3001\u5149\u9a71\u6216\u8f6f\u9a71\u7b49\u8bbe\u5907\uff0c\u5e76\u4e14\u53ef\u4ee5\u7528 mount \u547d\u4ee4\u628a\u8be5\u56de\u73af\u8bbe\u5907\u6302\u8f7d\u5230\u7279\u5b9a\u76ee\u5f55\u4e0b\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 Linux \u4e0b\u7684 <code>mkfs.ext3</code> \u547d\u4ee4\uff0c\u628a\u8fd9\u4e2a /dev/loop0 \u56de\u73af\u5757\u8bbe\u5907\u683c\u5f0f\u5316\uff0c\u8fdb\u800c\u683c\u5f0f\u5316 <code>hd.img</code>\u6587\u4ef6\uff0c\u5728\u91cc\u9762\u5efa\u7acb Ext3 \u6587\u4ef6\u7cfb\u7edf\u3002</p> <pre><code>sudo mkfs.ext3 -q /dev/loop0 \n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cloop0 \u53ef\u80fd\u5df2\u7ecf\u88ab\u5360\u7528\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 loop1\u3001loop2 \u7b49\uff0c\u4f60\u9700\u8981\u6839\u636e\u81ea\u5df1\u7535\u8111\u7684\u60c5\u51b5\u5904\u7406\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528 mount \u547d\u4ee4\u5c06 <code>hd.img</code> \u6302\u8f7d\u5230\u7279\u5b9a\u7684\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u547d\u4ee4\u6267\u884c\u6210\u529f\uff0c\u5c31\u80fd\u9a8c\u8bc1\u6211\u4eec\u865a\u62df\u786c\u76d8\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u6210\u529f\u5efa\u7acb\u3002\u547d\u4ee4\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>sudo mount -o loop ./hd.img ./hdisk/ ;\u6302\u8f7d\u786c\u76d8\u6587\u4ef6\n</code></pre> <p>\u8fd9\u884c\u4ee3\u7801\u7684\u4f5c\u7528\u662f\uff0c\u5c06 <code>hd.img</code> \u8fd9\u4e2a\u6587\u4ef6\u4f7f\u7528 loop \u6a21\u5f0f\u6302\u8f7d\u5728 <code>./hdisk/</code> \u76ee\u5f55\u4e4b\u4e0b\uff0c\u901a\u8fc7\u8fd9\u4e2a <code>hdis</code>k \u76ee\u5f55\uff0c\u5c31\u80fd\u8bbf\u95ee\u5230 <code>hd.img</code> \u865a\u62df\u786c\u76d8\u4e86\u3002\u5e76\u4e14\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528\u5e38\u7528\u7684 <code>mkdir</code>\u3001<code>touch</code>\u547d\u4ee4\u5728\u8fd9\u4e2a\u865a\u62df\u786c\u76d8\u4e2d\u5efa\u7acb\u76ee\u5f55\u548c\u6587\u4ef6\u3002</p> </li> </ul>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3","title":"Ext3\u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784","text":"<p>\u6211\u4eec\u5efa\u597d\u4e86\u786c\u76d8\uff0c\u5bf9\u5176\u8fdb\u884c\u4e86\u683c\u5f0f\u5316\uff0c\u4e5f\u5728\u4e0a\u9762\u5efa\u7acb\u4e86 Ext3 \u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u7814\u7a76\u4e00\u4e0b Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u7ed3\u6784\u3002Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u5168\u79f0\u662f Third extended file system\uff0c\u5df2\u7ecf\u6709 20 \u591a\u5e74\u7684\u5386\u53f2\u4e86\uff0c\u662f\u4e00\u79cd\u53e4\u8001\u800c\u6210\u719f\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>Ext3 \u5728 Ext2 \u57fa\u7840\u4e0a\u52a0\u5165\u4e86\u65e5\u5fd7\u673a\u5236\uff0c\u4e5f\u7b97\u662f\u5bf9 Ext2 \u6587\u4ef6\u7cfb\u7edf\u7684\u6269\u5c55\uff0c\u5e76\u4e14\u4e5f\u80fd\u517c\u5bb9 Ext2\u3002Ext3 \u662f\u5728\u53d1\u5e03 Linux2.4.x \u7248\u672c\u65f6\u52a0\u5165\u7684\uff0c\u652f\u6301\u4fdd\u5b58\u4e0a TB \u7684\u6587\u4ef6\uff0c\u4fdd\u5b58\u7684\u6587\u4ef6\u6570\u91cf\u7531\u786c\u76d8\u5bb9\u91cf\u51b3\u5b9a\uff0c\u8fd8\u652f\u6301\u9ad8\u8fbe 255 \u5b57\u8282\u7684\u6587\u4ef6\u540d\u3002</p> <p>Ext3 \u7684\u5185\u90e8\u7ed3\u6784\u662f\u600e\u6837\u7684\u5462\uff1f</p> <p>Ext3 \u5c06\u4e00\u4e2a\u786c\u76d8\u5206\u533a\u5206\u4e3a\u5927\u5c0f\u76f8\u540c\u7684\u50a8\u5b58\u5757\uff0c\u6bcf\u4e2a\u50a8\u5b58\u5757\u53ef\u4ee5\u662f 2 \u4e2a\u6247\u533a\u30014 \u4e2a\u6247\u533a\u30018 \u4e2a\u6247\u533a\uff0c\u5206\u522b\u5bf9\u5e94\u5927\u5c0f\u4e3a 1KB\u30012KB\u30014KB\u3002\u6240\u6709\u7684\u50a8\u5b58\u5757\u53c8\u88ab\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u5757\u7ec4\uff0c\u6bcf\u4e2a\u5757\u7ec4\u4e2d\u7684\u50a8\u5b58\u5757\u6570\u91cf\u76f8\u540c\u3002</p> <p>\u786c\u76d8(\u5206\u533a) --&gt; \u5757\u7ec4 --&gt; \u5b58\u50a8\u5757 --&gt; \u5757 --&gt; \u6247\u533a </p> <p>\u6bcf\u4e2a\u5757\u7ec4\u524d\u9762\u82e5\u5e72\u4e2a\u50a8\u5b58\u5757\u4e2d\uff0c\u4f9d\u6b21\u653e\u7740\uff1a\u8d85\u7ea7\u5757\u3001\u5757\u7ec4\u63cf\u8ff0\u8868\u3001\u5757\u4f4d\u56fe\u3001<code>inode</code> \u8282\u70b9\u4f4d\u56fe\u3001<code>inode</code> \u8282\u70b9\u8868\u3001\u6570\u636e\u5757\u533a\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8d85\u7ea7\u5757\u548c\u5757\u7ec4\u63cf\u8ff0\u8868\u662f\u5168\u5c40\u6027\u7684\uff0c\u5728\u6bcf\u4e2a\u5757\u7ec4\u4e2d\u5b83\u4eec\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\u3002\u6211\u518d\u5e2e\u4f60\u753b\u4e00\u4e2a\u903b\u8f91\u7ed3\u6784\u56fe\uff0c\u4f60\u5c31\u5bb9\u6613\u7406\u89e3\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u7b2c 1 \u4e2a\u50a8\u5b58\u5757\u662f\u7528\u4e8e\u5b89\u88c5\u5f15\u5bfc\u7a0b\u5e8f\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u4fdd\u7559\u4e0d\u4f7f\u7528\u7684\u3002</p> <p>\u8d85\u7ea7\u5757\u5360\u7528\u4e00\u4e2a\u50a8\u5b58\u5757\uff0c\u5728\u7b2c 2 \u4e2a\u50a8\u5b58\u5757\u4e2d\uff0c\u5373\u50a8\u5b58\u5757 1\uff0c\u50a8\u5b58\u5757\u7684\u5757\u53f7\u662f\u9488\u5bf9\u6574\u4e2a\u5206\u533a\u7f16\u7801\u7684\uff0c\u4ece 0 \u5f00\u59cb\u3002</p> <p>\u5176\u4e2d\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\u3001\u5757\u4f4d\u56fe\u3001<code>inode</code> \u8282\u70b9\u4f4d\u56fe\u3001<code>inode</code> \u8282\u70b9\u8868\u7684\u5360\u7528\u5927\u5c0f\uff0c\u662f\u6839\u636e\u5757\u7ec4\u591a\u5c11\u4ee5\u53ca\u5757\u7ec4\u7684\u5927\u5c0f\u52a8\u6001\u8ba1\u7b97\u7684\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_1","title":"Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u8d85\u7ea7\u5757","text":"<p>\u6211\u4eec\u9996\u5148\u8981\u63a2\u8ba8\u7684\u662f Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u8d85\u7ea7\u5757\uff0c\u5b83\u63cf\u8ff0\u4e86 Ext3 \u7684\u6574\u4f53\u4fe1\u606f\uff0c\u4f8b\u5982\u6709\u591a\u5c11\u4e2a <code>inode</code> \u8282\u70b9\u3001\u591a\u5c11\u4e2a\u50a8\u5b58\u5757\u3001\u50a8\u5b58\u5757\u5927\u5c0f\u3001\u7b2c\u4e00\u4e2a\u6570\u636e\u5757\u53f7\u662f\u591a\u5c11\uff0c\u6bcf\u4e2a\u5757\u7ec4\u591a\u5c11\u4e2a\u50a8\u5b58\u5757\u7b49\u3002</p> <p>Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u8d85\u7ea7\u5757\u5b58\u653e\u5728\u8be5\u6587\u4ef6\u7cfb\u7edf\u6240\u5728\u5206\u533a\u7684 2 \u53f7\u6247\u533a\uff0c\u5360\u7528\u4e24\u4e2a\u6247\u533a\u3002\u5f53\u50a8\u5b58\u5757\u7684\u5927\u5c0f\u4e0d\u540c\u65f6\uff0c\u8d85\u7ea7\u5757\u6240\u5728\u5757\u53f7\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u5f53\u50a8\u5b58\u5757\u5927\u5c0f\u4e3a 1KB \u65f6\uff0c0 \u53f7\u5757\u662f\u5f15\u5bfc\u7a0b\u5e8f\u6216\u8005\u4fdd\u7559\u50a8\u5b58\u5757\uff0c\u8d85\u7ea7\u5757\u8d77\u59cb\u4e8e 1 \u53f7\u5757\u50a8\u5b58\uff1b</li> <li>\u5f53\u5757\u5927\u5c0f\u4e3a 2KB \u65f6\uff0c\u8d85\u7ea7\u5757\u8d77\u59cb\u4e8e 0 \u53f7\u50a8\u5b58\u5757\uff0c\u5176\u4f4d\u4e8e 0 \u53f7\u50a8\u5b58\u5757\u7684\u540e 1KB\uff0c\u524d 1KB \u662f\u5f15\u5bfc\u7a0b\u5e8f\u6216\u8005\u4fdd\u7559\uff1b</li> <li>\u5f53\u50a8\u5b58\u5757\u5927\u5c0f\u4e3a 4KB \u65f6\uff0c\u8d85\u7ea7\u5757\u4e5f\u8d77\u59cb\u4e8e 0 \u53f7\u50a8\u5b58\u5757\uff0c\u5176\u4f4d\u4e8e 0 \u53f7\u5757\u7684 1KB \u5904\u3002</li> </ul> <p>\u603b\u4e4b\\</p> <p>klkll\u8d85\u7ea7\u5757\u4f4d\u4e8e\u76f8\u5bf9\u4e8e\u5206\u533a\u7684 2 \u53f7~3 \u53f7\u6247\u533a\uff0c\u8fd9\u4e00\u70b9\u662f\u56fa\u5b9a\u7684\u3002\u4e0b\u9762\u6211\u4eec\u770b\u4e00\u770b\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u8d85\u7ea7\u5757\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>struct ext3_super_block {\n  __le32  s_inodes_count;    //inode\u8282\u70b9\u603b\u6570 \n  __le32  s_blocks_count;    // \u50a8\u5b58\u5757\u603b\u6570\n  __le32  s_r_blocks_count;  // \u4fdd\u7559\u7684\u50a8\u5b58\u5757\u6570\n  __le32  s_free_blocks_count;// \u7a7a\u95f2\u7684\u50a8\u5b58\u5757\u6570\n    __le32  s_free_inodes_count;// \u7a7a\u95f2\u7684inode\u8282\u70b9\u6570\n  __le32  s_first_data_block;  // \u7b2c\u4e00\u4e2a\u6570\u636e\u50a8\u5b58\u5757\u53f7\n  __le32  s_log_block_size;  // \u50a8\u5b58\u5757\u5927\u5c0f\n  __le32  s_log_frag_size;  // \u788e\u7247\u5927\u5c0f\n  __le32  s_blocks_per_group;  // \u6bcf\u5757\u7ec4\u5305\u542b\u7684\u50a8\u5b58\u5757\u6570\n  __le32  s_frags_per_group;  // \u6bcf\u5757\u7ec4\u5305\u542b\u7684\u788e\u7247\n  __le32  s_inodes_per_group;  // \u6bcf\u5757\u7ec4\u5305\u542b\u7684inode\u8282\u70b9\u6570\n  __le32  s_mtime;        // \u6700\u540e\u6302\u8f7d\u65f6\u95f4\n    __le32  s_wtime;      // \u6700\u540e\u5199\u5165\u65f6\u95f4\n  __le16  s_mnt_count;    // \u6302\u8f7d\u6b21\u6570\n  __le16  s_max_mnt_count;  // \u6700\u5927\u6302\u8f7d\u6b21\u6570\n  __le16  s_magic;      // \u9b54\u6570\n  __le16  s_state;      // \u6587\u4ef6\u7cfb\u7edf\u72b6\u6001\n  __le16  s_errors;      // \u9519\u8bef\u5904\u7406\u65b9\u5f0f\n  __le16  s_minor_rev_level;  // \u6b21\u7248\u672c\u53f7\n  __le32  s_lastcheck;    // \u6700\u540e\u68c0\u67e5\u65f6\u95f4\n  __le32  s_checkinterval;  // \u5f3a\u8feb\u4e00\u81f4\u6027\u68c0\u67e5\u7684\u6700\u5927\u95f4\u9694\u65f6\u95f4\n  __le32  s_creator_os;    // \u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u7684\u64cd\u4f5c\u7cfb\u7edf\n  __le32  s_rev_level;    // \u4e3b\u7248\u672c\u53f7\n  __le16  s_def_resuid;    // \u9ed8\u8ba4\u7528\u6237\u4fdd\u7559\u50a8\u5b58\u5757\n  __le16  s_def_resgid;    // \u9ed8\u8ba4\u7528\u6237\u7ec4\u4fdd\u7559\u50a8\u5b58\u5757\n  __le32  s_first_ino;    // \u7b2c\u4e00\u4e2a\u975e\u4fdd\u7559inode\u8282\u70b9\u53f7\n  __le16   s_inode_size;    // inode\u8282\u70b9\u5927\u5c0f\n  __le16  s_block_group_nr;  // \u5f53\u524d\u8d85\u7ea7\u5757\u6240\u5728\u5757\u7ec4\n  __le32  s_feature_compat;  // \u517c\u5bb9\u529f\u80fd\u96c6\n  __le32  s_feature_incompat;  // \u975e\u517c\u5bb9\u529f\u80fd\u96c6\n  __le32  s_feature_ro_compat;// \u53ea\u8bfb\u517c\u5bb9\u529f\u80fd\u96c6\n  __u8  s_uuid[16];      // \u5377\u7684UUID\uff08\u5168\u5c40ID\uff09\n  char  s_volume_name[16];  // \u5377\u540d\n  char  s_last_mounted[64];  // \u6587\u4ef6\u7cfb\u7edf\u6700\u540e\u6302\u8f7d\u8def\u5f84\n  __le32  s_algorithm_usage_bitmap; // \u4f4d\u56fe\u7b97\u6cd5\n      //\u7701\u7565\u4e86\u65e5\u5fd7\u76f8\u5173\u7684\u5b57\u6bb5  \n};\n</code></pre> <p>\u4ee5\u4e0a\u7684\u4ee3\u7801\u4e2d\u6211\u7701\u7565\u4e86\u65e5\u5fd7\u548c\u9884\u5206\u914d\u7684\u76f8\u5173\u5b57\u6bb5\uff0c\u800c __ le16\u3001__le32\uff0c\u5728 x86 \u4e0a\u5c31\u662f u16\u3001u32 \u7c7b\u578b\u7684\u6570\u636e\u3002le \u8868\u793a\u4ee5\u5c0f\u7aef\u5b57\u8282\u5e8f\u50a8\u5b58\u6570\u636e\uff0c\u5b9a\u4e49\u6210\u8fd9\u6837\uff0c\u662f\u4e3a\u4e86\u5927\u5c0f\u7aef\u4e0d\u540c\u7684 CPU \u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u6587\u4ef6\u7cfb\u7edf\uff0c\u6216\u8005\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u524d\u63d0\u4e0b\uff0c\u65b9\u4fbf\u8fdb\u884c\u6570\u636e\u8f6c\u6362\u3002</p> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 <code>__le16</code> \u548c <code>__le32</code> \u8fd9\u6837\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6587\u4ef6\u7cfb\u7edf\u7684\u8bbe\u8ba1\u8005\u53ef\u4ee5\u786e\u4fdd\u5728\u4e0d\u540c\u5927\u5c0f\u7aef\uff08\u5373\u5927\u7aef\u5e8f\u548c\u5c0f\u7aef\u5e8f\uff09\u7684CPU\u4e0a\u90fd\u53ef\u4ee5\u6b63\u786e\u89e3\u91ca\u6570\u636e\u3002\u8fd9\u79cd\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\u662f\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u7684\uff1a</p> <ol> <li>\u5c0f\u7aef\u5b57\u8282\u5e8f\uff08Little Endian\uff09\u548c\u5927\u7aef\u5b57\u8282\u5e8f\uff08Big Endian\uff09\uff1a</li> <li>\u5c0f\u7aef\u5b57\u8282\u5e8f\uff1a\u6570\u636e\u7684\u4f4e\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u5904\uff0c\u9ad8\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u9ad8\u5730\u5740\u5904\u3002</li> <li> <p>\u5927\u7aef\u5b57\u8282\u5e8f\uff1a\u6570\u636e\u7684\u9ad8\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u5904\uff0c\u4f4e\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u9ad8\u5730\u5740\u5904\u3002</p> </li> <li> <p><code>__le16</code> \u548c <code>__le32</code> \u6570\u636e\u7c7b\u578b\uff1a</p> </li> <li><code>__le16</code> \u8868\u793a\u4e00\u4e2a16\u4f4d\u6574\u6570\uff0c\u4ee5\u5c0f\u7aef\u5b57\u8282\u5e8f\u5b58\u50a8\u3002</li> <li> <p><code>__le32</code> \u8868\u793a\u4e00\u4e2a32\u4f4d\u6574\u6570\uff0c\u4ee5\u5c0f\u7aef\u5b57\u8282\u5e8f\u5b58\u50a8\u3002</p> </li> <li> <p>\u6570\u636e\u8f6c\u6362\uff1a</p> </li> <li>\u5f53\u5728\u4e00\u4e2a\u5c0f\u7aef\u5e8f\u7684CPU\u4e0a\u8bfb\u53d6\u4e00\u4e2a\u4ee5\u5c0f\u7aef\u5e8f\u5b58\u50a8\u7684\u6570\u636e\u65f6\uff0c\u6570\u636e\u7684\u5b57\u8282\u987a\u5e8f\u662f\u6b63\u786e\u7684\uff0c\u65e0\u9700\u8f6c\u6362\u3002</li> <li> <p>\u5f53\u5728\u4e00\u4e2a\u5927\u7aef\u5e8f\u7684CPU\u4e0a\u8bfb\u53d6\u4e00\u4e2a\u4ee5\u5c0f\u7aef\u5e8f\u5b58\u50a8\u7684\u6570\u636e\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u5b57\u8282\u987a\u5e8f\u8f6c\u6362\uff0c\u5c06\u6570\u636e\u7684\u5b57\u8282\u987a\u5e8f\u53cd\u8f6c\uff0c\u4ee5\u6b63\u786e\u89e3\u91ca\u6570\u636e\u3002</p> </li> <li> <p>\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\uff1a</p> </li> <li>\u901a\u8fc7\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4f7f\u7528 <code>__le16</code> \u548c <code>__le32</code> \u8fd9\u6837\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u5728\u4e0d\u540c\u5927\u5c0f\u7aef\u5e8f\u7684CPU\u4e0a\u8fdb\u884c\u6b63\u786e\u89e3\u91ca\uff0c\u56e0\u4e3a\u65e0\u8bba\u662f\u5927\u7aef\u5e8f\u8fd8\u662f\u5c0f\u7aef\u5e8f\u7684CPU\uff0c\u90fd\u53ef\u4ee5\u6839\u636e\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u6b63\u786e\u7684\u5b57\u8282\u987a\u5e8f\u8f6c\u6362\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u901a\u8fc7\u8bbe\u8ba1\u6587\u4ef6\u7cfb\u7edf\u65f6\u8003\u8651\u5230\u5927\u5c0f\u7aef\u5e8f\u7684\u95ee\u9898\uff0c\u5e76\u4f7f\u7528\u7279\u5b9a\u7684\u6570\u636e\u7c7b\u578b\u6765\u786e\u4fdd\u6570\u636e\u5728\u4e0d\u540c\u5927\u5c0f\u7aefCPU\u4e0a\u7684\u6b63\u786e\u89e3\u91ca\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6587\u4ef6\u7cfb\u7edf\u7684\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\u3002\u8fd9\u79cd\u8bbe\u8ba1\u53ef\u4ee5\u786e\u4fdd\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u5728\u4e0d\u540c\u67b6\u6784\u7684\u8ba1\u7b97\u673a\u4e0a\u4f7f\u7528\uff0c\u5e76\u4e14\u6570\u636e\u80fd\u591f\u88ab\u6b63\u786e\u5730\u8bfb\u53d6\u548c\u5904\u7406\u3002</p> <p>\u5728\u8ba1\u7b97\u673a\u4e2d\uff0c\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\uff08\u5927\u5c0f\u7aef\u5e8f\uff09\u662f\u7531CPU\u7684\u8bbe\u8ba1\u51b3\u5b9a\u7684\uff0c\u800cCPU\u662f\u901a\u8fc7\u5185\u90e8\u7684\u5bc4\u5b58\u5668\u548c\u6570\u636e\u603b\u7ebf\u6765\u5904\u7406\u6570\u636e\u7684\u3002\u4e0b\u9762\u662f\u5173\u4e8eCPU\u4ee5\u5927\u7aef\u5e8f\u6216\u5c0f\u7aef\u5e8f\u5b58\u50a8\u6570\u636e\u7684\u4e00\u4e9b\u57fa\u672c\u539f\u7406\uff1a</p> <ol> <li>\u5927\u7aef\u5e8f\uff08Big Endian\uff09\uff1a</li> <li>\u5728\u5927\u7aef\u5e8f\u4e2d\uff0c\u6570\u636e\u7684\u9ad8\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u5904\uff0c\u4f4e\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u9ad8\u5730\u5740\u5904\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a16\u4f4d\u6574\u6570 <code>0x1234</code>\uff0c\u5728\u5927\u7aef\u5e8f\u4e2d\uff0c\u5176\u5b58\u50a8\u5f62\u5f0f\u4e3a <code>0x12 0x34</code>\uff0c\u9ad8\u5b57\u8282\u5728\u4f4e\u5730\u5740\uff0c\u4f4e\u5b57\u8282\u5728\u9ad8\u5730\u5740\u3002</p> </li> <li> <p>\u5c0f\u7aef\u5e8f\uff08Little Endian\uff09\uff1a</p> </li> <li>\u5728\u5c0f\u7aef\u5e8f\u4e2d\uff0c\u6570\u636e\u7684\u4f4e\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u5904\uff0c\u9ad8\u4f4d\u5b57\u8282\u5b58\u50a8\u5728\u9ad8\u5730\u5740\u5904\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8e\u540c\u6837\u768416\u4f4d\u6574\u6570 <code>0x1234</code>\uff0c\u5728\u5c0f\u7aef\u5e8f\u4e2d\uff0c\u5176\u5b58\u50a8\u5f62\u5f0f\u4e3a <code>0x34 0x12</code>\uff0c\u4f4e\u5b57\u8282\u5728\u4f4e\u5730\u5740\uff0c\u9ad8\u5b57\u8282\u5728\u9ad8\u5730\u5740\u3002</p> </li> <li> <p>\u5185\u90e8\u5de5\u4f5c\u539f\u7406\uff1a</p> </li> <li>CPU\u5185\u90e8\u7684\u5bc4\u5b58\u5668\u548c\u6570\u636e\u603b\u7ebf\u4f1a\u6839\u636eCPU\u7684\u8bbe\u8ba1\u6765\u5904\u7406\u6570\u636e\u7684\u5b58\u50a8\u548c\u8bbf\u95ee\u3002</li> <li>\u5f53CPU\u8bfb\u53d6\u6216\u5199\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u5c06\u6570\u636e\u4ece\u5185\u5b58\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u6216\u8005\u5c06\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u636e\u5199\u56de\u5185\u5b58\u3002</li> <li> <p>CPU\u4f1a\u6839\u636e\u5176\u8bbe\u8ba1\u7684\u5927\u5c0f\u7aef\u65b9\u5f0f\uff0c\u5c06\u6570\u636e\u4ece\u5185\u5b58\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u6216\u5199\u56de\u5185\u5b58\u65f6\uff0c\u6309\u7167\u5bf9\u5e94\u7684\u5b57\u8282\u987a\u5e8f\u8fdb\u884c\u64cd\u4f5c\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u5927\u5c0f\u7aef\u5e8f\uff1a</p> </li> <li>\u5728\u4e00\u4e9bCPU\u67b6\u6784\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u7279\u5b9a\u7684\u5bc4\u5b58\u5668\u6216\u6807\u5fd7\u4f4d\u6765\u6307\u5b9aCPU\u4f7f\u7528\u7684\u5927\u5c0f\u7aef\u5e8f\u3002</li> <li>\u4f8b\u5982\uff0c\u67d0\u4e9bARM\u5904\u7406\u5668\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u63a7\u5236\u5bc4\u5b58\u5668\u6765\u9009\u62e9\u4f7f\u7528\u5927\u7aef\u5e8f\u6216\u5c0f\u7aef\u5e8f\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cCPU\u4ee5\u5927\u7aef\u5e8f\u8fd8\u662f\u5c0f\u7aef\u5e8f\u5b58\u50a8\u6570\u636e\u662f\u7531CPU\u7684\u8bbe\u8ba1\u51b3\u5b9a\u7684\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u4f1a\u5f71\u54cd\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u50a8\u65b9\u5f0f\u548c\u8bbf\u95ee\u987a\u5e8f\u3002\u4e0d\u540c\u7684CPU\u67b6\u6784\u53ef\u80fd\u91c7\u7528\u4e0d\u540c\u7684\u5927\u5c0f\u7aef\u65b9\u5f0f\uff0c\u800c\u8fd9\u79cd\u8bbe\u8ba1\u4f1a\u5bf9\u6570\u636e\u7684\u5b58\u50a8\u548c\u5904\u7406\u4ea7\u751f\u5f71\u54cd\u3002\u56e0\u6b64\uff0c\u5728\u8bbe\u8ba1\u6587\u4ef6\u7cfb\u7edf\u6216\u901a\u4fe1\u534f\u8bae\u65f6\uff0c\u9700\u8981\u8003\u8651\u4e0d\u540cCPU\u7684\u5927\u5c0f\u7aef\u65b9\u5f0f\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u7684\u6b63\u786e\u4f20\u8f93\u548c\u89e3\u91ca\u3002</p> <p>\u200b   </p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_2","title":"Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868","text":"<p>Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\uff0c\u91cc\u9762\u5b58\u653e\u7740\u7528\u6765\u63cf\u8ff0\u5757\u7ec4\u4e2d\u7684\u4f4d\u56fe\u5757\u8d77\u59cb\u5757\u53f7\u3001<code>inode</code> \u8282\u70b9\u8868\u8d77\u59cb\u5757\u53f7\u3001\u7a7a\u95f2 <code>inode</code> \u8282\u70b9\u6570\u3001\u7a7a\u95f2\u50a8\u5b58\u5757\u6570\u7b49\u4fe1\u606f\uff0c\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6bcf\u4e2a\u5757\u7ec4\u90fd\u6709\u8fd9\u6837\u7684\u4e00\u4e2a\u5757\u7ec4\u63cf\u8ff0\u7b26\u4e0e\u4e4b\u5bf9\u5e94\u3002</p> <p>\u6240\u6709\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\u96c6\u4e2d\u5b58\u653e\uff0c\u5c31\u5f62\u6210\u4e86\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\u3002</p> <p>\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\u7684\u8d77\u59cb\u5757\u53f7\u4f4d\u4e8e\u8d85\u7ea7\u5757\u6240\u5728\u5757\u53f7\u7684\u4e0b\u4e00\u4e2a\u5757\uff0c\u5728\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u5b58\u6709\u5f88\u591a\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\u7684\u5907\u4efd\uff0c\u5b58\u5728\u7684\u65b9\u5f0f\u4e0e\u8d85\u7ea7\u5757\u76f8\u540c\u3002\u4e0b\u9762\u6211\u4eec\u770b\u4e00\u770b\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5355\u4e2a\u5757\u7ec4\u63cf\u8ff0\u7b26\u7ed3\u6784\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>struct ext3_group_desc\n{\n  __le32  bg_block_bitmap;    // \u8be5\u5757\u7ec4\u4f4d\u56fe\u5757\u8d77\u59cb\u5757\u53f7\n  __le32  bg_inode_bitmap;    // \u8be5\u5757\u7ec4inode\u8282\u70b9\u4f4d\u56fe\u5757\u8d77\u59cb\u5757\u53f7\n  __le32  bg_inode_table;      // \u8be5\u5757\u7ec4inode\u8282\u70b9\u8868\u8d77\u59cb\u5757\u53f7\n  __le16  bg_free_blocks_count;  // \u8be5\u5757\u7ec4\u7684\u7a7a\u95f2\u5757\n  __le16  bg_free_inodes_count;  // \u8be5\u5757\u7ec4\u7684\u7a7a\u95f2inode\u8282\u70b9\u6570\n  __le16  bg_used_dirs_count;    // \u8be5\u5757\u7ec4\u7684\u76ee\u5f55\u8ba1\u6570\n  __u16  bg_pad;          // \u586b\u5145\n  __le32  bg_reserved[3];      // \u4fdd\u7559\u672a\u7528\n};\n</code></pre> <p>\u5bf9\u7167\u4e0a\u8ff0\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u591a\u4e2a ext3_group_desc \u7ed3\u6784\u5c31\u5f62\u6210\u4e86\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\uff0c\u800c __le16 __le32 \u7c7b\u578b\u548c\u8d85\u7ea7\u5757\u4e2d\u7684\u76f8\u540c\u3002\u5982\u679c\u60f3\u77e5\u9053\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u591a\u5c11\u4e2a\u5757\u7ec4\u63cf\u8ff0\u7b26\uff0c\u53ef\u4ee5\u901a\u8fc7\u8d85\u7ea7\u5757\u4e2d\u603b\u5757\u6570\u548c\u6bcf\u4e2a\u5757\u7ec4\u7684\u5757\u6570\u6765\u8fdb\u884c\u8ba1\u7b97\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_3","title":"Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u4f4d\u56fe\u5757","text":"<p>\u63a5\u4e0b\u6765\u8981\u8bf4\u7684\u662f Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u4f4d\u56fe\u5757\uff0c\u5b83\u975e\u5e38\u7b80\u5355\uff0c\u6bcf\u4e2a\u5757\u7ec4\u4e2d\u6709\u4e24\u79cd\u4f4d\u56fe\u5757\uff1a</p> <ul> <li>\u4e00\u79cd\u7528\u6765\u63cf\u8ff0\u5757\u7ec4\u5185\u6bcf\u4e2a\u50a8\u5b58\u5757\u7684\u5206\u914d\u72b6\u6001\u3002</li> <li>\u53e6\u4e00\u79cd\u7528\u4e8e\u63cf\u8ff0 <code>inode</code> \u8282\u70b9\u7684\u5206\u914d\u72b6\u6001\u3002</li> </ul> <p>\u4f4d\u56fe\u5757\u4e2d\u6ca1\u6709\u4ec0\u4e48\u7ed3\u6784\uff0c\u5c31\u662f\u4f4d\u56fe\u6570\u636e\uff0c\u5373\u5757\u4e2d\u7684\u6bcf\u4e2a\u5b57\u8282\u90fd\u6709\u516b\u4e2a\u4f4d\u3002</p> <p>\u6bcf\u4e2a\u4f4d\u8868\u793a\u4e00\u4e2a\u76f8\u5e94\u5bf9\u8c61\u7684\u5206\u914d\u72b6\u6001\uff1a</p> <ul> <li>\u8be5\u4f4d\u4e3a 0 \u65f6\uff0c\u8868\u793a\u76f8\u5e94\u5bf9\u8c61\u4e3a\u7a7a\u95f2\u53ef\u7528\u72b6\u6001\uff1b</li> <li>\u4e3a 1 \u65f6\u5219\u8868\u793a\u76f8\u5e94\u5bf9\u8c61\u662f\u5360\u7528\u72b6\u6001\u3002</li> </ul> <p>\u4f8b\u5982\u4f4d\u56fe\u5757\u4e2d\u7b2c\u4e00\u4e2a\u5b57\u8282\uff0c\u8868\u793a\u5757\u7ec4 0~7 \u53f7\u50a8\u5b58\u5757\u7684\u5206\u914d\u72b6\u6001\uff1b\u7b2c\u4e8c\u4e2a\u5b57\u8282\uff0c\u8868\u793a\u5757\u7ec4 8~15 \u53f7\u50a8\u5b58\u5757\u7684\u5206\u914d\u72b6\u6001 \u2026\u2026\u4f9d\u6b21\u7c7b\u63a8\u3002\u4f4d\u56fe\u5757\u7684\u5757\u53f7\u53ef\u4ee5\u4ece\u5757\u7ec4\u63cf\u8ff0\u7b26\u4e2d\u5f97\u5230\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3-inode","title":"Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684 <code>inode</code> \u8282\u70b9","text":"<p>\u4e0a\u8282\u8bfe\u6211\u4eec\u63d0\u8fc7\uff0c<code>inode</code> \u8282\u70b9\u7528\u6765\u5b58\u653e\u8ddf\u6587\u4ef6\u76f8\u5173\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4f46\u662f\u6587\u4ef6\u540d\u79f0\u5374\u4e0d\u5728 <code>inode</code> \u8282\u70b9\u4e4b\u4e2d\uff0c\u6587\u4ef6\u540d\u79f0\u4fdd\u5b58\u5728\u6587\u4ef6\u76ee\u5f55\u9879\u4e2d\u3002</p> <p><code>inode</code> \u8282\u70b9\u4e2d\u5305\u542b\u4e86\u6587\u4ef6\u6a21\u5f0f\u3001\u6587\u4ef6\u94fe\u63a5\u6570\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u6587\u4ef6\u5360\u7528\u6247\u533a\u6570\u3001\u6587\u4ef6\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u7684\u65f6\u95f4\u4fe1\u606f\u3001\u6587\u4ef6\u7684\u7528\u6237 ID\u3001\u6587\u4ef6\u7684\u7528\u6237\u7ec4 ID\u3001\u6587\u4ef6\u6570\u636e\u5185\u5bb9\u7684\u50a8\u5b58\u5757\u53f7\u7b49\uff0c\u8fd9\u4e9b\u91cd\u8981\u4fe1\u606f\u4e5f\u88ab\u79f0\u4e3a\u6587\u4ef6\u7684\u5143\u6570\u636e\u3002\u90a3\u4e48\uff0c\u7528 C \u8bed\u8a00\u5982\u4f55\u5b9a\u4e49\u5355\u4e2a <code>inode</code> \u8282\u70b9\u7ed3\u6784\u5462\uff1f\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>struct ext3_inode {\n  __le16  i_mode;    // \u6587\u4ef6\u6a21\u5f0f\n  __le16  i_uid;    // \u5efa\u7acb\u6587\u4ef6\u7684\u7528\u6237\n  __le32  i_size;    // \u6587\u4ef6\u5927\u5c0f\n  __le32  i_atime;  // \u6587\u4ef6\u8bbf\u95ee\u65f6\u95f4\n  __le32  i_ctime;  // \u6587\u4ef6\u5efa\u7acb\u65f6\u95f4\n  __le32  i_mtime;  // \u6587\u4ef6\u4fee\u6539\u65f6\u95f4\n  __le32  i_dtime;  // \u6587\u4ef6\u5220\u9664\u65f6\u95f4\n  __le16  i_gid;    // \u5efa\u7acb\u6587\u4ef6\u7684\u7528\u6237\u7ec4\n  __le16  i_links_count;  // \u6587\u4ef6\u7684\u94fe\u63a5\u6570\n  __le32  i_blocks;  // \u6587\u4ef6\u5360\u7528\u7684\u50a8\u5b58\u5757 */\n  __le32  i_flags;  // \u6587\u4ef6\u6807\u5fd7\n  union {\n    struct {\n      __u32  l_i_reserved1;\n    } linux1;\n    struct {\n      __u32  h_i_translator;\n    } hurd1;\n    struct {\n      __u32  m_i_reserved1;\n    } masix1;\n  } osd1;        //\u64cd\u4f5c\u7cfb\u7edf\u4f9d\u8d561\n  __le32  i_block[EXT3_N_BLOCKS];// \u76f4\u63a5\u5757\u5730\u5740\n  __le32  i_generation;  // \u6587\u4ef6\u7248\u672c\n  __le32  i_file_acl;  // \u6587\u4ef6\u6269\u5c55\u5c5e\u6027\u5757\n  __le32  i_dir_acl;  // \u76ee\u5f55\u6269\u5c55\u5c5e\u6027\u5757\n  __le32  i_faddr;  // \u6bb5\u5730\u5740\n  union {\n    struct {\n      __u8  l_i_frag;  //\u6bb5\u53f7\n      __u8  l_i_fsize;  //\u6bb5\u5927\u5c0f\n      __u16  i_pad1;\n      __le16  l_i_uid_high;\n      __le16  l_i_gid_high;\n      __u32  l_i_reserved2;\n    } linux2;\n    struct {\n      __u8  h_i_frag;  //\u6bb5\u53f7\n      __u8  h_i_fsize;  //\u6bb5\u5927\u5c0f\n      __u16  h_i_mode_high;\n      __u16  h_i_uid_high;\n      __u16  h_i_gid_high;\n      __u32  h_i_author;\n    } hurd2;\n    struct {\n      __u8  m_i_frag;  //\u6bb5\u53f7\n      __u8  m_i_fsize;  //\u6bb5\u5927\u5c0f\n      __u16  m_pad1;\n      __u32  m_i_reserved2[2];\n    } masix2;\n  } osd2;        //\u64cd\u4f5c\u7cfb\u7edf\u4f9d\u8d562\n  __le16  i_extra_isize; \n  __le16  i_pad1;\n};\n</code></pre> <p>\u8fd9\u5c31\u662f <code>inode</code> \u8282\u70b9\uff0c\u5b83\u5305\u542b\u6587\u4ef6\u7684\u6240\u6709\u4fe1\u606f\u3002</p> <p>\u6587\u4ef6\u7684\u6570\u636e\u5185\u5bb9\u7684\u50a8\u5b58\u5757\u53f7\u4fdd\u5b58\u5728 <code>i_block</code> \u4e2d\uff0c\u8fd9\u4e2a <code>i_block</code> \u6570\u7ec4\u524d\u5341\u4e8c\u5143\u7d20\u4fdd\u5b58\u7684\u662f 1~12 \u8fd9 12 \u4e2a\u50a8\u5b58\u5757\u53f7\uff0c\u7b2c\u5341\u4e09\u4e2a\u5143\u7d20\u5f00\u59cb\u4fdd\u5b58\u7684\u662f\u4e00\u7ea7\u95f4\u63a5\u50a8\u5b58\u5757\u5757\u53f7\u3001\u4e8c\u7ea7\u95f4\u63a5\u50a8\u5b58\u5757\u5757\u53f7\u3001\u4e09\u7ea7\u95f4\u63a5\u50a8\u5b58\u5757\u5757\u53f7\u3002\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u4ec0\u4e48\u662f\u95f4\u63a5\u50a8\u5b58\u5757\uff1f\u5982\u56fe\uff1a</p> <p></p> <p>\u7531\u4e0a\u56fe\u53ef\u77e5\uff0c\u4e00\u4e2a <code>inode</code> \u8282\u70b9\u4e2d\u6709 11 \u4e2a\u76f4\u63a5\u50a8\u5b58\u5757\uff0c\u5176\u4e2d\u5b58\u653e\u7684\u662f\u5757\u53f7\uff0c\u80fd\u76f4\u63a5\u7d22\u5f15 11 \u4e2a\u50a8\u5b58\u5757\u3002</p> <p>\u5982\u679c\u6bcf\u4e2a\u50a8\u5b58\u5757\u5927\u5c0f\u662f 1KB \u7684\u8bdd\uff0c\u53ef\u4ee5\u4fdd\u5b58 11KB \u7684\u6587\u4ef6\u6570\u636e\uff1b\u5f53\u6587\u4ef6\u5185\u5bb9\u5927\u4e8e 11KB \u65f6\uff0c\u5c31\u8981\u7528\u5230\u4e00\u7ea7\u95f4\u63a5\u50a8\u5b58\u5757\u3002\u8fd9\u65f6\uff0c\u4e00\u7ea7\u95f4\u63a5\u50a8\u5b58\u5757\u91cc\u7684\u5757\u53f7\u7d22\u5f15\u7684\u50a8\u5b58\u5757\u4e2d\u4e0d\u662f\u6587\u4ef6\u6570\u636e\uff0c\u800c\u662f\u50a8\u5b58\u7684\u6307\u5411\u50a8\u5b58\u5757\u7684\u5757\u53f7\uff0c\u5b83\u53ef\u4ee5\u50a8\u5b58 1024/4 \u4e2a\u5757\u53f7\uff0c\u5373\u53ef\u7d22\u5f15 1024/4 \u4e2a\u50a8\u5b58\u5757\u3002\u4e8c\u7ea7\u3001\u4e09\u7ea7\u95f4\u63a5\u5757\u5219\u4f9d\u6b21\u7c7b\u63a8\uff0c\u53ea\u4e0d\u8fc7\u7ea7\u522b\u66f4\u6df1\uff0c\u4fdd\u5b58\u7684\u5757\u53f7\u5c31\u66f4\u591a\uff0c\u80fd\u7d22\u5f15\u7684\u50a8\u5b58\u5757\u5c31\u66f4\u591a\uff0c\u50a8\u5b58\u6587\u4ef6\u7684\u6570\u636e\u91cf\u5c31\u66f4\u5927\u3002</p> <p>\u591a\u91cd\u6307\u9488</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_4","title":"Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u76ee\u5f55\u9879","text":"<p>\u6211\u4eec\u5df2\u7ecf\u5bf9 Ext3 \u6587\u4ef6\u7cfb\u7edf\u82e5\u5e72\u7ed3\u6784\u90fd\u505a\u4e86\u68b3\u7406\uff0c\u73b0\u5728\u4f60\u5e94\u8be5\u5bf9 Ext3 \u6587\u4ef6\u7cfb\u7edf\u5982\u4f55\u50a8\u5b58\u6587\u4ef6\u6709\u4e86\u4e00\u5b9a\u8ba4\u8bc6\u3002</p> <p>\u53ef\u662f\u6587\u4ef6\u7cfb\u7edf\u4e2d\u8fd8\u6709\u8bb8\u591a\u6587\u4ef6\u76ee\u5f55\uff0c\u6587\u4ef6\u76ee\u5f55\u662f\u600e\u4e48\u5904\u7406\u7684\u5462\uff1f</p> <p>Ext3 \u6587\u4ef6\u7cfb\u7edf\u628a\u76ee\u5f55\u5f53\u6210\u4e86\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u5373\u76ee\u5f55\u6587\u4ef6\uff0c\u76ee\u5f55\u6587\u4ef6\u6709\u81ea\u5df1\u7684 <code>inode</code> \u8282\u70b9\uff0c\u80fd\u8bfb\u53d6\u5176\u4e2d\u6570\u636e\u3002</p> <p>\u5728\u76ee\u5f55\u6587\u4ef6\u7684\u6570\u636e\u4e2d\uff0c\u4fdd\u5b58\u7684\u662f\u4e00\u7cfb\u5217\u76ee\u5f55\u9879\uff0c\u76ee\u5f55\u9879\u7528\u6765\u5b58\u653e\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u7684 <code>inode</code> \u8282\u70b9\u53f7\u3001\u76ee\u5f55\u9879\u7684\u957f\u5ea6\u3001\u6587\u4ef6\u540d\u7b49\u4fe1\u606f\u3002\u4e0b\u9762\u6211\u4eec\u770b\u4e00\u770b\uff0c\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5355\u4e2a\u76ee\u5f55\u9879\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1a</p> <pre><code>#define EXT3_NAME_LEN 255\nstruct ext3_dir_entry {\n  __le32  inode;        // \u5bf9\u5e94\u7684inode\u8282\u70b9\u53f7\n  __le16  rec_len;      // \u76ee\u5f55\u9879\u957f\u5ea6\n  __u8  name_len;      // \u6587\u4ef6\u540d\u79f0\u957f\u5ea6\n  __u8  file_type;      // \u6587\u4ef6\u7c7b\u578b\uff1a\u6587\u4ef6\u3001\u76ee\u5f55\u3001\u7b26\u53f7\u94fe\u63a5\n  char  name[EXT3_NAME_LEN];// \u6587\u4ef6\u540d\n};\n</code></pre> <p>\u76ee\u5f55\u9879\u7ed3\u6784\u5927\u5c0f\u4e0d\u662f\u56fa\u5b9a\u4e0d\u53d8\u7684\uff0c\u8fd9\u662f\u7531\u4e8e\u6bcf\u4e2a\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u7684\u540d\u79f0\uff0c\u4e0d\u4e00\u5b9a\u662f 255 \u4e2a\u5b57\u7b26\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u5c11\u4e8e 255 \u4e2a\u5b57\u7b26\uff0c\u8fd9\u5c31\u5bfc\u81f4 name \u6570\u7ec4\u4e0d\u5fc5\u5360\u7528\u5b8c\u6574\u7684\u7a7a\u95f4\u3002\u6240\u4ee5\u76ee\u5f55\u9879\u662f\u52a8\u6001\u53d8\u5316\uff0c\u9700\u8981\u7ed3\u6784\u4e2d\u7684 <code>rec_len</code> \u5b57\u6bb5\uff0c\u624d\u80fd\u77e5\u9053\u76ee\u5f55\u9879\u7684\u771f\u5b9e\u5927\u5c0f\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_15","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_16","title":"\u8bfe\u540e\u601d\u8003","text":"<p>\u8bf7\u95ee Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u8d85\u7ea7\u5757\u653e\u5728\u786c\u76d8\u5206\u533a\u7684\u7b2c\u51e0\u4e2a\u6247\u533a\u4e2d\u3002</p> <p>In the Ext3 file system, the superblock contains several fields that store metadata about the file system, including the number of sectors per block group. The superblock itself is typically placed in sector 1 of the file system. The superblock is not divided into sectors; rather, it is a single block of data that contains information about the file system.</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#6linuxlinux","title":"6\uff5cLinux\u6587\u4ef6\u7cfb\u7edf\uff08\u4e8c\uff09\uff1aLinux\u5982\u4f55\u5b58\u653e\u6587\u4ef6\uff1f","text":"<p>\u901a\u8fc7\u4e0a\u8282\u8bfe\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u5df2\u7ecf\u5bf9 Ext3 \u6587\u4ef6\u7cfb\u7edf\u7684\u7ed3\u6784\u975e\u5e38\u4e86\u89e3\u4e86\u3002\u8fd9\u79cd\u4e86\u89e3\u7a76\u7adf\u6b63\u786e\u4e0e\u5426\uff0c\u8fd8\u662f\u9700\u8981\u901a\u8fc7\u5199\u4ee3\u7801\u6765\u9a8c\u8bc1\u3002</p> <p>\u8fd9\u8282\u8bfe\u6211\u4eec\u8bfb\u53d6 Ext3 \u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\uff0c\u52a0\u6df1\u5bf9 Ext3 \u7684\u7406\u89e3\u3002</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_17","title":"\u6253\u5f00\u865a\u62df\u786c\u76d8","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_5","title":"\u83b7\u53d6 Ext3 \u6587\u4ef6\u7cfb\u7edf\u8d85\u7ea7\u5757","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_6","title":"\u83b7\u53d6 Ext3 \u6587\u4ef6\u7cfb\u7edf\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_7","title":"\u83b7\u53d6 Ext3 \u6587\u4ef6\u7cfb\u7edf\u6839\u76ee\u5f55","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#ext3_8","title":"\u83b7\u53d6 Ext3 \u6587\u4ef6\u7cfb\u7edf\u6587\u4ef6","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_18","title":"\u603b\u7ed3","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html#_19","title":"\u8bfe\u540e\u601d\u8003","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/5.%20%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8/synthesis.html","title":"5. \u7efc\u5408\u5e94\u7528","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/5.%20%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8/synthesis.html#42ebpf","title":"42\uff5c\u6027\u80fd\u8c03\u4f18\uff1a\u6027\u80fd\u8c03\u4f18\u5de5\u5177eBPF\u548c\u8c03\u4f18\u65b9\u6cd5","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html","title":"\u73af\u5883\u914d\u7f6e\u548c\u5de5\u5177\u94fe","text":""},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html#yosys","title":"yosys\u5b89\u88c5\u548c\u7b80\u5355\u4f7f\u7528","text":"<p>yosys\u5b89\u88c5\u6559\u7a0b-CSDN\u535a\u5ba2</p> <p>\u5df2\u6709:</p> <pre><code>alu.v alu_tb.v wave wave.vcd\n</code></pre> <p>\u7b2c\u4e00\u6b65\uff0c\u5728 Yosys \u4e2d\u8bfb\u53d6 Verilog \u6587\u4ef6\u3002</p> <pre><code>read_verilog alu.v\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u4f7f\u7528\u540e\u9762\u7684\u547d\u4ee4\uff0c\u68c0\u67e5\u6a21\u5757\u4f8b\u5316\u7ed3\u6784\u3002hierarchy -check</p> <pre><code>hierarchy -check\n</code></pre> <p>\u63a5\u7740\u662f\u7b2c\u4e09\u6b65\uff0c\u6267\u884c\u4e0b\u4e00\u6761\u547d\u4ee4\uff0c\u6765\u5b8c\u6210\u9ad8\u5c42\u6b21\u7684\u903b\u8f91\u7efc\u5408\u3002</p> <pre><code>proc; opt; opt; fsm; memory; opt\n</code></pre> <p>\u5230\u4e86\u7b2c\u56db\u6b65\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 write_verilog \u751f\u6210\u7f51\u8868\u6587\u4ef6\u3002</p> <pre><code>write_verilog alu_synth.v\n</code></pre> <p>\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u7528\u4e0b\u65b9\u7684\u547d\u4ee4\uff0c\u8f93\u51fa\u7efc\u5408\u540e\u7684\u903b\u8f91\u56fe\u3002</p> <pre><code>show -format dot -prefix ./alu\n</code></pre> <p>\u5c06.dot\u8f6c\u6362\u6210.PNG\u56fe\u7247\u65b9\u4fbf\u67e5\u770b</p> <pre><code>dot -Tpng alu.dot -o alu.png\n</code></pre> <p>\u8fdb\u4e00\u6b65\u4f7f\u7528\u770b\u5b98\u7f51https://yosyshq.net/yosys</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html#_1","title":"\u73af\u5883\u642d\u5efa","text":"<p>12\uff5cQEMU\uff1a\u652f\u6301RISC-V\u7684QEMU\u5982\u4f55\u6784\u5efa\uff1f (geekbang.org)</p> <p>13\uff5c\u5c0f\u8bd5\u725b\u5200\uff1a\u8dd1\u901aRISC-V\u5e73\u53f0\u7684Hello World\u7a0b\u5e8f (geekbang.org)</p>"},{"location":"Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html#_2","title":"\u95ee\u9898","text":"<ol> <li> <p>\u7f3a\u5c11\u5de5\u5177\u94fe</p> <p>AS src/miniCPU_sim.asm build/miniCPU_sim.o make: riscv32-unknown-elf-as: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55 make: *** [Makefile:29\uff1abuild/miniCPU_sim.o] \u9519\u8bef 127</p> <p>\u3010\u95ee\u9898\u89e3\u51b3\u3011Error: Can\u2018t find compiler riscv32-unknown-elf-gcc-CSDN\u535a\u5ba2</p> <p>\u6709\u4e2a\u95ee\u9898, \u4e4b\u524d\u4e0d\u662f\u5b89\u88c5\u8fc7\u4e86RISCV64\u7684\u5417\uff1f\u4e8c\u8005\u4e0d\u517c\u5bb9\u662f\u5417:</p> <pre><code>riscv64-unknown-elf-gcc -v\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0d\u884c\u5462?</p> <p>\u4e24\u79cd\u67b6\u6784\u7684\u5de5\u5177\u94fe\u662f\u4e0d\u517c\u5bb9\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u5bf9\u4e8e\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\u548c\u5bc4\u5b58\u5668\u89c4\u8303\u8fdb\u884c\u4e86\u4f18\u5316\uff1f</p> <p>\u4f46\u662f\u5f88\u591a\u5185\u5bb9\u90fd\u662f\u62ff64bit\u7684\u5de5\u5177\u94fe\u6765\u6784\u5efa32\u7684\u76f8\u5173\u5e94\u7528\u7684\u5440\uff1f\u96be\u9053\u662f\u7f16\u8bd1\u7684\u76f8\u5173\u6807\u5fd7\uff1f-march\uff1f\u592a\u4e45\u8fdc\u4e86\uff0c\u4e0d\u770b\u4e86\u3002</p> </li> <li> <p>yosys\u5b89\u88c5 \u7f3a\u5c11tcl\u5934\u6587\u4ef6</p> <pre><code>[  5%] Building kernel/json.o\nIn file included from kernel/register.cc:20:\n./kernel/yosys.h:81:12: fatal error: 'tcl.h' file not found\n#  include &lt;tcl.h&gt;\n           ^~~~~~~\nIn file included from kernel/rtlil.cc:20:\n./kernel/yosys.h:81:12: fatal error: 'tcl.h' file not found\n#  include &lt;tcl.h&gt;\n           ^~~~~~~\nIn file included from kernel/driver.cc:20:\n./kernel/yosys.h:81:12: fatal error: 'tcl.h' file not found\n#  include &lt;tcl.h&gt;\n           ^~~~~~~\nIn file included from In file included from kernel/log.cc:20:\n./kernel/yosys.h:81:12: fatal error: 'tcl.h' file not found\n#  include &lt;tcl.h&gt;\n           ^~~~~~~\nkernel/calc.cc:24:\n./kernel/yosys.h:81:12: fatal error: 'tcl.h' file not found\n#  include &lt;tcl.h&gt;\n           ^~~~~~~\n</code></pre> <p>make - Error: tcl.h not found (no such file or directory) - Ask Ubuntu</p> </li> </ol>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html","title":"Shell","text":"<p>Shell \u6700\u597d\u7684\u7279\u6027\u5c31\u662f\u53ea\u8c03\u7528\u7a0b\u5e8f\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u8981\u627e\u5230\u5408\u9002\u7684\u66ff\u4ee3\u7a0b\u5e8f\u5373\u53ef\uff08\u751a\u81f3\u81ea\u5df1\u7f16\u5199\uff09</p> <p>\u6709\u4e9b\u95ee\u9898\u4f7f\u7528\u5408\u9002\u7684\u5de5\u5177\u5c31\u4f1a\u8fce\u5203\u800c\u89e3\uff0c\u800c\u5177\u4f53\u9009\u62e9\u54ea\u4e2a\u5de5\u5177\u5219\u4e0d\u662f\u90a3\u4e48\u91cd\u8981\u3002</p> <p>\u6700\u91cd\u8981\u7684\u662f\uff0c\u73b0\u5728\u6709\u4e86 GPT\uff0c\u5b66\u4f1a\u4f7f\u7528 GPT \u66f4\u52a0\u91cd\u8981\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html#shell","title":"Shell \u811a\u672c","text":"<ul> <li> <p>\u7279\u6b8a\u53d8\u91cf</p> <ul> <li><code>$0</code> - \u811a\u672c\u540d</li> <li><code>$1</code> \u5230 <code>$9</code> - \u811a\u672c\u7684\u53c2\u6570\u3002 <code>$1</code> \u662f\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002</li> <li><code>$@</code> - \u6240\u6709\u53c2\u6570</li> <li><code>$#</code> - \u53c2\u6570\u4e2a\u6570</li> <li><code>$?</code> - \u524d\u4e00\u4e2a\u547d\u4ee4\u7684\u8fd4\u56de\u503c</li> <li><code>$$</code> - \u5f53\u524d\u811a\u672c\u7684\u8fdb\u7a0b\u8bc6\u522b\u7801</li> <li><code>!!</code> - \u5b8c\u6574\u7684\u4e0a\u4e00\u6761\u547d\u4ee4\uff0c\u5305\u62ec\u53c2\u6570\u3002\u5e38\u89c1\u5e94\u7528\uff1a\u5f53\u4f60\u56e0\u4e3a\u6743\u9650\u4e0d\u8db3\u6267\u884c\u547d\u4ee4\u5931\u8d25\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>sudo !!</code> \u518d\u5c1d\u8bd5\u4e00\u6b21\u3002</li> <li><code>$_</code> - \u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u3002\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u662f\u4ea4\u4e92\u5f0f shell\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6309\u4e0b <code>Esc</code> \u4e4b\u540e\u952e\u5165 . \u6765\u83b7\u53d6\u8fd9\u4e2a\u503c\u3002</li> </ul> <p>\u66f4\u8be6\u7ec6\uff1aSpecial Characters (tldp.org)</p> </li> </ul>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html#shell_1","title":"Shell \u5de5\u5177","text":""},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html#_1","title":"\u67e5\u770b\u547d\u4ee4\u7684\u7528\u6cd5","text":"<ul> <li> <p><code>man</code></p> </li> <li> <p><code>-h</code>\u3001<code>--help</code></p> </li> <li> <p>tldr pages</p> </li> </ul>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html#find","title":"\u67e5\u627e\u6587\u4ef6\uff1a<code>find...</code>","text":"<p>\u7a0b\u5e8f\u5458\u4eec\u9762\u5bf9\u7684\u6700\u5e38\u89c1\u7684\u91cd\u590d\u4efb\u52a1\u5c31\u662f\u67e5\u627e\u6587\u4ef6\u6216\u76ee\u5f55\u3002\u6240\u6709\u7684\u7c7b UNIX \u7cfb\u7edf\u90fd\u5305\u542b\u4e00\u4e2a\u540d\u4e3a <code>find</code> \u7684\u5de5\u5177\uff0c\u5b83\u662f shell \u4e0a\u7528\u4e8e\u67e5\u627e\u6587\u4ef6\u7684\u7edd\u4f73\u5de5\u5177\u3002<code>find</code> \u547d\u4ee4\u4f1a\u9012\u5f52\u5730\u641c\u7d22\u7b26\u5408\u6761\u4ef6\u7684\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code># \u67e5\u627e\u6240\u6709\u540d\u79f0\u4e3asrc\u7684\u6587\u4ef6\u5939\nfind . -name src -type d\n# \u67e5\u627e\u6240\u6709\u6587\u4ef6\u5939\u8def\u5f84\u4e2d\u5305\u542btest\u7684python\u6587\u4ef6\nfind . -path '*/test/*.py' -type f\n# \u67e5\u627e\u524d\u4e00\u5929\u4fee\u6539\u7684\u6240\u6709\u6587\u4ef6\nfind . -mtime -1\n# \u67e5\u627e\u6240\u6709\u5927\u5c0f\u5728500k\u81f310M\u7684tar.gz\u6587\u4ef6\nfind . -size +500k -size -10M -name '*.tar.gz'\n</code></pre> <p>\u9664\u4e86\u5217\u51fa\u6240\u5bfb\u627e\u7684\u6587\u4ef6\u4e4b\u5916\uff0cfind \u8fd8\u80fd\u5bf9\u6240\u6709\u67e5\u627e\u5230\u7684\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u80fd\u6781\u5927\u5730\u7b80\u5316\u4e00\u4e9b\u5355\u8c03\u7684\u4efb\u52a1\u3002</p> <pre><code># \u5220\u9664\u5168\u90e8\u6269\u5c55\u540d\u4e3a.tmp \u7684\u6587\u4ef6\nfind . -name '*.tmp' -exec rm {} \\;\n# \u67e5\u627e\u5168\u90e8\u7684 PNG \u6587\u4ef6\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a JPG\nfind . -name '*.png' -exec convert {} {}.jpg \\;\n</code></pre> <p>\u5c3d\u7ba1 <code>find</code> \u7528\u9014\u5e7f\u6cdb\uff0c\u5b83\u7684\u8bed\u6cd5\u5374\u6bd4\u8f83\u96be\u4ee5\u8bb0\u5fc6\u3002\u4f8b\u5982\uff0c\u4e3a\u4e86\u67e5\u627e\u6ee1\u8db3\u6a21\u5f0f <code>PATTERN</code> \u7684\u6587\u4ef6\uff0c\u60a8\u9700\u8981\u6267\u884c <code>find -name '*PATTERN*'</code> (\u5982\u679c\u60a8\u5e0c\u671b\u6a21\u5f0f\u5339\u914d\u65f6\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>-iname</code> \u9009\u9879\uff09</p> <p>\u60a8\u5f53\u7136\u53ef\u4ee5\u4f7f\u7528 alias \u8bbe\u7f6e\u522b\u540d\u6765\u7b80\u5316\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u4f46 shell \u7684\u54f2\u5b66\u4e4b\u4e00\u4fbf\u662f\u5bfb\u627e\uff08\u66f4\u597d\u7528\u7684\uff09\u66ff\u4ee3\u65b9\u6848\u3002 \u8bb0\u4f4f\uff0cshell \u6700\u597d\u7684\u7279\u6027\u5c31\u662f\u60a8\u53ea\u662f\u5728\u8c03\u7528\u7a0b\u5e8f\uff0c\u56e0\u6b64\u60a8\u53ea\u8981\u627e\u5230\u5408\u9002\u7684\u66ff\u4ee3\u7a0b\u5e8f\u5373\u53ef\uff08\u751a\u81f3\u81ea\u5df1\u7f16\u5199\uff09\u3002</p> <p>\u4f8b\u5982\uff0c<code>fd</code> \u5c31\u662f\u4e00\u4e2a\u66f4\u7b80\u5355\u3001\u66f4\u5feb\u901f\u3001\u66f4\u53cb\u597d\u7684\u7a0b\u5e8f\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u4f5c\u4e3a <code>find</code> \u7684\u66ff\u4ee3\u54c1\u3002\u5b83\u6709\u5f88\u591a\u4e0d\u9519\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8f93\u51fa\u7740\u8272\u3001\u9ed8\u8ba4\u652f\u6301\u6b63\u5219\u5339\u914d\u3001\u652f\u6301 unicode \u5e76\u4e14\u6211\u8ba4\u4e3a\u5b83\u7684\u8bed\u6cd5\u66f4\u7b26\u5408\u76f4\u89c9\u3002\u4ee5\u6a21\u5f0f <code>PATTERN</code> \u641c\u7d22\u7684\u8bed\u6cd5\u662f <code>fd PATTERN</code>\u3002</p> <p>\u5927\u591a\u6570\u4eba\u90fd\u8ba4\u4e3a <code>find</code> \u548c <code>fd</code> \u5df2\u7ecf\u5f88\u597d\u7528\u4e86\uff0c\u4f46\u662f\u6709\u7684\u4eba\u53ef\u80fd\u60f3\u77e5\u9053\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u6709\u66f4\u9ad8\u6548\u7684\u65b9\u6cd5\uff0c\u4f8b\u5982\u4e0d\u8981\u6bcf\u6b21\u90fd\u641c\u7d22\u6587\u4ef6\u800c\u662f\u901a\u8fc7\u7f16\u8bd1\u7d22\u5f15\u6216\u5efa\u7acb\u6570\u636e\u5e93\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u66f4\u52a0\u5feb\u901f\u5730\u641c\u7d22\u3002</p> <p>\u8fd9\u5c31\u8981\u9760 <code>locate</code> \u4e86\u3002 <code>locate</code> \u4f7f\u7528\u4e00\u4e2a\u7531 <code>updatedb</code> \u8d1f\u8d23\u66f4\u65b0\u7684\u6570\u636e\u5e93\uff0c\u5728\u5927\u591a\u6570\u7cfb\u7edf\u4e2d <code>updatedb</code> \u90fd\u4f1a\u901a\u8fc7 <code>cron</code> \u6bcf\u65e5\u66f4\u65b0\u3002\u8fd9\u4fbf\u9700\u8981\u6211\u4eec\u5728\u901f\u5ea6\u548c\u65f6\u6548\u6027\u4e4b\u95f4\u4f5c\u51fa\u6743\u8861\u3002\u800c\u4e14\uff0c<code>find</code> \u548c\u7c7b\u4f3c\u7684\u5de5\u5177\u53ef\u4ee5\u901a\u8fc7\u522b\u7684\u5c5e\u6027\u6bd4\u5982\u6587\u4ef6\u5927\u5c0f\u3001\u4fee\u6539\u65f6\u95f4\u6216\u662f\u6743\u9650\u6765\u67e5\u627e\u6587\u4ef6\uff0c<code>locate</code> \u5219\u53ea\u80fd\u901a\u8fc7\u6587\u4ef6\u540d\u3002 \u8fd9\u91cc \u6709\u4e00\u4e2a\u66f4\u8be6\u7ec6\u7684\u5bf9\u6bd4\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/shell.html#grep","title":"\u67e5\u627e\u4ee3\u7801\uff1a<code>grep...</code>","text":"<p>\u67e5\u627e\u6587\u4ef6\u662f\u5f88\u6709\u7528\u7684\u6280\u80fd\uff0c\u4f46\u662f\u5f88\u591a\u65f6\u5019\u60a8\u7684\u76ee\u6807\u5176\u5b9e\u662f\u67e5\u770b\u6587\u4ef6\u7684\u5185\u5bb9\u3002\u4e00\u4e2a\u6700\u5e38\u89c1\u7684\u573a\u666f\u662f\u60a8\u5e0c\u671b\u67e5\u627e\u5177\u6709\u67d0\u79cd\u6a21\u5f0f\u7684\u5168\u90e8\u6587\u4ef6\uff0c\u5e76\u627e\u5b83\u4eec\u7684\u4f4d\u7f6e\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u70b9\uff0c\u5f88\u591a\u7c7b UNIX \u7684\u7cfb\u7edf\u90fd\u63d0\u4f9b\u4e86 <code>grep</code> \u547d\u4ee4\uff0c\u5b83\u662f\u7528\u4e8e\u5bf9\u8f93\u5165\u6587\u672c\u8fdb\u884c\u5339\u914d\u7684\u901a\u7528\u5de5\u5177\u3002\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684 shell \u5de5\u5177\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u7eed\u7684\u6570\u636e\u6e05\u7406\u8bfe\u7a0b\u4e2d\u6df1\u5165\u7684\u63a2\u8ba8\u5b83\u3002</p> <p><code>grep</code> \u6709\u5f88\u591a\u9009\u9879\uff0c\u8fd9\u4e5f\u4f7f\u5b83\u6210\u4e3a\u4e00\u4e2a\u975e\u5e38\u5168\u80fd\u7684\u5de5\u5177\u3002</p> <ul> <li>\u5176\u4e2d\u6211\u7ecf\u5e38\u4f7f\u7528\u7684\u6709 <code>-C</code> \uff1a\u83b7\u53d6\u67e5\u627e\u7ed3\u679c\u7684\u4e0a\u4e0b\u6587\uff08Context\uff09\uff1b</li> <li><code>-v</code> \u5c06\u5bf9\u7ed3\u679c\u8fdb\u884c\u53cd\u9009\uff08Invert\uff09\uff0c\u4e5f\u5c31\u662f\u8f93\u51fa\u4e0d\u5339\u914d\u7684\u7ed3\u679c\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c <code>grep -C 5</code> \u4f1a\u8f93\u51fa\u5339\u914d\u7ed3\u679c\u524d\u540e\u4e94\u884c\u3002</li> <li>\u5f53\u9700\u8981\u641c\u7d22\u5927\u91cf\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f7f\u7528 <code>-R</code> \u4f1a\u9012\u5f52\u5730\u8fdb\u5165\u5b50\u76ee\u5f55\u5e76\u641c\u7d22\u6240\u6709\u7684\u6587\u672c\u6587\u4ef6\u3002</li> <li><code>-n</code> \u663e\u793a\u884c\u53f7</li> </ul> <p>\u4e00\u4e9b\u66ff\u4ee3\u54c1\uff1aack, ag \u548c rg\u3002\u5b83\u4eec\u90fd\u7279\u522b\u597d\u7528\uff0c\u4f46\u662f\u529f\u80fd\u4e5f\u90fd\u5dee\u4e0d\u591a\uff0c\u6211\u6bd4\u8f83\u5e38\u7528\u7684\u662f ripgrep (<code>rg</code>) \uff0c\u56e0\u4e3a\u5b83\u901f\u5ea6\u5feb\uff0c\u800c\u4e14\u7528\u6cd5\u975e\u5e38\u7b26\u5408\u76f4\u89c9\u3002\u4f8b\u5b50\u5982\u4e0b\uff1a</p> <pre><code># \u67e5\u627e\u6240\u6709\u4f7f\u7528\u4e86 requests \u5e93\u7684\u6587\u4ef6\nrg -t py 'import requests'\n# \u67e5\u627e\u6240\u6709\u6ca1\u6709\u5199 shebang \u7684\u6587\u4ef6\uff08\u5305\u542b\u9690\u85cf\u6587\u4ef6\uff09\nrg -u --files-without-match \"^#!\"\n# \u67e5\u627e\u6240\u6709\u7684foo\u5b57\u7b26\u4e32\uff0c\u5e76\u6253\u5370\u5176\u4e4b\u540e\u76845\u884c\nrg foo -A 5\n# \u6253\u5370\u5339\u914d\u7684\u7edf\u8ba1\u4fe1\u606f\uff08\u5339\u914d\u7684\u884c\u548c\u6587\u4ef6\u7684\u6570\u91cf\uff09\nrg --stats PATTERN\n</code></pre> <p>\u4e0e <code>find</code>/<code>fd</code> \u4e00\u6837\uff0c\u91cd\u8981\u7684\u662f\u4f60\u8981\u77e5\u9053\u6709\u4e9b\u95ee\u9898\u4f7f\u7528\u5408\u9002\u7684\u5de5\u5177\u5c31\u4f1a\u8fce\u5203\u800c\u89e3\uff0c\u800c\u5177\u4f53\u9009\u62e9\u54ea\u4e2a\u5de5\u5177\u5219\u4e0d\u662f\u90a3\u4e48\u91cd\u8981\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html","title":"Shell","text":""},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#_1","title":"\u5e38\u7528\u67e5\u627e","text":"<p>\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528<code>find</code>\u547d\u4ee4\u6765\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b\u6587\u4ef6\u540d\u4e2d\u5305\u542b\"main\"\u7684\u6587\u4ef6\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u57fa\u672c\u7684\u547d\u4ee4\u793a\u4f8b\uff1a</p> <ol> <li> <p>\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u540d\u4e2d\u5305\u542b\"main\"\u7684\u6587\u4ef6\uff1a    <pre><code>find . -type f -name \"*main*\"\n</code></pre></p> </li> <li> <p>\u53ea\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff08\u4e0d\u5305\u62ec\u5b50\u76ee\u5f55\uff09\uff1a    <pre><code>find . -maxdepth 1 -type f -name \"*main*\"\n</code></pre></p> </li> <li> <p>\u67e5\u627e\u6587\u4ef6\u540d\u4e2d\u5305\u542b\"main\"\u7684C\u6216C++\u6e90\u6587\u4ef6\uff1a</p> </li> </ol> <pre><code>find . -type f \\( -name \"*.c\" -o -name \"*.cc\" -o -name \"*.cpp\" -o -name \"*.h\" \\) -name \"*main*\"\n</code></pre> <ol> <li> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u67e5\u627e\u6587\u4ef6\u540d\uff08\u5982\u679c\u4f60\u7684<code>find</code>\u547d\u4ee4\u652f\u6301<code>-regex</code>\u9009\u9879\uff09\uff1a    <pre><code>find . -type f -regex \".*/main.*\\.\\(c\\|cpp\\|cc\\|h\\)\"\n</code></pre></p> </li> <li> <p>\u4f7f\u7528<code>grep</code>\u547d\u4ee4\u914d\u5408<code>find</code>\u547d\u4ee4\u6765\u8fc7\u6ee4\u7ed3\u679c\uff08\u5982\u679c\u4f60\u53ea\u60f3\u67e5\u770b\u6587\u4ef6\u540d\uff0c\u800c\u4e0d\u662f\u5b8c\u6574\u8def\u5f84\uff09\uff1a    <pre><code>find . -type f -name \"*main*\" | grep \"main\"\n</code></pre></p> </li> <li> <p>\u4f7f\u7528<code>xargs</code>\u547d\u4ee4\u6765\u5bf9\u627e\u5230\u7684\u6587\u4ef6\u6267\u884c\u67d0\u4e2a\u547d\u4ee4\uff08\u4f8b\u5982\uff0c\u5217\u51fa\u6240\u6709\u627e\u5230\u7684\u6587\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\uff09\uff1a</p> </li> </ol> <pre><code>find . -type f -name \"*main*\" | xargs ls -l\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u547d\u4ee4\u4e2d\u7684<code>.</code>\u8868\u793a\u5f53\u524d\u76ee\u5f55\uff0c<code>-type f</code>\u6307\u5b9a\u67e5\u627e\u6587\u4ef6\uff0c<code>-name \"*main*\"</code>\u6307\u5b9a\u6587\u4ef6\u540d\u6a21\u5f0f\u3002\u5982\u679c\u4f60\u7684<code>find</code>\u547d\u4ee4\u7684\u8bed\u6cd5\u6709\u6240\u4e0d\u540c\uff0c\u53ef\u80fd\u9700\u8981\u8c03\u6574\u547d\u4ee4\u9009\u9879\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#_2","title":"\u7edf\u8ba1\u4ee3\u7801\u884c\u6570","text":"<p>\u8981\u7edf\u8ba1\u6587\u4ef6\u5939\u4e2d\u7684.c\u4ee3\u7801\u884c\u6570\u548c.h\u4ee3\u7801\u884c\u6570\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u7edf\u8ba1.c\u6587\u4ef6\u7684\u4ee3\u7801\u884c\u6570\uff1a</li> <li> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u7edf\u8ba1\u6587\u4ef6\u5939\u4e2d\u6240\u6709.c\u6587\u4ef6\u7684\u4ee3\u7801\u884c\u6570\uff1a      <pre><code>find /path/to/your/folder -name \"*.c\" | xargs cat | wc -l\n</code></pre>      \u8fd9\u4e2a\u547d\u4ee4\u4f1a\u627e\u5230\u6307\u5b9a\u6587\u4ef6\u5939\u4e0b\u6240\u6709\u6269\u5c55\u540d\u4e3a.c\u7684\u6587\u4ef6\uff0c\u5c06\u5b83\u4eec\u7684\u5185\u5bb9\u5408\u5e76\u540e\u7edf\u8ba1\u603b\u884c\u6570\u3002</p> <p>\u8fd9\u4e2a\u547d\u4ee4\u884c\u4f7f\u7528\u4e86\u51e0\u4e2a\u4e0d\u540c\u7684\u547d\u4ee4\u6765\u5b8c\u6210\u4e00\u4e2a\u7279\u5b9a\u7684\u4efb\u52a1\uff1a\u5728\u6307\u5b9a\u7684\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e2d\u67e5\u627e\u6240\u6709\u7684 C \u8bed\u8a00\u6e90\u4ee3\u7801\u6587\u4ef6\uff08\u4ee5 <code>.c</code> \u7ed3\u5c3e\u7684\u6587\u4ef6\uff09\uff0c\u5c06\u8fd9\u4e9b\u6587\u4ef6\u7684\u5185\u5bb9\u62fc\u63a5\u8d77\u6765\uff0c\u7136\u540e\u8ba1\u7b97\u603b\u7684\u884c\u6570\u3002\u4e0b\u9762\u662f\u6bcf\u4e2a\u90e8\u5206\u7684\u8be6\u7ec6\u89e3\u91ca\uff1a</p> <ol> <li><code>find /path/to/your/folder -name \"*.c\"</code>\uff1a</li> <li><code>find</code>\uff1a\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u7d22\u6587\u4ef6\u3002</li> <li><code>/path/to/your/folder</code>\uff1a\u6307\u5b9a\u4e86\u641c\u7d22\u7684\u8d77\u59cb\u76ee\u5f55\u3002\u4f60\u9700\u8981\u5c06\u5176\u66ff\u6362\u4e3a\u5b9e\u9645\u7684\u76ee\u5f55\u8def\u5f84\u3002</li> <li> <p><code>-name \"*.c\"</code>\uff1a\u6307\u5b9a\u4e86\u641c\u7d22\u6761\u4ef6\uff0c\u5373\u6240\u6709\u4ee5 <code>.c</code> \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u8fd9\u662f C \u8bed\u8a00\u6e90\u4ee3\u7801\u6587\u4ef6\u7684\u5e38\u89c1\u6269\u5c55\u540d\u3002</p> </li> <li> <p><code>|</code>\uff08\u7ba1\u9053\uff09\uff1a</p> </li> <li> <p>\u7ba1\u9053\u7b26\u53f7\u7528\u4e8e\u5c06\u4e00\u4e2a\u547d\u4ee4\u7684\u8f93\u51fa\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u547d\u4ee4\u7684\u8f93\u5165\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b83\u5c06 <code>find</code> \u547d\u4ee4\u7684\u8f93\u51fa\uff08\u5373\u6240\u6709 <code>.c</code> \u6587\u4ef6\u7684\u8def\u5f84\u5217\u8868\uff09\u4f20\u9012\u7ed9 <code>xargs</code> \u547d\u4ee4\u3002</p> </li> <li> <p><code>xargs</code>\uff1a</p> </li> <li> <p><code>xargs</code> \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5c06\u6807\u51c6\u8f93\u5165\uff08stdin\uff09\u6570\u636e\u8f6c\u6362\u6210\u547d\u4ee4\u884c\u53c2\u6570\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b83\u5c06\u63a5\u6536\u6765\u81ea <code>find</code> \u547d\u4ee4\u7684\u6587\u4ef6\u5217\u8868\uff0c\u5e76\u628a\u8fd9\u4e9b\u6587\u4ef6\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 <code>cat</code> \u547d\u4ee4\u3002</p> </li> <li> <p><code>cat</code>\uff1a</p> </li> <li> <p><code>cat</code> \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u8fde\u63a5\u6587\u4ef6\u5e76\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u3002\u7531\u4e8e <code>xargs</code> \u4f20\u9012\u4e86\u591a\u4e2a\u6587\u4ef6\u540d\u7ed9 <code>cat</code>\uff0c<code>cat</code> \u5c06\u8fd9\u4e9b\u6587\u4ef6\u7684\u5185\u5bb9\u62fc\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u5355\u4e00\u7684\u8f93\u51fa\u6d41\u3002</p> </li> <li> <p><code>wc -l</code>\uff1a</p> </li> <li><code>wc</code> \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u8ba1\u7b97\u5b57\u6570\u3001\u884c\u6570\u3001\u5b57\u7b26\u6570\u7b49\u3002</li> <li><code>-l</code> \u662f <code>wc</code> \u7684\u4e00\u4e2a\u9009\u9879\uff0c\u7528\u4e8e\u8ba1\u7b97\u884c\u6570\u3002</li> </ol> <p>\u5c06\u8fd9\u4e9b\u7ec4\u5408\u8d77\u6765\uff0c\u6574\u4e2a\u547d\u4ee4\u884c\u7684\u4f5c\u7528\u662f\uff1a\u67e5\u627e\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709 <code>.c</code> \u6587\u4ef6\uff0c\u5c06\u5b83\u4eec\u7684\u5185\u5bb9\u5168\u90e8\u62fc\u63a5\u8d77\u6765\uff0c\u7136\u540e\u8ba1\u7b97\u603b\u7684\u884c\u6570\u3002\u8fd9\u5728\u7edf\u8ba1\u4e00\u4e2a\u9879\u76ee\u4e2d\u6240\u6709 C \u6e90\u4ee3\u7801\u6587\u4ef6\u7684\u603b\u884c\u6570\u65f6\u975e\u5e38\u6709\u7528\u3002 </p> </li> <li> <p>\u7edf\u8ba1.h\u6587\u4ef6\u7684\u4ee3\u7801\u884c\u6570\uff1a</p> </li> <li>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u7edf\u8ba1\u6587\u4ef6\u5939\u4e2d\u6240\u6709.h\u6587\u4ef6\u7684\u4ee3\u7801\u884c\u6570\uff1a      <pre><code>find /path/to/your/folder -name \"*.h\" | xargs cat | wc -l\n</code></pre>      \u8fd9\u4e2a\u547d\u4ee4\u4f1a\u627e\u5230\u6307\u5b9a\u6587\u4ef6\u5939\u4e0b\u6240\u6709\u6269\u5c55\u540d\u4e3a.h\u7684\u6587\u4ef6\uff0c\u5c06\u5b83\u4eec\u7684\u5185\u5bb9\u5408\u5e76\u540e\u7edf\u8ba1\u603b\u884c\u6570\u3002</li> </ol> <p>\u8bf7\u5c06\"/path/to/your/folder\"\u66ff\u6362\u4e3a\u60a8\u8981\u7edf\u8ba1\u7684\u6587\u4ef6\u5939\u8def\u5f84\u3002\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u7ec8\u7aef\u4f1a\u8f93\u51fa.c\u6587\u4ef6\u548c.h\u6587\u4ef6\u7684\u603b\u4ee3\u7801\u884c\u6570\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#main","title":"\u627e main \u51fd\u6570\u5165\u53e3","text":"<p>\u5728\u4e00\u4e2a\u5927\u578b\u7684C\u9879\u76ee\u4e2d\u627e\u5230\u6700\u521d\u7684<code>main</code>\u51fd\u6570\u5165\u53e3\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5728Linux\u7cfb\u7edf\u4e2d\u8fdb\u884c\uff1a</p> <ol> <li>\u4f7f\u7528<code>grep</code>\u547d\u4ee4\u641c\u7d22\uff1a    \u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528<code>grep</code>\u547d\u4ee4\u641c\u7d22\u5305\u542b<code>main</code>\u51fd\u6570\u7684\u6587\u4ef6\uff0c\u7136\u540e\u67e5\u770b\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684<code>main</code>\u51fd\u6570\u662f\u5426\u662f\u7a0b\u5e8f\u7684\u5165\u53e3\u3002\u4f8b\u5982\uff1a</li> </ol> <p><pre><code>grep -r \"int main\" .\n</code></pre>    \u8fd9\u5c06\u641c\u7d22\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u4e2d\u5305\u542b<code>int main</code>\u7684\u5185\u5bb9\u3002</p> <p>\u5f88\u6709\u7528\u5594\uff01\uff01\uff01</p> <p>\u67e5\u627e\u4e86\u5f88\u591a\u53d8\u91cf\u3001\u5b8f\u5b9a\u4e49\u3001\u7b49\u7b49</p> <p>\u7b80\u5355\u5206\u6790</p> <p>\u8fd9\u4e2a <code>grep</code> \u547d\u4ee4\u7528\u4e8e\u9012\u5f52\u641c\u7d22\u5f53\u524d\u76ee\u5f55\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u4e0b\u5305\u542b\u5b57\u7b26\u4e32 <code>\"int main\"</code> \u7684\u6587\u4ef6\u3002\u4e0b\u9762\u662f\u6bcf\u4e2a\u53c2\u6570\u7684\u5177\u4f53\u542b\u4e49\uff1a</p> <ol> <li> <p><code>grep</code>\uff1a\u662f\u8fd9\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\u7684\u547d\u4ee4\u672c\u8eab\uff0c\u7528\u4e8e\u641c\u7d22\u6587\u672c\u6587\u4ef6\u5e76\u663e\u793a\u5339\u914d\u7684\u884c\u3002</p> </li> <li> <p><code>-r</code> \u6216 <code>--recursive</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u9009\u9879\uff0c\u544a\u8bc9 <code>grep</code> \u9012\u5f52\u5730\u641c\u7d22\u7ed9\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\u5305\u62ec\u5b50\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002</p> </li> <li> <p><code>\"int main\"</code>\uff1a\u8fd9\u662f <code>grep</code> \u641c\u7d22\u7684\u6a21\u5f0f\uff0c\u5373\u4f60\u60f3\u8981\u5728\u6587\u4ef6\u4e2d\u627e\u5230\u7684\u5b57\u7b26\u4e32\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b83\u641c\u7d22\u5305\u542b <code>int main</code> \u7684\u884c\uff0c\u8fd9\u901a\u5e38\u662f C \u6216 C++ \u7a0b\u5e8f\u4e2d\u4e3b\u51fd\u6570\u7684\u5f00\u59cb\u3002</p> </li> <li> <p><code>.</code>\uff1a\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u3002\u5728\u8fd9\u4e2a\u547d\u4ee4\u4e2d\uff0c\u5b83\u544a\u8bc9 <code>grep</code> \u4ece\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u5f00\u59cb\u641c\u7d22\uff0c\u5e76\u5305\u62ec\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u5b50\u76ee\u5f55\u3002</p> </li> </ol> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u6574\u4e2a\u547d\u4ee4 <code>grep -r \"int main\" .</code> \u7684\u4f5c\u7528\u662f\u5728\u5f53\u524d\u76ee\u5f55\u53ca\u5176\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u641c\u7d22\u5305\u542b <code>int main</code> \u7684\u6587\u672c\u884c\uff0c\u5e76\u5c06\u8fd9\u4e9b\u884c\u663e\u793a\u5728\u6807\u51c6\u8f93\u51fa\u4e0a\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u5feb\u901f\u67e5\u627e\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u4e3b\u51fd\u6570\u7684\u4f4d\u7f6e\u3002</p> <ol> <li> <p>\u67e5\u770b Makefile\u6216CMakeLists\u6587\u4ef6\uff1a    \u5982\u679c\u9879\u76ee\u4f7f\u7528\u4e86Makefile\u6216CMakeLists\u8fdb\u884c\u6784\u5efa\uff0c\u53ef\u4ee5\u67e5\u770b\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u662f\u5426\u6307\u5b9a\u4e86\u7a0b\u5e8f\u7684\u5165\u53e3\u6587\u4ef6\u3002\u901a\u5e38\u4f1a\u6709\u7c7b\u4f3c<code>TARGET</code>\u6216<code>EXECUTABLE</code>\u7684\u5b9a\u4e49\uff0c\u6307\u5b9a\u4e86\u53ef\u6267\u884c\u6587\u4ef6\u7684\u540d\u79f0\u3002</p> </li> <li> <p>\u4f7f\u7528<code>objdump</code>\u547d\u4ee4\uff1a    \u53ef\u4ee5\u4f7f\u7528<code>objdump</code>\u547d\u4ee4\u6765\u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684\u7b26\u53f7\u8868\uff0c\u627e\u5230<code>main</code>\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\u3002\u4f8b\u5982\uff1a</p> </li> </ol> <p><pre><code>objdump -t &lt;executable_file&gt; | grep main\n</code></pre>    \u8fd9\u5c06\u5217\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u6240\u6709\u5305\u542b<code>main</code>\u7684\u7b26\u53f7\uff0c\u5305\u62ec<code>main</code>\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\u3002</p> <ol> <li>\u4f7f\u7528<code>readelf</code>\u547d\u4ee4\uff1a    \u53ef\u4ee5\u4f7f\u7528<code>readelf</code>\u547d\u4ee4\u6765\u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8282\u5934\u8868\uff0c\u627e\u5230<code>main</code>\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\u3002\u4f8b\u5982\uff1a    <pre><code>readelf -s &lt;executable_file&gt; | grep main\n</code></pre>    \u8fd9\u5c06\u5217\u51fa\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u6240\u6709\u5305\u542b<code>main</code>\u7684\u7b26\u53f7\uff0c\u5305\u62ec<code>main</code>\u51fd\u6570\u7684\u5165\u53e3\u5730\u5740\u3002</li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u60a8\u53ef\u4ee5\u5728\u5927\u578bC\u9879\u76ee\u4e2d\u627e\u5230\u6700\u521d\u7684<code>main</code>\u51fd\u6570\u5165\u53e3\uff0c\u4ee5\u4fbf\u4e86\u89e3\u7a0b\u5e8f\u7684\u6574\u4f53\u7ed3\u6784\u548c\u542f\u52a8\u6d41\u7a0b\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#cpuh","title":"\u80fd\u4e0d\u80fd\u627e\u6587\u4ef6\u540d\u662f\u8fd9\u4e2a\u7684\u5462\uff1f\u6bd4\u5982\u8bf4\u662f <code>cpu.h</code> \u7684\uff1f","text":"<p>\u8981\u5728Linux\u7cfb\u7edf\u4e2d\u627e\u5230\u6587\u4ef6\u540d\u4e3a<code>cpu.h</code>\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528<code>find</code>\u547d\u4ee4\u3002<code>find</code>\u547d\u4ee4\u53ef\u4ee5\u5728\u6307\u5b9a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e2d\u641c\u7d22\u6587\u4ef6\uff0c\u5e76\u6839\u636e\u6307\u5b9a\u7684\u6761\u4ef6\u8fdb\u884c\u8fc7\u6ee4\u3002</p> <p>\u4e0b\u9762\u662f\u4f7f\u7528<code>find</code>\u547d\u4ee4\u67e5\u627e\u6587\u4ef6\u540d\u4e3a<code>cpu.h</code>\u7684\u6587\u4ef6\u7684\u793a\u4f8b\uff1a</p> <pre><code>find /path/to/search -type f -name \"cpu.h\"\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\uff1a - <code>/path/to/search</code>\u662f\u8981\u641c\u7d22\u7684\u76ee\u5f55\u8def\u5f84\u3002\u60a8\u53ef\u4ee5\u5c06\u5176\u66ff\u6362\u4e3a\u60a8\u5e0c\u671b\u641c\u7d22\u7684\u5b9e\u9645\u76ee\u5f55\u8def\u5f84\u3002 - <code>-type f</code>\u8868\u793a\u53ea\u641c\u7d22\u666e\u901a\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u76ee\u5f55\u6216\u5176\u4ed6\u7c7b\u578b\u7684\u6587\u4ef6\u3002 - <code>-name \"cpu.h\"</code>\u8868\u793a\u8981\u641c\u7d22\u7684\u6587\u4ef6\u540d\u4e3a<code>cpu.h</code>\u3002</p> <p>\u6267\u884c\u4e0a\u9762\u7684\u547d\u4ee4\u540e\uff0c<code>find</code>\u547d\u4ee4\u5c06\u5728\u6307\u5b9a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e2d\u67e5\u627e\u6587\u4ef6\u540d\u4e3a<code>cpu.h</code>\u7684\u6587\u4ef6\uff0c\u5e76\u8f93\u51fa\u76f8\u5e94\u7684\u6587\u4ef6\u8def\u5f84\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u8f93\u51fa\u7684\u6587\u4ef6\u8def\u5f84\u627e\u5230\u76ee\u6807\u6587\u4ef6<code>cpu.h</code>\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#find-grep-sed","title":"find \u548c grep \u548csed\u5b66\u4e60","text":""},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#find","title":"find","text":""},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture2.%20Shell%20Tools%20and%20Scripting/text%20processing/shell.html#grep","title":"grep","text":"<p><code>grep</code> \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u5b83\u7528\u4e8e\u641c\u7d22\u6587\u4ef6\u5185\u5bb9\uff0c\u627e\u51fa\u5305\u542b\u6307\u5b9a\u6a21\u5f0f\u7684\u884c\u3002\u4ee5\u4e0b\u662f <code>grep</code> \u7684\u4e00\u4e9b\u57fa\u672c\u7528\u6cd5\uff1a</p> <ol> <li>\u57fa\u672c\u641c\u7d22\uff1a    \u4f7f\u7528 <code>grep</code> \u641c\u7d22\u5305\u542b\u7279\u5b9a\u6587\u672c\u7684\u884c\uff1a</li> </ol> <p><pre><code>grep \"pattern\" filename\n</code></pre>    \u8fd9\u5c06\u641c\u7d22\u6587\u4ef6 <code>filename</code> \u4e2d\u6240\u6709\u5305\u542b\u5b57\u7b26\u4e32 <code>pattern</code> \u7684\u884c\uff0c\u5e76\u5c06\u5176\u6253\u5370\u51fa\u6765\u3002</p> <ol> <li>\u9012\u5f52\u641c\u7d22\uff1a    \u4f7f\u7528 <code>-r</code> \u6216 <code>--recursive</code> \u9009\u9879\u9012\u5f52\u641c\u7d22\u76ee\u5f55\uff1a</li> </ol> <p><pre><code>grep -r \"pattern\" /path/to/directory\n</code></pre>    \u8fd9\u5c06\u641c\u7d22\u6307\u5b9a\u76ee\u5f55\u53ca\u5176\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002</p> <ol> <li>\u884c\u53f7\uff1a    \u4f7f\u7528 <code>-n</code> \u9009\u9879\u663e\u793a\u5339\u914d\u884c\u7684\u884c\u53f7\uff1a</li> </ol> <pre><code>grep -n \"pattern\" filename\n</code></pre> <ol> <li>\u53ea\u6253\u5370\u6587\u4ef6\u540d\uff1a    \u4f7f\u7528 <code>-l</code> \u9009\u9879\u53ea\u6253\u5370\u5305\u542b\u5339\u914d\u884c\u7684\u6587\u4ef6\u540d\uff1a</li> </ol> <pre><code>grep -l \"pattern\" filename\n</code></pre> <ol> <li>\u4e0d\u663e\u793a\u5339\u914d\u884c\uff1a    \u4f7f\u7528 <code>-L</code> \u9009\u9879\u53ea\u6253\u5370\u4e0d\u5305\u542b\u5339\u914d\u884c\u7684\u6587\u4ef6\u540d\uff1a</li> </ol> <pre><code>grep -L \"pattern\" filename\n</code></pre> <ol> <li>\u5ffd\u7565\u5927\u5c0f\u5199\uff1a    \u4f7f\u7528 <code>-i</code> \u9009\u9879\u8fdb\u884c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u641c\u7d22\uff1a</li> </ol> <pre><code>grep -i \"pattern\" filename\n</code></pre> <ol> <li> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a    \u4f7f\u7528 <code>-E</code> \u9009\u9879\u542f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a    <pre><code>grep -E \"regexp\" filename\n</code></pre></p> </li> <li> <p>\u6392\u9664\u5339\u914d\uff1a    \u4f7f\u7528 <code>-v</code> \u6216 <code>--invert-match</code> \u9009\u9879\u6392\u9664\u5339\u914d\u7684\u884c\uff1a    <pre><code>grep -v \"pattern\" filename\n</code></pre></p> </li> <li> <p>\u53ea\u6253\u5370\u5339\u914d\u7684\u884c\uff1a    \u4f7f\u7528 <code>-o</code> \u9009\u9879\u53ea\u6253\u5370\u5339\u914d\u7684\u90e8\u5206\uff1a    <pre><code>grep -o \"pattern\" filename\n</code></pre></p> </li> <li> <p>\u56fa\u5b9a\u5b57\u7b26\u4e32\uff1a     \u4f7f\u7528 <code>-F</code> \u9009\u9879\u544a\u8bc9 <code>grep</code> \u641c\u7d22\u7684\u662f\u56fa\u5b9a\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>grep -F \"pattern\" filename\n</code></pre> </li> <li> <p>\u884c\u524d\u540e\u5185\u5bb9\uff1a     \u4f7f\u7528 <code>-C</code> \u6216 <code>--context</code> \u9009\u9879\u6253\u5370\u5339\u914d\u884c\u524d\u540e\u7684\u51e0\u884c\u5185\u5bb9\uff1a       <pre><code>grep -C 5 \"pattern\" filename\n</code></pre>       \u8fd9\u5c06\u6253\u5370\u5339\u914d\u884c\u53ca\u5176\u524d\u540e\u54045\u884c\u7684\u5185\u5bb9\u3002</p> </li> <li> <p>\u4f7f\u7528\u7ba1\u9053\uff1a     \u53ef\u4ee5\u5c06 <code>grep</code> \u7ed3\u5408\u5176\u4ed6\u547d\u4ee4\u4f7f\u7528\uff0c\u4f8b\u5982\u7ed3\u5408 <code>ls</code> \u6765\u641c\u7d22\u76ee\u5f55\uff1a       <pre><code>ls -l | grep \"pattern\"\n</code></pre></p> </li> <li> <p>\u53c2\u6570\u603b\u7ed3</p> <p><code>grep</code> \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u7528\u4e8e\u5728\u6587\u4ef6\u4e2d\u641c\u7d22\u5339\u914d\u7279\u5b9a\u6a21\u5f0f\u7684\u884c\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684 <code>grep</code> \u53c2\u6570\uff1a</p> <ol> <li> <p><code>-i</code> \u6216 <code>--ignore-case</code>\uff1a\u5ffd\u7565\u5927\u5c0f\u5199\u5dee\u5f02\u3002</p> </li> <li> <p><code>-c</code> \u6216 <code>--count</code>\uff1a\u53ea\u8f93\u51fa\u5339\u914d\u884c\u7684\u6570\u91cf\uff0c\u800c\u4e0d\u8f93\u51fa\u5339\u914d\u7684\u884c\u672c\u8eab\u3002</p> </li> <li> <p><code>-v</code> \u6216 <code>--invert-match</code>\uff1a\u663e\u793a\u4e0d\u5339\u914d\u6a21\u5f0f\u7684\u884c\u3002</p> </li> <li> <p><code>-l</code> \u6216 <code>--files-with-matches</code>\uff1a\u53ea\u8f93\u51fa\u5305\u542b\u5339\u914d\u884c\u7684\u6587\u4ef6\u540d\u3002</p> </li> <li> <p><code>-L</code> \u6216 <code>--files-without-match</code>\uff1a\u53ea\u8f93\u51fa\u4e0d\u5305\u542b\u5339\u914d\u884c\u7684\u6587\u4ef6\u540d\u3002</p> </li> <li> <p><code>-r</code> \u6216 <code>--recursive</code>\uff1a\u9012\u5f52\u5730\u641c\u7d22\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002</p> </li> <li> <p><code>-h</code> \u6216 <code>--no-filename</code>\uff1a\u4e0d\u663e\u793a\u6587\u4ef6\u540d\u3002</p> </li> <li> <p><code>-n</code> \u6216 <code>--line-number</code>\uff1a\u5728\u8f93\u51fa\u7684\u6bcf\u884c\u524d\u52a0\u4e0a\u884c\u53f7\u3002</p> </li> <li> <p><code>--color</code>\uff1a\u5c06\u5339\u914d\u7684\u6587\u672c\u9ad8\u4eae\u663e\u793a\u3002</p> </li> <li> <p><code>-E</code> \u6216 <code>--extended-regexp</code>\uff1a\u4f7f\u7528\u6269\u5c55\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> </li> <li> <p><code>-F</code> \u6216 <code>--fixed-strings</code>\uff1a\u5c06\u6a21\u5f0f\u4f5c\u4e3a\u56fa\u5b9a\u5b57\u7b26\u4e32\uff08\u975e\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u8fdb\u884c\u641c\u7d22\u3002</p> </li> <li> <p><code>-w</code> \u6216 <code>--word-regexp</code>\uff1a\u53ea\u5339\u914d\u6574\u4e2a\u5355\u8bcd\u3002</p> </li> <li> <p><code>-x</code> \u6216 <code>--line-regexp</code>\uff1a\u53ea\u5339\u914d\u6574\u884c\u3002</p> </li> <li> <p><code>-A</code> \u6216 <code>--after-context</code>\uff1a\u9664\u4e86\u5339\u914d\u7684\u884c\u5916\uff0c\u8fd8\u8f93\u51fa\u5339\u914d\u884c\u4e4b\u540e\u7684\u82e5\u5e72\u884c\u3002</p> </li> <li> <p><code>-B</code> \u6216 <code>--before-context</code>\uff1a\u9664\u4e86\u5339\u914d\u7684\u884c\u5916\uff0c\u8fd8\u8f93\u51fa\u5339\u914d\u884c\u4e4b\u524d\u7684\u82e5\u5e72\u884c\u3002</p> </li> <li> <p><code>-C</code> \u6216 <code>--context</code> \u6216 <code>--around-context</code>\uff1a\u540c\u65f6\u4f7f\u7528 <code>-A</code> \u548c <code>-B</code>\uff0c\u8f93\u51fa\u5339\u914d\u884c\u524d\u540e\u7684\u82e5\u5e72\u884c\u3002</p> </li> <li> <p><code>-P</code> \u6216 <code>--perl-regexp</code>\uff1a\u4f7f\u7528 Perl \u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> </li> <li> <p><code>-s</code> \u6216 <code>--no-messages</code>\uff1a\u4e0d\u663e\u793a\u9519\u8bef\u4fe1\u606f\u3002</p> </li> <li> <p><code>-q</code> \u6216 <code>--quiet</code> \u6216 <code>--silent</code>\uff1a\u4e0d\u8f93\u51fa\u4efb\u4f55\u5185\u5bb9\uff0c\u53ea\u901a\u8fc7\u8fd4\u56de\u72b6\u6001\u7801\u8868\u793a\u662f\u5426\u627e\u5230\u5339\u914d\u3002</p> </li> <li> <p><code>-e</code> \u6216 <code>--regexp</code>\uff1a\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> </li> </ol> <p>\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\uff0c\u4ee5\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u641c\u7d22\u529f\u80fd\u3002\u4f8b\u5982\uff0c<code>grep -i -r \"pattern\" /path/to/directory</code> \u4f1a\u9012\u5f52\u5730\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b\u641c\u7d22\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d \"pattern\" \u7684\u884c\u3002</p> </li> </ol>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html","title":"Data wrangling","text":""},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#regular-expression","title":"regular expression","text":"<p>RegexOne - Learn Regular Expressions - Lesson 1: An Introduction, and the ABCs</p> <p>\u76f4\u63a5\u4e0a\u624b\u7528\u3002</p> <p></p> <p><code>[abc]</code> \u5339\u914d <code>abc</code> \u4e09\u4e2a\u5b57\u7b26\u4e2d\u7684\u4e00\u4e2a\uff0c\u8981\u5339\u914d\u591a\u7684\uff0c<code>[abc]+</code></p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#sed","title":"sed","text":"<p>\u4ee5\u4e3a <code>ssh</code> \u7684 <code>log</code> \u6587\u4ef6 \u4e3a\u4f8b\u5b50\uff0c\u5177\u4f53\u770b\u89c6\u9891</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#sed-introduction","title":"sed introduction","text":"<p><code>sed</code> \u662f\u4e00\u4e2a\u57fa\u4e8e\u6587\u672c\u7f16\u8f91\u5668 <code>ed</code> \u6784\u5efa\u7684 \u201c\u6d41\u7f16\u8f91\u5668\u201d \u3002\u5728 <code>sed</code> \u4e2d\uff0c\u60a8\u57fa\u672c\u4e0a\u662f\u5229\u7528\u4e00\u4e9b\u7b80\u77ed\u7684\u547d\u4ee4\u6765\u4fee\u6539\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u64cd\u4f5c\u6587\u4ef6\u7684\u5185\u5bb9\uff08\u5c3d\u7ba1\u60a8\u4e5f\u53ef\u4ee5\u9009\u62e9\u8fd9\u6837\u505a\uff09\u3002\u76f8\u5173\u7684\u547d\u4ee4\u884c\u975e\u5e38\u591a\uff0c\u4f46\u662f\u6700\u5e38\u7528\u7684\u662f <code>s</code>\uff0c\u5373 \u66ff\u6362 \u547d\u4ee4\uff0c\u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>ssh myserver journalctl\n | grep sshd\n | grep \"Disconnected from\"\n | sed 's/.*Disconnected from //'\n</code></pre> <p>\u4e0a\u9762\u8fd9\u6bb5\u547d\u4ee4\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u6bb5\u7b80\u5355\u7684 \u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u79cd\u975e\u5e38\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u57fa\u4e8e\u67d0\u79cd\u6a21\u5f0f\u6765\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u5339\u914d\u3002<code>s</code> \u547d\u4ee4\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a<code>s/REGEX/SUBSTITUTION/flag</code>, \u5176\u4e2d <code>REGEX</code> \u90e8\u5206\u662f\u6211\u4eec\u9700\u8981\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u800c <code>SUBSTITUTION</code> \u662f\u7528\u4e8e\u66ff\u6362\u5339\u914d\u7ed3\u679c\u7684\u6587\u672c\u3002</p> <ul> <li><code>.*</code>\uff1a\u8868\u793a\u4efb\u610f\u6570\u91cf\u7684\u4efb\u610f\u5b57\u7b26\uff0c<code>.</code> \u8868\u793a\u4efb\u610f\u5b57\u7b26\uff0c<code>*</code> \u8868\u793a\u524d\u9762\u7684\u5b57\u7b26\u53ef\u4ee5\u51fa\u73b0\u4efb\u610f\u6b21\u6570\uff08\u5305\u62ec\u96f6\u6b21\uff09\u3002</li> <li><code>/.*Disconnected from /</code>\uff1a\u8868\u793a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u4ece\u884c\u5f00\u59cb\u5230 \"Disconnected from \"\uff08\u5305\u62ec\u7a7a\u683c\uff09\u7684\u6240\u6709\u5b57\u7b26\u3002\u70b9\u53f7 <code>.</code> \u8868\u793a\u4efb\u610f\u5b57\u7b26\uff0c\u661f\u53f7 <code>*</code> \u8868\u793a\u524d\u9762\u7684\u5b57\u7b26\u53ef\u4ee5\u51fa\u73b0\u4efb\u610f\u6b21\u6570\uff08\u5305\u62ec\u96f6\u6b21\uff09\uff0c\u6240\u4ee5 <code>.*</code> \u4f1a\u5339\u914d\u5c3d\u53ef\u80fd\u591a\u7684\u5b57\u7b26\u3002</li> <li>\u7b2c\u4e8c\u4e2a <code>/</code> \u540e\u9762\u6ca1\u6709\u5185\u5bb9\uff0c\u8868\u793a\u7528\u7a7a\u5b57\u7b26\u4e32\u66ff\u6362\u5339\u914d\u5230\u7684\u6587\u672c\u3002</li> <li>\u6700\u540e\u4e00\u4e2a <code>/</code> \u540e\u9762\u6ca1\u6709\u6807\u5fd7\uff0c\u6240\u4ee5\u6ca1\u6709\u7279\u6b8a\u7684\u66ff\u6362\u884c\u4e3a\u3002</li> </ul> <p>\u53c8\uff1a<code>echo 'aba' | sed 's/[ab]//'</code> or <code>echo 'abc' | sed 's/[ab]//g'</code></p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#sed-and-regex","title":"sed and regex","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u975e\u5e38\u5e38\u89c1\u4e5f\u975e\u5e38\u6709\u7528\uff0c\u503c\u5f97\u60a8\u82b1\u4e9b\u65f6\u95f4\u53bb\u7406\u89e3\u5b83\u3002\u8ba9\u6211\u4eec\u4ece\u8fd9\u4e00\u53e5\u6b63\u5219\u8868\u8fbe\u5f0f\u5f00\u59cb\u5b66\u4e60\uff1a <code>/.*Disconnected from /</code>\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u901a\u5e38\u4ee5\uff08\u5c3d\u7ba1\u5e76\u4e0d\u603b\u662f\uff09 <code>/</code> \u5f00\u59cb\u548c\u7ed3\u675f\u3002\u5927\u591a\u6570\u7684 ASCII \u5b57\u7b26\u90fd\u8868\u793a\u5b83\u4eec\u672c\u6765\u7684\u542b\u4e49\uff0c\u4f46\u662f\u6709\u4e00\u4e9b\u5b57\u7b26\u786e\u5b9e\u5177\u6709\u8868\u793a\u5339\u914d\u884c\u4e3a\u7684\u201c\u7279\u6b8a\u201d\u542b\u4e49\u3002\u4e0d\u540c\u5b57\u7b26\u6240\u8868\u793a\u7684\u542b\u4e49\uff0c\u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\uff0c\u4e5f\u4f1a\u6709\u6240\u53d8\u5316\uff0c\u8fd9\u4e00\u70b9\u786e\u5b9e\u4ee4\u4eba\u6cae\u4e27\u3002\u5e38\u89c1\u7684\u6a21\u5f0f\u6709\uff1a</p> <ul> <li><code>.</code> \u9664\u6362\u884c\u7b26\u4e4b\u5916\u7684 \u201c\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\u201d</li> <li><code>*</code> \u5339\u914d\u524d\u9762\u5b57\u7b26\u96f6\u6b21\u6216\u591a\u6b21 \uff08\u914d\u5408\u4f7f\u7528 <code>.*</code> \u4efb\u610f\u6570\u91cf\u7684\u4efb\u610f\u5b57\u7b26\uff09</li> <li><code>+</code> \u5339\u914d\u524d\u9762\u5b57\u7b26\u4e00\u6b21\u6216\u591a\u6b21</li> <li><code>[abc]</code> \u5339\u914d <code>a</code>, <code>b</code> \u548c <code>c</code> \u4e2d\u7684\u4efb\u610f\u4e00\u4e2a</li> <li><code>(RX1|RX2)</code> \u4efb\u4f55\u80fd\u591f\u5339\u914d <code>RX1</code> \u6216 <code>RX2</code> \u7684\u7ed3\u679c</li> <li><code>^</code> \u884c\u9996</li> <li><code>$</code> \u884c\u5c3e \uff08\u914d\u5408\u4f7f\u7528 's/^ ..... $//' \u5339\u914d\u6574\u4e00\u884c\uff09</li> </ul> <p><code>sed</code> \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u6709\u4e9b\u65f6\u5019\u662f\u6bd4\u8f83\u5947\u602a\u7684\uff0c\u5b83\u9700\u8981\u4f60\u5728\u8fd9\u4e9b\u6a21\u5f0f\u524d\u6dfb\u52a0 <code>\\</code> \u624d\u80fd\u4f7f\u5176\u5177\u6709\u7279\u6b8a\u542b\u4e49\u3002\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u6dfb\u52a0 <code>-E</code> \u9009\u9879\u6765\u652f\u6301\u8fd9\u4e9b\u5339\u914d\u3002</p> <p>\u4e00\u4e2a\u6709\u95ee\u9898\u7684\u4f8b\u5b50\uff1a</p> <pre><code>echo 'an 17 03:13:00 thesquareplanet.com sshd[2631]: Disconnected from invalid user Disconnected from 46.97.239.16 port 55920 [preauth]' | sed 's/.*Disconnected from //'\n\noutput:\n46.97.239.16 port 55920 [preauth]\n</code></pre> <p><code>*</code> \u548c <code>+</code> \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u8d2a\u5a6a\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u4f1a\u5c3d\u53ef\u80fd\u591a\u7684\u5339\u914d\u6587\u672c\u3002</p> <p>\u8fd9\u53ef\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\u3002\u5bf9\u4e8e\u67d0\u4e9b\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b9e\u73b0\u6765\u8bf4\uff0c\u60a8\u53ef\u4ee5\u7ed9 <code>*</code> \u6216 <code>+</code> \u589e\u52a0\u4e00\u4e2a <code>?</code> \u540e\u7f00\u4f7f\u5176\u53d8\u6210\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff0c\u4f46\u662f\u5f88\u53ef\u60dc <code>sed</code> \u5e76\u4e0d\u652f\u6301\u8be5\u540e\u7f00\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u5207\u6362\u5230 perl \u7684\u547d\u4ee4\u884c\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u652f\u6301\u7f16\u5199\u8fd9\u6837\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>perl -pe 's/.*?Disconnected from //'\n</code></pre> <p>\u56de\u5230 <code>sed</code>\uff0c\u5b8c\u6574\u7684\u64cd\u4f5c</p> <pre><code>sed -E 's/.*Disconnected from (invalid |authenticating )?user .* [^ ]+ port [0-9]+( \\[preauth\\])?$//'\n</code></pre> <p>\u5177\u4f53\u914d\u5408\u89c6\u9891\u548c regex101: build, test, and debug regex \u89e3\u6790\u3002</p> <p>\u597d\u597d\u5229\u7528 regex \u548c GPT</p> <p>\uff0c\u9700\u8981\u7528\u5230 <code>(.*)</code> capture group \u6355\u83b7\u7ec4\u3002</p> <pre><code>sed -E 's/.*Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$//' | less\n</code></pre> <p>\u4f46\u662f\u4e0a\u9762\u7684\u5904\u7406\u8fd8\u6709\u95ee\u9898\uff0c\u65e5\u5fd7\u7684\u5185\u5bb9\u5168\u90e8\u88ab\u66ff\u6362\u6210\u4e86\u7a7a\u5b57\u7b26\u4e32\uff0c\u6574\u4e2a\u65e5\u5fd7\u7684\u5185\u5bb9\u56e0\u6b64\u90fd\u88ab\u5220\u9664\u4e86\u3002\u4f46\u662f\u6211\u4eec\u5b9e\u9645\u5e0c\u671b user \u540e\u9762\u7684 name \u4fdd\u7559\u4e0b\u6765\uff0c\u5bf9\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u201c\u6355\u83b7\u7ec4\uff08capture groups\uff09\u201d\u6765\u5b8c\u6210\u3002\u88ab\u5706\u62ec\u53f7\u5185\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5230\u7684\u6587\u672c\uff0c\u90fd\u4f1a\u88ab\u5b58\u5165\u4e00\u7cfb\u5217\u4ee5\u7f16\u53f7\u533a\u5206\u7684\u6355\u83b7\u7ec4\u4e2d\u3002\u6355\u83b7\u7ec4\u7684\u5185\u5bb9\u53ef\u4ee5\u5728\u66ff\u6362\u5b57\u7b26\u4e32\u65f6\u4f7f\u7528\uff08\u6709\u4e9b\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5f15\u64ce\u751a\u81f3\u652f\u6301\u66ff\u6362\u8868\u8fbe\u5f0f\u672c\u8eab\uff09\uff0c\u4f8b\u5982 <code>\\1</code>\u3001 <code>\\2</code>\u3001<code>\\3</code> \u7b49\u7b49\uff0c\u6211\u4eec\u5339\u914d\u7b2c\u4e8c\u4e2a\u6355\u83b7\u7ec4 <code>(.*)</code> \u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4</p> <pre><code>sed -E 's/.*Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$/\\2/' | less\n</code></pre> <p>\u4f46\u662f\u4f9d\u7136\u6709\u95ee\u9898\uff0c\u8981\u662f\u7528\u6237\u518d\u641e\u602a\uff0c\u5b83\u7684\u7528\u6237\u540d\u4e3a\u6574\u6761 log \u6587\u4ef6\u600e\u4e48\u529e\uff1f\u975e\u8d2a\u5a6a\u6a21\u5f0f\u3002\u5177\u4f53\u770b\u89c6\u9891\u3002</p> <pre><code>sed -E 's/.*?Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$//' | less\n</code></pre> <p>\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\uff0c\u8d2a\u5a6a\u6a21\u5f0f\u548c\u975e\u8d2a\u5a6a\u6a21\u5f0f\u662f\u6307\u5339\u914d\u65f6\u7684\u4e24\u79cd\u4e0d\u540c\u884c\u4e3a\uff1a</p> <ol> <li>\u8d2a\u5a6a\u6a21\u5f0f\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f\u5728\u5339\u914d\u65f6\u4f1a\u5c3d\u53ef\u80fd\u591a\u5730\u5339\u914d\u5b57\u7b26\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u627e\u5230\u6700\u957f\u7684\u5339\u914d\u5b57\u7b26\u4e32\u3002</li> <li>\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff1a\u4e0e\u8d2a\u5a6a\u6a21\u5f0f\u76f8\u53cd\uff0c\u975e\u8d2a\u5a6a\u6a21\u5f0f\u4f1a\u5c3d\u53ef\u80fd\u5c11\u5730\u5339\u914d\u5b57\u7b26\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u627e\u5230\u6700\u77ed\u7684\u5339\u914d\u5b57\u7b26\u4e32\u3002</li> </ol> <p><code>sed</code> \u8fd8\u53ef\u4ee5\u505a\u5f88\u591a\u5404\u79cd\u5404\u6837\u6709\u8da3\u7684\u4e8b\u60c5\uff0c\u4f8b\u5982\u6587\u672c\u6ce8\u5165\uff1a(\u4f7f\u7528 <code>i</code> \u547d\u4ee4)\uff0c\u6253\u5370\u7279\u5b9a\u7684\u884c (\u4f7f\u7528 <code>p</code> \u547d\u4ee4)\uff0c\u57fa\u4e8e\u7d22\u5f15\u9009\u62e9\u7279\u5b9a\u884c\u7b49\u7b49\u3002\u8be6\u60c5\u8bf7\u89c1 <code>man sed</code>!</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#more","title":"more","text":"<p>\u4f46\u662f <code>sed</code> \u5e76\u4e0d\u662f\u5b8c\u7f8e\u7684\u5de5\u5177\uff0c\u5b83\u5728\u641c\u7d22\u548c\u66ff\u6362\u65b9\u9762\u786e\u5b9e\u5f88\u6709\u7528\uff0c\u4f46\u6211\u4eec\u4e0d\u80fd\u53ea\u7528 <code>sed</code>\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86\u4e00\u4e2a\u5305\u542b\u7528\u6237\u540d\u7684\u5217\u8868\uff0c\u5217\u8868\u4e2d\u7684\u7528\u6237\u90fd\u66fe\u7ecf\u5c1d\u8bd5\u8fc7\u767b\u5f55\u6211\u4eec\u7684\u7cfb\u7edf\u3002\u4f46\u8fd9\u8fd8\u4e0d\u591f\uff0c\u8ba9\u6211\u4eec\u8fc7\u6ee4\u51fa\u90a3\u4e9b\u6700\u5e38\u51fa\u73b0\u7684\u7528\u6237\uff1a</p> <pre><code>ssh myserver journalctl\n | grep sshd\n | grep \"Disconnected from\"\n | sed -E 's/.*Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$/\\2/'\n | sort | uniq -c\n</code></pre> <p><code>sort</code> \u4f1a\u5bf9\u5176\u8f93\u5165\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u3002<code>uniq -c</code> \u4f1a\u628a\u8fde\u7eed\u51fa\u73b0\u7684\u884c\u6298\u53e0\u4e3a\u4e00\u884c\u5e76\u4f7f\u7528\u51fa\u73b0\u6b21\u6570\u4f5c\u4e3a\u524d\u7f00\u3002\u6211\u4eec\u5e0c\u671b\u6309\u7167\u51fa\u73b0\u6b21\u6570\u6392\u5e8f\uff0c\u8fc7\u6ee4\u51fa\u6700\u5e38\u51fa\u73b0\u7684\u7528\u6237\u540d\uff1a</p> <pre><code>ssh myserver journalctl\n | grep sshd\n | grep \"Disconnected from\"\n | sed -E 's/.*Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$/\\2/'\n | sort | uniq -c\n | sort -nk1,1 | tail -n10\n</code></pre> <p>\u8865\u5145</p> <p><code>uniq</code> \u547d\u4ee4\u5728 Unix \u548c\u7c7b Unix \u7cfb\u7edf\u4e2d\u7528\u4e8e\u62a5\u544a\u6216\u7701\u7565\u91cd\u590d\u7684\u884c\u3002<code>-c</code> \u53c2\u6570\u662f <code>uniq</code> \u547d\u4ee4\u7684\u4e00\u4e2a\u9009\u9879\uff0c\u7528\u4e8e\u663e\u793a\u6bcf\u884c\u7684\u51fa\u73b0\u6b21\u6570\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c<code>uniq -c</code> \u4f1a\u4e3a\u8f93\u5165\u4e2d\u7684\u6bcf\u884c\uff08\u5728\u76f8\u90bb\u7684\u91cd\u590d\u884c\u4e2d\uff09\u663e\u793a\u8be5\u884c\u53ca\u5176\u51fa\u73b0\u7684\u6b21\u6570\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u7edf\u8ba1\u67d0\u4e2a\u6a21\u5f0f\u6216\u6587\u672c\u884c\u5728\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>uniq -c [input_file]\n</code></pre> <p>\u5176\u4e2d <code>input_file</code> \u662f\u4f60\u60f3\u8981\u68c0\u67e5\u91cd\u590d\u884c\u7684\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6587\u4ef6 <code>example.txt</code>\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>apple\nbanana\napple\norange\nbanana\napple\n</code></pre> <p>\u8fd0\u884c <code>uniq -c example.txt</code> \u5c06\u4f1a\u5f97\u5230\uff1a</p> <pre><code>      3 apple\n      2 banana\n      1 orange\n</code></pre> <p>\u8fd9\u91cc\u7684\u6570\u5b57\u8868\u793a\u6bcf\u884c\u6587\u672c\u5728\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\u6ce8\u610f\uff0c<code>uniq</code> \u53ea\u80fd\u8bc6\u522b\u8fde\u7eed\u7684\u91cd\u590d\u884c\uff0c\u6240\u4ee5\u5982\u679c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>apple\nbanana\napple\norange\nbanana\n</code></pre> <p><code>uniq</code> \u5c06\u4e0d\u4f1a\u5c06\u7b2c\u4e00\u884c\u7684 <code>apple</code> \u4e0e\u7b2c\u4e09\u884c\u7684 <code>apple</code> \u89c6\u4e3a\u91cd\u590d\uff0c\u56e0\u6b64 <code>-c</code> \u9009\u9879\u4e0d\u4f1a\u8ba1\u6570\u975e\u8fde\u7eed\u7684\u91cd\u590d\u884c\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8981\u5ffd\u7565\u8fde\u7eed\u6027\u7684\u9650\u5236\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>-f</code> \u53c2\u6570\u6307\u5b9a\u5ffd\u7565\u524d\u51e0\u4e2a\u5b57\u6bb5\uff08\u6216\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5ffd\u7565\u524d\u4e00\u884c\uff09\uff1a</p> <pre><code>uniq -c -f 1 example.txt\n</code></pre> <p>\u8fd9\u5c06\u7edf\u8ba1\u6587\u4ef6\u4e2d\u6240\u6709\u91cd\u590d\u884c\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u65e0\u8bba\u5b83\u4eec\u662f\u5426\u76f8\u90bb\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u505a\u8fd8\u662f\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6bd4\u8f83\u63a8\u8350\u5230\u505a\u6cd5\u662f\u5148\u5bf9\u6587\u4ef6\u8fdb\u884c\u6392\u5e8f\u540e\uff0c\u518d\u4f7f\u7528 <code>uniq -c</code>\uff1a</p> <pre><code>sort example.txt | uniq -c | less\n</code></pre> <p>\u53e6\u5916\uff0c<code>sort -n</code> \u4f1a\u6309\u7167\u6570\u5b57\u987a\u5e8f\u5bf9\u8f93\u5165\u8fdb\u884c\u6392\u5e8f\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u6309\u7167\u5b57\u5178\u5e8f\u6392\u5e8f <code>-k1,1</code> \u5219\u8868\u793a\u201c\u4ec5\u57fa\u4e8e\u4ee5\u7a7a\u683c\u5206\u5272\u7684\u7b2c\u4e00\u5217\u8fdb\u884c\u6392\u5e8f\u201d\u3002<code>,n</code> \u90e8\u5206\u8868\u793a\u201c\u4ec5\u6392\u5e8f\u5230\u7b2c n \u4e2a\u90e8\u5206\u201d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u662f\u5230\u884c\u5c3e\u3002\u5c31\u672c\u4f8b\u6765\u8bf4\uff0c\u9488\u5bf9\u6574\u4e2a\u884c\u8fdb\u884c\u6392\u5e8f\u4e5f\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u6211\u4eec\u8fd9\u91cc\u4e3b\u8981\u662f\u4e3a\u4e86\u5b66\u4e60\u8fd9\u4e00\u7528\u6cd5\uff01</p> <p>\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5f97\u5230\u767b\u5f55\u6b21\u6570\u6700\u5c11\u7684\u7528\u6237\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>head</code> \u6765\u4ee3\u66ff <code>tail</code>\u3002\u6216\u8005\u4f7f\u7528 <code>sort -r</code> \u6765\u8fdb\u884c\u5012\u5e8f\u6392\u5e8f\u3002</p> <p>\u76f8\u5f53\u4e0d\u9519\u3002\u4f46\u6211\u4eec\u53ea\u60f3\u83b7\u53d6\u7528\u6237\u540d\uff0c\u800c\u4e14\u4e0d\u8981\u4e00\u884c\u4e00\u4e2a\u5730\u663e\u793a\u3002</p> <pre><code>ssh myserver journalctl\n | grep sshd\n | grep \"Disconnected from\"\n | sed -E 's/.*Disconnected from (invalid |authenticating )?user (.*) [^ ]+ port [0-9]+( \\[preauth\\])?$/\\2/'\n | sort | uniq -c\n | sort -nk1,1 | tail -n10\n | awk '{print $2}' | paste -sd,\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528 <code>paste</code> \u547d\u4ee4\u6765\u5408\u5e76\u884c(<code>-s</code>)\uff0c\u5e76\u6307\u5b9a\u4e00\u4e2a\u5206\u9694\u7b26\u8fdb\u884c\u5206\u5272 (<code>-d</code>)\uff0c\uff08-s -d, \u62fc\u8d77\u6765\uff09</p> <p>\u90a3 <code>awk</code> \u7684\u4f5c\u7528\u53c8\u662f\u4ec0\u4e48\u5462\uff1f</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#awk","title":"awk","text":"<p><code>sed</code> \u662f\u4e00\u79cd\u57fa\u4e8e\u884c\u7684 stream editor \uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e5f\u662f\u9010\u884c\u5339\u914d\u7684\uff0c\u81ea\u7136\u4e5f\u6709\u57fa\u4e8e\u5217\u7684 stream editor\uff1a<code>awk</code></p> <p><code>awk</code> \u5176\u5b9e\u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u53ea\u4e0d\u8fc7\u5b83\u78b0\u5de7\u975e\u5e38\u5584\u4e8e\u5904\u7406\u6587\u672c\u3002\u5173\u4e8e <code>awk</code> \u53ef\u4ee5\u4ecb\u7ecd\u7684\u5185\u5bb9\u592a\u591a\u4e86\uff0c\u9650\u4e8e\u7bc7\u5e45\uff0c\u8fd9\u91cc\u6211\u4eec\u4ec5\u4ecb\u7ecd\u4e00\u4e9b\u57fa\u7840\u77e5\u8bc6\u3002</p> <p>\u9996\u5148\uff0c <code>{print $2}</code> \u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f <code>awk</code> \u7a0b\u5e8f\u63a5\u53d7\u4e00\u4e2a\u6a21\u5f0f\u4e32\uff08\u53ef\u9009\uff09\uff0c\u4ee5\u53ca\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c\u6307\u5b9a\u5f53\u6a21\u5f0f\u5339\u914d\u65f6\u5e94\u8be5\u505a\u4f55\u79cd\u64cd\u4f5c\u3002\u9ed8\u8ba4\u5f53\u6a21\u5f0f\u4e32\u5373\u5339\u914d\u6240\u6709\u884c\uff08\u4e0a\u9762\u547d\u4ee4\u4e2d\u5f53\u7528\u6cd5\uff09\u3002</p> <p>\u5728\u4ee3\u7801\u5757\u4e2d\uff0c<code>$0</code> \u8868\u793a\u6574\u884c\u7684\u5185\u5bb9\uff0c<code>$1</code> \u5230 <code>$n</code> \u4e3a\u4e00\u884c\u4e2d\u7684 n \u4e2a\u533a\u57df\uff0c\u533a\u57df\u7684\u5206\u5272\u57fa\u4e8e <code>awk</code> \u7684\u57df\u5206\u9694\u7b26\uff08\u9ed8\u8ba4\u662f\u7a7a\u683c\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>-F</code> \u6765\u4fee\u6539\uff09\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u7684\u4ee3\u7801\u610f\u601d\u662f\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u884c\u6587\u672c\uff0c\u6253\u5370\u5176\u7b2c\u4e8c\u4e2a\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u7528\u6237\u540d\u3002</p> <pre><code> 111 abc\n 100 edd\n 98 djao\n 82 dapk\n ....\n // match abc, edd...\n</code></pre> <p>\u8ba9\u6211\u4eec\u5eb7\u5eb7\uff0c\u8fd8\u6709\u4ec0\u4e48\u70ab\u9177\u7684\u64cd\u4f5c\u53ef\u4ee5\u505a\u3002\u8ba9\u6211\u4eec\u7edf\u8ba1\u4e00\u4e0b\u6240\u6709\u4ee5 <code>c</code> \u5f00\u5934\uff0c\u4ee5 <code>e</code> \u7ed3\u5c3e\uff0c\u5e76\u4e14\u4ec5\u5c1d\u8bd5\u8fc7\u4e00\u6b21\u767b\u5f55\u7684\u7528\u6237\u3002</p> <pre><code> | awk '$1 == 1 &amp;&amp; $2 ~ /^c[^ ]*e$/ { print $2 }' | wc -l\n</code></pre> <p>\u8ba9\u6211\u4eec\u597d\u597d\u5206\u6790\u4e00\u4e0b\u3002\u9996\u5148\uff0c\u6ce8\u610f\u8fd9\u6b21\u6211\u4eec\u4e3a <code>awk</code> \u6307\u5b9a\u4e86\u4e00\u4e2a\u5339\u914d\u6a21\u5f0f\u4e32\uff08\u4e5f\u5c31\u662f <code>{...}</code> \u524d\u9762\u7684\u90a3\u90e8\u5206\u5185\u5bb9\uff09\u3002\u8be5\u5339\u914d\u8981\u6c42\u6587\u672c\u7684\u7b2c\u4e00\u90e8\u5206\u9700\u8981\u7b49\u4e8e 1\uff08\u8fd9\u90e8\u5206\u521a\u597d\u662f <code>uniq -c</code> \u5f97\u5230\u7684\u8ba1\u6570\u503c\uff09\uff0c\u7136\u540e\u5176\u7b2c\u4e8c\u90e8\u5206\u5fc5\u987b\u6ee1\u8db3\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u4ee3\u7801\u5757\u4e2d\u7684\u5185\u5bb9\u5219\u8868\u793a\u6253\u5370\u7528\u6237\u540d\u3002\u7136\u540e\u6211\u4eec\u4f7f\u7528 <code>wc -l</code> \u7edf\u8ba1\u8f93\u51fa\u7ed3\u679c\u7684\u884c\u6570\u3002</p> <p>\u4e0d\u8fc7\uff0c\u65e2\u7136 <code>awk</code> \u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u90a3\u4e48\u5219\u53ef\u4ee5\u8fd9\u6837\uff1a</p> <pre><code>BEGIN { rows = 0 }\n$1 == 1 &amp;&amp; $2 ~ /^c[^ ]*e$/ { rows += $1 }\nEND { print rows }\n</code></pre> <p><code>BEGIN</code> \u4e5f\u662f\u4e00\u79cd\u6a21\u5f0f\uff0c\u5b83\u4f1a\u5339\u914d\u8f93\u5165\u7684\u5f00\u5934\uff08 <code>END</code> \u5219\u5339\u914d\u7ed3\u5c3e\uff09\u3002\u7136\u540e\uff0c\u5bf9\u6bcf\u4e00\u884c\u7b2c\u4e00\u4e2a\u90e8\u5206\u8fdb\u884c\u7d2f\u52a0\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u8f93\u51fa\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u629b\u5f03 <code>grep</code> \u548c <code>sed</code> \uff0c\u56e0\u4e3a <code>awk</code> \u5c31\u53ef\u4ee5 \u89e3\u51b3\u6240\u6709\u95ee\u9898\u3002\u81f3\u4e8e\u600e\u4e48\u505a\uff0c\u5c31\u7559\u7ed9\u8bfb\u8005\u4eec\u505a\u8bfe\u540e\u7ec3\u4e60\u5427\u3002</p>"},{"location":"Course/The%20Missing%20Semester%20of%20Your%20CS%20Education/Lecture4.%20Data%20Wrangling/data%20wrangling.html#_1","title":"\u5206\u6790\u6570\u636e","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html","title":"M1","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#introduction","title":"Introduction","text":"<p>\u89e3\u51b3\u95ee\u9898\u7684\u4e00\u822c\u65b9\u6cd5</p> <p>\u56e0\u4e3a\u4eba\u7684\u8111\u5bb9\u91cf\u6709\u9650\uff0c\u901a\u5e38\u89e3\u51b3\u95ee\u9898\u7684\u529e\u6cd5\u5c31\u662f\u628a\u6bd4\u8f83\u590d\u6742\u7684\u95ee\u9898\u5206\u89e3\u6210\u5c0f\u95ee\u9898\uff0c\u518d\u628a\u5c0f\u95ee\u9898\u7ee7\u7eed\u5206\u89e3\u4e0b\u53bb\u3002\u800c\u5728\u5b66\u6821\u91cc\u6240\u505a\u7684\u8bad\u7ec3\u5c31\u662f\u5efa\u7acb\u95ee\u9898\u5206\u89e3\u7684\u601d\u8def\u548c\u57f9\u517b\u89e3\u51b3\u95ee\u9898\u7684\u80fd\u529b\u3002\u5982\u679c\u60f3\u81ea\u5df1\u5c1d\u8bd5\uff0c\u6211\u4eec\u4e5f\u9f13\u52b1\u5927\u5bb6\u5ffd\u7565\u4e0b\u9762\u7684\u6559\u7a0b\uff0c\u81ea\u5df1\u52a8\u624b\u641e\u5b9a\uff0c\u9047\u5230\u4e0d\u660e\u767d\u7684\u5730\u65b9\u53ef\u4ee5\u6c42\u52a9 Google (Bing, Stackoverflow, ...)\uff1b\u4f46\u5bf9\u4e8e\u8fd9\u6837\u7684\u7b80\u5355\u4efb\u52a1\uff0c\u5927\u8bed\u8a00\u6a21\u578b\u7684\u8868\u73b0\u5c31\u6709\u4e9b\u592a\u597d\u4e86 (\u8bf7\u4e0d\u8981\u7528\u5b83\u4eec\uff01)\u3002\u5b8c\u6210\u4e4b\u540e\u53ef\u4ee5\u770b\u4e00\u4e0b\u5b9e\u9a8c\u6307\u5357\uff0c\u770b\u81ea\u5df1\u7684\u7406\u89e3\u662f\u5426\u6709\u53ef\u4ee5\u6539\u8fdb\u7684\u7a7a\u95f4\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#basic-implementation","title":"Basic implementation","text":"<ol> <li> <p>\u5148\u4e0d\u8003\u8651\u53c2\u6570\uff0c\u4ec5\u5b9e\u73b0\u529f\u80fd</p> <ol> <li> <p>\u83b7\u53d6\u8fdb\u7a0b\u53f7\uff1a<code>/proc/*</code> \u7684\u5185\u5bb9</p> <ol> <li> <p>\u5165\u95e8\u4e86\u89e3 <code>/proc</code> \u6587\u4ef6\u7cfb\u7edf\u7684\u76f8\u5173\u5185\u5bb9</p> <p>\u7b80\u8981\u770b\u770b <code>man 5 proc</code>\uff0c\u7136\u540e\u5373\u53ef\u5f00\u59cb\uff1a\u89c2\u6d4b\u8fdb\u7a0b\u7684\u53d8\u5316\uff0c\u53ea\u9700\u89e3\u6790\u6587\u672c\u6587\u4ef6\u3002</p> </li> <li> <p>\u5982\u4f55\u7528 C \u8bed\u8a00\u904d\u5386\u76ee\u5f55\uff1f</p> <p>\u8be2\u95ee AI \u4e92\u8054\u7f51\u3002</p> <p><code>opendir, readdir...</code></p> </li> <li> <p>\u9047\u5230\u95ee\u9898</p> <ol> <li> <p>Q1</p> <p>\u4e00\u6b21\u5076\u7136\u968f\u4fbf\u8fdb\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u53d1\u73b0 <code>/proc</code> \u4e0b\u4f1a\u6709\u4e24\u79cd\u8868\u793a \u8fdb\u7a0b \u7684\u65b9\u5f0f\uff0c\uff1f</p> <ul> <li><code>/proc/[pid]/stat</code></li> <li><code>/proc/[pid]/task/[pid].../stat</code></li> </ul> <p>\u5176\u5b9e\u662f\u81ea\u5df1\u4e0d\u4ed4\u7ec6\u770b\u8bb2\u4e49\u4ee5\u53ca\u81ea\u5df1\u758f\u5ffd\uff1a\u591a\u8fdb\u7a0b\u7cfb\u7edf\uff0c\u7236\u5b50\u8fdb\u7a0b\u3002</p> <p>\u4f8b\u5982\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7236\u8fdb\u7a0b\u4e5f\u9690\u85cf\u5728 <code>/proc/[pid]/</code> \u4e2d\u7684\u67d0\u4e2a\u6587\u4ef6\u91cc</p> </li> <li> <p>Q2</p> <p>\u4e3a\u4ec0\u4e48\u521a\u5f00\u59cb\u6ca1\u6709\u53d1\u73b0\u591a\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u663e\u793a\u51fa\u6765\u7684\u6240\u6709\u7684\u8fdb\u7a0b\u4e70\u5230\u77e5\u9053\u540e\u5e76\u6ca1\u6709\u6253\u5370\u51fa\u6765\u5462\uff1fkthreadd?</p> </li> </ol> </li> </ol> </li> <li> <p>\u6784\u5efa\u7531\u8fdb\u7a0b\u7ed3\u70b9\u7ec4\u6210\u7684\u6811</p> <ol> <li>\u5b66\u4e60\u6570\u636e\u7ed3\u6784 \u6811\u7684\u76f8\u5173\u5185\u5bb9\u3002</li> </ol> </li> <li> <p>\u904d\u5386\u6811</p> <ol> <li>\u524d\u5e8f\u904d\u5386</li> </ol> </li> </ol> </li> <li> <p>\u6dfb\u52a0\u53c2\u6570</p> <ol> <li> <p>\u5148\u6dfb\u52a0\u7b80\u5355\u7684\uff1a<code>-V</code>\u3001<code>show-pids</code></p> </li> <li> <p>\u518d\u6dfb\u52a0 <code>numeric-sort</code>\uff0c\u4f46\u662f\u600e\u4e48\u6309\u7167 <code>pid</code> \u987a\u5e8f\u8f93\u51fa\uff1f</p> <p>\u7a81\u7136\u6709\u4e24\u79cd\u60f3\u6cd5\uff1a</p> <ul> <li>\u5728\u6784\u5efa node \u7684\u65f6\u5019\u5c31\u6309\u7167\u987a\u5e8f\u6784\u5efa\uff08\u901a\u8fc7\u6807\u5fd7\u63a7\u5236\uff09---&gt; \u4ee3\u7801\u590d\u6742\uff1f\u597d\u50cf\u4e5f\u6ca1\u90a3\u4e48\u590d\u6742\uff1f</li> <li>\u5728\u6253\u5370\u7684\u65f6\u5019\u91cd\u65b0\u6309\u7167 <code>pid</code> \u53f7\u6392\u5e03\u8282\u70b9\uff1f ---&gt; \u8ba1\u7b97\u91cf\u5927\uff1f</li> </ul> </li> </ol> </li> <li> <p>\u6539\u8fdb</p> <p>\u8f93\u51fa\u5230 stderr\uff1a</p> <p>\u5185\u5b58\u4e00\u76f4\u6cc4\u9732\uff0c\u4f7f\u7528\u5185\u5b58\u6c60</p> </li> </ol> <p>reference\uff1a</p> <p>Valgrind errors: \"invalid read of size 8\" and \"...uninitialised value\" (pset5, speller) - CS50 Stack Exchange</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#learn","title":"learn","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#linux","title":"Linux \u4e2d\u7684\u591a\u8fdb\u7a0b\u548c\u591a\u7ebf\u7a0b","text":"<p>\u5728 <code>/proc</code> \u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u4ee5\u5176\u8fdb\u7a0b ID \u547d\u540d\u7684\u76ee\u5f55\uff0c\u4f8b\u5982 <code>/proc/1234</code>\u3002\u5982\u679c\u8fdb\u7a0b\u6709\u7ebf\u7a0b\uff08\u5728 Linux \u4e2d\u79f0\u4e3a\u4efb\u52a1\uff09\uff0c\u5219\u8fd9\u4e9b\u7ebf\u7a0b\u7684\u4fe1\u606f\u4f1a\u4f4d\u4e8e\u8be5\u8fdb\u7a0b\u76ee\u5f55\u4e0b\u7684 <code>task</code> \u5b50\u76ee\u5f55\u4e2d\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u8fd9\u4e2a <code>task</code> \u76ee\u5f55\u4e0b\u90fd\u6709\u81ea\u5df1\u7684\u4ee5\u5176\u7ebf\u7a0b ID \u547d\u540d\u7684\u5b50\u76ee\u5f55\uff0c\u8fd9\u4e9b\u5b50\u76ee\u5f55\u5305\u542b\u4e86\u7ebf\u7a0b\u7279\u6709\u7684\u4fe1\u606f\uff0c\u5982 <code>stat</code> \u6587\u4ef6\uff0c\u5b83\u5305\u542b\u4e86\u7ebf\u7a0b\u7684\u72b6\u6001\u4fe1\u606f\u3002</p> <p>\u6211\u7684 <code>read_proc</code> \u51fd\u6570\u9996\u5148\u88ab\u8c03\u7528\u6765\u8bfb\u53d6\u8fdb\u7a0b\u7684\u4fe1\u606f\uff08\u4e0d\u662f\u7ebf\u7a0b\uff09\uff0c\u7136\u540e <code>read_proc_dir</code> \u51fd\u6570\u904d\u5386\u6bcf\u4e2a\u8fdb\u7a0b\u7684 <code>task</code> \u76ee\u5f55\uff0c\u8c03\u7528 <code>read_proc</code> \u51fd\u6570\u6765\u8bfb\u53d6\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002\u8fd9\u6837\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6784\u5efa\u4e00\u4e2a\u5305\u542b\u6240\u6709\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u8fdb\u7a0b\u6811\u3002</p> <p>\u4f8b\u5982\uff0c <code>/proc/1898/task</code> \u76ee\u5f55\u4e0b\u6709\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>1898  1899  1900  1902  1903  1905\n</code></pre> <p>\u8fd9\u8868\u793a\u8fdb\u7a0b ID \u4e3a 1898 \u7684\u8fdb\u7a0b\u6709\u591a\u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u7684 ID \u5206\u522b\u662f 1898\u30011899\u30011900\u30011902\u30011903 \u548c 1905\u3002\u8fd9\u4e9b\u7ebf\u7a0b ID \u5e76\u4e0d\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\uff0c\u5b83\u4eec\u53ea\u662f\u7528\u6765\u6807\u8bc6\u8fdb\u7a0b\u7684\u4e0d\u540c\u7ebf\u7a0b\u3002</p> <p>\u5728 Linux \u4e2d\uff0c\u7ebf\u7a0b\u88ab\u89c6\u4e3a\u8f7b\u91cf\u7ea7\u7684\u8fdb\u7a0b\uff0c\u5b83\u4eec\u88ab\u5305\u542b\u5728\u5b83\u4eec\u6240\u5c5e\u7684\u8fdb\u7a0b\u4e0b\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u662f\u8fdb\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u4eec\u5171\u4eab\u8fdb\u7a0b\u7684\u5927\u90e8\u5206\u8d44\u6e90\uff0c\u5982\u5185\u5b58\u7a7a\u95f4\u3001\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b49\uff0c\u4f46\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u6267\u884c\u6808\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u8fd9\u6837\u8bbe\u8ba1\u662f\u5f97\u4ed6\u4eec\u80fd\u591f\u5e76\u53d1\u6267\u884c\uff0c\u53c8\u4f7f\u5f97\u7ebf\u7a0b\u4e4b\u95f4\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u6bd4\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\u8981\u5feb\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u9700\u8981\u5207\u6362\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u76f8\u540c\u7684\u540d\u5b57\uff1f</p> <p>\u5728 Linux \u4e2d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u8fdb\u7a0b ID\uff08PID\uff09\uff0c\u800c\u4e14\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5c5e\u4e8e\u67d0\u4e2a\u8fdb\u7a0b\u3002\u5bf9\u4e8e\u5355\u7ebf\u7a0b\u8fdb\u7a0b\uff0c\u8fdb\u7a0b ID \u548c\u7ebf\u7a0b ID \u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u8fdb\u7a0b\u53ea\u6709\u4e00\u4e2a\u6267\u884c\u6d41\u3002\u5bf9\u4e8e\u591a\u7ebf\u7a0b\u8fdb\u7a0b\uff0c\u9664\u4e86\u4e3b\u7ebf\u7a0b\uff08\u4e0e\u8fdb\u7a0b\u540c\u65f6\u521b\u5efa\u7684\u7ebf\u7a0b\uff09\u7684\u7ebf\u7a0b ID \u4e0e\u8fdb\u7a0b ID \u76f8\u540c\u4e4b\u5916\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4f1a\u6709\u81ea\u5df1\u7684\u7ebf\u7a0b ID\uff0c\u8fd9\u4e9b\u7ebf\u7a0b ID \u901a\u5e38\u662f\u552f\u4e00\u7684\uff0c\u5e76\u4e14\u4e0e\u8fdb\u7a0b ID \u4e0d\u540c\u3002</p> <p>\u5728 <code>/proc/1898/task</code> \u76ee\u5f55\u4e0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b ID \u5bf9\u5e94\u7684\u5b50\u76ee\u5f55\uff08\u4f8b\u5982 <code>/proc/1898/task/1899</code>\uff09\u5305\u542b\u4e86\u8be5\u7ebf\u7a0b\u7279\u5b9a\u7684\u4fe1\u606f\uff0c\u5982\u72b6\u6001\u3001\u7edf\u8ba1\u4fe1\u606f\u7b49\u3002\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u5b50\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff08\u5982 <code>stat</code> \u6587\u4ef6\uff09\u6765\u83b7\u53d6\u3002</p> <p><code>/proc/1898/task</code> \u76ee\u5f55\u4e0b\u7684\u6bcf\u4e2a\u6570\u5b57\u76ee\u5f55\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u5171\u540c\u5c5e\u4e8e\u8fdb\u7a0b ID \u4e3a 1898 \u7684\u8fdb\u7a0b\u3002\u8fd9\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u4f7f\u5f97\u7cfb\u7edf\u80fd\u591f\u4ee5\u8fdb\u7a0b\u4e3a\u5355\u4f4d\u7ba1\u7406\u548c\u8c03\u5ea6\u7ebf\u7a0b\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u5355\u72ec\u7684\u76d1\u63a7\u548c\u8c03\u8bd5\u3002</p> <p>proc(5): process info pseudo-file system - Linux man page (die.net)</p> <p>The /proc Filesystem \u2014 The Linux Kernel documentation</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#_1","title":"\u5185\u5b58\u6c60\u7684\u7ba1\u7406","text":"<p>Memory pool - Wikipedia</p> <p>\u76ee\u524d\u7684\u7b80\u5355\u5b9e\u73b0\u7248\u672c\uff1a</p> <pre><code>#define POOL_BLOCK_SIZE 1024\n#define POOL_MAX_BLOCKS 1024\n\ntypedef struct {\n    char *block;\n    char *free_ptr;\n    size_t remaining;\n    char *next_block; // \u7528\u4e8e\u5b58\u50a8\u4e0b\u4e00\u4e2a\u5757\u7684\u6307\u9488\n} memory_pool_t;\nmemory_pool_t proc_pool;\n\nvoid memory_pool_init(memory_pool_t *pool) {\n    pool-&gt;block = malloc(POOL_BLOCK_SIZE + sizeof(char *));\n    if (!pool-&gt;block) {\n        fprintf(stderr, \"Failed to allocate memory pool block\\n\");\n        exit(EXIT_FAILURE);\n    }\n    pool-&gt;free_ptr = pool-&gt;block + sizeof(char *);\n    pool-&gt;remaining = POOL_BLOCK_SIZE - sizeof(char *);\n    pool-&gt;next_block = NULL;\n    *(char **)(pool-&gt;block + POOL_BLOCK_SIZE) = NULL; // \u521d\u59cb\u5316 next_block \u4e3a NULL\n}\n\nvoid memory_pool_destroy(memory_pool_t *pool) {\n    char *block = pool-&gt;block;\n    while (block) {\n        char *next_block = *(char **)(block + POOL_BLOCK_SIZE);\n        free(block);\n        block = next_block;\n    }\n    pool-&gt;block = NULL;\n    pool-&gt;free_ptr = NULL;\n    pool-&gt;remaining = 0;\n    pool-&gt;next_block = NULL;\n}\n\nvoid *memory_pool_alloc(memory_pool_t *pool, size_t size) {\n    if (pool-&gt;remaining &lt; size) {\n        char *new_block = malloc(POOL_BLOCK_SIZE + sizeof(char *));\n        if (!new_block) {\n            fprintf(stderr, \"Failed to allocate new memory pool block\\n\");\n            exit(EXIT_FAILURE);\n        }\n        *(char **)(new_block + POOL_BLOCK_SIZE) = pool-&gt;block;\n        pool-&gt;block = new_block;\n        pool-&gt;free_ptr = new_block + sizeof(char *);\n        pool-&gt;remaining = POOL_BLOCK_SIZE - sizeof(char *);\n    }\n\n    void *ptr = pool-&gt;free_ptr;\n    pool-&gt;free_ptr += size;\n    pool-&gt;remaining -= size;\n    return ptr;\n}\n</code></pre> <p><code>*(char **)(pool-&gt;block + POOL_BLOCK_SIZE) = NULL; // \u521d\u59cb\u5316 next_block \u4e3a NULL</code></p> <p>\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u53bb\u6389\u8fd9\u4e00\u884c\uff0c\u5c31\u4f1a\u6709\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u518d\u66f4\u65b0\uff1a</p> <p>\u518d\u56de\u6765\u770b\uff0c\u5c31\u4e0d\u9700\u8981\u4e0a\u9762\u8fd9\u884c\u4ee3\u7801\u4e86\uff0c\u6709\u70b9\u8ff7\u7cca\u3002</p> <p>\u518d\u770b kimi \u7684\u89e3\u91ca\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#own-test","title":"Own test","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html#qemu-system-arch-qemu-arch","title":"qemu-system-arch &amp; qemu-arch","text":"<p>\u7531\u4e8e\u65e0\u6cd5\u4f7f\u7528\u5230\u5357\u5927\u6821\u5185oj\u6765\u6d4b\u8bd5\u81ea\u5df1\u5199\u7684\u4ee3\u7801\u7684\u79fb\u690d\u6027\uff0c\u6240\u4ee5\u8003\u8651\u4f7f\u7528 qemu \u6765\u6d4b\u8bd5\u3002</p> <p>\u6709\u4e24\u4e2aqemu\uff0c\u4e0d\u77e5\u9053\u4f7f\u7528\u54ea\u4e2a\u4ee5\u53ca\u4e8c\u8005\u533a\u522b\uff0c\u76f4\u63a5\u627e\u627e\uff1a</p> <p>kvm virtualization - Difference between qemu-kvm, qemu-system-x86_64, qemu-x86_64</p> <p>[Qemu-discuss] Difference between qemu-kvm, qemu-system-x86_64, qemu (gnu.org)</p> <ul> <li>qemu-arch like <code>/usr/local/bin/qemu-x86_64</code> is for running a program of that arch on the host machine of what ever arch, but not a virtual machine</li> <li>qemu-system-arch like <code>/usr/local/bin/qemu-system-x86_64</code> is for running a system of that arch on the host machine</li> <li>to enable kvm support, qemu parameter <code>-enable-kvm</code> is needed, libvirt should have taken care of this if right xml is configured</li> </ul> <ol> <li> <p>qemu-arch (<code>/usr/local/bin/qemu-x86_64</code>)\uff1a</p> <ul> <li>\u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u5728\u5f53\u524d\u4e3b\u673a\u67b6\u6784\u4e0a\u76f4\u63a5\u8fd0\u884c\u76ee\u6807\u67b6\u6784\u7684\u7a0b\u5e8f\uff0c\u800c\u4e0d\u662f\u8fd0\u884c\u4e00\u4e2a\u5b8c\u6574\u7684\u865a\u62df\u673a\u7cfb\u7edf\u3002</li> <li>\u5b83\u5141\u8bb8\u4f60\u5728\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u6a21\u62df\u4e0d\u540c\u67b6\u6784\u7684\u7a0b\u5e8f\u6267\u884c\uff0c\u4f46\u4e0d\u6d89\u53ca\u865a\u62df\u5316\u786c\u4ef6\u6216\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</li> <li>\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u6d4b\u8bd5\u4f60\u7684\u7a0b\u5e8f\u5728x86_64\u67b6\u6784\u4e0a\u7684\u884c\u4e3a\uff0c\u800c\u4e0d\u9700\u8981\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684x86_64\u7cfb\u7edf\u3002</li> </ul> </li> <li> <p>qemu-system-arch (<code>/usr/local/bin/qemu-system-x86_64</code>)\uff1a</p> <ul> <li>\u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u5728\u5f53\u524d\u4e3b\u673a\u4e0a\u6a21\u62df\u4e00\u4e2a\u5b8c\u6574\u7684\u76ee\u6807\u67b6\u6784\u7cfb\u7edf\u3002</li> <li>\u5b83\u63d0\u4f9b\u4e86\u865a\u62df\u5316\u786c\u4ef6\u652f\u6301\uff0c\u5141\u8bb8\u4f60\u8fd0\u884c\u4e00\u4e2a\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5c31\u50cf\u5728\u7269\u7406\u673a\u5668\u4e0a\u4e00\u6837\u3002</li> <li>\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u6d4b\u8bd5\u4f60\u7684\u7a0b\u5e8f\u5728\u4e00\u4e2a\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u4e2d\u7684\u884c\u4e3a\uff0c\u5305\u62ec\u542f\u52a8\u8fc7\u7a0b\u3001\u7cfb\u7edf\u8c03\u7528\u7b49\u3002</li> </ul> <p>\u8fd9\u5c31\u662fjyy\u5728\u8bfe\u4e0a\u4f7f\u7528\u7684\u8fd9\u4e2a\uff0c\u7528\u4e8e\u5b66\u4e60\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u884c\u4e3a\uff0c\u4eceboot\u9053kernel init</p> </li> </ol> <p>\u7efc\u4e0a\uff1a</p> <p>\u5bf9\u4e8e\u6d4b\u8bd5\u4ee3\u7801\u7684\u79fb\u690d\u6027\uff0c\u76f4\u63a5\u7528 <code>qemu-x86_64</code>\u3002</p> <p>\u6d4b\u8bd5\u5728\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u4e2d\u7684\u884c\u4e3a\uff0c\u7528 <code>qemu-system-x86_64</code>\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u8981\u786e\u4fdd\u7a0b\u5e8f\u5df2\u7ecf\u4ea4\u53c9\u7f16\u8bd1\u4e3a\u76ee\u6807\u67b6\u6784\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html","title":"M2","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html#introduction","title":"Introduction","text":"<p>\u7531\u4e8e\u6ca1\u6709\u7cfb\u7edf\u5730\u4e0a\u8fc7\u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840\uff0c\u8fd9\u91cc\u518d\u7b80\u5355\u8865\u5145\u4e00\u4e9b x86/x64 \u6c47\u7f16\u53ca System V ABI \u7684\u90e8\u5206\u5185\u5bb9\u3002</p> <p>\u66f4\u591a\u8be6\u7ec6\u70b9\u5185\u5bb9\u8fd8\u662f\u67e5\u770b manual\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html#system-v-abi","title":"System V ABI","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html#_1","title":"\u53c2\u6570\u4f20\u9012","text":"<p>SysV \u8c03\u7528\u7ea6\u5b9a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u662f\uff1a\u5728\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u5bf9\u4e8e\u6574\u578b\u548c\u6307\u9488\u7c7b\u578b\u7684\u5b9e\u53c2\uff0c\u9700\u8981\u5206\u522b\u4f7f\u7528\u5bc4\u5b58\u5668 rdi\u3001rsi\u3001rdx\u3001rcx\u3001r8\u3001r9\uff0c\u6309\u51fd\u6570\u5b9a\u4e49\u65f6\u53c2\u6570\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u8fdb\u884c\u4f20\u503c\u3002\u800c\u82e5\u4e00\u4e2a\u51fd\u6570\u63a5\u6536\u7684\u53c2\u6570\u8d85\u8fc7\u4e86 6 \u4e2a\uff0c\u5219\u4f59\u4e0b\u53c2\u6570\u5c06\u901a\u8fc7\u6808\u5185\u5b58\u8fdb\u884c\u4f20\u9001\u3002\u6b64\u65f6\uff0c\u591a\u51fa\u6765\u7684\u53c2\u6570\u5c06\u6309\u7167\u4ece\u53f3\u5f80\u5de6\uff08RTL\uff09\u7684\u987a\u5e8f\u88ab\u9010\u4e2a\u538b\u5165\u6808\u4e2d\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u56fe A \u53f3\u4fa7\u7b2c 30 \u5230 40 \u884c\u7ea2\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u5f97\u5230\u9a8c\u8bc1\u3002</p> <p>\u8fd9\u91cc\uff0c\u51fd\u6570 foo \u5728\u8c03\u7528\u524d\uff0c\u5206\u522b\u7528\u5bc4\u5b58\u5668 edi\u3001esi \u5b58\u653e\u5c40\u90e8\u53d8\u91cf x \u4e0e y \u7684\u503c\uff0c\u5e76\u7528\u5bc4\u5b58\u5668 edx\u3001ecx\u3001r8d\u3001r9d \u5b58\u653e\u5b57\u9762\u91cf\u503c 3\u30014\u30015\u30016\uff08\u5982\u679c\u4f60\u8fd8\u4e0d\u4e86\u89e3\u5bc4\u5b58\u5668 rdi \u4e0e edi \u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u5728\u8bfe\u524d\u70ed\u8eab\u4e00\u8bb2\u4e2d\u5f97\u5230\u7b54\u6848\uff09\u3002\u800c\u591a\u51fa\u6765\u7684\u53e6\u5916\u4e24\u4e2a\u5b57\u9762\u91cf\u503c\u53c2\u6570 7 \u548c 8 \uff0c\u5219\u76f4\u63a5\u901a\u8fc7 push \u6307\u4ee4\u88ab\u653e\u5728\u4e86\u6808\u5185\u5b58\u4e2d\u3002\u4f60\u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u6307\u4ee4\u64cd\u4f5c\u5b83\u4eec\u7684\u5148\u540e\u987a\u5e8f\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u53c2\u6570\u4ee5\u4ece\u53f3\u5411\u5de6\u7684\u987a\u5e8f\u88ab\u653e\u5165\u6808\u4e2d\u3002\u53e6\u5916\uff0c\u7531\u4e8e x\u3001y \u4e3a\u5c40\u90e8\u53d8\u91cf\uff0c\u56e0\u6b64\u6700\u5f00\u59cb\u5b83\u4eec\u4f1a\u88ab\u5b58\u50a8\u5728\u6808\u5185\u5b58\u4e2d\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5bf9\u4e8e\u6d6e\u70b9\u53c2\u6570\uff0c\u7f16\u8bd1\u5668\u5c06\u4f1a\u4f7f\u7528\u53e6\u5916\u7684 xmm0 \u5230 xmm7\uff0c\u5171 8 \u4e2a\u5bc4\u5b58\u5668\u8fdb\u884c\u5b58\u50a8\u3002\u5bf9\u4e8e\u66f4\u5bbd\u7684\u503c\uff0c\u4e5f\u53ef\u80fd\u4f1a\u4f7f\u7528 ymm \u4e0e zmm \u5bc4\u5b58\u5668\u6765\u66ff\u4ee3 xmm \u5bc4\u5b58\u5668\u3002\u800c\u4e0a\u9762\u63d0\u5230\u7684 xmm\u3001ymm\u3001zmm \u5bc4\u5b58\u5668\uff0c\u90fd\u662f\u7531 x86 \u6307\u4ee4\u96c6\u67b6\u6784\u4e2d\u540d\u4e3a AVX\uff08Advanced Vector Extensions\uff09\u7684\u6269\u5c55\u6307\u4ee4\u96c6\u4f7f\u7528\u7684\u3002\u8fd9\u4e9b\u6307\u4ee4\u96c6\u4e00\u822c\u4e13\u95e8\u7528\u4e8e\u6d6e\u70b9\u6570\u8ba1\u7b97\u4ee5\u53ca SIMD \u76f8\u5173\u7684\u5904\u7406\u8fc7\u7a0b\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html#_2","title":"\u8fd4\u56de\u503c\u4f20\u9012","text":""},{"location":"Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html#_3","title":"\u5bc4\u5b58\u5668\u4f7f\u7528","text":""},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html","title":"L0","text":"<p>\u5b9e\u9a8c\u8981\u6c42\uff1a\u663e\u793a\u4e00\u5f20\u56fe\u7247</p> <p>\u4f60\u9700\u8981\u7f16\u5199\u4e00\u4e2a\u76f4\u63a5\u8fd0\u884c\u5728 AbstractMachine \u4e0a (\u4ec5\u4ec5\u542f\u7528 IOE \u6269\u5c55\uff0c\u4e0d\u4f7f\u7528\u5176\u4ed6\u786c\u4ef6\u673a\u5236\u5982\u4e2d\u65ad/\u5f02\u5e38/\u865a\u62df\u5b58\u50a8/\u591a\u5904\u7406\u5668) \u7684\u7a0b\u5e8f\uff0c\u663e\u793a\u4e00\u5f20\u56fe\u7247\uff1b\u6ee1\u8db3\uff1a</p> <ol> <li>\u663e\u793a\u4e00\u5f20\u4efb\u4f55\u56fe\u7247\uff0c\u4f46\u80fd\u9002\u914d\u4e0d\u540c\u7684\u5c4f\u5e55\u5927\u5c0f\u3002\u786e\u4fdd\u4f60\u7684\u56fe\u7247\u5728 320\u00d7200\u3001320\u00d7200\u3001640\u00d7480\u3001640\u00d7480\u3001800\u00d7600\u3001800\u00d7600 \u7b49\u5206\u8fa8\u7387\u4e0b\u5747\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\uff1b</li> <li>\u56fe\u7247\u4e2d\u5305\u542b\u4e0d\u5c11\u4e8e 10 \u79cd\u989c\u8272\u3002</li> <li>\u7a0b\u5e8f\u4f7f\u7528\u7684\u5185\u5b58 (\u4ee3\u7801\u3001\u9759\u6001\u6570\u636e\u603b\u548c\u4e0d\u8d85\u8fc7 4 MiB\u3001\u5806\u533a <code>heap</code> \u4f7f\u7528\u4e0d\u8d85\u8fc7 4 MiB)\uff1b</li> <li>\u6309 ESC \u952e\u540e\u8c03\u7528 <code>halt()</code> \u9000\u51fa\uff1b\u9664\u6b64\u4e4b\u5916\uff0c\u6309\u4efb\u4f55\u952e\u7a0b\u5e8f\u90fd\u4e0d\u5e94\u9000\u51fa\u3002</li> </ol>"},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html#-freestanding","title":"-freestanding","text":"<p>C Library - OSDev Wiki</p> <p>The <code>__STDC_HOSTED__</code> macro expands to <code>1</code> on hosted implementations, or 0 on freestanding ones. The freestanding headers are: <code>float.h</code>, <code>iso646.h</code>, <code>limits.h</code>, <code>stdalign.h</code>, <code>stdarg.h</code>, <code>stdbool.h</code>, <code>stddef.h</code>, <code>stdint.h</code>, and <code>stdnoreturn.h</code>. You should be familiar with these headers as they contain useful declarations you shouldn't do yourself. GCC also comes with additional freestanding headers for CPUID, SSE and such.</p> <p>\u8fd9\u4e9b\u5934\u6587\u4ef6\u4e2d\u5305\u542b\u4e86 freestanding \u7a0b\u5e8f\u4e5f\u53ef\u4f7f\u7528\u7684\u58f0\u660e\u3002\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ef\u53d8\u53c2\u6570\u7ecf\u8fc7\u9884\u7f16\u8bd1\u540e\u751f\u6210\u4e86\u7c7b\u4f3c <code>__builtin_va_arg</code> \u7684 builtin \u8c03\u7528\uff0c\u7531\u7f16\u8bd1\u5668\u7ffb\u8bd1\u6210\u4e86\u7279\u5b9a\u7684\u6c47\u7f16\u4ee3\u7801\u3002</p> <p>\"ffreestanding\" \u662f\u4e00\u4e2a\u7f16\u8bd1\u5668\u9009\u9879\uff0c\u901a\u5e38\u4e0e C \u6216 C++ \u8bed\u8a00\u7684\u7f16\u8bd1\u5668\uff08\u5982 GCC\uff09\u4e00\u8d77\u4f7f\u7528\u3002\u8fd9\u4e2a\u9009\u9879\u7528\u4e8e\u6307\u5b9a\u7f16\u8bd1\u76ee\u6807\u662f\u4e00\u4e2a\u72ec\u7acb\u73af\u5883\uff08freestanding environment\uff09\uff0c\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0c\u6807\u51c6\u5e93\u53ef\u80fd\u4e0d\u5b58\u5728\uff0c\u7a0b\u5e8f\u7684\u5165\u53e3\u51fd\u6570\u4e0d\u4e00\u5b9a\u662f <code>main</code>\u3002\u8fd9\u4e0e\u201c\u6258\u7ba1\u73af\u5883\u201d\uff08hosted environment\uff09\u76f8\u5bf9\uff0c\u540e\u8005\u5047\u5b9a\u5b58\u5728\u4e00\u4e2a\u5b8c\u6574\u7684\u6807\u51c6\u5e93\uff0c\u5e76\u4e14\u7a0b\u5e8f\u901a\u5e38\u4ece <code>main</code> \u51fd\u6570\u5f00\u59cb\u6267\u884c\u3002</p> <p>\u5728\u72ec\u7acb\u73af\u5883\u4e2d\uff0c\u7f16\u8bd1\u5668\u4e0d\u4f1a\u5047\u8bbe\u6807\u51c6\u5e93\u7684\u5b58\u5728\uff0c\u8fd9\u610f\u5473\u7740\u67d0\u4e9b\u4f9d\u8d56\u4e8e\u6807\u51c6\u5e93\u7684\u529f\u80fd\u53ef\u80fd\u65e0\u6cd5\u4f7f\u7528\u3002\u8fd9\u79cd\u73af\u5883\u901a\u5e38\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u3001\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u6216\u5176\u4ed6\u9700\u8981\u6700\u5c0f\u5316\u8d44\u6e90\u4f7f\u7528\u7684\u573a\u666f\u3002\u4f8b\u5982\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5f00\u53d1\u65f6\uff0c\u5185\u6838\u4ee3\u7801\u901a\u5e38\u5728\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528 <code>-ffreestanding</code> \u9009\u9879\u6765\u7f16\u8bd1\u3002</p> <p>\u4f7f\u7528 <code>-ffreestanding</code> \u9009\u9879\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u5b9a\u4e49\u5b8f <code>__STDC_HOSTED__</code> \u4e3a <code>0</code>\uff0c\u800c\u5728\u6258\u7ba1\u73af\u5883\u4e2d\u5219\u5b9a\u4e49\u4e3a <code>1</code>\u3002\u8fd9\u5141\u8bb8\u5f00\u53d1\u8005\u5728\u4ee3\u7801\u4e2d\u6839\u636e\u5b8f\u7684\u503c\u6765\u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u67d0\u4e9b\u4f9d\u8d56\u4e8e\u6807\u51c6\u5e93\u7684\u7279\u6027\u3002</p> <p>\u6b64\u5916\uff0c\u72ec\u7acb\u5b9e\u73b0\u7684\u7f16\u8bd1\u73af\u5883\u5bf9\u591a\u7ebf\u7a0b\u6267\u884c\u548c\u6570\u636e\u7ade\u4e89\u7684\u884c\u4e3a\u3001<code>main</code> \u51fd\u6570\u7684\u8981\u6c42\u4ee5\u53ca\u53ef\u7528\u7684\u6807\u51c6\u5e93\u5934\u6587\u4ef6\u90fd\u6709\u7279\u5b9a\u7684\u89c4\u5b9a\u3002\u4f8b\u5982\uff0c\u5728\u72ec\u7acb\u5b9e\u73b0\u4e2d\uff0c\u7a0b\u5e8f\u662f\u5426\u9700\u8981\u5b9a\u4e49 <code>main</code> \u51fd\u6570\u3001\u7a0b\u5e8f\u542f\u52a8\u548c\u7ec8\u6b62\u7684\u8fc7\u7a0b\u3001\u4ee5\u53ca\u591a\u7ebf\u7a0b\u7684\u652f\u6301\u90fd\u662f\u7531\u5177\u4f53\u7684\u5b9e\u73b0\u5b9a\u4e49\u7684\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html#_1","title":"\u5206\u89e3\u95ee\u9898","text":"<ol> <li> <p>\u5b9e\u73b0 klib</p> <p>PA \u5b9e\u73b0\u3002</p> </li> <li> <p>\u8bbf\u95ee I/O \u8bbe\u5907</p> <p>\u6709\u4ec0\u4e48 I/O \u8bbe\u5907\uff1f\u600e\u4e48\u8bbf\u95ee\uff1f</p> </li> <li> <p>\u7ed8\u5236\u56fe\u7247</p> <p>\u6709\u8fc7\u73a9 OLED \u7ed8\u5236 \u56fe\u7247\u7684\u5e94\u8be5\u90fd\u4e86\u89e3\u3002\u518d\u770b\u770b\u8bb2\u4e49\u4e5f\u90fd\u660e\u767d\u3002</p> <p>\u8981\u5c06JPEG\u56fe\u7247\u8f6c\u6362\u4e3aC\u8bed\u8a00\u6570\u7ec4\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u4e13\u95e8\u7684\u5de5\u5177\u6765\u5e2e\u52a9\u4f60\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\u3002\u6839\u636e\u641c\u7d22\u7ed3\u679c\uff0c\u8fd9\u91cc\u6709\u51e0\u4e2a\u65b9\u6cd5\u4f60\u53ef\u4ee5\u5c1d\u8bd5\uff1a</p> <ol> <li> <p>\u4f7f\u7528<code>xxd</code>\u5de5\u5177\uff1a    <code>xxd</code>\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e8c\u8fdb\u5236\u6587\u4ef6\u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u7684\u6587\u672c\u8868\u793a\u3002\u5bf9\u4e8eJPEG\u56fe\u7247\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a    <pre><code>xxd -i image.jpg image_data.h\n</code></pre>    \u8fd9\u5c06\u751f\u6210\u4e00\u4e2aC\u8bed\u8a00\u5934\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u56fe\u7247\u6570\u636e\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u6570\u7ec4\u5d4c\u5165\u5230\u4f60\u7684C\u7a0b\u5e8f\u4e2d\u3002</p> </li> <li> <p>\u4f7f\u7528<code>image_to_c</code>\u5de5\u5177\uff1a    <code>image_to_c</code>\u662f\u4e00\u4e2a\u5f00\u6e90\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e8c\u8fdb\u5236\u56fe\u50cf\u6587\u4ef6\uff08\u5982PNG\u3001JPEG\u7b49\uff09\u8f6c\u6362\u6210C\u8bed\u8a00\u6e90\u4ee3\u7801\u5f62\u5f0f\u7684<code>uint8_t</code>\u6570\u7ec4\u3002\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u7a0b\u5e8f\u4e2d\u96c6\u6210\u56fe\u7247\u8d44\u6e90\uff0c\u800c\u4e0d\u9700\u8981\u5916\u90e8\u6587\u4ef6\u3002\u5b89\u88c5\u548c\u4f7f\u7528\u6b65\u9aa4\u5982\u4e0b\uff1a</p> </li> <li> <p>\u514b\u9686\u4ed3\u5e93\u5e76\u7f16\u8bd1\uff1a      <pre><code>git clone https://github.com/bitbank2/image_to_c.git\ncd image_to_c\nmake\n</code></pre></p> </li> <li> <p>\u8fd0\u884c\u5de5\u5177\u8f6c\u6362\u56fe\u7247\uff1a      <pre><code>./image2c image.jpg &gt; image_data.h\n</code></pre>      \u8fd9\u5c06\u751f\u6210\u4e00\u4e2a\u540d\u4e3a<code>image_data.h</code>\u7684\u5934\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u56fe\u7247\u6570\u636e\u7684C\u6570\u7ec4\u8868\u793a\u3002</p> </li> <li> <p>\u4f7f\u7528LVGL\u56fe\u7247\u8f6c\u6362\u5de5\u5177\uff1a    \u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528LVGL\uff08Light and Versatile Graphics Library\uff09\u8fdb\u884c\u5d4c\u5165\u5f0f\u5f00\u53d1\uff0cLVGL\u63d0\u4f9b\u4e86\u4e00\u4e2a\u56fe\u7247\u8f6c\u6362\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06JPEG\u7b49\u56fe\u7247\u683c\u5f0f\u8f6c\u6362\u4e3aC\u8bed\u8a00\u6570\u7ec4\u3002\u8fd9\u4e2a\u5de5\u5177\u7684\u4e0b\u8f7d\u5730\u5740\u662f\uff1ahttps://gitcode.com/open-source-toolkit/06dbc</p> </li> <li> <p>\u624b\u52a8\u8f6c\u6362\uff1a    \u5982\u679c\u4f60\u60f3\u8981\u66f4\u6df1\u5165\u5730\u4e86\u89e3\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u624b\u52a8\u7f16\u5199\u4ee3\u7801\u6765\u8bfb\u53d6JPEG\u6587\u4ef6\uff0c\u5c06\u5176\u89e3\u6790\u4e3aRGB\u503c\uff0c\u5e76\u5c06\u8fd9\u4e9b\u503c\u5199\u5165C\u8bed\u8a00\u6570\u7ec4\u3002\u8fd9\u901a\u5e38\u6d89\u53ca\u5230\u4f7f\u7528JPEG\u89e3\u6790\u5e93\uff0c\u5982libjpeg\uff0c\u6765\u8bfb\u53d6\u548c\u5904\u7406JPEG\u6587\u4ef6\u3002</p> </li> </ol> <p>\u9009\u62e9\u54ea\u79cd\u65b9\u6cd5\u53d6\u51b3\u4e8e\u4f60\u7684\u5177\u4f53\u9700\u6c42\uff0c\u6bd4\u5982\u4f60\u662f\u5426\u9700\u8981\u4e00\u4e2a\u56fe\u5f62\u754c\u9762\uff0c\u6216\u8005\u4f60\u662f\u5426\u5df2\u7ecf\u5728\u4f7f\u7528LVGL\u7b49\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u60c5\u51b5\uff0c\u4f7f\u7528\u73b0\u6210\u7684\u5de5\u5177\u5982<code>xxd</code>\u6216<code>image_to_c</code>\u4f1a\u662f\u6700\u7b80\u5355\u5feb\u6377\u7684\u65b9\u5f0f\u3002</p> </li> </ol> <p>\u4e3b\u8981\u5728\u4e8e\u9605\u8bfb <code>abstract-machine/am/src/x86/qemu/ioe.c</code></p>"},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html#_2","title":"\u6548\u679c","text":"<p>\u6d4b\u8bd5\u4e86\u4e0d\u540c\u7684\u56fe\u7247\uff0c\u5176\u4e2d\u4e4b\u4e00\uff08\u5206\u8fa8\u7387\u4e3a640 x 472\uff09\uff0c\u6700\u7ec8\u6548\u679c\uff1a</p> <p></p>"},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html#_3","title":"\u91cd\u65b0\u8ba4\u8bc6\u6807\u51c6\u5e93","text":""},{"location":"Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html#bmp","title":"\u5206\u89e3 BMP \u65f6\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898","text":"<ol> <li> <p>BMP \u76f8\u5173\u683c\u5f0f</p> <p></p> </li> <li> <p>\u5173\u4e8e\u989c\u8272\u7684\u987a\u5e8f</p> <p>BMP \u56fe\u7247\u4e2d\uff0c\u50cf\u7d20\u7684\u6392\u5e03\u662f BGR\u3002</p> <p>\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u989c\u8272\u901a\u9053\u7684\u8f6c\u6362\u3002</p> <p>\u4f46\u662f\u8981\u83b7\u53d6BMP\u7684\u50cf\u7d20\uff0c\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0cpadding</p> </li> <li> <p>padding\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u8981\u8fdb\u884c padding\uff1f\u600e\u4e48\u8ba1\u7b97 padding \u5927\u5c0f\uff1f\u4e0d\u540c\u7684\u8ba1\u7b97\u65b9\u6cd5\uff1f</p> <p></p> <p>c - Padding in 24-bits rgb bitmap - Stack Overflow</p> <p>\u5173\u4e8e\u5bf9\u9f50\uff0c\u9996\u5148\u60f3\u5230\u7684\u5c31\u662f \u8ba9\u8ba1\u7b97\u673a\u80fd\u4e00\u6b21\u6027\u8bbf\u95ee 4 byte\uff0c\u800c\u4e0d\u7528\u591a\u6b21\u8bbf\u95ee\uff08\u62c6\u5f00\u6765\u8bbf\u95ee\u4f1a\u6709\u9519\u8bef\uff1f\uff09\uff0c\u63d0\u5347\u901f\u5ea6\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\u662f\u6765\u81ea bmp pixel array \u7684\u8981\u6c42\u89c4\u5b9a\u3002</p> <p>\u8fdb\u4e00\u6b65\u8ba1\u7b97\uff1a</p> <p></p> <p>C bmp file padding : r/learnprogramming</p> <p>c++ - non dword aligned pixel to dword aligned bitmap - Stack Overflow</p> <p>I think your question is either, how do you determine in C that 2103 isn't a multiple of 4, or how do you find how much different it is from a multiple of 4? Maybe both questions.</p> <p>\u627e\u5230\u65b9\u6cd5\uff1a</p> <pre><code> // int line_padding = ((src_width * 3 + 31) &amp; ~31) - (src_width * 3);\n // int line_padding = (4 - (src_width * 3) % 4) % 4;\n int line_padding = ((src_width &amp; 32) + 31) &amp; ~31;\n</code></pre> </li> <li> <p>\u8ba1\u7b97 <code>src_index</code></p> <ol> <li>\u8ba1\u7b97\u6bcf\u884c\u7684\u603b\u5b57\u8282\u6570\uff0c\u5305\u62ec\u586b\u5145\uff1a<code>src_width * 4 + line_padding</code>\u3002</li> <li>\u8ba1\u7b97\u7ed9\u5b9a\u884c<code>y</code>\u7684\u8d77\u59cb\u5b57\u8282\u4f4d\u7f6e\uff1a<code>y * (src_width * 4 + line_padding)</code>\u3002</li> <li>\u8ba1\u7b97\u7ed9\u5b9a\u50cf\u7d20<code>x</code>\u5728\u884c\u4e2d\u7684\u5b57\u8282\u4f4d\u7f6e\uff1a<code>x * 4</code>\u3002</li> <li>\u5c06\u884c\u8d77\u59cb\u4f4d\u7f6e\u548c\u50cf\u7d20\u4f4d\u7f6e\u76f8\u52a0\uff0c\u5f97\u5230<code>src_index</code>\u3002</li> </ol> <p><code>int src_index = (y * (src_width * 4 + line_padding)) + (x * 4);</code></p> </li> </ol> <p>\u53c2\u8003\uff1a</p> <p>Bitmap - Wikipedia</p> <p>BMP file format - Wikipedia</p> <p>\u4f4d\u56fe(bmp)\u6587\u4ef6\u683c\u5f0f\u5206\u6790_bitmap \u6587\u4ef6\u683c\u5f0f-CSDN\u535a\u5ba2</p> <p>RGB\u6570\u636e\u5199bmp\u56fe\u7247\u6587\u4ef6\u9047\u5230\u7684\u8fd9\u4e9b\u5751_rgb\u8f6c\u4e3abmp\u6587\u4ef6\u65f6\u989c\u8272\u53cd\u4e86</p> <p>\u4e3a\u4ec0\u4e48\u5728BMP\u56fe\u7247\u4e2d\uff0c\u50cf\u7d20\u7684\u6392\u5e03\u4e3aBGR_bmp \u662fbgr rgb-CSDN\u535a\u5ba2</p> <p>\u6d4b\u8bd5\u901a\u8fc7\u7684C\u4ee3\u7801\uff1a\u5e73\u53f0\u65e0\u5173\u7684RGB\u4fdd\u5b58\u4e3aBMP\u683c\u5f0f\u7684\u56fe\u7247</p> <p>\u624b\u628a\u624b bmp \u683c\u5f0f\u7f16\u89e3\u7801\uff08\u4e8c\uff09\u2014\u2014 \u5f92\u624b\u62c6\u89e3 bmp \u56fe\u50cf_bmp\u89e3\u7801-CSDN\u535a\u5ba2</p> <p>Understanding int Padding in C for BMP Images</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html","title":"introduction","text":"<p>2024 Nanjing University, Operating System: Design and Implementation</p> <p>Mini Labs &amp; OS Labs</p> <p>The individual learning implementation version, without Online Judge, only local test</p> <ul> <li>Course Homepage: https://jyywiki.cn/OS/2024/</li> <li>Lesson Video: https://www.bilibili.com/video/BV1Xm411f7CM</li> </ul>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u8bb2\u5185\u5bb9\uff1a\u4e2a\u4eba/\u8bfe\u7a0b\u7b80\u4ecb\u3001\u64cd\u4f5c\u7cfb\u7edf\u7684\u53d1\u5c55\u5386\u53f2\uff0c\u56de\u7b54\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>(Why): \u4e3a\u4ec0\u4e48\u8981\u5b66\u64cd\u4f5c\u7cfb\u7edf\uff1f</li> <li>(What): \u5230\u5e95\u4ec0\u4e48\u662f\u64cd\u4f5c\u7cfb\u7edf\uff1f</li> <li>(How): \u600e\u4e48\u5b66\u64cd\u4f5c\u7cfb\u7edf\uff1f</li> </ul> <p></p> <p>\u5b66\u4e60\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4ec0\u4e48\uff1f\u9769\u547d\uff1f</p> <p></p> <p>\u4e3a\u4e86\u66f4\u5feb\u66f4\u597d\u5730\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\uff1f</p> <p>\u8fd9\u5b66\u671f\u521a\u5f00\u5b66\u7684\u65f6\u5019\u770b\u7b2c\u4e00\u8282\u8bfe\u5f88\u5403\u529b\uff0c\u505a\u4e86berkeley \u7684lab\u548cproject\u518d\u770b\u8fd9\u4e2a\uff0c\u77ac\u95f4\u7406\u89e3\u4e86\u4e0d\u5c11\u3002cs61c\u7684\u7b2c\u4e00\u4e2aproj\u662f\u7528c\u8bed\u8a00\u5199\u4e00\u4e2a\u8d2a\u5403\u86c7\u5c0f\u6e38\u620f\uff0c\u5305\u62ec\u4f7f\u7528gdb\uff0cvalgrind\u7b49\u5404\u79cd\u5de5\u5177\u8c03\u8bd5\u3002\u7b2c\u4e8c\u4e2aproj\u662f\u5728venus\u4e0a\u7528risc-v\u5199\u6c47\u7f16\u4ee3\u7801\uff0c\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u795e\u7ecf\u7f51\u7edc\uff0c\u4e2d\u95f4\u8c03\u8bd5\u7684\u65f6\u5019\u4e5f\u7528\u5230\u4e86os\uff0c\u628a\u503c\u6253\u5370\u51fa\u6765\u8c03\u8bd5\u3002\u7b2c\u4e09\u4e2aproj\u662f\u7528logisim\u642d\u4e00\u4e2acpu\u3002\u4ece\u6570\u5b57\u903b\u8f91\u5230\u6c47\u7f16\u8bed\u8a00\u5230\u7a0d\u5fae\u9ad8\u7ea7\u4e00\u70b9\u7684c\u8bed\u8a00\u4e09\u5c42\u62bd\u8c61\u90fd\u6db5\u76d6\u4e86\u3002\u7b2c\u56db\u4e2aproj\u662f\u5199\u6570\u636e\u7ea7\u522b\u548c\u7ebf\u7a0b\u7ea7\u522b\u7684\u5e76\u884c\u7a0b\u5e8f\uff0c\u4e5f\u6d89\u53ca\u5230\u4e86race condition,\u540c\u6b65\uff0c\u6b7b\u9501\uff0c\u6d3b\u9501\u7b49\u4e00\u4e9b\u5728os\u91cc\u4f1a\u51fa\u73b0\u7684\u6982\u5ff5\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u9700\u8981\u4ed6\u4eec\u5b66\u6821\u7684hive machine\uff0c\u6ca1\u592a\u6df1\u5165\u505a\u3002</p> <p></p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_2","title":"\u5e94\u7528\u89c6\u89d2\u7684\u64cd\u4f5c\u7cfb\u7edf","text":"<p>\u600e\u4e48\u95ee\u51fa\u95ee\u9898\uff1f</p> <p>\u5b66\u4e60\u6700\u91cd\u8981\u7684\u5185\u5bb9\u5c31\u662f \u63d0\u95ee</p> <p>\u4e00\u5207\u90fd\u662f\u72b6\u6001\u673a\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_3","title":"\u6784\u5efa\u6700\u5c0f\u53ef\u6267\u884c\u6587\u4ef6 \uff08\u7a0b\u5e8f = \u72b6\u6001\u673a\uff09","text":"<p>DEMO</p> <p>\u6700\u5c0f\u53ef\u6267\u884c\u6587\u4ef6\uff1a\u4e3a\u4e86\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u7a0b\u5e8f\uff0c\u6211\u4eec\u7684\u76ee\u6807\u662f\u6784\u9020\u4e00\u4e2a\u80fd\u76f4\u63a5\u88ab\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u4e14\u6253\u5370 Hello World \u7684\u6307\u4ee4\u5e8f\u5217\u3002\u5982\u679c\u4f60\u80fd\u60f3\u5230\u5199\u4e00\u6bb5\u6c47\u7f16\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u529f\u80fd\uff0c\u90a3\u4e48\u5927\u8bed\u8a00\u6a21\u578b\u5c31\u80fd\u5e2e\u4f60\u505a\u5230\uff1a</p> <p>\u5982\u4f55\u4ec5\u7528 x86-64 \u6c47\u7f16\u8c03\u7528 Linux \u7cfb\u7edf\u8c03\u7528\uff0c\u8f93\u51fa Hello World \u5e76\u9000\u51fa\uff1f</p> <p>AI \u4e0d\u4ec5\u80fd\u7ed9\u51fa\u4ee3\u7801\uff0c\u800c\u4e14\u8fd8\u80fd\u5e2e\u52a9\u4f60\u89e3\u51b3\u9047\u5230\u7684\u7591\u60d1\u548c\u56f0\u96be\u3002\u5728\u4f60\u719f\u6089\u8fd9\u4e9b\u6982\u5ff5\u4e4b\u540e\uff0csyscall(2) \u548c syscalls(2) \u5c31\u6210\u4e3a\u4e86\u975e\u5e38\u68d2 (\u800c\u4e14\u771f\u6b63 friendly) \u7684\u53c2\u8003\u3002</p> <p>\u80fd\u4e0d\u80fd\u5feb\u901f\u5730\u5199\u51fa\u8fd9\u4e2apromot\uff1f\u786e\u5b9e\u662f\u5f88\u91cd\u8981\u3002\u6307\u660e\u73af\u5883 <code>x86-64</code> \u6c47\u7f16 Linux \u7cfb\u7edf\u8c03\u7528\uff1f</p> <p>\u7a0b\u5e8f\u81ea\u5df1\u662f\u65e0\u6cd5\u9000\u51fa\u7684\uff0c\u5fc5\u987b\u501f\u52a9\u64cd\u4f5c\u7cfb\u7edf\u3002\uff08\u7cfb\u7edf\u8c03\u7528\uff09</p> <p></p> <p></p> <pre><code>#include &lt;sys/syscall.h&gt;\n\n// The x86-64 system call Application Binary Interface (ABI):\n//     System call number: RAX\n//     Arguments: RDI, RSI, RDX, RCX, R8, R9\n//     Return value: RAX\n// See also: syscall(2) syscalls(2)\n\n#define syscall3(id, a1, a2, a3) \\\n    movq $SYS_##id, %rax; \\\n    movq $a1, %rdi; \\\n    movq $a2, %rsi; \\\n    movq $a3, %rdx; \\\n    syscall\n\n#define syscall2(id, a1, a2)  syscall3(id, a1, a2, 0)\n#define syscall1(id, a1)  syscall2(id, a1, 0)\n\n.globl _start\n_start:\n    syscall3(write, 1, addr1, addr2 - addr1)\n    syscall1(exit, 99)\n\naddr1:\n    .ascii \"\\033[01;31mHello, OS World\\033[0m\\n\"\naddr2:\n\n//minimal.S\n</code></pre>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#toybox-010-strace","title":"\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f(toybox-0.1.0 / strace)","text":"<p><code>vscode</code>\u3001\u6d4f\u89c8\u5668\u3001\u7f16\u8bd1\u5668...</p> <p>DEMO</p> <p>toybox-0.1.0\uff1a\u8fd9\u662f\u65e9\u524d\u7248\u672c\u7684 toybox\uff0c\u5305\u542b\u4e00\u4e9b \u201c\u6700\u5c0f\u201d \u7cfb\u7edf\u6240\u9700\u7684\u5de5\u5177\u3002\u73b0\u5728\uff0cAndroid \u5185\u7f6e\u4e86 toybox\u3002\u5f53\u4f60\u6253\u5f00\u624b\u673a\u7684 \u201c\u5f00\u53d1\u8005\u6a21\u5f0f\u201d \u540e\uff0c\u901a\u8fc7 adb shell \u8fde\u63a5\u5230\u624b\u673a\uff0c\u5176\u4e2d\u7684\u547d\u4ee4\u884c\u5de5\u5177\u5c31\u662f toybox\u3002</p> <p></p> <p>\u6240\u4ee5\u6211\u80fd\u50cf\u6539 <code>minimal.S</code> \u7f16\u8bd1\u51fa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e00\u6837\u53bb\u6539\u5b83\u4eec\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u6240\u4ee5\u65b9\u5411 --&gt; \u9006\u5411\u5de5\u7a0b\u3002</p> <p>\u5173\u952e\u5728\u4e8e\u6709\u4e00\u4e2a\u826f\u597d\u7684\u5de5\u5177\uff1a<code>hexedit</code>\u3001<code>trace</code>...</p> <p></p> <p>\u6253\u5f00\u7a0b\u5e8f\u7684\u6267\u884c\uff1aTrace (\u8ffd\u8e2a)</p> <p>In general, trace refers to the process of following anything from the beginning to the end. For example, the <code>traceroute</code> command follows each of the network hops as your computer connects to another computer.</p> <p>DEMO</p> <p>strace (system call trace) \u662f\u300a\u64cd\u4f5c\u7cfb\u7edf\u300b\u8bfe\u7a0b\u4e2d\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5e2e\u52a9\u6211\u4eec \u201c\u89c2\u6d4b\u201d \u5e94\u7528\u7a0b\u5e8f\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fb9\u754c\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u4efb\u4f55\u7a0b\u5e8f\u7684\u6267\u884c\u5c31\u662f\u72b6\u6001\u673a\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u8fd0\u884c\uff0c\u56e0\u6b64 \u201c\u7528\u5408\u9002\u7684\u65b9\u5f0f\u89c2\u6d4b\u72b6\u6001\u673a\u6267\u884c\u201d \u5c31\u662f\u6211\u4eec\u7406\u89e3\u7a0b\u5e8f\u7684\u6839\u672c\u65b9\u6cd5\u3002\u8c03\u8bd5\u5668\u3001trace\u3001profiler \u63d0\u4f9b\u4e86\u4e0d\u540c\u4fa7\u9762\u7684\u7406\u89e3\u624b\u6bb5\uff0c\u8fd9\u4e09\u4e2a\u5de5\u5177\u5c06\u4f1a\u5728\u8bfe\u7a0b\u4e2d\u53cd\u590d\u51fa\u73b0\u3002</p> <p>\u5982\u679c\u4f60\u611f\u5230 strace \u7684\u7ed3\u679c\u4e0d\u90a3\u4e48\u53cb\u5584\uff0c\u7528\u9002\u5f53\u7684\u5de5\u5177\u5904\u7406\u5b83\u5c31\u975e\u5e38\u91cd\u8981\u4e86\u3002\u8bfe\u5802\u4e0a\u6211\u4eec\u5c55\u793a\u4e86\u7528\u547d\u4ee4\u884c\u5de5\u5177\u8fdb\u884c\u5904\u7406\u7684 \u201c\u4f20\u7edf\u65b9\u6cd5\u201d\uff1a</p> <pre><code>$ strace ls |&amp; grep -e read -e write\n</code></pre> <p>\u5bf9\u65b0\u624b\u6765\u8bf4\uff0c\u611f\u5230\u56f0\u60d1\u662f\u975e\u5e38\u6b63\u5e38\u7684\u2014\u2014\u4f46\u6211\u4eec\u603b\u662f\u53ef\u4ee5\u628a\u4e0d\u719f\u6089\u7684\u4e1c\u897f\u7528\u719f\u6089\u7684\u4e1c\u897f\u7c7b\u6bd4 (\u6b63\u662f AI \u64c5\u957f\u7684)\u3002\u4eca\u5929\u4f60\u53ea\u8981\u5b66\u4f1a\u63d0\u95ee\uff0c\u5c31\u51e0\u4e4e\u603b\u662f\u80fd\u5f97\u5230\u6ee1\u610f\u7684\u7b54\u6848\u3002</p> <p></p> <p><code>eg.</code></p> <ol> <li> <p>\u6240\u6709\u7684\u7a97\u53e3\u628a\u81ea\u5df1\u60f3\u8981\u753b\u4ec0\u4e48\uff08\u6570\u636e\uff09\uff0c\u53d1\u9001\u7ed9\u4e00\u4e2a\u7a97\u53e3\u7ba1\u7406\u5668\u7684\u8fdb\u7a0b\uff08NWM\uff09\u3002</p> </li> <li> <p>\u7a97\u53e3\u7ba1\u7406\u5668\u4f5c\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u76f4\u63a5\u7ba1\u7406\u5c4f\u5e55\u8bbe\u5907\u3002</p> <p>\u50cf PA \u4e2d\u7684 <code>fb_write</code> \u529f\u80fd\uff08<code>framebuffer</code>\uff09\u3002</p> <p>\u7136\u540e\u8fdb\u4e00\u6b65\u4f7f\u7528\u786c\u4ef6\u8d44\u6e90\uff08VGA\uff09\uff0c\u6700\u7ec8\u753b\u51fa\u56fe\u6848\uff0c\u8fd9\u5c31\u8ba9\u6211\u4eec\u4f53\u4f1a\u5230\u4e86\u8f6f\u4ef6\u548c\u786c\u4ef6\uff0c\u8fd8\u6709\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u662f\u600e\u4e48\u76f8\u4e92\u914d\u5408\u6765\u5b9e\u73b0\u60f3\u8981\u7684\u529f\u80fd\u3002</p> </li> </ol>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#c","title":"C \u8bed\u8a00\u4e0e\u6c47\u7f16","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#c_1","title":"C \u89e3\u91ca\u5668","text":"<p>C \u8bed\u8a00\u4e5f\u662f\u4e00\u4e2a\u72b6\u6001\u673a\u3002</p> <p>\u50cf GDB \u4e00\u6837\uff0c\u8c03\u6c47\u7f16\u4e00\u6837\u3002</p> <p>c source code ------&gt; C \u8bed\u8a00\u5355\u6b65\u89e3\u91ca</p> <p>\u7406\u89e3\u9ad8\u7ea7\u8bed\u8a00\u7a0b\u5e8f</p> <ul> <li>\u6210\u6bcf\u6761\u8bed\u53e5\u81f3\u591a\u4e00\u6b21\u8fd0\u7b97 (\u51fd\u6570\u8c03\u7528\u4e5f\u662f\u8fd0\u7b97)</li> <li>\u6761\u4ef6\u8bed\u53e5\u4e2d\u4e0d\u5305\u542b\u8fd0\u7b97<ul> <li>\u771f\u7684\u6709\u8fd9\u79cd\u5de5\u5177 (C Intermediate Language) \u548c\u89e3\u91ca\u5668</li> </ul> </li> <li>(\u6682\u65f6\u5047\u8bbe\u6ca1\u6709\u6307\u9488\u548c\u5185\u5b58\u5206\u914d)</li> </ul> <p>Simple C \u9879\u76ee\u786e\u5b9e\u53ef\u4ee5\u8bd5\u8bd5\u3002</p> <p></p> <p>\u8fd9\u91cc\uff0c\u6211\u901a\u8fc7\u6c47\u7f16\u7406\u89e3\u72b6\u6001\u673a\u3002\u5728\u6c47\u7f16\u5c42\u9762\uff0c\u72b6\u6001\u673a\u7684\u5f53\u524d\u72b6\u6001\u770b\u4f5c\u662f\u7a0b\u5e8f\u7684\u5f53\u524d\u72b6\u6001\u6216\u73af\u5883\uff0c\u72b6\u6001\u8fc1\u79fb\u5219\u5bf9\u5e94\u4e8e\u6267\u884c\u4e00\u6761\u6307\u4ee4\uff0c\u5bfc\u81f4\u72b6\u6001\uff08\u5373\u7a0b\u5e8f\u7684\u5f53\u524d\u72b6\u6001\uff1a\u5bc4\u5b58\u5668\u3001memory\uff09\u53d1\u751f\u53d8\u5316\u3002</p> <p>\u800c\u4e00\u6761\u6307\u4ee4\u57fa\u672c\u80fd\u505a\u5230\u7684\u529f\u80fd\uff08\u8fd9\u91cc\u6682\u65f6\u4e0d\u8ba8\u8bba\u66f4\u52a0\u590d\u6742\u7684\u90a3\u4e9batom\u3001SIMD\u7b49\u4e1c\u897f\uff09\uff1a</p> <ol> <li>\u6570\u636e\u4f20\u8f93\uff1a\u5728\u5bc4\u5b58\u5668\u4e4b\u95f4\u6216\u5bc4\u5b58\u5668\u548c\u5185\u5b58\u4e4b\u95f4\u79fb\u52a8\u6570\u636e\u3002</li> <li>\u7b97\u672f\u8fd0\u7b97\uff1a\u5bf9\u6570\u503c\u8fdb\u884c\u52a0\u3001\u51cf\u3001\u4e58\u3001\u9664\u7b49\u64cd\u4f5c\u3002</li> <li>\u903b\u8f91\u8fd0\u7b97\uff1a\u6267\u884c\u903b\u8f91AND\u3001OR\u3001NOT\u3001XOR\u7b49\u64cd\u4f5c\u3002</li> <li>\u6bd4\u8f83\uff1a\u6bd4\u8f83\u4e24\u4e2a\u503c\uff0c\u5e76\u6839\u636e\u6bd4\u8f83\u7ed3\u679c\u8bbe\u7f6e\u5904\u7406\u5668\u7684\u72b6\u6001\u6807\u5fd7\uff08\u5982\u96f6\u6807\u5fd7\u3001\u8fdb\u4f4d\u6807\u5fd7\u7b49\uff09\u3002</li> <li>\u8df3\u8f6c\uff1a\u6839\u636e\u6761\u4ef6\u8df3\u8f6c\u5230\u7a0b\u5e8f\u7684\u4e0d\u540c\u90e8\u5206\u6267\u884c\uff0c\u8fd9\u5728\u72b6\u6001\u673a\u4e2d\u76f8\u5f53\u4e8e\u6839\u636e\u4e8b\u4ef6\u5207\u6362\u5230\u4e0d\u540c\u7684\u72b6\u6001\u3002</li> <li>\u8c03\u7528\u548c\u8fd4\u56de\uff1a\u6267\u884c\u51fd\u6570\u8c03\u7528\u548c\u4ece\u51fd\u6570\u8fd4\u56de\uff0c\u8fd9\u5728\u72b6\u6001\u673a\u4e2d\u53ef\u4ee5\u770b\u4f5c\u662f\u8fdb\u5165\u4e00\u4e2a\u5b50\u72b6\u6001\u673a\u548c\u4ece\u5b50\u72b6\u6001\u673a\u8fd4\u56de\u3002</li> <li>\u8f93\u5165/\u8f93\u51fa\uff1a\u4e0e\u5916\u90e8\u8bbe\u5907\u8fdb\u884c\u4ea4\u4e92\u3002</li> </ol> <p>\u4f46\u662f\u6f0f\u4e86 PC \uff1f\uff01\u4ed6\u4e5f\u662f\u5bc4\u5b58\u5668\uff01\u8fd8\u662f\u6ca1\u7406\u89e3\u3002</p> <p></p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#hanoi","title":"\u9012\u5f52\u548c\u975e\u9012\u5f52(Hanoi)","text":"<p>\u4e0d\u77e5\u9053\u5565\u662f\u6c49\u8bfa\u5854\uff0cGPT\uff1a</p> <p>\u6c49\u8bfa\u5854\u95ee\u9898\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u9012\u5f52\u95ee\u9898\u3002\u95ee\u9898\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p>\u6709\u4e09\u6839\u67f1\u5b50\uff08\u901a\u5e38\u79f0\u4e3a\u201c\u8d77\u59cb\u67f1\u5b50\u201d\u3001\u201c\u76ee\u6807\u67f1\u5b50\u201d\u548c\u201c\u8f85\u52a9\u67f1\u5b50\u201d\uff09\u548c\u4e00\u7ec4\u4e0d\u540c\u5927\u5c0f\u7684\u76d8\u5b50\uff0c\u8fd9\u4e9b\u76d8\u5b50\u6700\u521d\u90fd\u53e0\u653e\u5728\u8d77\u59cb\u67f1\u5b50\u4e0a\uff0c\u5e76\u4e14\u76d8\u5b50\u662f\u6309\u7167\u5927\u5c0f\u987a\u5e8f\u53e0\u653e\u7684\uff0c\u5373\u6700\u5927\u7684\u76d8\u5b50\u5728\u6700\u4e0b\u9762\uff0c\u6700\u5c0f\u7684\u76d8\u5b50\u5728\u6700\u4e0a\u9762\u3002\u76ee\u6807\u662f\u5c06\u6240\u6709\u7684\u76d8\u5b50\u79fb\u52a8\u5230\u76ee\u6807\u67f1\u5b50\u4e0a\uff0c\u540c\u65f6\u5728\u79fb\u52a8\u8fc7\u7a0b\u4e2d\u9075\u5b88\u4ee5\u4e0b\u89c4\u5219\uff1a</p> <ol> <li>\u6bcf\u6b21\u53ea\u80fd\u79fb\u52a8\u4e00\u4e2a\u76d8\u5b50\u3002</li> <li>\u76d8\u5b50\u53ea\u80fd\u4ece\u9876\u90e8\u79fb\u52a8\u5230\u53e6\u4e00\u6839\u67f1\u5b50\u7684\u9876\u90e8\u3002</li> <li>\u5728\u4e09\u6839\u67f1\u5b50\u4e2d\u7684\u4efb\u610f\u65f6\u523b\uff0c\u4efb\u4f55\u76d8\u5b50\u4e0b\u9762\u90fd\u4e0d\u80fd\u6709\u6bd4\u5b83\u5c0f\u7684\u76d8\u5b50\u3002</li> </ol> <p>\u6c49\u8bfa\u5854\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u662f\u9012\u5f52\u7684\u3002\u9012\u5f52\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a</p> <ol> <li>\u5148\u89e3\u51b3\u8f83\u5c0f\u7684\u95ee\u9898\uff1a\u9996\u5148\uff0c\u5c06\u4e0a\u9762\u7684<code>n-1</code>\u4e2a\u76d8\u5b50\u4ece\u8d77\u59cb\u67f1\u5b50\u501f\u52a9\u76ee\u6807\u67f1\u5b50\u79fb\u52a8\u5230\u8f85\u52a9\u67f1\u5b50\u3002</li> <li>\u89e3\u51b3\u5f53\u524d\u95ee\u9898\uff1a\u7136\u540e\uff0c\u5c06\u6700\u5927\u7684\u76d8\u5b50\u76f4\u63a5\u4ece\u8d77\u59cb\u67f1\u5b50\u79fb\u52a8\u5230\u76ee\u6807\u67f1\u5b50\u3002</li> <li>\u6700\u540e\u518d\u89e3\u51b3\u5269\u4f59\u7684\u95ee\u9898\uff1a\u6700\u540e\uff0c\u5c06\u90a3<code>n-1</code>\u4e2a\u76d8\u5b50\u4ece\u8f85\u52a9\u67f1\u5b50\u501f\u52a9\u8d77\u59cb\u67f1\u5b50\u79fb\u52a8\u5230\u76ee\u6807\u67f1\u5b50\u3002</li> </ol> <p>DEMO</p> <p>\u6c49\u8bfa\u5854\uff1a\u6c49\u8bfa\u5854\u662f\u9012\u5f52\u548c\u5206\u6cbb\u7684\u7ecf\u5178\u95ee\u9898\uff0c\u800c\u540c\u5b66\u4eec\u4e5f\u66fe\u7ecf\u5728\u7406\u89e3\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u65f6\u5019\u9047\u5230\u56f0\u96be\u3002\u9047\u5230\u56f0\u96be\u662f\u6b63\u5e38\u7684\uff1aC/C++ \u4e2d\u7684 \u201c\u51fd\u6570\u201d \u548c\u6570\u5b66\u7684\u51fd\u6570\u5f88\u4e0d\u4e00\u6837\uff0c\u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u628a Fibonacci \u6570\u5217\u7684\u9012\u5f52\u5199\u6210\uff1a</p> <pre><code>// \u4e5f\u53ef\u4ee5 return f(n - 2) + f(n - 1);\nreturn f(n - 1) + f(n - 2);\n</code></pre> <p>\u6216\u662f\u4efb\u610f\u8c03\u6362\u51fd\u6570\u8c03\u7528\u7684\u6b21\u5e8f\uff0c\u4f46\u6c49\u8bfa\u5854\u4e0d\u884c\u3002</p> <p>\u4e0d\u884c\u7684\u6839\u672c\u539f\u56e0\u5728\u4e8e\u6c49\u8bfa\u5854\u4e2d\u7684 <code>printf</code> \u4f1a\u5e26\u6765\u5168\u5c40\u7684\u526f\u4f5c\u7528\u3002\u4f46 C/C++ \u9075\u5faa \u201c\u987a\u5e8f\u6267\u884c\u201d \u7684\u539f\u5219\uff0c\u51fd\u6570\u7684\u6267\u884c\u6709 \u201c\u5148\u540e\u201d (\u4e0d\u50cf\u6570\u5b66\u7684\u51fd\u6570\uff0c\u5148\u540e\u662f\u65e0\u5173\u7684)\uff0c\u6309\u7167\u4e0d\u540c\u987a\u5e8f\u8c03\u7528\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u8f93\u51fa\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u800c\u5728\u5177\u4f53\u5b9e\u73b0\u65f6\uff0c\u6bcf\u4e2a\u6808\u5e27\u4e2d\u5b58\u653e\u7684 \u201c\u5f53\u524d\u6267\u884c\u7684\u4f4d\u7f6e\u201d (PC) \u5b9e\u73b0\u4e86\u987a\u5e8f\u6267\u884c\u3002</p> <p>\u4e00\u4e9b\u601d\u8003\u7684\u95ee\u9898\uff1a\u51fd\u6570\u8c03\u7528\u4e3a\u4ec0\u4e48\u4f1a\u5bfc\u81f4\u6808\u6ea2\u51fa\uff1f\u4e3a\u4ec0\u4e48\u8981\u53eb\u8fd9\u4e2a\u540d\u5b57\uff1f</p> <p>\u6bcf\u6b21\u51fd\u6570\u8c03\u7528\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6808\u5e27\uff0c\u5e76\u4e14\u6bcf\u4e2a\u6808\u5e27\u90fd\u5360\u7528\u4e00\u5b9a\u7684\u6808\u7a7a\u95f4\u3002</p> <p>\u5982\u679c\u662f\u9012\u5f52\u8c03\u7528\uff0c\u5e76\u4e14\u9012\u5f52\u8c03\u7528\u7684\u6b21\u6570\u592a\u591a\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6808\u5e27\u4f1a\u7d2f\u79ef\u5728\u6808\u4e0a\uff0c\u6d88\u8017\u8d8a\u6765\u8d8a\u591a\u7684\u7a7a\u95f4\u3002</p> <p>\u5f53\u9012\u5f52\u8c03\u7528\u5c42\u6b21\u6df1\u5230\u8017\u5c3d\u4e86\u6240\u6709\u53ef\u7528\u7684\u6808\u7a7a\u95f4\u65f6\uff0c\u5982\u679c\u8fd8\u60f3\u8981\u7ee7\u7eed\u4f7f\u7528\u6808\u6765\u5b58\u50a8\u6570\u636e\u5c31\u4f1a\u9020\u6210\u6808\u6ea2\u51fa\u3002\u8fd9\u901a\u5e38\u53d1\u751f\u5728\u6ca1\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6765\u521b\u5efa\u65b0\u7684\u6808\u5e27\u65f6\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u9012\u5f52\u6307\u7684\u662f\u6574\u4e2a\u7cfb\u7edf\u5206\u914d\u7684\u6808\u7a7a\u95f4\u4e0d\u591f\u7528\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6808\u6862\u7684\u7a7a\u95f4\u4e0d\u591f\u7528\u4e86\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;assert.h&gt;\n\nint hanoi(int n, char from, char to, char via);\n\nint main() {\n    int n = 3;\n    char from = 'A';\n    char to = 'B';\n    char via = 'C';\n\n    int step_count = hanoi(n, from, to, via);\n    printf(\"\\nHanoi(%d, %c, %c, %c) = %d\\n\",\n        n, from, to, via, step_count);\n}\n#include &lt;stdio.h&gt;\n#include &lt;assert.h&gt;\n\nstruct Frame {\n    // Each frame has a program counter to keep track its next\n    // to-be-executed statement.\n    int pc;\n\n    // The internal state of the frame. This state includes\n    // both arguments and local variables (if any).\n    //\n    // Arguments:\n    int n;\n    char from, to, via;\n\n    // Local variables:\n    int c1, c2;\n};\n\ntypedef struct Frame Frame;\n\nint hanoi(int n, char from, char to, char via) {\n    Frame stk[64];\n\n    for (int i = 0; i &lt; 64; i++) {\n        printf(\"stk[%d] addr: %p\\n\", i, &amp;stk[i]);\n    }\n\n    Frame *top = stk - 1; // stk[-1]\n    printf(\"stk[-1]: %p\\n\", &amp;stk[-1]);\n    printf(\"top point addr: %p\\n\", top);\n\n    // Function call: push a new frame (PC=0) onto the stack\n    #define call(...) ({ *(++top) = (Frame){.pc = 0, __VA_ARGS__}; })\n\n    // Function return: pop the top-most frame\n    #define ret(val) ({ top--; retval = (val); })\n\n\n    // The last function-return's value. It is not obvious\n    // that we only need one retval.\n    int retval = 0;\n\n    // The initial call to the recursive function\n    call(n, from, to, via);\n\n    while (1) {\n        // Fetch the top-most frame.\n        Frame *f = top;\n        if (top &lt; stk) {\n            // No top-most frame any more; we're done.\n            break;\n        }\n\n        // Jumps may change this default next pc.\n        int next_pc = f-&gt;pc + 1;\n\n        // Single step execution.\n\n        // Extract the parameters from the current frame. (It's\n        // generally a bad idea to reuse variable names in\n        // practice; but we did it here for readability.)\n        int n = f-&gt;n, from = f-&gt;from, to = f-&gt;to, via = f-&gt;via;\n\n        printf(\"f-&gt;pc:%d  n:%d\\n\", f-&gt;pc, n);\n        switch (f-&gt;pc) {\n            case 0:\n                if (n == 1) {\n                    printf(\"%c -&gt; %c\\n\", from, to);\n                    ret(1);\n                }\n                break;\n            case 1: call(n - 1, from, via, to); break;\n            case 2: f-&gt;c1 = retval; break;\n            case 3: call(1, from, to, via); break;\n            case 4: call(n - 1, via, to, from); break;\n            case 5: f-&gt;c2 = retval; break;\n            case 6: ret(f-&gt;c1 + f-&gt;c2 + 1); break;\n            default: assert(0);\n        }\n\n        f-&gt;pc = next_pc;\n    }\n\n    return retval;\n}\n\n// after gcc -E:\nint hanoi(int n, char from, char to, char via) {\n    Frame stk[64];\n    Frame *top = stk - 1;\n# 35 \"hanoi-nr.c\"\n    int retval = 0;\n\n\n    ({ *(++top) = (Frame){.pc = 0, n, from, to, via}; });\n\n    while (1) {\n\n        Frame *f = top;\n        if (top &lt; stk) {\n\n            break;\n        }\n\n        int next_pc = f-&gt;pc + 1;\n\n        int n = f-&gt;n, from = f-&gt;from, to = f-&gt;to, via = f-&gt;via;\n\n        switch (f-&gt;pc) {\n            case 0:\n                if (n == 1) {\n                    printf(\"%c -&gt; %c\\n\", from, to);\n                    ({ top--; retval = (1); });\n                }\n                break;\n            case 1: ({ *(++top) = (Frame){.pc = 0, n - 1, from, via, to}; }); break;\n            case 2: f-&gt;c1 = retval; break;\n            case 3: ({ *(++top) = (Frame){.pc = 0, 1, from, to, via}; }); break;\n            case 4: ({ *(++top) = (Frame){.pc = 0, n - 1, via, to, from}; }); break;\n            case 5: f-&gt;c2 = retval; break;\n            case 6: ({ top--; retval = (f-&gt;c1 + f-&gt;c2 + 1); }); break;\n            default: \n# 71 \"hanoi-nr.c\" 3 4\n                    ((void) sizeof ((\n# 71 \"hanoi-nr.c\"\n                    0\n# 71 \"hanoi-nr.c\" 3 4\n                    ) ? 1 : 0), __extension__ ({ if (\n# 71 \"hanoi-nr.c\"\n                    0\n# 71 \"hanoi-nr.c\" 3 4\n                    ) ; else __assert_fail (\n# 71 \"hanoi-nr.c\"\n                    \"0\"\n# 71 \"hanoi-nr.c\" 3 4\n                    , \"hanoi-nr.c\", 71, __extension__ __PRETTY_FUNCTION__); }))\n# 71 \"hanoi-nr.c\"\n                             ;\n        }\n        f-&gt;pc = next_pc;\n    }\n    return retval;\n}\n</code></pre> <pre><code>//result:\nstk[0] addr: 0x7ffed250a720\nstk[1] addr: 0x7ffed250a734\n......\nstk[62] addr: 0x7ffed250abf8\nstk[63] addr: 0x7ffed250ac0c\nstk[-1]: 0x7ffed250a70c\ntop point addr: 0x7ffed250a70c\nf-&gt;pc:0  n:3\nf-&gt;pc:1  n:3\nf-&gt;pc:0  n:2\nf-&gt;pc:1  n:2\nf-&gt;pc:0  n:1\nA -&gt; B\nf-&gt;pc:2  n:2\nf-&gt;pc:3  n:2\nf-&gt;pc:0  n:1\nA -&gt; C\nf-&gt;pc:4  n:2\nf-&gt;pc:0  n:1\nB -&gt; C\nf-&gt;pc:5  n:2\nf-&gt;pc:6  n:2\nf-&gt;pc:2  n:3\nf-&gt;pc:3  n:3\nf-&gt;pc:0  n:1\nA -&gt; B\nf-&gt;pc:4  n:3\nf-&gt;pc:0  n:2\nf-&gt;pc:1  n:2\nf-&gt;pc:0  n:1\nC -&gt; A\nf-&gt;pc:2  n:2\nf-&gt;pc:3  n:2\nf-&gt;pc:0  n:1\nC -&gt; B\nf-&gt;pc:4  n:2\nf-&gt;pc:0  n:1\nA -&gt; B\nf-&gt;pc:5  n:2\nf-&gt;pc:6  n:2\nf-&gt;pc:5  n:3\nf-&gt;pc:6  n:3\n\nHanoi(3, A, B, C) = 7\n</code></pre> <p>\u4e0a\u8ff0\u901a\u8fc7\u6808\u5e27\u6a21\u62df\u7684\u51fd\u6570\u8c03\u7528\uff0c\u6bcf\u4e00\u6b21\u51fd\u6570\u8c03\u7528\u6a21\u62df\u4e3a\uff1a\u521b\u5efa\u65b0\u6808\u5e27\uff0cPC \u5237\u65b0\u4e3a 0\uff0c\u53bb\u5230\u8981\u6267\u884c\u4e0b\u4e00\u4e2a\u51fd\u6570\u7684\u5730\u65b9(\u6ce8\u610f\u6bcf\u6b21\u5faa\u73af\u90fd\u4f1a\u91cd\u65b0\u83b7\u53d6top\uff0c\u5373\u672c\u6b21\u6808\u5e27\uff0c\u7136\u540e\u83b7\u53d6\u6808\u5e27\u4e2d\u7684\u6570\u636e)\u3002</p> <p><code>call</code> \u548c <code>ret</code> \u8df3\u8f6c\u5230\u65b0\u6808\u5e27\u3001\u8fd4\u56de\u5230\u65e7\u6808\u5e27\u3002</p> <p>\u8fd9\u91cc\u901a\u8fc7\u4e00\u4e9b\u53d8\u91cf\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u521d\u6b65\u6784\u5efa\u51fa\u5b9a\u4e49\u7684 <code>Frame stk[64]</code>\u3001 <code>top</code> \u5728\u5b9e\u9645\u7684\u6808\u4e2d\u7684\u4f4d\u7f6e\u3002\u5982\u4e0b\u56fe\uff08\u501f\u52a9\u4e0a\u9762\u7684\u7ed3\u679c\uff09\uff1a</p> <pre><code>+----------------+ &lt;-- rbp  (high address)\n|     c1,c2      |\n| n from to via  | stk[63]\n|       pc       |\n+----------------+\n|     c1,c2      |\n| n from to via  | stk[62]\n|       pc       |\n+----------------+ &lt;-- fun1\u7684\u6808\u5e27\u8d77\u59cb\u5730\u5740\n|     c1,c2      |\n| n from to via  | stk[61]\n|       pc       |\n+----------------+\n        ...\n        ...        stk[..]\n        ...\n+----------------+ &lt;-- fun3\u7684\u6808\u5e27\u8d77\u59cb\u5730\u5740\n|     c1,c2      |\n| n from to via  | stk[1]\n|       pc       |\n+----------------+\n|     c1,c2      |\n| n from to via  | stk[0]\n|       pc       |\n+----------------+\n|     c1,c2      |\n| n from to via  | stk[-1] &lt;-- top pointed to this at the beginning\n|       pc       |\n+----------------+\n        ...\n        ...        other variables(next_pc, retval...)\n        ...\n+----------------+\n|                | top variable\n+----------------+ &lt;-- rsp  (low address)\n</code></pre>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_4","title":"\u7f16\u8bd1\u5668\u4e0e\u7f16\u8bd1\u4f18\u5316","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_5","title":"\u7f16\u8bd1\u5668","text":"<p>\u5c06\u4e00\u79cd\u72b6\u6001\u673a\uff08\u7531\u6808\u5e27\u7ec4\u6210\uff09\u53d8\u6210\u53e6\u4e00\u79cd\u72b6\u6001\u673a\uff08\u7531\u6307\u4ee4\u3001\u5bc4\u5b58\u5668\u3001\u5185\u5b58\uff08\u6808\u5e27\u4f9d\u65e7\u662f\u6709\u7684\uff0c\u5b58\u5728\u5185\u5b58\u4e0a\uff09\uff09\uff0c\u7f16\u8bd1\u5668\u7684\u5de5\u4f5c\u5c31\u662f\u505a\u8fd9\u4e2a\u5de5\u4f5c\u7684\u3002\uff08\u8fd9\u771f\u662f\u4e00\u4e2a\u5f88\u5947\u7279\u7684\u89c6\u89d2\uff01\uff01\uff09</p> <p></p> <p>\u4e5f\u5c31\u662f\u6211\u4e4b\u524d\u7684\u90a3\u79cd\u7406\u89e3\uff1a\u5c06C\u72b6\u6001\u673a\u548c\u6c47\u7f16\u72b6\u6001\u673a\u8fde\u63a5\u8d77\u6765\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u90a3\u5bf9\u4e8e Simple C \u600e\u4e48\u5b9e\u73b0\uff1a</p> <p></p> <ul> <li> <p>\u8fd0\u7b97</p> <pre><code>x = y + z; --&gt;\n\nrax = load(y)\nrbx = load(z)\nrax += rbx\nstore(x, rax)\n</code></pre> <p>\u5c06\u4e00\u6761\u9ad8\u7ea7\u8bed\u8a00\u7ffb\u8bd1\u6210\u6c47\u7f16\u6307\u4ee4</p> </li> <li> <p>\u5206\u652f/\u5faa\u73af</p> <p>\u8df3\u8f6c\u6307\u4ee4\uff0c\u5f88\u719f\u6089\u4e86\uff0c\u53ef\u4ee5\u518d\u770b PA4 \u90a3\u90e8\u5206\u5b9e\u73b0 <code>trap.S</code> \u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u8df3\u8f6c\u6307\u4ee4\u4e3a\u771f\uff0c\u8df3\u5230label \u90a3\u91cc\uff0c\u8fd8\u662f\u7ee7\u7eed\u6267\u884c\u63a5\u7740\u8df3\u8f6c\u6307\u4ee4\u540e\u9762\u7684\u7684\u90e8\u5206\u3002</p> </li> <li> <p>\u51fd\u6570\u8c03\u7528</p> <p>\u5173\u952e\u5728\u4e8e\u6808\u5e27\u7684\u5b9e\u73b0\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u5bc4\u5b58\u5668\u5b58\u653e\u5f53\u524d\u6808\u5e27\u7684\u4f4d\u7f6e\uff0c\u90a3\u5c31\u4e13\u95e8\u7559\u4e00\u4e2a\u5bc4\u5b58\u5668\uff08SP\uff09\u7ed9\u6808\u3002</p> </li> </ul> <p>\u8fd9\u91cc\u8001\u5e08\u7684\u63d0\u9192\u4e86\uff1aPA \u548c Simple C \u5206\u522b\u4ece\u4e24\u4e2a\u89c6\u89d2\u5b66\u4e60\u8ba1\u7b97\u673a\u3002</p> <p>PA\uff1a\u786c\u4ef6\u4e00\u6b65\u6b65\u5230\u4e0a\u5c42\u5e94\u7528\u3002\u5373\uff1a\u8ba1\u7b97\u673a\u7cfb\u7edf/\u786c\u4ef6</p> <p>Simple C \u7f16\u8bd1\u5668\uff1a (C -&gt; Simple C) -&gt; assembly\u3002\u5373\u8bed\u8a00\u5c42\u9762\uff1a\u9ad8\u7ea7\u8bed\u8a00\u5230\u6c47\u7f16\u8bed\u8a00\uff08\u53ef\u4ee5\u76f4\u63a5\u7406\u89e3\u4e3a\u673a\u5668\u80fd\u770b\u61c2\u7684\u8bed\u8a00\uff09</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_6","title":"\u7f16\u8bd1\u4f18\u5316","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_7","title":"\u786c\u4ef6\u89c6\u89d2\u7684\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_8","title":"\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u72b6\u6001\u673a\u6a21\u578b","text":"<p>\u8fd9\u91cc\u8fd8\u53ef\u4ee5\u770b\u770b \u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u72b6\u6001\u673a\u6a21\u578b - \u7b2c\u516d\u671f\u201c\u4e00\u751f\u4e00\u82af\u201d\u8ba1\u5212</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_9","title":"\u56fa\u4ef6\uff1a\u63a5\u7ba1\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u7b2c\u4e00\u4e2a\u7a0b\u5e8f","text":"<ul> <li> <p>\u7a0b\u5e8f\u5458\u5982\u4f55\u63a7\u5236\u8ba1\u7b97\u673a\u7cfb\u7edf\uff1f</p> <ul> <li>\u4ec5\u6709 RESET \u72b6\u6001\u662f\u4e0d\u591f\u7684</li> <li>\u7b54\u6848\uff1a\u8ba1\u7b97\u673a\u7cfb\u7edf\u4f1a\u548c System Programmers \u8fbe\u6210\u7ea6\u5b9a</li> </ul> </li> <li> <p>\u8fd8\u662f\u90a3\u4e2a\u601d\u60f3\uff1a\u628a\u7a0b\u5e8f\u653e\u5728memory\u7684\u5408\u9002\u7684\u4f4d\u7f6e\uff0cCPU \u5c31\u4f1a\u6267\u884c\u5b83</p> <p>\u4eba\u4e0e\u8ba1\u7b97\u673a\u7684\u7b2c\u4e00\u4e2a\u7ea6\u5b9a\uff1a\u56fa\u5b9a\u597d reset \u540e PC \u6307\u5411\u7684\u5730\u5740\u3002</p> <p>reset \u540e\u4e00\u5c0f\u6bb5\u8fd0\u884c\u7684\u7a0b\u5e8f\u4ee3\u7801\uff0c\u56fa\u4ef6\u3002</p> </li> </ul> <p></p> <ul> <li> <p>\u7a76\u7adf\u662f\u8c01\u5c06\u786c\u76d8\u4e0a\u7684\u4ee3\u7801\u642c\u5230\u5185\u5b58\u4e0a\u7684\uff1f\u53c8\u662f\u901a\u8fc7\u4ec0\u4e48\u6307\u4ee4\u505a\u5230\u7684\uff1f</p> <p>firmware\uff08\u770b\u770b CBIOS\u7684\u6e90\u7801\uff0c\u600e\u4e48\u642c\uff1f\uff09</p> <p><code>rep insl (%dx)</code></p> <p>repeat insl/outl\uff0c\u81ea\u5faa\u73af\uff0c\u6bcf\u6b21\u642c\u4e24\u4e2abyte\u3002</p> <p>PA \u4e2d\u5e94\u8be5\u5f88\u719f\u6089\u4e86\uff0cport io\uff0c\u901a\u8fc7in/out\u4e0e\u5916\u754c\u8bbe\u5907\u8fdb\u884cIO\u53e3\u901a\u4fe1\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u786c\u76d8\u4f1a\u6709\u5206\u533a\u8fd9\u4e2a\u4e1c\u897f\uff1f</p> <p>Disk partitioning - Wikipedia</p> <p>\u4e00\u79cd\u6280\u672f\uff0c\u7c7b\u4f3c\u5206\u6bb5\u3001\u5206\u9875\u3002</p> <p>Partitioning allows the use of different filesystems to be installed for different kinds of files. Separating user data from system data can prevent the system partition from becoming full and rendering the system unusable. Partitioning can also make backing up easier. A disadvantage is that it can be difficult to properly size partitions, resulting in having one partition with too much free space and another nearly totally allocated.</p> <p>\u66f4\u591a\u63a2\u7d22\uff1a</p> <p>\u6302\u8f7d\uff08mount\uff09\u6df1\u5165\u7406\u89e3 - \u6c5f\u53ec\u4f1f - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>Linux\u78c1\u76d8\u7ba1\u7406\u8be6\u89e3-mount\u6302\u8f7d - \u201c\u4eba\u751f\u82e6\u77ed\u201d - \u535a\u5ba2\u56ed (cnblogs.com)</p> </li> </ul> <p>\u65e9\u671f\u56fa\u4ef6\u8fd8\u6709\u4e2a\u540d\u5b57\u53eb BIOS\uff08legacy BIOS\uff09\uff1f</p> <p>BIOS \u751a\u81f3\u4e8e\u8fd0\u884c\u4e4b\u540e\u8fd8\u80fd\u518d\u88ab\u8c03\u7528\uff1f\uff08\u50cf\u7cfb\u7edf\u8c03\u7528\uff1f\uff09</p> <p>\u5982\u679c\u80fd\u7528\u6c47\u7f16\u91cd\u5199BIOS\u7684\u884c\u4e3a\uff0c\u90a3\u5c31\u80fd\u9020\u81ea\u5df1\u7684\u8ba1\u7b97\u673a\uff1f\u867d\u7136\u9a71\u52a8\u5f97\u81ea\u5df1\u5199\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u73b0\u5728\u8fdb\u5316\u6210 UEFI (Unified Extensible Firmware Interface)</p> <ul> <li> <p>\u5c31\u662f\u786c\u4ef6\u53d8\u591a\u4e86</p> <p>\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u652f\u6301 (\u4f8b\u5982\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f)\uff1a\u6307\u7eb9\u9501\u3001\u5c71\u5be8\u7f51\u5361\u4e0a\u7684 PXE \u7f51\u7edc\u542f\u52a8\u3001USB \u84dd\u7259\u8f6c\u63a5\u5668\u8fde\u63a5\u7684\u84dd\u7259\u952e\u76d8\u2026\u2026</p> </li> </ul>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#legacy-bios","title":"\u89c2\u5bdf\u548c\u8c03\u8bd5 legacy BIOS","text":"<p>\u81ea\u5df1\u6784\u5efa\u4e00\u4e2a\u542f\u52a8\u533a\uff08\u786c\u76d8\u4e2d\u76840\u76d80\u90531\u6247\u533a\uff0c\u7b2c\u4e00\u4e2a\u6247\u533a\u7684 512 \u5b57\u8282\u7684\u672b\u5c3e\u4e24\u4e2a\u5b57\u8282\u4e3a 0x55AA\uff0cBIOS \u5373\u8ba4\u4e3a\u5176\u5c31\u662f\u4e00\u4e2a\u542f\u52a8\u533a\uff09</p> <pre><code>minimal.img: Makefile\n    ( echo \"eb fe 11 22 33 44\" | xxd -r -p; \\\n      cat /dev/zero | head -c 504; \\\n      echo \"55 aa\" | xxd -r -p \\\n    ) &gt; minimal.img\n</code></pre> <p><code>eb fe: jmp</code></p> <pre><code>(qemu) x $eip\n0000000000007c00: 0x2211feeb\n(qemu) x/i $eip\n0x0000000000007c00:  jmp    0x7c00\n</code></pre> <p>\u5f53\u6211\u4eec\u6309\u4e0b\u5f00\u673a\u952e\u7684\u65f6\u5019\uff0c\u5728\u4e3b\u677f\u4e0a\u63d0\u524d\u5199\u6b7b\u7684\u56fa\u4ef6\u7a0b\u5e8f BIOS \u4f1a\u5c06\u786c\u4ef6\u542f\u52a8\u533a\u4e2d\u7684 512 byte \u7684\u6570\u636e\uff0c\u590d\u5236\u5230\u5185\u5b58\u4e2d 0x7c00 \u7684\u4f4d\u7f6e\u4e0a\uff0c\u5e76\u8df3\u5230\u90a3\u4e2a\u4f4d\u7f6e\u4e0a\u3002</p> <p>\u53e6\u5916\uff0c\u4f5c\u4e3a\u4e00\u4efd\u7a0b\u5e8f\uff0c\u6211\u4eec\u8fd8\u662f\u80fd\u8c03\u8bd5\u7684\uff1a</p> <p></p> <p>DEMO</p> <p>\u8c03\u8bd5\u56fa\u4ef6\uff1a\u8bfe\u7a0b\u548c\u4e92\u8054\u7f51\u4e0a\u7684\u6587\u6863\u90fd\u58f0\u79f0\u662f Firmware \u4ee3\u7801\u5c06\u5177\u6709 55 aa Magic Number \u78c1\u76d8\u7684\u524d 512 \u5b57\u8282\u8f7d\u5165\u5185\u5b58\u3002\u7ecf\u8fc7\u4e00\u4e9b\u5c1d\u8bd5 (\u4f8b\u5982\u4fee\u6539 Magic Number)\uff0c\u6211\u4eec\u786e\u8ba4\u4e86\u8fd9\u4e00\u884c\u4e3a\uff1b\u66f4\u8fdb\u4e00\u6b65\u5730\uff0c\u6211\u4eec\u80fd\u5426\u8c03\u8bd5\u56fa\u4ef6\u7684\u4ee3\u7801\uff0c\u770b\u770b\u5230\u5e95\u662f\u4ec0\u4e48\u6307\u4ee4\u5b9e\u73b0\u4e86\u78c1\u76d8\u5230\u5185\u5b58\u7684\u642c\u8fd0\uff1f\u8fd9\u5c31\u7528\u5230\u4e86\u300a\u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840\u300b\u5b9e\u9a8c\u4e2d\u7684 Watch Point\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u8fd8\u7528\u5230\u4e86 init.gdb\uff0c\u5b83\u53ef\u4ee5\u5e2e\u6211\u4eec\u7701\u53bb\u6bcf\u6b21\u8fd0\u884c\u65f6\u7684\u91cd\u590d\u8f93\u5165\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u8bbe\u7f6e hook (\u94a9\u5b50)\uff0c\u6bcf\u5f53\u7a0b\u5e8f\u6682\u505c\u65f6\u663e\u793a\u4e00\u4e9b\u6211\u4eec\u5173\u5fc3\u7684\u4fe1\u606f\u2014\u2014\u6211\u4eec\u5b9a\u5236\u548c\u6269\u5c55\u4e86 gdb\uff0c\u4f7f\u5b83\u5728\u8c03\u8bd5\u4e13\u5c5e\u4e8e\u6211\u4eec\u7684\u4efb\u52a1\u65f6\u66f4\u52a0\u5f3a\u5927\u3002</p> <p>\u8c03\u8bd5\u6280\u5de7</p> <p>\u56de\u8fc7\u5934\u6765\uff0c\u8ba4\u8bc6\u5b8c\u542f\u52a8\u76d8\u540e\uff0c\u90a3\u8fd9\u6837\u5c31 CPU \u5c31\u8981\u5b9e\u9645\u6267\u884c\u56fa\u4ef6\u7684\u4ee3\u7801\u4e86\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u53ef\u4ee5\u638c\u63a7\u7684\u90a3 446 byte \uff1a\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u5199\u4e00\u4e2a\u5c0f\u7684 C \u7a0b\u5e8f\uff0c\u6765\u4f5c\u4e3aboot/loader</p> <p></p> <p>\u4e4b\u524d\u5b66\u4e60\u7684 NEMU RISC-V \u542f\u52a8 Linux \u7684\u5185\u5bb9\uff0c\u518d\u56de\u53bb\u770b\u770b\u5c31\u5e94\u8be5\u6709\u4e0d\u4e00\u6837\u7684\u7406\u89e3</p> <p>\u770b\u770b\u5b9e\u9a8c\u6846\u67b6\u7684\u542f\u52a8\u52a0\u8f7d\u5668\uff1a</p> <p></p> <p>DEMO</p> <p>\u8c03\u8bd5 MBR \u4e2d\u7684\u52a0\u8f7d\u5668\uff1a\u6211\u4eec\u4f7f\u7528\u5b9e\u9a8c\u6846\u67b6\u5728 bare-metal \u4e0a\u8fd0\u884c\u4e86 Hello World\uff0c\u8fd9\u4e5f\u662f \u201c\u6700\u5c0f\u201d \u64cd\u4f5c\u7cfb\u7edf\u7684\u96cf\u5f62\u2014\u2014\u4f60\u53ef\u4ee5\u5728\u6b64\u57fa\u7840\u4e0a\u5b9e\u73b0\u4efb\u4f55\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u3002\u901a\u8fc7\u9002\u5f53\u7684 gdb \u6307\u4ee4 (\u8fd9\u6b21\u662f\u66f4\u597d\u7528\u7684 Python\uff0c\u53d6\u4ee3\u4e86\u5386\u53f2\u9057\u7559\u7684 gdb scripts)\uff0c\u6211\u4eec\u5b8c\u6210\u914d\u7f6e\u7684\u540c\u65f6\u6307\u5b9a\u6b63\u786e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u8c03\u8bd5\u786c\u4ef6\u4e0a\u7684\u4ee3\u7801\uff0c\u4e0e\u8c03\u8bd5\u666e\u901a\u7684\u7a0b\u5e8f\u5b8c\u5168\u6ca1\u6709\u533a\u522b\u3002</p> <p>\u5982\u679c\u5e0c\u671b\u6df1\u5165\u4e86\u89e3\u7f16\u8bd1\u7684\u5168\u8fc7\u7a0b\uff0c\u9075\u5faa \u201c\u4e00\u5207\u90fd\u662f\u72b6\u6001\u673a\u201d \u7684\u539f\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u89c2\u5bdf Makefile (\u7a0b\u5e8f)\uff0c\u4e5f\u53ef\u4ee5\u89c2\u5bdf\u5b83\u7684\u6267\u884c\uff0c\u800c\u5b83\u7684\u6267\u884c\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u547d\u4ee4\u3002<code>make log</code> \u5bf9\u8f93\u51fa\u7684\u65e5\u5fd7\u505a\u4e86\u4e00\u4e9b\u7b80\u5316\u5904\u7406\uff0c\u5df2\u7ecf\u8db3\u591f\u4eba\u7c7b\u53ef\u8bfb\uff0c\u7a0d\u52a0\u6574\u7406\u5c31\u80fd\u770b\u5230\u78c1\u76d8\u955c\u50cf\u7684\u7f16\u8bd1\u8fc7\u7a0b\u3002\u4f60\u4e5f\u8bb8\u4f1a\u611f\u5230\u6709\u4e9b\u5403\u60ca\uff1a\u4e16\u754c\u4e0a\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u6784\u5efa\u8fc7\u7a0b (\u4f8b\u5982 Linux)\uff0c\u90fd\u548c\u8fd9\u4e2a\u7b80\u5316\u7248\u7c7b\u4f3c\uff0c\u53ea\u662f\u591a\u4e86\u66f4\u591a\u5b9e\u7528\u7684\u7279\u6027\uff1a\u652f\u6301\u5206\u533a\u8868\u3001\u652f\u6301\u538b\u7f29/\u89e3\u538b\u7f29\u7b49\u3002</p> <p>RTFSC <code>abstract-machine/am/src/x86/qemu/boot/main.c</code></p> <pre><code>include $(AM_HOME)/Makefile\n\ndebug:\n    qemu-system-i386 -s -S -machine accel=tcg -smp \"1,sockets=1\" \\\n        -drive format=raw,file=build/hello-x86-qemu &amp;\n    gdb -x debug.py\n\nlog:\n    make -nB \\\n         | grep -ve '^\\(\\#\\|echo\\|mkdir\\|make\\)' \\\n         | sed \"s#$(AM_HOME)#\\AM#g\" \\\n         | sed \"s#$(PWD)#.#g\" \\\n         &gt; compile.log\n</code></pre> <p>\u5b66\u4e60 Python \u7684 import gdb\uff0c\u5c31\u4e0d\u7528\u90a3\u4e2agdb script\u811a\u672c\u4e86\u3002</p> <pre><code>import gdb\nimport os\n\n# Register the quit hook\ndef on_quit():\n    gdb.execute('kill')\n\ngdb.events.exited.connect(on_quit)\n\n# Connect to the remote target\ngdb.execute('target remote localhost:1234')\n\n# Load the debug symbols\nam_home = os.environ['AM_HOME']\npath = f'{am_home}/am/src/x86/qemu/boot/boot.o'\ngdb.execute(f'file {path}')\n\n# This is the 0x7c00\ngdb.Breakpoint('_start')\n\n# This is where 32-bit code starts\ngdb.Breakpoint('start32')\n\n# Continue execution\ngdb.execute('continue')\n</code></pre> <p>\u76f4\u63a5\u83b7\u53d6\u73af\u5883\u53d8\u91cf $(AM_HOME) \u7684\u5185\u5bb9\uff0cgdb\u76f4\u63a5\u5728\u8fd9\u91cc\u88c5\u8f7d\u8981\u8c03\u8bd5\u7684\u6587\u4ef6\uff0c\u8fd9\u64cd\u4f5c\u786e\u5b9e\u4ec0\u4e48nb\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#makefile","title":"Makefile \u65b9\u6cd5","text":"<p>Makefile \u770b\u8d77\u6765\u786e\u5b9e\u662f\u5f88\u590d\u6742\uff0c\u4f46\u662f\u5f53\u5b83\u672c\u8d28\u4e0a\u5728\u4e00\u884c\u884c\u5730\u6267\u884c\u547d\u4ee4\uff0c\u8fdb\u4e00\u6b65\u4e5f\u5c31\u662f\u7a0b\u5e8f\uff0c\u7a0b\u5e8f\u6267\u884c\u8d77\u6765\uff0c\u5b83\u5c31\u53d8\u6210\u4e86 trace\u3002\u600e\u4e48\u5904\u7406trace ?</p> <p>\u60f3\u60f3\u81ea\u5df1\u5728 <code>The Missing Semester of Your CS Education</code> \u5b66\u4f1a\u7684\u6570\u636e\u5904\u7406\u3002</p> <pre><code>log:\n    make -nB \\\n         | grep -ve '^\\(\\#\\|echo\\|mkdir\\|make\\)' \\\n         | sed \"s#$(AM_HOME)#\\AM#g\" \\\n         | sed \"s#$(PWD)#.#g\" \\\n         &gt; compile.log\n</code></pre> <p>\"\u5728\u4f60\u611f\u5230\u529d\u9000\uff0c\u60f3\u8981\u653e\u5f03\u7684\u90a3\u4e00\u523b\uff0c\u5148\u4e0d\u8981\u7740\u6025\u3002\u4efb\u4f55\u65f6\u5019\u4f60\u611f\u5230\u529d\u9000\u7684\u65f6\u5019\uff0c\u8fd9\u662f\u4e00\u4e2a\u7edd\u4f73\u7684\u673a\u4f1a\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u597d\u7684\u5de5\u5177\u89e3\u51b3\u95ee\u9898\u4e86\uff0c\u90a3\u4f60\u5c31\u89e3\u51b3\u95ee\u9898\u4e86\uff1b\u5982\u679c\u4e16\u754c\u4e0a\u6ca1\u6709\u4e00\u4e2a\u597d\u7684\u5de5\u5177\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u90a3\u4f60\u5c31\u80fd\u521b\u9020\u4e00\u4e2a\u597d\u7684\u5de5\u5177\"</p> <p>\u201c\u611f\u5230\u56f0\u96be\u7684\u65f6\u5019\uff0c\u505a\u51cf\u6cd5\uff0csimplify\u201d</p> <p>\u5148\u5206\u89e3\u51fa\u4e00\u4e2a\u4e2a\u5c0f\u7684\u7b80\u5355\u7684\u95ee\u9898\uff0c\u6162\u6162\u7ec4\u5408\u8d77\u6765\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#example","title":"Example","text":"<p>\u600e\u4e48\u521b\u5efa\u4e00\u4e2a\u53ef\u542f\u52a8\u7684x86\u7cfb\u7edf\u955c\u50cf\u6587\u4ef6\uff1f\u8bd5\u8bd5\uff1f</p> <p></p> <p>\u5570\u55e6\u7684\u89e3\u91ca...</p> <pre><code>.PHONY: build-arg\n\nLDFLAGS    += -N -Ttext-segment=0x00100000\nQEMU_FLAGS += -serial mon:stdio \\\n              -machine accel=tcg \\\n              -smp \"$(smp)\" \\\n              -drive format=raw,file=$(IMAGE)\n\nbuild-arg: image\n    @( echo -n $(mainargs); ) | dd if=/dev/stdin of=$(IMAGE) \\\n    bs=512 count=2 seek=1 conv=notrunc status=none\n\nBOOT_HOME := $(AM_HOME)/am/src/x86/qemu/boot\n\nimage: $(IMAGE).elf\n    @$(MAKE) -s -C $(BOOT_HOME)\n    @echo + CREATE \"-&gt;\" $(IMAGE_REL)\n    @( cat $(BOOT_HOME)/bootblock.o; \\\n        head -c 1024 /dev/zero; \\\n        cat $(IMAGE).elf \\\n    ) &gt; $(IMAGE)\n\n// abstract-machine/scripts/platform/qemu.mk\n</code></pre> <pre><code>### Compilation targets (a binary image or archive)\nIMAGE_REL = build/$(NAME)-$(ARCH)\nIMAGE     = $(abspath $(IMAGE_REL))\n</code></pre> <p>qemu \u76f8\u5173\u914d\u7f6e</p> <p>\u8fd9\u6bb5Makefile\u4ee3\u7801\u662f\u7528\u4e8e\u6784\u5efa\u548c\u8fd0\u884cQEMU\u865a\u62df\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\u3002\u5b83\u5b9a\u4e49\u4e86\u7f16\u8bd1\u53c2\u6570\u3001QEMU\u8fd0\u884c\u53c2\u6570\u4ee5\u53ca\u6784\u5efa\u955c\u50cf\u7684\u6b65\u9aa4\u3002\u4e0b\u9762\u662f\u5bf9\u8fd9\u4e9b\u90e8\u5206\u7684\u8be6\u7ec6\u89e3\u91ca\uff1a</p> <ul> <li> <p>\u53d8\u91cf\u5b9a\u4e49</p> <ol> <li> <p><code>LDFLAGS</code>\uff1a\u94fe\u63a5\u5668\u6807\u5fd7\uff0c\u7528\u4e8e\u6307\u5b9a\u94fe\u63a5\u65f6\u7684\u9009\u9879\u3002</p> <ul> <li><code>-N</code>\uff1a\u544a\u8bc9\u94fe\u63a5\u5668\u4e0d\u8981\u81ea\u52a8\u751f\u6210\u7b26\u53f7\u8868\u3002</li> <li><code>-Ttext-segment=0x00100000</code>\uff1a\u8bbe\u7f6e\u6587\u672c\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u4e3a0x00100000\u3002\u8fd9\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u52a0\u8f7d\u7684\u5730\u5740\u3002</li> </ul> </li> <li> <p><code>QEMU_FLAGS</code>\uff1aQEMU\u6a21\u62df\u5668\u8fd0\u884c\u65f6\u7684\u53c2\u6570\u3002</p> <ul> <li> <p><code>_serial mon:stdio</code>\uff1a</p> <p>\u5c06QEMU\u7684\u4e32\u884c\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u5165\u8f93\u51fa\uff0c\u65b9\u4fbf\u5728\u63a7\u5236\u53f0\u67e5\u770b\u3002</p> </li> <li> <p><code>-machine accel=tcg</code>\uff1a</p> <p>\u4f7f\u7528TCG\uff08Tiny Code Generator\uff09\u4f5c\u4e3aQEMU\u7684\u52a0\u901f\u5668\uff0c\u63d0\u9ad8\u6a21\u62df\u901f\u5ea6\u3002</p> </li> <li> <p><code>-smp \"$(smp)\"</code>\uff1a</p> <p>\u8bbe\u7f6e\u865a\u62dfCPU\u7684\u6838\u5fc3\u6570\uff0c<code>$(smp)</code>\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u8868\u793a\u8981\u6a21\u62df\u7684CPU\u6838\u5fc3\u6570\u3002</p> </li> <li> <p><code>-drive format=raw,file=$(IMAGE)</code>\uff1a</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u865a\u62df\u786c\u76d8\u9a71\u52a8\u5668\uff0c\u4f7f\u7528\u539f\u59cb\u683c\u5f0f\uff0c\u6587\u4ef6\u540d\u4e3a<code>$(IMAGE)</code>\u3002</p> </li> </ul> </li> </ol> </li> <li> <p>\u6784\u5efa\u76ee\u6807</p> <ol> <li> <p><code>build-arg</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u4f2a\u76ee\u6807\uff0c\u7528\u4e8e\u5c06\u542f\u52a8\u53c2\u6570\u5199\u5165\u955c\u50cf\u6587\u4ef6\u3002</p> <ul> <li> <p><code>@( echo -n $(mainargs); ) | dd if=/dev/stdin of=$(IMAGE) bs=512 count=2 seek=1 conv=notrunc status=none</code>\uff1a</p> <p>\u8fd9\u6761\u547d\u4ee4\u4f7f\u7528<code>dd</code>\u5de5\u5177\u5c06\u542f\u52a8\u53c2\u6570<code>$(mainargs)</code>\u5199\u5165\u5230<code>$(IMAGE)</code>\u6587\u4ef6\u7684\u7b2c\u4e8c\u4e2a\u6247\u533a\uff08\u56e0\u4e3a<code>seek=1</code>\uff0c\u6240\u4ee5\u4ece\u7b2c\u4e8c\u4e2a\u6247\u533a\u5f00\u59cb\u5199\u5165\uff09\u3002<code>bs=512</code>\u6307\u5b9a\u5757\u5927\u5c0f\u4e3a512\u5b57\u8282\uff0c<code>count=2</code>\u8868\u793a\u5199\u51652\u4e2a\u5757\u3002</p> </li> </ul> </li> <li> <p><code>image</code>\uff1a\u8fd9\u662f\u53e6\u4e00\u4e2a\u4f2a\u76ee\u6807\uff0c\u7528\u4e8e\u521b\u5efa\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\u3002</p> <ul> <li> <p><code>@$(MAKE) -s -C $(BOOT_HOME)</code>\uff1a</p> <p>\u5728<code>$(BOOT_HOME)</code>\u76ee\u5f55\u4e0b\u6267\u884c<code>make</code>\u547d\u4ee4\uff0c\u7f16\u8bd1\u542f\u52a8\u4ee3\u7801\u3002<code>-s</code>\u8868\u793a\u9759\u9ed8\u6a21\u5f0f\uff0c\u4e0d\u663e\u793a\u547d\u4ee4\u672c\u8eab\uff0c<code>-C</code>\u6307\u5b9a\u76ee\u5f55\u3002</p> </li> <li> <p><code>@echo + CREATE \"-&gt;\" $(IMAGE_REL)</code>\uff1a\u6253\u5370\u521b\u5efa\u955c\u50cf\u7684\u4fe1\u606f\u3002</p> </li> <li> <p><code>@( cat $(BOOT_HOME)/bootblock.o; \\ head -c 1024 /dev/zero; \\ cat $(IMAGE).elf ) &gt; $(IMAGE)</code>\uff1a</p> <p>\u8fd9\u6761\u547d\u4ee4\u5c06\u542f\u52a8\u5757\u5bf9\u8c61\u6587\u4ef6 <code>bootblock.o</code>\u30011024\u5b57\u8282\u7684\u96f6\u586b\u5145 \u548c ELF\u683c\u5f0f\u7684\u5185\u6838\u6587\u4ef6<code>$(IMAGE).elf</code>\u5408\u5e76\u6210\u4e00\u4e2a\u5355\u4e00\u7684\u955c\u50cf\u6587\u4ef6<code>$(IMAGE)</code>\u3002</p> </li> </ul> </li> </ol> </li> </ul> <p>\u8fd9\u6bb5Makefile\u4ee3\u7801\u5b9a\u4e49\u4e86\u5982\u4f55\u6784\u5efa\u4e00\u4e2aQEMU\u865a\u62df\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\uff0c\u5305\u62ec\u8bbe\u7f6e\u94fe\u63a5\u5668\u53c2\u6570\u3001QEMU\u8fd0\u884c\u53c2\u6570\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u542f\u52a8\u4ee3\u7801\u3001\u5185\u6838\u4ee3\u7801\u548c\u542f\u52a8\u53c2\u6570\u5408\u5e76\u6210\u4e00\u4e2a\u53ef\u542f\u52a8\u7684\u955c\u50cf\u6587\u4ef6\u3002\u8fd9\u4e9b\u6b65\u9aa4\u5bf9\u4e8e\u5728QEMU\u4e0a\u6a21\u62df\u8fd0\u884c\u64cd\u4f5c\u7cfb\u7edf\u81f3\u5173\u91cd\u8981\u3002</p> <pre><code>SRCS := start.S main.c\nbootblock.o: $(SRCS) Makefile\n    @echo + CC $(SRCS)\n    @$(CROSS_COMPILE)gcc -static -m32 -fno-pic \\\n    -Os -nostdlib -Ttext 0x7c00 \\\n    -I$(AM_HOME)/am/src -o bootblock.o $(SRCS)\n    @python3 genboot.py bootblock.o\n\nclean:\n    rm -rf *.o\n\n// abstract-machine/am/src/x86/qemu/boot/Makefile\n</code></pre> <ul> <li><code>-static</code>\uff1a\u751f\u6210\u4e00\u4e2a\u9759\u6001\u94fe\u63a5\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e0d\u4f9d\u8d56\u5171\u4eab\u5e93\u3002</li> <li><code>-m32</code>\uff1a\u751f\u621032\u4f4d\u4ee3\u7801\uff0c\u5373\u4f7f\u572864\u4f4d\u7cfb\u7edf\u4e0a\u7f16\u8bd1\u3002</li> <li><code>-fno-pic</code>\uff1a\u7981\u6b62\u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08Position Independent Code\uff09\uff0c\u8fd9\u5bf9\u4e8e\u67d0\u4e9b\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6216\u7279\u5b9a\u542f\u52a8\u4ee3\u7801\u662f\u5fc5\u8981\u7684\u3002</li> <li><code>-Os</code>\uff1a\u4f18\u5316\u5927\u5c0f\uff0c\u5c1d\u8bd5\u51cf\u5c0f\u751f\u6210\u7684\u4ee3\u7801\u5927\u5c0f\u3002</li> <li><code>-nostdlib</code>\uff1a\u4e0d\u4f7f\u7528\u6807\u51c6\u5e93\uff0c\u8fd9\u5bf9\u4e8e\u542f\u52a8\u4ee3\u7801\u901a\u5e38\u662f\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u6807\u51c6\u5e93\u4e4b\u524d\u8fd0\u884c\u3002</li> <li><code>-Ttext 0x7c00</code>\uff1a\u8bbe\u7f6e\u4ee3\u7801\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u4e3a0x7c00\uff0c\u8fd9\u662fBIOS\u542f\u52a8\u6247\u533a\u7684\u6807\u51c6\u4f4d\u7f6e\u3002</li> <li><code>-I$(AM_HOME)/am/src</code>\uff1a\u6dfb\u52a0\u4e00\u4e2a\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\uff0c<code>$(AM_HOME)</code>\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u6307\u5411\u5b58\u653e\u6e90\u4ee3\u7801\u7684\u76ee\u5f55\u3002</li> <li><code>-o bootblock.o</code>\uff1a\u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u540d\u4e3a<code>bootblock.o</code>\u3002</li> <li><code>$(SRCS)</code>\uff1a\u6e90\u6587\u4ef6\u5217\u8868\uff0c\u7528\u4e8e\u7f16\u8bd1\u3002</li> </ul> <pre><code>export CROSS_COMPILE := x86_64-linux-gnu-\nCFLAGS  += -m32 -fno-pic -fno-omit-frame-pointer -march=i386\nCFLAGS  += -fcf-protection=none # remove endbr32 in Ubuntu 20.04 with a CPU newer than Comet Lake\nASFLAGS += -m32 -fno-pic\nLDFLAGS += -melf_i386\n\n// abstract-machine/scripts/isa/x86.mk\n</code></pre> <ol> <li><code>CFLAGS</code>\uff1a\u8fd9\u662f\u7f16\u8bd1\u5668\u6807\u5fd7\u7684\u96c6\u5408\uff0c\u7528\u4e8e\u6307\u5b9a\u7f16\u8bd1\u65f6\u7684\u9009\u9879\u3002<ul> <li><code>-m32</code>\uff1a\u751f\u621032\u4f4d\u4ee3\u7801\uff0c\u5373\u4f7f\u572864\u4f4d\u7cfb\u7edf\u4e0a\u7f16\u8bd1\u3002</li> <li><code>-fno-pic</code>\uff1a\u7981\u6b62\u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08Position Independent Code\uff09\uff0c\u8fd9\u5bf9\u4e8e\u67d0\u4e9b\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6216\u7279\u5b9a\u542f\u52a8\u4ee3\u7801\u662f\u5fc5\u8981\u7684\u3002</li> <li><code>-fno-omit-frame-pointer</code>\uff1a\u7981\u6b62\u7701\u7565\u5e27\u6307\u9488\uff0c\u8fd9\u6709\u52a9\u4e8e\u8c03\u8bd5\u548c\u67d0\u4e9b\u4f18\u5316\u3002</li> <li><code>-march=i386</code>\uff1a\u6307\u5b9a\u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\u5e94\u8be5\u517c\u5bb9<code>i386</code>\u67b6\u6784\uff0c\u5373\u4f7f\u7f16\u8bd1\u5668\u662f\u5728\u66f4\u65b0\u7684CPU\u4e0a\u8fd0\u884c\u3002</li> <li><code>-fcf-protection=none</code>\uff1a\u7981\u7528\u63a7\u5236\u6d41\u4fdd\u62a4\uff08Control Flow Protection\uff09\uff0c\u8fd9\u662fGCC\u7684\u4e00\u4e2a\u5b89\u5168\u7279\u6027\uff0c\u7528\u4e8e\u9632\u6b62\u67d0\u4e9b\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u6ea2\u51fa\u653b\u51fb\u3002\u5728\u8fd9\u91cc\u7981\u7528\u5b83\u662f\u4e3a\u4e86\u517c\u5bb9\u65e7\u7684CPU\u67b6\u6784\uff0c\u5982\u5728Ubuntu 20.04\u4e0a\u4f7f\u7528\u8f83\u65b0\u7684CPU\u65f6\u3002</li> </ul> </li> <li><code>ASFLAGS</code>\uff1a\u8fd9\u662f\u6c47\u7f16\u5668\u6807\u5fd7\u7684\u96c6\u5408\uff0c\u7528\u4e8e\u6307\u5b9a\u6c47\u7f16\u65f6\u7684\u9009\u9879\u3002<ul> <li><code>-m32</code>\uff1a\u751f\u621032\u4f4d\u4ee3\u7801\u3002</li> <li><code>-fno-pic</code>\uff1a\u7981\u6b62\u751f\u6210\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\u3002</li> </ul> </li> <li><code>LDFLAGS</code>\uff1a\u8fd9\u662f\u94fe\u63a5\u5668\u6807\u5fd7\u7684\u96c6\u5408\uff0c\u7528\u4e8e\u6307\u5b9a\u94fe\u63a5\u65f6\u7684\u9009\u9879\u3002<ul> <li><code>-melf_i386</code>\uff1a\u6307\u5b9a\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u4e3aELF\u683c\u5f0f\uff0c\u4e14\u76ee\u6807\u67b6\u6784\u4e3a<code>i386</code>\u3002</li> </ul> </li> </ol> <p>\u90a3\u8c03\u7528 <code>run</code> \u76ee\u6807\u5462\uff1f</p> <pre><code>include $(AM_HOME)/scripts/isa/x86.mk\ninclude $(AM_HOME)/scripts/platform/qemu.mk\n\nAM_SRCS := x86/qemu/start32.S \\\n           x86/qemu/trap32.S \\\n           x86/qemu/trm.c \\\n           x86/qemu/cte.c \\\n           x86/qemu/ioe.c \\\n           x86/qemu/vme.c \\\n           x86/qemu/mpe.c\n\nrun: build-arg\n    @qemu-system-i386 $(QEMU_FLAGS)\n\n// abstract-machine/scripts/x86-qemu.mk\n</code></pre> <p>\u800c\u6700\u5f00\u59cb\u7684 <code>$AM_HOME/Makefile</code> \u7684\u4e00\u53e5\uff1a</p> <pre><code>### Paste in arch-specific configurations (e.g., from `scripts/x86_64-qemu.mk`)\n-include $(AM_HOME)/scripts/$(ARCH).mk\n</code></pre> <p>\u4e00\u5207\u90fd\u5408\u7406\u4e86\u3002</p> <ol> <li>boot</li> <li>ISA\u3001platform(qemu\u3001\u786c\u4ef6...)\u3001isa-platform</li> </ol> <p>\u5404\u4e00\u4e2a <code>Makefile</code>\uff0c\u7136\u540e\u901a\u8fc7 <code>-include</code> \u6280\u5de7\u7ec4\u5408\u8d77\u6765\u3002\u53c8\u6709\u79cd\u56de\u5230\u4e4b\u524d\u505a PA \u7684\u611f\u89c9\u4e86\u3002</p> <p>\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li> <p>\u4e24\u4e2a\u94fe\u63a5\u5730\u5740\uff1f <code>-Ttext 0x7c00</code>\u3001<code>-Ttext-segment=0x00100000</code></p> <p>\u6700\u5f00\u59cb\u7684\u662f\u56fa\u4ef6 <code>-Ttext 0x7c00</code>\uff0c\u4e5f\u5c31\u662f <code>$BOOT_HOME</code> \u91cc\u7684 <code>main.c</code>\u3002\u52a0\u8f7d\u5b8c\u56fa\u4ef6\u540e\uff0c\u624d\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838 <code>-Ttext-segment=0x00100000</code>\u3002</p> <ol> <li>\u56fa\u4ef6\uff08bootloader\uff09\uff1a\u8fd9\u90e8\u5206\u4ee3\u7801\u901a\u5e38\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u6700\u5148\u8fd0\u884c\u3002\u5b83\u7684\u4efb\u52a1\u662f\u521d\u59cb\u5316\u786c\u4ef6\uff0c\u8bbe\u7f6e\u5fc5\u8981\u7684\u7cfb\u7edf\u72b6\u6001\uff0c\u5e76\u52a0\u8f7d\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5230\u5185\u5b58\u4e2d\u3002\u56fa\u4ef6\u7684\u4ee3\u7801\u6bb5\u8d77\u59cb\u5730\u5740\u901a\u5e38\u88ab\u8bbe\u7f6e\u4e3a<code>0x7c00</code>\uff0c\u8fd9\u662f\u56e0\u4e3a\u5728BIOS\u5f15\u5bfc\u9636\u6bb5\uff0c\u7cfb\u7edf\u4f1a\u4ece\u786c\u76d8\u8bfb\u53d6\u542f\u52a8\u6247\u533a\uff08\u901a\u5e38\u4e3a512\u5b57\u8282\uff09\u5230\u8fd9\u4e2a\u5730\u5740\u3002\u4f60\u7684\u56fa\u4ef6\u4ee3\u7801\uff08<code>bootblock.o</code>\uff09\u5c31\u662f\u5728\u8fd9\u4e2a\u5730\u5740\u5f00\u59cb\u6267\u884c\u7684\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u5728\u7f16\u8bd1\u56fa\u4ef6\u65f6\u4f7f\u7528<code>-Ttext 0x7c00</code>\u9009\u9879\u7684\u539f\u56e0\u3002</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff1a\u4e00\u65e6\u56fa\u4ef6\u5b8c\u6210\u4e86\u5b83\u7684\u4efb\u52a1(\u786c\u4ef6\u81ea\u68c0, load kernel...)\uff0c\u5b83\u4f1a\u5c06\u63a7\u5236\u6743\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u3002\u5185\u6838\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e3b\u8981\u90e8\u5206\uff0c\u8d1f\u8d23\u7ba1\u7406\u7cfb\u7edf\u8d44\u6e90\u3001\u8c03\u5ea6\u8fdb\u7a0b\u7b49\u3002\u5185\u6838\u7684\u4ee3\u7801\u6bb5\u8d77\u59cb\u5730\u5740\u901a\u5e38\u5728\u66f4\u9ad8\u7684\u5730\u5740\uff0c\u4f8b\u5982<code>0x00100000</code>\uff0c\u8fd9\u662f\u56e0\u4e3a\u56fa\u4ef6\u5df2\u7ecf\u52a0\u8f7d\u4e86\u5185\u6838\u5230\u8fd9\u4e2a\u5730\u5740\u3002\u5728\u94fe\u63a5\u5185\u6838\u65f6\u4f7f\u7528<code>-Ttext-segment=0x00100000</code>\u9009\u9879\uff0c\u786e\u4fdd\u5185\u6838\u4ee3\u7801\u5728\u8fd9\u4e2a\u5730\u5740\u5f00\u59cb\u3002</li> </ol> <p>\u8981\u9a8c\u8bc1\u7684\u8bdd\uff0c\u5177\u4f53<code>objdump</code> \u770b\u770b MBR \u4e2d\u7684\u52a0\u8f7d\u5668\u3002</p> <ol> <li> <p>boot\uff1a<code>abstract-machine/am/src/x86/qemu/boot</code></p> <p>\u8be5\u76ee\u5f55\u7528\u4e8e\u6784\u5efa\u542f\u52a8\u955c\u50cf\u3002</p> <p>\u8be5\u76ee\u5f55\u4e0b\u7684 <code>start.S</code> -&gt; <code>load_kernel</code> \uff08\u56fa\u4ef6\u6700\u5f00\u59cb\u7684PC\uff1a<code>0x7c00</code>\uff09</p> <p>\u751f\u6210 <code>bootblock.o</code></p> </li> <li> <p>kernel\uff1a<code>abstract-machine/am/src/x86/qemu/ (\u9664boot)</code> </p> <p>\u7528\u4e8e\u6784\u5efa <code>bare-metal</code> \u5411\u4e0a\u7b2c\u4e00\u5c42\u62bd\u8c61 <code>am-x86-qemu.a</code>\uff08<code>trm + ioe + cte + vme + mpe</code>\uff09</p> <pre><code>x86_64-linux-gnu-ar rcs AM/am/build/am-x86-qemu.a \\\n    AM/am/build/x86-qemu/src/x86/qemu/start32.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/trap32.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/trm.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/cte.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/ioe.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/vme.o \\\n    AM/am/build/x86-qemu/src/x86/qemu/mpe.o\n</code></pre> <p>\u518d\u6784\u5efa <code>klib</code>\uff1a<code>am-x86-qemu.a</code></p> <pre><code>x86_64-linux-gnu-ar rcs AM/klib/build/klib-x86-qemu.a \\\n    AM/klib/build/x86-qemu/src/int64.o \\\n    AM/klib/build/x86-qemu/src/stdlib.o \\\n    AM/klib/build/x86-qemu/src/cpp.o \\\n    AM/ klib/build/x86-qemu/src/string.o \\\n    AM/klib/build/x86-qemu/src/stdio.o\n</code></pre> <p>\u518d <code>bare-metal</code> \u5e94\u7528\uff1a<code>debug-bootloader/hello.c</code></p> <p>\u7136\u540e\u94fe\u63a5\u5668\uff1a</p> <pre><code>x86_64-linux-gnu-ld -z noexecstack -melf_i386 -N \\\n    -Ttext-segment=0x00100000 -o ./build/hello-x86-qemu.elf \\\n    --start-group \\\n        ./build/x86-qemu/hello.o AM/am/build/am-x86-qemu.a AM/klib/build/klib-x86-qemu.a \\\n    --end-group\n</code></pre> <p>\u6700\u7ec8\u751f\u6210 .elf \u6587\u4ef6\u3002</p> <p>\u6700\u540e\uff1a</p> <pre><code>( cat AM/am/src/x86/qemu/boot/bootblock.o; \\\n    head -c 1024 /dev/zero; \\\n    cat ./build/hello-x86-qemu.elf \\\n) &gt; ./build/hello-x86-qemu\n</code></pre> </li> <li> <p>\u81ea\u5df1\u6572\u4e00\u904d</p> <pre><code>qemu-system-i386 -serial mon:stdio -drive format=raw,file=./build/hello-x86-qemu\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nHello, OS World\nCPU #0 Halt (00).\n</code></pre> </li> </ol> </li> </ul> <p>\u884c\u4e86\u3002</p> <p>\u6700\u540e\u518d\u770b\u770b QEMU \u7684\u57fa\u672c\u64cd\u4f5c\u3001\u518d\u770b\u770b QEMU \u7684\u8bba\u6587\uff0cppt\u91cc\u7684\u94fe\u63a5\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_10","title":"\u6570\u5b66\u89c6\u89d2\u7684\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_11","title":"\u7a0b\u5e8f\u7684\u672c\u8d28","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#30","title":"30 \u884c\u5efa\u6a21\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html#_12","title":"\u679a\u4e3e\u6cd5\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html","title":"concurrency","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#_1","title":"\u591a\u5904\u7406\u5668\u7f16\u7a0b","text":"<ul> <li> <p>\u8bc1\u660e\u5171\u4eab\u5185\u5b58</p> <p>DEMO</p> <p>\u5e76\u53d1\u7ebf\u7a0b\u6a21\u578b\uff1a\u5e76\u53d1\u7ebf\u7a0b\u80fd\u591f\u8bfb\u5199\u5171\u4eab\u7684 heap \u5806\u533a\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u6301\u6709\u5c40\u90e8\u53d8\u91cf\u7684\u526f\u672c\u3002Mosaic \u4e0d\u4f1a\u81ea\u52a8\u5728\u6bcf\u6761\u8bed\u53e5\u4e4b\u540e\u8fdb\u884c\u7ebf\u7a0b\u8c03\u5ea6\uff1a\u6211\u4eec\u9700\u8981\u624b\u5de5\u63d2\u5165 <code>sys_sched</code>\u3002</p> </li> </ul>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#1","title":"\u5e76\u53d1\u63a7\u5236\uff1a\u4e92\u65a5\uff081\uff09","text":"<p>\u600e\u4e48\u5e94\u5bf9\uff1f</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#_2","title":"\u963b\u6b62\u5e76\u53d1\uff08\u5e76\u884c\uff09\u7684\u53d1\u751f","text":"<p>\u4ec0\u4e48\u53eb\u4e92\u65a5\uff1f\u4ec0\u4e48\u53eb\u5e76\u53d1\uff1f</p> <p>Concurrent means happening at the same time</p> <p>\u201d\u8981\u6c42\u6574\u4e2a\u4e16\u754c\u6709\u5c0f\u6bb5\u65f6\u95f4\u53ea\u5c5e\u4e8e\u81ea\u5df1\uff0c\u4efb\u4f55\u4eba\u90fd\u4e0d\u80fd\u6253\u65ad\u201c \u201d\u4eba\u60f3\u8c61\u6210\u7ebf\u7a0b\uff0c\u591a\u7ebf\u7a0b\u60f3\u8c61\u6210\u7269\u7406\u4e16\u754c\u201c</p> <ul> <li>\u4e92\u65a5 (\u4e92\u76f8\u6392\u65a5)\uff1a\u963b\u6b62\u5e76\u53d1</li> </ul> <p></p> <p>\u5355\u6838\u5b9e\u73b0\u4e92\u65a5\uff1a</p> <p></p> <p></p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#loadstore","title":"\u4f7f\u7528 load/store \u5b9e\u73b0\u4e92\u65a5\uff08\uff09","text":"<p>\u4e3b\u8981\u662fPeterson \u7b97\u6cd5\u3002\u76f4\u63a5\u770b\u770b\u8bb2\u4e49\u548c\u89c6\u9891\u8bb2\u89e3\u5427\u3002</p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#_3","title":"\u5728\u591a\u5904\u7406\u5668\u4e0a\u5b9e\u73b0\u4e92\u65a5","text":"<p>\u9700\u8981\u610f\u8bc6\u5230\uff1a\u56e0\u4e3a\u4eba\u7c7b\u662f\u201csequential creatures\u201d\uff0c\u5bfc\u81f4\u8fc7\u53bb\u7684\u5f88\u591a\u8bbe\u8ba1\u662f\u6ca1\u6709\u8003\u8651\u5e76\u53d1\u7684\uff08\u591a\u5904\u7406\u5668\u3001\u5171\u4eab\u5185\u5b58\uff09\uff0c\u800c\u6211\u4eec\u5728\u5171\u4eab\u5185\u5b58\u4e0a\u5b9e\u73b0\u4e92\u65a5\u7684\u5931\u8d25\u548c\u6210\u529f\u5c1d\u8bd5\u540e\uff0c\u6211\u4eec\u610f\u8bc6\u5230\u8f6f\u4ef6\u9700\u8981\u548c\u786c\u4ef6\u534f\u540c\u5de5\u4f5c\uff0c\u5e76\u5728\u786c\u4ef6\u539f\u5b50\u6307\u4ee4\u57fa\u7840\u4e0a\u5b9e\u73b0\u4e86\u57fa\u7840\u7248\u672c\u7684\u81ea\u65cb\u9501\u3002</p> <p>\u5173\u952e\u5728\u4e8e\u786c\u4ef6\u5b9e\u73b0\uff0c\u5728 OS \u8bfe\u4e0a\u53ef\u4e0d\u7528\u6df1\u7a76\uff0c\u4e0d\u5c5e\u4e8e\u672c\u95e8\u8bfe\u7684\u8303\u56f4\u3002</p> <p>\u66f4\u591a\u5185\u5bb9\uff1a</p> <p>x86 - How are atomic operations implemented at a hardware level? - Stack Overflow</p> <p>computer architecture - How does an atomic operation guarantee consistency from a hardware perspective? - Super User</p> <p>\u8ba1\u7b97\u673a\u539f\u5b50\uff08atomic\uff09\u64cd\u4f5c\u7684\u5b9e\u73b0\u539f\u7406\u89e3\u6790 - \u77e5\u4e4e</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u603b\u7ed3\u4e3a\uff1a</p> <p>Extra transistors in the chip to implement special cache and memory coherency and bus synchronization procotols. The long answer is way too long.</p> <p>\u518d\u8fdb\u4e00\u6b65\u603b\u7ed3\u76f8\u5173\u5b9e\u73b0\u624b\u6bb5\uff1a</p> <p>\u603b\u7ebf\u9501\u5b9a --&gt; \u7f13\u5b58\u9501\u5b9a \u76f8\u5173\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae / LL/SC</p> <p></p>"},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#2","title":"\u5e76\u53d1\u63a7\u5236\uff1a\u4e92\u65a5\uff082\uff09","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#_4","title":"\u8c03\u8bd5\u7406\u8bba\u4e0e\u5b9e\u8df5","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#1_1","title":"\u5e76\u53d1\u63a7\u5236\uff1a\u540c\u6b65\uff081\uff09","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#2_1","title":"\u5e76\u53d1\u63a7\u5236\uff1a\u540c\u6b65\uff082\uff09","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#_5","title":"\u771f\u5b9e\u4e16\u754c\u7684\u5e76\u53d1\u7f16\u7a0b","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#bugs","title":"\u5e76\u53d1bugs","text":""},{"location":"Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html#bugs_1","title":"\u5e94\u5bf9\u5e76\u53d1bugs","text":""},{"location":"Debugging/Debugging.html","title":"Debugging","text":""},{"location":"Debugging/Debugging.html#books","title":"Books","text":"<p>\u300a\u8f6f\u4ef6\u8c03\u8bd5\u300b\u7b2c\u4e8c\u7248 \u5f20\u94f6\u594e</p> <p>\u300aCortex-M3 \u7f16\u7a0b\u6307\u5357\u300b</p>"},{"location":"Debugging/Debugging.html#example","title":"Example","text":"<p>\u901a\u8fc7qemu+gdb\u5b9e\u73b0\u8de8\u67b6\u6784\u8c03\u8bd5 - \u5218\u8dd1\u8dd1 - \u535a\u5ba2\u56ed (cnblogs.com)</p> <ul> <li> <p>\u7a97\u53e31\uff1a\u542f\u52a8 a.out     \u901a\u8fc7 qemu-aarch64 \u8fd0\u884c\u4ea4\u53c9\u7f16\u8bd1\u7684 a.out, \u5e76\u6307\u5b9a gdb \u8c03\u8bd5\u7aef\u53e3\u53f7\u4e3a1234\uff0c\u7136\u540e\u7b49\u5f85 gdb \u8fdc\u7a0b\u8fde\u63a5\u3002</p> <pre><code>lhx@ubuntu:~/test/qemu$ qemu-aarch64 -g 1234 ./a.out\nHello World !\n</code></pre> <ul> <li><code>-g 1234</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u7528\u4e8e\u6307\u5b9a QEMU \u6a21\u62df\u5668\u7684\u8c03\u8bd5\u7aef\u53e3\u3002<code>-g</code> \u540e\u9762\u8ddf\u7684\u6570\u5b57\u662f TCP \u7aef\u53e3\u53f7\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e3a 1234\u3002\u5f53\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u65f6\uff0cQEMU \u4f1a\u5728\u542f\u52a8\u65f6\u76d1\u542c\u6307\u5b9a\u7684\u7aef\u53e3\uff0c\u5141\u8bb8\u8c03\u8bd5\u5668\uff08\u5982 gdb\uff09\u8fde\u63a5\u5230\u8fd9\u4e2a\u7aef\u53e3\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\u3002</li> </ul> </li> <li> <p>\u7a97\u53e32\uff1agdb \u8fdc\u7a0b\u8c03\u8bd5     \u901a\u8fc7 gdb-multiarch \u542f\u52a8 a.out\uff0c\u8fd9\u91cc a.out \u7528\u4e8e\u8bfb\u53d6\u548c\u8fdc\u7a0b\u7aef\u4e00\u81f4\u7684\u8c03\u8bd5\u7b26\u53f7\u4fe1\u606f\u3002\u8fde\u63a5\u4e0a\u8fdc\u7a0b\u7aef\u53e3\u53f7\u540e\uff0c\u4fbf\u53ef\u4ee5\u8fdb\u884c\u8bbe\u65ad\u70b9\u3001\u67e5\u770b\u5bc4\u5b58\u5668\u3001\u53cd\u6c47\u7f16\u7b49\u4e00\u7cfb\u5217\u8c03\u8bd5\u64cd\u4f5c\u3002</p> <ol> <li><code>gdb-multiarch -q a.out</code>\uff1a<ul> <li><code>gdb-multiarch</code> \u662f\u4e00\u4e2a\u652f\u6301\u591a\u79cd\u67b6\u6784\u7684 GNU \u8c03\u8bd5\u5668\uff08GDB\uff09\u7248\u672c\uff0c\u5b83\u5141\u8bb8\u4f60\u8c03\u8bd5\u4e3a\u4e0d\u540c\u67b6\u6784\u7f16\u8bd1\u7684\u7a0b\u5e8f\u3002</li> <li><code>-q</code> \u9009\u9879\u4f7f GDB \u5728\u542f\u52a8\u65f6\u4e0d\u52a0\u8f7d\u4efb\u4f55\u521d\u59cb\u5316\u811a\u672c\u6587\u4ef6\uff0c\u8fd9\u5728\u81ea\u52a8\u5316\u811a\u672c\u4e2d\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u51cf\u5c11\u542f\u52a8\u65f6\u95f4\u3002</li> </ul> </li> <li><code>(gdb) target remote localhost:1234</code>\uff1a<ul> <li><code>target remote</code> \u547d\u4ee4\u544a\u8bc9 GDB \u8fde\u63a5\u5230\u4e00\u4e2a\u8fdc\u7a0b\u76ee\u6807\u8fdb\u884c\u8c03\u8bd5\u3002</li> <li><code>localhost:1234</code> \u6307\u5b9a\u4e86\u8fdc\u7a0b\u76ee\u6807\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u8fd9\u91cc\u662f\u672c\u5730\u4e3b\u673a\u4e0a\u7684 1234 \u7aef\u53e3\u3002\u8fd9\u901a\u5e38\u4e0e QEMU \u4f7f\u7528 <code>-g 1234</code> \u9009\u9879\u542f\u52a8\u65f6\u6307\u5b9a\u7684\u8c03\u8bd5\u7aef\u53e3\u76f8\u5339\u914d\u3002</li> </ul> </li> </ol> <pre><code>lhx@ubuntu:~/test/qemu$ ls\na.out  hello.c\nlhx@ubuntu:~/test/qemu$ gdb-multiarch -q a.out \nReading symbols from a.out...\n(gdb) target remote localhost:1234\nRemote debugging using localhost:1234\n0x0000000000400558 in _start ()\n(gdb) b main\nBreakpoint 1 at 0x4006d4: file hello.c, line 10.\n(gdb) c\nContinuing.\n\nBreakpoint 1, main () at hello.c:10\n10    hello();\n(gdb) s\nhello () at hello.c:5\n5     printf(\"Hello World !\\n\");\n(gdb) n\n6   }\n(gdb) info registers \nx0             0xe                 14\nx1             0x1                 1\nx2             0x0                 0\nx3             0x48bf00            4767488\nx4             0xfbad2a84          4222429828\nx5             0x21a               538\nx6             0x10                16\nx7             0x7f7f7f7f7f7f7f7f  9187201950435737471\nx8             0x40                64\nx9             0x3fffffff          1073741823\nx10            0x20000000          536870912\nx11            0x10000             65536\nx12            0x48b000            4763648\nx13            0x410               1040\nx14            0x0                 0\nx15            0x48c738            4769592\nx16            0x40b998            4241816\nx17            0x416fc0            4288448\nx18            0x0                 0\nx19            0x400db8            4197816\nx20            0x400e80            4198016\nx21            0x0                 0\nx22            0x400280            4194944\nx23            0x489030            4755504\nx24            0x18                24\nx25            0x48b000            4763648\nx26            0x48b000            4763648\nx27            0x451000            4526080\nx28            0x0                 0\nx29            0x4000800260        274886296160\nx30            0x4006c0            4196032\nsp             0x4000800260        0x4000800260\npc             0x4006c0            0x4006c0 &lt;hello+20&gt;\ncpsr           0x60000000          1610612736\nfpsr           0x0                 0\nfpcr           0x0                 0\n\n(gdb) bt\n#0  hello () at hello.c:6\n#1  0x00000000004006d8 in main () at hello.c:10\n(gdb) disassemble hello\nDump of assembler code for function hello:\n   0x00000000004006ac &lt;+0&gt;: stp x29, x30, [sp, #-16]!\n   0x00000000004006b0 &lt;+4&gt;: mov x29, sp\n   0x00000000004006b4 &lt;+8&gt;: adrp    x0, 0x451000 &lt;_nl_locale_subfreeres+552&gt;\n   0x00000000004006b8 &lt;+12&gt;:    add x0, x0, #0x3e8\n   0x00000000004006bc &lt;+16&gt;:    bl  0x407350 &lt;puts&gt;\n   0x00000000004006c0 &lt;+20&gt;:    nop\n   0x00000000004006c4 &lt;+24&gt;:    ldp x29, x30, [sp], #16\n   0x00000000004006c8 &lt;+28&gt;:    ret\nEnd of assembler dump.\n(gdb) c\nContinuing.\n[Inferior 1 (process 1) exited normally]\n(gdb) \n</code></pre> </li> </ul>"},{"location":"Linux/0.%20Basic%20commands/example.html","title":"Example","text":""},{"location":"Linux/0.%20Basic%20commands/example.html#_1","title":"\u89e3\u538b\u4e0e\u538b\u7f29","text":"<p>\u4f8b\u5b50\uff1a\u5c06\u540d\u4e3a<code>gcc_riscv32</code>\u7684\u76ee\u5f55\u538b\u7f29\u6210<code>.tar.gz</code>\u683c\u5f0f\u7684\u538b\u7f29\u6587\u4ef6</p> <pre><code>tar -czvf gcc_riscv32.tar.gz gcc_riscv32\n</code></pre> <ul> <li><code>tar</code>\uff1a\u8c03\u7528tar\u547d\u4ee4\uff0c\u7528\u4e8e\u6253\u5305\u548c\u538b\u7f29\u3002</li> <li><code>-c</code>\uff1a\u521b\u5efa\u65b0\u7684\u5f52\u6863\u6587\u4ef6\u3002</li> <li><code>-z</code>\uff1a\u901a\u8fc7gzip\u6765\u538b\u7f29\u5f52\u6863\u6587\u4ef6\u3002</li> <li><code>-v</code>\uff1a\u5728\u538b\u7f29\u8fc7\u7a0b\u4e2d\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\uff08verbose\u6a21\u5f0f\uff09\u3002</li> <li><code>-f</code>\uff1a\u6307\u5b9a\u5f52\u6863\u6587\u4ef6\u7684\u540d\u79f0\u3002</li> <li><code>gcc_riscv32.tar.gz</code>\uff1a\u6307\u5b9a\u7684\u8f93\u51fa\u5f52\u6863\u6587\u4ef6\u540d\u3002</li> <li><code>gcc_riscv32</code>\uff1a\u9700\u8981\u538b\u7f29\u7684\u76ee\u5f55\u540d\u3002</li> </ul> <p>\u5f53\u524d\u76ee\u5f55\u4e0b\u4f1a\u751f\u6210\u4e00\u4e2a\u540d\u4e3a<code>gcc_riscv32.tar.gz</code>\u7684\u538b\u7f29\u6587\u4ef6</p> <p>\u53e6\u5916\uff1a\u5c06\u540d\u4e3a<code>gcc_riscv32</code>\u7684\u76ee\u5f55\u538b\u7f29\u6210<code>.zip</code>\u683c\u5f0f\u7684\u538b\u7f29\u6587\u4ef6</p> <p>bash</p> <pre><code>zip -r gcc_riscv32.zip gcc_riscv32\n</code></pre> <p>\u8fd9\u6761\u547d\u4ee4\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li><code>zip</code>\uff1a\u8c03\u7528zip\u547d\u4ee4\uff0c\u7528\u4e8e\u538b\u7f29\u6587\u4ef6\u3002</li> <li><code>-r</code>\uff1a\u9012\u5f52\u5730\u5305\u542b\u76ee\u5f55\uff0c\u5373\u5305\u62ec\u76ee\u5f55\u5185\u7684\u6240\u6709\u5b50\u76ee\u5f55\u548c\u6587\u4ef6\u3002</li> <li><code>gcc_riscv32.zip</code>\uff1a\u6307\u5b9a\u7684\u8f93\u51fa\u538b\u7f29\u6587\u4ef6\u540d\u3002</li> <li><code>gcc_riscv32</code>\uff1a\u9700\u8981\u538b\u7f29\u7684\u76ee\u5f55\u540d\u3002</li> </ul> <p>\u5f53\u524d\u76ee\u5f55\u4e0b\u4f1a\u751f\u6210\u4e00\u4e2a\u540d\u4e3a<code>gcc_riscv32.zip</code>\u7684\u538b\u7f29\u6587\u4ef6</p>"},{"location":"Linux/0.%20Basic%20commands/example.html#ps","title":"ps \u5e38\u89c1\u64cd\u4f5c","text":"<p>Linux \u4e2d\u7684 <code>ps</code> \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5f53\u524d\u7cfb\u7edf\u4e2d\u7684\u8fdb\u7a0b\u72b6\u6001\u3002\u5b83\u662f\u201cProcess Status\u201d\u7684\u7f29\u5199\u3002<code>ps</code> \u547d\u4ee4\u53ef\u4ee5\u63d0\u4f9b\u5173\u4e8e\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u8fdb\u7a0bID\u3001\u7ec8\u7aef\u3001CPU\u4f7f\u7528\u7387\u3001\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u7b49\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684 <code>ps</code> \u547d\u4ee4\u9009\u9879\uff1a</p> <ul> <li><code>ps aux</code>\uff1a\u663e\u793a\u6240\u6709\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b\u4fe1\u606f\uff0c\u5305\u62ec\u5176\u4ed6\u7528\u6237\u542f\u52a8\u7684\u8fdb\u7a0b\u3002</li> <li><code>ps -ef</code>\uff1a\u4ee5\u5168\u683c\u5f0f\u663e\u793a\u6240\u6709\u8fdb\u7a0b\u3002</li> <li><code>ps -u \u7528\u6237\u540d</code>\uff1a\u663e\u793a\u6307\u5b9a\u7528\u6237\u7684\u6240\u6709\u8fdb\u7a0b\u3002</li> <li><code>ps -p PID</code>\uff1a\u663e\u793a\u6307\u5b9a\u8fdb\u7a0bID\u7684\u8fdb\u7a0b\u4fe1\u606f\u3002</li> <li><code>ps -ef | grep \u8fdb\u7a0b\u540d</code>\uff1a\u641c\u7d22\u7279\u5b9a\u8fdb\u7a0b\u3002</li> </ul> <p><code>ps</code> \u547d\u4ee4\u53ef\u4ee5\u4e0e\u5176\u4ed6\u547d\u4ee4\u7ed3\u5408\u4f7f\u7528\uff0c\u6bd4\u5982 <code>grep</code>\uff0c\u6765\u8fc7\u6ee4\u548c\u67e5\u627e\u7279\u5b9a\u7684\u8fdb\u7a0b\u4fe1\u606f\u3002</p>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html","title":"Introduction","text":"<p>[\u79cd\u8349LINUX]linux\u7cfb\u7edf\u67b6\u6784\u4ecb\u7ecd\uff0cBig Picture of LINUX_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_1","title":"\u53d1\u884c\u7248","text":"<p>Linux\u53d1\u884c\u7248\uff08Linux distribution\uff09\u7684\u4e3b\u8981\u533a\u522b\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li> <p>\u5305\u7ba1\u7406\u7cfb\u7edf\uff1a\u4e0d\u540c\u7684\u53d1\u884c\u7248\u53ef\u80fd\u91c7\u7528\u4e0d\u540c\u7684\u5305\u7ba1\u7406\u7cfb\u7edf\uff0c\u5982Debian\u7cfb\u7684apt\u3001Red Hat\u7cfb\u7684yum/dnf\u3001Arch\u7cfb\u7684pacman\u7b49\u3002\u8fd9\u4e9b\u5305\u7ba1\u7406\u7cfb\u7edf\u5728\u8f6f\u4ef6\u5b89\u88c5\u3001\u66f4\u65b0\u548c\u5378\u8f7d\u65b9\u9762\u6709\u7740\u4e0d\u540c\u7684\u547d\u4ee4\u548c\u5de5\u4f5c\u65b9\u5f0f\u3002</p> </li> <li> <p>\u8f6f\u4ef6\u5305\u9009\u62e9\u548c\u7ba1\u7406\uff1a\u4e0d\u540c\u7684\u53d1\u884c\u7248\u53ef\u80fd\u4f1a\u63d0\u4f9b\u4e0d\u540c\u7684\u8f6f\u4ef6\u5305\u96c6\u5408\uff0c\u6709\u4e9b\u53d1\u884c\u7248\u53ef\u80fd\u66f4\u503e\u5411\u4e8e\u63d0\u4f9b\u7a33\u5b9a\u6027\u548c\u53ef\u9760\u6027\u7684\u8f6f\u4ef6\u5305\uff0c\u800c\u6709\u4e9b\u53ef\u80fd\u66f4\u6ce8\u91cd\u63d0\u4f9b\u6700\u65b0\u7684\u8f6f\u4ef6\u5305\u3002</p> </li> <li> <p>\u53d1\u884c\u7248\u7684\u76ee\u6807\u53d7\u4f17\uff1a\u4e00\u4e9b\u53d1\u884c\u7248\u4e13\u6ce8\u4e8e\u4f01\u4e1a\u670d\u52a1\u5668\u5e02\u573a\uff0c\u63d0\u4f9b\u7a33\u5b9a\u6027\u548c\u957f\u671f\u652f\u6301\uff0c\u800c\u53e6\u4e00\u4e9b\u53d1\u884c\u7248\u5219\u66f4\u9002\u5408\u684c\u9762\u7528\u6237\u6216\u8005\u5f00\u53d1\u8005\u3002</p> </li> <li> <p>\u9ed8\u8ba4\u914d\u7f6e\u548c\u7528\u6237\u754c\u9762\uff1a\u4e0d\u540c\u7684\u53d1\u884c\u7248\u53ef\u80fd\u4f1a\u91c7\u7528\u4e0d\u540c\u7684\u9ed8\u8ba4\u914d\u7f6e\u548c\u7528\u6237\u754c\u9762\uff0c\u4ee5\u6ee1\u8db3\u7279\u5b9a\u7528\u6237\u7fa4\u4f53\u7684\u9700\u6c42\u3002</p> </li> <li> <p>\u793e\u533a\u548c\u652f\u6301\uff1a\u6bcf\u4e2a\u53d1\u884c\u7248\u90fd\u6709\u81ea\u5df1\u7684\u793e\u533a\u548c\u652f\u6301\u4f53\u7cfb\uff0c\u6709\u4e9b\u53d1\u884c\u7248\u53ef\u80fd\u6709\u66f4\u5927\u7684\u793e\u533a\u548c\u66f4\u4e30\u5bcc\u7684\u6587\u6863\uff0c\u800c\u6709\u4e9b\u53d1\u884c\u7248\u53ef\u80fd\u66f4\u4fa7\u91cd\u4e8e\u5546\u4e1a\u652f\u6301\u3002</p> </li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cLinux\u53d1\u884c\u7248\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5176\u5305\u7ba1\u7406\u7cfb\u7edf\u3001\u8f6f\u4ef6\u9009\u62e9\u548c\u7ba1\u7406\u3001\u76ee\u6807\u53d7\u4f17\u3001\u9ed8\u8ba4\u914d\u7f6e\u548c\u7528\u6237\u754c\u9762\u4ee5\u53ca\u793e\u533a\u548c\u652f\u6301\u4f53\u7cfb\u3002\u9009\u62e9\u9002\u5408\u81ea\u5df1\u9700\u6c42\u7684\u53d1\u884c\u7248\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002</p>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#lfs-linux-from-scratch","title":"LFS \uff08Linux From Scratch\uff09","text":""},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_2","title":"\u4f9d\u8d56\u56fe","text":""},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#linux","title":"Linux\u5185\u6838\u67b6\u6784","text":""},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_3","title":"\u5185\u90e8\u7ec4\u6210","text":"<p>Linux\u5185\u6838\u4e2d\u7684\u4e3b\u8981\u5b50\u7cfb\u7edf\uff0c\u8fd9\u4e9b\u5b50\u7cfb\u7edf\u8d1f\u8d23\u7ba1\u7406\u5404\u79cd\u529f\u80fd\u548c\u8bbe\u5907\u3002</p> <ol> <li>\u8fdb\u7a0b\u7ba1\u7406\uff1a</li> </ol> <p>\u7ba1\u7406 CPU\uff0c\u7531\u4e8e CPU \u662f\u6267\u884c\u7a0b\u5e8f\u7684\uff0c\u800c\u5185\u6838\u628a\u8fd0\u884c\u65f6\u7684\u7a0b\u5e8f\u62bd\u8c61\u6210\u8fdb\u7a0b\uff0c\u6240\u4ee5\u53c8\u79f0\u4e3a\u8fdb\u7a0b\u7ba1\u7406\u3002</p> <ul> <li>\u8fdb\u7a0b\u8c03\u5ea6</li> <li>\u8fdb\u7a0b\u521b\u5efa\u548c\u9500\u6bc1</li> <li> <p>\u8fdb\u7a0b\u95f4\u901a\u4fe1</p> </li> <li> <p>\u5185\u5b58\u7ba1\u7406\uff1a</p> </li> </ul> <p>\u7ba1\u7406\u5185\u5b58\uff0c\u7531\u4e8e\u7a0b\u5e8f\u548c\u6570\u636e\u90fd\u8981\u5360\u7528\u5185\u5b58\uff0c\u5185\u5b58\u662f\u975e\u5e38\u5b9d\u8d35\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u5185\u6838\u8981\u975e\u5e38\u5c0f\u5fc3\u5730\u5206\u914d\u3001\u91ca\u653e\u5185\u5b58\u3002</p> <ul> <li>\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e</li> <li>\u865a\u62df\u5185\u5b58\u7ba1\u7406</li> <li> <p>\u9875\u9762\u7f6e\u6362\u7b97\u6cd5</p> </li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\uff1a</p> </li> </ul> <p>\u7ba1\u7406\u786c\u76d8\uff0c\u800c\u786c\u76d8\u4e3b\u8981\u5b58\u653e\u7528\u6237\u6570\u636e\uff0c\u800c\u5185\u6838\u628a\u7528\u6237\u6570\u636e\u62bd\u8c61\u6210\u6587\u4ef6\uff0c\u5373\u7ba1\u7406\u6587\u4ef6\uff0c\u6587\u4ef6\u9700\u8981\u5408\u7406\u5730\u7ec4\u7ec7\uff0c\u65b9\u4fbf\u7528\u6237\u67e5\u627e\u548c\u8bfb\u5199\uff0c\u6240\u4ee5\u5f62\u6210\u4e86\u6587\u4ef6\u7cfb\u7edf\u3002</p> <ul> <li>\u6587\u4ef6\u8bfb\u5199</li> <li>\u76ee\u5f55\u7ba1\u7406</li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\u652f\u6301\uff08\u5982ext4\u3001NTFS\u7b49\uff09</p> </li> <li> <p>IO\u4f53\u7cfb\u7ed3\u6784\u548c\u8bbe\u5907\u9a71\u52a8\uff1a</p> </li> <li> <p>\u786c\u4ef6\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f</p> </li> <li> <p>\u8bbe\u5907\u7684\u521d\u59cb\u5316\u548c\u64cd\u4f5c</p> </li> <li> <p>\u7f51\u7edc\u534f\u8bae\u6808\uff1a</p> </li> </ul> <p>\u7ba1\u7406\u7f51\u5361\uff0c\u7f51\u5361\u4e3b\u8981\u5b8c\u6210\u7f51\u7edc\u901a\u4fe1\uff0c\u7f51\u7edc\u901a\u4fe1\u9700\u8981\u5404\u79cd\u901a\u4fe1\u534f\u8bae\uff0c\u6700\u540e\u5728\u5185\u6838\u4e2d\u5c31\u5f62\u6210\u4e86\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u53c8\u79f0\u7f51\u7edc\u7ec4\u4ef6\u3002</p> <ul> <li>TCP/IP\u534f\u8bae\u6808</li> <li>\u7f51\u7edc\u5957\u63a5\u5b57</li> <li> <p>\u7f51\u7edc\u8bbe\u5907\u9a71\u52a8</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528\uff1a</p> </li> <li> <p>\u63d0\u4f9b\u7528\u6237\u7a7a\u95f4\u7a0b\u5e8f\u4e0e\u5185\u6838\u4e4b\u95f4\u7684\u63a5\u53e3</p> </li> <li> <p>\u5b9a\u65f6\u5668\u548c\u4e2d\u65ad\u5904\u7406\uff1a</p> </li> <li> <p>\u786c\u4ef6\u5b9a\u65f6\u5668\u7ba1\u7406</p> </li> <li> <p>\u4e2d\u65ad\u8bf7\u6c42\u5904\u7406</p> </li> <li> <p>\u5b89\u5168\u6027\u548c\u6743\u9650\uff1a</p> </li> <li> <p>\u8bbf\u95ee\u63a7\u5236</p> </li> <li>\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1</li> <li> <p>\u5b89\u5168\u7b56\u7565</p> </li> <li> <p>\u56fe\u5f62\u7cfb\u7edf:</p> </li> </ul> <p>\u7ba1\u7406\u663e\u5361\uff0c\u8d1f\u8d23\u663e\u793a\u4fe1\u606f\uff0c\u800c\u73b0\u5728\u64cd\u4f5c\u7cfb\u7edf\u90fd\u662f\u652f\u6301 GUI\uff08\u56fe\u5f62\u7528\u6237\u63a5\u53e3\uff09\u7684\uff0c\u7ba1\u7406\u663e\u5361\u81ea\u7136\u800c\u7136\u5730\u5c31\u6210\u4e86\u5185\u6838\u4e2d\u7684\u56fe\u5f62\u7cfb\u7edf\u3002</p>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_4","title":"\u5173\u4e8e\u5b8f\u5185\u6838\u548c\u5fae\u5185\u6838","text":"<ul> <li> <p>\u5b8f\u5185\u6838</p> <p>\u5b8f\u5373\u5927\u4e5f\uff0c\u8fd9\u79cd\u6700\u7b80\u5355\u9002\u7528\uff0c\u4e5f\u662f\u6700\u65e9\u7684\u4e00\u79cd\u5185\u6838\u7ed3\u6784\u3002</p> <p>\u5b8f\u5185\u6838\u5c31\u662f\u628a\u4ee5\u4e0a\u8bf8\u5982\u7ba1\u7406\u8fdb\u7a0b\u7684\u4ee3\u7801\u3001\u7ba1\u7406\u5185\u5b58\u7684\u4ee3\u7801\u3001\u7ba1\u7406\u5404\u79cd I/O \u8bbe\u5907\u7684\u4ee3\u7801\u3001\u6587\u4ef6\u7cfb\u7edf\u7684\u4ee3\u7801\u3001\u56fe\u5f62\u7cfb\u7edf\u4ee3\u7801\u4ee5\u53ca\u5176\u5b83\u529f\u80fd\u6a21\u5757\u7684\u4ee3\u7801\uff0c\u628a\u8fd9\u4e9b\u6240\u6709\u7684\u4ee3\u7801\u7ecf\u8fc7\u7f16\u8bd1\uff0c\u6700\u540e\u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a\u5927\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u3002</p> <p>\u8fd9\u4e2a\u5927\u7a0b\u5e8f\u91cc\u6709\u5b9e\u73b0\u652f\u6301\u8fd9\u4e9b\u529f\u80fd\u7684\u6240\u6709\u4ee3\u7801\uff0c\u5411\u7528\u6237\u5e94\u7528\u8f6f\u4ef6\u63d0\u4f9b\u4e00\u4e9b\u63a5\u53e3\uff0c\u8fd9\u4e9b\u63a5\u53e3\u5c31\u662f\u5e38\u8bf4\u7684\u7cfb\u7edf API \u51fd\u6570\u3002\u800c\u8fd9\u4e2a\u5927\u7a0b\u5e8f\u4f1a\u5728\u5904\u7406\u5668\u7684\u7279\u6743\u6a21\u5f0f\u4e0b\u8fd0\u884c\uff0c\u8fd9\u4e2a\u6a21\u5f0f\u901a\u5e38\u88ab\u79f0\u4e3a\u5b8f\u5185\u6838\u6a21\u5f0f\u3002\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5b8f\u5185\u6838\u7ed3\u6784\u56fe\u5c3d\u7ba1\u56fe\u4e2d\u4e00\u5c42\u4e00\u5c42\u7684\uff0c\u8fd9\u5e76\u4e0d\u662f\u5b83\u4eec\u6709\u5c42\u6b21\u5173\u7cfb\uff0c\u4ec5\u4ec5\u8868\u793a\u5b83\u4eec\u94fe\u63a5\u5728\u4e00\u8d77\u3002</p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\u7406\u89e3\u5185\u90e8\u5177\u4f53\u539f\u7406\uff0c\u5b8f\u5185\u6838\u63d0\u4f9b\u5185\u5b58\u5206\u914d\u529f\u80fd\u7684\u670d\u52a1\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528\u5185\u5b58\u5206\u914d\u7684 API\uff08\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\uff09\u51fd\u6570\u3002</li> <li>\u5904\u7406\u5668\u5207\u6362\u5230\u7279\u6743\u6a21\u5f0f\uff0c\u5f00\u59cb\u8fd0\u884c\u5185\u6838\u4ee3\u7801\u3002</li> <li>\u5185\u6838\u91cc\u7684\u5185\u5b58\u7ba1\u7406\u4ee3\u7801\u6309\u7167\u7279\u5b9a\u7684\u7b97\u6cd5\uff0c\u5206\u914d\u4e00\u5757\u5185\u5b58\u3002</li> <li>\u628a\u5206\u914d\u7684\u5185\u5b58\u5757\u7684\u9996\u5730\u5740\uff0c\u8fd4\u56de\u7ed9\u5185\u5b58\u5206\u914d\u7684 API \u51fd\u6570\u3002</li> <li>\u5185\u5b58\u5206\u914d\u7684 API \u51fd\u6570\u8fd4\u56de\uff0c\u5904\u7406\u5668\u5f00\u59cb\u8fd0\u884c\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u5f97\u5230\u4e86\u4e00\u5757\u5185\u5b58\u7684\u9996\u5730\u5740\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528\u8fd9\u5757\u5185\u5b58\u4e86\u3002</li> </ol> <p>\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u548c\u4e00\u4e2a\u5b9e\u9645\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u8fd0\u884c\u8fc7\u7a0b\uff0c\u53ef\u80fd\u6709\u5dee\u5f02\uff0c\u4f46\u5927\u540c\u5c0f\u5f02\u3002\u5f53\u7136\uff0c\u7cfb\u7edf API \u548c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u53ef\u80fd\u8fd8\u6709\u5e93\u51fd\u6570\uff0c\u4e5f\u53ef\u80fd\u53ea\u662f\u5206\u914d\u4e86\u4e00\u4e2a\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u662f\u6211\u4eec\u5173\u6ce8\u7684\u53ea\u662f\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u4e0a\u56fe\u7684\u5b8f\u5185\u6838\u7ed3\u6784\u6709\u660e\u663e\u7684\u7f3a\u70b9\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u6a21\u5757\u5316\uff0c\u6ca1\u6709\u6269\u5c55\u6027\u3001\u6ca1\u6709\u79fb\u690d\u6027\uff0c\u9ad8\u5ea6\u8026\u5408\u5728\u4e00\u8d77\uff0c\u4e00\u65e6\u5176\u4e2d\u4e00\u4e2a\u7ec4\u4ef6\u6709\u6f0f\u6d1e\uff0c\u5185\u6838\u4e2d\u6240\u6709\u7684\u7ec4\u4ef6\u53ef\u80fd\u90fd\u4f1a\u51fa\u95ee\u9898\u3002</p> <p>\u5f00\u53d1\u4e00\u4e2a\u65b0\u7684\u529f\u80fd\u4e5f\u5f97\u91cd\u65b0\u7f16\u8bd1\u3001\u94fe\u63a5\u3001\u5b89\u88c5\u5185\u6838\u3002</p> <p>\u5176\u5b9e\u73b0\u5728\u8fd9\u79cd\u539f\u59cb\u7684\u5b8f\u5185\u6838\u7ed3\u6784\u5df2\u7ecf\u6ca1\u6709\u4eba\u7528\u4e86\u3002</p> <p>\u8fd9\u79cd\u5b8f\u5185\u6838\u552f\u4e00\u7684\u4f18\u70b9\u662f\u6027\u80fd\u5f88\u597d\uff0c\u56e0\u4e3a\u5728\u5185\u6838\u4e2d\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u53ef\u4ee5\u4e92\u76f8\u8c03\u7528\uff0c\u6027\u80fd\u6781\u9ad8\u3002</p> </li> <li> <p>\u5fae\u5185\u6838</p> <p>\u5fae\u5185\u6838\u7ed3\u6784\u5fae\u5185\u6838\u67b6\u6784\u6b63\u597d\u4e0e\u5b8f\u5185\u6838\u67b6\u6784\u76f8\u53cd\uff0c\u5b83\u63d0\u5021\u5185\u6838\u529f\u80fd\u5c3d\u53ef\u80fd\u5c11\uff1a</p> <p>\u4ec5\u4ec5\u53ea\u6709\u8fdb\u7a0b\u8c03\u5ea6\u3001\u5904\u7406\u4e2d\u65ad\u3001\u5185\u5b58\u7a7a\u95f4\u6620\u5c04\u3001\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7b49\u529f\u80fd\u3002</p> <p>\u8fd9\u6837\u7684\u5185\u6838\u662f\u4e0d\u80fd\u5b8c\u6210\u4ec0\u4e48\u5b9e\u9645\u529f\u80fd\u7684\uff0c\u5f00\u53d1\u8005\u4eec\u628a\u5b9e\u9645\u7684\u8fdb\u7a0b\u7ba1\u7406\u3001\u5185\u5b58\u7ba1\u7406\u3001\u8bbe\u5907\u7ba1\u7406\u3001\u6587\u4ef6\u7ba1\u7406\u7b49\u670d\u52a1\u529f\u80fd\uff0c\u505a\u6210\u4e00\u4e2a\u4e2a\u670d\u52a1\u8fdb\u7a0b\u3002\u548c\u7528\u6237\u5e94\u7528\u8fdb\u7a0b\u4e00\u6837\uff0c\u53ea\u662f\u5b83\u4eec\u5f88\u7279\u6b8a\uff0c\u5b8f\u5185\u6838\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5728\u5fae\u5185\u6838\u67b6\u6784\u91cc\u7531\u8fd9\u4e9b\u670d\u52a1\u8fdb\u7a0b\u4e13\u95e8\u8d1f\u8d23\u5b8c\u6210\u3002</p> <p>\u5fae\u5185\u6838\u5b9a\u4e49\u4e86\u4e00\u79cd\u826f\u597d\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u673a\u5236\u2014\u2014\u6d88\u606f\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u8981\u8bf7\u6c42\u76f8\u5173\u670d\u52a1\uff0c\u5c31\u5411\u5fae\u5185\u6838\u53d1\u9001\u4e00\u6761\u4e0e\u6b64\u670d\u52a1\u5bf9\u5e94\u7684\u6d88\u606f\uff0c\u5fae\u5185\u6838\u518d\u628a\u8fd9\u6761\u6d88\u606f\u8f6c\u53d1\u7ed9\u76f8\u5173\u7684\u670d\u52a1\u8fdb\u7a0b\uff0c\u63a5\u7740\u670d\u52a1\u8fdb\u7a0b\u4f1a\u5b8c\u6210\u76f8\u5173\u7684\u670d\u52a1\u3002\u670d\u52a1\u8fdb\u7a0b\u7684\u7f16\u7a0b\u6a21\u578b\u5c31\u662f\u5faa\u73af\u5904\u7406\u6765\u81ea\u5176\u5b83\u8fdb\u7a0b\u7684\u6d88\u606f\uff0c\u5b8c\u6210\u76f8\u5173\u7684\u670d\u52a1\u529f\u80fd\u3002</p> <p>\u5176\u7ed3\u6784\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u5fae\u5185\u6838\u63d0\u4f9b\u5185\u5b58\u5206\u914d\u529f\u80fd\u7684\u670d\u52a1\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5e94\u7528\u7a0b\u5e8f\u53d1\u9001\u5185\u5b58\u5206\u914d\u7684\u6d88\u606f\uff0c\u8fd9\u4e2a\u53d1\u9001\u6d88\u606f\u7684\u51fd\u6570\u662f\u5fae\u5185\u6838\u63d0\u4f9b\u7684\uff0c\u76f8\u5f53\u4e8e\u7cfb\u7edf API\uff0c\u5fae\u5185\u6838\u7684 API\uff08\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\uff09\u76f8\u5f53\u5c11\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\u4ec5\u9700\u8981\u4e24\u4e2a\uff0c\u4e00\u4e2a\u63a5\u6536\u6d88\u606f\u7684 API \u548c\u4e00\u4e2a\u53d1\u9001\u6d88\u606f\u7684 API\u3002</li> <li>\u5904\u7406\u5668\u5207\u6362\u5230\u7279\u6743\u6a21\u5f0f\uff0c\u5f00\u59cb\u8fd0\u884c\u5185\u6838\u4ee3\u7801\u3002</li> <li>\u5fae\u5185\u6838\u4ee3\u7801\u8ba9\u5f53\u524d\u8fdb\u7a0b\u505c\u6b62\u8fd0\u884c\uff0c\u5e76\u6839\u636e\u6d88\u606f\u5305\u4e2d\u7684\u6570\u636e\uff0c\u786e\u5b9a\u6d88\u606f\u53d1\u9001\u7ed9\u8c01\uff0c\u5206\u914d\u5185\u5b58\u7684\u6d88\u606f\u5f53\u7136\u662f\u53d1\u9001\u7ed9\u5185\u5b58\u7ba1\u7406\u670d\u52a1\u8fdb\u7a0b\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\u670d\u52a1\u8fdb\u7a0b\u6536\u5230\u6d88\u606f\uff0c\u5206\u914d\u4e00\u5757\u5185\u5b58\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\u670d\u52a1\u8fdb\u7a0b\uff0c\u4e5f\u4f1a\u901a\u8fc7\u6d88\u606f\u7684\u5f62\u5f0f\u8fd4\u56de\u5206\u914d\u5185\u5b58\u5757\u7684\u5730\u5740\u7ed9\u5185\u6838\uff0c\u7136\u540e\u7ee7\u7eed\u7b49\u5f85\u4e0b\u4e00\u6761\u6d88\u606f\u3002</li> <li>\u5fae\u5185\u6838\u628a\u5305\u542b\u5185\u5b58\u5757\u5730\u5740\u7684\u6d88\u606f\u8fd4\u56de\u7ed9\u53d1\u9001\u5185\u5b58\u5206\u914d\u6d88\u606f\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u5904\u7406\u5668\u5f00\u59cb\u8fd0\u884c\u7528\u6237\u6a21\u5f0f\u4e0b\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u5f97\u5230\u4e86\u4e00\u5757\u5185\u5b58\u7684\u9996\u5730\u5740\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528\u8fd9\u5757\u5185\u5b58\u4e86\u3002</li> </ol> <p>\u5fae\u5185\u6838\u7684\u67b6\u6784\u5b9e\u73b0\u867d\u7136\u4e0d\u540c\uff0c\u4f46\u662f\u5927\u81f4\u8fc7\u7a0b\u548c\u4e0a\u9762\u4e00\u6837\u3002\u540c\u6837\u662f\u5206\u914d\u5185\u5b58\uff0c\u5728\u5fae\u5185\u6838\u4e0b\u62d0\u4e86\u51e0\u4e2a\u5f2f\uff0c\u4e00\u6765\u4e00\u53bb\u7684\u6d88\u606f\u5e26\u6765\u4e86\u975e\u5e38\u5927\u7684\u5f00\u9500\uff0c\u5f53\u7136\u5404\u4e2a\u670d\u52a1\u8fdb\u7a0b\u7684\u5207\u6362\u5f00\u9500\u4e5f\u4e0d\u5c0f\u3002\u8fd9\u6837\u7cfb\u7edf\u6027\u80fd\u5c31\u5927\u6253\u6298\u6263\u3002</p> <p>\u4f46\u662f\u5fae\u5185\u6838\u6709\u5f88\u591a\u4f18\u70b9\uff0c\u9996\u5148\uff0c\u7cfb\u7edf\u7ed3\u6784\u76f8\u5f53\u6e05\u6670\u5229\u4e8e\u534f\u4f5c\u5f00\u53d1\u3002\u5176\u6b21\uff0c\u7cfb\u7edf\u6709\u826f\u597d\u7684\u79fb\u690d\u6027\uff0c\u5fae\u5185\u6838\u4ee3\u7801\u91cf\u975e\u5e38\u5c11\uff0c\u5c31\u7b97\u91cd\u5199\u6574\u4e2a\u5185\u6838\u4e5f\u4e0d\u662f\u96be\u4e8b\u3002</p> <p>\u6700\u540e\uff0c\u5fae\u5185\u6838\u6709\u76f8\u5f53\u597d\u7684\u4f38\u7f29\u6027\u3001\u6269\u5c55\u6027\uff0c\u56e0\u4e3a\u90a3\u4e9b\u7cfb\u7edf\u529f\u80fd\u53ea\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u968f\u65f6\u62ff\u6389\u4e00\u4e2a\u670d\u52a1\u8fdb\u7a0b\u4ee5\u51cf\u5c11\u7cfb\u7edf\u529f\u80fd\uff0c\u6216\u8005\u589e\u52a0\u51e0\u4e2a\u670d\u52a1\u8fdb\u7a0b\u4ee5\u589e\u5f3a\u7cfb\u7edf\u529f\u80fd\u3002</p> <p>\u5fae\u5185\u6838\u7684\u4ee3\u8868\u4f5c\u6709 MACH\u3001MINIX\u3001L4 \u7cfb\u7edf\uff0c\u8fd9\u4e9b\u7cfb\u7edf\u90fd\u662f\u5fae\u5185\u6838\uff0c\u4f46\u662f\u5b83\u4eec\u4e0d\u662f\u5546\u4e1a\u7ea7\u7684\u7cfb\u7edf\uff0c\u5546\u4e1a\u7ea7\u7684\u7cfb\u7edf\u4e0d\u91c7\u7528\u5fae\u5185\u6838\u4e3b\u8981\u8fd8\u662f\u56e0\u4e3a\u6027\u80fd\u5dee\u3002</p> </li> </ul>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_5","title":"\u4e8c\u8005\u7684\u4e3b\u8981\u533a\u522b","text":"<p>\u5b8f\u5185\u6838\u548c\u5fae\u5185\u6838\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u7684\u901a\u4fe1\u65b9\u5f0f</p> <ul> <li>\u5b8f\u5185\u6838\uff1a\u76f4\u63a5\u4f7f\u7528\u51fd\u6570\u8c03\u7528\u548c\u5171\u4eab\u6570\u636e\u7ed3\u6784</li> <li>\u5fae\u5185\u6838\uff1ainter-Process Communication (IPC)<ul> <li>\u6d88\u606f\u4f20\u9012(Message Passing)</li> <li>\u5171\u4eab\u5185\u5b58(Shared Memory)</li> <li>\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528(Remote Procedure Calls (RPC))</li> <li>\u4e8b\u4ef6\u961f\u5217(Event Queues)</li> </ul> </li> </ul>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#_6","title":"\u5b9e\u9645\u6848\u4f8b\u5b66\u4e60","text":"<ul> <li> <p>Linux</p> <p></p> <p></p> </li> </ul> <p>\u5185\u5b58\u7ba1\u7406\uff08memory\uff09</p> <p>\u8fdb\u7a0b\u7ba1\u7406\uff08CPU\uff09 ---&gt; \u8fdb\u7a0b\u8c03\u5ea6</p> <p>\u7cfb\u7edf --&gt;</p> <p>\u5b58\u50a8\uff08\u6587\u4ef6\u7cfb\u7edf\uff09\uff08disk controllers\uff09</p> <p>\u7f51\u7edc\u5b50\u7cfb\u7edf\uff08network controllers\uff09</p> <ul> <li> <p>Darwin (Mac OS / IOS)</p> <p></p> </li> <li> <p>Windows</p> <p>    \u5fae\u8f6f\u81ea\u5df1\u5728 HAL \u5c42\u4e0a\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5c0f\u5185\u6838\uff0c\u5c0f\u5185\u6838\u4e4b\u4e0b\u662f\u786c\u4ef6\u62bd\u8c61\u5c42 HAL\uff0c</p> <p>\u8fd9\u4e2a HAL \u5b58\u5728\u7684\u597d\u5904\u662f\uff1a\u4e0d\u540c\u7684\u786c\u4ef6\u5e73\u53f0\u53ea\u8981\u63d0\u4f9b\u5bf9\u5e94\u7684 HAL \u5c31\u53ef\u4ee5\u79fb\u690d\u7cfb\u7edf\u4e86\u3002</p> <p>\u5c0f\u5185\u6838\u4e4b\u4e0a\u662f\u5404\u79cd\u5185\u6838\u7ec4\u4ef6\uff0c\u5fae\u8f6f\u79f0\u4e4b\u4e3a\u5185\u6838\u6267\u884c\u4f53\uff0c\u5b83\u4eec\u5b8c\u6210\u8fdb\u7a0b\u3001\u5185\u5b58\u3001\u914d\u7f6e\u3001I/O \u6587\u4ef6\u7f13\u5b58\u3001\u7535\u6e90\u4e0e\u5373\u63d2\u5373\u7528\u3001\u5b89\u5168\u7b49\u76f8\u5173\u7684\u670d\u52a1\u3002</p> <p>\u6bcf\u4e2a\u6267\u884c\u4f53\u4e92\u76f8\u72ec\u7acb\uff0c\u53ea\u5bf9\u5916\u63d0\u4f9b\u76f8\u5e94\u7684\u63a5\u53e3\uff0c\u5176\u5b83\u6267\u884c\u4f53\u8981\u901a\u8fc7\u5185\u6838\u6a21\u5f0f\u53ef\u8c03\u7528\u63a5\u53e3\u548c\u5176\u5b83\u6267\u884c\u4f53\u901a\u4fe1\u6216\u8005\u8bf7\u6c42\u5176\u5b8c\u6210\u76f8\u5e94\u7684\u529f\u80fd\u670d\u52a1\u3002</p> <p>\u6240\u6709\u7684\u8bbe\u5907\u9a71\u52a8\u548c\u6587\u4ef6\u7cfb\u7edf\u90fd\u7531 I/O \u7ba1\u7406\u5668\u7edf\u4e00\u7ba1\u7406\uff0c\u9a71\u52a8\u7a0b\u5e8f\u53ef\u4ee5\u5806\u53e0\u5f62\u6210 I/O \u9a71\u52a8\u6808\uff0c\u529f\u80fd\u8bf7\u6c42\u88ab\u5c01\u88c5\u6210 I/O \u5305\uff0c\u5728\u6808\u4e2d\u4e00\u5c42\u5c42\u6d41\u52a8\u5904\u7406\u3002Windows \u5f15\u4ee5\u4e3a\u50b2\u7684\u56fe\u5f62\u5b50\u7cfb\u7edf\u4e5f\u5728\u5185\u6838\u4e2d\u3002</p> </li> <li> <p>Linux \u548c Windows \u533a\u522b</p> <p>Certainly! Let's delve into the main differences between the Linux kernel and the Windows kernel implementations, as well as how their internal workings differ:</p> <ol> <li> <p>Kernel Architecture:</p> <ul> <li>Linux Kernel: The Linux kernel follows a monolithic architecture, where core operating system services such as process management, memory management, file system handling, and device drivers all run in kernel space. This design choice aims for efficiency and direct access to hardware.</li> <li>Windows Kernel: The Windows kernel, specifically the Windows NT kernel, employs a hybrid architecture. While core services like process management and memory management reside in kernel mode, certain components like the graphics subsystem and file system drivers operate in user mode. This hybrid approach balances performance and stability.</li> </ul> </li> <li> <p>System Calls and APIs:</p> <ul> <li>Linux Kernel: Linux provides a set of system calls that user-space applications can invoke to interact with the kernel. The Linux API adheres to POSIX standards, offering a familiar environment for developers from Unix-like systems.</li> <li>Windows Kernel: Windows exposes its own set of system calls and APIs, collectively known as the Win32 API. This extensive API is tailored to Windows-specific features and functionalities, distinct from the Linux API.</li> </ul> </li> <li> <p>Process and Memory Management:</p> <ul> <li>Linux Kernel: Linux utilizes the fork-exec model for process management and implements robust memory management mechanisms such as virtual memory, demand paging, and memory protection. It also supports multi-threading via POSIX threads.</li> <li>Windows Kernel: Windows employs its process creation model with CreateProcess and provides memory management features like virtual memory, memory protection, and memory-mapped files. Windows offers multi-threading capabilities through its native threading API.</li> </ul> </li> <li> <p>File Systems:</p> <ul> <li>Linux Kernel: Linux supports various file systems like ext4, XFS, and Btrfs, allowing users to choose the file system that best suits their requirements.</li> <li>Windows Kernel: Windows primarily uses the NTFS file system, offering features such as file encryption, compression, and access control lists (ACLs). It also supports FAT and exFAT file systems.</li> </ul> </li> <li> <p>Device Drivers:</p> <ul> <li>Linux Kernel: Linux boasts a wide range of device drivers included in the kernel source tree, supporting a vast array of hardware devices.</li> <li>Windows Kernel: Windows includes a comprehensive set of device drivers, with support for a broad range of hardware components. Windows device drivers typically interact with the kernel via the Windows Driver Model (WDM).</li> </ul> </li> </ol> <p>These differences in architecture, system calls, memory management, file systems, and device driver support contribute to the distinct characteristics and behavior of the Linux and Windows kernels. Each kernel's design choices reflect its target use cases, performance objectives, and historical development paths.</p> </li> </ul>"},{"location":"Linux/1.%20Kernel%20architecture/Introduction.html#linux_1","title":"\u5173\u4e8eLinux\u5185\u6838\u7684\u5b66\u4e60","text":"<p>\u5728\u6211\u6709\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6574\u4f53\u5b8f\u89c2\u56fe\u6982\u5ff5\u548c\u4e00\u4e9b\u5e38\u89c1\u7684\u57fa\u7840\u6982\u5ff5\u4e4b\u540e\uff0c\u518d\u5f00\u59cb\u5206\u4e13\u9898\u5b66\u4e60\u5185\u6838\u5404\u4e2a\u5b50\u7cfb\u7edf\u3002</p> <p>\u6ce8\u610f\uff1a\u4ec5\u4e3a\u4e4b\u524d\u81ea\u8eab\u7684\u5b66\u4e60\u8def\u5f84\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002</p> <p>\u5185\u6838\u662f\u4e3a\u8fdb\u7a0b(CPU)\u670d\u52a1\u7684\uff0c \u8bfb\u660e\u767d\u4e86\u5185\u5b58\u5bfb\u5740\u548c\u5185\u5b58\u7ba1\u7406\uff0c\u4ee5\u201c\u8fdb\u7a0b\u7ed3\u6784\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u4ee5\u53cacpu\u5bf9\u8fd9\u6837\u7ed3\u6784\u7684\u8bbf\u95ee \u201d \u4e3a \u57fa\u672c\u6846\u67b6 \u6765\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <ol> <li> <p>\u9996\u5148\u770b\u5185\u5b58\u7ba1\u7406\u90e8\u5206</p> <p>\u5bfb\u5740\u3001\u5206\u9875\u3001\u5206\u6bb5\u5206\u9875\u3001\u5185\u5b58\u5730\u5740\u6620\u5c04\u3001\u7269\u7406\u9875\u6846\u7684\u7ba1\u7406\u7b49\uff0c\u5185\u5b58\u8bbf\u95ee\u662f\u4e00\u5207\u7684\u57fa\u7840</p> </li> <li> <p>\u8fdb\u7a0b\uff08/\u5185\u6838/CPU\uff09\u7684\u5730\u5740\u7a7a\u95f4\u7ba1\u7406</p> <p>\u8fdb\u7a0bmm\u7ed3\u6784\u3001vm_struct\u7ba1\u7406\u3001\u5185\u6838\u5185\u5b58\u5206\u914d\u7684\u51e0\u4e2a\u4e3b\u8981\u51fd\u6570\uff0cslab\uff0c\u4f19\u4f34\u7cfb\u7edf\u7b49</p> </li> <li> <p>\u8fdb\u7a0b\u8c03\u5ea6\u90e8\u5206</p> <p>\u5185\u6838\u540c\u6b65\uff0c\u4e2d\u65ad\uff0c\u4fe1\u53f7\uff0cIPC\uff0c\u7cfb\u7edf\u8c03\u7528\u7b49\u5176\u4ed6\u5185\u5bb9\uff0c</p> </li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\u90e8\u5206</p> <p>vfs\u548c \u9875\u9ad8\u901f\u7f13\u5b58\uff0c \u6587\u4ef6\uff0c\u6587\u4ef6\u7cfb\u7edf</p> </li> <li> <p>IO\u8bbe\u5907</p> <p>io \u8bbe\u5907\u548csysfs\u9a71\u52a8\u6a21\u578b</p> </li> </ol> <p>\u5269\u4f59\u7684\u4ec0\u4e48\u56fe\u5f62\u548c\u7f51\u7edc\u7531\u81ea\u5df1\u7684\u5174\u8da3\u548c\u4ee5\u540e\u5de5\u4f5c\u7684\u65b9\u5411\u6765\u3002</p>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html","title":"Summary","text":""},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#summary","title":"Summary","text":"<ul> <li> <p>Linux Operating System Basics: </p> <p>Understand the basic principles of Linux operating system, file system structure, process management, memory management and other related knowledge.</p> </li> <li> <p>C/C++ programming language: </p> <p>proficient in C/C++ language, as the main programming language of Linux system programming, able to carry out system-level programming and debugging.</p> </li> <li> <p>System Calls and Library Functions: </p> <p>Familiar with Linux system calls and library functions, able to write programs that can interact with the operating system.</p> </li> <li> <p>Shell Programming: </p> <p>Understand Shell Script Programming, and be able to write Shell scripts for system management and automation tasks.</p> </li> <li> <p>Multi-threading and process communication: </p> <p>Master the mechanism of multi-threaded programming and inter-process communication, and be able to achieve multi-task concurrent processing.</p> </li> <li> <p>Network Programming: </p> <p>Understand the relevant knowledge of network programming, including Socket programming, TCP/IP protocol, etc. , and be able to communicate and transmit data on the network.</p> </li> <li> <p>Debugging and Performance Optimization: </p> <p>Ability to debug programs and optimize performance, and be able to locate and solve problems in system programming.</p> </li> <li> <p>Kernel Module Programming: </p> <p>Understand Linux kernel module programming, and be able to write and debug kernel modules to extend system functionality.</p> </li> <li> <p>Linux\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\uff1a\u4e86\u89e3Linux\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u539f\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784\u3001\u8fdb\u7a0b\u7ba1\u7406\u3001\u5185\u5b58\u7ba1\u7406\u7b49\u76f8\u5173\u77e5\u8bc6\u3002</p> </li> <li> <p>C/C++\u7f16\u7a0b\u8bed\u8a00\uff1a\u719f\u7ec3\u638c\u63e1C/C++\u8bed\u8a00\uff0c\u4f5c\u4e3aLinux\u7cfb\u7edf\u7f16\u7a0b\u7684\u4e3b\u8981\u7f16\u7a0b\u8bed\u8a00\uff0c\u80fd\u591f\u8fdb\u884c\u7cfb\u7edf\u7ea7\u7f16\u7a0b\u548c\u8c03\u8bd5\u3002</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528\u548c\u5e93\u51fd\u6570\uff1a\u719f\u6089Linux\u7cfb\u7edf\u8c03\u7528\u548c\u5e93\u51fd\u6570\uff0c\u80fd\u591f\u7f16\u5199\u80fd\u591f\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\u7684\u7a0b\u5e8f\u3002</p> </li> <li> <p>Shell\u7f16\u7a0b\uff1a\u4e86\u89e3Shell\u811a\u672c\u7f16\u7a0b\uff0c\u80fd\u591f\u7f16\u5199Shell\u811a\u672c\u6765\u8fdb\u884c\u7cfb\u7edf\u7ba1\u7406\u548c\u81ea\u52a8\u5316\u4efb\u52a1\u3002</p> </li> <li> <p>\u591a\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u901a\u4fe1\uff1a\u638c\u63e1\u591a\u7ebf\u7a0b\u7f16\u7a0b\u548c\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u673a\u5236\uff0c\u80fd\u591f\u5b9e\u73b0\u591a\u4efb\u52a1\u5e76\u53d1\u5904\u7406\u3002</p> </li> <li> <p>\u7f51\u7edc\u7f16\u7a0b\uff1a\u4e86\u89e3\u7f51\u7edc\u7f16\u7a0b\u76f8\u5173\u77e5\u8bc6\uff0c\u5305\u62ecSocket\u7f16\u7a0b\u3001TCP/IP\u534f\u8bae\u7b49\uff0c\u80fd\u591f\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u548c\u6570\u636e\u4f20\u8f93\u3002</p> </li> <li> <p>\u8c03\u8bd5\u548c\u6027\u80fd\u4f18\u5316\uff1a\u5177\u5907\u8c03\u8bd5\u7a0b\u5e8f\u548c\u4f18\u5316\u6027\u80fd\u7684\u80fd\u529b\uff0c\u80fd\u591f\u5b9a\u4f4d\u548c\u89e3\u51b3\u7cfb\u7edf\u7f16\u7a0b\u4e2d\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u5185\u6838\u6a21\u5757\u7f16\u7a0b\uff1a\u4e86\u89e3Linux\u5185\u6838\u6a21\u5757\u7f16\u7a0b\uff0c\u80fd\u591f\u7f16\u5199\u548c\u8c03\u8bd5\u5185\u6838\u6a21\u5757\u4ee5\u6269\u5c55\u7cfb\u7edf\u529f\u80fd\u3002</p> </li> </ul> <p>\u5728\u7b80\u5386\u4e0a\u5199\u4e0a\u6570\u5b57Linux\u7cfb\u7edf\u7f16\u7a0b\u7684\u7ecf\u9a8c\uff0c\u9700\u8981\u6e05\u6670\u5730\u5217\u51fa\u4f60\u5728\u4ee5\u4e0a\u6280\u80fd\u65b9\u9762\u7684\u5b9e\u9645\u7ecf\u9a8c\u548c\u9879\u76ee\u7ecf\u5386\uff0c\u4ee5\u53ca\u80fd\u591f\u5c55\u793a\u4f60\u5728Linux\u7cfb\u7edf\u7f16\u7a0b\u65b9\u9762\u7684\u80fd\u529b\u548c\u6210\u5c31\u3002</p> <ol> <li>\u5982\u4f55\u8fdb\u884cLinux\u7cfb\u7edf\u7f16\u7a0b\u7684\u73af\u5883\u642d\u5efa\u548c\u8c03\u8bd5\uff1f</li> <li>\u5728Linux\u7cfb\u7edf\u7f16\u7a0b\u4e2d\uff0c\u5982\u4f55\u5904\u7406\u6587\u4ef6\u64cd\u4f5c\u548c\u6743\u9650\u7ba1\u7406\uff1f</li> <li>Linux\u7cfb\u7edf\u7f16\u7a0b\u4e2d\u5e38\u7528\u7684\u8c03\u8bd5\u5de5\u5177\u6709\u54ea\u4e9b\uff1f</li> </ol>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#system-calls-and-library-functions","title":"System Calls and Library Functions","text":"<p>\u5728Linux\u7cfb\u7edf\u7f16\u7a0b\u4e2d\uff0c\u7cfb\u7edf\u8c03\u7528\u548c\u5e93\u51fd\u6570\u662f\u975e\u5e38\u91cd\u8981\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u5b83\u4eec\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u63a5\u53e3\u548c\u529f\u80fd\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u8fdb\u884c\u7cfb\u7edf\u7ea7\u7f16\u7a0b\u548c\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ol> <li>\u6587\u4ef6\u64cd\u4f5c\uff1a\u5982open\u3001read\u3001write\u3001close\u7b49\uff0c\u7528\u4e8e\u5bf9\u6587\u4ef6\u7684\u8bfb\u5199\u548c\u3002</li> <li>\u8fdb\u7a0b\u63a7\u5236\uff1a\u5982fork\u3001exec\u3001wait\u7b49\uff0c\u7528\u4e8e\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u6267\u884c\u548c\u7b49\u5f85\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\uff1a\u5982brk\u3001mmap\u3001munmap\u7b49\uff0c\u7528\u4e8e\u5185\u5b58\u7684\u5206\u914d\u548c\u7ba1\u7406\u3002</li> <li>\u7f51\u7edc\u901a\u4fe1\uff1a\u5982socket\u3001bind\u3001connect\u7b49\uff0c\u7528\u4e8e\u7f51\u7edc\u901a\u4fe1\u7684\u5efa\u7acb\u548c\u64cd\u4f5c\u3002</li> <li>\u4fe1\u53f7\u5904\u7406\uff1a\u5982signal\u3001kill\u3001sigaction\u7b49\uff0c\u7528\u4e8e\u5904\u7406\u8fdb\u7a0b\u95f4\u7684\u4fe1\u53f7\u901a\u4fe1\u3002</li> </ol> <p>\u5e93\u51fd\u6570\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ol> <li>\u6807\u51c6C\u5e93\u51fd\u6570\uff1a\u5982stdio.h\u3001stdlib.h\u3001string.h\u7b49\uff0c\u63d0\u4f9b\u4e86\u5bf9\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u3001\u5185\u5b58\u64cd\u4f5c\u3001\u5b57\u7b26\u4e32\u5904\u7406\u7b49\u529f\u80fd\u7684\u652f\u6301\u3002</li> <li>\u7f51\u7edc\u5e93\u51fd\u6570\uff1a\u5982socket.h\u3001netinet/in.h\u7b49\uff0c\u63d0\u4f9b\u4e86\u5bf9\u7f51\u7edc\u7f16\u7a0b\u7684\u652f\u6301\uff0c\u5305\u62ecSocket\u64cd\u4f5c\u3001\u5730\u5740\u8f6c\u6362\u7b49\u3002</li> <li>\u7ebf\u7a0b\u5e93\u51fd\u6570\uff1a\u5982pthread.h\uff0c\u63d0\u4f9b\u4e86\u5bf9\u591a\u7ebf\u7a0b\u7f16\u7a0b\u7684\u652f\u6301\uff0c\u5305\u62ec\u7ebf\u7a0b\u521b\u5efa\u3001\u540c\u6b65\u3001\u4e92\u65a5\u7b49\u64cd\u4f5c\u3002</li> <li>\u6570\u5b66\u5e93\u51fd\u6570\uff1a\u5982math.h\uff0c\u63d0\u4f9b\u4e86\u5bf9\u6570\u5b66\u8fd0\u7b97\u7684\u652f\u6301\uff0c\u5305\u62ec\u5e38\u7528\u7684\u6570\u5b66\u51fd\u6570\u3001\u968f\u673a\u6570\u751f\u6210\u7b49\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c\u7cfb\u7edf\u8c03\u7528\u63d0\u4f9b\u4e86\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u529f\u80fd\u7684\u8bbf\u95ee\uff0c\u800c\u5e93\u51fd\u6570\u5219\u662f\u5bf9\u7cfb\u7edf\u8c03\u7528\u7684\u5c01\u88c5\u548c\u6269\u5c55\uff0c\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7ea7\u7684\u63a5\u53e3\u548c\u529f\u80fd\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u8fdb\u884c\u7a0b\u5e8f\u5f00\u53d1\u3002\u5728Linux\u7cfb\u7edf\u7f16\u7a0b\u4e2d\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u4f1a\u540c\u65f6\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u548c\u5e93\u51fd\u6570\u6765\u5b9e\u73b0\u5404\u79cd\u529f\u80fd\u3002</p>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#shell-programming","title":"Shell Programming","text":"<p>Linux\u7684shell\u7f16\u7a0b\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ol> <li>Shell\u811a\u672c\uff1a\u7f16\u5199\u4e00\u7cfb\u5217\u7684\u547d\u4ee4\uff0c\u4ee5\u811a\u672c\u7684\u5f62\u5f0f\u4fdd\u5b58\u5e76\u6267\u884c\uff0c\u53ef\u4ee5\u5b9e\u73b0\u81ea\u52a8\u5316\u4efb\u52a1\u3001\u6279\u5904\u7406\u7b49\u529f\u80fd\u3002</li> <li>\u53d8\u91cf\u548c\u73af\u5883\u53d8\u91cf\uff1a\u5728Shell\u811a\u672c\u4e2d\u53ef\u4ee5\u5b9a\u4e49\u53d8\u91cf\uff0c\u5e76\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6765\u63a7\u5236Shell\u7684\u884c\u4e3a\u548c\u6267\u884c\u73af\u5883\u3002</li> <li>\u6d41\u7a0b\u63a7\u5236\uff1a\u5305\u62ec\u6761\u4ef6\u5224\u65ad\uff08if-else\uff09\u3001\u5faa\u73af\uff08for\u3001while\uff09\u3001\u8df3\u51fa\u5faa\u73af\uff08break\u3001continue\uff09\u7b49\uff0c\u7528\u4e8e\u63a7\u5236Shell\u811a\u672c\u7684\u6267\u884c\u6d41\u7a0b\u3002</li> <li>\u51fd\u6570\uff1a\u5728Shell\u811a\u672c\u4e2d\u53ef\u4ee5\u5b9a\u4e49\u548c\u8c03\u7528\u51fd\u6570\uff0c\u63d0\u9ad8\u4ee3\u7801\u7684\u91cd\u7528\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002</li> <li>\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411\uff1a\u901a\u8fc7\u91cd\u5b9a\u5411\u7b26\u53f7\uff08&gt;\u3001&gt;&gt;\u3001&lt;\uff09\u53ef\u4ee5\u63a7\u5236\u547d\u4ee4\u7684\u8f93\u5165\u548c\u8f93\u51fa\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u8f93\u5165\u8f93\u51fa\u63a7\u5236\u3002</li> <li>\u7ba1\u9053\u548c\u8fc7\u6ee4\u5668\uff1a\u4f7f\u7528\u7ba1\u9053\u7b26\u53f7\uff08|\uff09\u53ef\u4ee5\u5c06\u4e00\u4e2a\u547d\u4ee4\u7684\u8f93\u51fa\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u547d\u4ee4\u7684\u8f93\u5165\uff0c\u5b9e\u73b0\u6570\u636e\u6d41\u7684\u5904\u7406\u548c\u8fc7\u6ee4\u3002</li> <li>\u6587\u4ef6\u64cd\u4f5c\uff1a\u5305\u62ec\u6587\u4ef6\u7684\u521b\u5efa\u3001\u5220\u9664\u3001\u590d\u5236\u3001\u79fb\u52a8\u7b49\u64cd\u4f5c\uff0c\u4ee5\u53ca\u6587\u4ef6\u6743\u9650\u7684\u7ba1\u7406\u3002</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a\u5728Shell\u811a\u672c\u4e2d\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u548c\u6587\u672c\u5904\u7406\u3002</li> <li>\u8c03\u8bd5\u548c\u9519\u8bef\u5904\u7406\uff1a\u901a\u8fc7\u8bbe\u7f6e\u8c03\u8bd5\u6807\u5fd7\u3001\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\uff0c\u4ee5\u53ca\u5904\u7406\u9519\u8bef\u4fe1\u606f\u6765\u63d0\u9ad8Shell\u811a\u672c\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u9760\u6027\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cLinux\u7684shell\u7f16\u7a0b\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u811a\u672c\u7f16\u7a0b\u8bed\u8a00\uff0c\u53ef\u4ee5\u7528\u4e8e\u7cfb\u7edf\u7ba1\u7406\u3001\u4efb\u52a1\u81ea\u52a8\u5316\u3001\u6570\u636e\u5904\u7406\u7b49\u591a\u79cd\u573a\u666f\uff0c\u5bf9\u4e8e\u7cfb\u7edf\u7ba1\u7406\u5458\u548c\u5f00\u53d1\u8005\u6765\u8bf4\u90fd\u662f\u5fc5\u5907\u7684\u6280\u80fd\u4e4b\u4e00\u3002</p>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#multi-process-and-threaded-programming","title":"Multi-process and threaded programming","text":"<p>Linux\u591a\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u7f16\u7a0b 1. \u8fdb\u7a0b\u7ba1\u7406\uff1a\u5305\u62ec\u8fdb\u7a0b\u521b\u5efa\u3001\u9500\u6bc1\u3001\u8c03\u5ea6\u3001\u901a\u4fe1\u548c\u540c\u6b65\u7b49\u3002fork()\u3001exec()\u3001wait()\u3002 2. \u7ebf\u7a0b\u7ba1\u7406\uff1a\u6d89\u53ca\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u540c\u6b65\u548c\u901a\u4fe1\u3002Linux\u7cfb\u7edf\u652f\u6301POSIX\u7ebf\u7a0b\uff08pthread\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528pthread_create()\u7b49\u51fd\u6570\u521b\u5efa\u65b0\u7ebf\u7a0b\uff0c\u4f7f\u7528pthread_join()\u7b49\u51fd\u6570\u5b9e\u73b0\u7ebf\u7a0b\u540c\u6b65\u3002 3. \u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\uff1a\u5305\u62ec\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u548c\u4fe1\u53f7\u91cf\u7b49\u673a\u5236\u3002\u8fd9\u4e9b\u673a\u5236\u53ef\u4ee5\u7528\u4e8e\u4e0d\u540c\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u548c\u540c\u6b65\u64cd\u4f5c\u3002 4. \u7ebf\u7a0b\u540c\u6b65\uff1a\u6d89\u53ca\u4e92\u65a5\u9501\u3001\u6761\u4ef6\u53d8\u91cf\u3001\u8bfb\u5199\u9501\u7b49\u540c\u6b65\u673a\u5236\uff0c\u7528\u4e8e\u907f\u514d\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\u53d1\u751f\u7ade\u6001\u6761\u4ef6\u3002 5. \u4fe1\u53f7\u5904\u7406\uff1aLinux\u7cfb\u7edf\u4e2d\u7684\u4fe1\u53f7\u53ef\u4ee5\u7528\u4e8e\u901a\u77e5\u8fdb\u7a0b\u53d1\u751f\u7684\u4e8b\u4ef6\uff0c\u5982\u4e2d\u65ad\u4fe1\u53f7\u3001\u7ec8\u6b62\u4fe1\u53f7\u7b49\u3002\u7f16\u7a0b\u65f6\u9700\u8981\u5904\u7406\u4fe1\u53f7\u7684\u6ce8\u518c\u3001\u5904\u7406\u548c\u54cd\u5e94\u3002 6. \u591a\u8fdb\u7a0b/\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u578b\uff1a\u8bbe\u8ba1\u548c\u5b9e\u73b0\u57fa\u4e8e\u591a\u8fdb\u7a0b\u6216\u591a\u7ebf\u7a0b\u7684\u5e76\u53d1\u6a21\u578b\uff0c\u8003\u8651\u5230\u8fdb\u7a0b/\u7ebf\u7a0b\u95f4\u7684\u901a\u4fe1\u3001\u540c\u6b65\u548c\u8d44\u6e90\u7ba1\u7406\u7b49\u95ee\u9898\u3002</p>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#network-programming","title":"Network Programming","text":"<p>\u5728Linux\u7f51\u7edc\u7f16\u7a0b\u4e2d\uff0c\u4e3b\u8981\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u5185\u5bb9\uff1a</p> <ol> <li> <p>Socket\u7f16\u7a0b\uff1a\u4f7f\u7528Socket API\u5b9e\u73b0\u7f51\u7edc\u901a\u4fe1\uff0c\u5305\u62ec\u521b\u5efaSocket\u3001\u7ed1\u5b9a\u5730\u5740\u3001\u76d1\u542c\u8fde\u63a5\u3001\u5efa\u7acb\u8fde\u63a5\u3001\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u7b49\u64cd\u4f5c\u3002</p> </li> <li> <p>TCP/IP\u534f\u8bae\uff1a\u7406\u89e3TCP\u548cIP\u534f\u8bae\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u5efa\u7acb\u8fde\u63a5\u3001\u6570\u636e\u4f20\u8f93\u3001\u9519\u8bef\u5904\u7406\u3001\u65ad\u5f00\u8fde\u63a5\u7b49\u8fc7\u7a0b\u3002</p> </li> <li> <p>UDP\u534f\u8bae\uff1a\u4e0eTCP\u7c7b\u4f3c\uff0c\u4f46\u662fUDP\u662f\u65e0\u8fde\u63a5\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u9002\u7528\u4e8e\u4e00\u4e9b\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u3001\u6570\u636e\u4f20\u8f93\u4e0d\u53ef\u9760\u7684\u573a\u666f\u3002</p> </li> <li> <p>\u7f51\u7edc\u7f16\u7a0b\u5de5\u5177\uff1a\u638c\u63e1\u4e00\u4e9b\u5e38\u7528\u7684\u7f51\u7edc\u7f16\u7a0b\u5de5\u5177\uff0c\u5982netcat\u3001tcpdump\u3001wireshark\u7b49\uff0c\u7528\u4e8e\u8c03\u8bd5\u548c\u5206\u6790\u7f51\u7edc\u901a\u4fe1\u95ee\u9898\u3002</p> </li> <li> <p>\u591a\u8def\u590d\u7528IO\uff1a\u4f7f\u7528select\u3001poll\u3001epoll\u7b49\u591a\u8def\u590d\u7528IO\u673a\u5236\uff0c\u5b9e\u73b0\u540c\u65f6\u76d1\u542c\u591a\u4e2aSocket\u7684\u8bfb\u5199\u4e8b\u4ef6\uff0c\u63d0\u9ad8\u7f51\u7edc\u7f16\u7a0b\u7684\u6548\u7387\u3002</p> </li> <li> <p>\u7f51\u7edc\u7f16\u7a0b\u6a21\u578b\uff1a\u4e86\u89e3\u5e76\u53d1\u670d\u52a1\u5668\u6a21\u578b\u3001\u591a\u7ebf\u7a0b\u670d\u52a1\u5668\u6a21\u578b\u3001\u591a\u8fdb\u7a0b\u670d\u52a1\u5668\u6a21\u578b\u7b49\u4e0d\u540c\u7684\u7f51\u7edc\u7f16\u7a0b\u6a21\u578b\uff0c\u9009\u62e9\u9002\u5408\u573a\u666f\u7684\u6a21\u578b\u8fdb\u884c\u5f00\u53d1\u3002</p> </li> <li> <p>\u5957\u63a5\u5b57\u9009\u9879\uff1a\u638c\u63e1\u5957\u63a5\u5b57\u9009\u9879\u7684\u8bbe\u7f6e\u548c\u4f7f\u7528\uff0c\u5982\u8bbe\u7f6eSocket\u7684\u8d85\u65f6\u65f6\u95f4\u3001\u7aef\u53e3\u590d\u7528\u3001\u5730\u5740\u91cd\u7528\u7b49\u3002</p> </li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cLinux\u7f51\u7edc\u7f16\u7a0b\u6d89\u53caSocket\u7f16\u7a0b\u3001TCP/IP\u534f\u8bae\u3001UDP\u534f\u8bae\u3001\u7f51\u7edc\u7f16\u7a0b\u5de5\u5177\u3001\u591a\u8def\u590d\u7528IO\u3001\u7f51\u7edc\u7f16\u7a0b\u6a21\u578b\u548c\u5957\u63a5\u5b57\u9009\u9879\u7b49\u5185\u5bb9\u3002\u5728\u5b9e\u9645\u7f16\u7a0b\u4e2d\uff0c\u9700\u8981\u5145\u5206\u7406\u89e3\u8fd9\u4e9b\u5185\u5bb9\uff0c\u5e76\u7ed3\u5408\u5177\u4f53\u4e1a\u52a1\u9700\u6c42\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u548c\u5b9e\u73b0\u3002</p>"},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#debugging-and-performance-optimization","title":"Debugging and Performance Optimization","text":""},{"location":"Linux/2.%20System%20Programming/0.%20Summary/Summary.html#kernel-module-programming","title":"Kernel Module Programming","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html","title":"Example","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#basic","title":"Basic","text":"<ul> <li>\u7a0b\u5e8f\uff1a\u6e90\u4ee3\u7801\u3001\u6307\u4ee4</li> <li>\u8fdb\u7a0b\uff1a\u8fd0\u884c\u7740\u7684\u7a0b\u5e8f</li> <li>\u7ebf\u7a0b\uff1a\u7ebf\u7a0b\u4ece\u5c5e\u4e8e\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u6709\u591a\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u8fdb\u7a0b\u7684\u8d44\u6e90</li> <li>\u4efb\u52a1\uff1a\u5177\u4f53\u8981\u505a\u7684\u7684\u4e8b\u60c5\uff08\u53ef\u4ee5\u662f\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u505a\u7684\uff09</li> </ul> <p>\u5173\u4e8e\u7ebf\u7a0b\u6982\u5ff5\u7684\u63d0\u51fa\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u662f\u4e3a\u4e86\u89e3\u51b3\u8fdb\u7a0b\u5207\u6362\u7684\u5f00\u9500\u8fc7\u5927</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_1","title":"\u8fdb\u7a0b","text":"<p>\u5305\u62ec\u8fdb\u7a0b\u521b\u5efa\u3001\u9500\u6bc1\u3001\u8c03\u5ea6\u3001\u901a\u4fe1\u548c\u540c\u6b65\u3002fork\uff08\uff09\u3001exec\uff08\uff09\u3001wait\uff08\uff09...</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#fork","title":"fork()","text":"<pre><code>man getpid\n# \u53e6\u5916\u67e5\u624b\u518c\n</code></pre> <ul> <li> <p>version1</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    pid_t pid;\n\n    pid = fork();\n\n    printf(\"pid = %d\\n\", pid);\n    printf(\"hello world.\\n\");\n\n    return 0;\n}\n\n//\u6253\u5370\u4e24\u6b21hello world\n//\u8fd8\u6709\u4e24\u4e2a\u8fdb\u7a0b\u53f7\npid = 5867\nhello world.\npid = 0\nhello world.\n</code></pre> <p>\u5206\u6790\uff1a</p> <p></p> <p>From manual: </p> <p>RETURN VALUE On success, the PID of the child process is returned in the parent, and 0 is returned in the child.  On failure, -1 is returned in the parent, no child process is created, and errno is set appropriately.</p> <p>\u7236\u8fdb\u7a0b\u8fd4\u56de\u5b50\u8fdb\u7a0b\u7684ID\u53f7\uff0c\u5b50\u8fdb\u7a0b\u8fd4\u56de0\u3002</p> </li> <li> <p>version2</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    pid_t pid1, pid2;\n\n    pid1 = fork();\n    pid2 = fork();\n\n    printf(\"pid1 = %d, pid2 = %d\\n\", pid1, pid2);\n    return 0;\n}\n</code></pre> <p>\u5206\u6790\uff1a</p> <p></p> <p>\u7b2c\u4e00\u884c\uff0c\u4e24\u6b21 ID \u53f7\u90fd\u5927\u4e8e 0\uff0c\u8bf4\u660e\u4e24\u6b21\u90fd\u5f53\u7236\u8fdb\u7a0b\uff0c\u4e3a\u8fdb\u7a0bA\u6253\u5370\u3002</p> <p>\u7b2c\u4e8c\u884c\uff0c\u7b2c\u4e00\u6b21\u5f53\u5b50\u8fdb\u7a0b\uff0c\u7b2c\u4e8c\u6b21\u5f53\u4e86\u7236\u8fdb\u7a0b\uff0c\u4e3aB\u8fdb\u7a0b\u6253\u5370\u3002</p> <p>\u7b2c\u4e09\u884c\uff0c\u7b2c\u4e00\u6b21\u5f53\u7236\u8fdb\u7a0b\uff0c\u7b2c\u4e8c\u6b21\u5f53\u5b50\u8fdb\u7a0b\uff0c\u4e0d\u5b58\u5728\uff0c\u5b9e\u9645\u4e0a\u4e3aC\u8fdb\u7a0b\u6253\u5370\uff08\u7a0d\u540e\u89e3\u6790\uff09</p> <p>\u7b2c\u56db\u884c\uff0c\u4e24\u6b21 ID \u53f7\u90fd\u5c0f\u4e8e 0\uff0c\u8bf4\u660e\u4e24\u6b21\u90fd\u4e3a\u5b50\u8fdb\u7a0b\uff0c\u4e3a\u8fdb\u7a0bD\u6253\u5370\u3002</p> <p>\u5173\u4e8e\u8fdb\u7a0bC\uff1a</p> <p>\u4e3a\u4ec0\u4e48C\u8fdb\u7a0b\u6253\u5370\u4f1a\u6709pid1\u7684\u503c\u5462\uff1f\u4ed6\u90fd\u6ca1\u6709\u6267\u884c<code>pid1 = fork()</code>\u3002</p> <p>\u6ce8\u610f\uff1a\u5728fork\u521b\u5efa\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u5b50\u8fdb\u7a0b\u8981\u590d\u5236\u62f7\u8d1d\u7236\u8fdb\u7a0b\u7684\u6240\u6709\u8d44\u6e90\u3002\uff0c\u6545pid1\u7684\u503c\u5b9e\u9645\u4e0a\u6765\u81ea\u8fdb\u7a0bA</p> <p>\uff08\u540c\u7406 \u7b2c\u56db\u884c\u7684 pid1 \u4e3a 0\uff0c\u4e5f\u662f\u8fd9\u4e48\u6765\u7684\uff09</p> <p>(\u9009\u770b)\uff08\u8fd9\u91cc\u53ef\u4ee5\u7ed3\u5408\u8ba1\u7ec4\u6210\u7b14\u8bb0\u6765\u8fdb\u4e00\u6b65\u601d\u8003\uff0c\u5b50\u8fdb\u7a0b\u590d\u5236\u4e4b\u540e\uff0c\u662f\u76f4\u63a5\u5f00\u8f9f\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4\u6765\u7528\u5417\uff1f\u5185\u5b58\u662f\u5f88\u5b9d\u8d35\u7684\u5594\uff1f\uff09</p> <p>\u60f3\u60f3 \u5199\u65f6\u590d\u5236 COW (Copy-on-write) \u548c\u8bf7\u6c42\u8c03\u9875\uff0c\u53ea\u6709\u5728\u5199\u5165\u5185\u5b58\u7684\u65f6\u5019\u624d\u4f1a\u5206\u914d\u65b0\u7684\u5185\u5b58\u3002</p> <p>\u66f4\u8fdb\u4e00\u6b65:</p> <p>fork \u628a\u8fdb\u7a0b A \u7684\u91cd\u8981\u6570\u636e\u7ed3\u6784\u590d\u5236\u4e86\u4e00\u4efd\uff0c\u5c31\u751f\u6210\u4e86\u8fdb\u7a0b C\u3002</p> <p>\u6709\u4e00\u70b9\u5f88\u91cd\u8981\uff0c\u90a3\u5c31\u662f\u8fdb\u7a0b A \u4e0e\u8fdb\u7a0b B \u7684\u9875\u8868\u6307\u5411\u4e86\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\u9875\uff0c\u5e76\u5bf9\u5176\u9875\u8868\u90fd\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u5c5e\u6027\u3002</p> <p>\u7c7b\u4f3c\u5185\u5b58\u5171\u4eab\u4f46\u6709\u533a\u522b\uff0c\u4f46\u5171\u4eab\u5185\u5b58\u662f\u4ece\u8bfb\u53d6\u6570\u636e\u7684\u89d2\u5ea6\u6765\u770b\u7684\uff0c\u8fd8\u6709\u6570\u636e\u5199\u5165\u3002</p> <ul> <li>\u5411\u5185\u5b58\u4e2d\u5199\u5165\u6570\u636e</li> </ul> <p>\u5199\u5165\u6570\u636e\u65f6\uff0c\u8fd9\u65f6\u65e0\u8bba\u662f\u8fdb\u7a0b A \u8fd8\u662f\u8fdb\u7a0b C \u53bb\u5199\u5165\u6570\u636e\uff0c\u8fd9\u91cc\u6211\u4eec\u5047\u5b9a\u8fdb\u7a0b B \u5411\u5b83\u7684\u6808\u533a\u3001\u6570\u636e\u533a\u3001\u6307\u4ee4\u533a\u7b49\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5199\u5165\u6570\u636e\uff0c\u7ed3\u679c\u4e00\u5b9a\u662f\u4ea7\u751f MMU \u8f6c\u6362\u5730\u5740\u5931\u8d25\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5bf9\u5e94\u7684\u9875\u8868\u662f\u53ea\u8bfb\u7684\uff0c\u5373\u4e0d\u5141\u8bb8\u5199\u5165\u3002</p> <p>\u6b64\u65f6 MMU \u5c31\u4f1a\u7ee7\u7eed\u901a\u77e5 CPU \u4ea7\u751f\u7f3a\u9875\u5f02\u5e38\u4e2d\u65ad\uff0c\u8fdb\u800c\u5f15\u8d77 Linux \u5185\u6838\u7f3a\u9875\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u3002\u7136\u540e\uff0c\u7f3a\u9875\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u5b8c\u76f8\u5e94\u7684\u68c0\u67e5\uff0c\u53d1\u73b0\u95ee\u9898\u51fa\u5728 COW \u673a\u5236\u4e0a\uff0c\u8fd9\u65f6\u5019\u624d\u4f1a\u628a\u4e00\u9875\u7269\u7406\u5185\u5b58\u4e5f\u5206\u914d\u7ed9\u76f8\u5173\u5e94\u7528\uff0c\u89e3\u9664\u9875\u8868\u7684\u53ea\u8bfb\u5c5e\u6027\uff0c\u5e76\u4e14\u628a\u8fdb\u7a0b A \u5bf9\u5e94\u7684\u7269\u7406\u5185\u5b58\u9875\u7684\u6570\u636e\uff0c\u590d\u5236\u5230\u65b0\u5206\u914d\u7684\u7269\u7406\u5185\u5b58\u9875\u4e2d\u3002</p> <p>\u7efc\u4e0a\uff0c\u5728fork\u8fdb\u7a0b\u5efa\u7acb\u65f6\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528\u5199\u65f6\u590d\u5236\u6765\u5ef6\u8fdf\u5185\u5b58\u5206\u914d\u3002 </p> <p>\u66f4\u8fdb\u4e00\u6b65\uff0c\u6253\u5370\u7684\u8fdb\u7a0b\u53f7\u90fd\u662f\u54ea\u51e0\u4e2a\u8fdb\u7a0b</p> <p>6068 \u662f\u8fdb\u7a0b B \u7684\u3002</p> <p>6069 \u662f\u8fdb\u7a0b C \u7684\u3002</p> <p>6070 \u662f\u8fdb\u7a0b D \u7684\u3002</p> <p>A \u4e0d\u77e5\u9053\u5594\uff0c\u901a\u8fc7\u522b\u7684\u65b9\u5f0f\u6765\u770b\u770b</p> </li> <li> <p>version3.1\uff1a</p> <p>\u8fdb\u4e00\u6b65\u6539\u5584\uff0c\u90fd\u6253\u5370ID\u53f7\uff0c\u6ca1\u5565\u610f\u4e49\u3002\u60f3\u8ba9\u7236\u5b50\u8fdb\u7a0b\u6267\u884c\u5404\u81ea\u7684\u5185\u5bb9\u3002--&gt; \u5229\u7528\u5206\u652f\u8bed\u53e5</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    pid_t pid;\n\n    pid = fork();\n\n    if(pid &gt; 0) //parent process\n    {\n        while(1)\n        {\n            printf(\"hello world.\\n\");\n            sleep(1);\n        }\n    }else if(pid == 0)  //child process\n    {\n        while(1)\n        {\n            printf(\"Good moring.\\n\");\n            sleep(1);\n        }\n    }else \n    {\n        perror(\"fork\");\n    }\n\n\n    return 0;\n}\n</code></pre> <p>Q1: \u5173\u4e8e\u8fd0\u884c\u65f6\u95f4\uff1f\u8c01\u5148\u8fd0\u884c\uff1f</p> <p>\u5b8f\u89c2\u4e0a\uff1a\u5e76\u53d1\u540c\u65f6\u6267\u884c\uff08\u8fd8\u6709<code>printf()</code>\u7684\u5f71\u54cd\uff0c\u4e0d\u80fd\u901a\u8fc7<code>printf()</code>\u7684\u987a\u5e8f\u6765\u5224\u65ad\u8c01\u5148\u8fd0\u884c\uff09\uff0c\u4f46\u975e\u8981\u5206\u9ad8\u4f4e\uff0c\u7531Linux 2.6 \u5185\u6838\u4ee5\u540e\u7ed9\u51fa\u7684\u89e3\u91ca\uff1a\u9ed8\u8ba4\u7236\u8fdb\u7a0b\u5148\u8c03\u5ea6\uff08\u6ce8\u610f\u00b7\uff09\uff0c\u56e0\u4e3a\u7236\u8fdb\u7a0b\u5728<code>fork()</code>\u7684\u65f6\u5019\uff0c\u5b83\u7684\u7f13\u5b58\u3001\u5185\u5b58\u90fd\u51c6\u5907\u597d\u4e86\uff0c\u81ea\u7136\u662f\u8981\u6bd4\u5b50\u8fdb\u7a0b\u5feb\u7684\uff0c\u4f46\u8fd9\u662f\u94bb\u725b\u89d2\u5c16\u7684\u89d2\u5ea6\uff0c\u7406\u89e3\u6210\u5e76\u53d1\u540c\u65f6\u6267\u884c\u5c31\u884c\u4e86\u3002</p> <p>\u6709\u4e00\u70b9\uff0c\u8fd9\u662f\u6765\u81ea\u5b98\u65b9\u8bf4\u660e\uff0c\u4e0d\u80fd\u5355\u5355\u9760<code>printf()</code>\u987a\u5e8f\u3002</p> <p>\u8fd8\u6709\u8fd9\u4e2a\u987a\u5e8f\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd\u5bf9\u4e8e\u7edd\u5927\u591a\u7684\u5e94\u7528\u90fd\u5fae\u4e4e\u5176\u5fae\uff0c\u4f46\u6211\u5c31\u662f\u8981\u4e00\u4e2a\u660e\u786e\u7684\u987a\u5e8f\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5c31\u662f\u540e\u9762 \u4efb\u52a1/\u8fdb\u7a0b/\u7ebf\u7a0b \u540c\u6b65\u6280\u672f\u3002</p> </li> <li> <p>version4</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint count = 0;\n\nint main(void)\n{\n    pid_t pid;\n    int i = 0;\n    pid = fork();\n\n    if(pid &gt; 0) //parent process\n    {\n        for(i = 0; i &lt; 10; i++)\n        {\n            printf(\"Hello world: %d\\n \", count++);\n        }\n    }else if(pid == 0)  //child process\n    {\n        while(1)\n        {\n            printf(\"Good moring: %d.\\n\", count++);\n            sleep(2);\n        }\n    }else \n    {\n        perror(\"fork\");\n    }\n\n\n    return 0;\n}\n</code></pre> <p>\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u90fd\u662f\u7531\u72ec\u7acb\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4e92\u4e0d\u5e72\u6270\u3001\u548c\u4e0d\u4e92\u76f8\u4f9d\u8d56\u3002</p> <p>\u53d8\u91cf<code>count</code>\u5728\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u4e2d\u90fd\u6709\u4e00\u4efd\u526f\u672c\uff0c\u4f46\u8fd9\u4e24\u4efd\u526f\u672c\u662f\u72ec\u7acb\u7684\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u4fee\u6539<code>count</code>\u65f6\u53ea\u4f1a\u5f71\u54cd\u81ea\u5df1\u8fdb\u7a0b\u5185\u90e8\u7684\u526f\u672c\uff0c\u4e0d\u4f1a\u5f71\u54cd\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u526f\u672c\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u7236\u5b50\u8fdb\u7a0b\u4e2d\u7684<code>count</code>\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u53d8\u91cf\uff0c\u53ea\u662f\u540d\u5b57\u76f8\u540c\u800c\u5df2\u3002</p> <p>\u5982\u679c\u60f3\u8981\u4e92\u76f8\u5e72\u6270\uff0c\u8fd8\u5f97\u662f IPC \u7684\u5185\u5bb9</p> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#wait","title":"wait()","text":"<pre><code>man wait\n# \u53e6\u5916\u67e5\u624b\u518c\n</code></pre> <p><code>pid_t wait(int *wstatus);</code> </p> <p>\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e\u8bb8\u591a\u9700\u8981\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u5e94\u7528\u6765\u8bf4\uff0c\u7236\u8fdb\u7a0b\u80fd\u591f\u76d1\u6d4b\u5b50\u8fdb\u7a0b\u7684\u7ec8\u6b62\u65f6\u95f4\u548c\u8fc7\u7a0b\u662f\u5f88\u6709\u5fc5\u8981\u7684\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528 wait()\u7b49\u5f85\u8c03\u7528\u8fdb\u7a0b\u7684\u4efb\u4e00\u5b50\u8fdb\u7a0b\u7ec8\u6b62\uff0c\u540c\u65f6\u5728\u53c2\u6570 status \u6240\u6307\u5411\u7684\u7f13\u51b2\u533a\u4e2d\u8fd4\u56de\u8be5\u5b50\u8fdb\u7a0b\u7684\u7ec8\u6b62\u72b6\u6001\u3002</p> <ul> <li> <p>\u5982\u679c\u6ca1\u6709\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6ca1\u6709\u7ec8\u6b62\u7684\u8bdd\uff0c\u90a3wait\u4e00\u76f4\u963b\u585e\uff1b\u5982\u679c\u6709\uff0c\u90a3\u5c31\u8fd4\u56de\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u7684ID\u53f7\uff0c\u4e14\u4ece\u963b\u585e\u53d8\u4e3a\u975e\u963b\u585e\u3002</p> </li> <li> <p>\u5f53\u6240\u6709\u5b50\u8fdb\u7a0b\u90fd\u5df2\u7ecf\u8fd0\u884c\u7ed3\u675f\uff0c\u90a3wait\u51fd\u6570\u8fd4\u56de -1 \uff0c\u5373wait\u51fd\u6570\u7b49\u5f85\u5b50\u8fdb\u7a0b\u90fd\u7ed3\u675f\u4e86\u3002</p> </li> <li>\u5982\u679c status \u975e\u7a7a\uff0c\u90a3\u4e48\u5173\u4e8e\u5b50\u8fdb\u7a0b\u5982\u4f55\u7ec8\u6b62\u7684\u4fe1\u606f\u5219\u4f1a\u901a\u8fc7 status \u6307\u5411\u7684\u6574\u578b\u53d8\u91cf\u8fd4\u56de\u3002</li> <li>\u5185\u6838\u5c06\u4f1a\u4e3a\u7236\u8fdb\u7a0b\u4e0b\u6240\u6709\u5b50\u8fdb\u7a0b\u7684\u8fd0\u884c\u603b\u91cf\u8ffd\u52a0\u8fdb\u7a0b CPU \u65f6\u95f4\u4ee5\u53ca\u8d44\u6e90\u4f7f\u7528\u6570\u636e\u3002  </li> </ul> <ul> <li> <p>version1\uff1a</p> <p>\u521b\u5efa3\u4e2a\u5b50\u8fdb\u7a0b\uff0c5s \u300110s\u300115s\u540e\u5206\u522b\u7ed3\u675f\uff0c\u7236\u8fdb\u7a0b\u4e00\u76f4\u7b49\u5f85\u5b50\u8fdb\u7a0b\u8fd0\u884c\u7ed3\u675f\uff0c\u76f4\u5230\u6240\u6709\u7684\u5b50\u8fdb\u7a0b\u7ed3\u675f\uff0c\u7236\u8fdb\u7a0b\u518d\u7ed3\u675f</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n\n// run model: ./a.out 10 5 15\n// Create three child process and run. After 10, 5, 15 seconds, they will exit \nint main(int argc, char *argv[])\n{\n    pid_t child_pid;\n    int numDead;\n    int i;\n\n    for(i = 1; i &lt; argc; i++)\n    {\n        switch(fork())\n        {\n            case -1:\n                perror(\"fork()\");\n                exit(0);\n\n            case 0:     //child process\n                printf(\"Child %d start with PID = %d, sleeping %s \\n\", i, getpid(), argv[i]);\n                sleep(atoi(argv[i]));\n                exit(0);\n\n            default:    //parent process\n                break;\n\n        }\n    }\n    numDead = 0;\n\n    while (1)\n    {\n        child_pid = wait(NULL);\n\n        if(-1 == child_pid)\n        {\n            printf(\"No more children, byebye!\\n\");\n            exit(0);\n        }\n\n        numDead++;\n        printf(\"wait() returned child PID: %d(numDead = %d)\\n\", child_pid, numDead);\n    }\n    return 0;\n}\n</code></pre> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_2","title":"\u7ebf\u7a0b","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#pthread_create","title":"pthread_create()","text":"<pre><code>  int pthread_create(pthread_t *thread, const pthread_attr_t *attr,\n                      void *(*start_routine) (void *), void *arg);\n\n1. \u7ebf\u7a0bID\u53f7\uff1athread\n\n2. \u7ebf\u7a0b\u7ed3\u6784\u4f53\u6307\u9488\uff1aattr\n       The attr argument points to a pthread_attr_t structure whose contents are used at thread creation time to determine attributes for the new thread; this structure is initialized using pthread_attr_init(3) and related functions.  If attr is NULL, then the thread is created with default attributes.\n\n3. \u51fd\u6570\u6307\u9488\uff1astart_routine\uff08\u5730\u5740\uff09\n\n4. \u7ed9\u51fd\u6570\u6307\u9488\u7684\u53c2\u6570\n           \u53ef\u4ee5\u63a7\u5236\u51fd\u6570\u6307\u9488\u7684\u4e00\u4e9b\u884c\u4e3a\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u7684\u6267\u884c\u987a\u5e8f\uff1f\n</code></pre> <ul> <li> <p>version1</p> <pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid *thread_function(void *arg);\n\nint main(int argc, char *argv[])\n{\n    pthread_t pthread;\n    int ret;\n\n    ret = pthread_create(&amp;pthread, NULL, thread_function, NULL);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n    return 0;\n}\n\nvoid *thread_function(void *arg)\n{\n    int i = 0;\n\n    printf(\"Thread begins running.\\n\");\n\n    while(1)\n    {\n        printf(\"Hello world.\\n\");\n        sleep(1);\n    }\n\n    return NULL;\n}\n// \u4e0a\u9762\u6709\u95ee\u9898\uff0c\u76f4\u63a5return0\u540e\uff0c\u8fdb\u7a0b\u76f4\u63a5\u6302\u4e86\uff0c\u7ebf\u7a0b\u4f9d\u8d56\u4e8e\u8fdb\u7a0b\uff0c\u90a3\u7ebf\u7a0b\u4e5f\u5c31\u6302\u4e86\n// \u6539\u8fdb\uff0c\u76f4\u63a5\u5728return 0\u524d\u9762\u52a0\u4e2awhile(1) \u6216\u8005\u522b\u7684\u65b9\u6cd5\uff0c\n</code></pre> <p>--&gt; \u5f15\u5165<code>pthread_join()</code> </p> <p>\u8fd0\u7528\u4e00\u4e0b<code>arg</code>\u53c2\u6570\uff1a</p> <pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid *thread_function(void *arg);\n\nint main(int argc, char *argv[])\n{\n    pthread_t pthread;\n    int ret;\n    int count = 4;\n\n    ret = pthread_create(&amp;pthread, NULL, thread_function, &amp;count);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n    pthread_join(pthread, NULL);\n    printf(\"The thread is over, the process is over too\\n\");\n\n\n    return 0;\n}\n\nvoid *thread_function(void *arg)\n{\n    int i = 0;\n\n    printf(\"Thread begins running.\\n\");\n\n    for(i = 0; i &lt; *(int *)arg; i++)\n    {\n        printf(\"Hello world.\\n\");\n        sleep(1);\n    }\n\n    return NULL;\n}\n</code></pre> </li> <li> <p>version2.1</p> <pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid *thread_function1(void *arg);\nvoid *thread_function2(void *arg);\n\nint main(int argc, char *argv[])\n{\n    pthread_t pthread1, pthread2;\n    int ret;\n//    int count = 4;\n\n    ret = pthread_create(&amp;pthread1, NULL, thread_function1, NULL);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n   ret =  pthread_create(&amp;pthread2, NULL, thread_function2, NULL);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n    pthread_join(pthread1, NULL);\n    pthread_join(pthread2, NULL);\n    printf(\"The thread is over, the process is over too\\n\");\n\n\n    return 0;\n}\n\nvoid *thread_function1(void *arg)\n{\n    printf(\"Thread1 begins running.\\n\");\n\n    while(1)\n    {\n        printf(\"Hello world.\\n\");\n        sleep(1);\n    }\n\n    return NULL;\n}\n\nvoid *thread_function2(void *arg)\n{\n    printf(\"Thread2 begins running.\\n\");\n\n    while(1)\n    {\n        printf(\"Good morning.\\n\");\n        sleep(1);\n    }\n\n    return NULL;\n}\n</code></pre> </li> <li> <p>version2.2</p> <pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid *thread_function1(void *arg);\nvoid *thread_function2(void *arg);\n\nint count = 0;\n\nint main(int argc, char *argv[])\n{\n    pthread_t pthread1, pthread2;\n    int ret;\n//    int count = 4;\n\n    ret = pthread_create(&amp;pthread1, NULL, thread_function1, NULL);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n   ret =  pthread_create(&amp;pthread2, NULL, thread_function2, NULL);\n    if(ret != 0)\n    {\n        perror(\"pthread_create()\");\n        exit(1);\n    }\n\n    pthread_join(pthread1, NULL);\n    pthread_join(pthread2, NULL);\n    printf(\"The thread is over, the process is over too\\n\");\n\n\n    return 0;\n}\n\nvoid *thread_function1(void *arg)\n{\n    printf(\"Thread1 begins running.\\n\");\n\n    while(1)\n    {\n        printf(\"Hello world. Thread1 count = %d\\n\", count++);\n        sleep(1);\n    }\n\n    return NULL;\n}\n\nvoid *thread_function2(void *arg)\n{\n    printf(\"Thread2 begins running.\\n\");\n\n    while(1)\n    {\n        printf(\"Good morning. Thread2 count = %d\\n\", count++);\n        sleep(1);\n    }\n\n    return NULL;\n}\n</code></pre> <p>\u548c\u8fdb\u7a0b\u4e0d\u4e00\u6837\u5594\uff01\u4e5f\u7b26\u5408\u7406\u8bba\uff0c\u4e5f\u5c31\u662f\u5171\u4eab\u8fdb\u7a0b\u8d44\u6e90\uff0c\u90a3\u4e2a\u5168\u5c40\u53d8\u91cf\u3002\u8fdb\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u770b\u5230\u4e92\u76f8\u7684count\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u7ebf\u7a0b\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u66f4\u52a0\u65b9\u4fbf\uff0c\u4e0d\u50cf\u8fdb\u7a0b\u90a3\u4e48\u590d\u6742\u3002</p> <p>\u8fdb\u7a0b\u901a\u4fe1\u8981\u6bd4\u7ebf\u7a0b\u901a\u4fe1\u8981\u96be\u5f97\u591a\u3002</p> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#ipc","title":"\u8fdb\u7a0b\u95f4\u901a\u4fe1 \uff08IPC\uff09","text":"<ul> <li> <p>\u4efb\u52a1\u95f4\u7684\u901a\u4fe1\uff1a</p> <ul> <li>\u7ba1\u9053\uff1a\u6709\u540d~\u3001 \u65e0\u540d~</li> <li>\u5171\u4eab\u5185\u5b58</li> <li>\u6d88\u606f\u961f\u5217</li> </ul> </li> <li> <p>\u4efb\u52a1\u95f4\u540c\u6b65\uff1a</p> <ul> <li>\u4fe1\u53f7\u91cf\uff1a\u65e0\u540d~\u3001 \u6709\u540d~</li> </ul> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#unnamed-pipe","title":"\u65e0\u540d\u7ba1\u9053\uff08unnamed pipe\uff09","text":"<p>\u7ba1\u9053\u53cc\u5411\u7684</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#pipe","title":"pipe()","text":"<p>\u6709\u4e00\u7aef\u8bfb\uff0c\u6709\u4e00\u7aef\u5199</p> <p>\uff08\u5b9e\u73b0\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\uff1a\u7236\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u5404\u6709\u4e00\u6bb5\u5f00\u8bfb\u5199\uff0c\u7236\u8fdb\u7a0b\u5f00\u5199\u7aef\uff0c\u5b50\u8fdb\u7a0b\u5f00\u8bfb\u7aef\uff09</p> <p>\u7528\u54ea\u8fb9\uff0c\u5f00\u54ea\u8fb9\uff08\u53c2\u6570\u6570\u7ec4\u7684\u4e24\u4e2a\u503c\uff09</p> <p></p> <ul> <li> <p>version1</p> <pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n\n/*\n *\n * parent process: write pipe  &lt; == &gt; like operate with file\n * child process: read pipe\n *\n * */\nint main(void)\n{\n    int fd[2];\n    pid_t pid;\n\n    if(pipe(fd) == -1)\n    {\n        perror(\"pipe\");\n    }\n\n    pid = fork();\n    if(pid &gt; 0)     //parent\n    {\n        close(fd[0]);\n        sleep(5);\n        write(fd[1], \"ab\", 2);\n    }else if(pid == 0)\n    {\n        char ch[2];\n\n        printf(\"child process is waitint for the data from parent process: \\n\");\n        close(fd[1]);\n        /* if no data buffer.... */\n        read(fd[0], ch, 2);\n        printf(\"Read from pipe: %s\\n\", ch);\n    }\n\n\n    return 0;;\n}\n</code></pre> <p>\u90a3\u7ba1\u9053\u7684\u5927\u5c0f\u5462</p> </li> <li> <p>version2</p> <p>\u7ba1\u9053\u5bb9\u91cf\u7a76\u7adf\u6709\u591a\u5927 65536\u4e2a\u5b57\u828264KB</p> <pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n\n\nint main(void)\n{\n    int fd[2];\n    pid_t pid;\n\n    if(pipe(fd) == -1)\n    {\n        perror(\"pipe\");\n    }\n\n    pid = fork();\n    if(pid &gt; 0)     //parent process: wait until child process is over.\n    {\n        waitpid(pid, NULL, 0);\n\n    }else if(pid == 0)      //child process: write to the pipe.\n    {\n        char ch = '*';\n        int n = 0;\n        close(fd[0]);\n\n        while(1)\n        {\n            write(fd[1], &amp;ch, 1);\n            printf(\"write count: %d\\n\", n++);\n        }\n    }\n\n    return 0;;\n}\n</code></pre> </li> <li> <p>version3</p> <pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n\nint main(void)\n{\n    int fd[2];\n    pid_t pid;\n\n    if(pipe(fd) == -1)\n    {\n        perror(\"pipe\");\n    }\n\n    pid = fork();\n    if(pid &gt; 0)     //parent process: read from child process\n    {\n        char temp[100];\n        close(fd[1]);\n\n        while(1)\n        {\n            printf(\"Parent is waiting from the child.\\n\");\n            read(fd[0], temp, sizeof(temp));  \n            printf(\"Read from pipe: %s\\n\\n\", temp);\n        }\n\n    }else if(pid == 0)      //child process: write to the pipe.\n    {\n        char tmp[100];\n\n        close(fd[0]);\n\n        while(1)\n        {\n            scanf(\"%s\", tmp);\n            write(fd[1], tmp, sizeof(tmp));\n\n        }\n    }\n\n\n    return 0;;\n}\n</code></pre> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#named-pipe","title":"\u6709\u540d\u7ba1\u9053\uff08named pipe\uff09","text":"<p>\u6709\u540d\u7ba1\u9053\uff08Named pipe\uff0c\u4e5f\u79f0\u4e3aFIFO\uff09\u548c\u65e0\u540d\u7ba1\u9053\uff08Anonymous pipe\uff09\u662f\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u7ba1\u9053\uff0c\u5b83\u4eec\u5728\u4f7f\u7528\u65b9\u5f0f\u548c\u7279\u6027\u4e0a\u6709\u4e00\u4e9b\u533a\u522b\u3002</p> <ol> <li>\u6709\u540d\u7ba1\u9053\uff1a</li> <li>\u6709\u540d\u7ba1\u9053\u662f\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u8def\u5f84\u540d\u6765\u547d\u540d\u7684\uff0c\u5b83\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u8282\u70b9\u3002</li> <li>\u6709\u540d\u7ba1\u9053\u53ef\u4ee5\u5728\u4e0d\u76f8\u5173\u7684\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\uff0c\u53ea\u8981\u5b83\u4eec\u77e5\u9053\u6709\u540d\u7ba1\u9053\u7684\u8def\u5f84\u540d\u3002</li> <li>\u6709\u540d\u7ba1\u9053\u53ef\u4ee5\u6301\u4e45\u5b58\u5728\uff0c\u5373\u4f7f\u521b\u5efa\u5b83\u7684\u8fdb\u7a0b\u7ed3\u675f\uff0c\u6709\u540d\u7ba1\u9053\u4ecd\u7136\u5b58\u5728\uff0c\u76f4\u5230\u663e\u5f0f\u5220\u9664\u3002</li> <li> <p>\u6709\u540d\u7ba1\u9053\u53ef\u4ee5\u901a\u8fc7<code>mkfifo</code>\u51fd\u6570\u6765\u521b\u5efa\u3002</p> </li> <li> <p>\u65e0\u540d\u7ba1\u9053\uff1a</p> </li> <li>\u65e0\u540d\u7ba1\u9053\u662f\u4e00\u79cd\u533f\u540d\u7684\u7ba1\u9053\uff0c\u6ca1\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u540d\u3002</li> <li>\u65e0\u540d\u7ba1\u9053\u901a\u5e38\u7528\u4e8e\u76f8\u5173\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5982\u7236\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u3002</li> <li>\u65e0\u540d\u7ba1\u9053\u662f\u4e34\u65f6\u7684\uff0c\u53ea\u5728\u521b\u5efa\u5b83\u4eec\u7684\u8fdb\u7a0b\u53ca\u5176\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u6709\u6548\uff0c\u8fdb\u7a0b\u7ed3\u675f\u65f6\u7ba1\u9053\u4e5f\u4f1a\u88ab\u9500\u6bc1\u3002</li> <li>\u65e0\u540d\u7ba1\u9053\u901a\u5e38\u901a\u8fc7<code>pipe</code>\u51fd\u6570\u6765\u521b\u5efa\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c\u6709\u540d\u7ba1\u9053\u9002\u7528\u4e8e\u4e0d\u76f8\u5173\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5e76\u4e14\u53ef\u4ee5\u6301\u4e45\u5b58\u5728\uff1b\u800c\u65e0\u540d\u7ba1\u9053\u9002\u7528\u4e8e\u76f8\u5173\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u662f\u4e34\u65f6\u7684\u3002\u6839\u636e\u5177\u4f53\u7684\u901a\u4fe1\u9700\u6c42\u548c\u751f\u5b58\u5468\u671f\uff0c\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528\u6709\u540d\u7ba1\u9053\u6216\u65e0\u540d\u7ba1\u9053\u3002</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#mkfifo","title":"mkfifo()","text":"<pre><code>// read.c \n// gcc read.c -o read\n// usage: ./read\n\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;fcntl.h&gt;\n\nint main(void)\n{\n    int ret;\n    int fd;\n    char buf[100];\n\n    ret = mkfifo(\"my_fifo\", 0666); \n    if(ret != 0)\n    {\n        perror(\"mkfifo\");\n    }\n\n    printf(\"Prepare reading from named pipe:\\n\");\n\n    fd = open(\"my_fifo\", O_RDWR);\n\n    if(fd == -1)\n    {\n        perror(\"open\");\n    }\n\n    while(1)\n    {\n        memset(buf, '\\0', sizeof(buf));\n        read(fd, buf, sizeof(buf));\n        printf(\"Read from named pipe: %s\\n\", buf);\n        sleep(1);\n    }\n\n\n    return 0;\n}\n</code></pre> <pre><code>// write.c \n// gcc write.c -o write\n// usage: ./write hello\n// maybe need root\n\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;fcntl.h&gt;\n\nint main(int argc, char *argv[])\n{\n    int fd;\n    char buf[100];\n\n    fd = open(\"my_fifo\", O_WRONLY);\n    if(fd == -1)\n    {\n        perror(\"open\");\n    }\n\n    if(argc == 1)\n    {\n        printf(\"please send something to the named pipe: \\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    strcpy(buf, argv[1]);\n    write(fd, buf, sizeof(buf));\n    printf(\"Write to the pipe: %s\\n\", buf);\n\n\n    return 0;\n}\n</code></pre> <p>\u8fd9\u91cc\u5728\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u8fd9\u4e00\u53e5<code>printf(\"Read from named pipe: %s\\n\", buf);</code>\u5f15\u53d1\u4e86\u4e00\u4e9b\u95ee\u9898\u3002</p> <p>\u5728\u6211\u52a0\u4e86<code>\\n</code>\u4e4b\u524d\uff0c\u4e00\u76f4\u8bfb\u53d6\u4e0d\u5230\u6765\u81ea\u7ba1\u9053\u53e6\u4e00\u7aef\u7684\u6570\u636e\uff0c\u4e00\u76f4\u5361\u6b7b\uff1b\u52a0\u4e86\u4e4b\u540e\u624d\u80fd\u8bfb\u53d6\u5230\u3002</p> <p>\u5b9e\u9645\u4e0a\u8fd9\u548c <code>printf</code> \u5b9e\u73b0\u6709\u5173\uff1a</p> <p><code>printf</code> \u662f\u4e00\u4e2a\u884c\u7f13\u51b2\u51fd\u6570\uff0c\u5148\u5199\u5230\u7f13\u51b2\u533a\uff0c\u6ee1\u8db3\u6761\u4ef6\u540e(\u539f\u5219\u4e0a\u7f13\u51b2\u533a\u6ee1\u4e86\u624d\u5199\u51fa\u6210\u4e3a\u6807\u51c6\u8f93\u51fa\u6d41)\uff0c\u624d\u5c06\u7f13\u51b2\u533a\u5237\u5230\u5bf9\u5e94\u6587\u4ef6\u4e2d\u3002</p> <p>\u5373\uff1a<code>printf</code> \u7684\u5185\u5bb9\u653e\u5728\u7f13\u51b2\u533a\u91cc\u9762\u8fd8\u6ca1\u6709\u5237\u51fa\u6765\uff0c\u539f\u5219\u4e0a\u662f\u7f13\u51b2\u533a\u6ee1\u4e86\u4ee5\u540e\u624d\u8f93\u51fa\u3002</p> <p>\u51b2\u5237\u7f13\u51b2\u533a\u7684\u6761\u4ef6\uff1a</p> <ol> <li>\u7f13\u51b2\u533a\u586b\u6ee1</li> <li>\u5199\u5165\u7684\u5b57\u7b26\u4e2d\u6709\"\\n\" \"\\r\"</li> <li>\u8c03\u7528 <code>fflush</code> \u624b\u52a8\u5237\u65b0\u7f13\u51b2\u533a <code>fflush(stdout)</code></li> <li>\u8c03\u7528 <code>scanf</code> \u8981\u4ece\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4e5f\u4f1a\u5c06\u7f13\u51b2\u533a\u5185\u7684\u6570\u636e\u5237\u65b0</li> </ol> <p>\u6267\u884c <code>printf</code> \u7684\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u7ed3\u675f\u540e\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528 <code>fflush</code> \u5237\u65b0\u7f13\u51b2\u533a\u3002 \u7f13\u51b2\u533a\u5927\u5c0f1024\u5b57\u8282\u3002</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_3","title":"\u5171\u4eab\u5185\u5b58","text":"<p>\u8fd9\u91cc\u8fd8\u5206 System V IPC \u548c POSIX IPC</p> <p>\u53ef\u4ee5\u4e86\u89e3\u4e00\u4e0b\u8fd9\u4e8c\u8005</p> <p>\u4e0b\u9762\u4e3b\u8981\u662f System V IPC </p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_4","title":"\u7b80\u8ff0","text":"<ul> <li> <p>\u65e9\u671f\u7684\u5171\u4eab\u5185\u5b58\uff0c\u7740\u91cd\u4e8e\u5f3a\u8c03\u628a\u540c\u4e00\u7247\u5185\u5b58\uff0cmap\u5230\u591a\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff08\u5728\u76f8\u5e94\u8fdb\u7a0b\u627e\u5230\u4e00\u4e2aVMA\u533a\u57df\uff09\uff0c\u4ee5\u4fbf\u4e8eCPU\u53ef\u4ee5\u5728\u5404\u4e2a\u8fdb\u7a0b\u8bbf\u95ee\u5230\u8fd9\u7247\u5185\u5b58\u3002\u4e0d\u540c\u8fdb\u7a0b\u5bf9\u6620\u5c04\u5230\u672c\u8fdb\u7a0b\u7684\u5185\u5b58\u8fdb\u884c\u5199\u8bfb\u64cd\u4f5c\uff0c\u76f8\u5f53\u4e8e\u5404\u4e2a\u8fdb\u7a0b\u5bf9\u4e8e\u540c\u4e00\u7247\u5730\u5740\u7a7a\u95f4\u8fdb\u884c\u64cd\u4f5c</p> </li> <li> <p>\u73b0\u9636\u6bb5\u5e7f\u6cdb\u5e94\u7528\u4e8e\u591a\u5a92\u4f53\u3001Graphics\u9886\u57df\u7684\u5171\u4eab\u5185\u5b58\u65b9\u5f0f\uff0c\u67d0\u79cd\u610f\u4e49\u4e0a\u4e0d\u518d\u5f3a\u8c03\u6620\u5c04\u5230\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u6982\u5ff5\uff08\u90a3\u65e0\u975e\u662f\u4e3a\u4e86\u8ba9CPU\u8bbf\u95ee\uff09\uff0c\u800c\u66f4\u5f3a\u8c03\u4ee5\u67d0\u79cd\u201c\u53e5\u67c4\u201d\u7684\u5f62\u5f0f\uff0c\u8ba9\u5927\u5bb6\u77e5\u9053\u67d0\u4e00\u7247\u89c6\u9891\u3001\u56fe\u5f62\u56fe\u50cf\u6570\u636e\u7684\u5b58\u5728\u5e76\u53ef\u4ee5\u501f\u52a9\u6b64 \u201c\u53e5\u67c4\u201d \u6765\u8de8\u8fdb\u7a0b\u5f15\u7528\u8fd9\u7247\u5185\u5b58\uff0c\u8ba9\u89c6\u9891 encoder\u3001decoder\u3001GPU \u7b49\u53ef\u4ee5\u8de8\u8fdb\u7a0b\u8bbf\u95ee\u5185\u5b58\u3002</p> <p>\u6240\u4ee5\u4e0d\u540c\u8fdb\u7a0b\u7528\u7684\u52a0\u901f\u786c\u4ef6\u5176\u5b9e\u662f\u4e0d\u540c\u7684\uff0c\u4ed6\u4eec\u66f4\u5728\u4e4e\u7684\u662f\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a handle \u62ff\u5230\u8fd9\u7247\u5185\u5b58\uff0c\u800c\u4e0d\u518d\u7279\u522b\u5728\u4e4e CPU \u8bbf\u95ee\u5b83\u7684\u865a\u62df\u5730\u5740\uff08\u5f53\u7136\u4ecd\u7136\u53ef\u4ee5\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4f9b CPU \u8bbf\u95ee\uff09\u3002</p> </li> </ul> <p></p> <p>\u4f7f\u7528\u8fc7\u7a0b\uff1a\u521b\u5efa\u6620\u5c04\uff0c\u5efa\u7acb\u6620\u5c04\uff0c\u89e3\u9664\u6620\u5c04\uff0c\u5220\u9664\u6620\u5c04</p> <p>\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u65b9\u5f0f\uff08\u4e00\uff09\uff1a\u5171\u4eab\u5185\u5b58 - \u77e5\u4e4e (zhihu.com)</p> <p>\u8fdb\u9636\uff1a\u5b8b\u5b9d\u534e\uff1a\u4e16\u4e0a\u6700\u597d\u7684\u5171\u4eab\u5185\u5b58(Linux\u5171\u4eab\u5185\u5b58\u6700\u900f\u5f7b\u7684\u4e00\u7bc7)-\u817e\u8baf\u4e91\u5f00\u53d1\u8005\u793e\u533a-\u817e\u8baf\u4e91 (tencent.com)</p> <p>\u5173\u4e8e\u6587\u4ef6\u6807\u8bc6\u7b26\u548c key \u503c</p> <p>\u5e94\u7528\u5c42\u4e2d\uff1a\u7528\u5171\u4eab\u5185\u5b58\u8868\u793a\u7b26\uff08\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6807\u5fd7\uff09identifier</p> <p>\u800c\u5185\u6838\u5c42\u4e2d\uff0c\u5b9e\u9645\u7528\u952e\u503c\u6765\u6807\u8bc6\u5171\u4eab\u5185\u5b58\u3002</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#shmget","title":"\u521b\u5efa/\u7ed1\u5b9a\u6620\u5c04: <code>shmget()</code>","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#shmat","title":"\u5efa\u7acb\u6620\u5c04: <code>shmat()</code>","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#shmdt","title":"\u89e3\u9664\u6620\u5c04: <code>shmdt()</code>","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#shmctl","title":"\u5220\u9664\u6620\u5c04: <code>shmctl()</code>","text":"<p>\u5e76\u6ca1\u6709\u7279\u522b\u5b9e\u73b0\u67d0\u4e2a\u6620\u5c04\uff0c\u901a\u8fc7\u8fd9\u4e2a\u63a7\u5236\u51fd\u6570\u6765\u5220\u9664\u3002\u81ea\u884c\u7814\u7a76</p> <p></p> <ul> <li> <p>version1\uff1a\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nchar msg[] = \"hello world!\";\n\nint main(void)\n{\n    int shmid;\n    pid_t pid;\n\n    // Allocte the shared memory.\n    shmid = shmget(IPC_PRIVATE, 1024, IPC_CREAT);\n\n    pid = fork();\n\n    if(pid &gt; 0)\n    {\n        char *p_addr;\n\n        // map the shared memory to the parent process p_addr\n        p_addr = shmat(shmid, NULL, 0);\n\n        memset(p_addr, '\\0', sizeof(msg));\n        memcpy(p_addr, msg, sizeof(msg));\n\n        shmdt(p_addr);\n\n        waitpid(pid, NULL, 0);\n    }else if(pid == 0)\n    {\n        char *c_addr;\n\n        // map the shared memory to the Child process p_addr\n        c_addr = shmat(shmid, NULL, 0);\n\n        printf(\"Child process is waiting.\\n\");\n        sleep(3);\n\n        printf(\"Child process reads from shared memory: %s\\n\", c_addr);\n\n        shmdt(c_addr);\n    }else\n    {\n        perror(\"fork\");\n    }\n\n\n    return 0;\n}\n</code></pre> <p></p> <p>\u6ce8\u610f\u5bf9\u5171\u4eab\u5185\u5b58\u7684\u8bfb\u5199\u64cd\u4f5c\u9700\u8981root\u6743\u9650</p> </li> <li> <p>version2\uff1a\u975e\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58</p> <p>\u5173\u952e\u5728\u4e8e\u4f7f\u7528\u4e86\u76f8\u540c\u7684key\uff0c\u80fd\u8bbf\u95ee\u5230\u76f8\u540c\u7684\u503c</p> <ul> <li>\u5b8f\u5b9a\u4e49\u540c\u4e00\u4e2akey\u503c</li> <li><code>ftok()</code></li> </ul> <pre><code>// read.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\n#define MY_KEY 9527\n\nint main(void)\n{\n    char *c_addr;\n    int shmid;\n\n    // Allocte the shared memory.\n    shmid = shmget(MY_KEY, 1024, IPC_CREAT);\n    if(-1 == shmid)\n    {\n        perror(\"shmget\");\n        exit(EXIT_FAILURE);\n    }\n\n    c_addr = (char *)shmat(shmid, NULL, 0);\n\n    printf(\"Read from shared memory: %s\\n\",c_addr);\n    shmdt(c_addr);\n\n    return 0;\n}\n</code></pre> <pre><code>// write.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nchar msg[] = \"hello world!\";\n\n/* \n * Ensure the same key in different process.\n * If we use the IPC_PRIVATE, we will create new segement by kernel.\n *\n * Any other methods?\n * cmsg --&gt; Socket\n */\n#define MY_KEY 9527\n\nint main(void)\n{\n    char *p_addr;\n    int shmid;\n\n    // Allocte the shared memory.\n    shmid = shmget(MY_KEY, 1024, IPC_CREAT);\n    if(-1 == shmid)\n    {\n        perror(\"shmget\");\n        exit(EXIT_FAILURE);\n    }\n\n    p_addr = (char *)shmat(shmid, NULL, 0);\n\n    memset(p_addr, '\\0', sizeof(msg));\n    memcpy(p_addr, msg, sizeof(msg));\n\n    shmdt(p_addr);\n\n    // delete the shared memmory,\n//    shmctl(shmid, IPC_RMID, NULL);\n\n    return 0;\n}\n</code></pre> </li> </ul> <p><code>ftok()</code> \u51fd\u6570\u662f\u4e00\u4e2a\u7528\u4e8e\u751f\u6210 System V IPC\uff08Inter-Process Communication\uff0c\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff09\u952e\u7684\u51fd\u6570\u3002\u5728 System V IPC \u4e2d\uff0c\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u548c\u4fe1\u53f7\u91cf\u90fd\u9700\u8981\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff08\u952e\uff09\u6765\u8fdb\u884c\u64cd\u4f5c\u3002<code>ftok()</code> \u51fd\u6570\u53ef\u4ee5\u6839\u636e\u7ed9\u5b9a\u7684\u8def\u5f84\u540d\u548c\u9879\u76ee ID \u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u952e\u3002</p> <ul> <li> <p><code>ftok()</code> \u51fd\u6570\u7684\u539f\u578b</p> <pre><code>key_t ftok(const char *pathname, int proj_id);\n</code></pre> </li> <li> <p>\u53c2\u6570\u8bf4\u660e</p> <ul> <li><code>pathname</code>\uff1a\u4e00\u4e2a\u5b58\u5728\u7684\u6587\u4ef6\u8def\u5f84\u540d\uff0c\u7528\u4e8e\u751f\u6210\u552f\u4e00\u952e\u7684\u57fa\u7840\u3002</li> <li><code>proj_id</code>\uff1a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u7528\u4e8e\u751f\u6210\u552f\u4e00\u952e\u7684\u8fdb\u7a0b ID\u3002</li> <li>\u8fd4\u56de\u503c</li> <li>\u5982\u679c\u6210\u529f\uff0c<code>ftok()</code> \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u7531 <code>pathname</code> \u548c <code>proj_id</code> \u751f\u6210\u7684\u552f\u4e00\u952e\u3002</li> <li>\u5982\u679c\u5931\u8d25\uff0c\u8fd4\u56de -1\uff0c\u5e76\u8bbe\u7f6e <code>errno</code> \u9519\u8bef\u7801\u6765\u6307\u793a\u9519\u8bef\u539f\u56e0\u3002</li> </ul> </li> <li> <p>\u4f7f\u7528\u793a\u4f8b</p> <pre><code>#include &lt;sys/types.h&gt;\n#include &lt;sys/ipc.h&gt;\n                \nkey_t key = ftok(\"/tmp/myfile\", 'A');\nif (key == -1) {\n    perror(\"ftok\");\n    exit(EXIT_FAILURE);\n}\n</code></pre> <p>\u5728\u793a\u4f8b\u4e2d\uff0c<code>ftok()</code> \u51fd\u6570\u6839\u636e\u6587\u4ef6\u8def\u5f84 <code>\"/tmp/myfile\"</code> \u548c\u9879\u76ee ID 'A' \u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u952e\uff0c\u7528\u4e8e\u521b\u5efa\u6216\u8bbf\u95ee System V IPC \u5bf9\u8c61\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>ftok()</code> \u51fd\u6570\u7684\u751f\u6210\u952e\u7684\u65b9\u5f0f\u53ef\u80fd\u4e0d\u591f\u5b89\u5168\uff0c\u56e0\u4e3a\u5b83\u4f9d\u8d56\u4e8e\u6587\u4ef6\u8def\u5f84\u548c\u9879\u76ee ID\u3002\u5982\u679c\u591a\u4e2a\u8fdb\u7a0b\u4f7f\u7528\u76f8\u540c\u7684\u8def\u5f84\u548c\u9879\u76ee ID \u6765\u8c03\u7528 <code>ftok()</code>\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u952e\u51b2\u7a81\u3002\u56e0\u6b64\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u5efa\u8bae\u4f7f\u7528\u5176\u4ed6\u66f4\u5b89\u5168\u7684\u65b9\u5f0f\u6765\u751f\u6210\u552f\u4e00\u952e\uff0c\u6bd4\u5982\u4f7f\u7528 <code>IPC_PRIVATE</code> \u6216\u5176\u4ed6\u65b9\u6cd5\u6765\u907f\u514d\u952e\u51b2\u7a81\u3002</p> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_5","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u7c7b\u4f3c\u4e8e\u7ba1\u9053\uff0c\u53ea\u662f\u5c06\u6570\u636e\u653e\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u662f\u653e\u5230\u6570\u636e\u5bb9\u5668\u4e2d\uff0c\u672c\u8d28\u5c31\u662f\u7ed3\u6784\u4f53\u3002\u6ce8\u610f\u8fd9\u91cc\u961f\u5217\u548c\u6570\u636e\u7ed3\u6784\u90a3\u91cc\u7684\u961f\u5217\u4e0d\u4e00\u6837</p> <p>\u4ecd\u7136\u8bb2System V</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_6","title":"\u7b80\u8ff0","text":"<p>Linux \u4e0b\u7684\u6d88\u606f\u961f\u5217\u662f\u4e00\u79cd\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u673a\u5236\uff0c\u5141\u8bb8\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u901a\u8fc7\u5728\u6d88\u606f\u961f\u5217\u4e2d\u53d1\u9001\u548c\u63a5\u6536\u6d88\u606f\u6765\u8fdb\u884c\u901a\u4fe1\u3002\u6d88\u606f\u961f\u5217\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5f02\u6b65\u901a\u4fe1\uff0c\u53d1\u9001\u65b9\u5c06\u6d88\u606f\u53d1\u9001\u5230\u961f\u5217\u4e2d\uff0c\u63a5\u6536\u65b9\u4ece\u961f\u5217\u4e2d\u63a5\u6536\u6d88\u606f\u3002</p> <ul> <li> <p>\u5185\u90e8\u5de5\u4f5c\u539f\u7406</p> <p>\u6d88\u606f\u961f\u5217\u7684\u5185\u90e8\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a 1. \u521b\u5efa\u6d88\u606f\u961f\u5217\uff1a\u9996\u5148\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u901a\u8fc7\u8c03\u7528 <code>msgget()</code> \u7cfb\u7edf\u8c03\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u8be5\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u4e00\u4e2a\u552f\u4e00\u7684\u6d88\u606f\u961f\u5217\u6807\u8bc6\u7b26\u3002 2. \u53d1\u9001\u6d88\u606f\uff1a\u53d1\u9001\u65b9\u8fdb\u7a0b\u4f7f\u7528 <code>msgsnd()</code> \u7cfb\u7edf\u8c03\u7528\u5c06\u6d88\u606f\u53d1\u9001\u5230\u6d88\u606f\u961f\u5217\u4e2d\u3002\u6d88\u606f\u5305\u542b\u4e00\u4e2a\u6d88\u606f\u7c7b\u578b\u548c\u5b9e\u9645\u6570\u636e\u3002 3. \u63a5\u6536\u6d88\u606f\uff1a\u63a5\u6536\u65b9\u8fdb\u7a0b\u4f7f\u7528 <code>msgrcv()</code> \u7cfb\u7edf\u8c03\u7528\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u63a5\u6536\u6d88\u606f\u3002\u63a5\u6536\u65b9\u53ef\u4ee5\u9009\u62e9\u63a5\u6536\u7279\u5b9a\u7c7b\u578b\u7684\u6d88\u606f\uff0c\u4e5f\u53ef\u4ee5\u63a5\u6536\u961f\u5217\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d88\u606f\u3002 4. \u5220\u9664\u6d88\u606f\u961f\u5217\uff1a\u5f53\u4e0d\u518d\u9700\u8981\u6d88\u606f\u961f\u5217\u65f6\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u8c03\u7528 <code>msgctl()</code> \u7cfb\u7edf\u8c03\u7528\u6765\u5220\u9664\u6d88\u606f\u961f\u5217\u3002</p> </li> <li> <p>\u5b9e\u73b0\u7ec6\u8282</p> <p>\u6d88\u606f\u961f\u5217\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u5185\u6838\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ba1\u7406\u6d88\u606f\u961f\u5217\u7684\u5185\u5bb9\u3002\u5728 Linux \u4e2d\uff0c\u6d88\u606f\u961f\u5217\u7684\u5185\u90e8\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a - \u6d88\u606f\u961f\u5217\u63cf\u8ff0\u7b26\uff08Message Queue Descriptor\uff09\uff1a\u6bcf\u4e2a\u6d88\u606f\u961f\u5217\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u63cf\u8ff0\u7b26\uff0c\u7528\u4e8e\u6807\u8bc6\u8be5\u6d88\u606f\u961f\u5217\u3002 - \u6d88\u606f\u961f\u5217\u6570\u636e\u7ed3\u6784\uff1a\u5185\u6838\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u6d88\u606f\u961f\u5217\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u6d88\u606f\u7684\u6570\u91cf\u3001\u5927\u5c0f\u3001\u6d88\u606f\u7c7b\u578b\u7b49\u3002 - \u6d88\u606f\u7f13\u51b2\u533a\uff1a\u5b9e\u9645\u5b58\u50a8\u6d88\u606f\u7684\u5730\u65b9\uff0c\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u90fd\u5b58\u50a8\u5728\u8fd9\u4e9b\u7f13\u51b2\u533a\u4e2d\u3002 - \u6d88\u606f\u961f\u5217\u63a7\u5236\u5757\uff08Message Queue Control Block\uff09\uff1a\u7528\u4e8e\u7ba1\u7406\u6d88\u606f\u961f\u5217\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u6307\u5411\u6d88\u606f\u961f\u5217\u7684\u6307\u9488\u3001\u6d88\u606f\u961f\u5217\u7684\u72b6\u6001\u7b49\u4fe1\u606f\u3002</p> </li> </ul> <p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u6d88\u606f\u961f\u5217\u662f\u901a\u8fc7 System V IPC \u673a\u5236\u5b9e\u73b0\u7684\uff0c\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u5305\u62ec <code>msgget()</code>\u3001<code>msgsnd()</code>\u3001<code>msgrcv()</code> \u548c <code>msgctl()</code>\u3002\u8fd9\u4e9b\u7cfb\u7edf\u8c03\u7528\u901a\u8fc7\u64cd\u4f5c\u5185\u6838\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u521b\u5efa\u3001\u53d1\u9001\u3001\u63a5\u6536\u548c\u5220\u9664\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u6d88\u606f\u961f\u5217\u662f\u4e00\u79cd\u65b9\u4fbf\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u901a\u8fc7\u5185\u6838\u7ef4\u62a4\u7684\u6570\u636e\u7ed3\u6784\u548c\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u6d88\u606f\u7684\u53d1\u9001\u548c\u63a5\u6536\u3002</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#msgget","title":"<code>msgget()</code>","text":"<p>\u548c\u5171\u4eab\u5185\u5b58\u7684 <code>shmget()</code> \u5dee\u4e0d\u591a</p> <p></p> <p></p> <p><code>msgflag</code> \u8fd9\u79cd\u6807\u5fd7\uff0c\u4e0d\u77e5\u9053\u5199\u4ec0\u4e48\uff0c\u76f4\u63a5\u5199\u9ed8\u8ba4\u7684</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#msgsnd-msgrcv","title":"<code>msgsnd() msgrcv()</code>","text":"<p>\u53ef\u4ee5\u53d1\u9001\u4efb\u610f\u7c7b\u578b\u6570\u636e\uff0c\u56e0\u4e3a\u4ed6\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u91cc\u9762\u5957\u4ec0\u4e48\u90fd\u884c\uff0c\u518d\u5957\u4e2a\u7ed3\u6784\u4f53\u90fd\u53ef\u4ee5</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#msgctl","title":"<code>msgctl()</code>","text":"<p>\u7528\u4e8e\u5220\u9664</p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_7","title":"\u7ec3\u4e60","text":"<ul> <li> <p>version1</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/msg.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nstruct msgbuf\n{\n    long mtype;         /* message type. must be &gt;0 */\n    char mtext[100];      /* message data */\n    int number;\n};\n\n#define MY_TYPE 9527\n\nint main(void)\n{\n    pid_t pid;\n    int msgid;\n    struct msgbuf buf;\n\n    msgid = msgget(IPC_PRIVATE, IPC_CREAT);\n\n    pid = fork();\n    if(pid &gt; 0)\n    {\n        sleep(3);\n\n        buf.mtype = MY_TYPE;\n        printf(\"Please enter a string you want to send: \\n\");\n        fgets(buf.mtext, sizeof(buf.mtext), stdin);\n//        gets(buf.mtext);\n        printf(\"Please enter a number you want to senf: \\n\");\n        scanf(\"%d\", &amp;buf.number);\n\n        msgsnd(msgid, &amp;buf, sizeof(buf) - sizeof(buf.mtype), 0);\n\n        waitpid(pid, NULL, 0);\n    }else if(pid == 0)\n    {\n        printf(\"Child process is waiting for msg: \\n\");\n        // memset(buf, '\\0', )\n        /* The type of msg in child process must be matched with parent. */\n        msgrcv(msgid, &amp;buf, sizeof(buf) - sizeof(buf.mtype), MY_TYPE, 0);\n        printf(\"Child process read from msg: %s, %d\\n\", buf.mtext, buf.number);\n\n        msgctl(msgid, IPC_RMID, NULL);\n\n    }else\n    {\n        perror(\"fork\");\n    }\n\n\n    return 0;\n}\n</code></pre> </li> <li> <p>version2</p> <pre><code>//write.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/msg.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nstruct msgbuf\n{\n    long mtype;         /* message type. must be &gt;0 */\n    char mtext[100];      /* message data */\n    int number;\n};\n\n#define MY_TYPE 9527\n#define MY_KEY 6666\n\nint main(void)\n{\n    int msgid;\n    struct msgbuf buf;\n\n    msgid = msgget(MY_KEY, IPC_CREAT);\n\n    sleep(3);\n\n    buf.mtype = MY_TYPE;\n    printf(\"Please enter a string you want to send: \\n\");\n    fgets(buf.mtext, sizeof(buf.mtext), stdin);\n    printf(\"Please enter a number you want to senf: \\n\");\n    scanf(\"%d\", &amp;buf.number);\n\n    msgsnd(msgid, &amp;buf, sizeof(buf) - sizeof(buf.mtype), 0);\n\n\n    return 0;\n}\n</code></pre> <pre><code>// read.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;sys/msg.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nstruct msgbuf\n{\n    long mtype;         /* message type. must be &gt;0 */\n    char mtext[100];      /* message data */\n    int number;\n};\n\n#define MY_TYPE 9527\n#define MY_KEY 6666\n\n\nint main(void)\n{\n    int msgid;\n    struct msgbuf buf;\n\n    msgid = msgget(MY_KEY, IPC_CREAT);\n\n    printf(\"Child process is waiting for msg: \\n\");\n    /* The type of msg in child process must be matched with parent. */\n    msgrcv(msgid, &amp;buf, sizeof(buf) - sizeof(buf.mtype), MY_TYPE, 0);\n    printf(\"Child process read from msg: %s, %d\\n\", buf.mtext, buf.number);\n\n    msgctl(msgid, IPC_RMID, NULL);\n\n\n    return 0;\n}\n</code></pre> <p>\u7528 <code>ftok()</code></p> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_8","title":"\u4fe1\u53f7\u91cf","text":"<p>\u524d\u9762\u7684\u7ba1\u9053\u3001\u5171\u4eab\u5185\u5b58\u3001\u6d88\u606f\u961f\u5217\uff0c\u90fd\u662f\u4e00\u79cd\u4efb\u52a1\u95f4\u901a\u4fe1\u3001\u6570\u636e\u4f20\u8f93\u7684\u673a\u5236</p> <p>\u4e0b\u9762\u7684\u4fe1\u53f7\u91cf\uff0c\u5219\u662f\u4e00\u79cd\u4efb\u52a1\u4e4b\u95f4\u540c\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u540c\u6b65\uff0c\u6bcf\u4e00\u523b\uff0c\u4e00\u79cd\u8d44\u6e90\u53ea\u80fd\u7531\u4e00\u4e2a\u4efb\u52a1\u5360\u6709\u3002\u6bd4\u5982\u6709\u4e00\u4e2a\u73a9\u5177\uff0c\u5f88\u591a\u5c0f\u670b\u53cb\u90fd\u60f3\u73a9\uff1f</p> <p>---&gt; \u4efb\u52a1\u5728\u5171\u4eab\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u8c01\u5148\u8bbf\u95ee\uff0c\u4e0d\u5141\u8bb8\u8bbf\u95ee\uff1f</p> <p>\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u540c\u6b65\u6307\u7684\u662f\u534f\u8c03\u4e0d\u540c\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u4e4b\u95f4\u7684\u64cd\u4f5c\uff0c\u4f7f\u5b83\u4eec\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u6216\u65f6\u95f4\u8fdb\u884c\u6267\u884c\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u3002\u540c\u6b65\u64cd\u4f5c\u53ef\u4ee5\u786e\u4fdd\u5728\u5fc5\u8981\u65f6\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u4f1a\u7b49\u5f85\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u5b8c\u6210\u67d0\u4e2a\u64cd\u4f5c\u540e\u624d\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u4e3e\u4e2a\u5b9e\u9645\u4f8b\u5b50\u6765\u8bf4\u660e\u540c\u6b65\u7684\u6982\u5ff5\uff1a \u5047\u8bbe\u6709\u4e24\u4e2a\u7ebf\u7a0bA\u548cB\u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf<code>count</code>\uff0c\u7ebf\u7a0bA\u60f3\u8981\u589e\u52a0<code>count</code>\u7684\u503c\uff0c\u800c\u7ebf\u7a0bB\u60f3\u8981\u51cf\u5c11<code>count</code>\u7684\u503c\u3002\u5982\u679c\u6ca1\u6709\u540c\u6b65\u673a\u5236\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ol> <li>\u7ebf\u7a0bA\u8bfb\u53d6<code>count</code>\u7684\u503c\u4e3a5\u3002</li> <li>\u7ebf\u7a0bB\u8bfb\u53d6<code>count</code>\u7684\u503c\u4e5f\u4e3a5\u3002</li> <li>\u7ebf\u7a0bA\u589e\u52a0<code>count</code>\u7684\u503c\u4e3a6\u3002</li> <li>\u7ebf\u7a0bB\u51cf\u5c11<code>count</code>\u7684\u503c\u4e3a4\u3002</li> </ol> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6700\u7ec8\u7684<code>count</code>\u503c\u5e76\u4e0d\u7b26\u5408\u9884\u671f\uff0c\u56e0\u4e3a\u4e24\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u64cd\u4f5c\u6ca1\u6709\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u8fdb\u884c\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u540c\u6b65\u64cd\u4f5c\u6765\u786e\u4fdd\u7ebf\u7a0bA\u548c\u7ebf\u7a0bB\u4e4b\u95f4\u7684\u64cd\u4f5c\u987a\u5e8f\u6b63\u786e\u3002</p> <p>\u4e3a\u4ec0\u4e48\u53eb\u505a\u201c\u540c\u6b65\u201d\u5462\uff1f\u201c\u540c\u6b65\u201d\u8fd9\u4e2a\u8bcd\u6e90\u4e8e\u5e0c\u814a\u8bed\u201csyn-\u201d\uff08\u5171\u540c\uff09\u548c\u201c <code>khronos</code>\u201d\uff08\u65f6\u95f4\uff09\uff0c\u610f\u601d\u662f\u201c\u5171\u540c\u7684\u65f6\u95f4\u201d\u3002\u5728\u8ba1\u7b97\u673a\u9886\u57df\uff0c\u540c\u6b65\u6307\u7684\u662f\u534f\u8c03\u4e0d\u540c\u64cd\u4f5c\u5728\u65f6\u95f4\u4e0a\u7684\u4e00\u81f4\u6027\uff0c\u786e\u4fdd\u5b83\u4eec\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u6216\u65f6\u95f4\u8fdb\u884c\u6267\u884c\uff0c\u4ee5\u8fbe\u5230\u6570\u636e\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u7684\u76ee\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u540c\u6b65\u64cd\u4f5c\u5728\u8ba1\u7b97\u673a\u9886\u57df\u4e2d\u88ab\u79f0\u4e3a\u201c\u540c\u6b65\u201d\uff0c\u662f\u4e3a\u4e86\u5f3a\u8c03\u4e0d\u540c\u64cd\u4f5c\u4e4b\u95f4\u7684\u534f\u8c03\u548c\u4e00\u81f4\u6027\uff0c\u786e\u4fdd\u5b83\u4eec\u5728\u201c\u5171\u540c\u7684\u65f6\u95f4\u201d\u5185\u6b63\u786e\u6267\u884c\u3002</p> <p>\u4fe1\u53f7\u91cf\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u7531\u5185\u6838\u7ef4\u62a4\u7684\u975e\u8d1f\u6574\u6570 &gt;= 0\u3002 semaphore</p> <p>\u901a\u8fc7\u52a0\u52a0\u51cf\u51cf\u3002</p> <p>\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u6743\u9650 </p>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_9","title":"\u7b80\u8ff0","text":"<p>\u5728 Linux \u4e0b\uff0c\u4fe1\u53f7\u91cf\u662f\u4e00\u79cd\u7528\u4e8e\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u540c\u6b65\u548c\u4e92\u65a5\u7684 System V IPC \u673a\u5236\u3002\u4fe1\u53f7\u91cf\u7684\u5185\u90e8\u5de5\u4f5c\u539f\u7406\u6d89\u53ca\u5185\u6838\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u548c\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u5bf9\u4fe1\u53f7\u91cf\u7684\u64cd\u4f5c\u3002</p> <ul> <li> <p>\u5185\u90e8\u5de5\u4f5c\u539f\u7406</p> <ul> <li>System V\uff1a<ol> <li>\u6570\u636e\u7ed3\u6784\uff1a\u5728 Linux \u5185\u6838\u4e2d\uff0c\u4fe1\u53f7\u91cf\u7684\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u5305\u62ec\u4fe1\u53f7\u91cf\u96c6\uff08Semaphore Set\uff09\u3001\u4fe1\u53f7\u91cf\uff08Semaphore\uff09\u3001\u4fe1\u53f7\u91cf\u961f\u5217\u7b49\u3002</li> <li>\u521d\u59cb\u5316\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7 <code>semget()</code> \u7cfb\u7edf\u8c03\u7528\u521b\u5efa\u4e00\u4e2a\u4fe1\u53f7\u91cf\u96c6\uff0c\u6307\u5b9a\u4fe1\u53f7\u91cf\u7684\u6570\u91cf\u548c\u6743\u9650\u7b49\u3002\u6bcf\u4e2a\u4fe1\u53f7\u91cf\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u3002</li> <li>\u64cd\u4f5c\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528 <code>semop()</code> \u7cfb\u7edf\u8c03\u7528\u5bf9\u4fe1\u53f7\u91cf\u8fdb\u884c\u64cd\u4f5c\uff0c\u5305\u62ec\u589e\u52a0\u3001\u51cf\u5c11\u4fe1\u53f7\u91cf\u7684\u503c\uff0c\u4ee5\u53ca\u7b49\u5f85\u4fe1\u53f7\u91cf\u8fbe\u5230\u67d0\u4e2a\u7279\u5b9a\u503c\u3002</li> <li>\u63a7\u5236\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528 <code>semctl()</code> \u7cfb\u7edf\u8c03\u7528\u6765\u63a7\u5236\u4fe1\u53f7\u91cf\uff0c\u6bd4\u5982\u83b7\u53d6\u4fe1\u53f7\u91cf\u7684\u503c\u3001\u8bbe\u7f6e\u4fe1\u53f7\u91cf\u7684\u503c\uff0c\u4ee5\u53ca\u5220\u9664\u4fe1\u53f7\u91cf\u7b49\u64cd\u4f5c\u3002</li> </ol> </li> <li>POSIX\uff1a<ol> <li>\u6570\u636e\u7ed3\u6784\uff1a\u5728 POSIX \u4e2d\uff0c\u4fe1\u53f7\u91cf\u7684\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u5305\u62ec\u4fe1\u53f7\u91cf\uff08semaphore\uff09\u4ee5\u53ca\u4e0e\u4fe1\u53f7\u91cf\u76f8\u5173\u7684\u5c5e\u6027\u7ed3\u6784\u4f53\uff08semun\uff09\u3002</li> <li>\u521d\u59cb\u5316\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7 <code>sem_init()</code> \u51fd\u6570\u521d\u59cb\u5316\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u6307\u5b9a\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u503c\u548c\u5171\u4eab\u6807\u5fd7\u7b49\u3002\u6bcf\u4e2a\u4fe1\u53f7\u91cf\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u3002</li> <li>\u64cd\u4f5c\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528 <code>sem_wait()</code> \u548c <code>sem_post()</code> \u51fd\u6570\u5bf9\u4fe1\u53f7\u91cf\u8fdb\u884c\u64cd\u4f5c\u3002<ol> <li><code>sem_wait()</code> \u7528\u4e8e\u51cf\u5c11\u4fe1\u53f7\u91cf\u7684\u503c\uff0c\u5982\u679c\u4fe1\u53f7\u91cf\u7684\u503c\u4e3a0\uff0c\u5219\u4f1a\u963b\u585e\u5f53\u524d\u8fdb\u7a0b\uff1b</li> <li><code>sem_post()</code> \u7528\u4e8e\u589e\u52a0\u4fe1\u53f7\u91cf\u7684\u503c\uff0c\u5524\u9192\u53ef\u80fd\u5728\u7b49\u5f85\u4fe1\u53f7\u91cf\u7684\u8fdb\u7a0b\u3002</li> </ol> </li> <li>\u63a7\u5236\uff1a\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528 <code>sem_getvalue()</code> \u51fd\u6570\u83b7\u53d6\u4fe1\u53f7\u91cf\u7684\u503c\uff0c<code>sem_destroy()</code> \u51fd\u6570\u9500\u6bc1\u4fe1\u53f7\u91cf\u3002</li> </ol> </li> </ul> </li> <li> <p>\u5185\u90e8\u6570\u636e\u7ed3\u6784</p> <p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u4fe1\u53f7\u91cf\u7684\u5185\u90e8\u6570\u636e\u7ed3\u6784\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u4fe1\u53f7\u91cf\u96c6\u63cf\u8ff0\u7b26\uff08Semaphore Set Descriptor\uff09\uff1a\u6bcf\u4e2a\u4fe1\u53f7\u91cf\u96c6\u90fd\u6709\u4e00\u4e2a\u63cf\u8ff0\u7b26\uff0c\u7528\u4e8e\u6807\u8bc6\u8be5\u4fe1\u53f7\u91cf\u96c6\u3002</li> <li>\u4fe1\u53f7\u91cf\u6570\u636e\u7ed3\u6784\uff1a\u5185\u6838\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u6bcf\u4e2a\u4fe1\u53f7\u91cf\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u5f53\u524d\u503c\u3001\u7b49\u5f85\u961f\u5217\u7b49\u3002</li> <li>\u4fe1\u53f7\u91cf\u961f\u5217\uff1a\u7528\u4e8e\u5b58\u50a8\u7b49\u5f85\u4fe1\u53f7\u91cf\u7684\u8fdb\u7a0b\u6216\u7ebf\u7a0b\uff0c\u5f53\u4fe1\u53f7\u91cf\u7684\u503c\u65e0\u6cd5\u6ee1\u8db3\u64cd\u4f5c\u65f6\uff0c\u8fdb\u7a0b\u4f1a\u88ab\u653e\u5165\u7b49\u5f85\u961f\u5217\u4e2d\u3002</li> <li>\u4fe1\u53f7\u91cf\u63a7\u5236\u5757\uff08Semaphore Control Block\uff09\uff1a\u7528\u4e8e\u7ba1\u7406\u4fe1\u53f7\u91cf\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u6307\u5411\u4fe1\u53f7\u91cf\u96c6\u7684\u6307\u9488\u3001\u4fe1\u53f7\u91cf\u7684\u72b6\u6001\u7b49\u4fe1\u606f\u3002</li> </ul> </li> <li> <p>\u5b9e\u73b0\u65b9\u5f0f</p> <p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u4fe1\u53f7\u91cf\u662f\u901a\u8fc7 System V IPC \u673a\u5236\u5b9e\u73b0\u7684\uff0c\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u5305\u62ec <code>semget()</code>\u3001<code>semop()</code>\u3001<code>semctl()</code> \u7b49\u3002\u8fd9\u4e9b\u7cfb\u7edf\u8c03\u7528\u901a\u8fc7\u64cd\u4f5c\u5185\u6838\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4fe1\u53f7\u91cf\u7684\u521b\u5efa\u3001\u64cd\u4f5c\u548c\u63a7\u5236\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u4fe1\u53f7\u91cf\u662f\u4e00\u79cd\u91cd\u8981\u7684\u8fdb\u7a0b\u95f4\u540c\u6b65\u548c\u4e92\u65a5\u673a\u5236\uff0c\u901a\u8fc7\u5185\u6838\u7ef4\u62a4\u7684\u6570\u636e\u7ed3\u6784\u548c\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u5bf9\u4fe1\u53f7\u91cf\u7684\u64cd\u4f5c\u3002\u901a\u8fc7\u9002\u5f53\u7684\u4f7f\u7528\u4fe1\u53f7\u91cf\uff0c\u53ef\u4ee5\u786e\u4fdd\u8fdb\u7a0b\u4e4b\u95f4\u7684\u534f\u4f5c\u548c\u8d44\u6e90\u7684\u5b89\u5168\u5171\u4eab\u3002</p> </li> <li> <p>\u547d\u540d\u4fe1\u53f7\u91cf</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;semaphore.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/mman.h&gt;\n\n// \u5199\u5b8c\u8fd9\u4e2a\uff0c\u53ef\u4ee5\u603b\u7ed3\u4e00\u4e0b\u5f00\u53d1linux\u7cfb\u7edf\u7f16\u7a0b\u7684\u5e38\u89c1\u6d41\u7a0b\u65b9\u6cd5\n// \u6bd4\u5982\u8bf4\u662f\u5f00\u53d1\u7684API\u63a5\u53e3\uff0c\u7528\u54ea\u4e9b\u53c2\u6570...  ---&gt; man man\n\nint main(void)\n{\n//    sem_t sem_id; //\u7b2c\u4e00\u6b21\u4f7f\u7528\u7684\n    pid_t pid;\n    sem_t *sem_id = NULL; // \u7b2c\u4e00\u6b21segementianl fault --&gt; \u6539\u7528mmap(). \u9700\u8981\u4f7f\u7528\u5171\u4eab\u5185\u5b58\n\n\n    sem_id = mmap(NULL, sizeof(sem_t), PROT_READ | PROT_WRITE, \n                  MAP_SHARED | MAP_ANONYMOUS, -1, 0);\n    if(sem_id == MAP_FAILED)\n    {\n        exit(EXIT_FAILURE);\n    }\n\n    sem_init(sem_id, 1, 0); \n\n    pid = fork();\n    if(pid &gt; 0)\n    {\n        while(1)\n        {\n            // \u7236\u5b50\u8fdb\u7a0b\u6240\u4f7f\u7528\u7684sem_id \u4e0d\u662f\u540c\u4e00\u4e2a. \u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u7a7a\u95f4\n            // so, must use the shared memory --&gt; mmap() or shmget()  \n            sem_wait(sem_id); \n            printf(\"This is parent process.\\n\");\n            sleep(1);\n        }\n    }else if(pid == 0)\n    {\n        while(1)\n        {\n            printf(\"This is child process.\\n\");\n            sleep(5);\n            sem_post(sem_id);\n        }\n    }\n</code></pre> </li> <li> <p>\u547d\u540d\u4fe1\u53f7\u91cf</p> <pre><code>// \u83b7\u53d6\u4fe1\u53f7\u91cf\u7684\n#include &lt;stdio.h&gt;\n#include &lt;semaphore.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/mman.h&gt;\n\n\nint main(void)\n{\n    sem_t *sem_fd;\n    int i = 0;\n\n    sem_fd = sem_open(\"NAMED_SEM\", O_CREAT, 666, 0);\n    if(sem_fd == SEM_FAILED)\n    {\n        exit(EXIT_FAILURE);\n    }\n\n    while(1) \n    {\n        sem_wait(sem_fd);\n        sleep(1);\n        printf(\"Process 1 i = %d\\n\", i++);\n    }\n\n    sem_close(sem_fd);\n    // sem_unlink(sem_fd);\n\n    return 0;\n}\n</code></pre> <pre><code>// \u589e\u52a0\u4fe1\u53f7\u91cf\n#include &lt;stdio.h&gt;\n#include &lt;semaphore.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/mman.h&gt;\n\n\nint main(void)\n{\n    sem_t *sem_fd;\n    int i = 0;\n\n    sem_fd = sem_open(\"NAMED_SEM\", O_CREAT, 666, 0);\n    if(sem_fd == SEM_FAILED)\n    {\n        exit(EXIT_FAILURE);\n    }\n\n    while(1)\n    {\n        printf(\"Process2 i = %d\\n\", i++);\n        sleep(1);\n        sem_post(sem_fd);\n    }\n    sem_close(sem_fd);\n\n    return 0;\n\n}\n</code></pre> </li> </ul>"},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_10","title":"\u624b\u518c","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_11","title":"\u7b80\u5355\u4f7f\u7528","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_12","title":"\u7ebf\u7a0b\u540c\u6b65","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_13","title":"\u4fe1\u53f7\u5904\u7406","text":""},{"location":"Linux/2.%20System%20Programming/2.%20Multi-process%20and%20threaded%20programming/example.html#_14","title":"\u591a\u8fdb\u7a0b/\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u578b","text":""},{"location":"Linux/Linux%20%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/bug.html","title":"Bug","text":""},{"location":"Linux/Linux%20%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/bug.html#_1","title":"\u6269\u5bb9","text":"<p>\u865a\u62df\u673a\u4e2d\u7684Ubuntu\u6269\u5bb9\u53ca\u91cd\u65b0\u5206\u533a\u65b9\u6cd5_\u865a\u62df\u673a\u91cd\u65b0\u5206\u914d\u78c1\u76d8\u7a7a\u95f4-CSDN\u535a\u5ba2</p>"},{"location":"Linux/Linux%20%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/bug.html#_2","title":"\u6e05\u7406\u78c1\u76d8","text":"<p>Ubuntu\u91ca\u653eVMware\u865a\u62df\u78c1\u76d8\u672a\u4f7f\u7528\u7a7a\u95f4 - \u77e5\u4e4e (zhihu.com)</p> <p>Vmware\u865a\u62df\u673a\u4f7f\u7528\u5e38\u89c1\u95ee\u9898_shrink disk is disabled for this virtual machine-CSDN\u535a\u5ba2</p>"},{"location":"Linux/Linux%20%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/bug.html#ubuntu2204software-updater","title":"Ubuntu22.04\u627e\u4e0d\u5230Software &amp; updater","text":"<p>\u66b4\u529b\u4e14\u6709\u6548\u7684\u64cd\u4f5c</p> <p>\u76f4\u63a5\u91cd\u88c5\u684c\u9762\u73af\u5883</p> <pre><code>sudo apt install --reinstall ubuntu-desktop\n</code></pre>"},{"location":"Linux/Over%20View/overview.html","title":"Overview","text":"<p>[\u5b9e\u5f55] linux training 02.01/02 - hardware_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u8f6f\u786c\u4ef6\u63a5\u53e3\uff1a</p> <p>\u5bf9\u4e8e\u786c\u4ef6\u6765\u8bf4\uff0c\u4e0a\u9762\u7684\u4e1c\u897f\u90fd\u662f\u4e00\u4e2a\u72b6\u6001\u673a\uff0c\u4ed6\u90fd\u4e0d\u77e5\u9053\u4e0a\u9762\u662fOS\u8fd8\u662f\u4ec0\u4e48\uff0c\uff08\u53cd\u6b63\u90fd\u662f\u7a0b\u5e8f\uff09\u3002</p> <p>\u6709\u70b9\u50cf\u56fe\u7075\u673a\u7684\u6a21\u578b</p> <p>statement\uff1a\u9648\u8ff0\u3002</p> <p>instruction\uff1a\u6307\u6325\u673a\u5668\u3002ISA\uff0c</p> <p>\u6709\u4e86ISA\u8fd9\u79cdAPI\u63a5\u53e3\uff0c\u6216\u8005\u8bf4\u53eb\u89c4\u8303\uff08\u8f6f\u4ef6\u548c\u786c\u4ef6\u7684\u63a5\u53e3\uff09\u3002\u786c\u4ef6\u968f\u4fbf\u5e72\uff0c\u8f6f\u4ef6\u4e5f\u968f\u4fbf\u5e72\u81ea\u5df1\u7684\uff0c\u5404\u81ea\u53d1\u6325\u6027\u80fd\u3002\u89e3\u8026\u4e86\uff01</p> <p>\u5e95\u5c42\u786c\u4ef6\u4e0d\u4e00\u6837\uff0c\u5404\u4e2a\u5382\u5bb6\u90fd\u6709\u81ea\u5df1\u7684\u8bbe\u8ba1\uff0c\u60f3\u4ec0\u4e48i5 i7\u7b49\u7b49</p> <p>\u8fd9\u5c31\u662f\u5fae\u67b6\u6784 <code>micro-architecture</code></p> <p>\u5fae\u67b6\u6784\u662fISA\u7684\u5b9e\u73b0\uff0c</p> <p>\u7f16\u7801\uff1f\u89e3\u6790\uff1fdecode</p> <p>\u6d41\u6c34\u7ebf\u7684\u51fa\u73b0\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff1f\u63d0\u5347\u6570\u636e\u541e\u5410\u91cf\uff0c\u6709\u5e76\u884c\u7684\u6548\u679c\uff1f\u6570\u5b57\u7535\u8def\u4e2d\u51fa\u73b0\u89e3\u51b3\u4ec0\u4e48\uff1f</p> <p>\u8ba1\u7b97\u673a\u91cc\u9762\uff0c\u4efb\u4f55\u4e00\u4e2a\u6280\u672f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\u7684\uff1f\u8fd9\u662f\u4e00\u79cd\u5b66\u4e60\u601d\u60f3\uff1f</p> <p>\u65f6\u95f4\u5e76\u884c\uff0c\u7a7a\u95f4\u5e76\u884c</p> <p>\u8ba1\u7b97\u673a\u4e2d\u7684\u6d41\u6c34\u7ebf\u548c\u5b9e\u9645\u751f\u6d3b\u4e2d\u7684\u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u9664\u4e86\u786c\u4ef6\uff09</p> <p>\u8981\u5f80\u56de\u53bb\u505a\uff1f----&gt; \u8df3\u8f6c\uff1f</p> <p>\u5de5\u5382\u4e2d\u7684\u6d41\u6c34\u7ebf\u4e00\u822c\u60c5\u51b5\u662f\u4e0d\u4f1a\u8df3\u8f6c\u7684\uff0c\u9664\u975e\u8fd9\u4e2a\u5668\u4ef6\u574f\u4e86\uff0c\u8981\u5012\u56de\u53bb\u4fee\uff0c\u5f53\u8ba9\u662f\u4f60\u81ea\u5df1\u7ba1\u7406\u7684\u3002</p> <p>\u6240\u4ee5\u8ba1\u7b97\u673a\u91cc\u9762\uff0c\u6700\u590d\u6742\u7684\u4e1c\u897f\uff0c\u662f\u4e0d\u662f\u63a7\u5236\u903b\u8f91\u5462\uff1f</p> <p>\u73b0\u5728\u7684\u6559\u80b2\uff0c\u90fd\u662f\u5f88\u6d45\u7684\u4e1c\u897f\uff0c\u5355\u70b9\u7684\u4e1c\u897f\u3002</p> <p>\u6211\u4eec\u9700\u8981\u901a\u8fc7\u5b8f\u89c2\u7684\u89c6\u89d2\u4e86\u89e3\u6574\u4e2a\u7cfb\u7edf\u7684\u8fd0\u4f5c\uff0c\u4e4b\u540e\u5c31\u80fd\u4e00\u6b65\u6b65\u4e86\u89e3\u5230\u5176\u4e2d\u6bcf\u4e00\u4e2a\u5668\u4ef6\u8d77\u5230\u7684\u4f5c\u7528\uff0c\u4e5f\u80fd\u660e\u767d\u4e3a\u4ec0\u4e48\u6709\u7684\u5668\u4ef6\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5173\u952e\u3002</p> <p>\u6bd4\u5982\u8bf4 <code>Multiplexer</code>\uff0c\u6ca1\u6709\u4ed6\uff0c\u8f93\u51651\u548c0\u5c31\u4f1a\u4e71\u4e32\uff0c\u7f3a\u5c11\u8fd9\u4e2a\u63a7\u5236\u5668\u4ef6\uff0c\u76f8\u5f53\u4e8e\u4ea4\u901a\u4e2d\uff0c\u6ca1\u6709\u7ea2\u7eff\u706f\u8fd9\u4e2a\u6982\u5ff5\uff0c\u8f66\u76f4\u63a5\u4e71\u5f00\uff0c\u793e\u4f1a\u4e0d\u5c31\u4e71\u5957\u4e86\uff1f\u540c\u7406\uff0cCPU\u5185\u90e8\u4e0d\u5c31\u4e71\u5957\u4e86\u3002</p> <p>Multiplexer  --&gt; C\u8bed\u8a00\u7684if\uff1f</p> <p>\u6240\u4ee5\uff0c\u5728\u5b66\u4e60\u5230\u6bcf\u4e00\u4e2a\u57fa\u7840\u7684\u4e1c\u897f\u7684\u65f6\u5019\uff0c\u628a\u4ed6\u4eec\u5f53\u4f5c\u79ef\u6728\u6765\u7528\uff0c\u90fd\u8981\u4ece\u590d\u6742\u7cfb\u7edf\u7684\u89d2\u5ea6\u6765\u4e86\u89e3\u4ed6\u7684\u4f5c\u7528\u3002</p> <p>\u6570\u7535\u548c\u8ba1\u7ec4\u91cc\u9762CPU\u6d41\u6c34\u7ebf\u91cd\u8981\u7684\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u8df3\u8f6c <code>branch</code></li> <li>\u4f9d\u8d56 <code>depend</code></li> </ol> <p>\u57fa\u4e8e\u4ec0\u4e48\u6837\u7684\u6761\u4ef6\uff0c\u4f9d\u8d56\uff0c\u6211\u9700\u8981\u4ea7\u751f <code>nop</code>\uff0c</p> <p>\u524d\u4e00\u6761write\u7684\u7ed3\u679c\uff0c\u4f1a\u88ab\u540e\u9762\u7684\u6307\u4ee4read\u3002</p> <p>\u8fd9\u5c31\u662f\u7ecf\u5178\u7684 <code>data hazard</code></p> <p>\u4e5f\u5c31\u662fread after write \uff08RAW\uff09</p> <p></p> <p><code>program order</code> \u6211\u5199\u7684\u7a0b\u5e8f\u987a\u5e8f</p> <p><code>execution order</code> \u7a0b\u5e8f\u5b9e\u9645\u6267\u884c\u7684\u987a\u5e8f</p> <p><code>Sequential order</code> \u6211\u4eec\u4eba\u7406\u89e3\u7684\u7a0b\u5e8f\u6267\u884c\u987a\u5e8f</p> <p>\u4e5f\u5c31\u662f\u5e26\u6765\u7684\u5e76\u884c\u6548\u679c</p> <p>---&gt; \u56fe\u7684\u5173\u7cfb</p> <p>\u4f9d\u8d56\u56fe\u3001\u6709\u5411\u65e0\u73af\u56fe\u3001\u8ba1\u7b97\u56fe\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u4e00\u8bb2\u7684\u90e8\u5206\uff0c\u5927\u6982\u5bf9\u786c\u4ef6\u6709\u4e00\u4e2a\u6bd4\u8f83\u6df1\u5165\u7684\u4e86\u89e3\u4e86\u3002</p> <p>\u6211\u9700\u8981\u63a2\u7d22\u7684\u7cbe\u795e\uff01\u591a\u95ee\u95ee\u4e3a\u4ec0\u4e48\uff0c\u79ef\u6781\u4e3b\u52a8\u4e00\u70b9\u3002</p> <p>\u5bf9\u81ea\u5df1\u6559\u80b2\u7684\u53cd\u601d\uff0c\u4e3a\u4ec0\u4e48\u5c0f\u65f6\u5019\u7684\u6211/\u5b69\u5b50\u90a3\u4e48\u4e3b\u52a8\u79ef\u6781\uff0c\u957f\u5927\u4e4b\u540e\u5c31\u4e0d\u4f1a\u4e86\uff1f</p> <p>\u5927\u5bb6\u793e\u4f1a\u5c31\u662f\u5bf9\u7684\u5417\uff1f</p> <p>\u5bf9\u8ba1\u7b97\u673a\u4e16\u754c\u7684\u63a2\u7d22\uff0c\u5c31\u662f\u9700\u8981\u8fd9\u79cd\u597d\u5947</p>"},{"location":"Todo%20List/todo.html","title":"Todo","text":""},{"location":"Todo%20List/todo.html#linux-mcu","title":"\u642d\u5efa Linux \u4e0b MCU \u5f00\u53d1\u73af\u5883","text":"<p>https://blog.csdn.net/ldl617/article/details/120307412</p>"},{"location":"Todo%20List/todo.html#linux-gd32stm32","title":"\u79fb\u690dLinux \u5230 GD32/STM32 \u4e0a","text":"<p>\u4e3b\u8981\u662f\u60f3\u4e3a\u534f\u4f1a\u7684 GD32 \u5f00\u53d1\u677f\u505a\u4e00\u4e9b\u6bd4\u8f83\u597d\u73a9\u7684\u4e1c\u897f\uff0c\u8fd8\u6709\u662f\u56e0\u4e3a\u770b\u4e86\u9605\u9a6c\u573a\u7684Linux\u9a71\u52a8\u7b2c\u4e00\u671f\u7684\u5185\u5bb9\uff0c\u53d1\u73b0\u53ef\u4ee5\u76f4\u63a5\u5c06Linux \u8dd1\u5728\u81ea\u5df1\u7684 MCU \u4e0a\uff01\uff01</p> <p>\u7559\u4e2a\u5751\u3002</p> <p>\u53ef\u4ee5\u53c2\u8003 b\u7ad9\u5168\u7f51\u9996\u53d1 \u7eaf\u624b\u5199 RISC-V CPU\u865a\u62df\u673a juicevm \u5728esp32 \u4e0a\u8fd0\u884clinux5.0</p> <p>\u6765\u4e86\u6765\u4e86\uff0c\u7528\u5355\u7247\u673a ESP32-S3 \u8dd1 RISC-V \u6a21\u62df\u5668\u8fd0\u884c Linux\uff0c\u8fd9\u6b21\u542f\u52a8\u53ea\u8981 8 \u79d2 | Architecting Life</p> <p>xhackerustc/uc-rv32ima: Run Linux on MCUs such as ESP32C3 with RISC-V emulator</p> <p>\u56e0\u4e3a GD32 \u4e0d\u5e26\u6709 MMU\uff0c\u6240\u4ee5\u600e\u4e48\u6a21\u62df\uff1f</p> <p>\u79fb\u690dLinux\u5230GD32\u8fd9\u7c7b\u6ca1\u6709MMU\uff08\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff09\u7684\u8bbe\u5907\u4e0a\uff0c\u901a\u5e38\u9700\u8981\u4f7f\u7528Linux\u7684Flat Memory Model\uff08\u5e73\u9762\u5185\u5b58\u6a21\u578b\uff09\u6216\u8005\u4f7f\u7528\u7279\u5b9a\u7684\u5185\u5b58\u7ba1\u7406\u6280\u672f\u6765\u6a21\u62dfMMU\u7684\u529f\u80fd\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u57fa\u672c\u6b65\u9aa4\u548c\u8003\u8651\u56e0\u7d20\uff1a</p> <ol> <li>\u9009\u62e9Linux\u5185\u6838\u7248\u672c\uff1a</li> <li> <p>\u9009\u62e9\u4e00\u4e2a\u652f\u6301RISC-V\u67b6\u6784\u4e14\u4e0d\u9700\u8981MMU\u7684Linux\u5185\u6838\u7248\u672c\u3002Linux 5.0\u7248\u672c\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u8d77\u70b9\uff0c\u56e0\u4e3a\u5b83\u5305\u542b\u4e86\u5bf9RISC-V\u7684\u652f\u6301\u3002</p> </li> <li> <p>\u914d\u7f6e\u5185\u6838\uff1a</p> </li> <li> <p>\u5728\u5185\u6838\u914d\u7f6e\u4e2d\uff0c\u9700\u8981\u7981\u7528\u6240\u6709\u4e0eMMU\u76f8\u5173\u7684\u9009\u9879\uff0c\u56e0\u4e3aGD32\u6ca1\u6709MMU\u3002\u8fd9\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1a</p> <ul> <li><code>CONFIG_MMU</code> \u5e94\u8be5\u88ab\u7981\u7528\u3002</li> <li>\u76f8\u5173\u7684\u5185\u5b58\u7ba1\u7406\u9009\u9879\u4e5f\u5e94\u8be5\u88ab\u7981\u7528\u6216\u914d\u7f6e\u4e3a\u9002\u5408\u5e73\u9762\u5185\u5b58\u6a21\u578b\u3002</li> </ul> </li> <li> <p>\u5185\u5b58\u5e03\u5c40\uff1a</p> </li> <li> <p>\u8bbe\u8ba1\u4e00\u4e2a\u9002\u5408GD32\u7684\u5185\u5b58\u5e03\u5c40\u3002\u5728\u6ca1\u6709MMU\u7684\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684\u4ee3\u7801\u3001\u6570\u636e\u548c\u5806\u6808\u901a\u5e38\u90fd\u4f4d\u4e8e\u4e00\u4e2a\u5355\u4e00\u7684\u8fde\u7eed\u7684\u5730\u5740\u7a7a\u95f4\u5185\u3002</p> </li> <li> <p>\u865a\u62df\u5185\u5b58\u6a21\u62df\uff1a</p> </li> <li> <p>\u5982\u679c\u9700\u8981\u4f7f\u7528\u865a\u62df\u5185\u5b58\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8f6f\u4ef6\u6a21\u62df\u7684\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u9875\u8868\u6765\u6a21\u62df\u865a\u62df\u5185\u5b58\uff0c\u4f46\u8fd9\u4f1a\u727a\u7272\u6027\u80fd\u3002</p> </li> <li> <p>\u9a71\u52a8\u7a0b\u5e8f\u548c\u786c\u4ef6\u652f\u6301\uff1a</p> </li> <li> <p>\u786e\u4fdd\u6240\u6709\u9700\u8981\u7684\u9a71\u52a8\u7a0b\u5e8f\u90fd\u53ef\u7528\uff0c\u5e76\u4e14\u5df2\u7ecf\u4e3aGD32\u8fdb\u884c\u4e86\u9002\u914d\u3002\u8fd9\u53ef\u80fd\u5305\u62ec\u4e32\u53e3\u3001\u7f51\u7edc\u3001\u5b58\u50a8\u7b49\u9a71\u52a8\u3002</p> </li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\uff1a</p> </li> <li> <p>\u9009\u62e9\u4e00\u4e2a\u9002\u5408\u5d4c\u5165\u5f0f\u8bbe\u5907\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5982FAT32\u3001ext4\u7b49\uff0c\u5e76\u786e\u4fdd\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u90fd\u5df2\u9488\u5bf9\u6ca1\u6709MMU\u7684\u73af\u5883\u8fdb\u884c\u4e86\u4f18\u5316\u3002</p> </li> <li> <p>\u8c03\u8bd5\u548c\u6d4b\u8bd5\uff1a</p> </li> <li> <p>\u4f7f\u7528JTAG\u6216\u5176\u5b83\u8c03\u8bd5\u5de5\u5177\u8fdb\u884c\u7cfb\u7edf\u7684\u8c03\u8bd5\u548c\u6d4b\u8bd5\u3002\u786e\u4fdd\u7cfb\u7edf\u7a33\u5b9a\u8fd0\u884c\uff0c\u5e76\u4e14\u6240\u6709\u529f\u80fd\u90fd\u6309\u9884\u671f\u5de5\u4f5c\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> </li> <li> <p>\u7531\u4e8e\u6ca1\u6709MMU\uff0c\u7cfb\u7edf\u7684\u6027\u80fd\u53ef\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u9700\u8981\u5bf9\u4ee3\u7801\u8fdb\u884c\u4f18\u5316\uff0c\u4ee5\u51cf\u5c11\u5185\u5b58\u788e\u7247\u548c\u63d0\u9ad8\u6548\u7387\u3002</p> </li> <li> <p>\u53c2\u8003\u9879\u76ee\uff1a</p> </li> <li> <p>\u53c2\u8003\u7c7b\u4f3c\u9879\u76ee\uff0c\u5982juicevm\u5728ESP32\u4e0a\u8fd0\u884cLinux\u7684\u6848\u4f8b\u3002\u867d\u7136ESP32\u548cGD32\u5728\u786c\u4ef6\u4e0a\u6709\u6240\u4e0d\u540c\uff0c\u4f46\u662f\u79fb\u690dLinux\u7684\u8fc7\u7a0b\u548c\u6311\u6218\u662f\u76f8\u4f3c\u7684\u3002</p> </li> <li> <p>\u793e\u533a\u548c\u6587\u6863\uff1a</p> <ul> <li>\u5229\u7528Linux\u793e\u533a\u548c\u76f8\u5173\u6587\u6863\uff0c\u5982Linux\u5185\u6838\u7684\u6587\u6863\u548c\u90ae\u4ef6\u5217\u8868\uff0c\u83b7\u53d6\u5e2e\u52a9\u548c\u6700\u4f73\u5b9e\u8df5\u3002</li> </ul> </li> </ol> <p>\u79fb\u690dLinux\u5230\u6ca1\u6709MMU\u7684\u8bbe\u5907\u662f\u4e00\u4e2a\u590d\u6742\u7684\u8fc7\u7a0b\uff0c\u9700\u8981\u5bf9\u5185\u6838\u6709\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u5e76\u4e14\u9700\u8981\u8010\u5fc3\u5730\u8c03\u8bd5\u548c\u4f18\u5316\u3002\u5982\u679c\u4f60\u4e0d\u719f\u6089\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u80fd\u9700\u8981\u82b1\u8d39\u4e00\u4e9b\u65f6\u95f4\u6765\u5b66\u4e60\u76f8\u5173\u7684\u77e5\u8bc6\uff0c\u6216\u8005\u5bfb\u6c42\u793e\u533a\u7684\u5e2e\u52a9\u3002</p> <p>\u6211\u8bb0\u5f97\u6709\u4e2a ucLinux\uff1f</p> <p>ucLinux \u5f00\u53d1\u7b80\u8ff0</p> <p>c - Possible to implement MMU functionality in software with GCC? - Stack Overflow</p> <p>\u8fd8\u8bb0\u5f97\u90a3\u4e2a\u674e\u8ff0\u94dc\u7684\u8bfe\u7a0b\u5417\uff1f\u5b9e\u9645\u4e0a\u662f\u6a21\u62df\u4e00\u5757 RISC-V MCU\uff1f</p> <p>Cortex-M MCU Emulation with Renode | Interrupt</p> <p>\u53d1\u73b0\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u4e1c\u897f\uff01\uff01</p> <p>johnnywei499/linux-for-microcontroller: A complete project that can run Linux-3.12.74 on a microcontroller, and the hardware development environment is easily accessible.</p>"},{"location":"Todo%20List/todo.html#2024127","title":"2024.12.7","text":"<p>\u5b8c\u6210\u4e86 NEMU \u521d\u6b65\u542f\u52a8 nommu-Linux \u540e\uff0c\u4e0b\u4e00\u6b65\u7684\u5b66\u4e60\u8ba1\u5212\u3002</p> <p>\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u90e8\u5206\uff1a</p> <ul> <li> <p>\u5f00\u59cb\u8865\u5145\u9879\u76ee</p> <ul> <li>OS \u5185\u6838\u53ca\u76f8\u5173\u5b50\u7cfb\u7edf\u8bbe\u8ba1\u53ca\u76f8\u5173\u529f\u80fd\uff08\u8fd9\u91cc\u5e94\u8be5\u5c06kernel \u548c system programing \u5206\u5f00\u7684\uff0c\u4f46\u4e4b\u540e\u518d\u8bf4\u5427\uff09<ul> <li>xv6 \u7684\u8bbe\u8ba1\u5b9e\u73b0</li> <li>jhbdream/armv8_os: a simple armv8 operating os for study</li> <li>rcore</li> <li>jyy lab</li> <li>\u5269\u4f59\u5c31\u662f \u5e02\u9762\u4e0a\u6210\u719f\u7684 OS\uff1aLinux\u3001FreeRTOS\u3001Zephyr...</li> </ul> </li> <li>\u786c\u4ef6/\u8f6f\u4ef6\u9879\u76ee\u5c3d\u91cf\u5168\u6253\u901a\uff0c\u5c3d\u91cf\u5e26\u9a71\u52a8</li> </ul> </li> <li> <p>\u5237\u8bfe</p> <p>\u5c3d\u91cf\u8865\u5145\u77e5\u8bc6\u9762</p> <ul> <li>jyy os</li> <li>\u9605\u7801\u573a\u8bfe\u7a0b</li> </ul> </li> <li> <p>\u53ef\u9009</p> <p>nemu \u6dfb\u52a0\u66f4\u591a\u5185\u5bb9</p> <ul> <li> <p>plic</p> </li> <li> <p>\u6a21\u62df\u5668\u6d6e\u70b9\u6269\u5c55</p> <p>\u53ef\u4ee5\u5bf9\u6bd4\u5b9e\u73b0 navy \u7684\u6d6e\u70b9\u5b9e\u73b0\uff08\u56fa\u5b9a\u70b9\u6570\uff09\u548c RV32F/D \u6269\u5c55\uff1f</p> </li> <li> <p>cache</p> <p>nemu \u7684memory \u8bbe\u8ba1\u662f\u600e\u4e48\u6837\u7684</p> <p>RISC-V Base Cache Management Operation ISA Extensions</p> <p>icspa-public-guide/ch/ch_pa-3-1_cache.md at master \u00b7 ics-nju-wl/icspa-public-guide</p> <p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840\u7efc\u5408\u5b9e\u8df5 NEMU PA3 | aa10n's blog</p> <p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840\u5b9e\u9a8c\u2014\u2014Cache\u7684\u6a21\u62df - \u7b80\u4e66</p> <p>NEMU PA3 \u5fc5\u505a\u4efb\u52a11\u53ca\u9009\u505a\u4efb\u52a11 \u5b9e\u9a8c\u601d\u8def\u5206\u4eab_nemupa3-CSDN\u535a\u5ba2</p> <p>[mmu/cache]-ARMV8-aarch64\u7684\u865a\u62df\u5185\u5b58(mmu/tlb/cache)\u4ecb\u7ecd-\u6982\u5ff5\u626b\u76f2 - \u54d4\u54e9\u54d4\u54e9</p> <p>\u5b9e\u5728\u4e0d\u884c\uff0c\u53ef\u4ee5\u653e\u5f03\u8fd9\u4e2a\uff0c\u505a\u4e00\u4e2acache\u6a21\u62df\u5668\u3002</p> <p>\u3010\u8ba1\u7ec4\u5b9e\u9a8c\u3011\u6784\u5efa32\u4f4dCache\u6a21\u62df\u5668(C\u8bed\u8a00) - \u77e5\u4e4e</p> <p>CSAPP | Lab5-Cache Lab \u6df1\u5165\u89e3\u6790 - \u77e5\u4e4e</p> <p>\u6216\u8bb8\u53ef\u4ee5\u505a\u5b8c CSAPP\u7684 cache \u540e\u5c06\u5176\u6dfb\u52a0\u8fdb nemu\uff1f</p> </li> <li> <p>\u6df1\u5165 MMU</p> <p>Lab 4: RISC-V \u865a\u62df\u5185\u5b58\u7ba1\u7406 - \u77e5\u4e4e</p> </li> <li> <p>\u7269\u7406\u5185\u5b58\u4fdd\u62a4 PMU</p> <p>RISC-V\u67b6\u6784\u2014\u2014\u7269\u7406\u5185\u5b58\u5c5e\u6027\u548c\u7269\u7406\u5185\u5b58\u4fdd\u62a4_riscv pma-CSDN\u535a\u5ba2</p> <p>\u6216\u8005\uff0c\u4e0d\u540c\u6a21\u5f0f\u4e0b\u8bbf\u95ee\u7684\u5bc4\u5b58\u5668\u6743\u9650</p> </li> <li> <p>\u591a\u6838\u7684\u6a21\u62df\u5668</p> <p>\u5148\u5165\u95e8\u591a\u6838\u5904\u7406\u5668</p> </li> </ul> </li> </ul>"},{"location":"Todo%20List/todo.html#-_8arm","title":"- \u4e13\u680f_8\u5c0f\u65f6\u5b66\u900fARM\u4f53\u7cfb\u67b6\u6784","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html","title":"Basic1","text":"<p>Questions</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#return-0return-exit_success","title":"return 0\u548creturn EXIT_SUCCESS","text":"<p>\u5148\u8bf4\u7ed3\u8bba, </p> <p>**\u5728main\u51fd\u6570\u4e2d, return (0)\u3001exit(EXIT_SUCCESS) \u548c exit(0) \u57fa\u672c\u4e0a \u662f\u7b49\u4ef7\u7684. **</p> <p></p> <ul> <li>\u8be6\u7ec6\u533a\u522b</li> </ul> <p>\u4e8b\u5b9e\u4e0a return \u548c\u76f4\u63a5\u8c03\u7528 exit \u7684\u6548\u679c\u5e76\u4e0d\u5b8c\u5168\u4e00\u6837\u3002\u5982\u679c\u4f7f\u7528 return\uff0c\u5219 main \u51fd\u6570\u7684\u6808\u5e27\u5c06\u56de\u6536\u5e76\u5931\u6548\u3002\u56e0\u6b64\uff0c\u6bd4\u5982\u8bf4\u5728 main \u51fd\u6570\u4e2d\u6709\u7c7b\u4f3c\u8fd9\u6837\u7684\u4ee3\u7801\uff1a</p> <pre><code>int\nmain(int argc, char **argv, char **envp)\n{\n    char *p;\n\n    /* ... */\n    p = malloc(PAGE_SIZE);\n    /* ... */\n</code></pre> <p>\u800c\u5728 return \u524d\uff0cp\u6ca1\u6709\u91ca\u653e\uff0c\u4e5f\u6ca1\u6709\u8d4b\u503c\u5230\u67d0\u4e2a\u9759\u6001\u53d8\u91cf\u4e0a\uff0c\u5219 \u6280\u672f\u4e0a \u8fd9\u5757\u5185\u5b58\u6cc4\u9732\u4e86\uff0c\u56e0\u4e3a\u4ece\u5df2\u77e5\u7684\u6240\u6709\u6808\u5e27\uff08\u6ce8\u610f\uff0creturn \u5bfc\u81f4\u4e86 main \u6808\u5e27\u7684\u5931\u6548\uff09\u53ca\u9759\u6001\u5206\u914d\u7684\u53d8\u91cf\u65e0\u6cd5\u518d\u5230\u8fbe\u8fd9\u5757\u5185\u5b58\u3002\u800c\u76f4\u63a5\u8c03\u7528 exit() \u65f6\uff0c\u5219\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u6b64\u65f6 main() \u51fd\u6570\u7684\u6808\u5e27\u4ecd\u7136\u662f\u6709\u6548\u7684\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5b9e\u8df5\u4e2d\u8fd9\u9879\u7ec6\u5fae\u7684\u5dee\u5f02\u5e76\u6ca1\u6709\u592a\u5927\u7684\u5f71\u54cd\uff0c\u56e0\u4e3a\u6700\u7ec8 exit() \u4f1a\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u7ed3\u675f\uff0c\u540e\u8005\u4f1a\u56de\u6536\u5c5e\u4e8e\u8fdb\u7a0b\u7684\u5168\u90e8\u5185\u5b58\u9875\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u7531\u4e8e main() \u7684\u6808\u5e27\u5df2\u7ecf\u56de\u6536\uff0c\u56e0\u6b64 return \u51cf\u5c11\u4e86\u6808\u7a7a\u95f4\u7684\u9700\u6c42\u3002</p> <p>\u6211\u4e2a\u4eba\u8ba4\u4e3a\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u5e94\u4f7f\u7528 return() \u6765\u7ed3\u675f main()\uff0c\u4f46\u5982\u679c main() \u4e2d\u5206\u914d\u4e86\u5185\u5b58\uff0c\u5219\u5e94\u4f7f\u7528 exit() \u7ed3\u675f\uff08\u4e00\u822c\u6765\u8bf4\uff0c\u9664\u975e\u662f\u591a\u6b21\u5206\u914d\u6216\u8005\u7cfb\u7edf\u7684\u5185\u5b58\u7a7a\u95f4\u975e\u5e38\u7d27\u5f20\uff0c\u5426\u5219 main()\uff0c\u7279\u522b\u662f\u77ed\u547d\u7a0b\u5e8f\u5982\u547d\u4ee4\u884c\u5de5\u5177\u7684 main() \u4e2d\u5206\u914d\u7684\u5185\u5b58\u4e0d\u5e94\u4f7f\u7528 free() \u91ca\u653e\uff09\u3002\u8fd9\u6837\u505a\u7684\u7406\u7531\u662f\u56e0\u4e3a\u524d\u9762\u6240\u8bf4\u7684\u6280\u672f\u6027\u5185\u5b58\u6cc4\u9732\u53ef\u80fd\u4f1a\u7ed9\u5185\u5b58\u6cc4\u9732\u68c0\u6d4b\u5668\u6216\u9759\u6001\u5206\u6790\u5de5\u5177\u5e26\u6765\u56f0\u6270\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#c-mainreturn-0return-exit_-success","title":"\u5728C\u8bed\u8a00\u4e2d, main()\u51fd\u6570\u4f7f\u7528return 0\u7ed3\u675f\u548c\u4f7f\u7528return EXIT_ SUCCESS\u7ed3\u675f\u7684\u533a\u522b?","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#switch-case","title":"\u5173\u4e8eswitch case\u7684\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_1","title":"\u5173\u4e8e\u6307\u9488\u521d\u6b65\u4f7f\u7528","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_2","title":"\u57fa\u7840\u4f7f\u7528","text":"<ol> <li>\u6570\u7ec4\u4e0e\u6307\u9488</li> </ol> <p>\u6307\u9488\u4e0e\u6570\u7ec4\u4e92\u6362, \u8bbf\u95ee\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u3002\u4f8b\u5982\uff1a</p> <pre><code>int arr[5] = {1, 2, 3, 4, 5};\nint *p = arr;  // \u5b9a\u4e49\u4e00\u4e2a\u6307\u5411 int \u7c7b\u578b\u6570\u7ec4\u7684\u6307\u9488\uff0c\u6307\u5411\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\nfor (int i = 0; i &lt; 5; i++) {\n    printf(\"%d \", *(p+i));  // \u901a\u8fc7\u6307\u9488\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>p</code> \u662f\u4e00\u4e2a\u6307\u5411 <code>int</code> \u7c7b\u578b\u6570\u7ec4\u7684\u6307\u9488\uff0c\u5b83\u88ab\u8d4b\u503c\u4e3a <code>arr</code>\uff0c\u5373\u6570\u7ec4\u7684\u9996\u5730\u5740\u3002\u901a\u8fc7 <code>*(p+i)</code> \u53ef\u4ee5\u8bbf\u95ee\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff0c\u5176\u4e2d <code>i</code> \u8868\u793a\u5143\u7d20\u7684\u4e0b\u6807\u3002</p> <ol> <li>\u7ed3\u6784\u4f53\u6307\u9488</li> </ol> <p>\u7ed3\u6784\u4f53\u6307\u9488\u662f\u6307\u5411\u7ed3\u6784\u4f53\u7684\u6307\u9488\u7c7b\u578b\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u8bbf\u95ee\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u3002\u4f8b\u5982\uff1a</p> <pre><code>struct Person {\n    char name[20];\n    int age;\n};\nstruct Person p = {\"Tom\", 20};\nstruct Person *ptr = &amp;p;  // \u5b9a\u4e49\u4e00\u4e2a\u6307\u5411\u7ed3\u6784\u4f53 Person \u7684\u6307\u9488\uff0c\u6307\u5411\u7ed3\u6784\u4f53\u53d8\u91cf p \u7684\u5730\u5740\nprintf(\"name: %s, age: %d\", ptr-&gt;name, ptr-&gt;age);  // \u901a\u8fc7\u6307\u9488\u8bbf\u95ee\u7ed3\u6784\u4f53\u6210\u5458\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>ptr</code> \u662f\u4e00\u4e2a\u6307\u5411\u7ed3\u6784\u4f53 <code>Person</code> \u7684\u6307\u9488\uff0c\u5b83\u88ab\u8d4b\u503c\u4e3a <code>&amp;p</code>\uff0c\u5373\u7ed3\u6784\u4f53\u53d8\u91cf <code>p</code> \u7684\u5730\u5740\u3002\u901a\u8fc7 <code>ptr-&gt;name</code> \u548c <code>ptr-&gt;age</code> \u53ef\u4ee5\u8bbf\u95ee\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u3002</p> <ol> <li>\u6307\u9488\u7684\u6307\u9488</li> </ol> <p>\u6307\u5411\u6307\u9488\u7684\u6307\u9488\u662f\u6307\u5411\u6307\u9488\u7684\u6307\u9488\u7c7b\u578b\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u8bbf\u95ee\u4e8c\u7ea7\u6307\u9488\u6307\u5411\u7684\u53d8\u91cf\u3002\u4f8b\u5982\uff1a</p> <pre><code>    int x = 10;\n    int *p = &amp;x;\n    int **pp = &amp;p;\n    printf(\"*** test1 ***\\n\");\n    printf(\"%d\\n\",x);\n    printf(\"%d\\n\",p);\n    printf(\"%d\\n\",*p);\n    printf(\"%d\\n\",pp);\n    printf(\"%d\\n\",*pp);\n    printf(\"%d\\n\",**pp);\n    **pp = 20;  // \u4fee\u6539 x \u53d8\u91cf\u7684\u503c\u4e3a 20\n    printf(\"*** test2 ***\\n\");\n    printf(\"%d\\n\",x);\n    printf(\"%d\\n\",p);\n    printf(\"%d\\n\",*p);\n    printf(\"%d\\n\",pp);\n    printf(\"%d\\n\",*pp);\n    printf(\"%d\\n\",**pp);\n</code></pre> <p></p> <p></p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>pp</code> \u662f\u4e00\u4e2a\u6307\u5411\u6307\u9488 <code>p</code> \u7684\u6307\u9488\uff0c\u5b83\u88ab\u8d4b\u503c\u4e3a <code>&amp;p</code>\uff0c\u5373\u6307\u5411\u6307\u9488 <code>p</code> \u7684\u5730\u5740\u3002\u901a\u8fc7 <code>**pp</code> \u53ef\u4ee5\u8bbf\u95ee <code>p</code> \u6307\u5411\u7684\u53d8\u91cf\uff0c\u5373 <code>x</code> \u53d8\u91cf\u3002\u6700\u540e\uff0c\u901a\u8fc7 <code>**pp = 20</code> \u53ef\u4ee5\u4fee\u6539 <code>x</code> \u53d8\u91cf\u7684\u503c\u4e3a 20\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_3","title":"\u57fa\u7840\u4f7f\u7528\u7684\u5b9e\u9645\u4f8b\u5b50","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_4","title":"\u6307\u9488\u8fd0\u7b97","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_5","title":"\u57fa\u7840\u77e5\u8bc6","text":"<p>\u5f53\u6211\u4eec\u8fdb\u884c\u6307\u9488\u8fd0\u7b97\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u5bf9\u6307\u9488\u8fdb\u884c\u52a0\u6cd5\u6216\u51cf\u6cd5\u8fd0\u7b97\u3002\u6307\u9488\u8fd0\u7b97\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u65b0\u7684\u6307\u9488\uff0c\u5b83\u6307\u5411\u539f\u59cb\u6307\u9488\u6240\u6307\u5411\u7684\u5185\u5b58\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\u5904\u3002</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u6307\u9488\u8fd0\u7b97\u662f\u4ee5\u6307\u9488\u6240\u6307\u5411\u7684\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u7684\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a<code>int*</code>\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u9488\u8fd0\u7b97\u5c06\u4ee5<code>sizeof(int)</code>\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u3002\u5bf9\u4e8e\u4e00\u4e2a<code>char*</code>\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u9488\u8fd0\u7b97\u5c06\u4ee5<code>sizeof(char)</code>\uff08\u53731\u5b57\u8282\uff09\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u3002</p> <p>\u5728\u6307\u9488\u8fd0\u7b97\u4e2d\uff0c\u52a0\u6cd5\u8fd0\u7b97\u8868\u793a\u5411\u524d\u79fb\u52a8\u6307\u9488\uff0c\u800c\u51cf\u6cd5\u8fd0\u7b97\u8868\u793a\u5411\u540e\u79fb\u52a8\u6307\u9488\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a<code>int*</code>\u7c7b\u578b\u7684\u6307\u9488<code>p</code>\uff0c<code>p + 1</code>\u5c06\u6307\u5411\u4e0b\u4e00\u4e2a<code>int</code>\u7c7b\u578b\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u800c<code>p - 1</code>\u5c06\u6307\u5411\u4e0a\u4e00\u4e2a<code>int</code>\u7c7b\u578b\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</p> <p>\u5f53\u6211\u4eec\u8fdb\u884c\u6307\u9488\u8fd0\u7b97\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u6839\u636e\u6307\u9488\u7684\u7c7b\u578b\u6765\u8ba1\u7b97\u504f\u79fb\u91cf\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a<code>int*</code>\u7c7b\u578b\u7684\u6307\u9488\uff0c\u7f16\u8bd1\u5668\u5c06\u6839\u636e<code>sizeof(int)</code>\u6765\u8ba1\u7b97\u504f\u79fb\u91cf\u3002\u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u4ee5\u7c7b\u578b\u5b89\u5168\u7684\u65b9\u5f0f\u8fdb\u884c\u6307\u9488\u8fd0\u7b97\uff0c\u800c\u65e0\u9700\u624b\u52a8\u8ba1\u7b97\u504f\u79fb\u91cf\u3002</p> <p>\u7136\u800c\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u624b\u52a8\u8ba1\u7b97\u504f\u79fb\u91cf\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u5904\u7406\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5b57\u6bb5\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u8ba1\u7b97\u5b57\u6bb5\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6307\u9488\u8f6c\u6362\u4e3a<code>char*</code>\u7c7b\u578b\uff0c\u5e76\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u8fdb\u884c\u6307\u9488\u8fd0\u7b97\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7ed3\u6784\u4f53<code>struct person</code>\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u6574\u578b\u5b57\u6bb5<code>age</code>\u548c\u4e00\u4e2a\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488<code>node</code>\u3002\u6211\u4eec\u60f3\u8981\u8ba1\u7b97<code>node</code>\u5b57\u6bb5\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <pre><code>unsigned int offset = (unsigned int)&amp;((struct person *)0)-&gt;node;\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5c06\u4e00\u4e2a\u7a7a\u6307\u9488<code>(struct person *)0</code>\u8f6c\u6362\u4e3a<code>struct person*</code>\u7c7b\u578b\uff0c\u7136\u540e\u4f7f\u7528<code>&amp;</code>\u8fd0\u7b97\u7b26\u83b7\u53d6<code>node</code>\u5b57\u6bb5\u7684\u5730\u5740\u3002\u7531\u4e8e\u6307\u9488\u8fd0\u7b97\u662f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u7684<code>offset</code>\u5c31\u662f<code>node</code>\u5b57\u6bb5\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\u3002</p> <p>\u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u504f\u79fb\u91cf\u5c06\u8282\u70b9\u6307\u9488\u8f6c\u6362\u4e3a\u4eba\u6307\u9488\uff1a</p> <pre><code>struct person *p = (struct person *)((char *)node - offset);\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5c06\u8282\u70b9\u6307\u9488<code>node</code>\u8f6c\u6362\u4e3a<code>char*</code>\u7c7b\u578b\uff0c\u5e76\u4ece\u6307\u9488\u7684\u503c\u4e2d\u51cf\u53bb\u504f\u79fb\u91cf\uff0c\u5f97\u5230\u6b63\u786e\u7684\u4eba\u6307\u9488\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_6","title":"\u7ed3\u6784\u4f53\u504f\u79fb\u6307\u9488\u4f8b\u5b50","text":"<pre><code>struct node_t {\n    struct node_t *next;\n};\n\nstruct person {\n    char *name;\n    int age;\n    struct node_t node;\n};\n\nstruct list {\n    char *name; /* A\u73ed */\n    struct node_t head;\n};\n\nint CmpPersonAge(struct node_t *pre, struct node_t *next)\n{\n    struct person *p;\n    struct person *n;\n\n    p = (struct person *)((char *)pre - (unsigned int)&amp;((struct person *)0)-&gt;node);\n    n = (struct person *)((char *)next - (unsigned int)&amp;((struct person *)0)-&gt;node);\n\n//\u7edf\u4e00\u6210\u4e00\u4e2a\u5b8f\uff1a \uff08\u8fd9\u91cc\u7684Container\u662f\u6307\u5305\u542b\u8fd9\u4e2a\u8fd9\u4e2a\u7ed3\u70b9\u7684\u7ed3\u6784\u4f53\uff09\n//#define container_of(ptr, type, member) \\\n//(type *)((char *)ptr - (unsigned int)&amp;((type *)0)-&gt;member)\n\n    if (p-&gt;age &lt; n-&gt;age)\n        return -1;\n    else\n        return 0;\n}\n</code></pre> <p>\u8fd9\u91cc\u7684\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u662f\u4e3a\u4e86\u5b9e\u73b0\u7ed3\u6784\u4f53\u504f\u79fb\u6307\u9488\u8ba1\u7b97\u3002\u9010\u6b65\u89e3\u91ca\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u9996\u5148\uff0c\u5728C\u8bed\u8a00\u4e2d\uff0c\u6307\u9488\u7684\u52a0\u51cf\u64cd\u4f5c\u4f1a\u6839\u636e\u6307\u9488\u6240\u6307\u5411\u7684\u7c7b\u578b\u8fdb\u884c\u8c03\u6574\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u6709\u4e00\u4e2a\u6307\u5411<code>int</code>\u7c7b\u578b\u7684\u6307\u9488<code>p</code>\uff0c\u90a3\u4e48<code>p+1</code>\u5c06\u4f1a\u5c06\u6307\u9488\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a<code>int</code>\u7c7b\u578b\u7684\u4f4d\u7f6e\u3002</p> <p>\u5728\u8fd9\u4e2a\u7279\u5b9a\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u6307\u5411\u8282\u70b9<code>struct node_t</code>\u7684\u6307\u9488<code>pre</code>\u548c<code>next</code>\u3002\u6211\u4eec\u60f3\u8981\u901a\u8fc7\u8fd9\u4e9b\u6307\u9488\u6765\u8bbf\u95ee\u8282\u70b9\u4e2d\u7684\u4eba\u7684\u5c5e\u6027\u3002\u4f46\u662f\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u8282\u70b9\u6307\u9488\u548c\u4eba\u6307\u9488\u4e4b\u95f4\u7684\u504f\u79fb\u91cf\uff0c\u4ee5\u4fbf\u6b63\u786e\u8ba1\u7b97\u51fa\u4eba\u6307\u9488\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u4e2a\u6280\u5de7\u3002\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u4e34\u65f6\u7684<code>struct person</code>\u6307\u9488\uff0c\u5b83\u7684\u503c\u88ab\u8bbe\u7f6e\u4e3a0\u3002\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528<code>&amp;((struct person *)0)-&gt;node</code>\u6765\u83b7\u53d6<code>struct person</code>\u7ed3\u6784\u4f53\u4e2d<code>node</code>\u6210\u5458\u76f8\u5bf9\u4e8e<code>struct person</code>\u7ed3\u6784\u4f53\u8d77\u59cb\u5730\u5740\u7684\u504f\u79fb\u91cf\u3002</p> <p>\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u7684\u542b\u4e49\u662f\uff0c\u5c060\u5f3a\u5236\u8f6c\u6362\u4e3a<code>struct person</code>\u6307\u9488\uff0c\u7136\u540e\u4f7f\u7528<code>-&gt;</code>\u8fd0\u7b97\u7b26\u6765\u83b7\u53d6<code>node</code>\u6210\u5458\u7684\u5730\u5740\u3002\u7531\u4e8e0\u662f\u4e00\u4e2a\u65e0\u6548\u7684\u5730\u5740\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u5173\u5fc3<code>node</code>\u6210\u5458\u7684\u504f\u79fb\u91cf\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u8282\u70b9\u6307\u9488<code>pre</code>\u548c<code>next</code>\u8f6c\u6362\u4e3a<code>char*</code>\u7c7b\u578b\uff0c\u8fd9\u662f\u56e0\u4e3a\u6307\u9488\u8fd0\u7b97\u9700\u8981\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u8fdb\u884c\u3002\u7136\u540e\uff0c\u6211\u4eec\u4ece\u6307\u9488\u7684\u503c\u4e2d\u51cf\u53bb<code>struct person</code>\u7ed3\u6784\u4f53\u4e2d<code>node</code>\u6210\u5458\u7684\u504f\u79fb\u91cf\uff0c\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u6b63\u786e\u7684<code>struct person</code>\u6307\u9488\u3002</p> <p>\u6700\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u6307\u9488\u8f6c\u6362\u56de<code>struct person</code>\u7c7b\u578b\uff0c\u5e76\u5c06\u5176\u5206\u522b\u8d4b\u503c\u7ed9<code>p</code>\u548c<code>n</code>\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u6210\u529f\u5730\u8ba1\u7b97\u51fa\u4e86\u7ed3\u70b9\u6307\u9488\u548c\u4eba\u6307\u9488\u4e4b\u95f4\u7684\u504f\u79fb\u91cf\u6210\u529f\u83b7\u53d6\u4e86\u4eba\u6307\u9488\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528\u4eba\u6307\u9488\u6765\u8bbf\u95ee\u8282\u70b9\u4e2d\u7684\u4eba\u7684\u5c5e\u6027\u3002</p> <p>\u5e0c\u671b\u8fd9\u4e2a\u89e3\u91ca\u80fd\u591f\u5e2e\u52a9\u60a8\u7406\u89e3\u8fd9\u4e2a\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u548c\u7ed3\u6784\u4f53\u504f\u79fb\u6307\u9488\u8ba1\u7b97\u7684\u539f\u7406\u548c\u4f5c\u7528\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u8bf7\u968f\u65f6\u63d0\u95ee\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_7","title":"\u5173\u4e8e\u6307\u9488\u548c\u5b57\u7b26\u4e32\u5e38\u91cf","text":"<p>\u201c\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5b57\u7b26\u4e32\u5e38\u91cf\u4f1a\u751f\u6210\u4e00\u4e2a \u2018\u6307\u5411\u5b57\u7b26\u7684\u5e38\u91cf\u6307\u9488\u2019 .</p> <p>==\u5f53\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u51fa\u73b0\u4e8e\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d, \u8868\u8fbe\u5f0f\u6240\u4f7f\u7528\u7684\u503c\u5c31\u662f\u8fd9\u4e9b\u5b57\u7b26\u6240\u5b58\u50a8\u7684\u5730\u5740, \u800c\u4e0d\u662f\u8fd9\u4e9b\u5b57\u7b26\u672c\u8eab. ==</p> <p>==\u6240\u4ee5.\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u8d4b\u503c\u7ed9\u4e00\u4e2a\u201d\u6307\u5411\u5b57\u7b26\u7684\u6307\u9488\u201c,</p> <p>** \u540e\u8005\u6307\u5411\u8fd9\u4e9b\u5b57\u7b26\u6240\u5b58\u50a8\u7684\u5730\u5740, \u4f46\u662f\u4e0d\u80fd\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u8d4b\u503c\u7ed9\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4, ==**</p> <p>\u56e0\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u76f4\u63a5\u503c\u662f\u4e00\u4e2a\u6307\u9488, \u800c\u4e0d\u662f\u8fd9\u4e9b\u5b57\u7b26\u672c\u8eab.\"</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_8","title":"\u5b9a\u4e49","text":"<p>\"\u4e00\u4e32\u4ee5NUL\u5b57\u8282\u7ed3\u5c3e\u7684\u96f6\u4e2a\u6216\u8005\u591a\u4e2a\u5b57\u7b26\" NUL:\u76f8\u5f53\u4e8e '\\0' \u7528\u6765\u7ed3\u5c3e</p> <p>\u4f8b\u5982\uff0c\u5b57\u7b26\u4e32\"Hello\"\u5b9e\u9645\u4e0a\u662f\u7531\u5b57\u7b26'H'\u3001'e'\u3001'l'\u3001'l'\u3001'o'\u548cNUL\u5b57\u7b26 '\\0' \u7ec4\u6210\u7684\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#1","title":"\u7591\u95ee1(\u524d\u534a\u6bb5)","text":"<p>\u8fd9\u6bb5\u8bdd\u7684\u4e00\u76f4\u5f88\u8ff7\u7cca, \u4f3c\u61c2\u975e\u61c2, \u7528\u7684\u4ec0\u4e48\u5730\u5740?  \u7528\u8fd9\u4e9b\u5b57\u7b26\u6240\u8868\u793a\u7684\u5730\u5740?</p> <p>\u4ece\u5934\u634b\u4e00\u904d: </p> <p>\u5b9e\u9645\u4e0a, \u5728\u6211\u4eec\u4f7f\u7528\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u65f6\u5019, \u7f16\u8bd1\u5668\u4f1a\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u5b58\u50a8\u5728==\u53ea\u8bfb\u6570\u636e\u6bb5==\u4e2d\uff0c\u5e76\u4e3a\u5176\u5206\u914d\u4e00\u4e2a\u5730\u5740\u3002\u8fd9\u4e2a\u5730\u5740\u5c31\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u3002\u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u5b57\u7b26\u4e32\u5e38\u91cf\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528\u4e86\u8be5\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u4f5c\u4e3a\u503c\u3002(\u4e5f\u5c31\u662f\u4e0a\u56fe\u76840XFFFFF134) </p> <p>\u5173\u4e8e\u6bb5: \u53ef\u4ee5\u5148\u770b\u770b\u738b\u723d\u8001\u5e08\u300a\u6c47\u7f16\u8bed\u8a00\u300b\u4e2d\u7684\u8bb2\u89e3, \u6211\u81ea\u5df1\u7406\u89e3\u5c31\u662f\u7684\u6570\u636e\u6bb5\u5c31\u662f\u4eba\u4e3a\u5212\u5206\u6216\u8005\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7684\u4e00\u6bb5\u5185\u5b58\u4e2d\u7684\u7a7a\u95f4. \u5982\u56fe: </p> <p>\u518d\u4e3e\u4e2a\u4f8b\u5b50, \u8003\u8651\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>const char* str = \"Hello\";\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\"Hello\"\u5b58\u50a8\u5728\u53ea\u8bfb\u6570\u636e\u6bb5\u4e2d\uff0c\u5e76\u88ab\u5206\u914d\u4e00\u4e2a\u5730\u5740\u3002\u53d8\u91cf<code>str</code>\u662f\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u7684\u6307\u9488\uff0c\u5b83\u5b58\u50a8\u4e86\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u3002\u56e0\u6b64\uff0c\u8868\u8fbe\u5f0f<code>str</code>\u5c31\u662f\u4f7f\u7528\u4e86\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u4f5c\u4e3a\u503c\u3002</p> <p>\u8fd9\u91cc\u4f7f\u7528\u7684\u5730\u5740\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u6211\u4eec\u9700\u8981\u8bbf\u95ee\u5b57\u7b26\u4e32\u5e38\u91cf\u4e2d\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u901a\u8fc7\u89e3\u5f15\u7528\u6307\u9488\u6765\u5b9e\u73b0\uff0c\u4f8b\u5982<code>*str</code>\u53ef\u4ee5\u83b7\u53d6\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u9996\u5b57\u7b26\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#2","title":"\u7591\u95ee2(\u540e\u534a\u6bb5)","text":"<p>\u5173\u4e8e\u4e0d\u80fd\u8d4b\u503c \u5b57\u7b26\u4e32\u5e38\u91cf\u662f\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u6570\u7ec4\u7684\u5e38\u91cf\u6307\u9488\uff0c\u4e0d\u80fd\u76f4\u63a5\u8d4b\u503c\u7ed9\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\u3002</p> <p>\u56e0\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u5b58\u50a8\u5728\u53ea\u8bfb\u6570\u636e\u6bb5\u4e2d\uff0c\u662f\u4e0d\u53ef\u4fee\u6539\u7684\u3002</p> <p>\u800c\u5b57\u7b26\u6570\u7ec4\u662f\u53ef\u4fee\u6539\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u6570\u7ec4\u5143\u7d20\u6765\u6539\u53d8\u5176\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u5c1d\u8bd5\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u76f4\u63a5\u8d4b\u503c\u7ed9\u5b57\u7b26\u6570\u7ec4\uff0c\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u9519\u8bef( \u56e0\u4e3a\u53ea\u8bfb )\u3002\u4e3a\u4e86\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u590d\u5236\u5230\u5b57\u7b26\u6570\u7ec4\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u62f7\u8d1d\u51fd\u6570\uff08\u5982strcpy\uff09\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5185\u5bb9\u590d\u5236\u5230\u5b57\u7b26\u6570\u7ec4\u4e2d\u3002\u4f8b\u5982\uff1a</p> <pre><code>char str[10];\n\nstr[10] = \"hello\";  (x)\nstrcpy(str, \"Hello\"); (\u221a)\n</code></pre> <p>\u8fd9\u6837\u5c31\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\"Hello\"\u590d\u5236\u5230\u4e86\u5b57\u7b26\u6570\u7ec4str\u4e2d\u3002\u8bf7\u6ce8\u610f\uff0c\u5b57\u7b26\u6570\u7ec4\u7684\u5927\u5c0f\u8981\u8db3\u591f\u5927\u4ee5\u5bb9\u7eb3\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5185\u5bb9\u548c\u7a7a\u5b57\u7b26'\\0'</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_9","title":"\u8865\u5145/\u5224\u65ad","text":"<pre><code>char str1[] = \"abc\";\nchar str2[] = \"abc\";    \nprintf(\"%d\",str1 == str2); //\u4e0d\u7b49: \u56e0 \u5b57\u7b26\u4e32\u6570\u7ec4 \u4f1a\u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\n\nchar *str3 = \"abc\";\nchar *str4 = \"abc\"; \nprintf(\"%d\",str1 == str2); //\u76f8\u7b49: \u56e0 \u6307\u5411 \u76f8\u540c\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u533a\u57df\n\nprintf(\"%d\\n\", sizeof(str1));  //sizeof \u8981\u5305\u542b\u7ed3\u5c3e\u5b57\u7b26\\0\nprintf(\"%d\\n\", strlen(str1));  //strlen \u9047\\0 \u7ed3\u675f\uff0c \\0\u4e0d\u8ba1\u5165\u957f\u5ea6\nprintf(\"%d\\n\", sizeof(str3));  //\u6307\u9488\u7684\u5927\u5c0f\nprintf(\"%d\\n\", strlen(str4));  //\u52a8\u6001\u8ba1\u7b97\u6307\u5411\u7684\u5b57\u7b26\u4e32 \u7684\u5927\u5c0f  \\0\u4e0d\u8ba1\u5165\u957f\u5ea6\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_10","title":"\u6307\u9488\u6570\u7ec4\u548c\u6570\u7ec4\u6307\u9488","text":"<p>int  ( pa)[3]; //\u5b9a\u4e49\u6570\u7ec4\u6307\u9488:  \u5176\u6307\u5411\u7684\u7c7b\u578b\u662f\u6570\u7ec4(\u67093\u4e2a\u6574\u578b\u6570\u5143\u7d20)                  //\u66ff\u6362\u6cd5(\u7528a \u66ff\u4ee3pa \uff0c\u5219pa\u662f\u6307\u5411a\u6570\u7ec4\u7684\u6307\u9488)  int * ap[3]; //\u5b9a\u4e49\u6307\u9488\u6570\u7ec4: \u6570\u7ec4\u5143\u7d20\u7684\u7c7b\u578b\u662f\u6307\u9488(\u5176\u6307\u5411\u7684\u7c7b\u578b\u662f int)                 //(int *) ap[3];  \u4f18\u5148\u7ea7 \u4ece\u53f3\u5230\u5de6,    </p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_11","title":"\u6307\u9488\u6570\u7ec4","text":"<p>\u672c\u8d28\u4e0a\u8fd8\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6570\u7ec4, \u4f46\u662f\u6570\u7ec4\u91cc\u9762\u5143\u7d20\u5b58\u653e\u7740 char* (\u6307\u9488\u7c7b\u578b)\u7684\u5143\u7d20,\u5373\u5b57\u7b26\u4e32(\u5143\u7d20)\u7684\u5730\u5740</p> <p>\u8981\u8bbf\u95ee\u6307\u9488\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u6807\u6765\u8bbf\u95ee\u6bcf\u4e2a\u6307\u9488\uff0c\u7136\u540e\u518d\u901a\u8fc7\u8be5\u6307\u9488\u6765\u8bbf\u95ee\u5176\u6307\u5411\u7684\u5185\u5bb9</p> <pre><code> char *name[]={\"yhai\", \"yzg\", \"li ming\"};  //\u6ce8: \u4ec5\u5206\u914d3\u4e2a\u6307\u9488\u7a7a\u95f4(\u6307\u5411\u7684\u662f\u5b57\u7b26\u4e32\u5e38\u91cf) //, \u4e8c\u7ef4\u6570\u7ec4,\u4f46\u53c8\u4e0d\u540c\n  printf(\"%s \",name[1]);\n  name[1][2]='w';   //\u6bb5\u9519\u8bef: \u4e0d\u80fd\u6539\u5199\uff0c\u56e0\u672a\u5206\u914d\u7a7a\u95f4\n  printf(\"%s \",name[1]);   \n\n          name  \n          -----     -------- \n  name[0] | &amp; | --&gt; |yhai\\0|\n          -----     --------  \n  name[1] | &amp; | --&gt; |yzg\\0|\n          -----     -----------    \n  name[2] | &amp; | --&gt; |li ming\\0|\n          -----     -----------   \n</code></pre> <p>\u8865\u5145</p> <ul> <li>\u4f8b\u5b50\u4e00\uff1a</li> </ul> <p>```C</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#include","title":"include  <p>int main(int argc, char *argv[]) {     int i = 0;</p> <pre><code>// go through each string in argv\n// why am I skipping argv[0]?\nfor(i = 1; i &lt; argc; i++) {\n    printf(\"arg %d: %s\\n\", i, argv[i]);\n}\n\n// let's make our own array of strings\nchar *states[] = {\n    \"California\", \"Oregon\",\n    \"Washington\", \"Texas\"\n};\nint num_states = 4;\n\nargv[1] = states[1];\n\n//states[2] = argv[1]  \u8fd9\u6837\u5b50\u505a\u662f\u53ef\u4ee5\u7684\n//states[2] = (char*) 55;   \u8fd9\u6837\u5b50\u505a\u4e5f\u53ef\u4ee5,\u4f46\u662f\u5e94\u8be5\u8bbf\u95ee\u975e\u6cd5\u5185\u5b58,\u6bb5\u9519\u8bef\n\nfor(i = 0; i &lt; num_states; i++) {\n    printf(\"state %d: %s\\n\", i, states[i]);\n}\n\nreturn 0;\n</code></pre> <p>}</p> <p>```</p> <p>\u5c06<code>argv[1]</code>\u8d4b\u503c\u7ed9<code>states[2]</code>\u65f6\uff0c\u5176\u5b9e\u662f\u5c06<code>states[2]</code>\u6307\u5411\u4e86<code>argv[1]</code>\u6240\u6307\u5411\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u867d\u7136\u5b57\u7b26\u4e32\u5e38\u91cf\u901a\u5e38\u5b58\u50a8\u5728\u53ea\u8bfb\u6570\u636e\u6bb5\uff0c\u4f46\u6307\u5411\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u6307\u9488\u662f\u53ef\u4ee5\u88ab\u4fee\u6539\u7684\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u5c06<code>argv[1]</code>\u8d4b\u503c\u7ed9<code>states[2]</code>\uff0c\u5e76\u4e14\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u53ef\u4ee5\u4fee\u6539\u6307\u5411\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u6307\u9488\uff0c\u4f46\u4e0d\u80fd\u4fee\u6539\u5b57\u7b26\u4e32\u5e38\u91cf\u672c\u8eab\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ef\u4ee5\u4fee\u6539\u6307\u9488\u7684\u6307\u5411(\u4e0d\u540c\u7684\u5730\u5740)\uff0c\u4f46\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u6307\u9488\u6765\u4fee\u6539\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5185\u5bb9\u3002</p> <p>\u6240\u4ee5\uff0c\u867d\u7136<code>states</code>\u548c<code>argv</code>\u4e2d\u7684\u5143\u7d20\u6307\u5411\u7684\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u4f46\u4ecd\u7136\u53ef\u4ee5\u5bf9\u6307\u9488\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\u3002</p> <ul> <li>\u4f8b\u5b50\u4e8c\uff1a</li> </ul> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u5b57\u7b26\u4e32\u662f\u4ee5\u5b57\u7b26\u6570\u7ec4\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\uff0c\u6240\u4ee5<code>states[1]</code>\u5b58\u50a8\u7684\u662f\u5b57\u7b26\u4e32\"Oregon\"\u7684\u5730\u5740\u3002\u5f53\u4f60\u6267\u884c<code>printf(\"%s\\n\", states[1]);</code>\u65f6\uff0c\u5b83\u4f1a\u6253\u5370\u51fa<code>states[1]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u5373\"Oregon\"\u3002\u800c\u5f53\u4f60\u6267\u884c<code>printf(\"%d\\n\", *states[1]);</code>\u65f6\uff0c\u5b83\u4f1a\u6253\u5370\u51fa<code>states[1]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684ASCII\u7801\u503c\uff0c\u5373'O'\u7684ASCII\u7801\u503c\u4e3a79\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[])\n{\n   int i = 0;\n\n   // go through each string in argv\n   // why am I skipping argv[0]?\n   for(i = 1; i &lt; argc; i++) {\n       printf(\"arg %d: %s\\n\", i, argv[i]);\n   }\n\n   // let's make our own array of strings\n   char *states[] = {\n       \"California\", \"Oregon\",\n       \"Washington\", \"Texas\"\n   };\n   int num_states = 4;\n\n   printf(\"%s\\n\",states[1]);\n   printf(\"%d\\n\",states[1]);\n   printf(\"%s\\n\",*states[1]);\n   printf(\"%d\\n\",*states[1]);\n\n   for(i = 0; i &lt; num_states; i++) {\n       printf(\"state %d: %s\\n\", i, states[i]);\n   }\n\n   return 0;\n}\n\n\n\u4e0a\u9762\u662f\u6e90\u4ee3\u7801\n\u4e0b\u9762\u662f\u8c03\u8bd5\u7ed3\u679c\nOregon\n-1112182757\n//\u6bb5\u9519\u8bef\n79\n\u3002\u3002\nstate 0: California\nstate 1: Oregon\nstate 2: Washington\nstate 3: Texas\n</code></pre> <p><code>states</code>\u662f\u4e00\u4e2a\u6307\u9488\u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u6307\u5411\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u6307\u9488\u3002\u9010\u4e2a\u5206\u6790<code>printf</code>\u8bed\u53e5\uff1a</p> <ol> <li><code>printf(\"%s\\n\", states[1]);</code>\uff1a\u8fd9\u884c\u4ee3\u7801\u4f1a\u6253\u5370<code>states[1]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u5373\"Oregon\"\u3002</li> <li><code>printf(\"%d\\n\", states[1]);</code>\uff1a\u8fd9\u884c\u4ee3\u7801\u4f1a\u5c1d\u8bd5\u4ee5\u6574\u6570\u7684\u5f62\u5f0f\u6253\u5370<code>states[1]</code>\u7684\u503c\uff0c\u5373\u6307\u5411\u5b57\u7b26\u4e32\"Oregon\"\u7684\u6307\u9488\uff0c\u8fd9\u662f\u4e0d\u6b63\u786e\u7684\u7528\u6cd5\uff0c\u56e0\u6b64\u8fd9\u53ef\u80fd\u5bfc\u81f4\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002</li> <li><code>printf(\"%s\\n\", *states[1]);</code>\uff1a\u8fd9\u884c\u4ee3\u7801\u4f1a\u5c1d\u8bd5\u6253\u5370<code>states[1]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5373'O'\uff0c\u4f46\u4f7f\u7528<code>%s</code>\u683c\u5f0f\u63a7\u5236\u7b26\u6765\u6253\u5370\u5355\u4e2a\u5b57\u7b26\u662f\u4e0d\u6b63\u786e\u7684\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</li> <li><code>printf(\"%d\\n\", *states[1]);</code>\uff1a\u8fd9\u884c\u4ee3\u7801\u4f1a\u5c1d\u8bd5\u4ee5\u6574\u6570\u7684\u5f62\u5f0f\u6253\u5370<code>*states[1]</code>\uff0c\u5373\u5b57\u7b26\u4e32\"Oregon\"\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26'O'\u7684ASCII\u7801\u503c\u3002</li> </ol> <p>\u5177\u4f53\u770b\u7b2c\u4e09\u4e2a<code>printf</code>\u7684\u6bb5\u9519\u8bef\u3002</p> <p><code>printf(\"%s\\n\", *states[1]);</code>\u4e2d\u7684<code>*states[1]</code>\u4f1a\u89e3\u5f15\u7528<code>states[1]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5c1d\u8bd5\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u6253\u5370\u89e3\u5f15\u7528\u540e\u7684\u503c\u3002</p> <p>\u4f46\u662f<code>states[1]</code>\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u800c<code>*states[1]</code>\u662f\u4e00\u4e2a\u5b57\u7b26\uff08\u76f8\u5f53\u4e8e<code>states[1][0]</code>\uff0c\u5373\u5b57\u7b26O\uff09\uff0c\u975e\u6307\u9488\uff0c\u800c%s\u5b9e\u9645\u4e0a\u64cd\u4f5c\u7684\u5bf9\u8c61\u662f\u6307\u9488, %s\u81ea\u52a8\u8fdb\u884c\u89e3\u5f15\u7528\u3002</p> <ul> <li> <p>\u4f8b\u5b50\u4e09\uff1a\u590d\u4e60\u683c\u5f0f\u5316\u5b57\u7b26\u4e32</p> <p><code>%s</code>\u548c<code>%c</code>\u662fC\u8bed\u8a00\u4e2d\u7528\u4e8e\u683c\u5f0f\u5316\u8f93\u51fa\u7684\u683c\u5f0f\u63a7\u5236\u7b26\u3002</p> <ul> <li><code>%s</code>\u7528\u4e8e\u6253\u5370\u5b57\u7b26\u4e32\uff0c\u5b83\u4f1a\u4ece\u5185\u5b58\u5730\u5740\u5f00\u59cb\uff0c\u4e00\u76f4\u6253\u5370\u76f4\u5230\u9047\u5230\u5b57\u7b26\u4e32\u7ed3\u675f\u6807\u5fd7<code>\\0</code>\u3002</li> <li><code>%c</code>\u7528\u4e8e\u6253\u5370\u5355\u4e2a\u5b57\u7b26\uff0c\u5b83\u4f1a\u6253\u5370\u6307\u5b9a\u5185\u5b58\u5730\u5740\u5904\u7684\u5355\u4e2a\u5b57\u7b26\u3002</li> </ul> <p>\u5982\u679c\u8981\u6253\u5370\u6307\u9488\u53d8\u91cf\u6240\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u4e0a\u5b58\u50a8\u7684\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528<code>*</code>\u8fd0\u7b97\u7b26\u6765\u89e3\u5f15\u7528\u6307\u9488\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528<code>%c</code>\u6216<code>%s</code>\u6765\u6253\u5370\u51fa\u89e3\u5f15\u7528\u540e\u7684\u503c\u3002\u6ce8\u610f\u8fd9\u4e2a\u5b57\u7b26\u4e32(\u4e00\u7ea7\u6307\u9488/\u4e8c\u7ea7\u6307\u9488)\u662f\u81ea\u52a8\u89e3\u5f15\u7528\u7684\u5594</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u6570\u7ec4\u7684\u6307\u9488<code>char *str</code>\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528<code>printf(\"%s\", str)</code>\u6765\u6253\u5370\u51fa<code>str</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u6216\u8005\u4f7f\u7528<code>printf(\"%c\", *str)</code>\u6765\u6253\u5370\u51fa<code>str</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u3002</p> </li> <li> <p>\u4f8b\u5b50\u56db\uff1a\u5173\u4e8e\u6307\u9488\u8d4b\u503c\u7684\u7406\u89e3 \u6307\u9488\u7684\u5f15\u7528</p> <p>\u200b \u8d77\u56e0: \u6709\u8fd9\u4e48\u4e00\u4e2a\u9700\u6c42</p> <p>\u200b             \u4f7f\u7528while\u5faa\u73af\u5c06argv\u4e2d\u7684\u503c\u590d\u5236\u5230states\u3002 \u8ba9\u8fd9\u4e2a\u590d\u5236\u5faa\u73af\u4e0d\u4f1a\u6267\u884c\u5931\u8d25\uff0c\u5373\u4f7fargv\u4e4b\u4e2d\u6709\u5f88\u591a\u5143\u7d20\u4e5f\u4e0d\u4f1a\u5168\u90e8\u653e\u8fdbstates\u3002</p> <p>\u7814\u7a76\u4f60\u662f\u5426\u771f\u6b63\u590d\u5236\u4e86\u8fd9\u4e9b\u5b57\u7b26\u4e32\u3002\u7b54\u6848\u53ef\u80fd\u4f1a\u8ba9\u4f60\u611f\u5230\u610f\u5916\u548c\u56f0\u60d1\u3002</p> <pre><code>    char *argv[]\n  char *states[4];  // \u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u5b57\u7b26\u4e32\u6307\u9488\u6570\u7ec4\n  // copy values from argv to states\n    i = 0;\n    while(i &lt; argc &amp;&amp; i &lt; 4) {\n        states[i] = argv[i];  // \u590d\u5236argv\u4e2d\u7684\u503c\u5230states\n        i++;\n    }\n</code></pre> <p>\u5c06<code>states[i]</code>\u6307\u5411<code>argv[i]</code>\u65f6\uff0c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u53d1\u751f\u5b57\u7b26\u4e32\u7684\u590d\u5236\u64cd\u4f5c\u3002</p> <p>\u76f8\u53cd\uff0c<code>states[i]</code>\u548c<code>argv[i]</code>\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u4fee\u6539\u4e86<code>argv[i]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48<code>states[i]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u4e5f\u4f1a\u53d1\u751f\u76f8\u5e94\u7684\u53d8\u5316\uff0c\u56e0\u4e3a\u5b83\u4eec\u5b9e\u9645\u4e0a\u6307\u5411\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u3002  (\u6709\u70b9\u50cf\u4e4b\u524d\u4e86\u89e3\u7684python\u7684\u8d4b\u503c)</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5728C\u8bed\u8a00\u4e2d\uff0c\u4f7f\u7528\u8d4b\u503c\u64cd\u4f5c\u7b26\u5c06\u6307\u9488\u6307\u5411\u7684\u5185\u5bb9\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6307\u9488\u65f6\uff0c\u5e76\u4e0d\u4f1a\u590d\u5236\u5b9e\u9645\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u800c\u53ea\u662f\u590d\u5236\u4e86\u6307\u9488\u7684\u5f15\u7528\u3002\u56e0\u6b64\uff0c\u539f\u6765<code>states[i]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u5e76\u6ca1\u6709\u88ab\u4e22\u5f03\uff0c\u800c\u662f\u88ab<code>argv[i]</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u6240\u53d6\u4ee3\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8981\u590d\u5236\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u5730\u590d\u5236\u6307\u9488\u7684\u5f15\u7528\uff0c\u9700\u8981\u4f7f\u7528<code>strcpy</code>\u51fd\u6570\u6765\u5b9e\u73b0\u3002\u8fd9\u6837\u5c31\u4f1a\u771f\u6b63\u590d\u5236\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u590d\u5236\u6307\u9488\u7684\u5f15\u7528\u3002</p> <p>\u603b\u7ed3: \u5f53\u4f60\u5c06\u4e24\u4e2a\u6307\u9488\u53d8\u91cf\u6307\u5411\u540c\u4e00\u5904\u5185\u5b58\u5730\u5740\u65f6\uff0c\u5b83\u4eec\u5c31\u6210\u4e3a\u4e86\u6307\u5411\u540c\u4e00\u5904\u5185\u5b58\u7a7a\u95f4\u7684\u6307\u9488\u5f15\u7528\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5f53\u4f60\u901a\u8fc7\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u4fee\u6539\u4e86\u5185\u5b58\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u65f6\uff0c\u53e6\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u4e5f\u4f1a\u53cd\u6620\u51fa\u8fd9\u4e9b\u53d8\u5316\u3002</p>  <p>GPT\u7684\u56de\u7b54: </p> <p>\u6307\u9488\u5f15\u7528\u662f\u6307\u4e24\u4e2a\u6216\u591a\u4e2a\u6307\u9488\u53d8\u91cf\u6307\u5411\u540c\u4e00\u5904\u5185\u5b58\u7a7a\u95f4\u7684\u60c5\u51b5\u3002\u5728C\u8bed\u8a00\u4e2d\uff0c\u6307\u9488\u5f15\u7528\u662f\u4e00\u79cd\u975e\u5e38\u5e38\u89c1\u7684\u73b0\u8c61\uff0c\u56e0\u4e3a\u6307\u9488\u53d8\u91cf\u901a\u5e38\u7528\u4e8e\u4f20\u9012\u5185\u5b58\u5730\u5740\u4ee5\u53ca\u5728\u51fd\u6570\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5c55\u793a\u4e86\u6307\u9488\u5f15\u7528\u7684\u6982\u5ff5\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n int a = 10;\n int *p1 = &amp;a;\n int *p2 = p1;\n\n printf(\"a = %d\\n\", a); // \u8f93\u51fa\uff1aa = 10\n printf(\"*p1 = %d\\n\", *p1); // \u8f93\u51fa\uff1a*p1 = 10\n printf(\"*p2 = %d\\n\", *p2); // \u8f93\u51fa\uff1a*p2 = 10\n\n *p1 = 20;\n printf(\"a = %d\\n\", a); // \u8f93\u51fa\uff1aa = 20\n printf(\"*p1 = %d\\n\", *p1); // \u8f93\u51fa\uff1a*p1 = 20\n printf(\"*p2 = %d\\n\", *p2); // \u8f93\u51fa\uff1a*p2 = 20\n\n return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6574\u6570\u53d8\u91cf<code>a</code>\uff0c\u5e76\u521b\u5efa\u4e86\u4e24\u4e2a\u6307\u9488\u53d8\u91cf<code>p1</code>\u548c<code>p2</code>\uff0c\u5b83\u4eec\u90fd\u6307\u5411<code>a</code>\u7684\u5185\u5b58\u5730\u5740\u3002\u56e0\u6b64\uff0c<code>p1</code>\u548c<code>p2</code>\u662f\u6307\u9488\u5f15\u7528\u3002</p> <p>\u5728\u7a0b\u5e8f\u7684\u540e\u9762\uff0c\u6211\u4eec\u901a\u8fc7<code>*p1</code>\u4fee\u6539\u4e86<code>a</code>\u7684\u503c\uff0c\u7136\u540e\u6253\u5370\u51fa\u4e86<code>a</code>\u3001<code>*p1</code>\u548c<code>*p2</code>\u7684\u503c\u3002\u7531\u4e8e<code>p1</code>\u548c<code>p2</code>\u6307\u5411\u540c\u4e00\u5904\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u5b83\u4eec\u90fd\u53cd\u6620\u4e86<code>a</code>\u7684\u65b0\u503c\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u6307\u9488\u5f15\u7528\u662f\u6307\u4e24\u4e2a\u6216\u591a\u4e2a\u6307\u9488\u53d8\u91cf\u6307\u5411\u540c\u4e00\u5904\u5185\u5b58\u7a7a\u95f4\u7684\u60c5\u51b5\u3002\u5728C\u8bed\u8a00\u4e2d\uff0c\u6307\u9488\u5f15\u7528\u662f\u4e00\u79cd\u975e\u5e38\u5e38\u89c1\u7684\u73b0\u8c61\uff0c\u56e0\u4e3a\u6307\u9488\u53d8\u91cf\u901a\u5e38\u7528\u4e8e\u4f20\u9012\u5185\u5b58\u5730\u5740\u4ee5\u53ca\u5728\u51fd\u6570\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u3002</p>  </li> <li> <p>\u4f8b\u5b50\u4e94\uff1a\u6307\u9488\u6570\u7ec4\u53ea\u80fd\u5b58\u5b57\u7b26\u4e32\u5417?</p> </li> </ul>  <p>C\u8bed\u8a00\u7684\u6307\u9488\u6570\u7ec4\u4e0d\u4ec5\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u8fd8\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u4efb\u4f55\u7c7b\u578b\u7684\u6307\u9488\u3002\u6307\u9488\u6570\u7ec4\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5176\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u3002\u8fd9\u4e9b\u6307\u9488\u53d8\u91cf\u53ef\u4ee5\u6307\u5411\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u5305\u62ec\u6574\u6570\u3001\u6d6e\u70b9\u6570\u3001\u7ed3\u6784\u4f53\u3001\u751a\u81f3\u662f\u5176\u4ed6\u6307\u9488\u6570\u7ec4\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5c55\u793a\u4e86\u6307\u9488\u6570\u7ec4\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u6570\u636e\u7684\u60c5\u51b5\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n int num1 = 10;\n double num2 = 3.14;\n char str[] = \"Hello, World!\";\n\n int *ptr1 = &amp;num1;\n double *ptr2 = &amp;num2;\n char *ptr3 = str;\n\n void *ptrArray[] = {ptr1, ptr2, ptr3};\n\n printf(\"%d\\n\", *(int *)ptrArray[0]); // \u8f93\u51fa\uff1a10\n printf(\"%f\\n\", *(double *)ptrArray[1]); // \u8f93\u51fa\uff1a3.14\n printf(\"%s\\n\", (char *)ptrArray[2]); // \u8f93\u51fa\uff1aHello, World!\n\n return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6307\u9488\u6570\u7ec4<code>ptrArray</code>\uff0c\u5176\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u3002\u8fd9\u4e9b\u6307\u9488\u53d8\u91cf\u5206\u522b\u6307\u5411<code>num1</code>\u3001<code>num2</code>\u548c<code>str</code>\u3002\u7136\u540e\uff0c\u6211\u4eec\u901a\u8fc7<code>ptrArray</code>\u6765\u8bbf\u95ee\u5e76\u8f93\u51fa\u4e86\u8fd9\u4e9b\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002</p> <p>\u56e0\u6b64\uff0c\u6307\u9488\u6570\u7ec4\u4e0d\u4ec5\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u8fd8\u53ef\u4ee5\u5b58\u50a8\u4efb\u4f55\u7c7b\u578b\u7684\u6307\u9488\u3002\u8fd9\u4f7f\u5f97\u6307\u9488\u6570\u7ec4\u6210\u4e3a\u4e00\u4e2a\u975e\u5e38\u7075\u6d3b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u7528\u4e8e\u5904\u7406\u5404\u79cd\u7c7b\u578b\u7684\u6570\u636e\u3002</p> <p>\u53ea\u662f\u8bf4\u6211\u4eec\u5e38\u7528\u6307\u9488\u6570\u7ec4\u6765\u5b58\u591a\u4e2a\u5b57\u7b26\u4e32</p>  <ul> <li> <p>\u603b\u7ed3\uff1a</p> <p>\u4ee5\u524d\u5bf9\u6307\u9488\u7684\u7406\u89e3\uff1a</p> <ul> <li>\u8ba4\u4e3a\u6307\u9488\u662f\u4e00\u4e2a\u666e\u901a\u7684\u53d8\u91cf\uff0c\u5b58\u50a8\u5730\u5740\uff0c\u548c\u5176\u4ed6\u7684int char\u4e00\u6837</li> </ul> <p>\u73b0\u5728\u5b9e\u9645\u8c03\u8bd5\u8fc7\u540e\u7684\uff0c\u66f4\u65b0\u8ba4\u77e5\uff1a</p> <ul> <li>\u4e0d\u5355\u5355\u7406\u89e3\u6210\u5b58\u50a8\u5730\u5740\uff0c\u5c06\u5b83\u7406\u89e3\u6210\u6307\u5411\u67d0\u4e00\u5757\u5730\u5740\uff08pointer\uff09  \u6307\u5411\u67d0\u4e00\u5757\u5730\u5740\u548c\u8fd9\u4e2a\u53d8\u91cf\u5b58\u7740\u67d0\u4e00\u4e2a\u5730\u5740\u5176\u5b9e\u8fd8\u662f\u6709\u533a\u522b\u7684\uff0c\u5c31\u6bd4\u5982\u5728\u4f7f\u7528\u6307\u9488\u5f15\u7528\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u672c\u8d28\u4e0a\u4e0d\u662f\u771f\u6b63\u7684\u590d\u5236\uff0c\u662f\u5728\u64cd\u4f5c\u6307\u9488\u6240\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u4e2d\u7684\u6570\u636e</li> </ul> </li> <li> <p>2024\u5e74\u8865\u5145\uff1a\u4e8c\u91cd\u6307\u9488\u5b58\u50a8\u952e\u503c\u5bf91</p> <p>\u4e8c\u91cd\u6307\u9488\u7684\u7528\u6cd5\u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u540c\u4e00\u4e2a\u6570\u7ec4\u4e2d\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e</p> <p><code>void **contents</code> \u662f\u4e00\u4e2a\u6307\u5411 <code>void*</code> \u7c7b\u578b\u7684\u6307\u9488\u6570\u7ec4\u3002\u8fd9\u610f\u5473\u7740 <code>contents</code> \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a\u6307\u5411 <code>void*</code> \u7c7b\u578b\u7684\u6307\u9488\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 <code>contents</code> \u4e2d\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u5305\u62ec\u6307\u5411\u4e0d\u540c\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\u7684\u6307\u9488\u3002</p> <p>\u5bf9\u4e8e\u5b58\u50a8\u952e\u503c\u5bf9\uff0c\u4f7f\u7528\u4e8c\u91cd\u6307\u9488\u7684\u6982\u5ff5\u6765\u5b9e\u73b0\u3002\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53 <code>KeyValuePair</code> \u6765\u8868\u793a\u952e\u503c\u5bf9\uff0c\u7136\u540e\u4f7f\u7528 <code>void **contents</code> \u6765\u5b58\u50a8\u6307\u5411 <code>KeyValuePair</code> \u7ed3\u6784\u4f53\u7684\u6307\u9488\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u6570\u7ec4\u4e2d\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u952e\u503c\u5bf9\u6570\u636e\u3002\u5982\u4e0b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// \u5b9a\u4e49\u952e\u503c\u5bf9\u7ed3\u6784\u4f53\ntypedef struct {\n    char* key;\n    int value;\n} KeyValuePair;\n\nint main() {\n    // \u521b\u5efa\u4e00\u4e2a\u6307\u5411 void* \u7c7b\u578b\u7684\u6307\u9488\u6570\u7ec4\n    void **contents = malloc(2 * sizeof(void*));\n\n    // \u521b\u5efa\u5e76\u63d2\u5165\u952e\u503c\u5bf9\n    KeyValuePair* pair1 = malloc(sizeof(KeyValuePair));\n    pair1-&gt;key = \"apple\";\n    pair1-&gt;value = 10;\n    contents[0] = pair1;\n\n    KeyValuePair* pair2 = malloc(sizeof(KeyValuePair));\n    pair2-&gt;key = \"banana\";\n    pair2-&gt;value = 20;\n    contents[1] = pair2;\n\n    // \u8bfb\u53d6\u952e\u503c\u5bf9\n    for (int i = 0; i &lt; 2; i++) {\n        KeyValuePair* pair = (KeyValuePair*)contents[i];\n        printf(\"Key: %s, Value: %d\\n\", pair-&gt;key, pair-&gt;value);\n    }\n\n    // \u91ca\u653e\u5185\u5b58\n    free(pair1);\n    free(pair2);\n    free(contents);\n\n    return 0;\n}\n</code></pre> <p>\u4f7f\u7528 <code>void **contents</code> \u6765\u5b58\u50a8\u6307\u5411 <code>KeyValuePair</code> \u7ed3\u6784\u4f53\u7684\u6307\u9488\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u6570\u7ec4\u4e2d\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u952e\u503c\u5bf9\u6570\u636e\u3002</p> </li> <li> <p>2024\u5e74\u8865\u5145\uff1a\u4e8c\u91cd\u6307\u9488\u5b58\u50a8\u952e\u503c\u5bf92</p> <ul> <li>\u6570\u7ec4\u4e0b\u6807\u4f5c\u4e3a\u952e</li> <li>*argv[0] \u624d\u662f\u5185\u5bb9 </li> </ul> </li> </ul>","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_12","title":"\u6570\u7ec4\u6307\u9488","text":"<p>\u5b9e\u9645\u4e0a\u8fd8\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6307\u9488\uff0c\u8be5\u6307\u9488\u6307\u5411\u4e00\u4e2a\u6570\u7ec4\u3002</p> <pre><code>int  (* pa)[3]; //\u5b9a\u4e49\u6570\u7ec4\u6307\u9488:  \u5176\u6307\u5411\u7684\u7c7b\u578b\u662f\u6570\u7ec4(\u67093\u4e2a\u6574\u578b\u6570\u5143\u7d20)\n                 //\u66ff\u6362\u6cd5(\u7528a \u66ff\u4ee3*pa \uff0c\u5219pa\u662f\u6307\u5411a\u6570\u7ec4\u7684\u6307\u9488) \n</code></pre> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u540d\u4e3a<code>pa</code>\u7684\u6307\u9488\uff0c\u5b83\u6307\u5411\u4e00\u4e2a\u5177\u67093\u4e2a\u6574\u6570\u5143\u7d20\u7684\u6570\u7ec4\u3002\u6211\u4eec\u53ef\u4ee5\u5c06<code>pa</code>\u770b\u4f5c\u662f\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\uff0c\u800c\u4e0d\u662f\u6307\u5411\u5355\u4e2a\u6574\u6570\u7684\u6307\u9488\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u4e2a\u66f4\u5177\u4f53\u7684\u4f8b\u5b50\uff1a</p> <pre><code>int arr[3] = {1, 2, 3};  // \u5b9a\u4e49\u4e00\u4e2a\u5305\u542b3\u4e2a\u6574\u6570\u5143\u7d20\u7684\u6570\u7ec4\nint (*pa)[3];            // \u5b9a\u4e49\u4e00\u4e2a\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\n\npa = &amp;arr;               // \u5c06\u6307\u9488pa\u6307\u5411\u6570\u7ec4arr\n\nprintf(\"%d\\n\", (*pa)[0]);  // \u8f93\u51fa\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u53731\nprintf(\"%d\\n\", (*pa)[1]);  // \u8f93\u51fa\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\uff0c\u53732\nprintf(\"%d\\n\", (*pa)[2]);  // \u8f93\u51fa\u6570\u7ec4\u7684\u7b2c\u4e09\u4e2a\u5143\u7d20\uff0c\u53733\n</code></pre> <p>\u9996\u5148\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5305\u542b3\u4e2a\u6574\u6570\u5143\u7d20\u7684\u6570\u7ec4<code>arr</code>\u3002\u7136\u540e\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488<code>pa</code>\u3002\u901a\u8fc7\u4f7f\u7528<code>&amp;</code>\u8fd0\u7b97\u7b26\uff0c\u5c06<code>pa</code>\u6307\u5411\u6570\u7ec4<code>arr</code>\u7684\u5730\u5740\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528<code>(*pa)[index]</code>\u7684\u8bed\u6cd5\u6765\u8bbf\u95ee\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u3002\u6ce8\u610f\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u62ec\u53f7\u5c06<code>pa</code>\u62ec\u8d77\u6765\uff0c\u4ee5\u786e\u4fdd<code>(*pa)</code>\u88ab\u89e3\u91ca\u4e3a\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\uff0c\u800c\u4e0d\u662f\u6307\u5411\u6574\u6570\u7684\u6307\u9488\u3002\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u7d22\u5f15<code>index</code>\u6765\u8bbf\u95ee\u6570\u7ec4\u7684\u7279\u5b9a\u5143\u7d20, \u8f93\u51fa\u4e86\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u53731\u30012\u548c3\u3002</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_13","title":"\u51fd\u6570\u6307\u9488","text":"<p>\u5b58\u653e\u51fd\u6570\u7684\u5730\u5740</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_14","title":"\u56de\u8c03\u51fd\u6570(\u91cd\u8981)","text":"<ul> <li> <p>\u8bed\u6cd5\u5c42\u9762: \u5c06\u51fd\u6570\u540d\u505a\u53c2\u6570\u4f20\u5165\uff0c\u5408\u9002\u65f6\u5019\u56de\u8c03</p> </li> <li> <p>\u601d\u60f3\u5c42\u9762(\u91cd\u8981): \u6267\u884c\u65f6\u673a\uff0c\u7531\u5bf9\u65b9\u51b3\u5b9a(\u4f60\u662f\u63d0\u4f9b\u8005\u53ea\u77e5\u9053\u5982\u4f55\u5904\u7406\uff0c\u4f46\u6267\u884c\u7684\u65f6\u673a\uff0c\u4f7f\u7528\u8005\u624d\u77e5\u9053\u3002\u7531\u4f7f\u7528\u8005\u6765\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684\u4e1c\u897f)</p> </li> <li> <p>\u7c7b\u6bd4: \u60f3\u5403\u5305\u5b50\uff0c\u5305\u5b50\u8fd8\u6ca1\u597d\uff0c\u7559\u4e0b\u7535\u8bdd\u53f7\u7801\uff0c\u505a\u597d\u7684\u65f6\u5019\u901a\u77e5\u6211\u53bb\u5403(\u4e8b\u4ef6\u9a71\u52a8)</p> <ul> <li>\u5f02\u6b65\uff1a\u5403\u5305\u5b50\u7684 \u548c\u505a\u5305\u5b50\u7684 \u53ef\u72ec\u7acb\u505a\u81ea\u5df1\u4e8b\u60c5</li> <li>\u963b\u585e\u7b49\u5f85: \u5403\u5305\u5b50\u7684\u4e00\u76f4\u7b49\u5728\u54ea\u91cc\uff0c\u4e0d\u53bb\u505a\u81ea\u5df1\u4e8b\u60c5</li> </ul> </li> <li>\u5b9e\u9645\u573a\u666f: \u8981\u663e\u793a\u4e00\u56fe\u7247\uff0c\u4f46\u56fe\u7247\u9700\u8981\u4ece\u7f51\u5361\u8bfb\uff0c\u4f46\u7f51\u5361\u4ec0\u4e48\u6709\u56fe\u7247\u53ea\u6709\u7f51\u5361\u77e5\u9053\uff0c\u8ba9\u5b83\u6709\u7684\u65f6\u5019\u56de\u8c03\u6211\uff08\u6709\u70b9\u7c7b\u4f3c\u4e2d\u65ad)</li> </ul> <pre><code>//\u5403\u5305\u5b50\n#include &lt;stdio.h&gt;\n\n//\u6539\u8fdb\uff1a\u539f\u59cb\u65b9\u5f0f\u4f7f\u7528\u8d77\u6765\u9ebb\u70e6\uff0c\u7528typedef \u5b9a\u4e49\u65b0\u7684\u51fd\u6570\u6307\u9488\u7c7b\u578b\uff0c\u66f4\u7b80\u6d01 \u8fd8\u80fd\u7edf\u4e00\u683c\u5f0f: \u7c7b\u578b  \u53d8\u91cf\n//\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5c31\u7528pFun\u5c31\u884c,\u76f8\u5f53\u4e8e\u522b\u7684\u7c7b\u578b\u540dint callback\u7684int\ntypedef void (*pFun)(int data); \n\n\n//\u51fd\u6570\u6307\u9488\u57fa\u672c\u683c\u5f0f, void (*pFun)(int data) \n    //void:\u8868\u793a\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b;int data(...\u66f4\u591a\u53c2\u6570):\u51fd\u6570\u7684\u53c2\u6570;\n    //*pFun:\u51fd\u6570\u7684\u7c7b\u578b,\u5373\u540c\u6837\u7684\u53c2\u6570,\u540c\u6837\u7684\u8fd4\u56de\u7c7b\u578b,\u66f4\u91cd\u8981\u7684\u540c\u4e00\u7c7b\u7684\u529f\u80fd\n\n//\u6b63\u786e\u64cd\u4f5c\uff1avoid do_baozi( void (*callback)(int data) )   \n    //\u529f\u80fd: \u5411\u51fd\u6570do_baozi\u4f20\u5165\u51fd\u6570: callback\u7684\u5730\u5740.\n\n//\u5177\u4f53\u5206\u6790:\n    //\u51fd\u6570\u6307\u9488\u505a\u53c2\u6570\u7684\u65b9\u5f0f\u770b\u8d77\u6765\u6bd4\u8f83\u522b\u626d\n    //\u4fbf\u4e8e\u7406\u89e3\u4f46\u662f\u62a5\u9519\u8bed\u6cd5\uff1avoid do_baozi( (void (*)(int) pt);\n    //\u5c06\u53c2\u6570\u62bd\u79bb\u51fa\u6765, \u53c2\u6570\u7684\u7c7b\u578b\uff1avoid (*)(int) \u4fee\u9970\u53d8\u91cf pt(\u4ee3\u8868\u7684\u5c31\u662f\u51fd\u6570)\n    //\u7531\u4e8eC\u8bed\u8a00\u8bed\u6cd5\u89c4\u5b9a,\u5c06pt\u653e\u5230(*)\u91cc\uff1avoid do_baozi (void (*pt)(int))\n    //\u8fdb\u4e00\u6b65\u6539\u540d\uff1a---&gt; void do_baozi( void (*callback)(int data) )\n\n//\u603b\u7ed3:\n    //\u51fd\u6570\u6307\u9488\u672c\u8d28\u4e0a\u5c31\u662f\u4e2a\u6307\u9488\uff0c\u6307\u9488\u53d8\u91cf\u91cc\u9762\u5b58\u7740\u51fd\u6570\u7684\u5730\u5740\n    //\uff08\u50cf\u522b\u7684\u7c7b\u578b\u7684\u6307\u9488\u4e00\u6837(char*)\uff0c\u90fd\u5b58\u7740\u5730\u5740\uff0c\u4f46\u8fd9\u4e2a\u5b58\u7684\u662f\u51fd\u6570\u5730\u5740\uff09\n    //\u6240\u4ee5\u5728\u4f60\u7528\u7684\u65f6\u5019 \u76f4\u63a5\u7528callback\u5373\u53ef\n\nvoid do_baozi(pFun callback)\n{\n   printf(\"\u505a\u597d\u5305\u5b50\u4e86\\n\"); //\u6267\u884c\u65f6\u673a\u7531\u5bf9\u65b9\u51b3\u5b9a\n   callback(3); //\u56de\u8c03(\u6253\u7535\u8bdd\uff0c\u901a\u77e5\u5bf9\u65b9\u5403)\n}\n\nvoid eat1(int data)\n{\n   printf(\"\u5403\u5305\u5b50:%d\\n\",data);  //\u5982\u4f55\u5904\u7406\u6211\u77e5\u9053\n}\n\nint main()\n{\n   do_baozi(eat1); //\u51fd\u6570\u540d\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\uff08\u7559\u4e0b\u7535\u8bdd\u53f7\u7801\uff08\u51fd\u6570\u540d\uff09\uff0c\u5373\u51fd\u6570\u6307\u9488\uff09\n   return 0;\n}\n</code></pre> <p>\u51fd\u6570\u5730\u5740\u4e5f\u662f\u4e00\u79cd\u7c7b\u578b</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_15","title":"\u8fd4\u56de\u51fd\u6570\u6307\u9488","text":"<ul> <li>\u5e94\u7528\u573a\u666f: \u8ba1\u7b97\u5668\u7684\u4e0d\u540c\u64cd\u4f5c</li> </ul> <pre><code>#include &lt;stdio.h&gt;\ntypedef int (*opFunc)(int,int); //\u81ea\u5b9a\u4e49\u51fd\u6570\u6307\u9488 \u65b0\u7c7b\u578b\nint add(int a,int b){\n    return a+b;\n}\nint sub(int a,int b){\n    return a-b;\n}\n//\u529f\u80fd\uff1a\u901a\u8fc7\u64cd\u4f5c\u7801\uff0c\u9009\u62e9\u4e0d\u540c\u7684\u64cd\u4f5c\u51fd\u6570\nopFunc select(char opcode){ //\u51fd\u6570\u6307\u9488 \u505a\u8fd4\u56de\u503c\n    switch(opcode){\n        case '+': return add; //\u8fd4\u56de\u51fd\u6570\u540d\n        case '-': return sub;\n        default:\n           printf(\"no find op name =%c\\n\",opcode);\n           return NULL; //\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u7a7a\u6307\u9488\n    }\n}\nint run(char opcode,int a,int b){\n  opFunc  fn=select(opcode); //fn\u662f\u5b58\u653e\u8fd4\u56de\u7684\u51fd\u6570\u5730\u5740\u7684\u6307\u9488\n  return fn(a,b); //\u901a\u8fc7\u51fd\u6570\u6307\u9488\u8c03\u7528\u51fd\u6570\n}\nint main(){\n   printf(\"%d\\n\",run('+',6,2)); \n   printf(\"%d\\n\",run('-',6,2));    \n   return 0;\n}   \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_16","title":"\u51fd\u6570\u6307\u9488\u6570\u7ec4","text":"<pre><code>#include &lt;stdio.h&gt;\ntypedef void (*opFunc)(void);\n\nvoid power()\n{\n    printf(\"\u5f00\u673a\\n\");\n}\nvoid volume_up()\n{\n    printf(\"\u97f3\u91cf\u52a0\\n\");\n}\nvoid volume_down()\n{\n    printf(\"\u97f3\u91cf\u51cf\\n\");\n} \nint main()\n{\n    // int *control[] = {power, volume_up, volume_down};  //\u8fd9\u6837\u5b50\u884c\u4e0d\u884c?\uff0c\n    // //\u51fd\u6570\u540d\u4f20\u8fdb\u6765\u662f\u4e00\u4e2a\u5730\u5740\uff0c\u4e00\u4e2a\u5730\u5740\u672c\u8eab\u5c31\u53ef\u4ee5\u662f\u4e00\u4e2a\u53d8\u91cf\uff08\u6307\u9488\uff09,\u7528int*\u53ef\u4ee5\u4e0d\uff1f\n    // //C\u8bed\u8a00\u7f16\u8bd1\u5668\u662f\u4e25\u683c\u7c7b\u578b\u68c0\u6d4b\u7684\uff0c\u5e76\u4e0d\u8fd0\u884c\u4e0a\u8ff0\u7684\u884c\u4e3a. C\u8bed\u8a00\u6839\u636e\u7c7b\u578b\u6709\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u540c\u6837\u662f\u6570\uff0c\u4f46\u6709\u4e0d\u4e00\u6837\u7684\u610f\u4e49\n    // //\u7531\u4e8e\u6570\u7ec4\u91cc\u5b58\u7684\u662f\u51fd\u6570\uff0c\u6240\u4ee5\u6570\u7ec4\u7c7b\u578b\u4e5f\u5e94\u8be5\u662f\u5b58\u653e\u51fd\u6570\u5730\u5740\u7684\u7c7b\u578b\uff0c\u5c31\u662f\u51fd\u6570\u6307\u9488\n\n    opFunc control[] = {power, volume_up, volume_down};\n    // void (*control[])(void) = {power, volume_up, volume_down};\n\n\n    // \u5148\u627e\u5230\u51fd\u6570\uff1apower ,\u518d\u7528()\u6267\u884c\u7c7b\u4f3c\u89e3\u5f15\u7528\u7684\u64cd\u4f5c \n    // \u518d\u7528\u66ff\u6362\u6cd5\uff0c\u5c06power\u6362\u6210\u7ed9control[0]\n    //\u8fd9\u6837\u5b50\u4f7f\u7528\u5c31\u548c\u6570\u7ec4\u6307\u9488\u6709\u70b9x\n    control[0](); \n    control[1]();\n    control[2]();\n\n    return 0;\n}\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#0x100000","title":"\u4f8b: \u8ba9\u7a0b\u5e8f\u8df3\u8f6c\u5230\u7edd\u5bf9\u5730\u5740\u662f0x100000\u53bb\u6267\u884c","text":"<p>\u95ee\uff1a\u8981\u5bf9\u7edd\u5bf9\u5730\u57400x100000\u8d4b\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528     ((unsigned int )0x100000) = 1234;   //\u5c060x100000\u8f6c\u6210\u6307\u9488\u53d8\u91cf\u4e86</p> <p>\u200b    \u90a3\u4e48\u8981\u662f\u60f3\u8ba9\u7a0b\u5e8f\u8df3\u8f6c\u5230\u7edd\u5bf9\u5730\u5740\u662f0x100000\u53bb\u6267\u884c\uff0c\u5e94\u8be5\u600e\u4e48\u505a\uff1f</p> <p>PC\u6307\u9488?</p> <p></p> <pre><code>\u7b54\u6848\uff1a*((void (*)( ))0x100000 )( );\n\u3000\u30001. \u9996\u5148\u8981\u5c060x100000\u5f3a\u5236\u8f6c\u6362\u6210\u51fd\u6570\u6307\u9488,\u5373://\u5b58\u653e\u4ee3\u7801\u5757\u51fd\u6570\u5f00\u5934\u7684\u5730\u5740\n\u3000\u3000(void (*)())0x100000\n\u3000\u30002. \u7136\u540e\u518d\u8c03\u7528\u5b83:\n\u3000\u3000*((void (*)())0x100000)();\n\n\u3000\u3000\u7528typedef\u53ef\u4ee5\u770b\u5f97\u66f4\u76f4\u89c2\u4e9b:\n\u3000\u3000typedef void(*voidFuncPtr)() ;\n\u3000\u3000*((voidFuncPtr)0x100000)();  \n// \u5c06*((voidFuncPtr)0x100000)\u770b\u6210\u4e00\u4e2a\u51fd\u6570\u540d\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_17","title":"\u5176\u4ed6","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#static","title":"\u53d8\u91cf\u5b58\u50a8\u7c7b\u578b\u548cstatic","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_18","title":"\u53d8\u91cf\u5b58\u50a8\u7c7b\u578b","text":"<ul> <li>\u9759\u6001\u53d8\u91cf</li> </ul> <p>\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u58f0\u660e\u7684\u53d8\u91cf, \u4e14\u5b58\u50a8\u4e8e\u9759\u6001\u5185\u5b58\u4e2d, \u4e0d\u5c5e\u4e8e\u6808\u7684\u5185\u5b58</p> <ul> <li>\u5168\u5c40\u53d8\u91cf</li> </ul> <p>\u5728\u51fd\u6570\u5916\u90e8\u6216\u8005\u4ee3\u7801\u5757\u4e4b\u5916\u58f0\u660e\u7684\u53d8\u91cf, \u4e14\u5b58\u50a8\u4e8e\u9759\u6001\u5185\u5b58\u4e2d, \u4e0d\u5c5e\u4e8e\u5806\u6808\u7684\u5185\u5b58</p> <ul> <li>\u81ea\u52a8\u53d8\u91cf</li> </ul> <p>\u5728\u4ee3\u7801\u5757\u4e4b\u5185\u58f0\u660e\u7684\u53d8\u91cf, \u5b58\u50a8\u4e8e\u6808\u4e2d</p> <ul> <li>\u5bc4\u5b58\u5668\u53d8\u91cf</li> </ul>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_19","title":"\u9759\u6001\u53d8\u91cf\u548c\u5168\u5c40\u53d8\u91cf\u7684\u533a\u522b","text":"<p>\u9759\u6001\u53d8\u91cf\u548c\u5168\u5c40\u53d8\u91cf==\u90fd\u5b58\u50a8\u5728\u9759\u6001\u5185\u5b58==\u4e2d\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u662f\u6301\u4e45\u7684\uff0c</p> <p>\u5373\u5b83\u4eec\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u5c31\u4f1a\u88ab\u5206\u914d\u5185\u5b58\uff0c\u5e76\u5728\u6574\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u90fd\u5b58\u5728\u3002</p> <p>\u533a\u522b\u5728\u4e8e==\u4f5c\u7528\u57df\u548c\u53ef\u89c1\u6027==\uff1a</p> <ol> <li>\u5168\u5c40\u53d8\u91cf\u5177\u6709\u5168\u5c40\u4f5c\u7528\u57df\uff0c\u5373\u5728\u6574\u4e2a\u7a0b\u5e8f\u4e2d\u90fd\u53ef\u89c1\u3002\u5b83\u4eec\u53ef\u4ee5\u5728\u4efb\u4f55\u51fd\u6570\u5185\u90e8\u6216\u4ee3\u7801\u5757\u5916\u90e8\u8bbf\u95ee\u3002</li> <li>\u9759\u6001\u53d8\u91cf\u5177\u6709\u5757\u4f5c\u7528\u57df\uff0c\u5373\u5728\u58f0\u660e\u5b83\u4eec\u7684\u51fd\u6570\u5185\u90e8\u53ef\u89c1\u3002\u5b83\u4eec\u53ea\u80fd\u5728\u58f0\u660e\u5b83\u4eec\u7684\u51fd\u6570\u5185\u90e8\u8bbf\u95ee\uff0c\u5176\u4ed6\u51fd\u6570\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u3002</li> </ol> <p>\u6b64\u5916\uff0c\u5168\u5c40\u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528<code>extern</code>\u5173\u952e\u5b57\u5728\u5176\u4ed6\u6587\u4ef6\u4e2d\u8fdb\u884c\u58f0\u660e\u5e76\u8bbf\u95ee\u3002\u800c\u9759\u6001\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u9650\u5b9a\u5728\u58f0\u660e\u5b83\u4eec\u7684\u51fd\u6570\u5185\u90e8\uff0c\u65e0\u6cd5\u5728\u5176\u4ed6\u6587\u4ef6\u4e2d\u76f4\u63a5\u8bbf\u95ee\u3002</p> <p>\u5177\u4f53\u4e3e\u4f8b:</p> <ul> <li> <p>\u5168\u5c40\u53d8\u91cf</p> <pre><code>#include &lt;stdio.h&gt;\n\nint globalVariable = 10; // \u5168\u5c40\u53d8\u91cf\u7684\u5b9a\u4e49\n\nvoid function1() {\n    printf(\"Global variable: %d\\n\", globalVariable); // \u5728\u51fd\u6570\u5185\u90e8\u8bbf\u95ee\u5168\u5c40\u53d8\u91cf\n}\n\nint main() {\n    printf(\"Global variable: %d\\n\", globalVariable); // \u5728main\u51fd\u6570\u5185\u90e8\u8bbf\u95ee\u5168\u5c40\u53d8\u91cf\n    function1();\n    return 0;\n}\n//globalVariable\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u5728\u51fd\u6570\u5916\u90e8\u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u5728main()\u51fd\u6570\u548cfunction1()\u51fd\u6570\u5185\u90e8\uff0c\u90fd\u53ef\u4ee5\u8bbf\u95ee\u548c\u4f7f\u7528\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf\u3002\n</code></pre> </li> <li> <p>\u9759\u6001\u53d8\u91cf</p> <pre><code>#include &lt;stdio.h&gt;\n            \nvoid function1() {\n    static int staticVariable = 10; // \u9759\u6001\u53d8\u91cf\u7684\u5b9a\u4e49\n    printf(\"Static variable: %d\\n\", staticVariable); // \u5728\u51fd\u6570\u5185\u90e8\u8bbf\u95ee\u9759\u6001\u53d8\u91cf\n    staticVariable++;\n}\n            \nint main() {\n    function1();\n    function1();\n    return 0;\n}\n//staticVariable\u662f\u4e00\u4e2a\u9759\u6001\u53d8\u91cf\uff0c\u5b83\u5728function1()\u51fd\u6570\u5185\u90e8\u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u6bcf\u6b21\u8c03\u7528function1()\u51fd\u6570\u65f6\uff0c\u9759\u6001\u53d8\u91cf\u7684\u503c\u90fd\u4f1a\u4fdd\u7559\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u51fd\u6570\u5185\u90e8\u8fdb\u884c\u4fee\u6539\u3002\n//\u9759\u6001\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u4ec5\u9650\u4e8e\u58f0\u660e\u5b83\u4eec\u7684\u51fd\u6570\u5185\u90e8\u3002\u5176\u4ed6\u51fd\u6570\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u548c\u4f7f\u7528\u9759\u6001\u53d8\u91cf.\n</code></pre> </li> </ul> <p>\u6240\u4ee5\uff0c\u867d\u7136\u9759\u6001\u53d8\u91cf\u548c\u5168\u5c40\u53d8\u91cf\u5728\u5b58\u50a8\u65b9\u5f0f\u4e0a\u76f8\u540c\uff0c\u4f46\u5728\u4f5c\u7528\u57df\u548c\u53ef\u89c1\u6027\u4e0a\u6709\u6240\u533a\u522b\u3002</p> <p>\u8865\u5145\u56fe\u89e3\uff1a</p> <p>C\u8bed\u8a00</p> <ol> <li>\u4ee3\u7801\u533a- \u5b58\u653e\u7a0b\u5e8f\u7684\u6267\u884c\u4ee3\u7801(\u673a\u5668\u6307\u4ee4\uff09</li> <li>\u6808\u533a- \u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u5206\u914d\u91ca\u653e</li> <li>\u5806\u533a - \u4e00\u822c\u7531\u7a0b\u5e8f\u5458\u5206\u914d\u91ca\u653e\uff0c\u82e5\u7a0b\u5e8f\u5458\u4e0d\u91ca\u653e\uff0c\u7a0b\u5e8f\u7ed3\u675f\u65f6\u53ef\u80fd\u7531OS\u56de\u6536</li> <li> <p>\u5168\u5c40\u533a(\u9759\u6001\u533a)\uff08\u4e5f\u5c31\u662fBSS\u6bb5\u548cdata\u6bb5\uff09\u548c\u5e38\u91cf\u533a\uff0c\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u7684\u5b58\u50a8\u662f\u653e\u5728\u4e00\u5757\u7684\uff0c\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u5728\u4e00\u5757\u533a\u57df\uff0c\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u548c\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\u5728\u76f8\u90bb\u7684\u53e6\u4e00\u5757\u533a\u57df\u3002</p> </li> <li> <p>\u5e38\u91cf\u533a</p> </li> </ol> <p></p> <p>\u62d3\u5c55\uff1aC++\u4e2d</p> <ol> <li>\u4ee3\u7801\u533a\uff0c\u4e3b\u8981\u662f\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u6c47\u7f16\u4ee3\u7801\u6216\u673a\u5668\u6307\u4ee4\u3002</li> <li>\u6808\u533a\uff0c\u5c31\u662f\u90a3\u4e9b\u7531\u7f16\u8bd1\u5668\u5728\u9700\u8981\u7684\u65f6\u5019\u5206\u914d\uff0c\u5728\u4e0d\u9700\u8981\u7684\u65f6\u5019\u81ea\u52a8\u6e05\u695a\u7684\u53d8\u91cf\u7684\u5b58\u50a8\u533a\u3002\u91cc\u9762\u7684\u53d8\u91cf\u901a\u5e38\u662f\u5c40\u90e8\u53d8\u91cf\u3001\u51fd\u6570\u53c2\u6570\u7b49\u3002</li> <li>\u5806\u533a(\u6216 \u81ea\u7531\u5b58\u50a8\u533a )\uff0c\u5c31\u662f\u90a3\u4e9b\u7531new\u5206\u914d\u7684\u5185\u5b58\u5757\uff0c\u4ed6\u4eec\u7684\u91ca\u653e\u7f16\u8bd1\u5668\u4e0d\u53bb\u7ba1\uff0c\u7531\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u53bb\u63a7\u5236\uff0c\u4e00\u822c\u4e00\u4e2anew\u5c31\u8981\u5bf9\u5e94\u4e00\u4e2adelete\u3002\u5982\u679c\u7a0b\u5e8f\u5458\u6ca1\u6709\u91ca\u653e\u6389\uff0c\u90a3\u4e48\u5728\u7a0b\u5e8f\u7ed3\u675f\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u56de\u6536\u3002 \u6216\u8005**\u662f\u90a3\u4e9b\u7531malloc\u7b49\u5206\u914d\u7684\u5185\u5b58\u5757\uff0c\u4ed6\u548c\u5806\u662f\u5341\u5206\u76f8\u4f3c\u7684\uff0c\u4e0d\u8fc7\u5b83\u662f\u7528free\u6765\u7ed3\u675f\u81ea\u5df1\u7684\u751f\u547d\u7684\u3002</li> <li>\u5168\u5c40/\u9759\u6001\u5b58\u50a8\u533a\uff0c\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u88ab\u5206\u914d\u5230\u540c\u4e00\u5757\u5185\u5b58\u4e2d\uff0c\u5728\u4ee5\u524d\u7684C\u8bed\u8a00\u4e2d\uff0c\u5168\u5c40\u53d8\u91cf\u53c8\u5206\u4e3a\u521d\u59cb\u5316\u7684\u548c\u672a\u521d\u59cb\u5316\u7684\uff0c\u5728C++\u91cc\u9762\u6ca1\u6709\u8fd9\u4e2a\u533a\u5206\u4e86\uff0c\u4ed6\u4eec\u5171\u540c\u5360\u7528\u540c\u4e00\u5757\u5185\u5b58\u533a\u3002</li> <li>\u5e38\u91cf\u5b58\u50a8\u533a\uff0c\u8fd9\u662f\u4e00\u5757\u6bd4\u8f83\u7279\u6b8a\u7684\u5b58\u50a8\u533a\uff0c\u4ed6\u4eec\u91cc\u9762\u5b58\u653e\u7684\u662f\u5e38\u91cf\uff0c\u4e0d\u5141\u8bb8\u4fee\u6539\uff08\u5f53\u7136\uff0c\u4f60\u8981\u901a\u8fc7\u975e\u6b63\u5f53\u624b\u6bb5\u4e5f\u53ef\u4ee5\u4fee\u6539\uff09</li> </ol> <p>[c/c++\u4e2d\u5185\u5b58\u533a\u57df\u5212\u5206\u5927\u603b\u7ed3-\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a (aliyun.com)](https://developer.aliyun.com/article/496107#:~:text=\u5728c\u4e2d\u5206\u4e3a\u8fd9\u51e0\u4e2a\u5b58\u50a8\u533a1.\u4ee3\u7801\u533a- \u5b58\u653e\u7a0b\u5e8f\u7684\u6267\u884c\u4ee3\u7801 (\u673a\u5668\u6307\u4ee4\uff092.\u6808\u533a-,\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u5206\u914d\u91ca\u653e3.\u5806\u533a - \u4e00\u822c\u7531\u7a0b\u5e8f\u5458\u5206\u914d\u91ca\u653e\uff0c\u82e5\u7a0b\u5e8f\u5458\u4e0d\u91ca\u653e\uff0c\u7a0b\u5e8f\u7ed3\u675f\u65f6\u53ef\u80fd\u7531OS\u56de\u65364.\u5168\u5c40\u533a (\u9759\u6001\u533a)\u548c\u5e38\u91cf\u533a\uff0c\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u7684\u5b58\u50a8\u662f\u653e\u5728\u4e00\u5757\u7684\uff0c\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u5728\u4e00\u5757\u533a\u57df\uff0c\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u548c\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\u5728\u76f8\u90bb\u7684\u53e6\u4e00\u5757\u533a\u57df\u3002)</p>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#static_1","title":"\u5173\u4e8estatic\u7684\u603b\u7ed3","text":"<ul> <li>\u7528\u4e8e\u51fd\u6570\u5b9a\u4e49\u3001\u6216\u8005\u4ee3\u7801\u5757\u4e4b\u5916\u7684\u58f0\u660e\u53d8\u91cf</li> </ul> <p>\u6b64\u65f6static\u7528\u4e8e\u6539\u53d8\u5176==\u94fe\u63a5\u5c5e\u6027==, \u5c06externa\u6539\u4e3ainternal, \u4f46\u662f\u5b83\u4eec\u7684\u5b58\u50a8\u7c7b\u578b\u548c\u4f5c\u7528\u57df\u4e0d\u53d7\u5f71\u54cd. \u6b64\u79cd\u65b9\u5f0f\u751f\u547d\u7684\u51fd\u6570\u6216\u53d8\u91cf\u53ea\u80fd\u5728\u58f0\u660e\u5b83\u4eec\u7684\u6e90\u6587\u4ef6\u4e2d\u8bbf\u95ee</p> <ul> <li>\u7528\u4e8e\u4ee3\u7801\u5757\u5185\u90e8\u7684\u53d8\u91cf\u58f0\u660e</li> </ul> <p>\u6b64\u65f6static\u4fee\u6539\u53d8\u91cf\u7684==\u5b58\u50a8\u7c7b\u578b==, \u4ece\u81ea\u52a8\u53d8\u91cf\u6539\u4e3a\u9759\u6001\u53d8\u91cf, \u4f46\u662f\u53d8\u91cf\u7684\u8fde\u63a5\u7c7b\u578b\u548c\u4f5c\u7528\u57df\u4e0d\u5f71\u54cd. \u8fd9\u79cd\u65b9\u5f0f\u58f0\u660e\u7684\u53d8\u91cf\u5728\u7a0b\u5e8f\u6267\u884c\u524d\u521b\u5efa,\u5728\u6574\u4e2a\u7a0b\u5e8f\u6267\u884c\u671f\u95f4\u4e00\u76f4\u5b58\u5728.</p> <ul> <li> <p>\u82e5\u662f\u60f3\u8bbf\u95ee\u522b\u7684.c\u6587\u4ef6\u91cc\u9762\u7684static\u53d8\u91cf, \u5219\u9700\u8981\u7528\u5230\u6307\u9488</p> <pre><code> //ex22.c\n double *get_ratio()\n {\n     static double ratio = 1.0;\n     return &amp;ratio;\n }\n\n//ex22_main.c\ndouble *ratio_ptr = get_ratio();\nlog_info(\"for test ratio:%f\",*ratio_ptr);\n*ratio_ptr = 10.0;\nlog_info(\"for test ratio:%f\",*ratio_ptr);\n</code></pre> </li> <li> <p>\u73b0\u4ee3C\u8bed\u8a00static\u6bd4\u8f83\u5c11\u7528</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7b80\u5355\u7684C\u8bed\u8a00\u9879\u76ee\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u540d\u4e3a<code>counter.c</code>\u7684\u6e90\u6587\u4ef6\uff0c\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e2a\u8ba1\u6570\u5668\u7684\u529f\u80fd\u3002\u6211\u4eec\u5c06\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u548c\u9759\u6001\u51fd\u6570\u6765\u5b9e\u73b0\u8ba1\u6570\u5668\uff0c\u5e76\u5c1d\u8bd5\u8bf4\u660e\u4e3a\u4ec0\u4e48\u5728\u73b0\u4ee3C\u8bed\u8a00\u4e2d\uff0cstatic\u5f88\u5c11\u4f7f\u7528\uff0c\u800c\u4e14\u5f88\u96be\u4e0e\u7ebf\u7a0b\u4f7f\u7528\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u548c\u9759\u6001\u51fd\u6570\u7684\u4ee3\u7801\uff1a</p> <pre><code>// counter.c\n\n#include &lt;stdio.h&gt;\n\nstatic int count = 0;\n\nstatic void incrementCounter() {\n    count++;\n}\n\nvoid printCounter() {\n    printf(\"The counter is: %d\\n\", count);\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u9759\u6001\u53d8\u91cf<code>count</code>\u548c\u9759\u6001\u51fd\u6570<code>incrementCounter</code>\u6765\u5b9e\u73b0\u8ba1\u6570\u5668\u3002\u7136\u540e\u6211\u4eec\u5728\u53e6\u4e00\u4e2a\u6e90\u6587\u4ef6<code>main.c</code>\u4e2d\u8c03\u7528\u8fd9\u4e9b\u51fd\u6570\uff1a</p> <pre><code>// main.c\n\n#include &lt;stdio.h&gt;\n\nextern void printCounter();\nextern void incrementCounter();\n\nint main() {\n    incrementCounter();\n    printCounter();\n    return 0;\n}\n</code></pre> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u8bf4\u660e\u4e3a\u4ec0\u4e48\u5728\u73b0\u4ee3C\u8bed\u8a00\u4e2d\uff0cstatic\u5f88\u5c11\u4f7f\u7528\uff0c\u800c\u4e14\u5f88\u96be\u4e0e\u7ebf\u7a0b\u4f7f\u7528\uff1a</p> <ol> <li> <p>\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\uff1a\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u548c\u51fd\u6570\u4f1a\u4f7f\u4ee3\u7801\u66f4\u96be\u4ee5\u7406\u89e3\u548c\u7ef4\u62a4\u3002\u5f53\u9879\u76ee\u53d8\u5f97\u66f4\u52a0\u590d\u6742\u65f6\uff0c\u9759\u6001\u53d8\u91cf\u548c\u51fd\u6570\u4f1a\u5bfc\u81f4\u4ee3\u7801\u7684\u7ed3\u6784\u53d8\u5f97\u6df7\u4e71\uff0c\u4f7f\u5f97\u4ee3\u7801\u7684\u7ef4\u62a4\u548c\u4fee\u6539\u53d8\u5f97\u66f4\u52a0\u56f0\u96be\u3002</p> <p>\u4e3a\u4ec0\u4e48\u53d8\u5f97\u6df7\u4e71\u4e86?</p> </li> <li> <p>\u53ef\u91cd\u7528\u6027\uff1a\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u548c\u51fd\u6570\u4f1a\u4f7f\u4ee3\u7801\u96be\u4ee5\u91cd\u7528\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u5728\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u8ba1\u6570\u5668\u529f\u80fd\uff0c\u6211\u4eec\u5c06\u65e0\u6cd5\u8bbf\u95ee<code>count</code>\u53d8\u91cf\u6216<code>incrementCounter</code>\u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u4f5c\u7528\u57df\u88ab\u9650\u5236\u5728<code>counter.c</code>\u6587\u4ef6\u4e2d\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168\u6027\uff1a\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u548c\u51fd\u6570\u4f1a\u4f7f\u4ee3\u7801\u96be\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u4f7f\u7528\u8ba1\u6570\u5668\uff0c\u6211\u4eec\u5c06\u65e0\u6cd5\u786e\u4fdd<code>count</code>\u53d8\u91cf\u548c<code>incrementCounter</code>\u51fd\u6570\u5728\u4e0d\u540c\u7ebf\u7a0b\u4e2d\u7684\u8c03\u7528\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u9759\u6001\u53d8\u91cf\u548c\u51fd\u6570\u7684\u72b6\u6001\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u3002</p> </li> </ol> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u548c\u53ef\u91cd\u7528\u6027\uff0c\u5e76\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\uff0c\u73b0\u4ee3C\u8bed\u8a00\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u66f4\u5b89\u5168\u3001\u66f4\u660e\u786e\u7684\u65b9\u6cd5\u6765\u7ba1\u7406\u53d8\u91cf\u548c\u51fd\u6570\u7684\u4f5c\u7528\u57df\u548c\u53ef\u89c1\u6027\uff0c\u4f8b\u5982\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u3001\u6a21\u5757\u5316\u7f16\u7a0b\u548c\u5c01\u88c5\u7b49\u6280\u672f\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u7ebf\u7a0b\u5b89\u5168\u673a\u5236\u6765\u786e\u4fdd\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u5b89\u5168\u8bbf\u95ee\u3002</p> </li> </ul>"},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_20","title":"\u5173\u4e8e\u4f20\u9012\u53c2\u6570","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_21","title":"\u5173\u4e8e","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#_22","title":"\u6761\u4ef6\u8fd0\u7b97\u7b26","text":""},{"location":"language/C_asm/Basic%20C/base1/basic1.html#switch-case_1","title":"switch case","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html","title":"\u5185\u5b58\u5206\u914d","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_1","title":"\u603b\u4f53\u6982\u8ff0","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nconst int    g_A       = 10;         //\u5e38\u91cf\u533a \nint          g_B       = 20;         //\u6570\u636e\u6bb5  \nstatic int   g_C       = 30;         //\u6570\u636e\u6bb5  \nstatic int   g_D;                    //BSS\u6bb5  \nint          g_E;                    //BSS\u6bb5  \nchar        *p1;                     //BSS\u6bb5  \n\nint main()\n{\n    int           local_A;            //\u6808  \n    int           local_B;            //\u6808  \n    static int    local_C = 0;        //BSS\u6bb5(\u521d\u503c\u4e3a0 \u7b49\u4e8e\u6ca1\u521d\u59cb\u5316\uff0c\u4f1a\u653e\u5728BSS\u6bb5 )  \n    static int    local_D;            //\u6570\u636e\u6bb5  \n\n    char        *p3 = \"123456\";       //123456\u5728\u4ee3\u7801\u6bb5\uff0cp3\u5728\u6808\u4e0a  \n\n    p1 = (char *)malloc( 10 );        //\u5806\uff0c\u5206\u914d\u5f97\u6765\u5f9710\u5b57\u8282\u7684\u533a\u57df\u5728\u5806\u533a  \n    char *p2 = (char *)malloc( 20 );  //\u5806\u4e0a\u518d\u5206\u914d\uff0c\u5411\u4e0a\u751f\u957f\n    strcpy( p1, \"123456\" );           //123456{post.content}\u653e\u5728\u5e38\u91cf\u533a\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5c06\u5b83\u4e0ep3\u6240\u6307\u5411 \u7684\"123456\"\u4f18\u5316\u6210\u4e00\u5757  \n\n    printf(\"hight address\\n\");  \n    printf(\"-------------\u6808--------------\\n\");  \n    printf( \"\u6808,    \u5c40\u90e8\u53d8\u91cf,                           local_A, addr:0x%08x\\n\", &amp;local_A );  \n    printf( \"\u6808,    \u5c40\u90e8\u53d8\u91cf,(\u540e\u8fdb\u6808\u5730\u5740\u76f8\u5bf9local_A\u4f4e)  local_B, addr:0x%08x\\n\", &amp;local_B );  \n    printf(\"-------------\u5806--------------\\n\");  \n    printf( \"\u5806,    malloc\u5206\u914d\u5185\u5b58,             p2,     addr:0x%08x\\n\", p2 );  \n    printf( \"\u5806,    malloc\u5206\u914d\u5185\u5b58,             p1,     addr:0x%08x\\n\", p1 );  \n    printf(\"------------BSS\u6bb5------------\\n\");  \n    printf( \"BSS\u6bb5, \u5168\u5c40\u53d8\u91cf,       \u672a\u521d\u59cb\u5316    g_E,     addr:0x%08x\\n\", &amp;g_E, g_E );      \n    printf( \"BSS\u6bb5, \u9759\u6001\u5168\u5c40\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   g_D,     addr:0x%08x\\n\", &amp;g_D );  \n    printf( \"BSS\u6bb5, \u9759\u6001\u5c40\u90e8\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   local_C, addr:0x%08x\\n\", &amp;local_C);  \n    printf( \"BSS\u6bb5, \u9759\u6001\u5c40\u90e8\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   local_D, addr:0x%08x\\n\", &amp;local_D);  \n    printf(\"-----------\u6570\u636e\u6bb5------------\\n\");  \n    printf( \"\u6570\u636e\u6bb5,\u5168\u5c40\u53d8\u91cf,       \u521d\u59cb\u5316      g_B,     addr:0x%08x\\n\", &amp;g_B);  \n    printf( \"\u6570\u636e\u6bb5,\u9759\u6001\u5168\u5c40\u53d8\u91cf,   \u521d\u59cb\u5316,     g_C,     addr:0x%08x\\n\", &amp;g_C);  \n    printf(\"-----------\u4ee3\u7801\u6bb5------------\\n\");  \n    printf( \" \u5e38\u91cf\u533a                \u53ea\u8bfbconst,  g_A,     addr:0x%08x\\n\\n\", &amp;g_A);  \n    printf( \" \u7a0b\u5e8f\u4ee3\u7801\uff0c\u53ef\u53cd\u6c47\u7f16\u770b objdump -d a.out \\n\");\n    printf(\"low address\\n\");  \n    return 0;\n}\n\u8fd0\u884c\u7ed3\u679c:\nhight address\n-------------\u6808--------------\n\u6808,    \u5c40\u90e8\u53d8\u91cf,                  local_A, addr:0xc8419530\n\u6808,    \u5c40\u90e8\u53d8\u91cf,                  local_B, addr:0xc8419534\n-------------\u5806--------------\n\u5806,    malloc\u5206\u914d\u5185\u5b58,             p2,     addr:0xe22852c0\n\u5806,    malloc\u5206\u914d\u5185\u5b58,             p1,     addr:0xe22852a0\n------------BSS\u6bb5------------\nBSS\u6bb5, \u5168\u5c40\u53d8\u91cf,       \u672a\u521d\u59cb\u5316    g_E,     addr:0xe19c0020\nBSS\u6bb5, \u9759\u6001\u5168\u5c40\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   g_D,      addr:0xe19c0030\nBSS\u6bb5, \u9759\u6001\u5c40\u90e8\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   local_C,  addr:0xe19c0034\nBSS\u6bb5, \u9759\u6001\u5c40\u90e8\u53d8\u91cf,   \u672a\u521d\u59cb\u5316,   local_D,  addr:0xe19c0038\n-----------\u6570\u636e\u6bb5------------\n\u6570\u636e\u6bb5,\u5168\u5c40\u53d8\u91cf,       \u521d\u59cb\u5316      g_B,      addr:0xe19c0010\n\u6570\u636e\u6bb5,\u9759\u6001\u5168\u5c40\u53d8\u91cf,    \u521d\u59cb\u5316,     g_C, addr:0xe19c0014\n-----------\u4ee3\u7801\u6bb5------------\n\u5e38\u91cf\u533a                \u53ea\u8bfbconst,  g_A,      addr:0xe19be008\n\n \u7a0b\u5e8f\u4ee3\u7801\uff0c\u53ef\u53cd\u6c47\u7f16\u770b objdump -d a.out \nlow address\n</code></pre> <p>\u5728\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u6bcf\u4e2a\u5c40\u90e8\u53d8\u91cf\u90fd\u4f1a\u88ab\u5206\u914d\u5230\u6808\u4e0a\uff0c\u6808\u662f\u4e00\u79cd\u540e\u8fdb\u5148\u51fa\uff08LIFO\uff09\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u8bf4\u540e\u5b9a\u4e49\u7684\u53d8\u91cf\u4f1a\u5148\u8fdb\u6808\uff0c\u5148\u5b9a\u4e49\u7684\u53d8\u91cf\u4f1a\u540e\u8fdb\u6808\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0clocal_A\u5148\u5b9a\u4e49\uff0c\u4f46\u662f\u540e\u8fdb\u6808\uff0c\u6240\u4ee5\u5b83\u7684\u5730\u5740\u6bd4local_B\u7684\u5730\u5740\u9ad8\u3002\u53e6\u5916\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5bf9\u53d8\u91cf\u7684\u5185\u5b58\u5e03\u5c40\u8fdb\u884c\u4f18\u5316\uff0c\u6240\u4ee5\u5b9e\u9645\u7684\u5730\u5740\u5206\u914d\u53ef\u80fd\u4e0d\u5b8c\u5168\u6309\u7167\u4ee3\u7801\u4e2d\u7684\u987a\u5e8f\u8fdb\u884c\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_2","title":"\u5806\u7684\u52a8\u6001\u7533\u8bf7\u91ca\u653e","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_3","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_4","title":"\u901a\u8fc7\u51fd\u6570\u5206\u914d\u7a7a\u95f4","text":"<pre><code>//\u9519:\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid getmemory(char *p)\n{\n   p=(char *) malloc(100); \n   strcpy(p,\"hello world\");\n}\n\nint main( )\n{\n   char *str=NULL;\n   getmemory(str); \n   printf(\"%s\",str);\n   free(str);\n   return 0;\n}\n\n\n//\u6539:\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nvoid getmemory(char **  p)  \n{ \n\n   *p=(char *) malloc(100); //\u7533\u8bf7\u7a7a\u95f4\u9996\u5730\u5740\u4ed8\u7ed9\u4f20\u5165\u7684\u88abp\u6307\u5411\u7684\u6307\u9488\uff0c\u5373str\n   strcpy(*p,\"hello world\");\n}\n//p: \u6307\u5411\u6307\u9488\u7684\u6307\u9488\n//*p: p\u6307\u5411\u7684\u6307\u9488(\u5373str)\n//**p: \u6700\u7ec8malloc\u5206\u914d\u7684\u7a7a\u95f4(str\u6307\u5411\u7684\u5806\u7a7a\u95f4)\n\n//getmemory\u4f20\u5165\u6307\u9488str\u7684\u5730\u5740\u7ed9p \n//\u800c*p\u53d6\u5f97\u662f\u4f20\u5165\u53c2\u6570\u7684\u5730\u5740(\u4e5f\u5c31\u662fstr\u6307\u9488\u53d8\u91cf\u7684\u5730\u5740)\n//\u6700\u540e\u518d\u7528**p\u8bbf\u95ee\u5230\u4e86*str\u5177\u4f53\u7684\u503c\n\nint main( )\n{\n   char *str=NULL;\n   getmemory(&amp;str); //\u4f20\u5165\u6307\u9488\u53d8\u91cf\u672c\u8eab\u7684\u5730\u5740\n   printf(\"%s\",str);\n   free(str);\n   return 0;\n}\n</code></pre> <p>\u5f53\u6211\u4eec\u5728\u51fd\u6570\u4e2d\u9700\u8981\u4fee\u6539\u4e00\u4e2a\u6307\u9488\u7684\u503c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4f20\u9012\u6307\u9488\u7684\u5730\u5740\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f20\u9012\u6307\u9488\u672c\u8eab\u3002</p> <p>\u56e0\u4e3aC\u8bed\u8a00\u4e2d\uff0c\u51fd\u6570\u53c2\u6570\u4f20\u9012\u662f\u6309\u503c\u4f20\u9012\u7684\uff0c\u5373\u51fd\u6570\u5185\u90e8\u5bf9\u53c2\u6570\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5230\u51fd\u6570\u5916\u90e8\u7684\u53d8\u91cf\u3002</p> <p>\u5728\u539f\u59cb\u4ee3\u7801\u4e2d\uff0cgetmemory\u51fd\u6570\u4e2d\u7684\u53c2\u6570p\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u5f53\u6211\u4eec\u5c06p\u6307\u9488\u91cd\u65b0\u8d4b\u503c\u4e3amalloc\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u65f6\uff0c\u53ea\u662f\u4fee\u6539\u4e86\u51fd\u6570\u5185\u90e8\u7684p\u6307\u9488\uff0c\u5e76\u4e0d\u4f1a\u4fee\u6539main\u51fd\u6570\u4e2d\u7684str\u6307\u9488\u3002\u6240\u4ee5\u5728main\u51fd\u6570\u4e2d\u6253\u5370str\u65f6\uff0c\u4f1a\u8f93\u51faNULL\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u4f20\u9012str\u6307\u9488\u7684\u5730\u5740\u7ed9getmemory\u51fd\u6570\uff0c\u8fd9\u6837\u5728\u51fd\u6570\u5185\u90e8\u5c31\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539*p\u6765\u4fee\u6539main\u51fd\u6570\u4e2d\u7684str\u6307\u9488\u3002\u901a\u8fc7\u4f20\u9012\u6307\u9488\u7684\u5730\u5740\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u6307\u9488\u7684\u95f4\u63a5\u4fee\u6539\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5c06getmemory\u51fd\u6570\u7684\u53c2\u6570\u6539\u4e3achar *p\uff0c\u5373\u4f20\u9012\u6307\u9488\u7684\u6307\u9488\u3002\u5728\u51fd\u6570\u5185\u90e8\uff0c\u901a\u8fc7p\u6765\u8bbf\u95ee\u548c\u4fee\u6539str\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u3002\u8fd9\u6837\u5c31\u80fd\u591f\u6b63\u786e\u5730\u5206\u914d\u5185\u5b58\u5e76\u5c06\u5b57\u7b26\u4e32\u590d\u5236\u5230str\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u4e2d\u3002</p> <p>\u5728main\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u4f20\u9012str\u6307\u9488\u7684\u5730\u5740\u7ed9getmemory\u51fd\u6570\uff0c\u8fd9\u6837\u5728\u51fd\u6570\u5185\u90e8\u901a\u8fc7\u4fee\u6539*p\u6765\u4fee\u6539main\u51fd\u6570\u4e2d\u7684str\u6307\u9488\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u6b63\u786e\u5730\u6253\u5370str\u6307\u9488\u6307\u5411\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u5728\u7a0b\u5e8f\u7ed3\u675f\u524d\u91ca\u653estr\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u3002</p> <p>\u901a\u8fc7\u8fd9\u6837\u7684\u4fee\u6539\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u6307\u9488\u7684\u95f4\u63a5\u4fee\u6539\uff0c\u786e\u4fdd\u5728\u51fd\u6570\u5185\u90e8\u5bf9\u6307\u9488\u7684\u4fee\u6539\u80fd\u591f\u5f71\u54cd\u5230\u51fd\u6570\u5916\u90e8\u7684\u53d8\u91cf\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#free","title":"\u7ed9\u5df2\u7ecfFree\u7684\u7a7a\u95f4\u8d4b\u503c","text":"<pre><code>// \u95ee: \u8f93\u51fa\u7ed3\u679c\u662f\u4ec0\u4e48? \u4e3a\u4ec0\u4e48 \n#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; \nvoid GetMemory(char **p,int num)\n{ \n    *p=(char *)malloc(num); \n} \nint main()\n{ \n    char *str=NULL; \n    GetMemory(&amp;str,100); \n    strcpy(str,\"hello\"); \n    free(str); \n    if(str!=NULL) \n    { \n        strcpy(str,\"world\"); \n    } \n    printf(\"\\n str is %s\",str); \n}\n</code></pre> <p>\u7b54\u6848\uff1a\u8f93\u51fastr is world\u3002</p> <p>\u8fdb\u7a0b\u4e2d\u7684\u5185\u5b58\u7ba1\u7406 \u662f\u7531\u5e93\u51fd\u6570\u5b8c\u6210\uff0c\u4e0d\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u3002 malloc\u65f6, \u5e93\u51fd\u6570\u4f1a\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7a7a\u95f4\uff0c\u5e76\u505a\u8bb0\u5f55, \u4f46free\u65f6, \u5e93\u51fd\u6570\u4e0d\u4f1a\u628a\u7a7a\u95f4\u9a6c\u4e0a\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf, \u8fd8\u80fd\u7ee7\u7eed\u8bbf\u95ee\u3002 \u4f46\u540e\u9762\u53ef\u80fd\u8fd9\u4e2a\u7a7a\u95f4\u5206\u914d\u7ed9\u522b\u4eba\u3002 \u6240\u4ee5\u4e3a\u907f\u514d\u8bef\u64cd\u4f5c free(str) \u540e \u9700 str=NULL;</p> <pre><code>    free(str);\n    str = NULL; // \u5c06\u6307\u9488\u8bbe\u7f6e\u4e3aNULL\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_5","title":"\u5185\u5b58\u6cc4\u6f0f","text":"<p>malloc\u540e\u6ca1\u6709\u8fdb\u884cfree, \u7cfb\u7edf\u8fd0\u884c\u51e0\u5929\u540e, \u4e0d\u505c\u5730\u7533\u8bf7\u5185\u5b58, \u6700\u540e\u5bfc\u81f4\u5185\u5b58\u5d29\u6e83, </p> <p>\u53ef\u80fd\u5728\u67d0\u4e2aSwitch\u4e2d\u5076\u5c14\u7533\u8bf7</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_6","title":"\u672a\u914d\u5bf9\u91ca\u653e","text":"<pre><code>char *pt = (char *)malloc(10); //\u5806\u4e0a\u7533\u8bf7\u7a7a\u95f4\uff0c\u672a\u914d\u5bf9free(pt)\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_7","title":"\u4e22\u5931\u5730\u5740","text":"<pre><code>  char *pt= (char *)malloc(10);     \n...\n...\n...\n    //\u53ef\u80fd\u4e2d\u95f4\u9694\u4e86\u597d\u591a\u7684\u51fd\u6570\n    pt= (char *)malloc(20);     //\u8986\u76d6\u4e86\u6307\u9488\uff0c\u5bfc\u81f4\u524d\u976210\u4e2a\u7a7a\u95f4\u7684\u5730\u5740\u4e22\u5931\u3002\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_8","title":"\u672a\u5206\u7ea7\u91ca\u653e","text":"<pre><code>#include  &lt;stdio.h&gt;\n#include  &lt;stdlib.h&gt;\nstruct birth\n{\n   int year;\n   int month;\n   int day;\n};\n\nstruct student\n{\n   char is_male;\n   char *name;\n   struct birth * bi;\n    //int a[1000];\n};\n\nint main()\n{\n   struct student *pt;\n   pt= (struct student *)malloc(sizeof(struct student)); //\u5806\u4e0a\u7533\u8bf7\u7a7a\u95f4\n\n   pt-&gt;is_male =1;\n   pt-&gt;name = \"wangwei\";\n   pt-&gt;bi = (struct birth *)malloc(sizeof(struct birth)); //\u5806\u4e0a\u7533\u8bf7\u7a7a\u95f4\n   pt-&gt;bi-&gt;year = 2000;\n   pt-&gt;bi-&gt;month = 3;  \n   pt-&gt;bi-&gt;day = 2;  \n\n   printf(\"%s %d \\n\",pt-&gt;name,pt-&gt;bi-&gt;day);\n\n   //\u9010\u7ea7\u91ca\u653e\u7a7a\u95f4\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\n   //pt-&gt;name \u662f\u5b57\u7b26\u4e32\u5e38\u91cf \u4e0d\u7528\u91ca\u653e \n   if(pt-&gt;bi!=NULL){ \n      free(pt-&gt;bi); //\u5148\u91ca\u653e\u5b50\u7a7a\u95f4\n      pt-&gt;bi=NULL;\n   }\n   free(pt); //\u540e\u91ca\u653e\u7236\u7a7a\u95f4\n   pt =NULL; //\u907f\u514d\u91ce\u6307\u9488 (\u64cd\u4f5c\u5df2\u91ca\u653e\u7684\u7a7a\u95f4)\n\n   return 0;\n}   \n</code></pre> <p><code>struct student *pt;</code> </p> <p><code>pt= (struct student *)malloc(sizeof(struct student)); //\u5806\u4e0a\u7533\u8bf7\u7a7a\u95f4</code></p> <p>\u76f8\u6bd4\u76f4\u63a5<code>struct student Student_A</code>(\u4f1a\u8ba1\u7b97\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u5927\u5c0f, \u7136\u540e\u7533\u8bf7\u4e86\u5404\u79cd\u5c40\u90e8\u53d8\u91cf,\u5982a[1000]\u5c31\u5f88\u6d6a\u8d39\u7a7a\u95f4)</p> <p>\u4f7f\u7528\u5806\u5206\u914d,\u66f4\u52a0\u8282\u7701\u7a7a\u95f4.</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u5185\u5b58\u7a7a\u95f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u7c7b\u578b\uff1a\u6808\u7a7a\u95f4\u548c\u5806\u7a7a\u95f4\u3002</p> <p>\u6808\u7a7a\u95f4\u662f\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u5206\u914d\u548c\u7ba1\u7406\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u548c\u51fd\u6570\u8c03\u7528\u7684\u53c2\u6570\u3001\u8fd4\u56de\u503c\u7b49\u4fe1\u606f\u3002\u6808\u7a7a\u95f4\u7684\u5927\u5c0f\u548c\u751f\u547d\u5468\u671f\u662f\u5728\u7f16\u8bd1\u65f6\u5c31\u786e\u5b9a\u7684\uff0c\u4e0d\u80fd\u52a8\u6001\u5730\u589e\u52a0\u6216\u51cf\u5c11\u3002</p> <p>\u5806\u7a7a\u95f4\u662f\u7531\u7a0b\u5e8f\u5458\u624b\u52a8\u5206\u914d\u548c\u91ca\u653e\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7528\u4e8e\u5b58\u50a8\u52a8\u6001\u5206\u914d\u7684\u53d8\u91cf\u3001\u6570\u7ec4\u3001\u7ed3\u6784\u4f53\u7b49\u6570\u636e\u7ed3\u6784\u3002\u5806\u7a7a\u95f4\u7684\u5927\u5c0f\u548c\u751f\u547d\u5468\u671f\u662f\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u786e\u5b9a\u7684\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u52a8\u6001\u589e\u52a0\u6216\u51cf\u5c11\u3002</p> <p>\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u4f7f\u7528\u4e86malloc\u51fd\u6570\u6765\u52a8\u6001\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5728\u5806\u4e0a\u5206\u914d\u4e00\u5757\u6307\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u8be5\u5185\u5b58\u7a7a\u95f4\u7684\u6307\u9488\u3002\u56e0\u6b64\uff0c\u901a\u8fc7malloc\u51fd\u6570\u52a8\u6001\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u5c31\u662f\u5728\u5806\u4e0a\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u800c\u5982\u679c\u76f4\u63a5\u5b9a\u4e49\u7ed3\u6784\u4f53\u53d8\u91cf\uff0c\u53d8\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u4f1a\u5728\u6808\u4e0a\u5206\u914d\uff0c\u5176\u5927\u5c0f\u548c\u751f\u547d\u5468\u671f\u5728\u7f16\u8bd1\u65f6\u5c31\u5df2\u7ecf\u786e\u5b9a\uff0c\u65e0\u6cd5\u52a8\u6001\u8c03\u6574\u3002\u56e0\u6b64\uff0c\u5982\u679c\u9700\u8981\u52a8\u6001\u7ba1\u7406\u7ed3\u6784\u4f53\u5bf9\u8c61\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u6307\u9488\u6765\u52a8\u6001\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u52a8\u6001\u521b\u5efa\u548c\u7ba1\u7406\u7ed3\u6784\u4f53\u5bf9\u8c61\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#gdb-","title":"GDB\u8c03\u8bd5--\u4ee5\u6808\u6ea2\u51fa\u4e3a\u4f8b\u5b50","text":"<p>\u6808\u8d8a\u754c\uff0c\u8986\u76d6\u522b\u7684\u6570\u636e  --&gt; \u63d0\u5347\u8c03\u8bd5\u80fd\u529b</p> <pre><code>//\u6808: \u662f\u4e00\u79cd \u5148\u8fdb\u540e\u51fa \u7684\u6570\u636e\u7ed3\u6784 -&gt; \u51fd\u6570\u8c03\u7528\u8fd4\u56de \n---    ---\n  |    |\n  | 3  | &lt;-- rsp/esp \u6808\u9876\u6307\u9488(\u8fdb\u51fa\u6808\u65f6\u5b83\u4f1a\u53d8\u5316)\n  | 2  | \n  | 1  | \n -----  &lt;-- rbp/ebp \u6808\u5e95\u6307\u9488\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_9","title":"\u51fd\u6570\u8c03\u7528\u8fd4\u56de","text":"<p>\u5165\u6808\u987a\u5e8f: \u4e00\u822c\u662f\u4ece\u51fd\u6570\u7684\u4e0b\u9762\u5230\u4e0a\u9762, \u53c2\u6570\u4ece\u5de6\u5230\u53f3 ( \u7531\u6808\u7684\u7279\u70b9FILO\u53ef\u77e5 )</p> <p>(\u4e0a\u9762\u8fd9\u4e2a\u56fe\u6709\u95ee\u9898\uff0c\u8fd4\u56de\u5730\u5740\u548c\u524d\u6808\u6808\u5e95\u53cd\u8fc7\u6765\u4e86 )</p> <p>\u5165\u6808\u987a\u5e8f\uff1a1. \u8fd4\u56de\u5730\u5740 2. \u524d\u6808\u6808\u5e95\uff08rbp\uff09 3. \u76f8\u5173\u53c2\u6570</p> <p>\u51fa\u6808\u987a\u5e8f\uff1a1. \u76f8\u5173\u53c2\u6570 2. \u524d\u6808\u6808\u5e95\uff08rbp\uff09 3. \u8fd4\u56de\u5730\u5740</p> <pre><code>#include &lt;stdio.h&gt;\nint func2(int x,int y){\n   char name[6];\n   int sum; \n   printf(\"input: \"); \n   gets(name); //\u8f93\u5165\u5b57\u7b26\u8fc7\u591a\uff0cname\u4f1a\u8d8a\u754c\uff0c\u6808\u6ea2\u51fa\u5d29\u6e83\n   return x+y;\n}\n\nint func1(int a){\n   int x=1;\n   printf(\" func1 a=%d\\n\",a);\n   func2(3,4);\n   return a+x;\n}\n\nint main (int argc,char *argv[]) {\n    func1(2);\n    printf(\"main end\\n\");\n    return 0;\n} \n</code></pre> <p></p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#gdb","title":"\uff08\u91cd\u8981\uff09GDB\u8c03\u8bd5","text":"<p>\u8fd9\u90e8\u5206\u4ee5\u540e\u7528\u6765\u53ef\u4ee5\u590d\u4e60GDB\u7684\u64cd\u4f5c,\u987a\u4fbf\u590d\u4e60\u6808\u7684\u5b58\u50a8, \u5728\u5927\u8111\u4e2d\u5efa\u7acb\u4e00\u5f20\u5185\u5b58\u7684\u5730\u56fe </p> <pre><code>//\u6d4b\u8bd5\u51fd\u6570\n#include &lt;stdio.h&gt; \n//\u5165\u6808\u987a\u5e8f\uff1a\u662f\u4ece\u4e0b\u5230\u4e0a\uff0c\u4ece\u53f3\u81f3\u5de6\uff0c\u53cd\u5411\u8fdb\u6808\nint func (int a,int b )   //4.b    5.a  (\u4ece\u53f3\u81f3\u5de6) \u8fd9\u91cc\u7f16\u8bd1\u5668\u4f18\u5316\u4e86\u597d\u50cf\n{ \n    char name[6]; //3. name[]\n    int sum;      //2.sum     \u4ece\u4e0b\u5230\u4e0a\n    printf(\"Please type your name: \"); \n    gets(name); \n    printf(\"Hello, %s!\", name);\n    sum =  a+b;\n    return sum; \n} \n\nint main (int argc,char *argv[]) \n{ \n    func(3,4); //\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u5165\u6808\u987a\u5e8f\n               //1. \u8fd4\u56de\u5730\u5740\u5165\u6808( \u5982return 0; ) \n    return 0; \n}      \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#1","title":"1.  \u5f00\u59cb\u8c03\u8bd5","text":"<pre><code>$ gcc -g -fno-stack-protector -z execstack  main.c  //\u7f16\u8bd1\u65f6 \u5173\u95ed\u6808\u4fdd\u62a4\n$ gdb ./a.out\n(gdb) l 1,25   //\u67e5\u770b1\u523025\u884c\u4ee3\u7801\n(gdb) b 15     //\u65ad\u70b9\u8bbe\u5728\u7b2c15\u884c(char name[6]\u5904)\n(gdb) r        //\u5168\u901f\u8fd0\u884c\n\n\n/*    \u5e38\u7528\u7684GDB\u8c03\u8bd5\u547d\u4ee4\nrun \u6216 r\uff1a\u542f\u52a8\u7a0b\u5e8f\u7684\u6267\u884c\u3002\nbreak \u6216 b\uff1a\u8bbe\u7f6e\u65ad\u70b9\u3002\u901a\u8fc7\u6307\u5b9a\u884c\u53f7\u6216\u51fd\u6570\u540d\u6765\u8bbe\u7f6e\u65ad\u70b9\uff0c\u5982 break main \u6216 break 10\u3002\ncontinue \u6216 c\uff1a\u7ee7\u7eed\u6267\u884c\u7a0b\u5e8f\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ed3\u675f\u3002\nnext \u6216 n\uff1a\u6267\u884c\u4e0b\u4e00\u884c\u4ee3\u7801\uff0c\u4e0d\u8fdb\u5165\u51fd\u6570\u8c03\u7528\u3002\nstep \u6216 s\uff1a\u6267\u884c\u4e0b\u4e00\u884c\u4ee3\u7801\uff0c\u5e76\u8fdb\u5165\u51fd\u6570\u8c03\u7528\u3002\nprint \u6216 p\uff1a\u6253\u5370\u53d8\u91cf\u7684\u503c\u3002\u4f8b\u5982 print x\u3002\nexamine \u6216\u8005 x : \u663e\u793a\u5185\u5b58\u4fe1\u606f \u663e\u793a\u67d0\u5730\u5740\u7684\u5185\u5b58\u503c \ninfo \u6216\u8005 i: \u663e\u793a\u5185\u5b58\u4fe1\u606f\nlist \u6216\u8005 l: \u663e\u793a\u6e90\u7801 \nbacktrace \u6216 bt\uff1a\u6253\u5370\u51fd\u6570\u8c03\u7528\u6808\u7684\u4fe1\u606f\u3002\ninfo locals\uff1a\u6253\u5370\u5f53\u524d\u51fd\u6570\u7684\u5c40\u90e8\u53d8\u91cf\u3002\ninfo breakpoints\uff1a\u663e\u793a\u5f53\u524d\u8bbe\u7f6e\u7684\u6240\u6709\u65ad\u70b9\u3002\ndelete\uff1a\u5220\u9664\u6307\u5b9a\u7684\u65ad\u70b9\u3002\u4f8b\u5982 delete 1\u3002\nwatch\uff1a\u8bbe\u7f6e\u89c2\u5bdf\u70b9\uff0c\u5f53\u53d8\u91cf\u7684\u503c\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u505c\u4e0b\u6765\u3002\nquit \u6216 q\uff1a\u9000\u51faGDB\u8c03\u8bd5\u3002\n*/\n</code></pre> <pre><code>// \u770bmain\u7684\u6808\u5e27\u5730\u5740 argc = 1, argv = 0x7fffffffe158 \u5bf9\u5e94\u5730\u5740 0x7ffffffe030\n</code></pre> <p>\u5bf9\u4e8e\u51fd\u6570\u7684\u53c2\u6570\uff0c\u4e00\u822c\u90fd\u662f\u4ece\u53f3\u5230\u5de6\uff08argv[] -&gt;argc\uff09\u5165\u6808\u7684,  \u4e5f\u5c31\u662f\u53f3\u8fb9\u7684\u5148\u5165\u6808\u5230\u6808\u5e95\uff08\u4e5f\u5c31\u662f\u9ad8\u5730\u5740\uff09\uff0c \u4f46\u662fgdb\u8c03\u8bd5\u51fa\u6765\u7684\u7ed3\u679c\u53c8\u4e0d\u662f\u8fd9\u6837\uff1fargc\u5148\u5165\u4e86\u6808\uff1f</p> <p>\u53ef\u80fd\u662f\u7f16\u8bd1\u5668\u4f18\u5316\u7684\u7f18\u6545</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#2","title":"2. \u6267\u884c\u5230\u54ea\u91cc","text":"<pre><code>(gdb) i reg   //\u67e5\u770b\u5bc4\u5b58\u5668\n              //rsp : \u6808\u9876\u6307\u9488(\u8fdb\u51fa\u6808\u65f6\u5b83\u4f1a\u53d8\u5316 ),\u6709\u4e9bcpu\u91cc\u53ebesp\n              //rbp : \u6808\u5e95\u6307\u9488\n              //rip : \u6307\u4ee4\u6307\u9488(\u4e0b\u4e00\u6761 \u7b49\u5f85\u6267\u884c\u7684 \u6307\u4ee4\u5730\u5740)\n(gdb) x $rip  //\u67e5\u770brip\u5bc4\u5b58\u5668\u5185\u5bb9 (\u77e5\u9053\u7a0b\u5e8f\u6267\u884c\u5230\u90a3\u4e86)\n              // x/16x $rip   \u67e5\u770b16\u4e2a\u5c06\u8981\u6267\u884c\u4ee3\u7801\u7684\u673a\u5668\u7801   \n\n(gdb) disas main //\u53cd\u6c47\u7f16main\u51fd\u6570\nDump of assembler code for function main:\n   0x000055555555520e &lt;+0&gt;: endbr64 \n   0x0000555555555212 &lt;+4&gt;: push   %rbp\n   0x0000555555555213 &lt;+5&gt;: mov    %rsp,%rbp\n   0x0000555555555216 &lt;+8&gt;: sub    $0x10,%rsp\n   0x000055555555521a &lt;+12&gt;:    mov    %edi,-0x4(%rbp)\n   0x000055555555521d &lt;+15&gt;:    mov    %rsi,-0x10(%rbp)\n       //func(3,4); \u4ee3\u7801\u7684\u5185\u5b58\u4f4d\u7f6e\u548c\u53cd\u6c47\u7f16\u4ee3\u7801\n   0x0000555555555221 &lt;+19&gt;:    mov    $0x4,%esi   //func \u4f20\u53c2 4\n   0x0000555555555226 &lt;+24&gt;:    mov    $0x3,%edi   //func \u4f20\u53c2 3\n   0x000055555555522b &lt;+29&gt;:    call   0x555555555189 &lt;func&gt;\n                                                   //\u8df3\u5230\u51fd\u6570 func\u4e2d \n   0x0000555555555230 &lt;+34&gt;:    mov    $0x0,%eax   //\u8c03\u7528func\u540e\u7684\u8fd4\u56de\u5730\u5740\n   0x0000555555555235 &lt;+39&gt;:    leave  \n   0x0000555555555236 &lt;+40&gt;:    ret    \nEnd of assembler dump.\n</code></pre> <p>0x7fffffffdb33</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#3","title":"3. \u6808\u67e5\u770b","text":"<pre><code>//\u8fdb\u5165func\u51fd\u6570\u540e\n\n(gdb) bt full  //\u67e5\u770b\u5168\u90e8\u7684 \u51fd\u6570\u8c03\u7528\u6808\u4fe1\u606f\n #0  main (argc=1, argv=0x7fffffffe158) \n           //argc=1: \u53c2\u6570\u4e2a\u6570 1    \u5bf9\u5e94 ./a.out\n       //argv=0x7fffffffe158 \u53c2\u6570\u6307\u9488\u6570\u7ec4\u8d77\u59cb\u4f4d\u7f6e  \u5982 ./a.out  hello  word \u65f6\n       //argv[0] \u5bf9\u5e94 ./a.out\u5b57\u7b26\u4e32\u8d77\u59cb\u5730\u5740  argv[1] \u5bf9\u5e94 hello \u5b57\u7b26\u4e32\u8d77\u59cb\u5730\u5740\n\n(gdb) x $rbp    //\u67e5\u770b\u6808\u5e95\n  0x7fffffffdf90:   0x00000000 //main\u51fd\u6570\u7684\u6808\u4f4e\n(gdb) x/28 $rsp //\u67e5\u770b\u6808\u9876 (\u8fdb\u51fa\u6808\u65f6\u5b83\u4f1a\u53d8\u5316 ) \n      //28\uff1a\u67e5\u770b\u4ece\u6808\u9876\u5730\u5740\u5f00\u59cb \u8fde\u7eed28\u4e2aint \u5185\u5b58\u5355\u5143\n      // eg.(gdb) x/20xw $rsp  (x:16\u8fdb\u5236\uff0cw:word)\n      //\u5165\u6808:   argv=0x7fffffffe158           \u5b57\u8282\u5bf9\u9f50\u88650       argc=1\n0x7fffffffdff0: 0x00000d30  0x00000000  0x00000004  0x00000003//\u8fd9\u4e00\u884c\u6ce8\u610f\n0x7fffffffe000: 0xf7fc1000  0x00007fff  0x01000000  0x00000101\n0x7fffffffe010: 0x00000002  0x00000000  0x078bfbff  0x00000000\n0x7fffffffe020: 0xffffe040  0x00007fff  0x55555230  0x00005555//\u8fd9\u4e00\u884c\u6ce8\u610f\n0x7fffffffe030: 0xffffe158  0x00007fff  0x555550a0  0x00000001//\u8fd9\u4e00\u884c\u6ce8\u610f\n0x7fffffffe040: 0x00000001  0x00000000  0xf7c29d90  0x00007fff\n0x7fffffffe050: 0x00000000  0x00000000  0x5555520e  0x00005555\n</code></pre> <p>\u8fdb\u5165\u5230func\u51fd\u6570\u4e4b\u540e,\u5df2\u7ecf\u5c06func\u8fd4\u56de\u5730\u5740\u548cmain\u51fd\u6570\u7684\u6808\u5e27\u5165\u6808\u4e86</p> <p>\u5148\u8bb0\u4f4f\u4e00\u70b9, \u7a0b\u5e8f\u4e0d\u65ad\u5411\u4e0b\u8fd0\u884c, \u6808\u9876\u6307\u9488(rsp)\u4e0d\u65ad\u9012\u51cf</p> <p>\u6240\u4ee5, \u4ecee030\u5730\u5740\u5230e020\u5730\u5740. e020\u5230e030\u5730\u5740\u7684\u4f4e\u5730\u5740\u90e8\u5206\u91cc\u9762\u5b58\u7740main\u51fd\u6570\u6808\u5e27(e040).</p> <p>\u9ad8\u5730\u5740\u90e8\u5206\u5b58\u7740\u8fd4\u56de\u5730\u5740(0x555555555230), \u8fd9\u4e2a\u5730\u5740\u53ef\u4ee5\u53c2\u80032. \u4e2d\u7684main\u51fd\u6570\u7684\u53cd\u6c47\u7f16,\u67e5\u770bcall\u4e0b\u9762\u7684\u90a3\u6761mov\u6307\u4ee4\u7684\u5730\u5740\u521a\u597d\u5c31\u662f0x555555555230</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#4","title":"4.  \u8fdb\u4e00\u6b65\u8c03\u8bd5","text":"<p>\u67e5\u770b\u8986\u76d6\u5185\u5b58</p> <p>\u8f93\u5165name[6] </p> <ul> <li>\u672a\u8986\u76d6(\u8f93\u5165\u4e86abc) </li> </ul> <p></p> <p>\u5730\u5740: 0x7fffffffe010\u5b58\u7684\u5185\u5bb9:abcd</p> <ul> <li>\u8986\u76d6</li> </ul> <p></p> <p>\u76f4\u63a5\u65e0\u6cd5\u8fd4\u56de</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#5","title":"5. \u5927\u8111\u4e2d\u5efa\u7acb\u5185\u5b58\u56fe","text":"<p>\u4e0a\u56fe\u7684\u8fd4\u56de\u5730\u5740\u548c\u524d\u6808\u6808\u5e95\u53cd\u8fc7\u6765\u4e86</p> <pre><code>--------4G---------0xFFFFFFFF  \u9ad8\u5730\u5740\n|      -----      | 0xffffffffff601000  \n|       \u5185\u6838      |   \n|      -----      | 0xffffffffff600000  //\u5185\u6838\u7cfb\u7edf\u8c03\u7528 \u8d77\u59cb\u5730\u5740\n|                 |   \n========3G=========0xC0000000\n|                 |\n|-----------------| 0x7ffffffde050  //\u7cfb\u7edf\u6808\u7684\u8d77\u59cb\u5730\u5740: \u6808\u662f\u5411\u4e0b\u751f\u957f\n|    \u6808(stack)    |    \n|    --------     | 0x7fffffffe040  //main\u51fd\u6570\u7684\u6808\u5e95\n|   0x00000001    | //argc=1   \u8c03\u7528main\u51fd\u6570\u65f6\u5165\u6808 \n|   0x00000000    | //\u5b57\u8282\u5bf9\u9f50  \n|   0x00007fff    | //argv=0x7fffffffe158 \u6307\u9488\u6570\u7ec4\u9996\u5730\u5740(64\u4f4d\u673a 8\u5b57\u8282 \u5c0f\u7aef)\n|   0xffffe158    | 0x7fffffffe030\n|    -------      | //\u5f53main\u51fd\u6570\u6808\u8fdb\u5b8c\u540e\uff0c\u4f1arbp\u5b58\u5165\u4e0b\u4e00\u5730\u5740\u4e2d\uff0c\u628a\u4e0b\u4e00\u5730\u5740\u5b58\u5165rbp\u4e2d\uff0c\u4f5c\u4e3a\u65b0\u6808\u7684\u6808\u5e95        \n|   0x55555230    | //\u8fd4\u56de\u5730\u5740\uff1a \u8c03\u7528func\u540e\uff0c\u8fd4\u56de\u5230main\u7684\u5730\u5740\n|   0x00005555    |  \n|   0xffffe040    | //func\u51fd\u6570\u7684\u6808\u5e95\uff1a\u5b58\u50a8\u7684\u4e0a\u4e00\u6808\u7684\u6808\u5e95(main\u51fd\u6570\u7684\u6808\u5e95 8\u5b57\u8282)  \n|   0x00007fff    | 0x7fffffffe020\n|   0x10f911f6    |\n|   0x79b1cf00    | //sum \u5c40\u90e8\u53d8\u91cf(\u672a\u521d\u59cb\u5316)\u5165\u6808  -&gt; \u4ece\u4e0b\u5230\u4e0a\uff0c\u4ece\u53f3\u81f3\u5de6\u8fdb\u6808\n|   0x00006463    |\n|   0x62610002    | 0x7fffffffe010 //name[6]\n|   0x00007fff    |\n|   0xf7facfc8    | 0x7fffffffe000  //\u8865\u5168\n|   0x00000003    |  //\u5b9e\u53c2\u62f7\u8d1d\u5230\u5f62\u53c2 b=4 a=3; \n|   0x00000004    |                \n|-----------------| 0x7ffffffff000 \n|                 |\n|      .....      |          \n|                 |\n|-----------------|\n|    \u5806(heap)     |   \n-------------------\n|    DATA\u6570\u636e\u6bb5   | \n-------------------\n|                 |\n|      -----      | 0x555555558000 \n|   \u4ee3\u7801\u533a(\u53ea\u8bfb)   | \n|      -----      | 0x555555554000  //a.out \u7a0b\u5e8f\u7684 \u8d77\u59cb\u5730\u5740\n|                 | \n-------------------0x00000000 \u4f4e\u5730\u5740   \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#gdb-1","title":"GDB \u5b9e\u9645\u8fd0\u75281","text":"<pre><code>/*\n\u5f53\u8fd0\u884c  ./a.out abcd \u6b63\u5e38\n\u5f53\u8fd0\u884c  ./a.out abcdefghijkomk \u65f6 \u6ea2\u51fa\u5d29\u6e83\n\u5c1d\u8bd5\u7528gdb\u8c03\u8bd5\u5206\u6790 \u6808\u6ea2\u51fa \u7684\u8fc7\u7a0b\n*/\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid function2(){\n    printf(\"Execution flow changed\\n\");\n}\nvoid function1(char *str){\n    char buffer[5];\n    strcpy(buffer,str);\n}\nvoid main(int argc,char *argv[]){\n   int a=1;\n   int b=2;\n   int c=3;\n    function1(argv[1]);\n    printf(\"%s\\n\",\"Executed normally\");\n}   \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_10","title":"\u524d\u7f6e\u77e5\u8bc6","text":"<p>\u5728C\u8bed\u8a00\u4e2d\uff0c<code>main</code>\u51fd\u6570\u662f\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u4e5f\u662f\u7a0b\u5e8f\u5f00\u59cb\u6267\u884c\u7684\u5730\u65b9\u3002\u5b83\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a<code>argc</code>\u548c<code>argv</code>\u3002</p> <ul> <li><code>argc</code>\uff08argument count\uff09\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u8868\u793a\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u91cf\u3002\u5b83\u5305\u62ec\u7a0b\u5e8f\u540d\u79f0\u672c\u8eab\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c\u7a0b\u5e8f\u65f6\u8f93\u5165\u4e863\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48<code>argc</code>\u7684\u503c\u5c06\u4e3a4\u3002</li> <li><code>argv</code>\uff08argument vector\uff09\u662f\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u4e32\u6570\u7ec4\u7684\u6307\u9488\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5b57\u7b26\u4e32\u90fd\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u53c2\u6570\u3002\u6570\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff08<code>argv[0]</code>\uff09\u662f\u7a0b\u5e8f\u7684\u540d\u79f0\uff0c\u540e\u7eed\u5143\u7d20\uff08<code>argv[1]</code>\u3001<code>argv[2]</code>\u7b49\uff09\u662f\u4f20\u9012\u7ed9\u7a0b\u5e8f\u7684\u5b9e\u9645\u53c2\u6570\u3002</li> </ul> <p>\u5728Ubuntu\u4e0b\u8fd0\u884c\u7a0b\u5e8f\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u8f93\u5165\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u7684\u7a0b\u5e8f\u540d\u4e3a<code>myprogram</code>\uff0c\u4f60\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u6765\u8fd0\u884c\u7a0b\u5e8f\u5e76\u4f20\u9012\u53c2\u6570\uff1a</p> <pre><code>./myprogram arg1 arg2 arg3\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>argc</code>\u7684\u503c\u5c06\u4e3a4\uff0c<code>argv</code>\u7684\u503c\u5c06\u662f\u4e00\u4e2a\u6307\u5411\u5305\u542b<code>\"./myprogram\"\u3001\"arg1\"\u3001\"arg2\"\u3001\"arg3\"</code>\u7684\u5b57\u7b26\u4e32\u6570\u7ec4\u7684\u6307\u9488\u3002</p> <p>\u5728\u4ee3\u7801\u4e2d\uff0c<code>main</code>\u51fd\u6570\u7684\u53c2\u6570<code>argc</code>\u548c<code>argv</code>\u88ab\u7528\u6765\u63a5\u6536\u547d\u4ee4\u884c\u53c2\u6570\u3002<code>argc</code>\u7528\u4e8e\u68c0\u67e5\u4f20\u9012\u7ed9\u7a0b\u5e8f\u7684\u53c2\u6570\u6570\u91cf\u662f\u5426\u8db3\u591f\uff0c<code>argv[1]</code>\u7528\u4e8e\u4f20\u9012\u7ed9<code>function1</code>\u51fd\u6570\u7684\u53c2\u6570\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_11","title":"\u5206\u6790","text":"<p>\u5f53\u8fd0\u884c  ./a.out abcd \u6b63\u5e38 \u5f53\u8fd0\u884c  ./a.out abcdefghijkomk \u65f6 \u6ea2\u51fa\u5d29\u6e83</p> <p>\u53ef\u4ee5\u770b\u51fa, \u5c31\u662f\u547d\u4ee4\u884c\u53c2\u6570\u7684\u95ee\u9898.</p> <p>\u6570\u7ec4\u53ea\u67095\u4e2a\u7a7a\u95f4,\u4f46\u662f\u547d\u4ee4\u884c\u53c2\u6570\u592a\u591a\u4e86,\u5bfc\u81f4\u6ea2\u51fa</p> <p></p> <p></p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_12","title":"\u6539\u8fdb","text":"\u95ee\u9898 \u63cf\u8ff0 \u4fee\u590d\u65b9\u6cd5 \u7f13\u51b2\u533a\u6ea2\u51fa <code>function1</code>\u4e2d\u7684<code>strcpy</code>\u51fd\u6570\u53ef\u80fd\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa \u4f7f\u7528<code>strncpy</code>\u51fd\u6570\uff0c\u5e76\u6307\u5b9a\u76ee\u6807\u6570\u7ec4\u7684\u5927\u5c0f \u7f3a\u5c11\u547d\u4ee4\u884c\u53c2\u6570\u68c0\u67e5 <code>main</code>\u51fd\u6570\u4e2d\u6ca1\u6709\u68c0\u67e5\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u91cf \u6dfb\u52a0\u5bf9<code>argc</code>\u7684\u68c0\u67e5\uff0c\u786e\u4fdd\u6709\u8db3\u591f\u7684\u547d\u4ee4\u884c\u53c2\u6570 <pre><code>void function1(char *str){\n    char buffer[5];\n    strncpy(buffer, str, sizeof(buffer)-1);\n    buffer[sizeof(buffer)-1] = '\\0';\n}\n//main \u51fd\u6570\u4e2d:\n    if (argc &lt; 2){\n        printf(\"Insufficient command line arguments\\n\");\n        return 1;\n    }\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#gdb-2","title":"GDB \u5b9e\u9645\u8fd0\u75282","text":"<p>\u6311\u6218\uff1a\u7528\u6808\u6ea2\u51fa\u6f0f\u6d1e\uff0c\u4e0d\u77e5\u9053\u5bc6\u7801\u60c5\u51b5\u4e0b\uff0c\u5982\u4f55\u9a8c\u8bc1\u901a\u8fc7</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#define PASS_WORD \"1234567\" \n\nint verify_password(char * password)\n{\n    int authentitated;\n    char buffer[8];\n    authentitated = strcmp(password,PASS_WORD);\n    strcpy(buffer,password);\n    return authentitated;\n}\n\nint main()\n{\n    int valid_flag = 0;\n    char password[1024] = {0};\n    while (1)\n    {\n        printf(\"please input password:\");\n        scanf(\"%s\",password);\n        valid_f lag = verify_password(password);\n        if(valid_flag)\n        {\n            printf(\"incorrect password!\\r\\n\");\n        }\n        else\n        {\n            printf(\"Congratulation ! you have passed the verification !\\r\\n\");\n        }\n    }\n    return 0;\n}\n</code></pre> <p>\u76ee\u524d\u5361\u4f4f</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_13","title":"\u5927\u5c0f\u7aef","text":"<p>\u5927\u7aef\uff08\u5b58\u50a8\uff09\u6a21\u5f0f: \u662f\u6307\u6570\u636e\u7684\u4f4e\u4f4d\u4fdd\u5b58\u5728\u5185\u5b58\u7684\u9ad8\u5730\u5740\u4e2d\uff0c\u800c\u6570\u636e\u7684\u9ad8\u4f4d\uff0c\u4fdd\u5b58\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u4e2d\uff1b(\u8bfb\u53d6\u6570\u636e\u5c31\u662f\u4ece\u4f4e\u5b57\u8282\u7a7a\u95f4\u5f00\u59cb\u8bfb)</p> <p>\u5c0f\u7aef\uff08\u5b58\u50a8\uff09\u6a21\u5f0f: \u662f\u6307\u6570\u636e\u7684\u4f4e\u4f4d\u4fdd\u5b58\u5728\u5185\u5b58\u7684\u4f4e\u5730\u5740\u4e2d\uff0c\u800c\u6570\u636e\u7684\u9ad8\u4f4d,\uff0c\u4fdd\u5b58\u5728\u5185\u5b58\u7684\u9ad8\u5730\u5740\u4e2d\u3002(\u8bfb\u53d6\u6570\u636e\u5c31\u662f\u4ece\u9ad8\u5b57\u8282\u7a7a\u95f4\u5f00\u59cb\u8bfb)</p> <p>\u7edd\u5927\u591a\u6570CPU\u90fd\u662f\u5c0f\u7aef\u5b58\u50a8</p> <p></p> <pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    int a = 0x12345678; //(gdb) p/t  a\n                    //(gdb) x   &amp;a \u67e5\u770b\u5185\u5b58\u503c\n    char *b =(unsigned char *)&amp;a;  //\u901a\u8fc7\u5730\u5740 \u5f3a\u8f6c\u4e3achar\u578b\uff0c\u8ba9\u6307\u9488 \u6307\u5411\u5b57\u8282\u5730\u5740\n    printf(\"%x %x %x %x\",*(b+3),*(b+2),*(b+1),*b);  \n}\n\n12 34 56 78\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_14","title":"\u7f16\u5199\u51fd\u6570\u5224\u65ad","text":"<pre><code>//\u65b9\u5f0f\u4e00: \u6307\u9488\u8f6c\u578b\nint i = 1;   \nunsigned char *pointer;   \npointer = (unsigned char *)&amp;i; //int \u5f3a\u8f6cchar\u578b \u65f6 \u53ea\u4fdd\u7559\u6700\u4f4e\u4f4d\u5b57\u8282\u7684\u6570\u636e\u3002   \n// \uff08\u4f4e\uff09 00 00 00 01\uff08\u9ad8\uff09  \u5927\u7aef\u5e8f\n// 01 00 00 00  \u5c0f\u7aef\u5e8f\nif(*pointer){\n   printf(\"little\"); //\u5c0f\u7aef(\u5927\u90e8\u5206\u662f\u5c0f\u7aef\u5b58\u50a8)\n}else{\n   printf(\"big\");\n} \n\n//\u65b9\u5f0f\u4e8c: \u8054\u5408\u4f53\nint checkCPU()\n{\n  union w\n  { \n    int a;\n    char b;\n  }c;\n  c.a = 1;  //\u8054\u5408\u4f53\u7684\u6240\u6709\u6210\u5458\u90fd\u4ece\u4f4e\u5730\u5740\u5f00\u59cb\u5b58\u653e\uff0c\n  return (c.b == 1);  //0:\u5927\u7aef  1:\u5c0f\u7aef\n} \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_15","title":"\u5b9e\u9645\u9898\u76ee:","text":"<p>\u6307\u9488\u504f\u79fb + \u5927\u5c0f\u7aef</p> <pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n   int a = 0x12345678;\n   int b = 0x0A0B0C0D;\n\n   unsigned char *c=( unsigned char *)&amp;a; \n   printf(\"%x \",*(c+1));\n   printf(\"%x \",*(int*)(c+1));\n   return 0;\n}   \n\n#include &lt;stdio.h&gt;\nint main()\n{\n   int a = 0x12345678;\n   int b = 0x0A0B0C0D;  \n   // \u5c40\u90e8\u53d8\u91cf \u4f1a\u987a\u5e8f\u5206\u914d\u5730\u5740(\u6ce8\u610f\u51fd\u6570\u5c40\u90e8\u53d8\u91cf\u5165\u6808\u7684\u987a\u5e8f:\u4ece\u4e0b\u5230\u4e0a):  \n   //(gdb) x &amp;a\n   // 0x7fffffffdf78:   0x12345678  \n   //(gdb) x &amp;b\n   // 0x7fffffffdf7c:   0x0a0b0c0d\n   //\u56e0\u662f\u5c0f\u7aef \u6545\u5185\u5b58\u4e3a\n   //\u5185\u5b58\uff1a \u9ad8 0x0A0B0C0D 0x12345678  \u4f4e(\u4e0b\u56fe)                \n   unsigned char *c=( unsigned char *)&amp;a; //\u5c0f\u7aef a \u5730\u5740\u6307\u5411\u4f4e\u5b57\u8282 78\n   printf(\"%x \",*(c+1)); // 0x56\n   printf(\"%x \",*(int*)(c+1)); //0d123456\n    //\u5148\u8fdb\u884c\u52a01\u540e\u518d\u8fdb\u884c\u5f3a\u8f6c:\n    //78 \u4e0b\u4e00\u4e2a 56 \u4e4b\u540e\u8f6c\u4e3aint\u578b,\u53d6\u56db\u4e2a\u5b57\u8282\u7684\u5185\u5bb9\n    //\u518d\u6839\u636e\u5730\u5740\u7684\u987a\u5e8f,\u5411\u4e0a\u53d6\u56db\u4e2a\u5b57\u8282\u7684\u5185\u5bb9 56 34 12 0D\n    //\u6700\u540e\u8bfb\u51fa\u6765: 0d123456\n   return 0;\n}   \n</code></pre> <p></p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_16","title":"\u6307\u9488\u504f\u79fb","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#1_1","title":"\u4f8b\u5b501","text":"<p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u6307\u9488\u8fd0\u7b97\u662f\u4ee5\u6307\u9488\u6240\u6307\u5411\u7684\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u7684\u3002</p> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a<code>int*</code>\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u9488\u8fd0\u7b97\u5c06\u4ee5<code>sizeof(int)</code>\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u3002\u5bf9\u4e8e\u4e00\u4e2a<code>char*</code>\u7c7b\u578b\u7684\u6307\u9488\uff0c\u6307\u9488\u8fd0\u7b97\u5c06\u4ee5<code>sizeof(char)</code>\uff08\u53731\u5b57\u8282\uff09\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\u8fdb\u884c\u3002</p> <pre><code>//\u4f8b:\u6307\u9488\u504f\u79fb + \u7c7b\u578b\u8f6c\u6362\n//\u95ee\uff1a\u4e0b\u9898\u8f93\u51fa\u4fe1\u606f\u662f\uff1f\nint a[5]={1,2,3,4,5}; \nint *ptr=(int *)(&amp;a+1); \n    //&amp;a:\u53d6\u6570\u7ec4\u7684\u5730\u5740\u3002    \n    //&amp;a+1:\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u7684\u5730\u5740(\u5bf9\u8c61\u662f \u6570\u7ec4\u7c7b\u578b\uff0c\u957f\u5ea6\u5355\u4f4d \u662f 4*5,\u504f\u79fb1\u4e2a\u6570\u7ec4\u7684\u5927\u5c0f),\n    //\u6307\u9488\u7684\u504f\u79fb: \u662f\u4ee5\u5b83\u6307\u5411\u7684\u5bf9\u8c61\u7684\u6570\u636e\u7c7b\u578b\u7684\u957f\u5ea6\u4e3a\u504f\u79fb\u7684\u5355\u4f4d\n    //          \u6307\u9488\u7684\u7c7b\u578b\u5c31\u50cf\u4eba\u7684\u8eab\u4efd\uff0c\u4f60\u662f\u4ee5\u4e2a\u4eba\uff0c\u8fd8\u662f\u8001\u677f\u7684\u8eab\u4efd\n    //          \u4e0d\u540c\u7684\u8eab\u4efd\uff0c\u4f60\u7684\u8d37\u6b3e\u989d\u5ea6\u4e0d\u4e00\u6837\n    //(int *): \u628a\u6307\u5411\u6570\u7ec4\u7c7b\u578b\u7684\u5730\u5740\uff0c\u5f3a\u8f6c\u4e3a\u6307\u5411int\u578b\u7684\u5730\u5740 \n    //\u662f\u5148\u8fdb\u884c\u4e86\u52a01,\u6307\u5411\u4e0b\u4e00\u4e2a\u5bf9\u8c61,\u4e4b\u540e\u518d\u8f6c\u6362\u4e3aint\u578b\u7684\u5730\u5740,\u8ba9\u52a0\u51cf\u53ef\u4ee5\u8bbf\u95ee\u6570\u7ec4\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20,\u4e0d\u7136\u5c31\u662f\u8bbf\u95ee\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u4e86.\n    //int \u578b\u662f4 \uff0cdouble\u578b\u662f8  \u6570\u7ec4\u578b\u662f\u6570\u7ec4\u957f\u5ea6\u3002                         \nprintf(\"%d,%d\",*(a+1),*(ptr-1)); \n    //a: \u6570\u7ec4\u540d\uff0c\u662f\u6570\u7ec4\u9996\u4e2a\u5143\u7d20\u7684\u5730\u5740\uff0c\u6307\u5411\u7684\u6570\u636e\u7c7b\u578b\u662f\u5143\u7d20\u7684\u7c7b\u578b int\n    //a+1:  \u4e0b\u4e00\u5143\u7d20\u7684\u5730\u5740\uff0c\u5373a[1]  (\u5bf9\u8c61\u662f int\u7c7b\u578b\uff0c\u957f\u5ea6\u5355\u4f4d\u662f 4)    \n    //*(a+1): a\u5730\u5740\u504f\u79fb1\u4e2a\u5355\u4f4d(int \u662f4)\uff0c\u518d\u53d6\u91cc\u9762\u5185\u5bb9(int\u578b)      \u662f2\n    //ptr: \u662f\u6307\u5411int\u578b\u7684\u6307\u9488\n    //ptr-1: \u5730\u5740\u51cf1\u4e2a\u5355\u4f4d(int\u578b\u662f4)\n    //*(ptr-1): \u53d6\u91cc\u9762\u5185\u5bb9(int\u578b)                              \u662f5\n</code></pre> <p>**\u6ce8\u610f\u5206\u6e05 (a+1) \u548c (&amp;a+1) **</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#2_1","title":"\u4f8b\u5b502","text":"<p>\u6307\u9488\u504f\u79fb + \u7c7b\u578b\u8f6c\u6362 +\u5927\u5c0f\u7aef</p> <pre><code>//\u95ee\uff1a\u4e0b\u9762\u7a0b\u5e8f\uff0c\u53d8\u91cfa\u7684\u5185\u5b58\u5730\u5740\u4e3a\uff1a0x0034fc50  \u95eeprintf\u8f93\u51fa\u503c\u662f\u591a\u5c11\nint main()    \n{    \n  int a[5] = { 1, 2, 3, 4, 5 };  \n  int *p1  = (int*)(&amp;a + 1);    \n  int *p2  = (int *)((int)a + 1);    \n\n  printf(\"0x%x, 0x%x\\n\", p1[-1], *p2);  \n  return 0;    \n}   \n</code></pre> <pre><code>//\u89e3\u7b54:\n\u9996\u5148\u5206\u6790p1\n&amp;a\u4e3a\u6570\u7ec4\u6307\u9488\uff0c\u7c7b\u578b\u662f\"int (*)[5]\"\uff0c\u6570\u7ec4\u6307\u9488\u662f\u6307\u5411\u6570\u7ec4\u9996\u5143\u7d20\u7684\u5730\u5740\u7684\u6307\u9488\n&amp;a\u7684\u5185\u5b58\u5730\u5740\u4e3a\uff1a0x0034fc50\n&amp;a + 1\u6307\u9488\u52a0\u4e00\uff0c\u5411\u540e\u79fb\u52a8\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd9\u91cc\u7684\u5143\u7d20\u7c7b\u578b\u662f\"int (*)[5]\"\uff0c\u5176\u7a7a\u95f4\u5927\u5c0f\u4e3a20\u5b57\u8282\uff0c\u56e0\u6b64//\u6307\u5411\u4e86\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u4e86\n&amp;a + 1\u7684\u5185\u5b58\u5730\u5740\u4e3a\uff1a0x0034fc64\uff080x0034fc50 + 0x14\uff09\np1\u7684\u5185\u5b58\u5730\u5740\u4e3a\uff1a0x0034fc64\np1[-1]\u6570\u7ec4\u4e0b\u6807\u4e3a\u8d1f\u6570\uff0c\u5411\u524d\u79fb\u52a8\u4e00\u4e2a\u5143\u7d20\uff08\u6ce8\uff1a\u6570\u7ec4\u8d8a\u754c\u5728\u7f16\u8bd1\u65f6\u4e0e\u8fd0\u884c\u65f6\u90fd\u4e0d\u4f1a\u62a5\u9519\uff0c\u9664\u975e\u64cd\u4f5c\u975e\u6cd5\u5185\u5b58\uff09\np1[-1]\u5143\u7d20\u6240\u5728\u7684\u5730\u5740\u4e3a\uff1a0x0034fc60\n\u56e0\u6b64\uff0c\u53ef\u77e5p1[-1]\u7684\u5730\u5740\u4e3aa + 4\u7684\u5730\u5740\np1[-1] == *(a + 4) == 5\n\n\n\u7ee7\u7eed\u5206\u6790p2\n(int)a\u7684\u503c\u4e3a0x0034fc50//\u6ce8\u610f,\u8f6c\u6362\u4e3aint\u7c7b\u578b\u540e,\u8fd9\u4e2a\u5730\u5740\u5c31\u53d8\u6210\u4e00\u4e2a\u6570\u4e86,\u6240\u4ee5\u52a01\u53ef\u4ee5\u76f4\u63a5\u52a0\n(int)a + 1\u7b49\u4e8e0x0034fc51\n\u5206\u6790\u5185\u5b58\u7ed3\u6784\uff0c\u6d4b\u8bd5\u73af\u5883\u5b57\u8282\u5e8f\u4e3alittle endian\n01 00 00 00 02 00 00 00 03 00 0...\n*p2\u7b49\u4e8e0x2000000\n//\u8fd9\u91cc\u8fd8\u6709\u4e00\u70b9\u8981\u8003\u8651,\u572864\u4f4d\u673a\u548c32\u673a\u4e0a\u7684\u7ed3\u679c\u4e0d\u4e00\u6837(\u4e0b\u56fe)\n//32\u673a\u80fd\u6b63\u5e38\u8fd0\u884c,\u56e0\u4e3a\u6307\u9488\u53d8\u91cf\u5360\u4e864\u4e2a\u5b57\u8282 \u4e3a:0x(7f)ffffe021\n//\u4f46\u662f64\u4f4d\u673a:0x7ffffffe021 \u8fdb\u884c\u4e86\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u540e p2\u53d8\u62104\u5b57\u8282\u7684\u4e86,\n//\u8fd9\u4e2a\u4e4b\u540e\u53c8\u7528(int*)\u628a\u5b83\u8f6c\u56de8\u4e2a\u5b57\u8282\u7684\u6307\u9488\u53d8\u91cf\u7c7b\u578b, \u81ea\u52a8\u8865\u5168\u4e3a:0xffffffffe021 \u8fd9\u6bb5\u5185\u5b58\u662f\u975e\u6cd5\u7684\n//\u7531\u524d\u9762\u7684\u77e5\u8bc6\u53ef\u77e5,\u8fd9\u90e8\u5206,\u5927\u6982\u5904\u4e8e\u5185\u6838\u533a \n</code></pre> <p></p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_17","title":"\u8d8a\u754c","text":"<pre><code>char s='a';\nint *pt;\npt=(int*)&amp;s;\n*pt=0x1234;    //\u8bbf\u95ee\u672a\u77e5\u533a\u57df(pt\u6307\u5411\u7a7a\u95f4\u672a\u5b8c\u5168\u5206\u914d\uff0c\u53ea\u67091\u4e2a\u5b57\u8282\u662fs\u7684\uff0c\u5176\u5b83\u7684\u672a\u77e5)\n               //\u53efgdb\u8c03\u8bd5\u770b\u770b: (gdb) x &amp;s   (gdb) x pt \nprintf(\"%d\\n\",*pt); //\u6bb5\u9519\u8bef\uff1a\u8bbf\u95ee\u672a\u77e5\u533a\u57df\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#0","title":"\u5b57\u7b26\u4e32 \u2019\\0\u2019 \u6570\u7ec4\u8d8a\u754c","text":"<pre><code>char astr[5];\nchar* pstr = \"12345\"; //\u5305\u62ec\u672b\u5c3e\u7684\u2019\\0\u2019, \nstrcpy( astr, pstr ); //\u6570\u7ec4\u8d8a\u754c(pstr \u97006\u4e2a\u5b57\u8282\u7a7a\u95f4)  \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#0-strcpy","title":"\u65e0\u7ed3\u5c3e\u2019\\0\u2019 \u7684strcpy","text":"<pre><code>char string[10], str1[10];\nint i;\nfor(i=0; i&lt;10; i++){ \n    str1[i] = 'a';\n}\nstrcpy(string, str1 ); \n//\u89e3\u7b54:\n//  1. \u65e0\u7ed3\u5c3e\u5b57\u7b26\u2019\\0\u2019\uff0c strcpy\u62f7\u8d1d\u4e0d\u4f1a\u7ed3\u675f  \u7ed93\u5206\n//  2. \u4ecestr1\u5185\u5b58\u8d77\u590d\u5236\u5230string\u5185\u5b58\u8d77\u6240\u590d\u5236\u7684\u5b57\u8282\u6570\u5177\u6709\u4e0d\u786e\u5b9a\u6027 \u7ed97\u5206\n//  3. \u6307\u51fa\u5e93\u51fd\u6570strcpy\u5de5\u4f5c\u65b9\u5f0f\u7684  \u7ed910 \u5206\n/*\n1. \u5728\u5faa\u73af\u4e2d\uff0c\u6570\u7ec4str1\u88ab\u586b\u5145\u4e86\u5b57\u7b26'a'\u3002\u7136\u800c\uff0c\u7531\u4e8e\u6ca1\u6709\u5728\u6570\u7ec4\u672b\u5c3e\u6dfb\u52a0\u7ed3\u5c3e\u5b57\u7b26'\\0'\uff0c\u6240\u4ee5strcpy\u51fd\u6570\u65e0\u6cd5\u786e\u5b9a\u590d\u5236\u7684\u7ed3\u675f\u4f4d\u7f6e\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u590d\u5236\u7684\u7ed3\u679c\u4e0d\u53ef\u9884\u6d4b\uff0c\u56e0\u4e3astrcpy\u51fd\u6570\u4f1a\u4e00\u76f4\u590d\u5236\u76f4\u5230\u9047\u5230'\\0'\u4e3a\u6b62\u3002\u8fd9\u4e2a\u95ee\u9898\u7ed9\u4e883\u5206\u3002\n\n2. \u7531\u4e8e\u6ca1\u6709\u660e\u786e\u6307\u5b9a\u590d\u5236\u7684\u957f\u5ea6\uff0c\u590d\u5236\u7684\u5b57\u8282\u6570\u5177\u6709\u4e0d\u786e\u5b9a\u6027\u3002\u8fd9\u662f\u56e0\u4e3astrcpy\u51fd\u6570\u4f1a\u4e00\u76f4\u590d\u5236\u76f4\u5230\u9047\u5230\u6e90\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u5b57\u7b26'\\0'\u4e3a\u6b62\u3002\u7531\u4e8e\u6e90\u5b57\u7b26\u4e32str1\u4e2d\u6ca1\u6709\u7ed3\u5c3e\u5b57\u7b26\uff0c\u590d\u5236\u7684\u957f\u5ea6\u53ef\u80fd\u8d85\u8fc7\u76ee\u6807\u5b57\u7b26\u4e32string\u7684\u957f\u5ea6\u9650\u5236\uff0c\u5bfc\u81f4\u5185\u5b58\u8d8a\u754c\u3002\u8fd9\u4e2a\u95ee\u9898\u7ed9\u4e887\u5206\u3002\n\n3. strcpy\u51fd\u6570\u662f\u4e00\u4e2a\u5e93\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\u4ece\u6e90\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\u5f00\u59cb\uff0c\u9010\u4e2a\u590d\u5236\u5b57\u7b26\u76f4\u5230\u9047\u5230\u6e90\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u5b57\u7b26'\\0'\u3002\u8fd9\u4e2a\u95ee\u9898\u7ed9\u4e8810\u5206\u3002\n*/\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#strlen0","title":"strlen\u672a\u7edf\u8ba1\u2019\\0\u2019","text":"<pre><code>char a[5];\nchar* p = \"12345\";\nif( strlen( p ) &lt;= sizeof(a) ){ //\u53bb\u6389=\u53f7\uff0c  \u56e0strlen\u7684\u7ed3\u679c\u672a\u7edf\u8ba1\u2019\\0\u2019\n  strcpy( a, p );\n}\n</code></pre> \u7279\u70b9 sizeof strlen \u8fd4\u56de\u7c7b\u578b size_t size_t \u53c2\u6570\u7c7b\u578b \u4efb\u4f55\u7c7b\u578b \u5b57\u7b26\u4e32\u6307\u9488 \u8fd4\u56de\u503c \u5bf9\u8c61\u6216\u7c7b\u578b\u7684\u5927\u5c0f\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09 \u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff08\u4e0d\u5305\u62ec\u7ed3\u5c3e\u7684'\\0'\uff09 \u8ba1\u7b97\u65b9\u5f0f \u5728\u7f16\u8bd1\u65f6\u8ba1\u7b97\u5bf9\u8c61\u6216\u7c7b\u578b\u7684\u5927\u5c0f \u5728\u8fd0\u884c\u65f6\u8ba1\u7b97\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 \u9002\u7528\u8303\u56f4 \u4efb\u4f55\u7c7b\u578b\u7684\u5bf9\u8c61\u6216\u7c7b\u578b \u4ec5\u9002\u7528\u4e8e\u4ee5'\\0'\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32 \u6ce8\u610f\u4e8b\u9879 \u4e0d\u4f1a\u8ba1\u7b97\u6307\u9488\u6240\u6307\u5411\u7684\u5bf9\u8c61\u6216\u7c7b\u578b\u7684\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684\u5927\u5c0f \u4e0d\u4f1a\u8ba1\u7b97'\\0'\u5b57\u7b26\u7684\u957f\u5ea6\uff0c\u53ea\u8fd4\u56de\u7b2c\u4e00\u4e2a\u51fa\u73b0\u7684'\\0'\u4e4b\u524d\u7684\u5b57\u7b26\u6570 <p>\u603b\u4e4b\uff0c<code>sizeof</code>\u548c<code>strlen</code>\u90fd\u662fC\u8bed\u8a00\u4e2d\u5e38\u7528\u7684\u8fd0\u7b97\u7b26\u548c\u51fd\u6570\uff0c\u7528\u4e8e\u8ba1\u7b97\u5bf9\u8c61\u6216\u5b57\u7b26\u4e32\u7684\u5927\u5c0f\u6216\u957f\u5ea6\u3002\u5b83\u4eec\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u8ba1\u7b97\u65b9\u5f0f\u548c\u9002\u7528\u8303\u56f4\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u7684\u4f7f\u7528\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u8fd0\u7b97\u7b26\u6216\u51fd\u6570\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_18","title":"\u8d8a\u754c\u62f7\u8d1d","text":"<pre><code>int main()\n{\n   char a;\n   char *str=&amp;a;\n   strcpy(str,\"hello\");\n   printf(str);\n   return 0;\n}   \n//\u89e3\u7b54:\n//  str\u672a\u5206\u914d\u7a7a\u95f4, \u8d8a\u754c\u62f7\u8d1d\uff0c\u5d29\u6e83\u3002\n//  \u5e94\u6539\u4e3a char *str = malloc(6);\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_19","title":"\u5b57\u8282\u5bf9\u9f50","text":"<pre><code>#include &lt;stdio.h&gt;\ntypedef struct stu\n{\n   char sex;\n   int age;\n}stu;\nint main(){\n  stu s={1,5};\n  //\u95ee\u9898\uff1a\u5982\u4e0d\u5bf9\u9f50\uff0c\u957f\u5ea6\u4e3a5, \u53d6age\u6570\u636e\uff0c\u9700\u8981\u8bfb\u4e24\u6b21\u7684\u6570\u636e\u6765\u62fc\u63a5\u3002\n  printf(\"%d\\n\",s.age);\n  //\u5b57\u8282\u5bf9\u9f50\uff1a\u8865\u7a7a\u6210\uff0c\u7c7b\u578b\u6700\u5927\u7684\u5143\u7d20 \u7684\u6574\u6570\u500d -&gt; \u7a7a\u95f4\u6362\u65f6\u95f4(\u907f\u514d\u8bfb\u4e24\u6b21\u6765\u62fc\u63a5\u6570\u636e)\n  //          sex \u8865\u9f503\u4e2achar \u4e0eint\u60f3\u7b49\u5bf9\u9f50\u540e\uff0c\u53ea\u9700\u8bfb\u4e00\u6b21 \n  printf(\"%d\\n\",sizeof(stu));  //8 \n  return 0;\n}\n</code></pre> <p>\u7ed3\u6784\u4f53\u5bf9\u9f50\u7684\u5173\u952e\u77e5\u8bc6\u70b9\uff1a</p> <ol> <li> <p>\u5bf9\u9f50\u539f\u5219\uff1a\u7ed3\u6784\u4f53\u7684\u5bf9\u9f50\u662f\u6309\u7167\u6210\u5458\u4e2d\u5360\u7528\u7a7a\u95f4\u6700\u5927\u7684\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u5bf9\u9f50\u7684\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5bf9\u9f50\u7684\u57fa\u672c\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u5373\u7ed3\u6784\u4f53\u7684\u8d77\u59cb\u5730\u5740\u5fc5\u987b\u662f\u6210\u5458\u4e2d\u6700\u5927\u6570\u636e\u7c7b\u578b\u7684\u500d\u6570\u3002</p> </li> <li> <p>\u6210\u5458\u5bf9\u9f50\uff1a\u7ed3\u6784\u4f53\u7684\u6210\u5458\u53d8\u91cf\u6309\u7167\u5b9a\u4e49\u7684\u987a\u5e8f\u4f9d\u6b21\u6392\u5217\u5728\u5185\u5b58\u4e2d\u3002\u6bcf\u4e2a\u6210\u5458\u53d8\u91cf\u7684\u5bf9\u9f50\u8981\u6c42\u662f\u5176\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u3002\u5982\u679c\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\u7684\u5927\u5c0f\u4e0d\u80fd\u88ab\u5f53\u524d\u4f4d\u7f6e\u7684\u5bf9\u9f50\u5355\u4f4d\u6574\u9664\uff0c\u5219\u9700\u8981\u5728\u5176\u540e\u63d2\u5165\u9002\u5f53\u6570\u91cf\u7684\u586b\u5145\u5b57\u8282\uff0c\u4ee5\u6ee1\u8db3\u5bf9\u9f50\u8981\u6c42\u3002</p> </li> <li> <p>\u7ed3\u6784\u4f53\u5bf9\u9f50\uff1a\u7ed3\u6784\u4f53\u7684\u603b\u5927\u5c0f\u662f\u6240\u6709\u6210\u5458\u53d8\u91cf\u5927\u5c0f\u4e4b\u548c\uff0c\u52a0\u4e0a\u586b\u5145\u5b57\u8282\u7684\u5927\u5c0f\u3002\u586b\u5145\u5b57\u8282\u7684\u5927\u5c0f\u53d6\u51b3\u4e8e\u524d\u9762\u7684\u6210\u5458\u53d8\u91cf\u7684\u5bf9\u9f50\u8981\u6c42\u548c\u5f53\u524d\u4f4d\u7f6e\u7684\u5bf9\u9f50\u5355\u4f4d\u3002</p> </li> <li> </li> <li> <p>\u7ed3\u6784\u4f53\u5bf9\u9f50\u7684\u5f71\u54cd\uff1a\u7ed3\u6784\u4f53\u5bf9\u9f50\u53ef\u4ee5\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u7684\u6548\u7387\uff0c\u51cf\u5c11\u5185\u5b58\u788e\u7247\u548c\u6d6a\u8d39\u3002\u4f46\u662f\uff0c\u8fc7\u5ea6\u7684\u5bf9\u9f50\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\uff0c\u56e0\u4e3a\u586b\u5145\u5b57\u8282\u4f1a\u5360\u7528\u989d\u5916\u7684\u7a7a\u95f4\u3002</p> </li> <li> <p>\u7ed3\u6784\u4f53\u5bf9\u9f50\u7684\u53ef\u79fb\u690d\u6027\uff1a\u7ed3\u6784\u4f53\u5bf9\u9f50\u662f\u4e0e\u7f16\u8bd1\u5668\u548c\u5e73\u53f0\u76f8\u5173\u7684\u3002\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u548c\u5e73\u53f0\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u5bf9\u9f50\u89c4\u5219\u548c\u9ed8\u8ba4\u5bf9\u9f50\u65b9\u5f0f\u3002\u4e3a\u4e86\u786e\u4fdd\u4ee3\u7801\u7684\u53ef\u79fb\u690d\u6027\uff0c\u5e94\u8be5\u9075\u5faa\u6807\u51c6\u7684\u5bf9\u9f50\u89c4\u5219\uff0c\u5e76\u907f\u514d\u4f9d\u8d56\u4e8e\u7279\u5b9a\u7684\u5bf9\u9f50\u65b9\u5f0f\u3002</p> </li> </ol> <p>\u603b\u4e4b\uff0c\u7ed3\u6784\u4f53\u5bf9\u9f50\u662f\u4e3a\u4e86\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u6548\u7387\u548c\u4f18\u5316\u5185\u5b58\u5360\u7528\u800c\u8fdb\u884c\u7684\u4e00\u79cd\u5185\u5b58\u5e03\u5c40\u65b9\u5f0f\u3002\u4e86\u89e3\u7ed3\u6784\u4f53\u5bf9\u9f50\u7684\u77e5\u8bc6\u70b9\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u5730\u7406\u89e3\u548c\u63a7\u5236\u7ed3\u6784\u4f53\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u50a8\u65b9\u5f0f\u3002</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#pragma-pack-pragma-pack","title":"pragma pack \u6307\u4ee4\uff1a\u6709\u4e9b\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86<code>#pragma pack</code>\u6307\u4ee4\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u5bf9\u9f50\u5355\u4f4d\u6765\u4fee\u6539\u7ed3\u6784\u4f53\u7684\u5bf9\u9f50\u65b9\u5f0f\u3002\u8fd9\u53ef\u4ee5\u7528\u6765\u4f18\u5316\u5185\u5b58\u5360\u7528\u6216\u4e0e\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u3002","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_20","title":"\u9010\u6bb5\u5bf9\u9f50","text":"<pre><code>typedef struct stu\n{\n    char sex;\n    short num;\n    int age;\n}stu;   // 1 2\u88651 + 4 =8\n\ntypedef struct stu\n{\n    char sex;\n    int age;\n    short num;\n}stu;   //1\u88653 + 4 + 2\u88652 =12     \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_21","title":"\u5e26\u4f4d\u6570\u6307\u5b9a\u7684 \u9010\u6bb5\u5bf9\u9f50","text":"<pre><code>struct s\n{\n    int i: 8; //\u5360int\u578b\u91cc\u76848\u4f4d\n    int j: 4; //\u5360int\u578b\u91cc\u76844\u4f4d\n    double b; //8\n    int a:3;\n}; //4\u88654 +  8 + 4\u88654  = 24 \u9010\u6bb5\u5bf9\u9f50 \nprintf(\"sizeof(s1)= %d\\n\", sizeof(s2));\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_22","title":"\u5e26\u8054\u5408\u4f53 \u7684\u5bf9\u9f50","text":"<pre><code>typedef struct stu\n{\n   int num;       //4\n   char name[30]; //30  \n   char job;             //1   \n   double sex;       //8\n   union    //\u53ea\u5206\u914d\u6700\u5927\u5143\u7d20\u7684\u7a7a\u95f4\uff088\uff09\n   {\n     int grade; //4\n     double d;      //8   \u7c7b\u578b\u6700\u5927\u503c\n   }gorp;\n}stu;  //\u7c7b\u578b\u6700\u5927\u503c8 \uff0c\u603b\u957f51\uff0c\u8865\u62108\u7684\u500d\u6570 \u4e3a56\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_23","title":"\u5b9e\u4f8b","text":"<pre><code>typedef union\n{\n   long i;\n   int k[5];\n   char c;\n} DATE; \u3000\n\nstruct data\n{\n   int cat;\n   DATE cow;\n   double dog;\n} too;\n\u3000 \nDATE max; \n\n//\u5219\u8bed\u53e5 printf(\"%d\",sizeof(struct data)+sizeof(max));\u7684\u6267\u884c\u7ed3\u679c\u662f___,\n/*\n20+32= 52\ntypedef union //\u6700\u5927\u5143\u7d20\u7a7a\u95f4 \u4e3a20\n{\n    long i;   //8\n    int k[5]; //4*5=20\n    char c;   //1\n} DATE; \u3000\n\nstruct data\n{\n    int cat;  //4\n    DATE cow; //20\n    double dog; //8\n} too;   // 4 +20 +8 = 32 \u521a\u597d\u662f8\u7684\u500d\u6570\n*/\n</code></pre> <p>\u5e26\u51fd\u6570\u6307\u9488\u7684\u7ed3\u6784\u4f53\u5927\u5c0f\u8ba1\u7b97 </p> <p>\u770b\u51fd\u6570\u6307\u9488\u524d\u9762\u7684\u8fd4\u56de\u53c2\u6570\u7c7b\u578b\u5c31\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u51fd\u6570\u6307\u9488</p> <pre><code>typedef struct {\n    char *description;\n    int (*init)(void *self);\n    void (*describe)(void *self);\n    void (*destroy)(void *self);\n    void *(*move)(void *self, Direction direction);\n    int (*attack)(void *self, int damage);\n } Object;\n\n int Object_init(void *self);\n void Object_destroy(void *self);\n void Object_describe(void *self);\n void *Object_move(void *self, Direction direction);\n int Object_attack(void *self, int damage);\n void *Object_new(size_t size, Object proto, char *description);\n\n #define NEW(T, N) Object_new(sizeof(T), T##Proto, N)\n #define _(N) proto.N\n\n #endif\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_24","title":"\u5e38\u7528\u7684\u5173\u952e\u5b57","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#const","title":"const","text":"<pre><code>const int a; \nint const a;    //\u90fd\u4e00\u6837\uff0c\u58f0\u660ea\u662f\u4e00\u4e2a\u5e38\u6574\u578b\u6570(a\u4e0d\u53ef\u66f4\u6539)\nconst int *a;   //a\u662f\u4e00\u4e2a\u6307\u5411\u5e38\u6574\u578b\u6570\u7684\u6307\u9488(\u6307\u5411\u7684\u6574\u578b\u6570(\u6307\u5411\u7684\u5185\u5bb9)\u4e0d\u53ef\u6539\uff0c\u4f46\u6307\u9488(\u5730\u5740)\u53ef\u4ee5)\nint * const a;  //a\u662f\u4e00\u4e2a\u6307\u5411\u6574\u578b\u6570\u7684\u5e38\u6307\u9488(\u4e5f\u5c31\u662f\u8bf4\uff0c\u6307\u5411\u7684\u6574\u578b\u6570\u53ef\u6539\uff0c\u4f46\u6307\u9488(\u5730\u5740)\u4e0d\u53ef\u6539)\nint const * a const;  //a\u662f\u4e00\u4e2a\u6307\u5411\u5e38\u6574\u578b\u6570\u7684\u5e38\u6307\u9488(\u90fd\u4e0d\u53ef\u6539)\n\nconst char const *argv; // Declaration of a pointer to constant character data\nconst char *str = \"Hello\";\nconst char const *ptr = str; // Pointer to constant character data\nchar const *name = \"John\"; // Another example of a pointer to constant character data\n\nconst char * const *argv; // Declaration of a constant pointer to a constant pointer to constant characters\nconst char *str = \"Hello\";\nconst char * const ptr = &amp;str; // Constant pointer to constant character data\nchar *const *names; // Pointer to constant pointer to characters\n\n\n\u6ce8  //\u58f0\u660e\u4e3aconst\u540e\uff0c\u7f16\u8bd1\u5668\u4f1a\u628a\u5b83\uff0c\u653e\u5728\u5e38\u91cf\u533a\uff0c\u4fdd\u62a4\u8d77\u6765\uff0c\u53ea\u8bfb\u4e0d\u53ef\u7be1\u6539(\u907f\u514dbug \u589e\u5f3a\u5065\u58ee\u6027)\n   //\u5355\u72ec\u8003\uff0c\u6ca1\u95ee\u9898\uff0c\u4f46\u81ea\u5df1\u7f16\u5199\u7a0b\u5e8f\u65f6\u5e38\u88ab\u9057\u5fd8\uff0c \u5176\u6839\u672c\u65f6\uff0c\u7a0b\u5e8f\u7684\u5b89\u5168\u610f\u8bc6\u6ca1\u5efa\u7acb\u3002\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_25","title":"\u4f8b\u5b50","text":"<pre><code>int a=248; b=4;\nint const c=21;\nconst int *d=&amp;a;\nint *const e=&amp;b;\nint const *f const =&amp;a;\n\n\u8bf7\u95ee\u4e0b\u5217\u8868\u8fbe\u5f0f\u54ea\u4e9b\u4f1a\u88ab\u7f16\u8bd1\u5668\u7981\u6b62\uff1f\u4e3a\u4ec0\u4e48\uff1f\n*c=32;\nd=&amp;b;*d=43;\n*e=34;e=&amp;a;\nf=0x321f;\n\n\n*c=32 //\u7981\u6b62: c\u662f\u6574\u578b\u6570\uff0c\u4e0d\u662f\u6307\u9488\n*d=43 //\u7981\u6b62: d\u6307\u5411\u7684\u6574\u578b\u6570\u5df2const\u58f0\u660e\u662f\u53ea\u8bfb\ne = &amp;a //\u7981\u6b62: e\u5df2const\u58f0\u660e\u662f\u5e38\u6307\u9488\nf=0x321f; //\u7981\u6b62: f \u5df2const\u58f0\u660e\u662f\u5e38\u6307\u9488\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#const_1","title":"const \u5728\u4e0d\u540c\u4f4d\u7f6e\u7684\u610f\u4e49","text":"<pre><code>char * const p; //\u5e38\u91cf\u6307\u9488\uff0cp\u7684\u503c\uff08\u5730\u5740\uff09\u4e0d\u53ef\u4ee5\u4fee\u6539\nchar const * p; //\u6307\u5411\u5e38\u91cf\u7684\u6307\u9488\uff0c\u6307\u5411\u7684\u5e38\u91cf\u503c\u4e0d\u53ef\u4ee5\u6539\nconst char *p\uff1b //\u548cchar const *p\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#static","title":"static","text":""},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_26","title":"\u57fa\u7840\u77e5\u8bc6","text":"<ul> <li>\u9759\u6001\u53d8\u91cf(\u7528\u4e86static\u7684\u5c40\u90e8\u53d8\u91cf)</li> </ul> <p>\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u58f0\u660e\u7684\u53d8\u91cf, \u4e14\u5b58\u50a8\u4e8e\u9759\u6001\u5185\u5b58\u4e2d, \u4e0d\u5c5e\u4e8e\u5806\u6808\u7684\u5185\u5b58</p> <ul> <li>\u5168\u5c40\u53d8\u91cf</li> </ul> <p>\u5728\u51fd\u6570\u5916\u90e8\u6216\u8005\u4ee3\u7801\u5757\u4e4b\u5916\u58f0\u660e\u7684\u53d8\u91cf, \u4e14\u5b58\u50a8\u4e8e\u9759\u6001\u5185\u5b58\u4e2d, \u4e0d\u5c5e\u4e8e\u5806\u6808\u7684\u5185\u5b58</p> <ul> <li>\u81ea\u52a8\u53d8\u91cf</li> </ul> <p>\u5728\u4ee3\u7801\u5757\u4e4b\u5185\u58f0\u660e\u7684\u53d8\u91cf, \u5b58\u50a8\u4e8e\u5806\u6808\u4e2d</p> <ul> <li>\u5bc4\u5b58\u5668\u53d8\u91cf</li> </ul>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_27","title":"\u9759\u6001\u5c40\u90e8\u53d8\u91cf","text":"<p>\u8ba9\u5c40\u90e8\u53d8\u91cf\u80fd \u6301\u4e45\u5b58\u5728 (\u6539\u53d8\u751f\u5b58\u5468\u671f)</p> <pre><code>#include &lt;stdio.h&gt;\n\nvoid count()\n{\n    static int num = 0; //\u5b9a\u4e49\u9759\u6001\u5c40\u90e8\u53d8\u91cf -&gt; \u6570\u636e\u6301\u4e45(\u6539\u53d8\u751f\u5b58\u5468\u671f)\n                        //\u5e95\u5c42: \u4ece\u6808\u533a\u79fb\u5230\u5168\u5c40\u6570\u636e\u533a,\u5b9e\u73b0\u6301\u4e45(\u7a0b\u5e8f\u9000\u51fa\u65f6\u624d\u91ca\u653e)\n                        //\u601d\u60f3: \u60f3\u6570\u636e\u6301\u4e45\u5b58\u5728\uff0c\u53c8\u907f\u514d\u5168\u5c40\u53d8\u91cf\u7684\u5f3a\u8026\u5408\u95ee\u9898\n    num++;\n    printf(\"%d\\n\",num);\n}\n\nint main(void)\n{\n    int i=0;\n    for (i = 0;i &lt;= 5;i++)\n    {\n        count();  //\u80fd\u6301\u4e45\u4fdd\u6301\u4e0a\u4e00\u6b21\u7684\u503c\n    }\n    return 0;\n}\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_28","title":"\u9759\u6001\u5168\u5c40\u53d8\u91cf","text":"<p>\u4f7f\u53d8\u91cf \u5916\u90e8\u6587\u4ef6\uff0c\u4e0d\u53ef\u8bbf\u95ee - - -&gt; \u907f\u514d\u540d\u5b57\u51b2\u7a81\u548c\u5f3a\u8026\u5408</p> <pre><code>//---main.c\n#include &lt;stdio.h&gt;\n\nvoid fn();\nint num;   //\u5b9a\u4e49 \u5168\u5c40\u53d8\u91cf\n//static int num; //\u5b9a\u4e49\u9759\u6001\u5168\u5c40\u53d8\u91cf(\u9650\u5b9a\u4ec5\u672c\u6587\u4ef6\u5185 \u53ef\u89c1)\n                  //\u5e95\u5c42: \u5b58\u50a8\u5728\u5168\u5c40\u6570\u636e\u533a(\u7a0b\u5e8f\u9000\u51fa\u65f6\u624d\u91ca\u653e\uff0c\u4e0d\u50cf\u6808\u548c\u5806)\n                  //\u601d\u60f3: \u907f\u514d\u540d\u5b57\u51b2\u7a81(\u4ec5\u6587\u4ef6\u5185\u53ef\u89c1),\u548c\u5f3a\u8026\u5408(\u907f\u514d\u5168\u5c40\u53d8\u91cf\u7684\u591a\u6587\u4ef6\u5f3a\u8026\u5408)\nvoid main(){\n    printf(\"init num=%d\\n\",num);  //\u81ea\u52a8\u521d\u59cb\u5316\u4e3a0\n    num =10; \n    printf(\"main num=%d\\n\",num);\n    fn();\n}\n\n//---fn.c\n#include &lt;stdio.h&gt;\nextern int num; //\u58f0\u660e num \u662f\u5916\u90e8\u53d8\u91cf //static int num\nvoid fn()\n{\n    num++;\n    printf(\"fn n=%d\\n\",num);\n}\n//---\u4f7f\u7528\n$ gcc main.c fn.c //\u5f53\u7528static\u65f6\uff0c\u94fe\u63a5\u9519\u8bef(\u5916\u90e8\u6587\u4ef6 \u4e0d\u53ef\u8bbf\u95ee static \u9759\u6001\u5168\u5c40\u53d8\u91cf)\n$ ./a.out \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_29","title":"\u9759\u6001\u51fd\u6570","text":"<p>\u4f7f\u51fd\u6570\uff0c\u5916\u90e8\u6587\u4ef6\uff0c\u4e0d\u53ef\u8bbf\u95ee - - -&gt;\u9690\u85cf \u9694\u79bb(\u9650\u5b9a\u4f5c\u7528\u57df)</p> <pre><code>//---main.c\n#include &lt;stdio.h&gt;\nextern void fn(); //\u58f0\u660e fn \u662f\u5916\u90e8\u51fd\u6570\nvoid main(){\n    fn();\n}\n//---fn.c\n#include &lt;stdio.h&gt;\n\n//\u58f0\u660e\u4e3a\u9759\u6001\u51fd\u6570 -&gt; \u9690\u85cf \u9694\u79bb \u4fdd\u62a4(\u5916\u90e8\u6587\u4ef6\u4e0d\u80fd\u8bbf\u95ee \u6539\u53d8\u4f5c\u7528\u57df)                  \n//\u6ce8:\u5728C++\u4e2d\u5c31\u6bd4\u8f83\u91cd\u8981\uff0c\u8d4b\u4e88\u5bf9\u8c61\uff0c\u552f\u4e00\u5171\u4eab\u7684\u6982\u5ff5\nstatic void fn()  \n{\n    printf(\"fn go\\n\");\n}\n//---\u4f7f\u7528\n$ gcc main.c fn.c //\u5f53\u7528static\u65f6\uff0c\u94fe\u63a5\u9519\u8bef(\u5916\u90e8\u6587\u4ef6 \u4e0d\u53ef\u8bbf\u95ee static \u9759\u6001\u51fd\u6570)\n$ ./a.out \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_30","title":"\u603b\u7ed3","text":"<ul> <li>\u7528\u4e8e\u51fd\u6570\u5b9a\u4e49\u3001\u6216\u8005\u4ee3\u7801\u5757\u4e4b\u5916\u7684\u58f0\u660e\u53d8\u91cf</li> </ul> <p>\u6b64\u65f6static\u7528\u4e8e\u6539\u53d8\u5176==\u94fe\u63a5\u5c5e\u6027==, \u5c06externa\u6539\u4e3ainternal, \u4f46\u662f\u5b83\u4eec\u7684\u5b58\u50a8\u7c7b\u578b\u548c\u4f5c\u7528\u57df\u4e0d\u53d7\u5f71\u54cd. \u6b64\u79cd\u65b9\u5f0f\u751f\u547d\u7684\u51fd\u6570\u6216\u53d8\u91cf\u53ea\u80fd\u5728\u58f0\u660e\u5b83\u4eec\u7684\u6e90\u6587\u4ef6\u4e2d\u8bbf\u95ee</p> <ul> <li>\u7528\u4e8e\u4ee3\u7801\u5757\u5185\u90e8\u7684\u53d8\u91cf\u58f0\u660e</li> </ul> <p>\u6b64\u65f6static\u4fee\u6539\u53d8\u91cf\u7684==\u5b58\u50a8\u7c7b\u578b==, \u4ece\u81ea\u52a8\u53d8\u91cf\u6539\u4e3a\u9759\u6001\u53d8\u91cf, \u4f46\u662f\u53d8\u91cf\u7684\u8fde\u63a5\u7c7b\u578b\u548c\u4f5c\u7528\u57df\u4e0d\u5f71\u54cd. \u8fd9\u79cd\u65b9\u5f0f\u58f0\u660e\u7684\u53d8\u91cf\u5728\u7a0b\u5e8f\u6267\u884c\u524d\u521b\u5efa,\u5728\u6574\u4e2a\u7a0b\u5e8f\u6267\u884c\u671f\u95f4\u4e00\u76f4\u5b58\u5728.</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#volatile","title":"volatile","text":"<p>\u58f0\u660e\u53d8\u91cf\u662f\u6613\u53d8\u7684, \u907f\u514d\u88ab\u7f16\u8bd1\u5668\u4f18\u5316</p>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_31","title":"\u8bfb\u786c\u4ef6\u5bc4\u5b58\u5668\u65f6(\u5982\u67d0\u4f20\u611f\u5668\u7684\u7aef\u53e3)","text":"<pre><code>//\u5047\u8bbe\u67d0\u70df\u96fe\u4f20\u611f\u5668\u7684 \u786c\u4ef6\u5bc4\u5b58\u5668\u5982\u4e0b(\u5f53\u53c8\u70df\u96fe\u65f6\u62a5\u8b66\u53d8\u4e3a1)\n#define GPA1DAT *((volatile unsigned int*)0xE0200084) \n\nvoid main(){\n while (1){//\u53cd\u590d\u8bfb\u53d6GPA1DAT\u503c\uff0c\u5f53\u4e3a1\u65f6\u706b\u707e\u62a5\u8b66\n    if (GPA1DAT) {  //\u5982\u4e0d\u52a0volatile\uff0c\u7f16\u8bd1\u5668\u4f18\u5316\u540e\uff0c\u53d8\u6210\u53ea\u8bfb\u4e00\u6b21\uff0c\n                    //\u540e\u9762\u7528\u7684\u662f\u526f\u672c\u6570\u636e\u3002\u4e00\u76f4\u4e3a0\n    fire()      \n    break;\n     }\n }\n}\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_32","title":"\u591a\u7ebf\u7a0b\u4e2d\u5bf9\u5171\u4eab\u7684\u53d8\u91cf\u7684\u4fee\u6539","text":"<pre><code>volatile  char  bStop  =  0;  //\u6ce8\u610f\uff1a\u9700\u58f0\u660e\u4e3avolatile\uff0c\u7ebf\u7a0b\u800c\u624d\u80fd\u901a\u8fc7\u5b83\u505c\u6b62\u7ebf\u7a0b1\n                          //\u5982\u4e0d\u58f0\u660e\uff0c\u7f16\u8bd1\u5668\u4f18\u5316\u540e\uff0c\u53d8\u6210\u4e00\u76f4\u8bfb\u526f\u672c\u6570\u636e\u3002\nvoid thread1(){  \n  while(!bStop)  {\n    //...\u4e00\u76f4\u5faa\u73af\u505a\u4e00\u4e9b\u4e8b\u60c5\n  }  \n}\nvoid thread2(){  \n   //...\u5904\u7406\u4e00\u4e9b\u4e8b\u60c5\u540e\u3002\n   bStop =1; //\u7ec8\u6b62\u7ebf\u7a0b2  \n} \n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_33","title":"\u4e2d\u65ad\u4e2d\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u4fee\u6539","text":"<pre><code>static int i=0; //\u5e94\u52a0static\u4fee\u9970\nint main(void)\n{\n     ...\n     while (1){\n     if (i) { //\u867d\u4e2d\u65ad\u4e2d\u66f4\u6539\u4e86i\u7684\u503c\uff0c\u4f46\u56e0\u672a\u58f0\u660ei \u662f\u6613\u53d8\u7684\uff0c\n        //\u7f16\u8bd1\u5668\u4f18\u5316\u540e\uff0c\u5bfc\u81f4\u5b83\u8bfb\u7684\u662f\u526f\u672c\u6570\u636e\uff0c\u5bfc\u81f4\u4e00\u76f4\u5faa\u73af\u4e0d\u9000\u51fa\n       break;\n     }\n    }\n}\nvoid interrupt(void)\n{\n      i=1;  //\u4e2d\u65ad\u4e2d\u6539\u53d8 i\u7684\u503c\uff0c\u4f46\n}\n</code></pre>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#_34","title":"\u601d\u8003","text":"<ol> <li> <p>\u601d\u8003: \u4e00\u4e2a\u53c2\u6570\u65e2\u53ef\u4ee5\u662fconst\u8fd8\u53ef\u4ee5\u662fvolatile\u5417</p> <p>\u4e00\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\u662f\u4f7f\u7528 const volatile \u4fee\u9970\u7684\u4e00\u4e2a\u6307\u5411\u786c\u4ef6\u5bc4\u5b58\u5668\u7684\u6307\u9488\u3002\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5e38\u5e38\u9700\u8981\u76f4\u63a5\u8bbf\u95ee\u786c\u4ef6\u5bc4\u5b58\u5668\u6765\u8bfb\u53d6\u6216\u5199\u5165\u786c\u4ef6\u72b6\u6001\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u901a\u5e38\u662f\u6613\u53d8\u7684\uff0c\u56e0\u4e3a\u786c\u4ef6\u72b6\u6001\u53ef\u80fd\u4f1a\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u800c\u53d1\u751f\u53d8\u5316\u3002\u540c\u65f6\uff0c\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e5f\u662f\u53ea\u8bfb\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\u786c\u4ef6\u72b6\u6001\u3002(\u5bf9\u6211\u4eec\u6765\u8bf4\u662f\u53ea\u8bfb\u7684, \u53ea\u80fd\u7531\u8bbe\u5907\u672c\u8eab\u81ea\u5df1\u66f4\u6539)</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u53ea\u8bfb\u7684\u72b6\u6001\u5bc4\u5b58\u5668\uff0c\u7528\u4e8e\u68c0\u6d4b\u67d0\u4e2a\u5916\u90e8\u8bbe\u5907\u7684\u72b6\u6001\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 const volatile \u4fee\u9970\u4e00\u4e2a\u6307\u5411\u8be5\u5bc4\u5b58\u5668\u7684\u6307\u9488\uff0c\u4ee5\u786e\u4fdd\u7f16\u8bd1\u5668\u4e0d\u4f1a\u5bf9\u8be5\u6307\u9488\u8fdb\u884c\u4f18\u5316\uff0c\u5e76\u4e14\u6211\u4eec\u4e0d\u80fd\u901a\u8fc7\u8be5\u6307\u9488\u4fee\u6539\u786c\u4ef6\u72b6\u6001\u3002</p> <pre><code>const volatile uint32_t* statusRegister = (uint32_t*)0x12345678;\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cstatusRegister \u662f\u4e00\u4e2a\u6307\u5411\u5730\u5740 0x12345678 \u7684\u53ea\u8bfb\u72b6\u6001\u5bc4\u5b58\u5668\u7684\u6307\u9488\u3002\u7531\u4e8e\u4f7f\u7528\u4e86 const volatile \u4fee\u9970\uff0c\u7f16\u8bd1\u5668\u5c06\u786e\u4fdd\u5bf9\u8be5\u6307\u9488\u7684\u4efb\u4f55\u8bfb\u53d6\u64cd\u4f5c\u90fd\u4e0d\u4f1a\u88ab\u4f18\u5316\uff0c\u5e76\u4e14\u6211\u4eec\u4e0d\u80fd\u901a\u8fc7\u8be5\u6307\u9488\u4fee\u6539\u786c\u4ef6\u72b6\u6001\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u5b89\u5168\u5730\u8bfb\u53d6\u786c\u4ef6\u72b6\u6001\u800c\u4e0d\u4f1a\u53d7\u5230\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u5e72\u6270\u3002</p> </li> <li> <p>\u4e0b\u9762\u51fd\u6570\u6709\u95ee\u9898:</p> <pre><code>int square(volatile int *ptr) \n{ \n   return *ptr * *ptr;  \n}   \n//\u6539\uff1a\nint square(volatile int *ptr) \n{ \n   return *ptr * *ptr;  // ptr\u6307\u5411\u7684\u6570\u636e\u662f\u6613\u53d8\u7684\uff0c\u524d\u9762*ptr\u548c\u540e\u9762\u7684*ptr\u53ef\u80fd\u4e0d\u4e00\u6837\u3002\n                    // \u6539\u4e3a int  a = *ptr; return a*a; \u5373\u53ef\n}   \n</code></pre> </li> </ol>"},{"location":"language/C_asm/Basic%20C/base2/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.html#define","title":"define","text":""},{"location":"language/C_asm/Code%20specification/%E6%A8%A1%E5%BC%8F.html","title":"\u6a21\u5f0f","text":"<p>\u5f53\u4f60\u7f16\u5199\u66f4\u591a\u7684C\u4ee3\u7801\u65f6\uff0c\u4f60\u5e94\u8be5\u6309\u7167\u4e0b\u5217\u6a21\u5f0f\uff1a</p> <ul> <li>\u8c03\u7528\u51fd\u6570\u3002</li> <li>\u5982\u679c\u8fd4\u56de\u503c\u51fa\u73b0\u9519\u8bef\uff08\u6bcf\u6b21\u90fd\u5fc5\u987b\u68c0\u67e5\uff09\u3002</li> <li>\u6e05\u7406\u521b\u5efa\u7684\u6240\u6709\u8d44\u6e90\u3002</li> <li>\u6253\u5370\u51fa\u6240\u6709\u53ef\u80fd\u6709\u5e2e\u52a9\u7684\u9519\u8bef\u4fe1\u606f\u3002</li> </ul> <p>\u7f16\u5199\u4efb\u4f55\u4ee3\u7801\u65f6\uff0c\u5c06\u5b83\u5e26\u6765\u7684\u6548\u679c\u653e\u5927\u4e00\u5343\u500d\uff0c\u56e0\u4e3a\u522b\u770b\u4ed6\u8fd9\u4e2a\u7a0b\u5e8f\u6bd4\u8f83\u5c0f\uff0c\u4f46\u662f\u7528\u5728\u4e00\u4e2a\u51e0\u5343\u3001\u51e0\u4e07\u884c\u4ee3\u7801\u7684\u9879\u76ee\u4e0a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6027\u80fd\u7684\u5de8\u5927\u63d0\u5347</p> <ul> <li>\u4e0d\u8981\u9690\u85cf\u67d0\u4e2a\u53d8\u91cf\uff0c\u5c31\u50cf\u4e0a\u9762<code>scope_demo</code>\u4e2d\u5bf9<code>count</code>\u6240\u505a\u7684\u4e00\u6837\u3002\u8fd9\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e00\u4e9b\u9690\u853d\u7684bug\uff0c\u4f60\u8ba4\u4e3a\u4f60\u6539\u53d8\u4e86\u67d0\u4e2a\u53d8\u91cf\u4f46\u5b9e\u9645\u4e0a\u6ca1\u6709\u3002</li> <li>\u907f\u514d\u8fc7\u591a\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5c24\u5176\u662f\u8de8\u8d8a\u591a\u4e2a\u6587\u4ef6\u3002\u5982\u679c\u5fc5\u987b\u7684\u8bdd\uff0c\u8981\u4f7f\u7528\u8bfb\u5199\u5668\u51fd\u6570\uff0c\u5c31\u50cf<code>get_age</code>\u3002\u8fd9\u5e76\u4e0d\u9002\u7528\u4e8e\u5e38\u91cf\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u53ea\u8bfb\u7684\u3002\u6211\u662f\u8bf4\u5bf9\u4e8e<code>THE_SIZE</code>\u8fd9\u79cd\u53d8\u91cf\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u522b\u4eba\u80fd\u591f\u4fee\u6539\u5b83\uff0c\u5c31\u5e94\u8be5\u4f7f\u7528\u8bfb\u5199\u5668\u51fd\u6570\u3002</li> <li>\u5728\u4f60\u4e0d\u6e05\u695a\u7684\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u628a\u5b83\u653e\u5728\u5806\u4e0a\u3002\u4e0d\u8981\u4f9d\u8d56\u4e8e\u6808\u7684\u8bed\u4e49\uff0c\u6216\u8005\u6307\u5b9a\u533a\u57df\uff0c\u800c\u662f\u8981\u76f4\u63a5\u4f7f\u7528<code>malloc</code>\u521b\u5efa\u5b83\u3002</li> <li>\u4e0d\u8981\u4f7f\u7528\u51fd\u6570\u7ea7\u7684\u9759\u6001\u53d8\u91cf\uff0c\u5c31\u50cf<code>update_ratio</code>\u3002\u5b83\u4eec\u5e76\u4e0d\u6709\u7528\uff0c\u800c\u4e14\u5f53\u4f60\u60f3\u8981\u4f7f\u4f60\u7684\u4ee3\u7801\u8fd0\u884c\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u65f6\uff0c\u4f1a\u6709\u5f88\u5927\u7684\u9690\u60a3\u3002\u5bf9\u4e8e\u826f\u597d\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u4eec\u4e5f\u975e\u5e38\u96be\u4e8e\u5bfb\u627e\u3002</li> <li> <p>\u907f\u514d\u590d\u7528\u51fd\u6570\u53c2\u6570\uff0c\u56e0\u4e3a\u4f60\u641e\u4e0d\u6e05\u695a\u4ec5\u4ec5\u60f3\u8981\u590d\u7528\u5b83\u8fd8\u662f\u5e0c\u671b\u4fee\u6539\u5b83\u7684\u8c03\u7528\u8005\u7248\u672c\u3002</p> </li> <li> <p>\u4f7f\u7528 if \u7684\u53d8\u91cf\u548c\u6570\u5b57\u5224\u65ad\u7684\u65f6\u5019\uff0c\u53cd\u7740\u5199</p> <p><code>if (x == 2)</code>  (NO)</p> <p><code>if (2 == 2)</code> (RIGHT)</p> </li> <li> <p>\u5934\u6587\u4ef6\u4fdd\u62a4</p> </li> </ul> <p>\u5bf9\u4e8e\u5934\u6587\u4ef6\u800c\u8a00\uff0c\u5728\u4e00\u4e2a\u7a0b\u5e8f\u4e2d\u6709\u53ef\u80fd\u88ab\u591a\u6b21\u5305\u542b(#include)\uff0c\u5982\u679c\u7f3a\u5c11\u5934\u6587\u4ef6\u4fdd\u62a4\uff0c\u5219\u4f1a\u53d1\u751f\u7f16\u8bd1\u9519\u8bef</p> <p>\u4e0d\u8981\u5c06 _ \u4f5c\u4e3a\u5b8f\u7684\u5f00\u5934\u6216\u8005\u7ed3\u5c3e\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f</p> <pre><code>  #ifndef VECTOR_H_INCLUDE\n    #define VECTOR_H_INCLUDE\n        /**TODO**/\n    #endif\n</code></pre> <p>\u5728\u5934\u6587\u4ef6\u4e2d\u4f7f\u7528\u5b8f\u6765\u5b9e\u73b0\u5934\u6587\u4ef6\u4fdd\u62a4\u662f\u4e3a\u4e86\u9632\u6b62\u5934\u6587\u4ef6\u88ab\u91cd\u590d\u5305\u542b\u800c\u5bfc\u81f4\u7684\u7f16\u8bd1\u9519\u8bef\u3002\u5b8f\u7684\u547d\u540d\u5e94\u8be5\u662f\u552f\u4e00\u7684\uff0c\u4ee5\u786e\u4fdd\u5934\u6587\u4ef6\u4fdd\u62a4\u7684\u6709\u6548\u6027\u3002\u56e0\u6b64\uff0c\u4e0d\u5efa\u8bae\u5c06 _ \u4f5c\u4e3a\u5b8f\u7684\u5f00\u5934\u6216\u7ed3\u5c3e\uff0c\u56e0\u4e3a\u5728C\u548cC++\u4e2d\uff0c\u6807\u8bc6\u7b26\u4ee5 _ \u5f00\u5934\u7684\u547d\u540d\u662f\u4fdd\u7559\u7ed9\u7cfb\u7edf\u4f7f\u7528\u7684\uff0c\u53ef\u80fd\u4f1a\u4e0e\u7cfb\u7edf\u5b9a\u4e49\u7684\u5b8f\u6216\u53d8\u91cf\u53d1\u751f\u51b2\u7a81\u3002</p> <p>\u5728\u7ed9\u5b8f\u547d\u540d\u65f6\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528\u5927\u5199\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\u6765\u786e\u4fdd\u552f\u4e00\u6027\uff0c\u5982\u5728\u60a8\u63d0\u4f9b\u7684\u793a\u4f8b\u4e2d\u7684 <code>VECTOR_H_INCLUDE</code>\u3002\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u907f\u514d\u4e0e\u7cfb\u7edf\u5b9a\u4e49\u7684\u5b8f\u6216\u53d8\u91cf\u53d1\u751f\u51b2\u7a81\uff0c\u786e\u4fdd\u5934\u6587\u4ef6\u4fdd\u62a4\u7684\u6b63\u5e38\u5de5\u4f5c\u3002</p> <ol> <li> <p><code>#if</code> \u548c <code>#ifdef</code>\uff1f</p> <ul> <li> <p>\u4f7f\u7528 <code>#if</code> \u800c\u4e0d\u662f <code>#ifdef</code></p> </li> <li> <p>\u53ef\u4ee5\u4f7f\u7528 <code>define()</code> \u6765\u4ee3\u66ff <code>#ifdef</code>\u7684\u529f\u80fd</p> <pre><code>  #if !define(USERS_DEFINE)\n    #define USERS_DEFINE ...\n  #endif\n</code></pre> </li> <li> <p>\u5bf9\u4e8e\u67d0\u4e9b\u5927\u6bb5\u9700\u8981\u6d88\u9664\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528\u6ce8\u91ca <code>/**/</code>\uff0c\u56e0\u4e3a\u6ce8\u91ca\u4e0d\u80fd\u5185\u5d4c\u7740\u6ce8\u91ca(<code>//</code>\u9664\u5916)\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u9ed1\u9b54\u6cd5\uff1a</p> <pre><code>  #if NOT_DECLARATION\n    /**\u60f3\u8981\u6ce8\u91ca\u7684\u4ee3\u7801**/\n  #endif\n</code></pre> </li> <li> <p>\u4e0d\u8981\u4f7f\u7528\u7eaf\u6570\u5b57</p> <ul> <li>\u610f\u5473\u7740\uff0c\u4e0d\u5728\u4f7f\u7528\u6beb\u65e0\u6807\u8bb0\u7684\u6570\u5b57\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f60\u8fc7\u4e86\u51e0\u4e2a\u6708\u518d\u770b\u6e90\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f60\u6839\u672c\u4e0d\u77e5\u9053\u8fd9\u4e2a\u6570\u5b57\u4ee3\u8868\u7740\u4ec0\u4e48</li> <li>\u800c\u5e94\u8be5\u4f7f\u7528<code>#define</code> \u7ed9\u5b83\u4e00\u4e2a\u540d\u5b57\uff0c\u6765\u8bf4\u660e\u8fd9\u4e2a\u6570\u5b57\u7684\u610f\u4e49\u3002</li> </ul> </li> </ul> <pre><code>#include &lt;threads.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdatomic.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\n#define THREAD_COUNT 10\n\natomic_int accountA = 100000000;    // \u8f6c\u51fa\u8d26\u6237\u521d\u59cb\u91d1\u989d\natomic_int accountB = 0;            // \u8f6c\u5165\u8d26\u6237\u521d\u59cb\u91d1\u989d\n\nint run(void *arg)\n{\n    int _amount = *((int *)arg);\n    while(1)\n    {\n        if(accountA &lt; _amount)\n            return thrd_error;\n\n        atomic_fetch_add(&amp;accountB, _amount);   // \u5c06\u91d1\u989d\u7d2f\u52a0\u5230\u8f6c\u5165\u8d26\u6237\n        atomic_fetch_sub(&amp;accountA, _amount);   // \u5c06\u91d1\u989d\u4ece\u8f6c\u51fa\u8d26\u6237\u4e2d\u6263\u9664\n    }\n    return thrd_success;\n}\n\nint main(void)\n{\n#if !defined(__STDC_NO_THREADS__) &amp;&amp; !defined(__STDC_NO_ATOMICS__)\n    thrd_t threads[THREAD_COUNT];\n    srand(time(NULL));\n\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        int amount = rand() % 50;   // \u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u751f\u6210\u4e00\u4e2a\u968f\u673a\u8f6c\u79fb\u91d1\u989d\n        thrd_create(&amp;threads[i], run, &amp;amount);\n    }\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        thrd_join(threads[i], NULL);\n    }\n\n    printf(\"A: %d.\\nB: %d.\\n\",accountA, accountB);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\uff1f\u5230\u5e95\u7528\u54ea\u4e2a\uff1f</p> </li> </ol>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html","title":"C\u8bed\u8a00\u51fd\u6570\u5206\u6790","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strcpystrdup","title":"\u5206\u6790strcpy()\u548cstrdup()","text":"<ul> <li>\u6e90\u4ee3\u7801\u5b9e\u73b0</li> <li>\u5404\u79cd\u7279\u70b9</li> <li>\u54ea\u4e2a\u4f7f\u7528\u66f4\u597d</li> <li>\u5177\u4f53\u4f8b\u5b50</li> </ul> <p>\u597d\u7684\uff0c\u8ba9\u6211\u6765\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b <code>strcpy</code> \u548c <code>strdup</code>\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strcpy","title":"strcpy","text":"<p><code>strcpy</code> \u662f C \u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u6570\u7ec4\u4e2d\u3002\u5176\u4ee3\u7801\u4e3a\uff1a</p> <p><pre><code>// strcpy \u7684\u6e90\u4ee3\u7801\u5b9e\u73b0\nchar *strcpy(char *dest, const char *src) {\n    char *save = dest;\n    while (*src != '\\0') {\n        *dest = *src;\n        dest++;\n        src?\n    }\n    *dest = '\\0';\n    return save;\n}\n</code></pre> <code>strcpy</code> \u7684\u7279\u70b9\uff1a</p> <ul> <li><code>strcpy</code> \u9700\u8981\u624b\u52a8\u786e\u4fdd\u76ee\u6807\u5b57\u7b26\u4e32\u6570\u7ec4\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6765\u5b58\u50a8\u6e90\u5b57\u7b26\u4e32\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002</li> <li><code>strcpy</code> \u4e0d\u4f1a\u81ea\u52a8\u5206\u914d\u5185\u5b58\uff0c\u9700\u8981\u624b\u52a8\u7ba1\u7406\u5185\u5b58\u7684\u5206\u914d\u548c\u91ca\u653e\u3002</li> <li>\u5982\u679c\u6e90\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u5e38\u91cf\u5b57\u7b26\u4e32\uff0c\u5982 \"tom\"\uff0c\u90a3\u4e48\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 <code>strcpy</code> \u6765\u8d4b\u503c\uff0c\u56e0\u4e3a\u5e38\u91cf\u5b57\u7b26\u4e32\u662f\u53ea\u8bfb\u7684\uff0c\u9700\u8981\u5206\u914d\u8db3\u591f\u7684\u5185\u5b58\u6765\u5b58\u50a8\u8be5\u5b57\u7b26\u4e32\u3002</li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strdup","title":"strdup","text":"<p><code>strdup</code> \u662f\u4e00\u4e2a\u975e\u6807\u51c6\u51fd\u6570\uff0c\u5b83\u5e76\u4e0d\u662f\u6240\u6709\u7684 C \u7f16\u8bd1\u5668\u90fd\u652f\u6301\uff0c\u4f46\u662f\u5b83\u975e\u5e38\u5e38\u89c1\uff0c\u5e76\u4e14\u5728\u5f88\u591a\u7cfb\u7edf\u4e0a\u90fd\u6709\u5b9e\u73b0\u3002<code>strdup</code> \u7528\u4e8e\u590d\u5236\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u65b0\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u7684\u6307\u9488\uff0c\u5176\u4e2d\u5b58\u50a8\u4e86\u590d\u5236\u7684\u5b57\u7b26\u4e32\u3002<code>strdup</code> \u7684\u7279\u70b9\uff1a</p> <pre><code>// strdup \u7684\u6e90\u4ee3\u7801\u5b9e\u73b0\nchar *strdup(const char *str) {\n    size_t len = strlen(str) + 1; // \u8ba1\u7b97\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u7ed3\u675f\u7b26 \\0\n    char *new_str = (char *)malloc(len); // \u5206\u914d\u8db3\u591f\u7684\u5185\u5b58\u7a7a\u95f4\n    if (new_str == NULL) {\n        return NULL; // \u5185\u5b58\u5206\u914d\u5931\u8d25\n    }\n    strcpy(new_str, str); // \u5c06\u6e90\u5b57\u7b26\u4e32\u590d\u5236\u5230\u65b0\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\n    //\u6216\u8005\u7528memcpy(new, str, len); \n    return new_str;\n}\n</code></pre> <ul> <li><code>strdup</code> \u4f1a\u81ea\u52a8\u5206\u914d\u8db3\u591f\u7684\u5185\u5b58\u6765\u5b58\u50a8\u590d\u5236\u7684\u5b57\u7b26\u4e32\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u7ba1\u7406\u5185\u5b58\u7684\u5206\u914d\u548c\u91ca\u653e\u3002</li> <li><code>strdup</code> \u8fd4\u56de\u7684\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u9700\u8981\u624b\u52a8\u91ca\u653e\uff0c\u4f7f\u7528\u5b8c\u6bd5\u540e\u5e94\u8be5\u8c03\u7528 <code>free</code> \u51fd\u6570\u6765\u91ca\u653e\u5185\u5b58\u3002</li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_1","title":"\u54ea\u4e2a\u4f7f\u7528\u66f4\u597d","text":"<p>\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 <code>strdup</code> \u66f4\u52a0\u5b89\u5168\u548c\u65b9\u4fbf\u3002\u56e0\u4e3a\u5b83\u4f1a\u81ea\u52a8\u5206\u914d\u8db3\u591f\u7684\u5185\u5b58\u6765\u5b58\u50a8\u590d\u5236\u7684\u5b57\u7b26\u4e32\uff0c\u907f\u514d\u4e86\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\uff0c\u4e5f\u7b80\u5316\u4e86\u5185\u5b58\u7ba1\u7406\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5e76\u975e\u6240\u6709\u7684 C \u7f16\u8bd1\u5668\u90fd\u652f\u6301 <code>strdup</code> \u51fd\u6570\uff0c\u5982\u679c\u9700\u8981\u5728\u8de8\u5e73\u53f0\u6216\u8005\u7279\u5b9a\u73af\u5883\u4e0b\u4f7f\u7528\uff0c\u53ef\u80fd\u9700\u8981\u8003\u8651\u517c\u5bb9\u6027\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_2","title":"\u5177\u4f53\u4f8b\u5b50","text":"<p>\u4e0b\u9762\u662f\u4f7f\u7528 <code>strcpy</code> \u548c <code>strdup</code> \u7684\u5177\u4f53\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n    char source[] = \"Hello\";\n    char dest1[20];\n    char *dest2;\n\n    // \u4f7f\u7528 strcpy\n    strcpy(dest1, source);\n    printf(\"strcpy: %s\\n\", dest1);\n\n    // \u4f7f\u7528 strdup\n    dest2 = strdup(source);\n    printf(\"strdup: %s\\n\", dest2);\n\n    // \u91ca\u653e strdup \u5206\u914d\u7684\u5185\u5b58\n    free(dest2);\n\n    return 0;\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u4f7f\u7528 <code>strcpy</code> \u5c06\u6e90\u5b57\u7b26\u4e32\u590d\u5236\u5230\u76ee\u6807\u5b57\u7b26\u4e32\u6570\u7ec4\u4e2d\uff0c\u7136\u540e\u4f7f\u7528 <code>strdup</code> \u590d\u5236\u6e90\u5b57\u7b26\u4e32\u5e76\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u65b0\u5206\u914d\u5185\u5b58\u7684\u6307\u9488\uff0c\u6700\u540e\u9700\u8981\u624b\u52a8\u91ca\u653e <code>strdup</code> \u5206\u914d\u7684\u5185\u5b58\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strcpymemcpy","title":"\u4f7f\u7528strcpy()\u548cmemcpy)()\u7684\u5206\u6790\u548c\u603b\u7ed3","text":"<p><code>strcpy</code>\u548c<code>memcpy</code>\u90fd\u662fC\u8bed\u8a00\u4e2d\u7528\u4e8e\u590d\u5236\u5185\u5b58\u5757\u7684\u51fd\u6570\uff0c\u4f46\u5b83\u4eec\u4e4b\u95f4\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u533a\u522b\u3002</p> <ul> <li> <p><code>strcpy</code>\u51fd\u6570\u7684\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>char *strcpy(char *dest, const char *src);\n</code></pre> <p><code>strcpy</code>\u51fd\u6570\u4f1a\u5c06<code>src</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u590d\u5236\u5230<code>dest</code>\u6307\u5411\u7684\u5b57\u7b26\u4e32\u4e2d\uff0c\u76f4\u5230\u9047\u5230\u5b57\u7b26\u4e32\u7ed3\u675f\u7b26<code>\\0</code>\u3002\u8fd9\u610f\u5473\u7740<code>strcpy</code>\u53ea\u80fd\u7528\u4e8e\u590d\u5236C\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p><code>memcpy</code>\u51fd\u6570\u7684\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>void *memcpy(void *dest, const void *src, size_t n);\n</code></pre> <p><code>memcpy</code>\u51fd\u6570\u4f1a\u4ece<code>src</code>\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u5f00\u59cb\uff0c\u590d\u5236<code>n</code>\u4e2a\u5b57\u8282\u7684\u6570\u636e\u5230<code>dest</code>\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u4e2d\u3002\u5b83\u662f\u4e00\u79cd\u901a\u7528\u7684\u5185\u5b58\u590d\u5236\u51fd\u6570\uff0c\u53ef\u4ee5\u7528\u4e8e\u590d\u5236\u4efb\u610f\u7c7b\u578b\u7684\u5185\u5b58\u5757\uff0c\u4e0d\u4ec5\u9650\u4e8eC\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u4e0b\u9762\u662f<code>memcpy</code>\u51fd\u6570\u7684\u6e90\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <pre><code>void *memcpy(void *dest, const void *src, size_t n) {\n    char *d = dest;\n    const char *s = src;\n    while (n--) {\n        *d++ = *s++;\n    }\n    return dest;\n}\n</code></pre> <p><code>memcpy</code>\u51fd\u6570\u7684\u597d\u5904\u662f\u5b83\u53ef\u4ee5\u7528\u4e8e\u590d\u5236\u4efb\u610f\u7c7b\u578b\u7684\u5185\u5b58\u5757\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5b57\u7b26\u4e32\u3002\u53e6\u5916\uff0c\u7531\u4e8e<code>memcpy</code>\u662f\u6309\u5b57\u8282\u8fdb\u884c\u590d\u5236\u7684\uff0c\u56e0\u6b64\u5b83\u66f4\u9002\u5408\u4e8e\u590d\u5236\u4e8c\u8fdb\u5236\u6570\u636e\u6216\u8005\u81ea\u5b9a\u4e49\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u603b\u7ed3\uff1a<code>strcpy</code>\u9002\u7528\u4e8eC\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u590d\u5236\uff0c\u800c<code>memcpy</code>\u9002\u7528\u4e8e\u901a\u7528\u7684\u5185\u5b58\u5757\u590d\u5236\u3002</p> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strncpystrlcpy","title":"\u5206\u6790strncpy()\u548cstrlcpy()","text":"<p><code>strncpy</code> \u548c <code>strlcpy</code> \u90fd\u662f\u7528\u4e8e\u5b57\u7b26\u4e32\u590d\u5236\u7684\u51fd\u6570\uff0c\u4f46\u5b83\u4eec\u5728\u5b9e\u73b0\u7ec6\u8282\u4e0a\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u533a\u522b\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strncpy","title":"strncpy","text":"<pre><code>char *strncpy(char *dest, const char *src, size_t n) {\n    size_t i;\n    for (i = 0; i &lt; n &amp;&amp; src[i] != '\\0'; i++) {\n        dest[i] = src[i];\n    }\n    for ( ; i &lt; n; i++) {\n        dest[i] = '\\0';\n    }\n    return dest;\n}\n</code></pre> <ul> <li> <p>\u529f\u80fd\uff1a<code>strncpy</code> \u51fd\u6570\u4f1a\u5c06\u6e90\u5b57\u7b26\u4e32 <code>src</code> \u7684\u524d <code>n</code> \u4e2a\u5b57\u7b26\u590d\u5236\u5230\u76ee\u6807\u5b57\u7b26\u4e32 <code>dest</code> \u4e2d\u3002</p> </li> <li> <p>\u89e3\u6790\uff1a\u5982\u679c <code>src</code> \u7684\u957f\u5ea6\u5c0f\u4e8e <code>n</code>\uff0c\u5219\u5269\u4f59\u7684\u90e8\u5206\u4f1a\u7528\u7a7a\u5b57\u7b26 <code>\\0</code> \u586b\u5145\u3002\u5982\u679c <code>src</code> \u7684\u957f\u5ea6\u5927\u4e8e <code>n</code>\uff0c\u5219 <code>dest</code> \u4e0d\u4f1a\u4ee5\u7a7a\u5b57\u7b26 <code>\\0</code> \u7ed3\u5c3e\u3002</p> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#strlcpy","title":"strlcpy","text":"<pre><code>size_t strlcpy(char *dest, const char *src, size_t size) {\n    size_t src_len = strlen(src);\n    size_t copy_len = (size &lt;= 0) ? 0 : (size - 1);\n    if (copy_len &lt; src_len) {\n        memcpy(dest, src, copy_len);\n        dest[copy_len] = '\\0';\n    } else {\n        memcpy(dest, src, src_len);\n        dest[src_len] = '\\0';\n    }\n    return src_len;\n}\n</code></pre> <ul> <li>\u529f\u80fd\uff1a<code>strlcpy</code> \u51fd\u6570\u4f1a\u5c06\u6e90\u5b57\u7b26\u4e32 <code>src</code> \u7684\u524d <code>size-1</code> \u4e2a\u5b57\u7b26\u590d\u5236\u5230\u76ee\u6807\u5b57\u7b26\u4e32 <code>dest</code> \u4e2d\uff0c\u5e76\u59cb\u7ec8\u786e\u4fdd <code>dest</code> \u4ee5\u7a7a\u5b57\u7b26 <code>\\0</code> \u7ed3\u5c3e\u3002</li> </ul> <p>\u5982\u679c <code>src</code> \u7684\u957f\u5ea6\u5927\u4e8e <code>size-1</code>\uff0c\u5219\u4f1a\u622a\u65ad <code>src</code>\uff0c\u5e76\u5728 <code>dest</code> \u7684\u672b\u5c3e\u6dfb\u52a0\u7a7a\u5b57\u7b26 <code>\\0</code>\u3002\u5982\u679c <code>src</code> \u7684\u957f\u5ea6\u5c0f\u4e8e <code>size-1</code>\uff0c\u5219\u4f1a\u5b8c\u6574\u590d\u5236 <code>src</code> \u5e76\u5728 <code>dest</code> \u7684\u672b\u5c3e\u6dfb\u52a0\u7a7a\u5b57\u7b26 <code>\\0</code>\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_3","title":"\u603b\u7ed3","text":"<p><code>strncpy</code> \u5b58\u5728\u7f3a\u9677\uff0c\u5bb9\u6613\u5bfc\u81f4\u76ee\u6807\u5b57\u7b26\u4e32\u4e0d\u4ee5\u7a7a\u5b57\u7b26 <code>\\0</code> \u7ed3\u5c3e\uff0c\u800c <code>strlcpy</code> \u5219\u66f4\u5b89\u5168\uff0c\u59cb\u7ec8\u786e\u4fdd\u76ee\u6807\u5b57\u7b26\u4e32\u4ee5\u7a7a\u5b57\u7b26 <code>\\0</code> \u7ed3\u5c3e\u3002\u56e0\u6b64\uff0c\u901a\u5e38\u5efa\u8bae\u4f7f\u7528 <code>strlcpy</code> \u6765\u907f\u514d <code>strncpy</code> \u7684\u6f5c\u5728\u95ee\u9898\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#malloccalloc","title":"\u5206\u6790malloc()\u548ccalloc()","text":"<p>\u5230\u65f6\u5019\u5177\u4f53\u53c2\u89c1FreeRTOS\u7684\u5185\u90e8\u5b9e\u73b0</p> <p><code>malloc</code>\u548c<code>calloc</code>\u51fd\u6570\u90fd\u662fC\u8bed\u8a00\u4e2d\u7528\u4e8e\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684\u51fd\u6570\uff0c\u5b83\u4eec\u5728\u5185\u5b58\u7ba1\u7406\u4e2d\u8d77\u7740\u975e\u5e38\u91cd\u8981\u7684\u4f5c\u7528\u3002\u4e0b\u9762\u6211\u5c06\u5bf9\u5b83\u4eec\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#malloc","title":"<code>malloc</code>\u51fd\u6570","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_4","title":"\u80cc\u666f","text":"<p><code>malloc</code>\u51fd\u6570\u7528\u4e8e\u5728\u5806\u4e0a\u5206\u914d\u6307\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u5757\u3002\u5b83\u662fC\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u5e2e\u52a9\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u5206\u914d\u5185\u5b58\uff0c\u4ee5\u6ee1\u8db3\u7a0b\u5e8f\u5728\u7f16\u8bd1\u65f6\u65e0\u6cd5\u786e\u5b9a\u7684\u5185\u5b58\u9700\u6c42\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_5","title":"\u539f\u578b","text":"<pre><code>void *malloc(size_t size);\n</code></pre> <p><code>malloc</code>\u51fd\u6570\u63a5\u53d7\u4e00\u4e2a<code>size</code>\u53c2\u6570\uff0c\u8868\u793a\u9700\u8981\u5206\u914d\u7684\u5185\u5b58\u5757\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002\u5b83\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u5206\u914d\u5185\u5b58\u5757\u8d77\u59cb\u5730\u5740\u7684\u6307\u9488\uff0c\u5982\u679c\u5206\u914d\u5931\u8d25\u5219\u8fd4\u56de<code>NULL</code>\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_6","title":"\u6e90\u7801\u5b9e\u73b0","text":"<p><code>malloc</code>\u51fd\u6570\u7684\u5177\u4f53\u5b9e\u73b0\u53ef\u80fd\u56e0\u5e73\u53f0\u548c\u7f16\u8bd1\u5668\u800c\u5f02\uff0c\u901a\u5e38\u4f1a\u8c03\u7528\u5e95\u5c42\u7684\u5185\u5b58\u5206\u914d\u51fd\u6570\uff08\u5982<code>brk</code>\u3001<code>sbrk</code>\u6216<code>mmap</code>\uff09\u6765\u83b7\u53d6\u5185\u5b58\u3002\u5b83\u4f1a\u5728\u5806\u4e0a\u5bfb\u627e\u8db3\u591f\u5927\u5c0f\u7684\u7a7a\u95f2\u5185\u5b58\u5757\uff0c\u7136\u540e\u5c06\u8be5\u5185\u5b58\u5757\u6807\u8bb0\u4e3a\u5df2\u4f7f\u7528\uff0c\u5e76\u8fd4\u56de\u5176\u8d77\u59cb\u5730\u5740\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_7","title":"\u4f7f\u7528","text":"<pre><code>int *ptr = (int *)malloc(10 * sizeof(int));\nif (ptr != NULL) {\n    // \u5185\u5b58\u5206\u914d\u6210\u529f\uff0c\u53ef\u4ee5\u4f7f\u7528ptr\u6307\u9488\u8bbf\u95ee\u5206\u914d\u7684\u5185\u5b58\u5757\n    // ...\n    free(ptr);  // \u4f7f\u7528\u5b8c\u6bd5\u540e\u8bb0\u5f97\u91ca\u653e\u5185\u5b58\n}\n</code></pre>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#calloc","title":"<code>calloc</code>\u51fd\u6570","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_8","title":"\u80cc\u666f","text":"<p><code>calloc</code>\u51fd\u6570\u4e5f\u7528\u4e8e\u5728\u5806\u4e0a\u5206\u914d\u5185\u5b58\uff0c\u4f46\u5b83\u4e0e<code>malloc</code>\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c<code>calloc</code>\u4f1a\u5728\u5206\u914d\u5185\u5b58\u7684\u540c\u65f6\u5c06\u5185\u5b58\u5757\u7684\u5185\u5bb9\u521d\u59cb\u5316\u4e3a\u96f6\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_9","title":"\u539f\u578b","text":"<pre><code>void *calloc(size_t num, size_t size);\n</code></pre> <p><code>calloc</code>\u51fd\u6570\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff0c<code>num</code>\u8868\u793a\u9700\u8981\u5206\u914d\u7684\u5143\u7d20\u4e2a\u6570\uff0c<code>size</code>\u8868\u793a\u6bcf\u4e2a\u5143\u7d20\u7684\u5927\u5c0f\uff08\u5355\u4f4d\u662f\u5b57\u8282\uff09\u3002\u5b83\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u5206\u914d\u5185\u5b58\u5757\u8d77\u59cb\u5730\u5740\u7684\u6307\u9488\uff0c\u5982\u679c\u5206\u914d\u5931\u8d25\u5219\u8fd4\u56de<code>NULL</code>\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_10","title":"\u6e90\u7801\u5b9e\u73b0","text":"<p><code>calloc</code>\u51fd\u6570\u7684\u5b9e\u73b0\u901a\u5e38\u4f1a\u8c03\u7528\u5e95\u5c42\u7684\u5185\u5b58\u5206\u914d\u51fd\u6570\uff08\u5982<code>brk</code>\u3001<code>sbrk</code>\u6216<code>mmap</code>\uff09\uff0c\u7136\u540e\u5c06\u5206\u914d\u7684\u5185\u5b58\u5757\u5185\u5bb9\u521d\u59cb\u5316\u4e3a\u96f6\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_11","title":"\u4f7f\u7528","text":"<pre><code>int *ptr = (int *)calloc(10, sizeof(int));\nif (ptr != NULL) {\n    // \u5185\u5b58\u5206\u914d\u6210\u529f\uff0cptr\u6307\u5411\u7684\u5185\u5b58\u5757\u5df2\u88ab\u521d\u59cb\u5316\u4e3a\u96f6\n    // ...\n    free(ptr);  // \u4f7f\u7528\u5b8c\u6bd5\u540e\u8bb0\u5f97\u91ca\u653e\u5185\u5b58\n}\n</code></pre>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_12","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4f7f\u7528<code>malloc</code>\u548c<code>calloc</code>\u5206\u914d\u7684\u5185\u5b58\u5757\u5728\u4f7f\u7528\u5b8c\u6bd5\u540e\u5e94\u8be5\u901a\u8fc7<code>free</code>\u51fd\u6570\u8fdb\u884c\u91ca\u653e\uff0c\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</li> <li>\u5728\u4f7f\u7528\u5206\u914d\u7684\u5185\u5b58\u65f6\u8981\u5c0f\u5fc3\u907f\u514d\u51fa\u73b0\u5185\u5b58\u8d8a\u754c\u3001\u91cd\u590d\u91ca\u653e\u3001\u672a\u521d\u59cb\u5316\u7b49\u95ee\u9898\uff0c\u8fd9\u4e9b\u95ee\u9898\u5bb9\u6613\u5bfc\u81f4\u7a0b\u5e8f\u8fd0\u884c\u65f6\u9519\u8bef\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>malloc</code>\u548c<code>calloc</code>\u51fd\u6570\u662fC\u8bed\u8a00\u4e2d\u52a8\u6001\u5185\u5b58\u5206\u914d\u7684\u91cd\u8981\u5de5\u5177\uff0c\u7a0b\u5e8f\u5458\u9700\u8981\u8c28\u614e\u4f7f\u7528\u5e76\u9075\u5faa\u5185\u5b58\u7ba1\u7406\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u5728free\u6389\u4e00\u90e8\u5206\u7a7a\u95f4\u4e4b\u540e,\u5230\u5e95\u8981\u4e0d\u8981\u5c06\u6307\u5411NULL</p> <p>\u5728Linux\u7684x86\u4f53\u7cfb\u7ed3\u6784\u4e0a\uff0c<code>malloc</code>\u51fd\u6570\u7684\u5177\u4f53\u5b9e\u73b0\u901a\u5e38\u662f\u7531C\u6807\u51c6\u5e93\u63d0\u4f9b\u7684\u3002\u5728GNU C\u5e93\uff08glibc\uff09\u4e2d\uff0c<code>malloc</code>\u51fd\u6570\u7684\u5b9e\u73b0\u662f\u7531<code>malloc</code>\u5b50\u7cfb\u7edf\u8d1f\u8d23\u7684\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\uff0c\u5c55\u793a\u4e86<code>malloc</code>\u51fd\u6570\u7684\u53ef\u80fd\u5b9e\u73b0\u65b9\u5f0f\uff1a</p> <pre><code>// \u4f2a\u4ee3\u7801\u793a\u4f8b\uff1a\u7b80\u5316\u7684malloc\u51fd\u6570\u5b9e\u73b0\n\n// \u5b9a\u4e49\u5185\u5b58\u5757\u7684\u5934\u90e8\u7ed3\u6784\nstruct block_header {\n    size_t size;  // \u5185\u5b58\u5757\u5927\u5c0f\n    bool free;    // \u662f\u5426\u7a7a\u95f2\n    // \u5176\u4ed6\u5143\u6570\u636e...\n};\n\n// \u4f2a\u4ee3\u7801\u4e2d\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u6307\u5411\u5806\u7684\u8d77\u59cb\u5730\u5740\nvoid *heap_start;\n\n// \u521d\u59cb\u5316\u5806\nvoid init_heap() {\n    // \u4f7f\u7528brk\u6216mmap\u7b49\u7cfb\u7edf\u8c03\u7528\u521d\u59cb\u5316\u5806\n    heap_start = // \u521d\u59cb\u5316\u5806\u7684\u8d77\u59cb\u5730\u5740\n    // \u5176\u4ed6\u521d\u59cb\u5316\u64cd\u4f5c...\n}\n\n// \u5206\u914d\u5185\u5b58\u7684\u4f2a\u4ee3\u7801\u5b9e\u73b0\nvoid *malloc(size_t size) {\n    // \u5982\u679c\u5806\u672a\u521d\u59cb\u5316\uff0c\u5219\u5148\u521d\u59cb\u5316\u5806\n    if (heap_start == NULL) {\n        init_heap();\n    }\n\n    // \u5728\u5806\u4e0a\u5bfb\u627e\u8db3\u591f\u5927\u5c0f\u7684\u7a7a\u95f2\u5185\u5b58\u5757\n    struct block_header *block = find_free_block(size);\n    if (block != NULL) {\n        // \u5c06\u5185\u5b58\u5757\u6807\u8bb0\u4e3a\u5df2\u4f7f\u7528\n        block-&gt;free = false;\n        return (void *)(block + 1);  // \u8fd4\u56de\u5185\u5b58\u5757\u8d77\u59cb\u5730\u5740\uff08\u8df3\u8fc7\u5934\u90e8\u7ed3\u6784\uff09\n    } else {\n        // \u672a\u627e\u5230\u8db3\u591f\u5927\u5c0f\u7684\u7a7a\u95f2\u5185\u5b58\u5757\uff0c\u8c03\u7528\u5e95\u5c42\u7684\u5185\u5b58\u5206\u914d\u51fd\u6570\uff08\u5982brk\u3001sbrk\u6216mmap\uff09\u6765\u83b7\u53d6\u5185\u5b58\n        // \u5206\u914d\u5185\u5b58\u5e76\u8fd4\u56de\u5185\u5b58\u5757\u8d77\u59cb\u5730\u5740\n        // ...\n    }\n}\n\n// \u91ca\u653e\u5185\u5b58\u7684\u4f2a\u4ee3\u7801\u5b9e\u73b0\nvoid free(void *ptr) {\n    // \u5c06\u5185\u5b58\u5757\u6807\u8bb0\u4e3a\u7a7a\u95f2\n    struct block_header *block = (struct block_header *)ptr - 1;\n    block-&gt;free = true;\n    // \u5176\u4ed6\u64cd\u4f5c...\n}\n</code></pre> <p>\u4ee5\u4e0a\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\uff0c\u5b9e\u9645\u7684<code>malloc</code>\u51fd\u6570\u5b9e\u73b0\u4f1a\u66f4\u52a0\u590d\u6742\uff0c\u6d89\u53ca\u5230\u5185\u5b58\u5bf9\u9f50\u3001\u5185\u5b58\u788e\u7247\u6574\u7406\u3001\u7ebf\u7a0b\u5b89\u5168\u7b49\u65b9\u9762\u7684\u95ee\u9898\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#memcpymemcpymemset","title":"\u5206\u6790memcpy()\u3001memcpy()\u3001memset()","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#io","title":"IO\u51fd\u6570\u603b\u7ed3","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_13","title":"\u76f8\u5173\u6982\u5ff5","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#io_1","title":"\u4ec0\u4e48\u662fIO","text":"<p>I\uff1ainput\uff08\u4ece\u5916\u90e8\u8bbe\u5907(\u952e\u76d8\u3001\u9f20\u6807...)\u5c06\u6570\u636e\u8f93\u5165\u5230\u5185\u5b58\u4e2d\uff09 o\uff1aoutput\uff08\u4ece\u5185\u5b58\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u8f93\u51fa\u8bbe\u5907(\u663e\u793a\u5668...)\u4e0a\uff09</p> <p>\u66f4\u8fdb\u4e00\u6b65: Linux\u4e0b\u4e00\u5207\u7686\u6587\u4ef6 \u8f93\u5165\uff1a\u4ece\u6587\u4ef6\u5c06\u6570\u636e\u8f93\u5165\u5230\u5185\u5b58\u4e2d \u8f93\u51fa\uff1a\u4ece\u5185\u5b58\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u6587\u4ef6\u4e2d</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#ioio","title":"\u6807\u51c6IO\u548c\u6587\u4ef6IO","text":"<ol> <li> <p>\u6807\u51c6IO\uff08stdin\u548cstdout\uff09\uff1a</p> </li> <li> <p>\u6807\u51c6\u8f93\u5165\uff08stdin\uff09\u662f\u6307\u7a0b\u5e8f\u9ed8\u8ba4\u4ece\u952e\u76d8\u83b7\u53d6\u8f93\u5165\u7684\u6d41\uff0c\u901a\u5e38\u4f7f\u7528scanf\u51fd\u6570\u6765\u8bfb\u53d6\u6807\u51c6\u8f93\u5165\u4e2d\u7684\u6570\u636e\u3002</p> </li> <li>\u6807\u51c6\u8f93\u51fa\uff08stdout\uff09\u662f\u6307\u7a0b\u5e8f\u9ed8\u8ba4\u5411\u5c4f\u5e55\u8f93\u51fa\u7ed3\u679c\u7684\u6d41\uff0c\u901a\u5e38\u4f7f\u7528printf\u51fd\u6570\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u4e2d\u3002</li> <li> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u53ef\u4ee5\u8de8\u5e73\u53f0\u4f7f\u7528, Linux\u3001Windows\u7b49\u4e0a\u90fd\u53ef\u4ee5\u7528</li> <li>\u5e93\u51fd\u6570: stdio.h \uff1ascanf\u3001printf</li> <li>\u6709\u7f13\u51b2\u673a\u5236</li> <li>\u901a\u8fc7\u6587\u4ef6\u6d41\u6307\u9488\u6765\u64cd\u4f5c</li> <li>\u4e00\u822c\u7528\u666e\u901a\u6587\u4ef6\u7684\u64cd\u4f5c</li> </ul> </li> <li> <p>\u6587\u4ef6I/O\uff1a</p> </li> <li> <p>\u6587\u4ef6I/O \u662f\u6307\u7a0b\u5e8f\u4e0e\u6587\u4ef6\u8fdb\u884c\u4ea4\u4e92\u7684\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u3002\u7a0b\u5e8f\u53ef\u4ee5\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\uff0c\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff08\u8f93\u5165\uff09\uff0c\u6216\u8005\u5c06\u6570\u636e\u5199\u5165\u6587\u4ef6\uff08\u8f93\u51fa\uff09\u3002</p> </li> <li>\u901a\u8fc7\u4f7f\u7528fopen\u51fd\u6570\u6765\u6253\u5f00\u6587\u4ef6\uff0c\u4f7f\u7528fread\u548cfwrite\u51fd\u6570\u6765\u8bfb\u5199\u6587\u4ef6\u3002</li> <li> <p>\u7279\u70b9</p> <ul> <li>\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08\u975e\u8d1f\u7684\u6574\u6570\uff09</li> <li>\u65e0\u7f13\u51b2\u673a\u5236</li> <li>\u7cfb\u7edf\u8c03\u7528</li> <li>\u4e00\u822c\u7528\u4e8e\u8bbe\u5907\u6587\u4ef6\u7684\u64cd\u4f5c</li> </ul> </li> <li> <p>\u533a\u522b\uff1a</p> </li> <li>\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u662f\u7a0b\u5e8f\u4e0e\u7528\u6237\u4ea4\u4e92\u7684\u65b9\u5f0f\uff0c\u901a\u5e38\u7528\u4e8e\u4ece\u952e\u76d8\u8bfb\u53d6\u8f93\u5165\u548c\u5411\u5c4f\u5e55\u8f93\u51fa\u7ed3\u679c\u3002</li> <li>\u6587\u4ef6I/O\u662f\u7a0b\u5e8f\u4e0e\u6587\u4ef6\u8fdb\u884c\u4ea4\u4e92\u7684\u65b9\u5f0f\uff0c\u901a\u5e38\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u7528\u4e8e\u4e0e\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u6587\u4ef6I/O\u7528\u4e8e\u4e0e\u6587\u4ef6\u8fdb\u884c\u4ea4\u4e92\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_14","title":"\u6587\u4ef6\u7c7b\u578b","text":"<ol> <li> <p>\u666e\u901a\u6587\u4ef6 -</p> <ol> <li> <p>ASCII\u7801\u6587\u4ef6 (\u6587\u672c\u6587\u4ef6)\uff1a\u4f7f\u7528fegts\u3001fputs\u51fd\u6570\u8bfb\u5199</p> </li> <li> <p>\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a\u7528fread\u3001fwrite\u51fd\u6570\u8bfb\u5199</p> </li> </ol> </li> <li> <p>\u76ee\u5f55\u6587\u4ef6 d</p> </li> <li>\u5757\u8bbe\u5907\u6587\u4ef6 b</li> <li>\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6 c</li> <li>\u94fe\u63a5\u6587\u4ef6 l</li> <li>\u7ba1\u9053\u6587\u4ef6 p</li> <li>\u5957\u63a5\u5b57\u6587\u4ef6 \uff08socket\uff09s</li> </ol>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_15","title":"\u7cfb\u7edf\u8c03\u7528","text":"<ul> <li> <p>C\u8bed\u8a00\u4e2d\u7684IO\u64cd\u4f5c\u6700\u7ec8\u4f1a\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u3002</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u8fdb\u884c\u5e95\u5c42\u786c\u4ef6\u7684\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_16","title":"\u7f13\u51b2\u533a","text":"<ol> <li> <p>\u7406\u89e3</p> <p>\u53ef\u4ee5\u5f53\u6210\u5185\u5b58\u4e2d\u7684\u4e00\u5757\u533a\u57df\uff0c\u7528\u4e8e\u4e34\u65f6\u5b58\u50a8\u6570\u636e\u3002\u5f53\u8fdb\u884cIO\u64cd\u4f5c\u7684\u65f6\u5019, \u6570\u636e\u9996\u5148\u88ab\u5199\u5165\u5230\u7f13\u51b2\u533a\uff0c\u7136\u540e\u5728\u9002\u5f53\u7684\u65f6\u673a\u624d\u4f1a\u88ab\u5237\u65b0\u5230\u6587\u4ef6\u6216\u8bbe\u5907\u4e2d\u3002</p> </li> <li> <p>\u4f5c\u7528</p> <p>\u7f13\u51b2\u533a\u6709\u6548\u51cf\u5c11\u5bf9\u5e95\u5c42\u7cfb\u7edf\u8c03\u7528\u7684\u9891\u7e41\u64cd\u4f5c\uff0c\u4ece\u800c\u63d0\u9ad8IO\u6027\u80fd\u3002\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528printf\u51fd\u6570\u6253\u5370\u6570\u636e\u65f6\uff0c</p> <p>\u6570\u636e\u9996\u5148\u88ab\u5199\u5165\u5230\u7f13\u51b2\u533a\uff0c\u800c\u4e0d\u662f\u7acb\u5373\u88ab\u53d1\u9001\u5230\u6807\u51c6\u8f93\u51fa\u8bbe\u5907\u3002\u8fd9\u6837\u53ef\u4ee5\u5c06\u591a\u4e2a\u5c0f\u7684\u8f93\u51fa\u64cd\u4f5c\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u7684\u8f93\u51fa\u64cd\u4f5c\uff0c\u51cf\u5c11\u4e86\u9891\u7e41\u7684IO\u64cd\u4f5c\uff0c\u63d0\u9ad8\u4e86\u6548\u7387\u3002</p> </li> <li> <p>\u7c7b\u578b</p> <ol> <li> <p>\u5168\u7f13\u5b58\uff1a\u5f53\u7f13\u51b2\u533a\u6ee1\u3001\u7a0b\u5e8f\u7ed3\u675f\u3001\u5f3a\u5236\u5237\u65b0\u7f13\u51b2\u533a\u65f6\u4f1a\u5237\u65b0\u7f13\u51b2\u533a</p> <p>\u5e38\u7528\u5728\u7f13\u51b2\u533a\u6ee1\u4e86\u624d\u5199\u8fdb\u6587\u4ef6</p> </li> <li> <p>\u884c\u7f13\u5b58\uff1a\u5f53\u7f13\u51b2\u533a\u6ee1\u3001\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\u3001\u5f3a\u5236\u5237\u65b0\u7f13\u51b2\u533a\u3001\u9047\u5230\u6362\u884c\u7b26\u65f6\u4f1a\u5237\u65b0\u7f13\u51b2\u533a</p> <p>\u6362\u884c\u624d\u5199\u8fdb\u6587\u4ef6</p> </li> <li> <p>\u4e0d\u7f13\u5b58\uff1a\u6ca1\u6709\u7f13\u5b58\u533a\uff0c\u76f4\u63a5\u8f93\u51fa</p> <p>\u6570\u636e\u7acb\u5373\u5199\u5165\u6587\u4ef6</p> </li> </ol> </li> <li> <p>\u8865\u5145</p> <p>\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u4e4b\u540e\uff0c\u4f1a\u9ed8\u8ba4\u6253\u5f00\u4e09\u4e2a\u6587\u4ef6\uff0c</p> <p>\u6807\u51c6\u8f93\u5165\u3001\u6807\u51c6\u8f93\u51fa\u3001\u6807\u51c6\u51fa\u9519\uff0c</p> <p>\u5bf9\u5e94\u7684\u6d41\u6307\u9488\u5206\u522b\u4e3astdin\u3001stdout\u3001stderror</p> </li> </ol>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#file","title":"\u6d41\u548cFILE\u6307\u9488","text":"<ol> <li> <p>\u6d41\u662f\u4e00\u79cd\u62bd\u8c61\u7684\u6982\u5ff5\uff0c\u5b83\u53ef\u7528\u6765\u8868\u793a\u6570\u636e\u7684\u4f20\u8f93\u6216\u5904\u7406\u8fc7\u7a0b\u3002</p> <ul> <li>\u6d41\u901a\u5e38\u88ab\u7528\u4e8e\u8868\u793a\u6570\u636e\u7684\u8f93\u5165\u3001\u8f93\u51fa\u6216\u5904\u7406</li> <li>\u6d41\u53ef\u4ee5\u662f\u5355\u5411\u7684\uff0c\u5373\u53ea\u80fd\u8fdb\u884c\u8bfb\u53d6\u6216\u5199\u5165\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u662f\u53cc\u5411\u7684\uff0c\u5373\u53ef\u4ee5\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u3002</li> </ul> </li> <li> <p>\u6587\u4ef6\u6d41</p> <ul> <li>\u6587\u4ef6\u6d41\u662f\u4e0e\u6587\u4ef6\u76f8\u5173\u8054\u7684\u6570\u636e\u6d41\u3002\u5728 C \u8bed\u8a00\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\uff08\u5982 <code>fopen</code>\u3001<code>fclose</code>\u3001<code>fread</code>\u3001<code>fwrite</code> \u7b49\uff09\u6765\u521b\u5efa\u6587\u4ef6\u6d41\uff0c\u5e76\u8fdb\u884c\u6587\u4ef6\u7684\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u3002</li> <li>\u6587\u4ef6\u6d41\u53ef\u4ee5\u662f\u6587\u672c\u6a21\u5f0f\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6a21\u5f0f\u7684\uff0c\u8fd9\u53d6\u51b3\u4e8e\u6253\u5f00\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u6a21\u5f0f\u3002</li> <li>\u6587\u4ef6\u6d41\u4e0e\u6587\u4ef6\u76f8\u5173\uff0c\u4ed6\u63d0\u7ed9\u5f00\u53d1\u8005\u4e00\u4e2a\u62bd\u8c61\u7684\u63a5\u53e3\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u901a\u8fc7\u6587\u4ef6\u6d41\u6765\u64cd\u4f5c\u6587\u4ef6\u7684\u6570\u636e\u3002</li> </ul> </li> <li> <p>\u4ea7\u751f</p> <p>\u5728\u8ba1\u7b97\u673a\u4e2d\uff0c\u6587\u4ef6\u662f\u4ee5\u5b57\u8282\u7684\u5f62\u5f0f\u5b58\u50a8\u5728\u5185\u5b58\u4e0a\u7684\u3002</p> <p>\u5f53\u6211\u4eec\u4f7f\u7528 <code>fopen</code> \u51fd\u6570\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u8be5\u6587\u4ef6\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u6d41\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u8be5\u6587\u4ef6\u6d41\u7684\u6307\u9488FILE\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u6307\u9488\u6765\u8fdb\u884c\u6587\u4ef6\u7684\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\uff0c\u800c\u8fd9\u4e9b\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u6587\u4ef6\u6d41\u6765\u8fdb\u884c\u7684\u3002</p> </li> </ol>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#c-gets-warning-this-program-uses-gets-which-is-unsafe","title":"C \u4e2d\u4f7f\u7528 gets() \u63d0\u793a warning: this program uses gets(), which is unsafe.","text":"<ul> <li>\u5206\u7c7b \u7f16\u7a0b\u6280\u672f</li> </ul> <p>C \u4e2d\u4f7f\u7528 gets() \uff0c\u7f16\u8bd1\u65f6\u4f1a\u51fa\u73b0\u5982\u4e0b\u8b66\u544a\uff1a</p> <pre><code>warning: this program uses gets(), which is unsafe.\n</code></pre> <p>gets() \u4e0d\u5b89\u5168\u662f\u56e0\u4e3a\u4f60\u7ed9\u4e86\u4ed6\u4e00\u4e2a\u7f13\u51b2\u533a\uff0c\u4f46\u662f\u4f60\u5374\u6ca1\u6709\u544a\u8bc9\u5b83\u8fd9\u4e2a\u7f13\u51b2\u533a\u5230\u5e95\u6709\u591a\u5927\uff0c\u4e5f\u4e0d\u77e5\u9053\u8f93\u5165\u7684\u5185\u5bb9\u5230\u5e95\u6709\u591a\u5927\uff0c\u8f93\u5165\u7684\u5185\u5bb9\u53ef\u80fd\u8d85\u51fa\u7f13\u51b2\u533a\u7684\u7ed3\u5c3e\uff0c\u5f15\u8d77\u4f60\u7684\u7a0b\u5e8f\u5d29\u6e83\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528 fgets \u66ff\u4ee3\uff1a</p> <pre><code>char buffer[bufsize];\nfgets(buffer, bufsize, stdin);\n</code></pre> <p>\u5b9e\u4f8b\uff1a</p> <pre><code>// \u4f7f\u7528 gets()\nchar buffer[4096];\ngets(buffer);\n\n// \u4f7f\u7528 fgets() \u66ff\u6362 gets()\nchar buffer[4096];\nfgets(buffer, (sizeof buffer / sizeof buffer[0]), stdin);\n</code></pre>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#printf","title":"printf\u5bb6\u65cf","text":"<ul> <li>printf\uff1a<ul> <li>\u7528\u4e8e\u683c\u5f0f\u5316\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u6d41\uff08\u5c4f\u5e55\uff09\u3002\u5b83\u63a5\u53d7\u4e00\u4e2a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u548c\u5bf9\u5e94\u7684\u53c2\u6570\u5217\u8868\uff0c\u6839\u636e\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u6307\u793a\u5c06\u53c2\u6570\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a\u3002\u4f8b\u5982\uff0c<code>printf(\"Hello, %s!\\n\", \"world\")</code>\u5c06\u4f1a\u8f93\u51fa<code>Hello, world!</code>\u5230\u5c4f\u5e55\u4e0a\u3002</li> </ul> </li> <li>printf\u65cf\u6210\u5458\uff1asprintf\u3001fprintf\u3001snprintf\u7b49<ul> <li>sprintf\uff1a\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u5b57\u7b26\u4e32</li> <li>fprintf\uff1a\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u6587\u4ef6</li> <li>snprintf\uff1a\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u5b57\u7b26\u4e32\uff0c\u5e76\u9650\u5236\u8f93\u51fa\u7684\u5b57\u7b26\u6570</li> </ul> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#scanf","title":"scanf\u5bb6\u65cf","text":"<ul> <li>scanf\uff1a<ul> <li>\u7528\u4e8e\u4ece\u6807\u51c6\u8f93\u5165\u6d41\uff08\u952e\u76d8\uff09\u8bfb\u53d6\u6570\u636e\u5e76\u6309\u7167\u6307\u5b9a\u683c\u5f0f\u8fdb\u884c\u89e3\u6790\u3002\u5b83\u63a5\u53d7\u4e00\u4e2a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u548c\u5bf9\u5e94\u7684\u53c2\u6570\u5217\u8868\uff0c\u6839\u636e\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u6307\u793a\u4ece\u8f93\u5165\u6d41\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5c06\u5176\u5b58\u50a8\u5230\u53c2\u6570\u4e2d\u3002\u4f8b\u5982\uff0c<code>scanf(\"%d\", &amp;num)</code>\u5c06\u4f1a\u4ece\u952e\u76d8\u4e0a\u8bfb\u53d6\u4e00\u4e2a\u6574\u6570\u5e76\u5c06\u5176\u5b58\u50a8\u5230\u53d8\u91cf<code>num</code>\u4e2d\u3002</li> </ul> </li> <li> <p>scanf\u65cf\u6210\u5458\uff1asscanf\u3001fscanf\u7b49</p> <ul> <li>sscanf\uff1a\u4ece\u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6\u683c\u5f0f\u5316\u7684\u6570\u636e</li> <li>fscanf\uff1a\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u683c\u5f0f\u5316\u7684\u6570\u636e</li> </ul> </li> <li> <p>\u91cd\u70b9\u770b\u770blcthw\u7684\u7ec3\u4e6026 27\u7684\u5185\u5bb9 </p> </li> <li> <p>\u7ec8\u6b62\u7a0b\u5e8f\u548c\u663e\u793a\u8b66\u544a\u7684\u95ee\u9898 \uff08\u5173\u4e8e\u9632\u5fa1\u6027\u7f16\u7a0b\u7684\u95ee\u9898\uff09</p> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#fprintf","title":"fprintf()\u51fd\u6570","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_17","title":"\u57fa\u672c","text":"<p>\u51fd\u6570\u539f\u578b\uff1a</p> <pre><code>int fprintf(FILE *stream, const char *format, ...);\n</code></pre> <p>\u51fd\u6570\u4f5c\u7528\uff1a</p> <p>\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u6d41 <code>stream</code> \u4e2d\u3002</p> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>stream</code>\uff1a\u6307\u5411 FILE \u5bf9\u8c61\u7684\u6307\u9488\uff0c\u8868\u793a\u8981\u5199\u5165\u6570\u636e\u7684\u6587\u4ef6\u6d41\u3002</li> <li><code>format</code>\uff1a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u6307\u5b9a\u8f93\u51fa\u7684\u683c\u5f0f\u3002</li> <li><code>...</code>\uff1a\u53ef\u53d8\u53c2\u6570\u5217\u8868\uff0c\u7528\u4e8e\u6307\u5b9a\u8981\u8f93\u51fa\u7684\u6570\u636e\u3002</li> </ul> <p>\u8fd4\u56de\u503c\uff1a</p> <p>\u6210\u529f\u8fd4\u56de\u5199\u5165\u7684\u5b57\u7b26\u6570\uff08\u4e0d\u5305\u62ec\u5b57\u7b26\u4e32\u7ed3\u5c3e\u7684\u7a7a\u5b57\u7b26\uff09\uff0c\u5931\u8d25\u8fd4\u56de\u8d1f\u6570\u3002</p> <p>\u6e90\u7801\u5b9e\u73b0\uff1a</p> <pre><code>int fprintf(FILE *stream, const char *format, ...) {\n  va_list arg;\n  int done;\n\n  va_start(arg, format);\n  done = vfprintf(stream, format, arg);\n  va_end(arg);\n\n  return done;\n}\n</code></pre> <p><code>fprintf()</code> \u51fd\u6570\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86 <code>vfprintf()</code> \u51fd\u6570\uff0c\u53ea\u662f\u5c06\u53ef\u53d8\u53c2\u6570\u5217\u8868\u5c01\u88c5\u6210\u4e86\u4e00\u4e2a <code>va_list</code> \u5bf9\u8c61\u4f20\u9012\u7ed9\u4e86 <code>vfprintf()</code> \u51fd\u6570\u3002</p> <p>\u4f7f\u7528\u573a\u666f\uff1a</p> <p><code>fprintf()</code> \u51fd\u6570\u5e38\u7528\u4e8e\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u3001\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u7b49\u573a\u666f\u3002\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u5c06\u6570\u636e\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u6d41 <code>stdout</code> \u6216\u6807\u51c6\u9519\u8bef\u6d41 <code>stderr</code> \u4e2d\uff0c\u7528\u4e8e\u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u8f93\u51fa\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    FILE *file = fopen(\"output.txt\", \"w\"); // \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u5199\u5165\n    if (file == NULL) {\n        perror(\"Error opening file\");\n        return 1;\n    }\n\n    int num1 = 10;\n    double num2 = 3.14;\n    char str[] = \"Hello, World!\";\n\n    fprintf(file, \"Integer: %d, Float: %f, String: %s\\n\", num1, num2, str);\n\n    fclose(file); // \u5173\u95ed\u6587\u4ef6\u6d41\n\n    return 0;\n}\n</code></pre>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_18","title":"\u6d41","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_19","title":"\u8c03\u8bd5\u5b8f","text":""},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_20","title":"\u5e38\u7528","text":"<p>\u4ee5\u540e\u518d\u4e0d\u65ad\u6269\u5145</p> <pre><code>#ifndef __dbg_h__\n#define __dbg_h__\n\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n\n/*\n** \u901a\u8fc7\u5b9e\u73b0\u4e00\u7cfb\u5217\u8f6c\u6362\u6765\u5904\u7406\u9519\u8bef\n** \u4efb\u4f55\u65f6\u5019\u53d1\u751f\u4e86\u9519\u8bef\uff0c\u4f60\u7684\u51fd\u6570\u90fd\u4f1a\u8df3\u5230\u6267\u884c\u6e05\u7406\u548c\u8fd4\u56de\u9519\u8bef\u4ee3\u7801\u7684\u201cerror:\u201d\u533a\u57df\u3002\n** \u4f60\u53ef\u4ee5\u4f7f\u7528check\u5b8f\u6765\u68c0\u67e5\u9519\u8bef\u4ee3\u7801\uff0c\u6253\u5370\u9519\u8bef\u4fe1\u606f\uff0c\u7136\u540e\u8df3\u5230\u6e05\u7406\u533a\u57df\u3002\n** \u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e00\u7cfb\u5217\u65e5\u5fd7\u51fd\u6570\u6765\u6253\u5370\u51fa\u6709\u7528\u7684\u8c03\u8bd5\u4fe1\u606f\u3002 \n*/\n\n#ifdef NDEBUG\n#define debug(M, ...)\n#else\n#define debug(M, ...) fprintf(stderr, \"DEBUG %s:%d:%s: \" M \"\\n\", __FILE__, __LINE__, __func__, ##__VA_ARGS__)\n#endif\n\n#define clean_errno() (errno == 0 ? \"None\" : strerror(errno))\n\n#define log_err(M, ...) fprintf(stderr, \"[ERROR] (%s:%d:%s: errno: %s) \" M \"\\n\", __FILE__, __LINE__, __func__, clean_errno(), ##__VA_ARGS__)\n\n#define log_warn(M, ...) fprintf(stderr, \"[WARN] (%s:%d:%s: errno: %s) \" M \"\\n\", __FILE__, __LINE__, __func__, clean_errno(), ##__VA_ARGS__)\n\n#define log_info(M, ...) fprintf(stderr, \"[INFO] (%s:%d:%s) \" M \"\\n\", __FILE__, __LINE__, __func__, ##__VA_ARGS__)\n\n#define check(A, M, ...) if(!(A)) { log_err(M, ##__VA_ARGS__); errno=0; goto error; }\n\n#define sentinel(M, ...) { log_err(M, ##__VA_ARGS__); errno=0; goto error; }\n\n#define check_mem(A) check((A), \"Out of memory.\")\n\n#define check_debug(A, M, ...) if(!(A)) { debug(M, ##__VA_ARGS__); errno=0; goto error; }\n\n#endif\n</code></pre> <p><code>error</code> \u662f\u4e00\u4e2a\u6807\u7b7e\uff0c\u901a\u5e38\u7528\u4e8e\u5728 C \u8bed\u8a00\u4e2d\u6807\u8bb0\u9519\u8bef\u5904\u7406\u4ee3\u7801\u7684\u4f4d\u7f6e\uff0c\u4ee5\u4fbf\u5728\u53d1\u751f\u9519\u8bef\u65f6\u8df3\u8f6c\u5230\u76f8\u5e94\u7684\u5904\u7406\u903b\u8f91\u3002</p>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_21","title":"\u4ed4\u7ec6\u5206\u6790","text":"<ul> <li> <p><code>debug(M, ...)</code></p> <pre><code>debug(M, ...) fprintf(stderr, \"DEBUG %s:%d:%s: \" M \"\\n\", __FILE__, __LINE__, __func__, ##__VA_ARGS__)\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e \u6253\u5370\u8c03\u8bd5\u4fe1\u606f\u3002\n    \u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\uff0c\u5b83\u4f1a\u5c06\u5e26\u6709\u6587\u4ef6\u540d\u548c\u884c\u53f7\u7684\u8c03\u8bd5\u4fe1\u606f\u6253\u5370\u5230\u6807\u51c6\u9519\u8bef\u6d41\u4e2d\uff0c\u683c\u5f0f\u4e3a \"DEBUG \u6587\u4ef6\u540d:\u884c\u53f7: \u8c03\u8bd5\u4fe1\u606f\"\u3002\n</code></pre> </li> <li> <p><code>clean_errno()</code></p> <pre><code>#define clean_errno() (errno == 0 ? \"None\" : strerror(errno))\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\u6e05\u7406\u9519\u8bef\u53f7\u3002\n    \u5b83\u4f1a\u68c0\u67e5\u5168\u5c40\u53d8\u91cf errno \u662f\u5426\u4e3a 0\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de\u5b57\u7b26\u4e32 \"None\"\uff0c\u5426\u5219\u8fd4\u56de\"\u5bf9\u5e94\u9519\u8bef\u53f7\u7684\u63cf\u8ff0\u5b57\u7b26\u4e32\".\n</code></pre> </li> <li> <p><code>log_err(M, ...)</code></p> <pre><code>#define log_err(M, ...) fprintf(stderr, \"[ERROR] (%s:%d:%s: errno: %s) \" M \"\\n\", __FILE__, __LINE__, __func__, clean_errno(), ##__VA_ARGS__)\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\u6253\u5370\u9519\u8bef\u4fe1\u606f\u3002\u5b83\u4f1a\u5c06\u5e26\u6709\u6587\u4ef6\u540d\u3001\u884c\u53f7\u548c\u9519\u8bef\u53f7\u7684\u9519\u8bef\u4fe1\u606f\u6253\u5370\u5230\u6807\u51c6\u9519\u8bef\u6d41\u4e2d\uff0c\n    \u683c\u5f0f\u4e3a \"[ERROR] (\u6587\u4ef6\u540d:\u884c\u53f7: errno: \u9519\u8bef\u63cf\u8ff0) \u9519\u8bef\u4fe1\u606f\"\u3002\n</code></pre> </li> <li> <p><code>log_warn(M, ...)</code></p> <pre><code>#define log_warn(M, ...) fprintf(stderr, \"[WARN] (%s:%d:%s: errno: %s) \" M \"\\n\", __FILE__, __LINE__, __func__, clean_errno(), ##__VA_ARGS__)\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\u6253\u5370\u8b66\u544a\u4fe1\u606f\u3002\u5b83\u4f1a\u5c06\u5e26\u6709\u6587\u4ef6\u540d\u3001\u884c\u53f7\u548c\u9519\u8bef\u53f7\u7684\u8b66\u544a\u4fe1\u606f\u6253\u5370\u5230\u6807\u51c6\u9519\u8bef\u6d41\u4e2d\uff0c\n    \u683c\u5f0f\u4e3a \"[WARN] (\u6587\u4ef6\u540d:\u884c\u53f7: errno: \u9519\u8bef\u63cf\u8ff0) \u8b66\u544a\u4fe1\u606f\"\u3002\n</code></pre> </li> <li> <p><code>log_info(M, ...)</code></p> <pre><code>#define log_info(M, ...) fprintf(stderr, \"[INFO] (%s:%d:%s) \" M \"\\n\", __FILE__, __LINE__, __func__, ##__VA_ARGS__)\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\"\u6253\u5370\u4e00\u822c\u4fe1\u606f\"\u3002\u5b83\u4f1a\u5c06\u5e26\u6709\u6587\u4ef6\u540d\u548c\u884c\u53f7\u7684\u4e00\u822c\u4fe1\u606f\u6253\u5370\u5230\u6807\u51c6\u9519\u8bef\u6d41\u4e2d\uff0c\n    \u683c\u5f0f\u4e3a \"[INFO] (\u6587\u4ef6\u540d:\u884c\u53f7) \u4e00\u822c\u4fe1\u606f\"\u3002\n</code></pre> </li> <li> <p><code>check(A, M, ...)</code>:</p> <pre><code>#define check(A, M, ...) if(!(A)) { log_err(M, ##__VA_ARGS__); errno=0; goto error; }\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\"\u68c0\u67e5\u6761\u4ef6 A \u662f\u5426\u4e3a\u771f\"\u3002\n    \u5982\u679c\u6761\u4ef6\u4e3a\u5047\uff0c\u5b83\u4f1a\u6253\u5370\u9519\u8bef\u4fe1\u606f\uff0c\u6e05\u7a7a\u9519\u8bef\u53f7\u5e76\u8df3\u8f6c\u5230\u6807\u7b7e error \u5904\u3002\n</code></pre> </li> <li> <p>sentinel(M, ...)</p> <pre><code>#define sentinel(M, ...)  { log_err(M, ##__VA_ARGS__); errno=0; goto error; }\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\"\u6253\u5370\u9519\u8bef\u4fe1\u606f\"\uff0c\u6e05\u7a7a\u9519\u8bef\u53f7\u5e76\u8df3\u8f6c\u5230\u6807\u7b7e error \u5904\u3002\n    \u5b83\u901a\u5e38\u7528\u4e8e\"\u6807\u8bb0\u7a0b\u5e8f\u4e2d\u7684\u9519\u8bef\u60c5\u51b5\"\u3002\n</code></pre> </li> <li> <p><code>check_mem(A)</code></p> <pre><code>#define check_mem(A) check((A), \"Out of memory.\")\n\n\u8fd9\u4e2a\u5b8f\u7528\u4e8e\"\u68c0\u67e5\u5185\u5b58\u5206\u914d\u662f\u5426\u6210\u529f\"\u3002\n    \u5982\u679c\u5206\u914d\u5931\u8d25\uff0c\u5b83\u4f1a\u6253\u5370\u76f8\u5e94\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u6e05\u7a7a\u9519\u8bef\u53f7\u5e76\u8df3\u8f6c\u5230\u6807\u7b7e error \u5904\u3002\n</code></pre> </li> <li> <p><code>check_debug(A, M, ...)</code></p> <pre><code>#define check_debug(A, M, ...) if(!(A)) { debug(M, ##__VA_ARGS__); errno=0; goto error; }\n\n\u8fd9\u4e2a\u5b8f\u7c7b\u4f3c\u4e8e  `check(A, M, ...)`\uff0c\u4f46\u662f\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u4f1a\u989d\u5916\u6253\u5370\u8c03\u8bd5\u4fe1\u606f\u3002\n</code></pre> </li> </ul>"},{"location":"language/C_asm/Function%20analysis/C%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90.html#_22","title":"\u9884\u5b9a\u4e49\u7684\u5b8f","text":"<p>\u5e38\u89c1\u7684</p> <ul> <li><code>__FILE__</code> \u4ee3\u8868\u5f53\u524d\u6e90\u6587\u4ef6\u7684\u6587\u4ef6\u540d\uff0c\u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</li> <li><code>__LINE__</code> \u4ee3\u8868\u5f53\u524d\u6240\u5728\u7684\u884c\u53f7\u3002</li> <li> <p><code>__func__</code> \u4ee3\u8868\u5f53\u524d\u6240\u5728\u7684\u51fd\u6570\u540d\u3002</p> </li> <li> <p><code>__DATE__</code>\uff1a\u4ee3\u8868\u4ee3\u7801\u88ab\u7f16\u8bd1\u7684\u65e5\u671f\uff0c\u683c\u5f0f\u4e3a\"MMM DD YYYY\"\u3002</p> </li> <li><code>__TIME__</code>\uff1a\u4ee3\u8868\u4ee3\u7801\u88ab\u7f16\u8bd1\u7684\u65f6\u95f4\uff0c\u683c\u5f0f\u4e3a\"HH:MM:SS\"\u3002</li> <li><code>__STDC__</code>\uff1a\u5f53\u7f16\u8bd1\u5668\u9075\u5faa ANSI \u6807\u51c6\u65f6\uff0c\u8be5\u5b8f\u88ab\u5b9a\u4e49\u4e3a 1\u3002</li> <li><code>__cplusplus</code>\uff1a\u5f53\u4f7f\u7528 C++ \u7f16\u8bd1\u5668\u7f16\u8bd1\u4ee3\u7801\u65f6\uff0c\u8be5\u5b8f\u88ab\u5b9a\u4e49\u3002</li> </ul>"},{"location":"language/C_asm/Inside%20C%20Tech/example.html","title":"Example","text":""},{"location":"language/C_asm/Inside%20C%20Tech/example.html#c-helloworld","title":"C\u8bed\u8a00 <code>helloworld</code> \u7684\u6280\u672f\u5185\u5e55","text":""},{"location":"language/C_asm/Inside%20C%20Tech/example.html#c","title":"C\u8bed\u8a00\u5168\u5c40\u6570\u636e\u7684\u6280\u672f\u5185\u5e55","text":"<p>\u5168\u5c40\u6570\u636e\u7684\u6307\u9488\u5730\u5740\u662f\u5e38\u91cf\u3002 \u5168\u5c40\u53d8\u91cf\u7684\u6307\u9488\u5730\u5740\u662f\u5e38\u91cf\u3002\u4e00\u65e6\u5168\u5c40\u53d8\u91cf\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u88ab\u5206\u914d\u5185\u5b58\u5e76\u521d\u59cb\u5316\uff0c\u5176\u5730\u5740\u5728\u6574\u4e2a\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u90fd\u4e0d\u4f1a\u6539\u53d8\uff0c\u56e0\u6b64\u88ab\u89c6\u4e3a\u5e38\u91cf\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u5168\u5c40\u53d8\u91cf\u7684\u6307\u9488\u5730\u5740\u662f\u4e0d\u53ef\u66f4\u6539\u7684\uff0c\u5b83\u6307\u5411\u7684\u5185\u5b58\u4f4d\u7f6e\u662f\u56fa\u5b9a\u7684\u3002</p> <p>\u5728\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u7684\u6307\u9488\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u4e0d\u8981\u5c1d\u8bd5\u4fee\u6539\u6307\u9488\u6307\u5411\u7684\u5730\u5740\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u610f\u5916\u7684\u884c\u4e3a\u6216\u9519\u8bef\u3002\u5982\u679c\u9700\u8981\u4fee\u6539\u5168\u5c40\u53d8\u91cf\u7684\u503c\uff0c\u5e94\u8be5\u901a\u8fc7\u6307\u9488\u95f4\u63a5\u5f15\u7528\u7684\u65b9\u5f0f\u8fdb\u884c\u3002</p> <p>\u94fe\u63a5\u5668\u4e00\u65e6\u786e\u5b9a\u540e\uff0c\u5c31\u662f\u5e38\u91cf\u5566</p> <p>\u7a0b\u5e8f\u89e3\u91ca\u5668\uff1f\u8fd9\u4e2a\u7528\u6765\u5e72\u4ec0\u4e48\u7684\uff1fC\u4e0d\u662f\u7f16\u8bd1\u578b\u8bed\u8a00\u5417\u8981\u7a0b\u5e8f\u89e3\u91ca\u5668\u5e72\u4ec0\u4e48\uff1f\u7ffb\u8bd1\u6210\u4e8c\u8fdb\u5236\u7801\uff1f</p> <p></p>"},{"location":"language/C_asm/Inside%20C%20Tech/example.html#c_1","title":"C\u8bed\u8a00\u7684\u9012\u5f52\u8be6\u89e3","text":""},{"location":"language/C_asm/Inside%20C%20Tech/example.html#c_2","title":"C\u8bed\u8a00\u7684\u52a8\u6001\u5e93\u548c\u52a8\u6001\u8fde\u63a5\u8be6\u89e3","text":""},{"location":"language/C_asm/Inside%20C%20Tech/example.html#linuxc","title":"Linux\u4e0aC\u8bed\u8a00\u7684\u7ebf\u7a0b\u9501\u7684\u6280\u672f\u5185\u5e55","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/index.html","title":"Index","text":"<p>\u5173\u4e8e\u5b66\u4e60C\u8bed\u8a00 \u53ca\u5176\u5bf9\u5e94\u7684\u6c47\u7f16\u5173\u7cfb (\u4e3b\u8981\u4e3ax86\u6c47\u7f16)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html","title":"Assembly","text":"<p>\u5b66\u4e60\u4ee3\u7801\u5e93\uff1a</p> <p>Becavalier/geektime-c: The Repo holding all the code snippets related to the C course on Geektime. (github.com)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html#_1","title":"\u6c47\u7f16\u7efc\u8ff0","text":"<p>\u901a\u8fc7 <code>ebx</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbf\u95ee\u5927\u5c0f\u4e3a 32 \u4f4d\u7684\u6570\u636e\uff0c\u8be5\u6570\u636e\u4e3a\u5bc4\u5b58\u5668 <code>rbx</code> \u7684\u4f4e 32 \u4f4d\u3002</p> <p>\u63a5\u4f7f\u7528 <code>rbx</code> \u4fbf\u53ef\u8bbf\u95ee\u8be5\u5bc4\u5b58\u5668\u7684\u5168\u90e8 64 \u4f4d\u6570\u636e\u3002</p> <p>\u4f7f\u7528 <code>bx</code> \u4e0e <code>bl</code> \uff0c\u4fbf\u53ef\u76f8\u5e94\u8bbf\u95ee\u8be5\u5bc4\u5b58\u5668\u7684\u4f4e 16 \u4f4d\u4e0e\u4f4e 8 \u4f4d\u6570\u636e\u3002</p> <ul> <li> <p>\u7ec3\u4e60</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void)\n{\n    register long num asm(\"rax\") = 0x100000000;\n    asm(\"movl $0x1, %eax\");\n    // printf(\"hex: %lx\\n\", num); \n    asm(\"movw $0x1, %ax\"); \n    printf(\"hex: %lx\\n\", num);  // \u8c03\u7528printf\u4f1a\u5f71\u54cd\u5bc4\u5b58\u5668\u7684\u503c\uff1f\n    // printf(\"dec: %ld\\n\", num);\n    return 0;\n}\n</code></pre> <p>\u7528\u7b2c\u4e8c\u6761\u6c47\u7f16\u6307\u4ee4\u5df2\u7ecf\u4e86\u89e3\uff0c\u4f46\u662f\u7528\u7b2c\u4e00\u6761\u4e3a\u4ec0\u4e48\u4f1a\u8f93\u51fa1\u5462\uff1f\u4e0d\u5e94\u8be5\u662f100000001\u5417\uff1f</p> <p>\u5f53\u67d0\u4e2a\u6307\u4ee4\u9700\u8981\u91cd\u5199\u5bc4\u5b58\u5668\u7684\u4f4e 16 \u4f4d\u6216\u4f4e 8 \u4f4d\u6570\u636e\u65f6\uff0c\u5bc4\u5b58\u5668\u4e2d\u5176\u4ed6\u4f4d\u4e0a\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u4fee\u6539\u3002\u6240\u4ee5<code>asm(\"movw $0x1, %ax\")</code> \u4e0d\u4f1a\u4fee\u6539 <code>rax</code> \u7684\u503c\uff0c\u8fd9\u65f6num\u8f93\u51fa\u7684\u503c\u4e3a0x100000001\u3002</p> <p>\u800c\u5f53\u6307\u4ee4\u9700\u8981\u91cd\u5199\u5bc4\u5b58\u5668\u4f4e 32 \u4f4d\u7684\u6570\u636e\u65f6\uff0c\u9ad8 32 \u4f4d\u7684\u6570\u636e\u4f1a\u88ab\u540c\u65f6\u590d\u4f4d\uff0c\u5373\u7f6e\u96f6\u3002\u6240\u4ee5 <code>asm(\"movl $0x1, %eax\")</code> \u4f1a\u5c06 <code>rax</code> \u7684\u7ed3\u679c\u7f6e\u96f6\u540e\u518d\u5199\u51651\uff0c\u8fd9\u65f6 num \u8f93\u51fa\u7684\u503c\u4e3a0x1\u3002</p> <p>\u95ee\u98981\uff1a\u5bf9\u4e8e\u6240\u6709\u7684\u7f16\u8bd1\u90fd\u662f\u8fd9\u6837\u5417\uff1f</p> <p></p> <p>\u597d\u50cf\u5e76\u4e0d\u662f\uff1f</p> <p>\u95ee\u98982\uff1aprintf\u6e05\u7a7a\u5bc4\u5b58\u5668\uff1f</p> <p><code>printf</code> \u51fd\u6570\u7684\u8c03\u7528\u5bfc\u81f4\u7684\uff0c\u66f4\u591a\u5185\u5bb9\u6211\u4eec\u4f1a\u5728\u7b2c <code>12 \u8bb2\uff1a\u6807\u51c6\u5e93\uff1a\u975e\u672c\u5730\u8df3\u8f6c\u4e0e\u53ef\u53d8\u53c2\u6570\u662f\u600e\u6837\u5b9e\u73b0\u7684\uff1f</code>\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u3002</p> <p>\u6982\u62ec\u4e0b\u6765\u662f\u7531\u4e8e x86-64 ABI \u4e2d\u5bf9\u53ef\u53d8\u957f\u53c2\u6570\u8c03\u7528\u65f6\u7684\u89c4\u5b9a\u3002\u5728\u8fd9\u91cc\uff0c\u5bc4\u5b58\u5668 <code>rax</code> \u4f1a\u7528\u4e8e\u4fdd\u5b58\u4f7f\u7528\u5230\u7684\u5411\u91cf\u5bc4\u5b58\u5668\u7684\u4e2a\u6570\u3002</p> </li> <li> <p>\u601d\u8003</p> <pre><code>mov eax, 0x1\ninc eax\nsub eax, 10\nxor eax, eax\nadd eax, 1\nmul eax\n\n; \u5bc4\u5b58\u5668eax\u4e2d\u7684\u503c\u662f\u591a\u5c11\uff1f\n; 1\n</code></pre> </li> </ul> <p>\u4f5c\u8005\u56de\u590d: \u8fd9\u53c8\u662f\u4e00\u4e2a\u597d\u95ee\u9898\uff01\u5176\u5b9e\u8fd9\u91cc\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u7684\u662f AT&amp;T \u7684\u5199\u6cd5\uff0c\u662f\u4e00\u79cd\u9ed8\u8ba4\u88ab\u7f16\u8bd1\u5668\u5e7f\u6cdb\u652f\u6301\u7684\u5185\u8054\u6c47\u7f16\u5199\u6cd5\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u505a\u9002\u5f53\u7684\u8c03\u6574\u6765\u4f7f\u7528 Intel \u5199\u6cd5\uff0c\u6bd4\u5982\u8fd9\u6837\uff1a</p> <pre><code>Intel\u5199\u6cd5\uff1a\n#include &lt;stdio.h&gt;\nint main(void) {\n  register long num asm(\"rax\") = 0x100000000;\n  asm(\n    \".intel_syntax noprefix \\n\\t\"\n    \"mov eax, 1\\n\\t\"    , \u53f3\u8fb9\u7ed9\u5de6\u8fb9\n    // \"mov ax, 1\\n\\t\"\n    \".att_syntax\"\n  );\n  printf(\"%ld\\n\", n\u8ba4\u88ab\u7f16\u8bd1\u5668\u5e7f\u6cdb\u652f\u6301\u7684\u5185\u8054\u6c47\u7f16\u5199\u6cd5\n}\n\n\u9ed8\u8ba4\u676f\u7f16\u8bd1\u5668\u5e7f\u6cdb\u652f\u6301\u7684\u5185\u8054\u6c47\u7f16\u5199\u6cd5AT &amp; T \u5199\u6cd5\uff1a\nasm(\"movl $0x1, %eax\");\u662f\u5c061\u7ed9eax\u7684\uff0csrc \u8ddfdst\u53cd\u8fc7\u6765\u4e86\u597d\u50cf\uff1a\u5de6\u8fb9\u7ed9\u53f3\u8fb9\n// AT &amp; T mov\u6307\u4ee4\u662f\u5de6\u8fb9\u7ed9\u53f3\u8fb9\n// intel \u6c47\u7f16\u662f\u53f3\u8fb9\u7ed9\u5de6\u8fb9\n</code></pre> <p>Intel\u6c47\u7f16\u548cAT&amp;T\u7684x86\u6c47\u7f16\u90fd\u662f\u9488\u5bf9x86\u67b6\u6784\u7684\u6c47\u7f16\u8bed\u8a00\uff0c\u4f46\u5b83\u4eec\u5728\u8bed\u6cd5\u548c\u8868\u793a\u65b9\u5f0f\u4e0a\u6709\u4e00\u4e9b\u533a\u522b\uff1a</p> <ol> <li>\u8bed\u6cd5\u683c\u5f0f\uff1a</li> <li>Intel\u6c47\u7f16\uff1aIntel\u8bed\u6cd5\u662f\u6700\u5e38\u89c1\u7684x86\u6c47\u7f16\u8bed\u6cd5\uff0c\u5b83\u4f7f\u7528\u76ee\u7684\u64cd\u4f5c\u6570\u5728\u6307\u4ee4\u540e\u9762\u7684\u5f62\u5f0f\u3002\u4f8b\u5982\uff0c<code>MOV EAX, 1</code>\u8868\u793a\u5c06\u503c1\u79fb\u52a8\u5230EAX\u5bc4\u5b58\u5668\u3002</li> <li> <p>AT&amp;T\u6c47\u7f16\uff1aAT&amp;T\u8bed\u6cd5\u4f7f\u7528\u6e90\u64cd\u4f5c\u6570\u5728\u6307\u4ee4\u540e\u9762\u7684\u5f62\u5f0f\u3002\u4f8b\u5982\uff0c<code>movl $1, %eax</code>\u8868\u793a\u5c06\u503c1\u79fb\u52a8\u5230EAX\u5bc4\u5b58\u5668\u3002</p> </li> <li> <p>\u5bc4\u5b58\u5668\u8868\u793a\uff1a</p> </li> <li>Intel\u6c47\u7f16\uff1a\u5bc4\u5b58\u5668\u540d\u79f0\u901a\u5e38\u4ee5\u5b57\u6bcd\u5f00\u5934\uff0c\u5982EAX\u3001EBX\u7b49\u3002</li> <li> <p>AT&amp;T\u6c47\u7f16\uff1a\u5bc4\u5b58\u5668\u540d\u79f0\u901a\u5e38\u4ee5%\u7b26\u53f7\u5f00\u5934\uff0c\u5982<code>%eax\u3001%ebx</code>\u7b49\u3002</p> </li> <li> <p>\u7acb\u5373\u6570\u8868\u793a\uff1a</p> </li> <li>Intel\u6c47\u7f16\uff1a\u7acb\u5373\u6570\u5e38\u5e38\u76f4\u63a5\u5199\u660e\uff0c\u5982<code>MOV EAX, 123</code>.</li> <li> <p>AT&amp;T\u6c47\u7f16\uff1a\u7acb\u5373\u6570\u524d\u9762\u901a\u5e38\u52a0\u4e0a$\u7b26\u53f7\uff0c\u5982<code>movl $123, %eax</code>\u3002</p> </li> <li> <p>\u6307\u4ee4\u683c\u5f0f\uff1a</p> </li> <li>\u6709\u4e9b\u6307\u4ee4\u7684\u64cd\u4f5c\u6570\u987a\u5e8f\u5728Intel\u548cAT&amp;T\u8bed\u6cd5\u4e2d\u662f\u76f8\u53cd\u7684\u3002\u4f8b\u5982\uff0c<code>ADD EAX, EBX</code>\u5728Intel\u8bed\u6cd5\u4e2d\u8868\u793a\u5c06EAX\u548cEBX\u76f8\u52a0\uff0c\u800c\u5728AT&amp;T\u8bed\u6cd5\u4e2d\u5e94\u8be5\u662f<code>addl %ebx, %eax</code>\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cIntel\u6c47\u7f16\u548cAT&amp;T\u6c47\u7f16\u5728\u8bed\u6cd5\u683c\u5f0f\u3001\u5bc4\u5b58\u5668\u8868\u793a\u548c\u7acb\u5373\u6570\u8868\u793a\u7b49\u65b9\u9762\u5b58\u5728\u4e00\u4e9b\u5dee\u5f02\u3002\u7a0b\u5e8f\u5458\u5728\u9605\u8bfb\u548c\u7f16\u5199\u4e0d\u540c\u683c\u5f0f\u7684\u6c47\u7f16\u4ee3\u7801\u65f6\u9700\u8981\u6ce8\u610f\u8fd9\u4e9b\u533a\u522b\uff0c\u4ee5\u786e\u4fdd\u6b63\u786e\u7406\u89e3\u548c\u7f16\u5199\u6c47\u7f16\u6307\u4ee4\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html#_2","title":"\u57fa\u7840\u77e5\u8bc6\u590d\u4e60","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html#c","title":"C\u6838\u5fc3\u8bed\u6cd5","text":"<pre><code>#include &lt;stdlib.h&gt; \n#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;stdbool.h&gt;\n\n#define BOOL_TRUE 1  // \u5b9a\u4e49\u7528\u5230\u7684\u5b8f\u5e38\u91cf\u4e0e\u5b8f\u51fd\u6570\uff1b\n#define BOOL_FALSE 0\n#define typename(x) _Generic((x), \\\n  unsigned short: \"unsigned short int\", \\\n  unsigned long: \"unsigned long int\", \\\n  default: \"unknown\")\n\ntypedef enum { Host, IP } IP_ADDR_TYPE;  // \u5b9a\u4e49\u679a\u4e3e\u7c7b\u578b IP_ADDR_TYPE\uff0c\u7528\u4e8e\u8868\u793a\u8054\u5408\u4e2d\u751f\u6548\u7684\u5b57\u6bb5\uff1b\ntypedef struct {  // \u5b9a\u4e49\u7ed3\u6784 CONN\uff1b\n  size_t id;\n  uint16_t port;\n  bool closed;\n  IP_ADDR_TYPE addr_type;\n  union {\n    char host_name[256];\n    char ip[24];\n  };\n} CONN;\n\ninline static const char* findAddr(const CONN* pip) {  // \u5b9a\u4e49\u51fd\u6570 findAddr\uff0c\u7528\u4e8e\u6253\u5370 CONN \u5bf9\u8c61\u7684\u4fe1\u606f\uff1b\n  assert(pip != NULL);  // \u8fd0\u884c\u65f6\u65ad\u8a00\uff0c\u5224\u65ad\u4f20\u5165\u7684 CONN \u6307\u9488\u662f\u5426\u6709\u6548\uff1b\n  return pip-&gt;addr_type == Host ? pip-&gt;host_name : pip-&gt;ip;\n}\n\nint main(int argc, char* argv[]) {  // \u5165\u53e3\u51fd\u6570\uff1b\n  static_assert(sizeof(CONN) &lt;= 0x400, \"the size of CONN object exceeds limit.\");  // \u9759\u6001\u65ad\u8a00\uff0c\u5224\u65ad CONN \u5bf9\u8c61\u7684\u5927\u5c0f\u662f\u5426\u7b26\u5408\u8981\u6c42\uff1b\n  const CONN conns[] = {  // \u6784\u9020\u4e00\u4e2a\u6570\u7ec4\uff0c\u5305\u542b\u4e09\u4e2a CONN \u5bf9\u8c61\uff1b\n    [2] = { 1, 80, BOOL_TRUE, IP, { .ip = \"127.0.0.1\" } },\n    [0] = { 2, 8080, BOOL_FALSE, IP, { .ip = \"192.168.1.1\" } },\n    { 3, 8088, BOOL_FALSE, Host, { .host_name = \"http://localhost/\" } }\n  };    \n\n  for (size_t i = 0; i &lt; (sizeof(conns) / sizeof(CONN)); ++i) {  // \u904d\u5386\u4e0a\u8ff0 CONN \u6570\u7ec4\uff0c\u5e76\u6253\u5370\u5176\u4e2d\u7684\u5185\u5bb9\uff1b\n    printf(\n      \"Port: %d\\n\"\n      \"Host/Addr: %s\\n\"\n      \"Internal type of `id` is: %s\\n\\n\",\n      conns[i].port,\n      findAddr(&amp;conns[i]),\n      typename(conns[i].id)\n    );\n  }\n  return EXIT_SUCCESS; \n}\n</code></pre> <ul> <li> <p>\u6570\u7ec4</p> <p>\u4e3b\u8981\u662f\u6570\u7ec4\u7684\u62ec\u53f7\u5217\u8868\u521d\u59cb\u5316\u65b9\u5f0f\uff0c\u4f46\u6211\u4eec\u8fd8\u4f7f\u7528\u4e86\u6307\u6d3e\u521d\u59cb\u5316\uff08\u4e3a\u521d\u59cb\u5316\u5217\u8868\u4e2d\u7684\u9879\u8bbe\u5b9a\u201c\u6307\u6d3e\u7b26\u201d\uff09\u7684\u65b9\u5f0f\uff0c\u6765\u660e\u786e\u6307\u5b9a\u8fd9\u4e9b\u9879\u5728\u6570\u7ec4\u4e2d\u7684\u5177\u4f53\u4f4d\u7f6e\u3002</p> <p>\u6bd4\u5982\u8fd9\u91cc\u7b2c\u4e00\u9879\u5bf9\u5e94\u7684 \u201c[2]\u201d \uff0c\u5c31\u8868\u793a\u5c06\u8be5\u9879\u8bbe\u7f6e\u4e3a\u6570\u7ec4 conns \u4e2d\u7684\u7b2c 3 \u4e2a\u5143\u7d20\uff08\u7d22\u5f15\u4ece 0 \u5f00\u59cb\uff09\u3002\u6570\u7ec4\u5b9a\u4e49\u5b8c\u6bd5\u540e\uff0c\u7b2c 44 \u5230\u7b2c 46 \u884c\u7684\u4ee3\u7801\u8bbf\u95ee\u4e86\u5176\u5185\u90e8\u5b58\u653e\u7684\u5143\u7d20\u3002\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u65b9\u62ec\u53f7\u52a0\u7d22\u5f15\u503c\u7684\u8bed\u6cd5\u5f62\u5f0f\u505a\u5230\u4e86\u8fd9\u4e00\u70b9\u3002</p> </li> <li> <p>\u7ed3\u6784\u548c\u8054\u5408</p> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u7ed3\u6784\u548c\u8054\u5408\uff08\u6709\u65f6\u4e5f\u88ab\u79f0\u4e3a\u7ed3\u6784\u4f53\u4e0e\u8054\u5408\u4f53\uff09\u901a\u5e38\u7528\u6765\u7ec4\u7ec7\u590d\u6742\u7c7b\u578b\u7684\u81ea\u5b9a\u4e49\u6570\u636e\u3002</p> <p>\u5728\u7ed3\u6784\u4e2d\uff0c\u6240\u6709\u5b9a\u4e49\u5b57\u6bb5\u7684\u5bf9\u5e94\u6570\u636e\u6309\u7167\u5185\u5b58\u8fde\u7eed\u7684\u65b9\u5411\u6392\u5217\uff1b\u800c\u5728\u8054\u5408\u4e2d\uff0c\u5b9a\u4e49\u7684\u5b57\u6bb5\u540c\u4e00\u65f6\u95f4\u53ea\u4f1a\u6709\u4e00\u4e2a\u201c\u751f\u6548\u201d\u3002</p> <p>\u5728\u6211\u4eec\u5bf9\u7ed3\u6784 CONN \u5bf9\u8c61\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u540c\u6837\u4f7f\u7528\u4e86\u7c7b\u4f3c\u6570\u7ec4\u7684\u62ec\u53f7\u5217\u8868\u521d\u59cb\u5316\uff0c\u4ee5\u53ca\u6307\u6d3e\u521d\u59cb\u5316\u3002\u4f46\u548c\u524d\u9762\u6570\u7ec4\u521d\u59cb\u5316\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u91cc\u7684\u6307\u6d3e\u662f\u9488\u5bf9\u7ed3\u6784\u4e0e\u8054\u5408\u7c7b\u578b\u5185\u90e8\u7684\u6210\u5458\u5b57\u6bb5\u7684\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528 \u201c.\u201d \u7b26\u53f7\u6765\u5f15\u7528\u67d0\u4e2a\u5177\u4f53\u6210\u5458\uff0c\u800c\u975e\u6570\u7ec4\u6240\u4f7f\u7528\u7684\u5f62\u5f0f\u3002</p> </li> <li> <p>\u5b8f</p> <p>\u7f16\u8bd1\u5668\u5bf9 C \u6e90\u4ee3\u7801\u7684\u5904\u7406\u8fc7\u7a0b\u5206\u4e3a\u51e0\u4e2a\u9636\u6bb5\uff0c\u5176\u4e2d\uff0c\u5b8f\u662f\u6700\u5148\u88ab\u5904\u7406\u7684\u4e00\u4e2a\u90e8\u5206\u3002\u5728\u8fd9\u6bb5\u4ee3\u7801\u7684\u5f00\u5934\u5904\uff0c\u6211\u4eec\u901a\u8fc7\u5b8f\u6307\u4ee4 \u201c#include\u201d \u5f15\u5165\u4e86\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u9700\u8981\u7684\u4e00\u4e9b\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u8fd9\u4e9b\u5f15\u5165\u7684\u5185\u5bb9\u4f1a\u5728\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u5f97\u5230\u66ff\u6362\u3002\u968f\u540e\uff0c\u6211\u4eec\u53c8\u901a\u8fc7 \u201c#define\u201d \u6307\u4ee4\u5b9a\u4e49\u4e86\u76f8\u5e94\u7684\u5b8f\u5e38\u91cf\u4e0e\u5b8f\u51fd\u6570\uff0c\u800c\u5176\u4e2d\u7684\u5b8f\u51fd\u6570 <code>typename</code> \u5219\u4f7f\u7528\u5230\u4e86 C11 \u6807\u51c6\u65b0\u5f15\u5165\u7684 <code>_Generic</code> \u5173\u952e\u5b57\uff0c\u4ee5\u7528\u6765\u5b9e\u73b0\u57fa\u4e8e\u5b8f\u7684\u6cdb\u578b\u3002</p> </li> <li> <p>\u65ad\u8a00</p> <p>\u5728\u8fd9\u6bb5\u4ee3\u7801\u7684\u7b2c 32 \u884c\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 C11 \u6807\u51c6\u4e2d\u63d0\u4f9b\u7684\u9759\u6001\u65ad\u8a00\u80fd\u529b\uff0c\u6765\u4fdd\u8bc1\u7ed3\u6784\u7c7b\u578b CONN \u7684\u5927\u5c0f\u4e0d\u4f1a\u8d85\u8fc7\u4e00\u5b9a\u7684\u9608\u503c\u3002\u800c\u5728\u4ee3\u7801\u7684\u7b2c 27 \u884c\uff0c\u6211\u4eec\u8fd8\u4f7f\u7528\u4e86\u8fd0\u884c\u65f6\u65ad\u8a00\u6765\u4fdd\u8bc1\u4f20\u9012\u7ed9\u51fd\u6570 <code>findAddr</code> \u7684 CONN \u5bf9\u8c61\u6307\u9488\u4e0d\u4e3a\u7a7a\u3002</p> <p>\u5728 C \u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u4f7f\u7528\u65ad\u8a00\uff0c\u6765\u5bf9\u67d0\u79cd\u9700\u8981\u652f\u6301\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u7684\u5047\u8bbe\u6027\u6761\u4ef6\u8fdb\u884c\u68c0\u67e5\u3002\u800c\u5f53\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\uff0c\u5219\u5728\u7a0b\u5e8f\u7f16\u8bd1\u6216\u8fd0\u884c\u65f6\u7ec8\u6b62\uff0c\u5e76\u5411\u7528\u6237\u629b\u51fa\u76f8\u5e94\u7684\u9519\u8bef\u4fe1\u606f\u3002</p> <p>C \u8bed\u8a00\u63d0\u4f9b\u9759\u6001\u4e0e\u52a8\u6001\u4e24\u79cd\u7c7b\u578b\u7684\u65ad\u8a00\uff0c\u5176\u4e2d\u9759\u6001\u65ad\u8a00\u4f1a\u5728\u4ee3\u7801\u7f16\u8bd1\u65f6\u8fdb\u884c\u68c0\u67e5\uff1b\u800c\u52a8\u6001\u65ad\u8a00\u5219\u4f1a\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u5230\u8be5\u65ad\u8a00\u8bed\u53e5\u65f6\u518d\u8fdb\u884c\u68c0\u67e5\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html#c_1","title":"C\u8bed\u8a00\u7f16\u7a0b\u8303\u5f0f","text":"<p>\u629b\u5f00\u8bed\u6cd5\u7ec6\u8282\uff0c\u4ece\u603b\u4f53\u4e0a\u6765\u770b\uff0cC \u8bed\u8a00\u662f\u4e00\u79cd\u201c\u547d\u4ee4\u5f0f\u201d\u7f16\u7a0b\u8bed\u8a00\uff0c\u548c\u5b83\u7c7b\u4f3c\u7684\u8fd8\u6709 Java\u3001C#\u3001Go \u7b49\u8bed\u8a00\u3002</p> <p>\u547d\u4ee4\u5f0f\u7f16\u7a0b\uff08Imperative Programming\uff09\u662f\u8fd9\u6837\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f\uff1a\u4f7f\u7528\u53ef\u4ee5\u6539\u53d8\u7a0b\u5e8f\u72b6\u6001\u7684\u4ee3\u7801\u8bed\u53e5\uff0c\u63cf\u8ff0\u7a0b\u5e8f\u5e94\u8be5\u5982\u4f55\u8fd0\u884c\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u66f4\u5173\u6ce8\u8ba1\u7b97\u673a\u5b8c\u6210\u4efb\u52a1\u6240\u9700\u8981\u6267\u884c\u7684\u5177\u4f53\u6b65\u9aa4\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\u3002\u5bf9\u4e8e\u201c\u4ece\u4e00\u4e2a\u5305\u542b\u6709\u6307\u5b9a\u6570\u5b57\u7684\u96c6\u5408\u4e2d\uff0c\u7b5b\u9009\u51fa\u5927\u4e8e 7 \u7684\u6240\u6709\u6570\u5b57\u201d\u8fd9\u4e2a\u9700\u6c42\uff0c\u6309\u7167\u547d\u4ee4\u5f0f\u7f16\u7a0b\u7684\u601d\u8def\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u7f16\u7a0b\u8bed\u8a00\u6765\u544a\u8bc9\u8ba1\u7b97\u673a\u5177\u4f53\u7684\u6267\u884c\u6b65\u9aa4\u3002</p> <p>\u4ee5 C \u8bed\u8a00\u4e3a\u4f8b\uff0c\u89e3\u51b3\u8fd9\u4e2a\u9700\u6c42\u7684\u6b65\u9aa4\u53ef\u80fd\u4f1a\u662f\u8fd9\u6837\uff1a</p> <p>\u4f7f\u7528\u6570\u7ec4\uff0c\u6784\u9020\u4e00\u5757\u53ef\u4ee5\u5b58\u653e\u8fd9\u4e9b\u6570\u5b57\u7684\u5185\u5b58\u7a7a\u95f4\uff1b</p> <p>\u4f7f\u7528\u5faa\u73af\u63a7\u5236\u8bed\u53e5\uff0c\u4f9d\u6b21\u68c0\u67e5\u5185\u5b58\u4e2d\u7684\u8fd9\u4e9b\u6570\u5b57\u662f\u5426\u6ee1\u8db3\u8981\u6c42\uff08\u5373\u5927\u4e8e 7\uff09\uff1b</p> <p>\u5bf9\u4e8e\u6ee1\u8db3\u8981\u6c42\u7684\u6570\u5b57\uff0c\u5c06\u5b83\u4eec\u62f7\u8d1d\u5230\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u6682\u5b58\u4e3a\u7ed3\u679c\u3002\u5bf9\u5e94\u7684\u4ee3\u7801\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#define ARR_LEN 5\nint main(void) { \n  int arr[ARR_LEN] = { 1, 5, 10, 9, 0 };\n  for (int i = 0; i &lt; ARR_LEN; ++i) {\n    if (arr[i] &gt; 7) {\n      // save this element somewhere else.\n    }\n  }\n  return 0;\n}\n</code></pre> <p>\u76f8\u5bf9\u4e8e\u547d\u4ee4\u5f0f\u7f16\u7a0b\u8bed\u8a00\uff0c\u5176\u4ed6\u8bed\u8a00\u4e00\u822c\u4f1a\u88ab\u5f52\u7c7b\u4e3a\u201c\u58f0\u660e\u5f0f\u201d\u7f16\u7a0b\u8bed\u8a00\u3002</p> <p>\u58f0\u660e\u5f0f\u7f16\u7a0b\uff08Declarative Programming\uff09\u4e5f\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u7f16\u7a0b\u8303\u5f0f\u3002\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u79cd\u8303\u5f0f\u66f4\u503e\u5411\u4e8e\u8868\u8fbe\u8ba1\u7b97\u7684\u903b\u8f91\uff0c\u800c\u975e\u89e3\u51b3\u95ee\u9898\u65f6\u8ba1\u7b97\u673a\u9700\u8981\u6267\u884c\u7684\u5177\u4f53\u6b65\u9aa4\u3002</p> <p>\u6bd4\u5982\u8bf4\uff0c\u8fd8\u662f\u521a\u624d\u90a3\u4e2a\u9700\u6c42\uff0c\u5728\u4f7f\u7528\u58f0\u660e\u5f0f\u7f16\u7a0b\u8bed\u8a00\u65f6\uff0c\u5bf9\u5e94\u7684\u89e3\u51b3\u6b65\u9aa4\u53ef\u80fd\u662f\uff1a</p> <p>\u6784\u5efa\u4e00\u4e2a\u5bb9\u5668\u6765\u5b58\u653e\u6570\u636e\uff1b</p> <p>\u6309\u7167\u6761\u4ef6\u5bf9\u5bb9\u5668\u6570\u636e\u8fdb\u884c\u7b5b\u9009\uff0c\u5e76\u5c06\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u4f5c\u4e3a\u7ed3\u679c\u8fd4\u56de\u3002</p> <p>\u4ee5 JavaScript \u4e3a\u4f8b\uff1a</p> <pre><code>let arr = [1, 5, 10, 9, 0]\nlet result = arr.filter(n =&gt; n &gt; 7)\n</code></pre> <ol> <li>\u547d\u4ee4\u5f0f\u7f16\u7a0b\uff08Imperative Programming\uff09\uff1a<ul> <li>\u547d\u4ee4\u5f0f\u7f16\u7a0b\u662f\u4e00\u79cd\u4ee5\u7f16\u5199\u660e\u786e\u7684\u6307\u4ee4\u5e8f\u5217\u6765\u63cf\u8ff0\u8ba1\u7b97\u8fc7\u7a0b\u7684\u7f16\u7a0b\u8303\u5f0f\u3002\u7a0b\u5e8f\u5458\u9700\u8981\u8be6\u7ec6\u6307\u5b9a\u6bcf\u4e2a\u6b65\u9aa4\u548c\u64cd\u4f5c\uff0c\u63a7\u5236\u8ba1\u7b97\u673a\u7684\u6267\u884c\u6d41\u7a0b\u3002</li> <li>\u547d\u4ee4\u5f0f\u7f16\u7a0b\u5173\u6ce8\u7684\u662f\u8ba1\u7b97\u673a\u6267\u884c\u7684\u6b65\u9aa4\u548c\u987a\u5e8f\uff0c\u4ee5\u53ca\u5bf9\u72b6\u6001\u7684\u64cd\u4f5c\u548c\u53d8\u5316\u3002</li> <li>\u4ee3\u8868\u6027\u7684\u547d\u4ee4\u5f0f\u7f16\u7a0b\u8bed\u8a00\u5305\u62ecC\u3001Java\u3001Python\u7b49\u3002</li> </ul> </li> <li>\u58f0\u660e\u5f0f\u7f16\u7a0b\uff08Declarative Programming\uff09\uff1a<ul> <li>\u58f0\u660e\u5f0f\u7f16\u7a0b\u662f\u4e00\u79cd\u63cf\u8ff0\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u800c\u4e0d\u662f\u63cf\u8ff0\u5982\u4f55\u89e3\u51b3\u95ee\u9898\u7684\u7f16\u7a0b\u8303\u5f0f\u3002\u7a0b\u5e8f\u5458\u66f4\u591a\u5730\u63cf\u8ff0\u95ee\u9898\u7684\u6027\u8d28\u548c\u8981\u6c42\uff0c\u800c\u4e0d\u662f\u5177\u4f53\u5b9e\u73b0\u7684\u6b65\u9aa4\u3002</li> <li>\u58f0\u660e\u5f0f\u7f16\u7a0b\u5173\u6ce8\u7684\u662f\u95ee\u9898\u7684\u672c\u8d28\u548c\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u5177\u4f53\u7684\u6267\u884c\u6d41\u7a0b\u548c\u64cd\u4f5c\u3002</li> <li>\u4ee3\u8868\u6027\u7684\u58f0\u660e\u5f0f\u7f16\u7a0b\u8bed\u8a00\u5305\u62ecSQL\u3001HTML\u3001CSS\u7b49\u3002</li> </ul> </li> <li>\u51fd\u6570\u5f0f\u7f16\u7a0b\uff08Functional Programming\uff09\uff1a<ul> <li>\u51fd\u6570\u5f0f\u7f16\u7a0b\u662f\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f\uff0c\u5176\u4e2d\u51fd\u6570\u88ab\u89c6\u4e3a\u4e00\u7b49\u516c\u6c11\uff0c\u51fd\u6570\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3001\u4f5c\u4e3a\u8fd4\u56de\u503c\u8fd4\u56de\uff0c\u51fd\u6570\u4e4b\u95f4\u7684\u7ec4\u5408\u548c\u64cd\u4f5c\u662f\u7f16\u7a0b\u7684\u6838\u5fc3\u3002</li> <li>\u51fd\u6570\u5f0f\u7f16\u7a0b\u5f3a\u8c03\u7eaf\u51fd\u6570\u3001\u4e0d\u53ef\u53d8\u6027\u548c\u907f\u514d\u526f\u4f5c\u7528\uff0c\u901a\u8fc7\u51fd\u6570\u7684\u7ec4\u5408\u548c\u5e94\u7528\u6765\u89e3\u51b3\u95ee\u9898\u3002</li> <li>\u51fd\u6570\u5f0f\u7f16\u7a0b\u6709\u52a9\u4e8e\u51cf\u5c11\u53ef\u53d8\u72b6\u6001\u548c\u526f\u4f5c\u7528\uff0c\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u548c\u5e76\u53d1\u6027\u3002</li> <li>\u4ee3\u8868\u6027\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u5305\u62ecHaskell\u3001Scala\u3001Clojure\u7b49\uff0c\u540c\u65f6\u4e5f\u6709\u4e00\u4e9b\u652f\u6301\u51fd\u6570\u5f0f\u7f16\u7a0b\u98ce\u683c\u7684\u7279\u6027\u7684\u8bed\u8a00\uff0c\u5982JavaScript\u548cPython\u3002</li> </ul> </li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/0.%20%E7%BB%BC%E8%BF%B0/assembly.html#c_2","title":"C\u7a0b\u5e8f\u7f16\u8bd1\u548c\u8fd0\u884c","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html","title":"Example","text":"<p>\u8fd9\u4efd\u7b14\u8bb0\uff1a\u6211\u4eec\u5c06\u56f4\u7ed5 C \u8bed\u8a00\u7684\u4e03\u5927\u7c7b\u6838\u5fc3\u8bed\u6cd5\uff0c\u6df1\u5165\u63a2\u5bfb\u9690\u85cf\u5728\u8bed\u6cd5\u80cc\u540e\uff0c\u7a0b\u5e8f\u4ee3\u7801\u7684\u5b9e\u9645\u6267\u884c\u7ec6\u8282\u3002</p> <p>C \u6807\u51c6\u4e2d\u8be6\u7ec6\u63cf\u8ff0\u4e86 C \u8bed\u8a00\u5728\u8bed\u6cd5\u548c\u8bed\u4e49\u4e24\u4e2a\u5c42\u9762\u7684\u57fa\u672c\u5185\u5bb9\uff0c</p> <p>\u4f46\u5bf9\u4e8e\u5b9e\u73b0\u8005\uff0c\u6bd4\u5982\u7f16\u8bd1\u5668\u6765\u8bf4\uff0c\u5982\u4f55\u5c06\u8fd9\u4e9b\u8bed\u6cd5\u548c\u8bed\u4e49\u4f53\u73b0\u5728\u5177\u4f53\u7684\u673a\u5668\u6307\u4ee4\uff08\u6c47\u7f16\u4ee3\u7801\uff09\u4e0a\uff0c\u6807\u51c6\u5e76\u672a\u7ed9\u51fa\u8be6\u7ec6\u89c4\u5b9a\u3002</p> <p>\u6240\u4ee5\u95ee\u9898\u6765\u4e86\uff1a\u5728\u8fd9\u5c42\u62bd\u8c61\u80cc\u540e\uff0c\u4e00\u4e2a C \u7a0b\u5e8f\u4e2d\u7684\u5404\u7c7b\u8bed\u6cd5\u7ed3\u6784\uff0c\u7a76\u7adf\u662f\u5982\u4f55\u6620\u5c04\u5230\u673a\u5668\u80fd\u591f\u8bc6\u522b\u7684\u4e0d\u540c\u6307\u4ee4\u4e0a\u7684\uff1f</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#01","title":"01\uff5c\u7a0b\u5e8f\u57fa\u77f3\uff1a\u6570\u636e\u4e0e\u91cf\u503c\u662f\u5982\u4f55\u88ab\u7ec4\u7ec7\u7684\uff1f","text":"<p>\u4e00\u4e2a\u5b8c\u6574\u7684\u7a0b\u5e8f\u662f\u7531\u201c\u7b97\u6cd5\u201d\u4e0e\u201c\u6570\u636e\u7ed3\u6784\u201d\u4e24\u90e8\u5206\u7ec4\u6210\u7684\u3002</p> <p>\u5176\u4e2d\uff0c\u7b97\u6cd5\u4ee3\u8868\u7a0b\u5e8f\u4f1a\u4ee5\u600e\u6837\u7684\u5177\u4f53\u903b\u8f91\u6765\u8fd0\u884c\uff1b\u6570\u636e\u7ed3\u6784\u4ee3\u8868\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u6d89\u53ca\u6570\u636e\u7684\u5177\u4f53\u7ec4\u7ec7\u65b9\u5f0f\u3002</p> <p>\u800c\u5728\u4e00\u95e8\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u6570\u636e\u4fbf\u662f\u4ee5\u4e0d\u540c\u7c7b\u578b\u201c\u91cf\u503c\u201d\u7684\u5f62\u5f0f\u88ab\u7ec4\u7ec7\u5728\u4e00\u8d77\uff0c\u5e76\u4ea4\u7531\u7b97\u6cd5\u8fdb\u884c\u5904\u7406\u7684\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8bf4\uff0c\u6570\u636e\u548c\u91cf\u503c\u662f\u7a0b\u5e8f\u8fd0\u884c\u7684\u57fa\u77f3\u3002</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_1","title":"\u53d8\u91cf","text":"<p>\u91cf\u503c\u53ef\u4ee5\u88ab\u7c97\u7565\u5730\u5206\u4e3a\u53d8\u91cf\uff08variable\uff09\u4e0e\u5e38\u91cf\uff08constant\uff09\u3002</p> <p>\u5176\u4e2d\u53d8\u91cf\u662f\u6307\u503c\u53ef\u4ee5\u5728\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u4e2d\u88ab\u591a\u6b21\u6539\u53d8\u7684\u91cf\uff1b</p> <p>\u800c\u5e38\u91cf\u5219\u4e0e\u4e4b\u76f8\u53cd\uff0c\u5728\u88ab\u5b9a\u4e49\u540e\u4fbf\u65e0\u6cd5\u88ab\u518d\u6b21\u4fee\u6539\u3002</p> <p>\u4f5c\u4e3a\u4e00\u79cd\u9ad8\u7ea7\u8bed\u8a00\uff0cC \u8bed\u8a00\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u53ef\u7528\u4e8e\u5b9a\u4e49\u5e38\u91cf\u4e0e\u53d8\u91cf\u7684\u8bed\u6cd5\u3002</p> <pre><code>int x = -10;  // \u5b9a\u4e49\u4e00\u4e2a\u6574\u578b\u53d8\u91cf\uff1b\nchar y = 'c';  // \u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u53d8\u91cf\uff1b\ndouble z = 2.0;  // \u5b9a\u4e49\u4e00\u4e2a\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u53d8\u91cf\uff1b\nunsigned int ux = 10;\n</code></pre> <p>C \u8bed\u8a00\u63d0\u4f9b\u4e86\u4f17\u591a\u7684\u5173\u952e\u5b57\uff0c\u53ef\u7528\u6765\u6307\u5b9a\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u8fd9\u4e9b\u7c7b\u578b\u5747\u4ee5\u5b57\u8282\u4f5c\u4e3a\u5355\u4f4d\uff0c\u6765\u8868\u793a\u53d8\u91cf\u53ef\u5bb9\u7eb3\u6570\u636e\u7684\u6700\u5927\u5bbd\u5ea6\u3002</p> <p>\u4f8b\u5982\uff0cchar \u7c7b\u578b\u7684\u6570\u636e\u4ec5\u5360\u7528 1 \u4e2a\u5b57\u8282\uff0c\u800c long long \u7c7b\u578b\u5219\u81f3\u5c11\u5360\u7528 8 \u4e2a\u5b57\u8282\u3002\u9664\u4e86\u6700\u5e38\u89c1\u7684\u7528\u4e8e\u8868\u793a\u6570\u503c\u7684\u7c7b\u578b\u5916\uff0cC90 \u4e0e C99 \u6807\u51c6\u8fd8\u63d0\u4f9b\u4e86 void\uff08\u7a7a\u7c7b\u578b\uff09\u3001_ Bool\uff08\u5e03\u5c14\u578b\uff09\u3001_Complex\uff08\u590d\u6570\u7c7b\u578b\uff09\u7b49\u7c7b\u578b\u5173\u952e\u5b57\uff0c\u4ee5\u7528\u4e8e\u6307\u5b9a\u5176\u4ed6\u975e\u6570\u503c\u7c7b\u578b\u3002</p> <p>\u5f53\u7136\uff0cC \u8bed\u8a00\u4e2d\u53d8\u91cf\u7c7b\u578b\u5360\u7528\u7684\u5177\u4f53\u5b57\u8282\u5927\u5c0f\uff0c\u8fd8\u4e0e\u7a0b\u5e8f\u8fd0\u884c\u6240\u5728\u7684\u786c\u4ef6\u4f53\u7cfb\u7ed3\u6784\u7d27\u5bc6\u76f8\u5173\uff0c\u8fd9\u4e5f\u662f C \u8bed\u8a00\u4e0e\u5176\u4ed6\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u6709\u6240\u4e0d\u540c\u7684\u5730\u65b9\u3002</p> <p>C \u8bed\u8a00\u6700\u521d\u88ab\u8bbe\u8ba1\u65f6\uff0c\u9ad8\u6548\u6027\u5c31\u662f\u8bbe\u8ba1\u8005\u8003\u8651\u7684\u4e00\u4e2a\u4e3b\u8981\u56e0\u7d20\u3002\u56e0\u6b64 C \u6807\u51c6\u59d4\u5458\u4f1a\u5728\u8003\u8651\u8bed\u8a00\u8bbe\u8ba1\u65f6\uff0c\u4f1a\u53c2\u8003\u6765\u81ea\u4e8e\u5e95\u5c42\u786c\u4ef6\u4f53\u7cfb\u7684\u67d0\u4e9b\u56e0\u7d20\u3002\u6bd4\u5982\uff0cC \u6807\u51c6\u4e2d\u89c4\u5b9a\uff0cint \u7c7b\u578b\u7684\u5927\u5c0f\u4e3a\u6267\u884c\u73af\u5883\u67b6\u6784\u4f53\u7cfb\u6240\u5efa\u8bae\u7684\u81ea\u7136\u5927\u5c0f\u3002</p> <p>\u6240\u8c13\u81ea\u7136\u5927\u5c0f\uff0c\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\uff1a\u5bf9\u4e8e\u8be5\u5927\u5c0f\u7684\u6570\u636e\uff0c\u786c\u4ef6\u4f53\u7cfb\u80fd\u591f\u4ee5\u6700\u9ad8\u7684\u6548\u7387\u8fdb\u884c\u5904\u7406\u3002\u56e0\u6b64\uff0c\u786c\u4ef6\u4f53\u7cfb\u4e0d\u540c\uff0c\u5bf9\u5e94\u7684\u81ea\u7136\u5927\u5c0f\u4fbf\u4e5f\u4e0d\u540c\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u540c\u4e00\u79cd C \u53d8\u91cf\u7c7b\u578b\u5728\u4e0d\u540c\u786c\u4ef6\u4f53\u7cfb\u4e0a\u53ef\u80fd\u4f1a\u6709\u7740\u4e0d\u540c\u7684\u5927\u5c0f\u3002</p> <p>\u800c\u5bf9\u4e8e Rust \u548c Java \u8fd9\u4e9b\u8bed\u8a00\u6765\u8bf4\uff0c\u5b83\u4eec\u7684\u8bed\u8a00\u6807\u51c6\u4e2d\u76f4\u63a5\u89c4\u5b9a\u4e86\u5404\u7c7b\u578b\u7684\u5177\u4f53\u5927\u5c0f\u3002\u7f16\u8bd1\u5668\u4f5c\u4e3a\u7f16\u7a0b\u8bed\u8a00\u4e0e\u786c\u4ef6\u4f53\u7cfb\u4e4b\u95f4\u7684\u62bd\u8c61\u5c42\uff0c\u5b83\u53ef\u4ee5\u786e\u4fdd\u4e0a\u5c42\u7c7b\u578b\u5728\u88ab\u7f16\u8bd1\u5230\u673a\u5668\u6307\u4ee4\u65f6\uff0c\u4e0d\u4f1a\u7ed9\u7a0b\u5e8f\u7684\u5b9e\u9645\u8fd0\u884c\u5e26\u6765\u53ef\u89c2\u6d4b\u7684\u5dee\u5f02\u3002\u5f53\u7136\uff0c\u4fdd\u6301\u5b8c\u5168\u4e0d\u53d8\u7684\u7c7b\u578b\u5927\u5c0f\u7684\u4ee3\u4ef7\u662f\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\uff0c\u53ea\u662f\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u8fd9\u90e8\u5206\u5f00\u9500\u5e76\u4e0d\u53ef\u89c2\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_2","title":"\u5e38\u91cf","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u901a\u8fc7\u5185\u8054\u65b9\u5f0f\u76f4\u63a5\u5199\u5230\u6e90\u4ee3\u7801\u4e2d\u7684\u5b57\u9762\u91cf\u503c\u4e00\u822c\u88ab\u79f0\u4e3a\u201c\u5e38\u91cf\u201d\u3002</p> <p>\u6211\u4eec\u5728\u524d\u9762\u63d0\u5230\u8fc7\u5e38\u91cf\u7684\u4e00\u4e2a\u6027\u8d28\uff0c\u5373\u201c\u5b83\u4eec\u88ab\u5b9a\u4e49\u540e\u65e0\u6cd5\u88ab\u518d\u6b21\u4fee\u6539\u201d\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u8fd9\u4e9b\u5e38\u91cf\u6570\u636e\u65e0\u6cd5\u7075\u6d3b\u5730\u88ab\u5f00\u53d1\u8005\u64cd\u63a7\uff0c\u5b83\u4eec\u53ea\u80fd\u5728\u7a0b\u5e8f\u6700\u5f00\u59cb\u51fa\u73b0\u7684\u5730\u65b9\u53d1\u6325\u4f5c\u7528\u3002\u6bd4\u5982\u5728\u524d\u9762\u5b9a\u4e49\u53d8\u91cf\u7684\u4e00\u7cfb\u5217\u4ee3\u7801\u4e2d\uff0c\u51fa\u73b0\u7684 \u201c-10\u201d\u3001\u201c2.0\u201d \u7b49\u6570\u5b57\u503c\u4fbf\u662f\u5e38\u91cf\u3002\u8fd9\u4e9b\u503c\u5728\u88ab\u62f7\u8d1d\u5e76\u8d4b\u503c\u7ed9\u76f8\u5e94\u7684\u53d8\u91cf\u540e\u4fbf\u7ed3\u675f\u4e86\u4f7f\u547d\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u53ef\u80fd\u6709\u540c\u5b66\u60f3\u95ee\uff1a\u7528 const \u5173\u952e\u5b57\u6309\u7167\u4e0e\u5b9a\u4e49\u53d8\u91cf\u76f8\u540c\u8bed\u6cd5\u5b9a\u4e49\u7684\u91cf\uff0c\u4e0d\u4e5f\u662f\u5e38\u91cf\u5417\uff1f\u5b83\u4e0e\u5b57\u9762\u91cf\u5e38\u91cf\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u95ee\u9898\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u6309\u7167\u4e0b\u9762\u7684\u65b9\u5f0f\u4f7f\u7528 const \u5173\u952e\u5b57\uff1a</p> <pre><code>const int vx = 10;\nconst int* px = &amp;vx;\n</code></pre> <p>\u901a\u5e38\u6765\u8bf4\uff0c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u4f7f\u7528 const \u5173\u952e\u5b57\u4fee\u9970\u7684\u53d8\u91cf\u5b9a\u4e49\u8bed\u53e5\uff0c\u8868\u793a\u5bf9\u4e8e\u8fd9\u4e9b\u53d8\u91cf\uff0c\u6211\u4eec\u65e0\u6cd5\u5728\u540e\u7eed\u7684\u7a0b\u5e8f\u4e2d\u4fee\u6539\u5176\u5bf9\u5e94\u6216\u6307\u9488\u6307\u5411\u7684\u503c\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u79f0\u5b83\u4eec\u4e3a\u201c\u53ea\u8bfb\u53d8\u91cf\u201d\uff0c\u800c\u975e\u5e38\u91cf\u3002</p> <p>\u5f53\u7136\uff0c\u5728\u7a0b\u5e8f\u7684\u5916\u5728\u8868\u73b0\u4e0a\uff0c\u4e8c\u8005\u6709\u4e00\u70b9\u662f\u76f8\u540c\u7684\uff1a\u5176\u503c\u5728\u7b2c\u4e00\u6b21\u51fa\u73b0\u65f6\u4fbf\u88ab\u786e\u5b9a\uff0c\u4e14\u65e0\u6cd5\u5728\u540e\u7eed\u7a0b\u5e8f\u4e2d\u88ab\u4fee\u6539\u3002</p> <p>\u53ea\u8bfb\u53d8\u91cf\u4e0e\u5b57\u9762\u91cf\u5e38\u91cf\u7684\u4e00\u4e2a\u6700\u91cd\u8981\u7684\u4e0d\u540c\u70b9\u662f\uff0c\u4f7f\u7528 const \u4fee\u9970\u7684\u53ea\u8bfb\u53d8\u91cf\u4e0d\u5177\u6709\u201c\u5e38\u91cf\u8868\u8fbe\u5f0f\u201d\u7684\u5c5e\u6027\uff0c\u56e0\u6b64\u65e0\u6cd5\u7528\u6765\u8868\u793a\u5b9a\u957f\u6570\u7ec4\u5927\u5c0f\uff0c\u6216\u4f7f\u7528\u5728 case \u8bed\u53e5\u4e2d\u3002</p> <p>\u5e38\u91cf\u8868\u8fbe\u5f0f\u672c\u8eab\u4f1a\u5728\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u88ab\u6c42\u503c\uff0c\u800c\u53ea\u8bfb\u53d8\u91cf\u7684\u503c\u53ea\u80fd\u591f\u5728\u7a0b\u5e8f\u5b9e\u9645\u8fd0\u884c\u65f6\u624d\u88ab\u5f97\u77e5\u3002</p> <p>\u5e76\u4e14\uff0c\u7f16\u8bd1\u5668\u901a\u5e38\u4e0d\u4f1a\u5bf9\u53ea\u8bfb\u53d8\u91cf\u8fdb\u884c\u5185\u8054\u5904\u7406\uff0c\u56e0\u6b64\u5176\u6c42\u503c\u4e0d\u7b26\u5408\u5e38\u91cf\u8868\u8fbe\u5f0f\u7684\u7279\u5f81\u3002</p> <pre><code>// \u8bef\u7528\u53ea\u8bfb\u53d8\u91cf\u548c\u5e38\u91cf\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u9519\u8bef\uff0c\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u5c55\u793a\u4e86\u8fd9\u7c7b\u9519\u8bef\n#include &lt;stdio.h&gt;\nint main(void) {\n  const int vx = 10;\n  const int vy = 10;\n  int arr[vx] = {1, 2, 3};  // [\u9519\u8bef1] \u4f7f\u7528\u975e\u5e38\u91cf\u8868\u8fbe\u5f0f\u5b9a\u4e49\u5b9a\u957f\u6570\u7ec4\uff1b\n  switch(vy) {\n    case vx: {  // [\u9519\u8bef2] \u975e\u5e38\u91cf\u8868\u8fbe\u5f0f\u5e94\u7528\u4e8e case \u8bed\u53e5\uff1b\n      printf(\"Value matched!\");\n      break;\n    }\n  }\n}\n</code></pre>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#-","title":"\u6570\u636e\u5b58\u50a8\u5f62\u5f0f - \u8865\u7801","text":"<p>\u4e0a\u9762\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u6570\u636e\u5728\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684\u4f53\u73b0\u65b9\u5f0f\uff0c\u8fd9\u662f\u7a0b\u5e8f\u5458\u80fd\u591f\u63a5\u89e6\u5230\u6570\u636e\u7684\u6700\u521d\u4f4d\u7f6e\u3002\u968f\u7740\u6e90\u4ee3\u7801\u88ab\u7f16\u8bd1\uff0c\u6570\u636e\u7684\u5b9e\u9645\u4f7f\u7528\u5f62\u5f0f\u5f00\u59cb\u53d8\u5f97\u4e0d\u900f\u660e\u8d77\u6765\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u4e00\u8d77\u770b\u770b\uff0c\u5728\u8ba1\u7b97\u673a\u5185\u90e8\uff0c\u6570\u636e\u662f\u4ee5\u600e\u6837\u7684\u5f62\u5f0f\u88ab\u5b58\u653e\u7684\u3002</p> <p>\u5bf9\u4e8e\u5927\u591a\u6570\u8ba1\u7b97\u673a\u800c\u8a00\uff0c\u901a\u5e38\u5176\u5185\u90e8\u4f1a\u4f7f\u7528\u8865\u7801\uff08Two\u2019s-complement\uff09\u7684\u683c\u5f0f\u6765\u5b58\u653e\u6709\u7b26\u53f7\u6574\u6570\uff0c\u4f7f\u7528\u76f4\u63a5\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u4f4d\u683c\u5f0f\u6765\u5b58\u653e\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u4f7f\u7528 IEEE-754 \u6807\u51c6\u7f16\u7801\u683c\u5f0f\u6765\u5b58\u653e\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662f\u5c0f\u6570\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u8ba1\u7b97\u673a\u5728\u770b\u5f85\u6570\u636e\u65f6\uff0c\u5e76\u4e0d\u4f1a\u533a\u5206\u5176\u7b26\u53f7\u6027\uff0c\u800c\u7b26\u53f7\u6027\u7684\u5dee\u5f02\u4ec5\u4f53\u73b0\u5728\u8ba1\u7b97\u673a\u6307\u4ee4\u64cd\u4f5c\u6570\u636e\u65f6\u7684\u5177\u4f53\u4f7f\u7528\u65b9\u5f0f\u4e0a\u3002</p> <p>\u4e00\u4e2a\u8865\u7801\u6240\u8868\u793a\u7684\u5b9e\u9645\u6570\u503c\uff0c\u7531\u5176\u8d1f\u6743\u91cd\u4f4d\u7684\u503c\u4e0e\u6b63\u6743\u91cd\u4f4d\u7684\u503c\u6c42\u548c\u800c\u6765\uff0c\u5176\u4e2d\u8d1f\u6743\u91cd\u4f4d\u5bf9\u5e94\u4e8e\u6700\u9ad8\u6709\u6548\u4f4d\uff08MSB\uff09\u7684\u7b26\u53f7\u4f4d\uff0c\u5373\u8be5\u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\u5728\u8ba1\u7b97\u65f6\u6309\u8d1f\u503c\u7d2f\u52a0\u3002\u5176\u4f59\u5404\u4f4d\u4e00\u8d77\u5bf9\u5e94\u6b63\u6743\u91cd\u4f4d\uff0c\u5373\u8fd9\u4e9b\u4f4d\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u503c\u5728\u8ba1\u7b97\u65f6\u6309\u6b63\u503c\u7d2f\u52a0\u3002\u90a3\u5177\u4f53\u8be5\u600e\u6837\u8ba1\u7b97\u5462\uff1f\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u7ec4\u8865\u7801 \u201c1101\u201d\uff0c\u90a3\u4e48\u5e94\u8be5\u5982\u4f55\u5f97\u5230\u5b83\u5bf9\u5e94\u7684\u6709\u7b26\u53f7\u6574\u6570\u503c\u5462\uff1f\u6309\u7167\u987a\u5e8f\uff0c\u6211\u4eec\u9996\u5148\u8ba1\u7b97\u5f97\u5230\u8be5\u8865\u7801\u5bf9\u5e94\u8d1f\u6743\u91cd\u4f4d\u7684\u503c\u4e3a -8\uff0c\u800c\u6b63\u6743\u91cd\u4f4d\u7684\u503c\u4e3a 5\uff0c\u56e0\u6b64\u8be5\u8865\u7801\u5bf9\u5e94\u7684\u5b9e\u9645\u503c\u4e3a -3\uff08-8+5\uff09\u3002\u5177\u4f53\u8ba1\u7b97\u6b65\u9aa4\u53ef\u4ee5\u53c2\u8003\u4e0b\u56fe\uff08\u56fe\u4e2d\u7684 B2T \u8868\u793a \u201cBinary to Two\u2019s-complement\u201d\uff0c\u5373\u201c\u4e8c\u8fdb\u5236\u8f6c\u8865\u7801\u201d\uff09\uff1a</p> <p></p> <p>\u5728\u8ba1\u7b97\u8d1f\u6743\u91cd\u4f4d\u65f6\uff0c\u5176\u6743\u91cd\u5e94\u53d6\u8d1f\u503c\uff0c\u6b63\u6743\u91cd\u4f4d\u53d6\u6b63\u503c\u3002\u901a\u8fc7\u4e0a\u9762\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\uff0c\u5bf9\u4e8e\u4e00\u4e2a 4 \u4f4d\u8865\u7801\uff0c\u5b83\u53ef\u4ee5\u8868\u793a\u7684\u6700\u5927\u503c\u4e0e\u6700\u5c0f\u503c\u5206\u522b\u662f\u591a\u5c11\u3002\u8ba1\u7b97\u6700\u5927\u503c\u65f6\uff0c\u7b26\u53f7\u4f4d\u7f6e 0\uff0c\u5176\u4ed6\u4f4d\u5747\u7f6e 1\uff0c\u53ef\u4ee5\u5f97\u5230\u80fd\u8868\u793a\u7684\u6700\u5927\u503c 7\u3002\u8ba1\u7b97\u6700\u5c0f\u503c\u65f6\uff0c\u7b26\u53f7\u4f4d\u7f6e 1\uff0c\u5176\u4ed6\u4f4d\u5747\u7f6e 0\uff0c\u53ef\u4ee5\u5f97\u5230\u6700\u5c0f\u503c -8\u3002\u8d1f\u6574\u6570\u7684\u503c\u53ef\u8868\u793a\u8303\u56f4\u6bd4\u6b63\u6574\u6570\u591a 1 \u4e2a\uff0c\u8fd9\u4e5f\u662f\u6240\u6709\u6709\u7b26\u53f7\u6574\u6570\u7684\u4e00\u4e2a\u91cd\u8981\u7279\u5f81\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u4e86\u89e3\u4e86\u8865\u7801\u7684\u57fa\u672c\u8ba1\u7b97\u65b9\u5f0f\u3002\u90a3\u6211\u8981\u5411\u4f60\u63d0\u51fa\u4e00\u4e2a\u5c0f\u95ee\u9898\uff1a\u8865\u7801\u7684\u82f1\u6587\u540d\u79f0\u662f Two\u2019s-complement \uff0c\u53ef\u76f4\u8bd1\u4e3a\u201c\u5bf9\u6570\u5b57 2 \u7684\u8865\u5145\u201d\uff0c\u90a3\u4e3a\u4ec0\u4e48\u4f1a\u53eb\u8fd9\u4e2a\u540d\u5b57\u5462\uff1f</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u6765\u8ba1\u7b97\u4e00\u4e0b\u6709\u7b26\u53f7\u6574\u6570 3 \u5bf9\u5e94\u7684\u56db\u4f4d\u8865\u7801\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5e8f\u5217 \u201c0011\u201d\u3002\u5c06\u8be5\u4e8c\u8fdb\u5236\u5e8f\u5217\u4e0e\u4e0a\u8ff0 -3 \u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u5e8f\u5217\u76f8\u52a0\uff0c\u901a\u8fc7\u8fdb\u4f4d\u53ef\u4ee5\u5f97\u5230\u5e8f\u5217 \u201c10000\u201d\uff0c\u8be5\u5e8f\u5217\u53ef\u4ee5\u8868\u793a\u65e0\u7b26\u53f7\u6b63\u6574\u6570 16\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u975e\u8d1f\u6570 x\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 2<sup>w</sup> \u2212 x\u6765\u8ba1\u7b97 \u2212x \u7684 w \u4f4d\u8868\u793a\u3002</p> <p>\u5957\u7528\u5728\u4e0a\u8ff0\u7684\u4f8b\u5b50\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u201c\u5728\u56db\u4f4d\u8865\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u975e\u8d1f\u6570 3\uff0c\u53ef\u4ee5\u7528\u65e0\u7b26\u53f7\u6570 13 (\u5373 16\u22123) \u7684\u4f4d\u6a21\u5f0f\u6765\u8868\u793a\u6709\u7b26\u53f7\u6570 -3 \u7684\u4f4d\u6a21\u5f0f\u201d\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u5373\u4e24\u8005\u4f4d\u6a21\u5f0f\u76f8\u540c\u3002\u800c\u8865\u7801\u7684\u82f1\u6587\u540d\u79f0\u6b63\u662f\u5bf9 x\u3001\u2212x \u548c 2w \u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u7684\u603b\u7ed3\u3002**</p> <p>\u6211\u4eec\u5728\u524d\u9762\u63d0\u5230\u8fc7\uff0c\u8ba1\u7b97\u673a\u4e0d\u4f1a\u533a\u5206\u6570\u636e\u7684\u7b26\u53f7\u6027\uff0c\u7b26\u53f7\u6027\u7684\u5dee\u5f02\u4ec5\u7531\u8ba1\u7b97\u673a\u6307\u4ee4\u5982\u4f55\u4f7f\u7528\u6570\u636e\u800c\u5b9a\u3002\u6bd4\u5982\u5728 C \u8bed\u8a00\u4e2d\uff0c\u5f53\u5bf9\u67d0\u7c7b\u578b\u53d8\u91cf\u8fdb\u884c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u65f6\uff0c\u5176\u5e95\u5c42\u5b58\u50a8\u7684\u6570\u636e\u5e76\u4e0d\u4f1a\u53d1\u751f\u5b9e\u8d28\u7684\u53d8\u5316\uff0c\u800c\u4ec5\u662f\u7a0b\u5e8f\u5bf9\u5982\u4f55\u89e3\u8bfb\u8fd9\u90e8\u5206\u6570\u636e\u7684\u65b9\u5f0f\u53d1\u751f\u4e86\u6539\u53d8\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n  signed char x = -10;\n  unsigned char y = (unsigned char)x;\n  printf(\"%d\\n\", y);  // output: 246.\n  return 0;\n}\n</code></pre> <p>\u7a0b\u5e8f\u5728\u8fdb\u884c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u5e95\u5c42\u6570\u636e\u7684\u5b9e\u9645\u5b58\u50a8\u65b9\u5f0f\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u5173\u4e8e\u6570\u636e\u4f7f\u7528\u8fd8\u6709\u4e00\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u95ee\u9898\uff1a\u53d8\u91cf\u7c7b\u578b\u7684\u9690\u5f0f\u8f6c\u6362\uff08Implicit Type Conversion\uff09\u3002</p> <p>C \u8bed\u8a00\u4f5c\u4e3a\u4e00\u79cd\u76f8\u5bf9\u800c\u8a00\u7684\u201c\u5f31\u7c7b\u578b\u201d\u8bed\u8a00\uff0c\u5176\u4e00\u5927\u7279\u5f81\u5c31\u662f\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u53d8\u91cf\u7684\u5b9e\u9645\u7c7b\u578b\u4f1a\u53d1\u751f\u9690\u5f0f\u8f6c\u6362\u3002</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n  int x = -10;\n  unsigned int y = 1;\n  if (x &lt; y) {\n    printf(\"x is smaller than y.\");\n  } else {\n    printf(\"x is bigger than y.\");   // this branch is picked!\n  }\n  return 0;\n}\n</code></pre> <p>\u5728\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b9a\u4e49\u7684\u4e24\u4e2a\u53d8\u91cf x \u4e0e y \u5206\u522b\u4e3a\u6709\u7b26\u53f7\u6574\u6570\u548c\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u4e14\u53d8\u91cf x \u7684\u503c\u660e\u663e\u5c0f\u4e8e\u53d8\u91cf y\uff0c\u4f46\u7a0b\u5e8f\u5728\u5b9e\u9645\u8fd0\u884c\u65f6\u5374\u4f1a\u8fdb\u5165\u5230 x &gt;= y \u7684\u5206\u652f\u4e2d\uff0c\u8fd9\u5c31\u662f\u56e0\u4e3a\u53d1\u751f\u4e86\u53d8\u91cf\u7c7b\u578b\u7684\u9690\u5f0f\u8f6c\u6362\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u7a0b\u5e8f\u903b\u8f91\u5728\u771f\u6b63\u8fdb\u5165\u5230\u6761\u4ef6\u8bed\u53e5\u4e4b\u524d\uff0c\u53d8\u91cf x \u7684\u7c7b\u578b\u4f1a\u9996\u5148\u88ab\u9690\u5f0f\u8f6c\u6362\u4e3a unsigned int \uff0c\u5373\u65e0\u7b26\u53f7\u6574\u578b\u3002</p> <p>\u800c\u6839\u636e\u6570\u636e\u7c7b\u578b\u7684\u89e3\u91ca\u89c4\u5219\uff0c\u539f\u5148\u5b58\u653e\u6709 -10 \u8865\u7801\u7684\u4f4d\u6a21\u5f0f\u4f1a\u88ab\u89e3\u91ca\u4e3a\u4e00\u4e2a\u5341\u5206\u5e9e\u5927\u7684\u6b63\u6574\u6570\uff0c\u800c\u8fd9\u4e2a\u6570\u5219\u8fdc\u8fdc\u5927\u4e8e 1\u3002</p> <ol> <li> <p>\u6574\u6570\u63d0\u5347\uff08Integer Promotion\uff09\uff1a</p> </li> <li> <p>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>int</code>\u3001<code>unsigned int</code>\u6216<code>char</code>\uff0c\u800c\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned int</code>\uff0c\u5219\u4f1a\u5c06<code>char</code>\u6216<code>int</code>\u7c7b\u578b\u7684\u64cd\u4f5c\u6570\u8f6c\u6362\u4e3a<code>unsigned int</code>\u7c7b\u578b\u3002</p> </li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>int</code>\uff0c\u800c\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned long</code>\uff0c\u5219\u4f1a\u5c06<code>int</code>\u7c7b\u578b\u7684\u64cd\u4f5c\u6570\u8f6c\u6362\u4e3a<code>unsigned long</code>\u7c7b\u578b\u3002</li> </ol> <pre><code>char c = 10;\nunsigned int ui = 20;\nunsigned int result = c + ui; // char\u7c7b\u578b\u7684c\u4f1a\u88ab\u63d0\u5347\u4e3aunsigned int\u7c7b\u578b\n</code></pre> <ol> <li> <p>\u7b97\u672f\u8f6c\u6362\uff08Usual Arithmetic Conversion\uff09\uff1a</p> </li> <li> <p>\u5f53\u8868\u8fbe\u5f0f\u4e2d\u5305\u542b\u4e0d\u540c\u7c7b\u578b\u7684\u64cd\u4f5c\u6570\u65f6\uff0c\u4f1a\u6839\u636e\u4ee5\u4e0b\u89c4\u5219\u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a\u540c\u4e00\u7c7b\u578b\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>long double</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>long double</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>double</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>double</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>float</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>float</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned long</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>unsigned long</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>long</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>long</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned int</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>unsigned int</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>int</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>int</code>\u3002</li> </ul> </li> </ol> <pre><code>int i = 10;\nfloat f = 3.5;\nfloat result = i + f; // int\u7c7b\u578b\u7684i\u4f1a\u88ab\u8f6c\u6362\u4e3afloat\u7c7b\u578b\n</code></pre> <ol> <li> <p>\u6574\u6570\u8f6c\u6362\uff08Integer Conversion\uff09\uff1a</p> </li> <li> <p>\u5f53\u4e0d\u540c\u7c7b\u578b\u7684\u6574\u6570\u8fdb\u884c\u8fd0\u7b97\u65f6\uff0c\u4f1a\u6839\u636e\u4ee5\u4e0b\u89c4\u5219\u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a\u540c\u4e00\u7c7b\u578b\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned long</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>unsigned long</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>long</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>long</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>unsigned int</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>unsigned int</code>\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u662f<code>int</code>\uff0c\u5219\u53e6\u4e00\u4e2a\u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u4e3a<code>int</code>\u3002</li> </ul> </li> </ol> <pre><code>unsigned int ui = 100;\nlong l = 200;\nlong result = ui + l; // unsigned int\u7c7b\u578b\u7684ui\u4f1a\u88ab\u8f6c\u6362\u4e3along\u7c7b\u578b\n</code></pre> <ol> <li> <p>\u5176\u4ed6\u7c7b\u578b\u8f6c\u6362\uff1a</p> </li> <li> <p>\u5728\u8d4b\u503c\u64cd\u4f5c\u4e2d\uff0c\u5982\u679c\u5c06\u4e00\u4e2a\u503c\u8d4b\u7ed9\u4e00\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u4f1a\u6839\u636e\u76ee\u6807\u53d8\u91cf\u7684\u7c7b\u578b\u8fdb\u884c\u9690\u5f0f\u8f6c\u6362</p> </li> </ol> <p><pre><code>int i = 10;\ndouble d = 3.14;\ndouble result = i + d; // int\u7c7b\u578b\u7684i\u4f1a\u88ab\u8f6c\u6362\u4e3adouble\u7c7b\u578b\n</code></pre> </p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#-ieee-754","title":"\u6570\u636e\u5b58\u50a8\u5f62\u5f0f - IEEE-754","text":"<p>\u6211\u4eec\u4e0a\u9762\u4e3b\u8981\u4ecb\u7ecd\u4e86\u6709\u7b26\u53f7\u6574\u6570\u7684\u8865\u7801\uff0c\u4ee5\u53ca\u5b83\u5728\u548c\u65e0\u7b26\u53f7\u6574\u6570\u4ea4\u4e92\u65f6\u7684\u4e00\u4e9b\u7279\u6027\u3002\u800c\u5bf9\u4e8e\u6d6e\u70b9\u6570\u7c7b\u578b\uff0c\u5927\u591a\u6570\u8ba1\u7b97\u673a\u4f53\u7cfb\u4f1a\u9009\u62e9\u4f7f\u7528 IEEE-754 \u6807\u51c6\uff0c\u4f5c\u4e3a\u5176\u7f16\u7801\u683c\u5f0f\u3002</p> <p>IEEE-754 \u662f\u4e00\u4e2a\u88ab\u4f17\u591a\u786c\u4ef6\u6d6e\u70b9\u8ba1\u7b97\u5355\u5143\uff08FPU\uff09\u91c7\u7528\u7684\u6d6e\u70b9\u6570\u6807\u51c6\uff0c\u8fd9\u4e2a\u6807\u51c6\u89e3\u51b3\u4e86\u6d6e\u70b9\u6570\u5728\u786c\u4ef6\u5b9e\u73b0\u4e0a\u7684\u5f88\u591a\u95ee\u9898\uff0c\u4f7f\u5176\u66f4\u5177\u53ef\u79fb\u690d\u6027\u3002</p> <p>\u5bf9\u4e8e IEEE-754\uff0c\u4e00\u4e2a\u503c\u5f97\u4ecb\u7ecd\u7684\u7279\u70b9\u662f\u5b83\u5bf9\u6d6e\u70b9\u6570\u7684\u5b58\u50a8\u683c\u5f0f\u8bbe\u8ba1\uff0c\u4f7f\u5f97\u8ba1\u7b97\u673a\u53ef\u4ee5\u7b80\u5355\u5730\u4f7f\u7528\u5bf9\u4e8e\u6574\u6570\u7684\u6392\u5e8f\u51fd\u6570\uff0c\u6765\u5bf9\u6d6e\u70b9\u6570\u8fdb\u884c\u6392\u5e8f\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5bf9\u4e8e\u65e0\u7b26\u53f7\u6570\u7684\u4e8c\u8fdb\u5236\u5e8f\u5217\u6765\u8bf4\uff0c0010 \u7684\u503c\u80af\u5b9a\u8981\u5c0f\u4e8e1000 \uff082 &lt; 8\uff09\u3002\u8fd9\u5bf9\u8ba1\u7b97\u673a\u6765\u8bf4\u5f88\u597d\u5224\u65ad\u3002\u800c\u5bf9\u57fa\u4e8e IEEE-754 \u7f16\u7801\u7684 8 \u4f4d\u6d6e\u70b9\u6570\uff084 \u4f4d\u9636\u7801\u4f4d\uff0c3 \u4f4d\u5c0f\u6570\u4f4d\uff09\u4e8c\u8fdb\u5236\u5e8f\u5217 0 0001 001 \u548c 0 1110 111 \u6765\u8bf4\uff0c\u5224\u65ad\u5176\u5927\u5c0f\u4e5f\u540c\u6837\u5341\u5206\u7b80\u5355\u3002\u9664\u53bb\u6700\u5de6\u4fa7\u7684\u7b26\u53f7\u4f4d\u5916\uff0c\u76f4\u63a5\u5c06\u5176\u4f59\u5404\u4f4d\u5f53\u4f5c\u65e0\u7b26\u53f7\u6574\u6570\u5e8f\u5217\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u6240\u5f97\u7ed3\u679c\u540c\u6837\u9002\u7528\u4e8e\u5bf9\u5e94\u7684\u6d6e\u70b9\u6570\u5e8f\u5217\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u540c\u6574\u6570\u4e00\u6837\uff0cC \u8bed\u8a00\u5728\u5bf9\u6d6e\u70b9\u6570\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u65f6\uff08\u65e0\u8bba\u9690\u5f0f\u8fd8\u662f\u663e\u5f0f\uff09\uff0c\u4e5f\u90fd\u4e0d\u4f1a\u5bf9\u5e95\u5c42\u5b58\u653e\u7684\u6d6e\u70b9\u6570\u636e\u8fdb\u884c\u6539\u52a8\uff0c\u800c\u53ea\u662f\u5c06\u5bf9\u5e94\u4f4d\u5e8f\u5217\u7684\u89e3\u91ca\u65b9\u5f0f\u4ece\u6d6e\u70b9\u6570\u6539\u4e3a\u4e86\u5176\u4ed6\u65b9\u5f0f\u3002\u5728 C \u8bed\u8a00\u4e2d\uff0c\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u7c7b\u578b double \u5177\u6709\u4f5c\u4e3a\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u7684\u6700\u9ad8\u4f18\u5148\u7ea7\u3002\u5f53\u5728\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u5b58\u5728\u8be5\u7c7b\u578b\u7684\u53d8\u91cf\u65f6\uff0c\u8ba1\u7b97\u673a\u4f1a\u9996\u5148\u5c06\u5176\u4ed6\u53c2\u4e0e\u53d8\u91cf\u5747\u8f6c\u6362\u4e3a\u8be5\u7c7b\u578b\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8868\u8fbe\u5f0f\u6c42\u503c\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_3","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>C \u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u5e38\u7528\u7c7b\u578b size_t \u901a\u5e38\u88ab\u7528\u5728\u54ea\u4e9b\u5730\u65b9\uff1f\u5b83\u662f\u6574\u6570\u7c7b\u578b\u5417\uff1f\u662f\u6709\u7b26\u53f7\u6570\u8fd8\u662f\u65e0\u7b26\u53f7\u6570\uff1f\u6b22\u8fce\u5728\u8bc4\u8bba\u533a\u7559\u4e0b\u4f60\u7684\u7b54\u6848\u3002</p> <p><code>size_t</code> \u662f C \u8bed\u8a00\u4e2d\u5b9a\u4e49\u5728 <code>&lt;stddef.h&gt;</code> \u5934\u6587\u4ef6\u4e2d\u7684\u7c7b\u578b\uff0c\u901a\u5e38\u7528\u4e8e\u8868\u793a\u5185\u5b58\u5927\u5c0f\u6216\u5bf9\u8c61\u5927\u5c0f\u3002\u5b83\u901a\u5e38\u88ab\u7528\u5728\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li>\u5728\u5904\u7406\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e\u65f6\uff0c<code>size_t</code> \u901a\u5e38\u7528\u4e8e\u8868\u793a\u5185\u5b58\u5757\u7684\u5927\u5c0f\u3002</li> <li>\u5728\u5904\u7406\u6570\u7ec4\u3001\u5b57\u7b26\u4e32\u957f\u5ea6\u7b49\u60c5\u51b5\u4e0b\uff0c<code>size_t</code> \u901a\u5e38\u7528\u4e8e\u8868\u793a\u5bf9\u8c61\u7684\u5927\u5c0f\u6216\u957f\u5ea6\u3002</li> </ol> <p><code>size_t</code> \u662f\u65e0\u7b26\u53f7\u6574\u6570\u7c7b\u578b\uff0c\u5b83\u7684\u5177\u4f53\u5b9e\u73b0\u53d6\u51b3\u4e8e\u7f16\u8bd1\u5668\u548c\u5e73\u53f0\uff0c\u4f46\u901a\u5e38\u88ab\u5b9a\u4e49\u4e3a <code>unsigned int</code> \u6216 <code>unsigned long</code>\u3002\u5b83\u7684\u65e0\u7b26\u53f7\u6027\u8d28\u4f7f\u5f97\u5b83\u53ef\u4ee5\u7528\u6765\u8868\u793a\u975e\u8d1f\u7684\u5927\u5c0f\u6216\u957f\u5ea6\uff0c\u907f\u514d\u4e86\u8d1f\u6570\u7684\u60c5\u51b5\u3002\u5728\u5b9e\u9645\u7f16\u7a0b\u4e2d\uff0c\u4f7f\u7528 <code>size_t</code> \u53ef\u4ee5\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u79fb\u690d\u6027\u548c\u5b89\u5168\u6027\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#02","title":"02\uff5c\u8ba1\u7b97\u5355\u5143\uff1a\u8fd0\u7b97\u7b26\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>C\u8bed\u8a00\u4e2d\u7684\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u5728\u7f16\u8bd1\u5668\u4e2d\u600e\u4e48\u5b9e\u73b0\u7684</p> <p></p> <p>\u5206\u7c7b\uff1a</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_4","title":"\u7b97\u6570\u3001\u5173\u7cfb\u3001\u4f4d\u3001\u8d4b\u503c\u8fd0\u7b97\u7b26\u7b97\u6570","text":"<p>\u7b97\u6570\u3001\u5173\u7cfb\u3001\u4f4d\u3001\u8d4b\u503c\u8fd9\u56db\u7c7b\u8fd0\u7b97\u7b26\u5728\u7ecf\u8fc7\u7f16\u8bd1\u5668\u5904\u7406\u540e\uff0c\u4e00\u822c\u90fd\u53ef\u4ee5\u76f4\u63a5\u5bf9\u5e94\u5230\u7531\u76ee\u6807\u5e73\u53f0\u4e0a\u76f8\u5e94\u673a\u5668\u6307\u4ee4\u7ec4\u6210\u7684\u7b80\u5355\u8ba1\u7b97\u903b\u8f91\u3002</p> <p>\u5728\u4e0b\u9762\u8fd9\u6bb5\u793a\u4f8b\u4ee3\u7801\u4e2d\uff0c</p> <p>\u5728 foo \u51fd\u6570\u7684\u5185\u90e8\u4f7f\u7528\u5230\u4e86\u52a0\u6cd5\u8fd0\u7b97\u7b26 \u201c+\u201d\u3001\u5927\u4e8e\u8fd0\u7b97\u7b26 \u201c&gt;\u201d\uff0c\u4ee5\u53ca\u6309\u4f4d\u6216\u8fd0\u7b97\u7b26 \u201c|\u201d\u3002</p> <p>\u901a\u8fc7\u53f3\u4fa7\u7684\u8f93\u51fa\u5185\u5bb9\uff0c\u67e5\u770b\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff08\u5373\u4e0d\u4f7f\u7528\u4efb\u4f55\u7f16\u8bd1\u4f18\u5316\uff09\u5de6\u4fa7\u4ee3\u7801\u5bf9\u5e94\u7684\u6c47\u7f16\u7ed3\u679c\u3002</p> <p></p> <ul> <li> <p>\u8fd0\u7b97\uff08\u7ea2\u8272\u6846\uff09</p> <p>\u5de6\u4fa7\u4ee3\u7801\u4e2d\u7528\u7ea2\u8272\u6846\u6807\u6ce8\u7684\u5185\u5bb9\uff0c\u4f7f\u7528\u4e86\u52a0\u6cd5\u8fd0\u7b97\u7b26 \u201c+\u201d \u7684 C \u8bed\u53e5\u3002</p> <p>\u5728\u5b83\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u524d\u4e24\u884c\u4ee3\u7801\u5206\u522b\u4ece\u6808\u5185\u5b58\u4e2d\u5c06\u53d8\u91cf x \u4e0e y \u7684\u503c\u653e\u5165\u5230\u4e86\u5bc4\u5b58\u5668 <code>edx</code> \u4e0e <code>eax</code> \u91cc\u3002</p> <p>\u7d27\u63a5\u7740\uff0c\u7a0b\u5e8f\u901a\u8fc7 add \u673a\u5668\u6307\u4ee4\u8ba1\u7b97\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u5b57\u4e4b\u548c\u3002\u968f\u540e\uff0c\u901a\u8fc7 mov \u6307\u4ee4\uff0c\u7a0b\u5e8f\u5c06\u8ba1\u7b97\u5f97\u5230\u7684\u7ed3\u679c\u503c\u4ece\u5bc4\u5b58\u5668 <code>eax</code> \u79fb\u52a8\u5230\u4e86\u5c40\u90e8\u53d8\u91cf <code>arithmetic</code> \u5bf9\u5e94\u7684\u6808\u5185\u5b58\u4e2d\u3002\u81f3\u6b64\uff0c\u8fd9\u884c C \u4ee3\u7801\u4fbf\u6267\u884c\u7ed3\u675f\u4e86\u3002</p> <ul> <li> <p>\u603b\u7ed3</p> <p>\u8fd9\u884c C \u5305\u542b\u4e86\u5bf9\u7b97\u6570\u8fd0\u7b97\u7b26 \u201c+\u201d \u548c\u8d4b\u503c\u8fd0\u7b97\u7b26 \u201c=\u201d \u7684\u4f7f\u7528\u8fc7\u7a0b\uff0c\u7565\u5e26\u5185\u5b58\u8bbf\u95ee</p> <p>add \u6c47\u7f16\u6307\u4ee4\u76f4\u63a5\u5bf9\u5e94\u4e8e C \u4ee3\u7801\u4e2d\u52a0\u6cd5\u8fd0\u7b97\u7b26\u7684\u64cd\u4f5c\u3002</p> <p>mov \u6c47\u7f16\u6307\u4ee4\u5219\u5bf9\u5e94\u4e8e\u7b49\u53f7\u8d4b\u503c\u8fd0\u7b97\u7b26\u7684\u64cd\u4f5c\u3002(Intel \u6c47\u7f16)</p> <p>\u6d89\u53ca\u67d0\u4e2a\u5177\u4f53\u5185\u5b58\u4f4d\u7f6e\uff1a<code>DWORD PTR [rbp-8]</code> </p> <p>\u5c06\u5bc4\u5b58\u5668 <code>rbp</code> \u4e2d\u7684\u503c\u51cf\u53bb 8 \u5f97\u5230\u7684\u7ed3\u679c\u4f5c\u4e3a\u4e00\u4e2a\u5730\u5740\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u5730\u5740\u4e0a\u8bfb\u53d6 / \u5199\u5165\u5927\u5c0f\u4e3a DWORD \u7684\u503c\u3002</p> <p>\u5728 Intel \u4f53\u7cfb\u4e2d\uff0c\u4e00\u4e2a WORD \u8868\u793a 16 \u4f4d\uff0c\u4e00\u4e2a DWORD \u4e3a 32 \u4f4d\uff0c\u800c\u4e00\u4e2a QWORD \u8868\u793a 64 \u4f4d\u3002</p> </li> </ul> </li> <li> <p>\u5173\u7cfb\u8fd0\u7b97\u7b26\uff08\u7eff\u8272\u6846\uff09</p> <p>\u7eff\u8272\u6846\u6807\u6ce8\u7684\u5173\u7cfb\u8fd0\u7b97\u7b26\u5927\u4e8e\u53f7 \u201c&gt;\u201d \u5bf9\u5e94\u6c47\u7f16\u6307\u4ee4 <code>cmp</code>\u3002</p> <p>\u8fd9\u4e2a\u6307\u4ee4\u5728\u88ab\u6267\u884c\u65f6\uff0c\u4f1a\u9996\u5148\u6bd4\u8f83\u53d8\u91cf x \u4e0e y \u503c\u7684\u5927\u5c0f\uff0c\u5e76\u6839\u636e\u6bd4\u8f83\u7ed3\u679c\uff0c\u52a8\u6001\u8c03\u6574 CPU \u4e0a FLAGS \u5bc4\u5b58\u5668\u4e2d\u7684\u76f8\u5e94\u4f4d\u3002</p> <p>\u590d\u4e60\uff1a\u72b6\u6001\u5bc4\u5b58\u5668</p> <p>FLAGS \u5bc4\u5b58\u5668\u662f\u4e00\u7ec4\u7528\u4e8e\u53cd\u6620\u7a0b\u5e8f\u5f53\u524d\u8fd0\u884c\u72b6\u6001\u7684\u6807\u5fd7\u5bc4\u5b58\u5668\u3002</p> <p></p> <p>\u6c47\u7f16\u6307\u4ee4 <code>cmp</code> \u7684\u4e0b\u4e00\u6761\u6c47\u7f16\u6307\u4ee4 <code>setg</code> \u4fbf\u4f1a\u901a\u8fc7\u67e5\u770b FLAGS \u5bc4\u5b58\u5668\u4e2d\u7684 ZF \u4f4d\u662f\u5426\u4e3a 0\uff0c\u4e14 SF \u4e0e OF \u4f4d\u7684\u503c\u662f\u5426\u76f8\u7b49\uff0c\u6765\u51b3\u5b9a\u5c06\u5bc4\u5b58\u5668 al \u4e2d\u7684\u503c\u7f6e 1\uff0c\u8fd8\u662f\u7f6e 0\u3002</p> <p>\u800cal\u5bc4\u5b58\u5668\u4e2d\u5b58\u653e\u7684\u6570\u5b57\u503c\uff0c\u4fbf\u4e3a\u53d8\u91cf relational \u7684\u6700\u7ec8\u7ed3\u679c\u3002</p> <p>\u4e3e\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\u5047\u8bbe\u8fd9\u91cc\u51fd\u6570 add \u5728\u8c03\u7528\u65f6\u4f20\u5165\u7684\u503c x \u4e3a 3\uff0cy \u4e3a 2\u3002\u90a3\u4e48\uff0c\u5f53 <code>cmp</code> \u6307\u4ee4\u6267\u884c\u65f6\uff0c\u5b83\u9996\u5148\u4f1a\u5728 CPU \u5185\u90e8\u5bf9\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u6570\u8fdb\u884c\u9690\u5f0f\u7684\u51cf\u6cd5\u8fd0\u7b97\uff0c\u8fd0\u7b97\u540e\u5f97\u5230\u7ed3\u679c 1\u3002\u800c ZF\u3001SF\u3001OF \u5728\u8fd9\u91cc\u90fd\u5c06\u88ab\u590d\u4f4d\uff0c\u800c\u590d\u4f4d\u5219\u4ee3\u8868\u7740\u6807\u5fd7\u4f4d\u6240\u8868\u793a\u7684\u72b6\u6001\u4e3a\u5047\u3002\u56e0\u6b64\uff0cFLAGS \u5bc4\u5b58\u5668\u7684\u72b6\u6001\u6ee1\u8db3\u6307\u4ee4 <code>setg</code> \u7684\u7f6e\u4f4d\u6761\u4ef6\uff08ZF=0 \u4e14 SF=OF\uff09\uff0cal \u5bc4\u5b58\u5668\u7684\u503c\u5c06\u88ab\u7f6e 1\u3002</p> </li> <li> <p>\u4f4d\u8fd0\u7b97\u7b26\uff08\u84dd\u8272\u6846\uff09</p> <p>\u84dd\u8272\u6846\u6807\u6ce8\u7684\u6216\u8fd0\u7b97\u7b26 \u201c|\u201d\u3002\u53ef\u4ee5\u5f88\u76f4\u89c2\u5730\u770b\u5230\uff0c\u5b83\u6240\u5bf9\u5e94\u7684\u6c47\u7f16\u6307\u4ee4\u662f or\u3002</p> </li> </ul> <p>\u9488\u5bf9\u4e0a\u8ff0\u8fd9\u51e0\u7c7b\u8fd0\u7b97\u7b26\uff0c\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u5373\u4fbf\u662f\u5728\u5f00\u542f\u4e86\u6700\u9ad8\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7\u7684\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u5b9e\u73b0\u4e0a\u8ff0\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u7684\u57fa\u672c\u903b\u8f91\u4ecd\u7136\u4e0d\u53d8\uff0c\u53ea\u4e0d\u8fc7\u4f1a\u76f8\u5bf9\u51cf\u5c11\u901a\u8fc7\u6808\u5185\u5b58\u8bbf\u95ee\u51fd\u6570\u4f20\u5165\u53c2\u6570\u7684\u8fc7\u7a0b\uff0c\u800c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u9009\u7528\u5bc4\u5b58\u5668\u4f20\u503c\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_5","title":"\u903b\u8f91\u8fd0\u7b97\u7b26","text":"<p>\u5728 C \u6807\u51c6\u4e2d\uff0c\u903b\u8f91\u4e0e\u8fd0\u7b97\u7b26 \u201c&amp;&amp;\u201d \u7684\u8bed\u4e49\u662f\uff1a\u5982\u679c\u5b83\u5de6\u53f3\u4e24\u4fa7\u7684\u64cd\u4f5c\u6570\u90fd\u5177\u6709\u975e\u96f6\u503c\uff0c\u5219\u4ea7\u751f\u8ba1\u7b97\u7ed3\u679c\u503c 1\u3002\u800c\u5982\u679c\u4efb\u4e00\u64cd\u4f5c\u6570\u4e3a 0\uff0c\u5219\u8ba1\u7b97\u7ed3\u679c\u4e3a 0\u3002</p> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c\u6807\u51c6\u8fd8\u89c4\u5b9a\u4e86\u8be5\u8fd0\u7b97\u7b26\u5728\u6267\u884c\u6a21\u578b\u4e2d\u7684\u6c42\u503c\u89c4\u5219\uff1a\u5982\u679c\u901a\u8fc7\u903b\u8f91\u4e0e\u8fd0\u7b97\u7b26\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6570\u7684\u6c42\u503c\u7ed3\u679c\u5c31\u80fd\u786e\u5b9a\u8868\u8fbe\u5f0f\u7684\u503c\uff0c\u5c31\u4e0d\u518d\u9700\u8981\u5bf9\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u6570\u8fdb\u884c\u6c42\u503c\u4e86\uff0c\u8fd9\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u201c\u77ed\u8def\u4e0e\u201d\u3002\u6c47\u7f16\u5b9e\u73b0\uff1a</p> <p></p> <p>\u903b\u8f91\u4e0e\u8fd0\u7b97\u7b26\u5e76\u6ca1\u6709\u53ef\u4e0e\u4e4b\u76f4\u63a5\u5bf9\u5e94\u7684\u6c47\u7f16\u6307\u4ee4\u3002\u5e76\u4e14\uff0c\u4e3a\u4e86\u6ee1\u8db3\u201c\u77ed\u8def\u201d\u8981\u6c42\uff0c\u7f16\u8bd1\u5668\u5728\u975e\u4f18\u5316\u7684\u5b9e\u73b0\u4e2d\u901a\u5e38\u4f1a\u4f7f\u7528\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\uff0c\u6bd4\u5982 je\u3002je \u6307\u4ee4\u4f1a\u5224\u65ad\u5f53\u524d FLAGS \u5bc4\u5b58\u5668\u4e2d\u7684\u6807\u5fd7\u4f4d ZF \u662f\u5426\u4e3a 1\u3002\u82e5\u4e3a 1\uff0c\u5219\u4f1a\u5c06\u7a0b\u5e8f\u6267\u884c\u76f4\u63a5\u8df3\u8f6c\u5230\u7ed9\u5b9a\u6807\u7b7e\u6240\u5728\u5730\u5740\u4e0a\u7684\u6307\u4ee4           \u3002</p> <p>\u4e0a\u56fe\u4e2d\u53f3\u4fa7\u8f93\u51fa\u7684\u6c47\u7f16\u4ee3\u7801\u91cc\uff0c\u7a0b\u5e8f\u4f1a\u6309\u987a\u5e8f\u5c06\u4f4d\u4e8e\u6808\u5185\u5b58\u4e2d\u7684\u53d8\u91cf x \u548c y(\u4e5f\u5c31 \u662f<code>edi</code> \u548c<code>esi</code>) \u7684\u503c\u4e0e\u6570\u503c 0 \u8fdb\u884c\u6bd4\u8f83\u3002\uff08\u4ece\u5de6\u5230\u53f3\u4e00\u4e2a\u4e2a\u6bd4\u8f83\uff09</p> <p>\u82e5\u5176\u4e2d\u7684\u67d0\u4e2a\u6bd4\u8f83\u7ed3\u679c\u76f8\u7b49(\u4e3a0)\uff0c\u7a0b\u5e8f\u6267\u884c\u5c06\u4f1a\u76f4\u63a5\u8df3\u8f6c\u5230\u6807\u7b7e \u201c.L2\u201d \u7684\u6240\u5728\u4f4d\u7f6e\u3002\u5728\u8fd9\u91cc\uff0c\u503c 0 \u4f1a\u88ab\u76f4\u63a5\u653e\u5165\u5bc4\u5b58\u5668 <code>eax</code>\u3002\u800c\u82e5\u53d8\u91cf x \u4e0e y \u7684\u503c\u5224\u65ad\u5747\u4e0d\u6210\u7acb\uff0c\u5219\u503c 1 \u4f1a\u88ab\u653e\u5165\u8be5\u5bc4\u5b58\u5668\u3002\u7d27\u63a5\u7740\uff0c\u6807\u7b7e \u201c.L3\u201d \u4e2d\u7684\u6307\u4ee4\u5c06\u63a5\u7740\u6267\u884c\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u5bc4\u5b58\u5668 <code>eax</code> \u4e2d\u7684\u503c\u5c06\u4f1a\u88ab\u4f5c\u4e3a\u6700\u7ec8\u7ed3\u679c\uff0c\u8d4b\u503c\u7ed9\u53d8\u91cf logical\u3002</p> <p>Q\uff1a\u6807\u7b7e \u201c.L3\u201d \u4e2d\u524d\u4e24\u6761\u6c47\u7f16\u8bed\u53e5\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f</p> <p>\u5f53\u7136\uff0c\u5c31\u903b\u8f91\u4e0e\u8fd0\u7b97\u7b26\u6765\u8bf4\uff0c\u5728\u4f7f\u7528\u9ad8\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7\u65f6\uff0c\u7f16\u8bd1\u5668\u8fd8\u53ef\u80fd\u4f1a\u91c7\u7528\u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u8be5\u8fd0\u7b97\u7b26\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u770b\u5230\u4e86\u65b0\u7684\u6c47\u7f16\u6307\u4ee4\uff1a <code>test</code> \u3001<code>setne</code> \u548c <code>movzx</code> \u3002</p> <pre><code>test    edi, edi  ; edi --&gt; \u53d8\u91cfx --&gt; \u5224\u65adx\u662f\u5426\u4e3a0\nsetne   al\ntest    esi, esi  ; esi --&gt; \u53d8\u91cfy --&gt; \u5224\u65ady\u662f\u5426\u4e3a0\nsetne   sil\nmovzx   esi, sil\nand     esi, eax\n</code></pre> <ul> <li> <p><code>test</code> \u6307\u4ee4\u7684\u6267\u884c\u65b9\u5f0f\u4e0e <code>cmp</code> \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5b83\u4f1a\u5bf9\u4f20\u5165\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570\u505a\u9690\u5f0f\u7684\u201c\u4e0e\u201d\u64cd\u4f5c\uff0c\u800c\u975e\u51cf\u6cd5\u64cd\u4f5c\u3002</p> <p>\u5728\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u6839\u636e\u8ba1\u7b97\u7ed3\u679c\uff0c\u6307\u4ee4\u4f1a\u76f8\u5e94\u5730\u4fee\u6539 FLAGS \u5bc4\u5b58\u5668\u4e0a\u7684 SF\u3001ZF \u4ee5\u53ca PF \u6807\u5fd7\u4f4d\u3002</p> </li> <li> <p><code>setne</code> \u6307\u4ee4\u5219\u4e0e <code>setg</code> \u6307\u4ee4\u7c7b\u4f3c\uff0c\u8be5\u6307\u4ee4\u5c06\u5728 ZF \u4e3a 0 \u65f6\u628a\u4f20\u5165\u7684\u5bc4\u5b58\u5668\u7f6e\u4f4d\uff0c\u5426\u5219\u5c06\u5176\u590d\u4f4d\u3002</p> </li> <li> <p><code>movzx</code> \u6307\u4ee4\u5b9e\u9645\u4e0a\u662f mov \u6307\u4ee4\u7684\u4e00\u79cd\u53d8\u4f53\u3002</p> <p>\u8fd9\u4e2a\u6307\u4ee4\u5c06\u6570\u636e\u4ece\u6e90\u4f4d\u7f6e\u79fb\u52a8\u5230\u76ee\u6807\u4f4d\u7f6e\u540e\uff0c\u4f1a\u540c\u65f6\u5bf9\u76ee\u6807\u4f4d\u7f6e\u4e0a\u7684\u6570\u636e\u8fdb\u884c\u96f6\u6269\u5c55\uff08Zero Extension\uff09\u3002</p> </li> </ul> <p>\u4e86\u89e3\u4e86\u8fd9\u4e9b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u5c1d\u8bd5\u7406\u89e3\u7f16\u8bd1\u5668\u5728\u9ad8\u4f18\u5316\u7b49\u7ea7\u4e0b\u5bf9\u903b\u8f91\u4e0e\u8fd0\u7b97\u7b26\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a</p> <ol> <li>\u9996\u5148\uff0c\u901a\u8fc7 <code>test</code> \u6307\u4ee4\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u5224\u65ad\u53c2\u6570 x \u4e0e y \u662f\u5426\u4e3a\u975e\u96f6\u503c\u3002\u82e5\u4e3a\u975e\u96f6\u503c\uff0c\u5219\u76f8\u5e94\u7684\u5bc4\u5b58\u5668\u4f1a\u88ab\u6307\u4ee4 <code>setne</code> \u7f6e\u4f4d\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5bc4\u5b58\u5668 <code>al</code> \u4e0e <code>sil</code> \u4e2d\u4fbf\u5b58\u653e\u6709\u7528\u4e8e\u8868\u793a\u53d8\u91cf x \u4e0e y \u662f\u5426\u4e3a\u96f6\u7684\u5e03\u5c14\u6570\u5b57\u503c 0 \u6216 1\u3002</li> <li>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u6570\u636e\u79fb\u52a8\u6307\u4ee4\uff0c\u5bc4\u5b58\u5668 <code>sil</code> \u4e2d\u7684\u503c\u88ab\u79fb\u52a8\u5230\u5bc4\u5b58\u5668 <code>esi</code> \u4e2d\u3002</li> <li>\u6700\u540e\u7684 <code>and</code> \u6307\u4ee4\u53c8\u4f1a\u5bf9 x \u4e0e y \u7684\u5e03\u5c14\u6570\u5b57\u503c\u518d\u6b21\u8fdb\u884c\u4e0e\u64cd\u4f5c\uff0c\u5f97\u5230\u7684\u6700\u7ec8\u7ed3\u679c\u5c06\u88ab\u5b58\u653e\u5728\u76ee\u7684\u5bc4\u5b58\u5668\uff0c\u5373 <code>esi</code> \u4e2d\u3002</li> </ol> <p>\u4e0a\u9762\u8fd9\u79cd\u4f18\u5316\u5b9e\u73b0\u65b9\u5f0f\u5927\u91cf\u51cf\u5c11\u4e86\u5bf9\u6808\u5185\u5b58\u4ee5\u53ca\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u4f7f\u7528\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u51cf\u5c11\u4e86\u8bbf\u95ee\u5185\u5b58\u65f6\u4ea7\u751f\u7684\u5ef6\u8fdf\uff0c\u4ee5\u53ca\u7531\u4e8e\u5206\u652f\u9884\u6d4b\u5931\u8d25\u800c\u5bfc\u81f4\u7684 CPU \u5468\u671f\u6d6a\u8d39\uff0c\u4ece\u800c\u6267\u884c\u6027\u80fd\u5f97\u5230\u4e86\u63d0\u5347\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0c\u5728\u4f7f\u7528\u9ad8\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7\u7684\u60c5\u51b5\u4e0b\uff0cC \u6807\u51c6\u4e2d\u903b\u8f91\u4e0e\u64cd\u4f5c\u7b26\u7684\u201c\u77ed\u8def\u201d\u7279\u6027\u5e76\u6ca1\u6709\u4f53\u73b0\u51fa\u6765\uff0c\u7a0b\u5e8f\u5b9e\u9645\u4e0a\u540c\u65f6\u5bf9\u53c2\u6570 x \u4e0e y \u7684\u503c\u8fdb\u884c\u4e86\u5224\u65ad\u3002\u800c\u8fd9\u4e5f\u6b63\u662f\u56e0\u4e3a C \u8bed\u8a00\u7684 \u201cas-if\u201d \u6027\u8d28\u7ed9\u4e88\u4e86\u7f16\u8bd1\u5668\u66f4\u591a\u7684\u4f18\u5316\u7a7a\u95f4\u3002</p> <p>C \u6807\u51c6\u4e2d\u89c4\u5b9a\uff0c\u9664\u53bb\u51e0\u79cd\u7279\u6b8a\u7684\u60c5\u51b5\u5916\uff0c\u5728\u4e0d\u5f71\u54cd\u4e00\u4e2a\u7a0b\u5e8f\u7684\u5916\u90e8\u53ef\u89c2\u6d4b\u884c\u4e3a\u7684\u60c5\u51b5\u4e0b\uff0c</p> <p>\u7f16\u8bd1\u5668\u53ef\u4ee5\u4e0d\u9075\u5faa C \u6807\u51c6\u4e2d\u5bf9\u6267\u884c\u6a21\u578b\u7684\u89c4\u5b9a\uff0c\u800c\u662f\u91c7\u7528\u5176\u7279\u5b9a\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4f18\u5316\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> <p>\u5728\u975e\u4f18\u5316\u7248\u672c\u7684\u5b9e\u73b0\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f7f\u7528\u4e86 je \u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u3002</p> <p>\u5176\u5b9e\uff0c\u73b0\u4ee3\u6d41\u6c34\u7ebf CPU \u901a\u5e38\u4f1a\u91c7\u7528\u4e00\u79cd\u540d\u4e3a \u201c\u6295\u673a\u6267\u884c\u201d\u00a0 \u7684\u65b9\u5f0f\u6765\u4f18\u5316\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u7684\u6267\u884c\u3002</p> <p>\u6240\u8c13\u6295\u673a\u6267\u884c\uff0c\u662f\u6307 CPU \u4f1a\u901a\u8fc7\u5206\u6790\u5386\u53f2\u7684\u5206\u652f\u6267\u884c\u60c5\u51b5\uff0c\u6765\u63a8\u6d4b\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u5c06\u4f1a\u6267\u884c\u7684\u5206\u652f\uff0c\u5e76\u63d0\u524d\u5904\u7406\u6240\u9884\u6d4b\u5206\u652f\u4e0a\u7684\u6307\u4ee4\u3002\u800c\u7b49\u5230 CPU \u53d1\u73b0\u4e4b\u524d\u6240\u9884\u6d4b\u7684\u5206\u652f\u662f\u9519\u8bef\u7684\u65f6\u5019\uff0c\u5b83\u5c06\u4e0d\u5f97\u4e0d\u4e22\u5f03\u8fd9\u4e2a\u5206\u652f\u4e0a\u6307\u4ee4\u7684\u6240\u6709\u4e2d\u95f4\u5904\u7406\u7ed3\u679c\uff0c\u5e76\u5c06\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u5230\u6b63\u786e\u7684\u5206\u652f\u4e0a\u3002\u5f88\u660e\u663e\uff0c\u8fd9\u6837\u5c31\u4f1a\u6d6a\u8d39\u8f83\u591a\u7684\u65f6\u949f\u5468\u671f\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_6","title":"\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26","text":"<p>\u63a5\u4e0b\u6765\uff0c\u8ba9\u6211\u4eec\u7ee7\u7eed\u6765\u770b\u770b\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26\u3002\u8fd9\u91cc\u6211\u4ee5\u53d6\u5730\u5740\u8fd0\u7b97\u7b26 \u201c&amp;\u201d\u3001\u89e3\u5f15\u7528\u8fd0\u7b97\u7b26 \u201c*\u201d \u4e3a\u4f8b\uff0c\u6765\u4ecb\u7ecd\u7f16\u8bd1\u5668\u5bf9\u5b83\u4eec\u7684\u5b9e\u73b0\u7ec6\u8282\u3002\u6765\u770b\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <p></p> <ul> <li> <p>&amp;</p> <p>\u5982\u4e0a\u56fe\u4e2d\u7ea2\u8272\u6846\u5bf9\u5e94\u7684 C \u4ee3\u7801\u548c\u6c47\u7f16\u4ee3\u7801\u6240\u793a\uff0c\u5bf9\u4e8e\u53d6\u5730\u5740\u8fd0\u7b97\u7b26 \u201c&amp;\u201d\uff0c\u5b9e\u9645\u4e0a\u5b83\u4e00\u822c\u4f1a\u76f4\u63a5\u5bf9\u5e94\u5230\u540d\u4e3a <code>lea</code> \u7684\u6c47\u7f16\u6307\u4ee4\u3002</p> <p>\u8fd9\u4e2a\u6307\u4ee4\u7684\u5168\u79f0\u4e3a \u201cLoad Effective Address\u201d\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4e3b\u8981\u7528\u6765\u5c06\u64cd\u4f5c\u6570\u4f5c\u4e3a\u5730\u5740\uff0c\u5e76\u5c06\u8fd9\u4e2a\u5730\u5740\u4ee5\u503c\u7684\u5f62\u5f0f\u4f20\u9001\u5230\u5176\u4ed6\u4f4d\u7f6e\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 <code>lea</code> \u6307\u4ee4\u5c06\u5bc4\u5b58\u5668 <code>rbp</code> \u4e2d\u7684\u503c\u51cf\u53bb 16 \u540e\uff0c\u76f4\u63a5\u5b58\u653e\u5230\u5bc4\u5b58\u5668 <code>rax</code> \u4e2d\uff0c\u800c\u6b64\u65f6\u8be5\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u5c31\u662f\u5c40\u90e8\u53d8\u91cf n \u5728\u6808\u4e0a\u7684\u5730\u5740\u3002</p> </li> <li> <p>*</p> <p>\u89e3\u5f15\u7528\u8fd0\u7b97\u7b26 \u201c*\u201d\u7684\u884c\u4e3a\u4e0e\u53d6\u5730\u5740\u8fd0\u7b97\u7b26\u5b8c\u5168\u76f8\u53cd\u3002</p> <p>\u5f53\u9700\u8981\u5bf9\u4f4d\u4e8e\u67d0\u4e2a\u5730\u5740\u4e0a\u7684\u503c\u8fdb\u884c\u4f20\u9001\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>mov</code> \u6307\u4ee4\u3002</p> <ol> <li>\u4e0a\u56fe\u4e2d\uff0c\u5728\u84dd\u8272\u6846\u7684\u6c47\u7f16\u4ee3\u7801\u91cc\uff0c\u7b2c\u4e00\u6761 mov \u6307\u4ee4\u5c06\u53d8\u91cf <code>n_ptr</code> \u7684\u503c\u4f20\u9001\u5230\u4e86\u5bc4\u5b58\u5668 <code>rax</code> \u4e2d\u3002\\</li> <li>\u968f\u540e\uff0c\u7b2c\u4e8c\u6761 mov \u6307\u4ee4\u5c06 <code>rax</code> \u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u4f5c\u4e3a\u5730\u5740\uff0c\u5e76\u5c06\u8be5\u5730\u5740\u4e0a\u7684\u503c\u4ee5 DWORD\uff0c\u5373 32 \u4f4d\u503c\uff08\u5bf9\u5e94 int \u7c7b\u578b\uff09\u7684\u5f62\u5f0f\u4f20\u9001\u5230 <code>eax</code> \u5bc4\u5b58\u5668\u4e2d\u3002</li> <li>\u6700\u540e\uff0c\u7b2c\u4e09\u6761 mov \u6307\u4ee4\u5c06\u6b64\u65f6 <code>eax</code> \u5bc4\u5b58\u5668\u4e2d\u7684\u7ed3\u679c\u503c\u4f20\u9001\u5230\u4e86\u53d8\u91cf m \u5728\u6808\u5185\u5b58\u4e0a\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</li> </ol> </li> <li> <p>\u5176\u4ed6</p> <p>\u81f3\u4e8e\u8be5\u7c7b\u522b\u4e0b\u7684\u5176\u4ed6\u8fd0\u7b97\u7b26\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u672c\u8d28\u90fd\u662f\u8bbf\u95ee\u4f4d\u4e8e\u67d0\u4e2a\u5185\u5b58\u5730\u5740\u4e0a\u7684\u6570\u636e\uff0c\u56e0\u6b64\u5b9e\u73b0\u65b9\u5f0f\u5927\u540c\u5c0f\u5f02\u3002</p> <ul> <li> <p>\u5b9e\u8df5\uff1a-&gt;\u7684\u5b9e\u73b0</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt; // \u5305\u542b\u52a8\u6001\u5185\u5b58\u5206\u914d\u6240\u9700\u7684\u5934\u6587\u4ef6\n\nstruct person\n{\n    char name[100];\n    int number;\n    int *p;\n};\n\nint main(void)\n{\n    struct person *p1;\n    int a = 3;\n\n    // \u5206\u914d\u5185\u5b58\u7ed9p1\n    p1 = (struct person*)malloc(sizeof(struct person));\n\n    strcpy(p1-&gt;name, \"hello\");\n    p1-&gt;number = 100;\n    p1-&gt;p = &amp;a;\n    printf(\"%s\\n\", p1-&gt;name);\n    printf(\"%d\\n\", p1-&gt;number);\n    printf(\"%d\\n\", *(p1-&gt;p));\n\n    // \u91ca\u653e\u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\n    free(p1);\n\n    return 0;\n}\n</code></pre> <pre><code>objdump -S ./a.out:\n\u5176\u4e2d\u4e00\u90e8\u5206:\nstrcpy(p1-&gt;name, \"hello\");\n    11f9: 48 8b 45 f0             mov    -0x10(%rbp),%rax\n    11fd: c7 00 68 65 6c 6c       movl   $0x6c6c6568,(%rax)\n    1203: 66 c7 40 04 6f 00       movw   $0x6f,0x4(%rax)\n    p1-&gt;number = 100;\n    1209: 48 8b 45 f0             mov    -0x10(%rbp),%rax\n    120d: c7 40 64 64 00 00 00    movl   $0x64,0x64(%rax)\n    p1-&gt;p = &amp;a;\n    1214: 48 8b 45 f0             mov    -0x10(%rbp),%rax\n    1218: 48 8d 55 ec             lea    -0x14(%rbp),%rdx\n    121c: 48 89 50 68             mov    %rdx,0x68(%rax)\n</code></pre> <p>\u5bf9\u4e8e\u7ed3\u6784\u4f53\u6307\u9488<code>p1</code>\u7684\u6210\u5458\u8d4b\u503c\u64cd\u4f5c\uff0c\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684<code>mov</code>\u6307\u4ee4\u7528\u4e8e\u5c06\u6570\u636e\u5b58\u50a8\u5230\u76f8\u5e94\u7684\u5185\u5b58\u4f4d\u7f6e\u3002\u5177\u4f53\u89e3\u91ca\u5982\u4e0b\uff1a</p> <ol> <li><code>strcpy(p1-&gt;name, \"hello\");</code>\uff1a</li> <li>\u5728\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c<code>movl $0x6c6c6568,(%rax)</code>\u5c06ASCII\u7801\u8868\u793a\u7684\u5b57\u7b26\u4e32\"hello\"\u7684\u503c\u5b58\u50a8\u5230<code>p1-&gt;name</code>\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</li> <li> <p><code>movw $0x6f,0x4(%rax)</code>\u5c06\u5b57\u7b26'o'\u7684ASCII\u7801\u503c\u5b58\u50a8\u5230<code>p1-&gt;name</code>\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5373<code>p1-&gt;name[4]</code>\u3002</p> </li> <li> <p><code>p1-&gt;number = 100;</code>\uff1a</p> </li> <li> <p><code>movl $0x64,0x64(%rax)</code>\u5c06\u6570\u503c100\u5b58\u50a8\u5230<code>p1-&gt;number</code>\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</p> </li> <li> <p><code>p1-&gt;p = &amp;a;</code>\uff1a</p> </li> <li><code>lea -0x14(%rbp),%rdx</code>\u8ba1\u7b97\u51fa\u53d8\u91cf<code>a</code>\u7684\u5730\u5740\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5230\u5bc4\u5b58\u5668<code>%rdx</code>\u4e2d\u3002</li> <li><code>mov %rdx,0x68(%rax)</code>\u5c06\u53d8\u91cf<code>a</code>\u7684\u5730\u5740\u5b58\u50a8\u5230<code>p1-&gt;p</code>\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</li> </ol> <p>\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u7ed3\u6784\u4f53\u7684\u6210\u5458\u662f\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u901a\u8fc7\u504f\u79fb\u91cf\u53ef\u4ee5\u8bbf\u95ee\u7ed3\u6784\u4f53\u7684\u5404\u4e2a\u6210\u5458\u3002\u901a\u8fc7<code>mov</code>\u6307\u4ee4\u53ef\u4ee5\u5c06\u6570\u636e\u5b58\u50a8\u5230\u6307\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u4ece\u800c\u5b9e\u73b0\u5bf9\u7ed3\u6784\u4f53\u6210\u5458\u7684\u8d4b\u503c\u64cd\u4f5c\u3002\u8fd9\u6837\uff0c\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684<code>mov</code>\u6307\u4ee4\u53ef\u4ee5\u5b9e\u73b0C\u4ee3\u7801\u4e2d\u4f7f\u7528<code>-&gt;</code>\u64cd\u4f5c\u7b26\u8bbf\u95ee\u7ed3\u6784\u4f53\u6210\u5458\u7684\u529f\u80fd\u3002</p> </li> <li> <p>\u8865\u5145</p> <p>\u6bb5\u9519\u8bef\uff08Segmentation Fault\uff09\u901a\u5e38\u662f\u7531\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u5f15\u8d77\u7684\uff1a</p> <ol> <li> <p>\u8bbf\u95ee\u672a\u5206\u914d\u7684\u5185\u5b58\uff1a\u5f53\u7a0b\u5e8f\u5c1d\u8bd5\u8bbf\u95ee\u672a\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u6307\u9488\u672a\u521d\u59cb\u5316\u3001\u6307\u9488\u8d8a\u754c\u8bbf\u95ee\u3001\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u5df2\u7ecf\u88ab\u91ca\u653e\u3001\u672a\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u7b49\u60c5\u51b5\u3002</p> </li> <li> <p>\u8bbf\u95ee\u53ea\u8bfb\u5185\u5b58\uff1a\u5c1d\u8bd5\u5411\u53ea\u8bfb\u5185\u5b58\u5730\u5740\u5199\u5165\u6570\u636e\u4e5f\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002\u4f8b\u5982\uff0c\u5c1d\u8bd5\u4fee\u6539\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5185\u5bb9\u5c31\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</p> </li> <li> <p>\u6808\u6ea2\u51fa\uff1a\u5f53\u7a0b\u5e8f\u9012\u5f52\u5c42\u6b21\u8fc7\u6df1\u6216\u8005\u5728\u6808\u4e0a\u5206\u914d\u8fc7\u591a\u7684\u5185\u5b58\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6808\u6ea2\u51fa\uff0c\u4e5f\u53ef\u80fd\u5f15\u8d77\u6bb5\u9519\u8bef\u3002</p> </li> <li> <p>\u8bbf\u95ee\u7a7a\u6307\u9488\uff1a\u5f53\u7a0b\u5e8f\u5c1d\u8bd5\u901a\u8fc7\u7a7a\u6307\u9488\u8bbf\u95ee\u5185\u5b58\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002\u7a7a\u6307\u9488\u662f\u6307\u672a\u6307\u5411\u4efb\u4f55\u6709\u6548\u5185\u5b58\u5730\u5740\u7684\u6307\u9488\u3002</p> </li> <li> <p>\u975e\u6cd5\u6307\u4ee4\uff1a\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u975e\u6cd5\u6307\u4ee4\u6216\u8005\u8bd5\u56fe\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5141\u8bb8\u7684\u64cd\u4f5c\u4e5f\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</p> </li> <li> <p>\u5185\u5b58\u5bf9\u9f50\u95ee\u9898\uff1a\u67d0\u4e9b\u4f53\u7cfb\u7ed3\u6784\u8981\u6c42\u6570\u636e\u6309\u7167\u7279\u5b9a\u7684\u5b57\u8282\u5bf9\u9f50\uff0c\u5982\u679c\u8fdd\u53cd\u4e86\u8fd9\u4e9b\u8981\u6c42\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</p> </li> </ol> </li> </ul> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_7","title":"\u5176\u4ed6\u8fd0\u7b97\u7b26","text":"<p>\u6700\u540e\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u770b\u9664\u4e86\u4e0a\u9762\u90a3\u516d\u7c7b\u8fd0\u7b97\u7b26\u4e4b\u5916\u7684\u5176\u4ed6\u8fd0\u7b97\u7b26\uff0c\u8fd9\u91cc\u6211\u4e3b\u8981\u4ecb\u7ecd <code>sizeof</code> \u8fd0\u7b97\u7b26\u548c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26 \u201c(type) a\u201d\u3002</p> <p>\u81f3\u4e8e\u51fd\u6570\u8c03\u7528\u8fd0\u7b97\u7b26\uff0c\u7531\u4e8e\u5185\u5bb9\u8f83\u591a\uff0c\u6211\u4f1a\u5728\u540e\u7eed\u7684\u8bfe\u7a0b\u518d\u5355\u72ec\u4e3a\u4f60\u4ecb\u7ecd\u3002\u6211\u4eec\u8fd8\u662f\u901a\u8fc7\u4e00\u6bb5\u793a\u4f8b\u4ee3\u7801\uff0c\u89c2\u5bdf\u5b83\u4eec\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7684\u6c47\u7f16\u5b9e\u73b0\uff1a</p> <p></p> <ul> <li> <p><code>sizeof</code></p> <p>\u5176\u4e2d\uff0c<code>sizeof</code> \u8fd0\u7b97\u7b26\u662f\u4e00\u4e2a\u7f16\u8bd1\u671f\u8fd0\u7b97\u7b26\uff0c\u8fd9\u610f\u5473\u7740\u7f16\u8bd1\u5668\u4ec5\u901a\u8fc7\u9759\u6001\u5206\u6790\u5c31\u80fd\u591f\u5c06\u7ed9\u5b9a\u53c2\u6570\u7684\u5927\u5c0f\u8ba1\u7b97\u51fa\u6765\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u6700\u7ec8\u751f\u6210\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4e0d\u4f1a\u770b\u5230 <code>sizeof</code> \u8fd0\u7b97\u7b26\u5bf9\u5e94\u4e8e\u4efb\u4f55\u6c47\u7f16\u6307\u4ee4\u3002</p> <p>\u76f8\u53cd\uff0c\u8fd0\u7b97\u7b26\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7684\u8ba1\u7b97\u7ed3\u679c\u503c\uff0c\u5c06\u4f1a\u4ee5\u5b57\u9762\u91cf\u503c\u7684\u5f62\u5f0f\u76f4\u63a5\u201c\u5d4c\u5165\u201d\u5230\u6c47\u7f16\u4ee3\u7801\u4e2d\u4f7f\u7528(\u8fd8\u8981\u770b\u5177\u4f53\u786c\u4ef6\u5e73\u53f0)\u3002</p> <p>\u4ece\u4e0a\u56fe\u4e2d\u53f3\u4fa7\u7ea2\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u770b\u5230\uff0cC \u4ee3\u7801 <code>sizeof(int)</code> \u7684\u8ba1\u7b97\u7ed3\u679c 4 \u76f4\u63a5\u4f5c\u4e3a\u4e86 <code>mov</code> \u6307\u4ee4\u7684\u4e00\u4e2a\u64cd\u4f5c\u6570\u3002</p> </li> <li> <p>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26</p> <p>\u5c06\u53d8\u91cf n \u7684\u503c\u7c7b\u578b\u7531\u539f\u6765\u7684 <code>size_t</code> \u8f6c\u6362\u4e3a\u4e86 <code>short</code>\u3002</p> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0a\u56fe\u4e2d\u84dd\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u91cc\u770b\u5230\uff0c\u5f53 mov \u6307\u4ee4\u5c06\u53d8\u91cf n \u7684\u503c\u79fb\u52a8\u5230\u53d8\u91cf f \u6240\u5728\u7684\u5185\u5b58\u533a\u57df\u65f6\uff0c\u5b83\u4ec5\u79fb\u52a8\u4e86\u8fd9\u4e2a\u503c\u4ece\u4f4e\u4f4d\u5f00\u59cb\u4e00\u4e2a WORD(\u5373 16 \u4f4d\u5927\u5c0f)\u7684\u90e8\u5206\u3002</p> <p>\u81f3\u4e8e\u5176\u4ed6\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u6210 \u5bf9\u540c\u4e00\u5757\u6570\u636e\u5728\u4e0d\u540c\u673a\u5668\u6307\u4ee4\u4e0b\u7684\u4e0d\u540c\u201c\u89e3\u8bfb\u201d\u65b9\u5f0f\u3002\uff0c\u5c31\u662f\u53ea\u64cd\u4f5c\u5bc4\u5b58\u5668\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u3010\u62d3\u5c55\u3011</p> <p>RISC\u8fd9\u79cd\u6307\u4ee4\u96c6\u600e\u4e48\u5b9e\u73b0\u4e0a\u9762\u8fd9\u79cd\u8fd0\u7b97\u7b26\u89e3\u8bfb\u7684\u5462\uff1f</p> <p>\u5728ARM\u548cRISC-V\u8fd9\u6837\u7684RISC\uff08Reduced Instruction Set Computing\uff09\u67b6\u6784\u4e2d\uff0c</p> <p>\u901a\u5e38\u4f1a\u4f7f\u7528\u52a0\u8f7d\uff08load\uff09\u548c\u5b58\u50a8\uff08store\uff09\u6307\u4ee4\u6765\u5904\u7406\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362\u3002</p> <p>\u8fd9\u4e9b\u67b6\u6784\u901a\u5e38\u91c7\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u5bc4\u5b58\u5668\uff0c\u4e0d\u50cfx86\u90a3\u6837\u6709\u4e0d\u540c\u5927\u5c0f\u7684\u5bc4\u5b58\u5668\u3002</p> <ol> <li> <p><code>sizeof</code></p> <p><code>sizeof</code> \u8fd9\u79cd\uff0c\u540c\u6837\u5728\u7f16\u8bd1\u671f\u95f4\u4e4b\u95f4\u7b97\u51fa\uff0c\u4e4b\u540e\u76f4\u63a5 <code>mov</code> \u8d4b\u503c</p> </li> <li> <p>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362</p> <p>\u5bf9\u4e8e\u5c06<code>size_t</code>\u7c7b\u578b\u8f6c\u6362\u4e3a<code>short</code>\u7c7b\u578b\u7684\u64cd\u4f5c\uff0c\u5728ARM\u548cRISC-V\u67b6\u6784\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u52a0\u8f7d\u548c\u5b58\u50a8\u6307\u4ee4\u6765\u5b9e\u73b0\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5c06<code>size_t</code>\u7c7b\u578b\u7684\u6570\u636e\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u63a9\u7801\uff08mask\uff09\u548c\u79fb\u4f4d\uff08shift\uff09\u7b49\u64cd\u4f5c\u6765\u63d0\u53d6\u6240\u9700\u7684\u4f4e\u4f4d\u90e8\u5206\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u5b58\u50a8\u5230<code>short</code>\u7c7b\u578b\u7684\u53d8\u91cf\u4e2d\u3002</p> <ul> <li> <p>\u5728ARM\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LDR</code> \u6307\u4ee4\u52a0\u8f7d\u6570\u636e\uff0c\u4f7f\u7528<code>LSR</code>\uff08Logical Shift Right\uff09\u6307\u4ee4\u8fdb\u884c\u53f3\u79fb\u64cd\u4f5c\uff0c\u7136\u540e\u4f7f\u7528<code>STR</code>\u6307\u4ee4\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u76ee\u6807\u5185\u5b58\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u7c7b\u4f3c\u5730\uff0c\u5728RISC-V\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>lw</code>\uff08load word\uff09\u6307\u4ee4\u52a0\u8f7d\u6570\u636e\uff0c\u4f7f\u7528\u4f4d\u64cd\u4f5c\u6307\u4ee4\uff08\u5982<code>SRL</code>\uff09\u8fdb\u884c\u53f3\u79fb\u64cd\u4f5c\uff0c\u6700\u540e\u4f7f\u7528<code>sw</code>\uff08store word\uff09\u6307\u4ee4\u5c06\u7ed3\u679c\u5b58\u50a8\u5230\u76ee\u6807\u5185\u5b58\u4f4d\u7f6e\u3002</p> </li> <li>\u8865\u5145\uff0c\u53ef\u80fd\u7531\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7684\u8d44\u6e90\u6709\u9650\uff0c\u4f1a\u4f7f\u7528flash\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e0a\u9762\u7684\u6307\u4ee4\u5c31\u662f\u5bf9 <code>flash</code> \u8fdb\u884c\u64cd\u4f5c\u4e86</li> </ul> </li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c\u867d\u7136ARM\u548cRISC-V\u67b6\u6784\u4e0ex86\u67b6\u6784\u5728\u6307\u4ee4\u96c6\u548c\u5bc4\u5b58\u5668\u7ed3\u6784\u4e0a\u6709\u6240\u4e0d\u540c\uff0c\u4f46\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u52a0\u8f7d\u3001\u5b58\u50a8\u548c\u4f4d\u64cd\u4f5c\u6307\u4ee4\u6765\u5b9e\u73b0\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362\uff0c\u5305\u62ec\u5bf9<code>size_t</code>\u548c<code>short</code>\u7c7b\u578b\u7684\u8f6c\u6362\u3002</p> </li> </ul> <p>\u5728\u9ad8\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7\u4e0b\uff0c\u4e0a\u9762\u4ecb\u7ecd\u7684\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26\u4e0e\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26\u7684\u5b9e\u73b0\u65b9\u5f0f\u5e76\u6ca1\u6709\u53d1\u751f\u672c\u8d28\u7684\u53d8\u5316\u3002</p> <p>\u800c\u4e0e\u5176\u4ed6\u8fd0\u7b97\u7b26\u7c7b\u4f3c\u7684\u662f\uff0c\u7f16\u8bd1\u5668\u4f1a\u51cf\u5c11\u5bf9\u6808\u5185\u5b58\u7684\u4f7f\u7528\u3002\u540c\u65f6\uff0c\u57fa\u4e8e\u66f4\u5f3a\u7684\u9759\u6001\u5206\u6790\u80fd\u529b\uff0c\u7f16\u8bd1\u5668\u751a\u81f3\u53ef\u4ee5\u63d0\u524d\u63a8\u7b97\u51fa\u67d0\u4e9b\u53d8\u91cf\u7684\u53d6\u503c\uff0c\u5e76\u7701\u53bb\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u518d\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u7684\u8fc7\u7a0b\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u63d0\u5347\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u6027\u80fd\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_8","title":"\u603b\u7ed3","text":"<p>C \u8bed\u8a00\u4e2d\u7684\u51e0\u7c7b\u4e0d\u540c\u8fd0\u7b97\u7b26\u662f\u5982\u4f55\u88ab\u7f16\u8bd1\u5668\u5b9e\u73b0\u7684\u3002\u5177\u4f53\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ol> <li>\u901a\u5e38\u6765\u8bf4\uff0c\u7b97\u6570\u3001\u5173\u7cfb\u3001\u4f4d\u3001\u8d4b\u503c\u8fd0\u7b97\u7b26\u7684\u5b9e\u73b0\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u90fd\u4f1a\u76f4\u63a5\u4e00\u4e00\u5bf9\u5e94\u5230\u7279\u5b9a\u7684\u6c47\u7f16\u6307\u4ee4\u4e0a\uff1b</li> <li>\u903b\u8f91\u8fd0\u7b97\u7b26\u7684\u5b9e\u73b0\u65b9\u5f0f\u5219\u6709\u4e9b\u4e0d\u540c\uff0c\u5b83\u4f1a\u9996\u5148\u501f\u52a9 <code>test</code> \u3001 <code>cmp</code> \u7b49\u6307\u4ee4\uff0c\u6765\u5224\u65ad\u64cd\u4f5c\u6570\u7684\u72b6\u6001\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u518d\u8fdb\u884c\u76f8\u5e94\u7684\u6570\u503c\u8f6c\u6362\u8fc7\u7a0b\uff1b</li> <li>\u5728\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26\u4e2d\uff0c\u53d6\u5730\u5740\u8fd0\u7b97\u7b26\u4e00\u822c\u5bf9\u5e94\u4e8e\u6c47\u7f16\u6307\u4ee4 <code>lea</code> \uff0c\u89e3\u5f15\u7528\u8fd0\u7b97\u7b26\u5219\u53ef\u76f4\u63a5\u4f7f\u7528 mov \u6307\u4ee4\u6765\u5b9e\u73b0\uff1b</li> <li>\u5bf9\u4e8e\u5176\u4ed6\u8fd0\u7b97\u7b26\uff0c<code>sizeof</code> \u8fd0\u7b97\u7b26\u4f1a\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u6c42\u503c\uff0c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26\u5219\u76f4\u63a5\u5bf9\u5e94\u4e8e\u4e0d\u540c\u6307\u4ee4\u5bf9\u540c\u4e00\u5757\u6570\u636e\u7684\u4e0d\u540c\u5904\u7406\u65b9\u5f0f\u3002</li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_9","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u7f16\u8bd1\u5668\u662f\u901a\u8fc7\u54ea\u7c7b\u6307\u4ee4\u6765\u5b9e\u73b0\u4e09\u5143\u8fd0\u7b97\u7b26 \u201c?:\u201d \u7684\uff1f</p> </li> <li> <p>\u5728ARM\u6307\u4ee4\u96c6\u6216\u8005RISC-V\u6307\u4ee4\u96c6\u67b6\u6784\u4e2d\u600e\u4e48\u5b9e\u73b0\u8fd9\u4e00\u8bb2\u7684\u5185\u5bb9\u5462\uff1f</p> <ol> <li> <p>\u5b9e\u9a8c\u90e8\u5206</p> <pre><code>int i = 123;        \n\n        printf(\"sizeof int: %d\\r\\n\", sizeof(int));\n        printf(\"sizeof int: %d\\r\\n\", sizeof(short));\n        volatile short test_i = (short)i;\n\n        for(test_i; test_i &gt;= 0; test_i--)\n        {\n                printf(\"%d \\r\\n\", test_i);\n        }\n</code></pre> <pre><code>   145:         int i = 123; \n   146:          \n0x0800212E 247B      MOVS     r4,#0x7B\n   154:                 printf(\"sizeof int: %d\\r\\n\", sizeof(int)); \n0x0800215A 2104      MOVS     r1,#0x04\n0x0800215C A0FA      ADR      r0,{pc}+0x3EC  ; @0x08002548\n0x0800215E F007FA11  BL.W     0x08009584 __0printf\n   155:                 printf(\"sizeof int: %d\\r\\n\", sizeof(short)); \n0x08002162 2102      MOVS     r1,#0x02\n0x08002164 A0F8      ADR      r0,{pc}+0x3E4  ; @0x08002548\n0x08002166 F007FA0D  BL.W     0x08009584 __0printf\n   156:                 volatile short test_i = (short)i; \n   157:                  \n0x0800216A B220      SXTH     r0,r4\n0x0800216C 9001      STR      r0,[sp,#0x04]\n   158:                 for(test_i; test_i &gt;= 0; test_i--) \n   159:                 { \n0x0800216E F9BD0004  LDRSH    r0,[sp,#0x04]\n   158:                 for(test_i; test_i &gt;= 0; test_i--) \n0x08002172 E009      B        0x08002188\n   160:                         printf(\"%d \\r\\n\", test_i); \n   161:                 } \n   162:                  \n   163:  \n0x08002174 F9BD1004  LDRSH    r1,[sp,#0x04]\n0x08002178 A0F8      ADR      r0,{pc}+0x3E4  ; @0x0800255C\n0x0800217A F007FA03  BL.W     0x08009584 __0printf\n   158:                 for(test_i; test_i &gt;= 0; test_i--) \n0x0800217E F8BD0004  LDRH     r0,[sp,#0x04]\n0x08002182 1E40      SUBS     r0,r0,#1\n0x08002184 B200      SXTH     r0,r0\n0x08002186 9001      STR      r0,[sp,#0x04]\n   158:                 for(test_i; test_i &gt;= 0; test_i--) \n0x08002188 F9BD0004  LDRSH    r0,[sp,#0x04]\n0x0800218C 2800      CMP      r0,#0x00\n0x0800218E DAF1      BGE      0x08002174\n   164:         } \n</code></pre> <ol> <li> <p>\u4ee3\u7801\u89e3\u91ca\uff1a</p> <ol> <li> <p><code>MOVS r4, #0x7B</code>: \u5c06\u5341\u8fdb\u5236\u6570123\uff080x7B\uff09\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668r4\u4e2d\uff0c\u5373<code>int i = 123;</code>\u3002</p> </li> <li> <p><code>MOVS r1, #0x04</code>: \u5c06\u6574\u65704\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668r1\u4e2d\uff0c\u8fd9\u5bf9\u5e94\u4e8e<code>sizeof(int)</code>\u3002</p> </li> <li> <p><code>BL.W 0x08009584 __0printf</code>: \u8c03\u7528 <code>printf</code> \u51fd\u6570\u6765\u6253\u5370<code>\"sizeof int: %d\\r\\n\"</code>\uff0c\u5176\u4e2d<code>%d</code>\u5c06\u88ab\u66ff\u6362\u4e3a4\u3002</p> </li> <li> <p><code>MOVS r1, #0x02</code>: \u5c06\u6574\u65702\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668r1\u4e2d\uff0c\u8fd9\u5bf9\u5e94\u4e8e<code>sizeof(short)</code>\u3002</p> </li> <li> <p><code>BL.W 0x08009584 __0printf</code>: \u8c03\u7528printf\u51fd\u6570\u6765\u6253\u5370<code>\"sizeof short: %d\\r\\n\"</code>\uff0c\u5176\u4e2d<code>%d</code>\u5c06\u88ab\u66ff\u6362\u4e3a2\u3002</p> </li> <li> <p><code>SXTH r0, r4</code>: \u5c06r4\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\uff08123\uff09\u7b26\u53f7\u6269\u5c55\u4e3a16\u4f4d\uff0c\u5e76\u5c06\u7ed3\u679c\u5b58\u50a8\u56der0\u4e2d\uff0c\u5373\u5c06<code>int i = 123;</code>\u5f3a\u5236\u8f6c\u6362\u4e3ashort\u3002</p> </li> <li> <p><code>STR r0, [sp, #0x04]</code>: \u5c06r0\u4e2d\u7684\u503c\uff08123\uff09\u5b58\u50a8\u5230\u6808\u6307\u9488\uff08sp\uff09\u504f\u79fb4\u7684\u4f4d\u7f6e\uff0c\u5373\u5c06short\u7c7b\u578b\u7684\u503c\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p><code>LDRSH r0, [sp, #0x04]</code>: \u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u4e00\u4e2a\u6709\u7b26\u53f7\u768416\u4f4d\u503c\u5230r0\u4e2d\uff0c\u5373\u52a0\u8f7dshort\u7c7b\u578b\u7684\u503c\u3002</p> </li> <li> <p><code>SUBS r0, r0, #1</code>: \u5c06r0\u4e2d\u7684\u503c\u51cf\u53bb1\u3002</p> </li> <li> <p><code>STR r0, [sp, #0x04]</code>: \u5c06\u51cf\u53bb1\u540e\u7684\u503c\u5b58\u50a8\u56de\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p><code>CMP r0, #0x00</code>: \u6bd4\u8f83r0\u4e2d\u7684\u503c\u662f\u5426\u4e3a0\u3002</p> </li> <li> <p><code>BGE 0x08002174</code>: \u5982\u679cr0\u4e2d\u7684\u503c\u5927\u4e8e\u7b49\u4e8e0\uff0c\u5219\u8df3\u8f6c\u5230\u5730\u57400x08002174\uff0c\u5373\u5faa\u73af\u7ee7\u7eed\u3002</p> </li> </ol> <p>\u8fd9\u4e9b\u6307\u4ee4\u5c55\u793a\u4e86\u5982\u4f55\u5728ARM\u6c47\u7f16\u4e2d\u5b9e\u73b0<code>sizeof</code>\u64cd\u4f5c\u548c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5faa\u73af\u6765\u9012\u51cf\u4e00\u4e2ashort\u7c7b\u578b\u7684\u503c\u5e76\u6253\u5370\u51fa\u6765\u3002</p> <p>ADR: \u5728ARM\u6c47\u7f16\u4e2d\uff0c<code>ADR</code> \u662f\u4e00\u4e2a\u4f2a\u6307\u4ee4\uff08pseudo-instruction\uff09\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u76f8\u5bf9\u4e8e\u5f53\u524d\u6307\u4ee4\u5730\u5740\u7684\u504f\u79fb\u91cf\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\u3002\u5b83\u7684\u4f5c\u7528\u7c7b\u4f3c\u4e8e\u8ba1\u7b97\u5730\u5740\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u4e0d\u6267\u884c\u5185\u5b58\u8bbf\u95ee\u64cd\u4f5c\u3002\u5728\u8fd9\u91cc\uff0c<code>ADR r0,{pc}+0x3E0</code> \u8ba1\u7b97\u7684\u662f\u5b57\u7b26\u4e32 <code>\"sizeof test: %d\\r\\n\"</code> \u7684\u5730\u5740\u3002</p> <p>C\u8bed\u8a00\u4e2d\u7684 <code>sizeof</code> \u64cd\u4f5c\u7b26\u662f\u5728\u7f16\u8bd1\u65f6\u8ba1\u7b97\u6570\u636e\u7c7b\u578b\u6216\u53d8\u91cf\u6240\u5360\u7684\u5b57\u8282\u6570\uff0c\u56e0\u6b64\u5728\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a\u7acb\u5373\u6570\u6765\u8868\u793a <code>sizeof(int)</code> \u7684\u5927\u5c0f\uff08\u901a\u5e38\u4e3a4\u4e2a\u5b57\u8282\uff09\uff0c\u800c\u4e0d\u9700\u8981\u5728\u8fd0\u884c\u65f6\u8ba1\u7b97\u3002\u56e0\u6b64\uff0c\u5728\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u76f4\u63a5\u5c06 <code>sizeof(int)</code> \u7684\u5927\u5c0f\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u7136\u540e\u4f20\u9012\u7ed9 <code>printf</code> \u51fd\u6570\u8fdb\u884c\u6253\u5370\u3002</p> </li> </ol> </li> </ol> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#03","title":"03\uff5c\u63a7\u5236\u903b\u8f91\uff1a\u8868\u8fbe\u5f0f\u548c\u8bed\u53e5\u662f\u5982\u4f55\u534f\u8c03\u7a0b\u5e8f\u8fd0\u884c\u7684\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_10","title":"\u8868\u8fbe\u5f0f","text":"<p>\u8868\u8fbe\u5f0f\uff08expression\uff09\u662f\u7531\u4e00\u7cfb\u5217\u8fd0\u7b97\u7b26\u4e0e\u64cd\u4f5c\u6570\uff08operand\uff09\u7ec4\u6210\u7684\u4e00\u79cd\u8bed\u6cd5\u7ed3\u6784\u3002</p> <p>\u5176\u4e2d\uff0c\u64cd\u4f5c\u6570\u662f\u53c2\u4e0e\u8fd0\u7b97\u7b26\u8ba1\u7b97\u7684\u72ec\u7acb\u5355\u5143\uff0c\u4e5f\u5373\u8fd0\u7b97\u7b26\u6240\u64cd\u4f5c\u7684\u5bf9\u8c61\u3002</p> <p>\u64cd\u4f5c\u6570\u53ef\u4ee5\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b57\u9762\u91cf\u503c\uff0c\u6bd4\u5982\u6570\u5b57 2\u3001\u5b57\u7b26\u4e32 \u201cHello, world!\u201d\uff1b\u4e5f\u53ef\u4ee5\u662f\u53e6\u4e00\u7ec4\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5728\u8868\u8fbe\u5f0f (1 + 2) * 3 + 4 / 5 \u4e2d\uff0c\u4e58\u6cd5\u8fd0\u7b97\u7b26 \u201c*\u201d \u6240\u5bf9\u5e94\u7684\u4e24\u4e2a\u64cd\u4f5c\u6570\u5206\u522b\u662f\u5b57\u9762\u91cf\u6570\u503c 3\uff0c\u548c\u5b50\u8868\u8fbe\u5f0f (1 + 2)\u3002\u901a\u5e38\u6765\u8bf4\uff0c\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\uff08evaluation\uff09\u8fc7\u7a0b\u9700\u8981\u4f9d\u636e\u6240\u6d89\u53ca\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7\u548c\u7ed3\u5408\u6027\u7684\u4e0d\u540c\uff0c\u800c\u6309\u4e00\u5b9a\u987a\u5e8f\u8fdb\u884c\u3002\u6211\u4eec\u4e00\u8d77\u6765\u770b\u770b\u4e0a\u9762\u63d0\u5230\u7684 (1 + 2) * 3 + 4 / 5 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u6d41\u7a0b\u3002</p> <ol> <li> <p>\u9996\u5148\uff0c\u9700\u8981\u6839\u636e\u8868\u8fbe\u5f0f\u4e2d\u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7\u7684\u4e0d\u540c\uff0c\u6765\u51b3\u5b9a\u6700\u5148\u8fdb\u884c\u54ea\u4e00\u90e8\u5206\u8fd0\u7b97\u3002</p> <p>\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7\u5f88\u597d\u7406\u89e3\uff0c\u7531\u4e8e\u4e58\u6cd5\u8fd0\u7b97\u7b26 \u201c * \u201d \u4e0e\u9664\u6cd5\u8fd0\u7b97\u7b26 \u201c/\u201d \u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u52a0\u6cd5\u8fd0\u7b97\u7b26 \u201c+\u201d\uff0c\u56e0\u6b64\u5728\u8ba1\u7b97\u6574\u4e2a\u8868\u8fbe\u5f0f\u7684\u503c\u65f6\uff0c\u9700\u8981\u9996\u5148\u5bf9\u7531\u8fd9\u4e24\u4e2a\u8fd0\u7b97\u7b26\u7ec4\u6210\u7684\u5b50\u8868\u8fbe\u5f0f\u8fdb\u884c\u6c42\u503c\u3002</p> </li> <li> <p>\u4ece\u4e0a\u4e00\u6b65\u4e2d\u201c\u7b5b\u9009\u51fa\u201d\u7684\u5f85\u8ba1\u7b97\u8fd0\u7b97\u7b26\u591a\u4e8e 1 \u4e2a\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u518d\u5224\u65ad\u8fd0\u7b97\u7b26\u7684\u7ed3\u5408\u6027\uff0c\u6765\u51b3\u5b9a\u4f18\u5148\u8ba1\u7b97\u54ea\u4e00\u4e2a</p> <p>\u56e0\u4e3a\u4e58\u6cd5\u8fd0\u7b97\u7b26\u548c\u9664\u6cd5\u8fd0\u7b97\u7b26\u5747\u5177\u6709\u5de6\u7ed3\u5408\u6027\uff0c\u56e0\u6b64\uff0c\u7531\u5de6\u4fa7\u4e58\u6cd5\u8fd0\u7b97\u7b26\u6784\u6210\u7684\u5b50\u8868\u8fbe\u5f0f\u9700\u8981\u88ab\u4f18\u5148\u6c42\u503c</p> <p>\u5f53\u6211\u4eec\u4ee5\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4e3a\u89c6\u89d2\uff0c\u8fdb\u884c\u89c2\u5bdf\u65f6\uff0c\u53c2\u4e0e\u8868\u8fbe\u5f0f\u8ba1\u7b97\u7684\u64cd\u4f5c\u6570\u5206\u522b\u4e3a\u5b50\u8868\u8fbe\u5f0f (1 + 2)\uff0c\u4ee5\u53ca\u5b57\u9762\u91cf\u6570\u503c 3\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u5206\u522b\u5bf9\u8fd9\u4e24\u90e8\u5206\u8fdb\u884c\u6c42\u503c\uff0c\u76f4\u81f3\u4e58\u6cd5\u8fd0\u7b97\u7b26 \u201c * \u201d \u4e24\u8fb9\u7684\u64cd\u4f5c\u6570\u53ef\u4ee5\u76f4\u63a5\u53c2\u4e0e\u8ba1\u7b97\u4e3a\u6b62\u3002</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cC \u6807\u51c6\u4e2d\u5e76==\u672a\u89c4\u5b9a==\u8fd0\u7b97\u7b26\u4e24\u4fa7\u64cd\u4f5c\u6570\u7684\u5177\u4f53\u6c42\u503c\u987a\u5e8f\uff0c\u56e0\u6b64\u5177\u4f53\u65b9\u5f0f\u7531\u7f16\u8bd1\u5668\u9009\u62e9\u3002</p> </li> <li> <p>\u603b\u7ed3\uff1a</p> <p>\u5bf9\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u8fc7\u7a0b\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6839\u636e\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7\u548c\u7ed3\u5408\u6027\uff0c\u6765\u5bf9\u8868\u8fbe\u5f0f\u548c\u5b83\u6240\u5305\u542b\u7684\u5b50\u8868\u8fbe\u5f0f\u8fdb\u884c\u9012\u5f52\u6c42\u503c\u7684\u8fc7\u7a0b\u3002</p> <p>\u8bbe\u8ba1\u7f16\u8bd1\u5668\u7684\u4eba\u6839\u636e\u6211\u4eec\u7684\u81ea\u7136\u89c4\u5f8b\u548c\u57fa\u672c\u6570\u5b66\u516c\u91cc\u6765\u8bbe\u8ba1\u4e0a\u9762\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7\u548c\u7ed3\u5408\u6027</p> <p>\u4ece\u7f16\u8bd1\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6240\u6d89\u53ca\u5230\u7684\u64cd\u4f5c\u6570\u7684\u5b9e\u9645\u6c42\u503c\u987a\u5e8f\u4f1a\u5728\u8bed\u6cd5\u5206\u6790\u9636\u6bb5\u88ab\u786e\u5b9a\uff0c\u5e76\u4f53\u73b0\u5728\u6e90\u7801\u5bf9\u5e94\u7684\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff0cAbstract Syntax Tree\uff09\u4e0a\u3002</p> <p></p> <ul> <li> <p>\u4f8b\u5b50\uff1a</p> <pre><code>main.c\nint foo(void) {\n  return (1 + 2) * 3 + 4 / 5;\n}\n</code></pre> <p>\u501f\u52a9 Clang \u7f16\u8bd1\u5668\u63d0\u4f9b\u7684 <code>-ast-dump</code> \u9009\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u7f16\u8bd1\u5e76\u6253\u5370\u51fa\u8fd9\u6bb5 C \u4ee3\u7801\u5bf9\u5e94\u7684 AST \u7ed3\u6784\u3002\u5b8c\u6574\u7684\u7f16\u8bd1\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>clang -Xclang -ast-dump -fsyntax-only main.c\n</code></pre> <p></p> <p>AST \u4f5c\u4e3a\u7528\u4e8e\u8868\u793a\u6e90\u4ee3\u7801\u8bed\u6cd5\u7ed3\u6784\u7684\u4e00\u79cd\u6811\u5f62\u6570\u636e\u7ed3\u6784\uff0c\u8bed\u6cd5\u5206\u6790\u5668\u4f1a\u5c06\u8868\u8fbe\u5f0f\u4e2d\u64cd\u4f5c\u6570\u7684\u6574\u4f53\u6c42\u503c\u987a\u5e8f\u6620\u5c04\u5230\u6811\u7684\u7ed3\u6784\u4e0a\u3002\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u4ee5\u540e\u5e8f\u904d\u5386\uff08LRD\uff09\u7684\u65b9\u5f0f\u904d\u5386\u8fd9\u68f5\u6811\u65f6\uff0c\u4fbf\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u6b63\u786e\u7684\u8868\u8fbe\u5f0f\u6c42\u503c\u987a\u5e8f\u3002</p> <p>\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b-\u94fe\u63a5\u3001\u88c5\u8f7d\u4e0e\u5e93\u300b\uff1a</p> <p><code>array[index] = (index + 4) * (2 + 6)</code></p> <p></p> <ol> <li> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684 AST \u6765\u8bf4\uff0c\u7531\u53f6\u5b50\u7ed3\u70b9\u7ec4\u6210\u7684\u5b50\u6811\u9700\u8981\u88ab\u6700\u5148\u6c42\u503c\uff0c\u56e0\u6b64\u6211\u4eec\u9996\u5148\u53ef\u4ee5\u5f97\u5230\u62ec\u53f7\u5185\u52a0\u6cd5\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u7ed3\u679c 3\u3002</p> </li> <li> <p>\u7136\u540e\uff0c\u8be5\u7ed3\u679c\u5c06\u4f5c\u4e3a\u53f6\u5b50\u7ed3\u70b9\u4e0a\u7684\u64cd\u4f5c\u6570\uff0c\u53c2\u4e0e\u4e58\u6cd5\u8fd0\u7b97\u7b26\u7684\u8ba1\u7b97\uff0c\u4ece\u800c\u5f97\u5230\u8ba1\u7b97\u7ed3\u679c 9\u3002</p> </li> <li>\u63a5\u4e0b\u6765\uff0c\u9664\u6cd5\u8fd0\u7b97\u7b26\u6240\u5728\u7684\u5b50\u8868\u8fbe\u5f0f\u7ecf\u8fc7\u6c42\u503c\uff0c\u5f97\u5230\u7ed3\u679c 0\u3002</li> <li>\u6700\u540e\uff0c\u8be5\u503c\u518d\u4f5c\u4e3a\u6700\u540e\u4e00\u4e2a\u52a0\u6cd5\u8fd0\u7b97\u7b26\u7684\u64cd\u4f5c\u6570\uff0c\u4e0e\u5b57\u9762\u91cf\u503c 9 \u76f8\u52a0\uff0c\u8fdb\u800c\u5f97\u5230\u6574\u4e2a\u8868\u8fbe\u5f0f\u7684\u6700\u7ec8\u8ba1\u7b97\u7ed3\u679c 9\u3002</li> </ol> </li> </ul> </li> <li> <p>\u8868\u8fbe\u5f0f\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u79cd\u80fd\u529b\uff1a\u80fd\u591f\u8ba9\u6570\u636e\u540c\u65f6\u53c2\u4e0e\u5230\u591a\u4e2a\u64cd\u4f5c\u7b26\u7684\u4e0d\u540c\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u3002\u800c\u901a\u8fc7\u63d0\u4f9b\u5bf9\u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7\u4e0e\u7ed3\u5408\u6027\u7684\u89c4\u5219\u9650\u5236\uff0c\u8868\u8fbe\u5f0f\u53ef\u4ee5\u63a7\u5236\u6574\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u7684\u6709\u5e8f\u8fdb\u884c\u3002</p> </li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_11","title":"\u8bed\u53e5","text":"<p>\u8bed\u53e5\uff08statement\uff09\u662f\u7528\u6765\u63cf\u8ff0\u7a0b\u5e8f\u7684\u57fa\u672c\u6784\u5efa\u5757\u3002</p> <p>\u548c\u8868\u8fbe\u5f0f\u4e0d\u540c\uff0c\u8bed\u53e5\u662f\u6784\u6210 C \u7a0b\u5e8f\u7684\u6700\u5927\u7c92\u5ea6\u5355\u5143\uff0c\u5728\u5b83\u7684\u5185\u90e8\uff0c\u53ef\u4ee5\u5305\u542b\u6709\u7b80\u5355\u6216\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u7ed3\u6784\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4e0d\u5305\u542b\u4efb\u4f55\u5185\u5bb9\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8bed\u53e5\u5728\u6267\u884c\u65f6\u4e0d\u8fd4\u56de\u4efb\u4f55\u7ed3\u679c\uff0c\u4f46\u53ef\u80fd\u4f1a\u4ea7\u751f\u526f\u4f5c\u7528\u3002</p> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u8bed\u53e5\u53ef\u4ee5\u88ab\u5206\u4e3a\u590d\u5408\u8bed\u53e5\u3001\u8868\u8fbe\u5f0f\u8bed\u53e5\u3001\u9009\u62e9\u8bed\u53e5\u3001\u8fed\u4ee3\u8bed\u53e5\u3001\u8df3\u8f6c\u8bed\u53e5\u4e94\u79cd\u7c7b\u578b\u3002</p> <p>\u4f46\u65e0\u8bba\u662f\u54ea\u79cd\u7c7b\u578b\uff0c\u8bed\u53e5\u90fd\u5fc5\u987b\u4ee5\u5206\u53f7\u7ed3\u5c3e\uff0c\u5e76\u6309\u4ece\u4e0a\u5230\u4e0b\u7684\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\u3002\u5176\u4e2d\uff0c\u590d\u5408\u8bed\u53e5\u662f\u6307\u7531\u82b1\u62ec\u53f7 \u201c{}\u201d \u6807\u8bb0\u7684\u4e00\u5757\u533a\u57df\u3002\u5728\u8fd9\u4e2a\u533a\u57df\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u7f6e\u58f0\u660e\uff08declaration\uff09\u548c\u8bed\u53e5\uff0c\u800c\u6700\u5e38\u89c1\u7684\u4e00\u79cd\u590d\u5408\u8bed\u53e5\u4fbf\u662f\u51fd\u6570\u4f53\u3002\u5728\u51fd\u6570\u4f53\u5185\u90e8\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u53d8\u91cf\uff0c\u5e76\u901a\u8fc7\u7ed3\u5408\u5404\u7c7b\u5176\u4ed6\u8bed\u53e5\u6765\u5b9e\u73b0\u51fd\u6570\u7684\u529f\u80fd\u3002</p> <p>\u800c\u8868\u8fbe\u5f0f\u8bed\u53e5\u5219\u662f\u76f4\u63a5\u7531\u8868\u8fbe\u5f0f\u5916\u52a0\u4e00\u4e2a\u5206\u53f7\u7ec4\u6210\u7684\u8bed\u53e5\uff0c\u6bd4\u5982\u51fd\u6570\u8c03\u7528\u8bed\u53e5\u6216\u53d8\u91cf\u8d4b\u503c\u8bed\u53e5\u3002\u5f53\u7136\uff0c\u8868\u8fbe\u5f0f\u8bed\u53e5\u4e2d\u7684\u8868\u8fbe\u5f0f\u4e5f\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u8fd9\u6837\u5c31\u6210\u4e3a\u4e86\u4ec5\u7531\u4e00\u4e2a \u201c;\u201d \u7ec4\u6210\u7684\u7a7a\u8bed\u53e5\u3002\u5728\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u91cc\uff0c\u6211\u6807\u6ce8\u51fa\u4e86\u5176\u4e2d\u4f7f\u7528\u5230\u7684\u590d\u5408\u8bed\u53e5\u4e0e\u8868\u8fbe\u5f0f\u8bed\u53e5\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec\u6765\u52a0\u6df1\u5bf9\u8fd9\u4e24\u79cd\u8bed\u53e5\u7684\u7406\u89e3\u3002</p> <pre><code>int foo(int x, int y) {  // \u590d\u5408\u8bed\u53e5\uff1b\n  int sum = x + y; // \u8868\u8fbe\u5f0f\u8bed\u53e5\uff1b\n  if (sum &lt; 0) {  // \u590d\u5408\u8bed\u53e5\uff1b\n    sum = -sum;  // \u8868\u8fbe\u5f0f\u8bed\u53e5\uff1b\n  }\n  return sum;\n}\n</code></pre> <p>\u8fd9\u4e24\u79cd\u7c7b\u578b\u7684\u8bed\u53e5\uff0c\u5b83\u4eec\u7684\u5177\u4f53\u7ed3\u6784\u4f9d\u7a0b\u5e8f\u8bbe\u8ba1\u7ec6\u8282\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u56e0\u6b64\u8fd9\u91cc\u6211\u4eec\u4e0d\u518d\u505a\u66f4\u591a\u7684\u8ba8\u8bba\u3002\u76f8\u5bf9\u7684\uff0c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u9009\u62e9\u8bed\u53e5\u3001\u8fed\u4ee3\u8bed\u53e5\u3001\u8df3\u8f6c\u8bed\u53e5\u90fd\u6709\u7740\u5b83\u4eec\u76f8\u5bf9\u5e94\u7684\u7279\u5b9a\u8bed\u6cd5\u7ed3\u6784\u3002\u56e0\u6b64\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u91cd\u70b9\u770b\u770b\u8fd9\u51e0\u7c7b\u8bed\u53e5\uff0c\u63a2\u7a76\u7f16\u8bd1\u5668\u662f\u5982\u4f55\u5b9e\u73b0\u5b83\u4eec\u7684\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_12","title":"\u9009\u62e9\u8bed\u53e5","text":"<p>\u540c\u5176\u4ed6\u5927\u591a\u6570\u8bed\u8a00\u7c7b\u4f3c\uff0c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u9009\u62e9\u8bed\u53e5\u4e3b\u8981\u662f\u6307\u7531 if\u2026else \u548c switch\u2026case \u8fd9\u4e24\u79cd\u8bed\u6cd5\u7ed3\u6784\u7ec4\u6210\u7684\u8bed\u53e5\u3002\u5b83\u4eec\u7684\u4f7f\u7528\u65b9\u5f0f\u4f60\u5e94\u8be5\u5f88\u719f\u6089\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8bb2\u4e86\u3002\u8ba9\u6211\u4eec\u76f4\u63a5\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\uff0c\u89c2\u5bdf\u7f16\u8bd1\u5668\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u5982\u4f55\u5b9e\u73b0\u5b83\u4eec\u7684\u3002\u9996\u5148\u6765\u770b if\u2026else \u8bed\u53e5\uff1a</p> <ul> <li> <p><code>if...else</code>\u8bed\u53e5\uff1a</p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5728\u5de6\u4fa7\u7684 C \u51fd\u6570 foo \u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 if\u2026else \u8bed\u53e5\u6784\u5efa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u7a0b\u5e8f\u903b\u8f91\u3002</p> <p>if \u8bed\u53e5\u4f1a\u5728\u6bcf\u4e00\u4e2a\u6761\u4ef6\u5206\u652f\u4e2d\u68c0\u6d4b\u51fd\u6570\u53c2\u6570 v \u7684\u503c\uff0c\u5e76\u6839\u636e\u5339\u914d\u60c5\u51b5\u8fd4\u56de\u4e00\u4e2a\u6570\u503c\u3002\u82e5\u6240\u6709\u60c5\u51b5\u90fd\u6ca1\u6709\u547d\u4e2d\uff0c\u5219\u6700\u540e\u7684 else \u8bed\u53e5\u751f\u6548\uff0c\u76f4\u63a5\u8fd4\u56de\u6570\u503c 4\u3002\u76f8\u5e94\u7684\uff0c\u5728\u53f3\u4fa7\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u51fd\u6570\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u901a\u8fc7\u7ea2\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u53d8\u91cf v \u7684\u503c\u88ab\u5b58\u653e\u5728\u6808\u5185\u5b58\u4e2d\u5730\u5740\u4e3a <code>rbp</code> \u5bc4\u5b58\u5668\u7684\u503c\u51cf\u53bb 4 \u7684\u4f4d\u7f6e\u4e0a\u3002\u7a0b\u5e8f\u4f7f\u7528\u591a\u4e2a\u6807\u7b7e\uff08\u5982 .L2\u3001.L3 \u7b49\uff09\uff0c\u5206\u522b\u5212\u5206\u4e0d\u540c\u5206\u652f\u5bf9\u5e94\u7684\u5904\u7406\u903b\u8f91\uff0c\u800c\u5206\u652f\u7684\u5224\u65ad\u8fc7\u7a0b\u5219\u662f\u7531\u6307\u4ee4 <code>cmp</code> \u4e0e\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4 <code>je</code> \u4e0e <code>jne</code> \u5171\u540c\u5b8c\u6210\u7684\u3002</p> <p>\u6c47\u7f16\u4ee3\u7801\u548c C \u4ee3\u7801\u7684\u6574\u4f53\u903b\u8f91\u57fa\u672c\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u5c3d\u91cf\u4fdd\u6301\u7a0b\u5e8f\u7684\u6267\u884c\u6027\u80fd\uff0c\u4f60\u53ef\u4ee5\u5c06\u547d\u4e2d\u51e0\u7387\u8f83\u5927\u7684\u6761\u4ef6\u8bed\u53e5\u653e\u5728\u8f83\u524d\u7684\u4f4d\u7f6e\u4e0a\u3002</p> </li> <li> <p><code>switch...case</code> \u8bed\u53e5</p> <p></p> <ol> <li> <p>\u6807\u6ce8\u4e3a\u7ea2\u8272\u7684\u6c47\u7f16\u4ee3\u7801\u4f1a\u901a\u8fc7 <code>cmp</code> \u6307\u4ee4\uff0c\u5224\u65ad\u5bc4\u5b58\u5668 <code>eax</code> \u4e2d\u7684\u503c\uff0c\u5373\u53d8\u91cf v \u7684\u503c\u662f\u5426\u5927\u4e8e 60\u3002\u82e5\u5224\u65ad\u6210\u7acb\uff0c\u5219\u76f4\u63a5\u5c06\u7a0b\u5e8f\u8df3\u8f6c\u5230\u6807\u7b7e .L2 \u5904\uff0c\u5e76\u5c06\u6570\u5b57 4 \u4f5c\u4e3a\u8fd4\u56de\u503c\uff1b\u82e5\u6761\u4ef6\u4e0d\u6210\u7acb\uff0c\u7a0b\u5e8f\u5c06\u7ee7\u7eed\u6267\u884c\u3002</p> </li> <li> <p>\u63a5\u4e0b\u6765\uff0c\u84dd\u8272\u90e8\u5206\u7684\u4ee3\u7801\u4f1a\u57fa\u4e8e\u53d8\u91cf v \u7684\u503c\uff0c\u6765\u4ea7\u751f\u4e00\u4e2a\u7528\u4e8e\u53c2\u4e0e\u540e\u7eed\u8fd0\u7b97\u7b26\u7684 \u201ctoken\u201d \u503c\u3002\u8fd9\u4e2a\u503c\u7684\u751f\u6210\u6b65\u9aa4\u5982\u4e0b\u6240\u793a\uff1a</p> <ol> <li>\u5c06\u5bc4\u5b58\u5668 <code>edx</code> \u7684\u503c\u8bbe\u4e3a 1\uff1b</li> <li>\u5c06\u5bc4\u5b58\u5668 <code>ecx</code> \u7684\u503c\u8bbe\u4e3a\u53d8\u91cf v \u7684\u503c\uff1b</li> <li>\u5c06\u5bc4\u5b58\u5668 <code>rdx</code> \u4e2d\u7684\u503c\u5de6\u79fb v \u4f4d\uff08\u503c\u88ab\u6269\u5c55\u4e3a 64 \u4f4d\uff09\uff1b</li> <li>\u5c06\u6b64\u65f6\u5bc4\u5b58\u5668 <code>rdx</code> \u4e2d\u7684\u503c\u79fb\u52a8\u5230 <code>rax</code> \u4e2d\u7559\u4f5c\u5f85\u7528\u3002</li> </ol> </li> <li> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e0a\u56fe\u4e2d\u53f3\u4fa7\u865a\u7ebf\u6846\u5185\u7684\u4ee3\u7801\uff0c\u7a0b\u5e8f\u5b8c\u6210\u4e86\u5bf9\u53d8\u91cf v \u7684\u503c\u7684\u7b2c\u4e00\u6b21\u7b5b\u9009\u8fc7\u7a0b\u3002</p> <ol> <li> <p>\u5982\u679c\u5c06\u5176\u4e2d\u7b2c\u4e00\u884c\u6307\u4ee4 <code>movabs</code> \u7684\u7acb\u5373\u6570\u64cd\u4f5c\u6570 1154047404513689600 \u4ee5 64 \u4f4d\u4e8c\u8fdb\u5236\u7684\u5f62\u5f0f\u5c55\u5f00\uff0c\u4f60\u4f1a\u53d1\u73b0\u5176\u4e2d\u53ea\u6709\u7b2c 50 \u548c 60 \u4f4d\u88ab\u7f6e\u4f4d\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u884c\u7684 and \u6307\u4ee4\uff0c\u4f1a\u5c06\u8fd9\u4e2a\u8d85\u957f\u7684\u7acb\u5373\u6570\u4e0e\u4e4b\u524d\u6839\u636e\u53d8\u91cf v \u7684\u503c\u8fdb\u884c\u79fb\u4f4d\u800c\u5f97\u6765\u7684 token \u503c\u8fdb\u884c\u201c\u4e0e\u201d\u64cd\u4f5c\u3002</p> <ol> <li>\u82e5\u64cd\u4f5c\u5f97\u5230\u7684\u7ed3\u679c\u4e0d\u4e3a 0\uff0c\u5219\u8868\u793a token \u503c\u7684\u7b2c 50 \u6216 60 \u4f4d\u80af\u5b9a\u4e0d\u4e3a 0\uff0c\u5373\u53d8\u91cf v \u7684\u503c\u4e3a 50 \u6216 60\u3002</li> <li>\u5426\u5219\uff0c\u53d8\u91cf v \u7684\u503c\u5219\u4e0d\u7b26\u5408\u8be5 case \u8bed\u53e5\u7684\u7b5b\u9009\u6761\u4ef6\u3002</li> </ol> <p>\u5230\u8fd9\u91cc\uff0c\u7b5b\u9009\u7684\u57fa\u672c\u903b\u8f91\u76f8\u4fe1\u4f60\u5df2\u7ecf\u6e05\u695a\u4e86\u3002\u4e0d\u8fc7\uff0c\u901a\u8fc7\u201c\u4f4d\u6620\u5c04\u201d\u7684\u65b9\u5f0f\u8fdb\u884c\u5206\u652f\u7b5b\u9009\uff0c\u5e76\u4e0d\u80fd\u5b8c\u7f8e\u5730\u8986\u76d6\u6240\u6709\u60c5\u51b5\u3002\u6bd4\u5982\uff0c\u5f53 case \u8bed\u53e5\u7684\u7b5b\u9009\u503c\u8fc7\u5927\uff0c\u65e0\u6cd5\u4f7f\u7528\u5bc4\u5b58\u5668\u6765\u8fdb\u884c\u6620\u5c04\u65f6\uff0c\u9ed8\u8ba4\u4f18\u5316\u6761\u4ef6\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u5c06 switch\u2026case \u7684\u5b9e\u73b0\u201c\u56de\u9000\u201d\u5230\u4e0e if\u2026else \u7c7b\u4f3c\u7684\u65b9\u5f0f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f7f\u7528 <code>cmp</code> \u6307\u4ee4\u4e0e\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u6765\u8fdb\u884c\u5206\u652f\u3002</p> </li> </ol> </li> </ol> </li> <li> <p>\u4f18\u5316</p> <p>\u9664\u4e86\u4e0a\u9762\u4ecb\u7ecd\u7684 if\u2026else \u4e0e switch\u2026case \u8bed\u53e5\u5b9e\u73b0\u65b9\u5f0f\u5916\uff0c\u5728\u9ad8\u4f18\u5316\u7b49\u7ea7\u4e0b\uff0c\u7f16\u8bd1\u5668\u8fd8\u53ef\u80fd\u4f1a\u91c7\u7528\u4e00\u79cd\u540d\u4e3a\u201c\u8df3\u8868\u201d\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u8fd9\u4e24\u79cd\u6761\u4ef6\u9009\u62e9\u8bed\u53e5\u3002\u4e0b\u9762\u662f\u7528\u8fd9\u79cd\u65b9\u5f0f\u4fee\u6539\u540e\u7684 switch\u2026case \u8bed\u53e5\u5b9e\u73b0\uff0c\u4f60\u53ef\u4ee5\u5148\u89c2\u5bdf\u4e0b\uff0c\u5e76\u601d\u8003\u8fd9\u79cd\u65b9\u5f0f\u7684\u5b9e\u73b0\u601d\u8def\u3002</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u5c06 switch\u2026case \u8bed\u53e5\u4e2d\u5206\u652f\u7b5b\u9009\u7684\u201c\u8de8\u5ea6\u201d\u8fdb\u884c\u4e86\u51cf\u5c0f\uff0c\u5373\u5c06\u5176\u4e2d\u7684\u6700\u5927\u5206\u652f\u5339\u914d\u6761\u4ef6\u7531 60 \u51cf\u5c0f\u5230\u4e86 40\u3002\u8df3\u8868\u662f\u4e00\u79cd\u7528\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u6761\u4ef6\u5339\u914d\u7b56\u7565\uff0c\u8ba9\u6211\u4eec\u901a\u8fc7\u4e0a\u56fe\u53f3\u4fa7\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u6765\u4e86\u89e3\u5b83\u7684\u5b9e\u73b0\u8fc7\u7a0b\u3002</p> <ol> <li>\u9996\u5148\uff0c\u6807\u6ce8\u4e3a\u7ea2\u8272\u7684\u6c47\u7f16\u4ee3\u7801\u5c06\u53d8\u91cf v \u7684\u503c\u51cf\u53bb\u4e86\u9009\u62e9\u8bed\u53e5\u4e2d\u6700\u5c0f\u5339\u914d\u6761\u4ef6\u7684\u503c\uff0c\u8fd9\u91cc\u4e5f\u5c31\u662f 10\u3002</li> <li>\u7136\u540e\uff0c\u7a0b\u5e8f\u901a\u8fc7 <code>cmp</code> \u4e0e <code>ja</code> \u6307\u4ee4\uff0c\u5224\u65ad\u53d8\u91cf v \u7684\u503c\u662f\u5426\u8d85\u8fc7\u4e86\u9009\u62e9\u8bed\u53e5\u4e2d\u6700\u5927\u5339\u914d\u6761\u4ef6\u4e0e\u6700\u5c0f\u5339\u914d\u6761\u4ef6\u4e4b\u95f4\u7684\u5dee\u503c\uff0c\u8fd9\u91cc\u4e5f\u5c31\u662f 30\u3002<ol> <li>\u82e5\u662f\uff0c\u5219\u7a0b\u5e8f\u76f4\u63a5\u8df3\u8f6c\u5230\u6807\u7b7e .LBB0_3 \u5904\uff0c\u5e76\u8fd4\u56de\u6570\u503c 3\u3002</li> <li>\u5426\u5219\uff0c\u7a0b\u5e8f\u5c31\u4f1a\u4f7f\u7528\u8df3\u8868\u6765\u5bfb\u627e\u53d8\u91cf v \u7684\u503c\u5bf9\u5e94\u7684\u6b63\u786e\u5206\u652f\u3002</li> </ol> </li> <li> <p>\u6240\u8c13\u8df3\u8868\uff0c\u5373\u5728\u4e00\u6bb5\u8fde\u7eed\u5185\u5b58\u4e2d\u5b58\u653e\u7684\uff0c\u53ef\u7528\u4e8e\u8f85\u52a9\u67e5\u627e\u6b63\u786e\u76ee\u6807\u5730\u5740\u7684\u5730\u5740\u4fe1\u606f\u3002</p> <ol> <li>\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u8df3\u8868\u4ece\u6807\u7b7e .LJTI0_0 \u5904\u5f00\u59cb\u3002\u5728\u8fd9\u6bb5\u5185\u5b58\u4e2d\uff0c\u8fde\u7eed\u5b58\u653e\u4e86\u7b5b\u9009\u503c 10 \u5230 40 \u533a\u95f4\u5185\uff0c\u6bcf\u4e00\u4e2a\u6574\u6570\u503c\u5bf9\u5e94\u7684\u6b63\u786e\u5206\u652f\u5904\u7406\u5730\u5740\u3002\u63a5\u4e0b\u6765\u7684\u84dd\u8272\u4ee3\u7801\u4fdd\u5b58\u4e86\u5f53\u8df3\u8868\u7b2c 0 \u9879\u201c\u547d\u4e2d\u201d\u65f6\uff0c\u51fd\u6570\u9700\u8981\u8fd4\u56de\u7684\u503c\u3002</li> </ol> </li> <li> <p>\u5047\u8bbe\u5728\u8c03\u7528\u51fd\u6570 foo \u65f6\uff0c\u4f20\u5165\u53d8\u91cf v \u7684\u503c\u4e3a 20\u3002\u865a\u7ebf\u6846\u4e2d\u7684 <code>jmp</code> \u6307\u4ee4\u5728\u6267\u884c\u65f6\uff0c\u4f1a\u6839\u636e v \u7684\u503c\u5728\u8df3\u8868\u4e2d\u627e\u5230\u5b83\u6240\u5bf9\u5e94\u7684\u6b63\u786e\u5206\u652f\u5730\u5740\u3002\u7531\u4e8e\u8fd9\u91cc <code>rdi</code> \u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u4e3a 10\uff0820 - 10\uff09\uff0c\u56e0\u6b64\u6b63\u786e\u7684\u5206\u652f\u5904\u7406\u5730\u5740\u4fbf\u662f\u8df3\u8868\u4e2d\u7b2c\u5341\u9879\u5bf9\u5e94\u7684\u503c\u3002</p> </li> <li>\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u5728 .LJTI0_0 \u6807\u7b7e +80 \u5b57\u8282\u7684\u4f4d\u7f6e\uff08.quad \u4ee3\u8868 8 \u5b57\u8282\u6570\u636e\uff09\u5904\uff0c\u6b63\u5bf9\u5e94\u7740\u6807\u7b7e .LBB0_4 \u7684\u5730\u5740\u3002\u800c\u8be5\u6807\u7b7e\u7684\u4f4d\u7f6e\uff0c\u6b63\u662f\u53d8\u91cf v \u4e3a\u503c 20 \u65f6\u7684\u6b63\u786e\u5206\u652f\u5904\u7406\u5730\u5740\u3002</li> </ol> </li> </ul> <p>\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u8fd9\u4e9b\u7f16\u8bd1\u5668\u5728\u5b9e\u73b0\u5206\u652f\u8bed\u53e5\u65f6\u4f7f\u7528\u7684\u5e38\u7528\u65b9\u5f0f\u5916\uff0c\u6839\u636e\u5206\u652f\u8bed\u53e5\u7684\u5177\u4f53\u60c5\u51b5\uff0c\u7f16\u8bd1\u5668\u8fd8\u53ef\u80fd\u4f1a\u91c7\u7528\u67d0\u4e9b\u9488\u5bf9\u7279\u5b9a\u5f62\u6001\u4ee3\u7801\u7684\u4e13\u7528\u4f18\u5316\u3002\u800c\u5373\u4f7f\u9488\u5bf9\u6700\u201c\u539f\u59cb\u201d\u7684 <code>cmp</code> \u52a0\u6761\u4ef6\u8df3\u8f6c\u8bed\u53e5\u7ec4\u5408\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7f16\u8bd1\u5668\u4e5f\u4f1a\u6839\u636e C \u6e90\u4ee3\u7801\u7684\u60c5\u51b5\uff0c\u9002\u5f53\u4f7f\u7528\u201c\u4e8c\u5206\u6cd5\u201d\u7b49\u4f18\u5316\u7b56\u7565\uff0c\u6765\u52a0\u5feb\u6761\u4ef6\u7684\u7b5b\u9009\u8fc7\u7a0b\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_13","title":"\u8fed\u4ee3\u8bed\u53e5","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u8fed\u4ee3\u8bed\u53e5\u4e3b\u8981\u5305\u542b do\u2026while\u3001for\u3001while \u8fd9\u4e09\u79cd\u57fa\u672c\u8bed\u6cd5\u5f62\u5f0f\u3002\u8fd9\u4e9b\u8bed\u53e5\u9664\u4e86\u5728\u6267\u884c\u7ec6\u8282\u4e0a\u6709\u4e9b\u8bb8\u5dee\u5f02\u5916\uff0c\u5176\u5bf9\u5e94\u7684\u6c47\u7f16\u5b9e\u73b0\u601d\u8def\u5927\u540c\u5c0f\u5f02\u3002\u8fd9\u91cc\u6211\u4ee5 do\u2026while \u8bed\u53e5\u4e3a\u4f8b\u6765\u8bb2\u89e3\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u771f\u6b63\u5bf9\u53d8\u91cf v \u8fdb\u884c\u6761\u4ef6\u5224\u65ad\u4e4b\u524d\uff0c\u7a0b\u5e8f\u5df2\u7ecf\u6267\u884c\u4e86\u4e00\u6b21 <code>printf</code> \u51fd\u6570\uff0c\u800c\u8fd9\u4fbf\u662f do\u2026while \u8bed\u53e5\u76f8\u8f83\u4e8e\u5176\u4ed6\u8fed\u4ee3\u8bed\u53e5\u7684\u7279\u70b9\u3002</p> <p>\u8fed\u4ee3\u8fc7\u7a0b\u4ee5 .L2 \u6807\u7b7e\u4f5c\u4e3a\u6bcf\u6b21\u7684\u8d77\u59cb\u70b9\uff0c\u6bcf\u6b21\u8fed\u4ee3\u90fd\u9075\u5faa\u7740\u201c\u5148\u6267\u884c\u5faa\u73af\u4f53\uff0c\u518d\u5224\u65ad\u6761\u4ef6\u201d\u7684\u89c4\u5219\u3002\u6761\u4ef6\u7684\u5224\u65ad\u548c\u6267\u884c\u8f6c\u79fb\u6d41\u7a0b\u5219\u5206\u522b\u7531\u6307\u4ee4 <code>test</code> \u4e0e <code>jne</code> \u8d1f\u8d23\u8fdb\u884c\u3002</p> <p>\u5373\u4f7f\u662f\u5728\u9ad8\u4f18\u5316\u7b49\u7ea7\u4e0b\uff0cC \u8bed\u8a00\u4e2d\u7684\u8fd9\u4e09\u79cd\u57fa\u672c\u8fed\u4ee3\u8bed\u53e5\u5728\u673a\u5668\u5c42\u9762\u7684\u6c47\u7f16\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u4e0d\u4f1a\u6709\u8f83\u5927\u7684\u5dee\u5f02\uff0c\u4f46\u8fd9\u4e5f\u5e76\u4e0d\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u5b83\u4eec\u3002\u81f3\u5c11\u5bf9\u4e8e do\u2026while \u4e0e while \u800c\u8a00\uff0c\u5b83\u4eec\u5728\u6267\u884c\u7ec6\u8282\u4e0a\u5b58\u5728\u7740\u5dee\u5f02\uff0c\u5982\u679c\u4e0d\u5047\u601d\u7d22\u5730\u4f7f\u7528\uff0c\u5f88\u53ef\u80fd\u4f1a\u7ed9\u4f60\u7684\u7a0b\u5e8f\u62db\u81f4\u4e0d\u5fc5\u8981\u4e14\u96be\u4ee5\u8c03\u8bd5\u7684 BUG\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_14","title":"\u8df3\u8f6c\u8bed\u53e5","text":"<p>C \u8bed\u8a00\u4e2d\u7684\u8df3\u8f6c\u8bed\u53e5\u4e3b\u8981\u6307\u90a3\u4e9b\u53ef\u4ee5\u6539\u53d8\u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b\u7684\u8bed\u6cd5\u7ed3\u6784\uff0c\u5b83\u4eec\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u56db\u79cd\u7c7b\u578b\uff1a</p> <p><code>break \u8bed\u53e5\uff1b</code></p> <p><code>continue \u8bed\u53e5\uff1b</code></p> <p><code>return \u8bed\u53e5\uff1b</code></p> <p><code>goto \u8bed\u53e5</code></p> <p>\u5176\u4e2d\uff0creturn \u8bed\u53e5\u7684\u6267\u884c\u7ec6\u8282\u6d89\u53ca\u5230\u4e86\u51fd\u6570\u7684\u8c03\u7528\u4e0e\u8fd4\u56de\uff0c\u56e0\u6b64\u6211\u4f1a\u5728 04-05 \u8bb2\u4e2d\u4e3a\u4f60\u8be6\u7ec6\u4ecb\u7ecd\u3002</p> <p>\u800c\u5bf9\u4e8e\u53e6\u5916\u4e09\u79cd\u8bed\u53e5\uff0c\u76f8\u4fe1\u5c31\u7b97\u4e0d\u53c2\u8003\u5b9e\u9645\u4ee3\u7801\uff0c\u5bf9\u4e8e\u5b83\u4eec\u7684\u5b9e\u73b0\u201c\u5957\u8def\u201d\uff0c\u4f60\u4e5f\u5df2\u7ecf\u5fc3\u4e2d\u6709\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u57fa\u672c\u529f\u80fd\u5747\u662f\u6539\u53d8\u7a0b\u5e8f\u7684\u5177\u4f53\u6267\u884c\u6d41\u7a0b\u3002 </p> <p>\u5728 C \u4ee3\u7801\u4e2d\uff0c\u7528\u4e8e\u63a7\u5236\u7a0b\u5e8f\u6267\u884c\u903b\u8f91\u7684\u5927\u90e8\u5206\u8bed\u53e5\uff0c\u5176\u80cc\u540e\u90fd\u662f\u901a\u8fc7==\u6761\u4ef6\u8df3\u8f6c\u8bed\u53e5==\u6765\u5b9e\u73b0\u7684\u3002\u7f16\u8bd1\u5668\u901a\u8fc7\u4ee3\u7801\u5206\u6790\uff0c\u53ef\u4ee5\u627e\u5230\u7a0b\u5e8f\u4e2d\u53ef\u80fd\u7684\u201c\u8df3\u5165\u70b9\u201d\u4e0e\u201c\u8df3\u51fa\u70b9\u201d\uff0c\u5e76\u5728\u673a\u5668\u6307\u4ee4\u5c42\u9762\u901a\u8fc7 je \u7b49\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\uff0c\u6765\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u5728\u8fd9\u4e9b\u70b9\u4e4b\u95f4\u8fdb\u884c\u8f6c\u79fb\u3002</p> <p>\u5728x86-64\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u6761\u4ef6\u8df3\u8f6c\u8bed\u53e5\u901a\u5e38\u57fa\u4e8e\u6807\u5fd7\u5bc4\u5b58\u5668\uff08Flags Register\uff09\u7684\u72b6\u6001\u6765\u786e\u5b9a\u662f\u5426\u8df3\u8f6c\u3002</p> <ol> <li>\u65e0\u6761\u4ef6\u8df3\u8f6c\uff1a</li> <li><code>jmp</code>\uff1a\u65e0\u6761\u4ef6\u8df3\u8f6c\u5230\u6307\u5b9a\u7684\u5730\u5740\u3002</li> <li>\u6761\u4ef6\u8df3\u8f6c\uff1a</li> <li><code>je</code>\uff08Jump if Equal\uff09\uff1a\u5f53\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>jne</code>\uff08Jump if Not Equal\uff09\uff1a\u5f53\u4e0d\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>jz</code>\uff08Jump if Zero\uff09\uff1a\u5f53\u4e3a\u96f6\u65f6\u8df3\u8f6c\u3002</li> <li><code>jnz</code>\uff08Jump if Not Zero\uff09\uff1a\u5f53\u4e0d\u4e3a\u96f6\u65f6\u8df3\u8f6c\u3002</li> <li><code>js</code>\uff08Jump if Sign\uff09\uff1a\u5f53\u4e3a\u8d1f\u65f6\u8df3\u8f6c\u3002</li> <li><code>jns</code>\uff08Jump if Not Sign\uff09\uff1a\u5f53\u4e0d\u4e3a\u8d1f\u65f6\u8df3\u8f6c\u3002</li> <li><code>jo</code>\uff08Jump if Overflow\uff09\uff1a\u5f53\u6ea2\u51fa\u65f6\u8df3\u8f6c\u3002</li> <li><code>jno</code>\uff08Jump if No Overflow\uff09\uff1a\u5f53\u6ca1\u6709\u6ea2\u51fa\u65f6\u8df3\u8f6c\u3002</li> <li><code>jl</code>\uff08Jump if Less\uff09\uff1a\u5f53\u5c0f\u4e8e\u65f6\u8df3\u8f6c\uff08\u6709\u7b26\u53f7\uff09\u3002</li> <li><code>jge</code>\uff08Jump if Greater or Equal\uff09\uff1a\u5f53\u5927\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\uff08\u6709\u7b26\u53f7\uff09\u3002</li> <li><code>jb</code>\uff08Jump if Below\uff09\uff1a\u5f53\u4f4e\u4e8e\u65f6\u8df3\u8f6c\uff08\u65e0\u7b26\u53f7\uff09\u3002</li> <li><code>jae</code>\uff08Jump if Above or Equal\uff09\uff1a\u5f53\u5927\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\uff08\u65e0\u7b26\u53f7\uff09\u3002</li> <li>\u5faa\u73af\u8df3\u8f6c\uff1a</li> <li><code>loop</code>\uff1a\u5faa\u73af\u8df3\u8f6c\uff0c\u6839\u636e\u8ba1\u6570\u5bc4\u5b58\u5668\u7684\u503c\u5224\u65ad\u662f\u5426\u7ee7\u7eed\u5faa\u73af\u3002 </li> </ol> <p>ARM/ARM64/RISC-V\uff1a</p> <ol> <li>ARM\u4f53\u7cfb\u7ed3\u6784\uff1a</li> <li><code>beq</code>\uff08Branch if Equal\uff09\uff1a\u5f53\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>bne</code>\uff08Branch if Not Equal\uff09\uff1a\u5f53\u4e0d\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>bgt</code>\uff08Branch if Greater Than\uff09\uff1a\u5f53\u5927\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li><code>blt</code>\uff08Branch if Less Than\uff09\uff1a\u5f53\u5c0f\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li><code>bge</code>\uff08Branch if Greater Than or Equal\uff09\uff1a\u5f53\u5927\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li> <p><code>ble</code>\uff08Branch if Less Than or Equal\uff09\uff1a\u5f53\u5c0f\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\u3002</p> </li> <li> <p>ARM64\u4f53\u7cfb\u7ed3\u6784\uff1a</p> </li> <li><code>b.eq</code>\uff08Branch if Equal\uff09\uff1a\u5f53\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>b.ne</code>\uff08Branch if Not Equal\uff09\uff1a\u5f53\u4e0d\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>b.gt</code>\uff08Branch if Greater Than\uff09\uff1a\u5f53\u5927\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li><code>b.lt</code>\uff08Branch if Less Than\uff09\uff1a\u5f53\u5c0f\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li><code>b.ge</code>\uff08Branch if Greater Than or Equal\uff09\uff1a\u5f53\u5927\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li> <p><code>b.le</code>\uff08Branch if Less Than or Equal\uff09\uff1a\u5f53\u5c0f\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\u3002</p> </li> <li> <p>RISC-V\u4f53\u7cfb\u7ed3\u6784\uff1a</p> </li> <li><code>beq</code>\uff08Branch if Equal\uff09\uff1a\u5f53\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>bne</code>\uff08Branch if Not Equal\uff09\uff1a\u5f53\u4e0d\u76f8\u7b49\u65f6\u8df3\u8f6c\u3002</li> <li><code>blt</code>\uff08Branch if Less Than\uff09\uff1a\u5f53\u5c0f\u4e8e\u65f6\u8df3\u8f6c\u3002</li> <li><code>bge</code>\uff08Branch if Greater Than or Equal\uff09\uff1a\u5f53\u5927\u4e8e\u7b49\u4e8e\u65f6\u8df3\u8f6c\u3002 </li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_15","title":"\u601d\u8003\u9898","text":"<ul> <li>\u7a7a\u8bed\u53e5 <code>;</code> \u5728 C \u8bed\u8a00\u4e2d\u6709\u54ea\u4e9b\u4f7f\u7528\u65b9\u5f0f\uff1f</li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#04","title":"04\uff5c\u4ee3\u7801\u5c01\u88c5\uff08\u4e0a\uff09\uff1a\u51fd\u6570\u662f\u5982\u4f55\u88ab\u8c03\u7528\u7684\uff1f","text":"<p>\u8fd9\u4e00\u8bb2\uff0c\u6211\u4eec\u9996\u5148\u6765\u770b C \u8bed\u8a00\u4e2d\uff0c\u7f16\u8bd1\u5668\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u65f6\u6240\u9075\u5faa\u7684\u4e00\u7cfb\u5217\u89c4\u5219\u3002\u8fd9\u4e9b\u89c4\u5219\u5b9e\u9645\u5f71\u54cd\u7740\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u5728\u5982\u4f55\u4f20\u53c2\u3001\u5982\u4f55\u4f7f\u7528\u5bc4\u5b58\u5668\u548c\u6808\u5185\u5b58\u7b49\u95ee\u9898\u4e0a\u7684\u5904\u7406\u7ec6\u8282\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;tgmath.h&gt;\n\ntypedef struct {\n  int x;\n  int y;\n} Point;\n\nint foo(int x, int y, Point* p, int(handler)(int)) {\n  return handler(x + y + p-&gt;x + p-&gt;y);\n}\n\nint handler(int n) {\n  return sqrt(n);\n}\nint main(void) {\n  int x = 2;\n  int y = 3;\n  Point p = { .x = 10, .y = 10 };\n  printf(\"%d\", foo(x, y, &amp;p, handler));  // 5.\n  return 0;\n} \n</code></pre> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u51fd\u6570\u6709\u4e24\u79cd\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u201c\u503c\u201d\u4f20\u9012\u548c\u901a\u8fc7\u201c\u6307\u9488\u201d\u4f20\u9012\u3002</p> <ul> <li>\u5bf9\u4e8e\u503c\u4f20\u9012\u7684\u65b9\u5f0f\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u5c06\u4f20\u5165\u51fd\u6570\u7684\u53c2\u6570\u503c\u8fdb\u884c\u590d\u5236\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8c03\u7528\u65f6\u4f20\u5165\u51fd\u6570\u7684\u53c2\u6570\u4e0e\u5728\u51fd\u6570\u5185\u90e8\u4f7f\u7528\u7684\u53c2\u6570\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u5b9e\u4f53\u3002</li> <li>\u4f7f\u7528\u6307\u9488\u5f62\u5f0f\u4f20\u5165\u7684\u53c2\u6570\uff0c\u56e0\u4e3a\u6307\u9488\u6240\u8868\u793a\u7684\u5730\u5740\u5728\u4f20\u5165\u51fd\u6570\u524d\u540e\u5747\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u5982\u679c\u5728\u51fd\u6570\u5185\u90e8\u4fee\u6539\u6307\u9488\u53c2\u6570\u6240\u6307\u5411\u7684\u503c\uff0c\u5219\u53d1\u751f\u5728\u8be5\u503c\u4e0a\u7684\u53d8\u5316\uff0c\u5728\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u540e\u4e5f\u5c06\u4e00\u76f4\u5b58\u5728\u3002</li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#c","title":"C \u51fd\u6570\u7684\u8c03\u7528\u7ea6\u5b9a","text":"<p>C \u6807\u51c6\u4e2d\u5e76\u672a\u89c4\u5b9a\uff0c\u8bed\u8a00\u7684\u5404\u7c7b\u8bed\u6cd5\u7ed3\u6784\u5e94\u8be5\u4ee5\u600e\u6837\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u4ece\u7f16\u8bd1\u5668\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u6bcf\u4e00\u4e2a\u51fd\u6570\u5728\u88ab\u8c03\u7528\u65f6\uff0c\u5e94\u8be5\u4ee5\u600e\u6837\u7684\u65b9\u5f0f\u901a\u8fc7\u673a\u5668\u6307\u4ee4\u6765\u5b9e\u73b0\u5176\u8c03\u7528\u8fc7\u7a0b\uff0c\u5374\u5b58\u5728\u7740\u76f8\u5e94\u7684\u4e8b\u5b9e\u6807\u51c6\u3002</p> <p>\u800c\u901a\u5e38\uff0c\u6211\u4eec\u628a\u7f16\u8bd1\u5668\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u65f6\u6240\u9075\u5faa\u7684\u4e00\u7cfb\u5217\u89c4\u5219\u79f0\u4e3a\u51fd\u6570\u7684 \u201c\u8c03\u7528\u7ea6\u5b9a\uff08Calling Convention\uff09\u201d\u3002</p> <p>\u8c03\u7528\u7ea6\u5b9a\u89c4\u5b9a\u4e86\u51fd\u6570\u8c03\u7528\u65f6\u9700\u8981\u5173\u6ce8\u7684\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u6bd4\u5982\uff1a\u5982\u4f55\u5c06\u5b9e\u53c2\u4f20\u9012\u7ed9\u88ab\u8c03\u7528\u51fd\u6570\u3001\u5982\u4f55\u5c06\u8fd4\u56de\u503c\u4ece\u88ab\u8c03\u7528\u51fd\u6570\u4e2d\u8fd4\u56de\u3001\u5982\u4f55\u7ba1\u7406\u5bc4\u5b58\u5668\uff0c\u4ee5\u53ca\u5982\u4f55\u7ba1\u7406\u6808\u5185\u5b58\uff0c\u7b49\u7b49\u3002</p> <p>\u8c03\u7528\u7ea6\u5b9a\u5e76\u975e C \u8bed\u8a00\u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u5b9e\u9645\u4e0a\u6bcf\u4e2a\u7f16\u8bd1\u5668\u90fd\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u72ec\u6709\u7684\u8c03\u7528\u7ea6\u5b9a\uff0c\u6765\u5b9e\u73b0 C \u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u3002</p> <p>\u4f46\u76f8\u5e94\u5730\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff1a\u5f53\u5177\u6709\u5916\u90e8\u94fe\u63a5\u7684\u51fd\u6570\u5728\u591a\u4e2a\u4e0d\u540c\u7f16\u8bd1\u5355\u5143\u5185\u88ab\u4f7f\u7528\uff0c\u4e14\u8fd9\u4e9b\u4e0d\u540c\u7f16\u8bd1\u5355\u5143\u5bf9\u5e94\u7684\u6e90\u6587\u4ef6\u901a\u8fc7\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u8fdb\u884c\u7f16\u8bd1\u65f6\uff0c\u90a3\u4e48\u5b83\u4eec\u5404\u81ea\u751f\u6210\u7684\u5bf9\u8c61\u6587\u4ef6\u53ef\u80fd\u65e0\u6cd5\u518d\u88ab\u6574\u5408\u5728\u4e00\u8d77\uff0c\u5e76\u751f\u6210\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u5e78\u8fd0\u7684\u662f\uff0c\u5bf9\u4e8e C \u8bed\u8a00\u6765\u8bf4\uff0c\u8fd0\u884c\u5728 x86-64 \u5e73\u53f0\u4e0a\u7684\u7f16\u8bd1\u5668\u57fa\u672c\u90fd\u4f1a\u6839\u636e\u6240\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e0d\u540c\uff0c\u9009\u62e9\u4f7f\u7528\u51e0\u79cd\u5e38\u89c1\u7684\u8c03\u7528\u7ea6\u5b9a\u4e8b\u5b9e\u6807\u51c6\u3002</p> <p>\u6bd4\u5982\uff0c\u5bf9\u4e8e Windows \u6765\u8bf4\uff0c\u7f16\u8bd1\u5668\u4f1a\u91c7\u7528\u4e13\u6709\u7684 Microsoft x64 \u6216 Vector \u8c03\u7528\u7ea6\u5b9a\u3002\u800c\u5728 Unix \u548c\u7c7b Unix \u7cfb\u7edf\u4e0a\uff0c\u5219\u4f1a\u4f7f\u7528\u540d\u4e3a System V AMD64 ABI\uff08\u540e\u7b80\u79f0 \u201c<code>SysV</code>\u201d\uff09\u7684\u8c03\u7528\u7ea6\u5b9a\u3002\u7c7b\u4f3c\u5730\uff0c\u5bf9\u4e8e i386\uff08IA32\uff09\u30018086 \u7b49\u5176\u4ed6\u5e73\u53f0\uff0c\u5b83\u4eec\u4e5f\u90fd\u6709\u7740\u5bf9\u5e94\u7684\u8c03\u7528\u7ea6\u5b9a\u4e8b\u5b9e\u6807\u51c6\u3002\u800c\u8f83\u4e3a\u7edf\u4e00\u7684\u8c03\u7528\u7ea6\u5b9a\uff0c\u4e5f\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4fdd\u8bc1\u4e86 C \u7a0b\u5e8f\u5728\u540c\u4e00\u5e73\u53f0\u4e0d\u540c\u7f16\u8bd1\u5668\u4e0b\u7684\u6700\u5927\u53ef\u79fb\u690d\u6027\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8ba9\u6211\u4eec\u770b\u770b <code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u4e2d\u90fd\u89c4\u5b9a\u4e86\u54ea\u4e9b\u91cd\u8981\u7684\u5b9e\u73b0\u7ec6\u8282\u3002\u4e3a\u4e86\u66f4\u76f4\u89c2\u5730\u89c2\u5bdf\u8fd9\u4e9b\u5185\u5bb9\uff0c\u8ba9\u6211\u4eec\u5148\u6765\u7f16\u5199\u4e00\u6bb5\u7b80\u5355\u7684 C \u4ee3\u7801\uff0c\u5e76\u5728 x86-64 \u5e73\u53f0\u4e0a\u4f7f\u7528\u9ed8\u8ba4\u4f18\u5316\u7b49\u7ea7\uff0c\u901a\u8fc7 GCC \u7f16\u8bd1\u751f\u6210\u5b83\u6240\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u3002\u5177\u4f53\u5982\u4e0b\u56fe\u6240\u793a\uff08\u5728\u540e\u9762\u63d0\u5230\u8fd9\u5f20\u56fe\u65f6\uff0c\u6211\u4f1a\u7edf\u4e00\u7528\u201c\u56fe A\u201d\u4ee3\u66ff\uff09\uff1a</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u5de6\u4fa7\u4e3a C \u4ee3\u7801\uff0c\u53f3\u4fa7\u4e3a\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u76f8\u540c\u989c\u8272\u7684\u4ee3\u7801\u5757\u8868\u793a\u6e90\u4ee3\u7801\u4e0e\u6c47\u7f16\u4ee3\u7801\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <p>\u5728 C \u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u540d\u4e3a bar \u4e0e foo \u7684\u4e24\u4e2a\u51fd\u6570\uff0c\u5e76\u5728 foo \u4e2d\u8c03\u7528\u4e86 bar\u3002bar \u51fd\u6570\u4e0d\u63a5\u6536\u4efb\u4f55\u53c2\u6570\uff0c\u8c03\u7528\u540e\u76f4\u63a5\u8fd4\u56de\u6574\u578b\u503c 10\u3002foo \u51fd\u6570\u5171\u63a5\u6536 8 \u4e2a\u53c2\u6570\uff0c\u8c03\u7528\u540e\u8fd4\u56de\u5176\u5185\u90e8\u6574\u578b\u53d8\u91cf n \u4e0e\u51fd\u6570 bar \u8c03\u7528\u8fd4\u56de\u503c\u7684\u548c\u3002</p> <p>\u5728 main \u51fd\u6570\u4e2d\uff0c\u5b9a\u4e49\u6709\u4e24\u4e2a\u6574\u578b\u5c40\u90e8\u53d8\u91cf x \u4e0e y\uff0c\u800c\u5f53\u51fd\u6570 foo \u88ab\u8c03\u7528\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e24\u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u4ee5\u53ca\u53e6\u5916\u7684 6 \u4e2a\u5b57\u9762\u91cf\u6570\u5b57\u503c\u4f5c\u4e3a\u5b83\u7684\u53c2\u6570\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728 x86-64 \u7684\u673a\u5668\u6307\u4ee4\u4e2d\uff0c\u51fd\u6570\u8c03\u7528\u662f\u901a\u8fc7 call \u6307\u4ee4\u6765\u5b8c\u6210\u3002\u800c\u6bcf\u4e00\u4e2a\u51fd\u6570\u4f53\u5728\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u90fd\u9700\u8981\u518d\u901a\u8fc7 ret \u6307\u4ee4\u6765\u9000\u51fa\u51fd\u6570\u7684\u6267\u884c\uff0c\u5e76\u8f6c\u79fb\u4ee3\u7801\u6267\u884c\u6d41\u7a0b\u5230\u4e4b\u524d\u51fd\u6570\u8c03\u7528\u6307\u4ee4\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u4e0a\u3002\u5982\u4e0b\u56fe\u4ee3\u7801\u7684\u6574\u4f53\u6267\u884c\u987a\u5e8f\uff1a</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_16","title":"\u53c2\u6570\u4f20\u9012","text":"<ul> <li> <p>\u6574\u578b\u548c\u6307\u9488\u7c7b\u578b\u7684\u5b9e\u53c2</p> <p><code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u662f\uff1a\u5728\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u5bf9\u4e8e\u6574\u578b\u548c\u6307\u9488\u7c7b\u578b\u7684\u5b9e\u53c2\uff0c\u9700\u8981\u5206\u522b\u4f7f\u7528\u5bc4\u5b58\u5668 <code>rdi\u3001rsi\u3001rdx\u3001rcx\u3001r8\u3001r9</code>\uff0c\u6309\u51fd\u6570\u5b9a\u4e49\u65f6\u53c2\u6570\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u8fdb\u884c\u4f20\u503c\u3002</p> <p>\u800c\u82e5\u4e00\u4e2a\u51fd\u6570\u63a5\u6536\u7684\u53c2\u6570\u8d85\u8fc7\u4e86 6 \u4e2a\uff0c\u5219\u4f59\u4e0b\u53c2\u6570\u5c06\u901a\u8fc7\u6808\u5185\u5b58\u8fdb\u884c\u4f20\u9001\u3002\u6b64\u65f6\uff0c\u591a\u51fa\u6765\u7684\u53c2\u6570\u5c06\u6309\u7167\u4ece\u53f3\u5f80\u5de6\uff08RTL\uff09\u7684\u987a\u5e8f\u88ab\u9010\u4e2a\u538b\u5165\u6808\u4e2d\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u56fe A \u53f3\u4fa7\u7b2c 30 \u5230 40 \u884c\u7ea2\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u5f97\u5230\u9a8c\u8bc1\uff1a</p> <p>\u8fd9\u91cc\uff0c\u51fd\u6570 foo \u5728\u8c03\u7528\u524d\uff0c\u5206\u522b\u7528\u5bc4\u5b58\u5668 <code>edi\u3001esi</code> \u5b58\u653e\u5c40\u90e8\u53d8\u91cf x \u4e0e y \u7684\u503c\uff0c\u5e76\u7528\u5bc4\u5b58\u5668 <code>edx\u3001ecx\u3001r8d\u3001r9d</code> \u5b58\u653e\u5b57\u9762\u91cf\u503c 3\u30014\u30015\u30016\uff08\u5982\u679c\u4f60\u8fd8\u4e0d\u4e86\u89e3\u5bc4\u5b58\u5668 <code>rdi</code> \u4e0e <code>edi</code> \u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u5728\u8bfe\u524d\u70ed\u8eab\u4e00\u8bb2\u4e2d\u5f97\u5230\u7b54\u6848\uff09\u3002</p> <p>\u800c\u591a\u51fa\u6765\u7684\u53e6\u5916\u4e24\u4e2a\u5b57\u9762\u91cf\u503c\u53c2\u6570 7 \u548c 8 \uff0c\u5219\u76f4\u63a5\u901a\u8fc7 push \u6307\u4ee4\u88ab\u653e\u5728\u4e86\u6808\u5185\u5b58\u4e2d\u3002\u4f60\u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u6307\u4ee4\u64cd\u4f5c\u5b83\u4eec\u7684\u5148\u540e\u987a\u5e8f\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u53c2\u6570\u4ee5\u4ece\u53f3\u5411\u5de6\u7684\u987a\u5e8f\u88ab\u653e\u5165\u6808\u4e2d\u3002\u53e6\u5916\uff0c\u7531\u4e8e x\u3001y \u4e3a\u5c40\u90e8\u53d8\u91cf\uff0c\u56e0\u6b64\u6700\u5f00\u59cb\u5b83\u4eec\u4f1a\u88ab\u5b58\u50a8\u5728\u6808\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u6d6e\u70b9\u53c2\u6570</p> <p>\u5bf9\u4e8e\u6d6e\u70b9\u53c2\u6570\uff0c\u7f16\u8bd1\u5668\u5c06\u4f1a\u4f7f\u7528\u53e6\u5916\u7684 <code>xmm0</code> \u5230 <code>xmm7</code>\uff0c\u5171 8 \u4e2a\u5bc4\u5b58\u5668\u8fdb\u884c\u5b58\u50a8\u3002\u5bf9\u4e8e\u66f4\u5bbd\u7684\u503c\uff0c\u4e5f\u53ef\u80fd\u4f1a\u4f7f\u7528 <code>ymm</code> \u4e0e <code>zmm</code> \u5bc4\u5b58\u5668\u6765\u66ff\u4ee3 <code>xmm</code> \u5bc4\u5b58\u5668\u3002\u800c\u4e0a\u9762\u63d0\u5230\u7684 <code>xmm\u3001ymm\u3001zmm</code> \u5bc4\u5b58\u5668\uff0c\u90fd\u662f\u7531 x86 \u6307\u4ee4\u96c6\u67b6\u6784\u4e2d\u540d\u4e3a AVX\uff08Advanced Vector Extensions\uff09\u7684\u6269\u5c55\u6307\u4ee4\u96c6\u4f7f\u7528\u7684\u3002\u8fd9\u4e9b\u6307\u4ee4\u96c6\u4e00\u822c\u4e13\u95e8\u7528\u4e8e\u6d6e\u70b9\u6570\u8ba1\u7b97\u4ee5\u53ca SIMD \u76f8\u5173\u7684\u5904\u7406\u8fc7\u7a0b\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_17","title":"\u8fd4\u56de\u503c\u4f20\u9012","text":"<p>\u5bf9\u4e8e\u51fd\u6570\u8c03\u7528\u4ea7\u751f\u7684\u8fd4\u56de\u503c\uff0c<code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u4e5f\u6709\u76f8\u5e94\u7684\u89c4\u5219\uff1a</p> <ul> <li>\u5f53\u51fd\u6570\u8c03\u7528\u4ea7\u751f\u6574\u6570\u7c7b\u578b\u7684\u8fd4\u56de\u503c\uff0c\u4e14\u5c0f\u4e8e\u7b49\u4e8e 64 \u4f4d\u65f6\uff0c\u901a\u8fc7\u5bc4\u5b58\u5668 rax \u8fdb\u884c\u4f20\u9012\uff1b</li> <li>\u5f53\u5927\u4e8e 64 \u4f4d\uff0c\u5c0f\u4e8e\u7b49\u4e8e 128 \u4f4d\u65f6\uff0c\u5219\u4f7f\u7528\u5bc4\u5b58\u5668 rax \u4e0e rdx \u5206\u522b\u5b58\u50a8\u8fd4\u56de\u503c\u7684\u4f4e 64 \u4f4d\u4e0e\u9ad8 64 \u4f4d\u3002</li> </ul> <p>\u53ef\u4ee5\u53c2\u8003\u56fe A \u53f3\u4fa7\u7b2c 4\u300121\u300147 \u884c\u84dd\u6846\u5185\u7684\u4ee3\u7801\uff0c\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u89c4\u5219\u3002\u8fd9\u4e09\u884c\u4ee3\u7801\u5206\u522b\u5904\u7406\u4e86\u51fd\u6570 bar\u3001foo\uff0c\u4ee5\u53ca main \u7684\u8fd4\u56de\u503c\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <ul> <li> <p>\u5bf9\u4e8e\u590d\u5408\u7c7b\u578b\uff08\u6bd4\u5982\u7ed3\u6784\u4f53\uff09\u7684\u8fd4\u56de\u503c\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u76f4\u63a5\u4f7f\u7528\u6808\u5185\u5b58\u8fdb\u884c\u201c\u4e2d\u8f6c\u201d\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6d6e\u70b9\u6570\u7c7b\u578b\u7684\u8fd4\u56de\u503c\uff0c\u540c\u53c2\u6570\u4f20\u9012\u7c7b\u4f3c\uff0c\u7f16\u8bd1\u5668\u4f1a\u9ed8\u8ba4\u4f7f\u7528 xmm0 \u4e0e xmm1 \u5bc4\u5b58\u5668\u8fdb\u884c\u5b58\u50a8\u3002\u800c\u5f53\u8fd4\u56de\u503c\u8fc7\u5927\u65f6\uff0c\u5219\u4f1a\u9009\u62e9\u6027\u4f7f\u7528 <code>ymm</code> \u4e0e <code>zmm</code> \u6765\u66ff\u4ee3 <code>xmm</code> \u5bc4\u5b58\u5668\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_18","title":"\u5bc4\u5b58\u5668\u4f7f\u7528","text":"<p><code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u5bf9\u5bc4\u5b58\u5668\u7684\u4f7f\u7528\u4e5f\u4f5c\u51fa\u4e86\u89c4\u5b9a\uff1a\u5bf9\u4e8e\u5bc4\u5b58\u5668 <code>rbx\u3001rbp\u3001rsp\uff0c\u4ee5\u53ca r12 \u5230 r15</code>\uff0c\u82e5\u88ab\u8c03\u7528\u51fd\u6570\u9700\u8981\u4f7f\u7528\u5b83\u4eec\uff0c\u5219\u9700\u8981\u8be5\u51fd\u6570\u5728\u4f7f\u7528\u4e4b\u524d\u5c06\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u8fdb\u884c\u6682\u5b58\uff0c\u5e76\u5728\u51fd\u6570\u9000\u51fa\u4e4b\u524d\u6062\u590d\u5b83\u4eec\u7684\u503c\uff08callee-saved \u88ab\u8c03\u7528\u8005\u4fdd\u5b58\uff09\u3002\u800c\u5bf9\u4e8e\u5176\u4ed6\u5bc4\u5b58\u5668\uff0c\u5219\u6839\u636e\u8c03\u7528\u65b9\u7684\u9700\u8981\uff0c\u81ea\u884c\u4fdd\u5b58\u548c\u6062\u590d\u5b83\u4eec\u7684\u503c\uff08caller-saved \u8c03\u7528\u8005\u4fdd\u5b58\uff09</p> <p>\u8be6\u7ec6\uff1a</p> <ol> <li>Caller-saved (\u8c03\u7528\u8005\u4fdd\u5b58):<ul> <li>\u5bf9\u4e8e\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\uff0c\u8c03\u7528\u51fd\u6570\u5728\u8c03\u7528\u88ab\u8c03\u7528\u51fd\u6570\u4e4b\u524d\u9700\u8981\u4fdd\u5b58\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4ee5\u9632\u6b62\u88ab\u8c03\u7528\u51fd\u6570\u4fee\u6539\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u5bfc\u81f4\u8c03\u7528\u51fd\u6570\u51fa\u9519\u3002\u8c03\u7528\u8005\u5728\u8c03\u7528\u88ab\u8c03\u7528\u51fd\u6570\u540e\u9700\u8981\u8d1f\u8d23\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u3002</li> <li>\u901a\u5e38\uff0ccaller-saved \u5bc4\u5b58\u5668\u5305\u62ec <code>rax\u3001rcx\u3001rdx\u3001rsi\u3001rdi\u3001r8-r11</code> \u7b49\u5bc4\u5b58\u5668\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u5728\u51fd\u6570\u8c03\u7528\u524d\u540e\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u8c03\u7528\u8005\u9700\u8981\u4fdd\u5b58\u548c\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u3002</li> </ul> </li> <li>Callee-saved (\u88ab\u8c03\u7528\u8005\u4fdd\u5b58):<ul> <li>\u5bf9\u4e8e\u88ab\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\uff0c\u88ab\u8c03\u7528\u51fd\u6570\u5728\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e4b\u524d\u9700\u8981\u4fdd\u5b58\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4ee5\u4fbf\u5728\u51fd\u6570\u9000\u51fa\u65f6\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u786e\u4fdd\u8c03\u7528\u8005\u7684\u5bc4\u5b58\u5668\u503c\u4e0d\u88ab\u7834\u574f\u3002</li> <li>\u901a\u5e38\uff0ccallee-saved \u5bc4\u5b58\u5668\u5305\u62ec <code>rbx\u3001rbp\u3001rsp\uff0c\u4ee5\u53ca r12-r15</code> \u7b49\u5bc4\u5b58\u5668\u3002\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u5728\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\u4e2d\u5e94\u8be5\u4fdd\u6301\u4e0d\u53d8\uff0c\u88ab\u8c03\u7528\u51fd\u6570\u9700\u8981\u8d1f\u8d23\u4fdd\u5b58\u548c\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u3002</li> </ul> </li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_19","title":"\u5806\u6808\u6e05\u7406","text":"<p>==\u6bcf\u4e00\u4e2a\u51fd\u6570\u5728\u8c03\u7528\u7ed3\u675f\u524d\uff0c\u90fd\u9700\u8981\u7531\u5b83\u81ea\u8eab\u5b8c\u6210\u5806\u6808\u7684\u6e05\u7406\u5de5\u4f5c\u3002==\u6bd4\u5982\u5728\u56fe A \u6240\u793a\u7684\u4ee3\u7801\u4e2d\uff0cfoo \u51fd\u6570\u5728\u88ab\u8c03\u7528\u65f6\uff0c\u5b83\u5728\u6808\u5185\u5b58\u4e2d\u5206\u914d\u4e86\u5bf9\u5e94\u7684\u7a7a\u95f4\uff0c\u7528\u4e8e\u5b58\u653e\u5c40\u90e8\u53d8\u91cf n \u7684\u503c\u3002\u800c\u5728\u8be5\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c\u51c6\u5907\u9000\u51fa\u524d\uff0c\u4fbf\u9700\u8981\u7531\u5b83\u81ea\u5df1\u5c06\u4e4b\u524d\u5728\u6808\u4e0a\u5206\u914d\u7684\u6570\u636e\u6e05\u7406\u5e72\u51c0\u3002</p> <p>--&gt; \u800c\u8fd9\u4e2a\u4efb\u52a1\u662f\u53ef\u4ee5\u7531 leave \u6307\u4ee4\u6765\u5b8c\u6210\u7684\u3002\u6211\u4f1a\u5728\u63a5\u4e0b\u6765\u8bb2\u89e3\u201c\u6808\u5e27\u201d\u65f6\uff0c\u518d\u6df1\u5165\u4ecb\u7ecd\u4e0e\u8be5\u6307\u4ee4\u76f8\u5173\u7684\u5185\u5bb9\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5bf9\u4e8e foo \u51fd\u6570\u88ab\u8c03\u7528\u524d\u6240\u4f20\u5165\u5b9e\u53c2\u7684\u6e05\u7406\u5de5\u4f5c\uff0c\u5219\u662f\u7531\u8c03\u7528\u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u8fd9\u91cc\u7684 main \u51fd\u6570\u6765\u5b8c\u6210\u7684\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u5f53 foo \u51fd\u6570\u8c03\u7528\u7ed3\u675f\uff0c\u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b\u8fd4\u56de\u5230\u4e4b\u524d call \u6307\u4ee4\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u65f6\uff0c\u7a0b\u5e8f\u901a\u8fc7 add \u6307\u4ee4\u4fee\u6539\u4e86 <code>rsp</code> \u5bc4\u5b58\u5668\u7684\u503c\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cmain \u51fd\u6570\u5bf9\u4e4b\u524d\u653e\u5165\u6808\u4e2d\u4f20\u9012\u7ed9\u51fd\u6570 foo \u7684\u5b9e\u53c2\u8fdb\u884c\u4e86\u6e05\u7406\u3002(\u6ce8\u610f\u9ad8\u5730\u5740\u662f\u6808\u5e95)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_20","title":"\u5176\u4ed6\u7ea6\u5b9a","text":"<p>\u9664\u6b64\u4e4b\u5916\uff0c<code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u8fd8\u6709\u4e0b\u9762\u8fd9\u51e0\u70b9\u89c4\u5b9a\uff1a</p> <ul> <li>\u51fd\u6570\u5728\u88ab call \u6307\u4ee4\u8c03\u7528\u524d\uff0c\u9700\u8981\u4fdd\u8bc1\u6808\u9876\u4e8e 16 \u5b57\u8282\u5bf9\u9f50\uff0c\u4e5f\u5c31\u662f\u6808\u9876\u7684\u6240\u5728\u5730\u5740\u503c\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\u662f 16 \u7684\u500d\u6570\uff1b</li> <li>\u4ece\u6808\u9876\u5411\u4e0a\u4fdd\u7559 128 \u5b57\u8282\u4f5c\u4e3a \u201cRed Zone\u201d\uff1b</li> <li>\u4e0d\u540c\u4e8e\u7528\u6237\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\uff0c\u7cfb\u7edf\u8c03\u7528\uff08System Call\uff09\u51fd\u6570\u9700\u4f7f\u7528\u5bc4\u5b58\u5668 <code>rdi\u3001rsi\u3001rdx\u3001r10\u3001r8\u3001r9</code> \u4f20\u9012\u53c2\u6570\u3002</li> </ul> <p>\u6211\u4eec\u6765\u91cd\u70b9\u770b\u770b\u7b2c\u4e8c\u70b9\uff1aRed Zone \u662f\u4f4d\u4e8e\u6808\u9876\u5411\u4e0a\uff08\u4f4e\u5730\u5740\u65b9\u5411\uff09\u7684\u4e00\u6bb5\u56fa\u5b9a\u957f\u5ea6\u7684\u5185\u5b58\u6bb5\uff0c\u8fd9\u5757\u533a\u57df\u901a\u5e38\u53ef\u4ee5\u88ab\u51fd\u6570\u8c03\u7528\u6808\u4e2d\u7684\u201c\u53f6\u5b50\u201d\u51fd\u6570\uff08\u5373\u4e0d\u518d\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u7684\u51fd\u6570\uff09\u4f7f\u7528\u3002</p> <p>\u8fd9\u6837\uff0c\u5728\u9700\u8981\u989d\u5916\u7684\u6808\u5185\u5b58\u65f6\uff0c\u5c31\u80fd\u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\u7701\u53bb\u5148\u8c03\u6574\u6808\u5185\u5b58\u5927\u5c0f\u7684\u8fc7\u7a0b\u3002</p> <p>\u800c\u6709\u5173\u7b2c\u4e09\u70b9\u4e2d\u6d89\u53ca\u5230\u7684\u4e0e\u7cfb\u7edf\u8c03\u7528\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u5728 3.\u8fd0\u884c\u7bc7\u7b14\u8bb0\u8bb2\u89e3</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_21","title":"\u4fdd\u5b58\u51fd\u6570\u8c03\u7528\u4fe1\u606f\u7684\u6808\u5e27","text":"<p>\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u4f34\u968f\u7740\u6808\u5185\u5b58\u4e2d\u6570\u636e\u7684\u4e0d\u65ad\u53d8\u5316\u3002\u4ece\u6574\u4f53\u4e0a\u6765\u770b\uff0c\u6bcf\u4e00\u4e2a\u51fd\u6570\u5728\u8c03\u7528\u65f6\uff0c\u90fd\u4f1a\u5728\u6808\u5185\u5b58\u4e2d\u5448\u73b0\u51fa\u57fa\u672c\u76f8\u540c\u7684\u6570\u636e\u5e03\u5c40\u7ed3\u6784\u3002\u800c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5212\u5206\u51fa\u6765\u7684\uff0c\u5bf9\u5e94\u4e8e\u6bcf\u4e00\u6b21\u51fd\u6570\u8c03\u7528\u7684\u6808\u5185\u5b58\u6570\u636e\u5757\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u5b83\u4e3a\u201c\u6808\u5e27\u201d\u3002 \u6808\u5e27\u4e2d\u5b58\u653e\u6709\u4e0e\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u76f8\u5173\u7684\u8fd4\u56de\u5730\u5740\u3001\u5b9e\u53c2\u3001\u5c40\u90e8\u53d8\u91cf\u3001\u8fd4\u56de\u503c\uff0c\u4ee5\u53ca\u6682\u5b58\u7684\u5bc4\u5b58\u5668\u503c\u7b49\u4fe1\u606f\u3002</p> <p>\u5728\u8fdb\u7a0b\u7684 VAS \u4e2d\uff0c\u6808\u5185\u5b58\u662f\u4ece\u9ad8\u5730\u5740\u5411\u4f4e\u5730\u5740\u9010\u6e10\u589e\u957f\u7684\uff0c\u5373\u6808\u5e95\u4f4d\u4e8e\u9ad8\u5730\u5740\u5904\uff0c\u6808\u9876\u4f4d\u4e8e\u4f4e\u5730\u5740\u5904\uff08\u8fd9\u4e9b\u601d\u8003\u7ed3\u8bba\u90fd\u662f\u4ece\u865a\u62df\u5185\u5b58\u7684\u89d2\u5ea6\u6765\u770b\u7684\uff09\u3002\u800c\u5f53\u4e00\u4e2a\u51fd\u6570\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u4f7f\u7528\u66f4\u591a\u7684\u6808\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u4fbf\u9700\u8981\u9996\u5148\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u6765\u6269\u5927\u8fdb\u7a0b\u7684\u53ef\u7528\u6808\u5185\u5b58\u5927\u5c0f\u3002</p> <p>\u901a\u8fc7\u64cd\u4f5c\u5bc4\u5b58\u5668 <code>rsp</code>\uff0c\u6211\u4eec\u4fbf\u53ef\u5b8c\u6210\u8fd9\u4e2a\u64cd\u4f5c\u3002<code>rsp</code> \u5bc4\u5b58\u5668\u53c8\u88ab\u79f0\u4e3a Stack Pointer\uff0c\u8be5\u5bc4\u5b58\u5668\u4e2d\u4e00\u76f4\u5b58\u653e\u7740\u5f53\u524d\u6808\u5185\u5b58\u9876\u90e8\uff08\u4f4e\u4f4d\u5730\u5740\uff09\u7684\u5730\u5740\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u7684\u503c\u51b3\u5b9a\u4e86\u8fdb\u7a0b\u6240\u80fd\u591f\u4f7f\u7528\u7684\u6808\u5185\u5b58\u5927\u5c0f\u3002\u56e0\u6b64\uff0c\u901a\u8fc7\u51cf\u5c0f\u8be5\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u6211\u4eec\u4fbf\u80fd\u591f\u6269\u5927\u8fdb\u7a0b\u7684\u53ef\u7528\u6808\u5185\u5b58\u7a7a\u95f4\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u628a\u76ee\u5149\u79fb\u52a8\u5230\u51fd\u6570 bar \u8eab\u4e0a\uff0c\u6765\u8be6\u7ec6\u770b\u770b\uff0c\u5b83\u5728\u901a\u8fc7 call \u6307\u4ee4\u8c03\u7528\u540e\u90fd\u53d1\u751f\u4e86\u4ec0\u4e48\u3002</p> <ol> <li> <p>call \u6307\u4ee4\u6267\u884c\u65f6\uff0c\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\u7684\u8fd4\u56de\u5730\u5740\u4f1a\u88ab\u9996\u5148\u63a8\u5165\u6808\u4e2d\u3002</p> <p>\u4ee5 bar \u51fd\u6570\u4e3a\u4f8b\uff0c\u5f53\u8be5\u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u56fe A \u4e2d\u53f3\u4fa7\u4ee3\u7801\u7b2c 20 \u884c\u5bf9\u5e94\u7684\u673a\u5668\u6307\u4ee4\u5730\u5740\u4fbf\u4f1a\u88ab\u5b58\u653e\u5230\u6808\u5185\u5b58\u4e2d\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u51fd\u6570\u7684\u7b2c\u4e00\u884c\u6307\u4ee4 <code>push rbp</code> \u4f1a\u5c06\u5f53\u524d\u5bc4\u5b58\u5668 <code>rbp</code> \u7684\u503c\u6682\u5b58\u5230\u6808\u4e2d\uff0c\u4ee5\u4fbf\u5728\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\u6062\u590d\u8be5\u5bc4\u5b58\u5668\u7684\u503c\u3002</p> <p><code>rbp</code> \u5bc4\u5b58\u5668\u53c8\u88ab\u79f0\u4e3a Frame Pointer\uff0c\u5373\u201c\u6808\u5e27\u5bc4\u5b58\u5668\u201d\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b83\u88ab\u7528\u6765\u5b58\u50a8\u51fd\u6570\u8c03\u7528\u524d\u7684\u201c\u6808\u9ad8\u5ea6\u201d\uff0c\u5373\u5bc4\u5b58\u5668 <code>rsp</code> \u7684\u65e7\u503c\uff0c\u4ee5\u4fbf\u7528\u4e8e\u5728\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u6808\u5e27\u4e2d\u6570\u636e\u7684\u5bfb\u5740\uff0c\u5e76\u5728\u51fd\u6570\u9000\u51fa\u524d\u628a\u6808\u4e2d\u7684\u6570\u636e\u6062\u590d\u5230\u51fd\u6570\u8c03\u7528\u524d\u7684\u72b6\u6001\u3002</p> </li> <li> <p>\u7d27\u63a5\u7740\uff0c\u7b2c\u4e8c\u53e5\u6307\u4ee4 <code>mov rbp, rsp</code> \u4fbf\u5c06\u5b58\u6709\u6b64\u523b\u6808\u9ad8\u5ea6\u7684\u5bc4\u5b58\u5668 <code>rsp</code> \u7684\u503c\u201c\u5907\u4efd\u201d\u5230\u5bc4\u5b58\u5668 <code>rbp</code> \u4e2d\u3002\u5f53\u51fd\u6570\u4f53\u7684\u5185\u5bb9\uff08\u7b2c\u4e09\u6761\u8bed\u53e5\uff09\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u7a0b\u5e8f\u901a\u8fc7 <code>pop</code> \u6307\u4ee4\u6062\u590d\u5bc4\u5b58\u5668 <code>rbp</code> \u7684\u503c\uff0c\u5e76\u901a\u8fc7 <code>ret</code> \u6307\u4ee4\u5c06\u7a0b\u5e8f\u7684\u6267\u884c\u8f6c\u79fb\u5230\u51fd\u6570\u8c03\u7528\u524d\uff0c\u5b58\u5165\u6808\u4e2d\u7684\u90a3\u4e2a\u8fd4\u56de\u5730\u5740\u4e0a\u53bb\u3002</p> </li> <li>\u5728\u51fd\u6570 bar \u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u5728\u6808\u4e0a\u5206\u914d\u4efb\u4f55\u6570\u636e\uff0c\u56e0\u6b64\u5728\u51fd\u6570\u5b9e\u9645\u6267\u884c\u7ed3\u675f\u524d\uff0c\u4e5f\u5e76\u4e0d\u9700\u8981\u5bf9\u6808\u8fdb\u884c\u4efb\u4f55\u6e05\u7406\u5de5\u4f5c\u3002</li> </ol> <p>\u5165\u6808\u987a\u5e8f\uff1a1. \u8fd4\u56de\u5730\u5740(<code>push rbp</code>) 2. \u524d\u6808\u6808\u5e95\uff08<code>mov rbp, rsp</code>\uff09 3. \u76f8\u5173\u53c2\u6570</p> <p>\u51fa\u6808\u987a\u5e8f\uff1a1. \u76f8\u5173\u53c2\u6570 2. \u524d\u6808\u6808\u5e95\uff08<code>rbp</code>\uff09 3. \u8fd4\u56de\u5730\u5740</p> <p>\u6240\u4ee5\u4f60\u4f1a\u53d1\u73b0\uff0c\u548c foo \u51fd\u6570\u4e0e main \u51fd\u6570\u76f8\u6bd4\uff0cbar \u51fd\u6570\u5728 ret \u6307\u4ee4\u4e4b\u524d\u5c11\u6267\u884c\u4e86\u4e00\u6761 leave \u6307\u4ee4\u3002</p> <p>\u800c\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u6761 leave \u6307\u4ee4\u4fbf\u4f1a\u901a\u8fc7\u6062\u590d\u5bc4\u5b58\u5668 <code>rsp</code> \u7684\u503c\u6765\u201c\u6e05\u7406\u201d\u6808\u4e0a\u7684\u6570\u636e\uff0c\u5e76\u540c\u65f6\u6062\u590d\u5bc4\u5b58\u5668 <code>rbp</code> \u7684\u503c\u3002</p> <p>\u8fdb\u4e00\u6b65\u89c2\u5bdf main \u51fd\u6570\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u4f60\u4f1a\u53d1\u73b0\u51fd\u6570\u5728\u6267\u884c\u65f6\u4f7f\u7528\u6808\u7684\u75d5\u8ff9\uff1a</p> <ol> <li> <p>\u6bd4\u5982\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684\u7b2c 29 \u884c\uff0c\u8fd9\u91cc\u901a\u8fc7 sub \u6307\u4ee4\u51cf\u5c0f\u4e86\u5bc4\u5b58\u5668 <code>rsp</code> \u7684\u503c\uff0c\u4ee5\u5c06\u5f53\u524d\u7684\u53ef\u7528\u6808\u7a7a\u95f4\u6269\u5927 16 \u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u63a5\u7740\uff0c\u901a\u8fc7\u7b2c 30\u300131 \u884c\u6307\u4ee4\uff0c\u51fd\u6570\u4e3a\u5c40\u90e8\u53d8\u91cf x \u548c y \u5206\u914d\u76f8\u5e94\u7684\u6808\u5185\u5b58\uff0c\u5e76\u5c06\u521d\u59cb\u503c 1 \u548c 2 \u5206\u522b\u5b58\u653e\u5230\u4e86\u6808\u4e0a<code>rbp-4</code> \u4e0e <code>rbp-8</code> \u7684\u4f4d\u7f6e\uff0c\u6bcf\u4e00\u4e2a\u5360\u7528 4 \u5b57\u8282\u5927\u5c0f\u3002</p> </li> <li>\u968f\u540e\uff0c\u5728\u4ee3\u7801\u7684\u7b2c 34\u300135 \u884c\uff0c\u501f\u52a9 push \u6307\u4ee4\uff0c\u989d\u5916\u7684\u4e24\u4e2a 4 \u5b57\u8282\u53c2\u6570\u503c\u540c\u6837\u88ab\u5b58\u653e\u5230\u4e86\u6808\u5185\u5b58\u4e2d\u3002\u6b64\u65f6\uff0cmain \u51fd\u6570\u5bf9\u5e94\u7684\u6808\u5e27\u5185\u5bb9\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ol> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_22","title":"\u601d\u8003\u9898","text":"<ul> <li> <p><code>rsp</code> \u5bc4\u5b58\u5668\uff0c\u6808\u6307\u9488\u6307\u5411\u6808\u9876\u8fd8\u662f\u6808\u5e95</p> <p>\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u5b9e\u9645\u4e0a\u6307\u5411\u6808\u9876\uff0c\u800c\u4e0d\u662f\u6808\u5e95\u3002</p> <ul> <li>\u6808\u9876\uff1a\u6808\u9876\u662f\u6307\u6808\u4e2d\u5f53\u524d\u6700\u65b0\u7684\u6570\u636e\u5143\u7d20\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u6808\u4e2d\u6700\u540e\u4e00\u4e2a\u88ab\u538b\u5165\u7684\u6570\u636e\u5143\u7d20\u7684\u4f4d\u7f6e\u3002</li> <li>\u6808\u5e95\uff1a\u6808\u5e95\u662f\u6307\u6808\u4e2d\u6700\u5e95\u90e8\u7684\u4f4d\u7f6e\uff0c\u901a\u5e38\u662f\u6808\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002\u5728\u5411\u6808\u4e2d\u538b\u5165\u6570\u636e\u65f6\uff0c\u6808\u5e95\u7684\u5730\u5740\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\u3002</li> </ul> <p>\u56e0\u6b64\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u6307\u5411\u6808\u9876\uff0c\u5f53\u6570\u636e\u88ab\u538b\u5165\u6808\u65f6\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u7684\u503c\u4f1a\u51cf\u5c0f\uff1b\u5f53\u6570\u636e\u4ece\u6808\u4e2d\u5f39\u51fa\u65f6\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u7684\u503c\u4f1a\u589e\u52a0\u3002\u8fd9\u6837\uff0c<code>rsp</code> \u5bc4\u5b58\u5668\u603b\u662f\u6307\u5411\u5f53\u524d\u6808\u9876\u7684\u4f4d\u7f6e\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u67b6\u6784\u6216\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u6808\u7684\u751f\u957f\u65b9\u5411\u53ef\u80fd\u4e0d\u540c\u3002\u4f8b\u5982\uff0c\u5728 x86 \u67b6\u6784\u4e2d\uff0c\u6808\u662f\u5411\u4f4e\u5730\u5740\u65b9\u5411\u751f\u957f\u7684\uff0c\u56e0\u6b64\u6808\u9876\u5730\u5740\u4f1a\u6bd4\u6808\u5e95\u5730\u5740\u66f4\u5c0f\u3002</p> </li> <li> <p>\u5728\u4e0d\u4f7f\u7528 leave \u6307\u4ee4\u7684\u60c5\u51b5\u4e0b\uff0c\u4f60\u77e5\u9053\u5e94\u8be5\u5982\u4f55\u8fdb\u884c\u6808\u6e05\u7406\uff0c\u5e76\u6062\u590d\u5bc4\u5b58\u5668 <code>rbp \u4e0e rsp</code> \u7684\u503c\u5417\uff1f\u800c\u4e0e\u5b83\u5bf9\u5e94\u7684 enter \u6307\u4ee4\u53c8\u6709\u4ec0\u4e48\u4f5c\u7528\u5462\uff1f</p> <p>\u624b\u52a8\u6808\u6e05\u7406\uff1a</p> <pre><code>mov rsp, rbp    ; \u6062\u590d\u6808\u9876\npop rbp         ; \u6062\u590d rbp \u5bc4\u5b58\u5668\u7684\u503c\nadd rsp, n      ; \u6e05\u7406\u6808\u4e0a\u7684 n \u4e2a\u5b57\u8282\n</code></pre> <p>\u5c06 <code>rbp</code> \u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u590d\u5236\u5230 <code>rsp</code> \u5bc4\u5b58\u5668\u4e2d\uff0c\u4ee5\u91ca\u653e\u5206\u914d\u7ed9\u8be5\u8fc7\u7a0b\u7684\u6240\u6709\u5806\u6808\u7a7a\u95f4\u3002\u7136\u540e\uff0c\u4ece\u5806\u6808\u6062\u590d <code>rsp</code> \u5bc4\u5b58\u5668\u7684\u65e7\u503c\u3002</p> <p><code>enter</code> \u8ddf <code>push rbp</code> \u548c <code>mov rbp, rsp</code> \u7b49\u4ef7\uff0c\u5728\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u521b\u5efa\u5806\u6808\u5e27\u3002</p> </li> <li> <p>\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\u4e2d\u6240\u9700\u8981/\u4ea7\u751f\u7684\u6570\u636e\u4e00\u822c\u653e\u5728\u54ea\u91cc\uff1f\u4ee5\u4ec0\u4e48\u6837\u7684\u5f62\u5f0f\u653e\u7684\uff1f</p> <p>\u4e00\u822c\u653e\u5728\u6808\u91cc\uff0c\u6808\u5e27\uff08\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u5728\u81ea\u5df1\u7684\u6808\u4e2d\u7684\u6570\u636e\u7684\u5206\u5e03\u7ed3\u6784\u53eb\u505a\u6808\u5e27\uff09</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#05","title":"05\uff5c\u4ee3\u7801\u5c01\u88c5\uff08\u4e0b\uff09\uff1a\u51fd\u6570\u662f\u5982\u4f55\u88ab\u8c03\u7528\u7684\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_23","title":"\u7f16\u5199\u4e0d\u4f9d\u8d56\u4e8e\u53c2\u6570\u6c42\u503c\u987a\u5e8f\u7684\u51fd\u6570","text":"<p>\u5f53\u4e00\u4e2a\u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u4f20\u9012\u7ed9\u5b83\u7684\u5b9e\u9645\u53c2\u6570\u5e94\u8be5\u6309\u7167\u600e\u6837\u7684\u987a\u5e8f\u8fdb\u884c\u6c42\u503c\uff0c\u8fd9\u5728 C \u6807\u51c6\u4e2d\u5e76\u6ca1\u6709\u88ab\u660e\u786e\u89c4\u5b9a\u3002</p> <p>\u56e0\u6b64\uff0c\u5bf9\u4e8e\u67d0\u4e9b\u7279\u6b8a\u7684\u4ee3\u7801\u5f62\u5f0f\uff0c\u5f53\u8fd0\u884c\u4f7f\u7528\u4e0d\u540c\u7f16\u8bd1\u5668\u7f16\u8bd1\u5f97\u5230\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u65f6\uff0c\u53ef\u80fd\u4f1a\u5f97\u5230\u4e0d\u540c\u7684\u8ba1\u7b97\u7ed3\u679c\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n  int n = 1;\n  printf(\"%d %d %d\", n++, n++, n++);\n  return 0;\n} \n</code></pre> <ul> <li> <p>\u5f53\u4f7f\u7528 Clang 13.0.0 \u7f16\u8bd1\u5668\u8fdb\u884c\u7f16\u8bd1\u5e76\u8fd0\u884c\u8fd9\u6bb5\u4ee3\u7801\u65f6\uff0c\u53ef\u4ee5\u5f97\u5230\u8f93\u51fa\u7ed3\u679c \u201c1 2 3\u201d\u3002</p> </li> <li> <p>\u800c\u6362\u6210 GCC 11.2 \u65f6\uff0c\u5219\u5f97\u5230\u4e86\u4e0d\u540c\u7684\u7ed3\u679c \u201c3 2 1\u201d\u3002</p> </li> </ul> <p>\u901a\u8fc7\u67e5\u770b\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u80fd\u591f\u770b\u5230\uff1aClang \u6309\u7167\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u6765\u4f9d\u6b21\u8ba1\u7b97\u8868\u8fbe\u5f0f n++ \u7684\u503c\uff0c\u800c GCC \u5219\u4e0e\u4e4b\u76f8\u53cd\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u4fdd\u8bc1 C \u7a0b\u5e8f\u7684\u5065\u58ee\u6027\u53ca\u53ef\u79fb\u690d\u6027\uff1a</p> <p>\u4e0d\u8981\u7f16\u5199\u9700\u4f9d\u8d56\u7279\u5b9a\u51fd\u6570\u53c2\u6570\u6c42\u503c\u987a\u5e8f\u624d\u80fd\u591f\u6b63\u5e38\u8fd0\u884c\u7684\u4ee3\u7801\u903b\u8f91\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_24","title":"\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316","text":"<p>factorial \u51fd\u6570\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\u7ed9\u5b9a\u6570\u7684\u9636\u4e58\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u4ee3\u7801\u7684\u7b2c\u56db\u884c\uff0c\u770b\u5230\u5b83\u5bf9\u81ea\u5df1\u7684\u8c03\u7528\u8fc7\u7a0b\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528 GCC \u5728\u9ed8\u8ba4\u4f18\u5316\u7b49\u7ea7\u60c5\u51b5\u4e0b\u7f16\u8bd1\u8fd9\u6bb5 C \u4ee3\u7801\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u56fe\u6240\u793a\u7684\u6c47\u7f16\u4ee3\u7801\uff1a</p> <p></p> <p>\u7b2c17\u884c\u8fdb\u884c\u9012\u5f52\u51fd\u6570\u7684\u8c03\u7528\u3002\u5982\u679c\u51fd\u6570\u9012\u5f52\u8c03\u7528\u5730\u8d8a\u6765\u8d8a\u591a\uff0c\u5c06\u4f1a\u5bfc\u81f4\u6808\u5185\u5b58\u4e2d\u4ea7\u751f\u7684\u6808\u5e27\u8d8a\u6765\u8d8a\u591a\uff0c\u76f4\u5230\u6808\u5185\u5b58\u65e0\u6cd5\u518d\u7ee7\u7eed\u589e\u957f\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6808\u6ea2\u51fa\u3002---&gt; <code>\u201cSegmentation Fault\u201d \u7b49\u9519\u8bef\u3002</code></p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6bcf\u6b21\u7684\u51fd\u6570\u8c03\u7528\u90fd\u4f1a\u8fdb\u884c\u6808\u5e27\u7684\u521b\u5efa\u548c\u9500\u6bc1\u8fc7\u7a0b\uff0c\u800c\u968f\u7740\u51fd\u6570\u8c03\u7528\u6b21\u6570\u7684\u589e\u52a0\uff0c\u8fd9\u90e8\u5206\u5f00\u9500\u4e5f\u53ef\u80fd\u9010\u6e10\u5f71\u54cd\u7a0b\u5e8f\u7684\u5916\u90e8\u53ef\u89c2\u6d4b\u6027\u80fd\u3002</p> <p>\u89e3\u51b3\uff1a\u201c\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\uff08Tail-Call Optimization\uff09\u201d\u3002</p> <p>\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u662f\u6307\u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0c\u7f16\u8bd1\u5668\u53ef\u4ee5\u76f4\u63a5 \u5229\u7528\u8df3\u8f6c\u6307\u4ee4\u53d6\u4ee3\u51fd\u6570\u8c03\u7528\u6307\u4ee4\uff0c\u6765\u201c\u6a21\u62df\u201d\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u3002</p> <p>\u8fd9\u6837\u505a\uff0c\u4fbf\u53ef\u4ee5\u7701\u53bb\u51fd\u6570\u8c03\u7528\u6808\u5e27\u7684\u4e0d\u65ad\u521b\u5efa\u548c\u9500\u6bc1\u8fc7\u7a0b\uff1b\u800c\u4e14\uff0c\u9012\u5f52\u51fd\u6570\u5728\u6574\u4e2a\u8c03\u7528\u671f\u95f4\u90fd\u4ec5\u5728\u6808\u5185\u5b58\u4e2d\u7ef4\u62a4\u7740\u4e00\u4e2a\u6808\u5e27\uff0c\u56e0\u6b64\u53ea\u4f7f\u7528\u4e86\u6709\u9650\u7684\u6808\u5185\u5b58\u3002</p> <p>\u5bf9\u4e8e\u51fd\u6570\u4f53\u8f83\u4e3a\u5c0f\u5de7\uff0c\u5e76\u4e14\u53ef\u80fd\u4f1a\u8fdb\u884c\u8f83\u591a\u6b21\u9012\u5f52\u8c03\u7528\u7684\u51fd\u6570\uff0c\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u53ef\u4ee5\u5e26\u6765\u53ef\u89c2\u7684\u6267\u884c\u6548\u7387\u63d0\u5347\u3002</p> <p>\u5c3e\u9012\u5f52\u8c03\u7528\u7684\u4e00\u4e2a\u91cd\u8981\u6761\u4ef6\u662f\uff1a\u9012\u5f52\u8c03\u7528\u8bed\u53e5\u5fc5\u987b\u4f5c\u4e3a\u51fd\u6570\u8fd4\u56de\u524d\u7684\u6700\u540e\u4e00\u6761\u8bed\u53e5 \u3002\u600e\u6837\u7406\u89e3\u8fd9\u4e2a\u7ea6\u675f\u6761\u4ef6\u5462\uff1f\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u8fd9\u91cc\u7684 C \u4ee3\u7801\u548c\u4e0a\u9762\u90a3\u6bb5\u529f\u80fd\u5b8c\u5168\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u4fee\u6539\u4e86\u51fd\u6570 factorial \u7684\u5b9e\u73b0\u903b\u8f91\uff0c\u5e76\u4e14\u5728\u7f16\u8bd1\u65f6\u6307\u5b9a\u4e86\u6700\u9ad8\u7684\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7 \u201c-O3\u201d\u3002\u901a\u8fc7\u67e5\u770b\u53f3\u4fa7\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u4f60\u53ef\u4ee5\u53d1\u73b0\uff0c\u7f16\u8bd1\u5668\u5e76\u6ca1\u6709\u8fdb\u884c\u4efb\u4f55 call \u6307\u4ee4\u7684\u8c03\u7528\u8fc7\u7a0b\u3002\u800c\u8fd9\u5c31\u662f\u56e0\u4e3a\u5b83\u4f7f\u7528\u4e86\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u3002</p> <p>\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u7684\u4e00\u4e2a\u6700\u663e\u8457\u7279\u5f81\uff0c\u5c31\u662f\u7f16\u8bd1\u5668\u4f1a\u4f7f\u7528\u8df3\u8f6c\u6307\u4ee4\uff08\u5982<code>je\u3001jne\u3001jle</code>\u7b49\uff09\u6765\u66ff\u6362\u51fd\u6570\u8c03\u7528\u65f6\u6240\u4f7f\u7528\u7684 call \u6307\u4ee4\u3002</p> <p>\u8fd9\u91cc\u51fd\u6570 factorial \u5728\u6267\u884c ret \u6307\u4ee4\u8fd4\u56de\u524d\uff0c\u4f1a\u5224\u65ad\u5bc4\u5b58\u5668 <code>edi</code> \u7684\u503c\u662f\u5426\u4e3a 0\uff08ZF=1\uff09\uff0c\u6765\u51b3\u5b9a\u662f\u8df3\u8f6c\u5230 \u201c.L2\u201d \u6807\u7b7e\u5904\u7ee7\u7eed\u201c\u9012\u5f52\u201d\u6267\u884c\u8be5\u51fd\u6570\uff0c\u8fd8\u662f\u76f4\u63a5\u8fd4\u56de\u3002\u5f53\u7136\uff0c\u7531\u4e8e\u8fd9\u91cc\u201c\u5b9e\u73b0\u9012\u5f52\u201d\u7684\u65b9\u5f0f\u662f\u901a\u8fc7\u8df3\u8f6c\u6307\u4ee4\u800c\u975e\u51fd\u6570\u7684\u518d\u6b21\u8c03\u7528\uff0c\u5728\u51fd\u6570 factorial \u6267\u884c\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6808\u5185\u5b58\u4e2d\u4ec5\u6709\u5176\u5bf9\u5e94\u7684\u4e00\u4e2a\u6808\u5e27\uff08\u662f\u7531\u8c03\u7528 factorial \u7684\u51fd\u6570\u901a\u8fc7 call \u6307\u4ee4\u521b\u5efa\u7684\uff09\u3002</p> <p>\u6b64\u65f6\uff0c\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u8fdd\u80cc\u5c3e\u9012\u5f52\u4f18\u5316\u7684\u91cd\u8981\u524d\u63d0\uff0c\u4f1a\u6709\u4ec0\u4e48\u7ed3\u679c\u5462\uff1f</p> <p>\u6765\u770b\u4e2a\u4f8b\u5b50\uff1a\u5728 factorial \u51fd\u6570\u7684\u7b2c\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u4e2d\uff0c\u7531\u4e8e\u51fd\u6570\u7684\u524d\u4e00\u6b21\u8c03\u7528\u7ed3\u679c\u4f9d\u8d56\u4e8e\u51fd\u6570\u4e0b\u4e00\u6b21\u8c03\u7528\u7684\u8fd4\u56de\u503c\uff0c\u5bfc\u81f4\u5b58\u653e\u5728\u6808\u5e27\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf num \u7684\u503c\u65e0\u6cd5\u88ab\u6e05\u7406\uff0c\u56e0\u6b64\u7f16\u8bd1\u5668\u4e5f\u5c31\u65e0\u6cd5\u901a\u8fc7\u6d88\u9664\u5386\u53f2\u51fd\u6570\u8c03\u7528\u6808\u5e27\u7684\u65b9\u5f0f\uff0c\u6765\u6a21\u62df\u51fd\u6570\u7684\u9012\u5f52\u8c03\u7528\u8fc7\u7a0b\u3002</p> <p>\u800c\u8fd9\u5c31\u662f\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u4ee5\u201c\u9012\u5f52\u8c03\u7528\u8bed\u53e5\u5fc5\u987b\u4f5c\u4e3a\u51fd\u6570\u8fd4\u56de\u524d\u7684\u6700\u540e\u4e00\u6761\u8bed\u53e5\u201d\u4e3a\u524d\u63d0\u6761\u4ef6\u7684\u539f\u56e0\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u624d\u80fd\u591f\u786e\u5b9a\u51fd\u6570\u7684\u8fd4\u56de\u503c\u6ca1\u6709\u88ab\u4e0a\u4e00\u4e2a\u6808\u5e27\u6240\u4f7f\u7528\u3002</p> <p>\u4f46\u8fd8\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff1a\u73b0\u4ee3\u7f16\u8bd1\u5668\u5177\u5907\u5341\u5206\u5f3a\u5927\u7684\u7a0b\u5e8f\u6267\u884c\u6d41\u5206\u6790\u80fd\u529b\u3002\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u5b83\u80fd\u591f\u76f4\u63a5\u63d0\u53d6\u51fa\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u4f7f\u7528\u5faa\u73af\u8fdb\u884c\u8868\u8fbe\u7684\u90e8\u5206\uff0c\u540c\u65f6\u907f\u514d call \u6307\u4ee4\u7684\u8c03\u7528\u8fc7\u7a0b\u3002\u56e0\u6b64\uff0c\u7f16\u8bd1\u5668\u662f\u5426\u91c7\u7528\u4e86\u5c3e\u9012\u5f52\u4f18\u5316\uff0c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u5df2\u7ecf\u5f88\u96be\u76f4\u63a5\u4ece\u7a0b\u5e8f\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\u770b\u51fa\u4e86\u3002\u800c\u6211\u4eec\u80fd\u505a\u7684\uff0c\u53ea\u662f\u6839\u636e\u7f16\u8bd1\u5668\u5b9e\u73b0\u5c3e\u9012\u5f52\u4f18\u5316\u7684\u7406\u8bba\u57fa\u7840\uff0c\u6765\u5c3d\u53ef\u80fd\u5730\u4ece\u4ee3\u7801\u5c42\u9762\u4f18\u5316\u6211\u4eec\u7684\u7a0b\u5e8f\u3002\u4f46\u5b9e\u9645\u6267\u884c\u65f6\u7684\u6548\u679c\u5982\u4f55\uff0c\u5c31\u8981\u53d6\u51b3\u4e8e\u5177\u4f53\u7f16\u8bd1\u5668\u7684\u80fd\u529b\u4e86\u3002\u6bd5\u7adf\uff0c\u4e0e\u5982\u4eca\u5f3a\u5927\u7684 GCC \u4e0e Clang \u7b49\u7f16\u8bd1\u5668\u76f8\u6bd4\uff0c\u8fd8\u6709\u5f88\u591a\u5f00\u6e90\u7f16\u8bd1\u5668\u751a\u81f3\u8fde\u57fa\u672c\u7684 C \u6807\u51c6\u7279\u6027\u90fd\u6ca1\u6709\u5b8c\u5168\u652f\u6301\u3002</p> <p>\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51cf\u5c11\u51fd\u6570\u8c03\u7528\u6808\u5e27\u7684\u521b\u5efa\u4e0e\u9500\u6bc1\u6b21\u6570\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u6d89\u53ca\u5230\u5bc4\u5b58\u5668\u7684\u4fdd\u5b58\u4e0e\u6062\u590d\u3001\u6808\u5185\u5b58\u7684\u5206\u914d\u4e0e\u91ca\u653e\u7b49\u3002</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u7684\u6548\u679c\u5728\u90a3\u4e9b\u51fd\u6570\u4f53\u672c\u8eab\u8f83\u5c0f\uff0c\u4e14\u9012\u5f52\u8c03\u7528\u6b21\u6570\u8f83\u591a\u7684\u51fd\u6570\u4e0a\u4f53\u73b0\u5f97\u66f4\u52a0\u660e\u663e\u3002</p> <p>*\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u5e73\u8861\u7684\u4e00\u70b9\u662f\uff1a\u51fd\u6570\u81ea\u8eab\u7684\u6267\u884c\u65f6\u95f4\u4e0e\u6808\u5e27\u7684\u521b\u5efa\u548c\u9500\u6bc1\u65f6\u95f4\uff0c\u4e8c\u8005\u54ea\u4e2a\u5360\u6bd4\u66f4\u5927\u3002\u5f88\u660e\u663e\uff0c\u9009\u62e9\u4f18\u5316\u5bf9\u6027\u80fd\u5f71\u54cd\u66f4\u5927\u7684\u56e0\u7d20\uff0c\u901a\u5e38\u4f1a\u5f97\u5230\u66f4\u5927\u7684\u6536\u76ca\u3002*</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#kr","title":"\u5e9f\u5f03\u7684 K&amp;R \u51fd\u6570\u58f0\u660e","text":"<p>\u6cbf\u7740\u5728 main \u51fd\u6570\u5185\u90e8\u8c03\u7528 add \u51fd\u6570\u7684\u6267\u884c\u94fe\u8def\u8fdb\u884c\u5bfb\u627e\uff0c\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u5730\u53d1\u73b0\u95ee\u9898\u6240\u5728\u3002</p> <p>\u5728\u4e0a\u4e00\u8bb2\u4e2d\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u8fc7\uff0c<code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u4f1a\u4f7f\u7528\u5bc4\u5b58\u5668 <code>rdi\u3001rsi</code> \u6765\u4f20\u9012\u7528\u6237\u51fd\u6570\u8c03\u7528\u65f6\u7684\u524d\u4e24\u4e2a\u53c2\u6570\u3002</p> <p>\u800c\u8fd9\u91cc\u5728 main \u51fd\u6570\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 add \u51fd\u6570\u5728\u88ab\u8c03\u7528\u524d\uff0c\u7f16\u8bd1\u5668\u4ec5\u901a\u8fc7\u84dd\u6846\u5185\u7684\u6c47\u7f16\u6307\u4ee4\uff0c\u5bf9\u4f20\u5165 add \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u8fdb\u884c\u4e86\u5904\u7406\uff0c\u5c06\u5b83\u5b58\u653e\u5230\u4e86\u5bc4\u5b58\u5668 <code>edi</code> \u4e2d\u3002\u800c add \u51fd\u6570\u5728\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u4f1a\u901a\u8fc7\u7ea2\u6846\u5185\u7684\u6307\u4ee4\uff0c\u540c\u65f6\u4ece\u5bc4\u5b58\u5668 <code>edi\u3001esi</code> \u4e2d\u521d\u59cb\u5316\u5b83\u6240\u9700\u8981\u7684\u4e24\u4e2a\u53c2\u6570\u3002\u56e0\u6b64\uff0c\u6b64\u65f6\u5bc4\u5b58\u5668 <code>esi</code> \u4e2d\u7684\u503c\u662f\u4ec0\u4e48\uff0c\u4fbf\u51b3\u5b9a\u4e86\u8be5\u51fd\u6570\u7684\u6700\u7ec8\u8fd4\u56de\u503c\u3002\u800c\u5b83\u53ef\u80fd\u662f 0\uff0c\u4e5f\u6709\u53ef\u80fd\u662f\u5404\u79cd\u968f\u673a\u6570\u3002</p> <p>\u603b\u7684\u6765\u770b\uff0c\u51fa\u73b0\u95ee\u9898\u7684\u539f\u56e0\u662f\u7f16\u8bd1\u5668\u5e76\u6ca1\u6709\u5f3a\u5236\u8981\u6c42\u51fd\u6570\u58f0\u660e\u3001\u51fd\u6570\u5b9a\u4e49\uff0c\u4ee5\u53ca\u51fd\u6570\u8c03\u7528\u4e09\u8005\u7684\u53c2\u6570\u5217\u8868\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u675c\u7edd\u6b64\u7c7b\u95ee\u9898\uff0cANSI C \u6807\u51c6\u5316\u4e4b\u540e\u7684 C \u8bed\u8a00\u63d0\u51fa\u4e86\u65b0\u7684\u201c\u51fd\u6570\u539f\u578b\u201d\u6982\u5ff5\uff0c\u4ee5\u53d6\u4ee3\u65e7\u65f6\u4f7f\u7528\u7684\u51fd\u6570\u58f0\u660e\u65b9\u5f0f\u3002</p> <pre><code>#include &lt;stdio.h&gt;\nint add(int x, int y);\nint main(void) {\n  printf(\"%d\", add(1));  // compiling error!\n  return 0;\n}\nint add(int x, int y) {\n  return x + y;\n}\n</code></pre>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_25","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u73b0\u4ee3 C \u8bed\u8a00\u4e2d\u8fd8\u589e\u52a0\u4e86\u5f88\u591a\u6709\u5173\u51fd\u6570\u7684\u65b0\u7279\u6027\u3002\u6bd4\u5982\uff0cC11 \u4e2d\u65b0\u5f15\u5165\u4e86\u4e00\u4e2a\u540d\u4e3a <code>_Noreturn</code> \u7684\u5173\u952e\u5b57\uff0c\u53ef\u53c2\u4e0e\u51fd\u6570\u7684\u5b9a\u4e49\u8fc7\u7a0b\u3002\u4f60\u53ef\u4ee5\u52a8\u624b\u67e5\u67e5\u5b83\u7684\u7528\u5904\uff0c\u601d\u8003\u5b83\u5b58\u5728\u7684\u610f\u4e49\u3002</p> <p><code>_Noreturn</code> \u662f C11 \u4e2d\u5f15\u5165\u7684\u4e00\u4e2a\u51fd\u6570\u58f0\u660e\u4fee\u9970\u7b26\uff0c\u7528\u4e8e\u544a\u8bc9\u7f16\u8bd1\u5668\u67d0\u4e2a\u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\u3002\u8fd9\u4e2a\u5173\u952e\u5b57\u7684\u5b58\u5728\u610f\u4e49\u662f\u4e3a\u4e86\u5e2e\u52a9\u7f16\u8bd1\u5668\u8fdb\u884c\u66f4\u597d\u7684\u4f18\u5316\u548c\u9519\u8bef\u68c0\u67e5\u3002</p> <p>\u5f53\u58f0\u660e\u4e00\u4e2a\u51fd\u6570\u4e3a <code>_Noreturn</code> \u7c7b\u578b\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u77e5\u9053\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u540e\u9762\u7684\u4ee3\u7801\u4e2d\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\uff0c\u6bd4\u5982\u4e0d\u9700\u8981\u4fdd\u5b58\u51fd\u6570\u8fd4\u56de\u503c\uff0c\u6216\u8005\u4e0d\u9700\u8981\u5206\u914d\u989d\u5916\u7684\u8d44\u6e90\u6765\u5904\u7406\u8fd4\u56de\u503c\u3002</p> <p>\u6b64\u5916\uff0c\u4f7f\u7528<code>_Noreturn</code>\u8fd8\u53ef\u4ee5\u5e2e\u52a9\u7f16\u8bd1\u5668\u5728\u51fd\u6570\u8c03\u7528\u65f6\u8fdb\u884c\u66f4\u4e25\u683c\u7684\u9519\u8bef\u68c0\u67e5\u3002\u5982\u679c\u7f16\u8bd1\u5668\u53d1\u73b0\u4e00\u4e2a\u51fd\u6570\u88ab\u58f0\u660e\u4e3a<code>_Noreturn</code>\u7c7b\u578b\uff0c\u4f46\u662f\u5728\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u540e\u9762\u8fd8\u6709\u4e00\u4e9b\u4ee3\u7801\uff0c\u5c31\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c\u63d0\u793a\u53ef\u80fd\u5b58\u5728\u903b\u8f91\u9519\u8bef\u3002</p> <p>\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdnoreturn.h&gt;\n\n_Noreturn void exitWithError() {\n    printf(\"An error occurred. Exiting...\\n\");\n    exit(1);\n}\n\nint main() {\n    int num = 10;\n\n    if (num &gt; 5) {\n        exitWithError();\n    }\n\n    printf(\"This line will not be reached.\\n\");\n\n    return 0;\n}\n</code></pre> <p><code>exitWithError</code> \u51fd\u6570\u88ab\u58f0\u660e\u4e3a <code>_Noreturn</code> \u7c7b\u578b\uff0c\u8868\u793a\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\u3002\u5728 <code>main</code> \u51fd\u6570\u8c03\u7528 <code>exitWithError</code> \u51fd\u6570\uff0c\u6b64\u65f6\u7a0b\u5e8f\u4f1a\u9000\u51fa\u5e76\u6253\u5370\u9519\u8bef\u4fe1\u606f\uff0c\u800c\u540e\u9762\u7684 <code>printf</code> \u8bed\u53e5\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\u56e0\u4e3a\u7f16\u8bd1\u5668\u77e5\u9053 <code>exitWithError</code> \u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fdb\u884c\u76f8\u5e94\u7684\u4f18\u5316\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#06","title":"06\uff5c\u6574\u5408\u6570\u636e\uff1a\u679a\u4e3e\u3001\u7ed3\u6784\u4e0e\u8054\u5408\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f","text":"<p>C \u8bed\u8a00\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u9ad8\u4e8e\u673a\u5668\u6307\u4ee4\u7684\u4e00\u5b9a\u62bd\u8c61\u80fd\u529b\uff0c\u8fd9\u4f7f\u5f97\u6211\u4eec\u80fd\u591f\u4ee5\u63a5\u8fd1\u81ea\u7136\u8bed\u8a00\u7684\u65b9\u5f0f\u6765\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u8bf4\u4f7f\u7528 C \u8bed\u8a00\u662f\u7528\u7816\u5757\u6765\u9020\u623f\u5b50\uff0c\u90a3\u4f7f\u7528\u5176\u4ed6\u9ad8\u62bd\u8c61\u7c92\u5ea6\u7f16\u7a0b\u8bed\u8a00\uff0c\u5c31\u662f\u76f4\u63a5\u4ee5\u5899\u9762\u4e3a\u5355\u4f4d\u6765\u642d\u5efa\u3002\u5f88\u660e\u663e\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0cC \u8bed\u8a00\u7528\u8d77\u6765\u4e0d\u5982\u5176\u4ed6\u9ad8\u7ea7\u8bed\u8a00\u65b9\u4fbf\uff0c\u4f46\u5b83\u4e5f\u540c\u65f6\u7ed9\u4e88\u4e86\u66f4\u7ec6\u7684\u6784\u5efa\u7c92\u5ea6\uff0c\u8ba9\u6211\u4eec\u80fd\u591f\u6309\u7167\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u7075\u6d3b\u81ea\u5b9a\u4e49\u5899\u9762\u7684\u5f62\u6001\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u91cc\u63d0\u5230\u7684\u7816\u5757\u548c\u5899\u9762\uff0c\u4f60\u53ef\u4ee5\u5c06\u5b83\u4eec\u7b80\u5355\u7406\u89e3\u4e3a\u7f16\u7a0b\u8bed\u8a00\u5728\u6784\u5efa\u7a0b\u5e8f\u65f6\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b\u3002\u6bd4\u5982\u5728 Python \u8bed\u8a00\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>\u96c6\u5408\uff08set\uff09\u3001\u5b57\u5178\uff08dict\uff09</code>\u7b49\u590d\u6742\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u800c\u5728 Java \u8bed\u8a00\u4e2d\uff0cMap \u672c\u8eab\u53c8\u4f1a\u88ab\u7ec6\u5206\u4e3a<code>HashMap\u3001LinkedHashMap\u3001EnumMap</code> \u7b49\u591a\u79cd\u7c7b\u578b\uff0c\u4f9b\u4e0d\u540c\u5e94\u7528\u573a\u666f\u4f7f\u7528\u3002</p> <p>\u4e3a\u4e86\u5728\u4fdd\u6301\u81ea\u8eab\u7cbe\u7b80\u7684\u540c\u65f6\u4e5f\u4fdd\u8bc1\u8db3\u591f\u9ad8\u7684\u7075\u6d3b\u6027\uff0cC \u8bed\u8a00\u5728\u63d0\u4f9b\u57fa\u672c\u6570\u503c\u7c7b\u578b\u548c\u6307\u9488\u7c7b\u578b\u7684\u57fa\u7840\u4e0a\uff0c\u53c8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u7ed3\u6784\uff08struct\uff09\u3001\u8054\u5408\uff08union\uff09\u4e0e\u679a\u4e3e\uff08<code>enum</code>\uff09\u8fd9\u4e09\u79cd\u7c7b\u578b\u3002\u7ed3\u5408\u4f7f\u7528\u8fd9\u4e9b\u7c7b\u578b\uff0c\u6211\u4eec\u5c31\u80fd\u5c06\u5c0f\u7684\u201c\u7816\u5757\u201d\u7ec4\u5408\u8d77\u6765\uff0c\u4ece\u800c\u5c06\u5b83\u4eec\u62fc\u63a5\u6210\u4e3a\u66f4\u5927\u7684\u3001\u5177\u6709\u7279\u5b9a\u529f\u80fd\u7ed3\u6784\u7684\u590d\u6742\u6784\u5efa\u5355\u5143\u3002</p> <p>\u90a3\u7f16\u8bd1\u5668\u662f\u5982\u4f55\u5728\u80cc\u540e\u5b9e\u73b0\u8fd9\u4e09\u79cd\u6570\u636e\u7c7b\u578b\u7684\uff1f\u800c\u5728\u5b9e\u73b0\u4e0a\uff0c\u4e3a\u4e86\u517c\u987e\u7a0b\u5e8f\u7684\u6027\u80fd\u8981\u6c42\uff0c\u7f16\u8bd1\u5668\u53c8\u505a\u4e86\u54ea\u4e9b\u7279\u6b8a\u4f18\u5316\uff1f</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_26","title":"\u679a\u4e3e","text":"<p>\u8868\u793a\u67d0\u7c7b\u53ef\u53d6\u503c\u8303\u56f4\u6709\u9650\u7684\u62bd\u8c61\u6982\u5ff5\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u7ecf\u5178\u7684\u4f8b\u5b50\uff1a\u5468\u4e00\u5230\u5468\u4e94\u600e\u4e48\u8868\u793a</p> <p></p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u89c2\u5bdf\uff0c\u6211\u76f4\u63a5\u5c55\u793a\u4e86 C \u4ee3\u7801\u53ca\u5176\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u7f16\u8bd1\u5668\u6ca1\u6709\u4e3a\u5de6\u4fa7\u7ea2\u6846\u5185\u7684\u679a\u4e3e\u7c7b\u578b\u5b9a\u4e49\u751f\u6210\u4efb\u4f55\u7684\u673a\u5668\u6307\u4ee4\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u81ea\u5b9a\u4e49\u679a\u4e3e\u7c7b\u578b\u4e2d\u7684\u679a\u4e3e\u503c\uff0c\u90fd\u662f\u4ee5 int \u7c7b\u578b\u7684\u65b9\u5f0f\u88ab\u5b58\u50a8\u7684\uff0c\u56e0\u6b64\uff0c\u8fd9\u4e9b\u679a\u4e3e\u503c\u6709\u65f6\u4e5f\u88ab\u79f0\u4e3a\u201c\u5177\u540d\u6574\u578b\u201d\u3002</p> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0a\u56fe\u53f3\u4fa7\u84dd\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\u770b\u5230\uff0c\u5f53\u51fd\u6570 foo \u88ab\u8c03\u7528\u65f6\uff0c\u4f20\u5165\u7684\u679a\u4e3e\u503c Mon \u6b63\u5bf9\u5e94\u4e8e\u901a\u8fc7 <code>edi</code> \u5bc4\u5b58\u5668\u4f20\u5165\u7684\u5b57\u9762\u91cf\u6570\u5b57 0\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u679a\u4e3e\u503c Mon \u5728\u5e95\u5c42\u662f\u7531\u6570\u5b57\u503c 0 \u8868\u793a\u7684\u3002\u540c\u6837\u5730\uff0c\u5728\u5de6\u4fa7 C \u4ee3\u7801\u7684\u7b2c 11 \u884c\uff0c\u6211\u4eec\u4e5f\u4f7f\u7528\u4e86\u6cdb\u578b\u5b8f\u6765\u5224\u65ad\u679a\u4e3e\u503c Mon \u7684\u5177\u4f53\u7c7b\u578b\u3002\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u8fd0\u884c\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5e76\u89c2\u5bdf\u7a0b\u5e8f\u7684\u8f93\u51fa\u7ed3\u679c\uff0c\u4ee5\u9a8c\u8bc1\u6211\u4eec\u7684\u7ed3\u8bba\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cC \u6807\u51c6\u76f4\u63a5\u5c06\u679a\u4e3e\u503c\u5f53\u4f5c\u6574\u6570\u8fdb\u884c\u5904\u7406\u7684\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6211\u4eec\u5728\u6784\u5efa\u7a0b\u5e8f\u65f6\u9047\u5230\u610f\u60f3\u4e0d\u5230\u7684\u95ee\u9898\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u4e0a\u8ff0\u8fd9\u6bb5 C \u4ee3\u7801\uff0c\u51fd\u6570 foo \u5728\u88ab\u8c03\u7528\u65f6\uff0c\u5b9e\u9645\u4e0a\u5141\u8bb8\u4f20\u5165\u4efb\u4f55\u53ef\u4ee5\u88ab\u9690\u5f0f\u8f6c\u6362\u4e3a int \u7c7b\u578b\u7684\u503c\uff0c\u54ea\u6015\u8fd9\u4e2a\u503c\u6765\u6e90\u4e8e\u53e6\u4e00\u4e2a\u679a\u4e3e\u7c7b\u578b\u7684\u53d8\u91cf\u3002\u56e0\u6b64\uff0c\u8ba9\u679a\u4e3e\u7c7b\u578b\u6709\u52a9\u4e8e\u7ec4\u7ec7\u7a0b\u5e8f\u4ee3\u7801\u7684\u540c\u65f6\u5e76\u786e\u4fdd\u5b83\u4e0d\u88ab\u4e71\u7528\uff0c\u4e5f\u662f\u6211\u4eec\u5728\u6784\u5efa\u9ad8\u8d28\u91cf\u7a0b\u5e8f\u65f6\u9700\u8981\u6ce8\u610f\u7684\u4e00\u4e2a\u95ee\u9898</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_27","title":"\u7ed3\u6784","text":"<p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6570\u7ec4\u7528\u6765\u5c06\u4e00\u7c07\u76f8\u540c\u7c7b\u578b\u7684\u6570\u636e\u5b58\u653e\u5728\u8fde\u7eed\u7684\u5185\u5b58\u6bb5\u4e0a\u3002\u800c\u7ed3\u6784\uff08Struct\uff09\u5b9e\u9645\u4e0a\u4e0e\u5176\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5728\u7ed3\u6784\u5185\u90e8\uff0c\u6211\u4eec\u53ef\u4ee5\u5b58\u653e\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002</p> <p></p> <p>\u5728\u4e0a\u56fe\u5de6\u4fa7\u7684 C \u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a S \u7684\u7ed3\u6784\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7ed3\u6784 S \u7684\u5bf9\u8c61\uff0c\u5176\u5185\u90e8\u90fd\u4f1a\u8fde\u7eed\u5b58\u653e\u4e09\u4e2a\u7c7b\u578b\u5b8c\u5168\u4e0d\u540c\u7684\u6570\u636e\u503c\uff0c\u5373\u4e00\u4e2a\u5b57\u7b26\u6307\u9488\u3001\u4e00\u4e2a\u5b57\u7b26\u503c\u3001\u4e00\u4e2a\u957f\u6574\u578b\u6570\u503c\u3002\u5728\u4ee3\u7801\u7684\u7b2c 10 \u884c\uff0c\u6211\u4eec\u901a\u8fc7\u62ec\u53f7\u5217\u8868\u521d\u59cb\u5316\u7684\u65b9\u5f0f\uff0c\u6784\u9020\u4e86\u7ed3\u6784 S \u7684\u4e00\u4e2a\u5bf9\u8c61 s\u3002\u901a\u8fc7\u53f3\u4e0a\u65b9\u84dd\u6846\u4e2d\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7f16\u8bd1\u5668\u662f\u5982\u4f55\u5b9e\u73b0\u5bf9\u5b83\u7684\u521d\u59cb\u5316\u7684\u3002</p> <p>\u672c\u8d28\u4e0a\uff0c\u7ed3\u6784\u53ea\u662f\u5bf9\u5176\u5185\u90e8\u6240\u5305\u542b\u5404\u7c7b\u6570\u636e\u7684\u4e00\u4e2a\u5c01\u88c5\uff0c\u56e0\u6b64\u4ece\u7f16\u8bd1\u4ea7\u7269\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u53ea\u9700\u8981\u628a\u5b83\u5c01\u88c5\u7684\u8fd9\u4e9b\u6570\u636e\u8fde\u7eed\u5730\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u5373\u53ef\u3002</p> <p>\u4e8b\u5b9e\u4e5f\u6b63\u662f\u5982\u6b64\uff0c\u5bf9\u7ed3\u6784 S \u5185\u90e8\u4e09\u4e2a\u6570\u636e\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\uff0c\u5747\u662f\u7531\u6307\u4ee4 mov \u5b8c\u6210\u7684\uff0c\u8fd9\u4e9b\u6570\u636e\u88ab\u521d\u59cb\u5316\u5728\u6808\u5185\u5b58\u4e2d\u3002</p> <p>\u7ed3\u6784\u4e2d\u7684\u6570\u636e\u9879\u88ab\u521d\u59cb\u5316\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u6bcb\u5eb8\u7f6e\u7591\uff0c\u4f46\u5b83\u4eec\u771f\u7684\u201c\u8fde\u7eed\u201d\u5417\uff1f</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5728\u5de6\u4fa7 C \u4ee3\u7801\u7684\u7b2c 12 \u884c\uff0c\u901a\u8fc7 <code>sizeof</code> \u8fd0\u7b97\u7b26\u5c06\u7ed3\u6784 S \u7684\u5927\u5c0f\u6253\u5370\u4e86\u51fa\u6765\u3002\u6309\u7167\u7ed3\u6784 S \u7684\u5b9a\u4e49\u65b9\u5f0f\u548c\u6211\u4eec\u5bf9\u201c\u8fde\u7eed\u201d\u4e00\u8bcd\u7684\u7406\u89e3\uff0c\u5b83\u5728 x86-64 \u5e73\u53f0\u4e0a\u7684\u5927\u5c0f\u5e94\u8be5\u4e3a 17 \u5b57\u8282\u3002\u5176\u4e2d\uff0c\u5b57\u7b26\u6307\u9488 8 \u5b57\u8282\u3001\u5b57\u7b26 1 \u5b57\u8282\uff0c\u6700\u540e\u7684\u957f\u6574\u578b\u6570\u503c 8 \u5b57\u8282\u3002\u4f46\u67e5\u770b\u53f3\u4fa7\u9ec4\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\uff1a\u6bcf\u4e00\u4e2a\u7ed3\u6784 S \u7684\u5bf9\u8c61\u7adf\u7136\u5360\u7528\u4e86\u591a\u8fbe 24 \u5b57\u8282\u7684\u5185\u5b58\u3002</p> <p>\u90a3\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\u901a\u8fc7\u6574\u7406\u5bf9\u8c61 s \u5728\u521d\u59cb\u5316\u65f6\u4f7f\u7528\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5176\u5185\u90e8\u5404\u4e2a\u6210\u5458\u5b57\u6bb5\u5728\u6808\u5185\u5b58\u4e2d\u7684\u5b9e\u9645\u5e03\u5c40\u60c5\u51b5\u3002\u7ecf\u8fc7\u6574\u7406\u540e\uff0c\u53ef\u4ee5\u5f97\u5230\u4e0b\u9762\u8fd9\u5f20\u56fe\uff1a</p> <p></p> <p>\u4ece\u5de6\u81f3\u53f3\uff0c\u8fd9\u5f20\u56fe\u4ee3\u8868\u7740\u6808\u5185\u5b58\u7684\u589e\u957f\u65b9\u5411\uff08\u9ad8\u5730\u5740 -&gt; \u4f4e\u5730\u5740\uff09\u3002\u5176\u4e2d\uff0c\u5bc4\u5b58\u5668 <code>rsp</code> \u6307\u5411\u6808\u9876\u7684\u4f4e\u5730\u5740\uff0c\u800c <code>rbp</code> \u5bc4\u5b58\u5668\u5219\u6307\u5411\u6808\u5e27\u5f00\u59cb\u5904\u7684\u9ad8\u5730\u5740\u3002</p> <p>\u6309\u7167\u6c47\u7f16\u4ee3\u7801\u4e2d\u7684\u6307\u4ee4\uff0c\u5b57\u7b26\u6307\u9488 p \u4f4d\u4e8e <code>[rbp-32]</code> \u5904\uff0c\u5e76\u5360\u7528 8 \u4e2a\u5b57\u8282\uff1b\u5b57\u7b26 c \u4f4d\u4e8e <code>[rbp-24]</code> \u5904\uff0c\u5e76\u5360\u7528 1 \u4e2a\u5b57\u8282\u3002\u800c\u957f\u6574\u578b\u53d8\u91cf x \u5219\u4f4d\u4e8e <code>[rbp-16]</code> \u5904\uff0c\u5e76\u5360\u7528 8 \u4e2a\u5b57\u8282\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u7f16\u8bd1\u5668\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u6309\u7167\u4e25\u683c\u8fde\u7eed\u7684\u65b9\u5f0f\u6765\u201c\u6446\u653e\u201d\u8fd9\u4e09\u4e2a\u6570\u636e\u503c\uff0c\u5176\u4e2d\uff0c<code>[rbp-25]</code> \u5230 <code>[rbp-16]</code> \u4e2d\u95f4\u7684 7 \u4e2a\u5b57\u8282\u5e76\u6ca1\u6709\u5b58\u653e\u4efb\u4f55\u6570\u636e\u3002</p> <p>\u800c\u7f16\u8bd1\u5668\u8fd9\u6837\u505a\u7684\u4e00\u4e2a\u91cd\u8981\u76ee\u7684\uff0c\u4fbf\u662f\u4e3a\u4e86\u201c\u6570\u636e\u5bf9\u9f50\u201d\u3002</p> <ul> <li> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u5185\u5b58\u6570\u636e\u5bf9\u9f50\uff1f</p> <p>\u5bf9\u4e8e\u73b0\u4ee3\u8ba1\u7b97\u673a\u800c\u8a00\uff0c\u5f53\u5185\u5b58\u4e2d\u9700\u8981\u88ab\u8bfb\u5199\u7684\u6570\u636e\uff0c\u5176\u6240\u5728\u5730\u5740\uff0c\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u7684\u65f6\u5019\uff0cCPU\u901a\u5e38\u80fd\u591f\u4ee5\u6700\u9ad8\u7684\u6548\u7387\u8fdb\u884c\u6570\u636e\u64cd\u4f5c\u3002</p> <p>\u6709\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li> <p>Q1:\u4ec0\u4e48\u53eb\u505a\u201c\u81ea\u7136\u5bf9\u9f50\u201d\uff1f</p> <p>\u5173\u4e8e\u81ea\u7136\u5bf9\u9f50\uff0c\u6307\u7684\u662f\u88ab\u64cd\u4f5c\u7684\u6570\u636e\u7684\u6240\u5728\u5730\u5740\u8be5\u6570\u636e\u5927\u5c0f\u7684\u6574\u6570\u500d\u3002</p> <p>\u6bd4\u5982 <code>x86-64</code> \u67b6\u6784\u4e2d\uff0c\u4e00\u4e2a <code>int</code> \u7c7b\u578b\u53d8\u91cf\uff0c\u6570\u636e\u5927\u5c0f\u4e3a\u56db\u4e2a\u5b57\u8282\uff0c\u5176\u503c\u5728\u5185\u5b58\u4e2d\u8fde\u7eed\u5b58\u653e\uff0c\u4e14\uff0c\u6700\u4f4e\u6709\u6548\u4f4d\u5b57\u8282\u6240\u5728\u7684\u5730\u5740\u4e3a4\u7684\u6574\u6570\u500d\u3002</p> <p>\u8fd9\u6837\u5b50\uff0c\u8be5\u53d8\u91cf\u7684\u503c\u5728\u5185\u5b58\u4e2d\u65f6\u5bf9\u9f50\u7684\u3002</p> </li> <li> <p>Q2:\u4e3a\u4ec0\u4e48\u81ea\u7136\u5bf9\u9f50\u80fd\u4ee5\u6700\u9ad8\u6548\u7387\u8fdb\u884c\u64cd\u4f5c\uff1f</p> <p>\u5b9e\u9645\u4e0a\u4e0e CPU \u548c MMU \u7b49\u5185\u5b58\u8bfb\u5199\u76f8\u5173\u6838\u5fc3\u786c\u4ef6\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u7684\u8bf8\u591a\u9650\u5236\u6027\u56e0\u7d20\u6709\u5173\u3002</p> <ul> <li> <p>\u6bd4\u5982\uff0c\u5bf9\u4e8e\u67d0\u4e9b\u53e4\u8001\u7684 Sun SPARC \u548c ARM \u5904\u7406\u5668\u6765\u8bf4\uff0c\u5b83\u4eec\u53ea\u80fd\u8bbf\u95ee\u4f4d\u4e8e\u7279\u5b9a\u5730\u5740\u4e0a\u7684\u5bf9\u9f50\u6570\u636e\uff0c\u800c\u5bf9\u4e8e\u975e\u5bf9\u9f50\u6570\u636e\u7684\u8bbf\u95ee\uff0c\u5219\u4f1a\u4ea7\u751f\u5f02\u5e38\u3002</p> </li> <li> <p>\u76f8\u53cd\uff0c\u6709\u4e9b\u5904\u7406\u5668\u5219\u80fd\u591f\u652f\u6301\u5bf9\u975e\u5bf9\u9f50\u6570\u636e\u7684\u8bbf\u95ee\uff0c\u4f46\u7531\u4e8e\u8bbe\u8ba1\u5de5\u827a\u4e0a\u7684\u9650\u5236\uff0c\u5bf9\u8fd9\u4e9b\u6570\u636e\u7684\u8bbf\u95ee\u9700\u8981\u82b1\u8d39\u66f4\u591a\u7684\u65f6\u949f\u5468\u671f\u3002</p> </li> </ul> <p>\u7efc\u4e0a\uff0c\u4e3a\u4e86\u8ba9\u4ee3\u7801\u9002\u5e94\u4e0d\u540c\u5904\u7406\u5668\u7684\u201c\u98ce\u683c\u201d\uff0c\u4fdd\u8bc1\u5185\u5b58\u4e2d\u7684\u6570\u636e\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u8981\u6c42\uff0c\u5c31\u6210\u4e86\u5927\u591a\u6570\u7f16\u8bd1\u5668\u5728\u751f\u6210\u673a\u5668\u6307\u4ee4\u65f6\u8fbe\u6210\u7684\u4e00\u4e2a\u9ed8\u8ba4\u5171\u8bc6\u3002</p> <p>\u54ea\u6015\u5728\u5982\u4eca\u7684\u73b0\u4ee3 x86-64 \u5904\u7406\u5668\u4e0a\uff0c\u8bbf\u95ee\u975e\u5bf9\u9f50\u6570\u636e\u6240\u4ea7\u751f\u7684\u6027\u80fd\u635f\u8017\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u5df2\u5fae\u4e0d\u8db3\u9053\u3002</p> </li> </ul> </li> <li> <p>\u5bf9\u4e8e\u975e\u5bf9\u9f50\u7684\u6570\u636e\uff0c\u4e3a\u4ec0\u4e48\u67d0\u4e9b\u5904\u7406\u5668\u6ca1\u6cd5\u6b63\u786e\u8bbf\u95ee\u6216\u8005\u901f\u5ea6\u4e0b\u964d\uff1f\u5176\u5185\u90e8\u786c\u4ef6\u539f\u7406\uff1f</p> <p>\u9996\u5148\u5173\u4e8e\u6570\u636e\uff0c\u4ed6\u662f\u9700\u8981\u4ece\u5185\u5b58\u4e2d\u53d6\u5f97\u6570\u636e\uff0c\u7136\u540e\u653e\u5230\u5904\u7406\u5668\u5185\u90e8\u7684\u5bc4\u5b58\u5668\u6216\u8005cache \uff08store buffer\u8fd9\u91cc\u4e0d\u592a\u8bb0\u5f97\u4e86\uff0c\u8fd9\u91cc\u518d\u56de\u53bb\u770b\u770b\uff1f\uff09 \u91cc\u9762\u7684\u3002\u90a3\u7531\u4e8e\u4e0d\u540c\u67b6\u6784\u7684\u8bbe\u8ba1\uff0c32/64 \u4f4d\u67b6\u6784\u5bf9\u5e94 32/64 \u4f4d\u7684\u5bc4\u5b58\u5668(\u4e5f\u6709\u4f8b\u5916)\uff0c\u5904\u7406\u5668\u4ece\u5185\u5b58\u4e2d\u4e00\u6b21\u6027\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u53d632/64 \u4f4d\uff084 byte /8 byte\uff09\u7684\u6570\u636e\u3002</p> <ul> <li> <p>\u786c\u4ef6\u8bbe\u8ba1\u9650\u5236</p> <p>\u67d0\u4e9b\u5904\u7406\u5668\u7684\u786c\u4ef6\u8bbe\u8ba1\u4ec5\u5141\u8bb8\u4ece\u7279\u5b9a\u5bf9\u9f50\u7684\u5185\u5b58\u5730\u5740\u8bfb\u53d6\u6570\u636e\u3002\u5982\u679c\u6570\u636e\u672a\u6309\u7167\u8fd9\u4e9b\u5904\u7406\u5668\u8981\u6c42\u7684\u5bf9\u9f50\u65b9\u5f0f\u5b58\u50a8\uff0c\u5904\u7406\u5668\u5c06\u65e0\u6cd5\u6b63\u786e\u5730\u8bbf\u95ee\u6570\u636e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u786c\u4ef6\u5f02\u5e38\u6216\u9519\u8bef\u3002</p> <p>\u627e\u5230\u4e86\u7b2c 1 \u7bc7\u8d44\u6599\uff1a\u5355\u7247\u673a(MCU)\u5982\u4f55\u624d\u80fd\u4e0d\u6b7b\u673a\u4e4b\u5bf9\u9f50\u8bbf\u95ee(Aligned Access) - \u77e5\u4e4e</p> <p>\u627e\u5230\u4e86\u7b2c 2 \u7bc7\u8d44\u6599\uff1aSTM32F0\u975e\u5bf9\u9f50\u8bbf\u95ee\u5f15\u8d77\u7684\u786c\u4ef6\u9519\u8bef\u53ca\u5176\u6392\u9664 - \u7535\u5b50\u5de5\u7a0b\u4e16\u754c</p> <p>\u627e\u5230\u4e86\u7b2c 3 \u7bc7\u8d44\u6599\uff1a\u77f3\u9524\u5185\u5b58\u8bbf\u95ee\u4e0d\u652f\u6301\u975e\u5bf9\u9f50\u662f\u5426STM32H7\u7684\u786c\u4ef6bug ...</p> <p>\u627e\u5230\u4e86\u7b2c 4 \u7bc7\u8d44\u6599\uff1aSTM32F0\u975e\u5bf9\u9f50\u8bbf\u95ee\u5f15\u8d77\u7684\u786c\u4ef6\u9519\u8bef\u53ca\u5176\u6392\u9664 - CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 5 \u7bc7\u8d44\u6599\uff1a\u3010STM32\u3011CortexM0\u5355\u7247\u673a\u4e2d\u7684\u975e\u5bf9\u9f50\u8bbf\u95ee\u9020\u6210\u7684HardFault</p> <p>\u627e\u5230\u4e86\u7b2c 6 \u7bc7\u8d44\u6599\uff1aSTM32F7\uff1a\u8bbf\u95ee\u672a\u5bf9\u9f50\u7684\u5185\u5b58\u5f15\u8d77\u786c\u4ef6\u5f02\u5e38\u7684\u89e3\u51b3\u65b9\u6cd5 ...</p> <p>\u627e\u5230\u4e86\u7b2c 7 \u7bc7\u8d44\u6599\uff1aSTM32F0\u975e\u5bf9\u9f50\u8bbf\u95ee\u5f15\u8d77\u7684\u786c\u4ef6\u9519\u8bef\u53ca\u5176\u6392\u9664 - CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 8 \u7bc7\u8d44\u6599\uff1a\u3010\u7ecf\u9a8c\u5206\u4eab\u3011STM32F0\u975e\u5bf9\u9f50\u8bbf\u95ee\u5f15\u8d77\u7684\u786c\u4ef6\u9519\u8bef\u53ca\u5176\u6392\u9664 ...</p> <p>\u627e\u5230\u4e86\u7b2c 9 \u7bc7\u8d44\u6599\uff1a\u5355\u7247\u673a\u7684\u975e\u5bf9\u9f50\u8bbf\u95ee\u5bfc\u81f4\u786c\u4ef6\u9519\u8bef_\u5355\u7247\u673a\u5b57\u8282\u4e0d\u5bf9\u9f50\u6bb5 ...</p> <p>\u627e\u5230\u4e86\u7b2c 10 \u7bc7\u8d44\u6599\uff1a\u89e3\u6790STM32\u7ed3\u6784\u4f53\u5bf9\u9f50\u539f\u7406\u548c\u8bbe\u8ba1\u539f\u5219\u4e0e\u5b9e\u73b0 - STM32\u56e2\u961f ...</p> <p>\u786c\u4ef6\u8bbe\u8ba1\u9650\u5236\u901a\u5e38\u6307\u7684\u662f\u7531\u4e8e\u5904\u7406\u5668\u6216\u5185\u5b58\u7cfb\u7edf\u7684\u67b6\u6784\u7279\u70b9\uff0c\u5bf9\u6570\u636e\u8bbf\u95ee\u7684\u5730\u5740\u6709\u7279\u5b9a\u7684\u8981\u6c42\u3002\u5982\u679c\u6570\u636e\u672a\u6309\u7167\u8fd9\u4e9b\u8981\u6c42\u5bf9\u9f50\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u6216\u786c\u4ef6\u5f02\u5e38\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5b9e\u9645\u7684\u4f8b\u5b50\uff1a</p> <ol> <li>ARM Cortex M0 \u4f53\u7cfb\u7ed3\u6784\uff1a\u8fd9\u79cd\u4f53\u7cfb\u7ed3\u6784\u53ea\u652f\u6301\u5bf9\u9f50\u8bbf\u95ee\uff08Aligned Access\uff09\u3002\u5bf9\u4e8e4\u5b57\u8282\uff08Double Word\uff09\u578b\u7684\u53d8\u91cf\uff0c\u5982\u679c\u8d77\u59cb\u5730\u5740\u80fd\u88ab4\u6574\u9664\uff0c\u8bbf\u95ee\u662f\u53cc\u5b57\u5bf9\u9f50\u7684\u3002\u5982\u679c\u8fdb\u884c\u975e\u5bf9\u9f50\u8bbf\u95ee\uff0c\u5219\u53ef\u80fd\u4ea7\u751f\u4e25\u91cd\u9519\u8bef\uff08HardFault\uff091\u3002</li> <li>STM32\u7cfb\u5217\u5fae\u63a7\u5236\u5668\uff1a\u5728STM32F0\u7cfb\u5217\u4e2d\uff0c\u975e\u5bf9\u9f50\u8bbf\u95ee\u53ef\u80fd\u5bfc\u81f4\u786c\u4ef6\u9519\u8bef\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a4\u5b57\u8282\u7684\u53d8\u91cf\u8d77\u59cb\u5730\u5740\u4e0d\u80fd\u88ab4\u6574\u9664\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5728\u8be5\u53d8\u91cf\u524d\u586b\u5145\u989d\u5916\u7684\u5b57\u8282\u4ee5\u786e\u4fdd\u5bf9\u9f50\uff0c\u907f\u514d\u8bbf\u95ee\u9519\u8bef478\u3002</li> <li>Cortex-M7 \u5185\u6838\uff1aSTM32H7\u7cfb\u5217\u4f7f\u7528Cortex-M7\u5185\u6838\uff0c\u8be5\u5185\u6838\u652f\u6301\u975e\u5bf9\u9f50\u8bbf\u95ee\uff0c\u4f46\u5728\u7279\u5b9a\u6761\u4ef6\u4e0b\uff0c\u5982\u5185\u5b58\u7a7a\u95f4\u88ab\u914d\u7f6e\u4e3aDevice\u6216Strongly-ordered\u6a21\u5f0f\uff0c\u975e\u5bf9\u9f50\u8bbf\u95ee\u53ef\u80fd\u89e6\u53d1 Usage Fault\u5f02\u5e383\u3002</li> <li>\u6307\u9488\u8bbf\u95ee\u5bf9\u9f50\u95ee\u9898\uff1a\u5728\u4f7f\u7528\u6307\u9488\u8bbf\u95ee\u5185\u5b58\u65f6\uff0c\u5982\u679c\u6307\u9488\u7684\u7c7b\u578b\u548c\u6240\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u672a\u5bf9\u9f50\uff0c\u6bd4\u5982\u4e00\u4e2a<code>uint32_t</code>\u6307\u9488\u6307\u5411\u4e00\u4e2a\u975e4\u5b57\u8282\u5bf9\u9f50\u7684\u5730\u5740\uff0c\u8bbf\u95ee\u8be5\u5730\u5740\u53ef\u80fd\u4f1a\u89e6\u53d1\u786c\u4ef6\u5f02\u5e38135\u3002</li> <li>\u5185\u5b58\u6027\u80fd\u5f71\u54cd\uff1a\u5728\u4e00\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u975e\u5bf9\u9f50\u8bbf\u95ee\u53ef\u80fd\u4e0d\u4f1a\u89e6\u53d1\u786c\u4ef6\u5f02\u5e38\uff0c\u4f46\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002\u56e0\u4e3a\u5904\u7406\u5668\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u5185\u5b58\u8bbf\u95ee\u548c\u5904\u7406\u6b65\u9aa4\u6765\u83b7\u53d6\u672a\u5bf9\u9f50\u7684\u6570\u636e6\u3002</li> <li>\u7279\u5b9a\u5185\u5b58\u533a\u57df\u7684\u5bf9\u9f50\u8981\u6c42\uff1a\u67d0\u4e9b\u5185\u5b58\u533a\u57df\uff0c\u5982\u5916\u90e8SDRAM\uff0c\u53ef\u80fd\u5bf9\u8bbf\u95ee\u5730\u5740\u7684\u5bf9\u9f50\u6709\u4e25\u683c\u8981\u6c42\u3002\u672a\u5bf9\u9f50\u7684\u8bbf\u95ee\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u635f\u574f\u6216\u7cfb\u7edf\u4e0d\u7a33\u5b9a\u3002</li> </ol> </li> <li> <p>\u5185\u5b58\u8bbf\u95ee\u6548\u7387</p> </li> </ul> <p>\u5373\u4f7f\u5904\u7406\u5668\u80fd\u591f\u8bbf\u95ee\u672a\u5bf9\u9f50\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u5185\u5b58\u8bbf\u95ee\u548c\u5904\u7406\u6b65\u9aa4\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a32\u4f4d\u7684 <code>int</code> \u578b\u6570\u636e\u5b58\u50a8\u5728\u4e00\u4e2a\u5947\u6570\u5730\u5740\u5f00\u59cb\u7684\u5730\u65b9\uff0c\u5904\u7406\u5668\u53ef\u80fd\u9700\u8981\u4ece\u4e24\u4e2a\u4e0d\u540c\u7684\u5185\u5b58\u5730\u5740\u8bfb\u53d6\u4e24\u4e2a16\u4f4d\u7684\u6570\u636e\u5757\uff0c\u7136\u540e\u5185\u90e8\u7ec4\u5408\u8fd9\u4e24\u4e2a\u5b57\u6570\u636e\u4ee5\u5f62\u6210\u5b8c\u6574\u768432\u4f4d\u6570\u636e\u3002</p> <p>\u8fd9\u79cd\u8bbf\u95ee\u65b9\u5f0f\u4e0d\u4ec5\u589e\u52a0\u4e86\u5185\u5b58\u8bbf\u95ee\u7684\u6b21\u6570\uff0c\u800c\u4e14\u4e5f\u589e\u52a0\u4e86\u5904\u7406\u5668\u7684\u5de5\u4f5c\u91cf\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u6548\u7387</p> <ul> <li>\u8de8\u7f13\u5b58\u884c\u8bbf\u95ee</li> </ul> <p>\u73b0\u4ee3\u5904\u7406\u5668\u4f7f\u7528\u7f13\u5b58\u6765\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u901f\u5ea6\u3002\u6570\u636e\u5bf9\u9f50\u53ef\u4ee5\u51cf\u5c11\u8de8\u7f13\u5b58\u884c\u7684\u8bbf\u95ee\uff0c\u56e0\u4e3a\u5bf9\u9f50\u7684\u6570\u636e\u66f4\u6709\u53ef\u80fd\u5b58\u50a8\u5728\u540c\u4e00\u7f13\u5b58\u884c\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u7f13\u5b58\u672a\u547d\u4e2d\u7684\u53ef\u80fd\u6027\uff0c\u63d0\u9ad8\u8bbf\u95ee\u901f\u5ea6\u3002</p> <p>\u7f51\u4e0a\u641c\u5230\u7684\u8fd9\u4e9b\u611f\u89c9\u8fd8\u662f\u6ca1\u6709\u4ed4\u7ec6\u5730\u5e95\u5c42\u5730\u8bf4\u51fa\u4e3a\u4ec0\u4e48\uff0c\u8fd8\u662f\u5f97\u770b\u770b\u56fd\u5916\u7684\u3002</p> <p>\u5b9e\u73b0memcpy()\u51fd\u6570\u53ca\u8fc7\u7a0b\u603b\u7ed3 - Infinite_feng - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u6d45\u8c08CPU\u5185\u5b58\u8bbf\u95ee\u8981\u6c42\u5bf9\u9f50\u7684\u539f\u56e0 \u2013 \u4ef0\u671b\u82cd\u5929\u601d\u5bf0\u5b87 (yangwang.hk)</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_28","title":"\u586b\u5145\u5b57\u8282","text":"<p>\u8ba9\u6211\u4eec\u518d\u56de\u5230\u4e4b\u524d\u90a3\u4e2a\u4f8b\u5b50\u3002\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0c\u4e3a\u4e86\u786e\u4fdd\u5bf9\u8c61 s \u4e2d\u6240\u6709\u6210\u5458\u5b57\u6bb5\u5728\u6808\u5185\u5b58\u4e2d\u90fd\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u7684\u8981\u6c42\uff0c\u7f16\u8bd1\u5668\u4f1a\u63d2\u5165\u989d\u5916\u7684\u201c\u586b\u5145\u5b57\u8282\u201d\uff0c\u6765\u52a8\u6001\u8c03\u6574\u7ed3\u6784\u5bf9\u8c61\u4e2d\u5404\u4e2a\u5b57\u6bb5\u5bf9\u5e94\u6570\u636e\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5373\u4f7f\u7ed3\u6784\u5bf9\u8c61\u5185\u5404\u4e2a\u6570\u636e\u6210\u5458\u90fd\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u7684\u8981\u6c42\uff0c\u989d\u5916\u7684\u586b\u5145\u5b57\u8282\u4e5f\u53ef\u80fd\u4f1a\u88ab\u6dfb\u52a0\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>struct Foo {\n  char *p;  // 8 bytes.\n  char c;  // 1 bytes.\n  // (padding): 7 bytes.\n};\n</code></pre> <p>\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u7ed3\u6784 Foo \u4e2d\u7684\u4e24\u4e2a\u6210\u5458\u5b57\u6bb5\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5df2\u7ecf\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u7684\u8981\u6c42\uff08\u5047\u8bbe\u5b57\u7b26\u6307\u9488 p \u7684\u5b58\u653e\u8d77\u59cb\u4f4d\u7f6e\u6ee1\u8db3 8 \u5b57\u8282\u5bf9\u9f50\uff09\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u5728\u901a\u8fc7 <code>sizeof</code> \u8fd0\u7b97\u7b26\u5bf9\u5b83\u8fdb\u884c\u6c42\u503c\u65f6\uff0c\u6211\u4eec\u4f1a\u5f97\u5230 16 \u5b57\u8282\u5927\u5c0f\u7684\u7ed3\u679c\uff0c\u800c\u975e\u76f4\u89c2\u7684 9 \u5b57\u8282\u3002</p> <p>\u4e4b\u6240\u4ee5\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u56e0\u4e3a\u7f16\u8bd1\u5668\u60f3\u8981\u4fdd\u8bc1\u8fd9\u4e00\u70b9\uff1a\u5f53\u7ed3\u6784\u5bf9\u8c61\u88ab\u8fde\u7eed\u5b58\u653e\u65f6\uff08\u6bd4\u5982\u901a\u8fc7\u6570\u7ec4\uff09\uff0c\u524d\u4e00\u4e2a\u5bf9\u8c61\u7684\u7ed3\u675f\u4f4d\u7f6e\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u540e\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u8d77\u59cb\u4f4d\u7f6e\u65f6\u7684\u81ea\u7136\u5bf9\u9f50\u8981\u6c42\u3002\u800c\u8fd9\u4e5f\u5c31\u8981\u6c42\u7ed3\u6784\u5bf9\u8c61\u672c\u8eab\u7684\u5927\u5c0f\u5fc5\u987b\u662f\u5176\u5185\u90e8\u6700\u5927\u6210\u5458\u5927\u5c0f\u7684\u6574\u6570\u500d\u3002</p> <p>\u56e0\u6b64\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u7ed3\u6784\u6700\u540e\u4e00\u4e2a\u6210\u5458\u7684\u540e\u9762\u518d\u586b\u5145\u9002\u5f53\u5b57\u8282\uff0c\u4ee5\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u3002\u53ef\u4ee5\u8bf4\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u7ed3\u6784\u5bf9\u8c61\uff0c\u5df2\u7ecf\u6ee1\u8db3\u4e86\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u7684\u81ea\u7136\u5bf9\u9f50\u6761\u4ef6\uff0c\u56e0\u6b64\uff0c\u6b64\u65f6\u7684\u7ed3\u6784\u5927\u5c0f\u4e5f\u4f1a\u88ab\u4f5c\u4e3a <code>sizeof</code> \u8fd0\u7b97\u7b26\u7684\u6700\u7ec8\u8ba1\u7b97\u7ed3\u679c\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_29","title":"\u8054\u5408","text":"<p>\u8054\u5408\u4e0e\u201c\u7ed3\u6784\u201d\u5728\u8bed\u6cd5\u4e0a\u7684\u4f7f\u7528\u65b9\u5f0f\u5341\u5206\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u8981\u628a\u5bf9\u5e94\u7684\u8bed\u6cd5\u5173\u952e\u5b57\u4ece struct \u66f4\u6362\u4e3a union \u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4e8c\u8005\u8fd8\u6709\u4e00\u4e2a\u8f83\u5927\u7684\u533a\u522b\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u201c\u8054\u5408\u201d\u8fd9\u4e2a\u540d\u5b57\u8c08\u8d77\u3002\u987e\u540d\u601d\u4e49\uff0c\u201c\u8054\u5408\u201d\u5c31\u610f\u5473\u7740\u5b9a\u4e49\u5728\u8be5\u7ed3\u6784\u5185\u7684\u6240\u6709\u6570\u636e\u5b57\u6bb5\uff0c\u5c06\u4f1a\u8054\u5408\u8d77\u6765\u5171\u4eab\u540c\u4e00\u5757\u5185\u5b58\u533a\u57df\u3002\u8fd8\u662f\u5148\u6765\u770b\u4e00\u6bb5\u4ee3\u7801\uff1a</p> <p></p> <p>\u8fd9\u91cc\uff0c\u5728\u5de6\u4fa7\u7684 C \u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 \u201cTagged Union\u201d \u7684\u6a21\u5f0f\u5bf9\u8054\u5408\u8fdb\u884c\u4e86\u5c01\u88c5\u3002</p> <p>\u4e0e\u7ed3\u6784\u4e0d\u540c\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5355\u72ec\u7684\u8054\u5408\u5bf9\u8c61\u6765\u8bf4\uff0c\u5728\u67d0\u4e00\u65f6\u523b\u5176\u5185\u90e8\u54ea\u4e00\u4e2a\u5b57\u6bb5\u6b63\u5728\u751f\u6548\uff0c\u6211\u4eec\u65e0\u4ece\u5f97\u77e5\u3002</p> <p>\u56e0\u6b64\uff0cTagged Union \u7684\u4f7f\u7528\u65b9\u5f0f\u8981\u6c42\u6211\u4eec\u4e3a\u6bcf\u4e00\u4e2a\u8054\u5408\u8bbe\u7f6e\u5355\u72ec\u7684\u201c\u6807\u7b7e\u201d\uff0c\u7528\u6765\u660e\u786e\u6307\u51fa\u5f53\u524d\u8054\u5408\u5185\u90e8\u6b63\u5728\u751f\u6548\u7684\u5b57\u6bb5\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4fbf\u9700\u8981\u5c06\u8fd9\u4e2a\u6807\u7b7e\u4e0e\u8054\u5408\u8fdb\u884c\u5c01\u88c5\uff0c\u6765\u5c06\u5b83\u4eec\u8fdb\u884c\u201c\u7ed1\u5b9a\u201d\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u5728\u7ed3\u6784 S \u5185\u90e8\uff0c\u679a\u4e3e\u7c7b\u578b\u5b57\u6bb5 type \u5c31\u662f\u7528\u6765\u6807\u8bb0\u5f53\u524d\u533f\u540d\u8054\u5408\u5185\u90e8\u6240\u5b58\u653e\u7684\u6570\u636e\u79cd\u7c7b\u7684\u3002\u800c\u5728\u7d27\u63a5\u7740\u7684\u533f\u540d\u8054\u5408\u5185\u90e8\uff0c\u6574\u578b\u6210\u5458 i \u4e0e\u5b57\u7b26\u6210\u5458 c \u5219\u5171\u4eab\u8be5\u8054\u5408\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u8fd9\u4fbf\u662f Tagged Union \u5728 C \u8bed\u8a00\u4e2d\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f\u3002</p> <p>\u4e00\u4e2a\u8054\u5408\u5bf9\u8c61\u7684\u5927\u5c0f\u540c\u8be5\u8054\u5408\u5185\u90e8\u5b9a\u4e49\u65f6\u6240\u5305\u542b\u6700\u5927\u6210\u5458\u7684\u5927\u5c0f\u76f8\u540c\uff0c\u56e0\u6b64\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u7ed3\u6784 S \u4e2d\u7684\u533f\u540d\u8054\u5408\u5927\u5c0f\u4fbf\u4e0e\u8054\u5408\u00b7\u5b9a\u4e49\u5185\u6574\u578b\u53c2\u6570 i \u7684\u5927\u5c0f\u76f8\u540c\u3002</p> <p>\u8fd9\u4e2a\u5927\u5c0f\u5728 x86-64 \u5e73\u53f0\u4e0a\u4e3a 4 \u5b57\u8282\u3002\u4ece\u56fe\u7247\u53f3\u4fa7\u84dd\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u8bba\u3002</p> <ul> <li> <p>\u7b2c\u4e00\u884c\u4ee3\u7801\u5c06\u6574\u4e2a\u7ed3\u6784\u5bf9\u8c61 s \u6240\u5360\u7528\u7684 8 \u5b57\u8282\u7a7a\u95f4\u5168\u90e8\u7f6e\u96f6\uff0c\u6765\u4e3a\u540e\u7eed\u7684\u533f\u540d\u8054\u5408\u5bf9\u8c61\u8d4b\u503c\u505a\u51c6\u5907\uff1b</p> </li> <li> <p>\u7b2c\u4e8c\u884c\u4ee3\u7801\u5c06\u679a\u4e3e\u7c7b\u578b CHAR \u5bf9\u5e94\u7684\u503c 1 \u8d4b\u503c\u7ed9\u7ed3\u6784\u5bf9\u8c61 s \u5185\u7684\u679a\u4e3e\u5b57\u6bb5 type\uff1b</p> </li> <li> <p>\u7b2c\u4e09\u884c\u4ee3\u7801\u5c06\u5b57\u7b26 \u201ca\u201d \u5bf9\u5e94\u7684\u503c 97 \u5b58\u653e\u5230\u7ed3\u6784\u5bf9\u8c61 s \u5185\u7684\u533f\u540d\u8054\u5408\u5bf9\u8c61\u4e2d</p> <p>]\u6307\u4ee4 mov \u5728\u8fdb\u884c\u6570\u636e\u4f20\u9001\u65f6\uff0c\u5728\u76ee\u7684\u5730\u53c2\u6570\u4e2d\u4f7f\u7528\u4e86 BYTE\uff0c\u4e5f\u5c31\u662f\u201c\u53d6\u51fa\u201d\u4e86\u8054\u5408\u5bf9\u8c61\u6240\u5360\u7528\u7684 4 \u5b57\u8282\u7a7a\u95f4\u4e2d\u7684 1 \u4e2a\u5b57\u8282\uff0c\u5c06\u5176\u4f5c\u4e3a\u5b58\u653e\u5b57\u7b26\u6570\u503c\u7684\u76ee\u6807\u5185\u5b58\u7a7a\u95f4\u3002</p> </li> </ul> <p>\u7a81\u7136\u60f3\u8d77\uff1a\u90a3RISC\u7c7b\u6307\u4ee4\u7ea7\u600e\u4e48\u6307\u5b9a\u64cd\u4f5c\u7279\u5b9a\u51e0\u4e2aByte</p> <p>GPT:</p> <p>\u5728 ARM \u67b6\u6784\u4e2d\uff0c\u4e0e x86 \u67b6\u6784\u4e0d\u540c\uff0c\u901a\u5e38\u4e0d\u4f1a\u4f7f\u7528\u7c7b\u4f3c <code>BYTE</code>\u3001<code>QBYTE</code>\u3001<code>DBYTE</code> \u8fd9\u6837\u7684\u6307\u4ee4\u540e\u7f00\u6765\u6307\u5b9a\u64cd\u4f5c\u5185\u5b58\u4e2d\u7684\u7279\u5b9a\u5b57\u8282\u6216\u5b57\u3002ARM \u67b6\u6784\u662f\u4e00\u79cd\u7cbe\u7b80\u6307\u4ee4\u96c6\u8ba1\u7b97\u673a\uff08RISC\uff09\uff0c\u5b83\u7684\u6307\u4ee4\u96c6\u8bbe\u8ba1\u66f4\u52a0\u7b80\u6d01\u548c\u7edf\u4e00\uff0c\u4e0d\u50cf x86 \u90a3\u6837\u6709\u5404\u79cd\u4e0d\u540c\u957f\u5ea6\u7684\u6570\u636e\u7c7b\u578b\u540e\u7f00\u3002</p> <p>\u5728 ARM \u67b6\u6784\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 <code>LDR</code> \u548c <code>STR</code> \u6307\u4ee4\u6765\u8fdb\u884c\u5185\u5b58\u52a0\u8f7d\u548c\u5b58\u50a8\u64cd\u4f5c\u3002\u8fd9\u4e9b\u6307\u4ee4\u53ef\u4ee5\u6839\u636e\u64cd\u4f5c\u6570\u7684\u5927\u5c0f\u6765\u51b3\u5b9a\u52a0\u8f7d\u6216\u5b58\u50a8\u591a\u5c11\u4e2a\u5b57\u8282\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u4e0d\u540c\u7684\u5bc4\u5b58\u5668\u4f5c\u4e3a\u64cd\u4f5c\u6570\uff0c\u6765\u6307\u5b9a\u8981\u52a0\u8f7d\u6216\u5b58\u50a8\u7684\u6570\u636e\u5927\u5c0f\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u8981\u52a0\u8f7d\u4e00\u4e2a\u5b57\u8282\uff088\u4f4d\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LDRB</code> \u6307\u4ee4\uff1b\u5982\u679c\u8981\u52a0\u8f7d\u4e00\u4e2a\u5b57\uff0832\u4f4d\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LDR</code> \u6307\u4ee4\u3002\u7c7b\u4f3c\u5730\uff0c\u5b58\u50a8\u64cd\u4f5c\u4e5f\u6709\u76f8\u5e94\u7684\u6307\u4ee4\uff0c\u5982 <code>STRB</code> \u548c <code>STR</code>\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5728 ARM \u6c47\u7f16\u4e2d\u4f7f\u7528 <code>LDRB</code> \u548c <code>STRB</code> \u6307\u4ee4\u6765\u52a0\u8f7d\u548c\u5b58\u50a8\u5355\u4e2a\u5b57\u8282\uff1a</p> <pre><code>    LDRB r0, [r1]   ; \u4ece\u5730\u5740 r1 \u5904\u52a0\u8f7d\u4e00\u4e2a\u5b57\u8282\u5230\u5bc4\u5b58\u5668 r0\n    STRB r0, [r2]   ; \u5c06\u5bc4\u5b58\u5668 r0 \u4e2d\u7684\u5b57\u8282\u5b58\u50a8\u5230\u5730\u5740 r2 \u5904\n</code></pre> <p>\u5982\u679c\u8981\u52a0\u8f7d\u6216\u5b58\u50a8\u66f4\u591a\u5b57\u8282\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LDR</code> \u548c <code>STR</code> \u6307\u4ee4\uff0c\u5e76\u6839\u636e\u9700\u8981\u9009\u62e9\u5408\u9002\u7684\u5bc4\u5b58\u5668\u548c\u504f\u79fb\u91cf\u6765\u6307\u5b9a\u64cd\u4f5c\u7684\u5b57\u8282\u6570\u3002</p> <p>\u603b\u4e4b\uff0c\u5728 ARM \u67b6\u6784\u4e2d\uff0c\u901a\u5e38\u662f\u901a\u8fc7\u6307\u4ee4\u672c\u8eab\u548c\u64cd\u4f5c\u6570\u5bc4\u5b58\u5668\u7684\u9009\u62e9\u6765\u786e\u5b9a\u8981\u52a0\u8f7d\u6216\u5b58\u50a8\u7684\u5b57\u8282\u6570\uff0c\u800c\u4e0d\u662f\u50cf x86 \u90a3\u6837\u4f7f\u7528\u7279\u5b9a\u7684\u6570\u636e\u7c7b\u578b\u540e\u7f00\u6765\u6307\u5b9a\u3002</p> <p>\u6216\u8005\u76f4\u63a5\u5c06\u4e0a\u9762\u7684\u4ee3\u7801\u653e\u5230ARM\u4e0a\u53bb\u8dd1\uff08\u6a21\u62df\u5668\u6216\u8005\u5355\u7247\u673a\u4e0a\uff09</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_30","title":"\u603b\u7ed3","text":"<p>\u679a\u4e3e\u8fd9\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u7528\u4e8e\u8868\u793a\u53ef\u53d6\u503c\u8303\u56f4\u6709\u9650\u7684\u62bd\u8c61\u5b9e\u4f53\u3002</p> <ul> <li>\u679a\u4e3e\u7c7b\u578b\u4e2d\u7684\u679a\u4e3e\u503c\u53c8\u88ab\u79f0\u4e3a\u201c\u5177\u540d\u6574\u578b\u201d\uff0c\u56e0\u6b64\u5728 C \u4ee3\u7801\u4e2d\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u88ab\u5f53\u4f5c\u6574\u6570\u503c\u6765\u4f7f\u7528\u3002\u540c\u6837\u5730\uff0c\u5728\u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\u4e2d\uff0c\u679a\u4e3e\u503c\u5c06\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a\u5bf9\u5e94\u7684\u6574\u6570\u503c\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u8981\u5728\u8fdb\u884c C \u7f16\u7801\u65f6\u4fdd\u8bc1\u679a\u4e3e\u503c\u548c\u5b83\u5bf9\u5e94\u7684\u6574\u6570\u503c\u4e0d\u88ab\u4e71\u7528\u3002</li> <li>\u7ed3\u6784\u662f\u4e00\u79cd\u7528\u4e8e\u7ec4\u7ec7\u5f02\u6784\u6570\u636e\u7684\u590d\u5408\u6570\u636e\u7c7b\u578b\u3002\u5728\u7ed3\u6784\u4e2d\uff0c\u6240\u6709\u5b9a\u4e49\u7684\u6570\u636e\u5b57\u6bb5\u5728\u5185\u5b58\u4e2d\u6309\u987a\u5e8f\u6392\u5217\u3002\u4e3a\u4e86\u4fdd\u8bc1\u7ed3\u6784\u4e2d\u5404\u4e2a\u5b57\u6bb5\u6700\u9ad8\u6548\u7684\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\uff0c\u7f16\u8bd1\u5668\u5728\u5185\u5b58\u4e2d\u5e03\u5c40\u8fd9\u4e9b\u5b57\u6bb5\u6570\u636e\u65f6\uff0c\u4f1a\u4fdd\u8bc1\u5b83\u4eec\u7684\u8d77\u59cb\u5730\u5740\u6ee1\u8db3\u81ea\u7136\u5bf9\u9f50\u7684\u6807\u51c6\u3002\u56e0\u6b64\uff0c\u7ed3\u6784\u4e2d\u5b57\u6bb5\u7684\u4e0d\u540c\u5b9a\u4e49\u987a\u5e8f\u5c06\u76f4\u63a5\u5f71\u54cd\u7ed3\u6784\u5bf9\u8c61\u7684\u5b9e\u9645\u5185\u5b58\u5360\u7528\u5927\u5c0f\uff0c\u800c\u8fd9\u4e5f\u662f\u6211\u4eec\u8fdb\u884c\u7a0b\u5e8f\u4f18\u5316\u7684\u4e00\u4e2a\u91cd\u8981\u5207\u5165\u70b9\u3002</li> <li>\u8054\u5408\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u590d\u5408\u6570\u636e\u7c7b\u578b\uff0c\u5728\u5176\u5185\u90e8\u5b9a\u4e49\u7684\u6240\u6709\u6570\u636e\u5b57\u6bb5\u5c06\u5360\u7528\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u3002\u8054\u5408\u5bf9\u8c61\u7684\u5b9e\u9645\u5927\u5c0f\u4e0e\u5176\u5185\u90e8\u6240\u5b9a\u4e49\u6700\u5927\u5b57\u6bb5\u7684\u5927\u5c0f\u76f8\u540c\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u65e0\u6cd5\u4ece\u5916\u90e8\u5f97\u77e5\u4e00\u4e2a\u8054\u5408\u5bf9\u8c61\u4e2d\u6b63\u5728\u201c\u751f\u6548\u201d\u7684\u5b57\u6bb5\u7c7b\u578b\uff0c\u56e0\u6b64 Tagged Union \u7684\u4f7f\u7528\u65b9\u5f0f\u4fbf\u6210\u4e3a\u4e3b\u6d41\u3002\u5c06\u7528\u6765\u6807\u8bc6\u751f\u6548\u5b57\u6bb5\u7684\u679a\u4e3e\u7c7b\u578b\u4e0e\u8054\u5408\u8fdb\u884c\u201c\u6253\u5305\u201d\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4f7f\u7528\u8054\u5408\u5bf9\u8c61\u524d\u8fdb\u884c\u76f8\u5e94\u7684\u5224\u65ad\u548c\u51c6\u5907\uff0c\u800c\u8fd9\u4e5f\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684\u5065\u58ee\u6027\u6253\u4e0b\u4e86\u57fa\u7840</li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_31","title":"\u601d\u8003\u9898","text":"<pre><code>struct {\n  short a;\n  char b;\n  char c;\n  int* d;\n  union {\n    double e;\n    int f;\n  };\n};\nsizeof\u7684\u5927\u5c0f\u662f\u591a\u5c11\uff1f24\n</code></pre>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#07","title":"07\uff5c\u64cd\u63a7\u8d44\u6e90\uff1a\u6307\u9488\u662f\u5982\u4f55\u7075\u6d3b\u4f7f\u7528\u5185\u5b58\u7684\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_32","title":"\u57fa\u672c\u4f7f\u7528","text":"<p>\u89c2\u5bdf\u4e0a\u56fe\u4e2d\u7ea2\u6846\u4e0e\u84dd\u6846\u5185\u7684 C \u4ee3\u7801\u4e0e\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u6765\u5feb\u901f\u590d\u4e60\u4e00\u4e0b\u76f8\u5173\u5185\u5bb9\u3002</p> <p>\u53d6\u5730\u5740\u8fd0\u7b97\u7b26\u53ef\u4ee5\u7528\u6765\u83b7\u53d6\u5185\u5b58\u4e2d\u67d0\u4e2a\u6570\u636e\u7684\u6240\u5728\u5730\u5740\uff0c\u8be5\u8fc7\u7a0b\u4e00\u822c\u4f1a\u901a\u8fc7\u7ea2\u6846\u5185\u7684 lea \u6307\u4ee4\u6765\u5b9e\u73b0\uff0c\u800c\u89e3\u5f15\u7528\u7684\u8fc7\u7a0b\u6b63\u4e0e\u6b64\u76f8\u53cd\u3002\u5982\u53f3\u4fa7\u84dd\u6846\u5185\u7684\u7b2c\u4e8c\u884c\u4ee3\u7801\u6240\u793a\uff0c\u76f4\u63a5\u901a\u8fc7 mov \u6307\u4ee4\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u6309\u7167\u6240\u6307\u5411\u6570\u636e\u7c7b\u578b\u7684\u56fa\u5b9a\u5927\u5c0f\uff08\u8fd9\u91cc\u4e3a DWORD\uff0c\u5373 32 \u4f4d\uff09\uff0c\u6765\u4e0e\u5bf9\u5e94\u5185\u5b58\u5730\u5740\u4e0a\u5b58\u653e\u7684\u6570\u636e\u503c\u8fdb\u884c\u4ea4\u4e92\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_33","title":"\u6307\u9488\u4e0e\u6570\u7ec4","text":"<p>\u4ece\u4e0a\u56fe\u5de6\u4fa7\u7ea2\u6846\u5185\u7684 C \u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5728\u4e3b\u51fd\u6570\u5185\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5305\u542b\u6709 4 \u4e2a\u6574\u578b\u5143\u7d20\u7684\u6570\u7ec4 <code>arr</code>\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u4f1a\u4ee5\u76f8\u90bb\u7684\u65b9\u5f0f\u5206\u914d\u5728\u8fde\u7eed\u7684\u6808\u5185\u5b58\u4e2d\u3002\u4ece\u53f3\u4fa7\u7ea2\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u9a8c\u8bc1\u8fd9\u4e00\u70b9\u3002</p> <p>\u7d27\u63a5\u7740\uff0c\u901a\u8fc7\u8c03\u7528\u540d\u4e3a sum \u7684\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u6c42\u5f97\u6570\u7ec4\u5185\u6240\u6709\u5143\u7d20\u7684\u7d2f\u52a0\u548c\u3002\u8be5\u51fd\u6570\u5171\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u4e3a\u76ee\u6807\u6570\u7ec4\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u8be5\u6570\u7ec4\u5305\u542b\u7684\u5143\u7d20\u4e2a\u6570\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u76f4\u63a5\u5c06 <code>arr</code> \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\u3002\u800c\u6b64\u65f6\uff0c\u901a\u8fc7 <code>sizeof</code> \u8fd0\u7b97\u7b26\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u5728\u7f16\u8bd1\u65f6\u5f97\u5230\u6709\u5173\u6570\u7ec4 <code>arr</code> \u7684\u5927\u5c0f\u4fe1\u606f\uff0c\u5e76\u52a8\u6001\u8ba1\u7b97\u51fa\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\u3002</p> <p>\u4f46\u5f53\u6570\u7ec4 <code>arr</code> \u4f5c\u4e3a\u5b9e\u53c2\u88ab\u4f20\u5165\u51fd\u6570 sum \u540e\uff0c\u4e8b\u60c5\u53d1\u751f\u4e86\u53d8\u5316\u3002\u4ece\u4e0a\u56fe\u53f3\u4fa7\u84dd\u6846\u5185\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u51fd\u6570\u88ab\u8c03\u7528\u524d\uff0c<code>rdi</code> \u5bc4\u5b58\u5668\u5185\u5b58\u653e\u7684\u662f <code>rbp-16</code>\uff0c\u4e5f\u5c31\u662f\u6570\u7ec4 <code>arr</code> \u9996\u4e2a\u5143\u7d20\u5bf9\u5e94\u5730\u5740\u7684\u503c\u3002\u56e0\u6b64\uff0c\u4f20\u9012\u7ed9\u51fd\u6570 sum \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5b9e\u9645\u4e0a\u4e3a\u4e00\u4e2a\u6307\u5411 int \u7c7b\u578b\u7684\u6307\u9488\uff0c\u800c\u6709\u5173\u6570\u7ec4 <code>arr</code> \u7684\u5927\u5c0f\u548c\u7c7b\u578b\u7684\u4fe1\u606f\u5728\u6b64\u65f6\u5df2\u7ecf\u5168\u90e8\u4e22\u5931\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u5176\u4e3a\u201c\u6570\u7ec4\u7684\u9000\u5316\u201d\uff0c\u5373\u6570\u7ec4\u7c7b\u578b\u9000\u5316\u4e3a\u6307\u9488\u7c7b\u578b\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_34","title":"\u5176\u4ed6\u8fd0\u7b97","text":"<ul> <li> <p>\u7b97\u6570</p> <ul> <li>\u5355\u4e2a\u6307\u9488\u4e0e\u53e6\u4e00\u4e2a\u6574\u6570\u76f8\u52a0 / \u76f8\u51cf\uff1b</li> <li>\u5355\u4e2a\u6307\u9488\u81ea\u589e / \u81ea\u51cf\uff1b</li> <li>\u4e24\u4e2a\u6307\u9488\u6c42\u5dee\u3002</li> </ul> <p>\u6307\u9488\u5728\u8fdb\u884c\u7b97\u6570\u8fd0\u7b97\u540e\uff0c\u4e0d\u80fd\u5c06\u5176\u6307\u5411\u7684\u3001\u4ee5\u56fa\u5b9a\u957f\u5ea6\u5b57\u8282\u4f5c\u4e3a\u6574\u4f53\u7684\u6570\u636e\u503c\u201c\u62c6\u5206\u201d\u3002\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u5bf9\u6307\u9488\u8fdb\u884c\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001\u9012\u589e\u3001\u9012\u51cf\u8fd0\u7b97\u65f6\uff0c\u7f16\u8bd1\u5668\u5b9e\u9645\u4e0a\u662f\u4ee5\u5f53\u524d\u6307\u9488\u6240\u6307\u5411\u503c\u5bf9\u5e94\u7684\u67d0\u4e2a\u56fa\u5b9a\u957f\u5ea6\u4e3a\u5355\u4f4d\uff0c\u5bf9\u6307\u9488\u4e2d\u5b58\u653e\u7684\u5730\u5740\u503c\u8fdb\u884c\u76f8\u5e94\u8c03\u6574\u7684\u3002\u540c\u6837\uff0c\u5bf9\u4e8e\u6307\u9488\u4e4b\u95f4\u7684\u6c42\u5dee\u64cd\u4f5c\uff0c\u6c42\u5f97\u7684\u4e5f\u5e76\u4e0d\u662f\u4e24\u4e2a\u5730\u5740\u503c\u4e4b\u95f4\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\u5dee\uff0c\u800c\u662f\u7528\u8fd9\u4e2a\u5dee\u503c\u9664\u4ee5\u4e0a\u9762\u63d0\u5230\u7684\u56fa\u5b9a\u957f\u5ea6\u6240\u5f97\u5230\u7684\u7ed3\u679c\u3002</p> <p>\u4e0b\u9762\uff0c\u8ba9\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6765\u770b\u770b\u7f16\u8bd1\u5668\u662f\u5982\u4f55\u5728\u80cc\u540e\u5904\u7406\u9488\u5bf9\u6307\u9488\u7684\u7b97\u6570\u8fd0\u7b97\u7684\u3002\u8fd9\u91cc\u6211\u4ecb\u7ecd\u7684\u662f\u201c\u5355\u4e2a\u6307\u9488\u4e0e\u53e6\u4e00\u4e2a\u6574\u6570\u76f8\u52a0\u201d\u8fd9\u79cd\u573a\u666f\u3002\u7531\u4e8e\u5176\u4ed6\u6307\u9488\u7b97\u6570\u8fd0\u7b97\u7684\u8fc7\u7a0b\u4e0e\u6b64\u57fa\u672c\u7c7b\u4f3c\uff0c\u76f8\u4fe1\u7406\u89e3\u4e86\u8fd9\u4e00\u79cd\uff0c\u53e6\u5916\u51e0\u79cd\u4f60\u4e5f\u80fd\u878d\u4f1a\u8d2f\u901a\u3002</p> <p></p> <p>\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a <code>arr</code> \u7684\uff0c\u5177\u6709 2 \u884c 3 \u5217\uff0c\u5171 6 \u4e2a\u5143\u7d20\u7684\u4e8c\u7ef4\u6570\u7ec4\u3002</p> <p>\u4ece\u53f3\u4fa7\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u6570\u7ec4\u5185\u90e8\u7684\u6570\u636e\u662f\u4ee5\u5730\u5740\u8fde\u7eed\u7684\u65b9\u5f0f\u88ab\u5b58\u653e\u5728\u6808\u5185\u5b58\u4e2d\u7684\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u5b58\u50a8\u65b9\u5f0f\uff0c\u4f60\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u7f16\u8bd1\u5668\u5bf9 C \u4ee3\u7801\u4e2d\u7684\u591a\u7ef4\u6570\u7ec4\u8fdb\u884c\u7684\u6241\u5e73\u5316\uff08flatten\uff09\u5904\u7406\u3002\uff08\u8fd8\u662f\u76f8\u5f53\u4e8e\u4e00\u4e2a\u4e00\u7ef4\u6570\u7ec4\uff1f\u8fd9\u4e0d\u8fc7\u5957\u4e86\u4e00\u5c42\uff1f\uff09</p> <p>\u5728\u63a5\u4e0b\u6765\u7684 C \u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u6307\u9488\u7684\u65b9\u5f0f\u83b7\u53d6\u5e76\u6253\u5370\u4e86\u4f4d\u4e8e\u6570\u7ec4 <code>arr</code> \u4e2d\u4e24\u4e2a\u4e0d\u540c\u4f4d\u7f6e\u4e0a\u7684\u503c\u3002</p> <ul> <li> <p>\u84dd\u6846\u5185\u7684\u8868\u8fbe\u5f0f\u9996\u5148\u5bf9 <code>arr</code> \u8fdb\u884c\u4e86\u52a0\u4e00\u64cd\u4f5c\uff0c\u7136\u540e\u8fd4\u56de\u4e86\u5bf9\u8fd9\u4e2a\u7ecf\u8fc7\u201c\u7d2f\u52a0\u201d\u540e\u7684\u5730\u5740\u8fdb\u884c\u4e24\u6b21\u89e3\u5f15\u7528\u7684\u7ed3\u679c\u503c\u3002</p> <ul> <li>\u4ece\u53f3\u4fa7\u76f8\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9 <code>arr</code> \u7684\u52a0\u4e00\u64cd\u4f5c\u5bfc\u81f4 <code>rax</code> \u5bc4\u5b58\u5668\u4e2d\u7684\u503c\u88ab\u589e\u52a0 12\u3002\u800c\u8be5\u5bc4\u5b58\u5668\u4e2d\u539f\u5148\u5b58\u653e\u6709\u6570\u7ec4\u4e2d\u7b2c 1 \u884c\u7b2c 1 \u5217\u5143\u7d20\u5bf9\u5e94\u7684\u5730\u5740\u503c\uff0c\u56e0\u6b64\u5728\u7ecf\u8fc7\u8ba1\u7b97\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u6307\u5411\u5143\u7d20 4 \u7684\u201c\u4e8c\u7ea7\u6307\u9488\u201d\u3002</li> <li>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u53d8\u91cf <code>arr</code> \u8fdb\u884c\u52a0\u4e00\u64cd\u4f5c\uff0c\u5bfc\u81f4\u6307\u5411\u4e8c\u7ef4\u6570\u7ec4\u9996\u5143\u7d20\u7684\u6307\u9488\uff0c\u5411\u6808\u4e2d\u7684\u9ad8\u5730\u5740\u65b9\u5411\u79fb\u52a8\u4e86 12 \u4e2a\u5b57\u8282\u3002</li> <li>\u4e4b\u6240\u4ee5\u4f1a\u6709\u8fd9\u6837\u7684\u53d8\u5316\uff0c\u662f\u56e0\u4e3a <code>arr</code> \u5728\u8fd9\u91cc\u76f4\u63a5\u6307\u5411\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u662f\u4e8c\u7ef4\u6570\u7ec4\u4e2d\u6bcf\u4e00\u4e2a\u5305\u542b\u6709 3 \u4e2a\u6574\u578b\u5143\u7d20\u7684\u4e00\u7ef4\u6570\u7ec4\u3002\u800c\u6bcf\u4e00\u4e2a\u4e00\u7ef4\u6570\u7ec4\u7684\u5927\u5c0f\u90fd\u4e3a\u56fa\u5b9a\u7684 12 \u5b57\u8282\u3002\u56e0\u6b64\uff0c\u5f53\u5bf9 <code>arr</code> \u8fdb\u884c\u7b97\u6570\u8fd0\u7b97\u65f6\uff0c\u7f16\u8bd1\u5668\u4fbf\u4f1a\u4ee5\u5b83\u6240\u6307\u5411\u7684\u4e00\u7ef4\u6570\u7ec4\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\uff0c\u6765\u8fdb\u884c\u5730\u5740\u503c\u4e0a\u7684\u8c03\u6574\u3002</li> </ul> </li> <li> <p>\u9ec4\u6846\u5185\u7684\u7b2c\u4e8c\u6b21\u6570\u7ec4\u5143\u7d20\u8bbf\u95ee\uff0c\u7531\u4e8e <code>*arr</code> \u4f5c\u4e3a\u4e00\u7ea7\u6307\u9488\uff08\u7ecf\u8fc7\u4e86\u4e00\u6b21\u89e3\u5f15\u7528\uff09\uff0c\u76f4\u63a5\u6307\u5411\u7684\u662f\u4e8c\u7ef4\u6570\u7ec4\u5185\u67d0\u4e2a\u4e00\u7ef4\u6570\u7ec4\u4e2d\u7684\u6574\u578b\u5143\u7d20\uff0c\u56e0\u6b64\uff0c\u5bf9\u5b83\u8fdb\u884c\u52a0\u6cd5\u8fd0\u7b97\uff0c\u5c06\u4f1a\u4ee5 4 \u5b57\u8282\u4f5c\u4e3a\u5355\u4f4d\u6765\u8fdb\u884c\u5730\u5740\u4e0a\u7684\u8c03\u6574\u3002</p> </li> </ul> <pre><code>printf(\"%d\\n\", *(*(arr + 1) + 1));  // ?---&gt; 5\u5417\uff1f\n</code></pre> <p>\u6700\u540e\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6307\u9488\u7684\u7b97\u6570\u8fd0\u7b97\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u53ea\u9002\u7528\u4e8e\u6570\u7ec4\u76f8\u5173\u7684\u6307\u9488\u3002\u800c\u5728\u5176\u4ed6\u573a\u666f\u4e2d\uff0c\u5373\u4f7f\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\u8fd0\u884c\uff0c\u4f46\u7531\u4e8e\u6807\u51c6\u4e2d\u53ef\u80fd\u5e76\u672a\u8981\u6c42\u7f16\u8bd1\u5668\u7684\u5177\u4f53\u6c42\u503c\u89c4\u5219\uff0c\u56e0\u6b64\u5176\u884c\u4e3a\u662f\u672a\u5b9a\u4e49\u7684\uff0c\u7a0b\u5e8f\u7684\u8fd0\u884c\u7ed3\u679c\u65e0\u6cd5\u5f97\u5230\u4fdd\u969c\u3002</p> <p>\u8865\u5145</p> <p>\u4ee5\u4e0b\u662f\u9488\u5bf9\u60a8\u63d0\u5230\u7684\u4e09\u79cd\u6307\u9488\u8fd0\u7b97\u7684\u4f8b\u5b50\u4ee3\u7801\uff1a</p> <ol> <li> <p>\u5355\u4e2a\u6307\u9488\u4e0e\u53e6\u4e00\u4e2a\u6574\u6570\u76f8\u52a0 / \u76f8\u51cf\uff1a <pre><code>int arr[] = {10, 20, 30, 40, 50};\nint *ptr = arr;  // \u6307\u5411\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\n\n// \u6307\u9488\u52a0\u6cd5\nint index = 2;\nint *ptr_add = ptr + index;  // \u6307\u5411\u7b2c\u4e09\u4e2a\u5143\u7d20\uff0c\u537330\n\n// \u6307\u9488\u51cf\u6cd5\nint *ptr_sub = ptr + 4;  // \u6307\u5411\u6570\u7ec4\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u537350\n</code></pre></p> </li> <li> <p>\u5355\u4e2a\u6307\u9488\u81ea\u589e / \u81ea\u51cf\uff1a <pre><code>int value = 100;\nint *ptr = &amp;value;\n\n// \u6307\u9488\u81ea\u589e\nptr++;  // \u6307\u5411\u4e0b\u4e00\u4e2a\u5185\u5b58\u5730\u5740\n\n// \u6307\u9488\u81ea\u51cf\nptr--;  // \u56de\u5230\u539f\u6765\u7684\u5185\u5b58\u5730\u5740\n</code></pre></p> </li> <li> <p>\u4e24\u4e2a\u6307\u9488\u6c42\u5dee\uff1a <pre><code>int arr[] = {1, 2, 3, 4, 5};\nint *ptr1 = &amp;arr[1];  // \u6307\u5411\u7b2c\u4e8c\u4e2a\u5143\u7d20\uff0c\u53732\nint *ptr2 = &amp;arr[4];  // \u6307\u5411\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u53735\n\n// \u6307\u9488\u6c42\u5dee\nint diff = ptr2 - ptr1;  // \u7ed3\u679c\u4e3a3\uff0c\u56e0\u4e3a\u4e24\u4e2a\u6307\u9488\u76f8\u96943\u4e2a\u5143\u7d20\u7684\u8ddd\u79bb\n</code></pre></p> </li> </ol> <p>\u5728\u8fd9\u4e9b\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u5982\u4f55\u5bf9\u6307\u9488\u8fdb\u884c\u7b97\u672f\u8fd0\u7b97\uff0c\u5e76\u8bf4\u660e\u4e86\u6307\u9488\u8fd0\u7b97\u65f6\u7684\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\u3002\u5e0c\u673f\u8fd9\u4e9b\u4f8b\u5b50\u80fd\u5e2e\u52a9\u60a8\u66f4\u597d\u5730\u7406\u89e3\u6307\u9488\u8fd0\u7b97\u7684\u539f\u7406\u3002</p> </li> <li> <p>\u5173\u7cfb\u8fd0\u7b97</p> <p>02 \u8bb2\u4e2d\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u5173\u7cfb\u8fd0\u7b97\u7b26\u7684\u673a\u5668\u6307\u4ee4\u5b9e\u73b0\u65b9\u5f0f\u3002</p> <p>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u914d\u5408\u4f7f\u7528 <code>cmp</code> \u4e0e <code>setg</code> \u7b49\u6307\u4ee4\u6765\u5224\u65ad\u5173\u7cfb\u8fd0\u7b97\u7b26\u4e24\u4fa7\u64cd\u4f5c\u6570\u7684\u5927\u5c0f\uff0c\u5e76\u6839\u636e\u5224\u65ad\u7ed3\u679c\uff0c\u8fdb\u884c\u76f8\u5e94\u7684\u7f6e\u4f4d\u4e0e\u590d\u4f4d\u64cd\u4f5c\uff0c\u6700\u7ec8\u8fd4\u56de 0 \u6216 1 \u4f5c\u4e3a\u7ed3\u679c\u3002</p> <p>\u800c\u5bf9\u4e8e\u6307\u9488\u4e4b\u95f4\u7684\u5173\u7cfb\u8fd0\u7b97\u6765\u8bf4\uff0c\u5176\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u662f\u5982\u6b64\u3002\u4f46\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff1a\u867d\u7136\u5728\u673a\u5668\u6307\u4ee4\u5c42\u9762\uff0c\u6307\u9488\u7684\u5173\u7cfb\u8fd0\u7b97\u5b9e\u9645\u4e0a\u662f\u5bf9\u6307\u9488\u5185\u90e8\u6240\u5b58\u653e\u7684\u5730\u5740\u503c\u8fdb\u884c\u7684\u5927\u5c0f\u5224\u65ad\uff0c\u4f46\u4ece C \u8bed\u6cd5\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5177\u6709\u5b9e\u9645\u610f\u4e49\u7684\u6307\u9488\u5173\u7cfb\u8fd0\u7b97\u4ec5\u6709\u4e3a\u6570\u4e0d\u591a\u7684\u51e0\u79cd\u60c5\u51b5\uff08Comparison operators - cppreference.com\uff09\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u4f7f\u7528\u65b9\u5f0f\u5747\u4f1a\u4ea7\u751f\u672a\u5b9a\u4e49\u884c\u4e3a\uff08UB\uff09\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_35","title":"\u5806\u5185\u5b58\u6307\u9488","text":"<p>\u81ea\u5df1\u5728\u6d4b\u8bd5struct\u7684.\u548c-&gt;\u65f6\u5019\u5199\u7684\u4ee3\u7801\uff0c\u4f7f\u7528\u6307\u9488\u58f0\u660e\u65f6\uff0c\u9700\u8981\u5206\u914d\u7a7a\u95f4\uff01\u56e0\u4e3a\u6307\u9488\u53ea\u662f\u4e00\u4e2a\u53d8\u91cf\u554a\uff0c\u5b58\u50a8\u4e86\u7ed3\u6784\u4f53\uff08\u6df7\u5408\u4e86\u591a\u949f\u7c7b\u578b\u7684\u6570\u636e\uff09\u7684\u5730\u5740\uff0c\u4e0d\u7136segmental fault</p> <p>\u5728\u4e4b\u524d\u4ecb\u7ecd\u7684\u4f8b\u5b50\u4e2d\uff0c\u6307\u9488\u4ec5\u5f15\u7528\u4e86\u4f4d\u4e8e\u6808\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u6307\u9488\u8fd8\u6709\u53e6\u4e00\u4e2a\u66f4\u91cd\u8981\u7684\u4f5c\u7528\uff0c\u90a3\u5c31\u662f\u7ed9\u4e88\u4e86\u6211\u4eec\u7075\u6d3b\u64cd\u63a7\u5806\u5185\u5b58\u4e2d\u6570\u636e\u7684\u80fd\u529b\u3002</p> <ul> <li>\u5806\u540c\u6808\u7c7b\u4f3c\uff0c\u4e5f\u662f\u4f4d\u4e8e\u8fdb\u7a0b VAS \u4e2d\u7684\u4e00\u6bb5\u4e13\u95e8\u7528\u4e8e\u5b58\u653e\u6570\u636e\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6808\u4e2d\u7684\u6570\u636e\u968f\u7740\u51fd\u6570\u7684\u8c03\u7528\u4e0e\u8fd4\u56de\uff0c\u4f1a\u88ab\u7a0b\u5e8f\u81ea\u52a8\u91ca\u653e\u3002</li> <li>\u800c\u5806\u5219\u6709\u6240\u4e0d\u540c\uff0c\u5728\u5806\u4e2d\u8fdb\u884c\u6570\u636e\u5206\u914d\uff0c\u9700\u8981\u501f\u52a9\u7279\u5b9a\u7684\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0c\u5e76\u4e14\u88ab\u5206\u914d\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e0d\u4f1a\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\u800c\u81ea\u52a8\u6e05\u9664\u3002\u56e0\u6b64\uff0c\u5f53\u8fd9\u4e9b\u6570\u636e\u4e0d\u518d\u88ab\u7a0b\u5e8f\u4f7f\u7528\u65f6\uff0c\u4fbf\u9700\u8981\u663e\u5f0f\u624b\u52a8\u5730\u8c03\u7528\u76f8\u5e94\u7684\u7cfb\u7edf\u51fd\u6570\uff0c\u6765\u5c06\u5176\u91ca\u653e\u3002</li> </ul> <p>\u5e78\u8fd0\u7684\u662f\uff0cC \u6807\u51c6\u5e93\u4e2d\u5df2\u7ecf\u4e3a\u6211\u4eec\u5c01\u88c5\u597d\u4e86\u8fd9\u6837\u7684\u4e00\u4e9b\u51fd\u6570\u3002\u501f\u52a9\u5b83\u4eec\uff0c\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u5730\u7533\u8bf7\u4e0e\u91ca\u653e\u5806\u5185\u5b58\uff0c\u5e76\u4eab\u53d7\u5806\u5206\u914d\u7b97\u6cd5\u5e26\u6765\u7684\u6027\u80fd\u4fdd\u969c\u3002</p> <p>\u8fd9\u91cc\u6211\u5148\u5e26\u4f60\u56de\u987e\u4e00\u4e0b\u8fd9\u4e9b\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u4e4b\u540e\u5728 \u5b9e\u6218\u7bc7 \u8fdb\u4e00\u6b65\u7406\u89e3\u5185\u90e8\u539f\u7406\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#define N 5\nint main(void) {\n  int arr[] = { 1, 2, 3, 4, 5 };  \n  // \u5206\u914d\u7528\u4e8e\u5b58\u653e N \u4e2a\u6574\u6570\u7684\u5806\u5185\u5b58\uff1b\n  int* p = (int*) malloc(sizeof(int) * N);\n  // \u5c06\u6570\u7ec4 arr \u4e2d\u7684\u5143\u7d20\u590d\u5236\u5230\u5206\u914d\u7684\u5806\u5185\u5b58\u4e2d\uff1b\n  memcpy(p, arr, sizeof(int) * N);  \n  for (int i = 0; i &lt; N; ++i) {\n    // \u901a\u8fc7\u6307\u9488\u904d\u5386\u5806\u7a7a\u95f4\u4e2d\u7684\u6570\u636e\uff1b\n    printf(\"%d\\n\", *(p + i));\n  }\n  // \u91ca\u653e\u5148\u524d\u5206\u914d\u7684\u5806\u7a7a\u95f4\uff0c\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u56de\u6536\u5185\u5b58\uff1b\n  free(p);  \n  return 0;\n}\n</code></pre> <p>\u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u53ef\u80fd\u4f1a\u6709\u8fd9\u6837\u7684\u7591\u95ee\uff1a\u6211\u5e73\u65f6\u5199\u7684 C \u7a0b\u5e8f\u53ea\u9700\u8981\u4e34\u65f6\u53d8\u91cf\u5c31\u591f\u7528\u4e86\uff0c\u8fd9\u4e9b\u53d8\u91cf\u7684\u503c\u4f1a\u88ab\u5206\u914d\u5728\u6808\u5185\u5b58\u4e2d\uff0c\u90a3\u6211\u4eec\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981\u5806\u5462\uff1f</p> <p>\u56e0\u4e3a\u6808\u4e0a\u7684\u6570\u636e\u5728\u51fd\u6570\u8fd4\u56de\u65f6\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\u4e0d\u65ad\u62f7\u8d1d\u7684\u65b9\u5f0f\u4fdd\u6301\u5176\u201c\u5b58\u6d3b\u201d\u3002\u800c\u5168\u5c40\u53d8\u91cf\u548c\u9759\u6001\u53d8\u91cf\u7684\u751f\u5b58\u671f\u867d\u7136\u4e0e\u6574\u4e2a\u7a0b\u5e8f\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u4e5f\u5e76\u6ca1\u6709\u529e\u6cd5\u5728\u7a0b\u5e8f\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u52a8\u6001\u751f\u6210\uff0c\u4e14\u7f3a\u4e4f\u4e00\u5b9a\u8868\u73b0\u529b\u3002</p> <p>\u800c\u5806\u5185\u5b58\u5219\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002\u5b58\u653e\u5728\u5176\u5185\u90e8\u7684\u6570\u636e\u80fd\u591f\u7531\u7a0b\u5e8f\u52a8\u6001\u5730\u521b\u5efa\uff0c\u800c\u4e14\u53ef\u4ee5\u4fdd\u6301\u4e0e\u7a0b\u5e8f\u76f8\u540c\u7684\u6700\u5927\u751f\u5b58\u671f\u3002\u4e0d\u4ec5\u5982\u6b64\uff0c\u548c\u5168\u5c40\u53d8\u91cf\u3001\u9759\u6001\u53d8\u91cf\u8fd9\u4e24\u79cd\u5c06\u503c\u5b8c\u5168\u66b4\u9732\u7ed9\u6240\u6709\u7a0b\u5e8f\u4ee3\u7801\u4f7f\u7528\u7684\u65b9\u5f0f\u76f8\u6bd4\uff0c\u4f7f\u7528\u5806\u5185\u5b58\u53ef\u4ee5\u5c06\u6570\u636e\u7684\u4f7f\u7528\uff0c\u9650\u5236\u5728\u5176\u6240\u9700\u8981\u7684\u6700\u5c0f\u8303\u56f4\u5185\uff0c\u8fd9\u65e0\u7591\u52a0\u5f3a\u4e86\u7a0b\u5e8f\u5bf9\u5185\u5b58\u8d44\u6e90\u7684\u7cbe\u7ec6\u5316\u7ba1\u7406\u7a0b\u5ea6\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_36","title":"\u4f7f\u7528\u6307\u9488\u7684\u6ce8\u610f\u4e8b\u9879","text":"<p>\u501f\u52a9\u6307\u9488\uff0c\u6211\u4eec\u53ef\u4ee5\u7075\u6d3b\u5730\u4f7f\u7528\u7a0b\u5e8f\u5b58\u653e\u5728\u5806\u5185\u5b58\u4e0e\u6808\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u4f46\u4e0d\u5f53\u7684\u6307\u9488\u4f7f\u7528\u65b9\u5f0f\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u51fa\u73b0\u96be\u4ee5\u8c03\u8bd5\u3001\u751a\u81f3\u662f\u96be\u4ee5\u590d\u73b0\u7684 BUG\u3002\u5176\u4e2d\uff0c\u4f60\u9700\u8981\u7279\u522b\u6ce8\u610f\u907f\u514d\u4e0b\u9762\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u51fa\u73b0\u65e0\u6cd5\u9884\u6d4b\u7684\u672a\u5b9a\u4e49\u884c\u4e3a\uff1a</p> <ul> <li>\u89e3\u5f15\u7528\u672a\u521d\u59cb\u5316\u7684\u6307\u9488\uff1b</li> <li>\u51fd\u6570\u8fd4\u56de\u6307\u5411\u5176\u5185\u90e8\u5c40\u90e8\u53d8\u91cf\u7684\u6307\u9488\uff1b</li> <li>\u975e\u6307\u5411\u540c\u4e00\u6570\u7ec4\u5185\u5143\u7d20\u7684\u4e24\u4e2a\u6307\u9488\u4e4b\u95f4\u7684\u51cf\u6cd5\u64cd\u4f5c\uff1b</li> <li>\u2026\u2026</li> </ul> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5bf9\u5806\u6307\u9488\u8fdb\u884c\u6709\u6548\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u4e5f\u662f\u6211\u4eec\u5728\u6784\u5efa\u7a0b\u5e8f\u65f6\u9700\u8981\u6ce8\u610f\u7684\u95ee\u9898\u3002\u7531\u4e8e\u540c\u4e00\u4e2a\u5806\u6307\u9488\u53ef\u80fd\u4f1a\u5728\u7a0b\u5e8f\u7684\u4e0d\u540c\u51fd\u6570\u4e2d\u88ab\u4f7f\u7528\uff0c\u56e0\u6b64\u5c31\u8981\u7279\u522b\u6ce8\u610f\uff1a\u6211\u4eec\u5e94\u8be5\u901a\u8fc7 free \u51fd\u6570\u53ca\u65f6\u6e05\u7406\u5806\u5185\u5b58\uff0c\u4ee5\u9632\u6b62\u5185\u5b58\u6cc4\u9732\uff1b\u540c\u65f6\uff0c\u53c8\u4e0d\u5e94\u8be5\u53bb\u91ca\u653e\u4e00\u5757\u5df2\u7ecf\u88ab\u91ca\u653e\u8fc7\u7684\u5806\u5185\u5b58\uff08\u91cd\u590d\u91ca\u653e\u4f1a\u4ea7\u751f\u5f02\u5e38\uff09\u3002 </p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_37","title":"\u603b\u7ed3","text":"<ul> <li>\u5728 C \u4ee3\u7801\u4e2d\uff0c\u901a\u8fc7\u6dfb\u52a0\u7279\u5b9a\u7684 \u201c * \u201d \u7b26\u53f7\uff0c\u6211\u4eec\u53ef\u4ee5\u58f0\u660e\u6240\u5b9a\u4e49\u53d8\u91cf\u4e3a\u4e00\u4e2a\u6307\u9488\u7c7b\u578b\u3002\u800c\u4e0e\u6307\u9488\u6709\u5173\u7684\u4e24\u4e2a\u5e38\u7528\u64cd\u4f5c\u7b26\u4e3a\u53d6\u5730\u5740\u64cd\u4f5c\u7b26 \u201c&amp;\u201d \u4e0e\u89e3\u5f15\u7528\u64cd\u4f5c\u7b26 \u201c * \u201d\uff0c\u5b83\u4eec\u4e00\u822c\u53ef\u4ee5\u901a\u8fc7 lea \u6307\u4ee4\u4e0e mov \u6307\u4ee4\u6765\u5b9e\u73b0\u3002</li> <li>\u6307\u9488\u548c\u6570\u7ec4\u4e4b\u95f4\u7684\u5173\u7cfb</li> <li>\u5806\u4e0a\u6570\u636e\u7684\u6307\u9488</li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_38","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u6b63\u5e38\u7f16\u8bd1\u5417\uff1f</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n  int arr[] = { 1, 2, 3, 4 };\n  printf(\"%d\", arr[3] == 3[arr]); \n  return 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u901a\u8fc7\uff0c\u4f46\u662f\u53ef\u8bfb\u6027\u5dee\uff0c\u5b9e\u9645\u4ee3\u7801\u4e2d\u4e0d\u8981\u4f7f\u7528\u3002</p> <p>\u90fd\u8868\u793a\u540c\u6837\u7684\u4e1c\u897f\uff0c\u76f4\u63a5\u8fdb\u884c\u5224\u65ad\u4e3a1\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p></p> <p>\u4e0b\u6807\u8fd0\u7b97\u7b26[] \u7684\u5b9a\u4e49\u5c31\u662f\u7528\u4e8e\u4e24\u4e2a\u64cd\u4f5c\u6570\uff0c\u4e00\u4e2a\u4e3a\u6307\u9488\uff0c\u4e00\u4e2a\u4e3a\u6574\u6570\uff0c\u4f46\u5e76\u6ca1\u6709\u5b9a\u4e49\u987a\u5e8f\u5173\u7cfb\uff0c\u6240\u4ee5<code>arr[3]</code>\u5f53\u7136\u7b49\u4e8e <code>[3]arr</code>  \u8fd9\u662fc\u8bed\u8a00\u89c4\u8303\u5b9a\u4e49\u7684\u3002</p> <p><code>arr</code> \u662f\u6570\u7ec4\u540d\uff0c\u662f\u6570\u7ec4\u5bf9\u8c61\u7684\u6807\u8bc6\u7b26\uff0c\u5728\u8fd9\u8fb9\u7528\u4e8e\u8868\u8fbe\u5f0f\u65f6\u8f6c\u4e3a\u6307\u5411\u9996\u5143\u7d20\u7684\u6307\u9488\uff0c\u56e0\u4e3a <code>arr</code> \u662f\u4e8c\u7ef4\u6570\u7ec4\uff0c\u6240\u4ee5\u6b64\u65f6 <code>arr</code> \u8f6c\u6362\u4e3a\u6307\u9488\u540e\uff0c\u6307\u5411\u5b50\u6570\u7ec4{1,2,3}\u3002<code>arr+3</code> \u8303\u56f4\u8d85\u8fc7\u4e86 <code>arr</code> \u6570\u7ec4\u7684\u8303\u56f4\uff0c\u5730\u5740\u5e94\u8be5\u662f <code>arr\u7684\u5730\u5740\u503c+sizeof(int)\u00d73\u00d73</code></p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#08","title":"08\uff5c\u7f16\u8bd1\u51c6\u5907\uff1a\u9884\u5904\u7406\u5668\u662f\u600e\u6837\u5904\u7406\u7a0b\u5e8f\u4ee3\u7801\u7684\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_39","title":"\u9884\u5904\u7406\u8fdb\u884c\u7684\u6b65\u9aa4","text":"<ol> <li>\u5220\u9664\u6e90\u4ee3\u7801\u4e2d\u7684\u6240\u6709\u6ce8\u91ca\uff1b</li> <li>\u5904\u7406\u6240\u6709\u5b8f\u5b9a\u4e49\uff08#define\uff09\uff0c\u5e76\u8fdb\u884c\u5c55\u5f00\u548c\u66ff\u6362\uff1b</li> <li>\u5904\u7406\u6240\u6709\u6761\u4ef6\u9884\u7f16\u8bd1\u6307\u4ee4\uff08\u5982 <code>#if\u3001#elif</code>\uff09\uff0c\u4ec5\u4fdd\u7559\u7b26\u5408\u6761\u4ef6\u7684\u4ee3\u7801\uff1b</li> <li>\u5904\u7406\u6587\u4ef6\u5305\u542b\u9884\u7f16\u8bd1\u6307\u4ee4\uff08#include\uff09\uff0c\u5c06\u88ab\u5305\u542b\u6587\u4ef6\u7684\u5185\u5bb9\u63d2\u5165\u5230\u8be5\u6307\u4ee4\u7684\u6240\u5728\u4f4d\u7f6e\uff1b</li> <li>\u5904\u7406\u5176\u4ed6\u53ef\u4ee5\u8bc6\u522b\u7684\u9884\u5904\u7406\u6307\u4ee4\uff08\u5982 #pragma\uff09\uff1b</li> <li>\u6dfb\u52a0\u5176\u4ed6\u5177\u6709\u8f85\u52a9\u6027\u529f\u80fd\u7684\u6ce8\u91ca\u4fe1\u606f\u3002</li> </ol> <pre><code>#pragma GCC warning \"Just FYI!\"\n#include &lt;stdbool.h&gt;\n#define PI 3.14\n#define SQUARE(x) (x * x)\nint main(void) {\n#if defined PI\n  // Some specific calculations.\n  const double area = SQUARE(5) * PI;\n  const bool isAreaGT100 = area &gt; 100.0;\n#endif\n  return 0;\n}\n</code></pre>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_40","title":"\u5b9a\u4e49\u5b8f\u51fd\u6570\u6240\u4f7f\u7528\u7684\u6280\u5de7","text":"<p>\u9884\u5904\u7406\u5668\u5728\u8fdb\u884c\u5b8f\u5c55\u5f00\u548c\u5b8f\u66ff\u6362\u65f6\uff0c\u53ea\u4f1a\u5bf9\u6e90\u4ee3\u7801\u8fdb\u884c\u7b80\u5355\u7684\u6587\u672c\u66ff\u6362\u3002</p> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5b8f\u51fd\u6570\u6240\u8868\u8fbe\u7684\u8ba1\u7b97\u903b\u8f91\u4e0e\u66ff\u6362\u540e C \u4ee3\u7801\u7684\u5b9e\u9645\u8ba1\u7b97\u903b\u8f91\u4ea7\u751f\u5f88\u5927\u5dee\u5f02\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u7f16\u5199\u5b8f\u51fd\u6570\u65f6\uff0c\u6211\u4eec\u8981\u7279\u522b\u6ce8\u610f\u51fd\u6570\u5c55\u5f00\u540e\u7684\u903b\u8f91\u662f\u5426\u6b63\u786e\uff0c\u907f\u514d\u7531 C \u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7\u7b49\u56e0\u7d20\u5bfc\u81f4\u7684\u4e00\u7cfb\u5217\u95ee\u9898\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u8ba9\u6211\u4eec\u4e00\u8d77\u770b\u4e0b\uff1a\u5f53\u5728 C \u4ee3\u7801\u4e2d\u4f7f\u7528\u9884\u5904\u7406\u5668\u65f6\uff0c\u6709\u54ea\u4e9b tips \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p>\u6280\u5de7\u4e00\u6b65\u63a5\u4e00\u6b65</p> <ul> <li> <p>\u6280\u5de7\u4e00\uff1a\u4e3a\u5b8f\u51fd\u6570\u7684\u8fd4\u56de\u503c\u6dfb\u52a0\u62ec\u53f7</p> <pre><code>#include &lt;stdio.h&gt;\n#define FOO(x) 1 + x * x\nint main(void) {\n  printf(\"%d\", 3 * FOO(2));\n  return 0;\n}\n//\u7406\u60f3\u8f93\u51fa15 \u4f46\u662f\u5b9e\u9645\u4e3a7\n\u5c55\u5f00 printf(\"%d\", 3 * 1 + 2 * 2);\n</code></pre> </li> <li> <p>\u6280\u5de7\u4e8c\uff1a\u4e3a\u5b8f\u51fd\u6570\u7684\u53c2\u6570\u6dfb\u52a0\u62ec\u53f7</p> <pre><code>#include &lt;stdio.h&gt;\n#define FOO(x) (1 + x * x)\nint main(void) {\n  printf(\"%d\", FOO(1 + 2));\n  return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u6539\u53d8\u4e86\u5b8f\u51fd\u6570 FOO \u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u76f4\u63a5\u5c06\u8868\u8fbe\u5f0f 1 + 2 \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u4e86\u5b83\u3002</p> <p>\u7531\u4e8e\u7f16\u8bd1\u5668\u5728\u5904\u7406\u5b8f\u51fd\u6570\u65f6\uff0c\u4ec5\u4f1a\u8fdb\u884c\u5b9e\u53c2\u5728\u5404\u81ea\u4f4d\u7f6e\u4e0a\u7684\u6587\u672c\u66ff\u6362\uff0c\u4f20\u5165\u51fd\u6570\u7684\u8868\u8fbe\u5f0f\u5e76\u4e0d\u4f1a\u5728\u51fd\u6570\u5c55\u5f00\u524d\u8fdb\u884c\u6c42\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u7ecf\u8fc7\u7f16\u8bd1\u5668\u7684\u9884\u5904\u7406\u540e\uff0c\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7b2c\u56db\u884c\u5bf9 <code>printf</code> \u8bed\u53e5\u7684\u8c03\u7528\u8fc7\u7a0b\u4f1a\u88ab\u53d8\u66f4\u4e3a\u5982\u4e0b\u5f62\u5f0f\uff1a</p> <pre><code>printf(\"%d\", (1 + 1 + 2 * 1 + 2));\n</code></pre> </li> <li> <p>\u6280\u5de7\u4e09\uff1a\u8b66\u60d5\u5b8f\u51fd\u6570\u5bfc\u81f4\u7684\u591a\u6b21\u526f\u4f5c\u7528</p> <pre><code>#include &lt;stdio.h&gt;\n#define FOO(x) (1 + (x) * (x))\nint main(void) {\n  int i = 1;\n  printf(\"%d\", FOO(++i));\n  return 0;\n}\n\n\u5c55\u5f00 printf(\"%d\", (1 + (++i) * (++i)));\n</code></pre> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u60f3\u4f60\u5df2\u7ecf\u77e5\u9053\u4e86\u95ee\u9898\u6240\u5728\uff1a\u7ecf\u8fc7\u5b8f\u66ff\u6362\u7684 C \u4ee3\u7801\u5bfc\u81f4\u591a\u4e2a\u81ea\u589e\u8fd0\u7b97\u7b26\u88ab\u540c\u65f6\u5e94\u7528\u5728\u4e86\u8868\u8fbe\u5f0f\u4e2d\uff0c\u800c\u8be5\u8fd0\u7b97\u7b26\u5bf9\u53d8\u91cf i \u7684\u526f\u4f5c\u7528\u4ea7\u751f\u4e86\u591a\u6b21\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u5b8f\u51fd\u6570\u65f6\u9700\u8981\u6ce8\u610f\uff0c\u5b8f\u51fd\u6570\u7684\u201c\u8c03\u7528\u201d\u4e0e C \u51fd\u6570\u7684\u8c03\u7528\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u4e24\u79cd\u65b9\u5f0f\u3002</p> <p>\u524d\u8005\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u6808\u5e27\uff0c\u800c\u53ea\u662f\u5bf9\u6e90\u4ee3\u7801\u6587\u672c\u8fdb\u884c\u7b80\u5355\u7684\u5b57\u7b26\u66ff\u6362\u3002\u6240\u4ee5\uff0c\u5bf9\u4e8e\u66ff\u6362\u540e\u4ea7\u751f\u7684\u65b0\u4ee3\u7801\uff0c\u5176\u8ba1\u7b97\u903b\u8f91\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u800c\u8fd9\u53ef\u80fd\u4f1a\u5f15\u8d77\u7a0b\u5e8f\u8ba1\u7b97\u7ed3\u679c\u9519\u8bef\uff0c\u6216\u526f\u4f5c\u7528\u4ea7\u751f\u591a\u6b21\u7b49\u95ee\u9898\u3002</p> </li> <li> <p>\u6280\u5de7\u56db\uff1a\u5b9a\u4e49\u5b8c\u5907\u7684\u591a\u8bed\u53e5\u5b8f\u51fd\u6570</p> <p>\u5230\u8fd9\u91cc\uff0c\u5bf9\u4e8e\u5b9a\u4e49\u7b80\u5355\u5b8f\u51fd\u6570\u65f6\u53ef\u80fd\u9047\u5230\u7684\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u76f8\u4fe1\u4f60\u90fd\u80fd\u5904\u7406\u4e86\u3002</p> <p>\u4f46\u5f53\u5b8f\u51fd\u6570\u9010\u6e10\u53d8\u5f97\u590d\u6742\uff0c\u51fd\u6570\u4f53\u5185\u4e0d\u518d\u53ea\u6709\u4e00\u6761\u8bed\u53e5\u65f6\uff0c\u65b0\u7684\u95ee\u9898\u53c8\u51fa\u73b0\u4e86\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u4e0e C \u4ee3\u7801\u7684\u98ce\u683c\u4fdd\u6301\u4e00\u81f4\uff0c\u5728\u8c03\u7528\u5b8f\u51fd\u6570\u65f6\uff0c\u6211\u4eec\u4e5f\u4f1a\u4e60\u60ef\u6027\u5730\u4e3a\u6bcf\u4e00\u4e2a\u8c03\u7528\u8bed\u53e5\u7684\u672b\u5c3e\u52a0\u4e0a\u5206\u53f7\u3002\u4f46\u4e5f\u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\uff0c\u5f53\u542b\u6709\u591a\u884c\u8bed\u53e5\u7684\u5b8f\u51fd\u6570\u4e0e\u67d0\u4e9b\u63a7\u5236\u8bed\u53e5\u4e00\u8d77\u914d\u5408\u4f7f\u7528\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u610f\u60f3\u4e0d\u5230\u7684\u7ed3\u679c\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#define SAY() printf(\"Hello, \"); printf(\"world!\")\nint main(void) {\n  int input;\n  scanf(\"%d\", &amp;input);  \n  if (input &gt; 0)\n    SAY();\n  return 0;\n}\n</code></pre> <p>\u5f53\u6211\u4eec\u4e60\u60ef\u4f7f\u7528 C \u4ee3\u7801\u7684\u6267\u884c\u601d\u7ef4\u6765\u770b\u5f85\u5b8f\u51fd\u6570\u65f6\uff0c\u4e0a\u8ff0\u4ee3\u7801\u7684\u6267\u884c\u60c5\u51b5\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a\u7a0b\u5e8f\u63a5\u6536\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u6570\u5b57\u503c\u3002\u82e5\u8be5\u503c\u5927\u4e8e 0\uff0c\u5219\u5b8f\u51fd\u6570\u5185\u7684\u4e24\u6761 <code>printf</code> \u8bed\u53e5\u88ab\u6267\u884c\uff0c\u5e76\u8f93\u51fa\u5b57\u7b26\u4e32 \u201cHello, world!\u201d\u3002\u5426\u5219\uff0c\u7a0b\u5e8f\u76f4\u63a5\u9000\u51fa\u3002</p> <p>\u4f46\u73b0\u5b9e\u7684\u60c5\u51b5\u5374\u662f\uff0c\u65e0\u8bba\u7528\u6237\u8f93\u5165\u4f55\u503c\uff0c\u5b57\u7b26\u4e32 \u201cworld!\u201d \u90fd\u4f1a\u88ab\u6253\u5370\u3002\u800c\u95ee\u9898\u5c31\u51fa\u73b0\u5728\u5b8f\u51fd\u6570 SAY \u88ab\u5c55\u5f00\u548c\u66ff\u6362\u540e\uff0c\u539f\u672c\u201c\u5c01\u88c5\u201d\u5728\u4e00\u8d77\u7684\u4e24\u6761 <code>printf</code> \u8bed\u53e5\u88ab\u62c6\u5206\u5f00\u6765\u3002\u5176\u4e2d\u7684\u7b2c\u4e00\u6761\u8bed\u53e5\u6210\u4e3a\u4e86 if \u6761\u4ef6\u63a7\u5236\u8bed\u53e5\u7684\u6267\u884c\u5185\u5bb9\uff1b\u800c\u7b2c\u4e8c\u6761\u8bed\u53e5\u7531\u4e8e\u6ca1\u6709\u5927\u62ec\u53f7\u7684\u5305\u88f9\uff0c\u5219\u76f4\u63a5\u88ab\u201c\u91ca\u653e\u201d\u5230\u4e86 main \u51fd\u6570\u4e2d\uff0c\u6210\u4e3a\u4e86\u8be5\u51fd\u6570\u8fd4\u56de\u524d\u6700\u540e\u4e00\u6761\u4f1a\u88ab\u6267\u884c\u7684\u8bed\u53e5\u3002</p> <p>\u6539\u8fdb\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#define SAY() \\\n  do { printf(\"Hello, \"); printf(\"world!\"); } while(0)\nint main(void) {\n  int input;\n  scanf(\"%d\", &amp;input);  \n  if (input &gt; 0)\n    SAY();\n  return 0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u5c06 while \u5173\u952e\u5b57\u4e2d\u7684\u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff0c\u6211\u4eec\u53ef\u4ee5\u4fdd\u8bc1\u6574\u4e2a\u8fed\u4ee3\u8bed\u53e5\u4ec5\u4f1a\u88ab\u6267\u884c\u4e00\u6b21\u3002\u800c do\u2026while \u8bed\u53e5\u201c\u5929\u751f\u201d\u9700\u8981\u4ee5\u5206\u53f7\u7ed3\u5c3e\u7684\u6027\u8d28\uff0c\u4e5f\u6b63\u597d\u6ee1\u8db3\u4e86\u5b8f\u51fd\u6570\u66ff\u6362\u540e\u7684 C \u8bed\u6cd5\u683c\u5f0f\u8981\u6c42\u3002\u5e76\u4e14\uff0c\u5bf9\u4e8e while(0) \u8fd9\u79cd\u7279\u6b8a\u7684\u8fed\u4ee3\u5f62\u5f0f\uff0c\u5927\u591a\u6570\u7f16\u8bd1\u5668\u4e5f\u4f1a\u901a\u8fc7\u76f8\u5e94\u7684\u4f18\u5316\uff0c\u53bb\u6389\u4e0d\u5fc5\u8981\u7684\u5faa\u73af\u63a7\u5236\u7ed3\u6784\uff0c\u4ee5\u964d\u4f4e\u5bf9\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6027\u80fd\u7684\u5f71\u54cd\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_41","title":"\u4f55\u65f6\u4f7f\u7528\u9884\u5904\u7406\u5668","text":"<p>\u8bb2\u4e86\u8fd9\u4e48\u591a\u9884\u5904\u7406\u5668\u7684\u4f7f\u7528\u6280\u5de7\uff0c\u6700\u540e\u8fd8\u662f\u8981\u63d0\u9192\u4f60\uff1a\u9884\u5904\u7406\u5668\u662f\u4e00\u628a\u201c\u53cc\u5203\u5251\u201d\u3002\u5bf9\u5b83\u7684\u5408\u7406\u4f7f\u7528\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u7684\u7a0b\u5e8f\u5177\u5907\u66f4\u5f3a\u7684\u52a8\u6001\u6269\u5c55\u80fd\u529b\uff1b\u76f8\u53cd\uff0c\u5982\u679c\u4efb\u610f\u4e71\u7528\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u6e90\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u5927\u5927\u964d\u4f4e\uff0c\u751a\u81f3\u5f15\u5165\u96be\u4ee5\u8c03\u8bd5\u7684 BUG\u3002</p> <p>\u901a\u5e38\uff0c\u5728\u4ee5\u4e0b\u4e09\u4e2a\u573a\u666f\u4e2d\uff0c\u4f60\u53ef\u4ee5\u89c6\u60c5\u51b5\u9009\u62e9\u662f\u5426\u4f7f\u7528\u9884\u5904\u7406\u5668\uff1a</p> <ul> <li>\u5b9a\u4e49\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5230\u7684\u9b54\u6570\u3002\u8fd9\u91cc\u63d0\u5230\u7684\u9b54\u6570\uff0c\u4e3b\u8981\u662f\u6307\u90a3\u4e9b\u7528\u4e8e\u63a7\u5236\u7a0b\u5e8f\u8fd0\u884c\u72b6\u6001\u3001\u5177\u6709\u7279\u5b9a\u529f\u80fd\u610f\u4e49\u7684\u53c2\u6570\u3002\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528\u9884\u5904\u7406\u5668\u4ee5\u5b8f\u7684\u5f62\u5f0f\u5b9a\u4e49\uff0c\u5e76\u5728\u7a0b\u5e8f\u7f16\u8bd1\u524d\u5185\u8054\u5230\u6e90\u4ee3\u7801\u4e2d\u4f7f\u7528\uff1b</li> <li>\u57fa\u4e8e\u7279\u5b9a\u8fd0\u884c\u73af\u5883\u7684\u6761\u4ef6\u7f16\u8bd1\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u7684\u5b8f\uff08\u6bd4\u5982\u7f16\u8bd1\u5668\u9884\u5b9a\u4e49\u5b8f\u3001C \u8bed\u8a00\u5185\u7f6e\u5b8f\u7b49\uff09\u6765\u68c0\u6d4b\u5f53\u524d\u7f16\u8bd1\u73af\u5883\u7684\u72b6\u6001\uff0c\u5e76\u4ee5\u6b64\u8c03\u6574\u7a0b\u5e8f\u9700\u8981\u542f\u7528\u7684\u7279\u5b9a\u529f\u80fd\uff1b</li> <li>\u5c01\u88c5\u4ee3\u7801\u6a21\u677f\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b8f\u7684\u5f62\u5f0f\uff0c\u5c01\u88c5\u9700\u8981\u91cd\u590d\u51fa\u73b0\u7684\u4ee3\u7801\u7247\u6bb5\uff0c\u5e76\u5c06\u5b83\u4eec\u5e94\u7528\u5728\u5faa\u73af\u5c55\u5f00\u7b49\u573a\u666f\u4e2d\u3002</li> </ul> <p>\u5f53\u7136\uff0c\u771f\u5b9e\u7684\u4f7f\u7528\u573a\u666f\u5e76\u4e0d\u5c40\u9650\u4e8e\u8fd9\u4e09\u7c7b\u3002\u4f46\u8fd8\u662f\u8981\u5f3a\u8c03\u4e0b\uff1a\u5728\u4f7f\u7528\u9884\u5904\u7406\u5668\u65f6\uff0c\u4fdd\u6301\u8c28\u614e\u5c0f\u5fc3\u662f\u5fc5\u8981\u7684\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_42","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u5047\u5982\u8bf4\u6211\u638c\u63e1\u4e86C\u8bed\u8a00\u7684\u7f16\u8bd1\u4f53\u7cfb\uff08\u9884\u5904\u7406-&gt;\u7f16\u8bd1-&gt;\u6c47\u7f16-&gt;\u94fe\u63a5-&gt;\u88c5\u8f7d\uff09\uff0c\u90a3\u662f\u4e0d\u662f\u53ef\u4ee5\u6bd4\u8f83\u5bb9\u6613\u5730\u5207\u6362\u5230\u53e6\u4e00\u79cd\u7f16\u8bd1\u578b\u8bed\u8a00\uff1f</p> <p>\u638c\u63e1\u4e86C\u8bed\u8a00\u7684\u7f16\u8bd1\u4f53\u7cfb\u786e\u5b9e\u4f1a\u4e3a\u5b66\u4e60\u548c\u5207\u6362\u5230\u5176\u4ed6\u7f16\u8bd1\u578b\u8bed\u8a00\u5960\u5b9a\u4e00\u5b9a\u7684\u57fa\u7840\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u7f16\u8bd1\u578b\u8bed\u8a00\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u6709\u4e00\u4e9b\u5171\u901a\u7684\u6b65\u9aa4\u3002\u7136\u800c\uff0c\u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u8bed\u6cd5\u3001\u8bed\u4e49\u548c\u7279\u6027\uff0c\u56e0\u6b64\u4ecd\u7136\u9700\u8981\u5b66\u4e60\u65b0\u8bed\u8a00\u7684\u8bed\u6cd5\u548c\u7279\u6027\u3002</p> </li> <li> <p>C \u9884\u5904\u7406\u8fd0\u7b97\u7b26 \u201c#\u201d \u4e0e \u201c##\u201d \u7684\u7528\u6cd5</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u9884\u5904\u7406\u5668\u662f\u5728\u7f16\u8bd1\u9636\u6bb5\u6267\u884c\u7684\u4e00\u79cd\u7279\u6b8a\u7a0b\u5e8f\uff0c\u7528\u4e8e\u5728\u7f16\u8bd1\u4e4b\u524d\u5bf9\u6e90\u4ee3\u7801\u8fdb\u884c\u5904\u7406\u3002\u9884\u5904\u7406\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7279\u6b8a\u7684\u8fd0\u7b97\u7b26\u548c\u6307\u4ee4\uff0c\u5176\u4e2d\u5305\u62ec\u201c#\u201d\u548c\u201c##\u201d\u8fd0\u7b97\u7b26\u3002</p> <ol> <li># \u8fd0\u7b97\u7b26\uff1a</li> <li> <p>\u5728\u5b8f\u5b9a\u4e49\u4e2d\uff0c# \u8fd0\u7b97\u7b26\u7528\u4e8e\u5c06\u5b8f\u53c2\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</p> </li> <li> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b8f\u5b9a\u4e49\uff1a      <pre><code>#define STR(x) #x\n</code></pre>      \u5f53\u4f7f\u7528\u5b8f STR \u65f6\uff0c# \u8fd0\u7b97\u7b26\u4f1a\u5c06\u5b8f\u53c2\u6570 x \u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\uff1a      <pre><code>printf(\"%s\", STR(test)); // \u8f93\u51fa\u5b57\u7b26\u4e32 \"test\"\n</code></pre></p> <p>\u8fd0\u7b97\u7b26\u7684\u4f5c\u7528\u662f\u5c06\u5b8f\u53c2\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u8fd9\u5728\u4e00\u4e9b\u5b8f\u5b9a\u4e49\u4e2d\u975e\u5e38\u6709\u7528\uff0c\u53ef\u4ee5\u5c06\u53c2\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>## \u8fd0\u7b97\u7b26\uff1a</p> </li> <li> <p>\u5728\u5b8f\u5b9a\u4e49\u4e2d\uff0c## \u8fd0\u7b97\u7b26\u7528\u4e8e\u5c06\u4e24\u4e2a\u6807\u8bc6\u7b26\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a\u65b0\u7684\u6807\u8bc6\u7b26\u3002</p> </li> <li> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b8f\u5b9a\u4e49\uff1a      <pre><code>#define CONCAT(x, y) x##y\n</code></pre>      \u5f53\u4f7f\u7528\u5b8f CONCAT \u65f6\uff0c## \u8fd0\u7b97\u7b26\u4f1a\u5c06\u4e24\u4e2a\u53c2\u6570\u8fde\u63a5\u5728\u4e00\u8d77\uff1a      <pre><code>int num = CONCAT(10, 20); // \u76f8\u5f53\u4e8e int num = 1020;\n</code></pre></p> <p>\u8fd0\u7b97\u7b26\u7684\u4f5c\u7528\u662f\u5c06\u4e24\u4e2a\u6807\u8bc6\u7b26\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u7528\u4e8e\u52a8\u6001\u751f\u6210\u65b0\u7684\u6807\u8bc6\u7b26\uff0c\u8fd9\u5728\u4e00\u4e9b\u590d\u6742\u7684\u5b8f\u5b9a\u4e49\u4e2d\u975e\u5e38\u6709\u7528\u3002</p> </li> </ol> </li> <li> <p>\u770b\u8d77\u6765\u9884\u5904\u7406\u5668\u4f3c\u4e4e\u662f\u4e00\u4e2a\u72ec\u7acb\u4e8e\u7f16\u7a0b\u8bed\u8a00\u7684\u4e1c\u897f\uff0c\u90a3\u4e3a\u4f55\u5927\u591a\u6570\u8bed\u8a00\u4e0d\u5f15\u5165\u9884\u5904\u7406\u5668\u5462\uff1f\u8fd9\u6837\u60f3\u7528\u5b8f\u7684\u4eba\u53ef\u4ee5\u7528\u5b8f\uff0c\u4e0d\u60f3\u7528\u5b8f\u7684\u4eba\u53ef\u4ee5\u4e0d\u7528\uff0c\u4e0d\u662f\u66f4\u80fd\u6ee1\u8db3\u7a0b\u5e8f\u5458\u5417\uff1f</p> <p>\u4f5c\u8005\u56de\u590d: \u5c31\u50cf\u4f60\u8bf4\u7684\u4e00\u6837\uff0c\u5176\u5b9e\u5927\u90e8\u5206\u201c\u73b0\u4ee3\u8bed\u8a00\u201d\u90fd\u4e0d\u5e0c\u671b\u5c06\u9884\u5904\u7406\u5668\u4f5c\u4e3a\u8bed\u8a00\u81ea\u8eab\u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u7528\u4e00\u4e9b\u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u9884\u5904\u7406\u80fd\u529b\u6765\u5bf9\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\u524d\u7684\u5904\u7406\u3002</p> <p>\u603b\u7684\u6765\u770b\uff0c\u5927\u90e8\u5206\u4eba\u8ba4\u4e3a\u9884\u5904\u7406\u5668\u7684\u8fc7\u5ea6\u4f7f\u7528\u901a\u5e38\u4f1a\u5bfc\u81f4\u9879\u76ee\u6574\u4f53\u7ed3\u6784\u7684\u6df7\u4e71\uff0c\u4e14\u4e0d\u5229\u4e8e\u4ee3\u7801\u8c03\u8bd5\u3002\u5e76\u4e14\u5b8f\u4f5c\u4e3a\u7b80\u5355\u7684\u6587\u672c\u66ff\u6362\u4e5f\u4e0d\u5177\u5907\u8bed\u4e49\u4e0a\u7684\u5b8c\u5907\u6027\uff08\u5b8f\u5b9a\u4e49\u65f6\u7684\u5f62\u5f0f\u65e0\u6cd5\u51b3\u5b9a\u5176\u5177\u4f53\u4f7f\u7528\u65f6\u4ea7\u751f\u7684\u6548\u679c\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u8bed\u8a00\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5927\u5bb6\u90fd\u66f4\u503e\u5411\u4e8e\u505a\u7f16\u8bd1\u65f6\u4f18\u5316\uff0c\u5c3d\u91cf\u8ba9\u8bed\u8a00\u672c\u8eab\u7684\u7279\u6027\u5c31\u53ef\u4ee5\u6ee1\u8db3\u9884\u5904\u7406\u5668\u7684\u4f7f\u7528\u573a\u666f\u3002\u4e2a\u4eba\u7406\u89e3\u54c8~</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/1.%20%E8%AF%AD%E6%B3%95%E7%AF%87/example.html#_43","title":"\u603b\u7ed3","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html","title":"Example","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#12-c","title":"1&amp;2\uff5c\u6781\u81f4\u4f18\u5316\uff1a\u5982\u4f55\u5b9e\u73b0\u9ad8\u6027\u80fd\u7684 C \u7a0b\u5e8f\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_1","title":"\u5982\u4f55\u8861\u91cf\u7a0b\u5e8f\u7684\u8fd0\u884c\u6027\u80fd","text":"<ul> <li>\u5185\u5b58\u6027\u80fd</li> <li>\u8fd0\u884c\u65f6\u95f4</li> </ul> <p>\u5bf9\u4e8e\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u4e24\u4e2a\u7a0b\u5e8f\uff0c\u5728\u5b8c\u6210\u76f8\u540c\u4efb\u52a1\u65f6\uff0c\u54ea\u4e00\u4e2a\u7684\u5185\u5b58\u4f7f\u7528\u7387\u66f4\u4f4e\uff0c\u4e14\u8fd0\u884c\u65f6\u95f4\u66f4\u77ed\uff0c\u5219\u7a0b\u5e8f\u7684\u6574\u4f53\u6027\u80fd\u76f8\u5bf9\u66f4\u597d\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_2","title":"\u6280\u5de7\u4e00\uff1a\u5229\u7528\u9ad8\u901f\u7f13\u5b58","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_3","title":"\u6280\u5de7\u4e8c\uff1a\u4ee3\u7801\u5185\u8054","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#restrict","title":"\u6280\u5de7\u4e09\uff1arestrict\u5173\u952e\u5b57","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_4","title":"\u6280\u5de7\u56db\uff1a\u6d88\u9664\u4e0d\u5fc5\u8981\u7684\u5185\u5b58\u5f15\u7528","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_5","title":"\u6280\u5de7\u4e94\uff1a\u5faa\u73af\u5c55\u5f00","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_6","title":"\u6280\u5de7\u516d\uff1a\u4f18\u5148\u4f7f\u7528\u6761\u4ef6\u4f20\u9001\u6307\u4ee4","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_7","title":"\u6280\u5de7\u4e03\uff1a\u4f7f\u7528\u66f4\u9ad8\u7684\u7f16\u8bd1\u4f18\u5316\u7b49\u7ea7","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_8","title":"\u6280\u5de7\u516b\uff1a\u5c3e\u9012\u5f52\u4f18\u5316","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#3c","title":"3\uff5c\u751f\u4ea7\u52a0\u901f\uff1aC \u9879\u76ee\u9700\u8981\u8003\u8651\u7684\u7f16\u7801\u89c4\u8303\u6709\u54ea\u4e9b\uff1f","text":"<p>\u8fd9\u4e00\u8282\u53ef\u4ee5\u548c\u5929\u8d4b\u597d\u4e66\u7684\u300aC\u8bed\u8a00\u8fdb\u9636\u300b\u91cc\u7684\u89c4\u8303\u4e00\u8d77\u6765\u8bb2</p> <p>C\u4ee3\u7801\u89c4\u8303-C \u8bed\u8a00\u8fdb\u9636 (cntofu.com)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#4-c","title":"4\uff5c\u751f\u4ea7\u52a0\u901f\uff1a\u5982\u4f55\u4f7f\u7528\u81ea\u52a8\u5316\u6d4b\u8bd5\u786e\u4fdd C \u9879\u76ee\u8d28\u91cf\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_9","title":"\u5355\u5143\u6d4b\u8bd5","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u5355\u5143\u6d4b\u8bd5\u5c31\u662f\u5bf9\u7ec4\u6210\u7a0b\u5e8f\u6574\u4f53\u7ed3\u6784\u7684\u57fa\u672c\u5355\u5143\uff08\u4e5f\u53ef\u79f0\u4e3a\u6a21\u5757\uff09\u8fdb\u884c\u529f\u80fd\u6b63\u786e\u6027\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u3002\u5176\u76ee\u6807\u662f\uff0c\u9694\u79bb\u7a0b\u5e8f\u7684\u6bcf\u4e2a\u90e8\u5206\uff0c\u5e76\u5355\u72ec\u9a8c\u8bc1\u8fd9\u4e9b\u90e8\u5206\u80fd\u5426\u6309\u7167\u9884\u671f\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u5bf9\u4e8e C \u7a0b\u5e8f\u6765\u8bf4\uff0c\u8fd9\u91cc\u7684\u5355\u5143\u901a\u5e38\u4e3a\u7a0b\u5e8f\u4f7f\u7528\u5230\u7684\u5404\u4e2a\u51fd\u6570\u3002</p> <p>\u65e2\u7136\u8981\u5bf9\u8fd9\u4e9b\u57fa\u672c\u5355\u5143\u7684\u529f\u80fd\u8fdb\u884c\u6d4b\u8bd5\uff0c\u90a3\u4fbf\u9700\u8981\u7f16\u5199\u4e00\u4e9b\u4ee3\u7801\u6765\u4f7f\u7528\u8fd9\u4e9b\u5355\u5143\uff0c\u5e76\u4e3a\u5b83\u4eec\u63d0\u4f9b\u591a\u79cd\u4e0d\u540c\u8f93\u5165\uff0c\u6765\u9a8c\u8bc1\u76f8\u5e94\u7684\u8f93\u51fa\u6216\u526f\u4f5c\u7528\u53d8\u5316\u662f\u5426\u7b26\u5408\u5355\u5143\u7684\u6b63\u5e38\u529f\u80fd\u5b9e\u73b0\u3002\u800c\u4e3a\u4e86\u8ba9\u76ee\u6807\u5355\u5143\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u6b63\u5e38\u8fd0\u4f5c\uff0c\u6211\u4eec\u901a\u5e38\u8fd8\u9700\u8981\u4e3a\u5b83\u51c6\u5907\u7279\u5b9a\u7684\u914d\u5957\u6d4b\u8bd5\u73af\u5883\uff0c\u6bd4\u5982\u7528\u4e8e\u66ff\u6362\u771f\u5b9e\u4ee3\u7801\uff08\u5982\u5916\u90e8\u51fd\u6570\u8c03\u7528\uff09\u7684\u6869\uff08Stub\uff09\u4ee3\u7801\uff0c\u4ee5\u53ca\u5404\u7c7b Mock \u8d44\u6e90\uff08\u5982 DB \u8bbf\u95ee\u5c42\u3001\u5916\u90e8 API \u63a5\u53e3\uff09\u7b49\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u5728\u4e8e\uff0c\u9694\u79bb\u5355\u5143\u9700\u8981\u4f9d\u8d56\u7684\u5916\u90e8\u73af\u5883\uff0c\u4f7f\u6d4b\u8bd5\u8303\u56f4\u53ef\u4ee5\u5c3d\u91cf\u96c6\u4e2d\u5728\u5355\u5143\u7684\u5185\u90e8\u903b\u8f91\u4e0a\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_10","title":"\u96c6\u6210\u6d4b\u8bd5","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_11","title":"\u529f\u80fd\u6d4b\u8bd5","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_12","title":"\u6027\u80fd\u6d4b\u8bd5","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#_13","title":"\u6d4b\u8bd5\u81ea\u52a8\u5316","text":"<p>\u4ec0\u4e48\u662f\u201c\u771f\u6b63\u201d\u7684\u6d4b\u8bd5\u81ea\u52a8\u5316\uff1f\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u8c08\u5230\u7684\u201c\u6d4b\u8bd5\u81ea\u52a8\u5316\u201d\u662f\u6307\u4f7f\u7528\u811a\u672c\u6216\u6d4b\u8bd5\u6846\u67b6\uff0c\u4ee5\u7f16\u7a0b\u7684\u65b9\u5f0f\u4ee3\u66ff\u4f20\u7edf\u7684\u4eba\u5de5\u65b9\u5f0f\uff0c\u6765\u5bf9\u8f6f\u4ef6\u529f\u80fd\u8fdb\u884c\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002</p> <p>\u56e0\u6b64\uff0c\u53ea\u8981\u6d89\u53ca\u4e86\u6d4b\u8bd5\u6846\u67b6\u3001\u8f6f\u4ef6\u6216\u811a\u672c\u7684\u4f7f\u7528\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u79f0\u8fd9\u6837\u7684\u6d4b\u8bd5\u4e3a\u81ea\u52a8\u5316\u6d4b\u8bd5\u3002</p> <p>\u4f46\u4e0e\u4e4b\u76f8\u6bd4\u66f4\u6709\u610f\u4e49\u7684\uff0c\u662f\u5982\u4f55\u8fdb\u4e00\u6b65\u5730\u628a\u4e00\u4e9b\u91cd\u8981\u7684\u6d4b\u8bd5\u73af\u8282\u878d\u5165\u5230\u6211\u4eec\u7684\u65e5\u5e38\u5f00\u53d1\u548c\u529f\u80fd\u8fed\u4ee3\u4e2d\uff0c\u6765\u8ba9\u6574\u4e2a DevOps\uff08\u5373\u8f6f\u4ef6\u5f00\u53d1\u3001\u8d28\u91cf\u4fdd\u8bc1\u4ee5\u53ca\u7cfb\u7edf\u8fd0\u7ef4\uff09\u7684\u8fc7\u7a0b\u66f4\u52a0\u81ea\u52a8\u5316\u3002</p> <p>\u901a\u5e38\u7684\u505a\u6cd5\u662f\uff0c\u8ba9\u4e00\u4e9b\u9488\u5bf9\u8f6f\u4ef6\u57fa\u7840\u529f\u80fd\u7684\u6d4b\u8bd5\uff08\u5982\u5355\u5143\u6d4b\u8bd5\u3001\u529f\u80fd\u6d4b\u8bd5\u7b49\uff09\u6210\u4e3a\u6bcf\u4e00\u6b21\u751f\u4ea7\u53d1\u5e03\u524d\u90fd\u5fc5\u987b\u6267\u884c\u7684\u73af\u8282\uff0c\u5e76\u6307\u5b9a\u4e00\u5b9a\u7684\u8986\u76d6\u7387\u4f5c\u4e3a\u901a\u8fc7\u57fa\u51c6\u3002\u800c\u8fd9\u4e00\u822c\u8981\u6c42\u516c\u53f8\u63d0\u4f9b\u9488\u5bf9\u67d0\u4e00\u7c7b\u9879\u76ee\uff08\u6bd4\u5982 C \u8bed\u8a00\u9879\u76ee\uff09\u7684\u7edf\u4e00\u53d1\u5e03\u5e73\u53f0\uff0c\u4e14\u652f\u6301\u5bf9\u5b83\u4eec\u8fdb\u884c\u96c6\u4e2d\u7684\u6301\u7eed\u7f16\u8bd1\u3001\u6d4b\u8bd5\u3001\u90e8\u7f72\u3001\u53d1\u5e03\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u5e76\u8ba9\u6240\u6709\u76f8\u5173\u6d41\u7a0b\u53ef\u4ee5\u6309\u201c\u7ba1\u9053\u201d\u7684\u65b9\u5f0f\u4f9d\u6b21\u6709\u5e8f\u6267\u884c\u3002</p> <p>\u66f4\u591a\u5185\u5bb9\uff1aWhat is Continuous Integration: Testing, Software &amp; Process Tutorial (cloudbees.com)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#5-c","title":"5\uff5c\u751f\u4ea7\u52a0\u901f\uff1a\u5982\u4f55\u4f7f\u7528\u7ed3\u6784\u5316\u7f16\u8bd1\u52a0\u901f C \u9879\u76ee\u6784\u5efa\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#6-http-server","title":"6\uff5c\u5b9e\u6218\u9879\u76ee\uff08\u4e0a\uff09\uff1a\u4e00\u4e2a\u7b80\u5355\u7684\u9ad8\u6027\u80fd HTTP Server","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#posix-tcp-server","title":"POSIX \u63a5\u53e3\u5b9e\u73b0 TCP Server","text":"<p><code>FibServ</code> \u7684\u6700\u6838\u5fc3\u529f\u80fd\u4fbf\u662f\u5bf9 HTTP \u8bf7\u6c42\u7684\u63a5\u6536\u4e0e\u5e94\u7b54\uff0c\u4ee5 HTTP 1.1 \u6807\u51c6\u4f5c\u4e3a\u5b9e\u73b0\u8981\u6c42\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff0c\u6839\u636e RFC 7230 \u5bf9\u8be5\u6807\u51c6\u7684\u89c4\u5b9a\uff0cHTTP \u4f5c\u4e3a\u4e00\u79cd\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u9700\u8981\u57fa\u4e8e\u4ee5\u4f20\u8f93\u5c42 TCP \u534f\u8bae\u5efa\u7acb\u7684\u7f51\u7edc\u8fde\u63a5\u6765\u5b9e\u73b0\u3002</p> <p>Although HTTP is independent of the transport protocol, the \u201chttp\u201d scheme is specific to TCP-based services because the name delegation process depends on TCP for establishing authority.</p> <p>Linux\u7cfb\u7edf\u4e2d\uff0c\u501f\u52a9\u5957\u63a5\u5b57\uff08Socket\uff09\u63a5\u53e3\uff0c\u6211\u4eec\u4fbf\u80fd\u591f\u5efa\u7acb\u8fd9\u6837\u7684\u4e00\u4e2a\u8fde\u63a5\u3002\u8fd9\u5957\u63a5\u53e3\u5c5e\u4e8e POSIX.1 \u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\uff0c\u5b83\u4e5f\u540c\u65f6\u88ab Unix \u4e0e\u5404\u79cd\u7c7b Unix \u64cd\u4f5c\u7cfb\u7edf\u91c7\u7528\u3002</p> <p>\u5957\u63a5\u5b57\u63a5\u53e3\u7684\u5168\u79f0\u4e00\u822c\u4e3a\u201c\u5957\u63a5\u5b57\u7f51\u7edc\u8fdb\u7a0b\u95f4\u901a\u4fe1\u63a5\u53e3\u201d\u3002\u4ece\u540d\u79f0\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\uff0c\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u4fbf\u53ef\u8fdb\u884c\u5728\u540c\u4e00\u7f51\u7edc\u4e0b\uff0c\u751a\u81f3\u662f\u8de8\u4e0d\u540c\u7f51\u7edc\u7684\u901a\u4fe1\u8fc7\u7a0b\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0b\u63a5\u53e3\uff0c\u5b9e\u73b0\u6838\u5fc3\u7684\u7f51\u7edc\u8bf7\u6c42\u529f\u80fd</p> <ol> <li> <p>socket</p> <p>\u901a\u8fc7 socket \u521b\u5efa\u5957\u63a5\u5b57</p> <pre><code>int socket(\n  int domain, \n  int type, \n  int protocol);\n</code></pre> <ul> <li> <p>domain</p> <p>\u6307\u5b9a\u901a\u4fe1\u57df</p> </li> <li> <p>type</p> <p>\u5957\u63a5\u5b57\u7c7b\u578b</p> </li> <li> <p>protocol</p> <p>\u4f7f\u7528\u7684\u534f\u8bae</p> </li> </ul> </li> <li> <p>bind</p> <p>\u901a\u8fc7 bind \u5c06\u5957\u63a5\u5b57\u4e0e\u4e00\u4e2a\u5177\u4f53\u5730\u5740\u5173\u8054</p> <pre><code>int bind(\n  int sockfd, \n  const struct sockaddr *addr, \n  socklen_t addrlen);\n</code></pre> <p>bind \u63a5\u53e3\u4f7f\u7528\u7684\u5730\u5740\u5fc5\u987b\u662f\u5728\u7a0b\u5e8f\u8fdb\u7a0b\u8fd0\u884c\u6240\u5728\u7684\u8ba1\u7b97\u673a\u4e0a\u6709\u6548\u7684\u3002\u5728 <code>FibServ</code> \u7684\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u5c06\u76f4\u63a5\u4f7f\u7528\u672c\u673a\u5730\u5740 \u201c127.0.0.1\u201d\u3002</p> <p>bind \u63a5\u53e3\u5728\u8c03\u7528\u65f6\u5171\u63a5\u6536\u4e24\u90e8\u5206\u4fe1\u606f\uff0c</p> <ul> <li> <p>\u67d0\u4e2a\u5177\u4f53 socket \u5bf9\u8c61\u5bf9\u5e94\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</p> </li> <li> <p>\u53e6\u4e00\u90e8\u5206\u4e3a\u4e0e\u6240\u5173\u8054\u5730\u5740\u76f8\u5173\u7684\u6570\u636e\u7ed3\u6784\u3002</p> </li> </ul> </li> <li> <p>listen</p> <p>\u5c06\u4e00\u4e2a socket \u5bf9\u8c61\u53d8\u4e3a\u201c\u88ab\u52a8 socket\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be5 socket \u4f1a\u5728\u67d0\u4e2a\u5730\u5740\u4e0a\u6301\u7eed\u88ab\u52a8\u5730\u7b49\u5f85\u4ece\u5916\u90e8\u53d1\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u800c\u4e0d\u4f1a\u81ea\u5df1\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u3002</p> <pre><code>int listen(int sockfd, int backlog);\n</code></pre> <p>listen \u63a5\u53e3\u5171\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c</p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u67d0\u4e2a\u5177\u4f53 socket \u5bf9\u8c61\u5bf9\u5e94\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7528\u4e8e\u63a7\u5236\u201c\u6682\u5b58\u961f\u5217\u201d\u7684\u5927\u5c0f\u3002</li> </ul> <p>\u5f53\u8be5\u961f\u5217\u53d1\u751f\u6ea2\u51fa\u65f6\uff0c\u540e\u7eed\u7684\u8fde\u63a5\u8bf7\u6c42\u5c06\u4f1a\u88ab\u76f4\u63a5\u62d2\u7edd\uff08ECONNREFUSED\uff09\u3002</p> </li> <li> <p>accept</p> <p>\u901a\u8fc7 accept \u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u88ab\u52a8 socket \u5bf9\u5e94\u7684\u6682\u5b58\u961f\u5217\u4e2d\u4f9d\u6b21\u53d6\u51fa\u5df2\u7ecf\u5230\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\u8fd9\u91cc\uff0c\u8be5\u63a5\u53e3\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u5df2\u63a5\u53d7\u7684\u8bf7\u6c42\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684\u3001\u8868\u793a\u5df2\u8fde\u63a5\u7684 socket \u5bf9\u8c61\u3002</p> <pre><code>int accept(\n  int sockfd, \n  struct sockaddr *restrict addr, \n  socklen_t *restrict addrlen);\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a socket \u5bf9\u8c61\u8fdb\u884c\u5404\u79cd IO \u64cd\u4f5c\uff1aread\u3001write\u3002\u901a\u8fc7\u8bfb\u51fa\u5bf9\u5e94\u8bf7\u6c42\u7684\u6570\u636e\uff0c\u8fdb\u884c\u76f8\u5173\u5904\u7406\u3002\u540c\u65f6\u5c06\u9002\u5f53\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u82e5\u5728\u8c03\u7528 accept \u63a5\u53e3\u65f6\uff0c\u6682\u5b58\u961f\u5217\u4e2d\u6ca1\u6709\u5f85\u5904\u7406\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5219\u63a5\u53e3\u8c03\u7528\u8005\u5c06\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a\u8fde\u63a5\u8bf7\u6c42\u7684\u5230\u6765\u3002</p> </li> <li> <p>close</p> <pre><code>int close(int fd);\n</code></pre> </li> </ol> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#tcp-http","title":"TCP \u4e4b\u4e0a\uff1ahttp\u534f\u8bae","text":"<p>\u5728 HTTP 1.1 \u4e2d\uff0c\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u6570\u636e\u62a5\u6587\u662f\u4ee5\u7eaf\u6587\u672c\u5f62\u5f0f\u6765\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u9012\u7684\u3002</p> <p>\u5373\uff1a\u5f53 <code>FibServ</code> \u5728\u5904\u7406\u4e00\u4e2a HTTP \u8bf7\u6c42\u65f6\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5904\u7406\u4e00\u5806\u5ba2\u6237\u7aef\u53d1\u8fc7\u6765\u7684\u5b57\u7b26\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e9b\u5b57\u7b26\u662f\u6309\u7167\u7279\u5b9a\u683c\u5f0f\u7ec4\u7ec7\u7684\u3002</p> <p>\u81f3\u4e8e\u8fd9\u4e9b\u5b57\u7b26\u7684\u5177\u4f53\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 read \u63a5\u53e3\uff0c\u4ece\u5df2\u88ab\u63a5\u53d7\u7684\u8fde\u63a5\u5bf9\u5e94\u7684 socket \u5bf9\u8c61\u4e2d\u8bfb\u53d6\u51fa\u6765\u3002</p> <ul> <li> <p>\u4ee5 <code>FibServ</code> \u4e3a\u4f8b\u7684\u62a5\u6587\u683c\u5f0f</p> <ul> <li> <p>HTTP\u8bf7\u6c42\u62a5\u6587</p> <pre><code>GET /?num=10 HTTP/1.1\nHost: 127.0.0.1:8080\nUser-Agent: ApacheBench/2.3\nAccept: */*\n</code></pre> <p>\u6574\u4e2a\u62a5\u6587\u88ab\u5206\u4e3a\u4e09\u90e8\u5206\uff0c\u5373\u8d77\u59cb\u884c\u3001\u9996\u90e8\u5b57\u6bb5\uff0c\u4ee5\u53ca\u4e3b\u4f53\u3002</p> <ul> <li> <p>\u8d77\u59cb\u884c\u4e2d\u5305\u542b\u6709\u4e0e\u8be5\u8bf7\u6c42\u76f8\u5173\u7684\u65b9\u6cd5\uff08GET\uff09\u3001\u8def\u5f84\uff08/?num=10\uff09\uff0c\u4ee5\u53ca\u534f\u8bae\u4e0e\u7248\u672c\uff08HTTP/1.1\uff09\u4fe1\u606f\u3002</p> </li> <li> <p>\u9996\u90e8\u5b57\u6bb5\u4e2d\u5219\u5305\u542b\u6240\u6709\u7684\u8bf7\u6c42\u5934\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u901a\u5e38\u7528\u4e8e\u63a7\u5236\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u5e94\u8be5\u5982\u4f55\u5904\u7406\u8be5\u8bf7\u6c42\u3002</p> </li> <li>\u5bf9\u4e8e\u67d0\u4e9b\u5c5e\u4e8e\u7279\u5b9a\u65b9\u6cd5\u7684\u8bf7\u6c42\uff0c\u62a5\u6587\u4e2d\u901a\u5e38\u8fd8\u53ef\u80fd\u5305\u542b\u6709\u4e0e\u8bf7\u6c42\u4e00\u540c\u53d1\u9001\u8fc7\u6765\u7684\u5fc5\u8981\u6570\u636e\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u5219\u88ab\u6574\u7406\u5728\u4e86\u62a5\u6587\u201c\u6700\u4e0b\u65b9\u201d\u7684\u4e3b\u4f53\u90e8\u5206\u4e2d\u3002</li> </ul> </li> <li> <p>HTTP\u54cd\u5e94\u62a5\u6587</p> <p>\u7ed3\u6784\u7c7b\u4f3c\uff0c\u53ea\u662f\u8d77\u59cb\u884c\u4e2d\u5305\u542b\u7684\u4fe1\u606f\u53d1\u751f\u4e86\u53d8\u5316</p> <pre><code>HTTP/1.1 200 OK\nContent-type: text/plain\nContent-length: 2\n\n55\n</code></pre> <p>\u8fd9\u91cc\u7684 \u201c200\u201d \u548c \u201cOK\u201d \u5206\u522b\u8868\u793a\u4e86\u8be5\u54cd\u5e94\u7684\u72b6\u6001\u7801\u4e0e\u53ef\u8bfb\u72b6\u6001\u4fe1\u606f\u3002(404\uff1f)</p> </li> <li> <p>Summary</p> <ul> <li>\u8bf7\u6c42\u62a5\u6587\u7684\u8d77\u59cb\u884c\u63cf\u8ff0\u4e86\u8fd9\u4e2a\u8bf7\u6c42\u201c\u5e0c\u671b\u8981\u505a\u7684\u4e8b\u60c5\u201d\uff1b</li> <li>\u800c\u54cd\u5e94\u62a5\u6587\u7684\u8d77\u59cb\u884c\u5219\u63cf\u8ff0\u4e86\u201c\u8fd9\u4ef6\u4e8b\u505a\u5b8c\u540e\u7684\u7ed3\u679c\u72b6\u6001\u201d\u3002</li> <li>\u4e0e\u4e4b\u524d\u7684\u8bf7\u6c42\u62a5\u6587\u4e0d\u540c\uff0c\u8fd9\u4e2a\u54cd\u5e94\u62a5\u6587\u4e2d\u8fd8\u5305\u542b\u6709\u4e3b\u4f53\u90e8\u5206\u7684\u6570\u636e \u201c55\u201d\uff0c\u800c\u8fd9\u90e8\u5206\u6570\u636e\u4fbf\u662f\u4ece\u670d\u52a1\u5668\u8fd4\u56de\u7684\u8bf7\u6c42\u7ed3\u679c\u3002</li> </ul> <p>\u53e6\u5916\u8fd8\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u6807\u51c6\u4e2d\u89c4\u5b9a\uff0c\u8d77\u59cb\u884c\u548c\u9996\u90e8\u7684\u6bcf\u4e00\u884c\u90fd\u9700\u8981\u4ee5 CRLF\uff0c\u5373\u201c\u56de\u8f66\u7b26\u201d\u52a0\u201c\u6362\u884c\u7b26\u201d\u7684\u5f62\u5f0f\u7ed3\u5c3e\u3002\u800c\u5728\u9996\u90e8\u5b57\u6bb5\u4e0e\u4e3b\u4f53\u4e4b\u95f4\uff0c\u5219\u9700\u8981\u4ee5 CRLF \u7ed3\u5c3e\u7684\u4e00\u884c\u7a7a\u884c\u8fdb\u884c\u5206\u5272\u3002\u8fd9\u662f\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u6784\u5efa HTTP \u62a5\u6587\u65f6\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u3002</p> <p>HTTP 1.1 \u9664\u4e86\u5bf9\u62a5\u6587\u7684\u5177\u4f53\u683c\u5f0f\u505a\u4e86\u8be6\u7ec6\u89c4\u5b9a\u5916\uff0c\u5b83\u8fd8\u5bf9 TCP \u8fde\u63a5\u63a7\u5236\u3001\u7f13\u5b58\u7ba1\u7406\u3001\u8ba4\u8bc1\u673a\u5236\u7b49\u5176\u4ed6\u91cd\u8981\u529f\u80fd\u7684\u5b9e\u73b0\u8981\u6c42\u8fdb\u884c\u4e86\u8bf4\u660e\u3002</p> <p>\u4f46\u8003\u8651\u5230\u5b9e\u73b0\u6210\u672c\uff0c\u5728\u672c\u6b21\u5b9e\u6218\u4e2d\uff0c\u6211\u4eec\u4ec5\u4f1a\u5bf9 <code>FibServ</code> \u6536\u5230\u7684 HTTP \u8bf7\u6c42\u62a5\u6587\u8fdb\u884c\u9002\u5f53\u89e3\u6790\uff0c\u5e76\u8fd4\u56de\u76f8\u5e94\u7684\u54cd\u5e94\u62a5\u6587\u3002\u800c\u5728\u5176\u4ed6\u90e8\u5206\u7684\u5b9e\u73b0\u4e0a\uff0c\u53ef\u80fd\u5e76\u6ca1\u6709\u9075\u5faa HTTP \u534f\u8bae\u7684\u76f8\u5173\u89c4\u5b9a\uff08\u6bd4\u5982\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e94\u4f7f\u7528\u957f\u8fde\u63a5\uff09\u3002</p> </li> </ul> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#fibserv","title":"\u4f18\u5316 <code>FibServ</code>","text":"<p>\u4e3a\u4e86\u5c3d\u53ef\u80fd\u63d0\u9ad8 <code>FibServ</code> \u5904\u7406\u8bf7\u6c42\u65f6\u7684\u6027\u80fd\uff0c\u6211\u4eec\u5c06\u4ece\u51e0\u4e2a\u5f88\u5bb9\u6613\u60f3\u5230\u7684\u5730\u65b9\u5165\u624b\uff0c\u6765\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u9002\u5f53\u7684\u4f18\u5316\u3002</p> <ul> <li> <p>\u7b80\u6613\u7ebf\u7a0b\u6c60</p> <p>\u9996\u5148\u6765\u601d\u8003\u4e0b\uff1a\u5982\u4f55\u8ba9\u7a0b\u5e8f\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u7684\u591a\u4e2a\u5904\u7406\u5355\u5143\uff1f\u591a\u7ebf\u7a0b\uff1f</p> <ol> <li> <p>\u5e76\u884c\u5316\u5904\u7406\uff1a\u5229\u7528\u591a\u7ebf\u7a0b\u6216\u591a\u8fdb\u7a0b\u5e76\u884c\u5904\u7406\u4efb\u52a1\uff0c\u5c06\u4efb\u52a1\u5206\u89e3\u6210\u591a\u4e2a\u5b50\u4efb\u52a1\uff0c\u5206\u914d\u7ed9\u4e0d\u540c\u7684\u5904\u7406\u5355\u5143\u540c\u65f6\u6267\u884c\uff0c\u4ee5\u63d0\u9ad8\u6574\u4f53\u5904\u7406\u6027\u80fd\u3002\u53ef\u4ee5\u4f7f\u7528\u7ebf\u7a0b\u5e93\uff08\u5982<code>pthread</code>\uff09\u3001\u8fdb\u7a0b\u5e93\uff08\u5982fork/exec\uff09\u3001\u5e76\u884c\u7f16\u7a0b\u6846\u67b6\uff08\u5982OpenMP\u3001MPI\uff09\u7b49\u5de5\u5177\u6765\u5b9e\u73b0\u5e76\u884c\u5316\u5904\u7406\u3002</p> </li> <li> <p>\u4efb\u52a1\u8c03\u5ea6\u4f18\u5316\uff1a\u5408\u7406\u8bbe\u8ba1\u4efb\u52a1\u8c03\u5ea6\u7b97\u6cd5\uff0c\u786e\u4fdd\u4efb\u52a1\u5728\u591a\u4e2a\u5904\u7406\u5355\u5143\u4e4b\u95f4\u5747\u8861\u5206\u914d\uff0c\u907f\u514d\u5355\u4e2a\u5904\u7406\u5355\u5143\u8d1f\u8f7d\u8fc7\u91cd\u6216\u7a7a\u95f2\u3002\u53ef\u4ee5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u8c03\u5ea6\u5668\u6216\u81ea\u5b9a\u4e49\u8c03\u5ea6\u7b97\u6cd5\u6765\u4f18\u5316\u4efb\u52a1\u5206\u914d\u3002</p> </li> <li> <p>\u6570\u636e\u5171\u4eab\u4e0e\u540c\u6b65\uff1a\u5728\u591a\u6838CPU\u4e2d\uff0c\u591a\u4e2a\u5904\u7406\u5355\u5143\u53ef\u80fd\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0c\u56e0\u6b64\u9700\u8981\u8fdb\u884c\u5408\u7406\u7684\u6570\u636e\u5171\u4eab\u4e0e\u540c\u6b65\u64cd\u4f5c\uff0c\u907f\u514d\u6570\u636e\u7ade\u4e89\u548c\u6b7b\u9501\u3002\u53ef\u4ee5\u4f7f\u7528\u4e92\u65a5\u9501\u3001\u6761\u4ef6\u53d8\u91cf\u3001\u4fe1\u53f7\u91cf\u7b49\u673a\u5236\u6765\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u7684\u6570\u636e\u5171\u4eab\u4e0e\u540c\u6b65\u3002</p> </li> <li> <p>\u4f18\u5316\u7b97\u6cd5\u4e0e\u6570\u636e\u7ed3\u6784\uff1a\u9488\u5bf9\u591a\u6838CPU\u7684\u7279\u70b9\uff0c\u8bbe\u8ba1\u548c\u9009\u62e9\u9002\u5408\u5e76\u884c\u5904\u7406\u7684\u7b97\u6cd5\u548c\u6570\u636e\u7ed3\u6784\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u540c\u6b65\u548c\u901a\u4fe1\u5f00\u9500\uff0c\u63d0\u9ad8\u5e76\u884c\u5904\u7406\u6548\u7387\u3002</p> </li> <li> <p>\u5229\u7528\u5411\u91cf\u5316\u6307\u4ee4\u96c6\uff1a\u8bb8\u591a\u73b0\u4ee3CPU\u90fd\u652f\u6301SIMD\uff08Single Instruction, Multiple Data\uff09\u6307\u4ee4\u96c6\uff0c\u53ef\u4ee5\u540c\u65f6\u5bf9\u591a\u4e2a\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u63d0\u9ad8\u8ba1\u7b97\u6548\u7387\u3002\u5728\u7f16\u5199\u4ee3\u7801\u65f6\uff0c\u53ef\u4ee5\u5229\u7528\u5411\u91cf\u5316\u6307\u4ee4\u96c6\uff08\u5982SSE\u3001AVX\u7b49\uff09\u6765\u4f18\u5316\u8ba1\u7b97\u6027\u80fd\u3002</p> </li> <li> <p>\u51cf\u5c11\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\uff1a\u591a\u6838CPU\u4e2d\u591a\u4e2a\u5904\u7406\u5355\u5143\u5171\u4eab\u5185\u5b58\uff0c\u9891\u7e41\u7684\u5185\u5b58\u8bbf\u95ee\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\uff0c\u964d\u4f4e\u6027\u80fd\u3002\u53ef\u4ee5\u901a\u8fc7\u4f18\u5316\u5185\u5b58\u8bbf\u95ee\u6a21\u5f0f\u3001\u51cf\u5c11\u7f13\u5b58\u5931\u6548\u7b49\u65b9\u5f0f\u6765\u964d\u4f4e\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u3002</p> </li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u63aa\u65bd\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5229\u7528\u591a\u6838CPU\u7684\u591a\u4e2a\u5904\u7406\u5355\u5143\uff0c\u63d0\u9ad8\u8f6f\u4ef6\u7684\u5e76\u884c\u5904\u7406\u80fd\u529b\u548c\u6027\u80fd\u3002</p> <p>\u5728 <code>FibServ</code> \u7684\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u5c06\u4e3a\u5b83\u6784\u5efa\u4e00\u4e2a\u62e5\u6709\u56fa\u5b9a N \u4e2a\u5904\u7406\u7ebf\u7a0b\u7684\u7b80\u6613\u7ebf\u7a0b\u6c60\u3002</p> <p>\u5176\u4e2d\uff0cN \u53ef\u4ee5\u7531\u7528\u6237\u5728\u8fd0\u884c <code>FibServ</code> \u65f6\uff0c\u901a\u8fc7\u6dfb\u52a0\u989d\u5916\u7684\u53c2\u6570 \u201cthread_count\u201d \u6765\u6307\u5b9a\u3002\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\u65f6\uff0c\u90fd\u4f1a\u901a\u8fc7 accept \u63a5\u53e3\uff0c\u72ec\u7acb\u5730\u4ece socket \u5bf9\u5e94\u7684\u6682\u5b58\u961f\u5217\u4e2d\u53d6\u51fa\u4e0b\u4e00\u4e2a\u5f85\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u8fdb\u884c\u76f8\u5e94\u5904\u7406\u3002\u5373\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u4e00\u4e2asocket\u3002</p> <p>\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528\u591a\u4e2a CPU \u6838\u5fc3\uff0c\u4ee5\u8ba9\u5b83\u4eec\u5e76\u884c\u5730\u5904\u7406\u591a\u4e2a\u8bf7\u6c42\u3002</p> </li> <li> <p>\u5c3e\u9012\u5f52</p> <p>\u9488\u5bf9\u6590\u6ce2\u90a3\u5951\u8fd9\u79cd\u5e38\u89c1\u9012\u5f52\u4f8b\u5b50\uff0c\u7528\u5c3e\u9012\u5f52\u6765\u51cf\u5c11\u9012\u5f52\u4ee3\u66ff\u7684\u5f00\u9500</p> </li> <li> <p>\u907f\u514d\u5fd9\u7b49\u5f85</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u56de\u770b\u4e4b\u95f4\u7684\u540c\u6b65\u539f\u8bed\u90e8\u5206\u7684\u6761\u4ef6\u53d8\u91cf\uff0c\u5f88\u597d\u5730\u89e3\u51b3\u5fd9\u7b49\u5f85</p> <p>From teacher\uff1a</p> <p>\u4e3a\u4e86\u786e\u4fdd <code>FibServ</code> \u80fd\u591f\u5728\u8bf7\u6c42\u5904\u7406\u7ebf\u7a0b\u5f02\u5e38\u9000\u51fa\u65f6\uff0c\u4ecd\u7136\u4fdd\u8bc1\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u91cf\u4e3a N\uff0c\u8fd9\u91cc\u4e0d\u4f7f\u7528\u5fd9\u7b49\u5f85\u7684\u65b9\u5f0f\u6301\u7eed\u5224\u65ad\u5b58\u6d3b\u7684\u7ebf\u7a0b\u6570\u91cf\u3002\u76f8\u5bf9\u5730\uff0c\u4f7f\u7528\u6761\u4ef6\u53d8\u91cf\uff0c\u6765\u8ba9\u5904\u7406\u7ebf\u7a0b\u5728\u9000\u51fa\u65f6\uff0c\u53ca\u65f6\u901a\u77e5\u4e3b\u7ebf\u7a0b\u521b\u5efa\u65b0\u7684\u5904\u7406\u7ebf\u7a0b\u3002</p> <p>\u800c\u4e3b\u7ebf\u7a0b\u4e5f\u5c06\u5728\u5904\u7406\u7ebf\u7a0b\u6570\u91cf\u6ee1\u8db3\u8981\u6c42\u65f6\uff0c\u518d\u6b21\u8fdb\u5165\u963b\u585e\u72b6\u6001\u3002</p> <p>\u53ef\u80fd\u6027\u80fd\u6ca1\u63d0\u9ad8\u591a\u5c11\uff0c\u4f46\u5bf9\u4e8e\u7406\u89e3\u201c\u6761\u4ef6\u53d8\u91cf\u201d\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u65b9\u5f0f\uff0c\u8fd8\u662f\u6709\u5e2e\u52a9\u7684\u3002</p> </li> <li> <p>More optimizations</p> <p>\u7528cache\uff1f\u5185\u5b58\u7f13\u5b58\u3001\u78c1\u76d8\u7f13\u5b58\uff1f</p> <p>\u6ca1\u60f3\u5230\uff1a\u7528\u5f02\u6b65IO\uff0c\u975e\u963b\u585e\u3002\u66f4\u591a\u597d\u50cf\u6ca1\u4e86\u89e3\u8fc7\uff1f</p> <p>\u8981\u4f18\u5316\u548c\u63d0\u5347\u81ea\u5df1\u7f16\u5199\u7684\u7b80\u6613HTTP\u670d\u52a1\u5668\u7684\u6027\u80fd\uff0c\u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u4f18\u5316\u7b56\u7565\uff1a</p> <ol> <li> <p>\u4f7f\u7528\u5f02\u6b65I/O\uff1a\u91c7\u7528\u5f02\u6b65I/O\u6a21\u578b\uff08\u5982<code>epoll</code>\u3001<code>kqueue</code>\u7b49\uff09\u53ef\u4ee5\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u51cf\u5c11I/O\u963b\u585e\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u901a\u8fc7\u975e\u963b\u585eI/O\u548c\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u5904\u7406\u591a\u4e2a\u5e76\u53d1\u8fde\u63a5\u3002</p> </li> <li> <p>\u591a\u7ebf\u7a0b/\u591a\u8fdb\u7a0b\u5904\u7406\uff1a\u4f7f\u7528\u591a\u7ebf\u7a0b\u6216\u591a\u8fdb\u7a0b\u5904\u7406\u8bf7\u6c42\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528\u591a\u6838CPU\u7684\u4f18\u52bf\uff0c\u63d0\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002\u53ef\u4ee5\u91c7\u7528\u7ebf\u7a0b\u6c60\u6216\u8fdb\u7a0b\u6c60\u6765\u7ba1\u7406\u5e76\u53d1\u8bf7\u6c42\uff0c\u907f\u514d\u9891\u7e41\u521b\u5efa\u9500\u6bc1\u7ebf\u7a0b/\u8fdb\u7a0b\u7684\u5f00\u9500\u3002</p> </li> <li> <p>\u7f13\u5b58\u6280\u672f\uff1a\u4f7f\u7528\u7f13\u5b58\u6280\u672f\uff08\u5982\u5185\u5b58\u7f13\u5b58\u3001\u78c1\u76d8\u7f13\u5b58\uff09\u53ef\u4ee5\u51cf\u5c11\u5bf9\u6570\u636e\u5e93\u6216\u6587\u4ef6\u7cfb\u7edf\u7684\u9891\u7e41\u8bbf\u95ee\uff0c\u63d0\u9ad8\u6570\u636e\u8bfb\u53d6\u901f\u5ea6\u3002\u53ef\u4ee5\u4f7f\u7528\u7f13\u5b58\u6765\u5b58\u50a8\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u51cf\u5c11\u8ba1\u7b97\u548cI/O\u5f00\u9500\u3002</p> </li> <li> <p>HTTP\u8fde\u63a5\u590d\u7528\uff1a\u901a\u8fc7HTTP\u8fde\u63a5\u7684\u590d\u7528\uff08\u5982HTTP Keep-Alive\u673a\u5236\uff09\uff0c\u53ef\u4ee5\u51cf\u5c11\u8fde\u63a5\u5efa\u7acb\u548c\u5173\u95ed\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u4fdd\u6301\u957f\u8fde\u63a5\u53ef\u4ee5\u51cf\u5c11TCP\u8fde\u63a5\u7684\u5efa\u7acb\u548c\u65ad\u5f00\u6b21\u6570\uff0c\u63d0\u9ad8\u6570\u636e\u4f20\u8f93\u6548\u7387\u3002</p> </li> <li> <p>\u4f18\u5316\u7f51\u7edc\u901a\u4fe1\uff1a\u901a\u8fc7\u4f18\u5316\u7f51\u7edc\u901a\u4fe1\uff08\u5982TCP\u53c2\u6570\u8c03\u4f18\u3001\u4f7f\u7528\u66f4\u9ad8\u6548\u7684\u534f\u8bae\u7b49\uff09\uff0c\u53ef\u4ee5\u51cf\u5c11\u7f51\u7edc\u5ef6\u8fdf\u548c\u63d0\u9ad8\u6570\u636e\u4f20\u8f93\u6548\u7387\u3002\u8c03\u6574TCP\u53c2\u6570\u3001\u4f7f\u7528\u66f4\u5feb\u901f\u7684\u4f20\u8f93\u534f\u8bae\uff08\u5982HTTP/2\uff09\u53ef\u4ee5\u63d0\u9ad8\u7f51\u7edc\u6027\u80fd\u3002</p> </li> <li> <p>\u6027\u80fd\u76d1\u63a7\u4e0e\u8c03\u4f18\uff1a\u901a\u8fc7\u6027\u80fd\u76d1\u63a7\u5de5\u5177\uff08\u5982top\u3001vmstat\u7b49\uff09\u5bf9\u670d\u52a1\u5668\u6027\u80fd\u8fdb\u884c\u76d1\u63a7\uff0c\u627e\u51fa\u6027\u80fd\u74f6\u9888\u5e76\u8fdb\u884c\u8c03\u4f18\u3002\u53ef\u4ee5\u4f18\u5316\u4ee3\u7801\u3001\u51cf\u5c11\u8d44\u6e90\u5360\u7528\uff0c\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u6027\u80fd\u548c\u7a33\u5b9a\u6027\u3002</p> </li> <li> <p>\u5b89\u5168\u6027\u4f18\u5316\uff1a\u4fdd\u969c\u670d\u52a1\u5668\u7684\u5b89\u5168\u6027\u4e5f\u662f\u63d0\u5347\u6027\u80fd\u7684\u91cd\u8981\u4e00\u73af\u3002\u9632\u6b62DDoS\u653b\u51fb\u3001SQL\u6ce8\u5165\u7b49\u5b89\u5168\u95ee\u9898\u53ef\u4ee5\u907f\u514d\u670d\u52a1\u5668\u56e0\u5b89\u5168\u95ee\u9898\u800c\u6027\u80fd\u4e0b\u964d\u3002</p> </li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u4f18\u5316\u7b56\u7565\uff0c\u53ef\u4ee5\u63d0\u5347\u81ea\u5df1\u7f16\u5199\u7684\u7b80\u6613HTTP\u670d\u52a1\u5668\u7684\u6027\u80fd\uff0c\u63d0\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\u548c\u54cd\u5e94\u901f\u5ea6\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#7-http-server","title":"7\uff5c\u5b9e\u6218\u9879\u76ee\uff08\u4e0b\uff09\uff1a\u4e00\u4e2a\u7b80\u5355\u7684\u9ad8\u6027\u80fd HTTP Server","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E5%B7%A5%E7%A8%8B/example.html#structure","title":"Structure","text":"<p>Learn how to use CMake first</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html","title":"Example","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#0","title":"0 | \u6982\u62ec","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#1","title":"1\uff5c\u6807\u51c6\u5e93\uff1a\u5b57\u7b26\u3001\u5b57\u7b26\u4e32\u5904\u7406\u4e0e\u6570\u5b66\u8ba1\u7b97","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_1","title":"\u5b57\u7b26\u548c\u5b57\u7b26\u4e32","text":"<ul> <li> <p>\u5b57\u7b26</p> <p>\u5728 C \u8bed\u8a00\u6807\u51c6\u4e2d\uff0c\u4e0d\u540c\u4e8e\u5176\u4ed6\u6574\u6570\u7c7b\u578b\uff08\u6bd4\u5982 int\uff09\uff0c\u5b57\u7b26\u7c7b\u578b char \u5e76\u6ca1\u6709\u88ab\u89c4\u5b9a\u9ed8\u8ba4\u7684\u7b26\u53f7\u6027\uff0c\u800c\u5176\u5177\u4f53\u7b26\u53f7\u6027\u5219\u662f\u7531\u7f16\u8bd1\u5668\u548c\u6240\u5728\u5e73\u53f0\u51b3\u5b9a\u7684\u3002\u867d\u7136\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u9009\u62e9\u5c06\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7684 char \u7c7b\u578b\u89c6\u4e3a\u6709\u7b26\u53f7\u6574\u6570\u7c7b\u578b\uff0c\u4f46\u8003\u8651\u5230\u7a0b\u5e8f\u7684\u53ef\u7528\u6027\u4e0e\u53ef\u79fb\u690d\u6027\uff0c\u5728\u5b9e\u9645\u7f16\u7801\u4e2d\u8fd8\u662f\u5efa\u8bae\u663e\u5f0f\u6307\u5b9a\u51fa\u6240\u5b9a\u4e49\u5b57\u7b26\u53d8\u91cf\u7684\u7b26\u53f7\u6027\u3002C \u6807\u51c6\u4e2d\u4e4b\u6240\u4ee5\u8fd9\u6837\u89c4\u5b9a\uff0c\u4e3b\u8981\u6e90\u4e8e\u5176\u5386\u53f2\u539f\u56e0\u3002\u6bd4\u8f83\u6709\u4ee3\u8868\u6027\u7684\u4e00\u79cd\u8bf4\u6cd5\u662f\uff1aC \u8bed\u8a00\u5728\u8bbe\u8ba1\u4e4b\u521d\u53c2\u8003\u4e86\u5b83\u7684\u201c\u524d\u8f88\u201d B \u8bed\u8a00\u3002B \u8bed\u8a00\u4e8e 1969 \u5e74\u7531 Ken Thompson \u5728\u8d1d\u5c14\u5b9e\u9a8c\u5ba4\u5f00\u53d1\u3002\u4f5c\u4e3a\u4e00\u79cd\u65e0\u7c7b\u578b\u8bed\u8a00\uff0c\u5b83\u7684\u5b57\u7b26\u7c7b\u578b\u4ec5\u7528\u4e8e\u5b58\u653e\u5b57\u7b26\uff0c\u800c\u4e0d\u4f5c\u6570\u5b66\u8fd0\u7b97\u4e4b\u7528\u3002\u56e0\u6b64\uff0c\u5e76\u4e0d\u9700\u8981\u7279\u522b\u533a\u5206\u7b26\u53f7\u6027\u3002\u6240\u4ee5\u5728 C \u8bed\u8a00\u4e2d\uff0c\u4f5c\u8005\u4e5f\u6ca1\u6709\u4e3a\u5b57\u7b26\u7c7b\u578b\u89c4\u5b9a\u9ed8\u8ba4\u7684\u7b26\u53f7\u6027\u3002</p> <p>\u53e6\u5916\uff0c\u6709\u5173\u5b57\u7b26\u7c7b\u578b\u7684\u53e6\u4e00\u4e2a\u91cd\u8981\u7279\u5f81\u662f\uff0cC \u8bed\u8a00\u4fdd\u8bc1 char \u7c7b\u578b\u53ea\u5360\u7528\u4e00\u4e2a\u5b57\u8282\u5927\u5c0f\uff0c\u56e0\u6b64\u5728\u4f7f\u7528 <code>sizeof</code> \u8fd0\u7b97\u7b26\u8ba1\u7b97\u8be5\u7c7b\u578b\u5927\u5c0f\u65f6\uff0c\u5c06\u6c38\u8fdc\u5f97\u5230\u7ed3\u679c 1\u3002\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u8ba1\u7b97\u673a\u4f53\u7cfb\u90fd\u4f7f\u7528 8 \u4f4d\u7684\u5b57\u8282\u5927\u5c0f\u3002\u5bf9\u4e8e\u67d0\u4e9b\u8f83\u4e3a\u53e4\u8001\u7684\u8ba1\u7b97\u673a\u4f53\u7cfb\uff0c\u4e00\u4e2a\u5b57\u8282\u53ef\u80fd\u5bf9\u5e94\u5927\u4e8e\u6216\u5c0f\u4e8e 8 \u4f4d\u3002\u5bf9\u4e8e\u67d0\u4e9b\u7279\u6b8a\u7684\u4e1a\u52a1\u9700\u6c42\u548c\u529f\u80fd\u573a\u666f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u6807\u51c6\u5e93\u4e2d\u5b9a\u4e49\u7684\u5e38\u91cf CHAR_BIT \uff0c\u6765\u68c0\u67e5\u5f53\u524d\u4f53\u7cfb\u4e0b\u4e00\u4e2a\u5b57\u7b26\u7c7b\u578b\u6240\u5360\u7528\u7684\u4f4d\u6570\uff0c\u8be5\u5e38\u91cf\u7684\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#include &lt;limits.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  printf(\"char type has %lu byte.\\n\", sizeof(char));  // ...1.\n  printf(\"char type has %d bits.\", CHAR_BIT);  // ...8.\n}\n</code></pre> <p>\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u81ea C89 \u4ee5\u6765\u7684\u6807\u51c6\u4e2d\u89c4\u5b9a\uff0cCHAR_BIT \u7684\u503c\u4e0d\u80fd\u5c0f\u4e8e 8\uff0c\u56e0\u6b64\u5bf9\u4e8e\u5355\u4e2a\u5b57\u8282\u6570\u5c0f\u4e8e 8 \u4f4d\u7684\u4f53\u7cfb\u67b6\u6784\uff0c\u8be5\u5e38\u91cf\u5e76\u4e0d\u80fd\u53cd\u6620\u771f\u5b9e\u60c5\u51b5\u3002</p> <p>\u6700\u540e\u4ecb\u7ecd\u4e00\u4e2a\u7f16\u7801\u65b9\u9762\u7684\u7279\u6027\u3002C \u8bed\u8a00\u4e2d\u7684 char \u5b57\u7b26\u7c7b\u578b\u53d8\u91cf\u5728\u6309\u7167\u5b57\u7b26\u7c7b\u578b\u6253\u5370\u65f6\uff08\u6bd4\u5982\u4f7f\u7528 <code>printf</code> \u51fd\u6570\uff0c\u914d\u5408 \u201c%c\u201d \u5360\u4f4d\u7b26\uff09\uff0c\u4f1a\u4f7f\u7528 ASCII \u7f16\u7801\u6765\u5bf9\u6570\u5b57\u503c\u8fdb\u884c\u5b57\u7b26\u6620\u5c04\u3002\u8fd9\u610f\u5473\u7740\uff0c\u4e00\u4e2a\u5b58\u50a8\u6709\u6574\u6570 65 \u7684\u5b57\u7b26\u7c7b\u578b\u53d8\u91cf\uff0c\u5728\u5c06\u5176\u6253\u5370\u8f93\u51fa\u65f6\uff0c\u4f1a\u5728\u547d\u4ee4\u884c\u4e2d\u76f4\u63a5\u5f97\u5230\u5b57\u7b26 \u201cA\u201d\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u9700\u8981\u786e\u4fdd\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u7684\u7f16\u7801\u8bbe\u7f6e\u4e3a UTF-8\uff0c\u4ee5\u4e0e ASCII \u7f16\u7801\u76f8\u517c\u5bb9\u3002</p> <p>\u9664\u4e86 char \u7c7b\u578b\u4ee5\u5916\uff0cC \u8bed\u8a00\u8fd8\u5728 C90 \u548c C11 \u6807\u51c6\u4e2d\u65b0\u589e\u4e86\u53ef\u7528\u4e8e\u5bbd\u5b57\u7b26\u7684\u7c7b\u578b\uff0c\u8bf8\u5982 <code>wchar_t\u3001char16_t\u3001char32_t</code> \u7b49\u3002\u5176\u4e2d\uff0c<code>wchar_t</code> \u7c7b\u578b\u7684\u5927\u5c0f\u7531\u5177\u4f53\u7684\u7f16\u8bd1\u5668\u5b9e\u73b0\u51b3\u5b9a\u3002\u800c char16_t \u548c char32_t \u7c7b\u578b\uff0c\u5176\u503c\u5219\u56fa\u5b9a\u5360\u7528\u5bf9\u5e94\u7684 16 \u548c 32 \u4f4d\u3002</p> </li> <li> <p>\u5b57\u7b26\u4e32</p> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e24\u79cd\u65b9\u5f0f\u6765\u5b9a\u4e49\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u4e00\u79cd\u662f\u6307\u9488\u5f62\u5f0f\uff0c\u53e6\u4e00\u79cd\u662f\u6570\u7ec4\u5f62\u5f0f\u3002\u5f53\u7136\uff0c\u8fd9\u91cc\u793a\u4f8b\u4ee3\u7801\u4e2d\u6211\u4eec\u5b9a\u4e49\u7684\u662f\u53ea\u8bfb\u5b57\u7b26\u4e32\uff1a</p> <pre><code>// read-only string.\nconst char strA[] = \"Hello, geek!\";  \nconst char* strB = \"Hello\" \", geek!\";\n</code></pre> <p>\u5176\u4e2d\uff0c\u7531\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u90e8\u5206\u4e00\u822c\u79f0\u4e3a\u201c\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u201d\u3002C \u6807\u51c6\u4e2d\u89c4\u5b9a\uff0c\u8fde\u7eed\u51fa\u73b0\u7684\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u4e4b\u95f4\u5982\u679c\u4ec5\u7531\u7a7a\u683c\u5206\u9694\uff0c\u5219\u4f1a\u5c06\u5b83\u4eec\u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53\u3002\u6240\u4ee5 <code>strA</code> \u4e0e <code>strB</code> \u8fd9\u4e24\u4e2a\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002</p> <p>\u672c\u8d28\u4e0a\uff0c\u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u5c55\u793a\u51fa\u4e86\u5b57\u7b26\u4e32\u5728 C \u8bed\u8a00\u4e2d\u7684\u5177\u4f53\u8868\u73b0\u5f62\u5f0f\uff0c\u5373\u201c\u5e26\u6709\u7ec8\u6b62\u7b26\u7684\u5b57\u7b26\u6570\u7ec4\u201d\u3002</p> <p>\u5173\u4e8e\u4e0a\u8ff0\u5b57\u7b26\u4e32\u5728\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u8fd9\u5f20\u56fe\u6765\u76f4\u89c2\u5730\u7406\u89e3\u4e00\u4e0b\u3002\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0c\u5b57\u7b26\u4e32\u6570\u636e\u88ab\u5b58\u653e\u5728\u8fde\u7eed\u7684\u5185\u5b58\u6bb5\u4e0a\uff0c\u4e14\u6bcf\u4e2a\u5b57\u7b26\u4e32\u6570\u636e\u7684\u6700\u540e\u90fd\u4ee5\u7a7a\u5b57\u7b26\uff08\\0\uff09\u4f5c\u4e3a\u8868\u793a\u7ed3\u675f\u7684\u7ec8\u6b62\u7b26\u3002\u6240\u4ee5\u6211\u4eec\u8bf4\uff0c\u5b57\u7b26\u4e32\u5e76\u4e0d\u662f\u5355\u7eaf\u7684\u5b57\u7b26\u6570\u7ec4\uff0c\u800c\u662f\u5e26\u6709\u9690\u5f0f\uff08\u5b9a\u4e49\u65f6\u4f1a\u88ab\u81ea\u52a8\u52a0\u4e0a\uff09\u7ec8\u6b62\u7b26\u7684\u5b57\u7b26\u6570\u7ec4\u3002</p> <p></p> <p>\u867d\u7136\u901a\u8fc7\u4e0a\u9762\u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u53ef\u4ee5\u5b9a\u4e49\u5b57\u7b26\u4e32\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u4e0d\u540c\u7684\u5b9a\u4e49\u65b9\u5f0f\u5728\u4e0d\u540c\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bf9\u7a0b\u5e8f\u8fd0\u884c\u4ea7\u751f\u4e0d\u540c\u7684\u5f71\u54cd\u3002\u8fd9\u91cc\u4f60\u53ef\u4ee5\u5148\u601d\u8003\u4e0b\uff1a\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5b83\u5728\u8fd0\u884c\u65f6\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u5417\uff1f\u5982\u679c\u6709\uff0c\u90a3\u5e94\u8be5\u600e\u6837\u6539\u6b63\uff1f</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main (void) {   \n  /* get the first token */\n  const char* token = strtok(\"Hello, geek!\", \"geek\");\n  printf(\"%s\", token);\n  return 0;\n}\n</code></pre> <p>\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u8fd0\u884c\u53ef\u80fd\u4f1a\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u6bd4\u5982\u5728 Linux \u4e0a\uff0c\u4f60\u53ef\u80fd\u4f1a\u5f97\u5230\u540d\u4e3a \u201cSegmentation fault\u201d \u7684\u7cfb\u7edf\u9519\u8bef\u3002\u5982\u679c\u8fdb\u4e00\u6b65\u7528 LLDB \u8fdb\u884c\u8c03\u8bd5\uff0c\u4f60\u4f1a\u53d1\u73b0\u9519\u8bef\u539f\u56e0\u662f\uff1a\u201csignal SIGSEGV: address access protected\u201d\uff0c\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f\u8bbf\u95ee\u4e86\u53d7\u4fdd\u62a4\u7684\u5730\u5740\u3002\u90a3\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u8d77\u770b\u770b\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\u3002</p> <p>\u6211\u4eec\u5728\u4e4b\u524d\u7684\u5185\u5bb9\u4e2d\u66fe\u63d0\u5230\u8fc7\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u4e00\u822c\u4f1a\u88ab\u5b58\u653e\u5728\u8fdb\u7a0b VAS \u7684 <code>.rodata Section\uff08\u4e0b\u6587\u7b80\u79f0 .rodata\uff09</code>\u4e2d\uff0c\u4f4d\u4e8e\u6b64\u5904\u7684\u6570\u636e\u4e00\u822c\u53ef\u4ee5\u5728\u7a0b\u5e8f\u4e2d\u88ab\u591a\u6b21\u5f15\u7528\u3002</p> <p>\u800c\u5f53\u6570\u636e\u9700\u8981\u88ab\u4fee\u6539\uff0c\u6216\u4ee5\u8f83\u77ed\u751f\u547d\u5468\u671f\u7684\u5f62\u5f0f\uff08\u5982\u5c40\u90e8\u53d8\u91cf\uff09\u5b58\u5728\u65f6\uff0c\u5176\u5f15\u7528\u7684\u76f8\u5173\u6570\u636e\u53ef\u80fd\u9700\u8981\u4ece <code>.rodata</code> \u4e2d\u88ab\u590d\u5236\u5230\u5176\u4ed6\u4f4d\u7f6e\u3002\u800c\u4e0a\u8ff0\u8fd9\u4e24\u79cd\u5b57\u7b26\u4e32\u5b9a\u4e49\u65b9\u5f0f\u4fbf\u5bf9\u5e94\u4e8e\u8fd9\u4e24\u79cd\u60c5\u51b5\u3002</p> <p>\u4ee5\u672c\u5c0f\u8282\u5f00\u5934\u7684\u4ee3\u7801\u4e3a\u4f8b\uff0c</p> <ul> <li> <p>\u4f7f\u7528\u6307\u9488\u5f62\u5f0f\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32 <code>strB</code> \uff0c\u5b9e\u9645\u4e0a\u76f4\u63a5\u5f15\u7528\u4e86 <code>.rodata</code> \u4e2d\u8be5\u5b57\u7b26\u4e32\u7684\u6240\u5728\u4f4d\u7f6e\uff0c\u5373\u5b57\u7b26\u6307\u9488 <code>strB</code> \u7684\u503c\u4e3a\u8be5\u4f4d\u7f6e\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\u3002</p> </li> <li> <p>\u4f7f\u7528\u6570\u7ec4\u5f62\u5f0f\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32 <code>strA</code> \uff0c\u5219\u662f\u5c06\u8be5\u5b57\u7b26\u4e32\u7684\u6570\u636e\u4ece <code>.rodata</code> \u4e2d\u590d\u5236\u5230\u4e86\u5176\u4ed6\u5730\u65b9\uff0c<code>strA</code> \u7684\u503c\u4e3a\u590d\u5236\u540e\u8be5\u5b57\u7b26\u4e32\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684\u6240\u5728\u5730\u5740\u3002</p> </li> <li> <p>\u9a8c\u8bc1\uff1a</p> <p><pre><code>// string.c\n#include &lt;stdio.h&gt;\nint main(void) {\n  const char strA[] = \"Hello, geek!\";\n  const char* strB = \"Hello, geek!\";\n  printf(\"%p\\n%p\", strA, strB);  \n  /**\n    Output:\n    0x7ffee84d3d0b\n    0x4006c8\n  */\n}\n</code></pre> <pre><code>    \u67e5\u770b\u5f53\u524d\u8fdb\u7a0b\u7684 VAS \u5206\u5e03\u60c5\u51b5\uff1a\n    pgrep string | xargs -I {} cat /proc/{}/maps\n</code></pre></p> <pre><code>\u6253\u5370\u51fa\u5f53\u524d\u7a0b\u5e8f .rodata \u7684\u76f8\u5173\u60c5\u51b5\uff1a\nobjdump -s string | grep .rodata -A 10\n</code></pre> </li> </ul> <p>\u603b\u7ed3\u4e00\u4e0b\u3002\u4f7f\u7528\u6570\u7ec4\u548c\u6307\u9488\u5f62\u5f0f\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\uff0c\u5176\u5e95\u5c42\u7684\u6570\u636e\u5f15\u7528\u65b9\u5f0f\u4f1a\u6709\u6240\u533a\u522b\u3002</p> <ol> <li>\u5176\u4e2d\u6570\u7ec4\u65b9\u5f0f\u4f1a\u5c06\u5b57\u7b26\u4e32\u6570\u636e\u4ece <code>.rodata</code> \u4e2d\u62f7\u8d1d\u5230\u5176\u4ed6\u4f4d\u7f6e\uff08\u6bd4\u5982\u6808\u5185\u5b58\uff09\uff0c\u56e0\u6b64\u4fee\u6539\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u6539\u53d8\u5b58\u5728\u4e8e\u539f\u59cb <code>.rodata</code> \u4e2d\u7684\u526f\u672c\u3002</li> <li>\u800c\u4f7f\u7528\u5e38\u91cf\u6307\u9488\u5f62\u5f0f\u5b9a\u4e49\u7684\u6570\u7ec4\uff0c\u8be5\u6307\u9488\u4f1a\u76f4\u63a5\u5f15\u7528\u4f4d\u4e8e <code>.rodata</code> \u4e2d\u7684\u5b57\u7b26\u4e32\u6570\u636e\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u4e00\u4e2a\u95ee\u9898\u662f\uff1a\u5f53\u4f7f\u7528\u975e const \u6307\u9488\u5f15\u7528\u5b57\u7b26\u4e32\u65f6\uff0c\u901a\u8fc7\u8be5\u6307\u9488\u4fee\u6539\u5b57\u7b26\u4e32\u7684\u503c\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u4f7f\u7528\u6307\u9488\u5f62\u5f0f\u5f15\u7528\u76f8\u540c\u5b57\u7b26\u4e32\u7684\u4ee3\u7801\u4f4d\u7f6e\u4e0a\u7684\u5b9e\u9645\u5b57\u7b26\u4e32\u503c\u3002\u5f53\u7136\u5728 C \u6807\u51c6\u4e2d\uff0c\u8fd9\u79cd\u4fee\u6539\u65b9\u5f0f\u672c\u8eab\u662f\u4e00\u79cd\u672a\u5b9a\u4e49\u884c\u4e3a\uff0c\u5176\u4ea7\u751f\u7684\u5177\u4f53\u5f71\u54cd\u5c06\u7531\u7f16\u8bd1\u5668\u548c\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u3002\u4f46\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u8be5\u884c\u4e3a\u90fd\u4f1a\u4ea7\u751f\u8bf8\u5982 \u201cSegmentation fault\u201d \u4ee5\u53ca \u201cBus error\u201d \u4e4b\u7c7b\u7684\u7cfb\u7edf\u9519\u8bef\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#c","title":"C \u6807\u51c6\u5e93\u4e2d\u7684\u5b57\u7b26\u3001\u5b57\u7b26\u4e32\u5904\u7406","text":"<ul> <li> <p>\u7edf\u8ba1\u5b57\u7b26\u4e32\u957f\u5ea6</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  const char str[10] = \"Hi\";\n  printf(\"%zu\\n\", strlen(str));  // 2.\n}\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u6807\u51c6\u5e93\u63d0\u4f9b\u7684 <code>strlen</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4e0d\u4f1a\u8ba1\u5165\u5b57\u7b26\u4e32\u4e2d\u591a\u4f59\u7684\u7ec8\u6b62\u7b26\u3002</p> </li> <li> <p>\u62fc\u63a5\u5b57\u7b26\u4e32</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#define STRLEN 14\nint main(void) {\n  char strA[STRLEN] = \"Hello,\";\n  char strB[] = \" world!\";\n  strncat(strA, strB, STRLEN - strlen(strA) - 1);\n  printf(\"%s\\n\", strA); \n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9009\u62e9\u4f7f\u7528 <code>strncat</code> \u51fd\u6570\u6765\u8fdb\u884c\u5b57\u7b26\u4e32\u62fc\u63a5\u3002\u8be5\u51fd\u6570\u76f8\u8f83\u4e8e <code>strcat</code> \u51fd\u6570\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u63a7\u5236\u88ab\u62fc\u63a5\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u4ee5\u9632\u88ab\u62fc\u63a5\u5b57\u7b26\u4e32\u8fc7\u957f\u5bfc\u81f4\u7684\u62fc\u63a5\u5b57\u7b26\u4e32\u6570\u7ec4\u6ea2\u51fa\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u5728\u8ba1\u7b97 <code>strncat</code> \u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u88ab\u62fc\u63a5\u5b57\u7b26\u4e32\u957f\u5ea6\u8fd9\u4e2a\u53c2\u6570\u65f6\uff0c\u9700\u8981\u4e3a\u5b57\u7b26\u4e32\u6700\u540e\u7684\u7ec8\u6b62\u7b26\u9884\u7559\u51fa 1 \u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\u3002</p> </li> <li> <p>\u62f7\u8d1d\u5b57\u7b26\u4e32</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  char strA[] = \"aaaaaa\";\n  char strB[] = \"bbbbbbb\";\n  printf(\"%s\\n\", strncpy(strA, strB, strlen(strA)));  // \"bbbbbb\".\n}\n</code></pre> <p>\u62f7\u8d1d\u5b57\u7b26\u4e32\u51fd\u6570 <code>strncpy</code> \u7684\u7528\u6cd5\u4e0e <code>strncat</code> \u57fa\u672c\u76f8\u540c\uff0c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u5176\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u6765\u51b3\u5b9a\u5c06\u591a\u5c11\u5b57\u7b26\u62f7\u8d1d\u5230\u76ee\u7684\u5b57\u7b26\u4e32\u7684\u6570\u7ec4\u4e2d\u3002</p> <p>\u95ee\u9898\uff1a\u5982\u679c\u628a strncpy \u51fd\u6570\u4e2d\u7b2c\u4e09\u4e2a\u53c2\u6570\u4f7f\u7528\u7684 strlen \u51fd\u6570\u66f4\u6362\u6210 sizeof\uff0c\u90a3\u4e48\u7a0b\u5e8f\u8fd0\u884c\u4f1a\u5f97\u5230\u4ec0\u4e48\u7ed3\u679c\uff1f\u4e3a\u4ec0\u4e48\uff1f</p> </li> <li> <p>\u683c\u5f0f\u5316\u5b57\u7b26\u4e32</p> <pre><code>#include &lt;stdio.h&gt;\n#define LEN 128\nint main(void) {\n  char dest[LEN];\n  const char strA[] = \"Hello, \";\n  sprintf(dest, \"%sworld!\", strA);\n  printf(\"%s\\n\", dest);\n}\n</code></pre> <p>\u51fd\u6570 <code>sprintf</code> \u53ef\u7528\u4e8e\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u5176\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u5f62\u5f0f\u4e0e <code>printf</code> \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e00\u81f4\uff0c\u53ea\u662f\u540e\u8005\u4f1a\u5c06\u5185\u5bb9\u8f93\u51fa\u5230\u547d\u4ee4\u884c\u4e2d\uff0c\u800c <code>sprintf</code> \u4f1a\u5c06\u683c\u5f0f\u5316\u540e\u7684\u5b57\u7b26\u4e32\u4fdd\u5b58\u5230\u901a\u8fc7\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\u7684\u6570\u7ec4\u4e2d\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#c_1","title":"C \u6807\u51c6\u5e93\u4e2d\u7684\u6570\u5b66\u8fd0\u7b97","text":"<p>\u4e0a\u9762\u6211\u4ecb\u7ecd\u4e86 C \u6807\u51c6\u5e93\u4e2d\u4e0e\u5b57\u7b26\u548c\u5b57\u7b26\u4e32\u5904\u7406\u76f8\u5173\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u9664\u6b64\u4e4b\u5916\uff0cC \u6807\u51c6\u5e93\u4e2d\u8fd8\u63d0\u4f9b\u4e86\u4e0e\u6570\u5b66\u8fd0\u7b97\u6709\u5173\u7684\u5de5\u5177\u51fd\u6570\uff0c\u57fa\u672c\u4e0a\u4f60\u90fd\u53ef\u4ee5\u901a\u8fc7\u5f15\u5165 <code>math.h \u548c stdlib.h</code> \u8fd9\u4e24\u4e2a\u5934\u6587\u4ef6\u6765\u4f7f\u7528\u3002\u6ce8\u610f\uff1a\u5728\u7f16\u8bd1\u65f6\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u4e3a\u94fe\u63a5\u5668\u6307\u5b9a \u201c<code>-lm</code>\u201d \u53c2\u6570\u4ee5\u94fe\u63a5\u6240\u9700\u7684\u6570\u5b66\u5e93\u3002</p> <p>\u5982\uff1a\u7edd\u5bf9\u503c\uff1a</p> <pre><code>#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  long double num = -10.1;\n  printf(\"%.1Lf\\n\", fabsl(num));\n}\n</code></pre> <p>\u4e3a\u4e86\u51cf\u5c11\u7f16\u7801\u7684\u5de5\u4f5c\u91cf\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u5bf9\u5e94\u7684\u6cdb\u578b\u7248\u672c\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570\u6765\u624b\u52a8\u9009\u62e9\u5408\u9002\u7684\u7248\u672c\uff08\u6bd4\u5982\u8fd9\u91cc\u7684 <code>fabsl</code> \u51fd\u6570\uff0c\u5b83\u7684\u540e\u7f00 \u201cl\u201d \u8868\u793a \u201clong\u201d\uff09\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u6240\u6709\u6d6e\u70b9\u7c7b\u578b\u7684\u6570\u5b57\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u540d\u4e3a fabs \u7684\u5b8f\u51fd\u6570\u3002\u8be5\u5b8f\u5728\u5c55\u5f00\u65f6\uff0c\u4f1a\u81ea\u52a8\u4e3a\u4f60\u5339\u914d\u5bf9\u5e94\u7684\u7c7b\u578b\u7cbe\u786e\u7248\u672c\u3002\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e9b\u6cdb\u578b\u5b8f\uff0c\u6211\u4eec\u9700\u8981\u5c06\u539f\u6765\u7684\u5934\u6587\u4ef6 <code>math.h</code> \u66ff\u6362\u4e3a <code>tgmath.h</code>\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>#include &lt;tgmath.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  long double num = -10.1;\n  printf(\"%.1Lf\\n\", fabs(num));\n}\n</code></pre> <p>\u6cdb\u578b\u5b8f\u662f\u4ec0\u4e48\uff1f</p> <p>\u6cdb\u578b\u5b8f\u662f\u4e00\u79cd\u5728C\u8bed\u8a00\u4e2d\u4f7f\u7528\u7684\u5b8f\uff0c\u53ef\u4ee5\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u5408\u9002\u7684\u5b9e\u73b0\u3002</p> <ul> <li> <p>\u5177\u4f53\u5b9e\u73b0</p> <p>\u5173\u4e8e\u8fd9\u4e9b\u6807\u51c6\u5e93\u51fd\u6570\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5982\u679c\u6211\u4eec\u8fdb\u4e00\u6b65\u6765\u770b\uff0c\u4f1a\u53d1\u73b0\u5e76\u975e\u6240\u6709\u51fd\u6570\u90fd\u662f\u6309\u7167\u76f8\u5e94\u7684\u6570\u5b66\u7b97\u6cd5\u6765\u5b9e\u73b0\u8ba1\u7b97\u8fc7\u7a0b\u7684\u3002\u8fd9\u91cc\u7528\u4e00\u4e2a\u5e38\u89c1\u7684\u6570\u5b66\u8fd0\u7b97\u201c\u6c42\u5e73\u65b9\u6839\u201d\u4e3e\u4f8b\u5b50\uff1a</p> <p>\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u725b\u987f\u8fed\u4ee3\u6cd5\uff0c\u4ee5\u8f6f\u4ef6\u7b97\u6cd5\u7684\u5f62\u5f0f\u8ba1\u7b97\u4e00\u4e2a\u6570\u7684\u5e73\u65b9\u6839\u503c\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u5f53\u6211\u4eec\u4ee5 <code>musl</code> \u8fd9\u4e2a C \u6807\u51c6\u5e93\u4e3a\u4f8b\uff0c\u8fdb\u4e00\u6b65\u67e5\u770b\u5176\u67d0\u7248\u672c\u7684\u5b9e\u73b0\u65f6\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u5728 i386 \u67b6\u6784\u4e0b\u76f4\u63a5\u4f7f\u7528\u4e86 FPU\uff08\u6d6e\u70b9\u8fd0\u7b97\u5355\u5143\uff09\u63d0\u4f9b\u7684\u673a\u5668\u6307\u4ee4 <code>fsqrt</code> \u6765\u8ba1\u7b97\u5e73\u65b9\u6839\u7684\u503c\uff0c\u800c\u5e76\u6ca1\u6709\u4f7f\u7528\u8f6f\u4ef6\u7b97\u6cd5\u3002\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff0c\u8fd9\u53ef\u4ee5\u6781\u5927\u63d0\u5347\u8ba1\u7b97\u6027\u80fd\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u6700\u5927\u7a0b\u5ea6\u5730\u5229\u7528\u786c\u4ef6\u5e26\u6765\u7684\u8ba1\u7b97\u6027\u80fd\u4f18\u52bf\uff0c\u5728\u51c6\u5907\u81ea\u884c\u7f16\u5199\u76f8\u5e94\u7b97\u6cd5\u65f6\uff0c\u53ef\u4ee5\u5148\u770b\u770b\u80fd\u5426\u76f4\u63a5\u5229\u7528\u6807\u51c6\u5e93\u63d0\u4f9b\u7684\u51fd\u6570\u6765\u5b8c\u6210\u4f60\u7684\u5de5\u4f5c\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_2","title":"\u81ea\u5df1\u603b\u7ed3","text":"<p>C\u8bed\u8a00\u4f5c\u4e3a\u4e00\u95e8\u4ece\u7f16\u8bd1\u5668\u5f00\u53d1\u8005\u7684\u89c6\u89d2\u88ab\u53d1\u660e\u7684\u8bed\u8a00\uff0c\u5b83\u7684\u5f88\u591a\u7279\u6027\u90fd\u662f\u548c\u786c\u4ef6\u5e73\u53f0\u3001\u4f53\u7cfb\u7ed3\u6784\u548c\u7f16\u8bd1\u5668\u76f8\u5173\u7684\uff0c\u6240\u4ee5\u5728\u8ba8\u8bba\u5404\u79cd\u7279\u6027\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u8981\u548c\u4e3b\u6d41\u7684\u7f16\u8bd1\u5668\u3001\u4f53\u7cfb\u7ed3\u6784\u8054\u7cfb\u8d77\u6765\u3002</p> <p>\u5173\u4e8e\u5b57\u7b26\u548c\u5b57\u7b26\u4e32\uff1a\u57fa\u672c\u4e0a\u73b0\u5728\u89c1\u5230\u7684\u6587\u672c\u90fd\u662f\u4e00\u4e2a\u4e2a\u5b57\u7b26\u62fc\u63a5\u8d77\u6765\u7684\uff0c\u53ea\u662f\u8d8a\u6765\u8d8a\u6f14\u8fdb\uff0c\u63d0\u9ad8\u6548\u7387\uff0c\u6709\u4e86\u5b57\u7b26\u4e32\u3002</p> <p>\u5173\u4e8e\u7f16\u8bd1\u5668\u5bf9 C \u7684\u5f71\u54cd\uff1a\u6bd4\u5982 <code>char</code> \u7684\u9ed8\u8ba4\u7b26\u53f7\u3001<code>char</code> \u5360\u591a\u5c11\u4e2a\u5b57\u8282\uff08C\u6807\u51c6\u56fa\u5b9a\u4e3a\u4e00\u4e2a\uff09\u7b49\u7b49\u3002</p> <p>\u8fd8\u6709\uff0cC\u8bed\u8a00\u4e2d\u662f\u6ca1\u6709\u5b57\u7b26\u4e32\u8fd9\u4e2a\u6982\u5ff5\uff0c\u672c\u8d28\u4e0a\u662f\u7531\u5f88\u591a\u4e2a\u5b57\u7b26\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u6700\u540e\u5728\u7ed3\u5c3e\u52a0\u4e00\u4e2a <code>\\0</code> \u7a7a\u5b57\u7b26\u7684\u5b57\u7b26\u6570\u7ec4\u6210\u7684\uff0c\u6240\u4ee5 C \u7684\u5b57\u7b26\u4e32\u4e00\u76f4\u90fd\u5f88\u6709\u95ee\u9898\uff0c\u5f00\u53d1\u4e2d\u5e94\u8be5\u81ea\u5df1\u5f00\u53d1\u4e00\u5957\u5b57\u7b26\u4e32\u6216\u8005\u4f7f\u7528\u5f00\u6e90\u7684\u826f\u597d\u7684 C \u5b57\u7b26\u4e32\u5e93\u3002</p> <p>C\u8bed\u8a00----\u8be6\u89e3\u5b57\u7b26\u4e32\u76f8\u5173\u7684\u5e93\u51fd\u6570\uff08\u5efa\u8bae\u6536\u85cf\uff09_c\u8bed\u8a00\u5b57\u7b26\u4e32\u5e93\u51fd\u6570-CSDN\u535a\u5ba2</p> <p>\u6bcf\u5929\u4e00\u70b9 C / \u4e00\u4e2a\u4f18\u96c5\u7684\u5b57\u7b26\u4e32\u51fd\u6570\u5e93(Simple Dynamic Strings) - \u77e5\u4e4e (zhihu.com)</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_3","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u8bf7\u4e86\u89e3\u4e00\u4e0b C \u6807\u51c6\u5e93\u4e2d <code>strtok</code> \u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u5e76\u601d\u8003\u662f\u54ea\u4e00\u6b65\u5f15\u8d77\u4e86\u6587\u4e2d\u5b9e\u4f8b\u7684 \u201cSegmentation fault\u201d \u9519\u8bef\u3002\u7136\u540e\uff0c\u5982\u679c\u65f6\u95f4\u5145\u8db3\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5df1\u7684\u7248\u672c\uff0c\u62e5\u6709\u4e0e <code>strtok</code> \u51fd\u6570\u4e00\u6837\u7684\u529f\u80fd\uff0c\u4f46\u662f\u4e0d\u4fee\u6539\u4f20\u5165\u7684\u6e90\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u95ee\u9898\u590d\u73b0</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main (void) {   \n/* get the first token */\nconst char* token = strtok(\"Hello, geek!\", \"geek\");\nprintf(\"%s\", token);\nreturn 0;\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4f1a\u62a5segmentation fault\uff1f\u8bbf\u95ee\u4e86\u5e38\u91cf\u533a\uff0c\u800c\u5e38\u91cf\u533a\u4e00\u822c\u662f\u4e0d\u80fd\u8bbf\u95ee\u7684\uff1f\u6539\u4e3a\u7528\u5b57\u7b26\u6570\u7ec4\u5b9a\u4e49\u5c31\u53ef\u4ee5\uff1f</p> <p>\u5728\u4f60\u7684<code>main</code>\u51fd\u6570\u4e2d\u8c03\u7528<code>my_strtok</code>\u51fd\u6570\u65f6\uff0c\u76f4\u63a5\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9<code>my_strtok</code>\u51fd\u6570\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\uff08segmentation fault\uff09\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u5b58\u50a8\u5728\u53ea\u8bfb\u6570\u636e\u6bb5\uff08<code>.rodata segment</code>\uff09\uff0c\u662f\u4e0d\u53ef\u4fee\u6539\u7684\u3002\u5f53\u4f60\u5c1d\u8bd5\u5728<code>my_strtok</code>\u51fd\u6570\u4e2d\u4fee\u6539\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</p> <p>\u6b63\u786e\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u5b57\u7b26\u6570\u7ec4\u6765\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a\u5b57\u7b26\u6570\u7ec4\u5b58\u50a8\u5728\u6808\u4e0a\uff0c\u53ef\u4ee5\u88ab\u4fee\u6539\u3002\u5f53\u4f60\u5c06\u5b57\u7b26\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9<code>my_strtok</code>\u51fd\u6570\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5c06\u5b57\u7b26\u6570\u7ec4\u7684\u5730\u5740\u4f20\u9012\u7ed9\u51fd\u6570\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f20\u9012\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u51fd\u6570\u5185\u90e8\u4fee\u6539\u5b57\u7b26\u4e32\u5185\u5bb9\u800c\u4e0d\u4f1a\u5bfc\u81f4\u6bb5\u9519\u8bef\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u6bb5\u9519\u8bef\uff0c\u5efa\u8bae\u5728\u8c03\u7528<code>my_strtok</code>\u51fd\u6570\u65f6\u4f7f\u7528\u5b57\u7b26\u6570\u7ec4\u6765\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f20\u9012\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</p> </li> <li> <p>\u5173\u4e8e <code>strtok</code> \u7684\u4ecb\u7ecd</p> <p><code>strtok</code>\u662fC\u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u5206\u5272\u6210\u4e00\u7cfb\u5217\u975e\u7a7a\u7684\u6807\u8bb0\uff08token\uff09\u3002</p> <p>\u53c2\u6570\uff1a</p> <ul> <li><code>str</code>\uff1a\u8981\u89e3\u6790\u7684\u5b57\u7b26\u4e32\uff0c\u5728\u7b2c\u4e00\u6b21\u8c03\u7528<code>strtok</code>\u65f6\u4f20\u5165\u3002</li> <li><code>delim</code>\uff1a\u7528\u6765\u6307\u5b9a\u5206\u9694\u6807\u8bb0\u7684\u5b57\u7b26\u96c6\u5408\u3002\u8fd9\u4e9b\u5b57\u7b26\u5c06\u88ab\u7528\u6765\u5206\u5272<code>str</code>\u4e2d\u7684\u6807\u8bb0\u3002</li> </ul> <p>\u8fd4\u56de\u503c\uff1a</p> <ul> <li>\u6bcf\u6b21\u8c03\u7528<code>strtok</code>\u51fd\u6570\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u4e0b\u4e00\u4e2a\u6807\u8bb0\u7684\u6307\u9488\uff0c\u8fd9\u4e2a\u6807\u8bb0\u662f\u4e00\u4e2a\u4ee5\u7a7a\u5b57\u7b26\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u66f4\u591a\u7684\u6807\u8bb0\uff0c<code>strtok</code>\u5c06\u8fd4\u56de<code>NULL</code>\u3002</li> </ul> <p>\u5de5\u4f5c\u539f\u7406\uff1a</p> <ol> <li>\u5728\u7b2c\u4e00\u6b21\u8c03\u7528<code>strtok</code>\u65f6\uff0c\u4f20\u5165\u8981\u89e3\u6790\u7684\u5b57\u7b26\u4e32<code>str</code>\u3002</li> <li>\u5728\u540e\u7eed\u7684\u8c03\u7528\u4e2d\uff0c<code>str</code>\u5fc5\u987b\u4f20\u5165<code>NULL</code>\uff0c\u4ee5\u4fbf\u7ee7\u7eed\u89e3\u6790\u76f8\u540c\u7684\u5b57\u7b26\u4e32\u3002</li> <li><code>delim</code>\u53c2\u6570\u6307\u5b9a\u7528\u6765\u5206\u5272\u6807\u8bb0\u7684\u5b57\u7b26\u96c6\u3002</li> <li>\u6bcf\u6b21\u8c03\u7528<code>strtok</code>\u4f1a\u8fd4\u56de\u4e0b\u4e00\u4e2a\u6807\u8bb0\uff0c\u5e76\u66f4\u65b0\u5185\u90e8\u6307\u9488\u4ee5\u6307\u5411\u4e0b\u4e00\u4e2a\u6807\u8bb0\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002</li> </ol> <p>\u6ce8\u610f\u4e8b\u9879\uff1a   - \u8fde\u7eed\u7684\u5206\u9694\u5b57\u7b26\u4f1a\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5206\u9694\u7b26\u3002   - \u5b57\u7b26\u4e32\u5f00\u5934\u6216\u7ed3\u5c3e\u7684\u5206\u9694\u7b26\u4f1a\u88ab\u5ffd\u7565\u3002   - \u8fd4\u56de\u7684\u6807\u8bb0\u662f\u975e\u7a7a\u5b57\u7b26\u4e32\u3002</p> <p>\u5728\u5b66\u4e60<code>strtok</code>\u51fd\u6570\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u6bcf\u6b21\u8c03\u7528<code>strtok</code>\u65f6\u4f20\u5165\u7684\u53c2\u6570\u4ee5\u53ca\u8fd4\u56de\u503c\u7684\u5904\u7406\u3002\u8fd9\u4e2a\u51fd\u6570\u5728\u5904\u7406\u5b57\u7b26\u4e32\u5206\u5272\u65f6\u975e\u5e38\u6709\u7528\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u6309\u7167\u6307\u5b9a\u7684\u5206\u9694\u7b26\u5206\u5272\u6210\u591a\u4e2a\u90e8\u5206\u3002</p> </li> <li> <p>\u5177\u4f53\u5b9e\u73b0</p> <pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"dbg.h\"\n\nstatic char *my_strtok1(char *str, const char *delim);\nstatic char *my_strtok2_0(char *str, const char *delim);\nstatic char *my_strtok2_1(char *str, const char *delim);\n\nint main (void)\n{\n   char ch[] = \"Hello, geek!\";\n\n   /* \u4e0d\u5bf9\u6e90\u5b57\u7b26\u4e32\u64cd\u4f5c  */\n   const char *token2_0 = my_strtok2_0(ch, \",\");\n   printf(\"%s\\n\", token2_0);\n   printf(\"%s\\n\", ch);\n\n   /* \u5bf9\u6e90\u5b57\u7b26\u4e32\u64cd\u4f5c */\n   /* get the first token */\n   const char* token1 = my_strtok1(ch, \",\");\n   printf(\"%s\\n\", token1);\n   printf(\"%s\\n\", ch);\n\n   free((char *)token1);\n\n   return 0;\n}\n\n/* Version 2.1 */\nstatic char *my_strtok2_1(char *str, const char *delim)\n{\n    static char *buffer = NULL;\n    static char *copy = NULL;\n\n    check(str != NULL, \"Please pass the nonempty str.\");\n    copy = strdup(str);  // \u590d\u5236\u539f\u59cb\u5b57\u7b26\u4e32\n    check_mem(copy);\n\n    buffer = copy;\n    check(buffer != NULL, \"Buffer is NULL.\");\n\n    char *token = buffer;\n    buffer = strpbrk(buffer, delim);\n\n    if(buffer != NULL)\n    {\n        *buffer = '\\0';\n        buffer++;  // \u6307\u5411\u4e0b\u4e00\u4e2a\u5b50\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\n    }\n\n    free(copy);  // \u91ca\u653e\u590d\u5236\u7684\u5b57\u7b26\u4e32\n    return token;\n\nerror:\n    if(copy) free(copy);\n    return NULL;\n}\n\n\n/* \n * Version 2.0 \n *\n * \u8fd9\u4e2a\u597d\u50cf\u5e94\u8be5\u6ca1\u6709\u95ee\u9898\uff1f\u4f46\u662f\u90a3\u4e2aresult\u53d8\u91cf\u5185\u5b58\u597d\u6ca1\u91ca\u653e\uff1f\n * \u8fd8\u6709\u70b9\u4e0d\u592a\u7406\u89e3\u6700\u540e\u90a3\u4e2aresult\u53d8\u91cf\u7684\u4f5c\u7528\uff1f\n *\n * \u61c2\u4e86\uff0c\u786e\u5b9e\u662f\u8fd9\u6837\u7684\uff1aresult\u53d8\u91cf\u5185\u5b58\u6ca1\u91ca\u653e\n * \u6240\u4ee5\u6ce8\u610f\uff1a\u5728main\u51fd\u6570\u8bb0\u5f97free\uff01\n *\n * */\n\nstatic char *my_strtok2_0(char *str, const char *delim)\n{\n    // \u9759\u6001\u53d8\u91cf\u7684\u521d\u59cb\u5316\u5fc5\u987b\u662f\u7f16\u8bd1\u65f6\u5e38\u91cf\u3002\n    static char *buffer = NULL;\n    static char *copy = NULL;\n\n    check(str != NULL, \"Please pass the nonempty str.\");\n    copy = strdup(str);  // \u590d\u5236\u539f\u59cb\u5b57\u7b26\u4e32\n    check_mem(copy);\n\n    buffer = copy;\n    check(buffer != NULL, \"Buffer is NULL.\");\n\n    char *token = buffer;\n    buffer = strpbrk(buffer, delim);\n\n    if(buffer != NULL)\n    {\n        *buffer = '\\0';\n        buffer++;  // \u6307\u5411\u4e0b\u4e00\u4e2a\u5b50\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\n    }\n\n    char *result = strdup(token);  // \u590d\u5236token\uff0c\u907f\u514d\u4fee\u6539\u539f\u59cb\u5b57\u7b26\u4e32\n    check_mem(result);\n\n    free(copy);  // \u91ca\u653e\u590d\u5236\u7684\u5b57\u7b26\u4e32\n    return result;\n\nerror:\n    if(copy) free(copy);\n    if(result) free(result);\n    return NULL;\n}\n\n/* Version 1 */\nstatic char *my_strtok1(char *str, const char *delim)\n{\n    static char *buffer = NULL;\n\n    check(str != NULL, \"Please pass the nonempty str.\");\n    buffer = str;\n    check(buffer != NULL, \"Buffer is NULL.\");\n\n    char *token = buffer;\n    // buffer = strchr(buffer, *delim);    // \u8fd4\u56dedelim\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u8d4b\u7ed9buffer\n    buffer = strpbrk(buffer, delim);    // \u8fd4\u56dedelim\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u8d4b\u7ed9buffer\n    // \u4e8c\u8005\u533a\u522b\uff1f\n\n    if(buffer != NULL)\n    {\n        *buffer = '\\0';\n        buffer++;       // \u6307\u5411\u4e0b\u4e00\u4e2a\u5b50\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\n    }\n\n    return token;       // \u8fd4\u56de\u5f53\u524d\u81ea\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\n\nerror:\n    return NULL;\n}\n\n\n/* test\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n    char str[] = \"aaa;;bbb,\";\n    char delim[] = \";,\";\n    char *token;\n\n    // \u7b2c\u4e00\u6b21\u8c03\u7528strtok\u65f6\u4f20\u5165\u8981\u89e3\u6790\u7684\u5b57\u7b26\u4e32\n    token = strtok(str, delim);\n\n    // \u5faa\u73af\u8c03\u7528strtok\u83b7\u53d6\u6bcf\u4e2a\u6807\u8bb0\n    while (token != NULL) {\n        printf(\"Token: %s\\n\", token);\n        token = strtok(NULL, delim); // \u540e\u7eed\u8c03\u7528\u4f20\u5165NULL\u4ee5\u7ee7\u7eed\u89e3\u6790\u76f8\u540c\u5b57\u7b26\u4e32\n    }\n\n    return 0;\n}\n*/\n\n/*\n * strchr \u7b80\u5355\u4f7f\u7528\n */\n// int main() {\n//     const char *str = \"Hello, world!\";\n//     char *ptr = strchr(str, 'o');       // \u8fd4\u56de\u6307\u5411o\u7684\u6307\u9488\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\n// \n//     if (ptr != NULL) {\n//         printf(\"Found 'o' at position: %ld\\n\", ptr - str);\n//         printf(\"%s\\n\", ptr);            // %s\u4eceo\u4e4b\u540e\u5f00\u59cb\u89e3\u5f15\u7528\u3002\n//     } else {\n//         printf(\"Character not found.\\n\");\n//     }\n// \n//     return 0;\n//  }\n</code></pre> <p><code>strchr</code> \u548c<code>strpbrk</code> \u51fd\u6570\uff1a</p> <p><code>strchr</code>\u548c<code>strpbrk</code>\u8fd9\u4e24\u4e2a\u51fd\u6570\u5728\u529f\u80fd\u4e0a\u6709\u4e00\u4e9b\u533a\u522b\uff0c\u867d\u7136\u5728\u6211\u7684\u4ee3\u7801\u4e2d\u5f97\u5230\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u7528\u9014\u7565\u6709\u4e0d\u540c\uff1a</p> <ol> <li><code>strchr</code>\u51fd\u6570\uff1a</li> <li><code>strchr</code>\u7528\u4e8e\u5728\u5b57\u7b26\u4e32\u4e2d\u67e5\u627e\u6307\u5b9a\u5b57\u7b26\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u627e\u5230\u5219\u8fd4\u56de\u8be5\u5b57\u7b26\u7684\u6307\u9488\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de<code>NULL</code>\u3002</li> <li> <p>\u9002\u7528\u4e8e\u67e5\u627e\u5355\u4e2a\u5b57\u7b26\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u4f4d\u7f6e\u3002</p> </li> <li> <p><code>strpbrk</code>\u51fd\u6570\uff1a(\u591a\u4e2a\u5b57\u7b26)</p> </li> <li><code>strpbrk</code>\u7528\u4e8e\u5728\u5b57\u7b26\u4e32\u4e2d\u67e5\u627e\u6307\u5b9a\u5b57\u7b26\u96c6\u4e2d\u4efb\u4e00\u5b57\u7b26\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u627e\u5230\u5219\u8fd4\u56de\u8be5\u5b57\u7b26\u7684\u6307\u9488\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de<code>NULL</code>\u3002</li> <li>\u9002\u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u96c6\u4e2d\u4efb\u4e00\u5b57\u7b26\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u67e5\u627e\u591a\u4e2a\u5b57\u7b26\u3002</li> </ol> <p>\u5728\u4f60\u7684\u4ee3\u7801\u4e2d\uff0c\u7531\u4e8e<code>delim</code>\u662f\u4e00\u4e2a\u5305\u542b\u591a\u4e2a\u5206\u9694\u7b26\u7684\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u4f7f\u7528<code>strpbrk</code>\u66f4\u9002\u5408\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u4e00\u6b21\u6027\u67e5\u627e\u591a\u4e2a\u5b57\u7b26\u3002\u800c\u5982\u679c<code>delim</code>\u53ea\u5305\u542b\u5355\u4e2a\u5b57\u7b26\uff0c\u4f7f\u7528<code>strchr</code>\u4e5f\u53ef\u4ee5\u8fbe\u5230\u76f8\u540c\u7684\u6548\u679c\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u9009\u62e9\u4f7f\u7528<code>strchr</code>\u8fd8\u662f<code>strpbrk</code>\u53d6\u51b3\u4e8e\u4f60\u8981\u67e5\u627e\u7684\u5b57\u7b26\u662f\u5355\u4e2a\u5b57\u7b26\u8fd8\u662f\u591a\u4e2a\u5b57\u7b26\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#2-io","title":"2\uff5c\u6807\u51c6\u5e93\uff1a\u6df1\u5165\u7406\u89e3\u6807\u51c6 IO","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#io","title":"I/O \u63a5\u53e3\u7684\u4e0d\u540c\u7ea7\u522b","text":"<ul> <li> <p>\u6807\u51c6 I/O \uff08\u9ad8\u7ea7 I/O\uff09</p> <pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n  printf(\"Enter some characters:\\n\");\n  FILE* fp = fopen(\"./temp.txt\", \"w+\");\n  if (fp) {\n    char ch;\n    while (scanf(\"%c\", &amp;ch)) {\n      if (ch == 'z') break;\n      putc(ch, fp);\n    }\n  } else {\n    perror(\"File open failed.\");\n  }\n  fclose(fp);\n  return 0;\n}\n</code></pre> </li> <li> <p>\u4f4e\u7ea7 I/O</p> <p>\u4f4e\u7ea7 IO \u4f1a\u4f7f\u7528\u4e0e\u5177\u4f53\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173\u7684\u4e00\u7cfb\u5217\u5e95\u5c42\u63a5\u53e3\u6765\u63d0\u4f9b\u76f8\u5e94\u7684 IO \u80fd\u529b\uff0c\u5982\u5e38\u7528\u4e8e Unix \u4e0e\u7c7b Unix \u4e0a\u7684 POSIX \u63a5\u53e3\u6807\u51c6\u3002</p> <pre><code>#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\nint main(void) {\n  const char str[] = \"Enter some characters:\\n\";\n  write(STDOUT_FILENO, str, sizeof(str));\n  const int fd = open(\"./temp.txt\", O_RDWR | O_CREAT);\n  if (fd &gt; 0) {\n    char ch;\n    while (read(STDIN_FILENO, &amp;ch, 1)) {\n      if (ch == 'z') break;\n      write(fd, &amp;ch, sizeof(ch));    \n    }\n  } else {\n    const char errMsg[] = \"File open failed.\";\n    write(STDERR_FILENO, errMsg, sizeof(errMsg));\n  }\n  close(fd);\n  return 0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u4f7f\u7528\u4f4e\u7ea7 IO \u63a5\u53e3\u8fdb\u884c\u7f16\u7a0b\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5904\u7406\u4e0e\u6240\u8fdb\u884c IO \u64cd\u4f5c\u6709\u5173\u7684\u66f4\u591a\u7ec6\u8282\u3002</p> <p>\u6bd4\u5982\uff0c\u5728\u8c03\u7528 write \u63a5\u53e3\u65f6\uff0c\u4f60\u5fc5\u987b\u8981\u6307\u5b9a\u4e0d\u540c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08File Descriptor\uff09\uff0c\u624d\u80fd\u591f\u533a\u5206\u6240\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u662f\u201c\u5411\u5c4f\u5e55\u4e0a\u8f93\u51fa\u5b57\u7b26\u201d\uff0c\u8fd8\u662f\u201c\u5411\u6587\u4ef6\u5185\u5199\u5165\u6570\u636e\u201d\u3002\uff08\u4e5f\u5c31\u662f\u63a7\u5236\u8f93\u51fa\u6d41\uff09</p> <p>\u76f8\u53cd\uff0c\u5728\u9ad8\u7ea7 IO \u7684\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5173\u6ce8\u8fd9\u4e9b\u7ec6\u8282\uff0c\u63a5\u53e3\u7684\u540d\u79f0\u53ef\u4ee5\u76f4\u63a5\u53cd\u6620\u5176\u5177\u4f53\u7528\u9014\u3002</p> <p>\u4e24\u8005\u4e4b\u6240\u4ee5\u4f1a\u5728\u63a5\u53e3\u4f7f\u7528\u7c92\u5ea6\u4e0a\u5b58\u5728\u5dee\u5f02\uff0c\u662f\u7531\u4e8e\u201c\u4f4e\u7ea7 IO \u4e0e\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7d27\u5bc6\u76f8\u5173\u201d\u3002</p> <p>\u5bf9\u4e8e POSIX \u6807\u51c6\u6765\u8bf4\uff0c\u5176\u6240\u5728\u7cfb\u7edf\u4f1a\u5c06\u7edd\u5927\u591a\u6570\u7684 IO \u76f8\u5173\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u6863\u3001\u76ee\u5f55\u3001\u952e\u76d8\u3001\u7f51\u7edc\u5957\u63a5\u5b57\uff0c\u4ee5\u53ca\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u7b49\uff0c\u4ee5\u201c\u6587\u4ef6\u201d\u7684\u5f62\u5f0f\u8fdb\u884c\u62bd\u8c61\uff0c\u5e76\u4f7f\u7528\u76f8\u5bf9\u7edf\u4e00\u7684\u6570\u636e\u7ed3\u6784\u6765\u8868\u793a\u3002</p> <p>\u800c\u5728\u5b9e\u9645\u7f16\u7801\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u53ef\u7528\u7684 IO \u8d44\u6e90\u90fd\u4f1a\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u552f\u4e00\u7684\u6574\u578b\u6587\u4ef6\u63cf\u8ff0\u7b26\u503c\u3002\u8be5\u503c\u5c06\u88ab\u4f5c\u4e3a\u201c\u5355\u4e00\u53ef\u4fe1\u6e90\uff08The Single Source of Truth\uff09\u201d\uff0c\u4f9b\u76f8\u5173\u63a5\u53e3\u4f7f\u7528\u3002</p> <ul> <li> <p>\u3010\u8865\u5145\u3011\uff1a\u5e26\u7f13\u51b2\u7684\u6807\u51c6 I/O</p> <p>\u4e0e\u4f4e\u7ea7 IO \u76f8\u6bd4\uff0c\u6807\u51c6 IO \u4f1a\u4e3a\u6211\u4eec\u63d0\u4f9b\u5e26\u7f13\u51b2\u7684\u8f93\u5165\u4e0e\u8f93\u51fa\u64cd\u4f5c\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u4f7f\u7528\u4f4e\u7ea7 IO \u63a5\u53e3\u5b9e\u73b0\u7684\u7a0b\u5e8f\uff0c\u4f1a\u5728\u7528\u6237\u6bcf\u6b21\u8f93\u5165\u65b0\u5185\u5bb9\u5230\u6807\u51c6\u8f93\u5165\u6d41\u4e2d\u65f6\uff0c\u540c\u65f6\u66f4\u65b0\u6587\u4ef6 \u201ctemp.txt\u201d \u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u4f7f\u7528\u6807\u51c6 IO \u63a5\u53e3\u5b9e\u73b0\u7684\u7a0b\u5e8f\uff0c\u4ec5\u4f1a\u5728\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\u8fbe\u5230\u4e00\u5b9a\u6570\u91cf\u6216\u7a0b\u5e8f\u9000\u51fa\u524d\uff0c\u518d\u66f4\u65b0\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u3002\u800c\u5728\u6b64\u4e4b\u524d\uff0c\u8fd9\u4e9b\u5185\u5bb9\u5c06\u4f1a\u88ab\u5b58\u653e\u5230\u7f13\u51b2\u533a\u4e2d\u3002</p> <pre><code>// ...\nchar buf[1024];\nsetvbuf(fp, buf, _IOFBF, 5);\n// ...\n</code></pre> </li> </ul> </li> <li> <p>\u7528\u4e8e\u4f4e\u7ea7 IO \u63a5\u53e3\u7684\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528</p> <p>\u5b9e\u9645\u4e0a\uff0c\u4f60\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u7cfb\u7edf\u8c03\u7528\u5f53\u4f5c\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u4e00\u7cfb\u5217\u51fd\u6570\u3002\u53ea\u662f\u76f8\u8f83\u4e8e\u7a0b\u5e8f\u5458\u5728 C \u6e90\u4ee3\u7801\u4e2d\u81ea\u5b9a\u4e49\u7684\u201c\u7528\u6237\u51fd\u6570\u201d\u6765\u8bf4\uff0c\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\u3002</p> <p>\u4e0e\u8c03\u7528\u7528\u6237\u51fd\u6570\u6240\u4f7f\u7528\u7684 call \u6307\u4ee4\u4e0d\u540c\uff0c\u5728 x86-64 \u5e73\u53f0\u4e0a\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u540d\u4e3a <code>syscall</code> \u7684\u6307\u4ee4\u6765\u6267\u884c\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u6574\u578b ID\uff0c\u8fd9\u4e2a ID \u5c06\u4f1a\u4f5c\u4e3a\u6807\u8bc6\u7b26\uff0c\u53c2\u4e0e\u5230\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u4e2d\u3002\u6bd4\u5982\u5728 x86-64 \u5e73\u53f0\u4e0a\u7684 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0copen \u7cfb\u7edf\u8c03\u7528\u5bf9\u5e94\u7684 ID \u503c\u4e3a 2\uff0c\u4f60\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u4f8b\u5b50\u4e2d\u770b\u5230\u5b83\u7684\u5b9e\u9645\u7528\u6cd5\u3002</p> <p>\u540c\u7528\u6237\u51fd\u6570\u7c7b\u4f3c\u7684\u662f\uff0c\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u5728\u88ab\u8c03\u7528\u65f6\uff0c\u4e5f\u9700\u8981\u901a\u8fc7\u76f8\u5e94\u7684\u5bc4\u5b58\u5668\u6765\u5b9e\u73b0\u53c2\u6570\u4f20\u9012\u7684\u8fc7\u7a0b\u3002\u800c\u6b63\u5982\u6211\u5728\u7b2c 05 \u8bb2 \u4e2d\u63d0\u5230\u7684\u90a3\u6837\uff0c<code>SysV</code> \u8c03\u7528\u7ea6\u5b9a\u4e2d\u89c4\u5b9a\uff0c\u7cfb\u7edf\u8c03\u7528\u5c06\u4f1a\u4f7f\u7528\u5bc4\u5b58\u5668 <code>rdi\u3001rsi\u3001rdx\u3001r10\u3001r8\u3001r9</code> \u6765\u8fdb\u884c\u5b9e\u53c2\u7684\u4f20\u9012\u3002\u5f53\u7136\uff0c\u9664\u6b64\u4e4b\u5916\uff0c<code>rax</code> \u5bc4\u5b58\u5668\u5c06\u4e13\u95e8\u7528\u4e8e\u5b58\u653e\u7cfb\u7edf\u8c03\u7528\u5bf9\u5e94\u7684 ID\uff0c\u5e76\u63a5\u6536\u7cfb\u7edf\u8c03\u7528\u5b8c\u6210\u540e\u7684\u8fd4\u56de\u503c\u3002</p> <pre><code>#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\nint main(void) {\n  const char str[] = \"Enter some characters:\\n\";\n  write(STDOUT_FILENO, str, sizeof(str));\n  const char* fileName = \"./temp.txt\";\n  // Call to `open` starts:\n  // const int fd = open(\"./temp.txt\", O_RDWR | O_CREAT);\n  volatile int fd;\n  asm(\"mov $2, %%rax\\n\\t\"\n      \"mov %0, %%rdi\\n\\t\"\n      \"mov $66, %%rsi\\n\\t\"  // 2 | 64 -&gt; 66;\n      \"syscall\\n\\t\"\n      \"mov %%rax, %1\\n\\t\"\n       : \"=m\" (fileName)\n       : \"m\" (fd));\n  // Call ended.\n  if (fd &gt; 0) {\n    char ch;\n    while (read(STDIN_FILENO, &amp;ch, 1)) {\n      if (ch == 'z') break;\n      write(fd, &amp;ch, sizeof(ch));\n    }\n  } else {\n    const char errMsg[] = \"File open failed.\";\n    write(STDERR_FILENO, errMsg, sizeof(errMsg));\n  }\n  close(fd);\n  return 0;\n}\n</code></pre> </li> </ul> <p></p> <p>\u6807\u51c6 IO \u63a5\u53e3\u5728\u5b9e\u73b0\u65f6\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528\u6240\u5728\u5e73\u53f0\u63d0\u4f9b\u7684\u4f4e\u7ea7 IO \u63a5\u53e3\u3002</p> <p>\u800c\u4f4e\u7ea7 IO \u63a5\u53e3\u5728\u6bcf\u6b21\u8c03\u7528\u65f6\uff0c\u90fd\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u5b8c\u6210\u76f8\u5e94\u7684 IO \u64cd\u4f5c\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u6d89\u53ca\u5230\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0e\u5185\u6838\u6a21\u5f0f\u4e4b\u95f4\u7684\u8f6c\u6362\uff0c\u5176\u6210\u672c\u8f83\u9ad8\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_4","title":"\u81ea\u5df1\u603b\u7ed3","text":"<p>\u6807\u51c6 I/O --&gt; \u4f4e\u7ea7 I/O --&gt; \u7cfb\u7edf\u8c03\u7528</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_5","title":"\u601d\u8003\u9898","text":"<ul> <li> <p><code>ungetc</code> \u51fd\u6570\u6709\u4ec0\u4e48\u4f5c\u7528\u5462\uff1f\u5bf9\u540c\u4e00\u4e2a\u6d41\uff0c\u5b83\u6700\u591a\u53ef\u4ee5\u88ab\u8fde\u7eed\u8c03\u7528\u591a\u5c11\u6b21\u5462\uff1f</p> <p><code>ungetc</code> \u51fd\u6570\u7528\u4e8e\u5c06\u4e00\u4e2a\u5b57\u7b26\u63a8\u56de\u5230\u6d41\u4e2d\uff0c\u4f7f\u5f97\u4e0b\u4e00\u6b21\u8bfb\u53d6\u5b57\u7b26\u65f6\u53ef\u4ee5\u8bfb\u53d6\u5230\u8be5\u5b57\u7b26\u3002\u5b83\u7684\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>int ungetc(int c, FILE *stream);\n</code></pre> <p>\u5176\u4e2d\uff0c<code>c</code> \u662f\u8981\u63a8\u56de\u7684\u5b57\u7b26\uff0c<code>stream</code> \u662f\u8981\u64cd\u4f5c\u7684\u6d41\u3002</p> <p><code>ungetc</code> \u51fd\u6570\u6700\u591a\u53ef\u4ee5\u88ab\u8fde\u7eed\u8c03\u7528 <code>1</code> \u6b21\uff0c\u5373\u53ea\u80fd\u5c06\u4e00\u4e2a\u5b57\u7b26\u63a8\u56de\u5230\u6d41\u4e2d\u3002\u5982\u679c\u5c1d\u8bd5\u591a\u6b21\u8c03\u7528 <code>ungetc</code> \u63a8\u56de\u591a\u4e2a\u5b57\u7b26\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#3","title":"3\uff5c\u6807\u51c6\u5e93\uff1a\u975e\u672c\u5730\u8df3\u8f6c\u4e0e\u53ef\u53d8\u53c2\u6570\u662f\u600e\u6837\u5b9e\u73b0\u7684\uff1f","text":"<p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u79cd\u4ee5\u51fd\u6570\u4e3a\u5355\u4f4d\u7684\u201c\u987a\u5e8f\u201d\u6267\u884c\u6d41\u5e76\u4e0d\u80fd\u5b8c\u5168\u6ee1\u8db3 C \u8bed\u8a00\u5728\u4f7f\u7528\u65f6\u7684\u6240\u6709\u5e94\u7528\u573a\u666f\u3002</p> <p>\u56e0\u6b64\uff0cC \u6807\u51c6\u4ece C90 \u5f00\u59cb\uff0c\u4fbf\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u540d\u4e3a \u201c<code>setjmp.h</code>\u201d \u7684\u6807\u51c6\u5e93\u5934\u6587\u4ef6\u3002\u901a\u8fc7\u4f7f\u7528\u8be5\u5934\u6587\u4ef6\u63d0\u4f9b\u7684\u4e24\u4e2a\u63a5\u53e3 <code>setjmp</code> \u4e0e <code>longjmp</code>\uff0c\u6211\u4eec\u80fd\u591f\u5728\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5b9e\u73b0\u5bf9\u6267\u884c\u6d41\u7684\u8de8\u51fd\u6570\u4f5c\u7528\u57df\u8f6c\u53d8\u3002</p> <p>\u800c\u5bf9\u4e8e\u4e0a\u8ff0\u8fd9\u79cd\u51fd\u6570\u6267\u884c\u6d41\u7a0b\u4e0a\u7684\u53d8\u5316\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u5b83\u4e3a\u201c\u975e\u672c\u5730\u8df3\u8f6c\uff08Non-local Jump\uff09\u201d\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_6","title":"\u975e\u672c\u5730\u8df3\u8f6c","text":"<p>\u5148\u4ecb\u7ecd\u4e00\u4e0b\u672c\u5730\u8df3\u8f6c\uff0c</p> <p></p> <p>\u6211\u4eec\u4e4b\u6240\u4ee5\u79f0\u8fd9\u79cd\u901a\u8fc7 <code>goto</code> \u8bed\u53e5\u5b9e\u73b0\u7684\u7a0b\u5e8f\u6267\u884c\u6d41\u53d8\u5316\u4e3a\u672c\u5730\u8df3\u8f6c\uff0c\u662f\u56e0\u4e3a\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e0b\u7684\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u4ec5\u80fd\u591f\u53d1\u751f\u5728\u5f53\u524d\u7a0b\u5e8f\u8fd0\u884c\u6240\u5728\u7684\u67d0\u4e2a\u5177\u4f53\u51fd\u6570\u4e2d\u3002</p> <p>\u76f8\u5bf9\u5730\uff0c\u7a0b\u5e8f\u65e0\u6cd5\u505a\u5230\u4ece\u67d0\u4e2a\u51fd\u6570\u4f53\u7684\u6267\u884c\u4e2d\u9014\uff0c\u76f4\u63a5\u5c06\u5176\u6267\u884c\u6d41\u8f6c\u79fb\u5230\u5176\u4ed6\u51fd\u6570\u7684\u5185\u90e8\u3002\u201c\u8de8\u51fd\u6570\u201d\u7684\u8c03\u7528\u4ec5\u80fd\u591f\u901a\u8fc7\u5e38\u89c4\u7684 call \u4e0e ret \u6307\u4ee4\u6765\u5b9e\u73b0\u3002\u4f46\u662f\uff0c\u975e\u672c\u5730\u8df3\u8f6c\u5374\u53ef\u4ee5\u6253\u7834\u8fd9\u4e2a\u9650\u5236\u3002\u4e5f\u5c31\u662f\u8de8\u51fd\u6570\u8df3\u8f6c\u3002</p> <ul> <li> <p><code>setjmp</code> \u4e0e <code>longjmp</code> \u51fd\u6570</p> <p></p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#4-c","title":"4\uff5c\u6807\u51c6\u5e93\uff1a\u4f60\u9700\u8981\u4e86\u89e3\u7684 C \u5e76\u53d1\u7f16\u7a0b\u57fa\u7840\u77e5\u8bc6\u6709\u54ea\u4e9b\uff1f","text":"<p>\u5728\u6784\u5efa\u9ad8\u6027\u80fd\u5e94\u7528\u65f6\uff0c\u5e76\u53d1\u7f16\u7a0b\u662f\u6211\u4eec\u7ecf\u5e38\u91c7\u7528\u7684\u4e00\u79cd\u6280\u5de7\u3002\u5b83\u901a\u8fc7\u5728\u7a0b\u5e8f\u7684\u8fd0\u884c\u8fdb\u7a0b\u5185\u63d0\u4f9b\u53ef\u63a7\u5236\u7c92\u5ea6\u66f4\u7ec6\u7684\u201c\u7ebf\u7a0b\u201d\uff0c\u4ece\u800c\u5c06\u7a0b\u5e8f\u7684\u6574\u4f53\u529f\u80fd\u62c6\u5206\u4e3a\u66f4\u5c0f\u7684\u72ec\u7acb\u4efb\u52a1\u5355\u5143\uff0c\u5e76\u4ee5\u6b64\u6765\u8fdb\u4e00\u6b65\u5229\u7528\u591a\u6838 CPU \u7684\u8fd0\u7b97\u8d44\u6e90\u3002</p> <p>\u5bf9\u4e8e C11 \u6807\u51c6\u4e4b\u524d\u7684 C \u8bed\u8a00\u6765\u8bf4\uff0c\u60f3\u8981\u6784\u5efa\u591a\u7ebf\u7a0b\u5e94\u7528\uff0c\u53ea\u80fd\u4f9d\u8d56\u4e8e\u6240\u5728\u5e73\u53f0\u4e0a\u7684\u4e13\u6709\u63a5\u53e3\uff0c\u6bd4\u5982 Unix \u4e0e\u7c7b Unix \u5e73\u53f0\u4e0a\u5e7f\u6cdb\u4f7f\u7528\u7684 POSIX \u6a21\u578b\uff0c\u4ee5\u53ca\u540e\u8d77\u4e4b\u79c0 OpenMP \u6a21\u578b\u7b49\u3002\u8fd9\u4e9b\u6a21\u578b\u63d0\u4f9b\u7684\u7f16\u7a0b\u63a5\u53e3\uff0c\u4ee5\u53ca\u6240\u652f\u6301\u5e73\u53f0\u90fd\u6709\u5f88\u5927\u7684\u4e0d\u540c\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u90a3\u65f6\u7684 C \u8bed\u8a00\u6765\u8bf4\uff0c\u60f3\u8981\u7f16\u5199\u9ad8\u53ef\u79fb\u690d\u6027\u7684\u591a\u7ebf\u7a0b\u5e94\u7528\uff0c\u4ecd\u9700\u8981\u82b1\u8d39\u5f88\u5927\u529f\u592b\u3002</p> <p>\u800c\u81ea C11 \u6807\u51c6\u540e\uff0cC \u8bed\u8a00\u4e3a\u6211\u4eec\u4e13\u95e8\u63d0\u4f9b\u4e86\u4e00\u5957\u901a\u7528\u7684\u5e76\u53d1\u7f16\u7a0b\u63a5\u53e3\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6807\u51c6\u5e93\u5934\u6587\u4ef6 <code>threads.h</code> \u4e0e <code>stdatomic.h</code> \u6765\u4f7f\u7528\u5b83\u4eec\u3002</p> <ul> <li><code>threads.h</code> \u4e2d\u5305\u542b\u6709\u4e0e\u7ebf\u7a0b\u63a7\u5236\u3001\u4e92\u65a5\u91cf\u3001\u6761\u4ef6\u53d8\u91cf\uff0c\u4ee5\u53ca\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\u76f8\u5173\u7684\u63a5\u53e3\uff1b</li> <li><code>stdatomic.h</code> \u4e2d\u5219\u5305\u542b\u6709\u4e0e\u539f\u5b50\u64cd\u4f5c\u76f8\u5173\u7684\u63a5\u53e3\u3002\u8fd9\u4e9b\u63a5\u53e3\u63d0\u4f9b\u4e86\u591a\u79cd\u4e0d\u540c\u65b9\u5f0f\uff0c\u53ef\u7528\u6765\u907f\u514d\u591a\u7ebf\u7a0b\u5e94\u7528\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9047\u5230\u7684\u5404\u7c7b\u7ebf\u7a0b\u540c\u6b65\u95ee\u9898\u3002</li> </ul> <p>C11 \u6807\u51c6\u7684\u53d1\u5e03\uff0c\u7406\u8bba\u4e0a\u4f7f\u6784\u5efa\u53ef\u79fb\u690d\u7684\u591a\u7ebf\u7a0b C \u5e94\u7528\u6210\u4e3a\u53ef\u80fd\uff0c\u4f46\u73b0\u5b9e\u60c5\u51b5\u5374\u5e76\u975e\u8fd9\u6837\u7406\u60f3\u3002\u5404\u7c7b C \u6807\u51c6\u5e93\u5bf9 C11 \u4e2d\u5e76\u53d1\u7f16\u7a0b\u63a5\u53e3\u7684\u652f\u6301\u7a0b\u5ea6\u4e0d\u540c\uff0c\u6bd4\u5982 Glibc\uff08GNU C \u6807\u51c6\u5e93\uff09\u5728\u5176 2018 \u5e74\u4e2d\u65ec\u53d1\u5e03\u7684 2.28 \u7248\u672c\u4e2d\uff0c\u624d\u5c06\u76f8\u5173\u63a5\u53e3\u8fdb\u884c\u4e86\u8f83\u4e3a\u5b8c\u6574\u7684\u5b9e\u73b0\u3002\u8fd9\u5c31\u5bfc\u81f4\u4e86 C11 \u6807\u51c6\u4e2d\u7684\u8fd9\u4e9b\u91cd\u8981\u7279\u6027\uff0c\u81f3\u4eca\uff082022 \u5e74\u521d\uff09\u4ecd\u7136\u6ca1\u6709\u5f97\u5230\u8f83\u4e3a\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p> <p>\u56e0\u6b64\uff0c\u63a5\u4e0b\u6765\u6211\u5c06\u7528\u4e24\u8bb2\u7684\u7bc7\u5e45\uff0c\u4e3a\u4f60\u4ece\u96f6\u4ecb\u7ecd\u6709\u5173\u5e76\u53d1\u7f16\u7a0b\u7684\u4e00\u4e9b\u57fa\u7840\u77e5\u8bc6\uff0c\u4ee5\u53ca C11 \u5e76\u53d1\u7f16\u7a0b\u76f8\u5173\u63a5\u53e3\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_7","title":"\u8fdb\u7a0b\u548c\u7ebf\u7a0b","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u7a0b\u5e8f\u521b\u5efa\u4e00\u4e2a\u76f8\u5e94\u7684\u8fdb\u7a0b\uff0c\u4ee5\u4f5c\u4e3a\u5b83\u7684\u8fd0\u884c\u5b9e\u4f8b\u3002\u800c\u8fdb\u7a0b\u4e2d\u5219\u5305\u542b\u4e0e\u8be5\u7a0b\u5e8f\u6709\u5173\u7684\u4e00\u7cfb\u5217\u8fd0\u884c\u65f6\u4fe1\u606f\uff0c\u6bd4\u5982 VAS\u3001\u8fdb\u7a0b ID\u3001\u5904\u7406\u5668\u4e0a\u4e0b\u6587\uff08\u5982\u901a\u7528\u76ee\u7684\u5bc4\u5b58\u5668\u4e0e\u6307\u4ee4\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\uff09\u3001\u8fdb\u7a0b\u72b6\u6001\uff0c\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9\u8be5\u8fdb\u7a0b\u7684\u76f8\u5173\u8d44\u6e90\u7b49\u3002\u8fd9\u4e9b\u4fe1\u606f\u88ab\u7edf\u4e00\u5b58\u653e\u5728\u5185\u6838\u63d0\u4f9b\u7684\uff0c\u540d\u4e3a\u201c\u8fdb\u7a0b\u63a7\u5236\u5757\uff08PCB\uff09\u201d\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u3002</p> <p>\u800c\u76f8\u8f83\u4e8e\u8fdb\u7a0b\uff0c\u7ebf\u7a0b\u5219\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u66f4\u7ec6\u7c92\u5ea6\u7684\u8fd0\u884c\u5355\u5143\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u4f20\u7edf\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u6765\u8bf4\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u5185\u90e8\u90fd\u4f1a\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a\u7ebf\u7a0b\u3002\u5176\u4e2d\uff0c\u8fdb\u7a0b\u8d1f\u8d23\u5212\u5206\u4e0d\u540c\u7a0b\u5e8f\u6240\u4eab\u6709\u8d44\u6e90\u7684\u8fb9\u754c\uff1b\u800c\u7ebf\u7a0b\u5219\u5728\u5171\u4eab\u7a0b\u5e8f\u8fd0\u884c\u8d44\u6e90\u7684\u60c5\u51b5\u4e0b\uff0c\u8d1f\u8d23\u7a0b\u5e8f\u67d0\u4e2a\u5b50\u4efb\u52a1\u7684\u5177\u4f53\u6267\u884c\u8fc7\u7a0b\u3002</p> <p></p> <p>\u540c\u8fdb\u7a0b\u7c7b\u4f3c\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u6240\u5177\u6709\u7684\u4e0d\u540c\u72b6\u6001\u4fe1\u606f\u88ab\u4fdd\u5b58\u5728\u5185\u6838\u4e2d\u540d\u4e3a\u201c\u7ebf\u7a0b\u63a7\u5236\u5757\uff08TCB\uff09\u201d\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u3002\u5176\u4e2d\u5305\u542b\u6709\u4e0e\u7279\u5b9a\u7ebf\u7a0b\u8fd0\u884c\u7d27\u5bc6\u76f8\u5173\u7684\u5904\u7406\u5668\u4e0a\u4e0b\u6587\u3001\u7ebf\u7a0b ID\u3001\u6240\u5c5e\u8fdb\u7a0b\uff0c\u4ee5\u53ca\u72b6\u6001\u4fe1\u606f\uff0c\u7b49\u7b49\u3002\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0cPCB \u4e0e TCB \u4e24\u8005\u5185\u90e8\u6240\u5305\u542b\u7684\u5185\u5bb9\u4f1a\u6709\u4e00\u5b9a\u91cd\u5408\u3002\u8fd9\u662f\u7531\u4e8e\u5728\u67d0\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u5355\u8fdb\u7a0b\uff08\u5355\u7ebf\u7a0b\uff09\u5e94\u7528\u7684\u8fd0\u884c\u53ef\u80fd\u4f1a\u76f4\u63a5\u4f7f\u7528 PCB\uff0c\u6765\u540c\u65f6\u4fdd\u5b58\u7a0b\u5e8f\u7684\u8d44\u6e90\u63cf\u8ff0\u4fe1\u606f\u4e0e\u6267\u884c\u72b6\u6001\u4fe1\u606f\u3002\u800c\u5f53\u8fd0\u884c\u591a\u7ebf\u7a0b\u5e94\u7528\u65f6\uff0c\u624d\u4f1a\u914d\u5408\u4f7f\u7528 PCB \u4e0e TCB\u3002\u8fd9\u91cc\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u56fe\u6765\u76f4\u89c2\u5730\u5bf9\u6bd4\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u4e4b\u95f4\u7684\u533a\u522b\u548c\u8054\u7cfb\u3002\u5f53\u7136\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u5f0f\u5e76\u4e0d\u552f\u4e00\u3002</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_8","title":"\u7ebf\u7a0b\u7684\u57fa\u672c\u63a7\u5236","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n\nint run(void *arg)\n{\n    thrd_t id = thrd_current();     // \u8fd4\u56de\u8be5\u51fd\u6570\u8fd0\u884c\u6240\u5728\u7ebf\u7a0b\u7684\u6807\u8bc6\u7b26\uff1b\n    printf((const char*)arg, id);\n    return thrd_success;\n}\n\nint main(void)\n{\n#ifndef __STDC_NO_THREADS__\n    thrd_t thread;\n    int result;\n\n    // \u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\n    thrd_create(&amp;thread, run, \"Hello C11 thread with id: %lu.\\n\");\n    if(thrd_join(thread, &amp;result) == thrd_success)\n    {\n        // \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u9000\u51fa\uff1b\n        printf(\"Thread returns %d at the end.\\n\", result);\n    }\n#endif\n    return 0;\n}\n</code></pre> <p>\u968f\u7740\u591a\u7ebf\u7a0b\u5e94\u7528\u7684\u529f\u80fd\u53d8\u5f97\u9010\u6e10\u590d\u6742\uff0c\u5171\u4eab\u53d8\u91cf\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u3002\u5e76\u4e14\uff0c\u4e0d\u540c\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u4ee5\u4e0d\u540c\u7684\u5148\u540e\u987a\u5e8f\uff0c\u6765\u6267\u884c\u7a0b\u5e8f\u4e2d\u7684\u540c\u4e00\u6bb5\u4ee3\u7801\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u73b0\u4ee3 CPU \u91c7\u7528\u7684\u7279\u6b8a\u6307\u4ee4\u5904\u7406\u65b9\u5f0f\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u7684\u5b9e\u9645\u6267\u884c\u6d41\u7a0b\u4e0e\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u53ef\u80fd\u4e5f\u4e0d\u5b8c\u5168\u4e00\u81f4\u3002\u800c\u4e0a\u8ff0\u8fd9\u4e09\u4e2a\u56e0\u7d20\uff0c\u90fd\u786e\u5b9e\u4f1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5f71\u54cd\u591a\u7ebf\u7a0b\u5e94\u7528\u7684\u6b63\u5e38\u6267\u884c\u3002</p> <p>\u4e0b\u9762\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e00\u4e0b\u4e0e\u4e0a\u8ff0\u8fd9\u4e09\u79cd\u60c5\u51b5\u76f8\u5bf9\u5e94\u7684\u4e09\u4e2a\u6982\u5ff5\uff0c\u5373\uff1a\u6570\u636e\u7ade\u4e89\u3001\u7ade\u6001\u6761\u4ef6\uff0c\u4ee5\u53ca\u6307\u4ee4\u91cd\u6392\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_9","title":"\u6570\u636e\u7ade\u4e89","text":"<p>\u4ece\u5b9a\u4e49\u4e0a\u6765\u8bb2\uff0c\u6570\u636e\u7ade\u4e89\uff08Data Race\uff09\u662f\u6307\u5728\u4e00\u4e2a\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\uff0c\u6709\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u7ebf\u7a0b\u5728\u540c\u4e00\u65f6\u95f4\u5bf9\u540c\u4e00\u5757\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e86\u975e\u539f\u5b50\u64cd\u4f5c\uff0c\u4e14\u5176\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u662f\u5199\u64cd\u4f5c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8be5\u6570\u636e\u503c\u7684\u6700\u7ec8\u72b6\u6001\u53ef\u80fd\u4e0e\u7a0b\u5e8f\u8bed\u4e49\u4e0a\u5e0c\u671b\u8868\u8fbe\u7684\u8ba1\u7b97\u7ed3\u679c\u4e0d\u4e00\u81f4\u3002\u6765\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n\n#define THREAD_COUNT 20\n#define THREAD_LOOP 100000000\n\nlong counter = 0;\n\nint run(void *arg)\n{\n    int i = 0;\n    for(i = 0; i &lt; THREAD_LOOP; i++)\n    {\n        counter++;\n    }\n    printf(\"Thread %d terminates. \\n\", *((int *) arg));\n    return thrd_success;\n}\n\n\nint main(void)\n{\n#ifndef __STDC_NO_THREADS__\n    int ids[THREAD_COUNT];      // \u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u5e8f\u53f7\u7684\u6570\u7ec4\n    thrd_t threads[THREAD_COUNT];\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        ids[i] = i + 1;\n        thrd_create(&amp;threads[i], run, ids + i); // \u521b\u5efa THREAD_COUNT \u4e2a\u7ebf\u7a0b\n    }\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        thrd_join(threads[i], NULL); // \u8ba9\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\n    }\n\n    printf(\"Counter value is %ld.\\n\", counter);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5728 main \u51fd\u6570\u5185\u521b\u5efa\u4e86 20 \u4e2a\u7ebf\u7a0b\uff08\u7531\u5b8f\u5e38\u91cf THREAD_COUNT \u6307\u5b9a\uff09\uff0c\u5e76\u8ba9\u8fd9\u4e9b\u7ebf\u7a0b\u540c\u65f6\u5bf9\u5168\u5c40\u53d8\u91cf counter \u8fdb\u884c\u503c\u9012\u589e\u64cd\u4f5c\u3002\u7531\u4e8e counter \u7684\u521d\u59cb\u503c\u88ab\u8bbe\u7f6e\u4e3a 0\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4ee3\u7801\u6309\u7167\u6211\u4eec\u7684\u9884\u671f\u6267\u884c\uff0c20 \u4e2a\u7ebf\u7a0b\u5206\u522b\u5bf9\u8be5\u5168\u5c40\u53d8\u91cf\u9012\u589e 1 \u4ebf\u6b21\uff0c\u7a0b\u5e8f\u5728\u9000\u51fa\u524d\u6253\u5370\u7684 counter \u53d8\u91cf\u503c\u5e94\u8be5\u4e3a 20 \u4ebf\u3002\u4f46\u5b9e\u9645\u60c5\u51b5\u53ef\u80fd\u5e76\u975e\u5982\u6b64\u3002</p> <p>\u5728\u975e\u4f18\u5316\u60c5\u51b5\u4e0b\u7f16\u8bd1\u5e76\u591a\u6b21\u8fd0\u884c\u8fd9\u6bb5\u4ee3\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0\u7a0b\u5e8f\u6253\u5370\u51fa\u7684 counter \u53d8\u91cf\u503c\u5e76\u4e0d\u7a33\u5b9a\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u503c\u662f\u51c6\u786e\u7684\uff0c\u800c\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5374\u5c0f\u4e8e\u8fd9\u4e2a\u6570\u5b57\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u4fbf\u662f\u7531\u4e8e\u591a\u7ebf\u7a0b\u6a21\u578b\u4e0b\u7684\u6570\u636e\u7ade\u4e89\u5f15\u8d77\u7684\u3002\u5bf9\u4e8e\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u6765\u8bf4\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4f1a\u5c06 run \u51fd\u6570\u5185\u7684 counter \u53d8\u91cf\u81ea\u589e\u8bed\u53e5\uff0c\u7f16\u8bd1\u4e3a\u5982\u4e0b\u6240\u793a\u7684\u51e0\u6761\u673a\u5668\u6307\u4ee4\u7684\u7ec4\u5408\uff1a</p> <pre><code>mov eax, DWORD PTR counter[rip]\nadd eax, 1\nmov DWORD PTR counter[rip], eax\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5f53\u591a\u4e2a\u7ebf\u7a0b\u5728 CPU \u7684\u8c03\u5ea6\u4e0b\u4ea4\u9519\u8fd0\u884c\u65f6\uff0c\u4fbf\u53ef\u80fd\u4f1a\u53d1\u751f\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u67d0\u4e2a\u7ebf\u7a0b\u521a\u521a\u6267\u884c\u5b8c\u4e0a\u8ff0\u4ee3\u7801\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\uff0c\u5c06\u53d8\u91cf counter \u7684\u503c\u6682\u5b58\u5728\u4e86\u5bc4\u5b58\u5668 <code>rax</code> \u4e2d\u3002\u6b64\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f00\u59cb\u8c03\u5ea6\u7ebf\u7a0b\uff0c\u5c06\u5f53\u524d\u7ebf\u7a0b\u6302\u8d77\uff0c\u5e76\u5f00\u59cb\u6267\u884c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u4ee3\u7801\u3002</p> <p>\u65b0\u7684\u7ebf\u7a0b\u5728\u6267\u884c\u9012\u589e\u65f6\uff0c\u7531\u4e8e\u9700\u8981\u518d\u6b21\u4ece counter \u6240\u5728\u7684\u539f\u5185\u5b58\u5730\u5740\u4e2d\u8bfb\u5165\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u8be5\u503c\u4e0e\u4e0a\u4e00\u4e2a\u7ebf\u7a0b\u8bfb\u53d6\u5230\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\u3002\u800c\u8fd9\u4fbf\u4f1a\u5bfc\u81f4\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u5728\u9012\u589e\u540e\u5f97\u5230\u7684\u7ed3\u679c\u503c\u4e5f\u5b8c\u5168\u76f8\u540c\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u5bf9 counter \u53d8\u91cf\u7684\u4e24\u6b21\u9012\u589e\u8fc7\u7a0b\u4ec5\u4f7f\u5f97\u5b83\u7684\u539f\u503c\u589e\u52a0\u4e86 1\u3002</p> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c\u54ea\u6015\u7f16\u8bd1\u5668\u5728\u4f18\u5316\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u9012\u589e\u8bed\u53e5\u5b9e\u73b0\u4e3a\u4ec5\u4e00\u6761\u6c47\u7f16\u6307\u4ee4\uff0c\u6570\u636e\u7ade\u4e89\u7684\u95ee\u9898\u4ecd\u53ef\u80fd\u4f1a\u5b58\u5728\u3002</p> <p>\u6bd4\u5982\uff0c\u7f16\u8bd1\u5668\u5c06\u8be5\u9012\u589e\u64cd\u4f5c\u5b9e\u73b0\u4e3a\u673a\u5668\u6307\u4ee4 add DWORD PTR counter[rip], 1\uff08\u8fd9\u91cc\u4f7f\u7528 RIP-relative \u5bfb\u5740\uff09\u3002\u73b0\u4ee3 x86-64 \u5904\u7406\u5668\u5728\u5904\u7406\u8fd9\u6761 CISC \u98ce\u683c\u7684\u673a\u5668\u6307\u4ee4\u65f6\uff0c\u53ef\u80fd\u4f1a\u5c06\u5176\u62c6\u5206\u4e3a\u5bf9\u5e94\u7684\u4e09\u79cd\u4e0d\u540c\u201c\u5fae\u6307\u4ee4\uff08<code>uOp</code>\uff09\u201d\uff1aLOAD\u3001ADD\u3001STORE\u3002\u5176\u4e2d\uff0c</p> <ol> <li> <p>LOAD \u6307\u4ee4\u4f1a\u9996\u5148\u4ece\u7ed9\u5b9a\u5185\u5b58\u5730\u5740\u5904\u8bfb\u51fa\u5f53\u524d\u7684\u6570\u636e\u503c\uff1b</p> </li> <li> <p>ADD \u6307\u4ee4\u5219\u4f1a\u6839\u636e\u7528\u6237\u4f20\u5165\u7684\u7acb\u5373\u6570\u53c2\u6570\uff0c\u6765\u8ba1\u7b97\u51fa\u66f4\u65b0\u540e\u7684\u6570\u636e\u503c\uff1b</p> </li> <li>\u6700\u540e\uff0cSTORE \u6307\u4ee4\u4f1a\u5c06\u8fd9\u4e2a\u7ed3\u679c\u6570\u636e\u503c\u66f4\u65b0\u5230\u5bf9\u5e94\u7684\u5185\u5b58\u4e2d\u3002</li> </ol> <p>\u540c\u4e4b\u524d\u591a\u6761\u673a\u5668\u6307\u4ee4\u7684\u5b9e\u73b0\u7c7b\u4f3c\uff0c\u8fd9\u4e9b\u5fae\u6307\u4ee4\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0b\u8c03\u5ea6\u4e0b\uff0c\u4e5f\u53ef\u80fd\u5b58\u5728\u7740\u4ea4\u66ff\u6267\u884c\u7684\u8fc7\u7a0b\uff0c\u56e0\u6b64\u4e5f\u6709\u7740\u4ea7\u751f\u6570\u636e\u7ade\u4e89\u7684\u98ce\u9669\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_10","title":"\u7ade\u6001\u6761\u4ef6","text":"<p>\u7ade\u6001\u6761\u4ef6\uff08Race Condition\uff09\u662f\u6307\u7531\u4e8e\u7a0b\u5e8f\u4e2d\u67d0\u4e9b\u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u673a\u4e0e\u987a\u5e8f\u4e0d\u4e00\u81f4\uff0c\u4ece\u800c\u5f71\u54cd\u7a0b\u5e8f\u8fd0\u884c\u6b63\u786e\u6027\u7684\u4e00\u79cd\u7f3a\u9677\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u7ade\u4e89\u7684\u5b58\u5728\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7ade\u6001\u6761\u4ef6\u7684\u51fa\u73b0\uff0c\u4f46\u4e24\u8005\u7684\u51fa\u73b0\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u592a\u591a\u8054\u7cfb\uff08\u6709\u90e8\u5206\u4eba\u8ba4\u4e3a\u6570\u636e\u7ade\u4e89\u662f\u7ade\u6001\u6761\u4ef6\u7684\u4e00\u79cd\uff0c\u4f46\u4e5f\u6709\u4eba\u6301\u53cd\u5bf9\u610f\u89c1\uff09\u3002</p> <p>\u4e0d\u540c\u4e8e\u6570\u636e\u7ade\u4e89\u7684\u662f\uff0c\u5bf9\u7a0b\u5e8f\u4e2d\u7ade\u6001\u6761\u4ef6\u7684\u5224\u65ad\u53ef\u80fd\u662f\u975e\u5e38\u56f0\u96be\u7684\u3002\u7ade\u6001\u6761\u4ef6\u5e76\u6ca1\u6709\u53ef\u4ee5\u7cbe\u786e\u5230\u5177\u4f53\u64cd\u4f5c\u548c\u884c\u4e3a\u4e0a\u7684\u5b9a\u4e49\uff0c\u56e0\u6b64\uff0c\u5b83\u662f\u5426\u4ea7\u751f\u5b8c\u5168\u53d6\u51b3\u4e8e\u7a0b\u5e8f\u7684\u5177\u4f53\u8bbe\u8ba1\uff0c\u4ee5\u53ca\u662f\u5426\u5b58\u5728\u53ef\u80fd\u5f71\u54cd\u7a0b\u5e8f\u8fd0\u884c\u7684\u5916\u90e8\u975e\u786e\u5b9a\u6027\u53d8\u5316\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u6bb5\u4ec5\u542b\u6709\u7ade\u6001\u6761\u4ef6\uff0c\u4f46\u5e76\u6ca1\u6709\u6570\u636e\u7ade\u4e89\u7684\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;threads.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdatomic.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\n#define THREAD_COUNT 10\n\natomic_int accountA = 100000000;\natomic_int accountB = 0;\n\nint run(void *arg)\n{\n    int _amount = *((int *)arg);\n    while (1)\n    {\n        if(accountA &lt; _amount)\n            return thrd_error;\n\n        atomic_fetch_add(&amp;accountB, _amount);   // \u5c06\u91d1\u989d\u7d2f\u52a0\u5230\u8f6c\u5165\u8d26\u6237\n        atomic_fetch_sub(&amp;accountA, _amount);   // \u5c06\u91d1\u989d\u4ece\u8f6c\u51fa\u8d26\u6237\u4e2d\u6263\u9664\n    }\n    return thrd_success;\n}\n\nint main(void)\n{\n#if !defined(__STDC_NO_THREADS__) &amp;&amp; !defined(__STDC_NO_ATOMICS__)\n    thrd_t threads[THREAD_COUNT];\n    srand(time(NULL));\n\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        int amount = rand() % 50;   // \u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u751f\u6210\u4e00\u4e2a\u968f\u673a\u8f6c\u79fb\u91d1\u989d\n        thrd_create(&amp;threads[i], run, &amp;amount);\n    }\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        thrd_join(threads[i], NULL);\n    }\n\n    printf(\"A: %d.\\nB: %d.\\n\",accountA, accountB);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4ee5\u7b80\u5316\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u91d1\u878d\u573a\u666f\uff0c\u5373\u8d26\u6237 A \u5411\u8d26\u6237 B \u8fdb\u884c\u591a\u6b21\u8f6c\u8d26\uff0c\u4e14\u6bcf\u6b21\u8f6c\u8d26\u7684\u91d1\u989d\u90fd\u5e76\u4e0d\u56fa\u5b9a\u3002\u5728 main \u51fd\u6570\u91cc\uff0c\u6211\u4eec\u901a\u8fc7\u521b\u5efa\u591a\u4e2a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6765\u6a21\u62df\u4e24\u4e2a\u8d26\u6237\u4e4b\u95f4\u5206\u6279\u3001\u591a\u6b21\u7684\u8d22\u4ea7\u8f6c\u79fb\u8fc7\u7a0b\u3002\u5176\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4f1a\u4f7f\u7528\u4e0d\u540c\u7684\u56fa\u5b9a\u4efd\u989d\u6765\u8fdb\u884c\u8f6c\u8d26\u8fc7\u7a0b\uff0c\u800c\u968f\u673a\u6570 amount \u4fbf\u8868\u793a\u4e86\u8fd9\u4e2a\u989d\u5ea6\u3002</p> <p>\u7ebf\u7a0b\u5f00\u59cb\u8fd0\u884c\u540e\uff0c\u5728\u4ee3\u7801\u7b2c 10 \u884c\u7684 run \u51fd\u6570\u5185\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf _amount \u6765\u5b58\u653e\u4f20\u5165\u7684\u3001\u5f53\u524d\u7ebf\u7a0b\u9700\u8981\u4f7f\u7528\u7684\u56fa\u5b9a\u4efd\u989d\u3002\u63a5\u4e0b\u6765\uff0c\u5728\u4e00\u4e2a\u65e0\u9650\u5faa\u73af\u4e2d\uff0c\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u4ee5\u4e0b\u4e09\u4e2a\u6b65\u9aa4\uff0c\u6765\u5b8c\u6210\u4e24\u4e2a\u8d26\u6237\u4e4b\u95f4\u7684\u8f6c\u8d26\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5224\u65ad\u8d26\u6237 A \u7684\u5269\u4f59\u8d44\u91d1\u662f\u5426\u8db3\u591f\u8fdb\u884c\u8f6c\u8d26\u3002\u82e5\u5426\uff0c\u5219\u76f4\u63a5\u9000\u51fa\uff1b</li> <li>\u5c06\u8f6c\u8d26\u7684\u91d1\u989d\u7d2f\u52a0\u5230\u8d26\u6237 B \u4e2d\uff1b</li> <li>\u5c06\u8f6c\u8d26\u7684\u91d1\u989d\u4ece\u8d26\u6237 A \u4e2d\u6263\u9664\u3002</li> </ol> <p>\u800c\u5f53\u6240\u6709\u7ebf\u7a0b\u90fd\u9000\u51fa\u65f6\uff0c\u5219\u8868\u793a\u5f53\u524d\u8d26\u6237 A \u4e2d\u7684\u5269\u4f59\u91d1\u989d\uff0c\u65e0\u6cd5\u518d\u6ee1\u8db3\u4efb\u4f55\u4e00\u4e2a\u7ebf\u7a0b\u4ee5\u5b83\u7684\u56fa\u5b9a\u91d1\u989d\u4e3a\u5355\u4f4d\u8fdb\u884c\u8f6c\u8d26\u3002\u6700\u540e\uff0c\u901a\u8fc7 <code>printf</code> \u51fd\u6570\uff0c\u6211\u4eec\u5c06\u4e24\u4e2a\u8d26\u6237\u5185\u7684\u5269\u4f59\u8d44\u91d1\u6253\u5370\u4e86\u51fa\u6765\u3002\u6309\u7167\u6211\u4eec\u5bf9\u7a0b\u5e8f\u7684\u7406\u89e3\uff0c\u6b64\u65f6\uff0c\u4e24\u4e2a\u8d26\u6237\u4e2d\u7684\u91d1\u989d\u5e94\u8be5\u90fd\u5927\u4e8e 0\uff0c\u4e14\u4e24\u8005\u4e4b\u548c\u4e3a 1 \u4ebf\u3002</p> <pre><code>A: -38.\nB: 100000038.\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8d26\u6237 A \u7684\u5269\u4f59\u91d1\u989d\u53d8\u4e3a\u4e86\u8d1f\u6570\uff0c\u7a0b\u5e8f\u8fd0\u884c\u51fa\u73b0\u4e86\u5f02\u5e38\u3002\u5982\u679c\u4ed4\u7ec6\u5206\u6790\u4e0a\u8ff0\u4ee3\u7801\u7684\u6267\u884c\u903b\u8f91\uff0c\u4f60\u4f1a\u53d1\u73b0\u591a\u4e2a\u7ebf\u7a0b\u5728\u5bf9\u8d26\u6237\u53d8\u91cf\u8fdb\u884c\u4fee\u6539\u65f6\uff0c\u867d\u7136\u6ca1\u6709\u6570\u636e\u7ade\u4e89\uff0c\u4f46\u7a0b\u5e8f\u7684\u4e0d\u6070\u5f53\u8bbe\u8ba1\u5bfc\u81f4\u5176\u5b58\u5728\u7740\u7ade\u6001\u6761\u4ef6\u3002</p> <p>\u5f53\u591a\u4e2a\u7ebf\u7a0b\u5728\u540c\u65f6\u6267\u884c run \u51fd\u6570\u5185\u7684\u903b\u8f91\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4efb\u52a1\u8c03\u5ea6\u5668\u53ef\u80fd\u4f1a\u5728\u4efb\u610f\u65f6\u523b\u6682\u505c\u67d0\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\uff0c\u8f6c\u800c\u53bb\u8fd0\u884c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p>\u56e0\u6b64\uff0c\u4fbf\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u67d0\u4e2a\u7ebf\u7a0b\u4ee5\u539f\u5b50\u5f62\u5f0f\uff0c\u6267\u884c\u4e86\u4ee3\u7801\u7684 <code>atomic_fetch_add</code>\uff0c\u5c06\u91d1\u989d\u7d2f\u52a0\u5230\u8d26\u6237 B\u3002\u800c\u6b64\u65f6\uff0c\u8c03\u5ea6\u5668\u5c06\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u7ed9\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u3002\u8be5\u7ebf\u7a0b\u5728\u4e0a\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u6ca1\u6709\u5b8c\u6210\u5bf9\u8d26\u6237 A \u7684\u6263\u51cf\u64cd\u4f5c\u524d\uff0c\u4fbf\u76f4\u63a5\u4f7f\u7528\u672a\u540c\u6b65\u7684\u503c\u53c2\u4e0e\u4e86\u4e0b\u4e00\u6b21\u7684\u8f6c\u8d26\u64cd\u4f5c\u3002</p> <p>\uff08\u6709\u70b9\u50cf\u6570\u636e\u7ade\u4e89\uff1f\uff09</p> <p>\u56e0\u6b64\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u5b9e\u9645\u4e0a\u4f9d\u8d56\u4e8e\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\uff0c\u6309\u7167\u4e00\u5b9a\u987a\u5e8f\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u90a3\u4e48\uff0c\u5e94\u8be5\u5982\u4f55\u4fee\u590d\u8fd9\u4e2a\u7a0b\u5e8f\u5462\uff1f\u4e0b\u4e00\u8bb2</p> <p>\u6709\u70b9\u50cf \u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u300b\u91cc\u7684\u89e3\u51b3\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u7b14\u8bb0\uff1f\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u7684\u4e32\u884c\u5316\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u7684\u7ade\u6001\u6761\u4ef6\u662f\u8f6f\u4ef6\u5c42\u9762\u7684\uff0c\u603b\u7ebf\u55c5\u63a2\uff08MESI\uff09\u504f\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u786c\u4ef6\u5c42\u9762\u7684\uff1f\u8fd9\u91cc\u89e3\u51b3\u5b83\uff0c\u7528\u4e00\u4e0b\u4e92\u65a5\u9501\u3001\u4fe1\u53f7\u91cf\u3001\u6761\u4ef6\u53d8\u91cf\u6765\u641e\u5b9a\uff1f</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_11","title":"\u6307\u4ee4\u91cd\u6392","text":"<p>\u73b0\u4ee3\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u901a\u5e38\u4f1a\u91c7\u7528\u540d\u4e3a\u201c\u6307\u4ee4\u91cd\u6392\u201d\uff08\u4e71\u5e8f\u6267\u884c\u7684\u4e00\u79cd\uff09\u7684\u6280\u672f\u6765\u8fdb\u4e00\u6b65\u63d0\u5347\u7a0b\u5e8f\u7684\u8fd0\u884c\u6548\u7387\u3002</p> <p>\u8fd9\u79cd\u6280\u672f\u4f1a\u5728\u5c3d\u91cf\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u53ef\u89c2\u6d4b\u6267\u884c\u7ed3\u679c\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u751f\u6210\u7684\u673a\u5668\u6307\u4ee4\uff0c\u6216\u5b83\u4eec\u7684\u5b9e\u9645\u6267\u884c\u987a\u5e8f\u8fdb\u884c\u9002\u5f53\u7684\u91cd\u65b0\u6392\u5e8f\u3002</p> <ul> <li>\u5bf9\u4e8e\u7f16\u8bd1\u5668\u6765\u8bf4\uff0c\u5176\u8868\u8c61\u662f\u6e90\u4ee3\u7801\u4e2d\u8bed\u53e5\u7684\u51fa\u73b0\u987a\u5e8f\uff0c\u4e0e\u5bf9\u5e94\u6c47\u7f16\u4ee3\u7801\u7684\u5b9e\u73b0\u987a\u5e8f\u4e0d\u4e00\u81f4\u3002</li> <li>\u5bf9\u4e8e\u5904\u7406\u5668\u6765\u8bf4\uff0c\u5219\u662f\u7a0b\u5e8f\u5728\u771f\u6b63\u6267\u884c\u65f6\u4ea7\u751f\u526f\u4f5c\u7528\u7684\u987a\u5e8f\uff08\u6bd4\u5982\u53d8\u91cf\u8d4b\u503c\uff09\uff0c\u4e0e\u6c47\u7f16\u4ee3\u7801\u4e2d\u6307\u4ee4\u7684\u51fa\u73b0\u987a\u5e8f\u4e0d\u4e00\u81f4\u3002</li> </ul> <p>\u5bf9\u591a\u7ebf\u7a0b\u5e94\u7528\u6765\u8bf4\uff0c\u5373\u4f7f\u7f16\u8bd1\u5668\u53ef\u4ee5\u4ece\u9759\u6001\u5206\u6790\u7684\u89c6\u89d2\uff0c\u6765\u786e\u4fdd\u6c47\u7f16\u6307\u4ee4\u7684\u91cd\u6392\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u7684\u53ef\u89c2\u6d4b\u6267\u884c\u7ed3\u679c\uff0c\u4f46\u5f53\u591a\u4e2a\u7ebf\u7a0b\u88ab\u8c03\u5ea6\u5230\u4e0d\u540c\u7684\u7269\u7406 CPU \u4e0a\u6267\u884c\u65f6\uff0c\u4e0d\u540c CPU \u4e4b\u95f4\u4e00\u822c\u65e0\u6cd5\u5171\u4eab\u5bf9\u5e94\u7ebf\u7a0b\u6307\u4ee4\u5728\u6267\u884c\u65f6\u7684\u91cd\u6392\u4fe1\u606f\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u7ebf\u7a0b\u4e4b\u95f4\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u65f6\uff0c\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u6b63\u786e\u6027\u53ef\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n#include &lt;stdatomic.h&gt;\n\n#if !defined(__STDC_NO_ATOMICS__)\n    atomic_int x = 0, y = 0;\n#endif\n\nint run(void *arg)\n{\n    x = 10;\n    y = 20;     // \uff01\u53d8\u91cf y \u7684\u503c\u53ef\u80fd\u88ab\u4f18\u5148\u66f4\u65b0\uff01\n}\n\nint observe(void *arg)\n{\n    while(y != 20);     // \u5fd9\u7b49\u5f85\n    printf(\"%d\", x);    // \u53ea\u5728 x \u88ab\u66f4\u65b0\u540e\u6253\u5370\n}\n\nint main(void)\n{\n#if !defined (__STDC_NO_THREADS__)\n    thrd_t threadA, threadB;\n\n    thrd_create(&amp;threadA, run, NULL);\n    thrd_create(&amp;threadB, observe, NULL);\n    thrd_join(threadA, NULL);\n    thrd_join(threadB, NULL);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u4f46\u7531\u4e8e\u6307\u4ee4\u91cd\u6392\u7684\u5b58\u5728\uff0crun \u51fd\u6570\u5728\u7a0b\u5e8f\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5176\u5185\u90e8\u5bf9\u53d8\u91cf x \u4e0e y \u7684\u503c\u53d8\u66f4\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4e0e\u6211\u4eec\u5728 C \u4ee3\u7801\u4e2d\u89c2\u5bdf\u5230\u7684\u987a\u5e8f\u5e76\u4e0d\u4e00\u81f4\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53d8\u91cf y \u7684\u503c\u53ef\u80fd\u4f1a\u88ab\u4f18\u5148\u66f4\u65b0\u3002\u800c\u5982\u679c\u6b64\u65f6 observe \u7ebf\u7a0b\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u5219 <code>printf</code> \u8bed\u53e5\u4fbf\u4f1a\u6253\u5370\u51fa\u5e76\u975e\u6211\u4eec\u6240\u671f\u671b\u7684\u503c\u3002\uff08\u8fd9\u79cd\u60c5\u51b5\u5f88\u96be\u9047\u5230\uff0c\u4f46\u662f\u6709\uff1f\uff09</p> <p>\u4e3a\u6b64\uff0cC \u8bed\u8a00\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u88ab\u79f0\u4e3a\u201c\u5185\u5b58\u987a\u5e8f\uff08Memory Order\uff09\u201d\u7684\u4e00\u7cfb\u5217\u679a\u4e3e\u503c\u3002\u901a\u8fc7\u914d\u5408\u7279\u5b9a\u7684\u5e93\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u6211\u4eec\u80fd\u591f\u660e\u786e\u89c4\u5b9a\u7f16\u8bd1\u5668\u53ca\u5904\u7406\u5668\u5e94\u8be5\u5982\u4f55\u5bf9\u67d0\u6bb5\u4ee3\u7801\u7684\u6307\u4ee4\u91cd\u6392\u8fdb\u884c\u7ea6\u675f\u3002\u4e0b\u4e00\u8bb2</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_12","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u5bf9\u4e8ePCB\u6211\u4e00\u76f4\u6709\u4e00\u4e2a\u7591\u60d1\uff0c\u5728\u6211\u7684\u7406\u89e3\u4e2d\u8fd9\u4e2a\u6982\u5ff5\u662f\u64cd\u4f5c\u7cfb\u7edf\u7edf\u4e00\u7684\u4e00\u4e2a\u62bd\u8c61\u6982\u5ff5\uff0c\u540c\u65f6\u636e\u6211\u6240\u77e5Linux\u4e2d\u5b58\u5728\u4e24\u4e2a\u8fdb\u7a0b\u76f8\u5173\u7684\u7ed3\u6784\uff1a<code>thread_info</code>\u548c<code>task_struct</code>\uff0c\u90a3\u4e48PCB\u548c\u8fd9\u4e24\u4e2a\u7ed3\u6784\u6709\u6ca1\u6709\u5bf9\u5e94\u5173\u7cfb\u5462\uff1f\u81f3\u4e8eTCB\u662f\u6211\u4eca\u5929\u7b2c\u4e00\u6b21\u542c\u5230\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u540c\u6837\u7684\u8fd9\u4e2a\u6982\u5ff5\u4e0e\u524d\u9762\u63d0\u5230\u7684\u4e24\u4e2aLinux\u7ed3\u6784\u6709\u5bf9\u5e94\u5173\u7cfb\u5417\uff1f</p> <p>\u4f5c\u8005\u56de\u590d: \u662f\u7684\uff0c\u5176\u5b9e PCB \u4e0e TCB \u5c31\u662f\u9488\u5bf9\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u62bd\u8c61\u6982\u5ff5\uff0c\u5177\u4f53\u5b9e\u73b0\u662f\u53ef\u4ee5\u591a\u79cd\u591a\u6837\u7684\u3002\u7b80\u5355\u6765\u8bb2\uff0cLinux \u5728\u5b9e\u73b0\u4e2d\u6ca1\u6709\u4e3a\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u5355\u72ec\u8bbe\u7f6e\u7528\u4e8e\u5b58\u653e\u76f8\u5173\u4fe1\u606f\u7684\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u7edf\u4e00\u4f7f\u7528 task_struct \u5b58\u50a8\u901a\u7528\u7684\u4efb\u52a1\u4fe1\u606f\uff0c\u4f7f\u7528 thread_info \u5b58\u653e\u5e73\u53f0\u76f8\u5173\u7684\u4fe1\u606f\u3002\u533a\u5206\u662f\u4e0d\u662f\u7ebf\u7a0b\u5c31\u770b\u4e0d\u540c task_struct \u5bf9\u8c61\u4e4b\u95f4\u6709\u6ca1\u6709\u5171\u4eab\u8d44\u6e90\u3002\u5373\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u5728 Linux \u4e2d\u53ea\u6709\u8fdb\u7a0b\uff08PCB\uff09\uff0c\u6ca1\u6709\u72ec\u7acb\u7684\u7ebf\u7a0b\uff08TCB\uff09\u3002\u800c\u76f8\u8f83\u4e8e Windows \u548c Sun Solaris \u7b49\u660e\u786e\u533a\u5206\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\uff0cLinux \u7684\u5b9e\u73b0\u76f8\u5bf9\u66f4\u52a0\u4f18\u96c5\u3002</p> <p>\u200b                                                                               \u2014 \u53c2\u8003\u81ea\u300aLinux Kernel Development 3rd Edition\u300b\uff0c\u57fa\u4e8e 2.6 \u7248\u672c\u5185\u6838\u3002</p> </li> <li> <p>\u4ec0\u4e48\u7c7b\u578b\u7684\u5e94\u7528\u66f4\u9002\u5408\u4f7f\u7528\u591a\u7ebf\u7a0b\u6280\u672f\u6765\u63d0\u5347\u5176\u8fd0\u884c\u65f6\u6027\u80fd\uff1f\u67e5\u627e\u8d44\u6599</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#5","title":"5\uff5c\u6807\u51c6\u5e93\uff1a\u5982\u4f55\u4f7f\u7528\u4e92\u65a5\u91cf\u7b49\u6280\u672f\u534f\u8c03\u7ebf\u7a0b\u8fd0\u884c\uff1f","text":"<p>C \u8bed\u8a00\u4e3a\u5e76\u53d1\u7f16\u7a0b\u63d0\u4f9b\u7684\u51e0\u5927\u5229\u5668\uff1a\u4e92\u65a5\u91cf\u3001\u539f\u5b50\u64cd\u4f5c\u3001\u6761\u4ef6\u53d8\u91cf\uff0c\u4ee5\u53ca\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_13","title":"\u4e92\u65a5\u91cf","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u6570\u636e\u7ade\u4e89\uff0c\u6709\u9501\u8fd9\u4e48\u4e00\u4e2a\u4e1c\u897f\u3002\uff08\u597d\u6bd4\u73b0\u5728\u6709\u4e00\u4e2a\u5171\u4eab\u7684\u4e1c\u897f\uff08\u5171\u4eab\u8d44\u6e90\uff09\uff0c\u8c01\u5148\u5230\u5148\u5f97\uff0c\u4f60\u5148\u5230\u4e86\u80af\u5b9a\u4e0d\u7ed9\u522b\u4eba\u7528\uff0c\u6240\u4ee5\u4f60\u7ed9\u8fd9\u4e2a\u4e1c\u897f\u653e\u5230\u4e86\u4e00\u4e2a\u4fdd\u9669\u67dc\uff0c\u4e0a\u4e86\u9501\uff09</p> <p>\u8fd9\u91cc\u7684\u4e92\u65a5\u91cf\u5c31\u662f\u4e00\u4e2a\u9501\u3002</p> <p>\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u8bbf\u95ee\u67d0\u4e2a\u5171\u4eab\u8d44\u6e90\u524d\uff0c\u9700\u8981\u5148\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u52a0\u9501\u64cd\u4f5c\u3002</p> <p>\u6b64\u65f6\uff0c\u5176\u4ed6\u4efb\u4f55\u60f3\u8981\u518d\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u52a0\u9501\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u81f3\u5f53\u524d\u7ebf\u7a0b\u91ca\u653e\u8be5\u9501\u3002</p> <p>\u9501\u88ab\u91ca\u653e\u540e\uff0c\u6240\u6709\u4e4b\u524d\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u90fd\u5f00\u59cb\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e76\u518d\u6b21\u91cd\u590d\u4e4b\u524d\u7684\u6b65\u9aa4\uff0c\u5f00\u59cb\u201c\u4e89\u593a\u201d\u53ef\u4ee5\u5bf9\u4e92\u65a5\u91cf\u8fdb\u884c\u52a0\u9501\u7684\u540d\u989d\u3002</p> <p>\u5728 C \u8bed\u8a00\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5934\u6587\u4ef6 <code>threads.h</code> \u63d0\u4f9b\u7684\uff0c\u4ee5 \u201c<code>mtx_\u201d</code> \u4e3a\u524d\u7f00\u7684\u76f8\u5173\u63a5\u53e3\u6765\u4f7f\u7528\u4e92\u65a5\u91cf\u7684\u80fd\u529b\u3002</p> <p>\u57fa\u672c\u4f7f\u7528\uff1a</p> <ol> <li>\u521d\u59cb\u5316\u4e92\u65a5\u91cf\uff1a<code>mtx_init()</code></li> <li>\u52a0\u9501\uff1a<code>mtx_lock()</code></li> <li>\u89e3\u9501\uff1a<code>mtx_unlock()</code></li> <li>\u9500\u6bc1\u4e92\u65a5\u91cf\uff1a<code>mtx_destroy()</code></li> </ol> <p>\u6539\u8fdb\u4e0a\u4e00\u8282\u7684\u6570\u636e\u7ade\u4e89\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n\n#define THREAD_COUNT 20\n#define THREAD_LOOP 100000000\n\nlong counter = 0;\nmtx_t mutex;\n\nint run(void *arg)\n{\n    int i = 0;\n    for(i = 0; i &lt; THREAD_LOOP; i++)\n    {\n        mtx_lock(&amp;mutex);\n        counter++;\n        mtx_unlock(&amp;mutex);\n    }\n    printf(\"Thread %d terminates. \\n\", *((int *) arg));\n    return thrd_success;\n}\n\n\nint main(void)\n{\n#ifndef __STDC_NO_THREADS__\n    int ids[THREAD_COUNT];      // \u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u5e8f\u53f7\u7684\u6570\u7ec4\n    thrd_t threads[THREAD_COUNT];\n    mtx_init(&amp;mutex, mtx_plain);\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        ids[i] = i + 1;\n        thrd_create(&amp;threads[i], run, ids + i); // \u521b\u5efa THREAD_COUNT \u4e2a\u7ebf\u7a0b\n    }\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        thrd_join(threads[i], NULL); // \u8ba9\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\n    }\n\n    printf(\"Counter value is %ld.\\n\", counter);\n    mtx_destroy(&amp;mutex);\n#endif\n    return 0;\n}\n</code></pre> <p>\u8bed\u8a00\u4e2d\uff0c\u4e92\u65a5\u91cf\u53ef\u4ee5\u88ab\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b\uff1a<code>mtx_plain\u3001mtx_recursive \u4e0e mtx_timed</code>\u3002</p> <ul> <li> <p><code>mtx_plain</code></p> <p><code>mtx_plain</code> \u4e3a\u6700\u7b80\u5355\u7c7b\u578b\u7684\u4e92\u65a5\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u57fa\u672c\u7684\u52a0\u9501\u548c\u89e3\u9501\uff0c\u4f46\u4e0d\u80fd\u5c06\u5176\u7528\u5728\u9700\u8981\u201c\u91cd\u590d\u52a0\u9501\u201d\u7684\u573a\u666f\uff08\u6bd4\u5982\u51fd\u6570\u7684\u9012\u5f52\u8c03\u7528\uff09\u4e2d\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u5373\u4f7f\u5f53\u524d\u7ebf\u7a0b\u62e5\u6709\u8be5\u9501\uff0c\u5bf9\u540c\u4e00\u4e2a <code>mtx_plain</code> \u4e92\u65a5\u91cf\u7684\u518d\u6b21\u52a0\u9501\u4e5f\u4f1a\u5bfc\u81f4\u8be5\u7ebf\u7a0b\u88ab\u963b\u585e\u3002\u800c\u6b64\u65f6\uff0c\u4fbf\u4f1a\u4ea7\u751f\u6b7b\u9501\u7684\u95ee\u9898\uff0c\u5373\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u81ea\u5df1\u89e3\u9501\u540e\u624d\u80fd\u591f\u518d\u6b21\u8fdb\u884c\u52a0\u9501\uff0c\u800c\u60f3\u8981\u89e3\u9501\uff0c\u5219\u9700\u8981\u8ba9\u7ebf\u7a0b\u5148\u52a0\u9501\u4ee5\u5b8c\u6210\u5f53\u524d\u529f\u80fd\u7684\u6267\u884c\u3002</p> </li> <li> <p><code>mtx_recursive</code></p> <p>\u76f8\u53cd\uff0c<code>mtx_recursive</code> \u7c7b\u578b\u7684\u4e92\u65a5\u91cf\u4e5f\u88ab\u79f0\u4e3a\u201c\u53ef\u91cd\u5165\u4e92\u65a5\u91cf\uff08Reentrant Mutex\uff09\u201d\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u53ef\u4ee5\u88ab\u7528\u5728\u9700\u8981\u91cd\u590d\u52a0\u9501\u7684\u573a\u666f\u4e2d\u3002\u8be5\u7c7b\u578b\u4e92\u65a5\u91cf\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91cd\u590d\u9501\u5b9a\u591a\u6b21\uff0c\u800c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\u3002\u4f46\u76f8\u5e94\u5730\uff0c\u5bf9\u5b83\u7684\u5b8c\u5168\u89e3\u9501\u4e5f\u9700\u8981\u6267\u884c\u5bf9\u5e94\u591a\u6b21\u7684 <code>mtx_unlock</code>\u3002</p> </li> <li> <p><code>mtx_timed</code></p> <p>\u800c\u6700\u540e\u4e00\u79cd\u662f <code>mtx_timed</code> \u7c7b\u578b\u7684\u4e92\u65a5\u91cf\uff0c\u5b83\u5177\u6709\u7279\u6b8a\u7684\u201c\u8d85\u65f6\u5c5e\u6027\u201d\u3002\u8fd9\u610f\u5473\u7740\uff0c\u901a\u8fc7\u914d\u5408\u4f7f\u7528 <code>mtx_timedlock</code> \u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u201c\u5e26\u8d85\u65f6\u9650\u5236\u7684\u4e92\u65a5\u91cf\u52a0\u9501\u201d\uff0c\u5373\u7ebf\u7a0b\u5728\u5c1d\u8bd5\u7ed9\u5bf9\u5e94\u4e92\u65a5\u91cf\u52a0\u9501\u65f6\uff0c\u53ea\u4f1a\u4ee5\u963b\u585e\u7684\u65b9\u5f0f\u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4\u3002\u82e5\u8d85\u8fc7\u7ed9\u5b9a\u65f6\u95f4\u540e\u4ecd\u672a\u7ed9\u4e92\u65a5\u91cf\u6210\u529f\u4e0a\u9501\uff0c\u5219\u7ebf\u7a0b\u7ee7\u7eed\u6267\u884c\u3002</p> </li> </ul> <p>\u5176\u4ed6\u51fd\u6570\uff1a</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_14","title":"\u539f\u5b50\u64cd\u4f5c","text":"<p>\u539f\u5b50\u662f\u5316\u5b66\u53cd\u5e94\u4e2d\u4e0d\u53ef\u88ab\u7ee7\u7eed\u5206\u5272\u7684\u57fa\u672c\u5fae\u7c92\uff0c\uff08\u5386\u53f2\u9057\u7559\u95ee\u9898\uff09\u987e\u540d\u601d\u4e49\uff0c\u201c\u539f\u5b50\u64cd\u4f5c\u201d\u7684\u610f\u601d\u5c31\u662f\u64cd\u4f5c\u672c\u8eab\u65e0\u6cd5\u518d\u88ab\u5212\u5206\u4e3a\u66f4\u7ec6\u7684\u6b65\u9aa4\u3002</p> <p>\u5728\u591a\u4e2a\u4e0d\u540c\u7ebf\u7a0b\u4e2d\u5bf9\u5171\u4eab\u8d44\u6e90\u8fdb\u884c\u539f\u5b50\u64cd\u4f5c\u65f6\uff0c\u7f16\u8bd1\u5668\u548c CPU \u5c06\u4f1a\u4fdd\u8bc1\u8fd9\u4e9b\u64cd\u4f5c\u7684\u6b63\u786e\u6267\u884c\uff0c\u5373\u540c\u4e00\u65f6\u523b\u53ea\u4f1a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fdb\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002\u800c\u53ea\u6709\u5728\u8be5\u7ebf\u7a0b\u5c06\u6574\u4e2a\u64cd\u4f5c\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u624d\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u540c\u6837\u7684\u64cd\u4f5c\u3002</p> <p>\u540c\u6837\uff0c\u6539\u8fdb\u6570\u636e\u7ade\u4e89\u7684\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n#include &lt;stdatomic.h&gt;\n\n#define THREAD_COUNT 20\n#define THREAD_LOOP 100000000\n\n#if !defined (__STDC_NO_ATOMICS__)\n// \u5173\u952e\u5b57\u7528\u6cd5\n_Atomic long counter = 0;   // \u5b9a\u4e49\u4e00\u4e2a\u539f\u5b50\u7c7b\u578b\u5168\u5c40\u53d8\u91cf\uff0c\u7528\u6765\u8bb0\u5f55\u7ebf\u7a0b\u7684\u7d2f\u52a0\u503c\n// C\u6807\u51c6\u5e93\u63d0\u4f9b\u7684\u5b8f\n// atomic_long counter = 0;\n#endif\n\nint run(void *arg)\n{\n    int i = 0;\n    for(i = 0; i &lt; THREAD_LOOP; i++)\n    {\n        atomic_fetch_add_explicit(&amp;counter, 1, memory_order_relaxed);   // \u4f7f\u7528\u539f\u5b50\u52a0\u6cd5\u64cd\u4f5c\n    }\n    printf(\"Thread %d terminates. \\n\", *((int *) arg));\n    return thrd_success;\n}\n\nint main(void)\n{\n#if !defined (__STDC_NO_THREADS__) || defined(__STDC_NO_ATOMICS__)\n    int ids[THREAD_COUNT];      // \u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u5e8f\u53f7\u7684\u6570\u7ec4\n    thrd_t threads[THREAD_COUNT];\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        ids[i] = i + 1;\n        thrd_create(&amp;threads[i], run, ids + i); // \u521b\u5efa THREAD_COUNT \u4e2a\u7ebf\u7a0b\n    }\n\n    for(i = 0; i &lt; THREAD_COUNT; i++)\n    {\n        thrd_join(threads[i], NULL); // \u8ba9\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\n    }\n\n    printf(\"Counter value is %ld.\\n\", counter);\n#endif\n    return 0;\n}\n</code></pre> <pre><code>#if !defined (__STDC_NO_ATOMICS__)\n...\n#endif\n    // \u5982\u679c\u6ca1\u6709\u5b9a\u4e49\u8fd9\u4e2a\u5b8f\uff0c\u90a3\u8868\u793a\u53ef\u7528\uff0c\u6ce8\u610f\u8fd9\u4e2a\u5b8f\u91cc\u9762\u7684NO\uff08\u53cc\u91cd\u5426\u5b9a\uff09\n</code></pre> <p>\u5173\u4e8e <code>atomic_fetch_add_explicit</code>\uff1a\u539f\u5b50\u7d2f\u52a0\u64cd\u4f5c\uff0c\u4f7f\u5f97\u7ebf\u7a0b\u8fdb\u884c\u6570\u636e\u7d2f\u52a0\u65f6\u72ec\u5360\u6574\u4e2a\u53d8\u91cf\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u901a\u8fc7\u8be5\u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u64cd\u4f5c\u9700\u8981\u6ee1\u8db3\u7684\u5185\u5b58\u987a\u5e8f\u3002</p> <p>\u53e6\u5916\uff0c\u4e0a\u4e00\u8bb2\u4e2d\u7531\u4e8e\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u91c7\u7528\u6307\u4ee4\u91cd\u6392\u6765\u4f18\u5316\u7a0b\u5e8f\u7684\u8fd0\u884c\u6548\u7387\uff0c\u56e0\u6b64\uff0c\u5f53\u5728\u591a\u6838 CPU \u4e0a\u8fd0\u884c\u5b58\u5728\u7ebf\u7a0b\u95f4\u6570\u636e\u4f9d\u8d56\u7684\u591a\u7ebf\u7a0b\u5e94\u7528\u65f6\uff0c\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> <p>\u8fd9\u91cc\uff0c\u901a\u8fc7\u6307\u5b9a\u5404\u4e2a\u539f\u5b50\u64cd\u4f5c\u7684\u5177\u4f53\u5185\u5b58\u987a\u5e8f\uff0c\u6539\u8fdb\u4e0a\u4e00\u8bb2\u7684\u6307\u4ee4\u91cd\u6392\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n#include &lt;stdatomic.h&gt;\n\n#if !defined(__STDC_NO_ATOMICS__)\n    atomic_int x = 0, y = 0;\n#endif\n\n/* \u901a\u8fc7\u6307\u5b9a\u5404\u4e2a\u539f\u5b50\u64cd\u4f5c\u7684\u5177\u4f53\u5185\u5b58\u987a\u5e8f */\nint run(void *arg)\n{\n    atomic_store_explicit(&amp;x, 10, memory_order_relaxed);\n    atomic_store_explicit(&amp;y, 20, memory_order_release);\n}\n\nint observe(void *arg)\n{\n    while(atomic_load_explicit(&amp;y, memory_order_acquire) != 20);\n    printf(\"%d\", atomic_load_explicit(&amp;x, memory_order_relaxed)); \n}\n\nint main(void)\n{\n#if !defined (__STDC_NO_THREADS__)\n    thrd_t threadA, threadB;\n\n    thrd_create(&amp;threadA, run, NULL);\n    thrd_create(&amp;threadB, observe, NULL);\n    thrd_join(threadA, NULL);\n    thrd_join(threadB, NULL);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u4fee\u6539\u4e86\u7ebf\u7a0b run \u548c observe \u4e2d\u5bf9\u539f\u5b50\u7c7b\u578b\u53d8\u91cf x \u548c y \u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <ul> <li> <p>\u51fd\u6570 <code>atomic_load_explicit</code> \u7528\u6765 \u8bfb\u53d6 \u67d0\u4e2a\u539f\u5b50\u7c7b\u578b\u53d8\u91cf\u7684\u503c\uff1b</p> </li> <li> <p>\u51fd\u6570 <code>atomic_store_explicit</code> \u7528\u6765 \u4fee\u6539 \u539f\u5b50\u7c7b\u578b\u7684\u53d8\u91cf\u3002</p> </li> </ul> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd9\u4e24\u4e2a\u51fd\u6570\u90fd\u652f\u6301\u901a\u8fc7\u5b83\u4eec\u7684\u6700\u540e\u4e00\u4e2a\u53c2\u6570\uff0c\u6765\u6307\u5b9a\u76f8\u5e94\u64cd\u4f5c\u9700\u8981\u9075\u5faa\u7684\u5185\u5b58\u987a\u5e8f\u3002\u5728\u8fd9\u6bb5\u4fee\u6539\u540e\u7684\u4ee3\u7801\u4e2d\uff0c\u4e00\u5171\u4f7f\u7528\u5230\u4e86\u4e09\u79cd\u4e0d\u540c\u7684\u5185\u5b58\u987a\u5e8f\uff08\u5bf9\u5e94\u4e09\u4e2a\u679a\u4e3e\u503c\uff09\uff1a</p> <p></p> <ul> <li> <p>\u5bf9\u4e8e run \u7ebf\u7a0b</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u53d8\u91cf x \u7684\u4fee\u6539\u8fc7\u7a0b\u4e00\u5b9a\u5148\u4e8e y\uff0c\u5bf9 y \u5199\u5165\u8981\u6c42 <code>memory_order_release</code>\uff0c \u4e00\u5b9a\u8981\u5b8c\u6210\u4e4b\u524d\u6240\u6709\u7684\u5199\u64cd\u4f5c\u624d\u80fd\u6267\u884c\u8fd9\u6761\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5bf9\u4e8e observe \u7ebf\u7a0b</p> <p>\u4e3a\u4e86\u9632\u6b62\u5904\u7406\u5668\u63d0\u524d\u5c06\u53d8\u91cf x \u7684\u503c\u653e\u5165\u7f13\u5b58\uff0c\u901a\u8fc7 <code>memory_order_acquire</code>\uff0c\u6765\u4fdd\u8bc1\u5bf9\u53d8\u91cf y \u8fdb\u884c\u7684\u8bfb\u64cd\u4f5c\u4e00\u5b9a\u4f1a\u6bd4\u5bf9\u53d8\u91cf x \u7684\u8bfb\u64cd\u4f5c\u5148\u53d1\u751f\u3002</p> <p>\u4e5f\u5c31\u662f\u5728\u6267\u884c<code>atomic_load_explicit(&amp;y, memory_order_acquire)</code>\u4e4b\u540e\uff0c\u5fc5\u987b\u786e\u4fdd\u5728\u6267\u884c<code>atomic_load_explicit(&amp;x, memory_order_relaxed)</code>\u4e4b\u524d\uff0c\u5148\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6700\u65b0\u7684<code>y</code>\u7684\u503c\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u4e4b\u524d\u7684\u7f13\u5b58\u503c\u3002</p> </li> <li> <p></p> </li> <li> <p>\u8865\u5145\uff1a\u5185\u5b58\u987a\u5e8f\u53c2\u6570</p> <p>memory_order - cppreference.com</p> <pre><code>enum memory_order {\n    memory_order_relaxed,\n    memory_order_consume,\n    memory_order_acquire,\n    memory_order_release,\n    memory_order_acq_rel,\n    memory_order_seq_cst\n};\n</code></pre> </li> </ul> <p>\u603b\u7684\u6765\u770b\uff0cC11 \u901a\u8fc7 <code>stdatomic.h</code> \u5934\u6587\u4ef6\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5927\u91cf\u53ef\u7528\u4e8e\u539f\u5b50\u64cd\u4f5c\u7684\u76f8\u5173\u7c7b\u578b\u3001\u5b8f\uff0c\u4ee5\u53ca\u51fd\u6570\u3002</p> <p>\u76f8\u8f83\u4e8e\u4f7f\u7528\u4e92\u65a5\u91cf\uff0c\u539f\u5b50\u64cd\u4f5c\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u52a0\u6e05\u6670\u548c\u65b9\u4fbf\u5730\u62bd\u8c61\u5e76\u884c\u4ee3\u7801\uff0c\u800c\u4e0d\u9700\u8981\u9891\u7e41\u8fdb\u884c\u52a0\u9501\u4e0e\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u3002</p> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c\u4ece\u6267\u884c\u6027\u80fd\u89d2\u5ea6\uff0c\u539f\u5b50\u64cd\u4f5c\u7684\u6267\u884c\u901a\u5e38\u76f4\u63a5\u4f9d\u8d56\u4e8e CPU \u63d0\u4f9b\u7684\u76f8\u5e94\u7684\u539f\u5b50\u673a\u5668\u6307\u4ee4\uff0c\u6bd4\u5982\u5728 x86-64 \u5e73\u53f0\u4e0a\uff0c<code>atomic_fetch_add_explicit</code> \u51fd\u6570\u5bf9\u5e94\u7684 lock add \u6307\u4ee4\u3002</p> <p>\u800c\u4f7f\u7528\u4e92\u65a5\u91cf\u5219\u9700\u8981\u8ba9\u7ebf\u7a0b\u963b\u585e\uff0c\u8fd8\u8981\u9891\u7e41\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\u3002\u56e0\u6b64\u4e0e\u4e4b\u76f8\u6bd4\uff0c\u539f\u5b50\u64cd\u4f5c\u7684\u6027\u80fd\u901a\u5e38\u4f1a\u66f4\u597d\u3002</p> <p>\u603b\u7ed3\u76f8\u5173\u539f\u5b50\u64cd\u4f5c\u7684\u51fd\u6570\uff1a</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_15","title":"\u6761\u4ef6\u53d8\u91cf","text":"<p>\u4f5c\u4e3a\u4e00\u79cd\u5e38\u7528\u7684\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u3002</p> <p>\u7ebf\u7a0b\u540c\u6b65\uff1a\u67d0\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u4f9d\u8d56\u4e8e\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u6570\u636e\u8fdb\u884c\u7684\u5904\u7406\u3002(\u5982\u4e0a\u9762\u7684 <code>observe</code> \u5fd9\u7b49\u5f85 <code>run</code> y \u7684\u503c\u53d8\u4e3a20\uff0c\u624d\u6267\u884c\u540e\u9762\u7684\u503c\uff09</p> <p>\u5fd9\u7b49\u5f85\u662f\u4e00\u79cd\u4e0b\u7b56\uff0c\u592a\u6d6a\u8d39CPU\u8d44\u6e90\u4e86\uff0c\u6709\u4e2a\u66f4\u597d\u7684\u529e\u6cd5\uff0c\u6761\u4ef6\u53d8\u91cf\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n#include &lt;unistd.h&gt;\n\nmtx_t mutex;\ncnd_t cond;     // \u6761\u4ef6\u53d8\u91cf\nint done = 0;\n\nvoid progressBar(int seconds)\n{\n    static int i;\n    for (i = 0; i &lt; seconds; i++) {\n        printf(\"[\");\n        static int j;\n        for (j = 0; j &lt;= i; j++) {\n            printf(\"#\");\n        }\n        for (j = i+1; j &lt; seconds; j++) {\n            printf(\" \");\n        }\n        printf(\"] %d/%d seconds\\r\", i+1, seconds);\n        fflush(stdout);\n        sleep(1);\n    }\n    printf(\"\\n\");\n}\n\nint run(void *arg)\n{\n    mtx_lock(&amp;mutex);\n    printf(\"------------------\\n\");\n    printf(\"Thread run begin:\\n\");\n    progressBar(10);\n    done = 1;\n    printf(\"The thread run ends.\\n\");\n    printf(\"------------------\\n\");\n    cnd_signal(&amp;cond);      //\u901a\u77e5\u7b49\u5f85\u4e2d\u7684\u7ebf\u7a0b\n    mtx_unlock(&amp;mutex);\n\n    return thrd_success;\n}\n\nint main(void)\n{\n#ifndef __STDC_NO_THREADS__\n    mtx_init(&amp;mutex, mtx_plain);\n    cnd_init(&amp;cond);\n    thrd_t thread;\n\n    thrd_create(&amp;thread, run, NULL);\n    mtx_lock(&amp;mutex);\n\n    while(done == 0)\n    {\n        cnd_wait(&amp;cond, &amp;mutex);    // \u8ba9\u5f53\u524d\u7ebf\u7a0b\u8fdb\u5165\u7b49\u5f85\u961f\u5217\n    }\n\n    mtx_unlock(&amp;mutex);\n    printf(\"The value of done is %d.\\n\", done);\n\n    mtx_destroy(&amp;mutex);\n    cnd_destroy(&amp;cond);\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u521a\u521a\u4f7f\u7528\u81ea\u5df1\u5728\u91cc\u9762\u5199\u7684\u4e00\u4e2asleep\u5b9e\u73b0\u4ee5\u53ca\u4f7f\u7528\u4e86\u7ebf\u7a0b\u521b\u5efa\u4f7f\u7528\u7684void *\u53c2\u6570\u4e3a\u4ec0\u4e48\u62a5`segmentation fault\uff1f\u5e94\u8be5\u65f6\u521b\u5efa\u51fd\u6570\u7684\u53c2\u6570\u4f20\u5165\u9519\u8bef\uff0c\u5e94\u8be5\u76f4\u63a5\u7528\u4e00\u4e2a\u53d8\u91cf\u7684\u3002</p> <p>\u4e3a\u4ec0\u4e48while\u90a3\u91cc\u4e0d\u7528if\uff1f</p> <p>\u5728\u5e76\u53d1\u7f16\u7a0b\u4e2d\uff0c\u6761\u4ef6\u53d8\u91cf\u662f\u4e00\u4e2a\u5341\u5206\u5f3a\u5927\u7684\u6b66\u5668\u3002\u901a\u8fc7\u5b83\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5b9e\u73b0\u76d1\u89c6\u5668\uff08Monitor\uff09\u3001\u7ba1\u7a0b\u7b49\u5de5\u5177\u548c\u540c\u6b65\u539f\u8bed\u3002\u800c\u4e14\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u7ecf\u5178\u7684\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u95ee\u9898\u3002</p> <p>\u5982\u679c\u4f60\u5bf9\u8fd9\u90e8\u5206\u5185\u5bb9\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u53c2\u8003\u300aC++ Concurrency in Action\u300b\u548c\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\u7b49\u4e66\uff0c\u6765\u8fdb\u884c\u66f4\u52a0\u6df1\u5165\u7684\u5b66\u4e60\u3002\u867d\u7136\u5b83\u4eec\u5e76\u4e0d\u4f1a\u4e13\u95e8\u4ecb\u7ecd\u57fa\u4e8e C \u8bed\u8a00\u7684\u5e76\u53d1\u7f16\u7a0b\uff0c\u4f46\u5176\u4e2d\u7684\u5f88\u591a\u6982\u5ff5\uff0c\u751a\u81f3 C++ \u63a5\u53e3\uff0c\u4e0e C \u8bed\u8a00\u90fd\u662f\u7c7b\u4f3c\u548c\u76f8\u901a\u7684\u3002</p> <ul> <li> <p>\u76f8\u5173\u51fd\u6570</p> <p></p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_16","title":"\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf","text":"<p>\u9664\u4e86\u53ef\u4ee5\u5171\u4eab\u5b58\u5728\u4e8e\u8fdb\u7a0b\u5185\u7684\u5168\u5c40\u53d8\u91cf\u5916\uff0c\u7ebf\u7a0b\u8fd8\u53ef\u4ee5\u62e5\u6709\u5c5e\u4e8e\u5b83\u81ea\u5df1\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\uff08TLS\uff09\u3002</p> <p>\u987e\u540d\u601d\u4e49\uff0c\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u503c\u4ec5\u80fd\u591f\u5728\u67d0\u4e2a\u5177\u4f53\u7ebf\u7a0b\u7684\u751f\u5b58\u671f\u5185\u53ef\u7528\u3002\u53d8\u91cf\u7684\u5b9e\u9645\u5b58\u50a8\u7a7a\u95f4\u4f1a\u5728\u7ebf\u7a0b\u5f00\u59cb\u65f6\u5206\u914d\uff0c\u7ebf\u7a0b\u7ed3\u675f\u65f6\u56de\u6536\u3002\u7ebf\u7a0b\u4e0d\u4f1a\u5bf9\u8fd9\u4e9b\u53d8\u91cf\u7684\u8bfb\u5199\u64cd\u4f5c\u4ea7\u751f\u6570\u636e\u7ade\u4e89\u3002\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n#include &lt;stdatomic.h&gt;\n\n#define THREAD_COUNT 10\n#define THREAD_LOOP 10000\n\n_Thread_local int counter = 0;      // \u5b9a\u4e49\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\n\nint run(void *arg)\n{\n    int i = 0;\n\n    for(i = 0; i &lt; THREAD_LOOP; ++i)\n    {\n        counter += 1;   // \u66f4\u65b0\u5f53\u524d\u7ebf\u7a0b\u6240\u5c5e\u7684 counter \u53d8\u91cf\u503c\n    }\n    return counter;\n}\n\nint main(int argc, char *argv[])\n{\n    thrd_t threads[THREAD_COUNT];\n    int sum = 0, result = 0;\n    int i = 0;\n\n    for (i = 0; i &lt; THREAD_COUNT; ++i)\n    {\n        thrd_create(&amp;threads[i], run, NULL);\n    }\n\n    for (i = 0; i &lt; THREAD_COUNT; ++i)\n    {\n        thrd_join(threads[i], &amp;result);\n        sum += result;\n    }\n\n    printf(\"The value of count is %d.\\n\", sum);\n\n    return 0;\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528 _Thread_local \u5173\u952e\u5b57\uff08\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b8f thread_local\uff09\uff0c\u5c06\u5168\u5c40\u53d8\u91cf counter \u6807\u8bb0\u4e3a\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u3002\u8fd9\u610f\u5473\u7740\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u5728\u521b\u5efa\u65f6\u751f\u6210\u4ec5\u5c5e\u4e8e\u5f53\u524d\u7ebf\u7a0b\u7684\u53d8\u91cf counter\u3002\u56e0\u6b64\uff0c\u5f53\u672c\u7ebf\u7a0b\u5728\u5bf9 counter \u53d8\u91cf\u8fdb\u884c\u7d2f\u52a0\u65f6\uff0c\u4fbf\u4e0d\u4f1a\u53d7\u5230\u5176\u4ed6\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u800c\u5f53\u7ebf\u7a0b\u9000\u51fa\u65f6\uff0c\u901a\u8fc7\u4ee3\u7801\u7684 thrd_join\uff0c\u6211\u4eec\u5f97\u4ee5\u5728 main \u7ebf\u7a0b\u4e2d\u5c06\u6bcf\u4e2a\u7ed3\u675f\u7ebf\u7a0b\u8fd4\u56de\u7684\uff0c\u5404\u81ea\u7684 counter \u503c\u518d\u8fdb\u884c\u7edf\u4e00\u7d2f\u52a0\uff0c\u4ece\u800c\u5f97\u5230\u6700\u540e\u7684\u8ba1\u7b97\u7ed3\u679c\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u56fe\u6765\u76f4\u89c2\u5730\u7406\u89e3\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p></p> <p>\u5185\u90e8\u539f\u7406\uff1a</p> <ol> <li>\u5f53\u4f7f\u7528 <code>_Thread_local</code> \u5173\u952e\u5b57\u58f0\u660e\u4e00\u4e2a\u53d8\u91cf\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u7684\u526f\u672c\u3002\u8fd9\u4e2a\u526f\u672c\u53ea\u80fd\u88ab\u5f53\u524d\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5230\u8fd9\u4e2a\u526f\u672c\u3002</li> <li>\u5f53\u7ebf\u7a0b\u521b\u5efa\u65f6\uff0c\u4f1a\u4e3a\u8be5\u7ebf\u7a0b\u5206\u914d\u4e00\u4e2a\u72ec\u7acb\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u7528\u4e8e\u5b58\u50a8\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u526f\u672c\u3002\u8fd9\u6837\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u4efd\u72ec\u7acb\u7684\u53d8\u91cf\u526f\u672c\u3002</li> <li>\u5f53\u7ebf\u7a0b\u8bbf\u95ee\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u8bbf\u95ee\u8be5\u7ebf\u7a0b\u81ea\u5df1\u7684\u53d8\u91cf\u526f\u672c\uff0c\u800c\u4e0d\u662f\u5168\u5c40\u53d8\u91cf\u7684\u5b9e\u9645\u503c\u3002\u56e0\u6b64\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u5bf9\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u7684\u540c\u540d\u53d8\u91cf\u3002</li> </ol> <p>\u5728\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\uff08\u5982\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 <code>counter</code> \u53d8\u91cf\uff09\u901a\u5e38\u4f1a\u5b58\u50a8\u5728\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u63a7\u5236\u5757\uff08Thread Control Block, TCB\uff09\u4e2d\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5b58\u50a8\u5728\u5bc4\u5b58\u5668\u6216\u6808\u4e2d\u3002\u7ebf\u7a0b\u63a7\u5236\u5757\u662f\u64cd\u4f5c\u7cfb\u7edf\u7ef4\u62a4\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u5b58\u50a8\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u72b6\u6001\u3001\u5bc4\u5b58\u5668\u72b6\u6001\u3001\u6808\u6307\u9488\u7b49\u4fe1\u606f\u3002</p> <p>\u5f53\u7ebf\u7a0b\u88ab\u521b\u5efa\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u8be5\u7ebf\u7a0b\u5206\u914d\u7ebf\u7a0b\u63a7\u5236\u5757\uff0c\u5e76\u5728\u5176\u4e2d\u5206\u914d\u5b58\u50a8\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u7a7a\u95f4\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u90fd\u4f1a\u88ab\u5b58\u50a8\u5728\u81ea\u5df1\u7684\u7ebf\u7a0b\u63a7\u5236\u5757\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u6bcf\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u7684\u53d8\u91cf\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u4f1a\u53d7\u5230\u5176\u4ed6\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002</p> <p>\u5f53\u7ebf\u7a0b\u6267\u884c\u65f6\uff0c\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u63a7\u5236\u5757\u4f1a\u88ab\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u4ee5\u4fbf\u5904\u7406\u5668\u80fd\u591f\u8bbf\u95ee\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u503c\u4e5f\u4f1a\u4ece\u7ebf\u7a0b\u63a7\u5236\u5757\u4e2d\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u6216\u8005\u7f13\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u7ebf\u7a0b\u53ef\u4ee5\u5feb\u901f\u8bbf\u95ee\u81ea\u5df1\u7684\u53d8\u91cf\u526f\u672c\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u901a\u5e38\u5b58\u50a8\u5728\u7ebf\u7a0b\u63a7\u5236\u5757\u4e2d\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5b58\u50a8\u5728\u5bc4\u5b58\u5668\u6216\u6808\u4e2d\u3002\u5904\u7406\u5668\u4f1a\u6839\u636e\u9700\u8981\u5c06\u7ebf\u7a0b\u63a7\u5236\u5757\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u5e76\u8bbf\u95ee\u5176\u4e2d\u5b58\u50a8\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u53d8\u91cf\u526f\u672c\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u9694\u79bb\u3002</p> <p>\u6700\u7ec8\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5c06\u5404\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u63a7\u5236\u5757\uff08TCB\uff09\u4e2d\u5b58\u50a8\u7684 <code>counter</code> \u6570\u636e\u8fdb\u884c\u7d2f\u52a0\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u5f53\u4e3b\u7ebf\u7a0b\u8c03\u7528 <code>thrd_join</code> \u51fd\u6570\u7b49\u5f85\u6bcf\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f\u83b7\u53d6\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u8fd4\u56de\u503c\uff0c\u4e5f\u5c31\u662f\u5404\u4e2a\u7ebf\u7a0b\u7684 <code>counter</code> \u503c\u3002\u7136\u540e\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5c06\u8fd9\u4e9b <code>counter</code> \u503c\u8fdb\u884c\u7d2f\u52a0\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u53e6\u4e00\u79cd\u53ef\u4ee5\u907f\u514d\u6570\u636e\u7ade\u4e89\u7684\u65b9\u5f0f\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5b83\u4e5f\u53ef\u4ee5\u88ab\u7528\u6765\u5b58\u50a8\u7ebf\u7a0b\u72ec\u6709\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982 errno \u7684\u503c\u3002</p> <p>\u6211\u4eec\u5728\u4e0a\u9762\u4ee3\u7801\u4e2d\u4f7f\u7528\u7684\u662f\u4ee5\u5173\u952e\u5b57\u6765\u5b9a\u4e49\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u7684\u65b9\u5f0f\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u6807\u51c6\u5e93\u8fd8\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u5b9e\u73b0\u540c\u6837\u7684\u76ee\u7684\u3002\u4f46\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u901a\u8fc7 <code>tss_create</code> \u7b49\u51fd\u6570\u6765\u521b\u5efa\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4e3a\u5176\u6307\u5b9a\u5bf9\u5e94\u7684\u6790\u6784\u51fd\u6570\u3002\u8fd9\u6837\uff0c\u5f53\u7ebf\u7a0b\u9000\u51fa\u65f6\uff0c\u4fbf\u53ef\u4ee5\u786e\u4fdd\u76f8\u5e94\u7684\u7ebf\u7a0b\u672c\u5730\u8d44\u6e90\uff08\u6bd4\u5982\u5806\u5185\u5b58\uff09\u80fd\u591f\u4ee5\u6b63\u786e\u7684\u65b9\u5f0f\u88ab\u6e05\u7406\u3002\u76f8\u5173\u51fd\u6570\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_17","title":"\u603b\u7ed3","text":"<ul> <li> <p>\u4e92\u65a5\u91cf</p> <p>\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u9501\uff0c\u901a\u8fc7\u52a0\u9501\u89e3\u9501\u7684\u65b9\u5f0f\u6765\u9650\u5236\u591a\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\uff0c\u8ba9\u4ed6\u4eec\u80fd\u591f\u6709\u5e8f\u5730\u4f7f\u7528\u5171\u4eab\u8d44\u6e90\u3002</p> <p>C \u8bed\u8a00\u9501\u7684\u7c7b\u578b\uff1a</p> <ol> <li><code>mtx_plain</code>\uff1a\u57fa\u672c\u7c7b\u578b</li> <li><code>mtx_recursive</code>\uff1a\u7528\u5728\u9700\u8981\u91cd\u590d\u52a0\u9501\u7684\u573a\u666f\u4e2d</li> <li><code>mtx_timed</code>\uff1a\u4e92\u65a5\u91cf\u5177\u6709\u8d85\u65f6\u5c5e\u6027\u3002\u4e0e mtx_timedlock \u7ed3\u5408\u4f7f\u7528\uff0c\u8ba9\u7ebf\u7a0b\u5728\u7ed9\u4e92\u65a5\u91cf\u52a0\u9501\u65f6\uff0c\u53ea\u5c1d\u8bd5\u6709\u9650\u7684\u4e00\u6bb5\u65f6\u95f4\u3002</li> </ol> </li> <li> <p>\u539f\u5b50\u64cd\u4f5c\u53ca\u5176\u5185\u5b58\u987a\u5e8f</p> <p>\u4e0d\u53ef\u5206\u5272\u5730\u4e00\u6b21\u6027\u5b8c\u6210\u6574\u4e2a\u64cd\u4f5c</p> <p>\u6307\u5b9a\u539f\u5b50\u64cd\u4f5c\u9700\u8981\u6ee1\u8db3\u7684\u5185\u5b58\u987a\u5e8f\uff0c\u7528\u6765\u63a7\u5236\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u5728\u5bf9\u539f\u5b50\u64cd\u4f5c\u8fdb\u884c\u4f18\u5316\u65f6\u7684\u884c\u4e3a\uff0c\u4ee5\u786e\u4fdd\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u3002</p> <p>\u539f\u5b50\u64cd\u4f5c\u7684\u5b9e\u73b0\u901a\u5e38\u4f9d\u8d56\u4e8e\u6240\u5728\u5e73\u53f0\u7684\u7279\u6b8a\u673a\u5668\u6307\u4ee4\uff0c\u800c C \u6807\u51c6\u5e93\u5219\u901a\u8fc7\u76f4\u63a5\u63d0\u4f9b\u5e38\u7528\u540c\u6b65\u539f\u8bed\u7684\u65b9\u5f0f\uff0c\u5e2e\u6211\u4eec\u5c4f\u853d\u4e86\u8fd9\u4e9b\u7ec6\u8282\u3002</p> </li> <li> <p>\u6761\u4ef6\u53d8\u91cf</p> <p>\u63d0\u4f9b\u4e86\u7ebf\u7a0b\u95f4\u901a\u77e5\u7684\u80fd\u529b\uff0c\u67d0\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u67d0\u4ef6\u4e8b\u60c5\u540e\uff0c\u901a\u77e5\u522b\u7684\u7ebf\u7a0b\u7ee7\u7eed\u505a\u522b\u7684\u3002\u4ece\u800c\u8ba9\u5177\u6709\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u7684\u7ebf\u7a0b\u4ee5\u4e00\u79cd\u66f4\u52a0\u9ad8\u6548\u7684\u65b9\u5f0f\u8fdb\u884c\u540c\u6b65\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6761\u4ef6\u53d8\u91cf\u8fd8\u53ef\u88ab\u7528\u4e8e\u5b9e\u73b0==\u76d1\u89c6\u5668\u3001\u7ba1\u7a0b\u7b49\u66f4\u591a\u590d\u6742\u7684\u540c\u6b65\u673a\u5236\u3002==</p> </li> <li> <p>\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf</p> <p><code>_Thread_loacl</code>\u3002\u4e3a\u5168\u5c40\u53d8\u91cf\u6dfb\u52a0 <code>_Thread_local</code> \u5173\u952e\u5b57\u3002\u8fd9\u6837\u4ec5\u5728\u7ebf\u7a0b\u521b\u5efa\u65f6\uff0c\u624d\u751f\u6210\u4ec5\u5c5e\u4e8e\u5f53\u524d\u7ebf\u7a0b\u7684\u672c\u5730\u540c\u540d\u53d8\u91cf\u3002 \u56e0\u6b64\uff0c\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u7684\u4fee\u6539\u4fbf\u4e0d\u4f1a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u5f71\u54cd\u3002</p> <p>\u89e3\u51b3\u6570\u636e\u7ade\u4e89\uff0c\u548c\u9501\u7c7b\u4f3c\u3002\u4f46\u66f4\u7b80\u6d01\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_18","title":"\u601d\u8003\u9898\u3010\u91cd\u8981\u3011\u3010\u591a\u3011","text":"<ul> <li> <p>\u539f\u5b50\u64cd\u4f5c\u662f\u591a\u6838\u624d\u6709\u7684\u5417\uff1f\u5355\u6838\u6709\u5417\uff1f\u6216\u8005\u8bf4\u5355\u6838\u5904\u7406\u5668\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u5e76\u53d1\u7684\u60c5\u51b5\uff1f</p> <p>\u5355\u6838\u5355\u7ebf\u7a0b\u4e2d\u4e3a\u4ec0\u4e48\u4f1a\u6709\u5e76\u53d1\u5462\uff1f\u53ea\u6709\u4e00\u79cd\u60c5\u51b5\uff1a\u4e2d\u65ad\u5417\uff1f</p> <p>\u539f\u5b50\u64cd\u4f5c\u5e76\u4e0d\u4ec5\u4ec5\u662f\u591a\u6838\u5904\u7406\u5668\u4e2d\u624d\u5b58\u5728\u7684\u6982\u5ff5\uff0c\u5b83\u5728\u5355\u6838\u5904\u7406\u5668\u4e2d\u540c\u6837\u5f88\u91cd\u8981\u3002</p> <p>\u539f\u5b50\u64cd\u4f5c\u662f\u6307\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u4e2d\u65ad\u6216\u8005\u5e72\u6270\u7684\u64cd\u4f5c\uff0c\u8981\u4e48\u5b8c\u5168\u6267\u884c\u6210\u529f\uff0c\u8981\u4e48\u5b8c\u5168\u4e0d\u6267\u884c\uff0c\u4e0d\u4f1a\u51fa\u73b0\u90e8\u5206\u6267\u884c\u7684\u60c5\u51b5\u3002</p> <p>\u5728\u5355\u6838\u5904\u7406\u5668\u4e2d\uff0c\u539f\u5b50\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7\u5173\u95ed\u4e2d\u65ad\u6765\u5b9e\u73b0\u3002\u5173\u95ed\u4e2d\u65ad\u53ef\u4ee5\u786e\u4fdd\u5728\u6267\u884c\u5173\u952e\u4ee3\u7801\u6bb5\u65f6\u4e0d\u4f1a\u88ab\u4e2d\u65ad\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u8fd9\u6bb5\u4ee3\u7801\u7684\u539f\u5b50\u6027\u3002\uff08\u963b\u6b62\u5e76\u53d1\uff09\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5373\u4f7f\u662f\u5355\u6838\u5904\u7406\u5668\uff0c\u4e5f\u9700\u8981\u8003\u8651\u5e76\u53d1\u64cd\u4f5c\u548c\u539f\u5b50\u6027\uff0c\u4ee5\u907f\u514d\u51fa\u73b0\u7ade\u6001\u6761\u4ef6\u548c\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002</p> <p>\u5728\u591a\u6838\u5904\u7406\u5668\u4e2d\uff0c\u539f\u5b50\u64cd\u4f5c\u66f4\u52a0\u590d\u6742\uff0c\u56e0\u4e3a\u591a\u4e2a\u6838\u5fc3\u4e4b\u95f4\u53ef\u80fd\u540c\u65f6\u8bbf\u95ee\u548c\u4fee\u6539\u5171\u4eab\u6570\u636e\u3002\u56e0\u6b64\uff0c\u591a\u6838\u5904\u7406\u5668\u4e2d\u7684\u539f\u5b50\u64cd\u4f5c\u901a\u5e38\u9700\u8981\u4f7f\u7528\u786c\u4ef6\u652f\u6301\u6216\u8005\u7279\u6b8a\u7684\u540c\u6b65\u673a\u5236\u6765\u786e\u4fdd\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u548c\u6b63\u786e\u6027\u3002</p> </li> <li> <p>\u5185\u5b58\u987a\u5e8f\u3001\u5185\u5b58\u5c4f\u969c\u662f\u4ec0\u4e48\uff1f</p> <p>\u4ee5\u539f\u5b50\u64cd\u4f5c\u6307\u5b9a\u5185\u5b58\u987a\u5e8f\u89e3\u51b3\u6307\u4ee4\u91cd\u6392\u7684\u4ee3\u7801\u4e3a\u4f8b</p> <pre><code>/* \u901a\u8fc7\u6307\u5b9a\u5404\u4e2a\u539f\u5b50\u64cd\u4f5c\u7684\u5177\u4f53\u5185\u5b58\u987a\u5e8f */\nint run(void *arg)\n{\n    atomic_store_explicit(&amp;x, 10, memory_order_relaxed);\n    atomic_store_explicit(&amp;y, 20, memory_order_release);\n}\n\nint observe(void *arg)\n{\n    while(atomic_load_explicit(&amp;y, memory_order_acquire) != 20);\n    printf(\"%d\", atomic_load_explicit(&amp;x, memory_order_relaxed)); \n}\n</code></pre> <p>\u5904\u7406\u5668\u5728\u6267\u884c\u539f\u5b50\u64cd\u4f5c\u65f6\uff0c\u4f1a\u6839\u636e\u6307\u5b9a\u7684\u5185\u5b58\u987a\u5e8f\u6765\u751f\u6210\u76f8\u5e94\u7684\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\uff0c\u4ee5\u786e\u4fdd\u5185\u5b58\u64cd\u4f5c\u7684\u987a\u5e8f\u7b26\u5408\u9884\u671f\u3002</p> <p>\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\u4f1a\u544a\u8bc9\u5904\u7406\u5668\u5728\u4f55\u65f6\u9700\u8981\u5237\u65b0\u7f13\u5b58\u3001\u4f55\u65f6\u9700\u8981\u7b49\u5f85\u5176\u4ed6\u5904\u7406\u5668\u7684\u64cd\u4f5c\u5b8c\u6210\u7b49\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c<code>memory_order_acquire</code>\u4f1a\u751f\u6210\u4e00\u4e2a\u8bfb\u53d6\u5c4f\u969c\uff0c\u786e\u4fdd\u5728\u8be5\u5c4f\u969c\u4e4b\u524d\u7684\u8bfb\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91cd\u6392\u5e8f\u5230\u8be5\u5c4f\u969c\u4e4b\u540e\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u89c2\u5bdf\u7ebf\u7a0b\u5728\u8bfb\u53d6<code>y</code>\u540e\uff0c\u4e0d\u4f1a\u63d0\u524d\u8bfb\u53d6\u7f13\u5b58\u4e2d\u7684\u65e7\u503c\uff0c\u800c\u662f\u7b49\u5f85\u5199\u5165<code>y</code>\u7684\u64cd\u4f5c\u5b8c\u6210\u3002</p> <p>\u6216\u8bb8\u6709\u4e9b\u96be\u4ee5\u60f3\u8c61\u8fd9\u4e2a\u6267\u884c\u987a\u5e8f\u9020\u6210\u7684\u5f71\u54cd\uff0c\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff1a</p> <ol> <li>\u67d0\u4e9bCPU\u7684\u7279\u5b9a\u529f\u80fd\u5bc4\u5b58\u5668\u5c31\u6709\u660e\u786e\u7684\u8bbe\u7f6e\u987a\u5e8f\u3002</li> <li>\u624b\u52a8\u6321\u7684\u8f66\uff0c\u8981\u5148\u8e29\u79bb\u5408\uff0c\u518d\u6362\u6321\uff0c\u4e0d\u7136\u53ef\u80fd\u635f\u574f\u53d8\u901f\u7bb1\u3002</li> </ol> <p>\u8001\u7b28\u4e00\u5206\u949f\u7ed9\u4f60\u8bb2\u900f\u5185\u5b58\u5c4f\u969c_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u7406\u89e3\u4e86\u5185\u5b58\u4e71\u5e8f/\u4e71\u5e8f\u6267\u884c/\u6307\u4ee4\u91cd\u6392\uff0c\u4e5f\u5c31\u7406\u89e3\u4e86\u4e3a\u4ec0\u4e48\u4f1a\u6709\u5185\u5b58\u5c4f\u969c\u3002</p> <p></p> <p></p> <p>\u5173\u952e\uff1a\u5728\u4fdd\u8bc1\u7a0b\u5e8f\u5458\u5199\u7684\u4ee3\u7801\u7b26\u5408\u9884\u671f\u6267\u884c\u987a\u5e8f\u7684\u524d\u63d0\u4e0b\uff0c\u5904\u7406\u5668\u5185\u90e8\u6267\u884c\u7684\u6bcf\u4e00\u6761 <code>load</code>\u3001<code>store</code> \u7b49\u6307\u4ee4\u4e0d\u4e00\u5b9a\u548c\u7a0b\u5e8f\u5458\u5199\u7684\u4ee3\u7801\u4e00\u4e00\u5bf9\u5e94\u3002</p> <p>\u5982\u4e0a\u56fe\uff0c\u8bbf\u5b58\u5b50\u7cfb\u7edf\u652f\u6301\u5185\u5b58\u4e71\u5e8f\uff0c\u6700\u7ec8\u6548\u679c\u4e00\u6837\uff0c\u4f46\u662f\u6548\u679c\u66f4\u597d\u3002</p> <p></p> <p>\u7ecf\u5178\u591a\u6838\u5e76\u53d1\u7684\u95ee\u9898(\u5982\u6700\u5f00\u59cb\u4f8b\u5b50)\uff0c\u4ea7\u751f\u7ade\u4e89\u8bbf\u95ee\u7684\u95ee\u9898\uff0c\u4e3a\u4e86\u89e3\u51b3\u9519\u8bef\u7684\u6307\u4ee4\u4e71\u5e8f\u5e26\u6765\u7684\u540e\u679c\uff0c\u5fae\u67b6\u6784\u7ed9\u7a0b\u5e8f\u5458\u7559\u4e86\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u5c31\u662f\u5185\u5b58\u5c4f\u969c\u3002</p> <p>..... \uff08\u4e0b\u9762\u95ee\u9898\u518d\u5f00\u4e00\u4e2apart\uff09</p> <p>\uff08\u5f88\u591a\u5751\uff1aCPU\u773c\u91cc\u7684\uff1a\u5185\u5b58\u5c4f\u969c | memory barrier | \u4e71\u5e8f\u6267\u884c_\u54d4\u54e9\u54d4\u54e9_bilibili\uff09</p> <p>\u6bd4\u5982\u51fa\u73b0\u95ee\u9898\uff0c\u5355\u6838\u4e2d\u6307\u4ee4\u91cd\u6392\u4e5f\u4f1a\u51fa\u73b0\u5417\uff1f\u90a3\u6709\u6ca1\u6709\u53ef\u80fd\u662f\u7f13\u5b58\u7684\u95ee\u9898\uff1f</p> <p>\u7f16\u8bd1\u5668\u7684\u6307\u4ee4\u4f18\u5316\u91cd\u6392\u6216\u8005\u53d6\u6d88\u548c\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\uff0c\u8fd9\u4e24\u4e2a\u4e1c\u897f\uff0c\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <p>\u6700\u540e\uff0c\u518d\u56de\u5230\u521a\u5f00\u59cb\uff0c\u5f15\u51fa\u8fd9\u4e2a\u5185\u5b58\u5c4f\u969c\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u4e00\u4e0b\u6307\u4ee4\u91cd\u6392\u5e26\u6765\u7684\u540e\u679c\uff0c\u7ea6\u675f\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\uff0c\u786e\u4fdd\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u548c\u4e00\u81f4\u6027\u3002</p> </li> <li> <p>x86-64 \u6307\u4ee4\u96c6\u4e2d\u7684 mfence\u3001lfence \u4e0e sfence \u6307\u4ee4\uff0c\u5b83\u4eec\u5177\u4f53\u6709\u4ec0\u4e48\u4f5c\u7528\u5462\uff1f\uff08\u8fd9\u4e2a\u95ee\u9898\uff0c\u8df3\u56de\u53bb\uff0c\u4ec0\u4e48\u662f\u5185\u5b58\u5c4f\u969c\uff1f\u4ece\u5185\u5b58\u987a\u5e8f\u90a3\u91cc\u5f00\u59cb\uff09</p> <p>\u5728x86-64\u6307\u4ee4\u96c6\u4e2d\uff0cmfence\u3001lfence\u548csfence\u662f\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\uff0c\u7528\u4e8e\u63a7\u5236\u5185\u5b58\u8bbf\u95ee\u7684\u987a\u5e8f\u548c\u53ef\u89c1\u6027\u3002<code>\u53c8\u662f\u5185\u5b58\u5c4f\u969c\uff1f</code></p> <ol> <li> <p>mfence\uff08Memory Fence\uff09\u6307\u4ee4\uff1a\u786e\u4fdd\u5728mfence\u6307\u4ee4\u4e4b\u524d\u7684\u6240\u6709\u5185\u5b58\u8bbf\u95ee\u64cd\u4f5c\u90fd\u5728mfence\u6307\u4ee4\u4e4b\u524d\u5b8c\u6210\uff0c\u4e14\u5728mfence\u6307\u4ee4\u4e4b\u540e\u7684\u5185\u5b58\u8bbf\u95ee\u64cd\u4f5c\u90fd\u5728mfence\u6307\u4ee4\u4e4b\u540e\u6267\u884c\u3002mfence\u6307\u4ee4\u4f1a\u5f3a\u5236CPU\u5c06\u6240\u6709\u5b58\u50a8\u5668\u548c\u52a0\u8f7d\u64cd\u4f5c\u6309\u7167\u7a0b\u5e8f\u7684\u987a\u5e8f\u6267\u884c\uff0c\u9632\u6b62\u4e71\u5e8f\u6267\u884c\u5e26\u6765\u7684\u95ee\u9898\u3002</p> </li> <li> <p>lfence\uff08Load Fence\uff09\u6307\u4ee4\uff1a\u786e\u4fdd\u5728lfence\u6307\u4ee4\u4e4b\u524d\u7684\u6240\u6709\u52a0\u8f7d\u64cd\u4f5c\u90fd\u5728lfence\u6307\u4ee4\u4e4b\u524d\u5b8c\u6210\uff0c\u4e14\u5728lfence\u6307\u4ee4\u4e4b\u540e\u7684\u52a0\u8f7d\u64cd\u4f5c\u90fd\u5728lfence\u6307\u4ee4\u4e4b\u540e\u6267\u884c\u3002lfence\u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u786e\u4fdd\u52a0\u8f7d\u64cd\u4f5c\u7684\u987a\u5e8f\u6027\uff0c\u9632\u6b62\u52a0\u8f7d\u64cd\u4f5c\u4e71\u5e8f\u6267\u884c\u3002</p> </li> <li> <p>sfence\uff08Store Fence\uff09\u6307\u4ee4\uff1a\u786e\u4fdd\u5728sfence\u6307\u4ee4\u4e4b\u524d\u7684\u6240\u6709\u5b58\u50a8\u5668\u64cd\u4f5c\u90fd\u5728sfence\u6307\u4ee4\u4e4b\u524d\u5b8c\u6210\uff0c\u4e14\u5728sfence\u6307\u4ee4\u4e4b\u540e\u7684\u5b58\u50a8\u5668\u64cd\u4f5c\u90fd\u5728sfence\u6307\u4ee4\u4e4b\u540e\u6267\u884c\u3002sfence\u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u786e\u4fdd\u5b58\u50a8\u64cd\u4f5c\u7684\u987a\u5e8f\u6027\uff0c\u9632\u6b62\u5b58\u50a8\u64cd\u4f5c\u4e71\u5e8f\u6267\u884c\u3002</p> </li> </ol> <p>\u8fd9\u4e9b\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\u5728\u591a\u7ebf\u7a0b\u7f16\u7a0b\u548c\u5e76\u53d1\u7f16\u7a0b\u4e2d\u975e\u5e38\u91cd\u8981\uff0c\u53ef\u4ee5\u5e2e\u52a9\u7a0b\u5e8f\u5458\u63a7\u5236\u5185\u5b58\u8bbf\u95ee\u7684\u987a\u5e8f\u548c\u53ef\u89c1\u6027\uff0c\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6b63\u786e\u6027\u3002\u901a\u8fc7\u5408\u7406\u5730\u4f7f\u7528mfence\u3001lfence\u548csfence\u6307\u4ee4\uff0c\u53ef\u4ee5\u907f\u514d\u7531\u4e8e\u5185\u5b58\u4e71\u5e8f\u6267\u884c\u800c\u5f15\u8d77\u7684\u95ee\u9898\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002</p> </li> <li> <p>\u6709\u6ca1\u6709\u8003\u8651\u8fc7\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e0b\u4e0a\u9762\u6240\u8bf4\u7684\u540c\u6b65\u539f\u8bed\u6216\u8005\u5f00\u5173\u4e2d\u65ad\uff1f</p> <p>\u53ef\u4ee5\u7684\u3002\u300a\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u621845\u8bb2\u300b\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e0b\uff1a</p> <ol> <li> <p>\u539f\u5b50\u64cd\u4f5c</p> <pre><code>//\u5b9a\u4e49\u4e00\u4e2a\u539f\u5b50\u7c7b\u578b\ntypedef struct s_ATOMIC{\n    volatile s32_t a_count; //\u5728\u53d8\u91cf\u524d\u52a0\u4e0avolatile\uff0c\u662f\u4e3a\u4e86\u7981\u6b62\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u4f7f\u5176\u6bcf\u6b21\u90fd\u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u53d8\u91cf\n}atomic_t;\n//\u539f\u5b50\u8bfb\nstatic inline s32_t atomic_read(const atomic_t *v)\n{        \n        //x86\u5e73\u53f0\u53d6\u5730\u5740\u5904\u662f\u539f\u5b50\n        return (*(volatile u32_t*)&amp;(v)-&gt;a_count);\n}\n//\u539f\u5b50\u5199\nstatic inline void atomic_write(atomic_t *v, int i)\n{\n        //x86\u5e73\u53f0\u628a\u4e00\u4e2a\u503c\u5199\u5165\u4e00\u4e2a\u5730\u5740\u5904\u4e5f\u662f\u539f\u5b50\u7684 \n        v-&gt;a_count = i;\n}\n//\u539f\u5b50\u52a0\u4e0a\u4e00\u4e2a\u6574\u6570\nstatic inline void atomic_add(int i, atomic_t *v)\n{\n        __asm__ __volatile__(\"lock;\" \"addl %1,%0\"\n                     : \"+m\" (v-&gt;a_count)\n                     : \"ir\" (i));\n}\n//\u539f\u5b50\u51cf\u53bb\u4e00\u4e2a\u6574\u6570\nstatic inline void atomic_sub(int i, atomic_t *v)\n{\n        __asm__ __volatile__(\"lock;\" \"subl %1,%0\"\n                     : \"+m\" (v-&gt;a_count)\n                     : \"ir\" (i));\n}\n//\u539f\u5b50\u52a01\nstatic inline void atomic_inc(atomic_t *v)\n{\n        __asm__ __volatile__(\"lock;\" \"incl %0\"\n                       : \"+m\" (v-&gt;a_count));\n}\n//\u539f\u5b50\u51cf1\nstatic inline void atomic_dec(atomic_t *v)\n{\n       __asm__ __volatile__(\"lock;\" \"decl %0\"\n                     : \"+m\" (v-&gt;a_count));\n}\n</code></pre> </li> <li> <p>\u5f00\u5173\u4e2d\u65ad</p> <pre><code>//\u5173\u95ed\u4e2d\u65ad\nvoid hal_cli()\n{\n    __asm__ __volatile__(\"cli\": : :\"memory\");\n}\n//\u5f00\u542f\u4e2d\u65ad\nvoid hal_sti()\n{\n    __asm__ __volatile__(\"sti\": : :\"memory\");\n}\n//\u4f7f\u7528\u573a\u666f\nvoid foo()\n{\n    hal_cli();\n    //\u64cd\u4f5c\u6570\u636e\u2026\u2026\n    hal_sti();\n}\nvoid bar()\n{\n    hal_cli();\n    //\u64cd\u4f5c\u6570\u636e\u2026\u2026\n    hal_sti();\n}\n</code></pre> </li> <li> <p>\u81ea\u65cb\u9501</p> <pre><code>//\u81ea\u65cb\u9501\u7ed3\u6784\ntypedef struct\n{\n     volatile u32_t lock;//volatile\u53ef\u4ee5\u9632\u6b62\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u4fdd\u8bc1\u5176\u5b83\u4ee3\u7801\u59cb\u7ec8\u4ece\u5185\u5b58\u52a0\u8f7dlock\u53d8\u91cf\u7684\u503c \n} spinlock_t;\n//\u9501\u521d\u59cb\u5316\u51fd\u6570\nstatic inline void x86_spin_lock_init(spinlock_t * lock)\n{\n     lock-&gt;lock = 0;//\u9501\u503c\u521d\u59cb\u5316\u4e3a0\u662f\u672a\u52a0\u9501\u72b6\u6001\n}\n//\u52a0\u9501\u51fd\u6570\nstatic inline void x86_spin_lock(spinlock_t * lock)\n{\n    __asm__ __volatile__ (\n    \"1: \\n\"\n    \"lock; xchg  %0, %1 \\n\"//\u628a\u503c\u4e3a1\u7684\u5bc4\u5b58\u5668\u548clock\u5185\u5b58\u4e2d\u7684\u503c\u8fdb\u884c\u4ea4\u6362\n    \"cmpl   $0, %0 \\n\" //\u75280\u548c\u4ea4\u6362\u56de\u6765\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\n    \"jnz    2f \\n\"  //\u4e0d\u7b49\u4e8e0\u5219\u8df3\u8f6c\u540e\u97622\u6807\u53f7\u5904\u8fd0\u884c\n    \"jmp 3f \\n\"     //\u82e5\u7b49\u4e8e0\u5219\u8df3\u8f6c\u540e\u97623\u6807\u53f7\u5904\u8fd4\u56de\n    \"2:         \\n\" \n    \"cmpl   $0, %1  \\n\"//\u75280\u548clock\u5185\u5b58\u4e2d\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\n    \"jne    2b      \\n\"//\u82e5\u4e0d\u7b49\u4e8e0\u5219\u8df3\u8f6c\u5230\u524d\u97622\u6807\u53f7\u5904\u8fd0\u884c\u7ee7\u7eed\u6bd4\u8f83  \n    \"jmp    1b      \\n\"//\u82e5\u7b49\u4e8e0\u5219\u8df3\u8f6c\u5230\u524d\u97621\u6807\u53f7\u5904\u8fd0\u884c\uff0c\u4ea4\u6362\u5e76\u52a0\u9501\n    \"3:  \\n\"     :\n    : \"r\"(1), \"m\"(*lock));\n}\n//\u89e3\u9501\u51fd\u6570\nstatic inline void x86_spin_unlock(spinlock_t * lock)\n{\n    __asm__ __volatile__(\n    \"movl   $0, %0\\n\"//\u89e3\u9501\u628alock\u5185\u5b58\u4e2d\u7684\u503c\u8bbe\u4e3a0\u5c31\u884c\n    :\n    : \"m\"(*lock));\n}\n</code></pre> </li> <li> <p>\u4fe1\u53f7\u91cf</p> <pre><code>#define SEM_FLG_MUTEX 0\n#define SEM_FLG_MULTI 1\n#define SEM_MUTEX_ONE_LOCK 1\n#define SEM_MULTI_LOCK 0\n//\u7b49\u5f85\u94fe\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u6302\u8f7d\u7b49\u5f85\u4ee3\u7801\u6267\u884c\u6d41\uff08\u7ebf\u7a0b\uff09\u7684\u7ed3\u6784\uff0c\u91cc\u9762\u6709\u7528\u4e8e\u6302\u8f7d\u4ee3\u7801\u6267\u884c\u6d41\u7684\u94fe\u8868\u548c\u8ba1\u6570\u5668\u53d8\u91cf\uff0c\u8fd9\u91cc\u6211\u4eec\u5148\u4e0d\u6df1\u5165\u7814\u7a76\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u3002\ntypedef struct s_KWLST\n{   \n    spinlock_t wl_lock;\n    uint_t   wl_tdnr;\n    list_h_t wl_list;\n}kwlst_t;\n//\u4fe1\u53f7\u91cf\u6570\u636e\u7ed3\u6784\ntypedef struct s_SEM\n{\n    spinlock_t sem_lock;//\u7ef4\u62a4sem_t\u81ea\u8eab\u6570\u636e\u7684\u81ea\u65cb\u9501\n    uint_t sem_flg;//\u4fe1\u53f7\u91cf\u76f8\u5173\u7684\u6807\u5fd7\n    sint_t sem_count;//\u4fe1\u53f7\u91cf\u8ba1\u6570\u503c\n    kwlst_t sem_waitlst;//\u7528\u4e8e\u6302\u8f7d\u7b49\u5f85\u4ee3\u7801\u6267\u884c\u6d41\uff08\u7ebf\u7a0b\uff09\u7ed3\u6784\n}sem_t;\n\n//\u83b7\u53d6\u4fe1\u53f7\u91cf\nvoid krlsem_down(sem_t* sem)\n{\n    cpuflg_t cpufg;\nstart_step:    \n    krlspinlock_cli(&amp;sem-&gt;sem_lock,&amp;cpufg);\n    if(sem-&gt;sem_count&lt;1)\n    {//\u5982\u679c\u4fe1\u53f7\u91cf\u503c\u5c0f\u4e8e1,\u5219\u8ba9\u4ee3\u7801\u6267\u884c\u6d41\uff08\u7ebf\u7a0b\uff09\u7761\u7720\n        krlwlst_wait(&amp;sem-&gt;sem_waitlst);\n        krlspinunlock_sti(&amp;sem-&gt;sem_lock,&amp;cpufg);\n        krlschedul();//\u5207\u6362\u4ee3\u7801\u6267\u884c\u6d41\uff0c\u4e0b\u6b21\u6062\u590d\u6267\u884c\u65f6\u4f9d\u7136\u4ece\u4e0b\u4e00\u884c\u5f00\u59cb\u6267\u884c\uff0c\u6240\u4ee5\u8981goto\u5f00\u59cb\u5904\u91cd\u65b0\u83b7\u53d6\u4fe1\u53f7\u91cf\n        goto start_step; \n    }\n    sem-&gt;sem_count--;//\u4fe1\u53f7\u91cf\u503c\u51cf1,\u8868\u793a\u6210\u529f\u83b7\u53d6\u4fe1\u53f7\u91cf\n    krlspinunlock_sti(&amp;sem-&gt;sem_lock,&amp;cpufg);\n    return;\n}\n//\u91ca\u653e\u4fe1\u53f7\u91cf\nvoid krlsem_up(sem_t* sem)\n{\n    cpuflg_t cpufg;\n    krlspinlock_cli(&amp;sem-&gt;sem_lock,&amp;cpufg);\n    sem-&gt;sem_count++;//\u91ca\u653e\u4fe1\u53f7\u91cf\n    if(sem-&gt;sem_count&lt;1)\n    {//\u5982\u679c\u5c0f\u4e8e1,\u5219\u8bf4\u6570\u636e\u7ed3\u6784\u51fa\u9519\u4e86\uff0c\u6302\u8d77\u7cfb\u7edf\n        krlspinunlock_sti(&amp;sem-&gt;sem_lock,&amp;cpufg);\n        hal_sysdie(\"sem up err\");\n    }\n    //\u5524\u9192\u8be5\u4fe1\u53f7\u91cf\u4e0a\u6240\u6709\u7b49\u5f85\u7684\u4ee3\u7801\u6267\u884c\u6d41\uff08\u7ebf\u7a0b\uff09\n    krlwlst_allup(&amp;sem-&gt;sem_waitlst);\n    krlspinunlock_sti(&amp;sem-&gt;sem_lock,&amp;cpufg);\n    krlsched_set_schedflgs();\n    return;\n}\n</code></pre> </li> </ol> <p>\u66f4\u591a\u8be6\u7ec6\u5730\u770b\u300a\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u621845\u8bb2\u300b</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_19","title":"\u601d\u8003\u9898\u4e2d\u7684\u4e00\u4e9b\u95ee\u9898","text":"<p>\u7f16\u8bd1\u5668\u7684\u6307\u4ee4\u4f18\u5316\u91cd\u6392\u548c\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a</p> <ol> <li>\u7f16\u8bd1\u5668\u7684\u6307\u4ee4\u4f18\u5316\u91cd\u6392\uff1a\u7f16\u8bd1\u5668\u5728\u5c06\u9ad8\u7ea7\u8bed\u8a00\u4ee3\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u4ee3\u7801\u65f6\uff0c\u4f1a\u8fdb\u884c\u6307\u4ee4\u4f18\u5316\u548c\u91cd\u6392\u3002\u8fd9\u4e9b\u4f18\u5316\u5305\u62ec\u5faa\u73af\u5c55\u5f00\u3001\u5e38\u91cf\u6298\u53e0\u3001\u6b7b\u4ee3\u7801\u6d88\u9664\u7b49\u3002\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u91cd\u6392\u662f\u5728\u4e0d\u6539\u53d8\u7a0b\u5e8f\u8bed\u4e49\u7684\u524d\u63d0\u4e0b\uff0c\u91cd\u65b0\u5b89\u6392\u6307\u4ee4\u7684\u987a\u5e8f\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002</li> <li>\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\uff1a\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u662f\u5728\u786c\u4ef6\u5c42\u9762\u4e0a\uff0cCPU\u6839\u636e\u6307\u4ee4\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u91cd\u65b0\u5b89\u6392\u6267\u884c\u987a\u5e8f\u4ee5\u63d0\u9ad8\u6548\u7387\u3002\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u4e0d\u4f9d\u8d56\u4e8e\u7f16\u8bd1\u5668\u7684\u4f18\u5316\uff0c\u5b83\u662fCPU\u786c\u4ef6\u8bbe\u8ba1\u7684\u4e00\u90e8\u5206\u3002</li> </ol> <p>\u4e24\u8005\u7684\u5173\u7cfb\uff1a</p> <ul> <li>\u76ee\u6807\u4e00\u81f4\u6027\uff1a\u7f16\u8bd1\u5668\u7684\u6307\u4ee4\u4f18\u5316\u91cd\u6392\u548c\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u90fd\u65e8\u5728\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\uff0c\u5b83\u4eec\u7684\u76ee\u6807\u662f\u4e00\u81f4\u7684\u3002</li> <li>\u4f18\u5316\u5c42\u6b21\uff1a\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u662f\u5728\u8f6f\u4ef6\u5c42\u9762\u4e0a\uff0c\u5b83\u5173\u6ce8\u7684\u662f\u6e90\u4ee3\u7801\u5230\u673a\u5668\u4ee3\u7801\u7684\u8f6c\u6362\u8fc7\u7a0b\u3002\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u662f\u5728\u786c\u4ef6\u5c42\u9762\u4e0a\uff0c\u5b83\u5173\u6ce8\u7684\u662f\u6307\u4ee4\u7684\u6267\u884c\u8fc7\u7a0b\u3002</li> <li>\u76f8\u4e92\u72ec\u7acb\uff1a\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u548c\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u662f\u4e24\u4e2a\u76f8\u5bf9\u72ec\u7acb\u7684\u8fc7\u7a0b\u3002\u7f16\u8bd1\u5668\u65e0\u6cd5\u63a7\u5236\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002</li> <li>\u76f8\u4e92\u5f71\u54cd\uff1a\u5c3d\u7ba1\u5b83\u4eec\u662f\u72ec\u7acb\u7684\uff0c\u4f46\u5b83\u4eec\u4e5f\u4f1a\u76f8\u4e92\u5f71\u54cd\u3002\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u53ef\u80fd\u4f1a\u5f71\u54cd\u5904\u7406\u5668\u4e71\u5e8f\u6267\u884c\u7684\u6548\u679c\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7f16\u8bd1\u5668\u5bf9\u4ee3\u7801\u8fdb\u884c\u4e86\u8fc7\u5ea6\u7684\u4f18\u5316\uff0c\u53ef\u80fd\u4f1a\u7834\u574f\u6307\u4ee4\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4ece\u800c\u5f71\u54cd\u4e71\u5e8f\u6267\u884c\u7684\u6548\u679c\u3002</li> <li>\u534f\u4f5c\uff1a\u4e3a\u4e86\u8fbe\u5230\u6700\u4f73\u7684\u6027\u80fd\uff0c\u7f16\u8bd1\u5668\u4f18\u5316\u548c\u5904\u7406\u5668\u4e71\u5e8f\u6267\u884c\u9700\u8981\u76f8\u4e92\u534f\u4f5c\u3002\u4f8b\u5982\uff0c\u7f16\u8bd1\u5668\u53ef\u4ee5\u901a\u8fc7\u63d2\u5165\u5185\u5b58\u5c4f\u969c\u7b49\u6307\u4ee4\u6765\u6307\u5bfc\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\uff0c\u786e\u4fdd\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0c\u7f16\u8bd1\u5668\u7684\u6307\u4ee4\u4f18\u5316\u91cd\u6392\u548c\u5904\u7406\u5668\u7684\u4e71\u5e8f\u6267\u884c\u90fd\u662f\u4e3a\u4e86\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\uff0c\u5b83\u4eec\u5728\u4e0d\u540c\u7684\u5c42\u6b21\u4e0a\u5de5\u4f5c\uff0c\u76f8\u4e92\u72ec\u7acb\u4f46\u53c8\u76f8\u4e92\u5f71\u54cd\u3002\u7406\u89e3\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u5bf9\u4e8e\u7f16\u5199\u9ad8\u6548\u7684\u5e76\u884c\u7a0b\u5e8f\u975e\u5e38\u91cd\u8981\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#52","title":"5.2 \u8865\u5145 | \u9501\u7684\u76f8\u5173\u5b9e\u73b0\u6709\u54ea\u4e9b\uff1f","text":"<p>\u4e92\u65a5\u9501\uff1f\u81ea\u65cb\u9501\uff1f\u539f\u5b50\u64cd\u4f5c\uff1fRCU\uff1f</p> <p></p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#6","title":"6\uff5c\u6807\u51c6\u5e93\uff1a\u4fe1\u53f7\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u8f6f\u4e2d\u65ad\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f","text":"<p>#### \u4fe1\u53f7</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u4e00\u79cd\u7528\u6765\u4f20\u9012\u7279\u5b9a\u6d88\u606f\u7684\u673a\u5236\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5c06\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u7c7b\u7279\u6b8a\u60c5\u51b5\u8f6c\u53d1\u7ed9\u7a0b\u5e8f\uff0c\u5e76\u6309\u7167\u5176\u6307\u5b9a\u7684\u903b\u8f91\u8fdb\u884c\u5904\u7406\u3002\u6bcf\u4e00\u79cd\u5177\u4f53\u7684\u4fe1\u53f7\u90fd\u6709\u5b83\u5bf9\u5e94\u7684\u540d\u79f0\uff0c\u8fd9\u4e9b\u540d\u79f0\u4ee5 \u201cSIG\u201d \u4f5c\u4e3a\u524d\u7f00\u3002\u6bd4\u5982\uff0c\u5f53\u7a0b\u5e8f\u8bbf\u95ee\u975e\u6cd5\u5185\u5b58\u65f6\uff0c\u4fbf\u4f1a\u4ea7\u751f\u540d\u4e3a SIGSEGV \u7684\u4fe1\u53f7\u3002\u800c\u9664\u96f6\u5f02\u5e38\u5219\u5bf9\u5e94\u7740\u540d\u4e3a SIGFPE \u7684\u4fe1\u53f7\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_20","title":"\u4fe1\u53f7\u548c\u8f6f\u4e2d\u65ad","text":"<p>\u4e2d\u65ad\uff0c\u6307\u7684\u662fCPU\u9700\u8981\u6682\u505c\u5f53\u7136\u6267\u884c\u7684\u4efb\u52a1\uff0c\u4fdd\u5b58\u5f53\u524d\u72b6\u6001\uff0c\u8f6c\u800c\u53bb\u6267\u884c\u7279\u5b9a\u7684\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\uff08ISR\uff09\uff0c\u54cd\u5e94\u5916\u90e8\u73af\u5883\u7684\u53d8\u5316\uff0c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0cCPU\u6062\u590d\u4e2d\u65ad\u524d\u6682\u505c\u7684\u4efb\u52a1\u3002</p> <p>\u4e2d\u65ad\u89e6\u53d1\u5206\u4e24\u79cd\uff1a\u786c\u4ef6\u4e2d\u65ad\u548c\u8f6f\u4ef6\u4e2d\u65ad\uff08\u786c\u4e2d\u65ad\u4e0e\u8f6f\u4e2d\u65ad\uff09\u3002</p> <ul> <li> <p>\u786c\u4e2d\u65ad</p> <p>\u4e0e\u8ba1\u7b97\u673a\u786c\u4ef6\u7279\u5b9a\u72b6\u6001\u76f8\u5173\u7684\u4e2d\u65ad\u8fc7\u7a0b\uff0c\u7531\u786c\u4ef6\u76f4\u63a5\u89e6\u53d1\u3002</p> <ul> <li> <p>eg</p> <p>\u952e\u76d8\u3001\u78c1\u76d8\u5b8c\u6210IO\u7684\u76f8\u5173\u64cd\u4f5c\u3002</p> <p>\u5f53\u78c1\u76d8\u5b8c\u6210\u4e86\u67d0\u6b21\u7531\u7528\u6237\u7a0b\u5e8f\u6307\u5b9a\u7684 IO \u64cd\u4f5c\u540e\uff0c\u4fbf\u4f1a\u901a\u8fc7\u786c\u4ef6\u4e2d\u65ad\u7684\u65b9\u5f0f\u6765\u901a\u77e5 CPU \u8fd9\u4e00\u6d88\u606f\uff0c\u5e76\u8ba9 CPU \u8fdb\u884c\u540e\u7eed\u7684\u5904\u7406\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4fbf\u5b58\u5728\u7740 CPU \u6267\u884c\u6d41\u7a0b\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u67d0\u884c\u673a\u5668\u6307\u4ee4\uff0c\u5230\u78c1\u76d8\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4ee3\u7801\u7684\u8f6c\u79fb\u3002</p> </li> </ul> </li> <li> <p>\u8f6f\u4e2d\u65ad</p> <p>\u7531\u8ba1\u7b97\u673a\u8f6f\u4ef6\uff0c\u901a\u8fc7 <code>int</code> \u7b49\u673a\u5668\u6307\u4ee4\u5f15\u8d77\u7684CPU\u6267\u884c\u6d41\u7a0b\u7684\u4e34\u65f6\u8f6c\u79fb\u3002</p> <ul> <li> <p>eg</p> <p>\u7cfb\u7edf\u8c03\u7528</p> <p>\u65e9\u671f\u7684 i386 \u67b6\u6784\u4e2d\uff0c\u7528\u6237\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u6307\u4ee4 <code>int 0x80</code> \u624d\u80fd\u591f\u501f\u7531\u8f6f\u4ef6\u4e2d\u65ad\u4ece\u7528\u6237\u6001\u8fdb\u5165\u5230\u5185\u6838\u6001\uff0c\u5e76\u4f7f\u7528\u5185\u6838\u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002\u540c\u6837\u5730\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4e5f\u5b58\u5728\u7740 CPU \u4ece\u7528\u6237\u4ee3\u7801\u5230\u5185\u6838\u4ee3\u7801\u7684\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u3002</p> </li> </ul> </li> </ul> <p>\u4fe1\u53f7\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u8f6f\u4e2d\u65ad\u3002\u5f53\u7279\u5b9a\u7684\u4e8b\u4ef6\u53d1\u751f\u7684\u65f6\u5019\uff08\u6bd4\u5982\u201c\u9664\u96f6\u201d\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5bf9\u5e94\u7684\u4fe1\u53f7\u503c\uff08\u5373\u5bf9\u5e94\u7684 SIGFPE\uff09\u53d1\u9001\u7ed9\u76f8\u5173\u7a0b\u5e8f\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5e76\u672a\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff0c\u5219\u64cd\u4f5c\u7cfb\u7edf\u5c06\u4f1a\u6267\u884c\u9ed8\u8ba4\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u7684\u903b\u8f91\uff08\u81ea\u52a8\u7ec8\u6b62\uff09\u3002</p> <p>\uff08\u6574\u4e2a\u4fe1\u53f7\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u5b58\u5728\u7740 CPU \u4ece\u7528\u6237\u7a0b\u5e8f\u5230\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u3002\uff09</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#c_2","title":"C\u8bed\u8a00\u4e2d\u4e0e\u4fe1\u53f7\u4ea4\u4e92","text":"<pre><code>#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid sigHandler(int sig)\n{\n    printf(\"Signal %d catched!\\n\",sig);\n    exit(sig);\n}\n\nint main(void)\n{\n    signal(SIGFPE, sigHandler);\n    int x = 10;\n    int y = 0;\n\n    printf(\"%d\\n\", x / y);\n\n    return 0;\n}\n</code></pre> <ul> <li> <p>signal\u51fd\u6570</p> <p></p> <ol> <li> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a6\u79cd\u4e0d\u540c\u7c7b\u578b\u4fe1\u53f7</p> <p></p> </li> <li> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u56de\u8c03\u51fd\u6570\u5f62\u5982 <code>void (* handler) (int)</code></p> </li> </ol> <p>\u4fe1\u53f7\u5177\u4f53\u5904\u7406\u6d41\u7a0b\uff1a</p> <ol> <li>CPU \u6267\u884c\u9664\u6cd5\u6307\u4ee4 idiv\uff1b</li> <li>\u53d1\u73b0\u9664\u96f6\u5f02\u5e38\uff0cCPU \u6682\u505c\u5f53\u524d\u7a0b\u5e8f\u8fd0\u884c\uff0c\u4fdd\u5b58\u5f53\u524d\u4e0a\u4e0b\u6587\uff0c\u5e76\u5c06\u63a7\u5236\u6743\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u5c06\u4fe1\u53f7 SIGFPE \u53d1\u9001\u7ed9\u51fa\u9519\u7684\u7a0b\u5e8f\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e\u60c5\u51b5\u6267\u884c\u76f8\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff08\u51fd\u6570\uff09\uff1b</li> <li> <p>\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u82e5\u7a0b\u5e8f\u672a\u9000\u51fa\uff0c\u5219\u5c06\u7a0b\u5e8f\u6267\u884c\u6062\u590d\u5230\u4e4b\u524d\u7684\u4e2d\u65ad\u70b9\uff08\u5373 CPU \u4f1a\u91cd\u65b0\u6267\u884c idiv \u6307\u4ee4\uff09\u3002</p> </li> <li> <p>\u66f4\u591a\u4fe1\u53f7\u5904\u7406\u65b9\u5f0f\uff1a</p> </li> </ol> <p></p> </li> </ul> <pre><code>#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  signal(SIGTERM, SIG_IGN);  // \u5ffd\u7565\u4fe1\u53f7 SIGTERM\uff1b\n  raise(SIGTERM);  // \u5411\u5f53\u524d\u7a0b\u5e8f\u53d1\u9001 SIGTERM \u4fe1\u53f7\uff1b\n  printf(\"Reachable!\\n\");  // Reachable code!\n  return 0;\n}\n</code></pre> <p>\u8fd9\u91cc\uff0c\u5728\u4ee3\u7801\u7684\u7b2c 5 \u884c\uff0c\u6211\u4eec\u8fd8\u4f7f\u7528\u4e86\u7531\u6807\u51c6\u5e93\u63d0\u4f9b\u7684 raise \u51fd\u6570\u3002\u8be5\u51fd\u6570\u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u76f4\u63a5\u5411\u5f53\u524d\u7a0b\u5e8f\u53d1\u9001\u6307\u5b9a\u7684\u4fe1\u53f7\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4e3a\u4fe1\u53f7 SIGTERM \u8bbe\u7f6e\u4e86 SIG_IGN \u4f5c\u4e3a\u5b83\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u56e0\u6b64\uff0c\u5f53\u6267\u884c\u5230 raise \u51fd\u6570\u540e\uff0c\u867d\u7136\u5b83\u5411\u7a0b\u5e8f\u53d1\u9001\u4e86 SIGTERM \u4fe1\u53f7\uff0c\u4f46\u7a0b\u5e8f\u5374\u4e0d\u4f1a\u88ab\u7acb\u5373\u7ec8\u6b62\u3002\u76f8\u53cd\uff0c\u5b83\u5c06\u7ee7\u7eed\u6267\u884c\u7b2c 6 \u884c\u7684 printf \u51fd\u6570\uff0c\u7136\u540e\u4ee5\u6b63\u5e38\u65b9\u5f0f\u9000\u51fa\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u8c03\u7528\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u5728\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4efb\u610f\u65f6\u523b\u3002\u800c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7ed9\u7a0b\u5e8f\u7684\u5b9e\u9645\u6267\u884c\u5e26\u6765\u5f71\u54cd\u3002\u63a5\u4e0b\u6765\uff0c\u8ba9\u6211\u4eec\u8fdb\u4e00\u6b65\u770b\u770b\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5982\u4f55\u5f71\u54cd\u7a0b\u5e8f\u8fd0\u884c\u7684\uff1a\u53ef\u91cd\u5165\u51fd\u6570\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_21","title":"\u53ef\u91cd\u5165\u51fd\u6570","text":"<p>\u8bd5\u60f3\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u67d0\u4e00\u65f6\u523b\uff0cCPU \u8fd8\u5728\u6b63\u5e38\u6267\u884c main \u51fd\u6570\u5185\u51fd\u6570 A \u7684\u4ee3\u7801\uff0c\u800c\u7531\u4e8e\u67d0\u4e9b\u5916\u90e8\u539f\u56e0\uff0c\u7a0b\u5e8f\u5728\u6b64\u523b\u6536\u5230\u4e86\u67d0\u4e2a\u4fe1\u53f7\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4fbf\u6682\u505c\u5f53\u524d\u7a0b\u5e8f\u8fd0\u884c\uff0c\u5e76\u5c06\u6267\u884c\u6d41\u7a0b\u8c03\u5ea6\u81f3\u5bf9\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002\u800c\u5728\u8fd9\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u51fd\u6570 A \u53c8\u88ab\u518d\u6b21\u8c03\u7528\u3002\u5f53\u4fe1\u53f7\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u6267\u884c\u6d41\u8fd4\u56de\u4e86\u4e4b\u524d\u7684\u201c\u4e2d\u65ad\u70b9\u201d\uff0c\u5e76\u7ee7\u7eed\u5904\u7406 main \u51fd\u6570\u5185\uff0c\u51fd\u6570 A \u4e2d\u8fd8\u672a\u88ab\u6267\u884c\u5230\u7684\u6307\u4ee4\u3002</p> <p>\u90a3\u4e48\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u5bf9\u51fd\u6570 A \u7684\u518d\u6b21\u8c03\u7528\uff0c\u4f1a\u4e0d\u4f1a\u5f71\u54cd\u4e4b\u524d\u8fd8\u672a\u8c03\u7528\u5b8c\u6210\u7684\u51fd\u6570 A \u7684\u6267\u884c\u72b6\u6001\u5462\uff1f\u8ba9\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u6bb5\u201c\u6a21\u62df\u201d\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;string.h&gt;\n\n#define BUF_SIZE 16  // \u5168\u5c40\u9759\u6001\u6570\u7ec4\u5927\u5c0f\uff1b\n#define FORMAT_NUM_(N) \" $\"#N\n#define FORMAT_NUM(N) FORMAT_NUM_(N)\n\n#define RAISE_EXP_false_ASM()\n// \u8c03\u7528 raise \u51fd\u6570\u5411\u5f53\u524d\u7a0b\u5e8f\u53d1\u9001\u4fe1\u53f7\uff1b\n#define RAISE_EXP_true_ASM() \\\n  \"movl    $4, %%edi\\n\\t\" \\\n  \"call    raise\\n\\t\"\n\n// \u5185\u8054\u6c47\u7f16\u5b9e\u73b0\uff1b\n#define INLINE_ASM(ID, HAS_EXP) \\\n  \"mov     %0, %%r8\\n\\t\" /* \u590d\u5236\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u6570\u636e\u5230\u5168\u5c40\u9759\u6001\u6570\u7ec4 */ \\\n  \"testq   %%rsi, %%rsi\\n\\t\" \\\n  \"je      .L1\" #ID \"\\n\\t\" \\\n  \"xorl    %%eax, %%eax\\n\\t\" \\\n  \".L3\" #ID \":\\n\\t\" \\\n  \"movzbl  (%%rdi,%%rax), %%ecx\\n\\t\" \\\n  \"movb    %%cl, (%%r8,%%rax)\\n\\t\" \\\n  \"addq    $1, %%rax\\n\\t\" \\\n  \"cmpq    %%rsi, %%rax\\n\\t\" \\\n  \"jne     .L3\" #ID \"\\n\\t\" \\\n  \".L1\" #ID \":\\n\\t\" \\\n  RAISE_EXP_##HAS_EXP##_ASM() /* \u9009\u62e9\u6027\u8c03\u7528 raise \u51fd\u6570 */ \\\n  \"mov     $1, %%rax\\n\\t\" \\\n  \"mov     $1, %%rdi\\n\\t\" \\\n  \"mov     %0, %%rsi\\n\\t\" \\\n  \"mov\" FORMAT_NUM(BUF_SIZE) \", %%rdx\\n\\t\" \\\n  \"syscall\\n\\t\"  /* \u89e6\u53d1\u7cfb\u7edf\u8c03\u7528\uff0c\u6253\u5370\u5185\u5bb9 */\n\nstatic char buf[BUF_SIZE];  // \u7528\u4e8e\u4fdd\u5b58\u5b57\u7b26\u7684\u5168\u5c40\u9759\u6001\u6570\u7ec4\uff1b\n\nvoid print_with_exp(const char* str, size_t len) {  // \u4f1a\u5f15\u8d77\u4fe1\u53f7\u4e2d\u65ad\u7684\u7248\u672c\uff1b\n  asm(INLINE_ASM(a, true) :: \"g\" (buf));\n}\nvoid print_normal(const char* str, size_t len) {  // \u6b63\u5e38\u7684\u7248\u672c\uff1b\n  asm(INLINE_ASM(b, false) :: \"g\" (buf));\n}\nvoid sigHandler(int sig) {\n  const char* str = \"Hello\";\n  print_normal(str, strlen(str));\n}\nint main(void) {\n  signal(SIGILL, sigHandler);\n  const char* str = \", world!\";\n  print_with_exp(str, strlen(str));\n  return 0;\n}\n</code></pre> <ol> <li>\u5728 main \u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u901a\u8fc7 signal \u51fd\u6570\uff0c\u4e3a\u4fe1\u53f7 SIGILL \u6ce8\u518c\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002</li> <li>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8c03\u7528\u4e86\u540d\u4e3a print_with_exp \u7684\u51fd\u6570\uff0c\u5e76\u4f20\u5165\u4e86\u5185\u5bb9\u4e3a \u201cHello\u201d \u7684\u5b57\u7b26\u4e32 str\uff0c\u4ee5\u53ca\u76f8\u5e94\u7684\u957f\u5ea6\u4fe1\u606f\u3002\u51fd\u6570\u5728\u8c03\u7528\u540e\u4f1a\u6253\u5370\u51fa\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u5b8c\u6574\u5185\u5bb9\u3002</li> <li>\u8fd9\u91cc\uff0c\u501f\u52a9\u51fd\u6570 print_with_exp\uff0c\u6211\u4eec\u5c06\u4f1a\u6a21\u62df\u4e0a\u9762\u63d0\u5230\u7684\uff0c\u4f4d\u4e8e main \u51fd\u6570\u4e2d\u7684\u51fd\u6570 A \u7684\u6267\u884c\u6d41\u7a0b\u3002</li> </ol> <p>\u4f46\u4e0e\u771f\u5b9e\u6848\u4f8b\u7a0d\u6709\u4e0d\u540c\u7684\u662f\uff0c\u4e3a\u4e86\u6a21\u62df\u64cd\u4f5c\u7cfb\u7edf\u5411\u7a0b\u5e8f\u968f\u673a\u53d1\u9001\u4fe1\u53f7\u7684\u8fc7\u7a0b\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u76f4\u63a5\u5728\u51fd\u6570 print_with_exp \u4e2d\uff0c\u901a\u8fc7\u8c03\u7528 raise \u51fd\u6570\u7684\u65b9\u5f0f\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u5f53\u7136\uff0c\u4f60\u53ef\u80fd\u4f1a\u8bf4\u201c\u8fd9\u5e76\u4e0d\u968f\u673a\u201d\uff0c\u4f46\u5728\u73b0\u5b9e\u6848\u4f8b\u4e2d\uff0c\u7c7b\u4f3c\u7684\u60c5\u51b5\u5374\u53ef\u80fd\u53d1\u751f\u3002</p> <p>\u4e3a\u4e86\u4ece\u66f4\u52a0\u7ec6\u5fae\u7684\u89d2\u5ea6\uff0c\u76f4\u89c2\u5730\u89c2\u5bdf\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u8c03\u7528\u5bf9\u201c\u51fd\u6570\u91cd\u5165\u201d\u7684\u5f71\u54cd\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u76f4\u63a5\u7528\u5185\u8054\u6c47\u7f16\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0 print_with_exp \u51fd\u6570\u3002\u76f8\u5e94\u5730\uff0c\u540d\u4e3a print_normal \u7684\u51fd\u6570\uff0c\u5176\u529f\u80fd\u4e0e print_with_exp \u76f8\u540c\uff0c\u53ea\u662f\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u4e0d\u4f1a\u8c03\u7528 raise \u51fd\u6570\u3002\u4f60\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u8fd9\u4e24\u4e2a\u51fd\u6570\u89c6\u4e3a\u529f\u80fd\u5b8c\u5168\u4e00\u81f4\u7684 \u201cprint\u201d \u51fd\u6570\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u7ec4\u7ec7\u4ee3\u7801\uff0c\u4ee5\u5c06\u76f8\u540c\u529f\u80fd\u7684\u5b9e\u73b0\u90e8\u5206\u8fdb\u884c\u62bd\u79bb\uff0c\u6211\u4eec\u901a\u8fc7\u5b8f\u7684\u65b9\u5f0f\u201c\u5c01\u88c5\u201d\u4e86\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u5185\u8054\u6c47\u7f16\u5185\u5bb9\u3002\u4f4d\u4e8e\u4ee3\u7801\u7b2c 13 \u884c\u7684\u5b8f\u51fd\u6570 INLINE_ASM\uff0c\u5c06\u4f1a\u6839\u636e\u4f20\u5165\u53c2\u6570\u7684\u4e0d\u540c\uff0c\u6765\u9009\u62e9\u6027\u5730\u751f\u6210\u4e0d\u540c\u7684\u6c47\u7f16\u4ee3\u7801\u3002</p> <p>\u5728\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u6c47\u7f16\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u4f1a\u5c06\u7531\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u6839\u636e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u5165\u7684\u957f\u5ea6\u4fe1\u606f\u9010\u5b57\u7b26\u590d\u5236\u5230\u7a0b\u5e8f\u4e2d\u7684\u5168\u5c40\u9759\u6001\u6570\u7ec4 buf \u4e2d\u3002\u7136\u540e\uff0c\u901a\u8fc7\u76f8\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u518d\u5c06\u8be5\u6570\u7ec4\u4e2d\u7684\u5185\u5bb9\u8f93\u51fa\u5230\u7ec8\u7aef\u3002\u53ea\u662f\u5bf9\u4e8e print_with_exp \u51fd\u6570\u6765\u8bf4\uff0c\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7\u8c03\u7528 raise \u51fd\u6570\u5c06\u4fe1\u53f7 SIGILL \u53d1\u9001\u7ed9\u5f53\u524d\u7a0b\u5e8f\u3002\u4f60\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u4e2d\u7684\u6ce8\u91ca\u6765\u4e86\u89e3\u8fd9\u90e8\u5206\u5b9e\u73b0\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6309\u7167\u6211\u4eec\u7684\u7406\u89e3\uff0c\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u540e\uff0c\u5e94\u8be5\u4f1a\u6309\u987a\u5e8f\u8fdb\u884c\u4e24\u6b21\u8f93\u51fa\uff08\u5bf9\u5e94\u4e24\u6b21\u7cfb\u7edf\u8c03\u7528\uff09\uff0c\u5e76\u5b8c\u6574\u6253\u5370\u5b57\u7b26\u4e32 \u201cHello, world!\u201d\u3002\u5176\u4e2d\uff0c\u524d\u534a\u6bb5\u7531\u9996\u5148\u8c03\u7528\u5b8c\u6210\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570 sigHandler \u4e2d\u7684 print_normal \u51fd\u6570\u8f93\u51fa\uff1b\u540e\u534a\u6bb5\u7531 main \u51fd\u6570\u5185\u7684 print_with_exp \u51fd\u6570\u8f93\u51fa\u3002</p> <p>\u7a0b\u5e8f\u8fd0\u884c\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b9e\u9645\u7684\u8f93\u51fa\u5185\u5bb9\u662f \u201cHellold!Hellold!\u201d\u3002\u5e76\u975e\u9884\u671f\u7684\u201dhello\uff0cworld\uff01\u201c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u4ed4\u7ec6\u67e5\u770b\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u51fd\u6570 print_with_exp \u5728\u8c03\u7528\u65f6\uff0c\u5b58\u5165\u5168\u5c40\u9759\u6001\u6570\u7ec4 buf \u4e2d\u7684\u5b57\u7b26\u4e32\u5185\u5bb9 \u201c, world!\u201d\uff0c\u4f1a\u88ab\u4fe1\u53f7\u5904\u7406\u4ee3\u7801\u4e2d print_normal \u51fd\u6570\u8c03\u7528\u65f6\u5b58\u5165\u7684\u5b57\u7b26\u4e32 \u201cHello\u201d\uff0c\u8986\u76d6\u4e86\u4e00\u90e8\u5206\u3002\u800c\u5f53\u6267\u884c\u6d41\u518d\u6b21\u9000\u56de\u5230 print_with_exp \u51fd\u6570\u4e2d\u7ee7\u7eed\u6267\u884c\u65f6\uff0c\u7531\u4e8e\u6b64\u65f6\u6570\u7ec4 buf \u4e2d\u7684\u5185\u5bb9\u5df2\u7ecf\u53d1\u751f\u6539\u53d8\uff0c\u56e0\u6b64\u4fbf\u6253\u5370\u51fa\u4e86\u9519\u8bef\u7684\u7ed3\u679c\u3002\u4f60\u53ef\u4ee5\u53c2\u8003\u4e0b\u56fe\uff0c\u6765\u7406\u89e3\u4e0a\u8ff0\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u3002</p> <p></p> <ul> <li> <p>\u5bf9\u4e8e\u8fd9\u79cd\u4e00\u65e6\u5728\u6267\u884c\u4e2d\u9014\u88ab\u4e34\u65f6\u6253\u65ad\uff0c\u5728\u6b64\u523b\u518d\u6b21\u8c03\u7528\u5c31\u53ef\u80fd\u5f71\u54cd\u524d\u4e00\u6b21\u8c03\u7528\u6b63\u5e38\u6267\u884c\u7684\u51fd\u6570\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u4e4b\u4e3a\u201c\u4e0d\u53ef\u91cd\u5165\u51fd\u6570\u201d\u3002</p> </li> <li> <p>\u76f8\u53cd\uff0c\u4e0d\u53d7\u4e2d\u9014\u6253\u65ad\u548c\u91cd\u65b0\u8c03\u7528\u5f71\u54cd\u7684\u51fd\u6570\uff0c\u4fbf\u88ab\u79f0\u4e3a\u201c\u53ef\u91cd\u5165\u51fd\u6570\u201d\u3002</p> </li> <li>\u5728\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\uff0c\u201c\u5c3d\u91cf\u4f7f\u7528\u53ef\u91cd\u5165\u51fd\u6570\u201d\u4fbf\u662f\u6211\u4eec\u9700\u8981\u9075\u5b88\u7684\u9996\u8981\u89c4\u5219\u3002\u867d\u7136\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5728\u4fe1\u53f7\u5904\u7406\u4ee3\u7801\u4e2d\u5bf9\u5b83\u4eec\u7684\u8c03\u7528\u90fd\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u4f46\u4ece\u7a0b\u5e8f\u5065\u58ee\u6027\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5374\u5e76\u4e0d\u63a8\u8350\u8fd9\u6837\u505a\u3002</li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u5305\u62ec printf\u3001exit\uff0c\u4ee5\u53ca malloc \u5728\u5185\u7684\u4f17\u591a\u5e38\u7528 C \u6807\u51c6\u5e93\u51fd\u6570\uff0c\u5b83\u4eec\u90fd\u5e76\u975e\u53ef\u91cd\u5165\u51fd\u6570\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u80fd\u591f\u5728\u4fe1\u53f7\u5904\u7406\u4ee3\u7801\u4e2d\u8fdb\u884c\u7684\u64cd\u4f5c\u4e5f\u5e76\u4e0d\u591a\u3002\u800c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u7b80\u5316\u4fe1\u53f7\u5904\u7406\u6a21\u578b\uff0cC \u6807\u51c6\u5e93\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a sig_atomic_t \u7684\u6574\u6570\u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u53ef\u4ee5\u4fdd\u8bc1\uff0c\u5373\u4f7f\u5b58\u5728\u53ef\u80fd\u7531\u4e8e\u4e2d\u65ad\u5bfc\u81f4\u7684\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\uff0c\u5bf9\u8be5\u7c7b\u578b\u53d8\u91cf\u7684\u8bfb\u5199\u8fc7\u7a0b\u4e5f\u90fd\u662f\u539f\u5b50\u7684\uff08\u6ce8\u610f\uff0c\u4e0d\u8981\u4e0e\u5e76\u53d1\u7f16\u7a0b\u4e2d\u7684\u539f\u5b50\u7c7b\u578b\u6df7\u6dc6\uff0c\u6807\u51c6\u4e2d\u4ec5\u89c4\u5b9a\u4e86 sig_atomic_t \u7c7b\u578b\u5728\u5f02\u6b65\u4fe1\u53f7\u5904\u7406\u573a\u666f\u4e0b\u7684\u539f\u5b50\u6027\uff09\u3002</p> <pre><code>#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\nvolatile sig_atomic_t sig = 0;\nvoid sigHandler(int signal) {\n  sig = signal;\n}\nint main(void) {\n  signal(SIGINT, sigHandler);\n  int counter = 0;  // \u8ba1\u6570\u5668\u53d8\u91cf\uff1b\n  while(1) {\n    switch (sig) {  // \u4fe1\u53f7\u7b5b\u9009\u4e0e\u5904\u7406\uff1b\n      case SIGINT: {\n        printf(\"SignalValue: %d\", sig);\n        /* \u5f02\u5e38\u5904\u7406\u7684\u4e3b\u8981\u903b\u8f91 */\n         // ... \n         // ...\n         // ...\n        exit(SIGINT);\n      }\n    }\n    if (counter == 5) raise(SIGINT);  //\u9ed8\u8ba4\u9000\u51fa\u7a0b\u5e8f\n    printf(\"Counter: %d\\n\", counter++);\n    sleep(1);\n  }\n  return 0;\n}\n</code></pre> <p>\u5728 main \u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u6b7b\u5faa\u73af\u6765\u8868\u793a\u4e00\u4e2a\u5e38\u9a7b\u7a0b\u5e8f\uff08\u6bd4\u5982 HTTP \u670d\u52a1\u5668\uff09\u7684\u6267\u884c\u72b6\u6001\u3002</p> <ol> <li>\u5728\u4ee3\u7801\u7684\u7b2c 10 \u884c\uff0c\u901a\u8fc7 signal \u51fd\u6570\uff0c\u6211\u4eec\u4e3a\u4fe1\u53f7 SIGINT \u6ce8\u518c\u4e86\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570 sigHandler\u3002\u5728\u8be5\u51fd\u6570\u5185\u90e8\uff0csig_atomic_t \u7c7b\u578b\u53d8\u91cf sig \u7684\u503c\u88ab\u66f4\u65b0\u4e3a\u6536\u5230\u7684\u4fe1\u53f7\u503c\u3002</li> <li>\u56de\u5230\u4e3b\u51fd\u6570\uff0c\u5728\u4ee3\u7801\u7684\u7b2c 13~19 \u884c\uff0c\u6211\u4eec\u5728\u4e3b\u5faa\u73af\u6bcf\u6b21\u8fed\u4ee3\u7684\u5f00\u5934\u5904\uff0c\u901a\u8fc7\u68c0\u6d4b\u53d8\u91cf sig \u7684\u503c\uff0c\u6765\u5224\u65ad\u5f53\u524d\u7a0b\u5e8f\u662f\u5426\u6536\u5230\u4fe1\u53f7\uff0c\u5e76\u4f5c\u51fa\u76f8\u5e94\u5904\u7406\u3002</li> <li>\u7b2c 18 \u884c\uff0c\u5f53 counter \u53d8\u91cf\u7684\u503c\u88ab\u9012\u589e\u5230 5 \u65f6\uff0craise \u51fd\u6570\u5411\u5f53\u524d\u7a0b\u5e8f\u53d1\u9001\u4e86\u4fe1\u53f7 SIGINT\uff0c\u4ece\u800c\u6a21\u62df\u4e86\u7a0b\u5e8f\u6536\u5230\u4fe1\u53f7\uff0c\u53d1\u751f\u8f6f\u4e2d\u65ad\u65f6\u7684\u573a\u666f\u3002</li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_22","title":"\u591a\u7ebf\u7a0b\u5e94\u7528\u7684\u4fe1\u53f7\u5904\u7406","text":"<p>\u5bf9\u4e8e\u5355\u7ebf\u7a0b\u5e94\u7528\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u5f88\u597d\u5730\u5728\u7a0b\u5e8f\u4e2d\u4e0e\u4fe1\u53f7\u8fdb\u884c\u4ea4\u4e92\u3002\u4f46\u9057\u61be\u7684\u662f\uff0cC \u8bed\u8a00\u5e76\u6ca1\u6709\u5bf9\u5e76\u53d1\u7f16\u7a0b\u4e2d\u7684\u4fe1\u53f7\u5904\u7406\u505a\u4efb\u4f55\u89c4\u8303\u4e0a\u7684\u7ea6\u675f\u548c\u5efa\u8bae\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5728\u591a\u7ebf\u7a0b\u5e94\u7528\u4e2d\u4f7f\u7528 signal \u548c raise \u51fd\u6570\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u672a\u5b9a\u4e49\u884c\u4e3a\u3002\u8fd9\u4e9b\u51fd\u6570\u4f1a\u5982\u4f55\u5f71\u54cd\u7a0b\u5e8f\u6267\u884c\uff0c\u5219\u53d6\u51b3\u4e8e\u4e0d\u540c C \u6807\u51c6\u5e93\u5728\u5177\u4f53\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u5b9e\u73b0\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5bf9\u7a0b\u5e8f\u7684\u53ef\u79fb\u690d\u6027\u53ca\u5065\u58ee\u6027\u6709\u8981\u6c42\uff0c\u90a3\u4e48\u8bf7\u4e0d\u8981\u5728\u591a\u7ebf\u7a0b\u5e94\u7528\u4e2d\u4f7f\u7528\u4fe1\u53f7\u5904\u7406\u3002\u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4f60\u53ef\u4ee5==\u8003\u8651\u901a\u8fc7\u5b8f\u7684\u65b9\u5f0f==\u6765\u533a\u5206\u7a0b\u5e8f\u8fd0\u884c\u6240\u5728\u7684\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7136\u540e\u5206\u522b\u4f7f\u7528 POSIX\u3001Win32 \u7b49 API \uff0c\u6765\u4ee5\u4e0d\u540c\u65b9\u5f0f\u5b9e\u73b0\u591a\u7ebf\u7a0b\u6a21\u5f0f\u4e0b\u7684\u4fe1\u53f7\u5904\u7406\u8fc7\u7a0b\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_23","title":"\u601d\u8003\u9898","text":"<ul> <li> <p>\u5173\u4e8eIPC\u548c\u5e76\u53d1\u7f16\u7a0b\u91cc\u9762\u7684\u4e00\u4e9b\u6982\u5ff5\u533a\u5206</p> <p>IPC\uff08Inter-Process Communication\uff0c\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff09 \u662f\u6307\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u548c\u901a\u4fe1\u7684\u673a\u5236\u3002\u5e38\u89c1\u7684 IPC \u65b9\u6cd5\u5305\u62ec\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u548c\u4fe1\u53f7\u91cf\u7b49\u3002IPC \u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u548c\u534f\u4f5c\uff0c\u4ece\u800c\u5b9e\u73b0\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u534f\u540c\u5de5\u4f5c\u3002</p> <p>\u5e76\u53d1\u7f16\u7a0b \u662f\u6307\u591a\u4e2a\u4efb\u52a1\uff08\u53ef\u4ee5\u662f\u8fdb\u7a0b\u6216\u7ebf\u7a0b\uff09\u5728\u540c\u4e00\u65f6\u95f4\u6bb5\u5185\u6267\u884c\uff0c\u901a\u8fc7\u5408\u7406\u7684\u8c03\u5ea6\u548c\u8d44\u6e90\u5206\u914d\u6765\u63d0\u9ad8\u7cfb\u7edf\u7684\u6548\u7387\u548c\u6027\u80fd\u3002\u5e76\u53d1\u7f16\u7a0b\u9700\u8981\u8003\u8651\u540c\u6b65\u3001\u4e92\u65a5\u3001\u6b7b\u9501\u7b49\u95ee\u9898\uff0c\u4ee5\u786e\u4fdd\u591a\u4e2a\u4efb\u52a1\u4e4b\u95f4\u7684\u6b63\u786e\u534f\u4f5c\u548c\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <p>\u4e00\u4e9b\u6982\u5ff5\u548c\u4f7f\u7528\u533a\u5206\u5982\u4e0b\uff1a</p> <ol> <li>IPC \u548c\u5e76\u53d1\u7f16\u7a0b\u7684\u5173\u7cfb\uff1a</li> <li>IPC \u662f\u5b9e\u73b0\u5e76\u53d1\u7f16\u7a0b\u7684\u91cd\u8981\u624b\u6bb5\u4e4b\u4e00\uff0c\u901a\u8fc7 IPC \u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u4efb\u52a1\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u548c\u901a\u4fe1\uff0c\u4ece\u800c\u534f\u540c\u5b8c\u6210\u67d0\u9879\u4efb\u52a1\u3002</li> <li> <p>\u5e76\u53d1\u7f16\u7a0b\u6d89\u53ca\u5230\u591a\u4e2a\u4efb\u52a1\u4e4b\u95f4\u7684\u534f\u4f5c\u548c\u8c03\u5ea6\uff0c\u800c IPC \u5219\u63d0\u4f9b\u4e86\u5b9e\u73b0\u8fd9\u79cd\u534f\u4f5c\u548c\u901a\u4fe1\u7684\u673a\u5236\u3002</p> </li> <li> <p>\u5e38\u89c1\u7684 IPC \u65b9\u6cd5\uff1a</p> </li> <li>\u7ba1\u9053\uff08Pipe\uff09\uff1a\u7528\u4e8e\u5b9e\u73b0\u7236\u5b50\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002</li> <li>\u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\uff1a\u7528\u4e8e\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u5f02\u6b65\u901a\u4fe1\u3002</li> <li>\u5171\u4eab\u5185\u5b58\uff08Shared Memory\uff09\uff1a\u7528\u4e8e\u5b9e\u73b0\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u3002</li> <li> <p>\u4fe1\u53f7\u91cf\uff08Semaphore\uff09\uff1a\u7528\u4e8e\u63a7\u5236\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\u3002</p> </li> <li> <p>\u5e76\u53d1\u7f16\u7a0b\u7684\u6982\u5ff5\uff1a</p> </li> <li>\u540c\u6b65\uff08Synchronization\uff09\uff1a\u63a7\u5236\u591a\u4e2a\u4efb\u52a1\u4e4b\u95f4\u7684\u6267\u884c\u987a\u5e8f\u548c\u4e92\u65a5\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u3002</li> <li>\u4e92\u65a5\uff08Mutual Exclusion\uff09\uff1a\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u4efb\u52a1\u53ef\u4ee5\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff0c\u4ee5\u907f\u514d\u6570\u636e\u7ade\u4e89\u3002</li> <li>\u6b7b\u9501\uff08Deadlock\uff09\uff1a\u591a\u4e2a\u4efb\u52a1\u56e0\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u8d44\u6e90\u800c\u65e0\u6cd5\u7ee7\u7eed\u6267\u884c\u7684\u72b6\u6001\u3002</li> </ol> <p>\u5728\u7f16\u7a0b\u65f6\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u7684\u9700\u6c42\u548c\u573a\u666f\u9009\u62e9\u5408\u9002\u7684 IPC \u65b9\u6cd5\u548c\u5e76\u53d1\u7f16\u7a0b\u6280\u672f\uff0c\u4ee5\u786e\u4fdd\u7a0b\u5e8f\u7684\u6b63\u786e\u6027\u3001\u9ad8\u6548\u6027\u548c\u53ef\u9760\u6027\u3002\u540c\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u5904\u7406\u5e76\u53d1\u7f16\u7a0b\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u540c\u6b65\u548c\u4e92\u65a5\u95ee\u9898\uff0c\u907f\u514d\u6b7b\u9501\u7b49\u60c5\u51b5\u7684\u53d1\u751f\u3002</p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#7","title":"7\uff5c\u6807\u51c6\u5e93\uff1a\u65e5\u671f\u3001\u65f6\u95f4\u4e0e\u5b9e\u7528\u51fd\u6570","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#8","title":"8\uff5c\u6807\u51c6\u5e93\uff1a\u65ad\u8a00\u3001\u9519\u8bef\u5904\u7406\u4e0e\u5bf9\u9f50","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_24","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/2.%20%E5%AE%9E%E6%88%98%E7%AF%87/%E6%A0%87%E5%87%86%E5%BA%93/example.html#_25","title":"\u81ea\u5b9a\u4e49\u6570\u636e\u5bf9\u9f50","text":"<p>\u8fd9\u91cc\uff0c\u5982\u4f55\u5728 C \u8bed\u8a00\u4e2d\u4e3a\u6570\u636e\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u5bf9\u9f50\u65b9\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u91c7\u7528\u81ea\u7136\u5bf9\u9f50\uff0c\u6765\u7ea6\u675f\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u4f7f\u7528 C11 \u63d0\u4f9b\u7684\u5173\u952e\u5b57 _Alignas \uff0c\u6765\u6839\u636e\u81ea\u8eab\u9700\u6c42\u4e3a\u6570\u636e\u6307\u5b9a\u7279\u6b8a\u7684\u5bf9\u9f50\u8981\u6c42\u3002</p> <p>\u5e76\u4e14\uff0c\u5934\u6587\u4ef6 stdalign.h \u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e0e\u5176\u5bf9\u5e94\u7684\u5b8f alignas\uff0c\u53ef\u4ee5\u7b80\u5316\u5173\u952e\u5b57\u7684\u4f7f\u7528\u8fc7\u7a0b\u3002\u6765\u770b\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdalign.h&gt;\n\nint main(void)\n{\n#if __alignas_is_defined == 1 &amp;&amp; __alignof_is_defined == 1\n    alignas(1024) int n = 1;\n    printf(\"The alignment of n is %zu\\n\", alignof(n));  // \"The alignment of n is 1024\"\n    printf(\"The address of n is: %p\\n\", &amp;n);    // \"The address of n is: 0x7ffe80658c00\".\n\n#endif\n    return 0;\n}\n</code></pre> <p>\u8fd9\u91cc\uff0c\u5728\u4ee3\u7801\u7684\u7b2c 6 \u884c\uff0c\u6211\u4eec\u9996\u5148\u901a\u8fc7\u9a8c\u8bc1\u5b8f\u5e38\u91cf __ alignas_is_defined \u4e0e __alignof_is_defined \u7684\u503c\u662f\u5426\u4e3a 1\uff0c\u6765\u5224\u65ad\u5f53\u524d\u7f16\u8bd1\u73af\u5883\u662f\u5426\u652f\u6301 alignas \u4e0e alignof \u8fd9\u4e24\u4e2a\u5b8f\u3002</p> <p>\u7d27\u63a5\u7740\uff0c\u5728\u4ee3\u7801\u7b2c 7 \u884c\uff0c\u901a\u8fc7\u5728\u53d8\u91cf n \u7684\u5b9a\u4e49\u4e2d\u6dfb\u52a0 alignas(1024) \u6807\u8bc6\u7b26\uff0c\u6211\u4eec\u53ef\u4ee5\u9650\u5b9a\uff0c\u53d8\u91cf n \u7684\u503c\u88ab\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u65f6\uff0c\u5176\u8d77\u59cb\u5730\u5740\u5fc5\u987b\u4e3a 1024 \u7684\u500d\u6570\u3002\u800c\u5728\u63a5\u4e0b\u6765\u4ee3\u7801\u7684\u7b2c 8~9 \u884c\uff0c\u6211\u4eec\u5206\u522b\u901a\u8fc7\u4f7f\u7528 alignof \u5b8f\u51fd\u6570\u548c\u76f4\u63a5\u67e5\u770b\u5730\u5740\u8fd9\u4e24\u79cd\u65b9\u5f0f\uff0c\u6765\u9a8c\u8bc1\u6211\u4eec\u5bf9\u53d8\u91cf n \u6307\u5b9a\u7684\u5bf9\u9f50\u65b9\u5f0f\u662f\u5426\u751f\u6548\u3002</p> <p>\u540c alignas \u7c7b\u4f3c\u7684\u662f\uff0c\u5b8f\u51fd\u6570 alignof \u5728\u5c55\u5f00\u540e\u4e5f\u4f1a\u76f4\u63a5\u5bf9\u5e94\u4e8e C11 \u65b0\u5f15\u5165\u7684\u8fd0\u7b97\u7b26\u5173\u952e\u5b57 _Alignof\uff0c\u800c\u8be5\u5173\u952e\u5b57\u53ef\u7528\u4e8e\u67e5\u770b\u6307\u5b9a\u53d8\u91cf\u9700\u8981\u6ee1\u8db3\u7684\u5bf9\u9f50\u65b9\u5f0f\u3002\u5e76\u4e14\uff0c\u901a\u8fc7\u6253\u5370\u53d8\u91cf n \u7684\u5730\u5740\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7ed3\u5c3e\u5904\u7684\u4e09\u4f4d 16 \u8fdb\u5236\u6570\u5b57 \u201cc00\u201d\uff0c\u4e5f\u8868\u793a\u8be5\u5730\u5740\u5df2\u7ecf\u5728 1024 \u7684\u8fb9\u754c\u4e0a\u5bf9\u9f50\u3002</p> <p>\u8868\u9762\u4e0a\u770b\uff0calignas \u53ea\u662f\u7528\u6765\u4fee\u6539\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u5bf9\u9f50\u65b9\u5f0f\u7684\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u5408\u7406\u5730\u8fd0\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f18\u5316\u7a0b\u5e8f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u7684\u8fd0\u884c\u65f6\u6027\u80fd\u3002\u5728\u4e0b\u4e00\u8bb2\u4e2d\uff0c\u6211\u4f1a\u4e3a\u4f60\u8be6\u7ec6\u4ecb\u7ecd\u8fd9\u4e9b\u5185\u5bb9\u3002</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html","title":"Example","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#1","title":"1\uff5c\u53ef\u6267\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\u91cc\u6709\u4ec0\u4e48\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#2","title":"2\uff5c\u8fdb\u7a0b\u662f\u5982\u4f55\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u7684\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#3","title":"3\uff5c\u7f16\u8bd1\u5668\u5728\u94fe\u63a5\u7a0b\u5e8f\u65f6\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u7f16\u8bd1\u5668\uff1a</p> <ol> <li>\u8bcd\u6cd5\u5206\u6790\uff1a\u63d0\u53d6\u51fa\u6bcf\u4e00\u4e2a\u5355\u8bcd\u5b57\u7b26</li> <li>\u8bed\u6cd5\u5206\u6790\uff1a\u8fd9\u4e9btoken\u60f3\u8868\u8fbe\u4ec0\u4e48\u610f\u601d</li> <li>\u8bed\u4e49\u5206\u6790\uff1a\u8bed\u6cd5\u6811\u662f\u5426\u5408\u7406</li> <li>\u751f\u6210\u4e2d\u95f4\u4ee3\u7801\uff1a\u6839\u636e\u8bed\u6cd5\u6811\u751f\u6210\u4e2d\u95f4\u4ee3\u7801</li> <li>\u4e2d\u95f4\u4ee3\u7801\u4f18\u5316</li> <li>\u4ee3\u7801\u751f\u6210</li> </ol>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#4","title":"4\uff5c\u7a0b\u5e8f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u94fe\u63a5\u5417\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#5c-main","title":"5\uff5cC \u7a0b\u5e8f\u7684\u5165\u53e3\u771f\u7684\u662f main \u51fd\u6570\u5417\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#_1","title":"\u601d\u8003\u9898","text":"<p>\u5982\u4f55\u7406\u89e3 Linux Shell \u4e2d\u7a0b\u5e8f\u7684\u5904\u7406\u8fc7\u7a0b\uff1f\u53ef\u4ee5\u81ea\u5df1\u5199\u4e00\u4e2a\uff1f\u770b\u770b\u8d44\u6599\uff1f</p> <p>\u3010\u6280\u672f\u6742\u8c08\u3011shell\u548cterminal_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#6abi-api","title":"6\uff5cABI \u4e0e API \u7a76\u7adf\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":""},{"location":"language/C_asm/Other%20courses/In-depth%20complication%20and%20linking/3.%20%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E7%AF%87/example.html#7","title":"7\uff5c\u7a0b\u5e8f\u5982\u4f55\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4ea4\u4e92\uff1f","text":""},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html","title":"Func","text":""},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#opf-programming","title":"OPF Programming","text":"<p>OPF Programming (opf-programming.github.io)</p> <p></p> <ul> <li> <p>\u4e00</p> <p>\u6a21\u5757\u5316\u7f16\u7a0b\uff1a\u5b66\u4e60\u4f7f\u7528struct\u7684\u672c\u8d28</p> <p>C\u7ed3\u6784\u4f53\u7684\u672c\u8d28 - \u5199\u7a0b\u5e8f\u8bb2\u89e3_\u54d4\u54e9\u54d4\u54e9_bilibili</p> </li> <li> <p>\u70b9\u4e94</p> <ul> <li> <p>\u51fd\u6570\u6307\u9488\u7684\u6838\u5fc3\u7528\u6cd5</p> <p>\u4e00\u70b9\u4e94\u7f16\u7a0b\u7684\u6838\u5fc3\u6280\u5de7 - \u51fd\u6570\u6307\u9488\u7684\u6b63\u786e\u7528\u6cd5_\u54d4\u54e9\u54d4\u54e9_bilibili</p> </li> <li> <p>\u8bc6\u522b\u6a21\u5f0f</p> <p>C\u8bed\u8a00\u6307\u9488\u9ad8\u7ea7\u7528\u6cd5 \u5165\u95e8\u8bfe - \u8bc6\u522b\u6a21\u5f0f_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u95ed\u5305\uff0cLambda\u8868\u8fbe\u5f0f\uff0c\u548c\u51fd\u6570\u6307\u9488\u7684\u533a\u522b - \u5199JS\u548cC\u7a0b\u5e8f\u89e3\u91ca_\u54d4\u54e9\u54d4\u54e9_bilibili</p> </li> </ul> </li> </ul>"},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#function-pointer-polymorphism","title":"Function pointer &amp; Polymorphism","text":""},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#implementation","title":"Implementation","text":"<pre><code>//printer.h\n#ifndef _PRINTER_H\n#define _PRINTER_H\n\ntypedef void (*printer_print_fn)(void *printer, const char *str);\n\nstruct printer_i {\n    printer_print_fn print;\n};\n\n#endif\n</code></pre> <pre><code>// color_printer.c\n\nstruct color_printer {\n    const struct printer_i *interface;\n    int enable_color;\n    const char *color_command;\n    char *buf;\n};\n\nvoid color_printer_print(struct color_printer *self, const char *str);\n\nstatic const struct printer_i printer_interface = {\n    .print = (printer_print_fn)color_printer_print,\n};\n\nstruct color_printer *color_printer_new(const char *color_command) {\n    struct color_printer *self;\n\n    self = malloc(sizeof(struct color_printer));\n    assert(self != NULL);\n\n    self-&gt;interface = &amp;printer_interface;\n    self-&gt;color_command = color_command == NULL ? \"\\033[31;40m\" : color_command;\n    self-&gt;enable_color = 1;\n\n    self-&gt;buf = malloc(100);\n    assert(self-&gt;buf != NULL);\n\n    return self;\n}\n\nvoid color_printer_cleanup(struct color_printer *self) {\n    free(self-&gt;buf);\n    free(self);\n}\n\nvoid color_printer_print(struct color_printer *self, const char *str) {\n    if (self-&gt;enable_color) {\n        printf(\"%s%s\\033[0m\", self-&gt;color_command, str);\n    } else {\n        printf(\"%s\", str);\n    }\n}\n\nvoid color_printer_disable_color(struct color_printer *self) {\n    self-&gt;enable_color = 0;\n}\n</code></pre> <pre><code>//plain_printer.c\nstruct plain_printer {\n    const struct printer_i *interface;\n    const char *prefix;\n};\n\nvoid plain_printer_print(struct plain_printer *self, const char *str);\n\nstatic const struct printer_i printer_interface = {\n    .print = (printer_print_fn)plain_printer_print,\n};\n\nstruct plain_printer *plain_printer_new(const char *prefix) {\n    struct plain_printer *self;\n\n    self = malloc(sizeof(struct plain_printer));\n    assert(self != NULL);\n\n    self-&gt;interface = &amp;printer_interface;\n    self-&gt;prefix = prefix;\n\n    return self;\n}\n\nvoid plain_printer_cleanup(struct plain_printer *self) {\n    free(self);\n}\n\nvoid plain_printer_print(struct plain_printer *self, const char *str) {\n    printf(\"%s%s\", self-&gt;prefix, str);\n}\n</code></pre> <pre><code>//main.c\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"printer.h\"\n#include \"color_printer.h\"\n#include \"plain_printer.h\"\n\nint main(int argc, char *argv[]) {\n    struct plain_printer *p1;\n    struct plain_printer *p2;\n\n    struct color_printer *p3;\n    struct color_printer *p4;\n\n    struct printer_i **p;\n\n    printf(\"\\n\\n\");\n    p1 = plain_printer_new(\"&gt;&gt;&gt; \");\n    p2 = plain_printer_new(\"~~~ \");\n    p3 = color_printer_new(\"\\033[31;47m\");  //\u524d\u666f\u662f\u7ea2\u8272\uff0c\u80cc\u666f\u662f\u767d\u8272\n    p4 = color_printer_new(\"\\033[30;42m\");  //\u524d\u666f\u662f\u9ed1\u8272\uff0c\u6bd5\u7adf\u662f\u7eff\u8272\n\n\n    p = (struct printer_i **)p1;\n    (*p)-&gt;print(p, \"hello from p1.\");\n\n    p = (struct printer_i **)p2;\n    (*p)-&gt;print(p, \"hello from p2.\");\n\n    p = (struct printer_i **)p3;\n    (*p)-&gt;print(p, \"hello from p3.\");\n\n    p = (struct printer_i **)p4;\n    (*p)-&gt;print(p, \"hello from p4.\");\n\n    color_printer_disable_color(p4);\n\n    (*p)-&gt;print(p, \"hello from p4.\");\n\n\n    printf(\"\\n\\n\");\n\n    plain_printer_cleanup(p1);\n    plain_printer_cleanup(p2);\n    color_printer_cleanup(p3);\n    color_printer_cleanup(p4);\n\n    return 0;\n}\n</code></pre>"},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#recognize-patterns","title":"Recognize patterns","text":"<p>\u5173\u952e\uff1a/ \u6307\u5411struct\u7684\u6307\u9488\u53ef\u4ee5\u8f6c\u6362\u4e3a\u6307\u5411struct\u7684\u7b2c\u4e00\u4e2a\u6210\u5458\u7684\u7684\u6307\u9488 /</p> <p></p> <ul> <li> <p>Q1\uff1a\u4e3a\u4ec0\u4e48\u8981\u7528struct printer_i \u4e8c\u91cd\u6307\u9488\uff1f\u8fd9\u4e2a\u4e8c\u91cd\u6307\u9488\u7684\u542b\u4e49\u662f\u4ec0\u4e48\uff1f</p> <p>\u9996\u5148\u8fd9\u4e2a <code>print</code> \u6307\u9488\uff0c\u6307\u5411\u7684\u8981\u4e48\u662f <code>plain_printer_print</code>\uff0c\u8981\u4e48\u662f <code>color_printer_print</code>\u3002</p> <p>\u4ee5 <code>plain_printer_print</code> \u4e3a\u4f8b\uff0c\u5b83\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f struct plain_printer * \uff0c</p> <p>\u7531\u4e8e struct plain_printer \u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\uff08offset\u4e3a0\u7684\u5730\u65b9\uff09\u662f\u4e00\u4e2a struct printer_i * ,\u6240\u4ee5 <code>struct plain_printer *</code> \u53ef\u4ee5\u770b\u505a\u4e00\u4e2a  <code>struct printer_i **</code> \u3002 </p> <p>\u540c\u7406 <code>struct color_printer *</code> \u4e5f\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a  <code>struct printer_i **</code> \u3002    </p> <p>\u7528\u540c\u4e00\u4e2a\u7c7b\u578b\u628a\u4e0d\u540c\u7ed3\u6784\u4f53\u7edf\u4e00\u8d77\u6765\u4e86\uff0c\u8fd9\u5c31\u662f\u8fd9\u4e2a\u505a\u6cd5\u5de7\u5999\u7684\u5730\u65b9\u3002</p> </li> <li> <p>Q2\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528p1-&gt;interface-&gt;print(p1, \"hello from p1\")\uff0c\u8fd9\u6837\u5b50\u5199\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u8fd8\u6709\u4e3a\u4ec0\u4e48\u8981\u641e\u4e00\u4e2astruct_i\u88c5\u6307\u9488\u51fd\u6570\uff0c\u76f4\u63a5\u5728color/plain\u7684\u7ed3\u6784\u4f53\u91cc\u521b\u5efa\u4e0d\u597d\u5417\uff1f</p> <ol> <li> <p>\u5bf9\u4e8e\u67d0\u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u7684\u53c2\u6570\u540c\u65f6\u80fd\u652f\u6301\u4f20\u5165 <code>color_printer</code> \u548c <code>plain_printer</code>\uff0c\u8fd9\u4e2a\u65f6\u5019\u4e8c\u91cd\u6307\u9488\u7684\u4ef7\u503c\u5c31\u51f8\u663e\u51fa\u6765\u4e86\u3002</p> <p>\u4e5f\u5c31\u6709\u70b9\u50cf\u591a\u6001\u4e86\uff0c\u201c\u4e0d\u540c\u7684\u5bf9\u8c61\u5bf9\u540c\u4e00\u4e2a\u6d88\u606f\u505a\u51fa\u4e0d\u540c\u7684\u54cd\u5e94\u201d\u3002</p> </li> <li> <p>\u5047\u5982\uff1a\u53ea\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53</p> <pre><code>struct count_normal\n{\n    int count;\n    int add;\n    void (*count_add)(struct count_normal *P);\n};\n\nvoid app(struct count_normal **c);\n</code></pre> <p>\u90a3\u4ee5\u540e\u5982\u679c\u5b9a\u4e49\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684\u7ed3\u6784\u4f53\uff08\u4e0d\u540c\u7684\u5bf9\u8c61\uff1a\u732b/\u72d7\uff09\uff0c\u4f60\u5c31\u4f1a\u53d1\u73b0\uff0c\u4e0d\u77e5\u9053 app \u7684\u53c2\u6570\u5e94\u8be5\u7ed9\u4ec0\u4e48\u7c7b\u578b\u4e86\u3002 </p> <p>\u8fd9\u91cc\u4e4b\u6240\u4ee5\u6709 <code>counter_i</code>\uff0c\u5c31\u662f\u4e3a\u4e86\u505a\u4e00\u5c42\u62bd\u8c61\uff0c</p> <p>\u4e0d\u7ba1\u4f60\u7ed3\u6784\u4f53\u600e\u4e48\u5b9a\u4e49\u7684\uff0c\u6709\u54ea\u4e9b\u65b9\u6cd5\uff0c\u53ea\u8981\u6211\u6700\u7ec8\u80fd\u591f\u901a\u8fc7 <code>(*p)-&gt;fn(p)</code> \u6765\u4f7f\u7528\uff0c\u90a3\u4e48\u4f60\u5c31\u80fd\u628a\u5b83\u4f20\u7ed9 app \u51fd\u6570\u3002</p> </li> </ol> </li> <li> <p>Supplement: \u591a\u6001(Polymorphism)</p> <p>\u591a\u6001\u662f\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\uff0c\u5b83\u5141\u8bb8\u4e0d\u540c\u7684\u5bf9\u8c61\u5bf9\u540c\u4e00\u4e2a\u6d88\u606f\u505a\u51fa\u4e0d\u540c\u7684\u54cd\u5e94\u3002\u7b80\u800c\u8a00\u4e4b\uff0c\u591a\u6001\u6027\u5141\u8bb8\u540c\u4e00\u4e2a\u51fd\u6570\u540d\u6216\u65b9\u6cd5\u540d\u5728\u4e0d\u540c\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4e0a\u8868\u73b0\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\u3002</p> <p>\u5728\u9762\u5411\u5bf9\u8c61\u7684\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u591a\u6001\u6027\u901a\u5e38\u901a\u8fc7\u7ee7\u627f\u548c\u91cd\u5199\u6765\u5b9e\u73b0\u3002\u5f53\u5b50\u7c7b\u91cd\u5199\u7236\u7c7b\u7684\u65b9\u6cd5\u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u7684\u5bf9\u8c61\u7c7b\u578b\u6765\u8c03\u7528\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p> <p>\u4e3e\u4e2a\u6bd4\u8f83\u751f\u52a8\u7684\u4f8b\u5b50\u6765\u89e3\u91ca\u591a\u6001\u6027\uff1a\u5047\u8bbe\u6709\u4e00\u4e2a\u52a8\u7269\u7c7b\uff0c\u5b83\u6709\u4e00\u4e2a\u65b9\u6cd5\u53eb\u505a\u201c\u53d1\u51fa\u58f0\u97f3\u201d\u3002\u7136\u540e\u6709\u4e24\u4e2a\u5b50\u7c7b\uff0c\u4e00\u4e2a\u662f\u72d7\u7c7b\uff0c\u4e00\u4e2a\u662f\u732b\u7c7b\uff0c\u5b83\u4eec\u5206\u522b\u91cd\u5199\u4e86\u201c\u53d1\u51fa\u58f0\u97f3\u201d\u7684\u65b9\u6cd5\u3002\u5f53\u6211\u4eec\u5bf9\u4e00\u4e2a\u72d7\u5bf9\u8c61\u548c\u4e00\u4e2a\u732b\u5bf9\u8c61\u8c03\u7528\u201c\u53d1\u51fa\u58f0\u97f3\u201d\u65b9\u6cd5\u65f6\uff0c\u7531\u4e8e\u591a\u6001\u6027\u7684\u5b58\u5728\uff0c\u72d7\u5bf9\u8c61\u4f1a\u53d1\u51fa\u201c\u6c6a\u6c6a\u201d\u7684\u58f0\u97f3\uff0c\u800c\u732b\u5bf9\u8c61\u4f1a\u53d1\u51fa\u201c\u55b5\u55b5\u201d\u7684\u58f0\u97f3\uff0c\u5c3d\u7ba1\u5b83\u4eec\u8c03\u7528\u7684\u662f\u540c\u4e00\u4e2a\u65b9\u6cd5\u3002</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u7531\u4e8e\u5176\u8f83\u4e3a\u5e95\u5c42\u7684\u7279\u6027\uff0c\u6ca1\u6709\u76f4\u63a5\u7684\u7c7b\u548c\u5bf9\u8c61\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u5b9e\u73b0\u591a\u6001\u6027\u9700\u8981\u901a\u8fc7\u51fd\u6570\u6307\u9488\u6216\u8005\u7ed3\u6784\u4f53\u6307\u9488\u6765\u6a21\u62df\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a</p> <p><pre><code>#include &lt;stdio.h&gt;\n\n// \u5b9a\u4e49\u52a8\u7269\u7ed3\u6784\u4f53\ntypedef struct {\n    void (*makeSound)(); // \u51fd\u6570\u6307\u9488\uff0c\u6a21\u62df\u53d1\u51fa\u58f0\u97f3\u7684\u65b9\u6cd5\n} Animal;\n\n// \u72d7\u7684\u53d1\u51fa\u58f0\u97f3\u65b9\u6cd5\nvoid dogSound() {\n    printf(\"\u6c6a\u6c6a\\n\");\n}\n\n// \u732b\u7684\u53d1\u51fa\u58f0\u97f3\u65b9\u6cd5\nvoid catSound() {\n    printf(\"\u55b5\u55b5\\n\");\n}\n\nint main() {\n    Animal dog;\n    dog.makeSound = &amp;dogSound; // \u5c06\u53d1\u51fa\u58f0\u97f3\u7684\u65b9\u6cd5\u6307\u5411\u72d7\u7684\u53d1\u51fa\u58f0\u97f3\u65b9\u6cd5\n    Animal cat;\n    cat.makeSound = &amp;catSound; // \u5c06\u53d1\u51fa\u58f0\u97f3\u7684\u65b9\u6cd5\u6307\u5411\u732b\u7684\u53d1\u51fa\u58f0\u97f3\u65b9\u6cd5\n\n    // \u901a\u8fc7\u8c03\u7528\u76f8\u540c\u7684\u65b9\u6cd5\u540d\uff0c\u5b9e\u73b0\u4e0d\u540c\u7684\u884c\u4e3a\n    dog.makeSound(); // \u8f93\u51fa\uff1a\u6c6a\u6c6a\n    cat.makeSound(); // \u8f93\u51fa\uff1a\u55b5\u55b5\n\n    return 0;\n}\n</code></pre> </p> </li> </ul>"},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#closure","title":"Closure","text":"<pre><code>#include &lt;stdio.h&gt;\n\ntypedef int(*increase_fn)(void *counter);\n\nstruct counter_i\n{\n    increase_fn increase;\n};\n\n\n/*\n * normal counter \n *\n */\n/* \u6307\u5411struct\u7684\u6307\u9488\u53ef\u4ee5\u8f6c\u6362\u4e3a\u6307\u5411struct\u7684\u7b2c\u4e00\u4e2a\u6210\u5458\u7684\u7684\u6307\u9488 */\nstruct normal_counter\n{\n    const struct counter_i *interface;\n    int count;\n};\n\nint normal_counter_increase(struct normal_counter *self);\n\nstatic struct counter_i normal_counter_interface = {\n    .increase = (increase_fn)normal_counter_increase,\n};\n\nvoid normal_counter_init(struct normal_counter *self)\n{\n    self-&gt;count = 0;\n    self-&gt;interface = &amp;normal_counter_interface;\n}\n\nint normal_counter_increase(struct normal_counter *self)\n{\n    return self-&gt;count++;\n}\n\n\n/*\n * skip counter\n */\nstruct skip_counter\n{\n    const struct counter_i *interface;\n    int count;\n};\n\nint skip_counter_increase(struct skip_counter *self);\n\nstatic struct counter_i skip_counter_interface = {\n    .increase = (increase_fn)skip_counter_increase,\n};\n\nvoid skip_counter_init(struct skip_counter *self)\n{\n    self-&gt;count = 0;\n    self-&gt;interface = &amp;skip_counter_interface;\n}\n\nint skip_counter_increase(struct skip_counter *self)\n{\n    int r;\n    r = self-&gt;count;\n    self-&gt;count += 2;\n    return r;\n}\n\n\nvoid app(struct counter_i **c, const char *prefix)\n{\n    int i = 0, r;\n    for(i = 0; i &lt; 2; i++)\n    {\n        r = (*c)-&gt;increase(c);\n        printf(\"%s is now %d\\n\", prefix, r);\n    }\n}\n\n\nint main(int argc, char **argv)\n{\n    struct normal_counter counter0;\n    struct normal_counter counter1;\n    struct skip_counter counter2;\n\n    normal_counter_init(&amp;counter0);\n    normal_counter_init(&amp;counter1);\n    skip_counter_init(&amp;counter2);\n\n    app((struct counter_i **)&amp;counter0, \"0\");\n    app((struct counter_i **)&amp;counter1, \"1\");\n    app((struct counter_i **)&amp;counter2, \"2\");\n\n    return 0;\n}\n</code></pre> <p>\u5185\u5bb9\u5176\u5b9e\u548c\u4e0a\u9762\u51fd\u6570\u6307\u9488\u90a3\u90e8\u5206\u7684\u5185\u5bb9\u5f88\u50cf\uff01</p>"},{"location":"language/C_asm/Other%20courses/opf-proagramming/base/func.html#_1","title":"\u8865\u5145\u8d44\u6599","text":"<p>\u627e\u5230\u4e86 12 \u7bc7\u8d44\u6599\u4f5c\u4e3a\u53c2\u8003\uff1a</p> <p>\u6b63\u5728\u5c1d\u8bd5\u4e3a\u60a8\u5728\u4e92\u8054\u7f51\u641c\u7d22\u76f8\u5173\u8d44\u6599...</p> <p>\u5f00\u59cb\u83b7\u53d6\u8d44\u6599...</p> <p>\u627e\u5230\u4e86\u7b2c 1 \u7bc7\u8d44\u6599\uff1aGitHub Top 10 + C \u8bed\u8a00\u5f00\u6e90\u9879\u76ee\uff082021\u7248\uff09 - \u77e5\u4e4e</p> <p>\u627e\u5230\u4e86\u7b2c 2 \u7bc7\u8d44\u6599\uff1a\u8be6\u89e3\u5d4c\u5165\u5f0fC\u8bed\u8a00\u7684\u51fd\u6570\u6307\u9488\u4e0e\u56de\u8c03\u51fd\u6570 - \u77e5\u4e4e</p> <p>\u627e\u5230\u4e86\u7b2c 3 \u7bc7\u8d44\u6599\uff1aClosuresKit\uff1a\u5f3a\u5927\u7684Swift\u95ed\u5305\u5de5\u5177\u5e93-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 4 \u7bc7\u8d44\u6599\uff1a\u7ed3\u6784\u4f53\u6307\u9488\uff0cC\u8bed\u8a00\u7ed3\u6784\u4f53\u6307\u9488\u8be6\u89e3</p> <p>\u627e\u5230\u4e86\u7b2c 5 \u7bc7\u8d44\u6599\uff1a\u3010\u6bcf\u65e5\u7cbe\u9009\u65f6\u523b\u3011EdgeOne\u4e0eHAI\u7684\u68a6\u5e7b\u8054\u52a8\uff1bGo\u8bed\u8a00\u5b66\u4e60 ...</p> <p>\u627e\u5230\u4e86\u7b2c 6 \u7bc7\u8d44\u6599\uff1aC\u5f00\u6e90\u9879\u76ee\u6392\u884c\u699c, GitHub\u4e0a\u6700\u53d7\u6b22\u8fce\u7684C\u9879\u76ee\u63a8\u8350 | GitHub ...</p> <p>\u627e\u5230\u4e86\u7b2c 7 \u7bc7\u8d44\u6599\uff1aC\u8bed\u8a00\u4e0e\u6570\u5b66\u5e93\u63a5\u53e3\uff1a\u4f7f\u7528GSL\u3001BLAS/LAPACK\u8fdb\u884c\u6570\u503c ...</p> <p>\u627e\u5230\u4e86\u7b2c 8 \u7bc7\u8d44\u6599\uff1aC\u8bed\u8a00\u4e2d\u95ed\u5305\u7684\u63a2\u7a76\u53ca\u6bd4\u8f83 - \u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a</p> <p>\u627e\u5230\u4e86\u7b2c 9 \u7bc7\u8d44\u6599\uff1a\u7ed3\u6784\u4f53\u6570\u7ec4\u4e0e\u6307\u9488\u4e0e\u51fd\u6570\u53ca\u5e94\u7528\u6848\u4f8b_\u7ed3\u6784\u4f53\u6307\u9488\u51fd\u6570-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 10 \u7bc7\u8d44\u6599\uff1aC\u8bed\u8a00\u51fd\u6570\u6307\u9488\uff08\u7ed3\u6784\u4f53\u51fd\u6570\u6307\u9488\uff09 - CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 11 \u7bc7\u8d44\u6599\uff1aC\u8bed\u8a00\u7ed3\u6784\u4f53\u4e2d\u7684\u51fd\u6570\u6307\u9488 - wuyudong - \u535a\u5ba2\u56ed</p> <p>\u627e\u5230\u4e86\u7b2c 12 \u7bc7\u8d44\u6599\uff1aC\u8bed\u8a00\u4e2d\u7ed3\u6784\u4f53\u5728\u51fd\u6570\u4e2d\u7684\u5e94\u7528_c\u8bed\u8a00\u7ed3\u6784\u4f53\u7528\u4e8e\u51fd\u6570-CSDN\u535a\u5ba2</p> <p>\u4e00\u5171\u627e\u5230 12 \u7bc7\u8d44\u6599\uff0c\u6b63\u5728\u9605\u8bfb...</p> <p>\u627e\u5230\u4e86 12 \u7bc7\u8d44\u6599\u4f5c\u4e3a\u53c2\u8003\uff1a</p> <p>\u5728\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528\u7ed3\u6784\u4f53\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\u7684\u7ed3\u5408\u53ef\u4ee5\u5e26\u6765\u5f88\u591a\u5b9e\u9645\u7684\u597d\u5904\uff0c\u5b83\u4eec\u53ef\u4ee5\u89e3\u51b3\u4e00\u4e9b\u7279\u5b9a\u7684\u95ee\u9898\uff0c\u5e76\u5728\u8bb8\u591a\u5927\u578b\u5f00\u6e90\u9879\u76ee\u4e2d\u5f97\u5230\u5e94\u7528\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5177\u4f53\u7684\u4f8b\u5b50\u548c\u5e94\u7528\u573a\u666f\uff1a</p> <ol> <li>\u56de\u8c03\u673a\u52362: \u56de\u8c03\u51fd\u6570\u662fC\u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\uff0c\u5b83\u5141\u8bb8\u5c06\u4e00\u4e2a\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u53e6\u4e00\u4e2a\u51fd\u6570\u3002\u8fd9\u79cd\u505a\u6cd5\u5728\u9700\u8981\u52a8\u6001\u51b3\u5b9a\u6267\u884c\u54ea\u4e2a\u51fd\u6570\u65f6\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\uff0c\u5728\u4e8b\u4ef6\u9a71\u52a8\u7684\u7f16\u7a0b\u4e2d\uff0c\u5f53\u67d0\u4e2a\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u7cfb\u7edf\u53ef\u80fd\u9700\u8981\u6267\u884c\u591a\u4e2a\u4e0d\u540c\u7684\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u53ef\u4ee5\u901a\u8fc7\u51fd\u6570\u6307\u9488\u4f5c\u4e3a\u56de\u8c03\u4f20\u9012\u7ed9\u4e8b\u4ef6\u5904\u7406\u7cfb\u7edf\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u5f88\u591a\u5927\u578b\u9879\u76ee\u4e2d\u90fd\u6709\u5e94\u7528\uff0c\u5982\u64cd\u4f5c\u7cfb\u7edf\u7684\u9a71\u52a8\u7a0b\u5e8f\u5f00\u53d1\u3001\u7f51\u7edc\u7f16\u7a0b\u4e2d\u7684\u5f02\u6b65I/O\u5904\u7406\u7b49\u3002</li> <li>\u7b56\u7565\u6a21\u5f0f11: \u5728\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\uff0c\u7b56\u7565\u6a21\u5f0f\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u4f7f\u7528\u7ed3\u6784\u4f53\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\u7684\u6a21\u5f0f\u3002\u5b83\u5141\u8bb8\u5728\u8fd0\u884c\u65f6\u9009\u62e9\u7b97\u6cd5\u7684\u884c\u4e3a\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u64cd\u4f5c\u7684\u7ed3\u6784\u4f53\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u6307\u5411\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\u7684\u51fd\u6570\u3002\u8fd9\u6837\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u6bcf\u4e2a\u7b56\u7565\u90fd\u6709\u81ea\u5df1\u5b9e\u73b0\u7684\u64cd\u4f5c\u51fd\u6570\u3002\u5728\u5927\u578b\u9879\u76ee\u4e2d\uff0c\u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u53ef\u63d2\u62d4\u7684\u7ec4\u4ef6\uff0c\u5982\u56fe\u5f62\u6e32\u67d3\u5f15\u64ce\u4e2d\u7684\u6e32\u67d3\u7b56\u7565\u3001\u6587\u672c\u7f16\u8f91\u5668\u4e2d\u7684\u4e0d\u540c\u6392\u5e8f\u7b97\u6cd5\u7b49\u3002</li> <li>\u6a21\u5757\u5316\u548c\u6269\u5c55\u60272: \u901a\u8fc7\u4f7f\u7528\u7ed3\u6784\u4f53\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\uff0c\u53ef\u4ee5\u589e\u52a0\u4ee3\u7801\u7684\u6a21\u5757\u5316\u548c\u6269\u5c55\u6027\u3002\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u5927\u578b\u7684\u8f6f\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u914d\u7f6e\u9009\u62e9\u4e0d\u540c\u7684\u5904\u7406\u6d41\u7a0b\u3002\u901a\u8fc7\u5b9a\u4e49\u4e00\u4e2a\u5904\u7406\u6d41\u7a0b\u7684\u7ed3\u6784\u4f53\uff0c\u5176\u4e2d\u5305\u542b\u51fd\u6570\u6307\u9488\uff0c\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u539f\u6709\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u66f4\u6362\u51fd\u6570\u6307\u9488\u6765\u6539\u53d8\u5904\u7406\u6d41\u7a0b\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u4e2d\u90fd\u6709\u5e94\u7528\uff0c\u5982Linux\u5185\u6838\u4e2d\u7684\u6a21\u5757\u5316\u9a71\u52a8\u7a0b\u5e8f\u3001\u5927\u578b\u6e38\u620f\u5f15\u64ce\u4e2d\u7684\u6e38\u620f\u903b\u8f91\u6a21\u5757\u7b49\u3002</li> <li>\u4ee3\u7801\u590d\u75288: \u7ed3\u6784\u4f53\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\u7684\u7ed3\u5408\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4ee3\u7801\u590d\u7528\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u901a\u7528\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5176\u4e2d\u5305\u542b\u51fd\u6570\u6307\u9488\uff0c\u7528\u4e8e\u5904\u7406\u6570\u636e\u3002\u7136\u540e\uff0c\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\uff0c\u5b9e\u73b0\u4e0d\u540c\u7684\u5904\u7406\u51fd\u6570\u3002\u8fd9\u6837\uff0c\u540c\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u7528\u4e8e\u591a\u79cd\u4e0d\u540c\u7684\u573a\u666f\uff0c\u800c\u65e0\u9700\u91cd\u590d\u7f16\u5199\u76f8\u540c\u7684\u4ee3\u7801\u3002\u5728\u5f00\u6e90\u9879\u76ee\u4e2d\uff0c\u8fd9\u79cd\u7528\u6cd5\u5e38\u89c1\u4e8e\u5e93\u7684API\u8bbe\u8ba1\uff0c\u5982\u8457\u540d\u7684\u6570\u5b66\u5e93GSL7\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u5957\u901a\u7528\u7684\u6570\u5b66\u51fd\u6570\uff0c\u5e76\u901a\u8fc7\u6e05\u6670\u7684\u63a5\u53e3\u548c\u51fd\u6570\u6307\u9488\u7684\u4f7f\u7528\uff0c\u4f7f\u5f97\u79d1\u5b66\u8ba1\u7b97\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u3002</li> </ol> <p>\u4ee5\u4e0a\u4f8b\u5b50\u5c55\u793a\u4e86\u7ed3\u6784\u4f53\u6307\u9488\u548c\u51fd\u6570\u6307\u9488\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u610f\u4e49\u548c\u89e3\u51b3\u95ee\u9898\u7684\u80fd\u529b\u3002\u901a\u8fc7\u8fd9\u4e9b\u6280\u672f\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u7f16\u5199\u51fa\u66f4\u52a0\u7075\u6d3b\u3001\u53ef\u6269\u5c55\u548c\u53ef\u7ef4\u62a4\u7684\u4ee3\u7801\u3002</p>"},{"location":"language/C_asm/asm_begin/example.html","title":"Example","text":"<p>\u6c47\u7f16\u8bed\u8a00\u5728\u7b80\u5355\u7cfb\u7edf\u5185\u6838\u91cc\u7684\u5e94\u7528_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <ol> <li>\u7b97\u6cd5\u3001\u4e0a\u5c42\u6570\u636e\u7ed3\u6784 ---&gt; C\u8bed\u8a00\u7b49\u9ad8\u7ea7\u8bed\u8a00</li> <li>\u5f15\u5bfc\u7a0b\u5e8f\u3001\u81ea\u65cb\u9501\u3001\u5185\u5b58\u6620\u5c04\u3001\u8fdb\u7a0b\u5207\u6362 ---&gt; \u6c47\u7f16\u8bed\u8a00</li> </ol>"},{"location":"language/C_asm/compile%20and%20linker/GCC%20option/gcc%20option.html","title":"Gcc option","text":"<p>gcc\u7684\u7f16\u8bd1\u9009\u9879(\u597d\u591a\u90fd\u53ef\u4ee5\u63d0\u9ad8\u6548\u7387\u7684)_-ffreestanding-CSDN\u535a\u5ba2</p> <p>GCC options_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"language/C_asm/compile%20and%20linker/Question/%E7%BC%96%E8%AF%91%E9%93%BE%E6%8E%A5.html","title":"\u7f16\u8bd1\u94fe\u63a5","text":""},{"location":"language/C_asm/compile%20and%20linker/Question/%E7%BC%96%E8%AF%91%E9%93%BE%E6%8E%A5.html#linuxc","title":"\u5173\u4e8eLinux\u4e0bC\u7f16\u8bd1\u62a5\u9519 \u95ee\u9898\u6392\u67e5\u7684\u601d\u8def","text":"<p>\u4e00\u5957\u89e3\u51b3\u7f16\u8bd1\u4f9d\u8d56\u9519\u8bef\u95ee\u9898\u7684\u7ec4\u5408\u62f3\u548c\u5de5\u5177\uff0c\u8ba9\u7f16\u8bd1\u95ee\u9898\u4e0d\u518d\u5934\u79c3_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u8bb0\u5f97\u8865\u5145\u4e00\u4e9b\u7f16\u8bd1\u94fe\u63a5\u7684\u77e5\u8bc6 \u300aC\u4e13\u5bb6\u7f16\u7a0b\u300b\uff1a\u7b2c5\u7ae0\uff0c\u5feb\u901f\u770b\u770b \u300aCASPP\u300b\uff1a\u7b2c7\u7ae0\u94fe\u63a5\uff0c\u4e09\u5341\u591a\u9875\uff0c\u8bb2\u7684\u4e0d\u6df1\u5165\uff0c\u4e5f\u53ef\u4ee5\u770b\u770b \uff08\u770b\u6e05\u534e\u9093\u535a\u58eb\u7684\u966a\u8dd1CSAPP\uff09 \u7a0b\u5e8f\u7684\u94fe\u63a5\u8fc7\u7a0b\u548c ELF \u683c\u5f0f\uff1a\u9605\u8bfb\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\u2014\u2014\u94fe\u63a5\u3001\u88c5\u8f7d\u548c\u5e93\u300b\u7684 1\uff5e4 \u7ae0\u3002 \u52a8\u6001\u94fe\u63a5\uff1a\u9605\u8bfb\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\uff1a\u94fe\u63a5\u3001\u88c5\u8f7d\u548c\u5e93\u300b\u7684\u7b2c 7 \u7ae0</p> <p>\u5f53\u5728Linux\u4e0b\u8fdb\u884cC\u7f16\u7a0b\u65f6\uff0c\u7f16\u8bd1\u62a5\u9519\u53ef\u80fd\u4f1a\u51fa\u73b0\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u95ee\u9898\u6392\u67e5\u7684\u601d\u8def\uff1a</p> <ol> <li>\u9605\u8bfb\u9519\u8bef\u4fe1\u606f\uff1a\u9996\u5148\u8981\u4ed4\u7ec6\u9605\u8bfb\u7f16\u8bd1\u5668\u63d0\u4f9b\u7684\u9519\u8bef\u4fe1\u606f\u3002\u9519\u8bef\u4fe1\u606f\u901a\u5e38\u4f1a\u6307\u51fa\u51fa\u73b0\u95ee\u9898\u7684\u6587\u4ef6\u3001\u884c\u53f7\u4ee5\u53ca\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u3002</li> <li>\u68c0\u67e5\u8bed\u6cd5\u9519\u8bef\uff1a\u68c0\u67e5\u4ee3\u7801\u4e2d\u7684\u8bed\u6cd5\u9519\u8bef\uff0c\u4f8b\u5982\u62fc\u5199\u9519\u8bef\u3001\u7f3a\u5c11\u5206\u53f7\u3001\u62ec\u53f7\u4e0d\u5339\u914d\u7b49\u3002</li> <li>\u67e5\u770b\u8b66\u544a\u4fe1\u606f\uff1a\u8b66\u544a\u4fe1\u606f\u53ef\u80fd\u9884\u793a\u7740\u6f5c\u5728\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u4e5f\u5e94\u8be5\u88ab\u5173\u6ce8\u3002\u6709\u65f6\u5019\u8b66\u544a\u4fe1\u606f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u540e\u7eed\u7684\u9519\u8bef\u3002</li> <li>\u67e5\u770b\u4f9d\u8d56\u5173\u7cfb\uff1a\u786e\u4fdd\u5934\u6587\u4ef6\u548c\u6e90\u6587\u4ef6\u7684\u4f9d\u8d56\u5173\u7cfb\u6b63\u786e\u3002\u5982\u679c\u5934\u6587\u4ef6\u6ca1\u6709\u6b63\u786e\u5305\u542b\u6216\u8005\u6e90\u6587\u4ef6\u6ca1\u6709\u6b63\u786e\u94fe\u63a5\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u9519\u8bef\u3002</li> <li>\u68c0\u67e5\u94fe\u63a5\u9519\u8bef\uff1a\u5982\u679c\u7f16\u8bd1\u901a\u8fc7\u4f46\u94fe\u63a5\u65f6\u51fa\u73b0\u9519\u8bef\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u67d0\u4e9b\u51fd\u6570\u6216\u53d8\u91cf\u672a\u5b9a\u4e49\u6216\u91cd\u590d\u5b9a\u4e49\u3002</li> <li>\u67e5\u770bMakefile\uff1a\u5982\u679c\u4f7f\u7528Makefile\u8fdb\u884c\u7f16\u8bd1\uff0c\u786e\u4fddMakefile\u4e2d\u7684\u89c4\u5219\u548c\u4f9d\u8d56\u5173\u7cfb\u6b63\u786e\u8bbe\u7f6e\u3002</li> <li>\u68c0\u67e5\u5e93\u6587\u4ef6\uff1a\u5982\u679c\u4f7f\u7528\u4e86\u5916\u90e8\u5e93\u6587\u4ef6\uff0c\u786e\u4fdd\u5e93\u6587\u4ef6\u8def\u5f84\u548c\u540d\u79f0\u6b63\u786e\u3002</li> <li>\u67e5\u770b\u7f16\u8bd1\u9009\u9879\uff1a\u68c0\u67e5\u7f16\u8bd1\u9009\u9879\u662f\u5426\u6b63\u786e\u8bbe\u7f6e\uff0c\u4f8b\u5982\u662f\u5426\u5305\u542b\u4e86\u5fc5\u8981\u7684\u5934\u6587\u4ef6\u8def\u5f84\u3001\u5e93\u8def\u5f84\u7b49\u3002</li> <li>\u4f7f\u7528\u8c03\u8bd5\u5de5\u5177\uff1a\u4f7f\u7528\u8c03\u8bd5\u5de5\u5177\uff08\u5982GDB\uff09\u6765\u8ddf\u8e2a\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\uff0c\u67e5\u627e\u9519\u8bef\u53d1\u751f\u7684\u539f\u56e0\u3002</li> <li>\u641c\u7d22\u5f15\u64ce\u548c\u793e\u533a\uff1a\u5982\u679c\u4ee5\u4e0a\u65b9\u6cd5\u90fd\u4e0d\u80fd\u89e3\u51b3\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528\u641c\u7d22\u5f15\u64ce\u67e5\u627e\u7c7b\u4f3c\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6216\u8005\u5728\u76f8\u5173\u7684\u793e\u533a\u5bfb\u6c42\u5e2e\u52a9\u3002</li> </ol> <pre><code>$ make\ncc -g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC   -c -o src/lcthw/list.o src/lcthw/list.c\nar rcs build/liblcthw.a src/lcthw/list.o\nranlib build/liblcthw.a\ncc -shared -o build/liblcthw.so src/lcthw/list.o\ncc -g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG  build/liblcthw.a    tests/list_tests.c   -o tests/list_tests\nsh ./tests/runtests.sh\nRunning unit tests:\n----\nRUNNING: ./tests/list_tests\nALL TESTS PASSED\nTests run: 6\ntests/list_tests PASS\n$\n\u8fd9\u662f\u522b\u4eba\u7f16\u8bd1\u51fa\u6765\u7684\n\n\u8fd9\u662f\u6211\u7f16\u8bd1\u51fa\u6765\u7684\uff1a\nar rcs build/list.a src/lcthw/list.o\nranlib build/list.a\ncc -g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC tests/list_tests.c build/list.a -o tests/list_tests\nIn file included from tests/list_tests.c:1:\ntests/list_tests.c: In function \u2018main\u2019:\ntests/minunit.h:15:38: warning: parameter \u2018argc\u2019 set but not used [-Wunused-but-set-parameter]\n   15 | #define RUN_TESTS(name) int main(int argc,  char *argv[]) {\\\n      |                                  ~~~~^~~~\ntests/list_tests.c:111:1: note: in expansion of macro \u2018RUN_TESTS\u2019\n  111 | RUN_TESTS(all_tests);\n      | ^~~~~~~~~\ncc -shared -o build/list.so src/lcthw/list.o\nsh ./tests/runtests.sh\nRunning unit tests:\n----\n----\nRUNNING: ./tests/list_tests\nALL TESTS PASSED!\nTests run:6\ntests/list_tests PASS\n----\nRUNNING: ./tests/list_tests\nALL TESTS PASSED!\nTests run:6\ntests/list_tests PASS\n----\nRUNNING: ./tests/list_tests\nALL TESTS PASSED!\nTests run:6\ntests/list_tests PASS\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u597d\u50cf\u6211\u4eec\u7684\u7f16\u8bd1\u547d\u4ee4\u987a\u5e8f\u4e0d\u4e00\u6837\uff0c\u4e3a\u4ec0\u4e48\u5462  \n\n\u8fd9\u662f\u6211\u7684makefile\u7684\u4e00\u90e8\u5206\n1 CFLAGS=-g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG $(OPTFLAGS)\n  2 LIBS=-ldl $(OPTLIBS)\n  3 PREFIX?=/usr/local\n  4 \n  5 SOURCES=$(wildcard src/**/*.c src/*.c)\n  6 OBJECTS=$(patsubst %.c,%.o,$(SOURCES))\n  7 \n  8 TEST_SRC=$(wildcard tests/*_tests.c)\n  9 TESTS=$(patsubst %.c,%,$(TEST_SRC))\n 10 # \u8fd9\u6b21\u7684\u95ee\u9898\u5e94\u8be5\u662f\u5934\u6587\u4ef6\u7684\u95ee\u9898\uff0c\u8981\u52a0\u4e0a\u7279\u5b9a\u7684\u76ee\u5f55\uff1f\n 11 TARGET=build/list.a\n 12 SO_TARGET=$(patsubst %.a,%.so,$(TARGET))\n 13 \n 14 # The Target Build\n 15 all: $(TARGET) $(SO_TARGET) tests\n 16 \n 17 dev: CFLAGS=-g -Wall -Isrc -Wall -Wextra $(OPTFLAGS)\n 18 dev: all\n 19 \n 20 $(TARGET): CFLAGS += -fPIC\n 21 $(TARGET): build $(OBJECTS)\n 22         ar rcs $@ $(OBJECTS)\n 23         ranlib $@\n 24         $(CC) $(CFLAGS) $(TEST_SRC) $(TARGET) -o tests/list_tests\n 25 \n 26 \n 27 $(SO_TARGET): $(TARGET) $(OBJECTS)\n 28         $(CC) -shared -o $@ $(OBJECTS)\n 29 \n 30 build:\n 31         @mkdir -p build\n 32         @mkdir -p bin\n</code></pre> <p>\u6839\u636e\u60a8\u63d0\u4f9b\u7684Makefile\u548c\u7f16\u8bd1\u8f93\u51fa\uff0c\u6211\u6ce8\u610f\u5230\u60a8\u7684\u95ee\u9898\u53ef\u80fd\u4e0e\u7f16\u8bd1\u547d\u4ee4\u987a\u5e8f\u6709\u5173\u3002\u5728\u522b\u4eba\u7f16\u8bd1\u51fa\u6765\u7684\u7ed3\u679c\u4e2d\uff0c\u5148\u521b\u5efa\u4e86\u9759\u6001\u5e93<code>liblcthw.a</code>\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u9759\u6001\u5e93\u548c<code>tests/list_tests.c</code>\u8fdb\u884c\u94fe\u63a5\u3002\u800c\u60a8\u7f16\u8bd1\u51fa\u6765\u7684\u7ed3\u679c\u4e2d\uff0c\u4f3c\u4e4e\u662f\u5148\u521b\u5efa\u4e86\u9759\u6001\u5e93<code>list.a</code>\uff0c\u7136\u540e\u4f7f\u7528<code>tests/list_tests.c</code>\u548c<code>list.a</code>\u8fdb\u884c\u94fe\u63a5\u3002</p> <p>\u6839\u636e\u60a8\u7684Makefile\u89c4\u5219\uff0c\u6211\u6ce8\u610f\u5230\u5728<code>$(TARGET)</code>\u7684\u6784\u5efa\u89c4\u5219\u4e2d\uff0c\u4f7f\u7528\u4e86<code>$(CC)</code>\u547d\u4ee4\u76f4\u63a5\u94fe\u63a5\u4e86<code>$(TARGET)</code>\u548c<code>$(TEST_SRC)</code>\u751f\u6210\u4e86<code>tests/list_tests</code>\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u4e86\u7f16\u8bd1\u987a\u5e8f\u7684\u4e0d\u4e00\u81f4\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u5c06<code>$(TARGET)</code>\u548c<code>$(TEST_SRC)</code>\u7684\u94fe\u63a5\u64cd\u4f5c\u5206\u79bb\u51fa\u6765\uff0c\u786e\u4fdd\u9759\u6001\u5e93\u5148\u6784\u5efa\u5b8c\u6210\u540e\u518d\u8fdb\u884c\u94fe\u63a5\u64cd\u4f5c\u3002\u60a8\u53ef\u4ee5\u5c06\u94fe\u63a5<code>$(TARGET)</code>\u548c<code>$(TEST_SRC)</code>\u7684\u64cd\u4f5c\u79fb\u5230<code>tests</code>\u76ee\u6807\u7684\u6784\u5efa\u89c4\u5219\u4e2d\uff0c\u786e\u4fdd\u9759\u6001\u5e93\u5df2\u7ecf\u6784\u5efa\u5b8c\u6210\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u7f16\u8bd1\u987a\u5e8f\u7684\u4e00\u81f4\u6027\u3002</p> <p>\u53e6\u5916\uff0c\u5173\u4e8e\u5934\u6587\u4ef6\u7684\u95ee\u9898\uff0c\u786e\u4fdd\u60a8\u7684\u5934\u6587\u4ef6\u8def\u5f84\u5728<code>-I</code>\u9009\u9879\u4e2d\u6b63\u786e\u5730\u6307\u5b9a\uff0c\u4ee5\u4fbf\u7f16\u8bd1\u5668\u80fd\u591f\u627e\u5230\u6240\u9700\u7684\u5934\u6587\u4ef6\u3002</p> <p>\u5e0c\u671b\u8fd9\u4e9b\u5efa\u8bae\u80fd\u5e2e\u52a9\u60a8\u89e3\u51b3\u95ee\u9898\u3002\u5982\u679c\u60a8\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u5e2e\u52a9\uff0c\u8bf7\u968f\u65f6\u544a\u8bc9\u6211\u3002</p> <p>LIBS=-ldl $(OPTLIBS) \u8fd9\u4e00\u884cMakefile\u662f\u5e72\u4ec0\u4e48\u7684</p> <p>GPT-3.5 Turbo</p> <p>\u8fd9\u4e00\u884c<code>LIBS=-ldl $(OPTLIBS)</code>\u662f\u5728Makefile\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53d8\u91cf<code>LIBS</code>\uff0c\u7528\u4e8e\u6307\u5b9a\u94fe\u63a5\u65f6\u9700\u8981\u4f7f\u7528\u7684\u5e93\u6587\u4ef6\u3002\u5177\u4f53\u6765\u8bf4\uff1a</p> <ul> <li><code>-ldl</code>\u8868\u793a\u94fe\u63a5\u65f6\u9700\u8981\u4f7f\u7528\u52a8\u6001\u94fe\u63a5\u5668\u5e93\uff0c\u5b83\u662fLinux\u7cfb\u7edf\u4e2d\u7684\u52a8\u6001\u94fe\u63a5\u5668\u5e93\u3002</li> <li><code>$(OPTLIBS)</code>\u8868\u793a\u5728\u8fd9\u4e2a\u53d8\u91cf\u4e2d\u8fd8\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u7684\u94fe\u63a5\u5e93\uff0c\u8fd9\u4e2a\u503c\u53ef\u80fd\u662f\u5728Makefile\u4e2d\u7684\u5176\u4ed6\u5730\u65b9\u5b9a\u4e49\u7684\u3002</li> </ul> <p>\u5728Makefile\u4e2d\uff0c\u8fd9\u4e2a<code>LIBS</code>\u53d8\u91cf\u901a\u5e38\u4f1a\u5728\u94fe\u63a5\u53ef\u6267\u884c\u6587\u4ef6\u6216\u5171\u4eab\u5e93\u65f6\u4f7f\u7528\uff0c\u4ee5\u786e\u4fdd\u6240\u9700\u7684\u5e93\u6587\u4ef6\u88ab\u6b63\u786e\u5730\u94fe\u63a5\u5230\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u5171\u4eab\u5e93\u4e2d\u3002</p> <p>\u5e0c\u671b\u8fd9\u4e2a\u89e3\u91ca\u80fd\u591f\u5e2e\u52a9\u60a8\u7406\u89e3\u8fd9\u4e00\u884cMakefile\u7684\u4f5c\u7528\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u8bf7\u968f\u65f6\u544a\u8bc9\u6211\u3002</p> <p>39 $(TESTS): $(TEST_SRC) $(TARGET) 40         $(CC) $(CFLAGS) $@.c -o $@ $(TARGET) 41         sh ./tests/runtests.sh \u4e3a\u4ec0\u4e48\u8fd9\u6837\u5b50\u5199makefile\u53ef\u4ee5\u6210\u529f\uff1a cc -g -O2 -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC   -c -o src/lcthw/list.o src/lcthw/list.c ar rcs build/liblcthw.a src/lcthw/list.o ranlib build/liblcthw.a cc -shared -o build/liblcthw.so src/lcthw/list.o cc -g -O2 -Wextra -Isrc -rdynamic -DNDEBUG  tests/list_tests.c -o tests/list_tests build/liblcthw.a sh ./tests/runtests.sh Running unit tests: ---- ---- RUNNING: ./tests/list_tests ALL TESTS PASSED! Tests run:6 tests/list_tests PASS ---- RUNNING: ./tests/list_tests ALL TESTS PASSED! Tests run:6 tests/list_tests PASS ---- RUNNING: ./tests/list_tests ALL TESTS PASSED! Tests run:6 tests/list_tests PASS \u4f46\u662f\u8fd9\u6837\u5b50\u5199\u5c31\u4e0d\u884c\uff1f 39 $(TESTS): $(TEST_SRC) $(TARGET) 40         $(CC) $(CFLAGS)  $(TARGET)  $@.c -o $@  41         sh ./tests/runtests.sh \u7f16\u8bd1\u7ed3\u679c\uff1a cc -g -O2 -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC   -c -o src/lcthw/list.o src/lcthw/list.c ar rcs build/liblcthw.a src/lcthw/list.o ranlib build/liblcthw.a cc -shared -o build/liblcthw.so src/lcthw/list.o cc -g -O2 -Wextra -Isrc -rdynamic -DNDEBUG  build/liblcthw.a tests/list_tests.c -o tests/list_tests  /usr/bin/ld: /tmp/cc73fAyH.o: in function <code>test_create': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:13: undefined reference to</code>List_create' /usr/bin/ld: /tmp/cc73fAyH.o: in function <code>test_destroy': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:22: undefined reference to</code>List_clear_destroy' /usr/bin/ld: /tmp/cc73fAyH.o: in function <code>test_push_pop': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:29: undefined reference to</code>List_push' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:32: undefined reference to <code>List_push' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:35: undefined reference to</code>List_push' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:39: undefined reference to <code>List_pop' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:42: undefined reference to</code>List_pop' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:45: undefined reference to <code>List_pop' /usr/bin/ld: /tmp/cc73fAyH.o: in function</code>test_unshift': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:55: undefined reference to <code>List_unshift' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:58: undefined reference to</code>List_unshift' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:61: undefined reference to <code>List_unshift' /usr/bin/ld: /tmp/cc73fAyH.o: in function</code>test_remove': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:72: undefined reference to <code>List_remove' /usr/bin/ld: /tmp/cc73fAyH.o: in function</code>test_shift': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:85: undefined reference to <code>List_shift' /usr/bin/ld: /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:88: undefined reference to</code>List_shift' /usr/bin/ld: /tmp/cc73fAyH.o: in function <code>test_destroy': /home/jai/c_ysyx/ex32/liblcthw/tests/list_tests.c:22: undefined reference to</code>List_clear_destroy' collect2: error: ld returned 1 exit status make: *** [Makefile:40\uff1atests/list_tests] \u9519\u8bef 1</p> <p>GPT-3.5 Turbo</p> <p>\u5728Makefile\u4e2d\u7684\u89c4\u5219<code>$(TESTS): $(TEST_SRC) $(TARGET)</code>\u8868\u793a\u8981\u6784\u5efa<code>$(TESTS)</code>\u8fd9\u4e2a\u76ee\u6807\u6587\u4ef6\uff0c\u4f9d\u8d56\u4e8e<code>$(TEST_SRC)</code>\u548c<code>$(TARGET)</code>\u3002\u5728\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u547d\u4ee4<code>$(CC) $(CFLAGS) $@.c -o $@ $(TARGET)</code>\u5c06<code>$@.c</code>\uff08\u5373<code>$(TESTS).c</code>\uff09\u7f16\u8bd1\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u94fe\u63a5\u65f6\u4f7f\u7528\u4e86<code>$(TARGET)</code>\u3002</p> <p>\u800c\u5728\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u547d\u4ee4<code>$(CC) $(CFLAGS) $(TARGET) $@.c -o $@</code>\u5c06<code>$(TARGET)</code>\u548c<code>$@.c</code>\u94fe\u63a5\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd9\u6837\u505a\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a\u94fe\u63a5\u987a\u5e8f\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u94fe\u63a5\u5668\u662f\u6309\u7167\u547d\u4ee4\u884c\u4e2d\u7684\u987a\u5e8f\u6765\u67e5\u627e\u7b26\u53f7\u7684\uff0c\u56e0\u6b64\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u94fe\u63a5\u5668\u4f1a\u5148\u67e5\u627e<code>$(TARGET)</code>\u4e2d\u7684\u7b26\u53f7\uff0c\u4f46\u6b64\u65f6<code>$@.c</code>\u4e2d\u7684\u7b26\u53f7\u8fd8\u6ca1\u6709\u88ab\u5b9a\u4e49\uff0c\u56e0\u6b64\u4f1a\u51fa\u73b0\"undefined reference\"\u7684\u9519\u8bef\u3002</p> <p>\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5c06<code>$(TARGET)</code>\u653e\u5728<code>$@.c</code>\u7684\u540e\u9762\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4e2d\u7684\u5199\u6cd5\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u5148\u7f16\u8bd1<code>$@.c</code>\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff0c\u7136\u540e\u518d\u94fe\u63a5\u65f6\u4f7f\u7528<code>$(TARGET)</code>\u3002</p> <p>\u5e0c\u671b\u8fd9\u4e2a\u89e3\u91ca\u80fd\u591f\u5e2e\u52a9\u60a8\u7406\u89e3\u95ee\u9898\u6240\u5728\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u8bf7\u968f\u65f6\u544a\u8bc9\u6211\u3002</p> <p>cc -g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC   -c -o src/lcthw/list_algos.o src/lcthw/list_algos.c cc -g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG  -fPIC   -c -o src/lcthw/list.o src/lcthw/list.c \u8fd9\u4e24\u4e2a\u6587\u4ef6\u7684\u7f16\u8bd1\u987a\u5e8f\u600e\u4e48\u53cd\u8fc7\u6765\u4e86\u5462\uff1f\u6211\u7684Makefile\u5982\u4e0b CFLAGS=-g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG $(OPTFLAGS)  2 LIBS=-ldl $(OPTLIBS)  3 PREFIX?=/usr/local  4   5 SOURCES=$(wildcard src//.c src/.c)  6 OBJECTS=$(patsubst %.c,%.o,$(SOURCES))  7   8 TEST_SRC=$(wildcard tests/*_tests.c)  9 TESTS=$(patsubst %.c,%,$(TEST_SRC)) 10 # \u8fd9\u6b21\u7684\u95ee\u9898\u5e94\u8be5\u662f\u5934\u6587\u4ef6\u7684\u95ee\u9898\uff0c\u8981\u52a0\u4e0a\u7279\u5b9a\u7684\u76ee\u5f55\uff1f 11 TARGET=build/liblcthw.a 12 SO_TARGET=$(patsubst %.a,%.so,$(TARGET)) 13  14 # The Target Build 15 all:$(SO_TARGET) $(TARGET)  tests 16  17 dev: CFLAGS=-g -Wall -Isrc -Wall -Wextra $(OPTFLAGS) 18 dev: all 19  20 $(TARGET): CFLAGS += -fPIC 21 $(TARGET): build $(OBJECTS) 22         ar rcs $@ $(OBJECTS) 23         ranlib $@ 24  25  26 $(SO_TARGET): $(TARGET) $(OBJECTS) 27         $(CC) -shared -o $@ $(OBJECTS) 28  29 build: 30         @mkdir -p build 31         @mkdir -p bin 32  33 # The Unit Tests 34 .PHONY: tests 35 tests: CFLAGS += -Isrc 36 tests: $(TESTS) 37 $(TESTS): $(TEST_SRC) $(TARGET) 38         $(CC) $(CFLAGS) $@.c  -o $@  $(TARGET) 39         sh ./tests/runtests.sh</p> <p>GPT-3.5 Turbo</p> <p>\u6839\u636e\u60a8\u7684Makefile\uff0c\u76ee\u6807<code>$(TESTS)</code>\u4f9d\u8d56\u4e8e<code>$(TEST_SRC)</code>\u548c<code>$(TARGET)</code>\u3002\u5728\u60a8\u7684\u89c4\u5219\u4e2d\uff0c\u60a8\u4f7f\u7528<code>$(CC) $(CFLAGS) $@.c -o $@ $(TARGET)</code>\u6765\u6784\u5efa<code>$(TESTS)</code>\u3002\u8fd9\u610f\u5473\u7740\u5728\u94fe\u63a5\u65f6\uff0c\u9996\u5148\u4f7f\u7528<code>$@.c</code>\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff0c\u7136\u540e\u518d\u94fe\u63a5<code>$(TARGET)</code>\u3002</p> <p>\u56e0\u6b64\uff0c\u7f16\u8bd1\u987a\u5e8f\u5e76\u4e0d\u662f\u7531Makefile\u51b3\u5b9a\u7684\uff0c\u800c\u662f\u7531\u60a8\u7684\u89c4\u5219\u51b3\u5b9a\u7684\u3002\u5982\u679c<code>src/lcthw/list_algos.c</code>\u5728<code>src/lcthw/list.c</code>\u4e4b\u524d\u88ab\u94fe\u63a5\uff0c\u90a3\u53ef\u80fd\u662f\u56e0\u4e3a\u5728<code>$(TESTS)</code>\u7684\u89c4\u5219\u4e2d\uff0c<code>$(TEST_SRC)</code>\u4e2d\u7684\u6587\u4ef6\u88ab\u5904\u7406\u7684\u987a\u5e8f\u5bfc\u81f4\u7684\u3002</p> <p>\u60a8\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e0b<code>$(TEST_SRC)</code>\u4e2d\u7684\u6587\u4ef6\u987a\u5e8f\uff0c\u4ee5\u53ca\u786e\u4fdd<code>list_algos.c</code>\u5728<code>list.c</code>\u4e4b\u524d\u51fa\u73b0\uff0c\u8fd9\u6837\u5728\u94fe\u63a5\u65f6\u5c31\u4f1a\u5148\u5904\u7406<code>list_algos.c</code>\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff0c\u7136\u540e\u518d\u5904\u7406<code>list.c</code>\u3002</p> <p>\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u60a8\u627e\u5230\u95ee\u9898\u6240\u5728\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u8bf7\u968f\u65f6\u544a\u8bc9\u6211\u3002</p> <p>\u600e\u4e48\u6539\u5462</p> <p>GPT-3.5 Turbo</p> <p>\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u5728<code>$(TEST_SRC)</code>\u4e2d\u663e\u5f0f\u6307\u5b9a\u7f16\u8bd1\u987a\u5e8f\uff0c\u786e\u4fdd<code>list_algos.c</code>\u5728<code>list.c</code>\u4e4b\u524d\u51fa\u73b0\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u5b9a\u4e49<code>$(TEST_SRC)</code>\uff1a</p> <pre><code>TEST_SRC=tests/test1.c tests/test2.c tests/test3.c ... \u5176\u4ed6\u6d4b\u8bd5\u6587\u4ef6\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5c06<code>list_algos.c</code>\u653e\u5728<code>list.c</code>\u4e4b\u524d\uff0c\u4ee5\u786e\u4fdd\u5728\u94fe\u63a5\u65f6<code>list_algos.c</code>\u5148\u88ab\u5904\u7406\u3002</p> <p>\u53e6\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5c1d\u8bd5\u5728<code>$(TESTS)</code>\u7684\u89c4\u5219\u4e2d\u5c06<code>$(OBJECTS)</code>\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u5217\u51fa\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$(TESTS): $(TEST_SRC) $(TARGET) $(OBJECTS)\n    $(CC) $(CFLAGS) $@.c -o $@ $(OBJECTS) $(TARGET)\n</code></pre> <p>\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u5728\u94fe\u63a5\u65f6\u5148\u5904\u7406<code>list_algos.o</code>\uff0c\u7136\u540e\u518d\u5904\u7406<code>list.o</code>\u3002</p> <p>\u5f53\u7136\uff0c\u8fd9\u53ea\u662f\u4e00\u79cd\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u7684\u9879\u76ee\u7ed3\u6784\u548c\u9700\u6c42\u3002\u5e0c\u671b\u8fd9\u4e9b\u63d0\u793a\u80fd\u591f\u5e2e\u52a9\u60a8\u89e3\u51b3\u95ee\u9898\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u5176\u4ed6\u95ee\u9898\uff0c\u8bf7\u968f\u65f6\u544a\u8bc9\u6211\u3002</p>"},{"location":"language/C_asm/compile%20and%20linker/Question/%E7%BC%96%E8%AF%91%E9%93%BE%E6%8E%A5.html#lcthw-ex26","title":"\u5173\u4e8eLCTHW ex26\u7ec3\u4e60\u7684\u95ee\u9898","text":"<p>\u4f7f\u7528\u4f5c\u8005\u7ed9\u51fa\u7684</p> <p>gcc \u8fd0\u884c\u6307\u5b9a\u52a8\u6001\u5e93\u7684\u4e09\u79cd\u65b9\u6cd5_gcc \u6307\u5b9a\u52a8\u6001\u5e93-CSDN\u535a\u5ba2</p> <p>\u5df2\u89e3\u51b3\uff1a\u52a8\u6001\u5e93\u52a0\u8f7d\u5931\u8d25\uff1acannot open shared object file: No such file or directory-CSDN\u535a\u5ba2</p> <p>\u6ce8\u610f\u5230\uff1a</p> <p>\u73b0\u4ee3\u8fde\u63a5\u5668\u5728\u5904\u7406\u52a8\u6001\u5e93\u65f6\u5c06\u94fe\u63a5\u65f6\u8def\u5f84\uff08Link-time path\uff09\u548c\u8fd0\u884c\u65f6\u8def\u5f84\uff08Run-time path\uff09\u5206\u5f00,\u7528\u6237\u53ef\u4ee5\u901a\u8fc7-L\u6307\u5b9a\u8fde\u63a5\u65f6\u5e93\u7684\u8def\u5f84\uff0c\u901a\u8fc7-R\uff08\u6216-rpath\uff09\u6307\u5b9a\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5e93\u7684\u8def\u5f84\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u5e93\u5e94\u7528\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u6bd4\u5982\u505a\u5d4c\u5165\u5f0f\u79fb\u690d\u65f6 </p> <p><code>#arm-linux-gcc $(CFLAGS) \u2013o target \u2013L/work/lib/zlib/ -llibz-1.2.3</code></p> <p>(work/lib/zlib\u4e0b\u662f\u4ea4\u53c9\u7f16\u8bd1\u597d\u7684zlib\u5e93)\uff0c\u5c06target\u7f16\u8bd1\u597d\u540e\u6211\u4eec\u53ea\u8981\u628azlib\u5e93\u62f7\u8d1d\u5230\u5f00\u53d1\u677f\u7684\u7cfb\u7edf\u9ed8\u8ba4\u8def\u5f84\u4e0b\u5373\u53ef\u3002\u6216\u8005\u901a\u8fc7- rpath\uff08\u6216-R \uff09\u3001LD_LIBRARY_PATH\u6307\u5b9a\u67e5\u627e\u8def\u5f84\u3002 \u8981\u7528\u81ea\u5df1\u5199\u7684\u5e93\uff0c\u5982\u679c\u7f16\u8bd1\u7684\u65f6\u5019\u52a0\u2013static \uff0c\u5b83\u662f\u8fde\u63a5\u9759\u6001\u5e93\uff08.a\uff09,\u6240\u4ee5\u81ea\u5df1\u5f97\u505a\u4e2a\u9759\u6001\u5e93\uff0c\u7136\u540e-l \u52a8\u6001\u7f16\u8bd1\uff0c-l\u7684\u662f.so\u3002 </p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html","title":"Complie","text":""},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_1","title":"\u5b8f\u89c2\u4f53\u7cfb","text":"<p>\u3010\u6280\u672f\u6742\u8c08\u3011C\u7f16\u8bd1\u4f53\u7cfb_\u54d4\u54e9\u54d4\u54e9_bilibili</p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_2","title":"\u5e38\u7528\u7f16\u8bd1\u9009\u9879\u548c\u7f16\u8bd1\u5404\u4e2a\u6d41\u7a0b","text":"<p>\u719f\u7ec3\u5e38\u7528\u53c2\u6570\u5417\uff0c\u77e5\u9053\u600e\u4e48\u4f7f\u7528\u5373\u53ef\uff0c\u4e0d\u5e38\u89c1\u7684\u4f1a\u67e5\u6587\u6863</p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_3","title":"\u591a\u6587\u4ef6\u548c\u7b2c\u4e09\u65b9\u5e93","text":"<ul> <li>C\u8f6f\u4ef6\u5305\u7ed3\u6784</li> <li>apt</li> </ul>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#c","title":"C\u8fd0\u884c\u65f6\u5e93 \u8de8\u5e73\u53f0\u548c\u4ea4\u53c9\u7f16\u8bd1","text":"<ul> <li>-- <li>\u52a0\u62ff\u5927\u7f16\u8bd1</li>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#c_1","title":"C\u8bed\u8a00\u7f16\u8bd1\u8fc7\u7a0b","text":"<p>\u7f16\u8bd1\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u9884\u5904\u7406\uff1a\u4e3b\u8981\u662f\u5904\u7406\u5b8f\u5b9a\u4e49\uff0c\u5c06\u5b8f\u5b9a\u4e49\u5c55\u5f00\uff0c\u8fd9\u4e00\u6b65\u6240\u4f7f\u7528\u7684\u6280\u672f\u4e00\u822c\u53ea\u6d89\u53ca\u5b57\u7b26\u4e32\u66ff\u6362\uff1b</li> </ol> <p>\u7f16\u8bd1\u5668\u6d41\u7a0b</p> <ol> <li> <p>\u7f16\u8bd1\u5668\u524d\u7aef</p> <ol> <li>\u8bcd\u6cd5\u5206\u6790\uff1a\u5c06\u6587\u672c\u8f6c\u6210 token \u5e8f\u5217\uff1b</li> <li> <p>\u6587\u6cd5\u5206\u6790\uff0c\u5c06 token \u5e8f\u5217\u8f6c\u6210\u62bd\u8c61\u8bed\u6cd5\u6811\uff1b</p> </li> <li> <p>\u8bed\u4e49\u5206\u6790\uff1a\u6587\u6cd5\u53ea\u80fd\u68c0\u67e5\u5c40\u90e8\u7684\u4fe1\u606f\uff0c\u6709\u4e00\u4e9b\u8bed\u4e49\u4fe1\u606f\u9700\u8981\u5728\u8fd9\u4e00\u6b65\u68c0\u67e5\uff0c\u4f8b\u5982\u975e void \u7684\u51fd\u6570\u6f0f\u5199 return \u8bed\u53e5\uff1b</p> </li> </ol> <p>\u540e\u9762 2\u8bcd\u6cd5\u5206\u6790 \u548c 3\u6587\u6cd5\u5206\u6790 \u9879\u76ee\u5b9e\u73b0\u4e00\u4e2a\u5c0f\u578b C \u8bed\u8a00\u7f16\u8bd1\u5668\u524d\u7aef\u3002\u5b83\u5c06\u6e90\u4ee3\u7801\u7ffb\u8bd1\u6210\u4e86 AST\uff0c\u800c\u4e14\u652f\u6301\u4e86\u53d8\u91cf\u5b9a\u4e49\u548c\u8d4b\u503c\uff0cif \u8bed\u53e5\u548c while \u8bed\u53e5\u3002</p> </li> <li> <p>\u4e2d\u7aef</p> <p>\u8d1f\u8d23\u4f18\u5316\u751f\u6210\u7684\u4e2d\u95f4\u8868\u793a\u5f62\u5f0f</p> <ol> <li>\u5e73\u53f0\u65e0\u5173\u4f18\u5316\uff1a\u4e0e\u5177\u4f53\u7684\u5e73\u53f0\uff08\u4f53\u7cfb\u7ed3\u6784\uff09\u65e0\u5173\u7684\u7ed3\u6784\u4f18\u5316\uff0c\u5f80\u5f80\u4e0e\u8bed\u4e49\u76f8\u5173\uff1b</li> <li>\u5e73\u53f0\u76f8\u5173\u4f18\u5316\uff1a\u4e0e\u5177\u4f53\u7684\u4f53\u7cfb\u7ed3\u6784\u76f8\u5173\u7684\u4f18\u5316\uff0c\u4f8b\u5982\u8003\u8651\u5e73\u53f0\u7684\u7f13\u5b58\u548c\u6d41\u6c34\u7ebf\u8bbe\u8ba1\u800c\u505a\u51fa\u7684\u4f18\u5316\uff1b</li> </ol> </li> <li> <p>\u540e\u7aef</p> <p>\u5c06\u4e2d\u95f4\u8868\u793a\u7ffb\u8bd1\u6210\u76ee\u6807\u5e73\u53f0\u7684\u673a\u5668\u7801\uff0c\u5e76\u751f\u6210\u76f8\u5e94\u5e73\u53f0\u7684\u53ef\u6267\u884c\u7a0b\u5e8f</p> <ol> <li>\u6307\u4ee4\u9009\u62e9\uff1a\u8c03\u5ea6\u548c\u5bc4\u5b58\u5668\u5206\u914d\uff0c\u4e3b\u8981\u662f\u5c06\u4f18\u5316\u540e\u7684\u4e2d\u95f4\u8868\u793a\u5f62\u5f0f\u8f6c\u6362\u4e3a\u540e\u7aef\u4e3a\u76ee\u6807\u5e73\u53f0\u751f\u6210\u4ee3\u7801\uff1b<ol> <li>\u673a\u5668\u4ee3\u7801\u3001\u6c47\u7f16\u4ee3\u7801</li> </ol> </li> <li>\u4e2d\u95f4\u6587\u4ef6\u751f\u6210\uff1a\u7f16\u8bd1\u8fc7\u7a0b\u7ed3\u675f\uff0c\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u4f1a\u751f\u6210\u4e00\u4e2a\u4e2d\u95f4\u6587\u4ef6\u3002</li> </ol> </li> </ol> <p>\u5bf9\u4e8e\u4e2d\u7aef\u548c\u540e\u7aef\uff0c\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u57fa\u4e8e\u6808\u7684\u5b57\u8282\u7801\u548c\u865a\u62df\u673a</p> <p></p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#1","title":"1. \u9884\u5904\u7406","text":"<pre><code>#include &lt;stdio.h&gt;\n\n#ifdef USE_MACRO\n#define square(x) (x)*(x)\n#else\ninline int square(int x) {\n    return x * x;\n}\n#endif\n\nint main() {\n    int a = 3;\n    int b = square(++a);\n    printf(\"%d\\n\", b);\n    return 0;\n}\n</code></pre> <pre><code>// \u7ec3\u4e60\uff1a\n#include &lt;stdio.h&gt;\n\n#define TYPE_Apple 1\n#define TYPE_Pear  2\n\nstruct Fruit {\n    int _type;\n    char* _name;\n};\n\n#define DECLARE(x) \\\nstruct Fruit x = {      \\\n    TYPE_##x,           \\\n    #x,                 \\\n};\n\nDECLARE(Apple)\nDECLARE(Pear)\n\nint main() {\n    printf(\"%d, %s\\n\", Apple._type, Apple._name);\n    printf(\"%d, %s\\n\", Pear._type, Pear._name);\n    return 0;\n}\n</code></pre>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#2","title":"2. \u8bcd\u6cd5\u5206\u6790","text":"<p>\u8bcd\u6cd5\u5206\u6790\u7528\u4e8e\u5c06\u6bcf\u4e00\u884c\u4ee3\u7801\u4e2d\u7684\u5b57\u7b26\u8fdb\u884c\u5206\u7ec4\uff0c\u6709\u610f\u4e49\u7684\u5206\u5230\u4e00\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u5c31\u662f\u4e00\u4e2a\u8bcd\u3002\u8bcd\u6cd5\u5206\u6790\u4e3b\u8981\u5728\u4e8e\uff1a\u8bcd\u6cd5\u5206\u6790\u5668</p> <p>\u4f8b\u5982\uff0c<code>double PI = 3.1415926</code> </p> <p>\u4eba\u4eec\u5728\u7406\u89e3\u5b83\u7684\u65f6\u5019\u662f\u5148\u628a\u5b83\u5206\u6210\u4e86\u8fd9\u56db\u4e2a\u5c0f\u7ec4\uff1a\uff08\u201cdouble\u201d\uff0c\u7c7b\u578b\u58f0\u660e\uff09\u3001\uff08\u201cPI\u201d\uff0c\u53d8\u91cf\u540d\uff09\u3001\uff08\u201c=\u201d\uff0c\u8d4b\u503c\u64cd\u4f5c\u7b26\uff09\u3001\uff08\u201c3.1415926\u201d\uff0c\u6d6e\u70b9\u7acb\u5373\u6570\uff09\u3002</p> <p>\u8bcd\u6cd5\u5206\u6790\u901a\u8fc7\u4e00\u4e2a\u53ebToken\u7684\u4e1c\u897f\u6765\u5206\u7ec4\u3002\u6211\u4eec\u8fd9\u91cc\u628a Token \u79f0\u4e3a\u8bcd\u6cd5\u5355\u5143\uff0c\u4ee3\u8868\u4e00\u4e2a\u8bcd\u7684\u610f\u601d\u3002</p> <p>Token \u8fd9\u4e2a\u672f\u8bed\u5728\u8ba1\u7b97\u673a\u5b66\u79d1\u4e2d\u7ecf\u5e38\u51fa\u73b0\uff0c\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e2d\u4ee3\u8868\u4e0d\u540c\u7684\u542b\u4e49\u3002\u4f8b\u5982\u5728\u7f51\u7edc\u4e2d\uff0c\u5b83\u88ab\u7ffb\u8bd1\u6210\u201c\u4ee4\u724c\u201d\uff0c\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u573a\u666f\u4e2d\uff0ctoken \u53c8\u88ab\u4f5c\u4e3a\u6388\u6743\u9a8c\u8bc1\u7684\u52a0\u901f\u624b\u6bb5\u3002</p> <p>\u8bcd\u6cd5\u5206\u6790\u7684\u4e3b\u8981\u624b\u6bb5\uff1a</p> <ul> <li> <p>\u6b63\u5219\u8868\u8fbe\u5f0f</p> </li> <li> <p>\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\uff08\u4e3b\u8981\u8bb2\u8fd9\u4e2a\uff09</p> <p>\u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\u7531\u4e00\u4e2a\u6709\u9650\u7684\u5185\u90e8\u72b6\u6001\u96c6\u5408\u548c\u4e00\u7ec4\u63a7\u5236\u89c4\u5219\u7ec4\u6210\uff0c</p> <p>\u8fd9\u4e9b\u89c4\u5219\u662f\u7528\u6765\u63a7\u5236\u5728\u5f53\u524d\u72b6\u6001\u4e0b\u53ef\u4ee5\u63a5\u53d7\u4ec0\u4e48\u8f93\u5165\uff0c\u4ee5\u53ca\u63a5\u53d7\u8fd9\u4e9b\u8f93\u5165\u4ee5\u540e\u5e94\u8f6c\u5411\u4ec0\u4e48\u72b6\u6001</p> </li> </ul> <p></p> <p>\u5728\u8fd9\u5f20\u56fe\u7247\u4e2d\uff0c\u72b6\u6001 0 \u662f\u81ea\u52a8\u673a\u7684\u521d\u59cb\u72b6\u6001\uff0c\u4ece\u72b6\u6001 0 \u51fa\u53d1\u7684\u7bad\u5934\u53f7\u6807\u4e0a\u4e86\u5b57\u6bcd a\uff0c\u8868\u793a\u8fd9\u4e2a\u72b6\u6001\u53ef\u4ee5\u63a5\u53d7\u5b57\u6bcd a\uff0c\u8fdb\u5165\u72b6\u6001 1 \u3002</p> <p>\u4ece\u72b6\u6001 1 \u51fa\u53d1\u7684\u7bad\u5934\u6709\u4e24\u6761\uff0c\u5206\u522b\u662f\u6307\u56de\u81ea\u5df1\u7684\u7bad\u5934 a\uff0c\u548c\u6307\u5411\u72b6\u6001 2 \u7684\u7bad\u5934 b\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u72b6\u6001 1 \u63a5\u53d7\u5b57\u6bcd a\uff0c\u4ecd\u7136\u56de\u5230\u4e86\u72b6\u6001 1\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u81ea\u52a8\u673a\u53ef\u4ee5\u5728\u72b6\u6001 1 \u7684\u60c5\u51b5\u4e0b\uff0c\u63a5\u53d7\u65e0\u7a77\u591a\u4e2a\u5b57\u6bcd a\u3002\u800c\u7bad\u5934 b \u5219\u610f\u5473\u7740\u72b6\u6001 1 \u8fd8\u53ef\u4ee5\u63a5\u53d7\u5b57\u6bcd b\uff0c\u53d8\u6210\u72b6\u6001 2\u3002</p> <p>\u72b6\u6001 2 \u662f\u6bd4\u8f83\u7279\u6b8a\u7684\u4e00\u4e2a\u72b6\u6001\uff0c\u6211\u4eec\u4f7f\u7528\u4e24\u4e2a\u5708\u6765\u7ed8\u5236\u5b83\uff0c\u8fd9\u4ee3\u8868\u5b83\u662f\u4e00\u4e2a\u7ec8\u6001\u3002\u5982\u679c\u81ea\u52a8\u673a\u8fdb\u5165\u5230\u7ec8\u6001\u4ee5\u540e\uff0c\u5c31\u8868\u793a\u81ea\u52a8\u673a\u5b8c\u6210\u4e86\u4e00\u6b21\u5339\u914d\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u81ea\u52a8\u673a\u4ee3\u8868\u4e86\u8fd9\u6837\u4e00\u79cd\u6a21\u5f0f\uff1a\u201ca+b\u201d\uff0c\u5176\u4e2d\u7684\u52a0\u53f7\u8868\u793a\uff0c\u81f3\u5c11\u5305\u542b\u4e00\u4e2a a\uff0c\u5e76\u4e14\u4ee5 b \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982<code>\u201caab\u201d \u201cab\u201d</code>\uff0c\u90fd\u7b26\u5408\u201ca+b\u201d\u8fd9\u4e2a\u6a21\u5f0f\u3002\u8fd9\u91cc\u4f60\u53ef\u4ee5\u81ea\u5df1\u7ec3\u4e60\u4e00\u4e0b\uff0c\u5f53\u8f93\u5165\u662f\u8fd9\u4e24\u4e2a\u5b57\u7b26\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u673a\u7684\u72b6\u6001\u662f\u5982\u4f55\u53d8\u5316\u7684\u3002</p> <p>\u5982\u4f55\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u81ea\u52a8\u673a\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6574\u578b\u53d8\u91cf state \u6765\u4ee3\u8868\u81ea\u52a8\u673a\u7684\u72b6\u6001\uff0c\u7136\u540e\u6839\u636e\u8f93\u5165\uff0c\u4e0d\u65ad\u5730\u6539\u53d8\u8fd9\u4e2a\u53d8\u91cf\u3002</p> <p>\u4e4b\u524d\u84dd\u6865\u676f\u5199\u7684\u90a3\u4e2a\u6309\u952e\u529f\u80fd\uff1a\u5c31\u662f\u72b6\u6001\u673a</p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_4","title":"\u8bcd\u6cd5\u5206\u6790\u5668","text":"<ol> <li> <p>\u5148\u521b\u5efa\u4ee3\u7801\u6240\u9700\u7684\u6570\u636e\u7ed3\u6784\uff1a</p> </li> <li> <p>\u5b9e\u73b0\u521b\u5efa Token \u548c \u9500\u6bc1 Token \u51fd\u6570</p> </li> <li> <p>\u5b9e\u73b0 next_token\uff1a\u4ece\u5b57\u7b26\u4e32\u4e2d\u5206\u5272\u5355\u8bcd\uff0c\u6bcf\u6b21\u8c03\u7528\u4e00\u4e2a next_token \u5c31\u751f\u6210\u4e00\u4e2a token\uff1a</p> </li> <li> <p>main\u51fd\u6570\u6d4b\u8bd5\uff1a</p> <p>\u6839\u636e\u4e0b\u9762\u4ee3\u7801\u7684\u5206\u5e03\uff0c\u5927\u6982\u4e5f\u53ef\u4ee5\u5bf9\u5e94\u4e0a\u9762\u8fc7\u7a0b\u7684\u56db\u6b65\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nenum State{\n    STATE_INIT,     /* \u6709\u9650\u72b6\u6001\u81ea\u52a8\u673a\u7684\u521d\u59cb\u5316 */\n    STATE_VAR,      /* \u63a5\u53d7\u5b57\u7b26\u7684\u72b6\u6001 */\n};\n\nenum TokenType{\n    TT_VAR,\n    TT_INTEGER,\n    TT_STRING,\n};\n\nunion TokenValue{\n    char *_str;\n    int _int;\n};\n\nstruct Token{\n    enum TokenType _type;\n    union TokenValue _value;\n};\n\nenum State state =  STATE_INIT;\nchar *cur;\n\nstruct Token *create_token(enum TokenType tt, char *begin, char *cur){\n    struct Token *nt = (struct Token*)malloc(sizeof(struct Token));\n    nt-&gt;_type = tt;\n\n    /* \u8fd9\u91cc\u53ea\u9700\u8981\u5bf9\u53d8\u91cf\u8fdb\u884c\u5904\u7406\uff0c\u7b49\u53f7\u3001\u5206\u53f7\u7b49\u7b26\u53f7\u53ea\u9700\u8981\u7c7b\u578b\u5c31\u591f\u4e86\u3002*/\n    if (tt == TT_VAR) {\n        nt-&gt;_value._str = (char *)malloc(cur - begin + 1);\n        strncpy(nt-&gt;_value._str, begin, cur - begin);\n        nt-&gt;_value ._str[cur-begin] = 0;\n    }\n\n    return nt;\n}\n\nvoid destroy_token(struct Token *t){\n    /* token \u662f\u53d8\u91cf\u7684\u7684\u65f6\u5019\u624d\u9700\u8981free\uff0c\u548c\u4e0a\u9762malloc\u4e00\u6837 */\n    if (t-&gt;_type == TT_VAR) {\n        free(t-&gt;_value._str);\n        t-&gt;_value._str = NULL;\n    }\n\n    free(t);\n}\n\n/* Version0.1 */\n/* \u5178\u578b\u7684\u81ea\u52a8\u673a\u5b9e\u73b0 */\n/* \u4f18\u5316\u4e00\u4e0b\uff0c\u4f7f\u7528Tagged Union? */\nstruct Token * next_token(void) {\n    state = STATE_INIT;\n    char *begin = 0;\n\n    while (*cur) {\n        char c = *cur;\n        if (state == STATE_INIT) {\n            /* \u5728\u521d\u6001\u4e0b\uff0c\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u3001\u5236\u8868\u7b49\u90fd\u53ef\u4ee5\u8df3\u8fc7 */\n            if (c == ' ' || c == '\\n' || c == '\\t') {\n                cur++;\n                continue;\n            }\n\n            /* \u9047\u5230\u5b57\u7b26\u5c31\u8ba4\u4e3a\u662f\u4e00\u4e2a\u53d8\u91cf\u7684\u5f00\u59cb\u3002\uff08C\u8bed\u8a00\u53d8\u91cf\u53ea\u80fd\u6709\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\u5f00\u5934\uff09 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || c == '_') {\n                begin = cur;\n                state = STATE_VAR;\n                cur++;\n            }\n        } else if (state == STATE_VAR) {\n            /* \u5f53\u524d\u72b6\u6001\u673a\u5904\u4e8e\u5206\u6790\u53d8\u91cf\u7684\u9636\u6bb5\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ee7\u7eed\u63a5\u53d7\u5b57\u6bcd\u548c\u6570\u5b57 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || \n                (c &lt;= '9' &amp;&amp; c &gt;= '0') || c == '_') {\n                cur++;\n            } else {\n                /* \u53d8\u91cf\u5206\u6790\u5b8c\u6210 */\n                return create_token(TT_VAR, begin, cur);\n            }\n        }\n\n    }\n\n    return NULL;\n}\n\nint main(int argc, char **argv){\n    cur = \"init val1 = 1;\";\n\n    struct Token *t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    return  0;\n}\n</code></pre> </li> <li> <p>\u8fdb\u4e00\u6b65\u5b8c\u5584</p> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u53ea\u5b9e\u73b0\u4e86\u5bf9\u4e8e\u53d8\u91cf\u7684\u8d4b\u503c\u3002\u8fdb\u4e00\u6b65\u6539\u8fdb\uff1a\u5b9e\u73b0\u5bf9\u7b49\u53f7\u7684\u5224\u65ad\u3001\u5bf9\u6574\u6570\u3001\u5bf9\u5206\u53f7\u7684\u5224\u65ad\uff1a</p> <p>\u81ea\u5df1\u7684\u7248\u672c\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nenum State{\n    STATE_INIT,     /* \u72b6\u6001\u673a\u521d\u59cb\u5316 */\n    STATE_VAR,      /* \u53d8\u91cf */\n    STATE_EQU,      /* \u7b49\u53f7 */\n    STATE_NUM,      /* \u6574\u6570 */\n};\n\nenum TokenType{\n    TT_VAR,\n    TT_INTEGER,\n    TT_STRING,\n    TT_ASSIGN,\n};\n\nunion TokenValue{\n    char *_str;\n    int _int;\n};\n\nstruct Token{\n    enum TokenType _type;\n    union TokenValue _value;\n};\n\nenum State state =  STATE_INIT;\nchar *cur;\n\nstruct Token *create_token(enum TokenType tt, char *begin, char *cur){\n    struct Token *nt = (struct Token*)malloc(sizeof(struct Token));\n    nt-&gt;_type = tt;\n\n    /* \u8fd9\u91cc\u53ea\u9700\u8981\u5bf9\u53d8\u91cf\u8fdb\u884c\u5904\u7406\uff0c\u7b49\u53f7\u3001\u5206\u53f7\u7b49\u7b26\u53f7\u53ea\u9700\u8981\u7c7b\u578b\u5c31\u591f\u4e86\u3002*/\n    if (tt == TT_VAR) {\n        nt-&gt;_value._str = (char *)malloc(cur - begin + 1);\n        strncpy(nt-&gt;_value._str, begin, cur - begin);\n        nt-&gt;_value ._str[cur-begin] = 0;\n    } else if (tt == TT_INTEGER) {\n\n        int sum = 0;\n        for (char *p = begin; p &lt; cur; p++) {\n           sum *= 10;\n           sum += (*p - '0');\n        }\n        nt-&gt;_value._int = sum; \n\n       //  nt-&gt;_value._int = atoi(begin);\n    } else if (tt == TT_ASSIGN) {\n        nt-&gt;_value._str = (char *)malloc(cur - begin + 1);\n        strncpy(nt-&gt;_value._str, begin, cur - begin);\n        nt-&gt;_value ._str[cur-begin] = 0;\n    } \n\n    return nt;\n}\n\nvoid destroy_token(struct Token *t){\n    /* token \u662f\u53d8\u91cf\u7684\u7684\u65f6\u5019\u624d\u9700\u8981free\uff0c\u548c\u4e0a\u9762malloc\u4e00\u6837 */\n    if (t-&gt;_type == TT_VAR) {\n        free(t-&gt;_value._str);\n        t-&gt;_value._str = NULL;\n    }\n\n    free(t);\n}\n\nstruct Token * next_token(void) {\n    state = STATE_INIT;\n    char *begin = 0;\n\n    while (*cur) {\n        char c = *cur;\n        if (state == STATE_INIT) {\n            /* \u5728\u521d\u6001\u4e0b\uff0c\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u3001\u5236\u8868\u7b49\u90fd\u53ef\u4ee5\u8df3\u8fc7 */\n            if (c == ' ' || c == '\\n' || c == '\\t') {\n                cur++;\n                continue;\n            }\n\n            /* \u9047\u5230\u5b57\u7b26\u5c31\u8ba4\u4e3a\u662f\u4e00\u4e2a\u53d8\u91cf\u7684\u5f00\u59cb\u3002\uff08C\u8bed\u8a00\u53d8\u91cf\u53ea\u80fd\u6709\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\u5f00\u5934\uff09 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || c == '_') {\n                begin = cur;\n                state = STATE_VAR;\n                cur++;\n            } else if (c == '=') {\n                /* \u521d\u59cb\u72b6\u6001\u5c31\u9047\u5230\u7b49\u53f7\uff0c\u65e0\u6cd5\u5224\u65ad\u662f\u8d4b\u503c\u64cd\u4f5c\u8fd8\u662f\u7b49\u4e8e\n                 * \u8fdb\u4e00\u6b65--&gt; \u770b\u540e\u9762\u7684\u4e00\u4e2a\u5b57\u7b26\u624d\u77e5\u9053\u3002\n                 * \u540e\u9762\u90a3\u4e2a\u662f' = '\u624d\u662f\u7b49\u4e8e\u7b26\u53f7\n                 */\n                begin = cur;\n                state = STATE_EQU;\n                cur++;\n            }\n\n            if (c &lt;= '9' &amp;&amp; c &gt;= '0') {\n                begin = cur;\n                state = STATE_NUM;\n                cur++;\n            }\n\n        } else if (state == STATE_VAR) {\n            /* \u5f53\u524d\u72b6\u6001\u673a\u5904\u4e8e\u5206\u6790\u53d8\u91cf\u7684\u9636\u6bb5\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ee7\u7eed\u63a5\u53d7\u5b57\u6bcd\u548c\u6570\u5b57 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || \n                (c &lt;= '9' &amp;&amp; c &gt;= '0') || c == '_') {\n                cur++;\n            } else {\n                /* \u53d8\u91cf\u5206\u6790\u5b8c\u6210 */\n                return create_token(TT_VAR, begin, cur);\n            }\n\n        } else if (state == STATE_EQU) {\n            if (c == '=' ) {\n                /* \u5148\u4e0d\u5904\u7406 */\n            } else {\n                return create_token(TT_ASSIGN ,begin, cur);\n            }\n        } else if (state == STATE_NUM) {\n            if (c &lt;= '9' &amp;&amp; c &gt;= '0') {\n                cur++;\n            }else {\n                return create_token(TT_INTEGER, begin, cur);\n            }\n        } \n\n    }\n\n    return NULL;\n}\n\n\n/* \n * Version0.1 \n * \u53ea\u5b9e\u73b0\u4e86\u7b80\u5355\u7684\u53d8\u91cf\u5904\u7406\n *\n */\n/* \u5178\u578b\u7684\u81ea\u52a8\u673a\u5b9e\u73b0 */\n/* \u4f18\u5316\u4e00\u4e0b\uff0c\u4f7f\u7528Tagged Union? */\n#ifdef Token_Version1\nstruct Token * next_token(void) {\n    /* \u6bcf\u6b21\u8fdb\u6765\uff08\u6bcf\u6b21\u5206\u6790\u4e00\u4e2aToken\uff09\u90fd\u662f\u4e00\u4e2a\u72b6\u6001\u673a\u7684\u8fd0\u4f5c\u3002 */\n    state = STATE_INIT;\n    char *begin = 0;\n\n    while (*cur) {\n        char c = *cur;\n        if (state == STATE_INIT) {\n            /* \u5728\u521d\u6001\u4e0b\uff0c\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u3001\u5236\u8868\u7b49\u90fd\u53ef\u4ee5\u8df3\u8fc7 */\n            if (c == ' ' || c == '\\n' || c == '\\t') {\n                cur++;\n                continue;\n            }\n\n            /* \u9047\u5230\u5b57\u7b26\u5c31\u8ba4\u4e3a\u662f\u4e00\u4e2a\u53d8\u91cf\u7684\u5f00\u59cb\u3002\uff08C\u8bed\u8a00\u53d8\u91cf\u53ea\u80fd\u6709\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\u5f00\u5934\uff09 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || c == '_') {\n                begin = cur;\n                state = STATE_VAR;\n                cur++;\n            }\n        } else if (state == STATE_VAR) {\n            /* \u5f53\u524d\u72b6\u6001\u673a\u5904\u4e8e\u5206\u6790\u53d8\u91cf\u7684\u9636\u6bb5\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ee7\u7eed\u63a5\u53d7\u5b57\u6bcd\u548c\u6570\u5b57 */\n            if ((c &lt;= 'z' &amp;&amp; c &gt;= 'a') || \n                (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || \n                (c &lt;= '9' &amp;&amp; c &gt;= '0') || c == '_') {\n                cur++;\n            } else {\n                /* \u53d8\u91cf\u5206\u6790\u5b8c\u6210 */\n                return create_token(TT_VAR, begin, cur);\n            }\n        }\n\n    }\n\n    return NULL;\n}\n#endif\n\nint main(int argc, char **argv){\n    cur = \"init val1 1224 = ;\";\n\n    //    strncpy(cur, \"init val1 1224 = ;\", 20);\n\n    struct Token *t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %d\\n\", t-&gt;_type, t-&gt;_value._int);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n    return  0;\n}\n</code></pre> </li> </ol>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#3","title":"3. \u6587\u6cd5\u5206\u6790\uff08\u8bed\u6cd5\u5206\u6790\uff09","text":"<p>\u6587\u6cd5\u5206\u6790\u6280\u672f\u4e0d\u53ea\u7528\u4e8e\u7f16\u8bd1\u5668\u4e2d\uff0c\u5728 JSON \u6587\u4ef6\u89e3\u6790\u3001XML \u6587\u4ef6\u89e3\u6790\u7b49\u573a\u666f\u4e2d\u4e5f\u88ab\u5e7f\u6cdb\u5730\u4f7f\u7528\uff0c\u5b83\u5176\u5b9e\u662f\u4e00\u79cd\u5904\u7406\u683c\u5f0f\u5316\u6587\u672c\u7684\u6280\u672f\u3002</p> <p>\u6240\u4ee5\u8fd9\u8282\u8bfe\uff0c\u4f60\u8981\u638c\u63e1\u7684\u4e0d\u4ec5\u662f\u6587\u6cd5\u5206\u6790\u7684\u5177\u4f53\u6280\u672f\uff0c\u66f4\u91cd\u8981\u7684\u662f\u8981\u7406\u89e3\u5b83\u5904\u7406\u683c\u5f0f\u5316\u6587\u672c\u7684\u539f\u7406\u3002</p> <p>\u53ea\u6709\u6df1\u523b\u5730\u7406\u89e3\u4e86\u539f\u7406\uff0c\u6211\u4eec\u624d\u80fd\u505a\u5230\u5728\u5177\u4f53\u7684\u573a\u666f\u4e2d\uff0c\u6839\u636e\u9700\u8981\u81ea\u7531\u5730\u4fee\u6539\u7b97\u6cd5\u7684\u5b9e\u73b0\u3002</p> <p>\u603b\u7ed3\uff1a</p> <p>\u6587\u6cd5\u662f\u4e00\u5957\u8bed\u8a00\u4ea7\u751f\u7684\u89c4\u5219\uff0c\u6839\u636e\u6587\u6cd5\u89c4\u5219\u6765\u5224\u65ad\u6e90\u6587\u4ef6\u662f\u5426\u7b26\u5408\u6587\u6cd5\u7684\u8fc7\u7a0b\u5c31\u662f\u6587\u6cd5\u5206\u6790\u3002</p> <p>\u6587\u6cd5\u5206\u6790\u7684\u65b9\u6cd5\u4e3b\u8981\u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f\u81ea\u9876\u5411\u4e0b\u548c\u81ea\u5e95\u5411\u4e0a\u7684\u5206\u6790\u65b9\u6cd5\u3002\u5176\u4e2d\uff0c\u81ea\u5e95\u5411\u4e0a\u4e3b\u8981\u91c7\u7528\u5f52\u7ea6\u7684\u529e\u6cd5\uff0c\u5c06\u7ec8\u7ed3\u7b26\u5f52\u7ea6\u6210\u9876\u7ea7\u7684\u975e\u7ec8\u7ed3\u7b26\uff0c\u591a\u6570\u81ea\u52a8\u5316\u5de5\u5177( <code>yacc</code>\u3001<code>javacc</code> )\u90fd\u662f\u91c7\u7528\u4e86\u8fd9\u79cd\u65b9\u6cd5\u3002\u800c\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\u5219\u6bd4\u8f83\u7b80\u5355\u660e\u4e86\uff0c\u66f4\u7b26\u5408\u4eba\u7684\u76f4\u89c2\u601d\u7ef4\u3002\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\u7b80\u5355\u5730\u5c06\u975e\u7ec8\u7ed3\u7b26\u8f6c\u6362\u6210\u51fd\u6570\uff0c\u628a\u6216\u7ed3\u6784\u8f6c\u6362\u6210 if \u8bed\u53e5\uff0c\u628a\u591a\u9879\u7ed3\u6784\u8f6c\u6362\u6210 while \u8bed\u53e5\u3002\u6240\u4ee5\u8fd9\u79cd\u5206\u6790\u65b9\u6cd5\u662f\u4e0d\u80fd\u5904\u7406\u5de6\u9012\u5f52\u7684\uff0c\u4f46\u662f\u6240\u6709\u7684\u5de6\u9012\u5f52\u6587\u6cd5\u90fd\u53ef\u4ee5\u6309\u4e00\u5b9a\u7684\u6a21\u5f0f\u8f6c\u6362\u6210\u53f3\u9012\u5f52\u7684\u3002</p> <p>\u5728\u7f16\u8bd1\u5668\u91cc\uff0c\u6587\u6cd5\u5206\u6790\u5e76\u4e0d\u662f\u76f4\u63a5\u5bf9\u6e90\u6587\u4ef6\u8fdb\u884c\u6c42\u503c\u8fd0\u7b97\u7684\uff0c\u800c\u662f\u4f1a\u751f\u6210\u62bd\u8c61\u8bed\u6cd5\u6811\u3002\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u68f5\u6811\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u8fd9\u68f5\u6811\uff0c\u5bf9\u5b83\u8fdb\u884c\u5404\u79cd\u53d8\u6362\uff0c\u6bd4\u5982\u8f6c\u6362\u6210\u5b57\u8282\u7801\uff0c\u6216\u8005\u5176\u4ed6\u7684\u4e2d\u95f4\u8868\u793a\uff0c\u7b49\u7b49\u3002\u8fd9\u4e9b\u5185\u5bb9\u6211\u5c06\u4f1a\u5728\u4e0b\u8282\u8bfe\u8fdb\u884c\u8bb2\u89e3\u3002</p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_5","title":"\u7b80\u5355\u7406\u89e3","text":"<ul> <li> <p>\u4e3b\u8c13\u5bbe</p> <p>S\uff08Subject\uff09\u3001P\uff08Predicate\uff09\u3001O\uff08Object\uff09</p> </li> <li> <p>\u7ec8\u7ed3\u7b26\u548c\u975e\u7ec8\u7ed3\u7b26</p> <pre><code>S \u2192 Tom\u2223Mary\nP \u2192 play\u2223eat\nO \u2192 basketball\u2223apple\n</code></pre> <p>\u4e3b\u8bed S \u53ef\u4ee5\u7ee7\u7eed\u63a8\u5bfc\uff0c\u4f46 Tom \u6216\u8005 Mary \u5219\u4e0d\u80fd\u518d\u7ee7\u7eed\u63a8\u5bfc\u4e0b\u53bb\u4e86\u3002\u8fd9\u6837\uff0c\u4eba\u4eec\u5c31\u628a\u53ef\u4ee5\u63a8\u5bfc\u4e0b\u53bb\u7684\u7b26\u53f7\u79f0\u4e3a\u975e\u7ec8\u7ed3\u7b26\uff0c\u4f8b\u5982 Sent\u3001S \u90fd\u662f\u975e\u7ec8\u7ed3\u7b26\uff0cP \u548c O \u5f53\u7136\u4e5f\u662f\u975e\u7ec8\u7ed3\u7b26\uff1b\u540c\u65f6\u628a\u4e0d\u53ef\u4ee5\u7ee7\u7eed\u63a8\u5bfc\u7684\u7b26\u53f7\u79f0\u4e3a\u7ec8\u7ed3\u7b26\uff0c\u4f8b\u5982 Mary \u548c Tom\u3002</p> </li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u542c\u61c2\u4e00\u4e2a\u53e5\u5b50\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53ea\u4e0d\u8fc7\u662f\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u4e00\u76f4\u4e60\u60ef\u4e86\uff0c\u4e00\u77ac\u95f4\u5c31\u660e\u767d\u3002</p> <ul> <li> <p>\u5f52\u7ea6</p> <p>\u62bd\u8c61\u5230\u6700\u4e0a\u5c42\uff1f</p> </li> <li> <p>\u63a8\u5bfc</p> <p>\u7531\u6700\u4e0a\u5c42\u62bd\u8c61\u9010\u6e10\u5230\u5b9e\u9645\u7684\uff1f</p> </li> </ul> <p>\u6bd4\u5982\u4e00\u4e2a\u53e5\u5b50\u4e2d\u6709\uff1a\u4e3b\u8c13\u5bbe\uff0c\u6211\u6253\u7bee\u7403</p> <p>\u6700\u4e0a\u5c42\u7684\u62bd\u8c61\u662f\u4e3b\u8c13\u5bbe\uff0c\u4e0b\u5c42\u662f\u5177\u4f53\u5230\u53e5\u5b50\u4e2d\u7684 \u201c\u6211\u201d \u548c \u201c\u6253\u201d \u548c \u201c\u7bee\u7403\u201d</p> <p>\u5c06\u6e90\u4ee3\u7801\u5f52\u7ea6\u5230\u9876\u7ea7\u89c4\u5219\u7684\u624b\u6bb5\uff0c\u662f\u4e00\u79cd\u81ea\u5e95\u5411\u4e0a\u7684\u5206\u6790\u624b\u6bb5\uff0c\u5b83\u4f7f\u7528\u6587\u6cd5\u89c4\u5219\u7684\u65f6\u5019\u662f\u4ece\u53f3\u5411\u5de6\u8fdb\u884c\u5f52\u7ea6\u7684\u3002\u4eba\u4eec\u79f0\u8fd9\u79cd\u5206\u6790\u65b9\u5f0f\u4e3a LR \u7b97\u6cd5\uff0c\u5176\u4e2d\u7684 L \u4ee3\u8868\u6e90\u6587\u4ef6\u7684\u5206\u6790\u65b9\u5411\u662f\u4ece\u5de6\u5411\u53f3\u7684\uff0c\u800c R \u5219\u4ee3\u8868\u89c4\u5219\u7684\u4f7f\u7528\u65b9\u5411\u662f\u4ece\u53f3\u5411\u5de6\u7684\uff0c\u6216\u8005\u8bf4\u81ea\u5e95\u5411\u4e0a\u7684\u3002</p> <p>\u5f88\u591a\u81ea\u52a8\u5316\u6587\u6cd5\u5206\u6790\u5de5\u5177\uff0c\u4f8b\u5982 <code>yacc</code>\u3001<code>javacc</code> \u7b49\uff0c\u90fd\u662f\u57fa\u4e8e LR \u7b97\u6cd5\u6765\u8fdb\u884c\u6587\u6cd5\u5206\u6790\u7684\u3002\u8fd9\u4e9b\u5de5\u5177\u4e3a\u5f00\u53d1\u65b0\u7684\u8bed\u8a00\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd1\u4e8c\u5341\u5e74\u6765\u65b0\u51fa\u73b0\u7684\u7f16\u7a0b\u8bed\u8a00\u5374\u8d8a\u6765\u8d8a\u559c\u6b22\u4f7f\u7528\u53e6\u5916\u4e00\u79cd\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\uff0c\u5b83\u4e5f\u53eb\u4f5c\u9012\u5f52\u4e0b\u964d\u7684\u5206\u6790\u65b9\u5f0f\u3002\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\u5177\u6709\u7b80\u6d01\u76f4\u89c2\u7684\u4f18\u70b9\uff0c\u4ee3\u7801\u6613\u8bfb\u6613\u7ef4\u62a4\uff0c\u6df1\u53d7\u7f16\u8bd1\u5668\u5f00\u53d1\u4eba\u5458\u7684\u559c\u7231\u3002\u6240\u4ee5\u8fd9\u8282\u8bfe\uff0c\u6211\u5c31\u91cd\u70b9\u4ecb\u7ecd\u9012\u5f52\u4e0b\u964d\u7684\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\u3002</p> <ul> <li> <p>\u4e0b\u9762\u4e3b\u8981\u5b66\u4e60\u9012\u5f52\u4e0b\u964d\u7684\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5</p> <p>\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\uff0c\u5176\u7279\u70b9\u662f\u4ece\u9876\u5c42\u89c4\u5219\u7684\u6700\u5de6\u4fa7\u7684\u7b26\u53f7\u5f00\u59cb\uff0c\u5c1d\u8bd5\u4e0d\u65ad\u5730\u4f7f\u7528\u6587\u6cd5\u4e2d\u7684\u5404\u79cd\u89c4\u5219\uff0c\u5bf9\u8f93\u5165\u5b57\u7b26\u4e32\u8fdb\u884c\u5339\u914d\u3002</p> <p>\u5177\u4f53\u505a\u6cd5\u662f\u5c06\u975e\u7ec8\u7ed3\u7b26\u5b9e\u73b0\u4e3a\u51fd\u6570\uff0c\u5728\u51fd\u6570\u4e2d\u5bf9\u7ec8\u7ed3\u7b26\u8fdb\u884c\u5339\u914d\u3002</p> <p>\u7528\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u7a0b\u5e8f\u6765\u8fdb\u884c\u8bf4\u660e\uff0c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u6587\u6cd5\u89c4\u5219\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\uff1a</p> <pre><code>expr \u2192 term([+\u2223\u2212]term)\u2217\nterm \u2192 factor([\u2217\u2223/])factor)\u2217\nfactor \u2192 NUM\u2223(expr)\n</code></pre> <p>\u9876\u7ea7\u89c4\u5219\u662f expr\uff0c\u8fd9\u6761\u89c4\u5219\u4ee3\u8868\u8868\u8fbe\u5f0f\u7684\u5b9a\u4e49\uff0c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u53ef\u4ee5\u662f\u591a\u9879\u5f0f\u7684\u4e00\u4e2a\u9879\u6216\u8005\u591a\u4e2a\u9879\u7684\u548c\u6216\u8005\u5dee\u3002</p> <p>\u7b2c\u4e8c\u6761\u89c4\u5219\u662f\u9879\u7684\u89c4\u5219\uff0c\u4e00\u4e2a\u9879\u53ef\u4ee5\u662f\u4e00\u4e2a\u56e0\u5b50\uff0c\u6216\u8005\u591a\u4e2a\u56e0\u5b50\u7684\u79ef\u6216\u8005\u5546\u3002\u8fd9\u6761\u89c4\u5219\u4fdd\u8bc1\u4e86\u4e58\u9664\u6cd5\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u52a0\u51cf\u6cd5\u3002</p> <p>\u7b2c\u4e09\u6761\u89c4\u5219\u662f\u56e0\u5b50\u7684\u89c4\u5219\uff0c\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u6216\u8005\u662f\u7528\u62ec\u53f7\u62ec\u8d77\u6765\u7684\u8868\u8fbe\u5f0f\u3002\u8fd9\u5c31\u5b9a\u4e49\u4e86\u62ec\u53f7\u7684\u4f18\u5148\u7ea7\u662f\u6700\u9ad8\u7684\u3002</p> <p>\u8868\u8fbe\u5f0f\uff1aexpression</p> <p>\u9879\uff1aterm</p> <p>\u56e0\u5b50\uff1afactor</p> </li> </ul>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_6","title":"\u5177\u4f53\u5b9e\u73b0\u8fc7\u7a0b","text":"<ol> <li> <p>\u6269\u5c55\u8bcd\u6cd5\u5206\u6790\u5668</p> <p>\u652f\u6301\u5c0f\u62ec\u53f7\u3001\u52a0\u51cf\u7b26\u53f7\u3001\u4e58\u9664\u7b26\u53f7\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nenum State{\n    STATE_INIT,     /* \u72b6\u6001\u673a\u521d\u59cb\u5316 */\n    STATE_VAR,      /* \u53d8\u91cf */\n    STATE_EQU,      /* \u7b49\u53f7 */\n    STATE_NUM,      /* \u6574\u6570 */\n};\n\nenum TokenType{\n    TT_VAR,\n    TT_INTEGER,     \n    TT_STRING,\n    TT_ASSIGN,\n\n    TT_SEMICON,\n    TT_LEFT_PAR,\n    TT_RIGHT_PARL,\n\n    TT_ADD,\n    TT_SUB,\n    TT_MUL,\n    TT_DIV,\n};\n\nunion TokenValue{\n    char *_str;\n    int _int;\n};\n\nstruct Token{\n    enum TokenType _type;\n    union TokenValue _value;\n};\n\nenum State state =  STATE_INIT;\nchar *cur;\n\nstruct Token *create_token(enum TokenType tt, char *begin, char *cur){\n    struct Token *nt = (struct Token*)malloc(sizeof(struct Token));\n    nt-&gt;_type = tt;\n\n    /* \u8fd9\u91cc\u53ea\u9700\u8981\u5bf9\u53d8\u91cf\u8fdb\u884c\u5904\u7406\uff0c\u7b49\u53f7\u3001\u5206\u53f7\u7b49\u7b26\u53f7\u53ea\u9700\u8981\u7c7b\u578b\u5c31\u591f\u4e86\u3002*/\n    if (tt == TT_VAR) {\n        nt-&gt;_value._str = (char *)malloc(cur - begin + 1);\n        strncpy(nt-&gt;_value._str, begin, cur - begin);\n        nt-&gt;_value ._str[cur-begin] = 0;\n    } else if (tt == TT_INTEGER) {\n\n        int sum = 0;\n        for (char *p = begin; p &lt; cur; p++) {\n           sum *= 10;\n           sum += (*p - '0');\n        }\n        nt-&gt;_value._int = sum; \n\n       //  nt-&gt;_value._int = atoi(begin);\n    } else if (tt == TT_ASSIGN) {\n        nt-&gt;_value._str = (char *)malloc(cur - begin + 1);\n        strncpy(nt-&gt;_value._str, begin, cur - begin);\n        nt-&gt;_value ._str[cur-begin] = 0;\n    } \n\n    return nt;\n}\n\nvoid destroy_token(struct Token *t){\n    /* token \u662f\u53d8\u91cf\u7684\u7684\u65f6\u5019\u624d\u9700\u8981free\uff0c\u548c\u4e0a\u9762malloc\u4e00\u6837 */\n    if (t-&gt;_type == TT_VAR) {\n        free(t-&gt;_value._str);\n        t-&gt;_value._str = NULL;\n    }\n\n    free(t);\n}\n\nvoid log_token(struct Token* t) {\n    printf(\"%d\", t-&gt;_type);\n\n    if (t-&gt;_type == TT_VAR) {\n        printf(\", %s\\n\", t-&gt;_value._str);\n    }\n    else if (t-&gt;_type == TT_INTEGER) {\n        printf(\", %d\\n\", t-&gt;_value._int);\n    }\n    else {\n        printf(\"\\n\");\n    }\n}\n\nchar is_alpha(char c) {\n     return (c &lt;= 'Z' &amp;&amp; c &gt;= 'A') || (c &lt;= 'z' &amp;&amp; c &gt;= 'a') || c == '_';\n}\n\nchar is_num(char c) {\n    return c &lt;= '9' &amp;&amp; c &gt;= '0';\n}\n\nstruct Token * next_token(void) {\n    state = STATE_INIT;\n    char *begin = 0;\n\n    while (*cur) {\n        char c = *cur;\n        if (state == STATE_INIT) {\n            /* \u5728\u521d\u6001\u4e0b\uff0c\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u3001\u5236\u8868\u7b49\u90fd\u53ef\u4ee5\u8df3\u8fc7 */\n            if (c == ' ' || c == '\\n' || c == '\\t') {\n                cur++;\n                continue;\n            }\n\n            /* \u9047\u5230\u5b57\u7b26\u5c31\u8ba4\u4e3a\u662f\u4e00\u4e2a\u53d8\u91cf\u7684\u5f00\u59cb\u3002\uff08C\u8bed\u8a00\u53d8\u91cf\u53ea\u80fd\u6709\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\u5f00\u5934\uff09 */\n            if (is_alpha(c)) {\n                begin = cur;\n                state = STATE_VAR;\n                cur++;\n            } else if (c == '=') {\n                /* \u521d\u59cb\u72b6\u6001\u5c31\u9047\u5230\u7b49\u53f7\uff0c\u65e0\u6cd5\u5224\u65ad\u662f\u8d4b\u503c\u64cd\u4f5c\u8fd8\u662f\u7b49\u4e8e\n                 * \u8fdb\u4e00\u6b65--&gt; \u770b\u540e\u9762\u7684\u4e00\u4e2a\u5b57\u7b26\u624d\u77e5\u9053\u3002\n                 * \u540e\u9762\u90a3\u4e2a\u662f' = '\u624d\u662f\u7b49\u4e8e\u7b26\u53f7\n                 */\n                begin = cur;\n                state = STATE_EQU;\n                cur++;\n            } else if (is_num(c)) {\n                begin = cur;\n                state = STATE_NUM;\n                cur++;\n            } else if (c == ';') {\n                begin = cur;\n                cur++;\n                return create_token(TT_SEMICON, begin, cur);\n            } else if (c == '+') {\n                begin = cur;\n                cur++;\n                return create_token(TT_ADD, begin, cur);\n            } else if (c == '-') {\n                begin = cur;\n                cur++;\n                return create_token(TT_SUB, begin, cur);\n            } else if (c == '*') {\n                begin = cur;\n                cur++;\n                return create_token(TT_MUL, begin, cur);\n            } else if (c == '/') {\n                begin = cur;\n                cur++;\n                return create_token(TT_DIV, begin, cur);\n            } else if (c == '(') {\n                begin = cur;\n                cur++;\n                return create_token(TT_LEFT_PAR, begin, cur);\n            } else if (c == ')') {\n                begin = cur;\n                cur++;\n                return create_token(TT_RIGHT_PARL, begin, cur);\n            } \n\n        } else if (state == STATE_VAR) {\n            /* \u5f53\u524d\u72b6\u6001\u673a\u5904\u4e8e\u5206\u6790\u53d8\u91cf\u7684\u9636\u6bb5\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ee7\u7eed\u63a5\u53d7\u5b57\u6bcd\u548c\u6570\u5b57 */\n            if (is_alpha(c) || is_num(c)) {\n                cur++;\n            } else {\n                /* \u53d8\u91cf\u5206\u6790\u5b8c\u6210 */\n                return create_token(TT_VAR, begin, cur);\n            }\n\n        } else if (state == STATE_EQU) {\n            if (c == '=' ) {\n                /* \u5148\u4e0d\u5904\u7406 */\n            } else {\n                return create_token(TT_ASSIGN ,begin, cur);\n            }\n        } else if (state == STATE_NUM) {\n\n            if (is_num(c)) {\n                cur++;\n            } else {\n                return create_token(TT_INTEGER, begin, cur);\n            }\n        } \n\n    }\n\n    return NULL;\n}\n\nint main(int argc, char **argv){\n    cur = \"3 - 2 * 4 + (3 + 5) / 2\";\n\n    //    strncpy(cur, \"init val1 1224 = ;\", 20);\n\n    struct Token *t = next_token();\n    printf(\"%d, %d\\n\", t-&gt;_type, t-&gt;_value._int);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %d\\n\", t-&gt;_type, t-&gt;_value._int);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %d\\n\", t-&gt;_type, t-&gt;_value._int);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n    t = next_token();\n    printf(\"%d, %s\\n\", t-&gt;_type, t-&gt;_value._str);\n    destroy_token(t);\n\n\n    return  0;\n}\n</code></pre> <p>\u7b80\u5355\u4f18\u5316\u3002</p> </li> <li> <p>\u5b9a\u4e49\u6587\u6cd5\u5206\u6790\u5668</p> <p>\u5c06\u975e\u7ec8\u7ed3\u7b26\u7ffb\u8bd1\u6210\u51fd\u6570\u3002\u8868\u8fbe\u5f0f\u7684\u6587\u6cd5\u91cc\u6709\u4e09\u4e2a\u975e\u7ec8\u7ed3\u7b26\uff0c\u5206\u522b\u662f expr\u3001term \u548c factor\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u5b9a\u4e49\u4e09\u4e2a\u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#include \"lexer.h\"\n#include &lt;stdio.h&gt;\n\nstruct Token* t = NULL;\n\n\nint term();\nint factor();\n\nint match(enum TokenType tt) {\n    if (t-&gt;_type != tt) {\n        printf(\"Parse Error, expected %d, but got %d\\n\", tt, t-&gt;_type);\n        return 0;\n    }\n    t = next_token();\n\n    return 1;\n}\n\n\n/* \u8868\u8fbe\u5f0f\u89c4\u5219\u7684\u6587\u6cd5\u89e3\u6790\u8fc7\u7a0b */\nint expr() {\n    int a = 0, b = 0;\n    a = term();\n\n    while (t-&gt;_type == TT_ADD || t-&gt;_type == TT_SUB) {\n        if (t-&gt;_type == TT_ADD) {\n            t = next_token();\n            b = term();\n            a += b;\n        } else if (t-&gt;_type == TT_SUB) {\n            t = next_token();\n            b = term();\n            a -= b;\n        }\n    }\n\n    return a;\n}\n\n/* \u6bcf\u4e00\u9879\u7684\u6587\u6cd5\u5206\u6790 */\nint term() {\n    int a = 0, b = 0;\n    a = factor();\n\n    while (t-&gt;_type == TT_MUL || t-&gt;_type == TT_DIV) {\n        if (t-&gt;_type == TT_MUL) {\n            t = next_token();\n            b = term();\n            a *= b;\n        } else if (t-&gt;_type == TT_DIV) {\n            t = next_token();\n            b = term();\n            a /= b;\n        }\n\n    }\n\n    return a;\n}\n\nint factor() {\n    if (t-&gt;_type == TT_INTEGER) {\n        int a = t-&gt;_value._int;\n        t = next_token();\n        return a;\n    } else if (t-&gt;_type == TT_LEFT_PAR) {\n        t = next_token();\n        int a = expr();\n        if (!match(TT_RIGHT_PAR)) {\n            return 0;\n        } else {\n            return a;\n        }\n    } else {\n        printf(\"Parse error\\n\");\n        return 0 ;\n    }\n}\n</code></pre> <pre><code>expr \u2192 term([+\u2223\u2212]term)\u2217\nterm \u2192 factor([\u2217\u2223/])factor)\u2217\nfactor \u2192 NUM\u2223(expr)\n</code></pre> <p>\u3010\u601d\u60f3\u3011\uff1a</p> <p>\u5176\u4e2d\uff0c\u51fd\u6570 expr \u5bf9\u5e94 expr \u89c4\u5219\uff0c\u51fd\u6570 term \u5bf9\u5e94 term \u89c4\u5219\uff0c\u800c\u51fd\u6570 factor \u5bf9\u5e94 factor \u89c4\u5219\u3002</p> <p>\u5728\u5bf9\u5e94\u7684\u65f6\u5019\uff0c\u6216\u7ed3\u6784\uff08\u4e2d\u62ec\u53f7\u548c\u7ad6\u7ebf\u8868\u793a\u6216\uff09\u5c31\u4f1a\u88ab\u7ffb\u8bd1\u6210 if\u2026else \u8bed\u53e5\uff0c\u800c\u6709\u96f6\u4e2a\u6216\u8005\u591a\u4e2a\uff08\u7528 * \u8868\u793a\uff09\u5c31\u4f1a\u88ab\u7ffb\u8bd1\u6210 while \u8bed\u53e5\u3002\u8fd9\u79cd\u5bf9\u5e94\u89c4\u5219\u662f\u975e\u5e38\u7b80\u660e\u7684\uff0c\u53ea\u8981\u4f60\u4ed4\u7ec6\u5bf9\u7167\u4f53\u4f1a\uff0c\u5c31\u80fd\u660e\u767d\u4e3a\u4ec0\u4e48\u4eba\u4eec\u66f4\u559c\u6b22\u81ea\u9876\u5411\u4e0b\u7684\u5206\u6790\u65b9\u6cd5\u3002\u53ea\u8981\u80fd\u5199\u51fa\u6587\u6cd5\u89c4\u5219\uff0c\u90a3\u4e48\u7ffb\u8bd1\u6210\u4ee3\u7801\u7684\u8fc7\u7a0b\u5c31\u975e\u5e38\u76f4\u63a5\u3002</p> <p>\u8fd9\u91cc\u5e26\u6709\u5f88\u591a\u4ec0\u4e48\u89c4\u5219\u3001\u5de6\u9012\u5f52\u3001\u53f3\u9012\u5f52\u3001\u8868\u8fbe\u5f0f\u6587\u6cd5\uff0c\u6709\u70b9\u61f5\u903c\u3002</p> <p>\u4e0a\u9762\u5728\u505a\u6587\u6cd5\u5206\u6790\u7684\u8fc7\u7a0b\u4e2d\u76f4\u63a5\u628a\u8868\u8fbe\u5f0f\u7684\u503c\u6c42\u51fa\u6765\u4e86\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u7f16\u8bd1\u5668\u5e76\u4e0d\u4f1a\u5728\u6587\u6cd5\u5206\u6790\u9636\u6bb5\u5c31\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u8fd0\u7b97\uff0c\u800c\u662f\u4f1a\u628a\u7a0b\u5e8f\u5148\u7ffb\u8bd1\u6210\u4e00\u79cd\u53eb\u4f5c\u62bd\u8c61\u8bed\u6cd5\u6811\uff08Abstract Syntax Tree, AST\uff09\u7684\u6811\u5f62\u7ed3\u6784\uff0c\u7136\u540e\u518d\u5bf9\u8fd9\u4e2a\u6811\u5f62\u7ed3\u6784\u505a\u5206\u6790\u548c\u53d8\u6362\uff0c\u8fdb\u800c\u7ffb\u8bd1\u6210\u673a\u5668\u6307\u4ee4\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u770b\u4e00\u4e0b\u62bd\u8c61\u8bed\u6cd5\u6811\u7684\u76f8\u5173\u77e5\u8bc6\u3002</p> </li> <li> <p>\u62bd\u8c61\u8bed\u6cd5\u6811</p> <p>\u5148\u8865\u5145\u4e00\u4e9b\u9012\u5f52\u548c\u6811\u548c\u6808\u7684\u77e5\u8bc6\uff1a</p> <p>\u8ba9\u6211\u4eec\u4e00\u6b65\u6b65\u6765\u7406\u89e3\u6811\u3001\u6808\u548c\u9012\u5f52\u4e4b\u95f4\u7684\u8054\u7cfb\uff1a</p> <ol> <li> <p>\u6811</p> <p>\u6811\u662f\u4e00\u79cd\u975e\u7ebf\u6027\u6570\u636e\u7ed3\u6784\uff0c\u7531\u8282\u70b9\u548c\u8fb9\u7ec4\u6210\uff0c\u5177\u6709\u5c42\u7ea7\u5173\u7cfb\u3002\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u6709\u96f6\u4e2a\u6216\u591a\u4e2a\u5b50\u8282\u70b9\uff0c\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u88ab\u79f0\u4e3a\u6839\u8282\u70b9\uff0c\u6ca1\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9\u79f0\u4e3a\u53f6\u8282\u70b9\u3002</p> </li> <li> <p>\u6808</p> <p>\u6808\u662f\u4e00\u79cd\u7ebf\u6027\u6570\u636e\u7ed3\u6784\uff0c\u5177\u6709\u201c\u540e\u8fdb\u5148\u51fa\u201d\u7684\u7279\u70b9\u3002\u6808\u7684\u64cd\u4f5c\u5305\u62ec\u538b\u6808\uff08push\uff09\u548c\u5f39\u6808\uff08pop\uff09\uff0c\u53ea\u80fd\u5728\u6808\u9876\u8fdb\u884c\u64cd\u4f5c\u3002</p> </li> <li> <p>\u9012\u5f52</p> <p>\u9012\u5f52\u662f\u4e00\u79cd\u89e3\u51b3\u95ee\u9898\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u8c03\u7528\u81ea\u8eab\u6765\u89e3\u51b3\u66f4\u5c0f\u89c4\u6a21\u7684\u540c\u7c7b\u95ee\u9898\u3002\u9012\u5f52\u51fd\u6570\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u5f62\u6210\u4e00\u9897\u9012\u5f52\u6811\uff0c\u6bcf\u6b21\u9012\u5f52\u8c03\u7528\u90fd\u4f1a\u5728\u6808\u4e2d\u538b\u5165\u4e00\u4e2a\u65b0\u7684\u5e27\u3002</p> </li> <li> <p>\u6811\u548c\u9012\u5f52</p> <p>\u9012\u5f52\u8c03\u7528\u7684\u51fd\u6570\u672c\u8d28\u4e0a\u662f\u4e00\u9897\u6811\uff1a\u6bcf\u6b21\u9012\u5f52\u8c03\u7528\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u51fd\u6570\u8c03\u7528\u5e27\uff0c\u5f62\u6210\u4e00\u9897\u9012\u5f52\u6811\u3002</p> <p>\u6811\u7684\u6839\u8282\u70b9\u5bf9\u5e94\u521d\u59cb\u7684\u51fd\u6570\u8c03\u7528\uff0c\u6bcf\u4e2a\u5b50\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2a\u9012\u5f52\u8c03\u7528\uff0c\u76f4\u5230\u8fbe\u5230\u9012\u5f52\u7ed3\u675f\u6761\u4ef6\u3002\u5982\u4e0b\u6590\u6ce2\u90a3\u5951\u7684\u4f8b\u5b50\uff1a</p> <pre><code>def fibonacci(n):\n    if n &lt;= 1:\n        return n\n    else:\n        return fibonacci(n-1) + fibonacci(n-2)\n\n# \u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u7b2c5\u9879\nresult = fibonacci(5)\n\n                fibonacci(5)\n             /                \\\n    fibonacci(4)              fibonacci(3)\n     /         \\              /         \\\nfibonacci(3) fibonacci(2) fibonacci(2) fibonacci(1)\n  /         \\\nfibonacci(2) fibonacci(1)\n</code></pre> <p>\u53e6\u5916\uff1a\u6811\u7684\u904d\u5386\u64cd\u4f5c\uff08\u5982\u524d\u5e8f\u3001\u4e2d\u5e8f\u3001\u540e\u5e8f\u904d\u5386\uff09\u901a\u5e38\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0\u3002\u6bcf\u6b21\u9012\u5f52\u8c03\u7528\u5904\u7406\u4e00\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u9012\u5f52\u5730\u5904\u7406\u5176\u5b50\u8282\u70b9\u3002</p> </li> <li> <p>\u6808\u548c\u9012\u5f52</p> <p>\u9012\u5f52\u7684\u7279\u70b9\uff0c\u6211\u7406\u89e3\u8d77\u6765\u5c31\u662f\u5b58\u50a8\u67d0\u4e9b\u6570\u636e\uff0c\u540e\u9762\u53c8\u4ee5\u9006\u5e8f\u6062\u590d\u8fd9\u4e9b\u6570\u636e\u3002\u8fd9\u548c\u6808 FILO \u7684\u7279\u70b9\u975e\u5e38\u50cf\uff0c\u6240\u4ee5\u7f16\u8bd1\u5668\u91cc\u7528\u6808\u6765\u5b9e\u73b0\u5904\u7406\u9012\u5f52\u4e5f\u5f88\u6b63\u5e38\uff1a</p> <p>\u7f16\u8bd1\u5668\u5728\u5904\u7406\u9012\u5f52\u8c03\u7528\u65f6\uff0c\u4f1a\u4f7f\u7528\u6808\u6765\u4fdd\u5b58\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u7684\u72b6\u6001\u3002\u6bcf\u6b21\u8fdb\u884c\u9012\u5f52\u8c03\u7528\u65f6\uff0c\u4f1a\u5c06\u5f53\u524d\u51fd\u6570\u7684\u53c2\u6570\u3001\u5c40\u90e8\u53d8\u91cf\u3001\u8fd4\u56de\u5730\u5740\u548c\u524d\u6808\u6808\u5e95\u7b49\u4fe1\u606f\u538b\u5165\u6808\u4e2d\uff0c\u7136\u540e\u6267\u884c\u65b0\u7684\u51fd\u6570\u8c03\u7528\u3002\u5f53\u9012\u5f52\u8c03\u7528\u7ed3\u675f\u65f6\uff0c\u4f1a\u4ece\u6808\u4e2d\u5f39\u51fa\u4fdd\u5b58\u7684\u72b6\u6001\uff0c\u6062\u590d\u5230\u4e0a\u4e00\u6b21\u51fd\u6570\u8c03\u7528\u7684\u72b6\u6001\uff0c\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\u3002</p> </li> <li> <p>\u6811\u4e0e\u6808</p> <ul> <li>\u5728\u975e\u9012\u5f52\u7684\u6811\u904d\u5386\u7b97\u6cd5\u4e2d\uff0c\u5982\u4e2d\u5e8f\u904d\u5386\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528\u6808\u6765\u8ddf\u8e2a\u5f53\u524d\u7684\u904d\u5386\u72b6\u6001\u3002\u8fd9\u662f\u4e00\u79cd\u8fed\u4ee3\u65b9\u6cd5\uff0c\u5b83\u6a21\u62df\u4e86\u9012\u5f52\u8fc7\u7a0b\u4e2d\u8c03\u7528\u6808\u7684\u884c\u4e3a\u3002</li> </ul> </li> <li> <p>\u7f16\u8bd1\u5668\u5b9e\u73b0\u4e2d\u7684\u9012\u5f52\u548c\u6808</p> <ul> <li>\u5728\u7f16\u8bd1\u5668\u4e2d\uff0c\u9012\u5f52\u4e0b\u964d\u89e3\u6790\u5668\uff08Recursive Descent Parser\uff09\u4f7f\u7528\u9012\u5f52\u6765\u89e3\u6790\u8bed\u6cd5\u6811\u3002\u6bcf\u4e2a\u9012\u5f52\u8c03\u7528\u5bf9\u5e94\u4e8e\u5bf9\u8bed\u6cd5\u89c4\u5219\u7684\u4e00\u6b21\u5c1d\u8bd5\u3002</li> <li>\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u7b26\u53f7\u8868\u7ba1\u7406\u4e5f\u4f1a\u7528\u5230\u6808\u3002\u7b26\u53f7\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u6808\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5f53\u524d\u4f5c\u7528\u57df\u4e2d\u7684\u53d8\u91cf\u548c\u51fd\u6570\u58f0\u660e\u3002\u5f53\u8fdb\u5165\u4e00\u4e2a\u65b0\u7684\u4f5c\u7528\u57df\u65f6\uff0c\u4f1a\u5c06\u65b0\u7684\u7b26\u53f7\u8868\u538b\u5165\u6808\u4e2d\uff1b\u5f53\u9000\u51fa\u4f5c\u7528\u57df\u65f6\uff0c\u4f1a\u5f39\u51fa\u6808\u9876\u7684\u7b26\u53f7\u8868\u3002</li> </ul> </li> <li> <p>\u7efc\u5408\u7406\u89e3</p> <p>\u5728\u9012\u5f52\u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u6b21\u51fd\u6570\u8c03\u7528\u90fd\u4f1a\u5728\u6808\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5e27\uff0c\u5f62\u6210\u4e00\u9897\u9012\u5f52\u6811\u7684\u7ed3\u6784\u3002\u7f16\u8bd1\u5668\u5b9e\u73b0\u4e2d\u901a\u5e38\u4f7f\u7528\u6808\u6765\u4fdd\u5b58\u51fd\u6570\u8c03\u7528\u7684\u72b6\u6001\uff0c\u786e\u4fdd\u9012\u5f52\u8c03\u7528\u80fd\u591f\u6b63\u786e\u6267\u884c\u3002\u56e0\u6b64\uff0c\u6811\u3001\u6808\u548c\u9012\u5f52\u4e4b\u95f4\u5b58\u5728\u7740\u5bc6\u5207\u7684\u8054\u7cfb\uff0c\u901a\u8fc7\u6df1\u5165\u7406\u89e3\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3\u548c\u5e94\u7528\u8fd9\u4e9b\u6982\u5ff5\u3002</p> <p>\u8981\u89e3\u6790\u8bed\u6cd5\u6811\uff0c\u90a3\u5c31\u9700\u8981\u9700\u8981\u9012\u5f52\u6765\u5e2e\u5fd9\uff0c\u9700\u8981\u9012\u5f52\u6765\u5e2e\u5fd9\uff0c\u90a3\u5c31\u9700\u8981\u6808\u5e2e\u5fd9\u5b9e\u73b0\u3002</p> <p>\u9012\u5f52\u7684\u8ba1\u7b97\u673a\u5e95\u5c42\u5b9e\u73b0\u7528\u6808\u6765\u505a\uff0c\u5373\u8c03\u7528\u6808\u6765\u5b58\u50a8\u6bcf\u4e2a\u9012\u5f52\u8c03\u7528\u7684\u72b6\u6001\uff1b\u4e4b\u540e\uff0c\u501f\u52a9\u9012\u5f52\u6765\u89e3\u6790\u7531\u8bcd\u6cd5\u5206\u6790\u751f\u6210\u7684\u8bed\u6cd5\u6811\u3002</p> <p>\u518d\u7531\u4e0a\u5230\u4e0b\u7406\u89e3\u6790\uff1a</p> <ol> <li>\u7f16\u8bd1\u5668\u7684\u8bed\u6cd5\u5206\u6790\u9636\u6bb5\uff08\u89e3\u6790AST\uff09\uff0c\u9012\u5f52\u4e0b\u964d\u89e3\u6790\u5668\u4f7f\u7528\u9012\u5f52\u6765\u5339\u914d\u8f93\u5165\u4ee3\u7801\u7684\u8bed\u6cd5\u7ed3\u6784\u3002\u6bcf\u4e2a\u9012\u5f52\u8c03\u7528\u5c1d\u8bd5\u5339\u914d\u4e00\u4e2a\u8bed\u6cd5\u89c4\u5219\u3002</li> <li>\u9012\u5f52\u4e0b\u964d\u89e3\u6790\u5668\u7684\u6bcf\u6b21\u9012\u5f52\u8c03\u7528\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u6808\u5e27\uff0c\u8fd9\u4e9b\u6808\u5e27\u5728\u8c03\u7528\u6808\u4e2d\u6309\u987a\u5e8f\u4fdd\u5b58\u3002</li> </ol> </li> </ol> <p>\u770b\u300a\u5927\u8bdd\u6570\u636e\u7ed3\u6784\u300b\u7b2c4\u7ae04.9\u6808\u7684\u5e94\u7528----\u56db\u5219\u8fd0\u7b97\u8868\u8fbe\u5f0f</p> <p>\u8865\u5145\u5173\u4e8e\u524d\u7f00\u3001\u4e2d\u7f00\u3001\u540e\u7f00\u8868\u8fbe\u5f0f\u7684\u57fa\u7840\u5185\u5bb9</p> <p>\u5bf9\u4e8e\u8868\u8fbe\u5f0f\u201c3 - 2 * 4 + 5\u201d\uff0c\u5b83\u7684\u62bd\u8c61\u8bed\u6cd5\u6811\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ol> <li> <p>\u5b9a\u4e49AST\u7684\u7ed3\u70b9,\uff0c\u4ece\u4e0a\u56fe\u4e2d\u53ef\u77e5\uff0c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u5305\u542b\u4e86\u52a0\u51cf\u4e58\u9664\u8fd0\u7b97\u7684\u7ed3\u70b9\u548c\u4ee3\u8868\u6574\u6570\u7684\u7ed3\u70b9\uff1a</p> <pre><code>// ast.h\nenum NodeType {\n    NT_INT,\n\n    NT_ADD,\n    NT_SUB,\n    NT_MUL,\n    NT_DIV\n};\n\ntypedef struct {\n    enum NodeType ntype;\n} Node;\n\ntypedef struct {\n    Node parent;\n    int value;\n} IntNode;\n\ntypedef struct {\n    Node parent;\n    Node* left;\n    Node* right;\n} BinOpNode;\n</code></pre> </li> <li> <p>\u5b9a\u4e49\u521b\u5efa\u7ed3\u70b9\u51fd\u6570</p> <pre><code>Node* create_int(int v) {\n    IntNode* in = (IntNode*)malloc(sizeof(IntNode));\n    in-&gt;value = v;\n    in-&gt;parent.ntype = NT_INT;\n    return (Node*) in;\n}\n\nNode* create_binop(enum TokenType tt, Node* left, Node* right) {\n    BinOpNode* node = (BinOpNode*) malloc(sizeof(BinOpNode));\n    node-&gt;left = left;\n    node-&gt;right = right;\n    if (tt == TT_ADD) {\n        node-&gt;parent.ntype = NT_ADD;\n    }\n    else if (tt == TT_SUB) {\n        node-&gt;parent.ntype = NT_SUB;\n    }\n    else if (tt == TT_DIV) {\n        node-&gt;parent.ntype = NT_DIV;\n    }\n    else if (tt == TT_MUL) {\n        node-&gt;parent.ntype = NT_MUL;\n    }\n\n    return (Node*) node;\n}\n</code></pre> </li> <li> <p>\u5c06\u6587\u6cd5\u5206\u6790\u7684\u8fc7\u7a0b\u4ece\u76f4\u63a5\u8ba1\u7b97\u503c\u6539\u6210\u521b\u5efa\u62bd\u8c61\u8bed\u6cd5\u6811\u7ed3\u70b9\uff1a</p> <pre><code>/* \u8868\u8fbe\u5f0f\u5bf9\u5e94\u7684\u51fd\u6570 */\nNode* expr() {\n    Node* a = NULL, *b = NULL;\n    a = term();\n\n    while (t-&gt;_type == TT_ADD || t-&gt;_type == TT_SUB) {\n        if (t-&gt;_type == TT_ADD) {\n            t = next_token();\n            b = term();\n            /* \u8fd9\u91cc\u4e0d\u518d\u662f\u76f4\u63a5\u8ba1\u7b97\uff0c\u800c\u662f\u751f\u6210\u4e00\u4e2a\u8bed\u6cd5\u6811\u7ed3\u70b9 */\n            a = create_binop(TT_ADD, a, b);\n        }\n        else if (t-&gt;_type == TT_SUB) {\n            t = next_token();\n            b = term();\n            a = create_binop(TT_SUB, a, b);\n        }\n    }\n\n    return a;\n}\n\n/* \u9879\u7684\u89c4\u5219 */\nNode* term() {\n    Node* a = NULL, *b = NULL;\n    a = factor();\n\n    while (t-&gt;_type == TT_MUL || t-&gt;_type == TT_DIV) {\n        if (t-&gt;_type == TT_MUL) {\n            t = next_token();\n            b = factor();\n            a = create_binop(TT_MUL, a, b);\n        }\n        else if (t-&gt;_type == TT_DIV) {\n            t = next_token();\n            b = factor();\n            a = create_binop(TT_DIV, a, b);\n        }\n    }\n\n    return a;\n}\n\n/* \u56e0\u5b50\u7684\u89c4\u5219 */\nNode* factor() {\n    if (t-&gt;_type == TT_INTEGER) {\n        /* \u521b\u5efa\u4e00\u4e2a\u4ee3\u8868\u6574\u578b\u7684\u8bed\u6cd5\u6811\u7ed3\u70b9 */\n        Node* a = create_int(t-&gt;_value._int);\n        t = next_token();\n        return a;\n    }\n    else if (t-&gt;_type == TT_LEFT_PAR) {\n        t = next_token();\n        Node* a = expr();\n        if (!match(TT_RIGHT_PAR))\n            return NULL;\n        else\n            return a;\n    }\n    else {\n        printf(\"Parse Error\\n\");\n        return NULL;\n    }\n}\n</code></pre> </li> <li> <p>\u7528\u4e8c\u53c9\u6811\u904d\u5386\u9a8c\u8bc1</p> <pre><code>void post_order(Node* root) {\n    if (root-&gt;ntype == NT_INT) {\n        printf(\"%d \", ((IntNode*)root)-&gt;value);\n    }\n    else {\n        BinOpNode* binop = (BinOpNode*)root;\n        post_order(binop-&gt;left);\n        post_order(binop-&gt;right);\n\n        enum NodeType tt = root-&gt;ntype;\n        if (tt == NT_ADD) {\n            printf(\"+ \");\n        }\n        else if (tt == NT_SUB) {\n            printf(\"- \");\n        }\n        else if (tt == NT_DIV) {\n            printf(\"/ \");\n        }\n        else if (tt == NT_MUL) {\n            printf(\"* \");\n        }\n    }\n}\n</code></pre> </li> </ol> <p>\u6700\u540e\uff1a</p> <p>\u8fd0\u884c\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u6210\u529f\u628a\u4e2d\u7f00\u8868\u8fbe\u5f0f\u8f6c\u6210\u4e86\u540e\u7f00\u8868\u8fbe\u5f0f\u8f93\u51fa\u3002\u5176\u5173\u952e\u4e5f\u5c31\u5728 \u5c06\u4e2d\u7f00\u8868\u8fbe\u5f0f\u53d8\u6210\u4e86\u540e\u7f00\u8868\u8fbe\u5f0f</p> <p>\u540e\u7f00\u8868\u8fbe\u5f0f\u4e5f\u53eb\u4f5c\u9006\u6ce2\u5170\u5e8f\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u4e0a\u8ff0\u4ee3\u7801\u4e0d\u4f7f\u7528\u540e\u5e8f\u904d\u5386\uff0c\u800c\u662f\u4f7f\u7528\u524d\u5e8f\u904d\u5386\uff0c\u7a0b\u5e8f\u7684\u8f93\u51fa\u5c31\u662f\u524d\u7f00\u8868\u8fbe\u5f0f\uff0c\u4f60\u53ef\u4ee5\u81ea\u5df1\u5c1d\u8bd5\u4e00\u4e0b\u3002</p> <p>\u66f4\u8fdb\u4e00\u6b65\uff0c\u5982\u679c\u6211\u4eec\u5728\u5bf9\u8fd9\u4e2a\u62bd\u8c61\u8bed\u6cd5\u6811\u8fdb\u884c\u904d\u5386\u7684\u65f6\u5019\uff0c\u540c\u65f6\u8fdb\u884c\u6c42\u503c\u548c\u8ba1\u7b97\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u89e3\u91ca\u6267\u884c\u3002\u4e0d\u540c\u4e8e\u7f16\u8bd1\u6267\u884c\uff0c\u89e3\u91ca\u6267\u884c\u5f80\u5f80\u6ca1\u6709\u7ecf\u8fc7\u6bd4\u8f83\u597d\u7684\u4f18\u5316\uff0c\u6240\u4ee5\u5b83\u7684\u6267\u884c\u6548\u7387\u5f80\u5f80\u6bd4\u8f83\u4f4e\u3002</p> </li> </ol>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#4","title":"4. \u57fa\u4e8e\u6808\u7684\u5b57\u8282\u7801\u548c\u865a\u62df\u673a","text":"<p>\u8fd9\u8282\u8bfe\u5e94\u8be5\u7ee7\u7eed\u4ecb\u7ecd\u4e2d\u7aef\u548c\u540e\u7aef\u3002\u4f46\u662f\u4e2d\u7aef\u4f18\u5316\u548c\u540e\u7aef\u4ee3\u7801\u751f\u6210\u8fd9\u4e24\u4e2a\u8bdd\u9898\u90fd\u6d89\u53ca\u5f88\u591a\u5185\u5bb9\uff0c\u5c55\u5f00\u6765\u8bb2\u7684\u8bdd\uff0c\u5f80\u5f80\u9700\u8981\u4e00\u6574\u672c\u4e66\u7684\u7bc7\u5e45\u3002\u4e3a\u4e86\u5e2e\u4f60\u901a\u8fc7\u6709\u9650\u7684\u7bc7\u5e45\u5feb\u901f\u7406\u89e3\u7f16\u8bd1\u5668\u7684\u7ed3\u6784\uff0c\u8fd9\u8282\u8bfe\u6211\u4f1a\u4ecb\u7ecd\u4e00\u79cd\u6700\u7b80\u5355\u7684\u6267\u884c\u6a21\u578b\uff1a\u57fa\u4e8e\u6808\u7684\u5b57\u8282\u7801\u548c\u865a\u62df\u673a\u3002</p>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#_7","title":"\u591a\u6587\u4ef6\u548c\u7b2c\u4e09\u65b9\u5e93","text":"<ul> <li>C\u8f6f\u4ef6\u5305\u7ed3\u6784</li> <li>apt</li> </ul>"},{"location":"language/C_asm/compile%20and%20linker/complie%20arch/complie.html#c_2","title":"C\u8fd0\u884c\u65f6\u5e93 \u8de8\u5e73\u53f0\u548c\u4ea4\u53c9\u7f16\u8bd1","text":"<ul> <li>-- <li>\u52a0\u62ff\u5927\u7f16\u8bd1</li>"},{"location":"ysyx/digital-circuit/digital%20circuit.html","title":"Digital Circuit","text":""},{"location":"ysyx/digital-circuit/digital%20circuit.html#verilator","title":"verilator \u914d\u7f6e","text":"<ul> <li> <p>\u6ce8\u610f\u8f6f\u786c\u4ef6\u534f\u540c</p> <p>\u786c\u4ef6\u677f\u5361  &lt;--&gt; \u8f6f\u4ef6diamagnetic</p> </li> </ul> <p>\u5728\u5b9e\u73b0\u6d41\u6c34\u706f\u7684\u65f6\u5019\uff0c\u4e86\u89e3\u6e05\u695a\u6bcf\u4e00\u5c42\u5728\u505a\u4ec0\u4e48\uff1a</p>"},{"location":"ysyx/digital-circuit/digital%20circuit.html#_1","title":"\u6574\u4f53\u6d41\u7a0b","text":"<p>\u5982\u679c\u4e00\u5f00\u59cb\u6ca1\u6709\u63a5\u89e6\u8fc7\u76f8\u5173\u7684\u8f6f\u786c\u4ef6\u534f\u540c\u7684\u6d41\u7a0b\uff0c\u5bf9\u4e8e\u8fd9\u90e8\u5206\u7684\u5b66\u4e60\u53ef\u80fd\u4f1a\u6709\u70b9\u61f5\uff0c\u6240\u4ee5\u6211\u81ea\u5df1\u505a\u4e00\u4e2a\u603b\u7ed3\u6d41\u7a0b\u68b3\u7406\u3002</p> <ul> <li> <p>\u53cc\u63a7\u5f00\u5173\uff1a\u7406\u89e3RTL\u4eff\u771f\u7684\u884c\u4e3a</p> <p>\u9605\u8bfbverilator\u7f16\u8bd1\u51fa\u7684C++\u4ee3\u7801, \u7136\u540e\u7ed3\u5408verilog\u4ee3\u7801, \u5c1d\u8bd5\u7406\u89e3\u4eff\u771f\u5668\u8fdb\u884c\u4eff\u771f\u7684\u65f6\u5019\u90fd\u53d1\u751f\u4e86\u4ec0\u4e48.</p> <p>\u611f\u89c9\u6bd4\u8f83\u590d\u6742~~\u3002C++\u57fa\u672c\u4e0d\u592a\u4f1a\u3002\u3002</p> <p>\u501f\u52a9 doxywizard \u548c GPT \u5927\u6982\u77e5\u9053\u4e00\u70b9\u3002</p> <p></p> <p></p> <p></p> <p>Verilator \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 Verilog \u4eff\u771f\u5668\uff0c\u5b83\u53ef\u4ee5\u5c06 Verilog \u4ee3\u7801\u8f6c\u6362\u6210 C++ \u4ee3\u7801\uff0c\u4ee5\u5b9e\u73b0\u5feb\u901f\u7684\u4eff\u771f\u3002\u4f60\u63d0\u4f9b\u7684 C++ \u4ee3\u7801\u662f Verilator \u6839\u636e\u4f60\u7684 Verilog \u4ee3\u7801\u751f\u6210\u7684\u6a21\u578b\u5b9e\u73b0\u6587\u4ef6\u3002\u4e0b\u9762\u662f\u5bf9\u8fd9\u4e9b\u4ee3\u7801\u7684\u7b80\u8981\u89e3\u91ca\uff0c\u4ee5\u53ca\u5b83\u4eec\u5728\u4eff\u771f\u8fc7\u7a0b\u4e2d\u7684\u4f5c\u7528\uff1a</p> <ol> <li>\u5934\u6587\u4ef6\u5305\u542b\uff1a</li> <li><code>Vtop.h</code>\uff1a\u5305\u542b Verilog \u6a21\u5757 <code>top</code> \u7684\u7c7b\u5b9a\u4e49\u3002</li> <li><code>Vtop__Syms.h</code>\uff1a\u5305\u542b\u7b26\u53f7\u8868\u7684\u5b9a\u4e49\uff0c\u8fd9\u662f Verilator \u7528\u4e8e\u5b58\u50a8\u4fe1\u53f7\u503c\u7684\u6570\u636e\u7ed3\u6784\u3002</li> <li> <p><code>verilated_vcd_c.h</code>\uff1a\u5305\u542b VCD\uff08Value Change Dump\uff09\u6587\u4ef6\u5904\u7406\u7684\u5934\u6587\u4ef6\uff0c\u7528\u4e8e\u6ce2\u5f62\u8f93\u51fa\u3002</p> </li> <li> <p>\u6784\u9020\u51fd\u6570\uff1a</p> </li> <li> <p><code>Vtop::Vtop()</code>\uff1a\u6784\u9020\u51fd\u6570\uff0c\u521d\u59cb\u5316 Verilator \u6a21\u578b\uff0c\u521b\u5efa\u7b26\u53f7\u8868\u5bf9\u8c61\uff0c\u5e76\u6ce8\u518c\u6a21\u578b\u5230 Verilator \u4e0a\u4e0b\u6587\u4e2d\u3002</p> </li> <li> <p>\u6790\u6784\u51fd\u6570\uff1a</p> </li> <li> <p><code>Vtop::~Vtop()</code>\uff1a\u6790\u6784\u51fd\u6570\uff0c\u91ca\u653e\u7b26\u53f7\u8868\u5bf9\u8c61\u3002</p> </li> <li> <p>\u4eff\u771f\u6b65\u9aa4\u51fd\u6570\uff1a</p> </li> <li> <p><code>Vtop::eval_step()</code>\uff1a\u8fd9\u662f\u4eff\u771f\u7684\u6838\u5fc3\u51fd\u6570\uff0c\u6bcf\u6b21\u8c03\u7528\u90fd\u4f1a\u6267\u884c\u4eff\u771f\u7684\u4e00\u6b65\u3002\u5b83\u9996\u5148\u68c0\u67e5\u662f\u5426\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u7136\u540e\u8c03\u7528 <code>Vtop___024root___eval</code> \u51fd\u6570\u6765\u6267\u884c\u6a21\u578b\u7684\u4eff\u771f\u903b\u8f91\u3002</p> </li> <li> <p>\u8c03\u8bd5\u548c\u65ad\u8a00\uff1a</p> </li> <li> <p><code>Vtop___024root___eval_debug_assertions()</code>\uff1a\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\uff0c\u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u6267\u884c\u65ad\u8a00\u68c0\u67e5\u3002</p> </li> <li> <p>\u4e8b\u4ef6\u548c\u5b9a\u65f6\uff1a</p> </li> <li> <p><code>Vtop::eventsPending()</code> \u548c <code>Vtop::nextTimeSlot()</code>\uff1a\u8fd9\u4e9b\u51fd\u6570\u7528\u4e8e\u5904\u7406\u4e8b\u4ef6\u9a71\u52a8\u7684\u4eff\u771f\uff0c\u4f46\u5728\u4f60\u7684\u4ee3\u7801\u4e2d\u5b83\u4eec\u88ab\u7b80\u5316\u4e86\uff0c\u56e0\u4e3a\u6ca1\u6709\u4f7f\u7528 Verilog \u7684\u65f6\u5e8f\u63a7\u5236\u8bed\u53e5\u3002</p> </li> <li> <p>\u6700\u7ec8\u5757\u8c03\u7528\uff1a</p> </li> <li> <p><code>Vtop___024root___eval_final()</code>\uff1a\u5728\u4eff\u771f\u7ed3\u675f\u65f6\u8c03\u7528\uff0c\u7528\u4e8e\u6267\u884c Verilog \u4e2d\u7684 <code>final</code> \u5757\u3002</p> </li> <li> <p>\u8ffd\u8e2a\u914d\u7f6e\uff1a</p> </li> <li> <p><code>Vtop::trace()</code> \u548c\u76f8\u5173\u51fd\u6570\uff1a\u8fd9\u4e9b\u51fd\u6570\u7528\u4e8e\u914d\u7f6e\u548c\u521d\u59cb\u5316 VCD \u8ffd\u8e2a\uff0c\u5141\u8bb8\u4f60\u89c2\u5bdf\u4eff\u771f\u8fc7\u7a0b\u4e2d\u4fe1\u53f7\u7684\u53d8\u5316\u3002</p> </li> <li> <p>Verilog \u4ee3\u7801\uff1a</p> </li> <li>\u4f60\u7684 Verilog \u4ee3\u7801\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9876\u5c42\u6a21\u5757 <code>top</code> \u548c\u4e00\u4e2a\u8f85\u52a9\u6a21\u5757 <code>x_or</code>\u3002<code>top</code> \u6a21\u5757\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u7684\u8f93\u5165\u8f93\u51fa\u7aef\u53e3\uff0c\u5e76\u901a\u8fc7\u5b9e\u4f8b\u5316 <code>x_or</code> \u6a21\u5757\u6765\u5b9e\u73b0\u903b\u8f91\u529f\u80fd\u3002</li> </ol> <p>\u5728\u4eff\u771f\u8fc7\u7a0b\u4e2d\uff0cVerilator \u4f1a\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ul> <li>\u521d\u59cb\u5316\uff1a\u6784\u9020\u51fd\u6570\u4e2d\u8fdb\u884c\u6a21\u578b\u548c\u7b26\u53f7\u8868\u7684\u521d\u59cb\u5316\u3002</li> <li>\u4eff\u771f\u5faa\u73af\uff1a\u5728 <code>eval_step()</code> \u4e2d\uff0c\u6bcf\u6b21\u5faa\u73af\u90fd\u4f1a\u6839\u636e\u5f53\u524d\u7684\u8f93\u5165\u4fe1\u53f7\u503c\u6765\u66f4\u65b0\u8f93\u51fa\u4fe1\u53f7\uff0c\u5e76\u6267\u884c Verilog \u4ee3\u7801\u4e2d\u7684\u903b\u8f91\u3002</li> <li>\u4fe1\u53f7\u8ffd\u8e2a\uff1a\u5982\u679c\u542f\u7528\u4e86 VCD \u8ffd\u8e2a\uff0c\u4eff\u771f\u8fc7\u7a0b\u4e2d\u4fe1\u53f7\u7684\u53d8\u5316\u4f1a\u88ab\u8bb0\u5f55\u4e0b\u6765\uff0c\u4f9b\u540e\u7eed\u5206\u6790\u4f7f\u7528\u3002</li> <li>\u6e05\u7406\uff1a\u5728\u4eff\u771f\u7ed3\u675f\u65f6\uff0c\u8c03\u7528\u6790\u6784\u51fd\u6570\u91ca\u653e\u8d44\u6e90\u3002</li> </ul> <p>\u7406\u89e3\u8fd9\u4e9b\u4ee3\u7801\u548c\u4eff\u771f\u8fc7\u7a0b\u5bf9\u4e8e\u8c03\u8bd5\u548c\u4f18\u5316\u4f60\u7684\u786c\u4ef6\u8bbe\u8ba1\u662f\u975e\u5e38\u6709\u5e2e\u52a9\u7684\u3002\u5982\u679c\u4f60\u6709\u5177\u4f53\u7684\u95ee\u9898\u6216\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u89e3\u91ca\uff0c\u8bf7\u968f\u65f6\u63d0\u95ee\u3002</p> <p>\u4f46\u662f\u6211\u76ee\u524d\u8fd8\u6ca1\u627e\u5230\u600e\u4e48\u5728\u6784\u9020\u51fd\u6570\u7684\u5730\u65b9\u6253\u65ad\u70b9\uff0c\u6ca1\u5b66\u8fc7C++\u3002\u3002\u5148\u7559\u5751\uff0c</p> </li> </ul>"},{"location":"ysyx/digital-circuit/digital%20circuit.html#_2","title":"\u786c\u4ef6\u8bbe\u8ba1\u6d41\u7a0b","text":"<p>\u4ece\u7535\u8def\u8bbe\u8ba1\u7684\u89d2\u5ea6\u5165\u95e8VerilogHDL_\u54d4\u54e9\u54d4\u54e9</p>"},{"location":"ysyx/digital-circuit/digital%20circuit.html#_3","title":"\u8f6f\u786c\u4ef6\u534f\u540c\u6d41\u7a0b","text":"<ol> <li> <p>\u7f16\u5199Verilog\u4ee3\u7801</p> <p>\u521b\u5efa\u63cf\u8ff0\u786c\u4ef6\u884c\u4e3a\u7684Verilog\u6a21\u5757\u3002\uff08light\u3001top \u5143\u4ef6\u6a21\u5757\uff09</p> </li> <li> <p>\u4f7f\u7528Verilator\u751f\u6210C++\u6a21\u578b</p> <p>\u901a\u8fc7Verilator\u5c06Verilog\u4ee3\u7801\u8f6c\u6362\u6210C++\u6a21\u578b\uff0c\u8fd9\u6837\u4f7f\u5f97\u6211\u4eec\u4e0d\u5b9e\u9645\u70e7\u5199\u5230FPGA\u4e0a\u4e5f\u80fd\u8fdb\u7a0b\u5feb\u901f\u7684\u6d4b\u8bd5\u548c\u9a8c\u8bc1\u3002</p> </li> <li> <p>\u7f16\u5199C++\u6fc0\u52b1\u6587\u4ef6</p> <p>\u521b\u5efaC++\u7a0b\u5e8f\uff0c\u7528\u4e8e\u6a21\u62df\u786c\u4ef6\u64cd\u4f5c\u73af\u5883\u548c\u63d0\u4f9b\u6d4b\u8bd5\u6fc0\u52b1\u3002</p> </li> <li> <p>\u751f\u6210\u5f15\u811a\u7ed1\u5b9a\u4ee3\u7801</p> <p>\u4f7f\u7528NVBoard\u63d0\u4f9b\u7684\u811a\u672c\u751f\u6210\u5f15\u811a\u7ed1\u5b9a\u4ee3\u7801\u3002</p> </li> <li> <p>\u7f16\u8bd1Verilog\u4ee3\u7801\u5230NVBoard\u652f\u6301\u7684\u683c\u5f0f</p> <p>\u5c06Verilog\u4ee3\u7801\u7f16\u8bd1\u4e3aFPGA\u53ef\u6267\u884c\u7684\u683c\u5f0f\uff0c\u5e76\u5c06NVBoard\u5e93\u6587\u4ef6\u52a0\u5165\u5230\u9879\u76ee\u4e2d\u3002</p> </li> <li> <p>\u5728NVBoard\u4e0a\u52a0\u8f7d\u548c\u8fd0\u884c\u786c\u4ef6--\u8fd0\u884c\u4eff\u771f</p> <p>\u6267\u884cC++\u6fc0\u52b1\u6587\u4ef6\uff0c\u52a0\u8f7dNVBoard\uff0c\u8fdb\u884c\u786c\u4ef6\u4eff\u771f\u3002</p> </li> <li> <p>\u4eff\u771f\u6d4b\u8bd5</p> <ul> <li>\u5982\u679c\u4f7f\u7528Verilator\u751f\u6210\u7684C++\u6a21\u578b\uff0c\u4f60\u53ef\u4ee5\u5728C++\u73af\u5883\u4e2d\u8fdb\u884c\u5feb\u901f\u4eff\u771f\uff0c\u89c2\u5bdf\u786c\u4ef6\u903b\u8f91\u662f\u5426\u6309\u9884\u671f\u5de5\u4f5c\uff0c\u5e76\u901a\u8fc7VCD\u6587\u4ef6\u8bb0\u5f55\u4eff\u771f\u8fc7\u7a0b\u4e2d\u7684\u4fe1\u53f7\u53d8\u5316\u3002</li> <li>\u5982\u679c\u5728NVBoard\u4e0a\u8fd0\u884c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7NVBoard\u63d0\u4f9b\u7684\u754c\u9762\u4e0e\u865a\u62df\u786c\u4ef6\u4ea4\u4e92\uff0c\u4f8b\u5982\uff0c\u4f7f\u7528\u62e8\u7801\u5f00\u5173\u4f5c\u4e3a\u8f93\u5165\uff0c\u89c2\u5bdfLED\u706f\u7684\u53d8\u5316\u6216VGA\u663e\u793a\u5668\u7684\u8f93\u51fa\u3002</li> </ul> <p>\u6839\u636e\u4eff\u771f\u548c\u6d4b\u8bd5\u7684\u7ed3\u679c\uff0c\u4e0d\u65ad\u4fee\u6539Verilog\u3002</p> </li> <li> <p>\u6700\u7ec8\u9a8c\u8bc1</p> <p>\u5728NVBoard\u4e0a\u5b8c\u6210\u6240\u6709\u6d4b\u8bd5\u3002</p> </li> <li> <p>NVBoard \u4e0e C++\u6fc0\u52b1\u6587\u4ef6 \u4e0e verilator\u7f16\u8bd1\u51fa\u7684C++\u6a21\u578b \u534f\u540c</p> <p>\u56e0\u4e3a\u6211\u7f16\u8bd1\u51fa\u6765\u7684verilator\u662f\u8dd1\u5728nvboard\u4e0a\u7684\uff0c\u6240\u4ee5\uff0c\u600e\u4e48\u5c06verilator\u7684\u4eff\u771f\u7ed3\u679c\u548c\u865a\u62df\u786c\u4ef6\u677f\u5361\u8054\u7cfb\u8d77\u6765\uff1f</p> <ol> <li>\u5c06Verilog\u6a21\u5757\u7528\u5230\u7684\u5f15\u811a\u7ed1\u5b9a\u5230NVboard\u4e0a<code>nvboard_bind_pin()</code>\uff1b\u518d\u5728\u6211\u7684\u6fc0\u52b1\u6587\u4ef6\u4e2d\u8c03\u7528 <code>nvboard_init()</code> \u51fd\u6570\u6765\u521d\u59cb\u5316NVBoard\uff0c\u8bbe\u7f6e\u4eff\u771f\u6240\u9700\u7684\u865a\u62df\u786c\u4ef6\u73af\u5883\u3002</li> <li>\u7136\u540e\uff0c\u5728\u4eff\u771f\u5faa\u73af\u4e2d\uff0c\u786e\u4fdd\u6bcf\u6b21\u66f4\u65b0Verilog\u6a21\u5757\u7684\u4fe1\u53f7\u540e\uff0c\u6fc0\u52b1\u4ee3\u7801\u90fd\u8c03\u7528 <code>nvboard_update()</code> \u51fd\u6570\u6765\u540c\u6b65NVBoard\u4e0a\u7684\u7ec4\u4ef6\u72b6\u6001\u3002\u7531\u6b64\uff0cNVBoard\u4e0a\u7684\u663e\u793a\u548c\u8f93\u5165\u8bbe\u5907\u5373\u53ef\u53cd\u6620Verilog\u6a21\u5757\u7684\u6700\u65b0\u72b6\u6001\u3002</li> </ol> <p>\u5bf9\u4e8eC++\u6fc0\u52b1\u6a21\u578b\uff1a\u6211\u4eec\u5728NVBoard\u4e0a\u8fd0\u884c\u786c\u4ef6\u65f6\uff0cC++\u6fc0\u52b1\u6587\u4ef6\u6a21\u62df\u8f93\u5165\u4fe1\u53f7\uff0cNVBoard\u663e\u793a\u8f93\u51fa\u4fe1\u53f7\uff0c\u6a21\u62df\u7528\u6237\u4ea4\u4e92\u3002</p> <p>\u4f8b\u5982\uff0c\u901a\u8fc7C++\u4ee3\u7801\u6a21\u62df\u62e8\u7801\u5f00\u5173\u7684\u72b6\u6001\u53d8\u5316\uff0c\u89c2\u5bdf\u8fd9\u4e9b\u53d8\u5316\u5982\u4f55\u5f71\u54cdLED\u706f\u7684\u72b6\u6001</p> <p>\u5b9e\u9645\u4e0a\u6211\u4eec\u770b\u5230 .v\u5143\u4ef6\u4ee3\u7801\u91cc\u7684\u8f93\u5165\u8f93\u51fa\u4fe1\u53f7\u53ef\u4ee5\u4e0d\u7ed1\u5b9a\u677f\u5b50\u5f15\u811a\uff0c\u53ef\u4ee5\u76f4\u63a5\u7559\u7a7a\u6216\u8005\u8ba9C++\u4ee3\u7801\u7ba1\u7406\uff0c\u5c31\u6bd4\u5982rst\uff0cclk\uff0c\u5c31\u662f\u76f4\u63a5\u901a\u8fc7\u4ee3\u7801\u8d4b\u503c\u7684\u3002</p> <p>\u4f46\u662f\u4e3a\u4ec0\u4e48\u4e0d\u5c06rst\u7ed1\u5b9a\u5230\u67d0\u4e2a\u6309\u952e\u4e0a\u5462\uff1f\u5e94\u8be5\u662f\u53ef\u4ee5\u7684\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u770b\u770b README.md \u6216\u8005\u6e90\u7801</p> </li> <li> <p>\u6d41\u6c34\u706f\uff1a\u7406\u89e3RTL\u4eff\u771f\u7684\u884c\u4e3a(2)</p> <p>\u9605\u8bfbverilator\u7f16\u8bd1\u51fa\u7684C++\u4ee3\u7801, \u7136\u540e\u7ed3\u5408verilog\u4ee3\u7801, \u5c1d\u8bd5\u7406\u89e3\u4eff\u771f\u5668\u662f\u5982\u4f55\u5bf9\u65f6\u5e8f\u903b\u8f91\u7535\u8def\u8fdb\u884c\u4eff\u771f\u7684.</p> <p></p> <p>\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u770b\u5230\u65f6\u5e8f\u903b\u8f91\u7535\u8def\u548c\u4e4b\u524d\u7684\u53cc\u63a7\u5f00\u5173\u7684\u6fc0\u52b1\u6587\u4ef6\u4e0d\u592a\u4e00\u6837\uff0cC++</p> <p></p> </li> </ol> <p>add \u56fe\u50cf\u76f8\u5173</p> <p>\u5728\u8ba1\u7b97\u673a\u8bbe\u5907\u4e0a\u52a0\u8f7d\u5230\u56fe\u7247\u662f\u600e\u4e48\u5f62\u6210\u7684\uff1f \u672c\u8d28\u662f\u50cf\u7d20\uff0c\u5b57\u8282\u5e8f\u5217\uff0c\u4f46\u662f\u662f\u600e\u4e48\u6709\u8fd9\u79cd\u73b0\u5b9e\u4e16\u754c\u4e2d\u7684\u8272\u5f69\u7684\u56fe\u5462\uff1f\u600e\u4e48\u751f\u6210\u8fd9\u79cd\u50cf\u7d20\u7684\uff1f \u96be\u9053\u8981\u6211\u7528 SDL \u4e0a\u7528\u76f8\u5173\u7684 API \u624b\u52a8\u753b\u56fe\uff1f\u663e\u7136\u4e0d\u53ef\u80fd\uff1f\u9700\u8981\u4e86\u89e3\u4e00\u4e0b\u600e\u4e48\u751f\u6210\u8fd9\u79cd\u56fe\u7684\uff1f \u7f51\u4e0a\u641c\u96c6\u76f8\u5173\u8d44\u6599</p> <p>\u5728\u8ba1\u7b97\u673a\u8bbe\u5907\u4e0a\u52a0\u8f7d\u56fe\u7247\u7684\u8fc7\u7a0b\u53ef\u4ee5\u5206\u4e3a\u51e0\u4e2a\u6b65\u9aa4\uff0c\u6d89\u53ca\u4e0d\u540c\u7684\u6280\u672f\u548c\u7ec4\u4ef6\u3002\u9996\u5148\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u56fe\u7247\u6587\u4ef6\u7684\u6269\u5c55\u540d\u8bc6\u522b\u6587\u4ef6\u7c7b\u578b\uff0c\u7136\u540e\u4f7f\u7528\u76f8\u5e94\u7684\u89e3\u7801\u5668\u6765\u89e3\u6790\u56fe\u7247\u6570\u636e\u3002\u56fe\u7247\u6587\u4ef6\u901a\u5e38\u5305\u62ec\u56fe\u7247\u6570\u636e\u672c\u8eab\u548c\u5143\u6570\u636e\uff0c\u5982\u5927\u5c0f\u3001\u989c\u8272\u6df1\u5ea6\u3001\u5206\u8fa8\u7387\u7b49\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5bf9\u4e8e\u6b63\u786e\u663e\u793a\u56fe\u7247\u81f3\u5173\u91cd\u8981\u3002\u89e3\u7801\u5668\u5c06\u538b\u7f29\u7684\u56fe\u7247\u6570\u636e\u8f6c\u6362\u6210\u50cf\u7d20\u6570\u636e\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u89e3\u7801\u3002\u4f8b\u5982\uff0cJPEG\u683c\u5f0f\u4f7f\u7528\u6709\u635f\u538b\u7f29\uff0c\u800cPNG\u683c\u5f0f\u4f7f\u7528\u65e0\u635f\u538b\u7f29\u3002</p> <p>\u50cf\u7d20\u6570\u636e\u968f\u540e\u88ab\u9001\u5165\u56fe\u5f62\u5904\u7406\u5355\u5143\uff08GPU\uff09\uff0cGPU\u6839\u636e\u50cf\u7d20\u6570\u636e\u7ed8\u5236\u51fa\u56fe\u7247\u7684\u6bcf\u4e2a\u50cf\u7d20\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u6e32\u67d3\u3002\u8ba1\u7b97\u673a\u8fd8\u4f1a\u8003\u8651\u663e\u793a\u5668\u7684\u5927\u5c0f\u548c\u5206\u8fa8\u7387\uff0c\u4ee5\u786e\u4fdd\u56fe\u7247\u80fd\u591f\u6b63\u786e\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002</p> <p>\u9664\u4e86\u4f20\u7edf\u7684\u56fe\u7247\u52a0\u8f7d\u548c\u663e\u793a\u8fc7\u7a0b\uff0c\u8fd8\u6709\u73b0\u4ee3\u7684\u56fe\u50cf\u751f\u6210\u6280\u672f\uff0c\u5982\u4f7f\u7528\u4eba\u5de5\u667a\u80fd\u7b97\u6cd5\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u56fe\u50cf\u3002\u6df1\u5ea6\u5b66\u4e60\u6280\u672f\uff0c\u7279\u522b\u662f\u751f\u6210\u5bf9\u6297\u7f51\u7edc\uff08GAN\uff09\u548c\u53d8\u5206\u81ea\u7f16\u7801\u5668\uff08VAE\uff09\uff0c\u5728\u56fe\u50cf\u751f\u6210\u9886\u57df\u5f97\u5230\u4e86\u5e7f\u6cdb\u5e94\u7528\u3002\u8fd9\u4e9b\u6280\u672f\u53ef\u4ee5\u7528\u4e8e\u827a\u672f\u521b\u4f5c\u3001\u6e38\u620f\u5f00\u53d1\u3001\u865a\u62df\u73b0\u5b9e\u7b49\u591a\u4e2a\u9886\u57df\uff0c\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u6587\u672c\u63d0\u793a\u6216\u6570\u5b66\u6a21\u578b\u751f\u6210\u5177\u6709\u827a\u672f\u548c\u521b\u9020\u6027\u7684\u56fe\u50cf\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5728\u7ebf\u5de5\u5177\u548c\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982Stable Diffusion\u548cPixel-Art.ai\uff0c\u5b83\u4eec\u5229\u7528AI\u6280\u672f\u7b80\u5316\u56fe\u50cf\u751f\u6210\u8fc7\u7a0b\uff0c\u5141\u8bb8\u7528\u6237\u8f93\u5165\u63cf\u8ff0\u6027\u6587\u672c\u63d0\u793a\u6216\u4f7f\u7528\u5185\u7f6e\u7684\u50cf\u7d20\u827a\u672f\u5de5\u4f5c\u5ba4\u6765\u521b\u5efa\u548c\u7f16\u8f91\u56fe\u50cf\u3002\u8fd9\u4e9b\u5de5\u5177\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b0\u9896\u7684\u56fe\u50cf\u521b\u4f5c\u65b9\u5f0f\uff0c\u4e5f\u4f7f\u5f97\u6ca1\u6709\u4e13\u4e1a\u56fe\u5f62\u8bbe\u8ba1\u6280\u80fd\u7684\u7528\u6237\u4e5f\u80fd\u8f7b\u677e\u5236\u4f5c\u51fa\u9ad8\u8d28\u91cf\u7684\u56fe\u50cf\u4f5c\u54c1\u3002</p> <p>\u5728\u5f00\u53d1\u9886\u57df\uff0c\u4f8b\u5982\u4f7f\u7528SDL\uff08Simple DirectMedia Layer\uff09\u8fd9\u6837\u7684\u5e93\uff0c\u53ef\u4ee5\u901a\u8fc7API\u5982SDL_IMAGE\u6765\u5bfc\u5165\u4e0d\u540c\u683c\u5f0f\u7684\u56fe\u7247\uff0c\u7136\u540e\u901a\u8fc7SDL_Surface\u548cSDL_Texture\u7b49\u5bf9\u8c61\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u663e\u793a\u8fd9\u4e9b\u56fe\u7247\u3002\u8fd9\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4e86\u4e00\u79cd\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u52a0\u8f7d\u548c\u6e32\u67d3\u56fe\u7247\u7684\u65b9\u6cd5\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u8ba1\u7b97\u673a\u52a0\u8f7d\u56fe\u7247\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u6d89\u53ca\u6587\u4ef6\u8bc6\u522b\u3001\u6570\u636e\u8bfb\u53d6\u3001\u89e3\u7801\u548c\u6e32\u67d3\u7684\u590d\u6742\u8fc7\u7a0b\uff0c\u800c\u73b0\u4ee3\u56fe\u50cf\u751f\u6210\u6280\u672f\u5219\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u66f4\u591a\u521b\u9020\u6027\u7684\u56fe\u50cf\u521b\u4f5c\u65b9\u6cd5\u3002</p>"},{"location":"ysyx/pa/Linux_porting/porting.html","title":"Linux Porting","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#task","title":"Task","text":"<p>\u5206\u4e3a\u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u5904\u7406\u5668<ul> <li>RV32IMA \u6269\u5c55</li> <li>Zicsr \u6269\u5c55</li> <li>\u65f6\u949f\u4e2d\u65ad</li> <li>\u76f8\u5173\u8bbe\u5907</li> </ul> </li> <li>Linux\u79fb\u690d</li> </ul>"},{"location":"ysyx/pa/Linux_porting/porting.html#_1","title":"\u5904\u7406\u5668","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#rv32ima","title":"~~RV32I\u3001M\u3001A \u6269\u5c55~~","text":"<pre><code>test list [56 item(s)]: amoadd_w amoand_w amomaxu_w amomax_w amominu_w \n    amomin_w amoor_w amoswap_w amoxor_w lrsc \n    addi add andi and auipc beq bge bgeu blt bltu bne jalr jal \n    lb lbu lh lhu lui lw ori or sb sh simple slli \n    sll slti sltiu slt sltu srai sra srli \n    srl sub sw xori xor div divu mulh mulhsu mulhu mul rem remu\n[      amoadd_w] PASS\n[      amoand_w] PASS\n[     amomaxu_w] PASS\n[      amomax_w] PASS\n[     amominu_w] PASS\n[      amomin_w] PASS\n[       amoor_w] PASS\n[     amoswap_w] ***FAIL***\n[      amoxor_w] PASS\n[          lrsc] PASS\n[          addi] PASS\n[           add] PASS\n[          andi] PASS\n[           and] PASS\n[         auipc] PASS\n[           beq] PASS\n[           bge] PASS\n[          bgeu] PASS\n[           blt] PASS\n[          bltu] PASS\n[           bne] PASS\n[          jalr] PASS\n[           jal] PASS\n[            lb] PASS\n[           lbu] PASS\n[            lh] PASS\n[           lhu] PASS\n[           lui] PASS\n[            lw] PASS\n[           ori] PASS\n[            or] PASS\n[            sb] PASS\n[            sh] PASS\n[        simple] PASS\n[          slli] PASS\n[           sll] PASS\n[          slti] PASS\n[         sltiu] PASS\n[           slt] PASS\n[          sltu] PASS\n[          srai] PASS\n[           sra] PASS\n[          srli] PASS\n[           srl] PASS\n[           sub] PASS\n[            sw] PASS\n[          xori] PASS\n[           xor] PASS\n[           div] PASS\n[          divu] PASS\n[          mulh] PASS\n[        mulhsu] PASS\n[         mulhu] PASS\n[           mul] PASS\n[           rem] PASS\n[          remu] PASS\n</code></pre>"},{"location":"ysyx/pa/Linux_porting/porting.html#zicsr","title":"\u5b9e\u73b0 <code>Zicsr</code> \u6269\u5c55","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#basic-instructions","title":"basic instructions","text":"<p>\u7b2c\u516d\u671f\"\u4e00\u751f\u4e00\u82af\"\u8bfe\u7a0b\u4e3b\u9875 | \u5b98\u65b9\u6587\u6863</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#csr","title":"CSR","text":"<p>\u5404\u4e2a CSR \u6539\u4e3a\u7528 bitfield \u5b9e\u73b0</p> <p>\u5404\u4e2a\u7279\u6743\u7ea7</p> <ul> <li> <p>mcause </p> <p></p> <p>\u518d\u5728 nemu \u91cc\u6dfb\u52a0\u4e00\u4e9b\u679a\u4e3e\u503c\u5373\u53ef\u3002</p> <p>\u5982\u679c etrace \u518d\u52a0\u529f\u80fd\u4e00\u70b9\uff0c\u53ef\u4ee5\u7528 X-Macro \u6765\u5f04\u5f04\uff1f</p> <p>\u4e0d\u884c\uff0c\u6bd4\u8f83\u9ebb\u70e6\uff0c\u7b97\u4e86\uff0c\u76f4\u63a5\u679a\u4e3e\u503c\u81ea\u5df1\u67e5\u7c7b\u578b</p> </li> <li> <p>mstatus</p> <p>\u540c\u4e0a\uff0c\u4f46\u8bb0\u5f97\u66f4\u6539 mret\u3001ecall \u76f8\u5173\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\u518d\u770b\u770b\u624b\u518c\u4e2d\u7684\u76f8\u5173\u4ecb\u7ecd\u3002</p> <p>chapter1_riscv.md \u00b7 \u534e\u4e2d\u79d1\u6280\u5927\u5b66\u64cd\u4f5c\u7cfb\u7edf\u56e2\u961f/pke-doc - Gitee.com</p> <p>\u53ef\u4ee5\u770b\u770b\u76f8\u5173 mstatus \u5404\u4e2a\u4f4d\u8868\u793a\u7684\u542b\u4e49\uff0c\u4e0d\u8fc7\u5904\u7406\u5668\u8fd9\u90e8\u5206\uff0c\u6211\u4eec\u53ea\u9700\u63d0\u4f9b\u597d\u786c\u4ef6\u5b9e\u73b0\u5373\u53ef\uff0c\u8fd9\u4e9b\u4f4d\u5e94\u8be5\u662fOS\u3001ABI \u90a3\u65b9\u9762\u8981\u505a\u7684\u3002</p> </li> </ul> <p>RISC-V Non-MMU Linux (1): \u4ece\u5185\u6838\u5230\u5e94\u7528\u8dd1\u901a\u4e00\u904d - \u6cf0\u6653\u79d1\u6280 (tinylab.org)</p> <p>RISC-V Non-MMU Linux (2): \u4ece M/S/U \u5230 M/U \u7684\u5c42\u7ea7\u8f6c\u53d8 - \u6cf0\u6653\u79d1\u6280 (tinylab.org)</p> <p>\u4ece\u96f6\u5f00\u59cb\uff0c\u5f92\u624b\u5199\u4e00\u4e2a RISC-V \u6a21\u62df\u5668\uff083\uff09\u2014\u2014 CSR \u4e0e\u7279\u6743\u7ea7 ISA - \u6cf0\u6653\u79d1\u6280 (tinylab.org)</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_2","title":"\u4e2d\u65ad\u76f8\u5173\u5185\u5bb9","text":"<p>\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u79fb\u690d\uff0c\u4e3b\u8981\u5c31\u662f\u5b9e\u73b0 \u65f6\u949f\u4e2d\u65ad\uff0c\u5269\u4f59\u7684 \u8f6f\u4ef6\u4e2d\u65ad\u3001\u5916\u90e8\u4e2d\u65ad\u53ef\u4ee5\u5b9e\u73b0\u4e3a\u7a7a\u3002</p> <ul> <li> <p>\u57fa\u7840\u6982\u5ff5</p> <p>\u5728\u79cd\u7c7b\u4e0a\uff0cRISC-V \u5c06\u4e2d\u65ad\uff08interrupt\uff09\u4e3b\u8981\u5206\u4e3a\u4e86\u4e09\u79cd\uff1a</p> <ul> <li> <p>software interrupt\uff08\u8f6f\u4ef6\u4e2d\u65ad\uff09</p> <p>\u8f6f\u4ef6\u4e2d\u65ad\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5668\u5185\u6838\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5373\u5904\u7406\u5668\u95f4\u4e2d\u65ad\uff08Inter-Processor Interrupt, IPI\uff09\uff0c\u4e5f\u79f0\u6838\u95f4\u4e2d\u65ad\u3002</p> </li> <li> <p>timer interrupt\uff08\u5b9a\u65f6\u5668\u4e2d\u65ad\uff09</p> <p>\u5b9a\u65f6\u5668\u4e2d\u65ad\u4e3a\u6765\u81ea\u5b9a\u65f6\u5668\u7684\u4e2d\u65ad\uff0c\u901a\u5e38\u7528\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u949f\u4e2d\u65ad\uff0c\u5373\u7528\u4e8e\u4ea7\u751f\u7cfb\u7edf\u7684tick\u3002</p> <p>RISC-V \u4f53\u7cfb\u7ed3\u6784\u89c4\u5b9a\u5904\u7406\u5668\u5fc5\u987b\u6709\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u901a\u5e38\u4e3a <code>mtime</code> \u3002 </p> </li> <li> <p>external interrupt\uff08\u5916\u90e8\u4e2d\u65ad\uff09</p> <p>\u5916\u90e8\u4e2d\u65ad\u6307\u7684\u662f\u6765\u81ea\u5904\u7406\u5668\u5916\u90e8\u8bbe\u5907\u7684\u4e2d\u65ad\uff08\u4e32\u53e3\u7b49\uff09\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u4e3a\u4e86\u652f\u6301\u66f4\u591a\u7684\u5916\u90e8\u4e2d\u65ad\u6e90\uff0c\u5904\u7406\u5668\u5f80\u5f80\u90fd\u4f1a\u4f7f\u7528\u4e2d\u65ad\u63a7\u5236\u5668\u6765\u7ba1\u7406\u5916\u90e8\u4e2d\u65ad\u3002</p> <p>\u5982\uff0cRISC-V \u4f7f\u7528\u5e73\u53f0\u7ea7\u522b\u7684\u4e2d\u65ad\u63a7\u5236\u5668\u6765\uff08Platform-Level Interrupt Controller\uff0cPLIC\uff09 \u4ef2\u88c1\u548c\u6d3e\u53d1\u5916\u90e8\u4e2d\u65ad\u3002</p> </li> </ul> <p>\u5f53\u7136\uff0c\u8fd8\u6709\u8c03\u8bd5\u4e2d\u65ad\uff08\u7528\u4e8e\u786c\u4ef6\u8c03\u8bd5\uff09\u3001\u8ba1\u6570\u5668\u6ea2\u51fa\u4e2d\u65ad\uff0c\u8fd9\u91cc\u4e0d\u5c55\u5f00\u8ba8\u8bba\u3002</p> <p>\u5728 RISC-V \u4e2d\uff0c\u5982\u679c\u518d\u6309\u7167\u4e2d\u65ad\u529f\u80fd\u6765\u5212\u5206\u7684\u8bdd\uff0c\u53ef\u5206\u4e3a\u5982\u4e0b\u4e24\u7c7b\uff1a</p> <ul> <li> <p>local interrupt\uff08\u672c\u5730\u4e2d\u65ad\uff09</p> <p>\u672c\u5730\u4e2d\u65ad\u4e3a\u5904\u7406\u5668\u79c1\u6709\u7684\u4e2d\u65ad\uff0c\u6709\u56fa\u5b9a\u4f18\u5148\u7ea7\uff0c\u53ef\u76f4\u63a5\u53d1\u9001\u7ed9\u672c\u5730\u5904\u7406\u5668 hart\u3002\u6240\u4ee5\uff0c\u672c\u5730\u4e2d\u65ad\u65e0\u9700\u7ecf\u8fc7\u4e2d\u65ad\u63a7\u5236\u5668\u7684\u4ef2\u88c1\u548c\u67e5\u8be2\uff0c\u80fd\u591f\u6709\u6548\u5730\u7f29\u77ed\u4e2d\u65ad\u5ef6\u65f6\u3002</p> <p>\u672c\u5730\u4e2d\u65ad\u4e00\u822c\u7531\u5904\u7406\u5668\u5185\u6838\u672c\u5730\u4e2d\u65ad\u5668\uff08Core-Local Interrupt, CLINT\uff09\u4ea7\u751f\u3002</p> <p>\u5177\u4f53\u5305\u62ec\uff1a\u8f6f\u4ef6\u4e2d\u65ad\u548c\u5b9a\u65f6\u5668\u4e2d\u65ad\u3002</p> </li> <li> <p>global interrupt\uff08\u5168\u5c40\u4e2d\u65ad\uff09</p> <p>\u901a\u5e38\u6307\u7684\u5c31\u662f\u5916\u90e8\u4e2d\u65ad\u4e86\u3002\u901a\u8fc7 PLIC \u7684\u8def\u7531\uff0c\u9001\u5230\u5408\u9002\u7684\u5904\u7406\u5668\u5185\u6838\u3002</p> </li> </ul> <p></p> <p>\u8fd9\u4e00\u70b9\u548c ARM \u63a5\u4e0d\u592a\u4e00\u6837\uff0carm\u591a\u6838\u4e0b\uff0c\u5b9a\u65f6\u5668\u4e2d\u65ad\u3001\u6838\u95f4\u4e2d\u65ad\u548c\u5916\u8bbe\u4e2d\u65ad\u90fd\u662f\u7edf\u4e00\u7531\u4e2d\u65ad\u63a7\u5236\u5668\u7ba1\u7406\u7684\u3002</p> <p>\u5e94\u8be5\u80fd\u8054\u60f3\u5230 ARM Cortex-M \u7684NVIC \u548c Cortex-A \u7cfb\u5217\u7684 GIC \u3002</p> <ul> <li> <p>\u53c2\u8003\u8d44\u6599</p> <ul> <li> <p>\u300aRISC-V\u4f53\u7cfb\u7ed3\u6784\u7f16\u7a0b\u4e0e\u5b9e\u8df5\u300b\u7b2c 9 \u7ae0 \u2014\u2014\u5954\u8dd1\u5427Linux\u793e\u533a </p> </li> <li> <p>\u8be6\u89e3RISC v\u4e2d\u65ad - LightningStar - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u6bd4\u8f83\u6742\u4e71\uff0c\u4f46\u662f\u5185\u5bb9\u8fd8\u633a\u591a\uff0c\u770b\u4e0d\u4e0b\u53bb\u624b\u518c\u53ef\u4ee5\u770b\u8fd9\u5757\u522b\u4eba\u603b\u7ed3\u7684\u3002</p> </li> <li> <p>RISCV\u57fa\u7840\u5f00\u53d1\uff08\u4e09\uff09 | \u5357\u4eac\u517b\u9e21\u4e8c\u5382 (databusworld.cn)</p> </li> <li> <p>[RFC PATCH v4 00/10] Linux RISC-V ACLINT Support - Anup Patel (kernel.org)</p> </li> <li> <p>plic-spec (github.com)</p> </li> </ul> </li> </ul> </li> </ul>"},{"location":"ysyx/pa/Linux_porting/porting.html#clint","title":"CLINT","text":"<p>\u8f6f\u4ef6\u4e2d\u65ad\u548c\u65f6\u949f\u4e2d\u65ad\uff0c\u5176\u4e2d\u65f6\u949f\u4e2d\u65ad\u662f\u6700\u5173\u952e\u7684\uff0cOS \u9700\u8981 Timer \u6765\u5b9e\u73b0\u4efb\u52a1\u7684\u5207\u6362\uff0c\u8fd9\u4e00\u90e8\u5206\u7684\u5185\u5bb9\u5176\u5b9e\u5728 PA4 \u5df2\u7ecf\u505a\u7684\u5dee\u4e0d\u591a\u4e86\uff1a<code>alarm</code>\u3001<code>timer</code> \u3002</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_3","title":"\u5916\u90e8\u4e2d\u65ad","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#_4","title":"\u76f8\u5173\u8bbe\u5907","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#uart","title":"UART","text":"<p>\u8d77\u521d\u7684bug</p> <p>\u5728\u8bbe\u5907\u6811\uff08Device Tree\uff09\u4e2d\uff0c\u8fd9\u6bb5\u4ee3\u7801\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a <code>chosen</code> \u7684\u8282\u70b9\uff0c\u5b83\u7528\u4e8e\u6307\u5b9a\u7cfb\u7edf\u542f\u52a8\u65f6\u7684\u4e00\u4e9b\u53c2\u6570\u548c\u914d\u7f6e\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u8fd9\u91cc\u7684 <code>bootargs</code> \u5c5e\u6027\u5305\u542b\u4e86\u5185\u6838\u542f\u52a8\u65f6\u9700\u8981\u7684\u4e00\u4e9b\u53c2\u6570\u3002</p> <ul> <li> <p><code>earlycon=uart8250,mmio,0xa00003f8,8 console=ttyS0</code>\uff1a\u8fd9\u90e8\u5206\u662f\u5185\u6838\u542f\u52a8\u53c2\u6570\u3002</p> </li> <li> <p><code>earlycon</code>\uff1a\u6307\u5b9a\u4e86\u65e9\u671f\u63a7\u5236\u53f0\uff08early console\uff09\u7684\u914d\u7f6e\u3002\u65e9\u671f\u63a7\u5236\u53f0\u662f\u5728\u5185\u6838\u5b8c\u5168\u542f\u52a8\u4e4b\u524d\uff0c\u7528\u4e8e\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u7684\u63a7\u5236\u53f0\u3002\u8fd9\u91cc\u6307\u5b9a\u4e86\u4f7f\u7528 <code>uart8250</code> \u4e32\u53e3\u63a7\u5236\u5668\uff0c<code>mmio</code> \u8868\u793a\u5185\u5b58\u6620\u5c04\u8f93\u5165\u8f93\u51fa\uff08Memory-Mapped I/O\uff09\u65b9\u5f0f\uff0c<code>0xa00003f8</code> \u662f\u4e32\u53e3\u7684\u7269\u7406\u5730\u5740\uff0c<code>8</code> \u662f\u4e32\u53e3\u7684IRQ\u53f7\u3002</p> </li> <li> <p><code>console=ttyS0</code>\uff1a\u6307\u5b9a\u4e86\u5185\u6838\u542f\u52a8\u540e\u7684\u6807\u51c6\u63a7\u5236\u53f0\u8bbe\u5907\u3002\u8fd9\u91cc\u6307\u5b9a\u7684\u662f <code>ttyS0</code>\uff0c\u5373\u7b2c\u4e00\u4e2a\u4e32\u53e3\u8bbe\u5907\u3002</p> </li> </ul> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u8fd9\u6bb5\u4ee3\u7801\u544a\u8bc9\u5185\u6838\u5728\u542f\u52a8\u65f6\u4f7f\u7528\u6307\u5b9a\u7684\u4e32\u53e3\u4f5c\u4e3a\u65e9\u671f\u63a7\u5236\u53f0\u548c\u6807\u51c6\u63a7\u5236\u53f0\uff0c\u4ee5\u4fbf\u5728\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u3002\u8fd9\u5bf9\u4e8e\u8c03\u8bd5\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u975e\u5e38\u6709\u7528\uff0c\u5c24\u5176\u662f\u5728\u6ca1\u6709\u56fe\u5f62\u754c\u9762\u7684\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\u3002</p> <p>\u81ea\u5df1\u6ca1\u6709\u6539\uff0c\u5bfc\u81f4\u4e00\u76f4\u8bbf\u5b58\u9519\u8bef\uff080x10000000 + 3\uff09</p> <p>\u76f8\u5173\u5bc4\u5b58\u5668\u6ca1\u6709\u5b9e\u73b0\uff0c\u5bfc\u81f4\u6b7b\u5faa\u73af</p> <ul> <li>\u53c2\u8003\u8d44\u6599<ul> <li>Differences Between vmlinux, vmlinuz, vmlinux.bin, zimage, and bzimage | Baeldung on Linux</li> <li>ByteRunner.com | TECHNICAL DATA ON 16550</li> <li>RISC-V from Scratch 4</li> <li></li> </ul> </li> </ul>"},{"location":"ysyx/pa/Linux_porting/porting.html#_5","title":"\u6309\u952e","text":"<ol> <li><code>KEY_QUEUE_LEN</code> \u5b8f\u5b9a\u4e49\uff1a</li> <li> <p>\u5b9a\u4e49\u4e86\u952e\u76d8\u4e8b\u4ef6\u961f\u5217\u7684\u957f\u5ea6\u4e3a1024\uff0c\u8fd9\u610f\u5473\u7740\u961f\u5217\u53ef\u4ee5\u5b58\u50a81024\u4e2a\u952e\u76d8\u4e8b\u4ef6\u3002</p> </li> <li> <p><code>key_queue</code> \u6570\u7ec4\uff1a</p> </li> <li> <p>\u8fd9\u662f\u4e00\u4e2a\u9759\u6001\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u952e\u76d8\u4e8b\u4ef6\u3002\u5b83\u7684\u5927\u5c0f\u7531<code>KEY_QUEUE_LEN</code>\u5b9a\u4e49\u3002</p> </li> <li> <p><code>key_f</code> \u548c <code>key_r</code> \u53d8\u91cf\uff1a</p> </li> <li><code>key_f</code>\uff08front\uff09\u662f\u961f\u5217\u7684\u5934\u90e8\u7d22\u5f15\uff0c\u8868\u793a\u4e0b\u4e00\u4e2a\u8981\u88ab\u5904\u7406\u7684\u4e8b\u4ef6\u3002</li> <li> <p><code>key_r</code>\uff08rear\uff09\u662f\u961f\u5217\u7684\u5c3e\u90e8\u7d22\u5f15\uff0c\u8868\u793a\u4e0b\u4e00\u4e2a\u8981\u88ab\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u7684\u4f4d\u7f6e\u3002</p> </li> <li> <p><code>key_enqueue</code> \u51fd\u6570\uff1a</p> </li> <li>\u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u5c06\u4e00\u4e2a\u65b0\u7684\u952e\u76d8\u4e8b\u4ef6\uff08<code>am_scancode</code>\uff09\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\u3002</li> <li>\u5b83\u5c06\u4e8b\u4ef6\u5b58\u50a8\u5728<code>key_r</code>\u7d22\u5f15\u7684\u4f4d\u7f6e\uff0c\u5e76\u5c06<code>key_r</code>\u9012\u589e\uff0c\u5982\u679c\u8fbe\u5230\u961f\u5217\u672b\u5c3e\u5219\u56de\u5230\u5f00\u5934\uff08\u901a\u8fc7\u53d6\u6a21\u8fd0\u7b97\u5b9e\u73b0\uff09\u3002</li> <li> <p>\u7136\u540e\uff0c\u5b83\u68c0\u67e5\u961f\u5217\u662f\u5426\u5df2\u6ee1\uff08\u5373<code>key_r</code>\u662f\u5426\u7b49\u4e8e<code>key_f</code>\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u65ad\u8a00\u5931\u8d25\uff0c\u8868\u793a\u961f\u5217\u6ea2\u51fa\u3002</p> </li> <li> <p><code>key_dequeue</code> \u51fd\u6570\uff1a</p> </li> <li>\u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u4e00\u4e2a\u952e\u76d8\u4e8b\u4ef6\u3002</li> <li>\u5982\u679c\u961f\u5217\u4e0d\u4e3a\u7a7a\uff08\u5373<code>key_f</code>\u4e0d\u7b49\u4e8e<code>key_r</code>\uff09\uff0c\u5b83\u5c06<code>key_f</code>\u7d22\u5f15\u5904\u7684\u4e8b\u4ef6\u53d6\u51fa\uff0c\u5e76\u5c06<code>key_f</code>\u9012\u589e\uff0c\u5982\u679c\u8fbe\u5230\u961f\u5217\u672b\u5c3e\u5219\u56de\u5230\u5f00\u5934\u3002</li> <li> <p>\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u5219\u8fd4\u56de<code>NEMU_KEY_NONE</code>\uff0c\u8868\u793a\u6ca1\u6709\u4e8b\u4ef6\u53ef\u53d6\u3002</p> </li> <li> <p><code>send_key</code> \u51fd\u6570\uff1a</p> </li> <li>\u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u5904\u7406\u952e\u76d8\u4e8b\u4ef6\u3002</li> <li>\u5b83\u9996\u5148\u68c0\u67e5\u865a\u62df\u673a\u72b6\u6001\u662f\u5426\u4e3a\u8fd0\u884c\u4e2d\uff08<code>NEMU_RUNNING</code>\uff09\uff0c\u5e76\u4e14\u626b\u63cf\u7801\uff08<code>scancode</code>\uff09\u5728\u952e\u4f4d\u6620\u5c04\u8868\uff08<code>keymap</code>\uff09\u4e2d\u6709\u5bf9\u5e94\u7684\u4e8b\u4ef6\u3002</li> <li>\u5982\u679c\u6761\u4ef6\u6ee1\u8db3\uff0c\u5b83\u5c06\u626b\u63cf\u7801\u8f6c\u6362\u4e3a\u5185\u90e8\u4f7f\u7528\u7684\u626b\u63cf\u7801\uff08<code>am_scancode</code>\uff09\uff0c\u5e76\u6839\u636e\u6309\u952e\u662f\u5426\u88ab\u6309\u4e0b\uff08<code>is_keydown</code>\uff09\u6765\u8bbe\u7f6e<code>KEYDOWN_MASK</code>\u3002</li> <li>\u6700\u540e\uff0c\u5b83\u8c03\u7528<code>key_enqueue</code>\u51fd\u6570\u5c06\u4e8b\u4ef6\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\u3002</li> </ol> <p>\u8fd9\u4e2a\u952e\u76d8\u903b\u8f91\u7684\u6838\u5fc3\u662f\u4f7f\u7528\u4e00\u4e2a\u5faa\u73af\u961f\u5217\u6765\u5b58\u50a8\u952e\u76d8\u4e8b\u4ef6\uff0c\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u5730\u5904\u7406\u4e8b\u4ef6\uff0c\u907f\u514d\u4e22\u5931\uff0c\u5e76\u4e14\u53ef\u4ee5\u6309\u987a\u5e8f\u5904\u7406\u4e8b\u4ef6\u3002\u961f\u5217\u7684\u4f7f\u7528\u5141\u8bb8\u7a0b\u5e8f\u5728\u4e8b\u4ef6\u4ea7\u751f\u65f6\u5feb\u901f\u5730\u5c06\u5b83\u4eec\u5b58\u50a8\u8d77\u6765\uff0c\u7136\u540e\u5728\u9700\u8981\u7684\u65f6\u5019\u9010\u4e2a\u5904\u7406\uff0c\u8fd9\u5bf9\u4e8e\u591a\u4efb\u52a1\u73af\u5883\u6216\u8005\u9700\u8981\u5904\u7406\u5927\u91cf\u5f02\u6b65\u4e8b\u4ef6\u7684\u7a0b\u5e8f\u6765\u8bf4\u662f\u975e\u5e38\u6709\u7528\u7684\u3002</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_6","title":"\u5b9a\u65f6\u5668","text":"<p>\u5f53\u65f6\u5728\u505a PA \u7684\u65f6\u5019\uff0c\u5bf9\u8fd9\u4e2a\u90e8\u5206\u5176\u5b9e\u4e5f\u662f\u8ff7\u8ff7\u7cca\u7cca\u7684\uff0c\u6211\u6709\u4e2a timer \u5c31\u62ff\u6765\u8ba1\u65f6\uff1f\u77e5\u9053\u540e\u6765\u5b66\u5230 \u5206\u65f6\u591a\u4efb\u52a1\u540e\uff0c\u624d\u77e5\u9053\u62a2\u5360\u591a\u4efb\u52a1\u7684\u6838\u5fc3\u539f\u7406\u5c31\u662f\u65f6\u949f\u4e2d\u65ad\uff0c\u90a3\u65f6\u5019\u518d\u56de\u6765\u770b\u76f8\u5173 alarm \u548c timer \u4ee3\u7801\uff0c\u5927\u6982\u4e5f\u80fd\u6e05\u695a\u4e00\u4e9b\u57fa\u672c\u7684\u539f\u7406\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4fe1\u53f7\u548c\u5b9a\u65f6\u5668\u6765\u5b9e\u73b0\u5468\u671f\u6027\u7684\u56de\u8c03\u51fd\u6570\u8c03\u7528\uff0c\u901a\u8fc7 <code>setitimer</code> \u8c03\u7528\uff0c\u5b9a\u65f6\u5668\u88ab\u8bbe\u7f6e\u4e3a\u6bcf\u9694\u4e00\u5b9a\u65f6\u95f4\uff08\u7531 <code>TIMER_HZ</code> \u51b3\u5b9a\uff09\u89e6\u53d1\u4e00\u6b21\uff0c\u6bcf\u6b21\u89e6\u53d1\u90fd\u4f1a\u6267\u884c\u6240\u6709\u6ce8\u518c\u7684\u56de\u8c03\u51fd\u6570\u3002\u8fd9\u4e5f\u662f\u4e00\u79cd\u5728\u64cd\u4f5c\u7cfb\u7edf\u6216\u6a21\u62df\u5668\u4e2d\u5b9e\u73b0\u5468\u671f\u6027\u4efb\u52a1\u7684\u5e38\u89c1\u65b9\u6cd5\u3002</p> <p>\u8fd9\u91cc\u518d\u7b80\u5355\u56de\u987e\u4e00\u4e9b\u5185\u5bb9\uff0c\u5173\u4e8e timer\u3001alarm\u3001clock \u7684\u4e00\u4e9b\u533a\u522b\uff0c\u8fd9\u91cc\u4e0d\u592a\u533a\u522b\u5f88\u7ec6\u8282\u7684\u6982\u5ff5\uff0c\u4e3b\u8981\u662f\u4e3a\u7406\u89e3\u3002</p> <p>\u60f3\u8c61\u4e00\u4e0b\uff0c\u4f60\u6b63\u5728\u505a\u4e00\u4e2a\u86cb\u7cd5\uff0c\u4f60\u9700\u8981\u8ba1\u65f6\u3002</p> <ol> <li>Counter\uff08\u8ba1\u6570\u5668\uff09\uff1a<ul> <li>\u5c31\u50cf\u4f60\u5728\u505a\u86cb\u7cd5\u65f6\u7528\u6765\u6570\u9e21\u86cb\u7684\u8ba1\u6570\u5668\u3002\u6bcf\u6b21\u4f60\u6572\u5f00\u4e00\u4e2a\u9e21\u86cb\uff0c\u4f60\u5c31\u5728\u8ba1\u6570\u5668\u4e0a\u52a0\u4e00\u3002\u8ba1\u6570\u5668\u53ef\u4ee5\u7531\u4efb\u4f55\u4e8b\u4ef6\u89e6\u53d1\uff0c\u6bd4\u5982\u6572\u9e21\u86cb\u3001\u5012\u9762\u7c89\u7b49\uff0c\u5b83\u53ea\u662f\u7b80\u5355\u5730\u8ba1\u6570\uff0c\u4e0d\u4e00\u5b9a\u4e0e\u65f6\u95f4\u6709\u5173\u3002</li> </ul> </li> <li>Clock\uff08\u65f6\u949f\uff09\uff1a<ul> <li>\u65f6\u949f\u5c31\u50cf\u4f60\u53a8\u623f\u91cc\u7684\u6302\u949f\uff0c\u5b83\u4ee5\u56fa\u5b9a\u7684\u901f\u5ea6\u201c\u6ef4\u7b54\u201d\u8d70\u7740\uff0c\u6bcf\u201c\u6ef4\u7b54\u201d\u4e00\u6b21\u5c31\u4ee3\u8868\u8fc7\u53bb\u4e86\u4e00\u5b9a\u7684\u65f6\u95f4\uff08\u6bd4\u5982\u4e00\u79d2\uff09\u3002\u65f6\u949f\u662f\u8ba1\u6570\u5668\u7684\u4e00\u79cd\uff0c\u4f46\u5b83\u662f\u88ab\u4e00\u4e2a\u89c4\u5f8b\u7684\u4e8b\u4ef6\uff08\u6bd4\u5982\u79d2\u9488\u7684\u79fb\u52a8\uff09\u9a71\u52a8\u7684\uff0c\u7528\u6765\u6d4b\u91cf\u65f6\u95f4\u3002</li> </ul> </li> <li>Alarm\uff08\u95f9\u949f\uff09\uff1a<ul> <li>\u95f9\u949f\u662f\u8bbe\u7f6e\u5728\u7279\u5b9a\u65f6\u95f4\u70b9\u63d0\u9192\u4f60\u7684\u8bbe\u5907\u3002\u4f60\u53ef\u4ee5\u628a\u5b83\u60f3\u8c61\u6210\u4f60\u8bbe\u7f6e\u5728\u86cb\u7cd5\u70e4\u597d\u65f6\u54cd\u8d77\u7684\u8ba1\u65f6\u5668\u3002\u5b83\u8fde\u63a5\u5230\u4e00\u4e2a\u8ba1\u6570\u5668\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5c31\u662f\u65f6\u949f\uff09\uff0c\u5e76\u5728\u8ba1\u6570\u5668\u8fbe\u5230\u4f60\u8bbe\u7f6e\u7684\u503c\u65f6\u53d1\u51fa\u63d0\u9192\u3002\u95f9\u949f\u53ef\u4ee5\u662f\u4e00\u6b21\u6027\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u5468\u671f\u6027\u7684\uff08\u6bd4\u5982\u6bcf10\u5206\u949f\u63d0\u9192\u4e00\u6b21\uff09\u3002</li> </ul> </li> <li>Timer\uff08\u8ba1\u65f6\u5668\uff09\uff1a<ul> <li>\u8ba1\u65f6\u5668\u5176\u5b9e\u548c\u95f9\u949f\u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u8fde\u63a5\u5230\u65f6\u949f\u4e0a\u7684\u3002\u5728\u4f60\u505a\u86cb\u7cd5\u7684\u4f8b\u5b50\u4e2d\uff0c\u8ba1\u65f6\u5668\u5c31\u662f\u4f60\u7528\u6765\u6d4b\u91cf\u86cb\u7cd5\u70d8\u70e4\u65f6\u95f4\u7684\u8bbe\u5907\u3002\u5b83\u4f9d\u8d56\u4e8e\u65f6\u949f\u7684\u201c\u6ef4\u7b54\u201d\u6765\u5de5\u4f5c\uff0c\u53ef\u4ee5\u662f\u4e00\u6b21\u6027\u7684\u4e5f\u53ef\u4ee5\u662f\u5468\u671f\u6027\u7684\u3002</li> </ul> </li> </ol> <p>\u603b\u7ed3\u4e00\u4e0b\uff1a</p> <ul> <li>Counter\uff1a\u53ea\u662f\u8ba1\u6570\uff0c\u53ef\u4ee5\u7531\u4efb\u4f55\u4e8b\u4ef6\u89e6\u53d1\u3002</li> <li>Clock\uff1a\u4e00\u79cd\u7279\u6b8a\u7684\u8ba1\u6570\u5668\uff0c\u7531\u89c4\u5f8b\u7684\u4e8b\u4ef6\uff08\u5982\u65f6\u95f4\u7684\u6d41\u901d\uff09\u9a71\u52a8\u3002</li> <li>Alarm\uff1a\u57fa\u4e8e\u8ba1\u6570\u5668\u7684\u503c\u6765\u89e6\u53d1\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u662f\u4e00\u6b21\u6027\u6216\u5468\u671f\u6027\u7684\u3002</li> <li>Timer\uff1a\u4e00\u79cd\u7279\u6b8a\u7684\u95f9\u949f\uff0c\u5b83\u8fde\u63a5\u5230\u65f6\u949f\u4e0a\uff0c\u7528\u6765\u6d4b\u91cf\u65f6\u95f4\u3002</li> </ul> <p>\u5728\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e9b\u6982\u5ff5\u88ab\u7528\u6765\u7ba1\u7406\u65f6\u95f4\u76f8\u5173\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u4efb\u52a1\u8c03\u5ea6\u3001\u6027\u80fd\u76d1\u63a7\u7b49\u3002</p> <ul> <li>A Counter maintains a monotonically increasing counter that is driven by some source of ticks. </li> <li>A Clock is a counter driven by a regular source of ticks (i.e. it counts time). Clocks have a resolution associated with them. A default system Clock is driven by the periodic interrupt described above, and tracks real-time. Other interrupt sources may drive other Counters that may or may not track real-time at different resolutions. Some Counters may be driven by aperiodic events and thus have no relation to real-time at all.</li> <li>An Alarm is attached to a Counter and provides a mechanism for generating single-shot or periodic events based on the counter's value. </li> <li>A Timer is simply an Alarm that is attached to a Clock.</li> </ul> <p>\u200b   </p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_7","title":"\u4e32\u53e3","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#plic","title":"PLIC","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#difftest","title":"DiffTest","text":"<p>dlopen Linux \u52a8\u6001\u5e93\u5931\u8d25\u539f\u56e0\u4e0e\u89e3\u51b3\u529e\u6cd5\u603b\u7ed3_dl\u5e93\u627e\u4e0d\u5230 linux-CSDN\u535a\u5ba2</p> <p>Better understanding Linux secondary dependencies solving with examples</p> <p>linux - dlopen \u5931\u8d25\uff1a\u65e0\u6cd5\u6253\u5f00\u5171\u4eab\u5bf9\u8c61\u6587\u4ef6\uff1a\u6ca1\u6709\u8fd9\u6837\u7684\u6587\u4ef6\u6216\u76ee\u5f55_Stack Overflow\u4e2d\u6587\u7f51</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#linux","title":"Linux \u7cfb\u7edf\u79fb\u690d","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#some-questions","title":"Some questions","text":"<ul> <li> <p><code>openSBI</code> \u662f\u4ec0\u4e48\uff1f\u548c <code>uboot</code> \u7684\u5173\u7cfb\uff1f</p> </li> <li> <p>\u7ec8\u7aef\u3001TTY\u3001\u4e32\u53e3\u662f\u4ec0\u4e48\uff1f</p> </li> <li> <p><code>buildroot</code> \u548c <code>busybox</code> \u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u5e38\u5e38\u542c\u5230\u8fd9\u4e24\u4e2a\u6df7\u5728\u4e00\u8d77\uff1f</p> </li> <li> <p>Linux \u542f\u52a8\u6d41\u7a0b</p> </li> <li> <p>Linker script \u7684\u4f7f\u7528</p> </li> </ul> <p>QEMU \u542f\u52a8\u65b9\u5f0f\u5206\u6790\uff081\uff09\uff1aQEMU \u53ca RISC-V \u542f\u52a8\u6d41\u7a0b\u7b80\u4ecb - \u6cf0\u6653\u79d1\u6280 (tinylab.org)</p> <p>\u5728 QEMU \u4e0a\u8fd0\u884c RISC-V 32 \u4f4d\u7248\u672c\u7684 Linux - \u77e5\u4e4e (zhihu.com)</p> <p>\u301099%\u73af\u5883\u642d\u5efa\u7cfb\u5217\u3011xv6-riscv\u5185\u6838\u8c03\u8bd5\u6559\u7a0b - Hexo (2017zhangyuxuan.github.io) xv6 \u8bfe\u7a0b</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_8","title":"\u5feb\u901f\u4e0a\u624b\u4f53\u9a8c","text":"<p>\u5148\u5728 QEMU \u4e0a\u4ece\u96f6\u6784\u5efa\u4e00\u904d Linux \u7cfb\u7edf\uff0c\u5feb\u901f\u4e0a\u624b\u4f7f\u7528\u770b\u770b</p> <p>\u5728 QEMU \u4e0a\u8fd0\u884c RISC-V 64 \u4f4d\u7248\u672c\u7684 Linux - \u77e5\u4e4e (zhihu.com)</p> <p>\u8fd9\u91cc\u7684\u6d41\u7a0b\u8fd8\u662f\u633a\u8be6\u7ec6\u7684\u4e86\uff0c\u6700\u540e\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\u6548\u679c\uff0c\u6700\u7ec8\u8fd0\u884c\u547d\u4ee4\uff1a</p> <pre><code>qemu-system-riscv64 -M virt -m 256M -nographic \\\n    -kernel linux/linux-5.15.167/arch/riscv/boot/Image \\\n    -drive file=rootfs.img,format=raw,id=hd0 \\\n    -device virtio-blk-device,drive=hd0 -append \"root=/dev/vda rw console=ttyS0\"\n</code></pre> <ol> <li><code>qemu-system-riscv64</code>\uff1a</li> <li>\u8fd9\u662fQEMU\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u6a21\u62dfRISC-V\u67b6\u6784\u7684\u7cfb\u7edf\u3002</li> </ol> <p>\u56de\u60f3 OS \u8bfe\u7684\u7b14\u8bb0\uff0c\u5173\u4e8e <code>qemu-system-riscv64</code> \u548c <code>qemu-riscv64</code> \u4e4b\u95f4\u533a\u522b\uff1f</p> <ol> <li> <p><code>-M virt</code>\uff1a</p> </li> <li> <p>\u6307\u5b9aQEMU\u4f7f\u7528\u7684\u673a\u5668\u6a21\u578b\u4e3a<code>virt</code>\uff0c\u5373\u865a\u62df\u5316\u73af\u5883\u3002</p> </li> <li> <p><code>-m 256M</code>\uff1a</p> </li> <li> <p>\u5206\u914d256MB\u7684\u5185\u5b58\u7ed9\u865a\u62df\u673a\u3002</p> </li> <li> <p><code>-nographic</code>\uff1a</p> </li> <li> <p>\u6307\u5b9a\u4e0d\u4f7f\u7528\u56fe\u5f62\u754c\u9762\uff0c\u5373\u5728\u6ca1\u6709\u56fe\u5f62\u663e\u793a\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u865a\u62df\u673a\u3002</p> </li> <li> <p><code>-kernel linux/linux-5.15.167/arch/riscv/boot/Image</code>\uff1a</p> </li> <li> <p>\u6307\u5b9a\u8981\u52a0\u8f7d\u7684\u5185\u6838\u6620\u50cf\u6587\u4ef6\u8def\u5f84\uff0c\u8fd9\u91cc\u662fRISC-V\u67b6\u6784\u7684Linux\u5185\u6838\u3002</p> </li> <li> <p><code>-drive file=rootfs.img,format=raw,id=hd0</code>\uff1a</p> </li> <li> <p>\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u786c\u76d8\u9a71\u52a8\u5668\uff0c\u5e76\u6307\u5b9a\u5176\u6587\u4ef6\u540d\u4e3a<code>rootfs.img</code>\uff0c\u683c\u5f0f\u4e3a\u539f\u59cb\uff08raw\uff09\uff0c\u5e76\u5206\u914d\u4e00\u4e2aID\u4e3a<code>hd0</code>\u3002</p> </li> <li> <p><code>-device virtio-blk-device,drive=hd0</code>\uff1a</p> </li> <li> <p>\u6dfb\u52a0\u4e00\u4e2avirtio\u5757\u8bbe\u5907\uff0c\u8fd9\u4e2a\u8bbe\u5907\u4f1a\u4f7f\u7528\u4e4b\u524d\u521b\u5efa\u7684<code>hd0</code>\u9a71\u52a8\u5668\u3002</p> </li> <li> <p><code>-append \"root=/dev/vda rw console=ttyS0\"</code>\uff1a</p> </li> <li>\u6307\u5b9a\u5185\u6838\u542f\u52a8\u53c2\u6570\u3002\u8fd9\u91cc\u6307\u5b9a\u4e86\u6839\u6587\u4ef6\u7cfb\u7edf\u7684\u4f4d\u7f6e\u4e3a<code>/dev/vda</code>\uff08\u901a\u5e38\u662f\u865a\u62df\u673a\u7684\u7b2c\u4e00\u4e2a\u786c\u76d8\u8bbe\u5907\uff09\uff0c\u542f\u52a8\u65f6\u4e3a\u8bfb\u5199\u6a21\u5f0f\uff08<code>rw</code>\uff09\uff0c\u5e76\u4e14\u5c06\u63a7\u5236\u53f0\u8f93\u51fa\u91cd\u5b9a\u5411\u5230<code>ttyS0</code>\uff08\u901a\u5e38\u662f\u865a\u62df\u673a\u7684\u4e32\u884c\u7aef\u53e3\uff09\u3002</li> </ol> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u8fd9\u6761\u547d\u4ee4\u662f\u5728QEMU\u4e2d\u542f\u52a8\u4e00\u4e2aRISC-V\u67b6\u6784\u7684\u865a\u62df\u673a\uff0c\u4f7f\u7528256MB\u5185\u5b58\uff0c\u4e0d\u663e\u793a\u56fe\u5f62\u754c\u9762\uff0c\u52a0\u8f7d\u6307\u5b9a\u7684\u5185\u6838\u6620\u50cf\uff0c\u5e76\u6302\u8f7d\u4e00\u4e2a\u540d\u4e3a<code>rootfs.img</code>\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u540c\u65f6\u6307\u5b9a\u4e86\u4e00\u4e9b\u5185\u6838\u542f\u52a8\u53c2\u6570\u3002</p> <p>\u8fd9\u91cc\u4e5f\u6709\u4e00\u7bc7\u76f8\u5173\u7684</p> <p>\u6559\u4f60\u5728QEMU\u4e0a\u8fd0\u884cRISC-V Linux-\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a (aliyun.com)</p> <p>Linux \u4e0b\u751f\u6210\u7684\u955c\u50cf\uff1a<code>arch/riscv/boot</code></p> <p>buildroot \u751f\u6210\u7684\u76f8\u5173\u955c\u50cf\uff1a<code>output/images</code></p> <p>OpenSBI \u751f\u6210\u7684\u76f8\u5173\u955c\u50cf\uff1a<code>build/platform/generic/firmware/</code> </p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_9","title":"\u542f\u52a8\u6d41\u7a0b","text":"<p>Table of Contents - HackMD</p> <p>\u8fd9\u7bc7\u4e13\u680f\u6536\u5f55\u4e86 Linux booting \u5404\u79cd\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u603b\u7ed3\u4e86 Linux \u5728 x86-64\u3001Arm64\u3001RISC-V\u4e0a\u7684 boot process\u3002\u53ef\u4ee5\u770b\u770b\u91cc\u9762\u7684\u76f8\u5173\u5185\u5bb9\u3002</p> <p></p> <p>\u6bcf\u4e00\u6b65\u600e\u4e48\u505a\u7684\uff0c\u628abootROM\u653e\u5230\u54ea\u91cc\uff0c\u7136\u540eloader\u54ea\u91cc\uff1f</p> <p>Linux \u7cfb\u7edf\u7684\u7f16\u8bd1\u3001\u955c\u50cf\u5236\u4f5c\u3001\u4ee5\u53ca\u70e7\u5f55\u7684\u6982\u8ff0 - \u767d\u83dc\u6ca1\u6211\u767d - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>1- Linux\u7cfb\u7edf\u79fb\u690d\u524d\u671f\u51c6\u5907\u6982\u8ff0 - \u767d\u83dc\u6ca1\u6211\u767d - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>Linux\u5185\u6838\u5728RISC-V\u67b6\u6784\u4e0b\u7684\u6784\u5efa\u4e0e\u542f\u52a8 - crab2313's blog</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_10","title":"\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe","text":"<p>\u4ecb\u7ecd\u4e00\u4e9b\u80cc\u666f\u77e5\u8bc6\u3002</p> <p>A master guide to Linux cross compiling | by Ruvinda Dhambarage | Medium</p> <p>How a toolchain is constructed (crosstool-ng.github.io)</p> <ul> <li> <p>\u4f7f\u7528\u522b\u4eba\u6253\u5305\u597d\u7684</p> <p>Cross-compilation toolchains for Linux - Home (bootlin.com)</p> <p>\u76f4\u63a5\u5728\u8fd9\u91cc\u4e0b\u8f7d\u5373\u53ef\u3002</p> <p>\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u89e3\u538b\u653e\u5230\u7cfb\u7edf\u4e0b\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u7136\u540e\u5c06\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u8def\u5f84\u5bfc\u5165\u5230\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u5728 <code>/etc/profile</code> \u5199\u5165\uff1a</p> <p><code>export PATH=$PATH:/usr/local/riscv64/riscv64-lp64d--glibc--stable-2024.05-1/bin</code></p> <p>\u5f53\u7136\uff0c\u653e\u5728\u7528\u6237\u4e0b\u7684\u4e5f\u53ef\u4ee5\uff1a<code>~/.bashrc</code></p> <p><code>export PATH=/opt/riscv/gcc/bin:$PATH</code></p> </li> </ul>"},{"location":"ysyx/pa/Linux_porting/porting.html#linker-script","title":"Linker Script","text":"<p>\u4e3b\u8981\u53c2\u8003\uff1a</p> <ul> <li>\u300aRISC-V \u4f53\u7cfb\u7ed3\u7f16\u7a0b\u4e0e\u5b9e\u8df5\u300b\u7b2c 6 \u7ae0</li> <li>\u5b98\u65b9\u6587\u6863 Top (LD) (sourceware.org)</li> <li> <p>Linker Scripts\u8bed\u6cd5\u89e3\u6790 - HiDark - \u535a\u5ba2\u56ed (cnblogs.com)</p> </li> <li> <p>\u4e00\u4e9b\u6982\u5ff5\u4e0a\u7684\u533a\u5206</p> <p>\u5728\u9605\u8bfb\u300aRISC-V \u4f53\u7cfb\u7ed3\u7f16\u7a0b\u4e0e\u5b9e\u8df5\u300b\u7b2c 6 \u7ae0 \u7684\u65f6\u5019\uff0c\u9047\u5230\u4e86 \u94fe\u63a5\u5730\u5740\u3001\u52a0\u8f7d\u5730\u5740\u3001\u8fd0\u884c\u5730\u5740\uff08\u865a\u62df\u5730\u5740\uff09\u8fd9\u4e09\u4e2a\u6982\u5ff5\uff0c\u5728\u53ea\u8c08\u5230\u88c5\u8f7d\u5730\u5740\u548c\u8fd0\u884c\u5730\u5740\u65f6\uff0c\u8fd9\u4e24\u4e2a\u6982\u5ff5\u8fd8\u662f\u6bd4\u8f83\u597d\u7406\u89e3\u7684\uff0c\u4f46\u662f\u5f15\u5165\u4e86\u94fe\u63a5\u5730\u5740\u540e\uff0c\u6211\u5bf9\u4e00\u4e9b\u6982\u5ff5\u51fa\u73b0\u4e86\u6df7\u4e71\u3002\u6545\u8bb0\u5f55\u4e00\u4e0b\u3002</p> <p>\u9996\u5148\uff0c\u5bf9\u4e8e\u521a\u5f00\u59cb\u7684\u52a0\u8f7d\u5730\u5740\u548c\u8fd0\u884c\u5730\u5740\u5176\u5b9e\u4ece\u5b57\u9762\u4e0a\u4e5f\u5f88\u597d\u7406\u89e3\uff0c</p> <ul> <li> <p>\u52a0\u8f7d\u5730\u5740\uff1a\u52a0\u8f7d\u5730\u5740\u662f\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u7a0b\u5e8f\u5230\u5185\u5b58\u65f6\u7684\u5b9e\u9645\u5730\u5740\u3002</p> <p>\u5728\u542f\u52a8\u65f6\uff0c\u52a0\u8f7d\u7a0b\u5e8f\uff08\u5982\u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f\uff09\u4f1a\u5c06\u5185\u6838\u6620\u50cf\u52a0\u8f7d\u5230\u8fd9\u4e2a\u5730\u5740\u3002</p> <p>\u5728\u811a\u672c\u4e2d\uff0c<code>_start</code>\u7b26\u53f7\u88ab\u8bbe\u7f6e\u4e3a<code>LOAD_OFFSET</code>\uff0c\u8fd9\u610f\u5473\u7740\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff08\u901a\u5e38\u662f\u7b2c\u4e00\u4e2a\u6267\u884c\u7684\u4ee3\u7801\uff09\u88ab\u5b9a\u4f4d\u5728\u88c5\u8f7d\u5730\u5740\u3002</p> </li> </ul> </li> </ul> <p>\u5b9e\u9645\u5b58\u50a8\u8bbe\u5907\u6620\u5c04\u5230\u5b58\u50a8\u7a7a\u95f4\uff01</p> <p>downloads.ti.com/docs/esd/SPRU513/load-and-run-addresses-slau1317366.html</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#opensbi","title":"OpenSBI","text":"<p>OpenSBI - HackMD</p> <p>opensbi\u5165\u95e8 - LightningStar - \u535a\u5ba2\u56ed (cnblogs.com)</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#u-boot","title":"U-Boot","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#busyboxbuildrootyocto","title":"busybox\u3001buildroot\u3001yocto","text":"<ul> <li> <p>busybox</p> <p></p> <p>\u5b9e\u9645\u4e0a\u5728\u505a PA4 \u7684\u65f6\u5019\uff0c\u5c31\u9047\u5230\u4e86 busybox \u3002\u5f53\u65f6\u6211\u4eec\u5199\u7684 NTerm \u6ca1\u6709\u591a\u5c11 Shell \u5de5\u5177\u53ef\u4ee5\u8fd0\u884c\uff0cbusybox \u6b63\u662f\u7528\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\uff0c\u5b83\u662f\u4e00\u4e2a\u7cbe\u7b80\u7248 Shell \u5de5\u5177\u7684\u96c6\u5408\uff0c\u5305\u542b\u4e86\u5927\u90e8\u5206\u5e38\u7528\u547d\u4ee4\u7684\u529f\u80fd\u3002\uff08\u4e5f\u5c31\u662f\u5e73\u65f6\u5728 Linux \u4e2d\u4f7f\u7528\u547d\u4ee4\u884c\u7684\u7ecf\u5386\uff09</p> <p>Busybox \u4e2d\u5305\u542b\u5f88\u591a\u5c0f\u5de5\u5177\uff0c\u901a\u8fc7 <code>make menuconfig</code> \u6765\u6253\u5f00\u4e00\u4e2a\u914d\u7f6e\u83dc\u5355\u6765\u67e5\u770b\u5b83\u4eec\u3002</p> <p>Busybox \u4f1a\u628a\u5176\u4e2d\u7684 Shell \u5de5\u5177\u94fe\u63a5\u6210\u4e00\u4e2a ELF \u53ef\u6267\u884c\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u50cf Ubuntu/Debian \u7b49\u53d1\u884c\u7248\u4e2d\u7684 Shell \u5de5\u5177\u90a3\u6837\u7684 \u72ec\u7acb\u7684 ELF \u53ef\u6267\u884c\u6587\u4ef6\u3002Busybox\u7684 <code>main()</code> \u51fd\u6570\u4f1a\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570\u6765\u8c03\u7528\u76f8\u5e94\u5de5\u5177\u7684\u529f\u80fd\uff1a</p> <pre><code>if (strcmp(argv[1], \"cat\") == 0) return cat_main(argc, argv);\nelse if (strcmp(argv[1], \"ls\") == 0) return ls_main(argc, argv);\nelse if (strcmp(argv[1], \"wc\") == 0) return wc_main(argc, argv);\n// ......\n</code></pre> <p>\u90a3\u4e0a\u56fe\u90a3\u4e9b <code>xxx -&gt; busybox</code> \u7b26\u53f7\u94fe\u63a5\uff0c\u8f6f\u94fe\u63a5\u662f\u600e\u4e48\u56de\u4e8b\uff1f</p> <p>kimi \u7684\u56de\u7b54\uff1a</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c<code>busybox</code> \u662f\u4e00\u4e2a\u96c6\u6210\u4e86\u591a\u8fbe\u6570\u767e\u4e2a\u6700\u5e38\u7528\u7684 Unix \u5de5\u5177\u548c\u547d\u4ee4\u7684\u8f6f\u4ef6\u3002\u5b83\u63d0\u4f9b\u4e86\u8f7b\u91cf\u7ea7\u7684 shell \u73af\u5883\uff0c\u901a\u5e38\u7528\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6216\u8005\u9700\u8981\u6700\u5c0f\u5316\u7cfb\u7edf\u73af\u5883\u7684\u573a\u666f\u3002\u7531\u4e8e <code>busybox</code> \u5305\u542b\u4e86\u5f88\u591a\u5de5\u5177\uff0c\u4f46\u662f\u6bcf\u4e2a\u5de5\u5177\u90fd\u662f\u4f5c\u4e3a <code>busybox</code> \u7684\u4e00\u4e2a\u5355\u72ec\u529f\u80fd\u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u5f53\u4f60\u5728 <code>/bin</code> \u76ee\u5f55\u4e0b\u770b\u5230\u7c7b\u4f3c <code>arch -&gt; busybox</code> \u8fd9\u6837\u7684\u94fe\u63a5\u65f6\uff0c\u8fd9\u610f\u5473\u7740 <code>arch</code> \u547d\u4ee4\u5b9e\u9645\u4e0a\u662f <code>busybox</code> \u7684\u4e00\u4e2a\u7b26\u53f7\u94fe\u63a5\u3002</p> <p>\u8fd9\u4e9b\u7b26\u53f7\u94fe\u63a5\uff08symbolic links\uff09\uff0c\u901a\u5e38\u7b80\u79f0\u4e3a symlinks\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u5b83\u4eec\u6307\u5411\u53e6\u4e00\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5f53\u4f60\u6267\u884c <code>arch</code> \u547d\u4ee4\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u6267\u884c <code>busybox</code> \u5e76\u8c03\u7528\u5b83\u7684 <code>arch</code> \u529f\u80fd\u3002</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u5141\u8bb8 <code>busybox</code> \u901a\u8fc7\u5355\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6765\u63d0\u4f9b\u591a\u79cd\u547d\u4ee4\uff0c\u4ece\u800c\u8282\u7701\u7a7a\u95f4\u5e76\u7b80\u5316\u7cfb\u7edf\u3002\u5f53\u4f60\u67e5\u770b <code>/bin</code> \u76ee\u5f55\u4e0b\u7684\u8fd9\u4e9b\u94fe\u63a5\u65f6\uff0c\u4f60\u4f1a\u770b\u5230\u8bb8\u591a\u5e38\u7528\u7684\u547d\u4ee4\uff0c\u5982 <code>cp</code>\u3001<code>grep</code>\u3001<code>hostname</code> \u7b49\uff0c\u5b83\u4eec\u90fd\u6307\u5411 <code>busybox</code>\uff0c\u8868\u660e\u8fd9\u4e9b\u547d\u4ee4\u90fd\u662f\u7531 <code>busybox</code> \u5b9e\u73b0\u7684\u3002</p> <p>\u4f8b\u5982\uff0c\u5f53\u4f60\u6267\u884c <code>cp</code> \u547d\u4ee4\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u6267\u884c\u4e86 <code>busybox cp</code>\u3002<code>busybox</code> \u4f1a\u6839\u636e\u63d0\u4f9b\u7684\u53c2\u6570\u548c\u9009\u9879\u6765\u786e\u5b9a\u5e94\u8be5\u6267\u884c\u54ea\u4e2a\u5177\u4f53\u7684\u547d\u4ee4\u529f\u80fd\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97 <code>busybox</code> \u975e\u5e38\u7075\u6d3b\u4e14\u5360\u7528\u7a7a\u95f4\u5c0f\u3002</p> </li> </ul> <p>buildroot\u4f7f\u7528\u4ecb\u7ecd - ArnoldLu - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>buildroot \u7f51\u7ad9 Buildroot - Making Embedded Linux Easy</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_11","title":"\u8bbe\u5907\u6811","text":"<p>\u4e3b\u8981\u501f\u52a9\u4e0b\u9762\u7684\u5185\u5bb9\u6765\u5b66\u4e60\uff1a</p> <p>\u3010\u4e00\u6587\u79d2\u61c2\u3011Linux\u8bbe\u5907\u6811\u8be6\u89e3 | Donge Blog</p> <p>devicetree-specification-v0.4</p> <p>Device Tree Usage - eLinux.org</p> <p>linux\u8bbe\u5907\u9a71\u52a8(20)\u8bbe\u5907\u6811\u8be6\u89e34-kernel\u89e3\u6790dts - Action_er - \u535a\u5ba2\u56ed</p> <p>\u5176\u4ed6\u95ee\u9898</p> <p>\u8bbe\u5907\u6811\u548c ACPI \u7684\u5173\u7cfb\uff1f</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#linux-kernel","title":"Linux kernel","text":"<p>\u5982\u4f55\u7f16\u8bd1\u5b89\u88c5Linux\u5185\u6838 - LightningStar - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u8fd9\u91cc\u6211\u60f3\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u4ec0\u4e48\u53eb\u955c\u50cf\uff1f</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#risc-v-arch","title":"RISC-V Arch \u76f8\u5173","text":"<p>RISC-V architecture \u2014 The Linux Kernel documentation</p> <p>kernel.org/doc/Documentation/nommu-mmap.txt</p> <p>riscv\u67b6\u6784\u79fb\u690d \u00b7 book for nxos (book-os.com)</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#kernel","title":"kernel","text":"<p>RISC-V\u5f52\u6863 - Laumy\u7684\u6280\u672f\u6808</p> <p>\u4e0a\u9762\u8fd9\u4e2a\u4e13\u9898\u8bb2\u5230\u4e86\u76f8\u5173\u7684 RISC-V Linux kernel \u7684\u542f\u52a8\u6d41\u7a0b\uff0c\u4e3b\u8981\u662f OS \u7684\u542f\u52a8\u6d41\u7a0b\uff0cOpenSBI\u3001U-Boot\u4e0d\u6d89\u53ca\u3002</p> <p>Linux\u5185\u6838\u5728RISC-V\u67b6\u6784\u4e0b\u7684\u6784\u5efa\u4e0e\u542f\u52a8 - crab2313's blog</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#kernel_1","title":"\u90e8\u5206 kernel \u4ee3\u7801\u5b66\u4e60","text":"<ul> <li> <p><code>linux/arch/riscv/include/asm/asm.h</code></p> <p>\u8fd9\u6bb5\u4ee3\u7801\u662fLinux\u5185\u6838\u4e2d\u9488\u5bf9RISC-V\u67b6\u6784\u7684\u6c47\u7f16\u8bed\u8a00\u5934\u6587\u4ef6\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5b8f\u548c\u6307\u4ee4\uff0c\u7528\u4e8e\u5728RISC-V\u5904\u7406\u5668\u4e0a\u8fdb\u884c\u5e95\u5c42\u7684\u5185\u5b58\u64cd\u4f5c\u548c\u5bc4\u5b58\u5668\u7ba1\u7406\u3002\u8fd9\u4e9b\u5b8f\u548c\u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u5185\u6838\u7684\u6c47\u7f16\u4ee3\u7801\u4e2d\uff0c\u4ee5\u5b9e\u73b0\u5bf9\u786c\u4ef6\u7684\u76f4\u63a5\u63a7\u5236\u3002\u4e0b\u9762\u662f\u5bf9\u8fd9\u6bb5\u4ee3\u7801\u7684\u603b\u7ed3\uff1a</p> <ol> <li>\u5b8f\u5b9a\u4e49\uff1a</li> <li> <p><code>__ASM_STR(x)</code>\uff1a\u8fd9\u4e2a\u5b8f\u7528\u4e8e\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\u76f4\u63a5\u63d2\u5165\u5b57\u7b26\u4e32<code>x</code>\u3002\u5982\u679c\u5904\u4e8e\u6c47\u7f16\u6a21\u5f0f\uff08<code>__ASSEMBLY__</code>\u5b9a\u4e49\u4e86\uff09\uff0c\u5219\u76f4\u63a5\u4f7f\u7528<code>x</code>\uff1b\u5426\u5219\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u5bc4\u5b58\u5668\u9009\u62e9\uff1a</p> </li> <li> <p><code>__REG_SEL(a, b)</code>\uff1a\u8fd9\u4e2a\u5b8f\u6839\u636e<code>__riscv_xlen</code>\u7684\u503c\u9009\u62e9\u5bc4\u5b58\u5668\u64cd\u4f5c\u3002<code>__riscv_xlen</code>\u5b9a\u4e49\u4e86RISC-V\u67b6\u6784\u7684\u5b57\u957f\uff0c\u53ef\u4ee5\u662f32\u4f4d\u621664\u4f4d\u3002<code>__REG_SEL</code>\u6839\u636e\u8fd9\u4e2a\u503c\u9009\u62e9<code>a</code>\u6216<code>b</code>\u3002</p> </li> <li> <p>\u5bc4\u5b58\u5668\u64cd\u4f5c\u5b8f\uff1a</p> </li> <li><code>REG_L</code>\u548c<code>REG_S</code>\uff1a\u8fd9\u4e24\u4e2a\u5b8f\u5206\u522b\u7528\u4e8e\u4ece\u5185\u5b58\u52a0\u8f7d\uff08Load\uff09\u548c\u5b58\u50a8\uff08Store\uff09\u6570\u636e\u5230\u5bc4\u5b58\u5668\u3002\u5b83\u4eec\u6839\u636e<code>__riscv_xlen</code>\u7684\u503c\u9009\u62e9\u4f7f\u752832\u4f4d\u8fd8\u662f64\u4f4d\u7684\u6307\u4ee4\u3002</li> <li><code>REG_SC</code>\uff1a\u539f\u5b50\u5b58\u50a8\u5e76\u4ea4\u6362\u64cd\u4f5c\uff0c\u7528\u4e8e\u591a\u5904\u7406\u5668\u540c\u6b65\u3002</li> <li> <p><code>REG_AMOSWAP_AQ</code>\uff1a\u539f\u5b50\u4ea4\u6362\u64cd\u4f5c\uff0c\u5e26\u6709\u5185\u5b58\u5c4f\u969c\u3002</p> </li> <li> <p>\u6307\u9488\u548c\u6574\u6570\u5927\u5c0f\uff1a</p> </li> <li><code>RISCV_PTR</code>\u3001<code>RISCV_SZPTR</code>\u3001<code>RISCV_LGPTR</code>\uff1a\u8fd9\u4e9b\u5b8f\u5b9a\u4e49\u4e86\u6307\u9488\u7684\u5927\u5c0f\u548c\u5bf9\u9f50\u65b9\u5f0f\u3002</li> <li><code>RISCV_INT</code>\u3001<code>RISCV_SZINT</code>\u3001<code>RISCV_LGINT</code>\uff1a\u5b9a\u4e49\u4e86\u6574\u6570\u7684\u5927\u5c0f\u548c\u5bf9\u9f50\u65b9\u5f0f\u3002</li> <li> <p><code>RISCV_SHORT</code>\u3001<code>RISCV_SZSHORT</code>\u3001<code>RISCV_LGSHORT</code>\uff1a\u5b9a\u4e49\u4e86\u77ed\u6574\u578b\u7684\u5927\u5c0f\u548c\u5bf9\u9f50\u65b9\u5f0f\u3002</p> </li> <li> <p>\u6c47\u7f16\u5b8f\uff1a</p> </li> <li><code>nops</code>\uff1a\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b8f\uff0c\u7528\u4e8e\u751f\u6210\u6307\u5b9a\u6570\u91cf\u7684NOP\uff08\u65e0\u64cd\u4f5c\uff09\u6307\u4ee4\uff0c\u901a\u5e38\u7528\u4e8e\u586b\u5145\u6216\u5ef6\u8fdf\u6267\u884c\u3002</li> <li><code>save_from_x6_to_x31</code>\u548c<code>restore_from_x6_to_x31</code>\uff1a\u8fd9\u4e24\u4e2a\u5b8f\u7528\u4e8e\u4fdd\u5b58\u548c\u6062\u590d\u5bc4\u5b58\u5668x6\u5230x31\u7684\u503c\uff0c\u901a\u5e38\u5728\u51fd\u6570\u8c03\u7528\u6216\u4e2d\u65ad\u5904\u7406\u4e2d\u4f7f\u7528\uff0c\u4ee5\u4fdd\u5b58\u73b0\u573a\u548c\u6062\u590d\u73b0\u573a\u3002</li> </ol> <p>REG_S\u5b8f\u7684\u4f5c\u7528\u662f\u5c06\u4e00\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u3002\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c<code>REG_S</code>\u6839\u636eRISC-V\u7684\u5b57\u957f\uff0832\u4f4d\u621664\u4f4d\uff09\u9009\u62e9\u4f7f\u7528<code>sw</code>\uff08store word\uff0c\u5b58\u50a8\u5b57\uff09\u6216<code>sd</code>\uff08store double word\uff0c\u5b58\u50a8\u53cc\u5b57\uff09\u6307\u4ee4\u3002\u8fd9\u4e2a\u5b8f\u5728\u5185\u6838\u4e2d\u7528\u4e8e\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u3001\u4e2d\u65ad\u5904\u7406\u7b49\u573a\u666f\u4e0b\u7684\u5bc4\u5b58\u5668\u4fdd\u5b58\u548c\u6062\u590d\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"ysyx/pa/Linux_porting/porting.html#abi","title":"\u542f\u52a8\u76f8\u5173\u7684ABI\u8bbe\u7f6e","text":"<p>RISC-V\u5185\u6838\u542f\u52a8\u8981\u6c42\u548c\u9650\u5236 \u2014 The Linux Kernel documentation</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#rootfs","title":"rootfs","text":"<p>\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u4ec0\u4e48\u53eb rootfs\uff1f</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#nommu-linux","title":"nommu-linux","text":"<p>\u5728\u79fb\u690dLinux\u4e4b\u524d\uff0c\u5148\u5c1d\u8bd5\u5b66\u4e60 <code>mini-rv32ima</code> \u8fd9\u4e2a\u9879\u76ee\uff0c\u7136\u540e\u4eff\u7167\u5b83\uff0c\u5c06 <code>nommu-linux</code> \u79fb\u690d\u5230 NEMU \u4e0a\u3002</p> <p></p>"},{"location":"ysyx/pa/Linux_porting/porting.html#image","title":"\u5982\u4f55\u52a0\u8f7d image \u548c\u8bbe\u5907\u6811","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#_12","title":"\u4e00\u4e9b\u542f\u52a8\u4e0a\u7684\u95ee\u9898","text":""},{"location":"ysyx/pa/Linux_porting/porting.html#_13","title":"\u53c2\u8003\u8d44\u6599","text":"<p>TODO: \u6dfb\u52a0\u81ea\u5df1\u5fae\u4fe1\u804a\u5929\u7684\u76f8\u5173\u7b14\u8bb0</p> <p>Linux\u4e0b1\u53f7\u8fdb\u7a0b\u7684\u524d\u4e16(kernel_init)\u4eca\u751f(init\u8fdb\u7a0b)----Linux\u8fdb\u7a0b\u7684\u7ba1\u7406\u4e0e\u8c03\u5ea6\uff08\u516d\uff09 - yooooooo - \u535a\u5ba2\u56ed</p> <p>\u611f\u89c9\u4f3c\u4e4e\u5f97\u57fa\u4e8e\u67d0\u4e00\u7248\u7684 Linux kernel \u6765\u5206\u6790\uff0c\u4e0d\u7136\u56fd\u5185\u7684\u5206\u6790\u597d\u50cf\u90fd\u662f 4.x \u7684\u7248\u672c\uff0c\u6ca1\u6709\u6bd4\u8f83\u65b0\u7684\u3002</p> <p>\u5361\u5728\u67d0\u5904bug\uff1a</p> <p>initcall \u673a\u5236 \u00b7 Linux \u00adInsides\u00ad</p> <p>\u5185\u6838\u955c\u50cf\uff0c\u4e3a\u4e86\u7528ftrace\uff0c\u4e86\u89e3 vmlinux\uff0c\u7528\u4e8e\u8c03\u8bd5</p> <p>Differences Between vmlinux, vmlinuz, vmlinux.bin, zimage, and bzimage | Baeldung on Linux</p> <p>\u73b0\u5728\u8fdb\u5165\u4e86 idle \u4efb\u52a1\uff1a</p> <p>\u4e00\u6587\u641e\u61c2linux cpu idle - \u77e5\u4e4e</p> <p>\u4f46\u5b9e\u9645\u4e0a\u597d\u50cf\u662fUART\u7684\u95ee\u9898\u3002</p> <p>\u8fdb\u4e00\u6b65\uff0c\u5173\u4e8e bootconsole\u3001console \u7684\u533a\u522b\uff1f</p> <p>\u518d\u8fdb\u4e00\u6b65 TTY\u3001 /dev/tty\u3001/dev/ttyS0\u3001/dev/console\u3001uart\u7b49\u5dee\u5f02\uff1f</p> <p>\u97e6\u4e1c\u5c71\u8001\u5e08\u7684\u89c6\u9891\u533a\u522b\uff01\uff01\uff01\u8bb2\u7684\u771f\u7684\u5f88\u597d\uff01\uff01</p> <p>Linux Serial Console \u2014 The Linux Kernel documentation</p> <p>\u89e3\u5bc6 TTY \u8bbe\u5907</p> <p>\u518d\u8865\u5145\uff1a\u6df1\u5165\u89e3\u6790Linux\u5185\u6838Console\u6846\u67b6\u53ca\u865a\u62dfUART\u63a7\u5236\u53f0\u7684\u5b9e\u73b0-CSDN\u535a\u5ba2</p> <p>\u8fd8\u6709\u4e00\u4e2a\u56de\u7b54\u4e5f\u633a\u597d\u7684\uff1a</p> <p>c - Difference between a serial driver and a tty driver - Stack Overflow</p> <p>\u8fdb\u4e00\u6b65\u4e86\u89e3 ramdisk\u3001initramfs\u3001initrd....</p> <p>embedded - Initrd, Ramdisk, Initramfs, uclinux - Stack Overflow</p> <p>linux - The difference between initrd and initramfs - Stack Overflow</p> <p>boot - Why is the root filesystem is loaded into a ramdisk? - Stack Overflow</p> <p>12.3. Booting with the Initial Ramdisk</p> <p>\u7b80\u5355\u7406\u89e3\uff0c\u5c06\u5185\u5b58\u4e2d\u7684\u4e00\u90e8\u5206\u5f53\u6210\u78c1\u76d8\u6765\u4f7f\u7528\uff1a\u8fd9\u6837\u7684\u78c1\u76d8\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u540d\u5b57\uff1aramdisk\u3002\u8fd9\u79cd\u78c1\u76d8\u4e0d\u50cf\u771f\u6b63\u7684\u78c1\u76d8\uff0c\u4ed6\u662f\u6389\u7535\u4e22\u5931\u7684\u3002</p> <p>initrd\u3001initramfs\uff1a\u7528\u6237\u7a7a\u95f4\u65e9\u671f\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e2a\u4f4d\u4e8e\u5185\u5b58\u7684\u6bd4\u8f83\u5c0f\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u501f\u6b64\u603b\u7ed3\uff1a</p> <p>\u4ece Linux \u542f\u52a8\u7684\u89d2\u5ea6\u6765\u603b\u7ed3\uff0cinitrd\uff08initial RAM disk\uff09\u548c initramfs \u662f\u4e24\u79cd\u7528\u4e8e\u65e9\u671f\u9636\u6bb5\u7528\u6237\u7a7a\u95f4\u6839\u6587\u4ef6\u7cfb\u7edf\uff08rootfs\uff09\u7684\u6280\u672f\uff0c\u5b83\u4eec\u5141\u8bb8\u7cfb\u7edf\u5728\u5185\u5b58\u4e2d\u8fd0\u884c\u4e00\u4e2a\u6700\u5c0f\u5316\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <ol> <li>initrd\uff1a</li> <li>initrd \u662f\u4e00\u4e2a\u7531\u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f\uff08\u5982 GRUB \u6216 LILO\uff09\u52a0\u8f7d\u7684\u521d\u59cb RAM \u78c1\u76d8\u6620\u50cf\uff0c\u5b83\u88ab\u6302\u8f7d\u4e3a\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u5141\u8bb8\u7cfb\u7edf\u5728\u53ea\u6709\u6700\u5c0f\u9a71\u52a8\u96c6\u5408\u7684\u60c5\u51b5\u4e0b\u542f\u52a8\u3002</li> <li>\u5b83\u7684\u4e3b\u8981\u76ee\u7684\u662f\u5728\u7cfb\u7edf\u542f\u52a8\u7684\u4e24\u4e2a\u9636\u6bb5\u4e2d\uff0c\u9996\u5148\u53ea\u52a0\u8f7d\u5185\u6838\u4e2d\u7f16\u8bd1\u7684\u6700\u5c0f\u9a71\u52a8\u96c6\u5408\uff0c\u7136\u540e\u4ece initrd \u4e2d\u52a0\u8f7d\u989d\u5916\u7684\u6a21\u5757\u3002</li> <li>initrd \u901a\u5e38\u5305\u542b\u5fc5\u8981\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u7279\u522b\u662f\u78c1\u76d8\u63a7\u5236\u5668\u7684\u9a71\u52a8\uff0c\u4ee5\u4fbf\u5728\u5b9e\u9645\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u88ab\u6302\u8f7d\u4e4b\u524d\u52a0\u8f7d\u8fd9\u4e9b\u9a71\u52a8\u3002</li> <li> <p>initrd \u662f\u4f7f\u7528 cpio \u683c\u5f0f\u5b58\u50a8\u6587\u4ef6\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u6784\u5efa\u5185\u6838\u65f6\u901a\u8fc7 usr/Kconfig \u8fdb\u884c\u914d\u7f6e\u3002</p> </li> <li> <p>initramfs\uff1a</p> </li> <li>initramfs \u662f initrd \u7684\u4e00\u4e2a\u66f4\u65e9\u671f\u9636\u6bb5\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u88ab\u96c6\u6210\u5728\u5185\u6838\u4e2d\uff08\u7531\u5185\u6838\u914d\u7f6e\u63a7\u5236\uff09\u3002</li> <li>initramfs \u7684\u5de5\u4f5c\u65b9\u5f0f\u76f8\u5bf9\u7b80\u5355\u76f4\u63a5\uff0c\u542f\u52a8\u65f6\u52a0\u8f7d\u5185\u6838\u548c initramfs \u5230\u5185\u5b58\u6267\u884c\uff0c\u5185\u6838\u521d\u59cb\u5316\u540e\uff0c\u5207\u6362\u5230\u7528\u6237\u6001\u6267\u884c initramfs \u4e2d\u7684\u7a0b\u5e8f/\u811a\u672c\uff0c\u52a0\u8f7d\u6240\u9700\u7684\u9a71\u52a8\u6a21\u5757\u548c\u5fc5\u8981\u914d\u7f6e\uff0c\u7136\u540e\u52a0\u8f7d rootfs \u5207\u6362\u5230\u771f\u6b63\u7684 rootfs \u4e0a\u53bb\u6267\u884c\u540e\u7eed\u7684 init \u8fc7\u7a0b\u3002</li> <li> <p>\u4ece Linux \u5185\u6838 2.6 \u5f00\u59cb\uff0cinitrd \u6587\u4ef6\u683c\u5f0f\u7531\u539f\u6765\u7684\u6587\u4ef6\u7cfb\u7edf\u955c\u50cf\u6587\u4ef6\u8f6c\u53d8\u6210\u4e86 cpio \u683c\u5f0f\uff0c\u5185\u6838\u5bf9\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u5904\u7406\u6709\u7740\u660e\u663e\u7684\u4e0d\u540c\u3002</p> </li> <li> <p>ramfs \u548c tmpfs\uff1a</p> </li> <li>ramfs \u662f\u4e00\u79cd\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u4f7f\u7528\u5185\u5b58\u800c\u4e0d\u662f\u78c1\u76d8\u6765\u5b58\u50a8\u6587\u4ef6\u6570\u636e\uff0c\u8fd9\u4f7f\u5f97\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\u3002</li> <li>tmpfs \u662f ramfs \u7684\u589e\u5f3a\u7248\uff0c\u4e5f\u662f\u4e00\u79cd\u57fa\u4e8e\u5185\u5b58\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0 initrd\u3002</li> <li> <p>\u65b0\u7248\u672c\u7684\u5185\u6838\u4e2d\uff0cinitrd \u901a\u5e38\u4f7f\u7528 tmpfs \u800c\u4e0d\u662f ramfs \u6765\u5b9e\u73b0\u3002</p> </li> <li> <p>\u542f\u52a8\u8fc7\u7a0b\uff1a</p> </li> <li>\u5728\u4f7f\u7528 initrd \u7684\u7cfb\u7edf\u4e2d\uff0c\u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f\u4f1a\u52a0\u8f7d\u5185\u6838\u548c initrd \u5230\u5185\u5b58\u4e2d\uff0c\u5185\u6838\u5c06 initrd \u8f6c\u6362\u4e3a\u4e00\u4e2a\u201c\u6b63\u5e38\u201d\u7684 RAM \u78c1\u76d8\uff0c\u5e76\u91ca\u653e initrd \u4f7f\u7528\u7684\u5185\u5b58\u3002</li> <li>\u7136\u540e\uff0c\u5982\u679c\u6839\u8bbe\u5907\u4e0d\u662f <code>/dev/ram0</code>\uff0c\u5185\u6838\u4f1a\u6302\u8f7d\u6839\u8bbe\u5907\uff0c\u5982\u679c\u662f <code>/dev/ram0</code>\uff0c\u5219 initrd \u6620\u50cf\u88ab\u6302\u8f7d\u4e3a\u6839\u3002</li> <li>\u63a5\u7740\u6267\u884c <code>/sbin/init</code>\uff0c\u8fd9\u662f init \u8fdb\u7a0b\u7684\u5f00\u59cb\uff0c\u5b83\u4f1a\u6302\u8f7d\u201c\u771f\u6b63\u7684\u201d\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u4f7f\u7528 <code>pivot_root</code> \u7cfb\u7edf\u8c03\u7528\u5c06\u6839\u6587\u4ef6\u7cfb\u7edf\u653e\u5230\u6839\u76ee\u5f55\u4e0b\u3002</li> <li>\u6700\u540e\uff0cinitrd \u6587\u4ef6\u7cfb\u7edf\u88ab\u79fb\u9664\uff0c\u7cfb\u7edf\u7ee7\u7eed\u5728\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u4e0a\u6267\u884c\u3002</li> </ol> <p>\u8fd9\u4e9b\u6280\u672f\u5141\u8bb8 Linux \u7cfb\u7edf\u5728\u542f\u52a8\u65f6\u6709\u4e00\u4e2a\u7075\u6d3b\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u4ece\u7f51\u7edc\u6216\u5916\u90e8\u5b58\u50a8\u4ecb\u8d28\u52a0\u8f7d\u6839\u6587\u4ef6\u7cfb\u7edf\u65f6\u975e\u5e38\u6709\u7528\u3002</p> <p>BusyBox \u6784\u5efa\u5e76\u542f\u52a8 RISC-V Linux \u5185\u6838 | \u591c\u4e91\u6cca</p> <p>\u5173\u4e8eLinux kernel \u7684\u542f\u52a8\u6d41\u7a0b\u5230 init \u4e4b\u540e --&gt; \u8fd0\u884c\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>Linux\u542f\u52a8\u5206\u6790\u2014\u2014init\u8fdb\u7a0b\u4e0eapp\u542f\u52a8(init\u8fdb\u7a0b\u6e90\u7801\u5206\u6790)_\u672c\u6587\u901a\u8fc7\u7b80\u8981\u5206\u6790init\u8fdb\u7a0b\u6e90\u7801,\u68b3\u7406\u5176\u5904\u7406\u6d41\u7a0b,\u91cd\u70b9\u5173\u6ce8init\u8fdb\u7a0b\u5982\u4f55\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f-CSDN\u535a\u5ba2</p> <p>\u7a81\u7136\u60f3\u5230\u53ef\u4ee5\u770b\u770b qemu \u548c opensbi \u5173\u4e8e uart8250\u548c ns16550\u7684\u5b9e\u73b0\uff1f</p> <p>qemu\u865a\u62df\u5316-\u8bbe\u5907\u6a21\u62df\u8be6\u89e3_qemu\u4e2duart\u6570\u636e-CSDN\u535a\u5ba2\uff01</p> <p>opensbi/lib/utils/serial/uart8250.c at master \u00b7 riscv-software-src/opensbi</p> <p>\u5b66\u4e60 QEMU\u7684\u8bbe\u8ba1\uff1a</p> <p>\u83dc\u9e21\u8bfbQEMU\u6e90\u7801 - From_Zero - \u535a\u5ba2\u56ed</p> <p>lishuhuakai/qemu_reading: qemu\u6e90\u7801\u7684\u9605\u8bfb\u7b14\u8bb0</p> <p>QEMU \u6e90\u7801\u5206\u6790-\u5916\u8bbe\u6a21\u62df\uff08\u4ee5 GPIO \u4e3a\u4f8b\uff09 | \u591c\u4e91\u6cca</p> <p>\u8865\u5145\u66f4\u591a UART\u7684\u5b66\u4e60</p> <p>UART 16550\u7684\u4f7f\u7528_uart16550-CSDN\u535a\u5ba2</p> <p>ns16550\u4e32\u53e3\u9a71\u52a8-CSDN\u535a\u5ba2</p> <p>The NS16550A: UART Design and Applications Considerations</p> <p>\u5173\u4e8e\u8bbe\u5907\u6811\u7684\uff1a</p> <p>\u8fdb\u4e00\u6b65\u770b\u770b\u6587\u6863\uff0c\u5c24\u5176\u662f\u90a3\u4e2a compatible\uff0c\u533a\u5206 ns16550\u30018250\u3001ns16850\u3001ns16550a</p> <p>\u4e3a\u4ec0\u4e48\u8bbe\u5907\u6811\u91cc\u5199\u8fd9\u4e2a\u5c31\u884c\uff1f\u90a3\u4e2a\u5c31\u4e0d\u884c\uff1fkernel \u600e\u4e48\u89e3\u6790\u7684\uff1f\u5177\u4f53\u770bUART\u7684\u9a71\u52a8\u5b9e\u73b0\uff1f</p> <p>Device Tree Usage - eLinux.org</p> <p>\u8fdb\u4e00\u6b65\u5b66\u4e60 hvc</p> <p>linux - Debian VM doesn\u2019t boot on QEMU with \"console=hvc0\" kernel parameter - Unix &amp; Linux Stack Exchange</p> <p>\u4e0b\u4e00\u6b65\u6280\u672f\uff1a</p> <p>\u5f00\u59cb\u5b66\u4e60 hypervisor \u5427\uff01\uff01</p> <p>\u57fa\u4e8eQemu ARM64\u642d\u5efaXEN Hypervisor\u8fd0\u884c\u73af\u5883 | \u5d4c\u5165\u5f0f\u5206\u533a\u5b9e\u65f6\u7cfb\u7edf</p> <p>blog.csdn.net/jingyu_1/article/details/137539089?spm=1001.2014.3001.5502</p> <p>\u5e94\u8be5\u4e70\u4e00\u5757\u5f00\u53d1\u677f\u4ee5\u53ca\uff1f</p> <p>\u6df1\u5165\u5b66\u4e60\u4e00\u4e9b\u786c\u4ef6\u67b6\u6784\uff1f</p> <p>MMU\u3001TLB\u3001cache\u3001\u5f02\u5e38\u5904\u7406\u3001trustzone\u3001bus\u3001SIMD...</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#other-qemu-opensbi-risc-v","title":"Other: QEMU + OpenSBI + ...  \u5b66\u4e60RISC-V","text":"<p>RISC-V - \u968f\u7b14\u5206\u7c7b - ArnoldLu - \u535a\u5ba2\u56ed</p>"},{"location":"ysyx/pa/Linux_porting/porting.html#_14","title":"\u53c2\u8003\u6587\u7ae0","text":"<p>1- Linux\u7cfb\u7edf\u79fb\u690d\u524d\u671f\u51c6\u5907\u6982\u8ff0 - \u767d\u83dc\u6ca1\u6211\u767d - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u5d4c\u5165\u5f0fLinux\u7cfb\u7edf\u79fb\u690d\u539f\u7406\u4e0e\u65b9\u6cd5\u603b\u7ed3_\u600e\u4e48\u66f4\u6362\u5d4c\u5165\u5f0f\u677f\u5b50\u7684linux\u7cfb\u7edf-CSDN\u535a\u5ba2</p> <p>\u3010\u6587\u7ae0\u7ffb\u8bd1\u3011\u5c06Linux\u79fb\u690d\u5230\u65b0\u7684\u5904\u7406\u5668\u67b6\u6784\uff081\uff09\u2014\u2014\u57fa\u7840\u7bc7 - \u5c39\u5929\u5b87\u7684\u535a\u5ba2 | Jack's Blog (yintianyu.github.io)</p> <p>Porting Linux to a new architecture LWN.net]</p>"},{"location":"ysyx/pa/c_marco/macro.html","title":"C Macro","text":""},{"location":"ysyx/pa/c_marco/macro.html#introduction","title":"Introduction","text":"<p>\u5173\u4e8e\u5b8f\uff0c\u5b9e\u9645\u4e0a\u5c31\u4e0d\u5f97\u4e0d\u8c08\u5230\u9884\u5904\u7406\u5668\u3002</p> <p>Preprocessor - cppreference.com</p> <p>The preprocessor has the source file translation capabilities:</p> <ul> <li>conditionally compile of parts of source file (controlled by directive , , , , , <code>#elifdef</code>, <code>#elifndef</code>(since C23) and ). <code>#if``#ifdef``#ifndef``#else``#elif``#endif</code></li> <li>replace text macros while possibly concatenating or quoting identifiers (controlled by directives and , and operators and <code>#define</code>\u3001<code>#undef</code>\u3001<code>#</code>\u3001<code>##</code>)</li> <li>include other files (controlled by directive <code>#include</code> and checked with __has_include(since C23))</li> <li>cause an error or warning(since C23) (controlled by directive or <code>#warning</code> respectively(since C23)<code>#error</code>)</li> </ul> <p>The following aspects of the preprocessor can be controlled:</p> <ul> <li>implementation defined behavior (controlled by directive and operator <code>_Pragma</code>(since C99)<code>#pragma</code>)</li> <li>file name and line information available to the preprocessor (controlled by directives <code>#line</code>)</li> </ul> <p>\u8fd9\u91cc\u6211\u53ea\u662f\u603b\u7ed3\u4e9b\u6211\u5728\u505a PA \u65f6\u9047\u5230\u7684\u4e00\u4e9b\u5b8f\uff0c\u6240\u4ee5\uff0c\u6211\u4ec5\u5173\u6ce8 replace \u8fd9\u4e00\u529f\u80fd\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#basic-usage","title":"Basic usage","text":"<p>\u4e0b\u9762\u76f4\u63a5\u7531 <code>kimi</code> \u751f\u6210\u3002</p> <p>C\u8bed\u8a00\u4e2d\u7684\u5b8f\u662f\u4e00\u79cd\u9884\u5904\u7406\u5668\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u4f60\u5728\u7f16\u8bd1\u4e4b\u524d\u8fdb\u884c\u6587\u672c\u66ff\u6362\u3002\u5b8f\u7684\u57fa\u672c\u4f7f\u7528\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u5e38\u91cf\uff1a \u4f7f\u7528\u5b8f\u5b9a\u4e49\u6765\u521b\u5efa\u5e38\u91cf\u53ef\u4ee5\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u4f8b\u5982\uff1a</p> <pre><code> #define PI 3.14159\n</code></pre> </li> <li> <p>\u4ee3\u7801\u590d\u7528\uff1a \u5b8f\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u4ee3\u7801\u7247\u6bb5\uff0c\u4ee5\u907f\u514d\u5728\u7a0b\u5e8f\u4e2d\u91cd\u590d\u7f16\u5199\u76f8\u540c\u7684\u4ee3\u7801\u3002\u4f8b\u5982\uff1a</p> <pre><code> #define SQUARE(x) ((x)*(x))\n</code></pre> </li> <li> <p>\u6761\u4ef6\u7f16\u8bd1\uff1a \u5b8f\u53ef\u4ee5\u7528\u4e8e\u6761\u4ef6\u7f16\u8bd1\uff0c\u4f7f\u5f97\u5728\u7f16\u8bd1\u65f6\u53ef\u4ee5\u6839\u636e\u7279\u5b9a\u7684\u6761\u4ef6\u5305\u542b\u6216\u6392\u9664\u4ee3\u7801\u6bb5\u3002\u4f8b\u5982\uff1a</p> <pre><code> #define DEBUG 1\n #ifdef DEBUG\n printf(\"Debugging information: variable value = %d\\n\", variable);\n #endif\n</code></pre> </li> <li> <p>\u5b57\u7b26\u4e32\u5316\u548c\u6807\u8bb0\u7c98\u8d34\uff1a \u5b8f\u63d0\u4f9b\u4e86\u5b57\u7b26\u4e32\u5316\uff08<code>#</code>\uff09\u548c\u6807\u8bb0\u7c98\u8d34\uff08<code>##</code>\uff09\u64cd\u4f5c\u7b26\uff0c\u7528\u4e8e\u7279\u6b8a\u7684\u6587\u672c\u5904\u7406\u3002</p> <ul> <li> <p>\u5b57\u7b26\u4e32\u5316\u64cd\u4f5c\u7b26\u5c06\u5b8f\u53c2\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff1a</p> <pre><code> #define LOG(msg) printf(\"Message: %s\\n\", #msg)\n</code></pre> </li> <li> <p>\u6807\u8bb0\u7c98\u8d34\u64cd\u4f5c\u7b26\u7528\u4e8e\u8fde\u63a5\u4e24\u4e2a\u7b26\u53f7\u6216\u5b8f\u53c2\u6570\uff1a</p> <pre><code> #define UNIQUE_NAME(x) x##_unique\n int UNIQUE_NAME(my_var);\n</code></pre> </li> </ul> </li> <li> <p>\u591a\u884c\u5b8f\uff1a \u5f53\u5b8f\u5b9a\u4e49\u8de8\u8d8a\u591a\u884c\u65f6\uff0c\u9700\u8981\u4f7f\u7528\u53cd\u659c\u6760\uff08<code>\\</code>\uff09\u6765\u7ee7\u7eed\u884c\u3002\u4f8b\u5982\uff1a</p> <pre><code> #define INIT_ARRAY(arr, size) { \\\n     int i; \\\n     for (i = 0; i &lt; size; i++) { \\\n         arr[i] = 0; \\\n     } \\\n }\n</code></pre> </li> <li> <p>\u5b8f\u4e0e\u51fd\u6570\u7684\u533a\u522b\uff1a \u5b8f\u6ca1\u6709\u7c7b\u578b\u68c0\u67e5\uff0c\u4e0d\u5360\u7528\u8fd0\u884c\u65f6\u8d44\u6e90\uff0c\u4e14\u5728\u7f16\u8bd1\u65f6\u5c55\u5f00\u3002\u800c\u51fd\u6570\u8c03\u7528\u6709\u7c7b\u578b\u68c0\u67e5\uff0c\u5360\u7528\u6808\u7a7a\u95f4\uff0c\u4e14\u5728\u8fd0\u884c\u65f6\u8c03\u7528\u3002</p> </li> <li> <p>\u5b8f\u7684\u526f\u4f5c\u7528\uff1a \u7531\u4e8e\u5b8f\u662f\u7b80\u5355\u7684\u6587\u672c\u66ff\u6362\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u4e0d\u671f\u671b\u7684\u526f\u4f5c\u7528\uff0c\u5c24\u5176\u662f\u5f53\u5b8f\u53c2\u6570\u662f\u8868\u8fbe\u5f0f\u65f6\u3002\u4f8b\u5982\uff1a</p> <pre><code> #define SQUARE_AND_ADD(x) (x * x + x)\n int a = 10;\n int result = SQUARE_AND_ADD(a++);\n // \u8fd9\u91cc a \u4f1a\u88ab\u589e\u52a0\u4e09\u6b21\uff0c\u800c\u4e0d\u662f\u9884\u671f\u7684\u4e00\u6b21\n</code></pre> </li> <li> <p>\u5b8f\u7684\u53ef\u89c1\u6027\uff1a \u5b8f\u5728\u5b9a\u4e49\u5b83\u4eec\u7684\u6587\u4ef6\u4e2d\u662f\u5168\u5c40\u53ef\u89c1\u7684\uff0c\u9664\u975e\u5b83\u4eec\u88ab\u5b9a\u4e49\u5728 <code>#ifndef</code> \u4fdd\u62a4\u5757\u4e2d\uff0c\u4ee5\u9632\u6b62\u5934\u6587\u4ef6\u7684\u91cd\u590d\u5305\u542b\u3002</p> </li> <li> <p>\u53d6\u6d88\u5b8f\u5b9a\u4e49\uff1a \u53ef\u4ee5\u4f7f\u7528 <code>#undef</code> \u6765\u53d6\u6d88\u5b8f\u7684\u5b9a\u4e49\u3002\u4f8b\u5982\uff1a</p> <pre><code> #undef PI\n</code></pre> </li> <li> <p>\u5b8f\u7684\u9650\u5236\uff1a \u5b8f\u4e0d\u80fd\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\uff0c\u5b83\u4eec\u53ea\u80fd\u7528\u4e8e\u5168\u5c40\u53ef\u89c1\u7684\u7b26\u53f7\u3002\u6b64\u5916\uff0c\u5b8f\u6ca1\u6709\u4f5c\u7528\u57df\u7684\u6982\u5ff5\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u57df\u662f\u6574\u4e2a\u6587\u4ef6\u3002</p> </li> </ol> <p>\u4f7f\u7528\u5b8f\u65f6\u5e94\u8be5\u8c28\u614e\uff0c\u56e0\u4e3a\u4e0d\u5f53\u7684\u4f7f\u7528\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ee3\u7801\u96be\u4ee5\u7406\u89e3\u548c\u7ef4\u62a4\u3002\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5185\u8054\u51fd\u6570\uff08C99 \u5f15\u5165\uff09\u4f5c\u4e3a\u5b8f\u7684\u66ff\u4ee3\uff0c\u56e0\u4e3a\u5185\u8054\u51fd\u6570\u63d0\u4f9b\u4e86\u7c7b\u578b\u68c0\u67e5\u548c\u66f4\u6e05\u6670\u7684\u8c03\u8bd5\u4fe1\u606f\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u914d\u5408Macros (The C Preprocessor) (gnu.org) \u624b\u518c\u5927\u6982\u5373\u53ef\u5f04\u5f97\u4e00\u4e9b\u57fa\u672c\u7684\u4f7f\u7528\u548c\u6982\u5ff5\u4e86\u3002</p> <p>\u6709\u4e86\u4e00\u5b9a\u7684\u7f16\u7a0b\u7ecf\u9a8c\u548c LLM \u7684\u5e2e\u52a9\uff0c\u5e94\u8be5\u662f\u53ef\u4ee5\u5bf9\u5b8f\u57fa\u672c\u4e0a\u624b\u4f7f\u7528\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u65e0\u8bba\u662f\u5728\u6559\u6750\u8fd8\u662f\u5404\u5927\u4ea4\u6d41\u5e73\u53f0\u4e0a\uff0c\u603b\u6709\u4eba\u8bf4\u5b8f\u4f1a\u5bfc\u81f4\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff0c\u4e0d\u8981\u4e71\u7528\u3002\u7531\u4e8e\u672c\u4eba\u7ecf\u9a8c\u8fd8\u662f\u5f88\u6709\u9650\uff0c\u6240\u4ee5\u76ee\u524d\u4ec5\u8bb0\u5f55\u4e00\u4e9b\u6bd4\u8f83\u591a\u4eba\u7528\u4e14\u524d\u4eba\u603b\u7ed3\u597d\u7684\u4e00\u4e9b\u529f\u80fd\u3002</p> <p>\u672c\u6587\u7b14\u8bb0 \u8bb0\u5f55\u7684\u662f GNU C preprocessor\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#c-macro-summary","title":"C Macro Summary","text":""},{"location":"ysyx/pa/c_marco/macro.html#preprocessor-process","title":"Preprocessor process","text":"<p>\u5b8f\u4f5c\u4e3a\u9884\u5904\u7406\u8bed\u53e5\u7684\u4e00\u90e8\u5206\uff0c\u6211\u8fd8\u662f\u60f3\u603b\u7ed3\u4e86\u4e00\u4e9b\u5173\u4e8e\u9884\u5904\u7406\u5668\u8fdb\u884c\u9884\u5904\u7406\u7684\u4e00\u4e9b\u6d41\u7a0b\u3002\u539f\u672c\u6211\u4ee5\u4e3a\u7684\u6d41\u7a0b\u5f88\u7b80\u5355\uff08 <code>include</code>\u3001\u5c55\u5f00\u3001\u66ff\u6362\uff09\uff0c\u4f46\u67e5\u9605\u624b\u518c\u548c\u6807\u51c6\u540e\u624d\u53d1\u73b0\u9884\u5904\u7406\u5668\u539f\u6765\u4e0d\u53ea\u6709\u505a\u8fd9\u4e9b\u4e8b\u60c5\u3002\u53e6\u4e00\u65b9\u9762\u4e5f\u662f\u4e3a\u4e86\u6574\u4e2a\u7b14\u8bb0\u7684\u5b8c\u6574\u6027\u5427\uff0c\u7a0d\u5fae\u6709\u70b9\u5f3a\u8feb\u75c7\u3002</p> <p>\u5b9e\u9645\u4e0a\u8fd9\u90e8\u5206\u7684\u5185\u5bb9\u6211\u89c9\u5f97\u5bf9\u4e8e\u5927\u90e8\u5206\u4eba\u5458\u90fd\u662f\u4e0d\u7528\u4e86\u89e3\u7684\uff08\u9664\u975e\u4f60\u662f\u5199 preprocessor \u7684\uff09\uff0c\u552f\u4e00\u9700\u8981\u5173\u6ce8\u7684\u662f <code>Preprocessing Language</code> \u4e2d\u5b8f\u5c55\u5f00\u7684\u90a3\u90e8\u5206\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#1-initial-processing","title":"1. Initial processing","text":"<ol> <li> <p>\u5c06\u8f93\u5165\u6587\u4ef6\u8bfb\u5165\u5230\u5185\u5b58\u4e2d\u5e76\u5212\u5206\u884c</p> <p>\u8fd9\u91cc\u4e0d\u540c\u7684\u7cfb\u7edf\u6709\u4e0d\u540c\u7ea6\u5b9a\u6765\u8868\u793a\u884c\u5c3e\uff0c\u76ee\u524d\u4e0d\u6df1\u5165\u4e86\u89e3\u3002</p> </li> <li> <p>\u5982\u679c\u542f\u7528\u4e86\u4e09\u5b57\u7b26\u5e8f\u5217\uff08trigraphs\uff09\uff0c\u5b83\u4eec\u4f1a\u88ab\u66ff\u6362\u4e3a\u5bf9\u5e94\u7684\u5355\u4e2a\u5b57\u7b26(\u9009) </p> <p>trigraphs \u90fd\u662f\u4ee5 <code>??</code> \u5f00\u5934\u7684\u3002\u603b\u5171\u6709 9 \u4e2a trigraphs\uff1a</p> <pre><code>Trigraph:       ??(  ??)  ??&lt;  ??&gt;  ??=  ??/  ??'  ??!  ??-\nReplacement:      [    ]    {    }    #    \\    ^    |    ~\n</code></pre> </li> <li> <p>\u8fde\u7eed\u884c\u5408\u5e76\u4e3a\u957f\u884c</p> <p>\u5982\u679c\u5728\u4ee3\u7801\u4e2d\u6709\u4f7f\u7528\u53cd\u659c\u6760 <code>\\</code> \u6765\u8de8\u884c\u7684\u8bdd\uff0c\u9884\u5904\u7406\u5668\u4f1a\u5c06\u591a\u884c\u5408\u5e76\u4e3a\u4e00\u4e2a\u957f\u884c\u3002eg\uff1a</p> <pre><code>#define FORMAT_STRACE \"syscall: %s sys_num: %d(d)\\n\" \\\n                      \"        reg: a0: 0x%x  a1: 0x%x  a2: 0x%x\\n\" \\\n                      \"        ret: 0x%x\\n\"   \n</code></pre> </li> <li> <p>\u6240\u6709\u6ce8\u91ca\u66ff\u6362\u4e3a\u5355\u4e2a\u7a7a\u683c</p> <p>\u65e0\u8bba\u662f\u5757\u6ce8\u91ca <code>/*   */</code> \u8fd8\u662f \u884c\u6ce8\u91ca <code>//</code></p> </li> </ol>"},{"location":"ysyx/pa/c_marco/macro.html#2-tokenization","title":"2. Tokenization","text":"<p>\u5b8c\u6210\u7b2c\u4e00\u6b65\u7684\u6587\u672c\u8f6c\u6362\u540e\uff0c\u8f93\u5165\u6587\u4ef6\u5c06\u4f1a\u88ab\u8f6c\u6362\u4e3a token \u5e8f\u5217\uff0c\u8fd9\u4e2a token \u548c\u7f16\u8bd1\u5668\u4e2d\u7684\u8bcd\u6cd5\u5206\u6790\u5355\u5143\u5f88\u7c7b\u4f3c\uff0c\u53ea\u662f\u6709\u4e00\u4e9b\u5c0f\u4e0d\u540c\uff0c\u6211\u4eec\u76ee\u524d\u4e0d\u6df1\u5165\u7406\u89e3\u3002\u6211\u4eec\u53ea\u5173\u6ce8\u91cd\u8981\u7684\u7279\u70b9\u3002</p> <ul> <li> <p>\u7a7a\u767d\u5206\u9694 token</p> <pre><code>#define foo() bar\nfoo()baz\n     \u2192 bar baz\nnot\n     \u2192 barbaz\n</code></pre> </li> <li> <p>\u5316\u4e3a token \u7684\u8fc7\u7a0b\u4e2d\uff0c\u9884\u5904\u7406\u5668\u4f1a\u5c3d\u53ef\u80fd\u5730\u5c06\u5b57\u7b26\u5e8f\u5217\u89e3\u91ca\u4e3a\u5c3d\u53ef\u80fd\u5927\u7684 token\u3002</p> <p>\u5982\uff1a <code>a+++++b</code> \u4f1a\u88ab\u89e3\u91ca\u4e3a <code>a++ ++ +b</code>\uff0c\u800c\u4e0d\u662f\u88ab\u89e3\u91ca\u4e3a <code>a ++ + ++ b</code>\uff0c\u54ea\u6015\u540e\u9762\u8fd9\u4e2a\u53ef\u80fd\u624d\u662f\u5bf9\u7684\u3002\uff08\u522b\u8fd9\u4e48\u5199\u4ee3\u7801\uff09</p> </li> <li> <p>\u62c6\u5206\u4e3a token \u540e\uff0c\u5404\u4e2a token \u5e8f\u5217\u7684\u8fb9\u754c\u5c31\u4e0d\u4f1a\u518d\u53d8\u4e86\uff0c\u9664\u975e\u7528 <code>##</code> \u6765\u4e32\u8fde token\u3002</p> </li> <li> <p>\u7f16\u8bd1\u5668\u4e0d\u4f1a\u518d\u91cd\u65b0 token \u5316\u9884\u5904\u7406\u5668\u7684\u8f93\u51fa\uff0c\u6bcf\u4e2a\u9884\u5904\u7406\u5668\u90e8\u5206\u7684 token \u76f4\u63a5\u4e3a\u7f16\u8bd1\u5668\u8bcd\u6cd5\u5206\u6790\u7684\u8bcd\u6cd5\u5355\u5143\u3002</p> </li> <li> <p>\u9884\u5904\u7406\u7684 token \u5206\u4e3a\u4e94\u7c7b\uff1a\u6807\u8bc6\u7b26\u3001\u9884\u5904\u7406\u6570\u5b57\u3001\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u3001\u6807\u70b9\u7b26\u53f7\u548c\u5176\u4ed6\u3002</p> <p>\u8be6\u7ec6\u770b\uff1aTokenization (The C Preprocessor) (gnu.org)</p> <ul> <li>identifier \u6807\u8bc6\u7b26\uff1a\u8fd9\u4e2a\u548c C \u8bed\u8a00\u7684\u6807\u8bc6\u7b26\u5b9a\u4e49\u4e00\u81f4</li> <li>preprocessing number \u9884\u5904\u7406\u6570\u5b57\uff1a\u5305\u542b C \u6240\u6709\u7684\u6574\u6570\u548c\u6d6e\u70b9\u6570\uff0c\u53e6\u5916\u8fd8\u5305\u62ec\u4e00\u4e9b\u7279\u522b\u7684\u5185\u5bb9\uff0c</li> <li>String literals \u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff1a\u201chello world!\u201d</li> <li>character-constant \u5b57\u7b26\u5e38\u91cf\uff1a\u5c31\u662f'a', '\\n' </li> <li>punctuator \u6807\u70b9\u7b26\u53f7 + - -&gt; \uff1a\u540c C/C++</li> <li>\u9664\u4e86\u4e0a\u8fb9\u6240\u5217\u60c5\u51b5\u4ee5\u5916\u7684\u6240\u6709\u975e\u7a7a\u767d\u5b57\u7b26</li> </ul> </li> </ul>"},{"location":"ysyx/pa/c_marco/macro.html#3-the-preprocessing-language","title":"3. The Preprocessing Language","text":"<p>\u5b8c\u6210 token \u5316\u4e4b\u540e\uff0ctoken \u5e8f\u5217\u5c31\u4f1a\u88ab\u4f20\u9012\u7ed9\u7f16\u8bd1\u5668\u7684 parser\u3002</p> <p>\u4f46\u662f\u5982\u679c\u6211\u4eec\u8fd8\u7528\u4e86\u9884\u5904\u7406\u8bed\u8a00\u7684\u8bdd\uff0c\u90a3\u5728\u8fd9\u4e4b\u524d\u7684\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5c06\u5176\u8f6c\u5316\u4e3a\u5bf9\u5e94\u7684\u6e90\u6587\u4ef6\u4ee3\u7801\uff0c\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e00\u6b65\u9aa4\u624d\u662f\u5927\u591a\u6570\u4eba\u8ba4\u4e3a\u9884\u5904\u7406\u5668\u505a\u7684\u4e8b\u60c5\u3002</p> <p>\u9884\u5904\u7406\u8bed\u8a00\u4ee5 <code>#</code> \u5f00\u59cb\uff0c\u4e3b\u8981\u5305\u542b\uff1a\u6307\u4ee4\u3001\u6269\u5c55\u7684\u5b8f\u3002</p> <ul> <li> <p><code>#include</code> \u5934\u6587\u4ef6\uff0c\u5176\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u6587\u672c\u66ff\u6362\uff0c\u4f46\u5b9e\u9645\u4e0a\u4f60\u53ef\u4ee5 <code>include</code> \u5404\u79cd\u5404\u6837\u7684\u5185\u5bb9\u8fdb\u53bb\uff0c\u4e0d\u5355\u5355\u662f <code>.h</code>\u3002</p> </li> <li> <p>\u6761\u4ef6\u7f16\u8bd1\uff1a<code>#if</code> <code>#elif</code></p> </li> <li> <p>\u5b8f</p> <p>Macro expansion. You can define macros, which are abbreviations for arbitrary fragments of C code. The preprocessor will replace the macros with their definitions throughout the program. Some macros are automatically defined for you.</p> </li> </ul> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5e38\u73a9\u7684\u5b8f\u6ee5\u7528\u3001\u9ed1\u9b54\u6cd5\u5c31\u662f\u8fd9\u4e00\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u800c\u6211\u4eec\u4e4b\u540e\u5173\u6ce8\u7684\u4e5f\u5c31\u662f\u8fd9\u90e8\u5206\u5185\u5bb9\uff1aMacro expansion</p>"},{"location":"ysyx/pa/c_marco/macro.html#and","title":"<code>#</code> and <code>##</code>","text":"<p>\u6211\u8fd9\u91cc\u901a\u8fc7\u4e00\u4e9b\u8fd0\u7b97\u7b26\u7684\u5b9e\u4f8b\u6765\u5f15\u5165\u5173\u4e8e\u5b8f\u5c55\u5f00\u7684\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\u53ea\u770b\u5e38\u7528\u7684\u529f\u80fd\uff0c\u66f4\u591a\u5177\u4f53\u7684\u9650\u5236\u548c\u89c4\u5219\uff0c\u81ea\u884c\u67e5\u770b\u6807\u51c6\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#stringizing","title":"# \u5b57\u7b26\u4e32\u5316\u64cd\u4f5c\u7b26\uff08Stringizing\uff09","text":"<p>\u8fd0\u7b97\u7b26 # \u5728\u5b8f\u4e2d\u4f1a\u5c06\u5b9e\u53c2\u76f4\u63a5\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</p> <pre><code>// macro stringizing\n#define str_temp(x) #x\n//#define str(x) str_temp(x)\n\nputs(str_temp(abcde1234));\nresult: puts(\"abcde1234\");\n</code></pre> <p>\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8981\u5305\u4e00\u5c42\uff0c\u660e\u660e\u4e00\u5c42\u5c31\u80fd\u641e\u5b9a\u7684\u4e8b\u60c5\uff1f</p>"},{"location":"ysyx/pa/c_marco/macro.html#token-pasting","title":"## \u6807\u8bb0\u7c98\u8d34\u64cd\u4f5c\u7b26\uff08token-pasting\uff09","text":"<p>\u9884\u5904\u7406\u5668\u5728\u5904\u7406 <code>##</code> \u64cd\u4f5c\u7b26\u65f6\uff0c\u4f1a\u5c06\u524d\u540e\u7684\u6807\u8bb0\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u7684\u6807\u8bb0\uff0c\u4f46\u8fd9\u8981\u6c42\u8fd9\u4e24\u4e2a\u6807\u8bb0\u80fd\u591f\u5f62\u6210\u4e00\u4e2a\u6709\u6548\u7684C\u8bed\u8a00\u6807\u8bc6\u7b26\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u64cd\u4f5c\u7b26\u5728\u751f\u6210\u590d\u6742\u7684\u5b8f\u5b9a\u4e49\u65f6\u975e\u5e38\u6709\u7528\uff0c\u4f46\u662f\u6211\u4eec\u76ee\u524d\u6700\u5e38\u7528\u7684\u5c31\u662f\u62fc\u63a5\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4e5f\u66f4\u4e60\u60ef\u53eb\u62fc\u63a5\u7b26\u3002</p> <pre><code>// macro concatenation\n#define concat_temp(x, y) x ## y\n//#define concat(x, y) concat_temp(x, y)\n\n#define RISCV_32 \"test-RISCV32\"\n#define RISCV_64 \"test-RISCV64\"\n\nputs(concat_temp(RISCV_, 32));\nputs(concat_temp(RISCV_, 64));\nresult: \nputs(\"test-RISCV32\");\nputs(\"test-RISCV64\");\n</code></pre> <p>\u53c8\u5305\u4e00\u5c42\uff1f</p>"},{"location":"ysyx/pa/c_marco/macro.html#_1","title":"# \u548c ## \u7279\u6b8a\u60c5\u51b5","text":"<p>\u4e0a\u9762\u4f7f\u7528\u7684\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7b26\uff0c\u5e38\u5e38\u4f1a\u5c06\u529f\u80fd\u518d\u5305\u4e00\u5c42\uff0c\u518d\u5bf9\u5916\u7ed9\u51fa\u63a5\u53e3\u3002\u4f46\u662f\u660e\u660e\u4e00\u5c42\u5c31\u80fd\u505a\u7684\u4e8b\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u518d\u5305\u4e00\u5c42\uff1f</p> <p>\u6211\u4eec\u5177\u4f53\u770b\u51e0\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>#define concat_temp(x, y) x ## y\n//#define concat(x, y) concat_temp(x, y)\n\n#define RISCV_32 \"test-RISCV32\"\n//#define RISCV_ARCH \"no\"                                                                                                \n#define ARCH 32\n\nputs(concat_temp(RISCV_, ARCH));\nputs(concat_temp(RISCV_, 32));\n</code></pre> <p>\u5982\u4e0a\u573a\u666f\u548c\u8981\u6c42\uff0c\u6211\u4eec\u901a\u8fc7 <code>Makefile</code> \u5b9a\u4e49\u4e86\u4e00\u4e9b\u5173\u4e8eARCH \u7684\u5b8f\uff0c\u6211\u4eec\u60f3\u8981\u5f97\u5230\u6548\u679c\u662f <code>RISCV_32</code>\uff0c\u5373\u8f93\u51fa <code>test-RISCV32</code>\u3002</p> <p>\u4f46\u662f\u5b9e\u9645\u5c55\u5f00\u5374\u662f RISCV_ARCH\uff0c\u5e76\u6ca1\u6709\u8fbe\u5230\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u3002</p> <p></p> <p>\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u518d\u6539\u4e00\u6539\uff1a</p> <pre><code>// macro concatenation\n#define concat_temp(x, y) x ## y\n#define concat(x, y) concat_temp(x, y)\n\n#define RISCV_32 \"test-RISCV32\"\n//#define RISCV_ARCH \"no\"\n\n#define ARCH 32\nint main(void) { \n    puts(concat(RISCV_, ARCH));\n    puts(concat_temp(RISCV_, 64));               \n    return 0;\n}\n</code></pre> <p>\u6ca1\u6709\u62a5\u9519\uff0c\u6b63\u5e38\u8f93\u51fa\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c<code>#</code> \u548c <code>##</code> \u8fd0\u7b97\u7b26\u5728\u63a5\u6536\u5230\u53c2\u6570\u540e\u7acb\u523b\u5c06\u5176\u53d8\u4e3a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u53c2\u6570\u8fd8\u662f\u4e00\u4e2a\u5b8f\uff0c\u90a3\u8fd9\u4e2a\u5b8f\u5e76\u4e0d\u4f1a\u5c55\u5f00\uff0c\u800c\u662f\u76f4\u63a5\u5c06\u5176\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\uff0c\u5982\u56fe error\u3002</p> <p>\u6240\u4ee5\u95ee\u9898\u5728\u4e8e\u4f20\u5165\u7684\u53c2\u6570\u5b8f <code>ARCH</code> \u6ca1\u6709\u66ff\u6362\u5c55\u5f00\uff08\u4f20\u5165\u5b8f\u7684\u5b9e\u53c2\u53ea\u662f\u88ab\u5f53\u4f5c\u4e00\u4e2a\u7b26\u53f7\uff0c\u5e76\u4e0d\u4f1a\u88ab\u8bc6\u522b\u6210\u53d8\u91cf\u3001\u522b\u7684\u5b8f\u7b49\u5185\u5bb9\u5c55\u5f00\uff09\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u591a\u52a0\u4e00\u5c42\u4e2d\u95f4\u8f6c\u6362\u5b8f (<code>concat</code>)\uff0c\u8fd9\u4e00\u5c42\u5b8f\u7684\u4f5c\u7528\u5c31\u5728\u4e8e\u628a\u6240\u6709\u5b8f\u7684\u53c2\u6570\u5728\u8fd9\u91cc\u5168\u90e8\u66ff\u6362\uff0c\u8fd9\u6837\u5728\u5b9e\u9645\u529f\u80fd\u5b8f (<code>concat_temp</code>) \u4e2d\u5c31\u80fd\u5f97\u5230\u6b63\u786e\u7684\u5b8f\u53c2\u6570\u3002</p> <p>\u4f46\u662f\u8fd9\u4e00\u89e3\u51b3\u63aa\u65bd\u597d\u50cf\u5e76\u6ca1\u6709\u8bf4\u4e2d\u5b83\u5185\u90e8\u7684\u539f\u7406\uff1f\u9884\u5904\u7406\u5668\u7a76\u7adf\u662f\u600e\u4e48\u626b\u63cf\u8fd9\u4e2a\u5b8f\u7684\uff1f\u4ee5\u4ec0\u4e48\u65b9\u5f0f\uff1f\u9700\u8981\u77e5\u9053\u5b83\u7684\u5177\u4f53\u7b97\u6cd5\u662f\u4ec0\u4e48\u5417\uff1f</p>"},{"location":"ysyx/pa/c_marco/macro.html#macro-expansion","title":"Macro expansion","text":"<p>\u524d\u9762\u5bf9\u4e8e\u9884\u5904\u7406\u5668\u7684\u5404\u4e2a\u9636\u6bb5\uff0c\u5982\u679c\u4e0d\u662f\u4e13\u95e8\u505a\u8fd9\u65b9\u9762\u7684\u5185\u5bb9\uff0c\u7b80\u5355\u4e86\u89e3\u5373\u53ef\uff0c\u751a\u81f3\u4e8e\u8bf4\u76f4\u63a5\u770b\u7b2c\u56db\u6b65\u8fd9\u91cc\u5c31\u53ef\u4ee5\u4e86\u3002\u5b8f\u5c55\u5f00\u624d\u662f\u91cd\u70b9\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#introduction_1","title":"Introduction","text":"<p>A macro is a fragment of code which has been given a name. Whenever the name is used, it is replaced by the contents of the macro. </p> <p>There are two kinds of macros. They differ mostly in what they look like when they are used. Object-like macros resemble data objects when used, function-like macros resemble function calls.</p> <pre><code>#define &lt;identifier&gt; &lt;replacement token list&gt; new line                   // object-like macro\n#define &lt;identifier&gt;(&lt;parameter list(identifier list)&gt;) &lt;replacement token list&gt; new line // function-like macro, note parameters\n</code></pre> <p>\u6211\u4eec\u4e3b\u8981\u5173\u6ce8 func-like \u5b8f\u7684\u5c55\u5f00\u987a\u5e8f\uff0cobj-like \u5b8f\u7684\u4e5f\u662f\u7c7b\u4f3c\uff0c\u53ea\u662f\u5c11\u4e86\u66f4\u591a\u7684\u89c4\u5219\u3002</p> <p>\u4e0b\u9762\u662f\u5728 Wikipedia \u4e0a\u7ed9\u51fa\u7684\u987a\u5e8f\uff1b</p> <p>Order of expansion</p> <p>Function-like macro expansion occurs in the following stages:</p> <ol> <li>Stringification operations are replaced with the textual representation of their argument's replacement list (without performing expansion).</li> <li>Parameters are replaced with their replacement list (without performing expansion).</li> <li>Concatenation operations are replaced with the concatenated result of the two operands (without expanding the resulting token).</li> <li>Tokens originating from parameters are expanded.</li> <li>The resulting tokens are substituted as normal.</li> </ol> <p>This may produce surprising results:</p> <pre><code>#define HE HI\n#define LLO _THERE\n#define HELLO \"HI THERE\"\n\n#define CAT(a,b) a##b\n#define XCAT(a,b) CAT(a,b)\n#define CALL(fn) fn(HE,LLO)\n\nCAT(HE, LLO) // \"HI THERE\", because concatenation occurs before normal expansion\nXCAT(HE, LLO) // HI_THERE, because the tokens originating from parameters (\"HE\" and \"LLO\") are expanded first\nCALL(CAT) // \"HI THERE\", because this evaluates to CAT(a,b)\n</code></pre> <p>\u8fd9\u91cc\u6709\u4e9b\u6982\u5ff5\u9700\u8981\u533a\u5206\uff1a\u53c2\u6570\u66ff\u6362\u3001token \u5c55\u5f00\u3001\u5b8f\u5c55\u5f00\uff0c\u6211\u5728\u5b66\u4e60\u7684\u65f6\u5019\u6709\u65f6\u4f1a\u5f04\u6df7\u3002</p> <p>\u8fd9\u91cc\u4ee5\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u66f4\u597d\u3002</p> <pre><code>#define ADD(x, y) x + y\n</code></pre> <p>\u8c03\u7528\u8fd9\u4e2a\u5b8f\uff1a</p> <pre><code>ADD(a + b, c * d)\n</code></pre> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u5b8f\u540d\u5c55\u5f00\uff1a</p> <p><code>ADD</code> \u88ab\u5c55\u5f00\u4e3a <code>x + y</code>\u3002</p> </li> <li> <p>\u53c2\u6570\u66ff\u6362\uff1a</p> <ul> <li><code>x</code> \u88ab\u66ff\u6362\u4e3a <code>a + b</code>\u3002</li> <li><code>y</code> \u88ab\u66ff\u6362\u4e3a <code>c * d</code>\u3002</li> </ul> </li> <li> <p>\u5b8c\u5168\u5c55\u5f00\uff1a</p> <p><code>(a + b) + (c * d)</code></p> </li> <li> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u5b8f\u540d\u5c55\u5f00\u662f\u9884\u5904\u7406\u5668\u5c06\u5b8f\u540d\u66ff\u6362\u4e3a\u5b8f\u5b9a\u4e49\u7684\u8fc7\u7a0b\u3002</li> <li>\u53c2\u6570\u66ff\u6362\u662f\u9884\u5904\u7406\u5668\u5c06\u5b8f\u5b9a\u4e49\u4e2d\u7684\u53c2\u6570\u66ff\u6362\u4e3a\u5b8f\u8c03\u7528\u4e2d\u7684\u5177\u4f53\u503c\u6216\u8868\u8fbe\u5f0f\u7684\u8fc7\u7a0b\u3002</li> </ul> </li> </ol> <p>\u8fd9\u91cc\u5b9e\u5728\u662f\u96be\u5199\uff0c\u8fd8\u662f\u76f4\u63a5\u770b\u770b\u7f51\u4e0a\u7684\u5185\u5bb9\uff1a</p> <p>\u5148\u603b\u7ed3\u5b8f\u5c55\u5f00\u57fa\u672c\u6ce8\u610f\u70b9\u3002</p> <ul> <li>\u5b8f\u7684\u53c2\u6570\u5148\u5c55\u5f00</li> <li>\u53c2\u6570\u66ff\u6362\u540e\u91cd\u65b0\u626b\u63cf</li> <li>\u84dd\u8272\u96c6\u5408\u4e2d\u4e0d\u5c55\u5f00</li> <li>\u9047\u5230 <code>#</code>\u3001<code>##</code>  \u4e0d\u5c55\u5f00\uff08\u60f3\u8981\u5c55\u5f00\u518d\u6dfb\u4e00\u5c42\uff09</li> <li>\u6700\u540e\u7684\u62ec\u53f7\u68c0\u67e5</li> <li>\u5728\u5c55\u5f00\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c replacement list \u4e2d\u51fa\u73b0\u4e86 \u88ab\u5c55\u5f00\u5b8f\uff0c\u90a3\u4e48\u8be5\u88ab\u5c55\u5f00\u5b8f\u4e0d\u4f1a\u88ab\u5c55\u5f00\u3002</li> <li>\u66f4\u8fdb\u4e00\u6b65\u7684\uff0c\u5728\u5c55\u5f00\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4efb\u4f55\u5d4c\u5957\u7684\u5c55\u5f00\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u88ab\u5c55\u5f00\u5b8f\uff0c\u8be5\u88ab\u5c55\u5f00\u5b8f\u4e5f\u4e0d\u4f1a\u88ab\u5c55\u5f00\u3002</li> </ul>"},{"location":"ysyx/pa/c_marco/macro.html#_2","title":"\u9012\u5f52\u4e0e\u5b8f","text":"<p>\u540e\u6765\u66f4\u65b0\uff1a</p> <p>\u5199\u5b8c\u7684\u65f6\u5019\u53d1\u73b0\uff0c\u5728 ysyx \u7684\u5206\u4eab\u4f1a\u4e0a\uff0c\u6709\u4eba\u5206\u4eab\u8fc7\u7c7b\u4f3c\u7684\u5185\u5bb9\uff0c\u66f4\u52a0\u6df1\u5165\u4e14\u6709\u7406\u8bba\u5206\u6790\uff0c\u5165\u95e8\u4e86\u89e3\u4e4b\u540e\uff0c\u770b\u770b\u8fd9\u90e8\u5206\u89c6\u9891\u3002</p> <p>\u7b2c\u516d\u671f\u53cc\u5468\u5206\u4eab\u4f1a10\u670829\u65e5 \u5206\u4eab 35:01 \u5b8f\u4e0e\u9884\u5904\u7406\u5668</p> <p>\u7b2c\u516d\u671f\u53cc\u5468\u5206\u4eab\u4f1a10\u670815\u65e5 NEMU\u5206\u4eab1:00:10 \u201c\u5b8f\u201d\u7684\u5947\u6280\u6deb\u5de7</p> <p>\u8fd8\u662f\u5148\u542f\u52a8\u5427\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u5148\u653e\u4e00\u653e\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#variadic-macros","title":"\u53d8\u53c2\u5b8f\uff08Variadic Macros\uff09","text":"<p>C99 \u5141\u8bb8\u5728\u5b8f\u4e2d\u5b9a\u4e49\u53ef\u53d8\u957f\u5ea6\u7684\u53c2\u6570\u5217\u8868\u3002</p> <p>\u5176\u8bed\u6cd5\u7c7b\u4f3c\u4e8e\u53d8\u53c2\u51fd\u6570\u7684\u8bed\u6cd5\uff1a</p> <ul> <li> <p>\u5b9a\u4e49\u53d8\u53c2\u5b8f\u65f6\uff0c\u5728\u53c2\u6570\u5217\u8868\u7684\u6700\u540e\u4f7f\u7528\u4e09\u4e2a\u70b9 <code>...</code> \u6765\u8868\u793a\u8fd9\u4e2a\u5b8f\u53ef\u4ee5\u63a5\u53d7\u53ef\u53d8\u6570\u91cf\u7684\u53c2\u6570\u3002</p> </li> <li> <p>\u5bf9\u5e94\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>__VA_ARGS__</code> \u6765\u5f15\u7528\u6240\u6709\u4f20\u9012\u7ed9\u5b8f\u7684\u53c2\u6570 <code>...</code>\u3002<code>__VA_ARGS__</code> \u4f1a\u5c06\u6240\u6709\u4f20\u9012\u7684\u53c2\u6570\u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53\u3002</p> </li> <li> <p>When the macro is invoked, all the tokens in its argument list after the last named argument (this macro has none), including any commas, become the variable argument. </p> <p>This sequence of tokens replaces the identifier <code>__VA_ARGS__</code> in the macro body wherever it appears.</p> </li> </ul> <p>examples\uff1a</p> <ol> <li> <p>Simple version</p> <pre><code>eprintf (\"%s:%d: \", input_file, lineno)\n     \u2192  fprintf (stderr, \"%s:%d: \", input_file, lineno)\n</code></pre> </li> <li> <p>More complicated</p> <pre><code>#define PRINT_MESSAGES(...) printf(\"Messages: \" __VA_ARGS__ \"\\n\")\nPRINT_MESSAGES(\"Hello, \");\n     \u2192 printf(\"Messages: \" \"Hello, \" \"\\n\");\n</code></pre> <pre><code>#define eprintf(format, ...) fprintf (stderr, format, __VA_ARGS__)\n\nint a = 10;\neprintf(\"new: %d\\n\", a);\n     \u2192 fprintf(stderr, \"new: %d\\n\", a);\n</code></pre> <pre><code>#define eprintf(args...) fprintf (stderr, args)\n</code></pre> <p>\u6ce8\u610f\uff0c\u4f7f\u7528\u7b2c\u4e09\u79cd\u683c\u5f0f\uff1a\u547d\u540d\u53c2\u6570 + ... \uff0c\u5728\u540c\u4e00\u4e2a\u5b8f\u79cd\u5c31\u4e0d\u80fd\u518d\u4f7f\u7528 <code>__VA_ARGS__</code> \u5b8f\u53ca\u76f8\u5173\u6269\u5c55\u3002</p> </li> </ol>"},{"location":"ysyx/pa/c_marco/macro.html#__va_args__-bug","title":"<code>__VA_ARGS__</code> \u7684 bug","text":"<p>\u4e0a\u9762\u7684 <code>__VA_ARGS__</code> \u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a</p> <p>\u6765\u81ea <code>gcc</code> \u624b\u518c\uff1a</p> <p>This formulation(\u4e0a\u9762\u7684 <code>eprintf</code> ) looks more descriptive, but historically it was less flexible: you had to supply at least one argument after the format string. </p> <p>In standard C, you could not omit the comma separating the named argument from the variable arguments. (Note that this restriction has been lifted in C++20, and never existed in GNU C; see below.)</p> <p>\u4e5f\u5c31\u662f\u5728\u683c\u5f0f\u5b57\u7b26\u4e32 <code>format</code> \u81f3\u5c11\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\uff0c\u5426\u5219\u5c06\u4f1a\u51fa\u9519\u3002</p> <pre><code>eprintf(\"success!\\n\", );\n     \u2192 fprintf(stderr, \"success!\\n\", );\n</code></pre> <p>\u8fd9\u4e2a\u95ee\u9898\u5728 C++20 \u5df2\u7ecf\u4fee\u590d\u4e86\uff0c\u5e76\u4e14 GNU C++ \u5bf9\u8fd9\u4e2a\u95ee\u9898\u8fd8\u6709\u4e00\u4e9b\u6269\u5c55\u3002</p> <p>\u9996\u5148\uff1a\u5728GNU CPP\u4ee5\u53ca\u4eceC++20\u5f00\u59cb\u7684C++\u4e2d\uff0c\u5141\u8bb8\u5b8c\u5168\u7701\u7565\u53d8\u91cf\u53c2\u6570</p> <pre><code>eprintf (\"success!\\n\")\n     \u2192 fprintf(stderr, \"success!\\n\", )\n</code></pre> <p>\u5176\u6b21\uff0cC++20\u5f15\u5165\u4e86 <code>__VA_OPT__</code> \u51fd\u6570\u5b8f\u3002\u8be5\u5b8f\u53ea\u80fd\u7528\u4e8e\u53d8\u53c2\u5b8f\u7684\u5b9a\u4e49\u4e2d\uff1a</p> <ul> <li>\u53ea\u6709\u5f53\u53ef\u53d8\u53c2\u6570 <code>...</code> \u81f3\u5c11\u63a5\u6536\u4e86\u4e00\u4e2a\u53c2\u6570\u65f6\uff0c<code>__VA_OPT__()</code> \u5c55\u5f00\u4e3a\u5176\u53c2\u6570\u7684\u5185\u5bb9\uff1b</li> <li>\u5426\u5219\u8be5\u5b8f\u5c55\u5f00\u4e3a\u7a7a\u3002\u6240\u4ee5\uff0c<code>eprintf</code> \u6539\u4e3a\uff1a</li> </ul> <pre><code>#define eprintf(format, ...) \\\n  fprintf (stderr, format __VA_OPT__(,) __VA_ARGS__)\n</code></pre> <p>\u53e6\u5916\uff0c<code>__VA_OPT__</code> \u4e5f\u53ef\u4ee5\u5728 GNU C \u548c GNU \u9884\u5904\u7406\u5668 \u4f7f\u7528\uff0c\u800c\u4e14\uff0c<code>__VA_OPT__</code> \u4e5f\u5df2\u7ecf\u88ab C23 \u63a5\u6536\u4f7f\u7528\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6709\u4e00\u4e9b\u7f16\u8bd1\u5668\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\u4e5f\u505a\u4e86\u4e00\u4e9b\u5904\u7406\uff0c\u5982GCC\u3002 \u8fd9\u4e5f\u5c31\u662f\u7ecf\u5e38\u5728\u4e00\u4e9b\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u548c\u53d8\u53c2\u5b8f\u914d\u5408\u4f7f\u7528\u7684\u5730\u65b9\u5e38\u5e38\u770b\u5230\u7684\uff1a\u901a\u8fc7\u5728\u9017\u53f7 <code>,</code> \u548c <code>__VA_ARGS__</code> \u4e2d\u4f7f\u7528 <code>##</code> \u9884\u5904\u7406\u8fd0\u7b97\u7b26\u3002</p> <pre><code>#define eprintf(format, ...) fprintf (stderr, format, ##__VA_ARGS__)\n</code></pre> <p>\u4f7f\u7528 <code>eprintf</code> \u5b8f\u65f6\u7701\u7565\u53d8\u91cf\u53c2\u6570\uff08\u4f20\u5165\u7a7a\uff09\uff0c\u5219 <code>##</code> \u524d\u7684\u9017\u53f7\u5c06\u88ab\u5220\u9664\u3002\u5982\u679c\u4f20\u9012\u7a7a\u53c2\u6570\uff0c\u5219\u4e0d\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u201c##\u201d\u524d\u9762\u7684\u6807\u8bb0\u4e0d\u662f\u9017\u53f7\uff0c\u5219\u4e0d\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#genericc11","title":"Generic\uff08C11\uff09","text":""},{"location":"ysyx/pa/c_marco/macro.html#introduction_2","title":"Introduction","text":"<p>C11 \u5f15\u5165\u4e86\u6cdb\u578b\u7684\u6982\u5ff5\uff0c\u5141\u8bb8\u7f16\u5199\u4e0e\u7c7b\u578b\u65e0\u5173\u7684\u51fd\u6570\u548c\u7ed3\u6784\u4f53\uff0c\u4f7f\u4ee3\u7801\u66f4\u52a0\u7075\u6d3b\u548c\u53ef\u91cd\u7528\u3002\u5982\u679c\u4f7f\u7528\u8fc7\u522b\u7684\u66f4\u9ad8\u7ea7\u7684\u7f16\u7a0b\u8bed\u8a00\u7684\u8bdd\uff08\u5982 C++ \u7684\u6a21\u677f\uff09\uff0c\u5bf9\u8fd9\u4e2a\u6982\u5ff5\u5e94\u8be5\u6bd4\u8f83\u719f\u6089\u3002</p> <p>C11 \u5f15\u5165\u7684\u6cdb\u578b\u4e3b\u8981\u5305\u62ec _Generic \u5173\u952e\u5b57\u3001\u7c7b\u578b\u6cdb\u5316\u7684\u590d\u5408\u5b57\u9762\u91cf\u3001\u9759\u6001\u65ad\u8a00\uff08 <code>_Static_assert</code>\uff09\u3002</p> <p>\u7b14\u8bb0\u4e3b\u8981\u603b\u7ed3 _Generic \u5173\u952e\u5b57\u7684\u5185\u5bb9\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#_generic","title":"\u5173\u952e\u5b57 _Generic","text":"<p>C \u6807\u51c6\u59d4\u5458\u4f1a\u5f15\u5165 <code>_Generic</code> \u5173\u952e\u5b57\u7684\u76ee\u7684\u3001\u4ee5\u53ca <code>_Generic</code> \u6700\u5e7f\u6cdb\u7684\u4f5c\u7528\u4e4b\u4e00 \u5c31\u662f\u901a\u8fc7\u9009\u62e9\u4e0d\u540c\u7684\u51fd\u6570\u6307\u9488\uff0c\u5c06 <code>_Generic</code> \u7528\u4e8e\u6cdb\u578b\u5b8f\u63a5\u53e3\u3002</p> <p><code>_Generic</code> \u5173\u952e\u5b57\u672c\u8eab\u5e76\u4e0d\u5177\u5907\u5b8f\u7684\u7279\u5f81\uff0c\u4f46\u5176\u53ef\u4ee5\u65b9\u4fbf\u5730\u7528\u4e8e\u5b8f\u6269\u5c55\u3002</p> <p><code>_Generic</code> \u5173\u952e\u5b57\u5141\u8bb8\u7f16\u5199\u57fa\u4e8e\u7c7b\u578b\u7684\u7f16\u8bd1\u65f6\u51b3\u7b56\u3002</p> <p>\u5b83\u6839\u636e\u7ed9\u5b9a\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\uff0c\u4ece\u63d0\u4f9b\u7684\u9009\u9879\u4e2d\u9009\u62e9\u4e00\u4e2a\u8868\u8fbe\u5f0f\u8fdb\u884c\u7f16\u8bd1\u3002</p> <pre><code>_Generic (controlling expression,\n          type1: expression1,\n          ... ,\n          typeN: expressionN\n          default: expression)\n</code></pre> <ul> <li><code>type</code> \u662f\u8981\u68c0\u67e5\u7684\u8868\u8fbe\u5f0f\u3002</li> <li><code>type1</code>, <code>type2</code>, ... \u662f\u7c7b\u578b\u540d\u79f0\u3002</li> <li><code>exprssion1</code>, <code>expression2</code>, ... \u662f\u4e0e\u6bcf\u79cd\u7c7b\u578b\u76f8\u5173\u8054\u7684\u8868\u8fbe\u5f0f\u3002</li> <li><code>default</code> \u662f\u5176\u4ed6\u6240\u6709\u7c7b\u578b\u90fd\u4e0d\u5339\u914d\u65f6\u4f7f\u7528\u7684\u9ed8\u8ba4\u8868\u8fbe\u5f0f\u3002</li> </ul> <p>\u6ce8\u610f\uff1a</p> <ul> <li><code>_Generic</code> \u5f88\u50cf <code>switch case</code>\uff0c\u4f46\u662f <code>_Generic</code> \u7684\u8868\u8fbe\u5f0f\u5224\u65ad\u4ec5\u7528\u4e8e\u5bf9 <code>controlling expression</code> \u7684\u7c7b\u578b\u8fdb\u884c\u5224\u65ad\u3002</li> <li>\u53e6\u5916\uff0c<code>_Generic</code> \u5173\u952e\u5b57\u867d\u7136\u914d\u5408\u5b8f\u4f7f\u7528\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u5728\u9884\u5904\u7406\u9636\u6bb5\u5c55\u5f00\u5b83\u7684\u7ed3\u679c\uff0c\u800c\u662f\u5728\u7f16\u8bd1\u9636\u6bb5\u8fdb\u884c\u7c7b\u578b\u5224\u65ad\u7684\u3002</li> </ul> <p>\u8fd9\u91cc\u603b\u7ed3\u4e24\u4e2a\u4f8b\u5b50\uff0c\u4e3b\u8981\u90fd\u662f\u5b9e\u73b0\u6cdb\u578b\u7f16\u7a0b\u7684\u3002</p> <ol> <li> <p>\u51fd\u6570\u91cd\u8f7d</p> <pre><code>static inline double min( double a, double b) {\n    printf(\"default.\\n\");\n    return a &lt; b ? a : b;\n}\n\nstatic inline long double minl ( long double a, long double b) {\n    printf(\"minl.\\n\");\n    return a &lt; b ? a : b;\n}\n\nstatic inline float minf ( float a, float b) {\n    printf(\"minf.\\n\");\n    return a &lt; b ? a : b;\n}\n\n/**\n** @brief Type - generic minimum for floating - point values\n**/\n# define min(A, B) \\\n    _Generic ((A)+(B), \\\n    float : minf , \\\n    long double : minl , \\\n    default : min)((A), (B))\n\nint main() {\n    float a1 = 2.1;\n    float a2 = 123.21;\n    //long double a2 = 123.21;\n\n    if (min(a1, a2) == a1) {\n        printf(\"dsfsdf\\n\");\n    }\n\n    return 0;\n}\n</code></pre> <p>\u5982\u4e0a\u4f8b\u5b50\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u6700\u5c0f\u503c\uff08\u4e24\u4e2a\u6570\uff09\u7684\u6cdb\u578b\u63a5\u53e3\u3002</p> <p>\u8fd9\u6837\u505a\u7684\u597d\u5904\uff1a\u5bf9\u4e8e\u4e09\u5143\u8fd0\u7b97\u7b26 <code>a ? b : c</code> \u7a76\u7adf\u8981\u505a\u51fa\u54ea\u4e2a\u9009\u62e9\uff0c\u90a3\u5c31\u8981\u770b\u8fd0\u884c\u65f6 <code>a</code> \u7684\u503c\u662f\u591a\u5c11\uff0c\u5e76\u4e14\u6bcf\u6b21\u8fd0\u884c <code>a</code> \u7684\u503c\u53ef\u80fd\u90fd\u4f1a\u4e0d\u540c\u3002\u800c\u4f7f\u7528 <code>_Generic</code> \u57fa\u4e8e\u7c7b\u578b\u6765\u5224\u65ad\u7684\u8bdd \u5c31\u8ba9\u4e09\u5143\u8fd0\u7b97\u7b26\u7684\u9009\u62e9\u63a8\u524d\u5230\u4e86\u7f16\u8bd1\u9636\u6bb5\u3002\u8fd9\u6837\u7f16\u8bd1\u5668\u4e5f\u5c31\u80fd\u6839\u636e\u76f8\u5e94\u7684\u7c7b\u578b\u7ed3\u679c\u6765\u505a\u51fa\u5bf9\u5e94\u7684\u4f18\u5316\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u4f7f\u7528\u4e0a\u8ff0\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4e3a\u53d8\u91cf\u9009\u62e9\u5408\u9002\u7684\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0 \u660e\u660e\u4f7f\u7528 int \u5c31\u591f\u4e86\uff0c\u4f46\u8fd8\u7528 long \u7684\u60c5\u51b5\u3002</p> <pre><code>define min(A, B) \\\n _Generic ((A)+(B), \\\n float : minf , \\\n long double : minl , \\\n default : min)((A), (B))\n</code></pre> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684 \u5b8f\u540d\u5b57 min \u548c \u9ed8\u8ba4\u7684\u51fd\u6570\u540d min \u540c\u540d\uff0c\u8fd9\u6837\u5b50\u4e0d\u4f1a\u5bfc\u81f4\u9884\u5904\u7406\u5668\u65e0\u9650\u5c55\u5f00\u5417\uff1f</p> <p>\u8fd9\u91cc\u9700\u8981\u660e\u767d\u4e00\u70b9\uff1a\u9884\u5904\u7406\u5668\u5e76\u4e0d\u4f1a\u6269\u5c55\u81ea\u5f15\u7528\u5b8f\uff0c\u9632\u6b62\u65e0\u9650\u5c55\u5f00\u3002</p> <p>\u4e66\u4e0a\u7684\u4f8b\u5b50\uff1a</p> <p>Also for the above example, a keen observer might notice that the name of the macro <code>cbrt</code> is the same as the default function <code>cbrt</code> and wonder why that doesn\u2019t cause an infinite preprocessor macro expansion loop. It doesn\u2019t because the preprocessor will not expand a macro that references itself. Hence, if the resulting expression of <code>_Generic</code> is <code>cbrt</code>, that will not be expanded again.</p> </li> <li> <p>\u7c7b\u578b\u81ea\u52a8\u5339\u914d</p> <p>\u7f51\u4e0a\u7684\u4f8b\u5b50</p> <pre><code>#include&lt;stdio.h&gt;\n#define GET_TYPENAME(var) _Generic((var), \\\n    int:\"int\",\\\n    char:\"char\", \\\n    float:\"float\", \\\n    double:\"double\", \\\n    char *:\"char *\",   \\\n    default: \"other type\")\n\n#define GET_FORMAT(signal) _Generic((signal),\\\n                                    int:\"%d\\n\", \\\n                                    char:\"%c\\n\", \\\n                                    char *:\"%s\\n\",\\\n                                    default:\"%f\\n\")\nint main(int argc, char** argv ) {\n    int x1;\n    int* x2;\n    char x3[20] = \"hello world!\";\n    x1 = 666666;\n\n    // \u8303\u4f8b1\n    printf(GET_FORMAT(x1), x1);\n    printf(GET_FORMAT(x3), x3);\n\n    // \u8303\u4f8b2\n    printf(\"type: x1 = %s\\n\", GET_TYPENAME(x1));\n    printf(\"type: x2 = %s\\n\", GET_TYPENAME(x2));\n    printf(\"type: x3 = %s\\n\", GET_TYPENAME(x3));\n\n    // \u8303\u4f8b3\n    // \u6cdb\u578b\u4e2d\u7684\u503c\u4f1a\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\uff1f\n    // \u7b54\u6848\uff1a\u4e0d\u4f1a\n    int k = 1;\n    GET_TYPENAME(k++);\n    GET_TYPENAME(++k);\n    GET_TYPENAME(k*=2);\n    GET_TYPENAME(k=4);\n    printf(\"k = %d\\n\", k);\n    return 0;\n}\n</code></pre> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define PI 3.14\n\n#define BUFSIZE 256\n#define PTR_TYPE(X) _Generic((X),\\\n    int: \"%d\", float : \"%f\", double: \"%f\", \\\n    char: \"%c\", char*: \"%s\", void *: \"%p\", default: \"%p\")\n#define printv(var) do {                                                     \\\n    char __print_buf[BUFSIZE], __format_buf[BUFSIZE] = \"val of \" #var \": \";  \\\n    sprintf(__print_buf, strcat(__format_buf, PTR_TYPE(var)), var);          \\\n    puts(__print_buf);                                                       \\\n} while(0)\n\nint main() {\n    int num = 10;\n    double sin10 = sin(PI / 9);\n    char ch = '6';\n    char* greeting = \"Hello\";\n    void* data = malloc(num);\n\n    printv(num);        // val of num: 10\n    printv(sin10);      // val of sin10: 0.342020\n    printv(ch);         // val of ch: 6\n    printv(greeting);   // val of greeting: Hello\n    printv(data);       // val of data: 00000000009B2430\n\n    free(data);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u6a21\u62df\u6a21\u677f</p> <p>\u3010C\u3011\u5229\u7528 _Generic \u91cd\u8f7d \u53c2\u6570\u6570\u76ee\u4e0d\u540c\u7684\u51fd\u6570 - realHarvey - \u535a\u5ba2\u56ed (cnblogs.com)</p> </li> </ol> <p>\u867d\u7136\u8bf4\u80fd\u501f\u52a9\u5b8f\u6a21\u62df\u6cdb\u578b\uff0c\u4f46\u662f\u8fd9\u6837\u5b50 debug \u662f\u4e0d\u662f\u4f1a\u6bd4\u8f83\u56f0\u96be\uff1f\u800c\u4e14\u672c\u8d28\u4e0a\u8fd9\u5e76\u6ca1\u6709\u51cf\u5c11\u4ee3\u7801\u91cf\u3002\u5982\u679c\u9047\u5230\u66f4\u52a0\u590d\u6742\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u505a\u8d77\u6765\u5e94\u8be5\u5f88\u590d\u6742\u7e41\u7410\uff1f\u770b\u770b\u4ed6\u4eba\u7684\u6700\u4f73\u5b9e\u8df5/\u4f8b\u5b50\uff1f</p> <p>\u6570\u7ec4\u7c7b\u578b\u8f6c\u4e3a <code>void*</code>\uff0c\u80fd\u6bd4\u8f83\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u7ec4\u4e86\uff0c\u8fd9\u600e\u4e48\u7528\u4e0a\u9762\u7684 <code>_Generic</code> \u5462\uff1f</p> <pre><code> qsort(void *Base,                                      // \u6570\u7ec4\u5730\u5740\n       size_t NumOfElements,                            // \u5143\u7d20\u6570\u91cf\n       size_t SizeOfElements,                           // \u5143\u7d20\u5927\u5c0f\n       int (*PtFuncCompare)(const void *, const void *) // \u6bd4\u8f83\u51fd\u6570\n );\n</code></pre> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// \u5b9a\u4e49\u6bd4\u8f83\u51fd\u6570\nint compare_int(const void *a, const void *b) {\n const int *ia = (const int *)a;\n const int *ib = (const int *)b;\n return *ia - *ib;\n}\n\nint compare_float(const void *a, const void *b) {\n const float *fa = (const float *)a;\n const float *fb = (const float *)b;\n return *fa &lt; *fb ? -1 : (*fa &gt; *fb);\n}\n\n// \u5b9a\u4e49\u4e00\u4e2a\u6cdb\u578b\u6bd4\u8f83\u5b8f\n#define compare(A, B) _Generic((A), \\\n int*: compare_int, \\\n float*: compare_float, \\\n default: ((void)(A), (void)(B), 0))((A), (B))\n\nint main() {\n int intArray[] = {3, 1, 4, 1, 5};\n float floatArray[] = {2.1f, 3.1f, 1.1f, 4.1f};\n\n qsort(intArray, sizeof(intArray) / sizeof(intArray[0]), sizeof(intArray[0]), compare);\n qsort(floatArray, sizeof(floatArray) / sizeof(floatArray[0]), sizeof(floatArray[0]), compare);\n\n // \u6253\u5370\u6392\u5e8f\u540e\u7684\u6570\u7ec4\n for (size_t i = 0; i &lt; sizeof(intArray) / sizeof(intArray[0]); i++) {\n     printf(\"%d \", intArray[i]);\n }\n printf(\"\\n\");\n\n for (size_t i = 0; i &lt; sizeof(floatArray) / sizeof(floatArray[0]); i++) {\n     printf(\"%f \", floatArray[i]);\n }\n printf(\"\\n\");\n\n return 0;\n}\n</code></pre> <p>more example\uff1a</p> <p>_Generic in C - DEV Community</p>"},{"location":"ysyx/pa/c_marco/macro.html#x-macro","title":"X-Macro","text":""},{"location":"ysyx/pa/c_marco/macro.html#introduction_3","title":"introduction","text":"<p>\u505a AM keyboard \u90e8\u5206\u7684\u65f6\u5019\u9047\u5230\u4e00\u4e9b\u770b\u8d77\u6765\u6bd4\u8f83\u5389\u5bb3\u7684\u5b8f\u6280\u5de7\uff0c\u751f\u6210\u4e86\u5927\u91cf\u7684\u952e\u76d8\u679a\u4e3e\u503c\u3002\u4e86\u89e3\u540e\u53d1\u73b0\u662f\u4e00\u79cd\u53eb X macro \u7684\u6280\u5de7\u3002</p> <p>X macros are an idiomatic usage of programming language macros for generating list-like structures of data or code. They are most useful when at least some of the lists cannot be composed by indexing, such as compile time. They provide reliable maintenance of parallel lists whose corresponding items must be declared or executed in the same order.</p> <p>Examples of such lists particularly include initialization of arrays, in concert with declarations of enumeration constants and function prototypes; generation of statement sequences and switch arms; etc.</p> <p>Usage of X macros dates back to the 1960s.[1] It remains useful in modern-day C and C++ programming languages, but remains relatively unknown.[2] [3]</p> <p>X macro - Wikipedia</p> <p>\u5982\u679c\u6ca1\u6709\u5b66\u4e60\u8fc7python\u7b49\u9ad8\u7ea7\u8bed\u8a00\u7684\u8bdd\uff0c\u7b2c\u4e00\u6b21\u542c\u5230\u5217\u8868\u72b6\u7ed3\u6784\u65f6\u53ef\u80fd\u4f1a\u6709\u70b9\u61f5\u3002\"\u5217\u8868\u72b6\u7ed3\u6784\u7684\u6570\u636e\u548c\u4ee3\u7801\"\uff08list-like structures of data or code\uff09\u662f\u6307\u90a3\u4e9b\u4ee5\u5217\u8868\u5f62\u5f0f\u7ec4\u7ec7\u7684\u6570\u636e\u7ed3\u6784\u6216\u4ee3\u7801\u5757\uff0c\u5b83\u4eec\u9700\u8981\u4ee5\u4e00\u5b9a\u5bf9\u987a\u5e8f\u88ab\u58f0\u660e\u6216\u6267\u884c\uff0c\u8fd9\u4e2a\u7ed3\u6784\u901a\u5e38\u5305\u542b\u4e00\u7cfb\u5217\u5143\u7d20\uff0c\u8fd9\u4e9b\u5143\u7d20\u53ef\u4ee5\u662f\u6570\u636e\u9879\u3001\u4ee3\u7801\u6307\u4ee4\u6216\u5176\u4ed6\u4efb\u4f55\u53ef\u4ee5\u5e8f\u5217\u5316\u7684\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u770bpython\u7684\u5185\u5bb9\uff1a</p> <p>\u521b\u5efa\u4e00\u4e2a\u5217\u8868\uff0c\u53ea\u8981\u628a\u9017\u53f7\u5206\u9694\u7684\u4e0d\u540c\u7684\u6570\u636e\u9879\u4f7f\u7528\u65b9\u62ec\u53f7\u62ec\u8d77\u6765\u5373\u53ef\uff1a</p> <pre><code>list1 = ['physics', 'chemistry', 1997, 2000]\nlist2 = [1, 2, 3, 4, 5 ]\nlist3 = [\"a\", \"b\", \"c\", \"d\"]\n</code></pre> <p>Python\u5217\u8868\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u5373\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u7d22\u5f15\u8bbf\u95ee\u4efb\u4f55\u5143\u7d20\u3002</p> <p>\u5bf9\u4e8e X-Macro \u7684\u5e94\u7528\u7ec4\u6210\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\uff1a</p> <ol> <li>The definition of the list's elements.</li> <li>Expansion(s) of the list to generate fragments of declarations or statements.</li> </ol> <p>The list is defined by a macro or header file (named, <code>LIST</code>) which generates no code by itself, but merely consists of a sequence of invocations of a macro (classically named \"<code>X</code>\") with the elements' data. Each expansion of <code>LIST</code> is preceded by a definition of <code>X</code> with the syntax for a list element. The invocation of <code>LIST</code> expands <code>X</code> for each element in the list.</p> <p>\u8fd9\u91cc\u76f4\u63a5\u4ee5\u4e00\u4e9b\u5b9e\u9645\u4f8b\u5b50\u6765\u770b\u770b\u4e0a\u9762\u7684\u7ec4\u6210\u3002</p> <ol> <li> <p>\u521d\u59cb\u5316\u6570\u7ec4</p> <p>\u6570\u636e\u9879\uff1a\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u503c\u3002</p> <p>\u4ee3\u7801\u6307\u4ee4\uff1a\u5b9a\u4e49\u6570\u7ec4\u548c\u521d\u59cb\u5316\u6570\u7ec4\u7684\u64cd\u4f5c\u3002</p> <pre><code>c#define COLORS \\\n    X(RED, \"red\"), \\\n    X(GREEN, \"green\"), \\\n    X(BLUE, \"blue\")\n\n#define X(value, str) { #value, str }\n\ntypedef struct {\n    const char *name;\n    const char *color;\n} Color;\n\nColor colors[] = {\n    COLORS\n};\n</code></pre> <ul> <li><code>RED</code>, <code>GREEN</code>, <code>BLUE</code> \u662f\u6570\u636e\u9879\uff0c\u5b83\u4eec\u662f\u679a\u4e3e\u503c\u3002</li> <li><code>\"red\"</code>, <code>\"green\"</code>, <code>\"blue\"</code> \u4e5f\u662f\u6570\u636e\u9879\uff0c\u5b83\u4eec\u662f\u5b57\u7b26\u4e32\u3002</li> <li><code>X(RED, \"red\")</code>, <code>X(GREEN, \"green\")</code>, <code>X(BLUE, \"blue\")</code> \u662f\u4ee3\u7801\u6307\u4ee4\uff0c\u5b83\u4eec\u5b9a\u4e49\u4e86\u6570\u7ec4\u7684\u521d\u59cb\u5316\u3002</li> </ul> </li> <li> <p>\u5b9a\u4e49\u679a\u4e3e\u5e38\u91cf\u548c\u51fd\u6570\u539f\u578b</p> <p>\u6570\u636e\u9879\uff1a\u679a\u4e3e\u5e38\u91cf\u7684\u503c\u3002</p> <p>\u4ee3\u7801\u6307\u4ee4\uff1a\u5b9a\u4e49\u679a\u4e3e\u548c\u51fd\u6570\u539f\u578b\u7684\u64cd\u4f5c\u3002</p> <pre><code>// \u5b9a\u4e49\u679a\u4e3e\u5e38\u91cf\n#define COMMANDS(_) \\\n    _(OPEN, open_file), \\\n    _(CLOSE, close_file), \\\n    _(READ, read_file), \\\n    _(COUNT, NULL) // \u6dfb\u52a0\u4e00\u4e2a\u8ba1\u6570\u9879\uff0c\u7528\u4e8e\u6570\u7ec4\u5927\u5c0f\n\n// \u5b9a\u4e49\u679a\u4e3e\u7c7b\u578b\n#define X(cmd, func) cmd\nenum Command { COMMANDS(X) };\n\n// \u5b9a\u4e49\u51fd\u6570\u539f\u578b\nvoid open_file(void);\nvoid close_file(void);\nvoid read_file(void);\n\n// \u5b9a\u4e49\u51fd\u6570\u6307\u9488\u6570\u7ec4\n#define Y(cmd, func) func\nvoid (*command_functions[])(void) = {\n    COMMANDS(Y)\n};\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li><code>OPEN</code>, <code>CLOSE</code>, <code>READ</code> \u662f\u6570\u636e\u9879\uff0c\u5b83\u4eec\u662f\u679a\u4e3e\u503c\u3002</li> <li><code>open_file</code>, <code>close_file</code>, <code>read_file</code> \u662f\u4ee3\u7801\u6307\u4ee4\uff0c\u5b83\u4eec\u662f\u51fd\u6570\u539f\u578b\u3002</li> </ul> </li> <li> <p>\u751f\u6210\u4ee3\u7801\u5757</p> <p>\u6570\u636e\u9879\uff1a\u4ee3\u7801\u5757\u4e2d\u7684\u5177\u4f53\u64cd\u4f5c\u6216\u503c\u3002</p> <p>\u4ee3\u7801\u6307\u4ee4\uff1a\u751f\u6210\u4ee3\u7801\u5757\u7684\u64cd\u4f5c\u3002</p> <pre><code>c#define CALCULATIONS \\\n    X(1, add, 5), \\\n    X(2, subtract, 3), \\\n    X(3, multiply, 2)\n\n#define X(id, operation, value) void operation_##id(int *result) { *result operation value; }\n\nX(1, add, 5)\nX(2, subtract, 3)\nX(3, multiply, 2)\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li><code>1</code>, <code>2</code>, <code>3</code> \u662f\u6570\u636e\u9879\uff0c\u5b83\u4eec\u662f\u51fd\u6570\u7684\u6807\u8bc6\u7b26\u3002</li> <li><code>add</code>, <code>subtract</code>, <code>multiply</code> \u662f\u4ee3\u7801\u6307\u4ee4\uff0c\u5b83\u4eec\u662f\u64cd\u4f5c\u7684\u540d\u79f0\u3002</li> <li><code>5</code>, <code>3</code>, <code>2</code> \u662f\u6570\u636e\u9879\uff0c\u5b83\u4eec\u662f\u64cd\u4f5c\u7684\u53c2\u6570\u3002</li> </ul> </li> </ol> <p>\u521d\u6b65\u5370\u8c61\u4e4b\u540e\uff0c\u518d\u6765\u770b\u770b PA2 \u5b9e\u73b0\u7684\u952e\u76d8\u5217\u8868\uff1a</p> <pre><code>#define AM_KEYS(_) \\\n    _(ESCAPE) _(F1) _(F2) _(F3) _(F4) _(F5) _(F6) _(F7) _(F8) _(F9) _(F10) _(F11) _(F12) \\\n    _(GRAVE) _(1) _(2) _(3) _(4) _(5) _(6) _(7) _(8) _(9) _(0) _(MINUS) _(EQUALS) _(BACKSPACE) \\\n    _(TAB) _(Q) _(W) _(E) _(R) _(T) _(Y) _(U) _(I) _(O) _(P) _(LEFTBRACKET) _(RIGHTBRACKET) _(BACKSLASH) \\\n    _(CAPSLOCK) _(A) _(S) _(D) _(F) _(G) _(H) _(J) _(K) _(L) _(SEMICOLON) _(APOSTROPHE) _(RETURN) \\\n    _(LSHIFT) _(Z) _(X) _(C) _(V) _(B) _(N) _(M) _(COMMA) _(PERIOD) _(SLASH) _(RSHIFT) \\\n    _(LCTRL) _(APPLICATION) _(LALT) _(SPACE) _(RALT) _(RCTRL) \\\n    _(UP) _(DOWN) _(LEFT) _(RIGHT) _(INSERT) _(DELETE) _(HOME) _(END) _(PAGEUP) _(PAGEDOWN)\n\n#define AM_KEY_NAMES(key) AM_KEY_##key,\nenum {\n    AM_KEY_NONE = 0,\n    AM_KEYS(AM_KEY_NAMES)\n};\n</code></pre> <ol> <li><code>AM_KEYS</code> \u5b8f\uff1a\u6309\u952e\u5217\u8868<ul> <li>\u5b9a\u4e49\u4e00\u4e2a\u957f\u5217\u8868\u7684\u952e\u76d8\u6309\u952e\u540d\u3002\u6bcf\u4e2a\u6309\u952e\u540d\u90fd\u662f\u901a\u8fc7\u4f20\u9012\u7ed9\u5b8f\u7684\u53c2\u6570 <code>_</code> \u6765\u751f\u6210\u7684\u3002\u8fd9\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u5360\u4f4d\u7b26\uff0c\u7528\u4e8e\u5728\u5b8f\u5c55\u5f00\u65f6\u88ab\u66ff\u6362\u3002</li> </ul> </li> <li><code>AM_KEY_NAMES</code> \u5b8f\uff1a\u6309\u952e\u540d\u5b8f<ul> <li>\u8fd9\u4e2a\u5b8f\u7528\u4e8e\u751f\u6210\u6bcf\u4e2a\u6309\u952e\u540d\u5bf9\u5e94\u7684\u679a\u4e3e\u503c\u3002\u5b83\u4f7f\u7528\u6807\u8bb0\u7c98\u8d34\u64cd\u4f5c\u7b26\uff08<code>##</code>\uff09\u5c06 <code>AM_KEY_</code> \u524d\u7f00\u548c\u6309\u952e\u540d\u8fde\u63a5\u8d77\u6765\u3002</li> </ul> </li> <li>\u679a\u4e3e\u5b9a\u4e49\uff1a<ul> <li>\u4f7f\u7528 <code>AM_KEYS</code> \u5b8f\u548c <code>AM_KEY_NAMES</code> \u5b8f\u6765\u5b9a\u4e49\u4e00\u4e2a\u679a\u4e3e\u7c7b\u578b\uff0c\u5176\u4e2d\u5305\u542b\u6240\u6709\u952e\u76d8\u6309\u952e\u7684\u679a\u4e3e\u503c\u3002</li> </ul> </li> </ol> <p>\u5c55\u5f00\uff1a</p> <pre><code>enum {\n    AM_KEY_NONE = 0,\n    AM_KEY_ESCAPE, AM_KEY_F1, AM_KEY_F2, AM_KEY_F3, AM_KEY_F4, AM_KEY_F5, AM_KEY_F6, AM_KEY_F7, AM_KEY_F8, AM_KEY_F9, AM_KEY_F10, AM_KEY_F11, AM_KEY_F12, AM_KEY_GRAVE, AM_KEY_1, AM_KEY_2, AM_KEY_3, AM_KEY_4, AM_KEY_5, AM_KEY_6, AM_KEY_7, AM_KEY_8, AM_KEY_9, AM_KEY_0, AM_KEY_MINUS, AM_KEY_EQUALS, AM_KEY_BACKSPACE, AM_KEY_TAB, AM_KEY_Q, AM_KEY_W, AM_KEY_E, AM_KEY_R, AM_KEY_T, AM_KEY_Y, AM_KEY_U, AM_KEY_I, AM_KEY_O, AM_KEY_P, AM_KEY_LEFTBRACKET, AM_KEY_RIGHTBRACKET, AM_KEY_BACKSLASH, AM_KEY_CAPSLOCK, AM_KEY_A, AM_KEY_S, AM_KEY_D, AM_KEY_F, AM_KEY_G, AM_KEY_H, AM_KEY_J, AM_KEY_K, AM_KEY_L, AM_KEY_SEMICOLON, AM_KEY_APOSTROPHE, AM_KEY_RETURN, AM_KEY_LSHIFT, AM_KEY_Z, AM_KEY_X, AM_KEY_C, AM_KEY_V, AM_KEY_B, AM_KEY_N, AM_KEY_M, AM_KEY_COMMA, AM_KEY_PERIOD, AM_KEY_SLASH, AM_KEY_RSHIFT, AM_KEY_LCTRL, AM_KEY_APPLICATION, AM_KEY_LALT, AM_KEY_SPACE, AM_KEY_RALT, AM_KEY_RCTRL, AM_KEY_UP, AM_KEY_DOWN, AM_KEY_LEFT, AM_KEY_RIGHT, AM_KEY_INSERT, AM_KEY_DELETE, AM_KEY_HOME, AM_KEY_END, AM_KEY_PAGEUP, AM_KEY_PAGEDOWN,\n};\n</code></pre>"},{"location":"ysyx/pa/c_marco/macro.html#application","title":"application","text":"<p>\u6211\u5728\u5199 strace \u7684\u65f6\u5019\u4e5f\u4f7f\u7528\u4e86\u8fd9\u79cd\u6280\u5de7</p> <pre><code>const char *syscall_name[] = {\n    SYSCALLS(SYSCALL_STRINGS_NAMES)\n};\n// src/syscall.c\n\n// use X macro like AM KEY(abstract-machine/am/include/amdev.h)\n#define SYSCALLS(_) \\\n    _(exit),       \\\n    _(yield),      \\\n    _(open),       \\\n    _(read),       \\\n    _(write),      \\\n    _(kill),       \\\n    _(getpid),     \\\n    _(close),      \\\n    _(lseek),      \\\n    _(brk),        \\\n    _(fstat),      \\\n    _(time),       \\\n    _(signal),     \\\n    _(execve),     \\\n    _(fork),       \\\n    _(link),       \\\n    _(unlink),     \\\n    _(wait),       \\\n    _(times),      \\\n    _(gettimeofday) \\\n\n#define SYSCALL_NAMES(name) SYS_##name\n#define SYSCALL_STRINGS_NAMES(name) [SYS_##name] = #name\n\nenum {\n    SYSCALLS(SYSCALL_NAMES)\n};\n\n#endif\n\n//src/syscall.h\n</code></pre> <p>\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u79cd\u5b8f\u6280\u5de7\u975e\u5e38\u5f3a\u5927\uff0c\u901a\u8fc7\u7b80\u5355\u7684\u5b8f\u5b9a\u4e49\u6211\u4eec\u5c31\u80fd\u751f\u6210\u5927\u91cf\u7684\u679a\u4e3e\u503c\u3001\u51fd\u6570\u58f0\u660e\u3001\u5b8c\u6210\u6570\u7ec4\u521d\u59cb\u5316\u3002\u8fd9\u6837\u611f\u89c9\u53ef\u7ef4\u62a4\u6027\u9ad8\u70b9\uff0c\u76f8\u5bf9\u4e0d\u5bb9\u6613\u51fa\u9519\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#_3","title":"\u6253\u5370\u989c\u8272\u914d\u5408\u5b8f","text":""},{"location":"ysyx/pa/c_marco/macro.html#_4","title":"\u5b8f\u6a21\u62df\u51fd\u6570\u5f0f\u7f16\u7a0b","text":""},{"location":"ysyx/pa/c_marco/macro.html#_5","title":"\u9884\u5b9a\u4e49\u5b8f","text":"<p>Predefined Macros (The C Preprocessor) (gnu.org)</p>"},{"location":"ysyx/pa/c_marco/macro.html#_6","title":"\u5176\u4ed6\u590d\u6742\u5b8f","text":"<p>PA \u4e2d\u6709\u633a\u591a\u4f8b\u5b50\u7684\uff0c\u8fd9\u91cc\u5c31\u770b\u770b <code>navy-apps/libs/libos/src/syscall.c</code> \u7684\u5bc4\u5b58\u5668\u9009\u62e9\u5b8f\u3002</p> <pre><code>// helper macros\n#define _concat(x, y) x ## y\n#define concat(x, y) _concat(x, y)\n#define _args(n, list) concat(_arg, n) list\n#define _arg0(a0, ...) a0\n#define _arg1(a0, a1, ...) a1\n#define _arg2(a0, a1, a2, ...) a2\n#define _arg3(a0, a1, a2, a3, ...) a3\n#define _arg4(a0, a1, a2, a3, a4, ...) a4\n#define _arg5(a0, a1, a2, a3, a4, a5, ...) a5\n\n// extract an argument from the macro array\n#define SYSCALL  _args(0, ARGS_ARRAY)\n#define GPR1 _args(1, ARGS_ARRAY)\n#define GPR2 _args(2, ARGS_ARRAY)\n#define GPR3 _args(3, ARGS_ARRAY)\n#define GPR4 _args(4, ARGS_ARRAY)\n#define GPRx _args(5, ARGS_ARRAY)\n\n# define ARGS_ARRAY (\"ecall\", \"a7\", \"a0\", \"a1\", \"a2\", \"a0\")\n\nintptr_t _syscall_(intptr_t type, intptr_t a0, intptr_t a1, intptr_t a2) {\n  register intptr_t _gpr1 asm (GPR1) = type;\n  register intptr_t _gpr2 asm (GPR2) = a0;\n  register intptr_t _gpr3 asm (GPR3) = a1;\n  register intptr_t _gpr4 asm (GPR4) = a2;\n  register intptr_t ret asm (GPRx);\n  asm volatile (SYSCALL : \"=r\" (ret) : \"r\"(_gpr1), \"r\"(_gpr2), \"r\"(_gpr3), \"r\"(_gpr4));\n  return ret;\n}\n</code></pre> <p>\u624b\u52a8\u5c55\u5f00\u4e86\u89e3\u5373\u53ef\uff0c\u5145\u5206\u5229\u7528\u5b8f\u5c55\u5f00\u4e2d\u7a7a\u683c\u7684\u5185\u5bb9\u3002</p> <pre><code>int main(int argc, char **argv) {\n    GPR1;\n    _args(1, ARGS_ARRAY);  \n    _args(1,(\"ecall\", \"a7\", \"a0\", \"a1\", \"a2\", \"a0\")); \n    concat(_arg, 1) (\"ecall\", \"a7\", \"a0\", \"a1\", \"a2\", \"a0\");\n    _concat(_arg, 1) (\"ecall\", \"a7\", \"a0\", \"a1\", \"a2\", \"a0\");\n    _arg1 (\"ecall\", \"a7\", \"a0\", \"a1\", \"a2\", \"a0\");\n\n    \"a7\"\n    return 0;\n}\n</code></pre>"},{"location":"ysyx/pa/c_marco/macro.html#macro-pitfalls","title":"Macro Pitfalls","text":"<p>Macro Pitfalls (The C Preprocessor) (gnu.org)</p> <p>\u624b\u518c\u603b\u7ed3\u7684\u8fd9\u90e8\u5206\u8fd8\u662f\u633a\u597d\u7684\uff0c\u518d\u914d\u5408\u7f51\u4e0a\u7684\u4e00\u4e9b\u6700\u4f73\u5b9e\u8df5\u5408\u7406\u7684\u4f7f\u7528\u5b8f\u5373\u53ef\u3002</p>"},{"location":"ysyx/pa/c_marco/macro.html#_7","title":"\u4e00\u4e9b\u6bd4\u8f83\u597d\u7528\u7684\u5b8f","text":"<ol> <li>\u6570\u7ec4\u5143\u7d20\u4e2a\u6570</li> <li>\u4f4d\u64cd\u4f5c</li> <li>\u5185\u5b58\u5bf9\u9f50\u5b8f</li> <li>\u6253\u5370\u989c\u8272</li> <li>\u9009\u62e9\u5b8f/IF\u5b8f</li> <li>\u8c03\u8bd5\u5b8f\uff1a</li> </ol> <pre><code>// macro stringizing\n#define str_temp(x) #x\n#define str(x) str_temp(x)\n\n// strlen() for string constant\n#define STRLEN(CONST_STR) (sizeof(CONST_STR) - 1)\n\n// calculate the length of an array\n#define ARRLEN(arr) (int)(sizeof(arr) / sizeof(arr[0]))\n\n// macro concatenation\n#define concat_temp(x, y) x ## y\n#define concat(x, y) concat_temp(x, y)\n#define concat3(x, y, z) concat(concat(x, y), z)\n#define concat4(x, y, z, w) concat3(concat(x, y), z, w)\n#define concat5(x, y, z, v, w) concat4(concat(x, y), z, v, w)\n\n// macro testing\n// See https://stackoverflow.com/questions/26099745/test-if-preprocessor-symbol-is-defined-inside-macro\n#define CHOOSE2nd(a, b, ...) b\n#define MUX_WITH_COMMA(contain_comma, a, b) CHOOSE2nd(contain_comma a, b)\n#define MUX_MACRO_PROPERTY(p, macro, a, b) MUX_WITH_COMMA(concat(p, macro), a, b)\n// define placeholders for some property\n#define __P_DEF_0  X,\n#define __P_DEF_1  X,\n#define __P_ONE_1  X,\n#define __P_ZERO_0 X,\n// define some selection functions based on the properties of BOOLEAN macro\n#define MUXDEF(macro, X, Y)  MUX_MACRO_PROPERTY(__P_DEF_, macro, X, Y)\n#define MUXNDEF(macro, X, Y) MUX_MACRO_PROPERTY(__P_DEF_, macro, Y, X)\n#define MUXONE(macro, X, Y)  MUX_MACRO_PROPERTY(__P_ONE_, macro, X, Y)\n#define MUXZERO(macro, X, Y) MUX_MACRO_PROPERTY(__P_ZERO_,macro, X, Y)\n\n// test if a boolean macro is defined\n#define ISDEF(macro) MUXDEF(macro, 1, 0)\n// test if a boolean macro is undefined\n#define ISNDEF(macro) MUXNDEF(macro, 1, 0)\n// test if a boolean macro is defined to 1\n#define ISONE(macro) MUXONE(macro, 1, 0)\n// test if a boolean macro is defined to 0\n#define ISZERO(macro) MUXZERO(macro, 1, 0)\n// test if a macro of ANY type is defined\n// NOTE1: it ONLY works inside a function, since it calls `strcmp()`\n// NOTE2: macros defined to themselves (#define A A) will get wrong results\n#define isdef(macro) (strcmp(\"\" #macro, \"\" str(macro)) != 0)\n\n// simplification for conditional compilation\n#define __IGNORE(...)\n#define __KEEP(...) __VA_ARGS__\n// keep the code if a boolean macro is defined\n#define IFDEF(macro, ...) MUXDEF(macro, __KEEP, __IGNORE)(__VA_ARGS__)\n// keep the code if a boolean macro is undefined\n#define IFNDEF(macro, ...) MUXNDEF(macro, __KEEP, __IGNORE)(__VA_ARGS__)\n// keep the code if a boolean macro is defined to 1\n#define IFONE(macro, ...) MUXONE(macro, __KEEP, __IGNORE)(__VA_ARGS__)\n// keep the code if a boolean macro is defined to 0\n#define IFZERO(macro, ...) MUXZERO(macro, __KEEP, __IGNORE)(__VA_ARGS__)\n\n// functional-programming-like macro (X-macro)\n// apply the function `f` to each element in the container `c`\n// NOTE1: `c` should be defined as a list like:\n//   f(a0) f(a1) f(a2) ...\n// NOTE2: each element in the container can be a tuple\n#define MAP(c, f) c(f)\n\n#define BITMASK(bits) ((1ull &lt;&lt; (bits)) - 1)\n#define BITS(x, hi, lo) (((x) &gt;&gt; (lo)) &amp; BITMASK((hi) - (lo) + 1)) // similar to x[hi:lo] in verilog\n#define SEXT(x, len) ({ struct { int64_t n : len; } __x = { .n = x }; (uint64_t)__x.n; })\n\n#define ROUNDUP(a, sz)   ((((uintptr_t)a) + (sz) - 1) &amp; ~((sz) - 1))\n#define ROUNDDOWN(a, sz) ((((uintptr_t)a)) &amp; ~((sz) - 1))\n\n#define PG_ALIGN __attribute((aligned(4096)))\n\n#if !defined(likely)\n#define likely(cond)   __builtin_expect(cond, 1)\n#define unlikely(cond) __builtin_expect(cond, 0)\n#endif\n\n// for AM IOE\n#define io_read(reg) \\\n  ({ reg##_T __io_param; \\\n    ioe_read(reg, &amp;__io_param); \\\n    __io_param; })\n\n#define io_write(reg, ...) \\\n  ({ reg##_T __io_param = (reg##_T) { __VA_ARGS__ }; \\\n    ioe_write(reg, &amp;__io_param); })\n\n#endif\n</code></pre> <pre><code>#define Log(format, ...) \\\n    _Log(ANSI_FMT(\"[%s:%d %s] \" format, ANSI_FG_BLUE) \"\\n\", \\\n        __FILE__, __LINE__, __func__, ## __VA_ARGS__)\n\n#define Assert(cond, format, ...) \\\n  do { \\\n    if (!(cond)) { \\\n      MUXDEF(CONFIG_TARGET_AM, printf(ANSI_FMT(format, ANSI_FG_RED) \"\\n\", ## __VA_ARGS__), \\\n        (fflush(stdout), fprintf(stderr, ANSI_FMT(format, ANSI_FG_RED) \"\\n\", ##  __VA_ARGS__))); \\\n      IFNDEF(CONFIG_TARGET_AM, extern FILE* log_fp; fflush(log_fp)); \\\n      extern void assert_fail_msg(); \\\n      assert_fail_msg(); \\\n      assert(cond); \\\n    } \\\n  } while (0)\n\n#define panic(format, ...) Assert(0, format, ## __VA_ARGS__)\n\n#define TODO() panic(\"please implement me\")\n\n\n#endif\n</code></pre> <pre><code>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u4ee3\u7801\u4f7f\u7528\u8fd9\u4e9b\u9884\u5b9a\u4e49\u5b8f\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7528\u4e8e\u63d0\u793a\u9519\u8bef\u4fe1\u606f\u7684\u5b8f\uff0c\u5f53\u8fd9\u4e2a\u5b8f\u88ab\u8c03\u7528\u65f6\u4f1a\u8f93\u51fa\u4e00\u6761\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f\uff1a\n\n#if __STDC_VERSION__ &gt;= 199900L\n    #define ERROR(message)                            \\\n        fprintf(stderr, \"%s:%d:(in %s) error: %s \\n\", \\\n                __FILE__, __LINE__, __func__, message)\n#else\n    #define ERROR(message)                     \\\n        fprintf(stderr, \"%s:%d: error: %s \\n\", \\\n                __FILE__, __LINE__, message)\n#endif\n\u8fd9\u4e2a\u5b8f\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\uff1a\n\nif (node == NULL)\n    ERROR(\"find NULL expression\");\n    // .\\macro.c:53:(in main) error: find NULL expression\n</code></pre>"},{"location":"ysyx/pa/c_marco/macro.html#_8","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Preprocessor - cppreference.com</p> <p>Macros (The C Preprocessor) (gnu.org)</p> <p>\u300aC99 Standard\u300b</p> <p>X macro - Wikipedia</p> <p>Macro Expansion (The GNU C Preprocessor Internals)</p> <p>The Macro Expansion Process (boost.org)</p> <p>Top (The GNU C Preprocessor Internals)</p> <p>Painted blue - Wikipedia</p> <p>C\u8bed\u8a00\u5b8f\uff08macro\uff09\u5c0f\u6280\u5de7 - NOSAE - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>C\u8bed\u8a00\u5b8f\u5b9a\u4e49\u3001\u5b8f\u51fd\u6570\u3001\u5185\u7f6e\u5b8f\u4e0e\u5e38\u7528\u5b8f_vc6.0 \u5b8f\u51fd\u6570-CSDN\u535a\u5ba2</p>"},{"location":"ysyx/pa/pa1/pa1.html","title":"PA1","text":""},{"location":"ysyx/pa/pa1/pa1.html#_1","title":"\u6982\u8ff0","text":"<ul> <li>task PA1.1: \u5b9e\u73b0\u5355\u6b65\u6267\u884c, \u6253\u5370\u5bc4\u5b58\u5668\u72b6\u6001, \u626b\u63cf\u5185\u5b58</li> <li>task PA1.2: \u5b9e\u73b0\u7b97\u672f\u8868\u8fbe\u5f0f\u6c42\u503c</li> <li>task PA1.3: \u5b9e\u73b0\u6240\u6709\u8981\u6c42, \u63d0\u4ea4\u5b8c\u6574\u7684\u5b9e\u9a8c\u62a5\u544a**==</li> </ul> <p>\u200b   </p>"},{"location":"ysyx/pa/pa1/pa1.html#isa","title":"ISA","text":"<p>\u5927\u90e8\u5206\u8bfe\u672c\u4e0a\u90fd\u4f1a\u6709\u7c7b\u4f3c\"ISA\u662f\u8f6f\u4ef6\u548c\u786c\u4ef6\u4e4b\u95f4\u7684\u63a5\u53e3\"\u8fd9\u79cd\u8be0\u91ca, \u4f46\u5bf9\u4e8e\u8fd8\u4e0d\u4e86\u89e3\u8f6f\u4ef6\u548c\u786c\u4ef6\u4e4b\u95f4\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u7684\u4f60\u6765\u8bf4, \"\u63a5\u53e3\"\u8fd9\u4e2a\u8bcd\u8fd8\u662f\u592a\u62bd\u8c61\u4e86.</p> <p>\u4e3a\u4e86\u7406\u89e3ISA, \u6211\u4eec\u53ef\u4ee5\u7528\u73b0\u5b9e\u751f\u6d3b\u4e2d\u7684\u4f8b\u5b50\u6765\u6bd4\u55bb: \u87ba\u9489\u548c\u87ba\u6bcd\u662f\u751f\u6d3b\u4e2d\u4e24\u79cd\u5e38\u89c1\u7684\u7269\u54c1, \u5b83\u4eec\u4e00\u822c\u9700\u8981\u914d\u5bf9\u6765\u4f7f\u7528. \u7ed9\u5b9a\u4e00\u4e2a\u87ba\u9489, \u90a3\u5c31\u8981\u627e\u5230\u4e00\u4e2a\u7b26\u5408\u76f8\u540c\u5c3a\u5bf8\u89c4\u8303\u7684\u87ba\u6bcd\u624d\u80fd\u914d\u5408\u4f7f\u7528, \u53cd\u4e4b\u4ea6\u7136.</p> <p>\u5728\u8ba1\u7b97\u673a\u4e16\u754c\u4e2d\u4e5f\u662f\u7c7b\u4f3c\u7684: \u4e0d\u540c\u67b6\u6784\u7684\u8ba1\u7b97\u673a(\u6216\u8005\u8bf4\u786c\u4ef6)\u597d\u6bd4\u4e0d\u540c\u5c3a\u5bf8\u7684\u87ba\u9489, \u4e0d\u540c\u67b6\u6784\u7684\u7a0b\u5e8f(\u6216\u8005\u8bf4\u8f6f\u4ef6)\u5c31\u76f8\u5f53\u4e8e\u662f\u4e0d\u540c\u5c3a\u5bf8\u7684\u87ba\u6bcd, \u5982\u679c\u4e00\u4e2a\u7a0b\u5e8f\u8981\u5728\u7279\u5b9a\u67b6\u6784\u7684\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c, \u90a3\u4e48\u8fd9\u4e2a\u7a0b\u5e8f\u548c\u8ba1\u7b97\u673a\u5c31\u5fc5\u987b\u662f\u7b26\u5408\u540c\u4e00\u5957\u89c4\u8303\u624d\u884c.</p> <p>\u56e0\u6b64, ISA\u7684\u672c\u8d28\u5c31\u662f\u7c7b\u4f3c\u8fd9\u6837\u7684\u89c4\u8303. \u6240\u4ee5ISA\u7684\u5b58\u5728\u5f62\u5f0f\u65e2\u4e0d\u662f\u786c\u4ef6\u7535\u8def, \u4e5f\u4e0d\u662f\u8f6f\u4ef6\u4ee3\u7801, \u800c\u662f\u4e00\u672c\u89c4\u8303\u624b\u518c.</p> <p>\u65b0\u89c6\u89d2\uff1a\u7ea6\u5b9a\u597d\u7684\u89c4\u8303\uff0c\u50cf\u6cd5\u5f8b\u4e00\u6837\uff1f</p> <p>\u548c\u87ba\u9489\u87ba\u6bcd\u7684\u751f\u4ea7\u8fc7\u7a0b\u7c7b\u4f3c, \u8ba1\u7b97\u673a\u786c\u4ef6\u662f\u6309\u7167ISA\u89c4\u8303\u624b\u518c\u6784\u9020\u51fa\u6765\u7684, \u800c\u7a0b\u5e8f\u4e5f\u662f\u6309\u7167ISA\u89c4\u8303\u624b\u518c\u7f16\u5199(\u6216\u751f\u6210)\u51fa\u6765\u7684, \u81f3\u4e8eISA\u89c4\u8303\u91cc\u9762\u90fd\u6709\u54ea\u4e9b\u5185\u5bb9, \u6211\u4eec\u5e94\u8be5\u5982\u4f55\u6784\u9020\u4e00\u4e2a\u7b26\u5408\u89c4\u8303\u7684\u8ba1\u7b97\u673a, \u7a0b\u5e8f\u5e94\u8be5\u5982\u4f55\u9075\u5b88\u8fd9\u4e9b\u89c4\u8303\u6765\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c, \u56de\u7b54\u8fd9\u4e9b\u95ee\u9898\u6b63\u662f\u505aPA\u7684\u4e00\u4e2a\u76ee\u6807.</p>"},{"location":"ysyx/pa/pa1/pa1.html#trm","title":"TRM","text":""},{"location":"ysyx/pa/pa1/pa1.html#_2","title":"\u6700\u7b80\u5355\u7684\u8ba1\u7b97\u673a","text":"<p>\u4e3a\u4e86\u6267\u884c\u7a0b\u5e8f, \u9996\u5148\u8981\u89e3\u51b3\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898, \u5c31\u662f\u8981\u628a\u7a0b\u5e8f\u653e\u5728\u54ea\u91cc. \u663e\u7136, \u6211\u4eec\u4e0d\u5e0c\u671b\u81ea\u5df1\u521b\u9020\u7684\u8ba1\u7b97\u673a\u53ea\u80fd\u6267\u884c\u5c0f\u7a0b\u5e8f. \u56e0\u6b64, \u6211\u4eec\u9700\u8981\u4e00\u4e2a\u8db3\u591f\u5927\u5bb9\u91cf\u7684\u90e8\u4ef6, \u6765\u653e\u4e0b\u5404\u79cd\u5404\u6837\u7684\u7a0b\u5e8f, \u8fd9\u4e2a\u90e8\u4ef6\u5c31\u662f\u5b58\u50a8\u5668. \u4e8e\u662f, \u5148\u9a71\u521b\u9020\u4e86\u5b58\u50a8\u5668, \u5e76\u628a\u7a0b\u5e8f\u653e\u5728\u5b58\u50a8\u5668\u4e2d, \u7b49\u5f85\u7740CPU\u53bb\u6267\u884c.</p> <p>\u7b49\u7b49, CPU\u662f\u8c01? \u4f60\u4e5f\u8bb8\u5f88\u65e9\u5c31\u542c\u8bf4\u8fc7\u5b83\u4e86, \u4e0d\u8fc7\u73b0\u5728\u8fd8\u662f\u8ba9\u6211\u4eec\u6765\u91cd\u65b0\u4ecb\u7ecd\u4e00\u4e0b\u5b83\u5427. CPU\u662f\u5148\u9a71\u6700\u4f1f\u5927\u7684\u521b\u9020, \u4ece\u5b83\u7684\u4e2d\u6587\u540d\u5b57\"\u4e2d\u592e\u5904\u7406\u5668\"\u5c31\u770b\u5f97\u51fa\u5b83\u88ab\u8d4b\u4e88\u4e86\u81f3\u9ad8\u65e0\u4e0a\u7684\u8363\u8000: CPU\u662f\u8d1f\u8d23\u5904\u7406\u6570\u636e\u7684\u6838\u5fc3\u7535\u8def\u5355\u5143, \u4e5f\u5c31\u662f\u8bf4, \u7a0b\u5e8f\u7684\u6267\u884c\u5168\u9760\u5b83\u4e86. \u4f46\u53ea\u6709\u5b58\u50a8\u5668\u7684\u8ba1\u7b97\u673a\u8fd8\u662f\u4e0d\u80fd\u8fdb\u884c\u8ba1\u7b97. \u81ea\u7136\u5730, CPU\u9700\u8981\u80a9\u8d1f\u8d77\u8ba1\u7b97\u7684\u91cd\u4efb, \u5148\u9a71\u4e3aCPU\u521b\u9020\u4e86\u8fd0\u7b97\u5668, \u8fd9\u6837\u5c31\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u5404\u79cd\u5904\u7406\u4e86. \u5982\u679c\u89c9\u5f97\u8fd0\u7b97\u5668\u592a\u590d\u6742, \u90a3\u5c31\u5148\u6765\u8003\u8651\u4e00\u4e2a\u52a0\u6cd5\u5668\u5427.</p> <p>\u5148\u9a71\u53d1\u73b0, \u6709\u65f6\u5019\u7a0b\u5e8f\u9700\u8981\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u8fdb\u884c\u8fde\u7eed\u7684\u5904\u7406. \u4f8b\u5982\u8981\u8ba1\u7b97<code>1+2+...+100</code>, \u5c31\u8981\u5bf9\u90e8\u5206\u548c<code>sum</code>\u8fdb\u884c\u7d2f\u52a0, \u5982\u679c\u6bcf\u5b8c\u6210\u4e00\u6b21\u7d2f\u52a0\u90fd\u9700\u8981\u628a\u5b83\u5199\u56de\u5b58\u50a8\u5668, \u7136\u540e\u53c8\u628a\u5b83\u4ece\u5b58\u50a8\u5668\u4e2d\u8bfb\u51fa\u6765\u7ee7\u7eed\u52a0, \u8fd9\u6837\u5c31\u592a\u4e0d\u65b9\u4fbf\u4e86. \u540c\u65f6\u5929\u4e0b\u4e5f\u6ca1\u6709\u514d\u8d39\u7684\u5348\u9910, \u5b58\u50a8\u5668\u7684\u5927\u5bb9\u91cf\u4e5f\u662f\u9700\u8981\u4ed8\u51fa\u76f8\u5e94\u7684\u4ee3\u4ef7\u7684, \u90a3\u5c31\u662f\u901f\u5ea6\u6162, \u8fd9\u662f\u5148\u9a71\u4e5f\u65e0\u6cd5\u8fdd\u80cc\u7684\u6750\u6599\u7279\u6027\u89c4\u5f8b. \u4e8e\u662f\u5148\u9a71\u4e3aCPU\u521b\u9020\u4e86\u5bc4\u5b58\u5668, \u53ef\u4ee5\u8ba9CPU\u628a\u6b63\u5728\u5904\u7406\u4e2d\u7684\u6570\u636e\u6682\u65f6\u5b58\u653e\u5728\u5176\u4e2d.</p> <p>\u5bc4\u5b58\u5668\u7684\u901f\u5ea6\u5f88\u5feb, \u4f46\u5bb9\u91cf\u5374\u5f88\u5c0f, \u548c\u5b58\u50a8\u5668\u7684\u7279\u6027\u6b63\u597d\u4e92\u8865, \u5b83\u4eec\u4e4b\u95f4\u4e5f\u8bb8\u4f1a\u4ea4\u7ec7\u51fa\u65b0\u7684\u6545\u4e8b\u5462, \u4e0d\u8fc7\u76ee\u524d\u6211\u4eec\u8fd8\u662f\u987a\u5176\u81ea\u7136\u5427.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u8ba1\u7b97\u673a\u53ef\u4ee5\u6ca1\u6709\u5bc4\u5b58\u5668\u5417? (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u5982\u679c\u6ca1\u6709\u5bc4\u5b58\u5668, \u8ba1\u7b97\u673a\u8fd8\u53ef\u4ee5\u5de5\u4f5c\u5417? \u5982\u679c\u53ef\u4ee5, \u8fd9\u4f1a\u5bf9\u786c\u4ef6\u63d0\u4f9b\u7684\u7f16\u7a0b\u6a21\u578b\u6709\u4ec0\u4e48\u5f71\u54cd\u5462?</p> <p>\u5c31\u7b97\u4f60\u662f\u4e8c\u5468\u76ee\u6765\u601d\u8003\u8fd9\u4e2a\u95ee\u9898, \u4f60\u4e5f\u6709\u53ef\u80fd\u662f\u7b2c\u4e00\u6b21\u542c\u5230\"\u7f16\u7a0b\u6a21\u578b\"\u8fd9\u4e2a\u6982\u5ff5. </p> <p>\u4e0d\u8fc7\u5982\u679c\u4e00\u5468\u76ee\u7684\u65f6\u5019\u4f60\u5df2\u7ecf\u4ed4\u7ec6\u5730\u9605\u8bfb\u8fc7ISA\u624b\u518c, \u4f60\u4f1a\u8bb0\u5f97\u786e\u5b9e\u6709\u8fd9\u4e48\u4e2a\u6982\u5ff5. \u6240\u4ee5, \u5982\u679c\u60f3\u77e5\u9053\u4ec0\u4e48\u662f\u7f16\u7a0b\u6a21\u578b, RTFM\u5427.</p> <ol> <li> <p>\u80fd\u4e0d\u80fd\u5de5\u4f5c</p> <p>\u6211\u89c9\u5f97\u662f\u53ef\u4ee5\u7684\u3002\u4e3a\u4ec0\u4e48\u8981\u63d0\u51fa\u5bc4\u5b58\u5668\uff0c\u770b\u770b\u4e0a\u9762\u7684\u5386\u53f2\uff0c\u5148\u9a71\u4e3a\u4e86\u63d0\u9ad8\u4e00\u4e0b\u8ba1\u7b97\u673a\u5904\u7406\u8fd0\u884c\u7684\u901f\u5ea6\uff0c\u4e0d\u60f3\u4ece\u5bb9\u91cf\u5927\u4f46\u662f\u901f\u5ea6\u6162\u7684\u5b58\u50a8\u5668\u4e2d\uff0c\u6765\u56de\u5730\u5b58\u53d6\u6570\u636e\uff0c\u80fd\u4e0d\u80fd\u6709\u4e00\u4e2a\u901f\u5ea6\u5feb\uff0c\u5b58\u653e\u4e2d\u95f4\u7ed3\u679c\u7684\u5730\u65b9\uff0c\u8981\u7528\u6211\u5c31\u53bb\u8fd9\u91cc\u5b58\uff0c\u4ece\u800c\u521b\u9020\u4e86\u5bc4\u5b58\u5668\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5bc4\u5b58\u5668\uff0c\u90a3\u5c31\u5f97\u4e0d\u65ad\u5730\u4ece\u5b58\u50a8\u5668\u4e2d\u53d6\u6570\u636e\uff0c\u8fd0\u7b97\uff0c\u653e\u6570\u636e...</p> <p>\u53ef\u4ee5\u662f\u53ef\u4ee5\u505a\uff0c\u4f46\u662f\u5f88\u6162\u6b38...</p> <p>\u56de\u60f3\u51af\u8bfa\u4f9d\u66fc\u67b6\u6784\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u8fd0\u7b97\u5668\u3001\u63a7\u5236\u5668\u3001\u5b58\u50a8\u3001\u8f93\u5165\u8f93\u51fa\u3002</p> <p>\u6709\u8bf4\u5b58\u50a8\u5668\u91cc\u8fd8\u6709\u4e2a\u5bc4\u5b58\u5668\u5417\uff1f\u6ca1\u6709\u5427\uff1f\uff08\u8fd9\u4e2a\u8fd8\u771f\u4e0d\u77e5\u9053\uff0c\u8981\u4e0d\u56de\u53bb\u770b\u770b\u51af\u8bfa\u4f9d\u66fc\u7684\u5386\u53f2\u624b\u7a3f\uff09</p> <p>\u76f8\u5173\u8d44\u6599\uff1a</p> <p>\u51af\u8bfa\u4f9d\u66fc\u7ed3\u6784 - \u7ef4\u57fa\u767e\u79d1\uff0c\u81ea\u7531\u7684\u767e\u79d1\u5168\u4e66 (wikipedia.org)</p> <p>\"\u5728\u4f7f\u7528Mark I\u548cENIAC\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4ed6\u610f\u8bc6\u5230\u4e86\u5b58\u50a8\u7a0b\u5e8f\u7684\u91cd\u8981\u6027\uff0c\u4ece\u800c\u63d0\u51fa\u4e86\u5b58\u50a8\u7a0b\u5e8f\u903b\u8f91\u67b6\u6784\u3002\"</p> <p>\u7ee7\u7eed\uff0c\u5047\u5982\u6ca1\u6709\uff0c\u6211\u4eec\u8981\u9020\u7684\u8ba1\u7b97\u673a\u5c31\u4ece\u5b58\u50a8\u5668\u91cc\u9762\u53d6\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4e5f\u5c06\u5404\u79cd\u8fd0\u7b97\u7ed3\u679c\u653e\u5230\u5b58\u50a8\u5668\u91cc\uff0c\u8fd9\u6837\u5b50\uff0c\u90a3\u5c31\u5f97\u597d\u597d\u89c4\u5212\u5b58\u50a8\u5668\u7684\u533a\u57df\u4e86\uff0c\u4e0d\u7136\u6570\u636e\u548c\u6307\u4ee4\u641e\u9519\u4e86\u600e\u4e48\u529e\uff1f</p> </li> <li> <p>\u7f16\u7a0b\u6a21\u578b</p> <p>\u597d\u7684\uff0c\u65e2\u7136\u80fd\u5de5\u4f5c\u4e86\uff0c\u90a3\u7f16\u7a0b\u6a21\u578b\u53c8\u662f\u4ec0\u4e48\uff1fISA\u624b\u518c\u4e2d\u6709\uff1f</p> <p>\u770b riscv manual \u2160\u548cGPT</p> <p></p> <p>\u7f16\u7a0b\u6a21\u578b\uff08Programming model\uff09\u662f\u6307\u4e00\u79cd\u63cf\u8ff0\u8ba1\u7b97\u673a\u7a0b\u5e8f\u8fd0\u884c\u65b9\u5f0f\u7684\u62bd\u8c61\u6982\u5ff5\u3002\u5b83\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u5458\u4e0e\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e4b\u95f4\u7684\u4ea4\u4e92\u65b9\u5f0f\uff0c\u5305\u62ec\u5982\u4f55\u8868\u793a\u6570\u636e\u3001\u5982\u4f55\u7ec4\u7ec7\u4ee3\u7801\u3001\u5982\u4f55\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u7b49\u3002</p> <p>\u7f16\u7a0b\u6a21\u578b\u901a\u5e38\u5305\u542b\u4e00\u7ec4\u89c4\u5219\uff0c\u7528\u4e8e\u6307\u5bfc\u7a0b\u5e8f\u5458\u521b\u5efa\u7a0b\u5e8f\uff0c\u5e76\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u5458\u9700\u8981\u4f7f\u7528\u7684\u7279\u5b9a\u7f16\u7a0b\u8bed\u8a00\u3001API\u3001\u5e93\u548c\u5de5\u5177\u96c6\u3002\u7f16\u7a0b\u6a21\u578b\u7684\u8bbe\u8ba1\u53ef\u4ee5\u6781\u5927\u5730\u5f71\u54cd\u7a0b\u5e8f\u7684\u53ef\u7ef4\u62a4\u6027\u3001\u53ef\u6269\u5c55\u6027\u548c\u53ef\u91cd\u7528\u6027\u3002</p> <p>\u5e38\u89c1\u7684\u7f16\u7a0b\u6a21\u578b\u5305\u62ec\u9762\u5411\u8fc7\u7a0b\u7f16\u7a0b\uff08Procedural Programming\uff09\u3001\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\uff08Object-Oriented Programming\uff09\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b\uff08Functional Programming\uff09\u3001\u4e8b\u4ef6\u9a71\u52a8\u7f16\u7a0b\uff08Event-Driven Programming\uff09\u7b49\u3002\u6bcf\u79cd\u7f16\u7a0b\u6a21\u578b\u90fd\u6709\u5176\u72ec\u7279\u7684\u7279\u70b9\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u7f16\u7a0b\u6a21\u578b\u6765\u8fdb\u884c\u7f16\u7a0b\u3002</p> <p>\u5728\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u4e2d\uff0c\"\u7f16\u7a0b\u6a21\u578b\"\uff08Programming Model\uff09\u662f\u6307\u7a0b\u5e8f\u5458\u5728\u7f16\u5199\u7a0b\u5e8f\u65f6\u6240\u4f9d\u8d56\u7684\u62bd\u8c61\u6982\u5ff5\u548c\u884c\u4e3a\u89c4\u8303\u3002\u5b83\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u5982\u4f55\u4e0e\u8ba1\u7b97\u673a\u786c\u4ef6\u4ea4\u4e92\uff0c\u5305\u62ec\u6307\u4ee4\u96c6\u3001\u5bc4\u5b58\u5668\u4f7f\u7528\u3001\u5185\u5b58\u8bbf\u95ee\u3001I/O\u64cd\u4f5c\u4ee5\u53ca\u5f02\u5e38\u548c\u4e2d\u65ad\u5904\u7406\u7b49\u3002\u7f16\u7a0b\u6a21\u578b\u662f\u786c\u4ef6\u67b6\u6784\u4e0e\u8f6f\u4ef6\u4e4b\u95f4\u7684\u6865\u6881\uff0c\u4e3a\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e86\u4e00\u4e2a\u76f8\u5bf9\u7b80\u5316\u548c\u4e00\u81f4\u7684\u63a5\u53e3\u6765\u7f16\u5199\u8f6f\u4ef6\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u7f16\u7a0b\u6a21\u578b\u7ec4\u6210\u90e8\u5206\u7684\u4f8b\u5b50\uff1a</p> <ol> <li>\u6307\u4ee4\u96c6\u7684\u590d\u6742\u6027\uff1a<ul> <li>CISC\uff08\u590d\u6742\u6307\u4ee4\u96c6\u8ba1\u7b97\u673a\uff09\uff1a\u5982x86\u67b6\u6784\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6307\u4ee4\u96c6\uff0c\u5305\u62ec\u590d\u6742\u64cd\u4f5c\u548c\u591a\u79cd\u5bfb\u5740\u6a21\u5f0f\u3002</li> <li>RISC\uff08\u7cbe\u7b80\u6307\u4ee4\u96c6\u8ba1\u7b97\u673a\uff09\uff1a\u5982ARM\u548cRISC-V\uff0c\u6307\u4ee4\u96c6\u76f8\u5bf9\u7b80\u5355\uff0c\u6613\u4e8e\u786c\u4ef6\u5b9e\u73b0\uff0c\u5f3a\u8c03\u6307\u4ee4\u7684\u5feb\u901f\u6267\u884c\u3002</li> </ul> </li> <li>\u5bc4\u5b58\u5668\u7684\u6570\u91cf\u548c\u7528\u9014\uff1a<ul> <li>\u901a\u7528\u5bc4\u5b58\u5668\uff1a\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u548c\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\u3002</li> <li>\u4e13\u7528\u5bc4\u5b58\u5668\uff1a\u5982\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u3001\u5806\u6808\u6307\u9488\uff08SP\uff09\u7b49\uff0c\u5177\u6709\u7279\u5b9a\u7528\u9014\u3002</li> </ul> </li> <li>\u5185\u5b58\u7ba1\u7406\u548cI/O\u8bbf\u95ee\u65b9\u5f0f\uff1a<ul> <li>\u5185\u5b58\u6a21\u578b\uff1a\u5982\u51af\u00b7\u8bfa\u4f9d\u66fc\u6a21\u578b\u548c\u54c8\u4f5b\u6a21\u578b\uff0c\u51b3\u5b9a\u4e86\u6307\u4ee4\u548c\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u3002</li> <li>\u5185\u5b58\u8bbf\u95ee\u6307\u4ee4\uff1a\u5982\u52a0\u8f7d\uff08load\uff09\u548c\u5b58\u50a8\uff08store\uff09\u6307\u4ee4\uff0c\u7528\u4e8e\u6570\u636e\u7684\u8bfb\u53d6\u548c\u5199\u5165\u3002</li> </ul> </li> <li>\u5f02\u5e38\u548c\u4e2d\u65ad\u5904\u7406\u673a\u5236\uff1a<ul> <li>\u5f02\u5e38\uff1a\u786c\u4ef6\u6216\u8f6f\u4ef6\u89e6\u53d1\u7684\u4e8b\u4ef6\uff0c\u5982\u9664\u96f6\u9519\u8bef\u3001\u975e\u6cd5\u6307\u4ee4\u7b49\u3002</li> <li>\u4e2d\u65ad\uff1a\u5916\u90e8\u6216\u5185\u90e8\u4e8b\u4ef6\u89e6\u53d1\u7684\u4e2d\u65ad\u8bf7\u6c42\uff0c\u5982I/O\u5b8c\u6210\u3001\u5b9a\u65f6\u5668\u5230\u671f\u7b49\u3002</li> </ul> </li> <li>\u5176\u4ed6\u7279\u6027\uff1a<ul> <li>\u5bfb\u5740\u6a21\u5f0f\uff1a\u5982\u76f4\u63a5\u5bfb\u5740\u3001\u95f4\u63a5\u5bfb\u5740\u3001\u57fa\u5740\u52a0\u504f\u79fb\u91cf\u5bfb\u5740\u7b49\u3002</li> <li>\u6761\u4ef6\u6267\u884c\uff1a\u6839\u636e\u7279\u5b9a\u7684\u6761\u4ef6\u6267\u884c\u6216\u8df3\u8fc7\u6307\u4ee4\u3002</li> <li>\u6d41\u6c34\u7ebf\uff1a\u6307\u4ee4\u6267\u884c\u7684\u6d41\u6c34\u7ebf\u5316\uff0c\u63d0\u9ad8\u6307\u4ee4\u541e\u5410\u7387\u3002</li> </ul> </li> </ol> <p>\u597d\u50cf\u90fd\u6ca1\u6709\u660e\u786e\u8bf4\u660e\u6216\u8005\u5b9a\u4e49 programming model \u5230\u5e95\u662f\u4e2a\u4ec0\u4e48\uff1f\u800c\u4e14\u4e0d\u540c\u9886\u57df\u5bf9\u8fd9\u4e2a\u8bcd\u7684\u5b9a\u4e49\u4e5f\u4e0d\u540c\u3002\u53ea\u80fd\u4ece\u624b\u518c\u91cc\u7684\u6d89\u53ca\u5230\u7684\u5185\u5bb9\u63a8\u6d4b\u4e00\u4e9b\u3002\u6240\u4ee5\u53ef\u4ee5\u63a8\u65ad\u51fa\u8fd9\u4e2a\u6240\u8c13\u7684\u7f16\u7a0b\u6a21\u578b\u5e94\u8be5\u662f\u548c\u5404\u79cd ISA \u6240\u89c4\u5b9a\u7684\u8bbf\u5b58\u64cd\u4f5c\u4e43\u81f3\u5982\u4f55\u4e0e\u786c\u4ef6\u4ea4\u4e92\u6709\u5173\u7684\u4e1c\u897f\uff0c\u800c\u4e0d\u662f\u4ec0\u4e48\u9762\u5411\u5bf9\u8c61\u3001\u51fd\u6570\u5f0f\uff08\u5e94\u8be5\u53eb\u7f16\u7a0b\u8303\u5f0f\uff09\u3002\u6bd4\u5982\u8bf4\u4e0d\u540cISA\u4e0b\uff0cRISC\u548cCISC\u7684\u5dee\u5f02\uff0c\u5bc4\u5b58\u5668\u7684\u6570\u91cf\uff0c\u5982\u4f55\u5185\u5b58\u7ba1\u7406\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5185\u5bb9\u3002</p> <p>\u518d\u56de\u5230\u9898\u76ee\u95ee\u7684\u95ee\u9898\uff0c\u6ca1\u6709\u5bc4\u5b58\u5668\uff0c\u5bf9\u4e8e\u7f16\u7a0b\u6a21\u578b\u7684\u5f71\u54cd\u3002</p> <p>\u6ca1\u6709\u4e86\u5bc4\u5b58\u5668\uff0cCPU\u5c31\u5f97\u4e00\u76f4\u4ece\u5b58\u50a8\u5668\u4e2d\u53d6\u5f97\u6570\u636e\u548c\u6307\u4ee4\uff0c\u90a3\u4e5f\u5c31\u6ca1\u6709\u5fc5\u8981\u4ec0\u4e48 <code>load</code> \u548c <code>store</code> \u6307\u4ee4\uff0c\u76f4\u63a5\u5206\u4e3a \u8bfb\u5b58\u50a8\uff0c\u5199\u5b58\u50a8\u5c31\u884c\u4e86\uff0c\u8fd9\u6837\u5b50 weak \u4e86\u786c\u4ef6\u8bbe\u8ba1\uff1f\uff08\u4e0d\u6e05\u695a\uff1f\uff09\uff0c\u4f46\u662f\u590d\u6742\u5316\u4e86\u7f16\u7a0b\u6a21\u578b\uff0c\u7a0b\u5e8f\u5458\u9700\u8981\u8003\u8651\u66f4\u52a0\u7684\u95ee\u9898\u3002</p> <ol> <li>\u5047\u5982\u6ca1\u6709\u4e86\u5bc4\u5b58\u5668\uff0c\u90a3PC\u4e5f\u6ca1\u6709\u4e86\uff0c\u90a3\u6211\u4eec\u600e\u4e48\u5904\u7406\u63a7\u5236\u6d41\u7684\u7ba1\u7406\uff0c\u8fd9\u6837\u5b50\u5206\u652f\u548c\u8df3\u8f6c\u64cd\u4f5c\u5c06\u66f4\u52a0\u590d\u6742\u3002\u3002\u3002\u6bcf\u6b21\u90fd\u8981\u53bb\u5185\u5b58\u4e2d\u8bfb\u53d6\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002</li> <li>\u66f4\u6162\u7684\u6307\u4ee4\u6267\u884c\u901f\u5ea6</li> <li>\u5185\u5b58\u8bbf\u95ee\u6b21\u6570\u589e\u52a0 --&gt; \u6162</li> <li>\u589e\u52a0\u6570\u636e\u5f00\u9500</li> <li>\u7a0b\u5e8f\u5458\u9700\u8981\u8003\u8651\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u548c\u8bbf\u95ee\u6a21\u5f0f\uff0c\u589e\u52a0\u4e86\u7f16\u7a0b\u7684\u590d\u6742\u6027\u3002</li> <li>\u3002\u3002\u3002</li> </ol> </li> </ol> </li> </ul> <p>\u8ba1\u7b97\u673a\u672c\u8d28\u4e0a\u505a\u7684\u4e8b\u60c5\uff1a</p> <pre><code>while (1) {\n  \u4ecePC\u6307\u793a\u7684\u5b58\u50a8\u5668\u4f4d\u7f6e\u53d6\u51fa\u6307\u4ee4;\n  \u6267\u884c\u6307\u4ee4;\n  \u66f4\u65b0PC;\n}\n</code></pre> <p>\u8fd9\u6837, \u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a\u8db3\u591f\u7b80\u5355\u7684\u8ba1\u7b97\u673a\u4e86. \u6211\u4eec\u53ea\u8981\u5c06\u4e00\u6bb5\u6307\u4ee4\u5e8f\u5217\u653e\u7f6e\u5728\u5b58\u50a8\u5668\u4e2d, \u7136\u540e\u8ba9PC\u6307\u5411\u7b2c\u4e00\u6761\u6307\u4ee4, \u8ba1\u7b97\u673a\u5c31\u4f1a\u81ea\u52a8\u6267\u884c\u8fd9\u4e00\u6bb5\u6307\u4ee4\u5e8f\u5217, \u6c38\u4e0d\u505c\u6b62.</p> <p>\u4f8b\u5982, \u4e0b\u9762\u7684\u6307\u4ee4\u5e8f\u5217\u53ef\u4ee5\u8ba1\u7b97<code>1+2+...+100</code>, \u5176\u4e2d<code>r1</code>\u548c<code>r2</code>\u662f\u4e24\u4e2a\u5bc4\u5b58\u5668, \u8fd8\u6709\u4e00\u4e2a\u9690\u542b\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668<code>PC</code>, \u5b83\u7684\u521d\u503c\u662f<code>0</code>. \u4e3a\u4e86\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3, \u6211\u4eec\u628a\u6307\u4ee4\u7684\u8bed\u4e49\u7ffb\u8bd1\u6210C\u4ee3\u7801\u653e\u5728\u53f3\u4fa7, \u5176\u4e2d\u6bcf\u4e00\u884cC\u4ee3\u7801\u524d\u90fd\u6dfb\u52a0\u4e86\u4e00\u4e2a\u8bed\u53e5\u6807\u53f7:</p> <pre><code>// PC: instruction    | // label: statement\n0: mov  r1, 0         |  pc0: r1 = 0;\n1: mov  r2, 0         |  pc1: r2 = 0;\n2: addi r2, r2, 1     |  pc2: r2 = r2 + 1;\n3: add  r1, r1, r2    |  pc3: r1 = r1 + r2;\n4: blt  r2, 100, 2    |  pc4: if (r2 &lt; 100) goto pc2;   // branch if less than\n5: jmp 5              |  pc5: goto pc5;\n</code></pre> <p>\u8ba1\u7b97\u673a\u6267\u884c\u4ee5\u4e0a\u7684\u6307\u4ee4\u5e8f\u5217, \u6700\u540e\u4f1a\u5728<code>PC=5</code>\u5904\u7684\u6307\u4ee4\u9677\u5165\u6b7b\u5faa\u73af, \u6b64\u65f6\u8ba1\u7b97\u5df2\u7ecf\u7ed3\u675f, <code>1+2+...+100</code>\u7684\u7ed3\u679c\u4f1a\u5b58\u653e\u5728\u5bc4\u5b58\u5668<code>r1</code>\u4e2d.</p> <p>\u4e3a\u4e86\u8868\u8fbe\u5bf9\u56fe\u7075\u7684\u656c\u4ef0, \u6211\u4eec\u4e5f\u628a\u4e0a\u9762\u8fd9\u4e2a\u6700\u7b80\u5355\u7684\u8ba1\u7b97\u673a\u79f0\u4e3a\"\u56fe\u7075\u673a\"(Turing Machine, TRM). \u6216\u8bb8\u4f60\u5df2\u7ecf\u542c\u8bf4\u8fc7\"\u56fe\u7075\u673a\"\u8fd9\u4e2a\u4f5c\u4e3a\u8ba1\u7b97\u6a21\u578b\u65f6\u7684\u6982\u5ff5, \u4e0d\u8fc7\u5728\u8fd9\u91cc\u6211\u4eec\u53ea\u5f3a\u8c03\u4f5c\u4e3a\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u771f\u5b9e\u8ba1\u7b97\u673a\u9700\u8981\u6ee1\u8db3\u54ea\u4e9b\u6761\u4ef6:</p> <ul> <li>\u7ed3\u6784\u4e0a, TRM\u6709\u5b58\u50a8\u5668, \u6709PC, \u6709\u5bc4\u5b58\u5668, \u6709\u52a0\u6cd5\u5668</li> <li>\u5de5\u4f5c\u65b9\u5f0f\u4e0a, TRM\u4e0d\u65ad\u5730\u91cd\u590d\u4ee5\u4e0b\u8fc7\u7a0b: \u4ecePC\u6307\u793a\u7684\u5b58\u50a8\u5668\u4f4d\u7f6e\u53d6\u51fa\u6307\u4ee4, \u6267\u884c\u6307\u4ee4, \u7136\u540e\u66f4\u65b0PC</li> </ul> <p>\u54a6? \u5b58\u50a8\u5668, \u8ba1\u6570\u5668, \u5bc4\u5b58\u5668, \u52a0\u6cd5\u5668, \u8fd9\u4e9b\u4e0d\u90fd\u662f\u6570\u5b57\u7535\u8def\u8bfe\u4e0a\u5b66\u4e60\u8fc7\u7684\u90e8\u4ef6\u5417? \u4e5f\u8bb8\u4f60\u4f1a\u89c9\u5f97\u96be\u4ee5\u7f6e\u4fe1, \u4f46\u5148\u9a71\u8bf4, \u4f60\u6b63\u5728\u9762\u5bf9\u7740\u7684\u90a3\u53f0\u65e0\u6240\u4e0d\u80fd\u7684\u8ba1\u7b97\u673a, \u5c31\u662f\u7531\u6570\u5b57\u7535\u8def\u7ec4\u6210\u7684! \u4e0d\u8fc7, \u6211\u4eec\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u5199\u7684\u7a0b\u5e8f\u662fC\u4ee3\u7801. \u4f46\u5982\u679c\u8ba1\u7b97\u673a\u771f\u7684\u662f\u4e2a\u53ea\u80fd\u61c20\u548c1\u7684\u5de8\u5927\u6570\u5b57\u7535\u8def, \u8fd9\u4e2a\u51b7\u51b0\u51b0\u7684\u7535\u8def\u53c8\u662f\u5982\u4f55\u7406\u89e3\u51dd\u7ed3\u4e86\u4eba\u7c7b\u667a\u6167\u7ed3\u6676\u7684C\u4ee3\u7801\u7684\u5462? \u5148\u9a71\u8bf4, \u8ba1\u7b97\u673a\u8bde\u751f\u7684\u90a3\u4e9b\u5e74\u8fd8\u6ca1\u6709C\u8bed\u8a00, \u5927\u5bb6\u90fd\u662f\u76f4\u63a5\u7f16\u5199\u5bf9\u4eba\u7c7b\u6765\u8bf4\u6666\u6da9\u96be\u61c2\u7684\u673a\u5668\u6307\u4ee4, \u90a3\u662f\u4ed6\u6240\u89c1\u8fc7\u7684\u6700\u65e9\u7684\u5bf9\u7535\u5b50\u8ba1\u7b97\u673a\u7684\u7f16\u7a0b\u65b9\u5f0f\u4e86. \u540e\u6765\u4eba\u4eec\u53d1\u660e\u4e86\u9ad8\u7ea7\u8bed\u8a00\u548c\u7f16\u8bd1\u5668, \u80fd\u628a\u6211\u4eec\u5199\u7684\u9ad8\u7ea7\u8bed\u8a00\u4ee3\u7801\u8fdb\u884c\u5404\u79cd\u5904\u7406, \u6700\u540e\u751f\u6210\u529f\u80fd\u7b49\u4ef7\u7684, CPU\u80fd\u7406\u89e3\u7684\u6307\u4ee4. CPU\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4, \u5c31\u76f8\u5f53\u4e8e\u662f\u6267\u884c\u4e86\u6211\u4eec\u5199\u7684\u4ee3\u7801. \u4eca\u5929\u7684\u8ba1\u7b97\u673a\u672c\u8d28\u4e0a\u8fd8\u662f\"\u5b58\u50a8\u7a0b\u5e8f\"\u8fd9\u79cd\u5929\u7136\u611a\u949d\u7684\u5de5\u4f5c\u65b9\u5f0f, \u662f\u7ecf\u8fc7\u4e86\u65e0\u6570\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\u7684\u52aa\u529b, \u6211\u4eec\u4eca\u5929\u624d\u53ef\u4ee5\u8f7b\u677e\u5730\u4f7f\u7528\u8ba1\u7b97\u673a.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_3","title":"\u4e3e\u4f8b\u8bf4\u660e","text":"<ul> <li>x86\u67b6\u6784\uff1a\u5178\u578b\u7684CISC\u67b6\u6784\uff0c\u5177\u6709\u4e30\u5bcc\u7684\u6307\u4ee4\u96c6\u548c\u591a\u79cd\u5bfb\u5740\u6a21\u5f0f\u3002x86\u7684\u7f16\u7a0b\u6a21\u578b\u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\u548c\u590d\u6742\u7684\u5185\u5b58\u8bbf\u95ee\u6307\u4ee4\u3002</li> <li>ARM\u67b6\u6784\uff1a\u4e00\u79cd\u5e7f\u6cdb\u4f7f\u7528\u7684RISC\u67b6\u6784\uff0c\u5177\u6709\u8f83\u5c11\u7684\u6307\u4ee4\u548c\u5bc4\u5b58\u5668\uff0c\u4f46\u5f3a\u8c03\u6307\u4ee4\u7684\u5feb\u901f\u6267\u884c\u548c\u4f4e\u529f\u8017\u3002ARM\u63d0\u4f9b\u4e86\u591a\u79cd\u5185\u5b58\u7ba1\u7406\u548cI/O\u8bbf\u95ee\u673a\u5236\u3002</li> <li>MIPS\u67b6\u6784\uff1a\u53e6\u4e00\u79cdRISC\u67b6\u6784\uff0c\u4ee5\u5176\u7b80\u5355\u548c\u4e00\u81f4\u7684\u6307\u4ee4\u96c6\u800c\u95fb\u540d\u3002MIPS\u7684\u7f16\u7a0b\u6a21\u578b\u5305\u62ec\u901a\u7528\u5bc4\u5b58\u5668\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\u548c\u5806\u6808\u6307\u9488\u7b49\u3002</li> <li>RISC-V\u67b6\u6784\uff1a\u4e00\u4e2a\u5f00\u6e90\u7684RISC\u6307\u4ee4\u96c6\u67b6\u6784\uff0c\u8bbe\u8ba1\u7b80\u6d01\uff0c\u6613\u4e8e\u6559\u5b66\u548c\u7814\u7a76\u3002RISC-V\u7684\u7f16\u7a0b\u6a21\u578b\u5305\u62ec\u7528\u6237\u6a21\u5f0f\u548c\u7279\u6743\u6a21\u5f0f\uff0c\u652f\u6301\u5f02\u5e38\u548c\u4e2d\u65ad\u5904\u7406\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_4","title":"\u603b\u7ed3","text":"<p>\u7f16\u7a0b\u6a21\u578b\u662f\u7406\u89e3\u7279\u5b9aISA\uff08\u6307\u4ee4\u96c6\u67b6\u6784\uff09\u7684\u57fa\u7840\uff0c\u5b83\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u5458\u5982\u4f55\u4e0e\u786c\u4ef6\u4ea4\u4e92\u3002\u4e0d\u540c\u7684ISA\u6709\u4e0d\u540c\u7684\u7f16\u7a0b\u6a21\u578b\uff0c\u8fd9\u4e9b\u6a21\u578b\u53cd\u6620\u4e86\u67b6\u6784\u7684\u8bbe\u8ba1\u54f2\u5b66\u548c\u76ee\u6807\u5e94\u7528\u573a\u666f\u3002\u4e86\u89e3\u7f16\u7a0b\u6a21\u578b\u6709\u52a9\u4e8e\u7a0b\u5e8f\u5458\u7f16\u5199\u66f4\u6709\u6548\u3001\u66f4\u53ef\u79fb\u690d\u7684\u4ee3\u7801\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_5","title":"\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a","text":"<p>ICS\u8bfe\u672c\u76841.1.3\u5c0f\u8282\u4e2d\u4ecb\u7ecd\u4e86\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u8ba1\u7b97\u673a. \u8fd9\u4e2a\u8ba1\u7b97\u673a\u67094\u4e2a8\u4f4d\u7684\u5bc4\u5b58\u5668, \u4e00\u4e2a4\u4f4dPC, \u4ee5\u53ca\u4e00\u6bb516\u5b57\u8282\u7684\u5185\u5b58(\u4e5f\u5c31\u662f\u5b58\u50a8\u5668), \u90a3\u4e48\u8fd9\u4e2a\u8ba1\u7b97\u673a\u53ef\u4ee5\u8868\u793a\u6bd4\u7279\u603b\u6570\u4e3a<code>B = 4*8 + 4 + 16*8 = 164</code>, \u56e0\u6b64\u8fd9\u4e2a\u8ba1\u7b97\u673a\u603b\u5171\u53ef\u4ee5\u6709<code>N = 2^B = 2^164</code>\u79cd\u4e0d\u540c\u7684\u72b6\u6001. \u5047\u8bbe\u8fd9\u4e2a\u5728\u8fd9\u4e2a\u8ba1\u7b97\u673a\u4e2d, \u6240\u6709\u6307\u4ee4\u7684\u884c\u4e3a\u90fd\u662f\u786e\u5b9a\u7684, \u90a3\u4e48\u7ed9\u5b9a<code>N</code>\u4e2a\u72b6\u6001\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a, \u5176\u8f6c\u79fb\u4e4b\u540e\u7684\u65b0\u72b6\u6001\u4e5f\u662f\u552f\u4e00\u786e\u5b9a\u7684. \u4e00\u822c\u6765\u8bf4<code>N</code>\u975e\u5e38\u5927, \u4e0b\u56fe\u5c55\u793a\u4e86<code>N=50</code>\u65f6\u67d0\u8ba1\u7b97\u673a\u7684\u72b6\u6001\u8f6c\u79fb\u56fe.</p> <p></p> <p>\u7ed9\u5b9a\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u653e\u5230\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u91cc\u9762\uff0c\u5728 N \u591a\u4e2a\u72b6\u6001\u4e2d\u6307\u5b9a\u4e00\u4e2a\u72b6\u6001\uff0c\u5373\u4e3a\u521d\u59cb\u72b6\u6001\uff0c\u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u5c31\u662f</p> <p>\u4ece\u8fd9\u4e2a\u521d\u59cb\u72b6\u6001\u5f00\u59cb --&gt; \u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4 --&gt; \u8fdb\u884c\u4e00\u6b21\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4, \u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u72b6\u6001\u673a\uff01\u8fd9\u4e2a\u72b6\u6001\u673a\u662f\u4e0a\u6587\u63d0\u5230\u7684\u5927\u72b6\u6001\u673a(\u72b6\u6001\u6570\u91cf\u4e3a<code>N</code>)\u7684\u5b50\u96c6.</p> <p>example\uff1a</p> <pre><code>8-&gt;1-&gt;32-&gt;31-&gt;32-&gt;31-&gt;...\n</code></pre> <pre><code>// PC: instruction    | // label: statement\n0: addi r1, r2, 2     |  pc0: r1 = r2 + 2;\n1: subi r2, r1, 1     |  pc1: r2 = r1 - 1;\n2: nop                |  pc2: ;  // no operation\n3: jmp 2              |  pc3: goto pc2;\n</code></pre> <p>\u4ece\u72b6\u6001\u673a\u89c6\u89d2\u7406\u89e3\u7a0b\u5e8f\u8fd0\u884c\uff1a</p> <p>\u4ee5<code>1+2+...+100</code>\u7684\u6307\u4ee4\u5e8f\u5217\u4e3a\u4f8b, \u5c1d\u8bd5\u753b\u51fa\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u72b6\u6001\u673a.</p> <p>\u8fd9\u4e2a\u7a0b\u5e8f\u6bd4\u8f83\u7b80\u5355, \u9700\u8981\u66f4\u65b0\u7684\u72b6\u6001\u53ea\u5305\u62ec<code>PC</code>\u548c<code>r1</code>, <code>r2</code>\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668, \u56e0\u6b64\u6211\u4eec\u7528\u4e00\u4e2a\u4e09\u5143\u7ec4<code>(PC, r1, r2)</code>\u5c31\u53ef\u4ee5\u8868\u793a\u7a0b\u5e8f\u7684\u6240\u6709\u72b6\u6001, \u800c\u65e0\u9700\u753b\u51fa\u5185\u5b58\u7684\u5177\u4f53\u72b6\u6001. </p> <p>\u521d\u59cb\u72b6\u6001\u662f<code>(0, x, x)</code>, \u6b64\u5904\u7684<code>x</code>\u8868\u793a\u672a\u521d\u59cb\u5316. \u7a0b\u5e8f<code>PC=0</code>\u5904\u7684\u6307\u4ee4\u662f<code>mov r1, 0</code>, \u6267\u884c\u5b8c\u4e4b\u540e<code>PC</code>\u4f1a\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4, \u56e0\u6b64\u4e0b\u4e00\u4e2a\u72b6\u6001\u662f<code>(1, 0, x)</code>. \u5982\u6b64\u7c7b\u63a8, \u6211\u4eec\u53ef\u4ee5\u753b\u51fa\u6267\u884c\u524d3\u6761\u6307\u4ee4\u7684\u72b6\u6001\u8f6c\u79fb\u8fc7\u7a0b:</p> <pre><code>(0, x, x) -&gt; (1, 0, x) -&gt; (2, 0, 0) -&gt; (3, 0, 1)....\n</code></pre> <p>\u8bf7\u4f60\u5c1d\u8bd5\u7ee7\u7eed\u753b\u51fa\u8fd9\u4e2a\u72b6\u6001\u673a, \u5176\u4e2d\u7a0b\u5e8f\u4e2d\u7684\u5faa\u73af\u53ea\u9700\u8981\u753b\u51fa\u524d\u4e24\u6b21\u5faa\u73af\u548c\u6700\u540e\u4e24\u6b21\u5faa\u73af\u5373\u53ef.</p> <p>\u6709\u70b9\u602a\uff1fPC\u7684\u987a\u5e8f</p> <p>pc, r1, r2</p> <pre><code>mov r1,0\nmov r2,0\nadd r2, 1\nadd r1, r2\njmp 3\n...\n</code></pre> <p>(0, x, x) -&gt; (1, 0, x) -&gt; (2, 0, 0) -&gt; (3, 0, 1) -&gt; (4, 1, 1) -&gt; (2, 1, 1) -&gt; (3, 1, 2) -&gt; (4, 3, 2) </p> <p>-&gt; (2, 3, 2) -&gt;(3, 3, 3) -&gt;(4, 6, 3) ....--&gt;... (2, 4851, 98) -&gt; (3, 4851, 99) -&gt; (4, 4950, 99) </p> <p>-&gt; (2, 4950, 99) -&gt; (3, 4950, 100) -&gt; (4, 5050, 100) -&gt; (5, 5050, 100)-&gt;...</p> <p>x86\uff1a</p> <p></p> <p>RISC-V\uff1a</p> <p></p> <p>\u8fd9\u79cd\u89c6\u89d2\u548c\u6c47\u7f16\u5bf9\u5e94\u8d77\u6765\u5f88\u50cf\u554a\uff01</p> <p>\u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u4ece\u4e24\u4e2a\u4e92\u8865\u7684\u89c6\u89d2\u6765\u770b\u5f85\u540c\u4e00\u4e2a\u7a0b\u5e8f:</p> <ul> <li>\u4e00\u4e2a\u662f\u4ee5==\u4ee3\u7801(\u6216\u6307\u4ee4\u5e8f\u5217)\u4e3a\u8868\u73b0\u5f62\u5f0f\u7684\u9759\u6001\u89c6\u89d2==, \u5927\u5bb6\u7ecf\u5e38\u8bf4\u7684\"\u5199\u7a0b\u5e8f\"/\"\u770b\u4ee3\u7801\", \u5176\u5b9e\u8bf4\u7684\u90fd\u662f\u8fd9\u4e2a\u9759\u6001\u89c6\u89d2. \u8fd9\u4e2a\u89c6\u89d2\u7684\u4e00\u4e2a\u597d\u5904\u662f\u63cf\u8ff0\u7cbe\u7b80, \u5206\u652f, \u5faa\u73af\u548c\u51fd\u6570\u8c03\u7528\u7684\u7ec4\u5408\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c11\u91cf\u4ee3\u7801\u5b9e\u73b0\u51fa\u5f88\u590d\u6742\u7684\u529f\u80fd. \u4f46\u8fd9\u4e5f\u53ef\u80fd\u4f1a\u4f7f\u5f97\u6211\u4eec\u5bf9\u7a0b\u5e8f\u884c\u4e3a\u7684\u7406\u89e3\u9020\u6210\u56f0\u96be.</li> <li>\u53e6\u4e00\u4e2a\u662f\u4ee5==\u72b6\u6001\u673a\u7684\u72b6\u6001\u8f6c\u79fb\u4e3a\u8fd0\u884c\u6548\u679c\u7684\u52a8\u6001\u89c6\u89d2== , \u5b83\u76f4\u63a5\u523b\u753b\u4e86\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u672c\u8d28. \u4f46\u8fd9\u4e00\u89c6\u89d2\u7684\u72b6\u6001\u6570\u91cf\u975e\u5e38\u5de8\u5927, \u7a0b\u5e8f\u4ee3\u7801\u4e2d\u7684\u6240\u6709\u5faa\u73af\u548c\u51fd\u6570\u8c03\u7528\u90fd\u4ee5\u6307\u4ee4\u7684\u7c92\u5ea6\u88ab\u5b8c\u5168\u5c55\u5f00, \u4f7f\u5f97\u6211\u4eec\u96be\u4ee5\u638c\u63e1\u7a0b\u5e8f\u7684\u6574\u4f53\u8bed\u4e49. \u4f46\u5bf9\u4e8e\u7a0b\u5e8f\u7684\u5c40\u90e8\u884c\u4e3a, \u5c24\u5176\u662f\u4ece\u9759\u6001\u89c6\u89d2\u6765\u770b\u96be\u4ee5\u7406\u89e3\u7684\u884c\u4e3a, \u72b6\u6001\u673a\u89c6\u89d2\u53ef\u4ee5\u8ba9\u6211\u4eec\u6e05\u695a\u5730\u4e86\u89e3\u76f8\u5e94\u7684\u7ec6\u8282.</li> </ul> <p>\u7a0b\u5e8f\u7684\u72b6\u6001\u673a\u89c6\u89d2\u6709\u4ec0\u4e48\u597d\u5904?</p> <p>\u6709\u4e00\u4e9b\u7a0b\u5e8f\u770b\u4e0a\u53bb\u5f88\u7b80\u5355, \u4f46\u884c\u4e3a\u5374\u4e0d\u90a3\u4e48\u76f4\u89c2, \u6bd4\u5982\u9012\u5f52. \u8981\u5f88\u597d\u5730\u7406\u89e3\u9012\u5f52\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u5982\u4f55\u8fd0\u884c, \u4ece\u72b6\u6001\u673a\u89c6\u89d2\u6765\u770b\u7a0b\u5e8f\u884c\u4e3a\u624d\u662f\u6700\u6709\u6548\u7684\u505a\u6cd5, \u56e0\u4e3a\u8fd9\u4e00\u89c6\u89d2\u53ef\u4ee5\u5e2e\u52a9\u4f60\u7406\u6e05\u6bcf\u4e00\u6761\u6307\u4ee4\u7a76\u7adf\u5982\u4f55\u4fee\u6539\u8ba1\u7b97\u673a\u7684\u72b6\u6001, \u4ece\u800c\u5b9e\u73b0\u5b8f\u89c2\u4e0a\u7684\u9012\u5f52\u8bed\u4e49. </p> <p>ICS\u7406\u8bba\u8bfe\u7684\u7b2c\u4e09\u7ae0\u4f1a\u4e13\u95e8\u5206\u6790\u5176\u4e2d\u7684\u7ec6\u8282</p> <p>\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u5fae\u89c2\u89c6\u89d2: \u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a </p> <p>\"\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a\"\u8fd9\u4e00\u89c6\u89d2\u5bf9ICS\u548cPA\u6765\u8bf4\u90fd\u662f\u975e\u5e38\u91cd\u8981\u7684, \u56e0\u4e3a\"\u7406\u89e3\u7a0b\u5e8f\u5982\u4f55\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u5c31\u662fICS\u548cPA\u7684\u6839\u672c\u76ee\u6807. \u81f3\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u5b8f\u89c2\u89c6\u89d2, \u6211\u4eec\u5c06\u4f1a\u5728PA\u7684\u4e2d\u671f\u6765\u4ecb\u7ecd.</p> <p>\u76ee\u7684\uff1a\u517b\u6210\u4ece\u72b6\u6001\u673a\u7684\u89c6\u89d2\u6765\u7406\u89e3\u7a0b\u5e8f\u884c\u4e3a\u7684\u610f\u8bc6\u3002</p> <p>\u4e00\u5927\u5806\u6570\u5b57\u903b\u8f91\u7535\u8def\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u65f6\u5e8f + \u7ec4\u5408\uff0c\u6784\u6210\u4e86\u8ba1\u7b97\u673a\u8fd9\u4e2a\u5de8\u65e0\u9738\u3002</p> <ul> <li> <p>\u5076\u5c14\u770b\u5230\uff1a</p> <p>(94 \u5c01\u79c1\u4fe1 / 80 \u6761\u6d88\u606f) \u4ec0\u4e48\u624d\u7b97\u662f\u771f\u6b63\u7684\u7f16\u7a0b\u80fd\u529b\uff1f</p> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#rtfsc","title":"RTFSC","text":""},{"location":"ysyx/pa/pa1/pa1.html#nemu","title":"NEMU \u7ed3\u6784","text":"<ul> <li>CPU</li> <li>memory</li> <li>monitor</li> <li>\u8bbe\u5907 device \uff08PA2\u4ecb\u7ecd\uff09</li> </ul> <p>Monitor(\u76d1\u89c6\u5668)\u6a21\u5757\u662f\u4e3a\u4e86\u65b9\u4fbf\u5730\u76d1\u63a7\u5ba2\u6237\u8ba1\u7b97\u673a\u7684\u8fd0\u884c\u72b6\u6001\u800c\u5f15\u5165\u7684. \u5b83\u9664\u4e86\u8d1f\u8d23\u4e0eGNU/Linux\u8fdb\u884c\u4ea4\u4e92(\u4f8b\u5982\u8bfb\u5165\u5ba2\u6237\u7a0b\u5e8f)\u4e4b\u5916, \u8fd8\u5e26\u6709\u8c03\u8bd5\u5668\u7684\u529f\u80fd, \u4e3aNEMU\u7684\u8c03\u8bd5\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684\u9014\u5f84. </p> <p>\u4ece\u6982\u5ff5\u4e0a\u6765\u8bf4, monitor\u5e76\u4e0d\u5c5e\u4e8e\u4e00\u4e2a\u8ba1\u7b97\u673a\u7684\u5fc5\u8981\u7ec4\u6210\u90e8\u5206, \u4f46\u5bf9NEMU\u6765\u8bf4, \u5b83\u662f\u5fc5\u8981\u7684\u57fa\u7840\u8bbe\u65bd. \u5982\u679c\u7f3a\u5c11monitor\u6a21\u5757, \u5bf9NEMU\u7684\u8c03\u8bd5\u5c06\u4f1a\u53d8\u5f97\u5341\u5206\u56f0\u96be.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_6","title":"\u6846\u67b6\u4ee3\u7801","text":"<pre><code>ysyx-workbench\n\u251c\u2500\u2500 abstract-machine   # \u62bd\u8c61\u8ba1\u7b97\u673a\n\u251c\u2500\u2500 am-kernels         # \u57fa\u4e8e\u62bd\u8c61\u8ba1\u7b97\u673a\u5f00\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\n\u251c\u2500\u2500 fceux-am           # \u7ea2\u767d\u673a\u6a21\u62df\u5668\n\u251c\u2500\u2500 init.sh            # \u521d\u59cb\u5316\u811a\u672c\n\u251c\u2500\u2500 Makefile           # \u7528\u4e8e\u5de5\u7a0b\u6253\u5305\u63d0\u4ea4\n\u251c\u2500\u2500 nemu               # NEMU\n\u2514\u2500\u2500 README.md\n</code></pre> <pre><code>nemu\n\u251c\u2500\u2500 configs                    # \u9884\u5148\u63d0\u4f9b\u7684\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 include                    # \u5b58\u653e\u5168\u5c40\u4f7f\u7528\u7684\u5934\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 common.h               # \u516c\u7528\u7684\u5934\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 config                 # \u914d\u7f6e\u7cfb\u7edf\u751f\u6210\u7684\u5934\u6587\u4ef6, \u7528\u4e8e\u7ef4\u62a4\u914d\u7f6e\u9009\u9879\u66f4\u65b0\u7684\u65f6\u95f4\u6233\n\u2502   \u251c\u2500\u2500 cpu\n\u2502   \u2502   \u251c\u2500\u2500 cpu.h\n\u2502   \u2502   \u251c\u2500\u2500 decode.h           # \u8bd1\u7801\u76f8\u5173\n\u2502   \u2502   \u251c\u2500\u2500 difftest.h\n\u2502   \u2502   \u2514\u2500\u2500 ifetch.h           # \u53d6\u6307\u76f8\u5173\n\u2502   \u251c\u2500\u2500 debug.h                # \u4e00\u4e9b\u65b9\u4fbf\u8c03\u8bd5\u7528\u7684\u5b8f\n\u2502   \u251c\u2500\u2500 device                 # \u8bbe\u5907\u76f8\u5173\n\u2502   \u251c\u2500\u2500 difftest-def.h\n\u2502   \u251c\u2500\u2500 generated\n\u2502   \u2502   \u2514\u2500\u2500 autoconf.h         # \u914d\u7f6e\u7cfb\u7edf\u751f\u6210\u7684\u5934\u6587\u4ef6, \u7528\u4e8e\u6839\u636e\u914d\u7f6e\u4fe1\u606f\u5b9a\u4e49\u76f8\u5173\u7684\u5b8f\n\u2502   \u251c\u2500\u2500 isa.h                  # ISA\u76f8\u5173\n\u2502   \u251c\u2500\u2500 macro.h                # \u4e00\u4e9b\u65b9\u4fbf\u7684\u5b8f\u5b9a\u4e49\n\u2502   \u251c\u2500\u2500 memory                 # \u8bbf\u95ee\u5185\u5b58\u76f8\u5173\n\u2502   \u2514\u2500\u2500 utils.h\n\u251c\u2500\u2500 Kconfig                    # \u914d\u7f6e\u4fe1\u606f\u7ba1\u7406\u7684\u89c4\u5219\n\u251c\u2500\u2500 Makefile                   # Makefile\u6784\u5efa\u811a\u672c\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 resource                   # \u4e00\u4e9b\u8f85\u52a9\u8d44\u6e90\n\u251c\u2500\u2500 scripts                    # Makefile\u6784\u5efa\u811a\u672c\n\u2502   \u251c\u2500\u2500 build.mk\n\u2502   \u251c\u2500\u2500 config.mk\n\u2502   \u251c\u2500\u2500 git.mk                 # git\u7248\u672c\u63a7\u5236\u76f8\u5173\n\u2502   \u2514\u2500\u2500 native.mk\n\u251c\u2500\u2500 src                        # \u6e90\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 cpu\n\u2502   \u2502   \u2514\u2500\u2500 cpu-exec.c         # \u6307\u4ee4\u6267\u884c\u7684\u4e3b\u5faa\u73af\n\u2502   \u251c\u2500\u2500 device                 # \u8bbe\u5907\u76f8\u5173\n\u2502   \u251c\u2500\u2500 engine\n\u2502   \u2502   \u2514\u2500\u2500 interpreter        # \u89e3\u91ca\u5668\u7684\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 filelist.mk\n\u2502   \u251c\u2500\u2500 isa                    # ISA\u76f8\u5173\u7684\u5b9e\u73b0\n\u2502   \u2502   \u251c\u2500\u2500 mips32\n\u2502   \u2502   \u251c\u2500\u2500 riscv32\n\u2502   \u2502   \u251c\u2500\u2500 riscv64\n\u2502   \u2502   \u2514\u2500\u2500 x86\n\u2502   \u251c\u2500\u2500 memory                 # \u5185\u5b58\u8bbf\u95ee\u7684\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 monitor\n\u2502   \u2502   \u251c\u2500\u2500 monitor.c          # \n\u2502   \u2502   \u2514\u2500\u2500 sdb                # \u7b80\u6613\u8c03\u8bd5\u5668\n\u2502   \u2502       \u251c\u2500\u2500 expr.c         # \u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u5b9e\u73b0\n\u2502   \u2502       \u251c\u2500\u2500 sdb.c          # \u7b80\u6613\u8c03\u8bd5\u5668\u7684\u547d\u4ee4\u5904\u7406\n\u2502   \u2502       \u2514\u2500\u2500 watchpoint.c   # \u76d1\u89c6\u70b9\u7684\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 nemu-main.c            # \u4f60\u77e5\u9053\u7684...\n\u2502   \u2514\u2500\u2500 utils                  # \u4e00\u4e9b\u516c\u5171\u7684\u529f\u80fd\n\u2502       \u251c\u2500\u2500 log.c              # \u65e5\u5fd7\u6587\u4ef6\u76f8\u5173\n\u2502       \u251c\u2500\u2500 rand.c\n\u2502       \u251c\u2500\u2500 state.c\n\u2502       \u2514\u2500\u2500 timer.c\n\u2514\u2500\u2500 tools                      # \u4e00\u4e9b\u5de5\u5177\n    \u251c\u2500\u2500 fixdep                 # \u4f9d\u8d56\u4fee\u590d, \u914d\u5408\u914d\u7f6e\u7cfb\u7edf\u8fdb\u884c\u4f7f\u7528\n    \u251c\u2500\u2500 gen-expr\n    \u251c\u2500\u2500 kconfig                # \u914d\u7f6e\u7cfb\u7edf\n    \u251c\u2500\u2500 kvm-diff\n    \u251c\u2500\u2500 qemu-diff\n    \u2514\u2500\u2500 spike-diff\n</code></pre> <p>\u4e3a\u4e86\u652f\u6301\u4e0d\u540c\u7684ISA, \u6846\u67b6\u4ee3\u7801\u628aNEMU\u5206\u6210\u4e24\u90e8\u5206: </p> <ul> <li>ISA\u65e0\u5173\u7684\u57fa\u672c\u6846\u67b6</li> <li>ISA\u76f8\u5173\u7684\u5177\u4f53\u5b9e\u73b0. </li> </ul> <p>NEMU\u628aISA\u76f8\u5173\u7684\u4ee3\u7801\u4e13\u95e8\u653e\u5728 <code>nemu/src/isa/</code> \u76ee\u5f55\u4e0b, \u5e76\u901a\u8fc7 <code>nemu/include/isa.h</code> \u63d0\u4f9bISA\u76f8\u5173API\u7684\u58f0\u660e. \u8fd9\u6837\u4ee5\u540e, <code>nemu/src/isa/</code>\u4e4b\u5916\u7684\u5176\u5b83\u4ee3\u7801\u5c31\u5c55\u793a\u4e86NEMU\u7684\u57fa\u672c\u6846\u67b6. \u8fd9\u6837\u505a\u6709\u4e24\u70b9\u597d\u5904:</p> <ul> <li> <p>\u6709\u52a9\u4e8e\u6211\u4eec\u8ba4\u8bc6\u4e0d\u540cISA\u7684\u5171\u540c\u70b9: \u65e0\u8bba\u662f\u54ea\u79cdISA\u7684\u5ba2\u6237\u8ba1\u7b97\u673a, \u5b83\u4eec\u90fd\u5177\u6709\u76f8\u540c\u7684\u57fa\u672c\u6846\u67b6</p> </li> <li> <p>\u4f53\u73b0\u62bd\u8c61\u7684\u601d\u60f3: \u6846\u67b6\u4ee3\u7801\u5c06ISA\u4e4b\u95f4\u7684\u5dee\u5f02\u62bd\u8c61\u6210API, \u57fa\u672c\u6846\u67b6\u4f1a\u8c03\u7528\u8fd9\u4e9bAPI, \u4ece\u800c\u65e0\u9700\u5173\u5fc3ISA\u7684\u5177\u4f53\u7ec6\u8282. \u5982\u679c\u4f60\u5c06\u6765\u6253\u7b97\u9009\u62e9\u4e00\u4e2a\u4e0d\u540c\u7684ISA\u6765\u8fdb\u884c\u4e8c\u5468\u76ee\u7684\u653b\u7565, \u4f60\u5c31\u80fd\u660e\u663e\u4f53\u4f1a\u5230\u62bd\u8c61\u7684\u597d\u5904\u4e86: \u57fa\u672c\u6846\u67b6\u7684\u4ee3\u7801\u5b8c\u5168\u4e0d\u7528\u4fee\u6539!</p> <p>NEMU ISA\u76f8\u5173\u7684API\u8bf4\u660e\u6587\u6863 | \u5b98\u65b9\u6587\u6863 (oscc.cc)</p> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_7","title":"\u914d\u7f6e\u7cfb\u7edf\u548c\u9879\u76ee\u6784\u5efa","text":"<p>\u5728\u4e00\u4e2a\u6709\u4e00\u5b9a\u89c4\u6a21\u7684\u9879\u76ee\u4e2d, \u53ef\u914d\u7f6e\u9009\u9879\u7684\u6570\u91cf\u53ef\u80fd\u4f1a\u975e\u5e38\u591a, \u800c\u4e14\u914d\u7f6e\u9009\u9879\u4e4b\u95f4\u53ef\u80fd\u4f1a\u5b58\u5728\u5173\u8054, \u6bd4\u5982\u6253\u5f00\u914d\u7f6e\u9009\u9879A\u4e4b\u540e, \u914d\u7f6e\u9009\u9879B\u5c31\u5fc5\u987b\u662f\u67d0\u4e2a\u503c. </p> <p>\u76f4\u63a5\u8ba9\u5f00\u53d1\u8005\u53bb\u7ba1\u7406\u8fd9\u4e9b\u914d\u7f6e\u9009\u9879\u662f\u5f88\u5bb9\u6613\u51fa\u9519\u7684, \u6bd4\u5982\u4fee\u6539\u9009\u9879A\u4e4b\u540e, \u53ef\u80fd\u4f1a\u5fd8\u8bb0\u4fee\u6539\u548c\u9009\u9879A\u6709\u5173\u8054\u7684\u9009\u9879B. </p> <p>\u914d\u7f6e\u7cfb\u7edf\u7684\u51fa\u73b0\u5219\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898.</p>"},{"location":"ysyx/pa/pa1/pa1.html#kconfig","title":"\u914d\u7f6e\u7cfb\u7edfkconfig","text":"<pre><code>nemu/tools/kconfig\n</code></pre> <p>\u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u8fd9\u5957\u8bed\u8a00\u6765\u7f16\u5199\"\u914d\u7f6e\u63cf\u8ff0\u6587\u4ef6\". \u5728\"\u914d\u7f6e\u63cf\u8ff0\u6587\u4ef6\"\u4e2d, \u5f00\u53d1\u8005\u53ef\u4ee5\u63cf\u8ff0:</p> <ul> <li>\u914d\u7f6e\u9009\u9879\u7684\u5c5e\u6027, \u5305\u62ec\u7c7b\u578b, \u9ed8\u8ba4\u503c\u7b49</li> <li>\u4e0d\u540c\u914d\u7f6e\u9009\u9879\u4e4b\u95f4\u7684\u5173\u7cfb</li> <li>\u914d\u7f6e\u9009\u9879\u7684\u5c42\u6b21\u5173\u7cfb</li> </ul> <p>\u76ee\u524d\u4ec5\u5173\u6ce8\u914d\u7f6e\u7cfb\u7edf\u751f\u6210\u7684\uff1a</p> <ul> <li><code>nemu/include/generated/autoconf.h</code>, \u9605\u8bfbC\u4ee3\u7801\u65f6\u4f7f\u7528</li> <li><code>nemu/include/config/auto.conf</code>, \u9605\u8bfbMakefile\u65f6\u4f7f\u7528</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#makefile","title":"\u9879\u76ee\u6784\u5efa\u548cMakefile","text":"<pre><code># Sanity check\nifeq ($(wildcard $(NEMU_HOME)/src/nemu-main.c),)\n  $(error NEMU_HOME=$(NEMU_HOME) is not a NEMU repo)\nendif\n\n# Include variables and rules generated by menuconfig\n-include $(NEMU_HOME)/include/config/auto.conf\n-include $(NEMU_HOME)/include/config/auto.conf.cmd\n\nremove_quote = $(patsubst \"%\",%,$(1))\n\n# Extract variabls from menuconfig\nGUEST_ISA ?= $(call remove_quote,$(CONFIG_ISA))\nENGINE ?= $(call remove_quote,$(CONFIG_ENGINE))\nNAME    = $(GUEST_ISA)-nemu-$(ENGINE)\n\n# Include all filelist.mk to merge file lists\nFILELIST_MK = $(shell find -L ./src -name \"filelist.mk\")\ninclude $(FILELIST_MK)\n\n# Filter out directories and files in blacklist to obtain the final set of source files\nDIRS-BLACKLIST-y += $(DIRS-BLACKLIST)\nSRCS-BLACKLIST-y += $(SRCS-BLACKLIST) $(shell find -L $(DIRS-BLACKLIST-y) -name \"*.c\")\nSRCS-y += $(shell find -L $(DIRS-y) -name \"*.c\")\nSRCS = $(filter-out $(SRCS-BLACKLIST-y),$(SRCS-y))\n\n# Extract compiler and options from menuconfig\nCC = $(call remove_quote,$(CONFIG_CC))\nCFLAGS_BUILD += $(call remove_quote,$(CONFIG_CC_OPT))\nCFLAGS_BUILD += $(if $(CONFIG_CC_LTO),-flto,)\nCFLAGS_BUILD += $(if $(CONFIG_CC_DEBUG),-Og -ggdb3,)\nCFLAGS_BUILD += $(if $(CONFIG_CC_ASAN),-fsanitize=address,)\nCFLAGS_TRACE += -DITRACE_COND=$(if $(CONFIG_ITRACE_COND),$(call remove_quote,$(CONFIG_ITRACE_COND)),true)\nCFLAGS  += $(CFLAGS_BUILD) $(CFLAGS_TRACE) -D__GUEST_ISA__=$(GUEST_ISA)\n\n# Linker configuration options\nLDFLAGS += $(CFLAGS_BUILD)\n\n# Include rules for menuconfig\ninclude $(NEMU_HOME)/scripts/config.mk\n\n# Target Architecture and Build Rules\nifdef CONFIG_TARGET_AM\ninclude $(AM_HOME)/Makefile\nLINKAGE += $(ARCHIVES)\nelse\n# Include rules to build NEMU\ninclude $(NEMU_HOME)/scripts/native.mk\nendif\n</code></pre> <p>Makefile \u6846\u67b6\uff1a\u81ea\u52a8\u5316NEMU\u7684\u6a21\u62df\u5668\u6784\u5efa\u8fc7\u7a0b\u3002</p> <ol> <li>\u9996\u5148\u68c0\u67e5\u5fc5\u8981\u7684\u914d\u7f6e\u548c\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002<ol> <li>Sanity check</li> <li>Include variables and rules generated by menuconfig</li> <li>Extract variabls from menuconfig</li> </ol> </li> <li>\u518d\u6839\u636e\u7528\u6237\u914d\u7f6e\u9009\u9879\u6765\u6700\u7ec8\u786e\u5b9a\u7f16\u8bd1\u76ee\u6807\u3001\u6e90\u6587\u4ef6\u3001\u7f16\u8bd1\u9009\u9879\u3002<ol> <li>Include all filelist.mk to merge file lists</li> <li>Filter out directories and files in blacklist to obtain the final set of source files</li> <li>Extract compiler and options from menuconfig</li> <li>Linker configuration options</li> <li>Include rules for menuconfig</li> <li>Target Architecture and Build Rules</li> </ol> </li> </ol> <ul> <li> <p>\u4e0e\u914d\u7f6e\u7cfb\u7edf\u5173\u8054</p> <p>\u901a\u8fc7\u5305\u542b<code>nemu/include/config/auto.conf</code>, \u4e0ekconfig\u751f\u6210\u7684\u53d8\u91cf\u8fdb\u884c\u5173\u8054. </p> <p>\u56e0\u6b64\u5728\u901a\u8fc7menuconfig\u66f4\u65b0\u914d\u7f6e\u9009\u9879\u540e, Makefile\u7684\u884c\u4e3a\u53ef\u80fd\u4e5f\u4f1a\u6709\u6240\u53d8\u5316.</p> </li> <li> <p>\u6587\u4ef6\u5217\u8868 (filelist)</p> <p>\u901a\u8fc7\u6587\u4ef6\u5217\u8868(filelist)\u51b3\u5b9a\u6700\u7ec8\u53c2\u4e0e\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6. </p> <p>\u5728<code>nemu/src</code>\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u5b58\u5728\u4e00\u4e9b\u540d\u4e3a<code>filelist.mk</code>\u7684\u6587\u4ef6, \u5b83\u4eec\u4f1a\u6839\u636emenuconfig\u7684\u914d\u7f6e\u5bf9\u5982\u4e0b4\u4e2a\u53d8\u91cf\u8fdb\u884c\u7ef4\u62a4:</p> <ul> <li><code>SRCS-y</code> - \u53c2\u4e0e\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u7684\u5019\u9009\u96c6\u5408</li> <li><code>SRCS-BLACKLIST-y</code> - \u4e0d\u53c2\u4e0e\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u7684\u9ed1\u540d\u5355\u96c6\u5408</li> <li><code>DIRS-y</code> - \u53c2\u4e0e\u7f16\u8bd1\u7684\u76ee\u5f55\u96c6\u5408, \u8be5\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u52a0\u5165\u5230<code>SRCS-y</code>\u4e2d</li> <li><code>DIRS-BLACKLIST-y</code> - \u4e0d\u53c2\u4e0e\u7f16\u8bd1\u7684\u76ee\u5f55\u96c6\u5408, \u8be5\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u52a0\u5165\u5230<code>SRCS-BLACKLIST-y</code>\u4e2d</li> </ul> <p>Makefile\u4f1a\u5305\u542b\u9879\u76ee\u4e2d\u7684\u6240\u6709<code>filelist.mk</code>\u6587\u4ef6, \u5bf9\u4e0a\u8ff04\u4e2a\u53d8\u91cf\u7684\u8ffd\u52a0\u5b9a\u4e49\u8fdb\u884c\u6c47\u603b, \u6700\u7ec8\u4f1a\u8fc7\u6ee4\u51fa\u5728<code>SRCS-y</code>\u4e2d\u4f46\u4e0d\u5728<code>SRCS-BLACKLIST-y</code>\u4e2d\u7684\u6e90\u6587\u4ef6, \u6765\u4f5c\u4e3a\u6700\u7ec8\u53c2\u4e0e\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u7684\u96c6\u5408.</p> <p>More\uff1a</p> <p>\u4e0a\u8ff04\u4e2a\u53d8\u91cf\u8fd8\u53ef\u4ee5\u4e0emenuconfig\u7684\u914d\u7f6e\u7ed3\u679c\u4e2d\u7684\u5e03\u5c14\u9009\u9879\u8fdb\u884c\u5173\u8054, </p> <p>\u4f8b\u5982<code>DIRS-BLACKLIST-$(CONFIG_TARGET_AM) += src/monitor/sdb</code>, </p> <ul> <li> <p>\u5f53\u6211\u4eec\u5728menuconfig\u4e2d\u9009\u62e9\u4e86<code>TARGET_AM</code>\u76f8\u5173\u7684\u5e03\u5c14\u9009\u9879\u65f6, kconfig\u6700\u7ec8\u4f1a\u5728<code>nemu/include/config/auto.conf</code>\u4e2d\u751f\u6210\u5f62\u5982<code>CONFIG_TARGET_AM=y</code>\u7684\u4ee3\u7801, \u5bf9\u53d8\u91cf\u8fdb\u884c\u5c55\u5f00\u540e\u5c06\u4f1a\u5f97\u5230<code>DIRS-BLACKLIST-y += src/monitor/sdb</code>; </p> </li> <li> <p>\u5f53\u6211\u4eec\u5728menuconfig\u4e2d\u672a\u9009\u62e9<code>TARGET_AM</code>\u76f8\u5173\u7684\u5e03\u5c14\u9009\u9879\u65f6, kconfig\u5c06\u4f1a\u751f\u6210\u5f62\u5982<code>CONFIG_TARGET_AM=n</code>\u7684\u4ee3\u7801, \u6216\u8005\u672a\u5bf9<code>CONFIG_TARGET_AM</code>\u8fdb\u884c\u5b9a\u4e49, \u6b64\u65f6\u5c06\u4f1a\u5f97\u5230<code>DIRS-BLACKLIST-n += src/monitor/sdb</code>, \u6216\u8005<code>DIRS-BLACKLIST- += src/monitor/sdb</code>, \u8fd9\u4e24\u79cd\u60c5\u51b5\u90fd\u4e0d\u4f1a\u5f71\u54cd<code>DIRS-BLACKLIST-y</code>\u7684\u503c, \u4ece\u800c\u5b9e\u73b0\u4e86\u5982\u4e0b\u6548\u679c:</p> </li> </ul> <pre><code>\u5728menuconfig\u4e2d\u9009\u4e2dTARGET_AM\u65f6, nemu/src/monitor/sdb\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4e0d\u4f1a\u53c2\u4e0e\u7f16\u8bd1.\n</code></pre> </li> <li> <p>\u7f16\u8bd1\u548c\u94fe\u63a5</p> <p>Makefile\u7684\u7f16\u8bd1\u89c4\u5219\u5728<code>nemu/scripts/build.mk</code>\u4e2d\u5b9a\u4e49:</p> <pre><code>$(OBJ_DIR)/%.o: %.c\n  @echo + CC $&lt;\n  @mkdir -p $(dir $@)\n  @$(CC) $(CFLAGS) -c -o $@ $&lt;\n  $(call call_fixdep, $(@:.o=.d), $@)\n</code></pre> <p><code>call_fixdep</code>\u7684\u8c03\u7528\u7528\u4e8e\u751f\u6210\u66f4\u5408\u7406\u7684\u4f9d\u8d56\u5173\u7cfb, \u76ee\u524d\u6211\u4eec\u4e3b\u8981\u5173\u6ce8\u7f16\u8bd1\u7684\u547d\u4ee4, \u56e0\u6b64\u53ef\u4ee5\u5148\u5ffd\u7565<code>call_fixdep</code>.</p> <p>\u6211\u4eec\u53ef\u4ee5\u5148\u67e5\u770b<code>make</code>\u8fc7\u7a0b\u4e2d\u90fd\u8fd0\u884c\u4e86\u54ea\u4e9b\u547d\u4ee4, \u7136\u540e\u53cd\u8fc7\u6765\u7406\u89e3<code>$(CFLAGS)</code>\u7b49\u53d8\u91cf\u7684\u503c. </p> <p>\u4e3a\u6b64, \u6211\u4eec\u53ef\u4ee5\u952e\u5165<code>make -nB</code>, \u5b83\u4f1a\u8ba9<code>make</code>\u7a0b\u5e8f\u4ee5\"\u53ea\u8f93\u51fa\u547d\u4ee4\u4f46\u4e0d\u6267\u884c\"\u7684\u65b9\u5f0f\u5f3a\u5236\u6784\u5efa\u76ee\u6807. </p> <p>Tips\uff1a\u4e5f\u662f\u4e00\u4e2a\u67e5\u770b\u5b66\u4e60\u5927\u578b\u9879\u76eeMakefile\u7684\u597d\u65b9\u6cd5\uff1a\u53ea\u8f93\u51fa\u547d\u4ee4\u4f46\u4e0d\u8fd0\u884c <code>make -nB</code></p> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_8","title":"\u51c6\u5907\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7a0b\u5e8f","text":"<p>\u5c31\u50cf\u4e16\u754c\u4e0a\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\u662f\u600e\u4e48\u8ba9\u4ed6\u88c5\u8f7d\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\u8d77\u6765\u7684\uff1f\u624b\u52a8\u88c5\u8f7d\u554a\uff01</p> <p>\u3010\u62d3\u5c55\u3011\uff1a</p> <p>BIOS\u548c\u8ba1\u7b97\u673a\u542f\u52a8</p> <p>\u6211\u4eec\u77e5\u9053\u5185\u5b58\u662f\u4e00\u79cdRAM, \u662f\u4e00\u79cd\u6613\u5931\u6027\u7684\u5b58\u50a8\u4ecb\u8d28, \u8fd9\u610f\u5473\u7740\u8ba1\u7b97\u673a\u521a\u542f\u52a8\u7684\u65f6\u5019, \u5185\u5b58\u4e2d\u7684\u6570\u636e\u90fd\u662f\u65e0\u610f\u4e49\u7684; \u800cBIOS\u662f\u56fa\u5316\u5728ROM/Flash\u4e2d\u7684, \u5b83\u4eec\u90fd\u662f\u975e\u6613\u5931\u6027\u7684\u5b58\u50a8\u4ecb\u8d28, BIOS\u4e2d\u7684\u5185\u5bb9\u4e0d\u4f1a\u56e0\u4e3a\u65ad\u7535\u800c\u4e22\u5931.</p> <p>\u56e0\u6b64\u5728\u771f\u5b9e\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d, \u8ba1\u7b97\u673a\u542f\u52a8\u540e\u9996\u5148\u4f1a\u628a\u63a7\u5236\u6743\u4ea4\u7ed9BIOS, BIOS\u7ecf\u8fc7\u4e00\u7cfb\u5217\u521d\u59cb\u5316\u5de5\u4f5c\u4e4b\u540e, \u518d\u4ece\u78c1\u76d8\u4e2d\u5c06\u6709\u610f\u4e49\u7684\u7a0b\u5e8f\u8bfb\u5165\u5185\u5b58\u4e2d\u6267\u884c. \u5bf9\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6a21\u62df\u9700\u8981\u4e86\u89e3\u5f88\u591a\u8d85\u51fa\u672c\u8bfe\u7a0b\u8303\u56f4\u7684\u7ec6\u8282, </p> <p>\u6211\u4eec\u5728PA\u4e2d\u505a\u4e86\u7b80\u5316: \u91c7\u53d6\u7ea6\u5b9a\u7684\u65b9\u5f0f\u8ba9CPU\u76f4\u63a5\u4ece\u7ea6\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e\u5f00\u59cb\u6267\u884c.</p> <p>\u3010\u5267\u900f\u3011\uff1a</p> <p>\u4f60\u4f7f\u7528windows\u7684\u65f6\u5019, \u5f00\u673a\u8fc7\u7a0b\u4e00\u822c\u90fd\u4f1a\u64ad\u653e\u76f8\u5e94\u7684\u5f00\u673a\u52a8\u753b, \u7136\u540e\u4e0d\u77e5\u9053\u600e\u4e48\u5c31\u8fdb\u5165\u767b\u5f55\u753b\u9762\u4e86, \u8fd9\u663e\u7136\u4e0d\u80fd\u6ee1\u8db3CSer\u7684\u6c42\u77e5\u6b32. \u4e8b\u5b9e\u4e0a, \u5728GNU/Linux\u4e2d, \u4f60\u53ef\u4ee5\u5f88\u5bb9\u6613\u5f97\u77e5\u64cd\u4f5c\u7cfb\u7edf\u5728\u80cc\u540e\u505a\u4e86\u4e9b\u4ec0\u4e48. \u952e\u5165<code>sudo dmesg</code>, \u5c31\u53ef\u4ee5\u8f93\u51fa\u64cd\u4f5c\u7cfb\u7edf\u7684\u542f\u52a8\u65e5\u5fd7, \u64cd\u4f5c\u7cfb\u7edf\u7684\u884c\u4e3a\u4e00\u89c8\u65e0\u4f59.</p> <p>\u4e0d\u8fc7, \u76ee\u524d\u4f60\u7684\u77e5\u8bc6\u53ef\u80fd\u8fd8\u65e0\u6cd5\u7406\u89e3\u5176\u4e2d\u7684\u5965\u79d8. \u4f46\u4f60\u65e0\u9700\u4e3a\u6b64\u611f\u5230\u6cae\u4e27, \u5728PA\u7684\u4e2d\u540e\u671f, \u4f60\u5c06\u4f1a\u5728NEMU\u4e0a\u8fd0\u884c\u4e00\u4e2a\u5c0f\u578b\u64cd\u4f5c\u7cfb\u7edfNanos-lite. \u867d\u7136\u548cGNU/Linux\u76f8\u6bd4, Nanos-lite\u53ef\u4ee5\u8bf4\u662f\u6ca7\u6d77\u4e00\u7c9f, \u4f46\u4f60\u5c06\u4f1a\u5b8c\u5168\u660e\u767d\u64cd\u4f5c\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5173\u952e\u6b65\u9aa4, \u64cd\u4f5c\u7cfb\u7edf\u7684\u5927\u95e8\u4e5f\u5c06\u4f1a\u4e3a\u4f60\u655e\u5f00.</p> <p>\u6211\u4eec\u7684\u5ba2\u6237\u7a0b\u5e8f\u4e00\u5f00\u59cb\u5e76\u4e0d\u5728\u5ba2\u6237\u8ba1\u7b97\u673a\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u624b\u52a8\u5730\u5c06\u5ba2\u6237\u7a0b\u5e8f\u8bfb\u5165\u5230\u5ba2\u6237\u8ba1\u7b97\u673a\u4e2d\u3002----&gt; \u4ea4\u7ed9 <code>monitor</code> \u8d1f\u8d23\uff1aRTFSC</p> <ol> <li> <p>\u641e\u61c2 <code>init_monitor()</code> </p> <pre><code>void init_monitor(int argc, char *argv[]) {\n  /* Perform some global initialization. */\n\n  /* Parse arguments. */\n  parse_args(argc, argv);\n\n  /* Set random seed. */\n  init_rand();\n\n  /* Open the log file. */\n  init_log(log_file);\n\n  /* Initialize memory. */\n  init_mem();\n\n  /* Initialize devices. */\n  IFDEF(CONFIG_DEVICE, init_device());\n\n  /* Perform ISA dependent initialization. */\n  init_isa();\n\n  /* Load the image to memory. This will overwrite the built-in image. */\n  long img_size = load_img();\n\n  /* Initialize differential testing. */\n  init_difftest(diff_so_file, img_size, difftest_port);\n\n  /* Initialize the simple debugger. */\n  init_sdb();\n\n#ifndef CONFIG_ISA_loongarch32r\n  IFDEF(CONFIG_ITRACE, init_disasm(\n    MUXDEF(CONFIG_ISA_x86,     \"i686\",\n    MUXDEF(CONFIG_ISA_mips32,  \"mipsel\",\n    MUXDEF(CONFIG_ISA_riscv,\n      MUXDEF(CONFIG_RV64,      \"riscv64\",\n                               \"riscv32\"),\n                               \"bad\"))) \"-pc-linux-gnu\"\n  ));\n#endif\n\n  /* Display welcome message. */\n  welcome();\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\u7684\u4ee3\u7801\u90fd\u662f\u51fd\u6570\u8c03\u7528\uff0c\u6309\u9053\u7406\u8bb2\uff0c\u628a\u76f8\u5e94\u7684\u51fd\u6570\u4f53\u5728<code>init_monitor()</code>\u4e2d\u5c55\u5f00\u4e5f\u4e0d\u5f71\u54cd\u4ee3\u7801\u7684\u6b63\u786e\u6027. \u76f8\u6bd4\u4e4b\u4e0b, \u5728\u8fd9\u91cc\u4f7f\u7528\u51fd\u6570\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f</p> <ol> <li> <p>\u6a21\u5757\u5316\uff1a\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u4ee3\u8868\u4e00\u4e2a\u6a21\u5757\u5316\u7684\u7ec4\u4ef6\uff0c\u8fd9\u4f7f\u5f97\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\u548c\u6613\u4e8e\u7ba1\u7406\u3002\u6bcf\u4e2a\u51fd\u6570\u53ef\u4ee5\u72ec\u7acb\u4e8e\u5176\u4ed6\u51fd\u6570\u8fdb\u884c\u6d4b\u8bd5\u3001\u8c03\u8bd5\u548c\u7ef4\u62a4\u3002</p> </li> <li> <p>\u53ef\u91cd\u7528\u6027\uff1a\u901a\u8fc7\u5c06\u4ee3\u7801\u5c01\u88c5\u5728\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u91cd\u7528\u8fd9\u4e9b\u51fd\u6570\uff0c\u51cf\u5c11\u91cd\u590d\u4ee3\u7801\uff0c\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u3002</p> </li> <li> <p>\u53ef\u8bfb\u6027\uff1a\u51fd\u6570\u8c03\u7528\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u9ad8\u5c42\u6b21\u7684\u62bd\u8c61\uff0c\u4f7f\u5f97\u9605\u8bfb\u8005\u53ef\u4ee5\u5feb\u901f\u7406\u89e3\u4ee3\u7801\u7684\u6d41\u7a0b\uff0c\u800c\u4e0d\u5fc5\u6df1\u5165\u4e86\u89e3\u6bcf\u4e2a\u51fd\u6570\u7684\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282\u3002</p> </li> <li> <p>\u7075\u6d3b\u6027\uff1a\u5982\u679c\u9700\u8981\u66f4\u6539\u67d0\u4e2a\u529f\u80fd\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u53ea\u9700\u8981\u4fee\u6539\u76f8\u5e94\u7684\u51fd\u6570\uff0c\u800c\u4e0d\u9700\u8981\u4fee\u6539\u8c03\u7528\u8be5\u51fd\u6570\u7684\u6240\u6709\u5730\u65b9\u3002</p> </li> <li> <p>\u6613\u4e8e\u6269\u5c55\uff1a\u5f53\u9700\u8981\u6dfb\u52a0\u65b0\u529f\u80fd\u65f6\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u6dfb\u52a0\u65b0\u7684\u51fd\u6570\uff0c\u5e76\u5728<code>init_monitor()</code>\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u8c03\u7528\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u6784\u6574\u4e2a\u521d\u59cb\u5316\u6d41\u7a0b\u3002</p> </li> <li> <p>\u6761\u4ef6\u7f16\u8bd1\uff1a\u4f7f\u7528<code>IFDEF</code>\u548c<code>MUXDEF</code>\u8fd9\u6837\u7684\u9884\u5904\u7406\u5668\u6307\u4ee4\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fdb\u884c\u6761\u4ef6\u7f16\u8bd1\uff0c\u8fd9\u5728\u5904\u7406\u4e0d\u540c\u914d\u7f6e\u548c\u5e73\u53f0\u65f6\u975e\u5e38\u6709\u7528\u3002</p> </li> <li> <p>\u9519\u8bef\u9694\u79bb\uff1a\u5982\u679c\u67d0\u4e2a\u51fd\u6570\u4e2d\u51fa\u73b0\u9519\u8bef\uff0c\u5b83\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u51fd\u6570\u7684\u6267\u884c\uff0c\u8fd9\u6709\u52a9\u4e8e\u5b9a\u4f4d\u548c\u89e3\u51b3\u95ee\u9898\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5bf9\u5355\u72ec\u7684\u51fd\u6570\u8fdb\u884c\u6027\u80fd\u4f18\u5316\uff0c\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6\u90e8\u5206\u3002</p> </li> <li> <p>\u63a5\u53e3\u6807\u51c6\u5316\uff1a\u51fd\u6570\u63d0\u4f9b\u4e86\u4e00\u79cd\u6807\u51c6\u5316\u7684\u63a5\u53e3\uff0c\u4f7f\u5f97\u5176\u4ed6\u5f00\u53d1\u8005\u53ef\u4ee5\u66f4\u5bb9\u6613\u5730\u7406\u89e3\u548c\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\u3002</p> </li> <li> <p>\u7ef4\u62a4\u5386\u53f2\u8bb0\u5f55\uff1a\u51fd\u6570\u8c03\u7528\u7684\u5f62\u5f0f\u6709\u52a9\u4e8e\u7ef4\u62a4\u4ee3\u7801\u7684\u5386\u53f2\u8bb0\u5f55\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u51fd\u6570\u7684\u53d8\u66f4\u90fd\u53ef\u4ee5\u72ec\u7acb\u8ddf\u8e2a\u3002</p> </li> </ol> <p>\u5728<code>init_monitor()</code>\u4e2d\uff0c\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684\u521d\u59cb\u5316\u6b65\u9aa4\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4f7f\u5f97\u6574\u4e2a\u521d\u59cb\u5316\u8fc7\u7a0b\u66f4\u52a0\u7ed3\u6784\u5316\u548c\u6613\u4e8e\u7ba1\u7406\u3002\u5982\u679c\u5c06\u6240\u6709\u51fd\u6570\u4f53\u76f4\u63a5\u5c55\u5f00\u5728<code>init_monitor()</code>\u4e2d\uff0c\u867d\u7136\u7406\u8bba\u4e0a\u4e0d\u4f1a\u5f71\u54cd\u4ee3\u7801\u7684\u6b63\u786e\u6027\uff0c\u4f46\u4f1a\u5bfc\u81f4\u4ee3\u7801\u53d8\u5f97\u96be\u4ee5\u9605\u8bfb\u548c\u7ef4\u62a4\uff0c\u540c\u65f6\u4e5f\u5931\u53bb\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684\u8bb8\u591a\u597d\u5904\u3002</p> <ol> <li> <p>parse_args()</p> <pre><code>  static int parse_args(int argc, char *argv[]) {\n    const struct option table[] = {\n      {\"batch\"    , no_argument      , NULL, 'b'},\n      {\"log\"      , required_argument, NULL, 'l'},\n      {\"diff\"     , required_argument, NULL, 'd'},\n      {\"port\"     , required_argument, NULL, 'p'},\n      {\"help\"     , no_argument      , NULL, 'h'},\n      {0          , 0                , NULL,  0 },\n    };\n    int o;\n    while ( (o = getopt_long(argc, argv, \"-bhl:d:p:\", table, NULL)) != -1) {\n      switch (o) {\n        case 'b': sdb_set_batch_mode(); break;\n        case 'p': sscanf(optarg, \"%d\", &amp;difftest_port); break;\n        case 'l': log_file = optarg; break;\n        case 'd': diff_so_file = optarg; break;\n        case 1: img_file = optarg; return 0;\n        default:\n          printf(\"Usage: %s [OPTION...] IMAGE [args]\\n\\n\", argv[0]);\n          printf(\"\\t-b,--batch              run with batch mode\\n\");\n          printf(\"\\t-l,--log=FILE           output log to FILE\\n\");\n          printf(\"\\t-d,--diff=REF_SO        run DiffTest with reference REF_SO\\n\");                                                                \n          printf(\"\\t-p,--port=PORT          run DiffTest with port PORT\\n\");\n          printf(\"\\n\");\n          exit(0);\n      }\n    }\n    return 0;\n  }\n</code></pre> <p>\u539f\u6765\u547d\u4ee4\u884c\u89e3\u6790\u53c2\u6570\u53ef\u4ee5\u8fd9\u4e48\u5199\uff0c\u4e3b\u8981\u7528\u5230\u8fd9\u4e2a <code>getopt_long</code> \u51fd\u6570\uff0c\u4e13\u95e8\u7528\u6765\u89e3\u6790\u53c2\u6570</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>\u539f\u6765\u5947\u602a\u7684 <code>struct option</code> \u5728\u8fd9\u4e2a\u5934\u6587\u4ef6\u91cc\u9762</p> </li> <li> <p>init_rand()</p> <p>src/utils/timer.c </p> <pre><code>// \u968f\u673a\u6570\u79cd\u5b50\nvoid init_rand() {\n    srand(get_time_internal());\n}    \n</code></pre> </li> <li> <p>init_log()</p> <p>src/utils/log.c </p> <p>\u521d\u59cb\u65e5\u5fd7</p> <pre><code>void init_log(const char *log_file) {                                                                                                            \n  log_fp = stdout;\n  if (log_file != NULL) {\n    FILE *fp = fopen(log_file, \"w\");\n    Assert(fp, \"Can not open '%s'\", log_file);\n    log_fp = fp;\n  }\n  Log(\"Log is written to %s\", log_file ? log_file : \"stdout\");\n}\n</code></pre> </li> <li> <p>init_mem()</p> <p>src/memory/paddr.c </p> <p>\u521d\u59cb\u5185\u5b58</p> <pre><code>void init_mem() {\n#if   defined(CONFIG_PMEM_MALLOC)\n  pmem = malloc(CONFIG_MSIZE);\n  assert(pmem);\n#endif\n  IFDEF(CONFIG_MEM_RANDOM, memset(pmem, rand(), CONFIG_MSIZE));\n  Log(\"physical memory area [\" FMT_PADDR \", \" FMT_PADDR \"]\", PMEM_LEFT, PMEM_RIGHT);\n}\n</code></pre> <p>include/config/auto.conf   </p> <pre><code>#\n# Automatically generated file; DO NOT EDIT.\n# NEMU Configuration Menu\n#\nCONFIG_DIFFTEST_REF_NAME=\"none\"\nCONFIG_ENGINE=\"interpreter\"\nCONFIG_PC_RESET_OFFSET=0\nCONFIG_TARGET_NATIVE_ELF=y\nCONFIG_MSIZE=0x8000000   \n    /* 0x8000000 Byte= 128MB*/\nCONFIG_CC_O2=y\nCONFIG_MODE_SYSTEM=y\nCONFIG_MEM_RANDOM=y\nCONFIG_ITRACE=y\nCONFIG_ISA_riscv=y\nCONFIG_TRACE_END=10000\nCONFIG_MBASE=0x80000000\nCONFIG_TIMER_GETTIMEOFDAY=y\nCONFIG_ENGINE_INTERPRETER=y\nCONFIG_CC_OPT=\"-O2\"\nCONFIG_RT_CHECK=y\nCONFIG_ITRACE_COND=\"true\"\nCONFIG_CC=\"gcc\"\nCONFIG_DIFFTEST_REF_PATH=\"none\"\nCONFIG_TRACE_START=0\nCONFIG_CC_GCC=y\nCONFIG_TRACE=y\nCONFIG_ISA=\"riscv32\"\nCONFIG_PMEM_GARRAY=y\n</code></pre> </li> <li> <p><code>init_isa()</code> </p> <pre><code>static void restart() {\n  /* Set the initial program counter. */\n  cpu.pc = RESET_VECTOR;\n\n  /* The zero register is always 0. */\n  cpu.gpr[0] = 0;\n}\n\nvoid init_isa() {\n  /* Load built-in image. */\n  memcpy(guest_to_host(RESET_VECTOR), img, sizeof(img));\n\n  /* Initialize this virtual computer system. */\n  restart();\n}  \n</code></pre> <ol> <li> <p>\u5c06\u5ba2\u6237\u5185\u7f6e\u7684\u7a0b\u5e8f\u8bfb\u5230\u5185\u5b58\u4e2d \uff08BIOS\uff09</p> <ol> <li> <p>\u5ba2\u6237\u7a0b\u5e8f\u662f\u4ec0\u4e48? \u6211\u4eec\u77e5\u9053, \u7a0b\u5e8f\u662f\u7531\u6307\u4ee4\u6784\u6210\u7684, \u800c\u4e0d\u540cISA\u7684\u6307\u4ee4\u4e5f\u5404\u4e0d\u76f8\u540c(\u60f3\u8c61\u4e00\u4e0b\u7528\u4e0d\u540c\u7684\u8bed\u8a00\u6765\u8868\u8fbe\"\u4f60\u597d\"\u7684\u610f\u601d), \u56e0\u800c\u7a0b\u5e8f\u672c\u8eab\u80af\u5b9a\u662fISA\u76f8\u5173\u7684. \u56e0\u6b64, \u6211\u4eec\u628a\u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f\u653e\u5728<code>nemu/src/isa/$ISA/init.c</code>\u4e2d. \u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f\u7684\u884c\u4e3a\u975e\u5e38\u7b80\u5355, \u5b83\u53ea\u5305\u542b\u5c11\u6570\u51e0\u6761\u6307\u4ee4, \u751a\u81f3\u7b97\u4e0d\u4e0a\u5728\u505a\u4e00\u4e9b\u6709\u610f\u4e49\u7684\u4e8b\u60c5.</p> </li> <li> <p>\u5185\u5b58\u662f\u4ec0\u4e48? \u6211\u4eec\u53ef\u4ee5\u628a\u5185\u5b58\u770b\u4f5c\u4e00\u6bb5\u8fde\u7eed\u7684\u5b58\u50a8\u7a7a\u95f4, \u800c\u5185\u5b58\u53c8\u662f\u5b57\u8282\u7f16\u5740\u7684(\u5373\u4e00\u4e2a\u5185\u5b58\u4f4d\u7f6e\u5b58\u653e\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e), </p> <p>\u5728C\u8bed\u8a00\u4e2d\u6211\u4eec\u5c31\u5f88\u81ea\u7136\u5730\u4f7f\u7528\u4e00\u4e2a<code>uint8_t</code>\u7c7b\u578b\u7684\u6570\u7ec4\u6765\u5bf9\u5185\u5b58\u8fdb\u884c\u6a21\u62df. </p> <p>NEMU\u9ed8\u8ba4\u4e3a\u5ba2\u6237\u8ba1\u7b97\u673a\u63d0\u4f9b128MB\u7684\u7269\u7406\u5185\u5b58(\u89c1<code>nemu/src/memory/paddr.c</code>\u4e2d\u5b9a\u4e49\u7684<code>pmem</code>),</p> </li> <li> <p>\u9700\u8981\u5c06\u5ba2\u6237\u7a0b\u5e8f\u8bfb\u5165\u5230\u5185\u5b58\u7684\u4ec0\u4e48\u4f4d\u7f6e? \u4e3a\u4e86\u8ba9\u5ba2\u6237\u8ba1\u7b97\u673a\u7684CPU\u53ef\u4ee5\u6267\u884c\u5ba2\u6237\u7a0b\u5e8f, \u56e0\u6b64\u6211\u4eec\u9700\u8981\u4e00\u79cd\u65b9\u5f0f\u8ba9\u5ba2\u6237\u8ba1\u7b97\u673a\u7684CPU\u77e5\u9053\u5ba2\u6237\u7a0b\u5e8f\u7684\u4f4d\u7f6e. \u6211\u4eec\u91c7\u53d6\u4e00\u79cd\u6700\u7b80\u5355\u7684\u65b9\u5f0f: \u7ea6\u5b9a. </p> <p>\u5177\u4f53\u5730, \u6211\u4eec\u8ba9monitor\u76f4\u63a5\u628a\u5ba2\u6237\u7a0b\u5e8f\u8bfb\u5165\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e<code>RESET_VECTOR</code>. <code>RESET_VECTOR</code>\u7684\u503c\u5728<code>nemu/include/memory/paddr.h</code>\u4e2d\u5b9a\u4e49.</p> </li> </ol> <p>\u76f4\u63a5\u7406\u89e3\u6210\u5185\u5b58\u662f\u4e00\u4e2a\u8d85\u5927\u578b\u7684\u4e00\u7ef4\u6570\u7ec4\uff0c\u6570\u7ec4\u4e0b\u6807\u5c31\u662f\u5730\u5740\u3002C\u8bed\u8a00\u4e2d\u597d\u50cf\u6ca1\u6709\u4e8c\u7ef4\u6570\u7ec4\u7684\u8fd9\u4e2a\u6982\u5ff5\uff0c\u8fd8\u662f\u4e00\u7ef4\u66f4\u597d\u7406\u89e3\u3002</p> </li> <li> <p>\u521d\u59cb\u5316\u5bc4\u5b58\u5668 ---&gt; restart()</p> <p><code>init_isa()</code>\u7684\u7b2c\u4e8c\u9879\u4efb\u52a1\u662f\u521d\u59cb\u5316\u5bc4\u5b58\u5668, \u8fd9\u662f\u901a\u8fc7<code>restart()</code>\u51fd\u6570\u6765\u5b9e\u73b0\u7684. </p> <p>\u5728CPU\u4e2d, \u5bc4\u5b58\u5668\u662f\u4e00\u4e2a\u7ed3\u6784\u5316\u7279\u5f81\u8f83\u5f3a\u7684\u5b58\u50a8\u90e8\u4ef6, \u5728C\u8bed\u8a00\u4e2d\u6211\u4eec\u5c31\u5f88\u81ea\u7136\u5730\u4f7f\u7528\u76f8\u5e94\u7684\u7ed3\u6784\u4f53\u6765\u63cf\u8ff0CPU\u7684\u5bc4\u5b58\u5668\u7ed3\u6784. </p> <p>\u4e0d\u540cISA\u7684\u5bc4\u5b58\u5668\u7ed3\u6784\u4e5f\u5404\u4e0d\u76f8\u540c, \u4e3a\u6b64\u6211\u4eec\u628a\u5bc4\u5b58\u5668\u7ed3\u6784\u4f53<code>CPU_state</code>\u7684\u5b9a\u4e49\u653e\u5728<code>nemu/src/isa/$ISA/include/isa-def.h</code>\u4e2d, \u5e76\u5728<code>nemu/src/cpu/cpu-exec.c</code>\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf<code>cpu</code>. </p> <p>\u521d\u59cb\u5316\u5bc4\u5b58\u5668\u7684\u4e00\u4e2a\u91cd\u8981\u5de5\u4f5c\u5c31\u662f\u8bbe\u7f6e<code>cpu.pc</code>\u7684\u521d\u503c, \u6211\u4eec\u9700\u8981\u5c06\u5b83\u8bbe\u7f6e\u6210\u521a\u624d\u52a0\u8f7d\u5ba2\u6237\u7a0b\u5e8f\u7684\u5185\u5b58\u4f4d\u7f6e, \u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9CPU\u4ece\u6211\u4eec\u7ea6\u5b9a\u7684\u5185\u5b58\u4f4d\u7f6e\u5f00\u59cb\u6267\u884c\u5ba2\u6237\u7a0b\u5e8f\u4e86. \u5bf9\u4e8emips32\u548criscv32, \u5b83\u4eec\u76840\u53f7\u5bc4\u5b58\u5668\u603b\u662f\u5b58\u653e<code>0</code>, \u56e0\u6b64\u6211\u4eec\u4e5f\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316.</p> <p>\u3010\u62d3\u3011</p> <p>x86\u7684\u7269\u7406\u5185\u5b58\u662f\u4ece0\u5f00\u59cb\u7f16\u5740\u7684, \u4f46\u5bf9\u4e8e\u4e00\u4e9bISA\u6765\u8bf4\u5374\u4e0d\u662f\u8fd9\u6837, \u4f8b\u5982mips32\u548criscv32\u7684\u7269\u7406\u5730\u5740\u5747\u4ece<code>0x80000000</code>\u5f00\u59cb. </p> <p>\u56e0\u6b64\u5bf9\u4e8emips32\u548criscv32, \u5176<code>CONFIG_MBASE</code>\u5c06\u4f1a\u88ab\u5b9a\u4e49\u6210<code>0x80000000</code>. \u5c06\u6765CPU\u8bbf\u95ee\u5185\u5b58\u65f6, \u6211\u4eec\u4f1a\u5c06CPU\u5c06\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u5730\u5740\u6620\u5c04\u5230<code>pmem</code>\u4e2d\u7684\u76f8\u5e94\u504f\u79fb\u4f4d\u7f6e, \u8fd9\u662f\u901a\u8fc7<code>nemu/src/memory/paddr.c</code>\u4e2d\u7684<code>guest_to_host()</code>\u51fd\u6570\u5b9e\u73b0\u7684. </p> <p>\u4f8b\u5982\u5982\u679cmips32\u7684CPU\u6253\u7b97\u8bbf\u95ee\u5185\u5b58\u5730\u5740<code>0x80000000</code>, \u6211\u4eec\u4f1a\u8ba9\u5b83\u6700\u7ec8\u8bbf\u95ee<code>pmem[0]</code>, \u4ece\u800c\u53ef\u4ee5\u6b63\u786e\u8bbf\u95ee\u5ba2\u6237\u7a0b\u5e8f\u7684\u7b2c\u4e00\u6761\u6307\u4ee4. \u8fd9\u79cd\u673a\u5236\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u540d\u5b57, \u53eb \u5730\u5740\u6620\u5c04 , \u5728\u540e\u7eed\u7684PA\u4e2d\u6211\u4eec\u8fd8\u4f1a\u518d\u9047\u5230\u5b83.</p> <p>Monitor \u8bfb\u5165\u5ba2\u6237\u7a0b\u5e8f\u5e76\u5bf9\u5bc4\u5b58\u5668\u8fdb\u884c\u521d\u59cb\u5316\u540e\uff0c\u8fd9\u65f6\u7684\u5185\u5b58\u5e03\u5c40\u5982\u4e0b\uff1a</p> <pre><code>pmem:\n\nCONFIG_MBASE      RESET_VECTOR\n   |                 |\n   v                 v\n   -----------------------------------------------\n   |                 |                  |\n   |                 |    guest prog    |\n   |                 |                  |\n   -----------------------------------------------\n                     ^\n                     |\n                    pc\n</code></pre> <pre><code>#define PMEM_LEFT  ((paddr_t)CONFIG_MBASE)\n#define PMEM_RIGHT ((paddr_t)CONFIG_MBASE + CONFIG_MSIZE - 1)\n#define RESET_VECTOR (PMEM_LEFT + CONFIG_PC_RESET_OFFSET)\n</code></pre> <p>\u600e\u4e48\u7406\u89e3\u5bc4\u5b58\u5668\u662f\u4e00\u4e2a\u7ed3\u6784\u5316\u7279\u5f81\u8f83\u5f3a\u7684\u5b58\u50a8\u90e8\u4ef6\uff1f\u600e\u4e48\u7406\u89e3\u4e0b\u9762\u7684\u5b9a\u4e49\uff1f</p> <p>CPU_state\u7a76\u7adf\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u4e3a\u4ec0\u4e48\u6211\u5728vim\u4e2d\u7684ctags\u8df3\u8f6c\u4e2d\u627e\u4e0d\u5230\uff1f\u7a76\u7adf\u5b9a\u4e49\u5728\u4ec0\u4e48\u5730\u65b9\uff1f\u8fd9\u4e9b\u5b8f\u7a76\u7adf\u600e\u4e48\u4f7f\u7528\uff1f</p> <pre><code>// isa-def.h\n\ntypedef struct {\n   word_t gpr[MUXDEF(CONFIG_RVE, 16, 32)];\n   vaddr_t pc;\n } MUXDEF(CONFIG_RV64, riscv64_CPU_state, riscv32_CPU_state);\n\n // decode\n typedef struct {\n   union {\n     uint32_t val;\n   } inst;\n } MUXDEF(CONFIG_RV64, riscv64_ISADecodeInfo, riscv32_ISADecodeInfo);\n</code></pre> <ul> <li> <p>\u9996\u5148\uff0c\u4e3a\u4ec0\u4e48\u8bf4\u5bc4\u5b58\u5668\u662f\u4e00\u4e2a\u7ed3\u6784\u5316\u7279\u5f81\u8f83\u5f3a\u7684\u5b58\u50a8\u90e8\u4ef6\uff1f</p> </li> <li> <p>\u8fd9\u4e9b\u7528\u5230\u7684\u5b8f\uff0c\u7a76\u7adf\u6709\u4ec0\u4e48\u7528\uff1f</p> <pre><code>// nemu/include/macro.h \n\n// macro concatenation\n#define concat_temp(x, y) x ## y\n#define concat(x, y) concat_temp(x, y)\n#define concat3(x, y, z) concat(concat(x, y), z)                                                                                                   \n#define concat4(x, y, z, w) concat3(concat(x, y), z, w)\n#define concat5(x, y, z, v, w) concat4(concat(x, y), z, v, w)\n\n\n/* macro testing */\n// See https://stackoverflow.com/questions/26099745/test-if-preprocessor-symbol-is-defined-inside-macro\n#define CHOOSE2nd(a, b, ...) b\n#define MUX_WITH_COMMA(contain_comma, a, b) CHOOSE2nd(contain_comma a, b)\n#define MUX_MACRO_PROPERTY(p, macro, a, b) MUX_WITH_COMMA(concat(p, macro), a, b)\n// define placeholders for some property\n#define __P_DEF_0  X,\n#define __P_DEF_1  X,\n#define __P_ONE_1  X,\n#define __P_ZERO_0 X,\n// define some selection functions based on the properties of BOOLEAN macro\n#define MUXDEF(macro, X, Y)  MUX_MACRO_PROPERTY(__P_DEF_, macro, X, Y)\n#define MUXNDEF(macro, X, Y) MUX_MACRO_PROPERTY(__P_DEF_, macro, Y, X)\n#define MUXONE(macro, X, Y)  MUX_MACRO_PROPERTY(__P_ONE_, macro, X, Y)\n#define MUXZERO(macro, X, Y) MUX_MACRO_PROPERTY(__P_ZERO_,macro, X, Y)\n</code></pre> </li> </ul> <p>\u4e0a\u9762\u8fd9\u4e9b\u6761\u4ef6\u7f16\u8bd1\u5b8f\uff1a</p> <pre><code>&gt; 1. **\u9009\u62e9\u5b8f** (`CHOOSE2nd`, `MUX_WITH_COMMA`, `MUX_MACRO_PROPERTY`):\n&gt;     - \u8fd9\u4e9b\u5b8f\u7528\u4e8e\u57fa\u4e8e\u6761\u4ef6\u9009\u62e9\u4e24\u4e2a\u503c\u4e2d\u7684\u4e00\u4e2a\u3002\n&gt; 2. **\u6d4b\u8bd5\u5b8f\u5c5e\u6027** (`MUXDEF`, `MUXNDEF`, `MUXONE`, `MUXZERO`):\n&gt;     - \u8fd9\u4e9b\u5b8f\u7528\u4e8e\u6839\u636e\u53e6\u4e00\u4e2a\u5b8f\u7684\u5c5e\u6027\u9009\u62e9\u4e00\u4e2a\u503c\u3002\n\n&gt; \u5177\u4f53\u6765\u770b\uff1a\n\n&gt; `MUXDEF(macro, X, Y)` \u8fd9\u4e2a\u5b8f\u7684\u4f5c\u7528\u662f\uff1a\n\n&gt; - \u5982\u679c `macro` \u88ab\u5b9a\u4e49\u4e86\uff0c\u90a3\u4e48\u5b83\u4f1a\u9009\u62e9 `X`\u3002\n&gt; - \u5982\u679c `macro` \u6ca1\u6709\u88ab\u5b9a\u4e49\uff0c\u90a3\u4e48\u5b83\u4f1a\u9009\u62e9 `Y`\u3002\n</code></pre> <p>\u7ed3\u5408\u5b8f\u5b9a\u4e49\u548c\u5b9e\u9645\u7ed3\u6784\u4f53\u5b9a\u4e49\uff1a\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5206\u6790 <code>isa-def.h</code> \u7684\u7b2c\u4e00\u4e2a <code>struct</code> \u7684\u5185\u5bb9\uff1a</p> <ul> <li>\u5982\u679c <code>CONFIG_RV64</code> \u88ab\u5b9a\u4e49\uff0c\u90a3\u4e48\u8fd9\u4e2a <code>typedef</code> \u5c06\u4f1a\u662f <code>riscv64_ISADecodeInfo</code> \u7c7b\u578b\u3002<ul> <li>\u5982\u679c <code>CONFIG_RV64</code> \u6ca1\u6709\u88ab\u5b9a\u4e49\uff0c\u90a3\u4e48\u8fd9\u4e2a <code>typedef</code> \u5c06\u4f1a\u662f <code>riscv32_ISADecodeInfo</code> \u7c7b\u578b\u3002</li> </ul> </li> </ul> <p>\u4e3a\u4e86\u77e5\u9053\u5b9a\u4e49\u4e86\u54ea\u4e2a\u7c7b\u578b\uff0c\u6211\u4eec\u9700\u8981\u67e5\u770b\u7f16\u8bd1\u65f6\u7684\u914d\u7f6e\u6216\u8005\u67e5\u770b <code>CONFIG_RV64</code> \u5b8f\u7684\u5b9a\u4e49\uff1a</p> <ul> <li> <p>\u5982\u679c <code>CONFIG_RV64</code> \u88ab\u5b9a\u4e49\u4e3a 1 \u6216\u8005\u662f\u4e00\u4e2a\u975e\u96f6\u503c\uff0c\u90a3\u4e48\u4f1a\u9009\u62e9\u4e0e 64 \u4f4d\u76f8\u5173\u7684\u7c7b\u578b\uff1b</p> </li> <li> <p>\u5982\u679c\u6ca1\u6709\u5b9a\u4e49\u6216\u8005\u5b9a\u4e49\u4e3a 0\uff0c\u90a3\u4e48\u4f1a\u9009\u62e9\u4e0e 32 \u4f4d\u76f8\u5173\u7684\u7c7b\u578b\u3002</p> <p>\u518d\u6b21\u590d\u4e60\uff1a</p> <pre><code>&gt; ##\uff1a\u8fde\u63a5\u4e24\u4e2a\u7b26\u53f7\u5f62\u6210\u65b0\u7684\u7b26\u53f7\n\n&gt; #\uff1a\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\u3002\n</code></pre> </li> </ul> </li> <li> <p>\u5176\u6b21\uff0c\u4e3a\u4ec0\u4e48\u627e\u4e0d\u5230\u8fd9\u4e2a\u5b9a\u4e49\u5462\uff1f</p> <p>\u6211\u4e2a\u4eba\u8ba4\u4e3a\u662f\u56e0\u4e3a\u8fd9\u4e2a\u9879\u76ee\u592a\u5927\u4e86\uff0c\u7136\u540e\u81ea\u5df1\u7684\u77e5\u8bc6\u6709\u5f88\u532e\u4e4f\uff0c\u5f88\u591a\u4e1c\u897f\u90fd\u4e00\u77e5\u534a\u89e3\uff0c\u6240\u4ee5\u5148\u4e0d\u8981\u6015\uff0c\u6162\u6162\u5730\u770b\u4ee3\u7801\uff08\u6ce8\u610f\uff1a<code>Makefile</code> \u4e5f\u662f\u4ee3\u7801\uff09</p> <p>\u6240\u4ee5\u6211\u4eec\u4e00\u6b65\u6b65\u5206\u6790\uff1a</p> <ol> <li> <p>\u901a\u8fc7\u7b2c\u4e8c\u6b65\uff0c\u6211\u4eec\u77e5\u9053\u6211\u4eec\u5b9a\u4e49\u4e86\u662frv64\u8fd8\u662frv32\uff0c\u90a3\u6211\u4eec\u7ee7\u7eed\u627e</p> <p>\u5728<code>nemu/src/cpu/cpu-exec.c</code>\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf<code>cpu</code>.</p> <p></p> <p>\u770b\u6837\u5b50\u548c <code>cpu.h</code> \u6709\u5173\uff0cfind\u547d\u4ee4\u770b\u770b\uff1f</p> <p></p> <p>\u627e\u5230\u4e86\uff0c\u770b\u6837\u5b50\u5c31\u662f\u8fd9\u4e2a\u5b8f\u4e86\uff01\u5f88\u719f\u6089\uff01\u62fc\u63a5\u5b8f\uff01</p> <p>\u4f46\u662f\u600e\u4e48\u7406\u89e3\u5462\uff1f\u53c8\u51fa\u73b0\u4e86\u4e00\u4e9b\u83ab\u540d\u5176\u5999\u7684\u4e1c\u897f\uff0c__ GUSEST_ISA __ ?</p> <p>\u4ed4\u7ec6\u770b\u6ce8\u91ca\uff0c\u88ab\u5b9a\u4e49\u5728CFLAGS\u91cc\u4e86\u5594\uff0c</p> <p>\u56de\u53bb\u770b <code>nemu/Makefile</code> </p> <p>\u53c8\u6709\u4e00\u4e9b\u5947\u602a\u7684 <code>Makefile</code> \u7528\u6cd5\u4e86\uff0c\u7ee7\u7eed\u590d\u4e60\u770b\u770b\uff1f</p> <p></p> <p></p> </li> </ol> </li> </ol> <p>\u901a\u8fc7\u8fd9\u4e9b\uff0c\u5927\u6982\u660e\u767d__ GUSEST_ISA __ \u662f\u600e\u4e48\u6765\u7684\u4e86\u5427\uff0c\u7b80\u5355\u603b\u7ed3\u4e0b\uff1a</p> <ol> <li>\u9996\u5148 <code>CONFIG_ISA</code> \u662f <code>menuconfig</code> \u4e2d\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728 <code>auto.conf</code> \u4e2d\u627e\u627e\u770b\u3002</li> <li>\u4e4b\u540e\u901a\u8fc7 <code>$(call remove_quote,$(CONFIG_ISA))</code> \u8c03\u7528 <code>remove_quote</code> \u51fd\u6570\uff0c\u4f20\u5165 <code>CONFIG_ISA</code> \u7684\u503c\u3002\u5982\u679c <code>CONFIG_ISA</code> \u7684\u503c\u88ab\u5f15\u53f7\u5305\u56f4\uff0c<code>remove_quote</code> \u51fd\u6570\u5c06\u53bb\u9664\u8fd9\u4e9b\u5f15\u53f7\u3002</li> <li>\u518d\u901a\u8fc7 <code>GUEST_ISA ?= ...</code>  \u8bbe\u7f6e <code>GUEST_ISA</code> \u53d8\u91cf</li> <li>\u6700\u7ec8\uff0c<code>GUEST_ISA</code> \u88ab\u7528\u4e8e\u7f16\u8bd1\u6807\u5fd7 <code>-D__GUEST_ISA__=$(GUEST_ISA)</code>\uff0c\u8fd9\u4f1a\u5b9a\u4e49\u4e00\u4e2a\u5b8f <code>__GUEST_ISA__</code>\uff0c\u5176\u503c\u7b49\u4e8e <code>GUEST_ISA</code> \u7684\u503c\u3002\u8fd9\u4e2a\u5b8f\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u88ab\u7528\u6765\u6839\u636e <code>GUEST_ISA</code> \u7684\u503c\u6765\u6267\u884c\u4e0d\u540c\u7684\u7f16\u8bd1\u65f6\u884c\u4e3a\u3002</li> <li>\u4e4b\u540e\u56de\u5230 <code>include/isa/h</code> \u4e2d \uff0c\u5927\u6982\u80fd\u7406\u89e3 <code>CPU_state</code> \u600e\u4e48\u6765\u7684\u4e86\uff0c\u90a3\u4e5f\u5c31\u7406\u89e3\u4e86\u5173\u4e8e\u5bc4\u5b58\u5668\u7684\u76f8\u5173\u67b6\u6784\u9009\u62e9\uff08\u901a\u8fc7\u5404\u79cd\u9b54\u6cd5\u5b8f\uff09</li> <li>\u8fd9\u6837\u6700\u540e\u6211\u4eec\u4e5f\u5b8c\u6210\u4e86\u5173\u4e8e\u5bc4\u5b58\u5668\u7684\u76f8\u5173\u521d\u59cb\u5316\uff0c\u521d\u6b65\u660e\u767d\u8fd9\u4e2a\u5185\u5bb9</li> </ol> </li> <li> <p><code>load_img()</code></p> <p>\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5c06\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u5ba2\u6237\u7a0b\u5e8f\u4ece\u955c\u50cf\u6587\u4ef6\u8bfb\u5165\u5230\u5185\u5b58, \u8986\u76d6\u521a\u624d\u7684\u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f. </p> <p>\u8fd9\u4e2a\u955c\u50cf\u6587\u4ef6\u662f\u8fd0\u884cNEMU\u7684\u4e00\u4e2a\u53ef\u9009\u53c2\u6570, \u5728\u8fd0\u884cNEMU\u7684\u547d\u4ee4\u4e2d\u6307\u5b9a. \u5982\u679c\u8fd0\u884cNEMU\u7684\u65f6\u5019\u6ca1\u6709\u7ed9\u51fa\u8fd9\u4e2a\u53c2\u6570, NEMU\u5c06\u4f1a\u8fd0\u884c\u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f</p> </li> </ol> </li> <li> <p>\u76f4\u63a5\u5f00\u59cb</p> <pre><code>make run\n</code></pre> </li> <li> <p>\u81ea\u884c\u89e3\u51b3</p> <p>\u8fd0\u884cNEMU\u4e4b\u540e\u4f60\u5e94\u8be5\u80fd\u770b\u5230\u76f8\u5e94\u7684\u6b22\u8fce\u4fe1\u606f, \u4ee5\u53ca\u4f60\u9009\u62e9\u7684ISA. \u8bf7\u52a1\u5fc5\u786e\u8ba4\u8f93\u51fa\u7684ISA\u4fe1\u606f\u4e0e\u4f60\u9009\u62e9\u7684ISA\u4e00\u81f4. \u4e0d\u8fc7\u4f60\u4f1a\u770b\u5230\u5982\u4e0b\u7684\u9519\u8bef\u4fe1\u606f:</p> <pre><code>[src/monitor/monitor.c:20 welcome] Exercise: Please remove me in the source code and compile NEMU again.\nriscv32-nemu-interpreter: src/monitor/monitor.c:21: welcome: Assertion `0' failed.\n</code></pre> </li> </ol>"},{"location":"ysyx/pa/pa1/pa1.html#_9","title":"\u8fd0\u884c\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7a0b\u5e8f","text":"<p>\u8fd0\u884c\u4e4b\u540e\uff1a</p> <p>\u51fd\u6570\u6267\u884c\u6d41\u7a0b\uff1a</p> <p><code>main()</code> --&gt; <code>engine_start()</code> --&gt; <code>sdb_mainloop()</code> --&gt; <code>cmd_c()</code> --&gt; <code>cpu_exec()</code> --&gt; <code>execute()</code> --&gt; <code>cpu_once()</code> </p> <p>--&gt; <code>isa_exec_once()</code></p> <p><code>cpu_once()</code>\uff1a\u8fd9\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u5c31\u662f\u6211\u4eec\u5728\u4e0a\u4e00\u5c0f\u8282\u4e2d\u4ecb\u7ecd\u7684\u5185\u5bb9: \u8ba9CPU\u6267\u884c\u5f53\u524dPC\u6307\u5411\u7684\u4e00\u6761\u6307\u4ee4, \u7136\u540e\u66f4\u65b0PC.</p>"},{"location":"ysyx/pa/pa1/pa1.html#nemu_1","title":"\u5173\u4e8e <code>nemu</code> \u9000\u51fa","text":"<p>\u7531\u4e8e\u521a\u624d\u6211\u4eec\u8fd0\u884cNEMU\u7684\u65f6\u5019\u5e76\u672a\u7ed9\u51fa\u5ba2\u6237\u7a0b\u5e8f\u7684\u955c\u50cf\u6587\u4ef6, \u6b64\u65f6NEMU\u5c06\u4f1a\u8fd0\u884c\u4e0a\u6587\u63d0\u5230\u7684\u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f. NEMU\u5c06\u4e0d\u65ad\u6267\u884c\u6307\u4ee4, \u76f4\u5230\u9047\u5230\u4ee5\u4e0b\u60c5\u51b5\u4e4b\u4e00, \u624d\u4f1a\u9000\u51fa\u6307\u4ee4\u6267\u884c\u7684\u5faa\u73af:</p> <ul> <li> <p>\u8fbe\u5230\u8981\u6c42\u7684\u5faa\u73af\u6b21\u6570.</p> </li> <li> <p>\u5ba2\u6237\u7a0b\u5e8f\u6267\u884c\u4e86 <code>nemu_trap</code> \u6307\u4ee4. </p> <p>\u8fd9\u662f\u4e00\u6761\u865a\u6784\u7684\u7279\u6b8a\u6307\u4ee4, \u5b83\u662f\u4e3a\u4e86\u5728NEMU\u4e2d\u8ba9\u5ba2\u6237\u7a0b\u5e8f\u6307\u793a\u6267\u884c\u7684\u7ed3\u675f\u800c\u52a0\u5165\u7684, NEMU\u5728ISA\u624b\u518c\u4e2d\u9009\u62e9\u4e86\u4e00\u4e9b\u7528\u4e8e\u8c03\u8bd5\u7684\u6307\u4ee4, \u5e76\u5c06 <code>nemu_trap</code> \u7684\u7279\u6b8a\u542b\u4e49\u8d4b\u4e88\u5b83\u4eec. \u4f8b\u5982\u5728riscv32\u7684\u624b\u518c\u4e2d, NEMU\u9009\u62e9\u4e86 <code>ebreak</code> </p> <p>\u6307\u4ee4\u6765\u5145\u5f53 <code>nemu_trap</code>\u3002</p> <p>\u4e3a\u4e86\u8868\u793a\u5ba2\u6237\u7a0b\u5e8f\u662f\u5426\u6210\u529f\u7ed3\u675f, <code>nemu_trap</code> \u6307\u4ee4\u8fd8\u4f1a\u63a5\u6536\u4e00\u4e2a\u8868\u793a\u7ed3\u675f\u72b6\u6001\u7684\u53c2\u6570. </p> <p>\u5f53\u5ba2\u6237\u7a0b\u5e8f\u6267\u884c\u4e86\u8fd9\u6761\u6307\u4ee4\u4e4b\u540e, NEMU\u5c06\u4f1a\u6839\u636e\u8fd9\u4e2a\u7ed3\u675f\u72b6\u6001\u53c2\u6570\u6765\u8bbe\u7f6eNEMU\u7684\u7ed3\u675f\u72b6\u6001, \u5e76\u6839\u636e\u4e0d\u540c\u7684\u72b6\u6001\u8f93\u51fa\u4e0d\u540c\u7684\u7ed3\u675f\u4fe1\u606f, \u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li><code>HIT GOOD TRAP</code> - \u5ba2\u6237\u7a0b\u5e8f\u6b63\u786e\u5730\u7ed3\u675f\u6267\u884c</li> <li><code>HIT BAD TRAP</code> - \u5ba2\u6237\u7a0b\u5e8f\u9519\u8bef\u5730\u7ed3\u675f\u6267\u884c</li> <li><code>ABORT</code> - \u5ba2\u6237\u7a0b\u5e8f\u610f\u5916\u7ec8\u6b62, \u5e76\u672a\u7ed3\u675f\u6267\u884c</li> </ul> </li> </ul> <p>\u5f53\u4f60\u770b\u5230NEMU\u8f93\u51fa\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u5185\u5bb9\u65f6(\u4e0d\u540cISA\u7684pc\u8f93\u51fa\u503c\u4f1a\u6709\u6240\u4e0d\u540c):</p> <pre><code>nemu: HIT GOOD TRAP at pc = 0x8000000c\n</code></pre> <p>\u8bf4\u660e\u5ba2\u6237\u7a0b\u5e8f\u5df2\u7ecf\u6210\u529f\u5730\u7ed3\u675f\u8fd0\u884c. NEMU\u4f1a\u5728<code>cpu_exec()</code>\u51fd\u6570\u7684\u6700\u540e\u6253\u5370\u6267\u884c\u7684\u6307\u4ee4\u6570\u76ee\u548c\u82b1\u8d39\u7684\u65f6\u95f4, \u5e76\u8ba1\u7b97\u51fa\u6307\u4ee4\u6267\u884c\u7684\u9891\u7387. \u4f46\u7531\u4e8e\u5185\u7f6e\u5ba2\u6237\u7a0b\u5e8f\u592a\u5c0f, \u6267\u884c\u5f88\u5feb\u5c31\u7ed3\u675f\u4e86, \u76ee\u524d\u65e0\u6cd5\u8ba1\u7b97\u51fa\u6709\u610f\u4e49\u7684\u9891\u7387, \u5c06\u6765\u8fd0\u884c\u4e00\u4e9b\u590d\u6742\u7684\u7a0b\u5e8f\u65f6, \u6b64\u5904\u8f93\u51fa\u7684\u9891\u7387\u53ef\u4ee5\u7528\u4e8e\u7c97\u7565\u5730\u8861\u91cfNEMU\u7684\u6027\u80fd.</p> <p>\u9000\u51fa<code>cpu_exec()</code>\u4e4b\u540e, NEMU\u5c06\u8fd4\u56de\u5230<code>sdb_mainloop()</code>, \u7b49\u5f85\u7528\u6237\u8f93\u5165\u547d\u4ee4. \u4f46\u4e3a\u4e86\u518d\u6b21\u8fd0\u884c\u7a0b\u5e8f, \u4f60\u9700\u8981\u952e\u5165<code>q</code>\u9000\u51faNEMU, \u7136\u540e\u91cd\u65b0\u8fd0\u884c. </p> <ul> <li> <p>\u91cd\u8981\u7684\u4e1c\u897f</p> <ol> <li> <p>\u4e09\u4e2a\u91cd\u8981\u7684\u8c03\u8bd5\u5b8f</p> <p><code>nemu/include/debug.h</code> \u4e2d\u5b9a\u4e49</p> <ul> <li><code>Log()</code>\u662f<code>printf()</code>\u7684\u5347\u7ea7\u7248, \u4e13\u95e8\u7528\u6765\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f, \u540c\u65f6\u8fd8\u4f1a\u8f93\u51fa\u4f7f\u7528<code>Log()</code>\u6240\u5728\u7684\u6e90\u6587\u4ef6, \u884c\u53f7\u548c\u51fd\u6570. \u5f53\u8f93\u51fa\u7684\u8c03\u8bd5\u4fe1\u606f\u8fc7\u591a\u7684\u65f6\u5019, \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b9a\u4f4d\u5230\u4ee3\u7801\u4e2d\u7684\u76f8\u5173\u4f4d\u7f6e</li> <li><code>Assert()</code>\u662f<code>assert()</code>\u7684\u5347\u7ea7\u7248, \u5f53\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u5047\u65f6, \u5728assertion fail\u4e4b\u524d\u53ef\u4ee5\u8f93\u51fa\u4e00\u4e9b\u4fe1\u606f</li> <li><code>panic()</code>\u7528\u4e8e\u8f93\u51fa\u4fe1\u606f\u5e76\u7ed3\u675f\u7a0b\u5e8f, \u76f8\u5f53\u4e8e\u65e0\u6761\u4ef6\u7684assertion fail</li> </ul> </li> <li> <p>\u5185\u5b58\u6a21\u62df</p> <ul> <li>\u901a\u8fc7\u5728<code>nemu/src/memory/paddr.c</code>\u4e2d\u5b9a\u4e49\u7684\u5927\u6570\u7ec4<code>pmem</code>\u6765\u6a21\u62df. </li> <li>\u5728\u5ba2\u6237\u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d, \u603b\u662f\u4f7f\u7528<code>vaddr_read()</code>\u548c<code>vaddr_write()</code> (\u5728<code>nemu/src/memory/vaddr.c</code>\u4e2d\u5b9a\u4e49)\u6765\u8bbf\u95ee\u6a21\u62df\u7684\u5185\u5b58. vaddr, paddr\u5206\u522b\u4ee3\u8868\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740. \u8fd9\u4e9b\u6982\u5ff5\u5728\u5c06\u6765\u624d\u4f1a\u7528\u5230, \u76ee\u524d\u4e0d\u5fc5\u6df1\u7a76, \u4f46\u4ece\u73b0\u5728\u5f00\u59cb\u4fdd\u6301\u63a5\u53e3\u7684\u4e00\u81f4\u6027\u53ef\u4ee5\u5728\u5c06\u6765\u907f\u514d\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6.</li> </ul> </li> </ol> </li> <li> <p>\u6dfb\u52a0GDB\u8c03\u8bd5\u9009\u9879</p> <p>menuconfig \u9009\u9879\u91cc\u81ea\u5df1\u627e</p> <pre><code>Build Options\n  [*] Enable debug information\n</code></pre> </li> <li> <p>test</p> <p>\u4f18\u7f8e\u5730\u9000\u51fa</p> <p>\u4e3a\u4e86\u6d4b\u8bd5\u5927\u5bb6\u662f\u5426\u5df2\u7ecf\u7406\u89e3\u6846\u67b6\u4ee3\u7801, \u6211\u4eec\u7ed9\u5927\u5bb6\u8bbe\u7f6e\u4e00\u4e2a\u7ec3\u4e60: \u5982\u679c\u5728\u8fd0\u884cNEMU\u4e4b\u540e\u76f4\u63a5\u952e\u5165<code>q</code>\u9000\u51fa, \u4f60\u4f1a\u53d1\u73b0\u7ec8\u7aef\u8f93\u51fa\u4e86\u4e00\u4e9b\u9519\u8bef\u4fe1\u606f. \u8bf7\u5206\u6790\u8fd9\u4e2a\u9519\u8bef\u4fe1\u606f\u662f\u4ec0\u4e48\u539f\u56e0\u9020\u6210\u7684, \u7136\u540e\u5c1d\u8bd5\u5728NEMU\u4e2d\u4fee\u590d\u5b83.</p> <p></p> <p>\u6211\u662f\u66f4\u6539\u4e86\u8fd9\u91cc\uff0c\u5728\u8f93\u5165q\u65f6\uff0c\u76f4\u63a5\u5c06nemu\u7684\u72b6\u6001\u6539\u4e3a\u9000\u51fa\u4e86\uff0c\u7136\u540e\u89e3\u51b3\u7684\u3002</p> <p>\u6211\u9996\u5148\u770b\u5230<code>sdb</code> \u7684\u4e3b\u5faa\u73af\u91cc\u7528\u7684\u4e00\u4e9b\u51fd\u6570\u6307\u9488\uff0c\u77e5\u9053\u9000\u51fa\u547d\u4ee4\u76f4\u63a5\u8fd4\u56de-1\uff0c\u800c\u522b\u7684\u547d\u4ee4\u662f\u8fd4\u56de0\u3002</p> <p></p> <p>\u518d\u56de\u5230 <code>main</code> \u51fd\u6570\u76f4\u63a5\u5230\u770b\u600e\u4e48\u9000\u51fa\u7684\uff1a</p> <p></p> <p>\u6240\u4ee5\u6211\u77e5\u9053\u4e86\uff0c\u5982\u679c\u6211\u76f4\u63a5\u9000\u51fa\u7684\u8bdd\uff0c</p> <p>\u4e00\u662fNEMU\u72b6\u6001\u8fd8\u662f\u505c\u6b62\u7684\uff0c\u4e0d\u53ef\u80fd\u5230NEMU_END\uff0c</p> <p>\u53e6\u5916\u4e00\u79cd\uff0c\u6211\u53c8\u6ca1\u6709\u76f4\u63a5\u5c06\u5c06NEMU\u7684\u72b6\u6001\u6539\u4e3aQUIT\uff0c</p> <p>\u6240\u4ee5\u4e86\u89e3\u4e00\u4e0b\u72b6\u6001\uff0c\u5927\u6982\u5c31\u77e5\u9053\u600e\u4e48\u6539\u4e86\uff1a</p> <p></p> <p>\u4f46\u662f\u8bf4\u8fd8\u6709 <code>halt_pc</code> \u548c <code>halt_ret</code> \uff0c\u8fd9\u4e2a\u53c8\u662f\u4ec0\u4e48\uff1f\u5173\u4e8e\u7a0b\u5e8f\u9000\u51fa\u65f6\u5019\u7684pc\u503c\u3002</p> <p>\u90a3\u8fd9\u4e2aret\uff1f\u67e5\u4e86\u4e00\u4e0b\uff0c\u8bf4\u7684\u662f\u9000\u51fa\u65f6\u4faf\u7684\u72b6\u6001\u7801\uff0c\u54e6\u8bb0\u8d77\u6765\u4e86\uff0c\u597d\u50cf\u4e00\u822cshell\u4f1a\u6709\u9000\u51fa\u7801\u8fd9\u4e2a\u4e1c\u897f\uff1alinux - Shell\u63ed\u79d8\u2014\u2014\u7a0b\u5e8f\u9000\u51fa\u72b6\u6001\u7801 - \u4e2a\u4eba\u6587\u7ae0 - SegmentFault \u601d\u5426</p> <p>\u6240\u4ee5\u8bf4\uff0c\u6211\u4e00\u5f00\u59cb\u8fd9\u4e48\u505a\u8fd8\u662f\u6709\u70b9\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u770b\u770b\u4ed6\u8fd9\u4e2a\u72b6\u6001\u7801\u3002</p> <p>\u5728\u7c7b Unix \u7cfb\u7edf\u4e2d\uff0c\u72b6\u6001\u7801\u8fd9\u4e2a\u503c\u901a\u5e38\u7528\u4e8e\u8868\u793a\u7a0b\u5e8f\u9000\u51fa\u7684\u72b6\u6001\u3002</p> <ul> <li><code>0</code> \u901a\u5e38\u8868\u793a\u6210\u529f\u9000\u51fa\u3002</li> <li>\u975e <code>0</code> \u503c\u8868\u793a\u6709\u9519\u8bef\u6216\u5f02\u5e38\u9000\u51fa\u3002</li> </ul> <p>GPT:</p> <p>\u9000\u51fa\u72b6\u6001\u7801\uff08\u901a\u5e38\u7531\u7a0b\u5e8f\u7684\u8fd4\u56de\u503c\u6216\u7279\u5b9a\u7684\u73af\u5883\u53d8\u91cf\u8868\u793a\uff09\u5728\u8bb8\u591a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u673a\u5236\uff0c\u7528\u4e8e\u6307\u793a\u7a0b\u5e8f\u9000\u51fa\u7684\u539f\u56e0\u548c\u72b6\u6001\u3002\u5728\u7c7b Unix \u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e2a\u72b6\u6001\u7801\u5bf9\u4e8e\u811a\u672c\u3001\u8c03\u8bd5\u548c\u65e5\u5fd7\u8bb0\u5f55\u5c24\u4e3a\u91cd\u8981\u3002\u4ee5\u4e0b\u662f\u9000\u51fa\u72b6\u6001\u7801\u7684\u4e00\u4e9b\u7528\u9014\uff1a</p> <ol> <li>\u6307\u793a\u6210\u529f\u6216\u9519\u8bef:</li> <li> <p>\u9000\u51fa\u72b6\u6001\u7801\u901a\u5e38\u7528\u4e8e\u533a\u5206\u7a0b\u5e8f\u662f\u6210\u529f\u6267\u884c\u5b8c\u6bd5\u8fd8\u662f\u56e0\u4e3a\u9519\u8bef\u800c\u7ec8\u6b62\u3002\u5728\u8bb8\u591a\u7cfb\u7edf\u4e2d\uff0c\u8fd4\u56de\u503c\u4e3a <code>0</code> \u901a\u5e38\u8868\u793a\u6210\u529f\uff0c\u975e <code>0</code> \u503c\u8868\u793a\u6709\u9519\u8bef\u53d1\u751f\u3002</p> </li> <li> <p>\u63d0\u4f9b\u9519\u8bef\u7c7b\u578b\u4fe1\u606f:</p> </li> <li> <p>\u4e0d\u540c\u7684\u975e\u96f6\u9000\u51fa\u72b6\u6001\u7801\u53ef\u4ee5\u8868\u793a\u4e0d\u540c\u7c7b\u578b\u7684\u9519\u8bef\u6216\u5f02\u5e38\u60c5\u51b5\uff0c\u5982 <code>1</code> \u53ef\u80fd\u8868\u793a\u4e00\u822c\u9519\u8bef\uff0c<code>126</code> \u8868\u793a\u547d\u4ee4\u4e0d\u53ef\u6267\u884c\uff0c<code>127</code> \u8868\u793a\u547d\u4ee4\u672a\u627e\u5230\u7b49\u3002</p> </li> <li> <p>\u811a\u672c\u548c\u81ea\u52a8\u5316:</p> </li> <li> <p>\u5728\u7f16\u5199\u811a\u672c\u65f6\uff0c\u9000\u51fa\u72b6\u6001\u7801\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u6d41\u7a0b\uff0c\u4f8b\u5982\uff0c\u53ea\u6709\u5f53\u4e00\u4e2a\u547d\u4ee4\u6210\u529f\u6267\u884c\uff08\u8fd4\u56de <code>0</code>\uff09\u65f6\uff0c\u811a\u672c\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u4e2a\u547d\u4ee4\u3002</p> </li> <li> <p>\u8c03\u8bd5\u8f85\u52a9:</p> </li> <li> <p>\u5982\u679c\u7a0b\u5e8f\u5d29\u6e83\u6216\u56e0\u9519\u8bef\u800c\u9000\u51fa\uff0c\u9000\u51fa\u72b6\u6001\u7801\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u5feb\u901f\u8bc6\u522b\u95ee\u9898\u6240\u5728\u3002</p> </li> <li> <p>\u7b26\u5408\u7ea6\u5b9a:</p> </li> <li>\u4f7f\u7528\u9000\u51fa\u72b6\u6001\u7801\u662f\u9075\u5faa POSIX \u6807\u51c6\u548c\u8bb8\u591a\u5176\u4ed6\u7cfb\u7edf\u7ea6\u5b9a\u7684\u4e00\u79cd\u505a\u6cd5\uff0c\u8fd9\u6709\u52a9\u4e8e\u7a0b\u5e8f\u4e0e\u7cfb\u7edf\u548c\u7528\u6237\u671f\u671b\u7684\u884c\u4e3a\u4fdd\u6301\u4e00\u81f4\u3002</li> </ol> <p>\u5728\u5f00\u6e90\u9879\u76ee\u4e2d\uff0c\u4f7f\u7528\u9000\u51fa\u72b6\u6001\u7801\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u6807\u51c6\u5316\u7684\u65b9\u5f0f\u6765\u62a5\u544a\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u3002\u8bb8\u591a\u5f00\u6e90\u9879\u76ee\u9075\u5faa\u8fd9\u4e9b\u7ea6\u5b9a\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u7684\u5de5\u5177\u548c\u5e94\u7528\u7a0b\u5e8f\u80fd\u591f\u5728\u591a\u79cd\u73af\u5883\u4e2d\u53ef\u9760\u5730\u5de5\u4f5c\u3002</p> <p>\u81f3\u4e8e <code>halt_ret</code>\uff0c\u5b83\u53ef\u80fd\u662f\u7279\u5b9a\u4e8e NEMU \u6a21\u62df\u5668\u7684\u5b9e\u73b0\uff0c\u7528\u4e8e\u8bb0\u5f55\u6a21\u62df\u5668\u505c\u6b62\u65f6\u7684\u72b6\u6001\u3002\u5728\u6a21\u62df\u5668\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c<code>halt_ret</code> \u53ef\u80fd\u7528\u4e8e\u8bb0\u5f55\u6a21\u62df\u7a0b\u5e8f\u7684\u9000\u51fa\u72b6\u6001\uff0c\u6216\u8005\u6a21\u62df\u7a0b\u5e8f\u6267\u884c\u7684\u67d0\u4e9b\u7279\u5b9a\u884c\u4e3a\u3002</p> <p>\u5373\u4f7f\u60a8\u4e0d\u663e\u5f0f\u8bbe\u7f6e <code>halt_ret</code>\uff0c\u8bb8\u591a\u7cfb\u7edf\u4e5f\u4f1a\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u4e00\u4e2a\u9ed8\u8ba4\u7684\u9000\u51fa\u72b6\u6001\u7801\u3002\u7136\u800c\uff0c\u4e3a\u4e86\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u9519\u8bef\u5904\u7406\u548c\u8c03\u8bd5\u4fe1\u606f\uff0c\u663e\u5f0f\u8bbe\u7f6e\u9000\u51fa\u72b6\u6001\u7801\u662f\u4e00\u79cd\u826f\u597d\u7684\u7f16\u7a0b\u5b9e\u8df5\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u4f7f\u7528\u9000\u51fa\u72b6\u6001\u7801\u5e76\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4e60\u60ef\uff0c\u800c\u662f\u4e00\u79cd\u5728\u8f6f\u4ef6\u5f00\u53d1\u4e2d\u5e7f\u6cdb\u91c7\u7528\u7684\u7ea6\u5b9a\uff0c\u5b83\u6709\u52a9\u4e8e\u63d0\u9ad8\u7a0b\u5e8f\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u53ef\u7528\u6027\u3002</p> <p></p> <p>\u81f3\u4e8e\u8bf4\u4e3a\u4ec0\u4e48\u76f4\u63a5\u62a5\u4e86\u8fd9\u4e2a\u9519\u8bef\uff1a</p> <p></p> <p>\u56e0\u4e3aC\u8bed\u8a00\u7684 <code>main</code> \u51fd\u6570\u8fd4\u56de\u503c\u7528\u6765\u8868\u793a\u7a0b\u5e8f\u7684\u6267\u884c\u72b6\u6001\uff1a</p> <ul> <li>\u5f53 main \u51fd\u6570\u8fd4\u56de0\u65f6\uff0c\u8868\u793a\u7a0b\u5e8f\u6b63\u5e38\u6267\u884c\u7ed3\u675f\uff0c\u6ca1\u6709\u53d1\u751f\u9519\u8bef\u3002\u8fd9\u901a\u5e38\u88ab\u89c6\u4e3a\u7a0b\u5e8f\u6210\u529f\u6267\u884c\u7684\u6807\u5fd7\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c060\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u9000\u51fa\u72b6\u6001\u7801\uff0c\u8868\u793a\u7a0b\u5e8f\u6b63\u5e38\u9000\u51fa\u3002</li> <li>\u5f53 main \u51fd\u6570\u8fd4\u56de\u975e0\u503c\uff08\u901a\u5e38\u662f1\uff09\u65f6\uff0c\u8868\u793a\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u67d0\u79cd\u9519\u8bef\u6216\u5f02\u5e38\u60c5\u51b5\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u975e0\u7684\u8fd4\u56de\u503c\u901a\u5e38\u88ab\u7528\u6765\u8868\u793a\u7a0b\u5e8f\u7684\u9519\u8bef\u72b6\u6001\uff0c\u4ee5\u4fbf\u8ba9\u8c03\u7528\u7a0b\u5e8f\u6216\u64cd\u4f5c\u7cfb\u7edf\u77e5\u9053\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u95ee\u9898\u3002</li> </ul> <p>\u548c\u4e0a\u9762\u7c7b\u4f3c\u4e86</p> <p></p> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_10","title":"\u518d\u6b21\u7406\u89e3\u6846\u67b6\u4ee3\u7801","text":"<ul> <li> <p>\u5b58\u50a8\u5668</p> <p><code>nemu/src/memory/paddr.c</code>\u4e2d\u5b9a\u4e49\u7684\u8d85\u5927 uint8_t \u7684\u4e00\u7ef4\u6570\u7ec4</p> </li> <li> <p>PC\u548c\u901a\u7528\u5bc4\u5b58\u5668</p> <p><code>nemu/src/isa/$ISA/include/isa-def.h</code>\u4e2d\u7684\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49</p> </li> <li> <p>\u52a0\u6cd5\u5668</p> <p>\u5728... \u55ef, \u8fd9\u90e8\u5206\u6846\u67b6\u4ee3\u7801\u6709\u70b9\u590d\u6742, \u4e0d\u8fc7\u5b83\u5e76\u4e0d\u5f71\u54cd\u6211\u4eec\u5bf9TRM\u7684\u7406\u89e3, \u6211\u4eec\u8fd8\u662f\u5728PA2\u91cc\u9762\u518d\u4ecb\u7ecd\u5b83\u5427</p> </li> <li> <p>TRM\u7684\u5de5\u4f5c\u65b9\u5f0f</p> <p>\u901a\u8fc7<code>cpu_exec()</code>\u548c<code>exec_once()</code>\u4f53\u73b0</p> </li> </ul> <p>\u4f60\u9700\u8981\u7ed3\u5408\u4e0a\u8ff0\u6587\u5b57\u7406\u89e3NEMU\u7684\u6846\u67b6\u4ee3\u7801.</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\"\u600e\u4e48\u624d\u7b97\u662f\u770b\u61c2\u4e86\u6846\u67b6\u4ee3\u7801\", \u4f60\u53ef\u4ee5\u5148\u5c1d\u8bd5\u8fdb\u884c\u540e\u9762\u7684\u4efb\u52a1. \u5982\u679c\u53d1\u73b0\u4e0d\u77e5\u9053\u5982\u4f55\u4e0b\u624b, \u518d\u56de\u6765\u4ed4\u7ec6\u9605\u8bfb\u8fd9\u4e00\u9875\u9762. </p> <p>\u7406\u89e3\u6846\u67b6\u4ee3\u7801\u662f\u4e00\u4e2a\u87ba\u65cb\u4e0a\u5347\u7684\u8fc7\u7a0b, \u4e0d\u540c\u7684\u9636\u6bb5\u6709\u4e0d\u540c\u7684\u91cd\u70b9. </p> <p>\u4e0d\u5fc5\u56e0\u4e3a\u770b\u4e0d\u61c2\u67d0\u4e9b\u7ec6\u8282\u800c\u611f\u5230\u6cae\u4e27, \u66f4\u4e0d\u8981\u8bd5\u56fe\u4e00\u6b21\u628a\u6240\u6709\u4ee3\u7801\u5168\u90e8\u770b\u660e\u767d.</p>"},{"location":"ysyx/pa/pa1/pa1.html#rtfsc-","title":"\u600e\u4e48\u7406\u89e3 RTFSC ---&gt; \u600e\u4e48\u9605\u8bfb\u5927\u578b\u7684\u6e90\u7801","text":"<p>RTFSC != \u76ef\u7740\u4ee3\u7801\u770b</p> <p>\u4f60\u5f88\u53ef\u80fd\u662f\u7b2c\u4e00\u6b21\u63a5\u89e6\u5230\u8fd9\u4e48\u591a\u6e90\u6587\u4ef6\u7684\u9879\u76ee, \u770b\u4ee3\u7801\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u611f\u5230\u5f88\u8ff7\u832b: \u4e0d\u77e5\u9053\u51fd\u6570\u7684\u5b9a\u4e49\u5728\u54ea\u4e2a\u6587\u4ef6, \u4e0d\u7406\u89e3\u51fd\u6570\u7684\u529f\u80fd\u662f\u4ec0\u4e48, \u4e0d\u6e05\u695a\u67d0\u6bb5\u4ee3\u7801\u7684\u884c\u4e3a\u5177\u4f53\u5982\u4f55... \u540c\u65f6\u4f60\u4e5f\u5f88\u53ef\u80fd\u6cbf\u7528\u4ee5\u524d\u770b\u4ee3\u7801\u6700\u539f\u59cb\u7684\u65b9\u5f0f: \u7528\u773c\u775b\u770b. \u4f60\u575a\u6301\u770b\u4e86\u4e00\u6bb5\u65f6\u95f4, \u53d1\u73b0\u8fd8\u662f\u6ca1\u4ec0\u4e48\u6536\u83b7, \u4e8e\u662f\u4f60\u5f00\u59cb\u611f\u5230\u6cae\u4e27...</p> <p>\u5bf9\u4e8e\u53ea\u6709\u4e00\u4e24\u4e2a\u6e90\u6587\u4ef6, \u4ee3\u7801\u53ea\u6709\u51e0\u767e\u884c\u7684\u9879\u76ee, \u76f4\u63a5RTFSC\u8fd8\u662f\u6709\u6548\u679c\u7684. \u4f46\u5982\u679c\u6e90\u6587\u4ef6\u66f4\u591a, \u4ee3\u7801\u91cf\u66f4\u5927, \u4f60\u5f88\u5feb\u5c31\u4f1a\u53d1\u73b0\u8fd9\u79cd\u505a\u6cd5\u6548\u7387\u5f88\u4f4e, \u8fd9\u662f\u56e0\u4e3a\u4eba\u8111\u7684\u77ed\u671f\u8bb0\u5fc6\u80fd\u529b\u662f\u5f88\u6709\u9650\u7684, \u5373\u4f7f\u662f\u9759\u6001\u7684\u4ee3\u7801\u4e5f\u65e0\u6cd5\u5b8c\u5168\u8bb0\u5f97\u4f4f, \u66f4\u4f55\u51b5\u7a0b\u5e8f\u7684\u52a8\u6001\u884c\u4e3a\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u72b6\u6001\u673a, \u4f60\u7684\u5927\u8111\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u53ea\u80fd\u6a21\u62df\u51fa\u8fd9\u4e2a\u72b6\u6001\u673a\u5f88\u5c0f\u7684\u4e00\u90e8\u5206.</p> <p>\u6709\u6ca1\u6709\u5de5\u5177\u80fd\u591f\u5e2e\u4f60\u6a21\u62df\u8fd9\u4e2a\u5de8\u5927\u7684\u72b6\u6001\u673a\u5462? \u8fd9\u65f6\u6211\u4eec\u5728PA0\u91cc\u9762\u63d0\u5230\u7684\u4e00\u4e2a\u5de5\u5177\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86, \u5b83\u5c31\u662fGDB. \u5728GDB\u4e2d, \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5355\u6b65\u6267\u884c\u7684\u65b9\u5f0f\u8ba9\u7a0b\u5e8f\u4e00\u6b21\u6267\u884c\u4e00\u6761\u6307\u4ee4, \u76f8\u5f53\u4e8e\u8ba9\u72b6\u6001\u673a\u4e00\u6b21\u53ea\u524d\u8fdb\u4e00\u6b65, \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u89c2\u5bdf\u7a0b\u5e8f\u4efb\u610f\u65f6\u523b\u7684\u72b6\u6001\u4e86! \u800c\u4e14\u72b6\u6001\u673a\u524d\u8fdb\u7684\u8f68\u8ff9\u5c31\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u771f\u5b9e\u987a\u5e8f, \u4e8e\u662f\u4f60\u5c31\u53ef\u4ee5\u4e00\u8fb9\u8fd0\u884c\u7a0b\u5e8f\u4e00\u8fb9\u7406\u89e3\u7a0b\u5e8f\u7684\u884c\u4e3a\u4e86. \u8fd9\u5bf9\u4e8e\u4e00\u4e9b\u6307\u9488\u76f8\u5173\u7684\u4ee3\u7801\u6709\u7740\u4e0d\u9519\u7684\u6548\u679c, \u5c24\u5176\u662f\u51fd\u6570\u6307\u9488, \u56e0\u4e3a\u4f60\u4ece\u9759\u6001\u4ee3\u7801\u4e0a\u5f88\u53ef\u80fd\u770b\u4e0d\u51fa\u6765\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\u8fd9\u4e2a\u6307\u9488\u4f1a\u6307\u5411\u54ea\u4e2a\u51fd\u6570.</p> <p>GDB\u8fd8\u81ea\u5e26\u4e00\u4e2a\u53ebTUI\u7684\u7b80\u5355\u754c\u9762. \u5728\u4e00\u4e2a\u9ad8\u5ea6\u8f83\u9ad8\u7684\u7a97\u53e3\u4e2d\u8fd0\u884cGDB\u540e, \u8f93\u5165<code>layout split</code>\u5c31\u53ef\u4ee5\u5207\u6362\u5230TUI, \u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u540c\u65f6\u4ece\u6e90\u4ee3\u7801\u548c\u6307\u4ee4\u7684\u89d2\u5ea6\u6765\u89c2\u5bdf\u7a0b\u5e8f\u7684\u884c\u4e3a\u4e86. \u4e0d\u8fc7\u4e3a\u4e86\u770b\u5230\u6e90\u4ee3\u7801, \u4f60\u8fd8\u9700\u8981\u5728\u7f16\u8bd1NEMU\u65f6\u6dfb\u52a0GDB\u8c03\u8bd5\u4fe1\u606f, \u5177\u4f53\u64cd\u4f5c\u89c1\u4e0b\u9762\u7684\u63d0\u793a\u6846. \u5982\u679c\u4f60\u60f3\u4e86\u89e3TUI\u7684\u66f4\u591a\u5185\u5bb9, STFW.</p> <p>\u4e3a\u4e86\u5e2e\u52a9\u4f60\u66f4\u9ad8\u6548\u5730RTFSC, \u4f60\u6700\u597d\u901a\u8fc7RTFM\u548cSTFW\u591a\u8ba4\u8bc6GDB\u7684\u4e00\u4e9b\u547d\u4ee4\u548c\u64cd\u4f5c, \u6bd4\u5982:</p> <ul> <li>\u5355\u6b65\u6267\u884c\u8fdb\u5165\u4f60\u611f\u5174\u8da3\u7684\u51fd\u6570</li> <li>\u5355\u6b65\u6267\u884c\u8df3\u8fc7\u4f60\u4e0d\u611f\u5174\u8da3\u7684\u51fd\u6570(\u4f8b\u5982\u5e93\u51fd\u6570)</li> <li>\u8fd0\u884c\u5230\u51fd\u6570\u672b\u5c3e</li> <li>\u6253\u5370\u53d8\u91cf\u6216\u5bc4\u5b58\u5668\u7684\u503c</li> <li>\u626b\u63cf\u5185\u5b58</li> <li>\u67e5\u770b\u8c03\u7528\u6808</li> <li>\u8bbe\u7f6e\u65ad\u70b9</li> <li>\u8bbe\u7f6e\u76d1\u89c6\u70b9</li> </ul> <p>\u5982\u679c\u4f60\u4e4b\u524d\u6ca1\u6709\u4f7f\u7528\u8fc7GDB, \u7136\u540e\u5728PA0\u4e2d\u53c8\u8df3\u8fc7\u4e86GDB\u76f8\u5173\u7684\u5185\u5bb9, \u73b0\u5728\u4f60\u5c31\u8981\u5403\u5077\u61d2\u7684\u4e8f\u4e86.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_11","title":"\u57fa\u7840\u8bbe\u65bd\uff1a\u5efa\u8bae\u8c03\u8bd5\u5668","text":"<p>\u5728monitor\u4e2d\u5b9e\u73b0\u4e00\u4e2a\u5177\u6709\u5982\u4e0b\u529f\u80fd\u7684\u7b80\u6613\u8c03\u8bd5\u5668 (\u76f8\u5173\u90e8\u5206\u7684\u4ee3\u7801\u5728<code>nemu/src/monitor/sdb/</code>\u76ee\u5f55\u4e0b), \u5982\u679c\u4f60\u4e0d\u6e05\u695a\u547d\u4ee4\u7684\u683c\u5f0f\u548c\u529f\u80fd, \u8bf7\u53c2\u8003\u5982\u4e0b\u8868\u683c:</p> \u547d\u4ee4 \u683c\u5f0f \u4f7f\u7528\u4e3e\u4f8b \u8bf4\u660e \u5e2e\u52a9(1) <code>help</code> <code>help</code> \u6253\u5370\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f \u7ee7\u7eed\u8fd0\u884c(1) <code>c</code> <code>c</code> \u7ee7\u7eed\u8fd0\u884c\u88ab\u6682\u505c\u7684\u7a0b\u5e8f \u9000\u51fa(1) <code>q</code> <code>q</code> \u9000\u51faNEMU \u5355\u6b65\u6267\u884c <code>si [N]</code> <code>si 10</code> \u8ba9\u7a0b\u5e8f\u5355\u6b65\u6267\u884c<code>N</code>\u6761\u6307\u4ee4\u540e\u6682\u505c\u6267\u884c, \u5f53<code>N</code>\u6ca1\u6709\u7ed9\u51fa\u65f6, \u7f3a\u7701\u4e3a<code>1</code> \u6253\u5370\u7a0b\u5e8f\u72b6\u6001 <code>info SUBCMD</code> <code>info r</code> <code>info w</code> \u6253\u5370\u5bc4\u5b58\u5668\u72b6\u6001 \u6253\u5370\u76d1\u89c6\u70b9\u4fe1\u606f \u626b\u63cf\u5185\u5b58(2) <code>x N EXPR</code> <code>x 10 $esp</code> \u6c42\u51fa\u8868\u8fbe\u5f0f<code>EXPR</code>\u7684\u503c, \u5c06\u7ed3\u679c\u4f5c\u4e3a\u8d77\u59cb\u5185\u5b58 \u5730\u5740, \u4ee5\u5341\u516d\u8fdb\u5236\u5f62\u5f0f\u8f93\u51fa\u8fde\u7eed\u7684<code>N</code>\u4e2a4\u5b57\u8282 \u8868\u8fbe\u5f0f\u6c42\u503c <code>p EXPR</code> <code>p $eax + 1</code> \u6c42\u51fa\u8868\u8fbe\u5f0f<code>EXPR</code>\u7684\u503c, <code>EXPR</code>\u652f\u6301\u7684 \u8fd0\u7b97\u8bf7\u89c1\u8c03\u8bd5\u4e2d\u7684\u8868\u8fbe\u5f0f\u6c42\u503c\u5c0f\u8282 \u8bbe\u7f6e\u76d1\u89c6\u70b9 <code>w EXPR</code> <code>w *0x2000</code> \u5f53\u8868\u8fbe\u5f0f<code>EXPR</code>\u7684\u503c\u53d1\u751f\u53d8\u5316\u65f6, \u6682\u505c\u7a0b\u5e8f\u6267\u884c \u5220\u9664\u76d1\u89c6\u70b9 <code>d N</code> <code>d 2</code> \u5220\u9664\u5e8f\u53f7\u4e3a<code>N</code>\u7684\u76d1\u89c6\u70b9 <p>\u5907\u6ce8:</p> <ul> <li>(1) \u547d\u4ee4\u5df2\u5b9e\u73b0</li> <li>(2) \u4e0eGDB\u76f8\u6bd4, \u6211\u4eec\u5728\u8fd9\u91cc\u505a\u4e86\u7b80\u5316, \u66f4\u6539\u4e86\u547d\u4ee4\u7684\u683c\u5f0f</li> </ul> <p>\u601d\u8003\u9898\u5982\u4f55\u6d4b\u8bd5\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570?</p> <p>\u4f60\u53ef\u80fd\u4f1a\u6291\u5236\u4e0d\u4f4f\u7f16\u7801\u7684\u51b2\u52a8: \u4e0e\u5176RTFM, \u8fd8\u4e0d\u5982\u81ea\u5df1\u5199. \u5982\u679c\u771f\u662f\u8fd9\u6837, \u4f60\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b, \u4f60\u4f1a\u5982\u4f55\u6d4b\u8bd5\u81ea\u5df1\u7f16\u5199\u7684\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570?</p> <p>\u5982\u679c\u4f60\u613f\u610fRTFM, \u4e5f\u4e0d\u59a8\u601d\u8003\u4e00\u4e0b\u8fd9\u4e2a\u95ee\u9898, \u56e0\u4e3a\u4f60\u4f1a\u5728PA2\u4e2d\u9047\u5230\u7c7b\u4f3c\u7684\u95ee\u9898.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_12","title":"\u5355\u6b65\u6267\u884c","text":"<p>\u5173\u4e8e\u6307\u4ee4\u540d\u5b57\u7684\u5224\u65ad\u5df2\u7ecf\u5728 <code>sdb_mainloop</code> \u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\uff01\u522b\u72af\u8ff7\u7cca\u4e86\uff01</p> <p>\u8fd8\u662f\u6709\u70b9\u4e0d\u592a\u7406\u89e3\u8fd9\u4e2a\u6846\u67b6\u4ee3\u7801\u5230\u5e95\u662f\u5e72\u4ec0\u4e48\u7684\uff0c<code>cpu_exec(uint64_t n)</code> \u5c31\u662f\u6267\u884c\u4ee3\u7801\u7684\u51fd\u6570\uff0c\u4f20\u8fdb\u53bb\u7684\u53c2\u6570\u5c31\u662f\u8981\u6267\u884c\u7684\u6267\u884c\uff0c\u6709\u70b9\u8ff7\u7cca\u4e86\u4e00\u5f00\u59cb\u3002</p> <p></p> <p>\u7406\u89e3\u4e00\u4e0b\u5173\u4e8e\u6307\u9488\u6570\u7ec4</p> <p></p> <p>\u6211 <code>*regs[0]</code> \u5b9e\u9645\u4e0a\u8bbf\u95ee\u4e86\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u6362\u7b97\u6210ASIC\u7801\u5373\u53ef\u77e5\u9053\u3002\u4f46\u662f\u4e3a\u4ec0\u4e48\u4e4b\u540e\u7801\u4e00\u76f4\u90fd\u662f\u540c\u6837\u7684\u51e0\u4e2a\u6570\u503c\uff1f</p> <p>\u597d\u50cf\u771f\u7684\u90fd\u662f\u5f00\u5934\u90a3\u4e2a\u5b57\u7b26\u7684\u7ed3\u679c\uff1f</p> <p>\u8fd8\u6709\uff0c\u5c31\u7b97\u6211\u7b2c\u4e09\u4e2a\u662f\u5bf9\u7684\uff1a<code>gpr(i)</code>\uff0c\u4f46\u662f\u4e3a\u4ec0\u4e48\u7ed3\u679c\u8f93\u51fa\u5168\u90fd\u662f0\uff1f</p> <p>\u6211\u73b0\u5728\u5bc4\u5b58\u5668\u91cc\u9762\u4ec0\u4e48\u90fd\u6ca1\u5b58\uff0c\u90fd\u662f\u521d\u59cb\u503c\uff1f</p> <p><code>args[0]</code> \u6307\u7684\u662f\u8f93\u5165\u547d\u4ee4\u540e\u7684\u53c2\u6570\uff0c\u518d\u5f00\u59cb\u8ba1\u6570\u7684</p> <p></p>"},{"location":"ysyx/pa/pa1/pa1.html#_13","title":"\u6253\u5370\u5bc4\u5b58\u5668","text":""},{"location":"ysyx/pa/pa1/pa1.html#_14","title":"\u626b\u63cf\u5185\u5b58","text":"<p>\u5206\u6790\u5b57\u7b26\u4e32\u793a\u4f8b\u7684\u65f6\u5019\uff1a <code>x 10 0x80000000</code> \u53c8\u641e\u6df7\u4e86args[0]\uff0c\u8fd8\u662f\u6709\u70b9\u95ee\u9898\uff0c\u90a3\u4e2a <code>x</code> \u5728 <code>sdb</code> \u7684\u4e3b\u5faa\u73af\u5c31\u5df2\u7ecf\u5224\u65ad\u5b8c\u6210\u4e86\uff0c\u4f20\u8fdb\u53bb\u7684\u662f 10\u4e4b\u540e\u7684\u4e86\u3002</p> <p>\u901a\u8fc7\u6253\u5370\u7b2c\u4e00\u4e2a\u5b57\u7b26\u770b\u770b\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u53d1\u73b0\u6253\u5370\u4e861\uff0c\u5c31\u662f\u4f20\u8fdb\u53bb\u4e8610</p> <p></p> <p>\u76f4\u63a5\u7528\u6307\u9488\uff0c\u4f1a\u6709\u95ee\u9898\u5594\u3002\u8fd9\u91cc\u5e94\u8be5\u6709\u4e00\u4e2a\u7c7b\u578b\u63d0\u5347\uff1f</p> <p>\u4e0d\u5bf9\uff0c\u5e94\u8be5\u6ca1\u6709\uff0cchar\u578b\u672c\u8d28\u4e0a\u5e94\u8be5\u8fd8\u662f\u4e00\u4e2a\u6574\u578b\uff0c\u6240\u4ee5\u5e94\u8be5\u7528\u7684\u662f\u4ed6\u7684ASIC\u7801\u8868\u5224\u65ad\u7684\u3002</p> <p>\u6ca1\u9519\uff0c\u901a\u8fc7\u76f4\u63a5\u6253\u5370\uff0c\u8f93\u51fa\u4e8649\u6b21 \u521a\u597d\u662f\u5b57\u7b261\u7684ASIC\u7801\u503c\u3002</p> <p>\u6240\u4ee5\u52a0\u4e2a <code>atoi</code> \u7528\u6765\u8f6c\u6362\u6210\u6570\u503c</p> <p>\u5173\u4e8e <code>strtoul</code> \u4f7f\u7528</p> <p>\u5728\u8c03\u7528 <code>strtoul</code>\u3001<code>strtoull</code> \u6216\u5176\u4ed6\u76f8\u5173\u51fd\u6570\uff08\u5982 <code>strtol</code>\u3001<code>strtoull</code> \u7b49\uff09\u65f6\u4f20\u9012 <code>NULL</code> \u4f5c\u4e3a <code>endptr</code> \u53c2\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u7684\u884c\u4e3a\u4f1a\u7565\u6709\u4e0d\u540c\uff1a</p> <ol> <li><code>strtoul</code> \u548c <code>strtoull</code>:</li> <li> <p>\u5982\u679c\u60a8\u4f20\u9012 <code>NULL</code> \u4f5c\u4e3a <code>endptr</code> \u53c2\u6570\uff0c\u51fd\u6570\u4ecd\u5c06\u5c1d\u8bd5\u8f6c\u6362\u5b57\u7b26\u4e32\uff0c\u4f46\u60a8\u5c06\u65e0\u6cd5\u77e5\u9053\u5b57\u7b26\u8f6c\u6362\u7ed3\u675f\u540e\u7684\u5269\u4f59\u5b57\u7b26\u4e32\u5185\u5bb9\u3002\u8fd9\u610f\u5473\u7740\u60a8\u65e0\u6cd5\u68c0\u67e5\u8f93\u5165\u5b57\u7b26\u4e32\u4e2d\u8f6c\u6362\u540e\u7684\u5b57\u7b26\u662f\u5426\u6709\u6548\uff0c\u4e5f\u65e0\u6cd5\u533a\u5206\u4e0d\u540c\u7684\u9519\u8bef\u60c5\u51b5\u3002</p> </li> <li> <p><code>strtol</code> \u548c <code>strtol</code>:</p> </li> <li>\u540c\u6837\uff0c\u5982\u679c\u60a8\u4e0d\u63d0\u4f9b <code>endptr</code>\uff0c\u60a8\u5c06\u65e0\u6cd5\u83b7\u53d6\u6709\u5173\u8f6c\u6362\u540e\u5269\u4f59\u5b57\u7b26\u4e32\u7684\u4fe1\u606f\u3002</li> </ol> <p>\u5728\u5904\u7406\u5b57\u7b26\u4e32\u8f6c\u6362\u65f6\uff0c<code>endptr</code> \u53c2\u6570\u975e\u5e38\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u60a8\u68c0\u67e5\u8f6c\u6362\u8fc7\u7a0b\uff1a</p> <ul> <li>\u6210\u529f\u8f6c\u6362: \u5982\u679c\u8f6c\u6362\u6210\u529f\uff0c<code>endptr</code> \u5c06\u6307\u5411\u5b57\u7b26\u4e32\u4e2d\u7b2c\u4e00\u4e2a\u672a\u88ab\u8f6c\u6362\u7684\u5b57\u7b26\u3002</li> <li>\u65e0\u6548\u8f93\u5165: \u5982\u679c\u8f93\u5165\u5b57\u7b26\u4e32\u4ee5\u975e\u6570\u5b57\u5b57\u7b26\u5f00\u59cb\uff0c<code>endptr</code> \u5c06\u6307\u5411\u539f\u59cb\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u4f4d\u7f6e\uff0c\u51fd\u6570\u5c06\u8fd4\u56de 0\u3002</li> <li>\u7a7a\u5b57\u7b26\u4e32\u6216\u7a7a\u5b57\u7b26: \u5982\u679c\u8f93\u5165\u5b57\u7b26\u4e32\u4e3a\u7a7a\u6216\u53ea\u5305\u542b\u7a7a\u5b57\u7b26\uff0c<code>endptr</code> \u4e5f\u4f1a\u6307\u5411\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002</li> </ul> <p>\u901a\u8fc7\u68c0\u67e5 <code>endptr</code>\uff0c\u60a8\u53ef\u4ee5\u533a\u5206\u4e0a\u8ff0\u60c5\u51b5\u5e76\u76f8\u5e94\u5730\u5904\u7406\u9519\u8bef\u3002\u5982\u679c\u4e0d\u4f7f\u7528 <code>endptr</code>\uff0c\u60a8\u5c06\u5931\u53bb\u8fd9\u79cd\u80fd\u529b\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u60a8\u7684\u7a0b\u5e8f\u65e0\u6cd5\u6b63\u786e\u5904\u7406\u6240\u6709\u53ef\u80fd\u7684\u9519\u8bef\u60c5\u51b5\u3002</p> <p>\u793a\u4f8b:</p> <pre><code>char *endptr;\nlong int value = strtol(input_string, &amp;endptr, 10);\n\nif (endptr == input_string) {\n    // \u6ca1\u6709\u6d88\u5316\u4efb\u4f55\u5b57\u7b26\uff0c\u53ef\u80fd\u662f\u7a7a\u5b57\u7b26\u4e32\u6216\u65e0\u6548\u8f93\u5165\n} else if (*endptr != '\\0') {\n    // \u8f6c\u6362\u540e\u8fd8\u6709\u5269\u4f59\u5b57\u7b26\uff0c\u53ef\u80fd\u662f\u683c\u5f0f\u4e0d\u6b63\u786e\u6216\u9700\u8981\u8fdb\u4e00\u6b65\u5904\u7406\n} else {\n    // \u6210\u529f\u8f6c\u6362\u4e86\u6574\u4e2a\u5b57\u7b26\u4e32\n}\n</code></pre> <p>\u5728\u60a8\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u60a8\u5728\u8c03\u7528 <code>strtoul</code> \u6216 <code>strtoull</code> \u65f6\u4f20\u9012 <code>NULL</code> \u4f5c\u4e3a <code>endptr</code>\uff0c\u60a8\u5c06\u65e0\u6cd5\u68c0\u67e5 <code>next</code> \u5b57\u7b26\u4e32\u662f\u5426\u53ea\u5305\u542b\u6709\u6548\u7684\u5341\u516d\u8fdb\u5236\u6570\u5b57\uff0c\u4e5f\u65e0\u6cd5\u77e5\u9053\u662f\u5426\u6709\u5269\u4f59\u5b57\u7b26\u3002\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u60a8\u7684\u7a0b\u5e8f\u5728\u5904\u7406\u9519\u8bef\u7684\u8f93\u5165\u5b57\u7b26\u4e32\u65f6\u51fa\u73b0\u95ee\u9898\u3002\u56e0\u6b64\uff0c\u63a8\u8350\u4f7f\u7528 <code>endptr</code> \u53c2\u6570\u6765\u589e\u5f3a\u9519\u8bef\u68c0\u67e5\u548c\u5904\u7406\u80fd\u529b\u3002</p> <p>```c</p>"},{"location":"ysyx/pa/pa1/pa1.html#include","title":"include","text":""},{"location":"ysyx/pa/pa1/pa1.html#include_1","title":"include","text":""},{"location":"ysyx/pa/pa1/pa1.html#include_2","title":"include","text":""},{"location":"ysyx/pa/pa1/pa1.html#include_3","title":"include  <p>// \u5047\u8bbe vaddr_read \u662f\u4e00\u4e2a\u5df2\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u8bfb\u53d6\u5185\u5b58\u5730\u5740\u7684\u503c word_t vaddr_read(vaddr_t addr, int size);</p> <p>typedef unsigned long long word_t; // \u5047\u8bbe word_t \u662f unsigned long long \u7684\u522b\u540d typedef unsigned long vaddr_t;     // \u5047\u8bbe vaddr_t \u662f unsigned long \u7684\u522b\u540d</p> <p>static int cmd_x(char *args) {    if (args == NULL) {         printf(\"Please pass argument.\\n\");         return 0;     }</p> <pre><code>int num = 1; // \u9ed8\u8ba4\u503c\nunsigned long long test_expr = 0; // \u7528\u4e8e\u5b58\u50a8\u5730\u5740\u7684\u53d8\u91cf\n\nchar *str = strdup(args);\nif (str == NULL) {\n    printf(\"memory allocate error\\n\");\n    return 0;\n}\n\nchar *token = strtok(str, \" \");\nif (token != NULL) {\n    if (is_hex(token)) {\n        test_expr = strtoull(token, NULL, 16);\n    } else {\n        num = atoi(token);\n        token = strtok(NULL, \" \");\n        if (token == NULL || !is_hex(token)) {\n            printf(\"please pass the correct hex address.\\n\");\n            free(str);\n            return 0;\n        }\n        test_expr = strtoull(token, NULL, 16);\n    }\n} else {\n    printf(\"No arguments provided.\\n\");\n    free(str);\n    return 0;\n}\n\nfree(str);\n\nfor (int i = 0; i &lt; num; i++) {\n    result = vaddr_read((vaddr_t)(test_expr + i * 4), 4);\n    printf(\"0x%08x: 0x%08x\\n\", test_expr + i * 4, result);\n}\n\nreturn 0;\n</code></pre> <p>} ```</p>","text":""},{"location":"ysyx/pa/pa1/pa1.html#_15","title":"\u540c\u6837\u529f\u80fd\u7684\u51fd\u6570\u603b\u7ed3","text":"<ul> <li><code>atoi</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>int</code> \u7c7b\u578b\u3002</li> <li><code>atol</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>long</code> \u7c7b\u578b\u3002</li> <li><code>atoll</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>long long</code> \u7c7b\u578b\u3002</li> <li><code>strtol</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>long</code> \u7c7b\u578b\uff0c\u5e76\u5141\u8bb8\u6307\u5b9a\u57fa\u6570\u3002</li> <li><code>strtoll</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>long long</code> \u7c7b\u578b\uff0c\u5e76\u5141\u8bb8\u6307\u5b9a\u57fa\u6570\u3002</li> <li><code>strtoul</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>unsigned long</code> \u7c7b\u578b\uff0c\u5e76\u5141\u8bb8\u6307\u5b9a\u57fa\u6570\u3002</li> <li><code>strtoull</code>: \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a <code>unsigned long long</code> \u7c7b\u578b\uff0c\u5e76\u5141\u8bb8\u6307\u5b9a\u57fa\u6570\u3002</li> </ul> <p>\u8fd9\u4e9b\u51fd\u6570\u90fd\u53ef\u7528\u4e8e\u5b57\u7b26\u4e32\u5230\u6570\u503c\u7684\u8f6c\u6362\uff0c\u9009\u62e9\u54ea\u4e2a\u51fd\u6570\u53d6\u51b3\u4e8e\u60a8\u9700\u8981\u7684\u6570\u503c\u7c7b\u578b\u548c\u57fa\u6570\u3002\u5728\u5904\u7406\u5927\u6570\u503c\u6216\u5341\u516d\u8fdb\u5236\u6570\u503c\u65f6\uff0c<code>strtoull</code> \u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u8db3\u591f\u7684\u8303\u56f4\u5e76\u4e14\u5141\u8bb8\u60a8\u6307\u5b9a\u5341\u516d\u8fdb\u5236\u57fa\u6570\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#more","title":"more","text":"<pre><code>#ifndef __CPU_DECODE_H__\n#define __CPU_DECODE_H__\n\n#include &lt;isa.h&gt;\n\ntypedef struct Decode {\n  vaddr_t pc;\n  vaddr_t snpc; // static next pc\n  vaddr_t dnpc; // dynamic next pc\n  ISADecodeInfo isa;\n  IFDEF(CONFIG_ITRACE, char logbuf[128]);\n} Decode;\n\n\n// --- pattern matching mechanism ---\n__attribute__((always_inline))\nstatic inline void pattern_decode(const char *str, int len,\n    uint64_t *key, uint64_t *mask, uint64_t *shift) {\n  uint64_t __key = 0, __mask = 0, __shift = 0;\n#define macro(i) \\\n  if ((i) &gt;= len) goto finish; \\\n  else { \\\n    char c = str[i]; \\\n    if (c != ' ') { \\\n      Assert(c == '0' || c == '1' || c == '?', \\\n          \"invalid character '%c' in pattern string\", c); \\\n      __key  = (__key  &lt;&lt; 1) | (c == '1' ? 1 : 0); \\\n      __mask = (__mask &lt;&lt; 1) | (c == '?' ? 0 : 1); \\\n      __shift = (c == '?' ? __shift + 1 : 0); \\\n    } \\\n  }\n\n#define macro2(i)  macro(i);   macro((i) + 1)\n#define macro4(i)  macro2(i);  macro2((i) + 2)\n#define macro8(i)  macro4(i);  macro4((i) + 4)\n#define macro16(i) macro8(i);  macro8((i) + 8)\n#define macro32(i) macro16(i); macro16((i) + 16)\n#define macro64(i) macro32(i); macro32((i) + 32)\n  macro64(0);\n  panic(\"pattern too long\");\n#undef macro\nfinish:\n  *key = __key &gt;&gt; __shift;\n  *mask = __mask &gt;&gt; __shift;\n  *shift = __shift;\n}\n\n__attribute__((always_inline))\nstatic inline void pattern_decode_hex(const char *str, int len,\n    uint64_t *key, uint64_t *mask, uint64_t *shift) {\n  uint64_t __key = 0, __mask = 0, __shift = 0;\n#define macro(i) \\\n  if ((i) &gt;= len) goto finish; \\\n  else { \\\n    char c = str[i]; \\\n    if (c != ' ') { \\\n      Assert((c &gt;= '0' &amp;&amp; c &lt;= '9') || (c &gt;= 'a' &amp;&amp; c &lt;= 'f') || c == '?', \\\n          \"invalid character '%c' in pattern string\", c); \\\n      __key  = (__key  &lt;&lt; 4) | (c == '?' ? 0 : (c &gt;= '0' &amp;&amp; c &lt;= '9') ? c - '0' : c - 'a' + 10); \\\n      __mask = (__mask &lt;&lt; 4) | (c == '?' ? 0 : 0xf); \\\n      __shift = (c == '?' ? __shift + 4 : 0); \\\n    } \\\n  }\n\n  macro16(0);\n  panic(\"pattern too long\");\n#undef macro\nfinish:\n  *key = __key &gt;&gt; __shift;\n  *mask = __mask &gt;&gt; __shift;\n  *shift = __shift;\n}\n\n\n// --- pattern matching wrappers for decode ---\n#define INSTPAT(pattern, ...) do { \\\n  uint64_t key, mask, shift; \\\n  pattern_decode(pattern, STRLEN(pattern), &amp;key, &amp;mask, &amp;shift); \\\n  if ((((uint64_t)INSTPAT_INST(s) &gt;&gt; shift) &amp; mask) == key) { \\\n    INSTPAT_MATCH(s, ##__VA_ARGS__); \\\n    goto *(__instpat_end); \\\n  } \\\n} while (0)\n\n#define INSTPAT_START(name) { const void ** __instpat_end = &amp;&amp;concat(__instpat_end_, name);\n#define INSTPAT_END(name)   concat(__instpat_end_, name): ; }\n\n#endif\n\n// include/cpu/decode.h\n</code></pre> <pre><code>#include \"local-include/reg.h\"\n#include &lt;cpu/cpu.h&gt;\n#include &lt;cpu/ifetch.h&gt;\n#include &lt;cpu/decode.h&gt;\n\n#define R(i) gpr(i)\n#define Mr vaddr_read\n#define Mw vaddr_write\n\nenum {\n  TYPE_I, TYPE_U, TYPE_S,\n  TYPE_N, // none\n};\n\n#define src1R() do { *src1 = R(rs1); } while (0)\n#define src2R() do { *src2 = R(rs2); } while (0)\n#define immI() do { *imm = SEXT(BITS(i, 31, 20), 12); } while(0)\n#define immU() do { *imm = SEXT(BITS(i, 31, 12), 20) &lt;&lt; 12; } while(0)\n#define immS() do { *imm = (SEXT(BITS(i, 31, 25), 7) &lt;&lt; 5) | BITS(i, 11, 7); } while(0)\n\nstatic void decode_operand(Decode *s, int *rd, word_t *src1, word_t *src2, word_t *imm, int type) {\n  uint32_t i = s-&gt;isa.inst.val;\n  int rs1 = BITS(i, 19, 15);\n  int rs2 = BITS(i, 24, 20);\n  *rd     = BITS(i, 11, 7);\n  switch (type) {\n    case TYPE_I: src1R();          immI(); break;\n    case TYPE_U:                   immU(); break;\n    case TYPE_S: src1R(); src2R(); immS(); break;\n  }\n}\n\nstatic int decode_exec(Decode *s) {\n  int rd = 0;\n  word_t src1 = 0, src2 = 0, imm = 0;\n  s-&gt;dnpc = s-&gt;snpc;\n\n#define INSTPAT_INST(s) ((s)-&gt;isa.inst.val)\n#define INSTPAT_MATCH(s, name, type, ... /* execute body */ ) { \\\n  decode_operand(s, &amp;rd, &amp;src1, &amp;src2, &amp;imm, concat(TYPE_, type)); \\\n  __VA_ARGS__ ; \\\n}\n\n  INSTPAT_START();\n  INSTPAT(\"??????? ????? ????? ??? ????? 00101 11\", auipc  , U, R(rd) = s-&gt;pc + imm);\n  INSTPAT(\"??????? ????? ????? 100 ????? 00000 11\", lbu    , I, R(rd) = Mr(src1 + imm, 1));\n  INSTPAT(\"??????? ????? ????? 000 ????? 01000 11\", sb     , S, Mw(src1 + imm, 1, src2));\n\n  INSTPAT(\"0000000 00001 00000 000 00000 11100 11\", ebreak , N, NEMUTRAP(s-&gt;pc, R(10))); // R(10) is $a0\n  INSTPAT(\"??????? ????? ????? ??? ????? ????? ??\", inv    , N, INV(s-&gt;pc));\n  INSTPAT_END();\n\n  R(0) = 0; // reset $zero to 0\n\n  return 0;\n}\n\nint isa_exec_once(Decode *s) {\n  s-&gt;isa.inst.val = inst_fetch(&amp;s-&gt;snpc, 4);\n  return decode_exec(s);\n}\n\n//risv64/inst.c\n</code></pre> <p>\u5173\u4e8eRISC-V\u6307\u4ee4\u89e3\u7801\u548c\u6267\u884c\u3002\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u5934\u6587\u4ef6\u7d27\u5bc6\u76f8\u5173</p> <p><code>inst.c</code> \u7684\u6a21\u5f0f\u5339\u914d\u673a\u5236\u4e0e\u4e4b\u524d\u63d0\u4f9b\u7684\u5934\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684 <code>pattern_decode</code> \u548c <code>pattern_decode_hex</code> \u51fd\u6570\u914d\u5408\u4f7f\u7528\uff0c\u4ee5\u89e3\u6790\u548c\u5339\u914d\u6307\u4ee4\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u3002</p> <p>\u6bcf\u4e2a <code>INSTPAT</code> \u8c03\u7528\u90fd\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684\u6307\u4ee4\u6a21\u5f0f\uff0c\u8fd9\u4e9b\u6a21\u5f0f\u4e0eRISC-V\u6307\u4ee4\u96c6\u4e2d\u7684\u6307\u4ee4\u683c\u5f0f\u76f8\u5bf9\u5e94\u3002</p> <p>\u5f53\u4e00\u6761\u6307\u4ee4\u4e0e\u67d0\u4e2a\u6a21\u5f0f\u5339\u914d\u65f6\uff0c\u76f8\u5e94\u7684\u6307\u4ee4\u6267\u884c\u903b\u8f91\u5c06\u88ab\u89e6\u53d1\u3002</p> <p>\u539f\u6765\u8fd9\u5c31\u662fC\u8bed\u8a00\u600e\u4e48\u6a21\u62df\u6307\u4ee4\u96c6\uff1f\u76f4\u63a5\u4e00\u4f4d\u4f4d\u5730\u6a21\u62df\uff1f</p> <p></p> <pre><code>ic void exec_once(Decode *s, vaddr_t pc) {\n  s-&gt;pc = pc;\n  s-&gt;snpc = pc;\n  isa_exec_once(s);\n  cpu.pc = s-&gt;dnpc;\n#ifdef CONFIG_ITRACE\n  char *p = s-&gt;logbuf;\n  p += snprintf(p, sizeof(s-&gt;logbuf), FMT_WORD \":\", s-&gt;pc);\n  int ilen = s-&gt;snpc - s-&gt;pc;\n  int i;\n  uint8_t *inst = (uint8_t *)&amp;s-&gt;isa.inst.val;\n  for (i = ilen - 1; i &gt;= 0; i --) {\n    p += snprintf(p, 4, \" %02x\", inst[i]);\n  }\n  int ilen_max = MUXDEF(CONFIG_ISA_x86, 8, 4);\n  int space_len = ilen_max - ilen;\n  if (space_len &lt; 0) space_len = 0;\n  space_len = space_len * 3 + 1;\n  memset(p, ' ', space_len);\n  p += space_len;\n\n#ifndef CONFIG_ISA_loongarch32r\n  void disassemble(char *str, int size, uint64_t pc, uint8_t *code, int nbyte);\n  disassemble(p, s-&gt;logbuf + sizeof(s-&gt;logbuf) - p,\n      MUXDEF(CONFIG_ISA_x86, s-&gt;snpc, s-&gt;pc), (uint8_t *)&amp;s-&gt;isa.inst.val, ilen);\n#else\n  p[0] = '\\0'; // the upstream llvm does not support loongarch32r\n#endif\n#endif\n}\n</code></pre> <p>\u8fd9\u91cc\u6253\u5370\u7684\u5440\u3002</p> <p>\u4ec0\u4e48\u5751\uff1f\uff1f\u600e\u4e48\u6ca1\u53d1\u73b0\uff1f</p>"},{"location":"ysyx/pa/pa1/pa1.html#_16","title":"\u8868\u8fbe\u5f0f\u6c42\u503c","text":"<p>\u7b80\u5316\u7248\uff1a\u6570\u5b66\u8868\u8fbe\u5f0f\u6c42\u503c</p> <p>\u4efb\u52a1\uff1a</p> <ol> <li>\u8bc6\u522b\u8868\u8fbe\u5f0f\u4e2d\u7684 <code>token</code> \u5355\u5143</li> <li>\u6839\u636e\u8868\u8fbe\u5f0f\u7684\u5f52\u7eb3\u5b9a\u4e49\u8fdb\u884c\u9012\u5f52\u6c42\u503c</li> </ol>"},{"location":"ysyx/pa/pa1/pa1.html#_17","title":"\u8bcd\u6cd5\u5206\u6790","text":"<p>\"\u8bcd\u6cd5\u5206\u6790\"\u8fd9\u4e2a\u8bcd\u770b\u4e0a\u53bb\u5f88\u9ad8\u7aef, \u8bf4\u767d\u4e86\u5c31\u662f\u505a\u4e0a\u9762\u7684\u7b2c1\u4ef6\u4e8b\u60c5, \"\u8bc6\u522b\u51fa\u8868\u8fbe\u5f0f\u4e2d\u7684\u5355\u5143\". \u8fd9\u91cc\u7684\"\u5355\u5143\"\u662f\u6307\u6709\u72ec\u7acb\u542b\u4e49\u7684\u5b50\u4e32, \u5b83\u4eec\u6b63\u5f0f\u7684\u79f0\u547c\u53ebtoken. \u5177\u4f53\u5730\u8bf4, \u6211\u4eec\u9700\u8981\u5728\u4e0a\u8ff0\u8868\u8fbe\u5f0f\u4e2d\u8bc6\u522b\u51fa<code>5</code>, <code>+</code>, <code>4</code>, <code>*</code>, <code>3</code>, <code>/</code>, <code>2</code>, <code>-</code>, <code>1</code>\u8fd9\u4e9btoken. \u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\u8fd9\u662f\u4e00\u4ef6\u5f88\u7b80\u5355\u7684\u4e8b\u60c5, \u4f46\u8003\u8651\u4ee5\u4e0b\u7684\u8868\u8fbe\u5f0f:</p> <pre><code>\"0x80100000+   ($a0 +5)*4 - *(  $t1 + 8) + number\"\n</code></pre> <p>\u5b83\u5305\u542b\u66f4\u591a\u7684\u529f\u80fd, \u4f8b\u5982\u5341\u516d\u8fdb\u5236\u6574\u6570(<code>0x80100000</code>), \u5c0f\u62ec\u53f7, \u8bbf\u95ee\u5bc4\u5b58\u5668(<code>$a0</code>), \u6307\u9488\u89e3\u5f15\u7528(\u7b2c\u4e8c\u4e2a<code>*</code>), \u8bbf\u95ee\u53d8\u91cf(<code>number</code>). \u4e8b\u5b9e\u4e0a, \u8fd9\u79cd\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u5728\u8c03\u8bd5\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u7528\u5230, \u800c\u4e14\u4f60\u9700\u8981\u5728\u7a7a\u683c\u6570\u76ee\u4e0d\u56fa\u5b9a(0\u4e2a\u6216\u591a\u4e2a)\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u80fd\u6b63\u786e\u8bc6\u522b\u51fa\u5176\u4e2d\u7684token. \u5f53\u7136\u4f60\u4ecd\u7136\u53ef\u4ee5\u624b\u52a8\u8fdb\u884c\u5904\u7406(\u5982\u679c\u4f60\u559c\u6b22\u6311\u6218\u6027\u7684\u5de5\u4f5c\u7684\u8bdd), \u4e00\u79cd\u66f4\u65b9\u4fbf\u5feb\u6377\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f. \u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5339\u914d\u51fa\u4e00\u4e9b\u590d\u6742\u7684pattern, \u662f\u7a0b\u5e8f\u5458\u5fc5\u987b\u638c\u63e1\u7684\u5185\u5bb9. \u5982\u679c\u4f60\u4ece\u6765\u6ca1\u6709\u63a5\u89e6\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f, \u8bf7\u67e5\u9605\u76f8\u5173\u8d44\u6599. \u5728\u5b9e\u9a8c\u4e2d, \u4f60\u53ea\u9700\u8981\u4e86\u89e3\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4e00\u4e9b\u57fa\u672c\u77e5\u8bc6\u5c31\u53ef\u4ee5\u4e86(\u4f8b\u5982\u5143\u5b57\u7b26).</p> <p>\u5b66\u4e60\u7b80\u5355\u5bf9\u6b63\u5219\u8868\u8fbe\u5f0f</p>"},{"location":"ysyx/pa/pa1/pa1.html#posix","title":"\u7b80\u5355 POSIX \u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u5b66\u4e60POSIX\u7684\u6b63\u5219\u3002<code>PCRE</code> \u4e0d\u770b\u3002</p> <pre><code>NAME\n    regcomp, regexec, regerror, regfree - POSIX regex functions\n\nSYNOPSIS\n    #include &lt;regex.h&gt;\n\n    int regcomp(regex_t *preg, const char *regex, int cflags);\n\n    int regexec(const regex_t *preg, const char *string, size_t nmatch,\n                regmatch_t pmatch[], int eflags);\n\n    size_t regerror(int errcode, const regex_t *preg, char *errbuf,\n                    size_t errbuf_size);\n\n    void regfree(regex_t *preg);\n\nstatic regex_t re[NR_REGEX] = {};\n\n/* Rules are used for many times.\n * Therefore we compile them only once before any usage.\n */\nvoid init_regex() {\n  int i;\n  char error_msg[128];\n  int ret;\n\n  for (i = 0; i &lt; NR_REGEX; i ++) {\n    ret = regcomp(&amp;re[i], rules[i].regex, REG_EXTENDED);\n    if (ret != 0) {\n      regerror(ret, &amp;re[i], error_msg, 128);\n      panic(\"regex compilation failed: %s\\n%s\", error_msg, rules[i].regex);\n    }\n  }\n}\n</code></pre> <p>POSIX\u6b63\u5219\u8868\u8fbe\u5f0f\u51fd\u6570\u5982\u4e0a\uff0c\u8fd9\u4e9b\u51fd\u6570\u7528\u4e8e\u7f16\u8bd1\u3001\u5339\u914d\u548c\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u6587\u672c\u5904\u7406\u5de5\u5177\uff0c\u7528\u4e8e\u641c\u7d22\u3001\u66ff\u6362\u7b26\u5408\u67d0\u4e2a\u6a21\u5f0f\u7684\u5b57\u7b26\u4e32\u3002</p> <ul> <li>\u5b9e\u73b0\u7b97\u672f\u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\uff1a<ul> <li>\u5341\u8fdb\u5236\u6574\u6570</li> <li><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></li> <li><code>(</code>, <code>)</code></li> <li>\u7a7a\u683c\u4e32(\u4e00\u4e2a\u6216\u591a\u4e2a\u7a7a\u683c)</li> </ul> </li> </ul> <p>\u4f60\u9700\u8981\u505a\u7684\u662f\u5c06\u8bc6\u522b\u51fa\u7684token\u4fe1\u606f\u8bb0\u5f55\u4e0b\u6765(\u4e00\u4e2a\u4f8b\u5916\u662f\u7a7a\u683c\u4e32), \u6211\u4eec\u4f7f\u7528<code>Token</code>\u7ed3\u6784\u4f53\u6765\u8bb0\u5f55token\u7684\u4fe1\u606f:</p> <pre><code>typedef struct token {\n  int type;\n  char str[32];\n} Token;\n</code></pre> <pre><code>    /* hexadecimal number */                                                                                 \n    {\"0[xX][0-9a-fA-F]+\", TK_HEX, true, handler_hex},                                                        \n    // numbers (\u786e\u4fdd\u662f+\u53f7\uff0c\u8868\u793a\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u5b57)\n    {\"[0-9]+\", TK_NUM, true, handler_num},\n    // register name (\u786e\u4fdd\u5728\u6570\u5b57\u4e4b\u540e\uff0c\u8fd9\u6837\u6570\u5b57\u4e0d\u4f1a\u88ab\u5f53\u4f5c\u5355\u8bcd\u5339\u914d)                                            \n    {\"\\\\$\\\\w+|\\\\w+\", TK_REG_NAME, true, handler_reg}, // \u6709\u4e0d\u662f$\u5f00\u5934\u7684                                       \n                        \n    /* comparison operators */\n    {\"!=\", TK_NEQ, false, handler_neq},\n    {\"==\", TK_EQ}, false, handler_eq,\n\n    /* logical operator */\n    {\"&amp;&amp;\", TK_LOGICAL_AND, false, handler_logical_and},\n\n    {\"\\\\+\", TK_ADD, false, handler_add},    // plus\n    {\"-\", TK_SUB, false, handler_sub},      // sub and neg\n    {\"\\\\*\", TK_MUL, false, handler_mul},    // mul and deref. \n    {\"/\", TK_DIV, false, handler_div},\n\n    //      \u597d\u50cf\u6211\u4e0b\u9762\u8fd9\u4e48\u5199\u4e0d\u884c\uff1f\n    //    {\"\\\\d\", TK_NUM},                                                                                   \n    //    {\"\\\\w\", TK_WORD},\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0b\u9762\u8fd9\u4e2a\u4e0d\u884c\uff1f</p>"},{"location":"ysyx/pa/pa1/pa1.html#posix_1","title":"POSIX\u6b63\u5219\u8868\u8fbe\u5f0f\u51fd\u6570\u4ecb\u7ecd\uff1a","text":"<ol> <li>regcomp - \u7f16\u8bd1\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</li> <li>\u51fd\u6570\u539f\u578b\uff1a<code>int regcomp(regex_t *preg, const char *regex, int cflags);</code></li> <li>\u4f5c\u7528\uff1a\u5c06\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6b63\u5219\u8868\u8fbe\u5f0f<code>regex</code>\u7f16\u8bd1\u6210\u5185\u90e8\u5f62\u5f0f\uff0c\u4ee5\u4fbf\u540e\u7eed\u4f7f\u7528\u3002\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5b58\u50a8\u5728<code>regex_t</code>\u7ed3\u6784\u4e2d\u3002</li> <li> <p>\u53c2\u6570\uff1a</p> <ul> <li><code>preg</code>\uff1a\u6307\u5411<code>regex_t</code>\u7ed3\u6784\u7684\u6307\u9488\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</li> <li><code>regex</code>\uff1a\u6307\u5411\u5305\u542b\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\u3002</li> <li><code>cflags</code>\uff1a\u7f16\u8bd1\u6807\u5fd7\uff0c\u53ef\u4ee5\u662f0\u6216\u7531<code>REG_</code>\u524d\u7f00\u5b9a\u4e49\u7684\u5e38\u91cf\uff08\u5982<code>REG_EXTENDED</code>\u8868\u793a\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\uff09\u3002</li> </ul> </li> <li> <p>regexec - \u6267\u884c\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff1a</p> </li> <li>\u51fd\u6570\u539f\u578b\uff1a<code>int regexec(const regex_t *preg, const char *string, size_t nmatch, regmatch_t pmatch[], int eflags);</code></li> <li>\u4f5c\u7528\uff1a\u4f7f\u7528\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f<code>preg</code>\u5728\u5b57\u7b26\u4e32<code>string</code>\u4e0a\u6267\u884c\u641c\u7d22\u3002</li> <li> <p>\u53c2\u6570\uff1a</p> <ul> <li><code>preg</code>\uff1a\u6307\u5411\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7684<code>regex_t</code>\u7ed3\u6784\u7684\u6307\u9488\u3002</li> <li><code>string</code>\uff1a\u8981\u641c\u7d22\u7684\u5b57\u7b26\u4e32\u3002</li> <li><code>nmatch</code>\uff1a\u6570\u7ec4<code>pmatch</code>\u7684\u5927\u5c0f\uff0c\u8868\u793a\u53ef\u4ee5\u5b58\u50a8\u7684\u5339\u914d\u7ed3\u679c\u7684\u6570\u91cf\u3002</li> <li><code>pmatch</code>\uff1a\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u5339\u914d\u7ed3\u679c\u3002</li> <li><code>eflags</code>\uff1a\u6267\u884c\u6807\u5fd7\uff0c\u53ef\u4ee5\u662f0\u6216\u7531<code>REG_</code>\u524d\u7f00\u5b9a\u4e49\u7684\u5e38\u91cf\u3002</li> </ul> </li> <li> <p>regerror - \u83b7\u53d6\u9519\u8bef\u4fe1\u606f\uff1a</p> </li> <li>\u51fd\u6570\u539f\u578b\uff1a<code>size_t regerror(int errcode, const regex_t *preg, char *errbuf, size_t errbuf_size);</code></li> <li>\u4f5c\u7528\uff1a\u6839\u636e\u9519\u8bef\u4ee3\u7801<code>errcode</code>\uff0c\u5c06\u9519\u8bef\u4fe1\u606f\u590d\u5236\u5230<code>errbuf</code>\u4e2d\u3002</li> <li> <p>\u53c2\u6570\uff1a</p> <ul> <li><code>errcode</code>\uff1a\u9519\u8bef\u4ee3\u7801\u3002</li> <li><code>preg</code>\uff1a\u6307\u5411\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7684<code>regex_t</code>\u7ed3\u6784\u7684\u6307\u9488\u3002</li> <li><code>errbuf</code>\uff1a\u7528\u4e8e\u5b58\u50a8\u9519\u8bef\u4fe1\u606f\u7684\u7f13\u51b2\u533a\u3002</li> <li><code>errbuf_size</code>\uff1a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002</li> </ul> </li> <li> <p>regfree - \u91ca\u653e\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</p> </li> <li>\u51fd\u6570\u539f\u578b\uff1a<code>void regfree(regex_t *preg);</code></li> <li>\u4f5c\u7528\uff1a\u91ca\u653e\u4e0e<code>preg</code>\u5173\u8054\u7684\u5185\u5b58\u8d44\u6e90\u3002</li> </ol>"},{"location":"ysyx/pa/pa1/pa1.html#_18","title":"\u793a\u4f8b\u4ee3\u7801\u89e3\u6790\uff1a","text":"<p>\u5728\u60a8\u63d0\u4f9b\u7684\u4ee3\u7801\u793a\u4f8b\u4e2d\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3a<code>re</code>\u7684<code>regex_t</code>\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u540e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002<code>init_regex</code>\u51fd\u6570\u7684\u76ee\u7684\u662f\u521d\u59cb\u5316\u8fd9\u4e2a\u6570\u7ec4\uff1a</p> <ol> <li>\u5faa\u73af\u904d\u5386<code>re</code>\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u3002</li> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u5143\u7d20\uff0c\u4f7f\u7528<code>regcomp</code>\u7f16\u8bd1\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u5b58\u50a8\u5728<code>rules[i].regex</code>\u4e2d\uff0c\u8fd9\u91cc\u5047\u8bbe<code>rules</code>\u662f\u4e00\u4e2a\u5305\u542b\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u6570\u7ec4\u7684\u7ed3\u6784\u3002</li> <li>\u5982\u679c<code>regcomp</code>\u8fd4\u56de\u975e\u96f6\u503c\uff0c\u8868\u793a\u7f16\u8bd1\u5931\u8d25\u3002\u6b64\u65f6\uff0c\u4f7f\u7528<code>regerror</code>\u83b7\u53d6\u9519\u8bef\u4fe1\u606f\uff0c\u5e76\u4f7f\u7528<code>panic</code>\u51fd\u6570\uff08\u8fd9\u91cc\u672a\u63d0\u4f9b<code>panic</code>\u7684\u5b9e\u73b0\uff0c\u4f46\u901a\u5e38\u5b83\u7528\u4e8e\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u5e76\u7ec8\u6b62\u7a0b\u5e8f\uff09\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u548c\u5931\u8d25\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</li> </ol> <p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u76ee\u7684\u662f\u9884\u5148\u7f16\u8bd1\u6240\u6709\u53ef\u80fd\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u89c4\u5219\uff0c\u4ee5\u4fbf\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5339\u914d\uff0c\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u5728\u6587\u672c\u5904\u7406\u3001\u6570\u636e\u63d0\u53d6\u3001\u6a21\u5f0f\u5339\u914d\u7b49\u573a\u666f\u4e2d\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\uff0c\u5728\u7f51\u7edc\u7f16\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u89e3\u6790HTTP\u8bf7\u6c42\u6216\u914d\u7f6e\u6587\u4ef6\uff1b\u5728\u6587\u672c\u7f16\u8f91\u5668\u4e2d\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u67e5\u627e\u548c\u66ff\u6362\u6587\u672c\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\uff08Regular Expression\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u5b57\u7b26\u4e32\u641c\u7d22\u548c\u64cd\u4f5c\u7684\u5f3a\u5927\u5de5\u5177\uff0c\u5b83\u4f7f\u7528\u5355\u4e2a\u5b57\u7b26\u4e32\u6765\u63cf\u8ff0\u3001\u5339\u914d\u4e00\u7cfb\u5217\u7b26\u5408\u67d0\u4e2a\u53e5\u6cd5\u89c4\u5219\u7684\u5b57\u7b26\u4e32\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u5e7f\u6cdb\u5e94\u7528\u5728\u6570\u636e\u9a8c\u8bc1\u3001\u6587\u672c\u5904\u7406\u548c\u7f51\u7edc\u722c\u866b\u4e2d\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u57fa\u672c\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\u548c\u793a\u4f8b\uff1a</p>"},{"location":"ysyx/pa/pa1/pa1.html#_19","title":"\u57fa\u672c\u5b57\u7b26","text":"<ul> <li>\u5b57\u9762\u91cf\u5b57\u7b26\uff1a\u76f4\u63a5\u8868\u793a\u8981\u5339\u914d\u7684\u5b57\u7b26\uff0c\u5982 <code>a</code>, <code>b</code>, <code>123</code>, <code>hello</code>\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_20","title":"\u7279\u6b8a\u5b57\u7b26","text":"<ul> <li>.\uff1a\u5339\u914d\u9664\u6362\u884c\u7b26\u4ee5\u5916\u7684\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\u3002</li> <li>\\\uff1a\u8f6c\u4e49\u5b57\u7b26\uff0c\u7528\u4e8e\u5339\u914d\u90a3\u4e9b\u5426\u5219\u6709\u7279\u6b8a\u610f\u4e49\u7684\u5b57\u7b26\uff0c\u5982 <code>.</code>, <code>*</code>, <code>?</code>, <code>+</code>, <code>()</code>, <code>[]</code>, <code>^</code>, <code>$</code>, <code>\\</code> \u548c <code>|</code>\u3002</li> <li>[]\uff1a\u5b57\u7b26\u96c6\uff0c\u5339\u914d\u65b9\u62ec\u53f7\u5185\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982 <code>[abc]</code> \u53ef\u4ee5\u5339\u914d <code>a</code>, <code>b</code>, \u6216 <code>c</code>\u3002</li> <li>[^]\uff1a\u5426\u5b9a\u5b57\u7b26\u96c6\uff0c\u5339\u914d\u4e0d\u5728\u65b9\u62ec\u53f7\u5185\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982 <code>[^abc]</code> \u5339\u914d\u9664\u4e86 <code>a</code>, <code>b</code>, <code>c</code> \u4e4b\u5916\u7684\u4efb\u610f\u5b57\u7b26\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_21","title":"\u91cf\u8bcd","text":"<ul> <li>*\uff1a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u6216\u5b50\u8868\u8fbe\u5f0f\u96f6\u6b21\u6216\u591a\u6b21\uff0c\u5982 <code>a*</code> \u5339\u914d\u96f6\u4e2a\u6216\u591a\u4e2a <code>a</code>\u3002</li> <li>+\uff1a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u6216\u5b50\u8868\u8fbe\u5f0f\u4e00\u6b21\u6216\u591a\u6b21\uff0c\u5982 <code>a+</code> \u5339\u914d\u81f3\u5c11\u4e00\u4e2a <code>a</code>\u3002</li> <li>?\uff1a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u6216\u5b50\u8868\u8fbe\u5f0f\u96f6\u6b21\u6216\u4e00\u6b21\uff0c\u5982 <code>a?</code> \u5339\u914d\u96f6\u4e2a\u6216\u4e00\u4e2a <code>a</code>\u3002</li> <li>{n}\uff1a\u6070\u597dn\u6b21\uff0c\u5982 <code>[0-9]{3}</code> \u5339\u914d\u4e09\u4f4d\u6570\u3002</li> <li>{n,}\uff1a\u81f3\u5c11n\u6b21\uff0c\u5982 <code>[0-9]{2,}</code> \u5339\u914d\u81f3\u5c11\u4e24\u4f4d\u6570\u3002</li> <li>{n,m}\uff1a\u4ecb\u4e8en\u5230m\u6b21\u4e4b\u95f4\uff0c\u5982 <code>[0-9]{1,3}</code> \u5339\u914d1\u52303\u4f4d\u6570\u5b57\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_22","title":"\u4f4d\u7f6e","text":"<ul> <li>^\uff1a\u5339\u914d\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u3002</li> <li>$\uff1a\u5339\u914d\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_23","title":"\u7ec4\u5408","text":"<ul> <li>|\uff1a\u903b\u8f91\u6216\uff0c\u5339\u914d\u5de6\u8fb9\u6216\u53f3\u8fb9\u7684\u8868\u8fbe\u5f0f\uff0c\u5982 <code>cat|dog</code> \u5339\u914d <code>cat</code> \u6216 <code>dog</code>\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_24","title":"\u4f8b\u5b50","text":"<ul> <li>\u5339\u914d\u7a7a\u683c\uff1a<code>\\s</code> \u6216 <code>[ \\t\\n]</code>\uff0c\u5176\u4e2d <code>\\s</code> \u662f\u4e00\u4e2a\u5e38\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7528\u4e8e\u5339\u914d\u4efb\u4f55\u7a7a\u767d\u5b57\u7b26\uff08\u5305\u62ec\u7a7a\u683c\u3001\u5236\u8868\u7b26\u3001\u6362\u884c\u7b26\uff09\u3002</li> <li>\u5339\u914d\u52a0\u53f7\uff1a<code>\\+</code>\uff0c\u56e0\u4e3a <code>+</code> \u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u662f\u4e00\u4e2a\u91cf\u8bcd\uff0c\u6240\u4ee5\u8981\u4f7f\u7528\u53cd\u659c\u7ebf <code>\\</code> \u8fdb\u884c\u8f6c\u4e49\u3002</li> <li>\u5339\u914d\u51cf\u53f7\uff1a<code>-</code>\uff0c\u4e0d\u9700\u8981\u8f6c\u4e49\uff0c\u56e0\u4e3a <code>-</code> \u53ea\u6709\u5728\u5b57\u7b26\u96c6 <code>[...]</code> \u5185\u90e8\u548c\u8fde\u5b57\u7b26 <code>^</code> \u540e\u9762\u65f6\u624d\u9700\u8981\u8f6c\u4e49\u3002</li> <li>\u5339\u914d\u4e58\u53f7\uff1a<code>\\*</code>\uff0c\u56e0\u4e3a <code>*</code> \u662f\u4e00\u4e2a\u91cf\u8bcd\uff0c\u6240\u4ee5\u9700\u8981\u8f6c\u4e49\u3002</li> <li>\u5339\u914d\u9664\u53f7\uff1a<code>/</code>\uff0c\u4e0d\u9700\u8981\u8f6c\u4e49\uff0c\u56e0\u4e3a <code>/</code> \u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u6ca1\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u9664\u975e\u5b83\u7528\u4e8e\u8868\u793a\u5f00\u59cb\u548c\u7ed3\u675f\u7684\u5206\u9694\u7b26\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_25","title":"\u5e94\u7528\u793a\u4f8b","text":"<ul> <li>\u5339\u914d\u4e00\u4e2a\u7b80\u5355\u7684\u6570\u5b66\u8868\u8fbe\u5f0f\uff1a<code>([0-9]+(\\.[0-9]+)?([eE][+-]?[0-9]+)?)(\\+|-|/|\\*)([0-9]+(\\.[0-9]+)?([eE][+-]?[0-9]+)?))</code></li> <li>\u5339\u914d\u4e00\u4e2a\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff1a<code>[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}</code></li> <li>\u5339\u914d\u4e00\u4e2aURL\uff1a<code>(https?://)?(www\\.)?[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+(/[a-zA-Z0-9_/.-]*)*</code></li> </ul> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u590d\u6742\u4e14\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u5b66\u4e60\u5b83\u7684\u8bed\u6cd5\u9700\u8981\u5b9e\u8df5\u548c\u65f6\u95f4\u3002\u4e0a\u8ff0\u53ea\u662f\u4e00\u4e9b\u57fa\u7840\u7684\u4ecb\u7ecd\uff0c\u66f4\u6df1\u5165\u7684\u5b66\u4e60\u548c\u4f7f\u7528\u53ef\u80fd\u9700\u8981\u53c2\u8003\u66f4\u8be6\u7ec6\u7684\u6587\u6863\u548c\u6559\u7a0b\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_26","title":"\u9012\u5f52\u6c42\u503c","text":"<p>\u628a\u5f85\u6c42\u503c\u8868\u8fbe\u5f0f\u4e2d\u7684token\u90fd\u6210\u529f\u8bc6\u522b\u51fa\u6765\u4e4b\u540e, \u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u6c42\u503c\u4e86. \u9700\u8981\u6ce8\u610f\u7684\u662f, \u6211\u4eec\u73b0\u5728\u662f\u5728\u5bf9tokens\u6570\u7ec4\u8fdb\u884c\u5904\u7406, \u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0, \u6211\u4eec\u79f0\u5b83\u4e3a\"token\u8868\u8fbe\u5f0f\". </p> <p>\u4f8b\u5982\u5f85\u6c42\u503c\u8868\u8fbe\u5f0f</p> <pre><code>\"4 +3*(2- 1)\"\n</code></pre> <p>\u7684 token \u8868\u8fbe\u5f0f\uff1a</p> <pre><code>+-----+-----+-----+-----+-----+-----+-----+-----+-----+\n| NUM | '+' | NUM | '*' | '(' | NUM | '-' | NUM | ')' |\n| \"4\" |     | \"3\" |     |     | \"2\" |     | \"1\" |     |\n+-----+-----+-----+-----+-----+-----+-----+-----+-----+\n</code></pre> <p>\u771f\u6709\u70b9\u641e\u4e0d\u61c2\u8fd9\u4e2aBNF\u662f\u62ff\u6765\u5e72\u5565\u5462\u7684</p> <pre><code>           /* 2024.04.30 \u665a\u4e0a\n             * \u73b0\u5728\u7684bug\uff1a1. \u7a7a\u683c\u8bc6\u522b 2. \u5b50\u8868\u8fbe\u5f0f\u7684\u62ec\u53f7\u5339\u914d\n             * \u5df2\u89e3\u51b3\uff1a1. \u4e0d\u628a\u7a7a\u683c\u653e\u5230tokens\u91cc\n             *         2. gdb\u51fa\u6765\u53d1\u73b0\u81ea\u5df1\u5199\u7684\u5224\u65ad\u62ec\u53f7\u7b97\u6cd5\u6709\u95ee\u9898\n             *            \u6539\u7528\u7f51\u4e0a\u7684\u53cc\u6307\u9488\u7b97\u6cd5\uff0c\u4e0d\u4f1a\uff0c\u7559\u7740\u5f85\u4f1a\u5b66\n             * \u73b0\u5728\u51fa\u73b0\u65b0\u95ee\u9898\uff1a4 +3*(2- 1) \u9519\u8bef\u9000\u51fa\u4e86\u3002\n             * 2024.05.01 \u4e0b\u53481\u70b9\uff1a\n             * 1. \u5173\u4e8etokens\u7684\u4e0b\u6807\u95ee\u9898\uff0c\u7b2c\u4e00\u6b21\u5199\u4e86p\uff0c\u5e94\u8be5\u662fi\n             * 2. gdb\u53d1\u73b0\u662f\u5728\u5230\u62ec\u53f7\u91cc\u9762\u7684\u51cf\u53f7\u7684\u65f6\u5019\u548c\u6700\u5f00\u59cb\u7684\u90a3\u4e2a+\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\n             *    \u5bfc\u81f4\u76f4\u63a5\u5224\u65adop\u7684\u65f6\u5019\uff0c\u5224\u65ad\u4e3a\u90a3\u4e2a\u51cf\u53f7\u4e86\u3002\n             *    \u6240\u4ee5\u6211\u5728\u4f18\u5148\u7ea7\u5224\u65ad\u90a3\u91cc\u518d\u52a0\u4e00\u4e2a\u6807\u5fd7\u4f4d\uff0c\n             *    \u5224\u65ad\u51fa\u4e86\u9664\u62ec\u53f7\u5916\u7684\u6700\u4f4e\u7684\u4f18\u5148\u7ea7\u3002\n             * \u53c8\u6709\u95ee\u9898\uff1a(12-3)*(4-2) \u8fd9\u4e2a\u53c8\u5224\u65ad\u4e0d\u51fa\u6765\u4e86\uff0c\n             *          \u8fd9\u662f\u4ec0\u4e48\uff1f\u6240\u4ee5\u5e94\u8be5\u662f\u4f18\u5148\u7ea7\u5224\u65ad\u6709\u70b9\u95ee\u9898\uff0c\n             *          \u6700\u4f4e\u4f18\u5148\u7ea7\u662f\u4e0d\u662f\u5f97\u628a() \u4e5f\u5f97\u5224\u65ad\u4e0a\uff0c\n             *\n             */\n</code></pre> <p>\u76ee\u524d\u5361\u5728\u4e86\u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7\u7684\u8fd9\u91cc</p> <pre><code>#include &lt;bits/types/timer_t.h&gt;\n#include &lt;isa.h&gt;\n\n/* We use the POSIX regex functions to process regular expressions.\n * Type 'man regex' for more information about POSIX regex functions.\n */\n#include &lt;regex.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;assert.h&gt;\n\n#ifdef  new\nenum {\n    TK_NOTYPE = 256,\n    TK_EQ,\n\n    TK_ADD,\n    TK_SUB,\n    TK_MUL,\n    TK_DIV,\n\n    TK_RIGHT_PAR,\n    TK_LEFT_PAR,\n\n    TK_NUM,\n    TK_WORD,\n\n  /* TODO: Add more token types */\n};\n\nstatic struct rule {\n  const char *regex;\n  int token_type;\n} rules[] = {\n\n  /* TODO: Add more rules.\n   * Pay attention to the precedence level of different rules.\n   */\n\n    {\"\\\\(\", TK_LEFT_PAR},\n    {\"\\\\)\", TK_RIGHT_PAR},\n\n    // numbers (\u786e\u4fdd\u662f+\u53f7\uff0c\u8868\u793a\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u5b57)\n    {\"[0-9]+\", TK_NUM},\n    // words (\u786e\u4fdd\u5728\u6570\u5b57\u4e4b\u540e\uff0c\u8fd9\u6837\u6570\u5b57\u4e0d\u4f1a\u88ab\u5f53\u4f5c\u5355\u8bcd\u5339\u914d)\n    {\"[A-Za-z_][A-Za-z0-9_]*\", TK_WORD},\n\n    {\" +\", TK_NOTYPE},      // spaces\n    {\"==\", TK_EQ},          // equal\n\n    {\"\\\\+\", TK_ADD},        // plus\n    {\"-\", TK_SUB},\n    {\"\\\\*\", TK_MUL},\n    {\"/\", TK_DIV},\n\n\n//      \u597d\u50cf\u6211\u4e0b\u9762\u8fd9\u4e48\u5199\u4e0d\u884c\uff1f    \n//    {\"\\\\d\", TK_NUM},\n//    {\"\\\\w\", TK_WORD},\n};\n#endif\nenum {\n    TK_NOTYPE = 256,\n    NUM = 1,\n    RESGISTER = 2,\n    HEX = 3,\n    EQ = 4,\n    NOTEQ = 5,\n    OR = 6,\n    AND = 7,\n    ZUO = 8,\n    YOU = 9,\n    LEQ = 10,\n    YINYONG = 11,\n    POINT, NEG\n};\nstatic struct rule {\n    const char *regex;\n    int token_type;\n} rules[] = {\n\n    /* TODO: Add more rules.\n     * Pay attention to the precedence level of different rules.\n     */\n\n    {\" +\", TK_NOTYPE},    // spaces\n    {\"\\\\+\", '+'},         // plus\n    {\"\\\\-\", '-'},         // sub\n    {\"\\\\*\", '*'},         // mul\n    {\"\\\\/\", '/'},         // div\n\n    {\"\\\\(\", ZUO},\n    {\"\\\\)\", YOU},\n    /*\n     * Inset the '(' and ')' on the [0-9] bottom case Bug.\n     */\n\n    {\"\\\\&lt;\\\\=\", LEQ},            // TODO\n    {\"\\\\=\\\\=\", EQ},        // equal\n    {\"\\\\!\\\\=\", NOTEQ},\n\n    {\"\\\\|\\\\|\", OR},       // Opetor\n    {\"\\\\&amp;\\\\&amp;\", AND},\n    {\"\\\\!\", '!'},\n\n    //{\"\\\\$[a-z]*\", RESGISTER},\n    {\"\\\\$[a-zA-Z]*[0-9]*\", RESGISTER},\n    {\"0[xX][0-9a-fA-F]+\", HEX},\n    {\"[0-9]*\", NUM},\n\n};\n#define max(a, b) ((a) &gt; (b) ? (a) : (b))\n#define NR_REGEX ARRLEN(rules)\n\nstatic regex_t re[NR_REGEX] = {};\n\n/* Rules are used for many times.\n * Therefore we compile them only once before any usage.\n */\nvoid init_regex() {\n  int i;\n  char error_msg[128];\n  int ret;\n\n  for (i = 0; i &lt; NR_REGEX; i ++) {\n    ret = regcomp(&amp;re[i], rules[i].regex, REG_EXTENDED);\n    if (ret != 0) {\n      regerror(ret, &amp;re[i], error_msg, 128);\n      panic(\"regex compilation failed: %s\\n%s\", error_msg, rules[i].regex);\n    }\n  }\n}\n\ntypedef struct token {\n  int type;\n  char str[32];\n  int num_value;\n} Token;\n\nstatic Token tokens[32] __attribute__((used)) = {};\nstatic int nr_token __attribute__((used))  = 0;\n\n#ifdef new\nstatic bool make_token(char *e) {\n  int position = 0;\n  int i;\n  regmatch_t pmatch;\n\n  nr_token = 0;\n\n  while (e[position] != '\\0') {\n    /* Try all rules one by one. */\n    for (i = 0; i &lt; NR_REGEX; i++) {\n      if (regexec(&amp;re[i], e + position, 1, &amp;pmatch, 0) == 0 &amp;&amp; pmatch.rm_so == 0) {\n        char *substr_start = e + position;\n        int substr_len = pmatch.rm_eo;\n\n        Log(\"match rules[%d] = \\\"%s\\\" at position %d with len %d: %.*s\",\n            i, rules[i].regex, position, substr_len, substr_len, substr_start);\n\n        position += substr_len;\n\n        /* TODO: Now a new token is recognized with rules[i]. Add codes\n         * to record the token in the array `tokens'. For certain types\n         * of tokens, some extra actions should be performed.\n         */\n\n        switch (rules[i].token_type) {\n            case TK_NOTYPE:\n                /* \u76f4\u63a5\u8df3\u8fc7\u7a7a\u683c */\n                break;\n\n            case TK_ADD:\n                // tokens[i] = {.type = TK_ADD};\n                tokens[nr_token++].type = TK_ADD;\n                break;\n\n            case TK_SUB:\n                tokens[nr_token++].type = TK_SUB;\n                break;\n\n            case TK_MUL:\n                tokens[nr_token++].type = TK_MUL;\n                break;\n\n            case TK_DIV:\n                tokens[nr_token++].type = TK_DIV;\n                break;\n\n            case TK_NUM: // \u6bd4\u5982\u8bf4\u4f20\u8fdb\u6765\u4e00\u4e2a\u6570\u5b57 1234, \u4e0d\u80fd\u53ea\u5224\u65ad1, \u540e\u9762\u5c31\u6ca1\u4e86\u3002\n                tokens[nr_token].type = TK_NUM;\n                // \u600e\u4e48\u5224\u65ad\u4e00\u76f4\u5230\u6570\u5b57\uff1f\u76f4\u63a5\u5728\u8fd9\u4e2a token \u7684 substr_len \u5373\u53ef.\n                if (substr_len &gt; sizeof(tokens[nr_token].str) - 1) {\n                    substr_len = sizeof(tokens[nr_token].str) - 1;\n                }\n\n                strncpy(tokens[nr_token].str, substr_start, substr_len);\n                tokens[nr_token].str[substr_len] = '\\0';\n                //tokens[token_index].num_value = atoi(substr_start);\n                nr_token++;\n                break;\n\n            case TK_WORD:\n                tokens[nr_token++].type = TK_WORD;\n                break;\n\n            case TK_RIGHT_PAR:\n                tokens[nr_token++].type = TK_RIGHT_PAR;\n                break;\n\n            case TK_LEFT_PAR:\n                tokens[nr_token++].type = TK_LEFT_PAR;\n\n                break;\n            default:\n                printf(\"No rules were mathced with %s\\n\", substr_start);\n        }\n\n        break;\n      }\n    }\n\n    if (i == NR_REGEX) {\n      printf(\"no match at position %d\\n%s\\n%*.s^\\n\", position, e, position, \"\");\n      return false;\n    }\n\n  }\n\n  return true;\n}\n/*\nstatic bool check_parentheses(int p, int q) {\n    int parentheses = 0;\n\n    if (tokens[p].type != TK_LEFT_PAR || tokens[p].type != TK_RIGHT_PAR) {\n        return false;\n    }\n\n    for (int i = p; i &lt;= q; i++) {\n        if (tokens[i].str[0] == '(' ) {\n            parentheses++;\n        }\n        if (tokens[i].str[0] == ')' ) {\n            parentheses--;\n        }\n        if (parentheses &lt; 0) {\n            return false;\n        }\n    }\n    return parentheses == 0;\n}\n*/\n\nbool check_parentheses(int p, int q)\n{\n    if(tokens[p].type != TK_LEFT_PAR || tokens[q].type != TK_RIGHT_PAR) {\n        return false;\n    }\n\n    int l = p , r = q;\n    while(l &lt; r)\n    {\n        if(tokens[l].type == '('){\n            if(tokens[r].type == ')')\n            {\n                l ++ , r --;\n                continue;\n            }\n\n            else\n                r --;\n        }\n        else if(tokens[l].type == ')')\n            return false;\n        else l ++;\n    }\n    return true;\n}\n\n\n\nint get_priority(int op_type) {\n    switch (op_type) {\n        case TK_ADD:\n        case TK_SUB:\n            return 1;\n        case TK_MUL:\n        case TK_DIV:\n            return 2;\n        default:\n            return 0; // Default priority for non-operators\n    }\n}\n\n/* \n * \u5728token\u8868\u8fbe\u5f0f\u4e2d\u6307\u793a\u4e00\u4e2a\u5b50\u8868\u8fbe\u5f0f, \n * \u4f7f\u7528\u4e24\u4e2a\u6574\u6570 p \u548c q \u6765\u6307\u793a\u8fd9\u4e2a\u5b50\u8868\u8fbe\u5f0f\u7684\u5f00\u59cb\u4f4d\u7f6e\u548c\u7ed3\u675f\u4f4d\u7f6e. \n */\nint eval(int p, int q) {\n    int op_type;\n    if (p &gt; q) {\n    /* Bad expression */\n        printf(\"error_eval, index error.\\n\");\n        return -1;\n    } else if (p == q) {\n    /* Single token.\n     * For now this token should be a number.\n     * Return the value of the number.\n     */\n        if (tokens[p].type != TK_NUM) {\n            printf(\"error_eval, expect number but got %d\\n\", tokens[p].type);\n            return -1;\n        }\n\n        return tokens[p].num_value;\n    } else if (check_parentheses(p, q) == true) {\n    /* The expression is surrounded by a matched pair of parentheses.\n     * If that is the case, just throw away the parentheses.\n     */\n        return eval(p + 1, q - 1);\n    } else {\n        int op = -1;\n        int par_right = 0;\n        int min_priority = INT_MAX;\n\n        for (int i = p; i &lt;= q; i++) {\n\n            // \u5224\u65ad\u4e3b\u8fd0\u7b97\u7b26\u52a0\u51cf\u4e58\u9664\u7684\u8fd0\u7b97\u4f18\u5148\u7ea7\n            // \u5728\u8868\u8fbe\u5f0f\u62ec\u53f7\u5185\u7684\u4e0d\u662f\u4e3b\u8fd0\u7b97\u7b26 \n            if (tokens[i].type &gt;= TK_ADD &amp;&amp; tokens[i].type &lt;= TK_DIV) {\n                int priority = get_priority(tokens[i].type);\n                if (priority &lt;= min_priority  ) {\n                    min_priority = priority;\n                    op = i;\n                    op_type = tokens[i].type;\n                }\n            }\n\n            if (tokens[i].type == TK_LEFT_PAR) {\n                par_right = i;\n                while (tokens[par_right].type != TK_RIGHT_PAR) {\n                    /* \u8df3\u8fc7\u62ec\u53f7\u5185\u7684\u8868\u8fbe\u5f0f\uff0c\u76f4\u5230\u9047\u5230\u5bf9\u5e94\u7684\u53f3\u62ec\u53f7 */\n                    par_right++;\n                }\n\n                // \u6211\u5224\u65ad\u51fa\u4e86\u8fd9\u4e2a\u5b50\u8868\u8fbe\u5f0f\u7684\u62ec\u53f7\uff0c\u662f\u4e0d\u662f\u4e5f\u8981\u8ba1\u7b97\uff1f\n                if(check_parentheses(i, par_right) == false) {\n                    printf(\"parentheses in sub expression was not matched.\\n\");\n                    return -1;\n                } else {\n                    int result = eval(i, par_right);\n                    tokens[i].type = TK_NUM;\n                    tokens[i].str[0] = '\\0';\n                    tokens[i].num_value = result;\n                    for (int j = i + 1; j &lt;= par_right; j++) {\n                        tokens[j].type = TK_NOTYPE;\n                        tokens[j].str[0] = '\\0';\n                        tokens[j].num_value = 0;\n                    }\n                } \n            }\n\n        }\n\n        if (op == -1) {\n            printf(\"No operator found.\\n\");\n            return -1;\n        }\n\n        int val1 = eval(p, op -1);\n        int val2 = eval(op + 1, q);\n\n        // op = the position of \u4e3b\u8fd0\u7b97\u7b26 in the token expression;\n        // \u4e0b\u9762\u662f\u6700\u5e95\u5c42\u62ec\u53f7\u5185\u7684\u8fd0\u7b97\uff1a\n\n        switch (op_type) {\n            case TK_ADD: \n                return val1 + val2;\n                break;\n            case TK_SUB: /* ... */\n                return val1 - val2;\n                break;\n            case TK_MUL: /* ... */\n                return val1 *val2;\n                break;\n            case TK_DIV:\n                if (val2 == 0) {\n                    printf(\"error:division not 0.\\n\");\n                    return -1;\n                }\n                return val1 / val2;\n                break;\n            //case 4:\n            //    return val1 == val2;\n            //case 5:\n            //    return val1 != val2;\n            //case 6:\n            //    return val1 || val2;\n            //case 7:\n            //    return val1 &amp;&amp; val2;\n            default: assert(0);\n        }\n    }\n}\n#endif\n\nstatic bool make_token(char *e) {\n    int position = 0;\n    int i;\n    regmatch_t pmatch;\n\n    nr_token = 0;\n\n    while (e[position] != '\\0') {\n        /* Try all rules one by one. */\n        for (i = 0; i &lt; NR_REGEX; i ++) {\n            if (regexec(&amp;re[i], e + position, 1, &amp;pmatch, 0) == 0 &amp;&amp; pmatch.rm_so == 0) {\n                //      char *substr_start = e + position;\n                int substr_len = pmatch.rm_eo;\n                /*\n                   Log(\"match rules[%d] = \\\"%s\\\" at position %d with len %d: %.*s\",\n                   i, rules[i].regex, position, substr_len, substr_len, substr_start);\n                   */\n\n                position += substr_len;\n\n                /* TODO: Now a new token is recognized with rules[i]. Add codes\n                 * to record the token in the array `tokens'. For certain types\n                 * of tokens, some extra actions should be performed.\n                 */\n                Token tmp_token;\n                switch (rules[i].token_type) {\n                    case '+':\n                        tmp_token.type = '+';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case '-':\n                        tmp_token.type = '-';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case '*':\n                        tmp_token.type = '*';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case '/':\n                        tmp_token.type = '/';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case 256:\n                        break;\n                    case '!':\n                        tmp_token.type = '!';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case 9:\n                        tmp_token.type = ')';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n                    case 8:\n                        tmp_token.type = '(';\n                        tokens[nr_token ++] = tmp_token;\n                        break;\n\n                        // Special\n                    case 1: // num\n                        tokens[nr_token].type = 1;\n                        strncpy(tokens[nr_token].str, &amp;e[position - substr_len], substr_len);\n                        nr_token ++;\n                        break;\n                    case 2: // regex\n                        tokens[nr_token].type = 2;\n                        strncpy(tokens[nr_token].str, &amp;e[position - substr_len], substr_len);\n                        nr_token ++;\n                        break;\n                    case 3: // HEX\n                        tokens[nr_token].type = 3;\n                        strncpy(tokens[nr_token].str, &amp;e[position - substr_len], substr_len);\n                        nr_token ++;\n                        break;\n                    case 4:\n                        tokens[nr_token].type = 4;\n                        strcpy(tokens[nr_token].str, \"==\");\n                        nr_token++;\n                        break;\n                    case 5:\n                        tokens[nr_token].type = 5;\n                        strcpy(tokens[nr_token].str, \"!=\");\n                        nr_token++;case 6:\n                        tokens[nr_token].type = 6;\n                        strcpy(tokens[nr_token].str, \"||\");\n                        nr_token++;\n                        break;\n                    case 7:\n                        tokens[nr_token].type = 7;\n                        strcpy(tokens[nr_token].str, \"&amp;&amp;\");\n                        nr_token++;\n                        break;\n                    case 10:\n                        tokens[nr_token].type = 10;\n                        strcpy(tokens[nr_token].str, \"&lt;=\");\n                        nr_token ++;\n                        break;\n                    default:\n                        printf(\"i = %d and No rules is com.\\n\", i);\n                        break;\n                }\n                //int  len = nr_token;\n                break;\n            }\n        }\n\n        if (i == NR_REGEX) {\n            printf(\"no match at position %d\\n%s\\n%*.s^\\n\", position, e, position, \"\");\n            return false;\n        }\n    }\n\n    return true;\n}\n\nbool check_parentheses(int p, int q)\n{\n    if(tokens[p].type != '('  || tokens[q].type != ')')\n        return false;\n    int l = p , r = q;\n    while(l &lt; r)\n    {\n        if(tokens[l].type == '('){\n            if(tokens[r].type == ')')\n            {\n                l ++ , r --;\n                continue;\n            }\n\n            else\n                r --;\n        }\n        else if(tokens[l].type == ')')\n            return false;\n        else l ++;\n    }\n    return true;\n}\nuint32_t eval(int p, int q) {\n    if (p &gt; q) {\n        /* Bad expression */\n        assert(0);\n        return -1;\n    }\n    else if (p == q) {\n        /* Single token.\n         * For now this token should be a number.\n         * Return the value of the number.\n         */\n        return atoi(tokens[p].str);\n    }\n    else if (check_parentheses(p, q) == true) {\n        /* The expression is surrounded by a matched pair of parentheses.\n         * If that is the case, just throw away the parentheses.\n         */\n        // printf(\"check p = %d, q = %d\\n\",p + 1 , q - 1);\n        return eval(p + 1, q - 1);\n    }\n    /* else if(check_parentheses(p, q) == false){\n       printf(\"Unique\\n\");\n       return -1;\n       }\n       */\n    else {\n        int op = -1; // op = the position of \u4e3b\u8fd0\u7b97\u7b26 in the token expression;\n        bool flag = false;\n        for(int i = p ; i &lt;= q ; i ++)\n        {\n            if(tokens[i].type == '(')\n            {\n                while(tokens[i].type != ')')\n                    i ++;\n            }\n            if(!flag &amp;&amp; tokens[i].type == 6){\n                flag = true;\n                op = max(op,i);\n            }\n\n            if(!flag &amp;&amp; tokens[i].type == 7 ){\n                flag = true;\n                op = max(op,i);\n            }\n\n            if(!flag &amp;&amp; tokens[i].type == 5){\n                flag = true;\n                op = max(op,i);\n            }\n\n            if(!flag &amp;&amp; tokens[i].type == 4){\n                flag = true;\n                op = max(op,i);\n            }\n            if(!flag &amp;&amp; tokens[i].type == 10){\n                flag = true;\n                op = max(op, i);\n            }\n            if(!flag &amp;&amp; (tokens[i].type == '+' || tokens[i].type == '-')){\n                flag = true;\n                op = max(op, i);\n            }\n            if(!flag &amp;&amp; (tokens[i].type == '*' || tokens[i].type == '/') ){\n                op = max(op, i);\n            }\n        }\n        //      printf(\"op position is %d\\n\", op);\n        // if register return $register\n        int  op_type = tokens[op].type;\n\n        // \u9012\u5f52\u5904\u7406\u5269\u4f59\u7684\u90e8\u5206\n        uint32_t  val1 = eval(p, op - 1);\n        uint32_t  val2 = eval(op + 1, q);\n        //      printf(\"val1 = %d, val2 = %d \\n\", val1, val2);\n\n        switch (op_type) {\n            case '+':\n                return val1 + val2;\n            case '-':\n                return val1 - val2;\n            case '*':\n                return val1 * val2;\n            case '/':\n                return val1 / val2;\n            case 4:\n                return val1 == val2;\n            case 5:\n                return val1 != val2;\n            case 6:\n                return val1 || val2;\n            case 7:\n                return val1 &amp;&amp; val2;\n            default:\n                printf(\"No Op type.\");\n                assert(0);\n        }\n    }\n}\n\n\nword_t expr(char *e, bool *success) {\n  if (!make_token(e)) {\n    *success = false;\n    return 0;\n  }\n/*\n  // \u786e\u4fdd\u4f7f\u7528strtol\u8f6c\u6362\u5b57\u7b26\u4e32\u4e3a\u6570\u5b57\n  for (int i = 0; i &lt; nr_token; ++i) {\n      if (tokens[i].type == TK_NUM) {\n          tokens[i].num_value = atoi(tokens[i].str);\n      }\n  }\n  */\n\n  /* TODO: Insert codes to evaluate the expression. */\n  int result = (word_t)eval(0, nr_token - 1);\n  if (result == -1) {\n    *success = false;\n  }\n\n  return result;\n}\n</code></pre> <p>\u6709\u60f3\u6cd5\uff1f</p> <ul> <li>\u5982\u679c\u5f53\u524d\u6807\u8bb0\u662f\u5de6\u62ec\u53f7 <code>'('</code>\uff0c\u5219\u4f7f\u7528 <code>while</code> \u5faa\u73af\u8df3\u8fc7\u62ec\u53f7\u5185\u7684\u6240\u6709\u6807\u8bb0\uff0c\u76f4\u5230\u9047\u5230\u53f3\u62ec\u53f7 <code>')'</code>\u3002\u8fd9\u6837\u505a\u662f\u56e0\u4e3a\u62ec\u53f7\u5185\u7684\u8868\u8fbe\u5f0f\u5e94\u8be5\u88ab\u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u5e76\u4e14\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e0d\u9700\u8981\u8fdb\u4e00\u6b65\u89e3\u6790\u3002</li> </ul> <p>\u89e3\u51b3\uff1a</p> <pre><code>       for (int i = p; i &lt;= q; i++) {\n            if (tokens[i].type == TK_LEFT_PAR) {\n                while (tokens[i].type != TK_RIGHT_PAR) {\n                    /* \u8df3\u8fc7\u62ec\u53f7\u5185\u7684\u8868\u8fbe\u5f0f\uff0c\u76f4\u5230\u9047\u5230\u5bf9\u5e94\u7684\u53f3\u62ec\u53f7 */\n                    i++;\n                }\n                continue;\n            }\n\n            // \u5224\u65ad\u4e3b\u8fd0\u7b97\u7b26\u52a0\u51cf\u4e58\u9664\u7684\u8fd0\u7b97\u4f18\u5148\u7ea7\n            // \u5728\u8868\u8fbe\u5f0f\u62ec\u53f7\u5185\u7684\u4e0d\u662f\u4e3b\u8fd0\u7b97\u7b26 \n            if (tokens[i].type &gt;= TK_ADD &amp;&amp; tokens[i].type &lt;= TK_DIV) {\n                int priority = get_priority(tokens[i].type);\n                // \u6211\u8fd9\u6837\u5b50\u5199\u662f\u4e0d\u662f\u6709\u70b9\u95ee\u9898\uff1f\n                // \u8981\u4e0d\u5206\u5f00\u6765\u5199\uff1f\n                // \u5148\u5224\u65ad\u4e86+-\n                // \u6709\u4e2a\u95ee\u9898\n                // \u6211\u4e00\u5f00\u59cb\u90a3\u6837\u5b50\u5199 priority &gt; max_priority\n                // \u53ea\u6709\u5728\u627e\u5230\u6bd4\u4e4b\u524d\u627e\u5230\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u8fd0\u7b97\u7b26\u624d\u4f1a\u66f4\u65b0op\u3001\n                // \u8fd9\u6837\u5b50\uff0cop\u5c31\u4e00\u76f4\u90fd\u5728\u90a3\u4e2a\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u4f4d\u7f6e\u4e86\u3002\n                // \u6240\u4ee5\uff0c\u6211\u8981\u6539\u7684\u5e94\u8be5\u662f\u5728\u6bcf\u4e00\u4e2a\u4f18\u5148\u7ea7\u90fd\u8981\u8fdb\u884c\u5224\u65ad\n                if (priority &lt;= min_priority  ) {\n                    min_priority = priority;\n                    op = i;\n                }\n            }\n            // \u73b0\u5728\u6211\u5c31\u6539\u6210\u529f\u4e86\uff1f\u90a3\u5173\u952e\u7684\u4e00\u6b65\u5e94\u8be5\u662f\u8df3\u8fc7\uff08\uff09\n        }\n        op_type = tokens[op].type;\n</code></pre> <p>\u73b0\u5728\u9700\u8981\u5b9e\u73b0\u8bc6\u522b\u8d1f\u6570:</p> <p>\u5b9e\u73b0\u5e26\u6709\u8d1f\u6570\u7684\u7b97\u672f\u8868\u8fbe\u5f0f\u7684\u6c42\u503c (\u9009\u505a)</p> <p>\u5728\u4e0a\u8ff0\u5b9e\u73b0\u4e2d, \u6211\u4eec\u5e76\u6ca1\u6709\u8003\u8651\u8d1f\u6570\u7684\u95ee\u9898, \u4f8b\u5982</p> <pre><code>\"1 + -1\"\n\"--1\"    /* \u6211\u4eec\u4e0d\u5b9e\u73b0\u81ea\u51cf\u8fd0\u7b97, \u8fd9\u91cc\u5e94\u8be5\u89e3\u91ca\u6210 -(-1) = 1 */\n</code></pre> <p>\u5b83\u4eec\u4f1a\u88ab\u5224\u5b9a\u4e3a\u4e0d\u5408\u6cd5\u7684\u8868\u8fbe\u5f0f. \u4e3a\u4e86\u5b9e\u73b0\u8d1f\u6570\u7684\u529f\u80fd, \u4f60\u9700\u8981\u8003\u8651\u4e24\u4e2a\u95ee\u9898:</p> <ul> <li>\u8d1f\u53f7\u548c\u51cf\u53f7\u90fd\u662f<code>-</code>, \u5982\u4f55\u533a\u5206\u5b83\u4eec?</li> <li>\u8d1f\u53f7\u662f\u4e2a\u5355\u76ee\u8fd0\u7b97\u7b26, \u5206\u88c2\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u4ec0\u4e48?</li> </ul> <p>\u4f60\u53ef\u4ee5\u9009\u62e9\u4e0d\u5b9e\u73b0\u8d1f\u6570\u7684\u529f\u80fd, \u4f46\u4f60\u5f88\u5feb\u5c31\u8981\u9762\u4e34\u7c7b\u4f3c\u7684\u95ee\u9898\u4e86. </p> <p>\u53c8\u662f\u90a3\u4e2a\u5173\u952e\u7684\u5730\u65b9\uff1a\u8bc6\u522btoken\u7684\u65f6\u5019\uff0c\u7528\u7684\u662f <code>nr_token</code>\uff0c\u800c\u4e0d\u662f <code>i</code>\uff0c<code>i</code> \u662f\u6b63\u5219\u8868\u8fbe\u5f0f\u89c4\u5219\u7684\u4e0b\u6807\uff01</p> <p>\u4efb\u52a1\uff1a</p> <ol> <li> <p>\u73b0\u5728\u5b9e\u73b0 <code>p -1+2</code></p> </li> <li> <p>\u5b9e\u73b0\u8fd0\u7b97\u7b26\u53f7\u6df7\u5408</p> </li> <li> <p>\u5b9e\u73b0--1\u7c7b\u578b\u7684</p> </li> </ol> <pre><code>/*\n * Version1\n *\n */\n\n    int begin_neg = 0;\n    // \u4f7f\u7528atoi\u8f6c\u6362\u5b57\u7b26\u4e32\u4e3a\u6570\u5b57\n    for (int i = 0; i &lt; nr_token; ++i) {\n        // \u6b63\u8d1f\u6570\u5904\u7406\n        if (tokens[i].type == TK_NUM) { // \u6b63\u5e38\u6b63\u6570\n            tokens[i].num_value = atoi(tokens[i].str);\n        } else if (tokens[i].type == TK_NEG\n            &amp;&amp; (i == 0 &amp;&amp; tokens[i + 1].type == TK_NUM)) // \u5f00\u5934\u8d1f\u53f7\uff1a-1+2  \n        { \n            begin_neg++;\n            tokens[i + 1].num_value = -atoi(tokens[i + 1].str);\n            i++; \n        } else if (tokens[i].type == TK_SUB // \u8fde\u7eed\u8d1f\u53f7\uff1a2--1\n                   &amp;&amp; tokens[i + 1].type == TK_NEG)\n        {\n            tokens[i].type = TK_ADD;\n\n            if (i + 2 &lt; nr_token &amp;&amp; tokens[i + 2].type == TK_NUM) {\n                tokens[i + 2].num_value = atoi(tokens[i + 2].str);\n            }\n\n            // \u4ece i + 2 \u5f00\u59cb\uff0c\u5c06\u6240\u6709\u5143\u7d20\u5411\u524d\u79fb\u52a8\u4e00\u4e2a\u4f4d\u7f6e\n            for(int j = i + 2; j &lt; nr_token; j++) {\n                tokens[j - 1] = tokens[j];\n            }\n            memset(&amp;tokens[i + 2], 0, sizeof(tokens[i + 2]));\n\n            nr_token--;\n            i += 2;\n        } else if (tokens[i].type == TK_ADD // \u6b63\u8d1f\u53f7\uff1a2+-1 (\u5355\u76ee\u8fd0\u7b97\u7b26)\n                   &amp;&amp; tokens[i + 1].type == TK_NEG) \n        {\n            tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n\n            // \u4ece i + 2 \u5f00\u59cb\uff0c\u5c06\u6240\u6709\u5143\u7d20\u5411\u524d\u79fb\u52a8\u4e00\u4e2a\u4f4d\u7f6e\n            for(int j = i + 2; j &lt; nr_token; j++) {\n                tokens[j - 1] = tokens[j];\n            }\n            memset(&amp;tokens[i + 2], 0, sizeof(tokens[i + 2]));\n            nr_token--;\n            i++;\n        }\n    }\n</code></pre> <pre><code>/*\n * Version1.1\n * \u7b80\u5355\u4f18\u5316\u8fc7\n */\n\n void is_Negative() {\n    for (int i = 0; i &lt; nr_token ;i++) {\n        if (tokens[i].type == TK_SUB) {\n            if ((i == 0) \n                || (tokens[i - 1].type != TK_NUM &amp;&amp; tokens[i + 1].type == TK_NUM))\n            {\n                tokens[i].type = TK_NEG;\n            }\n        }\n    }\n}\n\n/*\n * \u4ecestart\u5f80\u540e\u4e0d\u5305\u62ec(start)\u7684\u5185\u5bb9\uff0c\u90fd\u5f80\u524d\u79fb\u52a8count\u4e2a\u5355\u4f4d\n\n */\nvoid shift_left(int start, int count) {\n    for (int j = start; j &lt; nr_token; ++j) {      \n        tokens[j - count] = tokens[j];\n    }\n    memset(&amp;tokens[start], 0, sizeof(tokens[start]));\n    nr_token-=count;\n}\n\nword_t expr(char *e, bool *success) {\n    if (!make_token(e)) {\n        *success = false;\n        return 0;\n    }\n    is_Negative();\n\n    int begin_neg = 0;\n    // \u4f7f\u7528atoi\u8f6c\u6362\u5b57\u7b26\u4e32\u4e3a\u6570\u5b57\n    for (int i = 0; i &lt; nr_token; ++i) {\n        // \u6b63\u8d1f\u6570\u5904\u7406\n        if (tokens[i].type == TK_NUM) { // \u6b63\u5e38\u6b63\u6570\n            tokens[i].num_value = atoi(tokens[i].str);\n        } else if (tokens[i].type == TK_NEG\n            &amp;&amp; (i == 0 &amp;&amp; tokens[i + 1].type == TK_NUM)) // \u5f00\u5934\u8d1f\u53f7\uff1a-1+2  \n        { \n            begin_neg++;\n            tokens[i + 1].num_value = -atoi(tokens[i + 1].str);\n            i++; \n        } else if (tokens[i].type == TK_SUB // \u8fde\u7eed\u8d1f\u53f7\uff1a2--1\n                   &amp;&amp; tokens[i + 1].type == TK_NEG)\n        {\n            tokens[i].type = TK_ADD;\n\n            //\u6211\u8fd9\u91cc\u8fd8\u5224\u65adi + 2 &lt; nr_token\u662f\u4e0d\u662f\u6709\u70b9\u591a\u6b64\u4e00\u4e3e\uff1f\n            // \u540e\u9762\u8fd9\u4e2a\u6761\u4ef6\u5e94\u8be5\u5bf9\u7684\uff0c\u8981\u77e5\u9053\u4ed6\u662f\u6570\u5b57\n            if (i + 2 &lt; nr_token &amp;&amp; tokens[i + 2].type == TK_NUM) {\n                tokens[i + 2].num_value = atoi(tokens[i + 2].str);\n            }\n            shift_left(i + 2, 1);\n            i += 2;\n        } else if (tokens[i].type == TK_ADD // \u6b63\u8d1f\u53f7\uff1a2+-1 (\u5355\u76ee\u8fd0\u7b97\u7b26)\n                   &amp;&amp; tokens[i + 1].type == TK_NEG) \n        {\n            tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n            shift_left(i + 2, 1);\n            i++;\n        }\n    }\n</code></pre> <p>\u6211\u5728\u60f3\u80fd\u4e0d\u80fd\u7528\u5b8f\u7b49\u9ad8\u7ea7\u65b9\u6cd5\u6765\u63d0\u5347\u53ef\u8bfb\u6027\u3001\u6027\u80fd\uff0c\u53d8\u5f97\u66f4\u4f18\u96c5\uff1f</p> <p>\u8fd8\u6709\u53d8\u91cf\u7684\u7c7b\u578b\uff1f</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\u5b57\u7b26\u6765\u6253\u5370<code>uint32_t</code>\u548c<code>uint64_t</code>\u7c7b\u578b\u7684\u53d8\u91cf\uff1a</p> <ul> <li>\u5bf9\u4e8e<code>uint32_t</code>\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528<code>PRIu32</code>\u683c\u5f0f\u5b57\u7b26\uff0c\u5b9a\u4e49\u5728<code>inttypes.h</code>\u5934\u6587\u4ef6\u4e2d\u3002</li> <li>\u5bf9\u4e8e<code>uint64_t</code>\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528<code>PRIu64</code>\u683c\u5f0f\u5b57\u7b26\uff0c\u540c\u6837\u4e5f\u5b9a\u4e49\u5728<code>inttypes.h</code>\u5934\u6587\u4ef6\u4e2d\u3002</li> </ul> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;inttypes.h&gt;\n\nint main() {\n    uint32_t num32 = 42;\n    uint64_t num64 = 123456789012345;\n\n    printf(\"uint32_t: %\" PRIu32 \"\\n\", num32);\n    printf(\"uint64_t: %\" PRIu64 \"\\n\", num64);\n\n    return 0;\n}\n</code></pre> <p>\u53e6\u5916\uff0c\u8fd9\u4e2a\u597d\u50cf\u4e0d\u592a\u884c\uff0c3+4*-1\u4e5f\u4e0d\u5bf9\uff1f</p> <p>\u6211\u60f3\u53ef\u4ee5\u5148\u5224\u65ad\u540e\u9762\u4e00\u4e2a\u7684\u5b57\u7b26\u662f\u4e0d\u662f\u8d1f\u53f7\uff0c\u518d\u56de\u8fc7\u5934\u53bb\u770b\u524d\u9762\u7684\u662f\u4ec0\u4e48\u8d1f\u53f7\uff0c</p> <p>\u8d1f\u53f7\uff1a2--1</p> <p>\u6b63\u53f7\uff1a2+-1</p> <p>\u4e58\u53f7\uff1a2*-1</p> <p>\u9664\u53f7\uff1a2/-1</p> <p>\u518d\u6539\u4e00\u7248\uff1a</p> <pre><code>/**\n * \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\u3002\n *\n * @note \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\n * @note i + 2 \u51fa\u73b0\u8fd9\u4e48\u591a\u6b21?\n * @note eg. 2--1 :\u7b2c\u4e00\u4e2a\u51cf\u53f7\u4e3ai\n */\nint handle_neg(int i, bool *neg_flag) {\n    if (tokens[i].type == TK_NEG // \u5f00\u5934\u8d1f\u53f7\uff1a-1+2\n               &amp;&amp; (i == 0 &amp;&amp; tokens[ + 1].type == TK_NUM)) {\n        *neg_flag = true;\n\n        tokens[i + 1].num_value = -atoi(tokens[i + 1].str);\n        i++;\n    } else if (tokens[i + 1].type == TK_NEG\n               &amp;&amp; tokens[i + 2].type == TK_NUM) {\n        switch (tokens[i].type) {\n            // \u8fd8\u662f\u6709\u95ee\u9898\uff0c\u8981\u662f\u6709\u5d4c\u5957\u62ec\u53f7\u600e\u4e48\u529e\u5462\uff1f\n            case TK_ADD:\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_SUB:\n                tokens[i].type = TK_ADD;\n\n                tokens[i + 2].num_value = atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i += 2;\n                break;\n\n            case TK_MUL:\n                tokens[i].type = TK_MUL;\n\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_DIV:\n                tokens[i].type = TK_DIV;\n\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n        }\n    }\n    return i;\n}\n\n/**\n * \u5c06\u5b57\u7b26\u4e32\u8868\u8fbe\u5f0f\u4e2d\u7684\u6570\u5b57\u8f6c\u6362\u4e3a\u6570\u503c\uff0c\n * \n * @return \u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6307\u793a\u8868\u8fbe\u5f0f\u662f\u5426\u4ee5\u8d1f\u53f7\u5f00\u5934\n */\nbool string_2_num(void) {\n    bool neg_flag = false;\n    // \u4f7f\u7528atoi? \u8fd8\u662fstrtoul? \u8f6c\u6362\u5b57\u7b26\u4e32\u4e3a\u6570\u5b57\n    for (int i = 0; i &lt; nr_token; ++i) {\n        // \u6b63\u5e38\u6b63\u6570\n        if (tokens[i].type == TK_NUM) {\n            tokens[i].num_value = atoi(tokens[i].str);\n        }\n        // \u8d1f\u6570\u5904\u7406\n        i = handle_neg(i, &amp;neg_flag);\n    }\n    return neg_flag;\n}\n\nword_t expr(char *e, bool *success) {\n  if (!make_token(e)) {\n    *success = false;\n    return 0;\n  }\n  is_neg();\n\n  bool neg_begin = string_2_num();\n  /* TODO: Insert codes to evaluate the expression. */\n  int result = neg_begin ? eval(1, nr_token - 1) : eval(0, nr_token - 1);\n  // \u8d4b\u503c\u8303\u56f4\u95ee\u9898\uff0c\u9690\u5f0f\u8f6c\u6362\uff0c\u7b49\u4f1a\u89e3\u51b3\n  // \u4e0a\u9762\u7684\u907f\u514d\u4f7f\u7528atoi\uff0c\u4e5f\u662f\u4e00\u4e2a\u597d\u4e60\u60ef\uff0c\u56e0\u4e3a\u4f1a\u6574\u6570\u6ea2\u51fa\n\n  if (result == -1) {\n    *success = false;\n    return 0;\n  }\n\n  return result;\n}\n</code></pre> <p>\u4fee\u6539\uff1a</p> <pre><code>/**\n * \u4ecestart\u5f80\u540e\u7684\u5185\u5bb9\uff0c\u90fd\u5f80\u524d\u79fb\u52a8count\u4e2a\u5355\u4f4d\n * \u4e3a\u65b0\u5143\u7d20\u817e\u51fa\u7a7a\u95f4\uff0c\u4fdd\u6301\u6570\u7ec4\u5185\u5bb9\u7684\u8fde\u7eed\u6027\n */\nvoid shift_left(int start, int count) {\n  for (int j = start; j &lt; nr_token; ++j) {\n    tokens[j - count] = tokens[j];\n  }\n  // \u4e3a\u4ec0\u4e48\u8981\u8986\u76d6\u8fd9\u4e2a\uff1f\u6211\u4e0d\u662f\u8981\u8986\u76d6\u6700\u540e\u4e00\u4e2a\u5417\uff1f\n  //memset(&amp;tokens[start + count], 0, sizeof(tokens[start + count]));\n  memset(&amp;tokens[nr_token], 0, sizeof(tokens[nr_token]));\n  nr_token -= count;\n}\n\n/**\n * \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\u3002\n *\n * @note \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\n * @note i + 2 \u51fa\u73b0\u8fd9\u4e48\u591a\u6b21?\n * @note eg. 2--1 :\u7b2c\u4e00\u4e2a\u51cf\u53f7\u4e3ai\n */\nint handle_neg(int i) {\n    if (tokens[i].type == TK_NEG // \u5f00\u5934\u8d1f\u53f7\uff1a-1+2\n               &amp;&amp; (i == 0 &amp;&amp; tokens[i + 1].type == TK_NUM)) {\n        tokens[i + 1].num_value = -atoi(tokens[i + 1].str);\n        shift_left(i + 1 , 1);\n        i++;\n    } else if (tokens[i + 1].type == TK_NEG\n               &amp;&amp; tokens[i + 2].type == TK_NUM) {\n        switch (tokens[i].type) {\n            // \u8fd8\u662f\u6709\u95ee\u9898\uff0c\u8981\u662f\u6709\u5d4c\u5957\u62ec\u53f7\u600e\u4e48\u529e\u5462\uff1f\n            // \u8fd8\u6709\uff0c\u8981\u662f\u8f93\u5165--1,\u5e94\u8be5\u8f93\u51fa1\u624d\u5bf9\u3002\n            // \u90a3\u4e0a\u9762\u4e5f\u6539\u6210\u79fb\u52a8\u5427\n            // \u90a3\u8fd9\u6837\u5b50neg_flag\u4e5f\u4e0d\u7528\u4e86\n            case TK_ADD:\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_SUB:\n                tokens[i].type = TK_ADD;\n\n                tokens[i + 2].num_value = atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i += 2;\n                break;\n\n            case TK_MUL:\n                tokens[i].type = TK_MUL;\n\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_DIV:\n                tokens[i].type = TK_DIV;\n\n                tokens[i + 2].num_value = -atoi(tokens[i + 2].str);\n                shift_left(i + 2, 1);\n                i++;\n                break;\n        }\n    }\n    return i;\n}\n</code></pre> <p>\u6539\u8fdb\u62ec\u53f7\u7b97\u6cd5\uff1a</p> <pre><code>1. \u5bfb\u627e\u4e3b\u8fd0\u7b97\u7b26\n/*\nint find_main_operator(int p, int q, int *min_priority) {\n  int op = -1; // \u4e3b\u8fd0\u7b97\u7b26\u7684\u4f4d\u7f6e\n  Stack *stack = Stack_create();\n\n  for (int i = p; i &lt;= q; i++) {\n    if (tokens[i].type == TK_LEFT_PAR) {\n        Stack_push(stack, &amp;tokens[i].type);\n    } else if (tokens[i].type == TK_RIGHT_PAR) {\n        if (Stack_count(stack) &gt; 0) {\n            Stack_pop(stack);\n        } else {\n            // \u5982\u679c\u6808\u4e3a\u7a7a\uff0c\u8bf4\u660e\u53f3\u62ec\u53f7\u6ca1\u6709\u5339\u914d\u7684\u5de6\u62ec\u53f7\n            printf(\"Error: Unmatched right parenthesis\\n\");\n            return -1;\n        }\n    }\n\n    if (tokens[i].type == TK_NOTYPE) {\n      continue;\n    }\n\n    // \u5224\u65ad\u4e3b\u8fd0\u7b97\u7b26\u52a0\u51cf\u4e58\u9664\u7684\u8fd0\u7b97\u4f18\u5148\u7ea7\n    if (tokens[i].type &gt;= TK_ADD &amp;&amp; tokens[i].type &lt;= TK_DIV) {\n      int priority = get_priority(tokens[i].type);\n      // \u66f4\u65b0\u6700\u5c0f\u4f18\u5148\u7ea7\u548c\u4e3b\u8fd0\u7b97\u7b26\u4f4d\u7f6e\n      if (priority &lt;= *min_priority) {\n        *min_priority = priority;\n        op = i;\n      }\n    }\n\n  }\n\n  // \u68c0\u67e5\u6808\u662f\u5426\u4e3a\u7a7a\uff0c\u786e\u4fdd\u6240\u6709\u62ec\u53f7\u90fd\u5df2\u5339\u914d\n  if (Stack_count(stack) != 0) {\n      printf(\"Error: Unmatched left parenthesis\\n\");\n      return -1;\n  }\n\n  Stack_destroy(stack);\n  return op;\n}\n*/\nint find_main_operator(int p, int q, int *min_priority) {\n    int op = -1; // \u4e3b\u8fd0\u7b97\u7b26\u7684\u4f4d\u7f6e\n    int in_parens = 0; // \u6807\u8bb0\u662f\u5426\u5728\u62ec\u53f7\u5185\n    Stack *stack = Stack_create(); // \u521b\u5efa\u6808\n    for (int i = p; i &lt;= q; i++) {\n        if (tokens[i].type == TK_LEFT_PAR) {\n            // \u9047\u5230\u5de6\u62ec\u53f7\uff0c\u538b\u5165\u6808\u4e2d\uff0c\u5e76\u6807\u8bb0\u8fdb\u5165\u62ec\u53f7\n            Stack_push(stack, &amp;tokens[i].type);\n            in_parens++;\n        } else if (tokens[i].type == TK_RIGHT_PAR) {\n            // \u9047\u5230\u53f3\u62ec\u53f7\uff0c\u4ece\u6808\u4e2d\u5f39\u51fa\u5de6\u62ec\u53f7\uff0c\u5e76\u6807\u8bb0\u9000\u51fa\u62ec\u53f7\n            if (Stack_count(stack) &gt; 0) {\n                Stack_pop(stack);\n                in_parens--;\n            } else {\n                // \u5982\u679c\u6808\u4e3a\u7a7a\uff0c\u8bf4\u660e\u53f3\u62ec\u53f7\u6ca1\u6709\u5339\u914d\u7684\u5de6\u62ec\u53f7\n                printf(\"Error: Unmatched right parenthesis\\n\");\n                Stack_destroy(stack);\n                return -1;\n            }\n        } else if (tokens[i].type == TK_NOTYPE) {\n            continue;\n        } else if (tokens[i].type &gt;= TK_ADD &amp;&amp; tokens[i].type &lt;= TK_DIV) {\n            // \u53ea\u6709\u5728\u4e0d\u5728\u62ec\u53f7\u5185\u65f6\uff0c\u624d\u68c0\u67e5\u8fd0\u7b97\u7b26\n            if (in_parens == 0) {\n                int priority = get_priority(tokens[i].type);\n                if (priority &lt; *min_priority) {\n                    *min_priority = priority;\n                    op = i;\n                }\n            }\n        }\n    }\n    // \u68c0\u67e5\u6808\u662f\u5426\u4e3a\u7a7a\uff0c\u786e\u4fdd\u6240\u6709\u62ec\u53f7\u90fd\u5df2\u5339\u914d\n    if (Stack_count(stack) != 0) {\n        printf(\"Error: Unmatched left parenthesis\\n\");\n        Stack_destroy(stack);\n        return -1;\n    }\n    // \u9500\u6bc1\u6808\n    Stack_destroy(stack);\n    return op;\n}\n\n\n\n2. \u62ec\u53f7\u5339\u914d\n/*\n *version1.0\n */\n/*\nbool check_parentheses(int p, int q) {\n  if (!(tokens[p].type == TK_LEFT_PAR &amp;&amp; tokens[q].type == TK_RIGHT_PAR )) \n  {\n      return false;\n  }\n  // (70)-(52) \u4e0d\u884c\n\n  int l = p, r = q;\n  while (l &lt; r) {\n    if (tokens[l].type == '(') {\n      if (tokens[r].type == ')') {\n        l++, r--;\n        continue;\n      }\n\n      else\n        r--;\n    } else if (tokens[l].type == ')')\n      return false;\n    else\n      l++;\n  }\n  return true;\n}\n*/\n\n/**\n * version2\n * (70)-(52) \u4e0d\u884c\n *\n * \u601d\u8003\uff1a\u65e2\u7136\u5df2\u7ecf\u8fc7\u4e86\u7b2c\u4e00\u90e8\u5206\u7684\u68c0\u67e5,\n *       \u90a3\u6211\u76f4\u63a5\u4ece p + 1 \u5f00\u59cb\u5224\u65ad\u5230 q -1\n *       \u8fd9\u6837\u5b50\u4e0d\u5c31\u76f4\u63a5\u8df3\u8fc7\u4e86\u5417?\n */\nbool check_parentheses(int p, int q) {\n    if (tokens[p].type != TK_LEFT_PAR || tokens[q].type != TK_RIGHT_PAR) {\n        return false;\n    }\n\n    Stack *stack = Stack_create();\n    for (int i = p + 1; i &lt; q; i++) {\n        if (tokens[i].type == TK_LEFT_PAR) {\n            Stack_push(stack, &amp;tokens[i].type);\n        } else if (tokens[i].type == TK_RIGHT_PAR) {\n            if (Stack_count(stack) == 0) {\n                Stack_destroy(stack);\n                return false;\n            }\n            Stack_pop(stack); \n        }\n    }\n\n    // \u6808\u975e\u7a7a\uff0c\u6709\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\n    if (Stack_count(stack) != 0) {\n        Stack_destroy(stack);\n        return false;\n    }\n\n    Stack_destroy(stack);\n    return true;\n}\n</code></pre> <p>\u6211\u6539\u4e86\u597d\u51e0\u7248\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u592a\u4f1a\u7528git\u6765\u7248\u672c\u63a7\u5236\uff1f\u6211\u5199\u4e86\u5f88\u591a\u7248\u4ee3\u7801\uff0c\u600e\u4e48\u4f7f\u7528\u5462\uff1f</p> <p>\u80fd\u4e0d\u80fd\u5177\u4f53\u4f7f\u7528\u4f8b\u5b50\u6765\u770b\u770b\uff1f\u6bd4\u5982\u8bf4\u6211\u5199\u4e865\u7248\uff0c\u90a3\u6211\u6bcf\u5199\u5b8c\u4e00\u7248\u6211\u90fd\u4e0a\u4ea4\u4e00\u6b21\uff1f\u8fd8\u662f\u4ec0\u4e48\uff1f</p> <p>\u51fd\u6570\u6539\u5b8f:</p> <p>\u5c06<code>shift_left</code>\u51fd\u6570\u8f6c\u6362\u4e3a\u5b8f\u5b9a\u4e49\u53ef\u4ee5\u63d0\u9ad8\u4ee3\u7801\u7684\u7b80\u6d01\u6027\uff0c\u5c24\u5176\u662f\u5728\u8be5\u51fd\u6570\u4f53\u8f83\u5c0f\u4e14\u4f7f\u7528\u9891\u7e41\u7684\u60c5\u51b5\u4e0b\u3002\u7136\u800c\uff0c\u4f7f\u7528\u5b8f\u4e5f\u6709\u4e00\u4e9b\u6f5c\u5728\u7684\u7f3a\u70b9\uff0c\u6bd4\u5982\u53ef\u80fd\u4f1a\u4f7f\u5f97\u8c03\u8bd5\u66f4\u52a0\u56f0\u96be\uff0c\u5e76\u4e14\u5982\u679c\u5b8f\u7684\u4f7f\u7528\u4e0d\u5f53\uff0c\u8fd8\u53ef\u80fd\u5bfc\u81f4\u610f\u5916\u7684\u526f\u4f5c\u7528\u3002</p> <p>\u5728\u51b3\u5b9a\u662f\u5426\u5c06<code>shift_left</code>\u8f6c\u6362\u4e3a\u5b8f\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u770b\u770b\u8fd9\u4e2a\u51fd\u6570\uff1a</p> <pre><code>void shift_left(int start, int count) {\n    for (int j = start; j &lt; nr_token; ++j) {\n        tokens[j - count] = tokens[j];\n    }\n    memset(&amp;tokens[nr_token - 1], 0, sizeof(tokens[nr_token - 1]));\n    nr_token -= count;\n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u662f\u5c06<code>tokens</code>\u6570\u7ec4\u4ece<code>start</code>\u7d22\u5f15\u5f00\u59cb\u7684\u5143\u7d20\u5411\u524d\u79fb\u52a8<code>count</code>\u4e2a\u4f4d\u7f6e\uff0c\u5e76\u51cf\u5c11<code>nr_token</code>\u7684\u503c\u3002\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u5916\u90e8\u72b6\u6001\uff0c\u4e5f\u6ca1\u6709\u590d\u6742\u7684\u63a7\u5236\u6d41\uff0c\u56e0\u6b64\u5b83\u662f\u4e00\u4e2a\u5c06\u5b8f\u8f6c\u6362\u7684\u597d\u5019\u9009\u3002</p> <p>\u5982\u679c\u51b3\u5b9a\u5c06\u5176\u8f6c\u6362\u4e3a\u5b8f\uff0c\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>#define SHIFT_LEFT(start, count) \\\n    do { \\\n        for (int j = (start); j &lt; nr_token; ++j) { \\\n            tokens[j - (count)] = tokens[j]; \\\n        } \\\n        memset(&amp;tokens[nr_token - 1], 0, sizeof(tokens[nr_token - 1])); \\\n        nr_token -= (count); \\\n    } while (0)\n</code></pre> <p>\u4f7f\u7528\u5b8f\u7684\u597d\u5904\u5305\u62ec\uff1a</p> <ol> <li>\u907f\u514d\u51fd\u6570\u8c03\u7528\uff1a\u5b8f\u5728\u9884\u5904\u7406\u9636\u6bb5\u5c55\u5f00\uff0c\u56e0\u6b64\u6ca1\u6709\u51fd\u6570\u8c03\u7528\u7684\u5f00\u9500\u3002</li> <li>\u4ee3\u7801\u7b80\u6d01\uff1a\u5728\u591a\u4e2a\u5730\u65b9\u4f7f\u7528\u65f6\uff0c\u5b8f\u53ef\u4ee5\u51cf\u5c11\u91cd\u590d\u4ee3\u7801\u3002</li> </ol> <p>\u6f5c\u5728\u7684\u7f3a\u70b9\u5305\u62ec\uff1a</p> <ol> <li>\u8c03\u8bd5\u96be\u5ea6\uff1a\u5b8f\u5728\u8c03\u8bd5\u65f6\u53ef\u80fd\u66f4\u96be\u8ddf\u8e2a\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728\u9884\u5904\u7406\u9636\u6bb5\u5c31\u5df2\u7ecf\u5c55\u5f00\u3002</li> <li>\u4f5c\u7528\u57df\u95ee\u9898\uff1a\u5b8f\u4e0d\u5177\u6709\u51fd\u6570\u90a3\u6837\u7684\u5c40\u90e8\u53d8\u91cf\u4f5c\u7528\u57df\uff0c\u53ef\u80fd\u4f1a\u5f15\u5165\u53d8\u91cf\u540d\u51b2\u7a81\u3002</li> <li>\u9519\u8bef\u5904\u7406\uff1a\u5b8f\u4e0d\u80fd\u50cf\u51fd\u6570\u90a3\u6837\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u4ee3\u7801\u6216\u5f02\u5e38\u3002</li> </ol> <p>\u5728\u5b9e\u9645\u4f7f\u7528\u5b8f\u65f6\uff0c\u8981\u6ce8\u610f\u907f\u514d\u8fd9\u4e9b\u6f5c\u5728\u95ee\u9898\u3002\u5982\u679c\u51b3\u5b9a\u4f7f\u7528\u5b8f\uff0c\u786e\u4fdd\u5b8f\u7684\u540d\u79f0\u8db3\u591f\u660e\u786e\uff0c\u4ee5\u51cf\u5c11\u4e0e\u5176\u4ed6\u4ee3\u7801\u7684\u547d\u540d\u51b2\u7a81\u3002</p> <p>\u6700\u540e\uff0c\u65e0\u8bba\u662f\u5426\u4f7f\u7528\u5b8f\uff0c\u90fd\u8981\u786e\u4fdd<code>shift_left</code>\u51fd\u6570\uff08\u6216\u5b8f\uff09\u7684\u6b63\u786e\u6027\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u6570\u7ec4\u8fb9\u754c\u548c\u5185\u5b58\u64cd\u4f5c\u65f6\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_27","title":"\u5173\u4e8e\u8d1f\u53f7\u8fdb\u4e00\u6b65","text":"<ol> <li>\u6211\u53ea\u662f\u4fdd\u8bc1\u4e86\u51fa\u73b02+-1\u5f62\u5982\u8fd9\u79cd\u7684\uff0c\u8981\u662f\u51fa\u73b0\u591a\u4e2a\u8d1f\u53f7\uff0c\u5c31\u5f88\u6709\u95ee\u9898\u4e86\u3002</li> <li>\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u6ca1\u6709\u66f4\u52a0\u6df1\u5165\u5730\u8003\u8651\u8fc7\u8d1f\u53f7\u4f5c\u4e3a\u5355\u76ee\u8fd0\u7b97\u7b26\u8fd9\u4e00\u70b9\u7684\u5185\u5bb9\u3002</li> <li>\u540e\u9762\u8fd8\u8981\u6dfb\u52a0\u5341\u516d\u8fdb\u5236\u6570\u7684\u8d1f\u53f7\u8865\u5145\uff1f\u503c\u5f97\u8003\u8651\u3002 </li> </ol> <p>\u7559\u5751\uff0c\u4e4b\u540e\u8981\u4fee\u6539\u3002</p> <pre><code> * \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\u3002\n *\n * @note \u5904\u7406\u8fde\u7eed\u7684\u8d1f\u53f7\u548c\u5f00\u5934\u7684\u8d1f\u53f7\n * @note i + 2 \u51fa\u73b0\u8fd9\u4e48\u591a\u6b21?\n * @note eg. 2--1 :\u7b2c\u4e00\u4e2a\u51cf\u53f7\u4e3ai\n *\n * TODO: \u8981\u6539\uff0c\u6211\u8fd9\u6837\u6709\u70b9\u76f8\u5f53\u4e8e\u7a77\u4e3e\u4e86\uff0c\u6ca1\u6709\u8003\u8651\u5230\u4ed6\u5355\u76ee\u8fd0\u7b97\u7b26\u7684\u7279\u70b9\u4e86\n *       \u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u5148\u628a\u529f\u80fd\u5b9e\u73b0\u4e86\u3002\n */\nint handle_neg(int i) {\n    if (tokens[0].type == TK_NEG // \u5f00\u5934\u8d1f\u53f7\uff1a-1+2\n               &amp;&amp; (tokens[i + 1].type == TK_NUM))\n    {\n        int num_value = 0;\n        if (sscanf(tokens[i + 1].str, \"%d\", &amp;num_value) != 1) {\n            fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 1].str);\n            exit(EXIT_FAILURE);\n        }\n        tokens[i + 1].num_value = -num_value;\n        shift_left(i + 1 , 1);\n        i++;\n    }else if (tokens[0].type == TK_NEG \n              &amp;&amp; tokens[1].type == TK_NEG) { // 2+ (-1)\n        int num_value = 0;\n        // \u6211\u8fd9\u4e48\u5904\u7406\u5e94\u8be5\u4e5f\u662f\u6709\u5f88\u5927\u95ee\u9898\u7684\uff0c\u8981\u662f\u51fa\u73b0\u8fde\u7eed\u7684\u8d1f\u53f7\n        if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n            fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n            exit(EXIT_FAILURE);\n        }\n        tokens[i + 2].num_value = -num_value;\n        tokens[i] = tokens[i + 2];\n        memset(&amp;tokens[1], 0, sizeof(tokens[1]));\n        memset(&amp;tokens[2], 0, sizeof(tokens[2])); \n        nr_token-=2;\n        i += 2;\n    } else if (tokens[i + 1].type == TK_NEG\n               &amp;&amp; tokens[i + 2].type == TK_NUM) {\n        int num_value = 0;\n        switch (tokens[i].type) { \n            case TK_LEFT_PAR: //\u8fd9\u91cc\u7684\u903b\u8f91\u600e\u4e48\u5b9e\u73b0\uff1f\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = -num_value;\n                shift_left(i + 2, 1);\n                i++;\n                break;\n            case TK_RIGHT_PAR: //\u8fd9\u91cc\u7684\u903b\u8f91\u600e\u4e48\u5b9e\u73b0\uff1f\n                tokens[i + 1].type = TK_ADD;\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = -num_value;\n                i+=2;\n                break;\n\n            case TK_ADD:\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = -num_value;\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_SUB:\n                tokens[i].type = TK_ADD;\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = num_value; \n                shift_left(i + 2, 1);\n                i += 2;\n                break;\n\n            case TK_MUL:\n                tokens[i].type = TK_MUL;\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = -num_value;\n                shift_left(i + 2, 1);\n                i++;\n                break;\n\n            case TK_DIV:\n                tokens[i].type = TK_DIV;\n                if (sscanf(tokens[i + 2].str, \"%d\", &amp;num_value) != 1) {\n                    fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 2].str);\n                    exit(EXIT_FAILURE);\n                }\n                tokens[i + 2].num_value = -num_value;\n                shift_left(i + 2, 1);\n                i++;\n                break;\n        }\n    }\n    return i;\n}\n</code></pre> <p>\u8be5\u91cd\u6784\u8fd9\u6258shit\u4e86</p> <pre><code>/**\n * Use unary operator, direct 1 -&gt; -1\n */\nint handle_neg(int i) {\n    bool isUnary = (i == 0 || tokens[i - 1].type != TK_NUM);\n\n    if (isUnary &amp;&amp; tokens[i + 1].type == TK_NUM) {\n        // Unary operator\n        int num_value = 0;\n        if (sscanf(tokens[i + 1].str, \"%d\", &amp;num_value) != 1) {\n            fprintf(stderr, \"Error converting string to number: %s\\n\", tokens[i + 1].str);\n            exit(EXIT_FAILURE);\n        }\n        tokens[i + 1].num_value = -num_value;\n        shift_left(i + 1, 1);\n        i++;\n        return i;\n    } \n    // Binary operator\n    return i;\n}\n</code></pre> <p>\u200b     </p>"},{"location":"ysyx/pa/pa1/pa1.html#_28","title":"\u7528\u51fd\u6570\u6307\u9488\uff1f","text":"<pre><code>static inline int op_add(int a, int b) {\n    return a + b;\n}\n\nstatic inline int op_sub(int a, int b) {\n    return a - b;\n}\n\nstatic inline int op_mul(int a, int b) {\n    return a * b;\n}\n\nstatic int op_div(int a, int b) {\n    if (b == 0) {\n        fprintf(stderr, \"Error: Division by zero.\\n\");\n        exit(EXIT_FAILURE);\n    }\n    return a / b;\n}\n\nstatic inline int op_eq(int a, int b) {\n    return a == b;\n}\n\nstatic inline int op_neq(int a, int b) {\n    return a != b;\n}\n\nstatic inline int op_logical_and(int a, int b) {\n    return a &amp;&amp; b;\n}\n\n\ntypedef int (*BinaryOperation)(int, int);\n/**\n * \u4e0b\u9762\u8fd9\u4e2a\u51fd\u6570\u987a\u5e8f\u548ctoken\u7c7b\u578b\u987a\u5e8f\u4e00\u81f4?\n * \u6709\u5fc5\u8981\u7528\u51fd\u6570\u6307\u9488\uff1f\n */\nBinaryOperation operations[] = {\n    op_add, \n    op_sub,\n    op_mul,\n    op_div,\n    op_eq,\n    op_neq,\n    op_logical_and,\n    // \u6307\u9488\u89e3\u5f15\u7528\u4e0d\u6d89\u53ca\u6570\u503c\u8ba1\u7b97\n};\n\nint compute(int op_type, int val1, int val2) {\n    if (op_type &lt; TK_ADD || op_type &gt; TK_OR) {\n        fprintf(stderr, \"Invalid operation type: %d\\n\", op_type);\n        exit(EXIT_FAILURE);\n    }\n\n    BinaryOperation op = operations[op_type];\n    if (op == NULL) {\n        fprintf(stderr, \"Operation not supported: %d\\n\", op_type);\n        exit(EXIT_FAILURE);\n    }\n    return op(val1, val2);\n}\n</code></pre> <p>\u5173\u4e8e\u4e0a\u9762\u7684\u5404\u79cd\u8ba1\u7b97\uff0c\u6211\u9700\u8981\u7528\u51fd\u6570\u6307\u9488\uff1f\u8fd8\u662f\u76f4\u63a5\u7b80\u6d01\u70b9\uff0cswitch case\u91cc\u5c31\u884c\uff1f</p> <pre><code>int compute(int op_type, int val1, int val2) {\n    switch (op_type) {\n        case TK_ADD: return val1 + val2;\n        case TK_SUB: return val1 - val2;\n        case TK_MUL: return val1 * val2;\n        case TK_DIV:\n            if (val2 == 0) {\n                fprintf(stderr, \"Error: Division by zero.\\n\");\n                exit(EXIT_FAILURE);\n            }\n            return val1 / val2;\n        case TK_EQ: return val1 == val2;\n        case TK_NEQ: return val1 != val2;\n        case TK_LOGICAL_AND: return val1 &amp;&amp; val2;\n        // ... \u5176\u4ed6\u8fd0\u7b97\u7b26\n        default:\n            fprintf(stderr, \"Invalid operation type: %d\\n\", op_type);\n            exit(EXIT_FAILURE);\n    }\n}\n</code></pre> <p>\u5148\u7528\u8fd9\u4e2a\u7b80\u6d01\u7684\u5427\u3002\u6211\u4e5f\u4e0d\u9700\u8981\u8fd9\u4e48\u591a\u529f\u80fd\uff1f</p>"},{"location":"ysyx/pa/pa1/pa1.html#_29","title":"\u5173\u4e8e\u7c7b\u578b\u6ea2\u51fa","text":"<p>\u597d\u597d\u603b\u7ed3\uff1f</p> <p></p> <p></p> <pre><code>(-1)/2 0\n(uint32_t) (1-2)/2 = \n</code></pre>"},{"location":"ysyx/pa/pa1/pa1.html#test-your-code","title":"test your code","text":"<ul> <li>\u8fdb\u884c\u7684\u90fd\u662f\u65e0\u7b26\u53f7\u8fd0\u7b97</li> <li>\u6570\u636e\u5bbd\u5ea6\u90fd\u662f32bit</li> <li>\u6ea2\u51fa\u540e\u4e0d\u5904\u7406</li> </ul> <ul> <li> <p><code>system</code> \u548c <code>popen</code> \u51fd\u6570</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c<code>system</code> \u548c <code>popen</code> \u662f\u4e24\u4e2a\u7528\u4e8e\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u547d\u4ee4\u7684\u6807\u51c6\u5e93\u51fd\u6570\u3002</p> </li> </ul> <p>\u603b\u662f\u4e0d\u8bb0\u5f97 <code>sprintf</code> \u548c <code>snprintf</code> \u8fd9\u79cd\u51fd\u6570\u4e4b\u7c7b\u7684\u7528\u6cd5</p> <p><code>sprintf</code> \u548c <code>snprintf</code> \u90fd\u662fC\u8bed\u8a00\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u5b57\u7b26\u4e32\u3002\u5b83\u4eec\u975e\u5e38\u76f8\u4f3c\uff0c\u4f46\u662f\u6709\u4e00\u4e9b\u5173\u952e\u7684\u533a\u522b\uff0c\u8fd9\u4e9b\u533a\u522b\u6d89\u53ca\u5230\u5b89\u5168\u6027\u548c\u529f\u80fd\u6027\u3002</p> <ul> <li>\u9664\u96f6\u7684\u786e\u5207\u884c\u4e3a</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#system","title":"system \u51fd\u6570","text":"<p><code>system</code> \u51fd\u6570\u5141\u8bb8\u4f60\u5728C\u7a0b\u5e8f\u4e2d\u6267\u884c\u4e00\u4e2ashell\u547d\u4ee4\u3002\u5b83\u7684\u539f\u578b\u5b9a\u4e49\u5728 <code>&lt;cstdlib&gt;</code> \u5934\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>int system(const char *command);\n</code></pre> <ul> <li>\u53c2\u6570: <code>command</code> \u662f\u4e00\u4e2a\u6307\u5411\u4ee5\u7a7a\u5b57\u7b26\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u5305\u542b\u4e86\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</li> <li>\u8fd4\u56de\u503c:</li> <li>\u5982\u679c\u547d\u4ee4\u6210\u529f\u6267\u884c\uff0c\u8fd4\u56de\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\u3002</li> <li>\u5982\u679c\u547d\u4ee4\u6267\u884c\u5931\u8d25\u6216\u8005 <code>system</code> \u51fd\u6570\u672a\u88ab\u6267\u884c\uff0c\u8fd4\u56de\u4e00\u4e2a\u8d1f\u6574\u6570\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#popen","title":"popen \u51fd\u6570","text":"<p><code>popen</code> \u51fd\u6570\u7528\u4e8e\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u5e76\u6253\u5f00\u4e00\u4e2a\u8fdb\u7a0b\u7ba1\u9053\uff0c\u5141\u8bb8\u4f60\u7684\u7a0b\u5e8f\u4e0e\u8be5\u547d\u4ee4\u7684\u8f93\u5165\u6216\u8f93\u51fa\u8fdb\u884c\u4ea4\u4e92\u3002\u5b83\u7684\u539f\u578b\u5b9a\u4e49\u5728 <code>&lt;cstdio&gt;</code> \u5934\u6587\u4ef6\u4e2d\uff1a</p> <pre><code>FILE *popen(const char *command, const char *type);\n</code></pre> <ul> <li>\u53c2\u6570:</li> <li><code>command</code> \u662f\u4e00\u4e2a\u6307\u5411\u4ee5\u7a7a\u5b57\u7b26\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u5305\u542b\u4e86\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</li> <li><code>type</code> \u6307\u5b9a\u4e86\u7ba1\u9053\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e24\u4e2a\u5b57\u7b26\u4e32\u4e4b\u4e00\uff1a<ul> <li><code>\"r\"</code>\uff1a\u4ee3\u8868\u7ba1\u9053\u7528\u4e8e\u8bfb\uff0c\u5373\u547d\u4ee4\u7684\u8f93\u51fa\u4f1a\u53d1\u9001\u7ed9\u4f60\u7684\u7a0b\u5e8f\u3002</li> <li><code>\"w\"</code>\uff1a\u4ee3\u8868\u7ba1\u9053\u7528\u4e8e\u5199\uff0c\u5373\u4f60\u53ef\u4ee5\u53d1\u9001\u8f93\u5165\u5230\u547d\u4ee4\u3002</li> </ul> </li> <li>\u8fd4\u56de\u503c:</li> <li>\u5982\u679c\u6210\u529f\u6253\u5f00\u7ba1\u9053\uff0c\u8fd4\u56de\u4e00\u4e2a <code>FILE</code> \u6307\u9488\uff0c\u53ef\u4ee5\u50cf\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6\u6587\u4ef6\u6d41\u4e00\u6837\u4f7f\u7528\u5b83\u3002</li> <li>\u5982\u679c\u6253\u5f00\u7ba1\u9053\u5931\u8d25\uff0c\u8fd4\u56de <code>NULL</code>\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_30","title":"\u793a\u4f8b","text":"<p>\u4f7f\u7528 <code>system</code> \u51fd\u6570\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>#include &lt;cstdlib&gt;\n\nint main() {\n    int status = system(\"ls -l\");\n    if (status == -1) {\n        perror(\"System command failed\");\n    }\n    return 0;\n}\n</code></pre> <p>\u4f7f\u7528 <code>popen</code> \u51fd\u6570\u6267\u884c\u547d\u4ee4\u5e76\u8bfb\u53d6\u8f93\u51fa\uff1a</p> <pre><code>#include &lt;cstdio&gt;\n#include &lt;cstring&gt;\n\nint main() {\n    FILE *fp;\n    char buffer[128];\n\n    fp = popen(\"ls -l\", \"r\");\n    if (fp == NULL) {\n        perror(\"popen\");\n        return 1;\n    }\n\n    while (fgets(buffer, 128, fp) != NULL) {\n        printf(\"%s\", buffer);\n    }\n\n    if (pclose(fp) == -1) {\n        perror(\"pclose\");\n        return 1;\n    }\n\n    return 0;\n}\n</code></pre>"},{"location":"ysyx/pa/pa1/pa1.html#_31","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li><code>system</code> \u548c <code>popen</code> \u51fd\u6570\u6267\u884c\u7684\u547d\u4ee4\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u7684shell\u73af\u5883\u3002</li> <li>\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5e26\u6765\u5b89\u5168\u98ce\u9669\uff0c\u7279\u522b\u662f\u5f53\u6267\u884c\u7684\u547d\u4ee4\u5305\u542b\u6216\u7531\u4e0d\u53ef\u4fe1\u7684\u8f93\u5165\u6784\u6210\u65f6\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u80fd\u4f1a\u88ab\u6076\u610f\u5229\u7528\u6765\u6267\u884c\u4efb\u610f\u547d\u4ee4\u3002</li> <li><code>popen</code> \u6253\u5f00\u7684\u7ba1\u9053\u5e94\u8be5\u5728\u5b8c\u6210\u8bfb\u5199\u64cd\u4f5c\u540e\u4f7f\u7528 <code>pclose</code> \u51fd\u6570\u5173\u95ed\u3002</li> <li>\u8fd9\u4e9b\u51fd\u6570\u7684\u884c\u4e3a\u53ef\u80fd\u56e0\u64cd\u4f5c\u7cfb\u7edf\u800c\u5f02\uff0c\u7279\u522b\u662f\u5728\u547d\u4ee4\u7684\u8bed\u6cd5\u548c\u53ef\u7528\u6027\u65b9\u9762\u3002</li> </ul> <p>\u5728\u7f16\u5199\u7cfb\u7edf\u7ea7\u7a0b\u5e8f\u65f6\uff0c\u5e94\u8be5\u8c28\u614e\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\uff0c\u5e76\u59cb\u7ec8\u5bf9\u7528\u6237\u8f93\u5165\u8fdb\u884c\u9a8c\u8bc1\u548c\u6e05\u7406\uff0c\u4ee5\u907f\u514d\u5b89\u5168\u6f0f\u6d1e\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#sprintf","title":"sprintf \u51fd\u6570","text":"<p>\u529f\u80fd\uff1a \u5c06\u683c\u5f0f\u5316\u7684\u6570\u636e\u5199\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002</p> <p>\u539f\u578b\uff1a <pre><code>int sprintf(char *str, const char *format, ...);\n</code></pre></p> <ul> <li><code>str</code>\uff1a\u6307\u5411\u8981\u5199\u5165\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\u3002</li> <li><code>format</code>\uff1a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u5b83\u544a\u8bc9 <code>sprintf</code> \u5982\u4f55\u89e3\u91ca\u540e\u7eed\u53c2\u6570\u5e76\u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002</li> <li><code>...</code>\uff1a\u53ef\u53d8\u53c2\u6570\u5217\u8868\uff0c\u5305\u542b\u8981\u683c\u5f0f\u5316\u7684\u6570\u636e\u3002</li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u5199\u5165\u5b57\u7b26\u7684\u6570\u91cf\uff0c\u4e0d\u5305\u62ec\u6700\u540e\u7684\u7a7a\u5b57\u7b26 <code>\\0</code>\u3002</p> <p>\u5b89\u5168\u6027\uff1a\u4e0d\u5b89\u5168\u3002\u5982\u679c\u76ee\u6807\u5b57\u7b26\u4e32 <code>str</code> \u4e0d\u591f\u5927\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u7f13\u51b2\u533a\u6ea2\u51fa\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#snprintf","title":"snprintf \u51fd\u6570","text":"<p>\u529f\u80fd\uff1a \u7c7b\u4f3c\u4e8e <code>sprintf</code>\uff0c\u4f46\u662f\u5141\u8bb8\u4f60\u6307\u5b9a\u76ee\u6807\u5b57\u7b26\u4e32\u7684\u6700\u5927\u957f\u5ea6\uff0c\u8fd9\u6709\u52a9\u4e8e\u9632\u6b62\u7f13\u51b2\u533a\u6ea2\u51fa\u3002</p> <p>\u539f\u578b\uff1a <pre><code>int snprintf(char *str, size_t size, const char *format, ...);\n</code></pre></p> <ul> <li><code>str</code>\uff1a\u6307\u5411\u8981\u5199\u5165\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\u3002</li> <li><code>size</code>\uff1a\u76ee\u6807\u5b57\u7b26\u4e32\u7684\u6700\u5927\u5b57\u8282\u6570\uff0c\u5305\u62ec\u6700\u540e\u7684\u7a7a\u5b57\u7b26 <code>\\0</code>\u3002</li> <li><code>format</code> \u548c <code>...</code>\uff1a\u4e0e <code>sprintf</code> \u76f8\u540c\u3002</li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u5199\u5165\u7684\u5b57\u7b26\u6570\u91cf\uff08\u4e0d\u5305\u62ec\u6700\u540e\u7684\u7a7a\u5b57\u7b26 <code>\\0</code>\uff09\uff0c\u5982\u679c\u8f93\u51fa\u88ab\u622a\u65ad\uff08\u5373\uff0c\u5982\u679c <code>size</code> \u662f\u592a\u5c0f\u800c\u65e0\u6cd5\u5305\u542b\u6240\u6709\u5b57\u7b26\uff09\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u5927\u4e8e\u6216\u7b49\u4e8e <code>size</code> \u7684\u503c\u3002</p> <p>\u5b89\u5168\u6027\uff1a\u66f4\u5b89\u5168\u3002<code>size</code> \u53c2\u6570\u786e\u4fdd\u4e86\u5373\u4f7f\u6e90\u5b57\u7b26\u4e32\u592a\u957f\uff0c\u4e5f\u4e0d\u4f1a\u8d85\u51fa\u76ee\u6807\u5b57\u7b26\u4e32\u7684\u8fb9\u754c\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_32","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"ysyx/pa/pa1/pa1.html#sprintf_1","title":"sprintf \u7684\u4f7f\u7528","text":"<pre><code>char buffer[100];\nsprintf(buffer, \"The value is: %d\", 42);\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u4f1a\u5c06\u5b57\u7b26\u4e32 \"The value is: 42\" \u5199\u5165 <code>buffer</code>\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#snprintf_1","title":"snprintf \u7684\u4f7f\u7528","text":"<pre><code>char buffer[100];\nsnprintf(buffer, sizeof(buffer), \"The value is: %d\", 42);\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u4e0e\u4e0a\u9762\u7684 <code>sprintf</code> \u793a\u4f8b\u76f8\u540c\uff0c\u4f46\u662f\u901a\u8fc7\u6307\u5b9a <code>sizeof(buffer)</code> \u6765\u907f\u514d\u7f13\u51b2\u533a\u6ea2\u51fa\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_33","title":"\u5982\u4f55\u8bb0\u4f4f","text":"<ul> <li>\u5f53\u4f60\u4e0d\u9700\u8981\u8003\u8651\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5e76\u4e14\u786e\u5b9a\u76ee\u6807\u5b57\u7b26\u4e32\u8db3\u591f\u5927\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>sprintf</code>\u3002</li> <li>\u5f53\u4f60\u60f3\u907f\u514d\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u98ce\u9669\u65f6\uff0c\u603b\u662f\u4f7f\u7528 <code>snprintf</code>\u3002</li> <li>\u8bb0\u4f4f <code>snprintf</code> \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>size</code> \u662f\u6574\u4e2a\u76ee\u6807\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u800c\u4e0d\u662f\u5269\u4f59\u7a7a\u95f4\u7684\u5927\u5c0f\u3002</li> </ul> <p>\u5728\u7f16\u5199\u5b89\u5168\u3001\u53ef\u9760\u7684\u4ee3\u7801\u65f6\uff0c\u4f18\u5148\u4f7f\u7528 <code>snprintf</code> \u662f\u4e00\u4e2a\u597d\u4e60\u60ef\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#token","title":"\u4f18\u5316token\u7684\u5b9e\u73b0","text":"<p>\u4fdd\u7559\u610f\u89c1\uff0c\u4e0d\u592a\u60f3</p> <pre><code>num {\n  TK_NOTYPE = 256,\n\n  TK_ADD = 0,\n  TK_SUB = 1,\n  TK_MUL = 2,\n  TK_DIV = 3,\n  TK_EQ = 4,\n  TK_NEQ = 5,\n  TK_LOGICAL_AND = 6,\n\n  TK_RIGHT_PAR = 7,\n  TK_LEFT_PAR = 8,\n\n  TK_NEG = 9,\n\n  /* TODO: merge thr TK_NUM and TK_HEX*/\n  TK_NUM = 10,\n  TK_HEX = 11,\n  TK_REG_NAME = 12,\n\n  TK_DEREF = 13,\n  /* TODO: Add more token types */\n};\n\nstatic struct rule {\n  const char *regex;\n  int token_type;\n  bool require_data;\n  void (*handler) (char *, int);\n} rules[] = {\n\n    /* TODO: Add more rules.\n     * Pay attention to the precedence level of different rules.\n     */\n\n    // \u5982\u4f55\u5b89\u6392\u8fd9\u4e9b\u89c4\u5219\u7684\u987a\u5e8f\uff0c\u662f\u4e2a\u95ee\u9898\n    // \u8fd0\u7b97\u7b26\u7684\u987a\u5e8f\u548c\u548c\u8fd9\u4e2a\u89c4\u5219\u987a\u5e8f\u5e94\u8be5\u4e0d\u592a\u4e00\u6837\u3002\n    {\" +\", TK_NOTYPE, false, NULL}, // spaces\n\n    {\"\\\\(\", TK_LEFT_PAR, false, handler_left_par},\n    {\"\\\\)\", TK_RIGHT_PAR, false, handler_right_par},\n\n    /**\n     * \u8fd9\u91cc\u7684\u89c4\u5219\u4f18\u5148\u7ea7\u662f\u4e0d\u662f\u4e5f\u662f\u9700\u8981\u6ce8\u610f\u4e0b\u7684? \n     * \u5982\u679cTK_NUM\u5728\u524d\u9762\uff0c\u4f1a\u5bfc\u81f40x\u88ab\u622a\u65ad\uff1f\n     * \u90a3\u8fd9\u6837\u4e0d\u4f1a\u4e5f\u5bfc\u81f4NUM\u7684\u4f18\u5148\u7ea7\u5730\u57dfHEX\uff1f\n     * \u8981\u4e0d\u7edf\u4e00\u4f7f\u7528NUM\uff0c\u4e4b\u540e\u518d\u533a\u5206\u662fHEX\u8fd8\u662fDEC\uff1f\n     */\n    /* hexadecimal number */\n    {\"0[xX][0-9a-fA-F]+\", TK_HEX, true, handler_hex},\n    // numbers (\u786e\u4fdd\u662f+\u53f7\uff0c\u8868\u793a\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u5b57)\n    {\"[0-9]+\", TK_NUM, true, handler_num},\n    // register name (\u786e\u4fdd\u5728\u6570\u5b57\u4e4b\u540e\uff0c\u8fd9\u6837\u6570\u5b57\u4e0d\u4f1a\u88ab\u5f53\u4f5c\u5355\u8bcd\u5339\u914d)\n    {\"\\\\$\\\\w+|\\\\w+\", TK_REG_NAME, true, handler_reg}, // \u6709\u4e0d\u662f$\u5f00\u5934\u7684\n\n    /* comparison operators */\n    {\"!=\", TK_NEQ, false, handler_neq},\n    {\"==\", TK_EQ}, false, handler_eq,\n\n    /* logical operator */\n    {\"&amp;&amp;\", TK_LOGICAL_AND, false, handler_logical_and},\n\n    {\"\\\\+\", TK_ADD, false, handler_add},    \n    {\"-\", TK_SUB, false, handler_sub},      // sub and neg\n    {\"\\\\*\", TK_MUL, false, handler_mul},    // mul and deref. \n    {\"/\", TK_DIV, false, handler_div},\n\n};\n\n#define NR_REGEX ARRLEN(rules)\n\nstatic regex_t re[NR_REGEX] = {};\n\nstatic int add_token(char *substr_start, int substr_len, int i);\nvoid string_2_num(int p, int q);\n\n/* Rules are used for many times.\n * Therefore we compile them only once before any usage.\n */\nvoid init_regex() {\n  int i;\n  char error_msg[128];\n  int ret;\n\n  for (i = 0; i &lt; NR_REGEX; i++) {\n    ret = regcomp(&amp;re[i], rules[i].regex, REG_EXTENDED);\n    if (ret != 0) {\n      regerror(ret, &amp;re[i], error_msg, 128);\n      panic(\"regex compilation failed: %s\\n%s\", error_msg, rules[i].regex);\n    }\n  }\n}\ntypedef struct token {\n  int type;\n  char str[128];\n  word_t num_value;\n} Token;\n\nstatic Token tokens[128] __attribute__((used)) = {};\nstatic int nr_token __attribute__((used)) = 0;\n\nstatic bool make_token(char *e) {\n  int position = 0;\n  int i;\n  regmatch_t pmatch;\n\n  nr_token = 0;\n\n  while (e[position] != '\\0') {\n    /* Try all rules one by one. */\n    for (i = 0; i &lt; NR_REGEX; i++) {\n      if (regexec(&amp;re[i], e + position, 1, &amp;pmatch, 0) == 0 &amp;&amp;\n          pmatch.rm_so == 0) {\n        char *substr_start = e + position;\n        int substr_len = pmatch.rm_eo;\n\n        Log(\"match rules[%d] = \\\"%s\\\" at position %d with len %d: %.*s\", i,\n            rules[i].regex, position, substr_len, substr_len, substr_start);\n\n        position += substr_len;\n\n        /* TODO: Now a new token is recognized with rules[i]. Add codes\n         * to record the token in the array `tokens'. For certain types\n         * of tokens, some extra actions should be performed.\n         */\n\n        i = add_token(substr_start, substr_len, i);\n        break;\n      }\n    }\n\n    if (i == NR_REGEX) {\n      printf(\"no match at position %d\\n%s\\n%*.s^\\n\", position, e, position, \"\");\n      return false;\n    }\n  }\n\n  return true;\n}\n\nstatic inline void handler_add(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_ADD;\n}\nstatic inline void handler_sub(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_SUB;\n}\nstatic inline void handler_mul(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_MUL;\n}\nstatic inline void handler_div(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_DIV;\n}\nstatic void handler_num(char *substr_start, int substr_len) {\n    tokens[nr_token].type = TK_NUM;\n    // \u600e\u4e48\u5224\u65ad\u4e00\u76f4\u5230\u6570\u5b57\uff1f\u76f4\u63a5\u5728\u8fd9\u4e2a token \u7684 substr_len \u5373\u53ef.\n    if (substr_len &gt; sizeof(tokens[nr_token].str) - 1) {\n        substr_len = sizeof(tokens[nr_token].str) - 1;\n    }\n\n    strncpy(tokens[nr_token].str, substr_start, substr_len);\n    tokens[nr_token].str[substr_len] = '\\0';\n    nr_token++;\n}\n\nstatic inline void handler_right_par(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_RIGHT_PAR;\n}\nstatic inline void handler_left_par(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_LEFT_PAR;\n}\nstatic void handler_hex(char *substr_start, int substr_len) {\n    tokens[nr_token].type = TK_HEX;\n    char *hex_start = substr_start + 2;\n    int hex_len = substr_len - 2;\n    if (hex_len &gt; sizeof(tokens[nr_token].str) - 1) {\n        hex_len = sizeof(tokens[nr_token].str) - 1;\n    }\n    strncpy(tokens[nr_token].str, hex_start, hex_len);\n    tokens[nr_token].str[hex_len] = '\\0';\n    nr_token++;\n\n}\nstatic void handler_reg(char *substr_start, int substr_len) {\n    tokens[nr_token].type = TK_REG_NAME;\n    strncpy(tokens[nr_token].str, substr_start, substr_len);\n    tokens[nr_token].str[substr_len] = '\\0';\n    nr_token++;\n}\nstatic inline void handler_eq(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_EQ;\n}\nstatic inline void handler_neq(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_NEQ;\n}\nstatic inline void handler_logical_and(char *substr_start, int substr_len) {\n    tokens[nr_token++].type = TK_LOGICAL_AND;\n}\n\n\nstatic int add_token(char *substr_start, int substr_len, int i) {\n    if (rules[i].handler != NULL &amp;&amp; rules[i].require_data) {\n        rules[i].handler(substr_start, substr_len); \n    } else if (rules[i].handler != NULL) {\n        rules[i].handler(NULL, 0);\n    }\n    return i;\n}\n</code></pre> <p>\u6709\u4e9btokne\u5c31\u53ea\u7528\u8bb0\u5f55\u7c7b\u578b\uff0c\u6709\u5c11\u6570\u5c31\u8981\u7528token\u7684str\u548cnum_value</p> <p>\u53ef\u4ee5\u4f18\u5316\u3002</p> <pre><code>#define NEEDS_STRING(type) ((type) == TK_NUM || (type) == TK_REG_NAME || /* \u5176\u4ed6\u9700\u8981\u5b57\u7b26\u4e32\u7684token\u7c7b\u578b */)\n\n// \u5728add_token\u51fd\u6570\u4e2d\u4f7f\u7528\u5b8f\nint add_token(char *substr_start, int substr_len, int i) {\n    tokens[nr_token].type = rules[i].token_type;\n    tokens[nr_token].num_value = 0; // \u521d\u59cb\u5316\u6570\u503c\n\n    if (NEEDS_STRING(rules[i].token_type)) {\n        // \u5982\u679ctoken\u7c7b\u578b\u9700\u8981\u5b57\u7b26\u4e32\uff0c\u5219\u590d\u5236\u5b83\n        if (substr_len &gt; sizeof(tokens[nr_token].str) - 1) {\n            substr_len = sizeof(tokens[nr_token].str) - 1;\n        }\n        strncpy(tokens[nr_token].str, substr_start, substr_len);\n        tokens[nr_token].str[substr_len] = '\\0';\n    }\n\n    nr_token++;\n    return i;\n}\n</code></pre>"},{"location":"ysyx/pa/pa1/pa1.html#_34","title":"\u76d1\u89c6\u70b9","text":""},{"location":"ysyx/pa/pa1/pa1.html#_35","title":"\u8865\u5145\u8868\u8fbe\u5f0f","text":"<p>\u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7</p> <p>C Operator Precedence - cppreference.com</p> <p></p>"},{"location":"ysyx/pa/pa1/pa1.html#_36","title":"\u5b9e\u73b0\u76d1\u89c6\u70b9","text":"<p>\u6c60\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u662f\u4ec0\u4e48\uff1f</p> <p><code>wp_pool</code> \u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u5bf9\u8c61\u6c60\uff08\u4e5f\u79f0\u4e3a\u5185\u5b58\u6c60\uff09\u3002\u5bf9\u8c61\u6c60\u662f\u4e00\u79cd\u5185\u5b58\u7ba1\u7406\u6280\u672f\uff0c\u7528\u4e8e\u9ad8\u6548\u5730\u5206\u914d\u548c\u91ca\u653e\u4e00\u7ec4\u56fa\u5b9a\u6570\u91cf\u7684\u5bf9\u8c61\u3002\u5728\u60a8\u7684\u793a\u4f8b\u4e2d\uff0c<code>wp_pool</code> \u662f\u4e00\u4e2a\u5305\u542b <code>NR_WP</code> \u4e2a <code>WP</code> \u7ed3\u6784\u4f53\u7684\u6570\u7ec4\uff0c\u6bcf\u4e2a\u7ed3\u6784\u4f53\u4ee3\u8868\u4e00\u4e2a\u76d1\u89c6\u70b9\u3002</p> <p>\u8fd9\u4e2a\u6c60\u901a\u8fc7\u4e24\u4e2a\u94fe\u8868 <code>head</code> \u548c <code>free_</code> \u6765\u7ba1\u7406\uff1a</p> <ul> <li> <p><code>head</code>\uff1a\u6307\u5411\u6b63\u5728\u4f7f\u7528\u7684\u76d1\u89c6\u70b9\u94fe\u8868\u7684\u5934\uff0c\u8868\u793a\u5df2\u7ecf\u88ab\u5206\u914d\u5e76\u6b63\u5728\u88ab\u7a0b\u5e8f\u4f7f\u7528\u7684\u76d1\u89c6\u70b9\u7ed3\u6784\u4f53\u3002</p> </li> <li> <p><code>free_</code>\uff1a\u6307\u5411\u7a7a\u95f2\u76d1\u89c6\u70b9\u94fe\u8868\u7684\u5934\uff0c\u8868\u793a\u5f53\u524d\u672a\u4f7f\u7528\u4e14\u53ef\u4ee5\u88ab\u5206\u914d\u7684\u76d1\u89c6\u70b9\u7ed3\u6784\u4f53\u3002</p> </li> </ul> <p>\u5f53\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u76d1\u89c6\u70b9\u65f6\uff0c\u53ef\u4ee5\u4ece <code>free_</code> \u94fe\u8868\u4e2d\u83b7\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684\u7ed3\u6784\u4f53\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 <code>head</code> \u94fe\u8868\u4e2d\u3002\u5f53\u76d1\u89c6\u70b9\u4e0d\u518d\u9700\u8981\u65f6\uff0c\u53ef\u4ee5\u4ece <code>head</code> \u94fe\u8868\u4e2d\u79fb\u9664\u5e76\u8fd4\u56de\u5230 <code>free_</code> \u94fe\u8868\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u590d\u7528\u3002</p> <p>\u4f7f\u7528\u5bf9\u8c61\u6c60\u7684\u597d\u5904\u5305\u62ec\uff1a</p> <ul> <li> <p>\u63d0\u9ad8\u6027\u80fd\uff1a\u51cf\u5c11\u52a8\u6001\u5185\u5b58\u5206\u914d\u548c\u91ca\u653e\u7684\u5f00\u9500\uff0c\u56e0\u4e3a\u5bf9\u8c61\u6c60\u9884\u5148\u5206\u914d\u4e86\u4e00\u5b9a\u6570\u91cf\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u907f\u514d\u5185\u5b58\u788e\u7247\uff1a\u7531\u4e8e\u5185\u5b58\u662f\u9884\u5148\u5206\u914d\u7684\uff0c\u8fd9\u6709\u52a9\u4e8e\u51cf\u5c11\u5185\u5b58\u788e\u7247\u5316\u3002</p> </li> <li> <p>\u56fa\u5b9a\u6570\u91cf\u7684\u5185\u5b58\u4f7f\u7528\uff1a\u5bf9\u8c61\u6c60\u9650\u5236\u4e86\u6700\u5927\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u6709\u52a9\u4e8e\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p> </li> </ul> <p>\u590d\u4e60</p> <p>\u6846\u67b6\u4ee3\u7801\u4e2d\u5b9a\u4e49<code>wp_pool</code>\u7b49\u53d8\u91cf\u7684\u65f6\u5019\u4f7f\u7528\u4e86\u5173\u952e\u5b57<code>static</code>, <code>static</code>\u5728\u6b64\u5904\u7684\u542b\u4e49\u662f\u4ec0\u4e48? \u4e3a\u4ec0\u4e48\u8981\u5728\u6b64\u5904\u4f7f\u7528\u5b83?</p> <p>\u5173\u952e\u5b57 <code>static</code> \u5728 C \u8bed\u8a00\u4e2d\u6709\u591a\u4e2a\u542b\u4e49\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5b83\u5728\u4ee3\u7801\u4e2d\u7684\u4f4d\u7f6e\u3002\u5728\u60a8\u63d0\u4f9b\u7684\u4ee3\u7801\u7247\u6bb5\u4e2d\uff1a</p> <pre><code>static WP wp_pool[NR_WP] = {};\nstatic WP *head = NULL, *free_ = NULL;\n</code></pre> <p><code>static</code> \u5173\u952e\u5b57\u7528\u4e8e\u58f0\u660e\u5168\u5c40\u53d8\u91cf <code>wp_pool</code>\u3001<code>head</code> \u548c <code>free_</code> \u4e3a\u9759\u6001\u53d8\u91cf\u3002\u8fd9\u91cc\u7684 \"\u9759\u6001\" \u610f\u5473\u7740\u8fd9\u4e9b\u53d8\u91cf\u7684\u751f\u547d\u5468\u671f\u662f\u6574\u4e2a\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u53ef\u89c1\u6027\u9650\u5236\u5728\u5b9a\u4e49\u5b83\u4eec\u7684\u6e90\u6587\u4ef6\u5185\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5176\u4ed6\u6e90\u6587\u4ef6\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u53d8\u91cf\uff0c\u9664\u975e\u901a\u8fc7\u51fd\u6570\u53c2\u6570\u3001\u8fd4\u56de\u503c\u6216\u6307\u9488\u4f20\u9012\u3002</p> <p>\u4f7f\u7528 <code>static</code> \u7684\u539f\u56e0\u53ef\u80fd\u5305\u62ec\uff1a</p> <ol> <li>\u5c01\u88c5\uff1a\u9650\u5236\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0c\u4f7f\u5f97\u5176\u4ed6\u6e90\u6587\u4ef6\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u53d8\u91cf\uff0c\u4ece\u800c\u9690\u85cf\u5b9e\u73b0\u7ec6\u8282\uff0c\u9632\u6b62\u5916\u90e8\u76f4\u63a5\u4fee\u6539\u3002</li> <li>\u907f\u514d\u547d\u540d\u51b2\u7a81\uff1a\u5728\u5927\u578b\u9879\u76ee\u4e2d\uff0c\u4e0d\u540c\u6e90\u6587\u4ef6\u53ef\u80fd\u4f1a\u6709\u76f8\u540c\u540d\u79f0\u7684\u53d8\u91cf\u3002\u4f7f\u7528 <code>static</code> \u53ef\u4ee5\u907f\u514d\u8fd9\u4e9b\u5168\u5c40\u53d8\u91cf\u5728\u7a0b\u5e8f\u7684\u5176\u4ed6\u90e8\u5206\u53d1\u751f\u547d\u540d\u51b2\u7a81\u3002</li> <li>\u8d44\u6e90\u7ba1\u7406\uff1a\u5728\u60a8\u7684\u793a\u4f8b\u4e2d\uff0c<code>wp_pool</code> \u662f\u4e00\u4e2a\u9759\u6001\u5206\u914d\u7684\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u76d1\u89c6\u70b9\uff08Watchpoint\uff09\u7ed3\u6784\u4f53\u7684\u6c60\u3002\u4f7f\u7528\u9759\u6001\u5206\u914d\u610f\u5473\u7740\u8fd9\u4e9b\u7ed3\u6784\u4f53\u5728\u7a0b\u5e8f\u5f00\u59cb\u8fd0\u884c\u65f6\u5c31\u5df2\u7ecf\u5206\u914d\u4e86\u5185\u5b58\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u4e0e\u7a0b\u5e8f\u4e00\u81f4\u3002 </li> </ol> <ul> <li> <p>\u5f53\u7528\u6237\u7ed9\u51fa\u4e00\u4e2a\u5f85\u76d1\u89c6\u8868\u8fbe\u5f0f\u65f6, \u4f60\u9700\u8981\u901a\u8fc7<code>new_wp()</code>\u7533\u8bf7\u4e00\u4e2a\u7a7a\u95f2\u7684\u76d1\u89c6\u70b9\u7ed3\u6784, \u5e76\u5c06\u8868\u8fbe\u5f0f\u8bb0\u5f55\u4e0b\u6765. </p> </li> <li> <p>\u7136\u540e\u5728<code>trace_and_difftest()</code>\u51fd\u6570(\u5728<code>nemu/src/cpu/cpu-exec.c</code>\u4e2d\u5b9a\u4e49)\u7684\u6700\u540e\u626b\u63cf\u6240\u6709\u7684\u76d1\u89c6\u70b9, \u6bcf\u5f53<code>cpu_exec()</code>\u7684\u5faa\u73af\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4, \u90fd\u4f1a\u8c03\u7528\u4e00\u6b21<code>trace_and_difftest()</code>\u51fd\u6570. </p> <p>\u5728\u626b\u63cf\u76d1\u89c6\u70b9\u7684\u8fc7\u7a0b\u4e2d, \u4f60\u9700\u8981\u5bf9\u76d1\u89c6\u70b9\u7684\u76f8\u5e94\u8868\u8fbe\u5f0f\u8fdb\u884c\u6c42\u503c(\u4f60\u4e4b\u524d\u5df2\u7ecf\u5b9e\u73b0\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u529f\u80fd\u4e86), \u5e76\u6bd4\u8f83\u5b83\u4eec\u7684\u503c\u6709\u6ca1\u6709\u53d1\u751f\u53d8\u5316, \u82e5\u53d1\u751f\u4e86\u53d8\u5316, \u7a0b\u5e8f\u5c31\u56e0\u89e6\u53d1\u4e86\u76d1\u89c6\u70b9\u800c\u6682\u505c\u4e0b\u6765, \u4f60\u9700\u8981\u5c06<code>nemu_state.state</code>\u53d8\u91cf\u8bbe\u7f6e\u4e3a<code>NEMU_STOP</code>\u6765\u8fbe\u5230\u6682\u505c\u7684\u6548\u679c. </p> <p>\u6700\u540e\u8f93\u51fa\u4e00\u53e5\u8bdd\u63d0\u793a\u7528\u6237\u89e6\u53d1\u4e86\u76d1\u89c6\u70b9, \u5e76\u8fd4\u56de\u5230<code>sdb_mainloop()</code>\u5faa\u73af\u4e2d\u7b49\u5f85\u7528\u6237\u7684\u547d\u4ee4.</p> </li> <li> <p>\u4f7f\u7528<code>info w</code>\u547d\u4ee4\u6765\u6253\u5370\u4f7f\u7528\u4e2d\u7684\u76d1\u89c6\u70b9\u4fe1\u606f, \u81f3\u4e8e\u8981\u6253\u5370\u4ec0\u4e48, \u4f60\u53ef\u4ee5\u53c2\u8003GDB\u4e2d<code>info watchpoints</code>\u7684\u8fd0\u884c\u7ed3\u679c.</p> </li> <li> <p>\u4f7f\u7528<code>d</code>\u547d\u4ee4\u6765\u5220\u9664\u76d1\u89c6\u70b9, \u4f60\u53ea\u9700\u8981\u91ca\u653e\u76f8\u5e94\u7684\u76d1\u89c6\u70b9\u7ed3\u6784\u5373\u53ef.</p> </li> </ul> <p>\u683c\u5f0f\uff1a</p> <p></p> <p></p> <p></p> <p>\u89e6\u53d1\u4e4b\u540e\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e94\u8be5\u76f4\u5230\u8fd9\u4e2a\u53d8\u91cf\u88ab\u4f18\u5316\u3002</p> <p></p> <p>\u5220\u9664\u4e4b\u540e\u5e94\u8be5\u5728\u5e8f\u53f7\u4e4b\u540e\u7ee7\u7eed\u6dfb\u52a0\uff0c\u6bd4\u5982\u5220\u9664\u4e862\u76d1\u89c6\u7684i\u53d8\u91cf\uff0c\u4e4b\u540e\u518d\u6b21\u76d1\u89c6i\uff0c\u662f\u4ece5\u5f00\u59cb\u3002</p> <p>\u8fd8\u6709\uff0c\u6392\u5e8f\u987a\u5e8f\u4ece\u4f4e\u5230\u9ad8\u3002</p> <p>\u5173\u4e8e\u5b9e\u73b0\u7684\u9009\u62e9\uff1a</p> <p>\u4f7f\u7528\u5934\u63d2\u6cd5\u548c\u5c3e\u63d2\u6cd5\uff08\u5728\u4f60\u7684\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u6b63\u5728\u4f7f\u7528\u7684\u94fe\u8868\u4e2d\u63d2\u5165\u6216\u5220\u9664\u8282\u70b9\uff09\u5404\u6709\u4f18\u52a3\uff0c\u8fd9\u53d6\u51b3\u4e8e\u4f60\u7684\u5177\u4f53\u5e94\u7528\u573a\u666f\u548c\u6027\u80fd\u8981\u6c42\u3002\u4e0b\u9762\u662f\u4e24\u79cd\u65b9\u6cd5\u7684\u4f18\u52a3\u5bf9\u6bd4\uff1a</p> <p>\u57fa\u672c\u5b9e\u73b0\u529f\u80fd\uff0c\u4feebug\u3002</p> <p>\u590d\u4e60</p> <p>\u5173\u4e8e <code>strlen</code> \u548c <code>sizeof</code> \u7684\u8fdb\u4e00\u6b65\u533a\u522b</p> <ul> <li> <p><code>strlen</code></p> <p>\u4e00\u4e2a\u6807\u51c6\u5e93\u51fd\u6570\uff0c\u7528\u4e8e\u8ba1\u7b97\u4e00\u4e2a\u4ee5\u7a7a\u5b57\u7b26\uff08'\\0'\uff09\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u3002\u4e0d\u5305\u62ec\u7a7a\u5b57\u7b26</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n    char str[] = \"Hello, World!\";\n    printf(\"Length of str: %zu\\n\", strlen(str));\n    return 0;\n}\n</code></pre> <pre><code>Length of str: 13\n</code></pre> </li> <li> <p><code>sizeof</code></p> <p>\u4e00\u4e2a\u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e\u8ba1\u7b97\u5bf9\u8c61\u3001\u6570\u7ec4\u3001\u7c7b\u578b\u6240\u5360\u7684\u603b\u5b57\u8282\u6570\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09</p> <pre><code>int arr[10];\nprintf(\"Size of arr: %zu\\n\", sizeof(arr));\n                                                                                                \nint i;\nprintf(\"Size of int: %zu\\n\", sizeof(i));\n                                                                                                \nchar *ptr = \"Hello, World!\";\nprintf(\"Size of ptr: %zu\\n\", sizeof(ptr));\n</code></pre> <pre><code>40 4 8\n</code></pre> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_37","title":"\u5934\u63d2\u6cd5\uff08\u5728\u94fe\u8868\u5934\u90e8\u63d2\u5165\u8282\u70b9\uff09","text":"<p>\u4f18\u70b9\uff1a 1. \u5feb\u901f\u63d2\u5165\uff1a\u65b0\u8282\u70b9\u603b\u662f\u88ab\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd9\u4f7f\u5f97\u63d2\u5165\u64cd\u4f5c\u975e\u5e38\u5feb\u901f\uff0c\u56e0\u4e3a\u53ea\u9700\u8981\u4fee\u6539\u4e24\u4e2a\u6307\u9488\uff08\u65b0\u8282\u70b9\u7684<code>next</code>\u548c\u94fe\u8868\u7684\u5934\u6307\u9488\uff09\u3002 2. \u65e0\u9700\u904d\u5386\uff1a\u5206\u914d\u548c\u91ca\u653e\u8282\u70b9\u65f6\u4e0d\u9700\u8981\u904d\u5386\u94fe\u8868\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u5934\u90e8\u64cd\u4f5c\u3002</p> <p>\u7f3a\u70b9\uff1a 1. \u987a\u5e8f\u95ee\u9898\uff1a\u9891\u7e41\u7684\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u53ef\u80fd\u5bfc\u81f4\u94fe\u8868\u7684\u5143\u7d20\u987a\u5e8f\u4e0e\u5b83\u4eec\u88ab\u5206\u914d\u7684\u987a\u5e8f\u76f8\u53cd\uff0c\u8fd9\u5728\u67d0\u4e9b\u9700\u8981\u4fdd\u6301\u7279\u5b9a\u987a\u5e8f\u7684\u5e94\u7528\u4e2d\u53ef\u80fd\u662f\u4e2a\u95ee\u9898\u3002 2. \u5185\u5b58\u5c40\u90e8\u6027\uff1a\u7531\u4e8e\u94fe\u8868\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u88ab\u5206\u6563\u5230\u5185\u5b58\u7684\u4e0d\u540c\u4f4d\u7f6e\uff0c\u8fd9\u53ef\u80fd\u4f1a\u964d\u4f4e\u5185\u5b58\u8bbf\u95ee\u7684\u5c40\u90e8\u6027\uff0c\u5f71\u54cd\u6027\u80fd\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_38","title":"\u5c3e\u63d2\u6cd5\uff08\u5728\u94fe\u8868\u5c3e\u90e8\u63d2\u5165\u8282\u70b9\uff09","text":"<p>\u4f18\u70b9\uff1a 1. \u987a\u5e8f\u4fdd\u6301\uff1a\u5982\u679c\u8282\u70b9\u7684\u5206\u914d\u548c\u91ca\u653e\u9075\u5faa\u7279\u5b9a\u7684\u987a\u5e8f\uff08\u5982\u5148\u8fdb\u5148\u51fa\uff0cFIFO\uff09\uff0c\u5c3e\u63d2\u6cd5\u53ef\u4ee5\u4fdd\u6301\u8fd9\u4e2a\u987a\u5e8f\u3002 2. \u5185\u5b58\u5c40\u90e8\u6027\uff1a\u65b0\u5206\u914d\u7684\u8282\u70b9\u66f4\u6709\u53ef\u80fd\u4e0e\u94fe\u8868\u7684\u5176\u4ed6\u8282\u70b9\u5728\u5185\u5b58\u4e2d\u4f4d\u7f6e\u63a5\u8fd1\uff0c\u8fd9\u53ef\u4ee5\u63d0\u9ad8\u5185\u5b58\u8bbf\u95ee\u7684\u5c40\u90e8\u6027\u3002</p> <p>\u7f3a\u70b9\uff1a 1. \u63d2\u5165\u901f\u5ea6\uff1a\u63d2\u5165\u65b0\u8282\u70b9\u5230\u94fe\u8868\u5c3e\u90e8\u53ef\u80fd\u9700\u8981\u904d\u5386\u6574\u4e2a\u94fe\u8868\uff0c\u8fd9\u5728\u94fe\u8868\u8f83\u957f\u65f6\u4f1a\u5f71\u54cd\u6027\u80fd\u3002 2. \u590d\u6742\u5ea6\uff1a\u91ca\u653e\u8282\u70b9\u65f6\u53ef\u80fd\u9700\u8981\u5728\u94fe\u8868\u4e2d\u627e\u5230\u7279\u5b9a\u7684\u8282\u70b9\u5e76\u66f4\u65b0\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488\uff0c\u8fd9\u589e\u52a0\u4e86\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_39","title":"\u6c60\u7ed3\u6784\u7684\u8003\u8651","text":"<p>\u5728\u4f60\u63d0\u4f9b\u7684\u4ee3\u7801\u4e2d\uff0c\u4f7f\u7528\u4e86\u6c60\uff08pool\uff09\u6765\u7ba1\u7406\u4e00\u7ec4\u56fa\u5b9a\u6570\u91cf\u7684\u76d1\u89c6\u70b9\uff08watchpoints\uff09\u3002\u8fd9\u79cd\u8bbe\u8ba1\u901a\u5e38\u7528\u4e8e\u4f18\u5316\u5185\u5b58\u5206\u914d\uff0c\u51cf\u5c11\u5185\u5b58\u788e\u7247\uff0c\u5e76\u63d0\u9ad8\u5206\u914d\u548c\u91ca\u653e\u64cd\u4f5c\u7684\u901f\u5ea6\u3002\u5728\u8fd9\u79cd\u7ed3\u6784\u4e2d\uff0c\u5934\u63d2\u6cd5\u548c\u5c3e\u63d2\u6cd5\u7684\u9009\u62e9\u4e3b\u8981\u53d6\u51b3\u4e8e\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li>\u5206\u914d\u548c\u91ca\u653e\u7684\u9891\u7387\uff1a\u5982\u679c\u9891\u7e41\u8fdb\u884c\u5206\u914d\u548c\u91ca\u653e\uff0c\u5934\u63d2\u6cd5\u53ef\u80fd\u66f4\u4f18\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u66f4\u5feb\u7684\u63d2\u5165\u901f\u5ea6\u3002</li> <li>\u987a\u5e8f\u7684\u91cd\u8981\u6027\uff1a\u5982\u679c\u76d1\u89c6\u70b9\u7684\u4f7f\u7528\u987a\u5e8f\u5bf9\u7a0b\u5e8f\u903b\u8f91\u5f88\u91cd\u8981\uff0c\u90a3\u4e48\u53ef\u80fd\u9700\u8981\u8003\u8651\u4fdd\u6301\u8fd9\u4e2a\u987a\u5e8f\u3002</li> <li>\u5185\u5b58\u8bbf\u95ee\u6a21\u5f0f\uff1a\u5982\u679c\u7a0b\u5e8f\u80fd\u591f\u4ece\u5185\u5b58\u5c40\u90e8\u6027\u4e2d\u53d7\u76ca\uff0c\u90a3\u4e48\u5c3e\u63d2\u6cd5\u53ef\u80fd\u66f4\u4f18\u3002</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_40","title":"\u7ed3\u8bba","text":"<p>\u5728\u4f60\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u76d1\u89c6\u70b9\u7684\u5206\u914d\u548c\u91ca\u653e\u64cd\u4f5c\u975e\u5e38\u9891\u7e41\uff0c\u5e76\u4e14\u987a\u5e8f\u4e0d\u662f\u5173\u952e\u56e0\u7d20\uff0c\u90a3\u4e48\u5934\u63d2\u6cd5\u53ef\u80fd\u662f\u66f4\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u63d0\u4f9b\u66f4\u5feb\u7684\u5206\u914d\u548c\u91ca\u653e\u901f\u5ea6\u3002\u7136\u800c\uff0c\u5982\u679c\u4f60\u9700\u8981\u4fdd\u6301\u76d1\u89c6\u70b9\u7684\u7279\u5b9a\u987a\u5e8f\uff0c\u6216\u8005\u4f60\u7684\u7a0b\u5e8f\u80fd\u591f\u4ece\u66f4\u597d\u7684\u5185\u5b58\u5c40\u90e8\u6027\u4e2d\u53d7\u76ca\uff0c\u90a3\u4e48\u5c3e\u63d2\u6cd5\u53ef\u80fd\u66f4\u9002\u5408\u3002</p> <p>\u6700\u540e\uff0c\u5b9e\u9645\u9009\u62e9\u54ea\u79cd\u65b9\u6cd5\u5e94\u8be5\u57fa\u4e8e\u4f60\u7684\u5177\u4f53\u9700\u6c42\u548c\u6027\u80fd\u6d4b\u8bd5\u7684\u7ed3\u679c\u3002\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u5bf9\u4e24\u79cd\u65b9\u6cd5\u90fd\u8fdb\u884c\u6d4b\u8bd5\uff0c\u4ee5\u786e\u5b9a\u54ea\u79cd\u65b9\u6cd5\u5728\u4f60\u7684\u7279\u5b9a\u573a\u666f\u4e0b\u8868\u73b0\u66f4\u597d\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_41","title":"\u8c03\u8bd5\u5de5\u5177\u4e0e\u539f\u7406","text":"<ul> <li>Fault: \u5b9e\u73b0\u9519\u8bef\u7684\u4ee3\u7801, \u4f8b\u5982<code>if (p = NULL)</code></li> <li>Error: \u7a0b\u5e8f\u6267\u884c\u65f6\u4e0d\u7b26\u5408\u9884\u671f\u7684\u72b6\u6001, \u4f8b\u5982<code>p</code>\u88ab\u9519\u8bef\u5730\u8d4b\u503c\u6210<code>NULL</code></li> <li>Failure: \u80fd\u76f4\u63a5\u89c2\u6d4b\u5230\u7684\u9519\u8bef, \u4f8b\u5982\u7a0b\u5e8f\u89e6\u53d1\u4e86\u6bb5\u9519\u8bef</li> </ul> <p>\u8c03\u8bd5\u5176\u5b9e\u5c31\u662f\u4ece\u89c2\u6d4b\u5230\u7684failure\u4e00\u6b65\u4e00\u6b65\u56de\u6eaf\u5bfb\u627efault\u7684\u8fc7\u7a0b, \u627e\u5230\u4e86fault\u4e4b\u540e, \u6211\u4eec\u5c31\u5f88\u5feb\u77e5\u9053\u5e94\u8be5\u5982\u4f55\u4fee\u6539\u9519\u8bef\u7684\u4ee3\u7801\u4e86. \u4f46\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u770b\u51fa, \u8c03\u8bd5\u4e4b\u6240\u4ee5\u4e0d\u5bb9\u6613, \u6070\u6070\u662f\u56e0\u4e3a:</p> <ul> <li>fault\u4e0d\u4e00\u5b9a\u9a6c\u4e0a\u89e6\u53d1error</li> <li>\u89e6\u53d1\u4e86error\u4e5f\u4e0d\u4e00\u5b9a\u9a6c\u4e0a\u8f6c\u53d8\u6210\u53ef\u89c2\u6d4b\u7684failure</li> <li>error\u4f1a\u50cf\u6eda\u96ea\u7403\u4e00\u822c\u8d8a\u79ef\u8d8a\u591a, \u5f53\u6211\u4eec\u89c2\u6d4b\u5230failure\u7684\u65f6\u5019, \u5176\u5b9e\u5df2\u7ecf\u8ddd\u79bbfault\u975e\u5e38\u9065\u8fdc\u4e86</li> </ul> <p>\u7406\u89e3\u4e86\u8fd9\u4e9b\u539f\u56e0\u4e4b\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u5236\u5b9a\u76f8\u5e94\u7684\u7b56\u7565\u4e86:</p> <ul> <li>\u5c3d\u53ef\u80fd\u628afault\u8f6c\u53d8\u6210error. </li> </ul> <p>\u4f60\u4f1a\u5982\u4f55\u6d4b\u8bd5\u4f60\u7684\u76d1\u89c6\u70b9\u5b9e\u73b0?</p> <p>\u6211\u4eec\u6ca1\u6709\u63d0\u4f9b\u76d1\u89c6\u70b9\u76f8\u5173\u7684\u6d4b\u8bd5, \u601d\u8003\u4e00\u4e0b, \u4f60\u4f1a\u5982\u4f55\u6d4b\u8bd5?</p> <p>\u5f53\u7136, \u5bf9\u4e8e\u5b9e\u9a8c\u6765\u8bf4, \u5c06\u6765\u8fb9\u7528\u8fb9\u6d4b\u4e5f\u662f\u4e00\u79cd\u8bf4\u5f97\u8fc7\u53bb\u7684\u65b9\u6cd5, \u5c31\u770b\u4f60\u5bf9\u81ea\u5df1\u4ee3\u7801\u7684\u4fe1\u5fc3\u4e86.</p> <p>GPT</p> <p>\u6709\u7528\u7684\u64cd\u4f5c</p> <ul> <li> <p>\u5c3d\u65e9\u89c2\u6d4b\u5230error\u7684\u5b58\u5728. </p> <p>\u89c2\u6d4b\u5230error\u7684\u65f6\u673a\u76f4\u63a5\u51b3\u5b9a\u4e86\u8c03\u8bd5\u7684\u96be\u5ea6: \u5982\u679c\u7b49\u5230\u89e6\u53d1failure\u7684\u65f6\u5019\u624d\u53d1\u73b0error\u7684\u5b58\u5728, \u8c03\u8bd5\u5c31\u4f1a\u6bd4\u8f83\u56f0\u96be; </p> <p>\u4f46\u5982\u679c\u80fd\u5728error\u521a\u521a\u89e6\u53d1\u7684\u65f6\u5019\u5c31\u89c2\u6d4b\u5230\u5b83, \u8c03\u8bd5\u96be\u5ea6\u4e5f\u5c31\u5927\u5927\u964d\u4f4e\u4e86. \u4e8b\u5b9e\u4e0a, \u4f60\u5df2\u7ecf\u89c1\u8bc6\u8fc7\u4e00\u4e9b\u6709\u7528\u7684\u5de5\u5177\u4e86:</p> <ul> <li> <p><code>-Wall</code>, <code>-Werror</code>: \u5728\u7f16\u8bd1\u65f6\u523b\u628a\u6f5c\u5728\u7684fault\u76f4\u63a5\u8f6c\u53d8\u6210failure. </p> <p>\u8fd9\u79cd\u5de5\u5177\u7684\u4f5c\u7528\u5f88\u6709\u9650, \u53ea\u80fd\u5bfb\u627e\u4e00\u4e9b\u5728\u7f16\u8bd1\u65f6\u523b\u4e5f\u89c9\u5f97\u53ef\u7591\u7684fault, \u4f8b\u5982<code>if (p = NULL)</code>. \u4e0d\u8fc7\u968f\u7740\u7f16\u8bd1\u5668\u7248\u672c\u7684\u589e\u5f3a, \u7f16\u8bd1\u5668\u4e5f\u80fd\u53d1\u73b0\u4ee3\u7801\u4e2d\u7684\u4e00\u4e9b\u672a\u5b9a\u4e49\u884c\u4e3a\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00. \u8fd9\u4e9b\u90fd\u662f\u514d\u8d39\u7684\u5348\u9910, \u4e0d\u5403\u5c31\u771f\u7684\u767d\u767d\u6d6a\u8d39\u4e86.</p> <p>-Wall\uff1a\u5f00\u542f\u6240\u6709\u8b66\u544a\uff0c\u53ef\u4ee5\u907f\u514d\u7f16\u8bd1\u5668\u81ea\u52a8\u9002\u5e94\u4e00\u4e9b\u770b\u4e0d\u89c1\u7684\u9519\u8bef\u3002</p> <p>-Werror\uff1a\u5c06\u8b66\u544a\u4f5c\u4e3a\u9519\u8bef</p> </li> <li> <p><code>assert()</code>: \u5728\u8fd0\u884c\u65f6\u523b\u628aerror\u76f4\u63a5\u8f6c\u53d8\u6210failure.</p> <p><code>assert()</code>\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u5374\u53c8\u975e\u5e38\u5f3a\u5927\u7684\u5de5\u5177, \u53ea\u8981\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u597d\u7a0b\u5e8f\u5e94\u8be5\u6ee1\u8db3\u7684\u7279\u5f81, \u5c31\u4e00\u5b9a\u80fd\u5728\u8fd0\u884c\u65f6\u523b\u5c06\u4e0d\u6ee1\u8db3\u8fd9\u4e9b\u7279\u5f81\u7684error\u62e6\u622a\u4e0b\u6765. \u4f8b\u5982\u94fe\u8868\u7684\u5b9e\u73b0, \u6211\u4eec\u53ea\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u63d2\u5165\u4e00\u4e9b\u5f88\u7b80\u5355\u7684<code>assert()</code>(\u4f8b\u5982\u6307\u9488\u89e3\u5f15\u7528\u65f6\u4e0d\u4e3a\u7a7a), \u5c31\u80fd\u591f\u51e0\u4e4e\u544a\u522b\u6bb5\u9519\u8bef. \u4f46\u662f, \u7f16\u5199\u8fd9\u4e9b<code>assert()</code>\u5176\u5b9e\u9700\u8981\u6211\u4eec\u5bf9\u7a0b\u5e8f\u7684\u884c\u4e3a\u6709\u4e00\u5b9a\u7684\u4e86\u89e3, \u540c\u65f6\u5728\u7a0b\u5e8f\u7279\u5f81\u4e0d\u6613\u8868\u8fbe\u7684\u65f6\u5019, <code>assert()</code>\u7684\u4f5c\u7528\u4e5f\u8f83\u4e3a\u6709\u9650.</p> </li> <li> <p><code>printf()</code>: \u901a\u8fc7\u8f93\u51fa\u7684\u65b9\u5f0f\u89c2\u5bdf\u6f5c\u5728\u7684error.</p> <p>\u8fd9\u662f\u7528\u4e8e\u56de\u6eaffault\u65f6\u6700\u5e38\u7528\u7684\u5de5\u5177, \u7528\u4e8e\u89c2\u6d4b\u7a0b\u5e8f\u4e2d\u7684\u53d8\u91cf\u662f\u5426\u8fdb\u5165\u4e86\u9519\u8bef\u7684\u72b6\u6001. \u5728NEMU\u4e2d\u6211\u4eec\u63d0\u4f9b\u4e86\u8f93\u51fa\u66f4\u591a\u8c03\u8bd5\u4fe1\u606f\u7684\u5b8f<code>Log()</code>, \u5b83\u5b9e\u9645\u4e0a\u5c01\u88c5\u4e86<code>printf()</code>\u7684\u529f\u80fd. \u4f46\u7531\u4e8e<code>printf()</code>\u9700\u8981\u6839\u636e\u8f93\u51fa\u7684\u7ed3\u679c\u4eba\u5de5\u5224\u65ad\u662f\u5426\u6b63\u786e, \u5728\u4fbf\u5229\u7a0b\u5ea6\u4e0a\u76f8\u5bf9\u4e8e<code>assert()</code>\u7684\u81ea\u52a8\u5224\u65ad\u5c31\u900a\u8272\u4e86\u4e0d\u5c11.</p> </li> <li> <p>GDB: \u968f\u65f6\u968f\u5730\u89c2\u6d4b\u7a0b\u5e8f\u7684\u4efb\u4f55\u72b6\u6001.</p> <p>3\u8c03\u8bd5\u5668\u662f\u6700\u5f3a\u5927\u7684\u5de5\u5177, \u4f46\u4f60\u9700\u8981\u5728\u7a0b\u5e8f\u884c\u4e3a\u7684\u832b\u832b\u5927\u6d77\u4e2d\u89c2\u6d4b\u90a3\u4e9b\u53ef\u7591\u7684\u72b6\u6001, \u56e0\u6b64\u4f7f\u7528\u8d77\u6765\u7684\u4ee3\u4ef7\u4e5f\u662f\u6700\u5927\u7684.</p> </li> </ul> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_42","title":"\u8fdb\u4e00\u6b65\u9632\u5fa1\u6027\u7f16\u7a0b","text":"<ul> <li> <p>\u591a\u4f7f\u7528assert()</p> </li> <li> <p>\u7ec3\u4e6027\uff1a\u521b\u9020\u6027\u548c\u9632\u5fa1\u6027\u7f16\u7a0b-\u7b28\u529e\u6cd5\u5b66C(Learn C The Hard Way) (cntofu.com)</p> </li> <li> <p>sanitizer - \u4e00\u79cd\u5e95\u5c42\u7684assert</p> <p>\u6bb5\u9519\u8bef\u4e00\u822c\u662f\u7531\u4e8e\u975e\u6cd5\u8bbf\u5b58\u9020\u6210\u7684, \u4e00\u79cd\u7b80\u5355\u7684\u60f3\u6cd5\u662f, \u5982\u679c\u6211\u4eec\u80fd\u5728\u6bcf\u4e00\u6b21\u8bbf\u5b58\u4e4b\u524d\u90fd\u7528<code>assert()</code>\u68c0\u67e5\u4e00\u4e0b\u5730\u5740\u662f\u5426\u8d8a\u754c, \u5c31\u53ef\u4ee5\u5728\u6bb5\u9519\u8bef\u53d1\u751f\u4e4b\u524d\u6355\u6349\u5230error\u4e86!</p> <p>\u867d\u7136\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee, \u4f46\u8fd9\u6837\u7684\u4ee3\u7801\u5728\u9879\u76ee\u4e2d\u6709\u5f88\u591a, \u5982\u679c\u8981\u6211\u4eec\u624b\u52a8\u5728\u8fd9\u4e9b\u8bbf\u95ee\u4e4b\u524d\u6dfb\u52a0<code>assert()</code>, \u5c31\u592a\u9ebb\u70e6\u4e86. </p> <p>\u4e8b\u5b9e\u4e0a, \u6700\u9002\u5408\u505a\u8fd9\u4ef6\u4e8b\u60c5\u7684\u662f\u7f16\u8bd1\u5668, \u56e0\u4e3a\u5b83\u80fd\u77e5\u9053\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee\u90fd\u5728\u54ea\u91cc. </p> <p>\u800c\u8ba9\u7f16\u8bd1\u5668\u652f\u6301\u8fd9\u4e2a\u529f\u80fd\u7684\u662f\u4e00\u4e2a\u53eb<code>Address Sanitizer</code>\u7684\u5de5\u5177, \u5b83\u53ef\u4ee5\u81ea\u52a8\u5730\u5728\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee\u4e4b\u524d\u63d2\u5165\u7528\u6765\u68c0\u67e5\u662f\u5426\u8d8a\u754c\u7684\u4ee3\u7801. GCC\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>-fsanitize=address</code>\u7684\u7f16\u8bd1\u9009\u9879\u6765\u542f\u7528\u5b83. menuconfig\u5df2\u7ecf\u4e3a\u5927\u5bb6\u51c6\u5907\u597d\u76f8\u5e94\u9009\u9879\u4e86, \u4f60\u53ea\u9700\u8981\u6253\u5f00\u5b83:</p> <pre><code>Build Options\n  [*] Enable address sanitizer\n</code></pre> <p>\u7136\u540e\u6e05\u9664\u7f16\u8bd1\u7ed3\u679c\u5e76\u91cd\u65b0\u7f16\u8bd1\u5373\u53ef.</p> <p>\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u6545\u610f\u89e6\u53d1\u4e00\u4e2a\u6bb5\u9519\u8bef, \u7136\u540e\u9605\u8bfb\u4e00\u4e0bAddress Sanitizer\u7684\u62a5\u9519\u4fe1\u606f. </p> <p>\u4e0d\u8fc7\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u7a0b\u5e8f\u7684\u6027\u80fd\u6709\u6240\u4e0b\u964d, \u8fd9\u662f\u56e0\u4e3a\u5bf9\u6bcf\u4e00\u6b21\u8bbf\u5b58\u8fdb\u884c\u68c0\u67e5\u4f1a\u5e26\u6765\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500. \u4f46\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u5e2e\u52a9\u4f60\u8bca\u65adbug\u7684\u5de5\u5177, \u4ed8\u51fa\u8fd9\u4e00\u70b9\u4ee3\u4ef7\u8fd8\u662f\u5f88\u503c\u5f97\u7684, \u800c\u4e14\u4f60\u8fd8\u662f\u53ef\u4ee5\u5728\u65e0\u9700\u8c03\u8bd5\u7684\u65f6\u5019\u5c06\u5176\u5173\u95ed.</p> <p>\u8fd9\u4e9b\u5de5\u5177\u90fd\u4f1a\u5f71\u54cd\u6027\u80fd\u7684\u3002\u6240\u4ee5\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u4e00\u822c\u4e0d\u7528\u662f\u5417\uff1f</p> <p>\u4e8b\u5b9e\u4e0a, \u9664\u4e86\u5730\u5740\u8d8a\u754c\u7684\u9519\u8bef\u4e4b\u5916, Address Sanitizer\u8fd8\u80fd\u68c0\u67e5use-after-free\u7684\u9519\u8bef (\u5373\"\u91ca\u653e\u4ece\u5806\u533a\u7533\u8bf7\u7684\u7a7a\u95f4\u540e\u4ecd\u7136\u7ee7\u7eed\u4f7f\u7528\"\u7684\u9519\u8bef), \u4f60\u77e5\u9053\u5b83\u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e00\u529f\u80fd\u7684\u5417?</p> </li> <li> <p>summary</p> <ul> <li>\u603b\u662f\u4f7f\u7528<code>-Wall</code>\u548c<code>-Werror</code></li> <li>\u5c3d\u53ef\u80fd\u591a\u5730\u5728\u4ee3\u7801\u4e2d\u63d2\u5165<code>assert()</code></li> <li>\u8c03\u8bd5\u65f6\u5148\u542f\u7528sanitizer</li> <li><code>assert()</code>\u65e0\u6cd5\u6355\u6349\u5230error\u65f6, \u901a\u8fc7<code>printf()</code>\u8f93\u51fa\u53ef\u7591\u7684\u53d8\u91cf, \u671f\u671b\u80fd\u89c2\u6d4b\u5230error</li> <li><code>printf()</code>\u4e0d\u6613\u89c2\u6d4berror\u65f6, \u901a\u8fc7GDB\u7406\u89e3\u7a0b\u5e8f\u7684\u7cbe\u786e\u884c\u4e3a</li> </ul> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_43","title":"\u65ad\u70b9","text":"<p>\u65ad\u70b9\u7684\u529f\u80fd\u662f\u8ba9\u7a0b\u5e8f\u6682\u505c\u4e0b\u6765, \u4ece\u800c\u65b9\u4fbf\u67e5\u770b\u7a0b\u5e8f\u67d0\u4e00\u65f6\u523b\u7684\u72b6\u6001. \u4e8b\u5b9e\u4e0a, \u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u7528\u76d1\u89c6\u70b9\u6765\u6a21\u62df\u65ad\u70b9\u7684\u529f\u80fd:</p> <pre><code>w $pc == ADDR\n</code></pre> <p>\u5176\u4e2d<code>ADDR</code>\u4e3a\u8bbe\u7f6e\u65ad\u70b9\u7684\u5730\u5740. \u8fd9\u6837\u7a0b\u5e8f\u6267\u884c\u5230<code>ADDR</code>\u7684\u4f4d\u7f6e\u65f6\u5c31\u4f1a\u6682\u505c\u4e0b\u6765.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_44","title":"\u5982\u4f55\u9605\u8bfb\u624b\u518c","text":""},{"location":"ysyx/pa/pa1/pa1.html#_45","title":"\u5fc5\u7b54\u9898","text":"<p>\u4f60\u9700\u8981\u5728\u5b9e\u9a8c\u62a5\u544a\u4e2d\u56de\u7b54\u4e0b\u5217\u95ee\u9898:</p> <ul> <li> <p>\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a \u753b\u51fa\u8ba1\u7b97<code>1+2+...+100</code>\u7684\u7a0b\u5e8f\u7684\u72b6\u6001\u673a, \u5177\u4f53\u8bf7\u53c2\u8003\u8fd9\u91cc.</p> </li> <li> <p>\u7406\u89e3\u57fa\u7840\u8bbe\u65bd \u6211\u4eec\u901a\u8fc7\u4e00\u4e9b\u7b80\u5355\u7684\u8ba1\u7b97\u6765\u4f53\u4f1a\u7b80\u6613\u8c03\u8bd5\u5668\u7684\u4f5c\u7528. \u9996\u5148\u4f5c\u4ee5\u4e0b\u5047\u8bbe:</p> <ul> <li>\u5047\u8bbe\u4f60\u9700\u8981\u7f16\u8bd1500\u6b21NEMU\u624d\u80fd\u5b8c\u6210PA.</li> <li>\u5047\u8bbe\u8fd9500\u6b21\u7f16\u8bd1\u5f53\u4e2d, \u670990%\u7684\u6b21\u6570\u662f\u7528\u4e8e\u8c03\u8bd5.</li> <li>\u5047\u8bbe\u4f60\u6ca1\u6709\u5b9e\u73b0\u7b80\u6613\u8c03\u8bd5\u5668, \u53ea\u80fd\u901a\u8fc7GDB\u5bf9\u8fd0\u884c\u5728NEMU\u4e0a\u7684\u5ba2\u6237\u7a0b\u5e8f\u8fdb\u884c\u8c03\u8bd5. \u5728\u6bcf\u4e00\u6b21\u8c03\u8bd5\u4e2d, \u7531\u4e8eGDB\u4e0d\u80fd\u76f4\u63a5\u89c2\u6d4b\u5ba2\u6237\u7a0b\u5e8f, \u4f60\u9700\u8981\u82b1\u8d3930\u79d2\u7684\u65f6\u95f4\u6765\u4eceGDB\u4e2d\u83b7\u53d6\u5e76\u5206\u6790\u4e00\u4e2a\u4fe1\u606f.</li> <li>\u5047\u8bbe\u4f60\u9700\u8981\u83b7\u53d6\u5e76\u5206\u679020\u4e2a\u4fe1\u606f\u624d\u80fd\u6392\u9664\u4e00\u4e2abug.</li> </ul> <p>\u90a3\u4e48\u8fd9\u4e2a\u5b66\u671f\u4e0b\u6765, \u4f60\u5c06\u4f1a\u5728\u8c03\u8bd5\u4e0a\u82b1\u8d39\u591a\u5c11\u65f6\u95f4?</p> <p>\u7531\u4e8e\u7b80\u6613\u8c03\u8bd5\u5668\u53ef\u4ee5\u76f4\u63a5\u89c2\u6d4b\u5ba2\u6237\u7a0b\u5e8f, \u5047\u8bbe\u901a\u8fc7\u7b80\u6613\u8c03\u8bd5\u5668\u53ea\u9700\u8981\u82b1\u8d3910\u79d2\u7684\u65f6\u95f4\u4ece\u4e2d\u83b7\u53d6\u5e76\u5206\u6790\u76f8\u540c\u7684\u4fe1\u606f. \u90a3\u4e48\u8fd9\u4e2a\u5b66\u671f\u4e0b\u6765, \u7b80\u6613\u8c03\u8bd5\u5668\u53ef\u4ee5\u5e2e\u52a9\u4f60\u8282\u7701\u591a\u5c11\u8c03\u8bd5\u7684\u65f6\u95f4?</p> <p>\u4e8b\u5b9e\u4e0a, \u8fd9\u4e9b\u6570\u5b57\u4e5f\u8bb8\u8fd8\u662f\u6709\u70b9\u4e50\u89c2, \u4f8b\u5982\u5c31\u7b97\u4f7f\u7528GDB\u6765\u76f4\u63a5\u8c03\u8bd5\u5ba2\u6237\u7a0b\u5e8f, \u8fd9\u4e9b\u6570\u5b57\u5047\u8bbe\u4f60\u80fd\u901a\u8fc710\u5206\u949f\u7684\u65f6\u95f4\u6392\u9664\u4e00\u4e2abug. \u5982\u679c\u5b9e\u9645\u4e0a\u4f60\u9700\u8981\u5728\u8c03\u8bd5\u8fc7\u7a0b\u4e2d\u83b7\u53d6\u5e76\u5206\u6790\u66f4\u591a\u7684\u4fe1\u606f, \u7b80\u6613\u8c03\u8bd5\u5668\u8fd9\u4e00\u57fa\u7840\u8bbe\u65bd\u80fd\u5e26\u6765\u7684\u597d\u5904\u5c31\u66f4\u5927.</p> </li> <li> <p>RTFM \u7406\u89e3\u4e86\u79d1\u5b66\u67e5\u9605\u624b\u518c\u7684\u65b9\u6cd5\u4e4b\u540e, \u8bf7\u4f60\u5c1d\u8bd5\u5728\u4f60\u9009\u62e9\u7684ISA\u624b\u518c\u4e2d\u67e5\u9605\u4ee5\u4e0b\u95ee\u9898\u6240\u5728\u7684\u4f4d\u7f6e, \u628a\u9700\u8981\u9605\u8bfb\u7684\u8303\u56f4\u5199\u5230\u4f60\u7684\u5b9e\u9a8c\u62a5\u544a\u91cc\u9762:</p> <ul> <li>x86<ul> <li>EFLAGS\u5bc4\u5b58\u5668\u4e2d\u7684CF\u4f4d\u662f\u4ec0\u4e48\u610f\u601d?</li> <li>ModR/M\u5b57\u8282\u662f\u4ec0\u4e48?</li> <li>mov\u6307\u4ee4\u7684\u5177\u4f53\u683c\u5f0f\u662f\u600e\u4e48\u6837\u7684?</li> </ul> </li> <li>mips32<ul> <li>mips32\u6709\u54ea\u51e0\u79cd\u6307\u4ee4\u683c\u5f0f?</li> <li>CP0\u5bc4\u5b58\u5668\u662f\u4ec0\u4e48?</li> <li>\u82e5\u9664\u6cd5\u6307\u4ee4\u7684\u9664\u6570\u4e3a0, \u7ed3\u679c\u4f1a\u600e\u6837?</li> </ul> </li> <li>riscv32<ul> <li>riscv32\u6709\u54ea\u51e0\u79cd\u6307\u4ee4\u683c\u5f0f?</li> <li>LUI\u6307\u4ee4\u7684\u884c\u4e3a\u662f\u4ec0\u4e48?</li> <li>mstatus\u5bc4\u5b58\u5668\u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684?</li> </ul> </li> </ul> </li> <li> <p>shell\u547d\u4ee4 \u5b8c\u6210PA1\u7684\u5185\u5bb9\u4e4b\u540e, <code>nemu/</code>\u76ee\u5f55\u4e0b\u7684\u6240\u6709.c\u548c.h\u548c\u6587\u4ef6\u603b\u5171\u6709\u591a\u5c11\u884c\u4ee3\u7801? \u4f60\u662f\u4f7f\u7528\u4ec0\u4e48\u547d\u4ee4\u5f97\u5230\u8fd9\u4e2a\u7ed3\u679c\u7684? \u548c\u6846\u67b6\u4ee3\u7801\u76f8\u6bd4, \u4f60\u5728PA1\u4e2d\u7f16\u5199\u4e86\u591a\u5c11\u884c\u4ee3\u7801? (Hint: \u76ee\u524d<code>pa0</code>\u5206\u652f\u4e2d\u8bb0\u5f55\u7684\u6b63\u597d\u662f\u505aPA1\u4e4b\u524d\u7684\u72b6\u6001, \u601d\u8003\u4e00\u4e0b\u5e94\u8be5\u5982\u4f55\u56de\u5230\"\u8fc7\u53bb\"?) \u4f60\u53ef\u4ee5\u628a\u8fd9\u6761\u547d\u4ee4\u5199\u5165<code>Makefile</code>\u4e2d, \u968f\u7740\u5b9e\u9a8c\u8fdb\u5ea6\u7684\u63a8\u8fdb, \u4f60\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u7edf\u8ba1\u5de5\u7a0b\u7684\u4ee3\u7801\u884c\u6570, \u4f8b\u5982\u6572\u5165<code>make count</code>\u5c31\u4f1a\u81ea\u52a8\u8fd0\u884c\u7edf\u8ba1\u4ee3\u7801\u884c\u6570\u7684\u547d\u4ee4. \u518d\u6765\u4e2a\u96be\u4e00\u70b9\u7684, \u9664\u53bb\u7a7a\u884c\u4e4b\u5916, <code>nemu/</code>\u76ee\u5f55\u4e0b\u7684\u6240\u6709<code>.c</code>\u548c<code>.h</code>\u6587\u4ef6\u603b\u5171\u6709\u591a\u5c11\u884c\u4ee3\u7801?</p> </li> <li> <p>RTFM \u6253\u5f00<code>nemu/scripters/build.mk</code>\u6587\u4ef6, \u4f60\u4f1a\u5728<code>CFLAGS</code>\u53d8\u91cf\u4e2d\u770b\u5230gcc\u7684\u4e00\u4e9b\u7f16\u8bd1\u9009\u9879. \u8bf7\u89e3\u91cagcc\u4e2d\u7684<code>-Wall</code>\u548c<code>-Werror</code>\u6709\u4ec0\u4e48\u4f5c\u7528? \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528<code>-Wall</code>\u548c<code>-Werror</code>?</p> </li> </ul> <ul> <li> <p>1</p> <p>\u524d\u9762</p> </li> <li> <p>2</p> <p>500*0.9 = 450 \u6b21\u8c03\u8bd5</p> <p>30s \u4e00\u4e2a\u4fe1\u606f\uff0c20\u4e2a\u4fe1\u606f\u4fee\u4e00\u4e2abug     600s 10min\u4fee\u4e00\u4e2abug</p> <p>\u5047\u5982\u6709100\u4e2abug 100 * 10 =1000min  = 16h 40min</p> <p>\u6709\u4e86\u7b80\u6613\u8c03\u8bd5\u5668</p> <p>10s  * 20 = 200s \u4fee\u4e00\u4e2abug </p> <p>100bug   100 *200 = 20000s = 5.5h\u3002\u3002\u3002\u4fee\u5b8c \u5dee\u522b\u8fd8\u662f\u8d85\u7ea7\u5927\u7684\u3002(</p> </li> <li> <p>3</p> <ul> <li> <p>riscv32\u6709\u54ea\u51e0\u79cd\u6307\u4ee4\u683c\u5f0f?</p> <p></p> </li> <li> <p>LUI\u6307\u4ee4\u7684\u884c\u4e3a\u662f\u4ec0\u4e48?</p> <p></p> <p>RISC-V \u6307\u4ee4\u96c6\u67b6\u6784\u4e2d\u7684 <code>lui</code> \u548c <code>auipc</code> \u6307\u4ee4\u5982\u4e0b\uff1a</p> <ol> <li> <p><code>lui</code> \u6307\u4ee4\uff08Load Upper Immediate\uff09\u7528\u4e8e\u5c06\u4e00\u4e2a 20 \u4f4d\u7684\u7acb\u5373\u6570\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u7684\u9ad8 20 \u4f4d\uff0c\u4f4e 12 \u4f4d\u88ab\u8bbe\u7f6e\u4e3a 0\u3002\u8fd9\u4e2a\u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u751f\u6210\u4e00\u4e2a 32 \u4f4d\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u4e0e\u5176\u4ed6\u6307\u4ee4\uff08\u5982 <code>addi</code> \u6216 <code>ori</code>\uff09\u7ed3\u5408\u4f7f\u7528\u6765\u5f62\u6210\u5b8c\u6574\u7684 32 \u4f4d\u7acb\u5373\u6570\u3002</p> <p>\u56e0\u4e3a <code>addi</code> \u5e26\u4e8612\u4f4d\u7684\u7acb\u5373\u6570</p> </li> <li> <p><code>auipc</code> \u6307\u4ee4\uff08Add Upper Immediate to PC\uff09\u5c06\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u7684\u5f53\u524d\u503c\u4e0e\u4e00\u4e2a 20 \u4f4d\u7684\u7acb\u5373\u6570\u76f8\u52a0\uff0c\u5e76\u5c06\u7ed3\u679c\u653e\u7f6e\u5728\u76ee\u6807\u5bc4\u5b58\u5668\u4e2d\u3002\u8fd9\u4e2a\u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u751f\u6210 PC \u76f8\u5bf9\u7684\u5730\u5740\uff0c\u5b83\u5c06\u7acb\u5373\u6570\u5de6\u79fb 12 \u4f4d\u540e\u52a0\u5230 PC \u4e0a\uff0c\u4ee5\u6b64\u6765\u521b\u5efa\u4e00\u4e2a\u6307\u5411\u7a0b\u5e8f\u5185\u5176\u4ed6\u4f4d\u7f6e\u7684\u5730\u5740\u3002</p> </li> </ol> <p>\u8fd9\u4e9b\u6307\u4ee4\u5728 RISC-V \u67b6\u6784\u4e2d\u7528\u4e8e\u5730\u5740\u8ba1\u7b97\u548c\u8df3\u8f6c\uff0c\u662f\u6784\u9020\u590d\u6742\u63a7\u5236\u6d41\u7ed3\u6784\u7684\u57fa\u7840\u3002</p> <p>\u5173\u4e8e RISC-V \u6307\u4ee4\u96c6\u7684\u624b\u518c\uff0c\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u8d44\u6e90\uff1a</p> <ol> <li>RISC-V \u6307\u4ee4\u96c6\u67b6\u6784\u7684\u5b98\u65b9\u6587\u6863\uff0c\u53ef\u4ee5\u5728 RISC-V \u57fa\u91d1\u4f1a\u7684\u5b98\u65b9\u7f51\u7ad9\u627e\u5230\uff1aRISC-V Foundation</li> <li>\u7531 Andrew Waterman, Yunsup Lee, David Patterson, Krste Asanovi\u0107 \u7b49\u4eba\u7f16\u5199\u7684 RISC-V \u7528\u6237\u7ea7\u6307\u4ee4\u96c6\u4f53\u7cfb\u7ed3\u6784\u6587\u6863\uff0c\u8fd9\u662f\u63cf\u8ff0 RISC-V \u7528\u6237\u7ea7\u4f53\u7cfb\u7ed3\u6784\u7684\u6743\u5a01\u6587\u6863\u3002\u6587\u6863\u53ef\u4ee5\u5728 UC Berkeley \u7684\u6280\u672f\u62a5\u544a\u4e2d\u627e\u5230\uff0c\u6216\u8005\u5728\u4e00\u4e9b\u6280\u672f\u793e\u533a\u7f51\u7ad9\u4e0a\u641c\u7d22\u76f8\u5173\u8d44\u6e90\u3002</li> <li>GitHub \u4e0a\u4e5f\u6709 RISC-V \u6307\u4ee4\u96c6\u624b\u518c\u7684\u4e2d\u6587\u7ffb\u8bd1\u7248\u672c\uff0c\u7531\u4e2d\u56fd\u79d1\u5b66\u9662\u5927\u5b66\u7684\u5218\u7545\u7b49\u4eba\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728\u4ee5\u4e0b\u94fe\u63a5\u627e\u5230\uff1aRISC-V ISA Manual CN</li> </ol> <p>\u6b64\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5728\u7ebf\u8d44\u6e90\u548c\u4e66\u7c4d\u63d0\u4f9b\u4e86\u5173\u4e8e RISC-V \u6307\u4ee4\u96c6\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u8003\uff1a</p> <ul> <li>RISC-V \u6307\u4ee4\u96c6\u624b\u518c\uff08\u5377\u4e00\uff09\u7684 GitBook \u9875\u9762\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e86 RISC-V ISA \u7684\u6982\u8ff0\u548c\u5176\u4ed6\u76f8\u5173\u4fe1\u606f\u3002</li> <li>RISC-V \u6307\u4ee4\u96c6\u624b\u518c\u7684\u5b98\u65b9 PDF \u7248\u672c\uff0c\u8fd9\u662f\u7531 RISC-V \u793e\u533a\u7ef4\u62a4\u7684\u624b\u518c\u3002 </li> </ul> </li> <li> <p>mstatus\u5bc4\u5b58\u5668\u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684?</p> <p></p> <p><code>mstatus</code> \u5bc4\u5b58\u5668\u8868\u793aM\u6a21\u5f0f\u4e0b\u7684\u5904\u7406\u5668\u72b6\u6001\u3002</p> </li> </ul> </li> <li> <p>4</p> <pre><code>find ./ -name \"*.c\" -o -name \"*.h\" | xargs cat | wc l \n</code></pre> <p>\u9996\u5148\u7528 <code>find</code> \u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u7d22\u6587\u4ef6\uff0c\u901a\u8fc7 <code>-name</code> <code>-o</code> \u6307\u5b9a \u641c\u7d22\u65b9\u5f0f\uff1b</p> <p><code>-o</code> \uff1a\u8868\u793a \u6216\u8005</p> <p>\u7136\u540e\u5c06\u641c\u7d22\u7ed3\u679c\u901a\u8fc7\u7ba1\u9053 <code>|</code>  \u4f20\u9012\u7ed9 <code>xargs</code> \uff1b</p> <p><code>xargs</code> \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5c06\u6807\u51c6\u8f93\u5165\uff08stdin\uff09\u6570\u636e\u8f6c\u6362\u6210\u547d\u4ee4\u884c\u53c2\u6570\u3002</p> <p>\u7136\u540e <code>xargs</code> \u4e4b\u524d\u8f93\u5165\u8fdb\u6765\u7684\u6587\u4ef6\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 <code>cat</code> \u547d\u4ee4\uff1b</p> <p>\u7136\u540e <code>cat</code> \u5c06\u591a\u4e2a\u6587\u4ef6\u62fc\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u5355\u4e00\u8f93\u51fa\u6d41\uff1b</p> <p>\u7136\u540e\u518d\u901a\u8fc7\u7ba1\u9053\u4f20\u9012\u7ed9 <code>wc -l</code></p> <ul> <li><code>wc</code> \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u8ba1\u7b97\u5b57\u6570\u3001\u884c\u6570\u3001\u5b57\u7b26\u6570\u7b49\u3002</li> <li><code>-l</code> \u662f <code>wc</code> \u7684\u4e00\u4e2a\u9009\u9879\uff0c\u7528\u4e8e\u8ba1\u7b97\u884c\u6570\u3002</li> </ul> <p>\u73b0\u5728\u8fd8\u8981\u8fc7\u6ee4\u7a7a\u683c\uff1a</p> <p>\u7528grep\uff1f\u8fd9\u4e2a\u6211\u8bb0\u5f97\u597d\u50cf\u662f\u7528\u4e8e\u641c\u7d22\u6587\u672c\u6587\u4ef6\u5e76\u663e\u793a\u5339\u914d\u7684\u884c\uff1f</p> <ol> <li>find\uff1a</li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u7d22\u6587\u4ef6\u3002\u53ef\u4ee5\u6839\u636e\u6587\u4ef6\u540d\u3001\u5927\u5c0f\u3001\u6743\u9650\u3001\u6240\u6709\u8005\u3001\u521b\u5efa\u65e5\u671f\u7b49\u591a\u79cd\u5c5e\u6027\u6765\u67e5\u627e\u6587\u4ef6\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>find</code> \u547d\u4ee4\u662f\u6587\u4ef6\u641c\u7d22\u5de5\u5177\uff0c\u4e0d\u76f4\u63a5\u7528\u4e8e\u6587\u672c\u5185\u5bb9\u7684\u641c\u7d22\u6216\u5904\u7406\u3002</p> </li> <li> <p>grep\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u641c\u7d22\u6587\u672c\u6587\u4ef6\u5185\u5bb9\u4e2d\u5339\u914d\u7279\u5b9a\u6a21\u5f0f\u7684\u884c\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>grep</code> \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u53ef\u4ee5\u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22\u6587\u672c\u5185\u5bb9\uff0c\u5e76\u4e14\u53ef\u4ee5\u9012\u5f52\u5730\u641c\u7d22\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002</p> </li> <li> <p>sed\uff08Stream Editor\uff09\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u5bf9\u6587\u672c\u8fdb\u884c\u8fc7\u6ee4\u548c\u66ff\u6362\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>sed</code> \u53ef\u4ee5\u6267\u884c\u57fa\u672c\u7684\u6587\u672c\u5904\u7406\u4efb\u52a1\uff0c\u5982\u5220\u9664\u3001\u66ff\u6362\u3001\u63d2\u5165\u6587\u672c\u884c\u7b49\u3002\u5b83\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5339\u914d\u6587\u672c\u3002</p> </li> <li> <p>awk\uff1a</p> </li> <li>\u7528\u9014\uff1a\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u6587\u672c\u5206\u6790\u5de5\u5177\uff0c\u7528\u4e8e\u5904\u7406\u7ed3\u6784\u5316\u6587\u672c\u6570\u636e\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>awk</code> \u7279\u522b\u9002\u5408\u5904\u7406\u5217\u6570\u636e\uff0c\u5982CSV\u6587\u4ef6\u3002\u5b83\u652f\u6301\u590d\u6742\u7684\u6587\u672c\u6a21\u5f0f\u5339\u914d\u548c\u6587\u672c\u64cd\u4f5c\u3002</p> </li> <li> <p>sort\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u5bf9\u6587\u672c\u6587\u4ef6\u4e2d\u7684\u884c\u8fdb\u884c\u6392\u5e8f\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>sort</code> \u53ef\u4ee5\u5c06\u6587\u672c\u6587\u4ef6\u7684\u884c\u6392\u5e8f\uff0c\u652f\u6301\u6570\u5b57\u548c\u5b57\u5178\u987a\u5e8f\u6392\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u6587\u4ef6\u4e2d\u7684\u7279\u5b9a\u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\u3002</p> </li> <li> <p>uniq\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u8fc7\u6ee4\u6587\u4ef6\u4e2d\u7684\u91cd\u590d\u884c\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>uniq</code> \u901a\u5e38\u4e0e <code>sort</code> \u547d\u4ee4\u4e00\u8d77\u4f7f\u7528\uff0c\u7528\u4e8e\u4ece\u6392\u5e8f\u540e\u7684\u6587\u4ef6\u4e2d\u5220\u9664\u91cd\u590d\u7684\u884c\u3002</p> </li> <li> <p>cut\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u4ece\u6bcf\u884c\u6587\u672c\u4e2d\u63d0\u53d6\u90e8\u5206\u6587\u672c\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>cut</code> \u53ef\u4ee5\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u6216\u5b57\u7b26\u4f4d\u7f6e\u6765\u63d0\u53d6\u6587\u672c\u3002</p> </li> <li> <p>tr\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u5220\u9664\u3001\u538b\u7f29\u6216\u8f6c\u6362\u6587\u4ef6\u4e2d\u7684\u5b57\u7b26\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>tr</code> \u53ef\u4ee5\u7528\u4e8e\u7b80\u5355\u7684\u5b57\u7b26\u66ff\u6362\u4efb\u52a1\u3002</p> </li> <li> <p>diff\uff1a</p> </li> <li>\u7528\u9014\uff1a\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6587\u4ef6\u7684\u5dee\u5f02\u3002</li> <li> <p>\u7279\u70b9\uff1a<code>diff</code> \u53ef\u4ee5\u663e\u793a\u4e24\u4e2a\u6587\u4ef6\u5185\u5bb9\u7684\u4e0d\u540c\u4e4b\u5904\uff0c\u5e38\u7528\u4e8e\u7248\u672c\u63a7\u5236\u3002</p> </li> <li> <p>tail \u548c head\uff1a</p> <ul> <li>\u7528\u9014\uff1a<code>tail</code> \u7528\u4e8e\u663e\u793a\u6587\u4ef6\u7684\u6700\u540e\u51e0\u884c\uff0c\u800c <code>head</code> \u7528\u4e8e\u663e\u793a\u6587\u4ef6\u7684\u524d\u51e0\u884c\u3002</li> <li>\u7279\u70b9\uff1a\u8fd9\u4e9b\u547d\u4ee4\u901a\u5e38\u7528\u4e8e\u5feb\u901f\u67e5\u770b\u6587\u4ef6\u5185\u5bb9\u3002</li> </ul> </li> </ol> <p>\u8fd9\u4e9b\u5de5\u5177\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ba1\u9053\uff08<code>|</code>\uff09\u7ec4\u5408\u4f7f\u7528\uff0c\u4ee5\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u6587\u672c\u5904\u7406\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>grep</code> \u6765\u641c\u7d22\u6587\u672c\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u901a\u8fc7\u7ba1\u9053\u4f20\u9012\u7ed9 <code>sort</code> \u8fdb\u884c\u6392\u5e8f\uff0c\u518d\u4f20\u9012\u7ed9 <code>uniq</code> \u6765\u5220\u9664\u91cd\u590d\u884c\u3002\u8fd9\u79cd\u7ec4\u5408\u4f7f\u7528\u662fLinux\u547d\u4ee4\u884c\u7684\u5f3a\u5927\u4e4b\u5904\u3002</p> <p>\u7528 <code>grep</code> \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\u8fc7\u6ee4\u7a7a\u884c\uff0c\u90a3\u80fd\u4e0d\u80fd\u5c06\u4e0a\u9762\u7684\u67e5\u627e <code>.c .h</code> \u7684\u529f\u80fd\u5148\u5c01\u88c5\u6210\u4e00\u4e2a\u529f\u80fd\u3002</p> <p>GPT\uff1a</p> <p>\u7efc\u4e0a\uff0c\u5199\u5165 Makefile \u91cc\uff1a</p> <pre><code>find $(NEMU_HOME) -name \"*.c\" -o -name \"*.h\" | xargs grep -v -e '^$$' | wc -l\n</code></pre> </li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_46","title":"\u601d\u8003\u9898","text":""},{"location":"ysyx/pa/pa1/pa1.html#_47","title":"\u601d\u8003\u9898\u4e00","text":"<p>\u4e00\u4e2a\u7a0b\u5e8f\u4ece\u54ea\u91cc\u5f00\u59cb\u6267\u884c\u5462?</p> <p>\u611f\u89c9\u662f\u4e2a\u8de8\u5ea6\u5f88\u5927\u7684\u95ee\u9898\u3002</p> <ul> <li> <p>\u4ece\u7cfb\u7edf\u4e00\u70b9\u7684\u89d2\u5ea6\u6765\u770b\uff1a</p> <p>\u6211\u81ea\u5df1\u7684\u7406\u89e3\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u5199\u4ee3\u7801\u65f6\uff0c\u90fd\u9ed8\u8ba4\u7a0b\u5e8f <code>main</code> \u51fd\u6570\u5f00\u59cb\u6267\u884c\uff0c\u4f46\u662f\u8fd9\u53ea\u662f\u5bf9\u4e8e\u4e00\u4e2a\u4e0a\u5c42\u7a0b\u5e8f\u5458\u6216\u8005\u8bf4\u521d\u5b66\u8005\u6765\u8bf4\u662f\u8fd9\u6837\u7684\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u7a0b\u5e8f\u5728\u6267\u884c\u4e4b\u524d\u505a\u4e86\u5f88\u591a\u7684\u51c6\u5907\uff0c\u6bd4\u5982\u7f16\u8bd1\u5668\u4e3a\u4f60\u505a\u597d\u4e86\u5c06\u9ad8\u7ea7\u8bed\u8a00\u7ffb\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u7684\u5de5\u4f5c\uff08\u5404\u79cd\u8bcd\u6cd5\u5206\u6790\uff0c\u8bed\u6cd5\u5206\u6790\uff0c\u8bed\u4e49\u5206\u6790\u7b49\u7b49\uff09\uff0c\u7b80\u5355\u5206\u914d\u4e86\u51e0\u4e2a\u6bb5\uff08\u4e0d\u8bb0\u5f97\u662f\u5728\u54ea\u4e2a\u9636\u6bb5\u5206\u914d\u6bb5\u7684\u540d\u5b57\u4e86\uff09\uff0c\u7c97\u7565\u7a0b\u5e8f\u7684\u5730\u5740\uff08\u94fe\u63a5\u5668\u518d\u5408\u5e76\u771f\u5b9e\u7684\uff1f\uff09\uff1b\u6c47\u7f16\u5668\u6839\u636e\u7279\u5b9a\u7684\u786c\u4ef6\u5e73\u53f0\u548c\u6307\u4ee4\u96c6\uff0c\u7ffb\u8bd1\u6210\u4f60\u7684\u7279\u5b9a\u673a\u5668\u80fd\u770b\u61c2\u7684\u673a\u5668\u8bed\u8a00\uff0c\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff1b\u4e4b\u540e\u94fe\u63a5\u6587\u4ef6\u5c06\u76ee\u6807\u6587\u4ef6\u548c\u4f60\u6240\u7528\u5230\u7684\u5e93\u6587\u4ef6\u8fdb\u884c\u94fe\u63a5\uff0c\u89e3\u6790\u7b26\u53f7\uff0c\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff1b\u4e4b\u540e\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u53d8\u6210\u6307\u4ee4\u548c\u6570\u636e\uff0cCPU\u6267\u884c\u3002 </p> <p>\u6240\u4ee5\u6211\u611f\u89c9\u4e0d\u80fd\u76f4\u63a5\u8bf4\u4ece <code>main</code> \u51fd\u6570\u5c31\u5f00\u59cb\u6267\u884c\uff0c\u4e5f\u4e0d\u80fd\u76f4\u63a5\u7ed9\u4e2a\u7b54\u6848\uff0c\u7a0b\u5e8f\u7684\u80cc\u540e\u8fd8\u6709\u5f88\u591a\u4e1c\u897f\u3002</p> <p>\u5982\u679c\u8bf4\u8fd8\u662f\u89c9\u5f97\u4e0d\u591f\u5e95\u5c42\uff0c\u90a3\u6211\u60f3\u53ef\u80fd\u8fd8\u5f97\u4ece bootloader\u3001BIOS\u3001UEFI\u3001\u673a\u5668\u4e0a\u7535\u5f00\u59cb\uff0c\u4ece\u542f\u52a8\u4ee3\u7801\u5f00\u59cb\u4e00\u6b65\u6b65\u5411\u4e0a\u6253\u901a\u3002</p> <p>\u5982\u679c\u786c\u8981\u8bf4\u4ece\u54ea\u91cc\u5f00\u59cb\uff0c\u4ece <code>_start</code> \u6bb5\u5f00\u59cb\u8bf4\u6bd4\u8f83\u597d\uff1f</p> </li> <li> <p>\u518d\u56de\u5230\u4e0a\u5c42\u4e00\u70b9\uff0c\u5177\u4f53\u6765\u770b\u770b\u5728 <code>Linux</code> \u4e0a  <code>main</code> \u51fd\u6570\u662f\u600e\u4e48\u548c <code>entry</code> \u626f\u4e0a\u5173\u7cfb\u7684\u5462\uff1f </p> </li> </ul> <p>\u6211\u60f3\u8fd8\u662f\u62ff\u4e00\u4e2a\u4f8b\u5b50\u5206\u6790\u6bd4\u8f83\u597d\uff0c\u6bd4\u5982\u8bf4 <code>hello world</code></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7a0b\u5e8f\u5165\u53e3\u662f 0x1060</p> <p>\u8fd9\u91cc\u662f\u54ea\u91cc\uff1f\u53bb\u7b26\u53f7\u8868\u770b\u770b\uff1f</p> <p></p> <pre><code>\u8bf6\uff0c`.text` \u6bb5\uff0c\u5c31\u662f\u5b58\u653e\u8981\u6267\u884c\u4ee3\u7801\u7684\u5730\u65b9\uff0c\u4e5f\u6b63\u5e38\uff0c\u90a3\u65c1\u8fb9\u7684 `_start` \u662f\u4ec0\u4e48\uff1f\n\n\u518d `objdump -d a.out ` \u770b\u770b\uff1a\n</code></pre> <p></p> <pre><code>\u5173\u4e8e\u8fd9\u4e2a\u4ee3\u7801\u6bb5 -&gt; `_start` \u6bb5\u7684\u53cd\u6c47\u7f16\uff0c\u7b80\u5355\u8bfb\u4e00\u4e0b\u6211\u4eec\u5e94\u8be5\u80fd\u5f97\u5230\u4e00\u4e9b\u4fe1\u606f\uff1a\n\n&gt; 1. \u6e05\u96f6\u6808\u57fa\u5740\u5bc4\u5b58\u5668\u3002\n&gt;\n&gt; 2. \u5c06\u6570\u636e\u5bc4\u5b58\u5668 `%rdx` \u7684\u503c\u79fb\u52a8\u5230 `%r9` \u5bc4\u5b58\u5668\u3002\n&gt;\n&gt; 3. \u4ece\u6808\u4e2d\u5f39\u51fa\u503c\u5230 `%rsi` \u5bc4\u5b58\u5668\u3002\n&gt;\n&gt;     &gt;  `%rsi` \u901a\u5e38\u7528\u4e8e\u5b58\u50a8\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002\n&gt;\n&gt; 4. \u5c06\u6808\u6307\u9488 `%rsp` \u7684\u503c\u79fb\u52a8\u5230 `%rdx` \u5bc4\u5b58\u5668\u3002\n&gt;\n&gt; 5. \u5c06\u6808\u6307\u9488 `%rsp` \u4e0e `0xfffffffffffffff0` \u8fdb\u884c `AND` \u64cd\u4f5c\uff0c\u786e\u4fdd\u6808\u6307\u9488\u662f 16 \u5b57\u8282\u5bf9\u9f50\u7684\u3002\n&gt;\n&gt;     &gt;  \u4e3a\u4ec0\u4e48\u8981\u5bf9\u9f50\uff1f\u4e4b\u524d\u522b\u7684\u5206\u6790\u8fc7\uff0c\u53d6\u6570\u636e\u6b63\u786e\uff0c\u786c\u4ef6\u8bbe\u8ba1\u8981\u6c42\uff0c\u6027\u80fd\u8981\u6c42\u3002\u3002\u3002\u3002\n&gt;\n&gt; 6. \u5c06 `%rax` \u5bc4\u5b58\u5668\u7684\u503c\u538b\u5165\u6808\u3002\n&gt;\n&gt;     &gt; `rax` \u5bc4\u5b58\u5668\u5e38\u5e38\u5b58\u51fd\u6570\u53c2\u6570\uff0c\u90a3\u8fd9\u91cc\u5e94\u8be5\u662f `main` \u51fd\u6570\u7684\u53c2\u6570\u662f\u5427\uff1f\u4e0d\u592a\u5bf9\uff0c\u8fd9\u4e48\u5feb\u5c31\u8fdb\u5165 `main` \u51fd\u6570\u4e86\uff1f\u663e\u7136\u662f\u9519\u7684\uff0c\u5e94\u8be5\u4e0d\u662f `main` \u51fd\u6570\u7684\u53c2\u6570\uff0c\u90a3\u7a76\u7adf\u662f\u4ec0\u4e48\u53c2\u6570\uff1f\u7559\u5751\uff1f\n&gt;\n&gt; 7. \u5c06\u6808\u6307\u9488 `%rsp` \u538b\u5165\u6808\u3002\n&gt;\n&gt;     &gt;  \u540e\u6765\u8865\u5145\uff1a\u8fd9\u4e24\u4e2a `push` \u64cd\u4f5c\u4e3a `__libc_start_main` \u51fd\u6570\u51c6\u5907\u4e86\u5b83\u7684\u53c2\u6570\u3002\n&gt;\n&gt; 8. \u5c06 `%r8d` \u5bc4\u5b58\u5668\u7684\u503c\u7f6e\u4e3a0\u3002\n&gt;\n&gt; 9. \u5c06 `%ecx` \u5bc4\u5b58\u5668\u7684\u503c\u7f6e\u4e3a0\u3002\n&gt;\n&gt; 10. \u5c06 `%rip` \u5bc4\u5b58\u5668\u52a0\u4e0a\u504f\u79fb\u91cf `0xca` \u7684\u5730\u5740\u52a0\u8f7d\u5230 `%rdi` \u5bc4\u5b58\u5668\u3002\n&gt;\n&gt;     &gt; \u5173\u4e8e `lea` \u6307\u4ee4\n&gt;     &gt;\n&gt;     &gt; ![image-20240516220431047](pic/image-20240516220431047.png)\n&gt;     &gt;\n&gt;     &gt; ![image-20240516220621208](pic/image-20240516220621208.png)\n&gt;     &gt;\n&gt;     &gt; \u54e6\uff01\u5c06 `main` \u51fd\u6570\u7684\u5730\u5740\u5b58\u5230 `%rdi` \u5bc4\u5b58\u5668\u4e2d\u3002\n&gt;\n&gt; 11. \u8c03\u7528\u8fd9\u4e2a0x2f53(%rip)\u4f4d\u7f6e\u7684\u51fd\u6570\n&gt;\n&gt;     &gt; \u6309\u56fe\u7684\u610f\u601d\uff0c\u662f\u8c03\u7528 `__glibc_start_main` \u51fd\u6570\uff1f\u7531 `glibc` \u63d0\u4f9b\u7684\uff1f\n&gt;\n&gt; 12. \u6307\u4ee4\u7528\u4e8e\u4f7f CPU \u8fdb\u5165\u505c\u6b62\u72b6\u6001\u3002\n&gt;\n&gt;     \u5982\u679c `__libc_start_main` \u8fd4\u56de\uff0c\u8fd9\u5c06\u505c\u6b62\u7a0b\u5e8f\u7684\u6267\u884c\u3002\n&gt;\n&gt; 13. \u4e00\u7ec4\u65e0\u64cd\u4f5c\uff08NOP\uff09\u6307\u4ee4\uff0c\u7528\u4e8e\u586b\u5145\u7a7a\u95f4\uff0c\u907f\u514d\u6307\u4ee4\u5bf9\u9f50\u95ee\u9898\u3002\n&gt;\n&gt;     \u540e\u9762\u7684\u51e0\u4e2a `00` \u662f\u586b\u5145\u5b57\u8282\u3002\n\n\u4ece `_start` \u5f00\u59cb\uff0c\u4e4b\u540e\u7a0b\u5e8f\u5c31\u4ece\u8fd9\u4e2a\u5165\u53e3\u7ee7\u7eed\u8d70\u3002\u4e0d\u5e94\u8be5\u4e4b\u540e\u5230 `main` \u51fd\u6570\u4e86\u5417\uff1f\u4e3a\u4ec0\u4e48\u53ea\u662f\u5b58\u4e86\u4e2a\u51fd\u6570\u5730\u5740\uff1f\n\n\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u6c47\u7f16\u4ee3\u7801\u663e\u793a\u8c03\u7528 `__glibc_start_main`\u51fd\u6570\uff1f\n\n\u90a3\u73b0\u5728\u8be5\u4e86\u89e3\u4e00\u4e9b\u5173\u4e8e `_glibc_start_main` \u51fd\u6570\u7684\u5185\u5bb9\u3002\n\n\u8fd9\u4e2a `__libc_start_main` \u53c8\u662f\u4ec0\u4e48\uff1f\u8fd9\u4e2a\u8fc7\u7a0b\u600e\u4e48\u5f00\u59cb\u5206\u6790\uff1f\n\n&gt; \u597d\u50cf\u6709\u4eba\u505a\u4e86\u8fd9\u65b9\u9762\u7684\u5185\u5bb9\u54a7 \uff1a(\n&gt;\n&gt; [Linux\u4e2d\u8ab0\u4f86\u547c\u53ebC\u8a9e\u8a00\u4e2d\u7684main? - My code works, I don\u2019t know why. (wen00072.github.io)](https://wen00072.github.io/blog/2015/02/14/main-linux-whos-going-to-call-in-c-language/)\n\n\n\n\n\n&gt; `__libc_start_main` \u51fd\u6570\u662f POSIX C \u6807\u51c6\u5e93\u4e2d\u7684\u4e00\u4e2a\u5185\u90e8\u51fd\u6570\uff0c\u5b83\u4e0d\u662f\u7528\u6237\u7a0b\u5e8f\u7684\u4e00\u90e8\u5206\uff0c\u800c\u662f C \u8fd0\u884c\u65f6\u542f\u52a8\u4ee3\u7801\u7684\u4e00\u90e8\u5206\uff0c\u901a\u5e38\u7531\u7cfb\u7edf C \u5e93\uff08\u5982 GNU C Library\uff0c\u4e5f\u79f0\u4e3a glibc\uff09\u63d0\u4f9b\u3002\n&gt;\n&gt; \u8fd9\u4e2a\u51fd\u6570\u5728 C \u7a0b\u5e8f\u7684 `main` \u51fd\u6570\u6267\u884c\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u521d\u59cb\u5316\u7a0b\u5e8f\uff0c\u5305\u62ec\u8bbe\u7f6e\u7a0b\u5e8f\u7684\u73af\u5883\u3001\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u7b49\u3002\n&gt;\n&gt; `__libc_start_main` \u51fd\u6570\u7684\u539f\u578b\u901a\u5e38\u5982\u4e0b\u6240\u793a\uff1a\n&gt;\n&gt; ```c\n&gt; int __libc_start_main(int (*main)(void), int argc, char **argv, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void));\n&gt; ```\n&gt;\n&gt; \u53c2\u6570\u89e3\u91ca\uff1a\n&gt;\n&gt; - `main`\uff1a**\u6307\u5411\u7a0b\u5e8f `main` \u51fd\u6570\u7684\u6307\u9488\u3002\n&gt;\n&gt;     &gt; **\u6240\u4ee5\uff0c\u5c31\u662f\u7531\u5b83\u53bb\u8c03\u7528 `main` \u51fd\u6570\uff1f**\n&gt;\n&gt; - `argc`\uff1a\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u91cf\uff08\u5305\u62ec\u7a0b\u5e8f\u540d\uff09\u3002\n&gt;\n&gt;     &gt; \u8fd9\u6837\u6211\u624d\u77e5\u9053\u8c03\u7684\u54ea\u4e2a\u7a0b\u5e8f\u7684main\u51fd\u6570\u662f\u5427\n&gt;\n&gt; - `argv`\uff1a\u6307\u5411\u547d\u4ee4\u884c\u53c2\u6570\u6570\u7ec4\u7684\u6307\u9488\u3002\n&gt;\n&gt; - `init`\uff1a\u6307\u5411\u7a0b\u5e8f\u521d\u59cb\u5316\u51fd\u6570\u7684\u6307\u9488\uff0c\u53ef\u4ee5\u662f `main` \u51fd\u6570\u4e4b\u524d\u7684\u521d\u59cb\u5316\u4ee3\u7801\u3002\n&gt;\n&gt; - `fini`\uff1a\u6307\u5411\u7a0b\u5e8f\u7ec8\u6b62\u51fd\u6570\u7684\u6307\u9488\uff0c\u53ef\u4ee5\u662f `main` \u51fd\u6570\u4e4b\u540e\u7684\u6e05\u7406\u4ee3\u7801\u3002\n&gt;\n&gt;     &gt; \u8fd9\u4e2a `init` \u548c `fini` \u51fd\u6570\u6307\u9488\u3002\n&gt;     &gt;\n&gt;     &gt; C/C++\uff0c\u5b83\u8fd9\u4e24\u4e2a\u521d\u59cb\u5316\u51fd\u6570\uff0c\u5e94\u8be5\u662f\u901a\u5e38\u7528\u4e8eC\u7a0b\u5e8f\u7684\u5168\u5c40\u5bf9\u8c61\u6784\u9020\u5668(`constructor`)\u548c\u5168\u5c40\u5bf9\u8c61\u6790\u6784\u5668(`destructor`)\u3002\n&gt;     &gt;\n&gt;     &gt; `main` \u51fd\u6570\u4e4b\u524d\u5e94\u8be5\u8981\u6784\u9020\u5168\u5c40\u5bf9\u8c61\uff0c\u4e4b\u540e\u8981\u9500\u6bc1\u5168\u5c40\u5bf9\u8c61\u3002\n&gt;     &gt;\n&gt;     &gt; \u8fd9\u4e9b\u51fd\u6570\u5e94\u8be5\u662f\u7f16\u8bd1\u5668\u81ea\u52a8\u751f\u6210\u7684\u3002\n&gt;     &gt;\n&gt;     &gt; &gt; From GPT:\n&gt;     &gt; &gt;\n&gt;     &gt; &gt; \u5728 C \u7a0b\u5e8f\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u5168\u5c40\u6784\u9020\u5668\u6216\u6790\u6784\u5668\uff0c`init` \u548c `fini` \u901a\u5e38\u8bbe\u7f6e\u4e3a `NULL`\u3002\u800c\u5728 C++ \u7a0b\u5e8f\u4e2d\uff0c\u94fe\u63a5\u5668\u4f1a\u4ece\u7f16\u8bd1\u5668\u751f\u6210\u7684\u7279\u6b8a\u6bb5\uff08\u5982 `.init` \u548c `.fini`\uff09\u4e2d\u63d0\u53d6\u8fd9\u4e9b\u51fd\u6570\u7684\u5730\u5740\uff0c\u5e76\u586b\u5145\u5230\u8fd9\u4e9b\u53c2\u6570\u4e2d\u3002\n&gt;     &gt; &gt;\n&gt;     &gt; &gt; `__libc_start_main` \u51fd\u6570\u7684\u5b9e\u73b0\u4f1a\u786e\u4fdd\u5728\u8c03\u7528 `main` \u51fd\u6570\u4e4b\u524d\u6267\u884c `init` \u51fd\u6570\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c\u5e76\u5728 `main` \u51fd\u6570\u8fd4\u56de\u4e4b\u540e\u6267\u884c `fini` \u51fd\u6570\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\u3002\u8fd9\u662f C/C++ \u7a0b\u5e8f\u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u4e00\u90e8\u5206\uff0c\u786e\u4fdd\u7a0b\u5e8f\u7684\u5168\u5c40\u72b6\u6001\u5728\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u5f97\u5230\u6b63\u786e\u7684\u5904\u7406\u3002\n&gt;\n&gt;     - `rtld_fini`\uff1a\u5728\u52a8\u6001\u94fe\u63a5\u7a0b\u5e8f\u4e2d\uff0c\u6307\u5411\u52a8\u6001\u94fe\u63a5\u5668\u7684\u7ec8\u6b62\u51fd\u6570\u7684\u6307\u9488\u3002\n&gt;\n</code></pre> <p>\u6240\u4ee5\uff0c\u8fd9\u4e2a <code>__libc_start_main</code> \u5e94\u8be5\u662fC\u5e93\u7684\u5185\u5bb9\u4e86</p> <p>\u600e\u4e48\u770b\u54ea\u91cc\u7528\u4e86\u5462\uff1f</p> <p>\u56de\u60f3\u5f00\u59cb\u6211\u4eec\u8bf4\u7684\u90a3\u51e0\u4e2a\u6b65\u9aa4\uff0c\u7f16\u8bd1\u6e90\u6587\u4ef6\u540e\uff0c\u7f16\u8bd1\u5668\u751f\u6210\u51e0\u4e2a\u76ee\u6807\u6587\u4ef6(\u4e00\u822c\u4e3a .o )\uff0c\u7136\u540e\u94fe\u63a5\u5668\u5c06\u76ee\u6807\u6587\u4ef6\u548cC\u5e93\u7684\u5176\u4ed6\u76ee\u6807\u6587\u4ef6\u94fe\u63a5\u8d77\u6765\uff0c\u521b\u5efa\u53ef\u6267\u884c\u6587\u4ef6\u3002\u90a3\u6211\u662f\u4e0d\u662f\u53ef\u4ee5\u770b\u770b\u94fe\u63a5\u5668\u7684\u5185\u5bb9\uff1fld / gcc\uff1f</p> <p>\u5047\u5982\u6211\u8981\u94fe\u63a5\u5668\u8f93\u51fa\u76f8\u5173\u4fe1\u606f\u600e\u4e48\u505a\uff1fGPT\uff1f<code>gcc -v hello.c</code></p> <p>\u4e00\u5806\u4e71\u4e03\u516b\u7cdf\u7684\uff1a   </p> <p> </p> <p>\u4f46\u662f\u6211\u597d\u50cf\u662f\u8981\u770bC\u5e93\u7684\u5185\u5bb9\u6b38\uff1f\u6211\u60f3\u8981\u77e5\u9053\u5e93\u54ea\u91cc\u6709 <code>entry</code>\u3001<code>_start</code>\u3001 <code>__glibc_start_main</code> \u7b49\u7b49\u4e1c\u897f\u8bf6\uff1f</p> <p>\u5148\u5728 <code>/usr/lib</code> \u91cc\u627e\u5230\u6240\u6709\u7684.o .ao\u6587\u4ef6\uff0c \u7136\u540e\uff0c\u7528 <code>nm</code> \u5de5\u5177\u5217\u51fa\u76ee\u6807\u6587\u4ef6\u4e2d\u5b9a\u4e49\u548c\u5f15\u7528\u7684\u5185\u5bb9\uff0c\u4e4b\u540e\u518d <code>grep</code> \u8fc7\u6ee4\u4e00\u4e0b\uff1f\u627e\u5230 <code>_start</code>\uff1f</p> <p>\u601d\u8def\u5e94\u8be5\u6ca1\u9519\uff1f\u4ea4\u7ed9GPT</p> <p>\u6211\u8981\u770b\u5e93\u6587\u4ef6\u7684\uff1a</p> <p></p> <p>\u54e6\uff01\u73b0\u5728\u77e5\u9053\u4e86\uff0c\u5173\u4e8e\u8fd9\u4e2a<code>_start</code> \u90e8\u5206\u662f\u5728\u8fd9\u4e9b <code>CRT(C Runtime library)</code> \u4e2d\u7684\uff01</p> <p>\u518d\u8865\u5145GPT\uff1a</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u8fd0\u884c\u65f6\u5e93\uff08\u5982 GNU C Library\uff0cglibc\uff09\u63d0\u4f9b\u4e86\u7a0b\u5e8f\u6267\u884c\u6240\u9700\u7684\u5404\u79cd\u6807\u51c6\u5e93\u51fd\u6570\u548c\u542f\u52a8\u4ee3\u7801\u3002<code>_start</code> \u662f\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u5b83\u901a\u5e38\u662f\u7531\u8fd0\u884c\u65f6\u5e93\u7684\u4e00\u90e8\u5206\uff0c\u7279\u522b\u662f\u5728 C \u8bed\u8a00\u7a0b\u5e8f\u4e2d\uff0c<code>_start</code> \u7b26\u53f7\u7ecf\u5e38\u5b9a\u4e49\u5728\u5e93\u7684\u542f\u52a8\u5bf9\u8c61\u6587\u4ef6\u4e2d\uff0c\u5982 <code>crt1.o</code>\u3001<code>Scrt1.o</code>\u3001<code>crtbegin.o</code> \u7b49\u3002</p> <p>\u4ece\u60a8\u63d0\u4f9b\u7684\u547d\u4ee4\u8f93\u51fa\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u591a\u4e2a\u4e0d\u540c\u7684 <code>.a</code> \u5f52\u6863\u6587\u4ef6\uff08\u9759\u6001\u5e93\uff09\u548c\u5b83\u4eec\u5305\u542b\u7684\u76ee\u6807\u6587\u4ef6\uff08<code>.o</code>\uff09\uff0c\u8fd9\u4e9b\u76ee\u6807\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86 <code>_start</code> \u7b26\u53f7\u3002\u8fd9\u4e9b\u6587\u4ef6\u662f\uff1a</p> <ul> <li><code>libcoregrind-amd64-linux.a</code>\uff1a\u8fd9\u662f Valgrind \u5de5\u5177\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u662f\u4e00\u4e2a\u5185\u5b58\u8c03\u8bd5\u548c\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u5de5\u5177\u3002\u8fd9\u91cc\u663e\u793a\u4e86\u4e24\u4e2a <code>_start</code> \u7b26\u53f7\uff0c\u8868\u660e Valgrind \u7684\u542f\u52a8\u4ee3\u7801\u652f\u6301\u4e24\u79cd\u4e0d\u540c\u7684\u542f\u52a8\u65b9\u5f0f\u3002</li> <li><code>libcoregrind-x86-linux.a</code>\uff1a\u540c\u6837\u662f Valgrind \u7684\u4e00\u90e8\u5206\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u67b6\u6784\u3002</li> <li><code>Scrtl.0</code>\u3001<code>crtl.0</code>\u3001<code>rcrt1.0</code>\u3001<code>grcrt1.0</code>\u3001<code>gcrt1.0</code>\uff1a\u8fd9\u4e9b\u53ef\u80fd\u662f\u7279\u5b9a\u4e8e\u67d0\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216\u5e93\u7684\u81ea\u5b9a\u4e49\u542f\u52a8\u6587\u4ef6\uff0c\u5b83\u4eec\u4e5f\u5305\u542b\u4e86 <code>_start</code> \u7b26\u53f7\u3002</li> </ul> <p>\u5206\u6790\u8fd9\u4e9b\u8f93\u51fa\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4ee5\u4e0b\u7ed3\u8bba\uff1a</p> <ol> <li> <p><code>_start</code> \u7b26\u53f7\u662f\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u5b83\u5728\u591a\u4e2a\u4e0d\u540c\u7684\u5e93\u4e2d\u5b9a\u4e49\uff0c\u8fd9\u8868\u660e\u4e0d\u540c\u7684\u5e93\u53ef\u80fd\u4e3a\u4e0d\u540c\u7684\u67b6\u6784\u6216\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\u63d0\u4f9b\u4e86\u5b9a\u5236\u7684\u542f\u52a8\u4ee3\u7801\u3002</p> </li> <li> <p><code>_start</code> \u7b26\u53f7\u524d\u7684 <code>T</code> \u8868\u793a\u5b83\u662f\u4e00\u4e2a\u5168\u5c40\u7b26\u53f7\uff0c\u5373\u5b83\u53ef\u4ee5\u5728\u5176\u4ed6\u6587\u4ef6\u4e2d\u88ab\u5f15\u7528\u3002</p> </li> <li> <p>\u5730\u5740 <code>0000000000000000</code> \u8868\u793a\u8fd9\u4e9b\u7b26\u53f7\u5728\u5b83\u4eec\u5404\u81ea\u76ee\u6807\u6587\u4ef6\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002\u8fd9\u901a\u5e38\u662f\u56e0\u4e3a\u94fe\u63a5\u5668\u5728\u5904\u7406\u8fd9\u4e9b\u7279\u6b8a\u7684\u542f\u52a8\u76ee\u6807\u6587\u4ef6\u65f6\uff0c\u4f1a\u5c06\u5b83\u4eec\u653e\u5728\u7a0b\u5e8f\u7684\u6700\u4f4e\u5730\u5740\u5904\u3002</p> </li> <li> <p>\u4e00\u4e9b <code>_start</code> \u7b26\u53f7\u540e\u9762\u8ddf\u7740 <code>_in_C_linux</code>\uff0c\u8fd9\u53ef\u80fd\u8868\u793a\u8fd9\u4e9b\u662f C \u8bed\u8a00\u73af\u5883\u4e0b\u7684 Linux \u7cfb\u7edf\u4e13\u7528\u7684\u5165\u53e3\u70b9\u3002</p> </li> <li> <p>\u8fd9\u4e9b\u6587\u4ef6\u7684\u5b58\u5728\u8868\u660e\uff0c\u8fd0\u884c\u65f6\u5e93\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u6807\u51c6\u7684\u8f93\u5165\u8f93\u51fa\u548c\u6570\u5b66\u51fd\u6570\u7b49\uff0c\u8fd8\u63d0\u4f9b\u4e86\u7a0b\u5e8f\u542f\u52a8\u65f6\u6240\u9700\u7684\u5e95\u5c42\u652f\u6301\u3002</p> </li> </ol> <p>\u8981\u8fdb\u4e00\u6b65\u5206\u6790\u8fd9\u4e9b\u6587\u4ef6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>nm</code> \u548c <code>objdump</code> \u5de5\u5177\u6765\u67e5\u770b\u8fd9\u4e9b\u76ee\u6807\u6587\u4ef6\u4e2d\u7684\u7b26\u53f7\u5b9a\u4e49\u548c\u53cd\u6c47\u7f16\u4ee3\u7801\u3002\u4f8b\u5982\uff1a</p> <p><pre><code>nm -A /usr/lib/x86_64-linux-gnu/valgrind/libcoregrind-amd64-linux.a\nobjdump -d /usr/lib/x86_64-linux-gnu/valgrind/libcoregrind-amd64-linux.a\n</code></pre> </p> <p>\u518d\u7531\u4e4b\u524d\u7684\u535a\u5ba2\u77e5\u9053\uff1a</p> <p>\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\uff0c\u67e5\u770b\u94fe\u63a5\u5668\u662f\u600e\u4e48\u627e\u5230\u5e76\u4f7f\u7528 <code>__libc_start_main</code> \u51fd\u6570\u3002</p> <p></p> <pre><code>&gt; `__libc_start_main` \u662f C \u8bed\u8a00\u7a0b\u5e8f\u5728 Linux \u7cfb\u7edf\u4e0a\u4f7f\u7528 GNU C Library\uff08glibc\uff09\u65f6\u7684\u4e00\u4e2a**\u7279\u6b8a\u51fd\u6570**\u3002\n&gt;\n&gt; \u8fd9\u4e2a\u51fd\u6570\u662f\u7a0b\u5e8f\u542f\u52a8\u8fc7\u7a0b\u4e2d\u7684\u5173\u952e\u90e8\u5206\uff0c\u5b83\u8d1f\u8d23\u5b8c\u6210\u7a0b\u5e8f\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u5e76\u6700\u7ec8\u8c03\u7528\u7528\u6237\u7684 `main` \u51fd\u6570\u3002\n&gt;\n&gt; \u5728 C \u7a0b\u5e8f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\uff0c\u901a\u5e38\u4e0d\u4f1a\u76f4\u63a5\u8c03\u7528 `__libc_start_main`\uff0c\u800c\u662f\u7531\u7cfb\u7edf\u63d0\u4f9b\u7684\u542f\u52a8\u4ee3\u7801\uff08\u901a\u5e38\u5728\u94fe\u63a5\u65f6\u4ece C \u5e93\u4e2d\u94fe\u63a5\u8fdb\u6765\uff09\u6765\u8c03\u7528\u3002\n&gt;\n&gt; \u8fd9\u4e2a\u542f\u52a8\u4ee3\u7801\u8bbe\u7f6e\u4e86\u7a0b\u5e8f\u7684\u521d\u59cb\u6267\u884c\u73af\u5883\uff0c\u5305\u62ec\u6808\u3001\u73af\u5883\u53d8\u91cf\u7b49\uff0c\u7136\u540e\u8df3\u8f6c\u5230 `__libc_start_main`\u3002\n&gt;\n&gt; `__libc_start_main` \u51fd\u6570\u7684\u4e3b\u8981\u4efb\u52a1\u5305\u62ec\uff1a\n&gt;\n&gt; 1. **\u521d\u59cb\u5316**\uff1a\u8fdb\u884c\u4e00\u4e9b\u5fc5\u8981\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u6bd4\u5982\u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf\u3001\u521d\u59cb\u5316 C \u5e93\u51fd\u6570\u7b49\u3002\n&gt;\n&gt; 2. **\u89e3\u6790\u53c2\u6570**\uff1a\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u5c06\u5b83\u4eec\u5b58\u50a8\u5728 `main` \u51fd\u6570\u53ef\u4ee5\u8bbf\u95ee\u7684\u5168\u5c40\u53d8\u91cf\u4e2d\u3002\n&gt;\n&gt; 3. **\u8c03\u7528 `main` \u51fd\u6570**\uff1a\u4e00\u65e6\u521d\u59cb\u5316\u5b8c\u6210\uff0c`__libc_start_main` \u4f1a\u8c03\u7528\u7a0b\u5e8f\u7684 `main` \u51fd\u6570\u3002\n&gt;\n&gt; 4. **\u9000\u51fa\u5904\u7406**\uff1a\u5f53 `main` \u51fd\u6570\u8fd4\u56de\u540e\uff0c`__libc_start_main` \u4f1a\u6267\u884c\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u6bd4\u5982\u5173\u95ed\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u7136\u540e\u8c03\u7528 `exit` \u51fd\u6570\u6765\u7ec8\u6b62\u7a0b\u5e8f\u3002\n&gt;\n&gt; \u5728\u60a8\u63d0\u4f9b\u7684\u547d\u4ee4\u8f93\u51fa\u4e2d\uff0c`LD_DEBUG=all` \u662f\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u7528\u4e8e\u542f\u7528\u94fe\u63a5\u5668\u7684\u8be6\u7ec6\u8c03\u8bd5\u8f93\u51fa\u3002\u901a\u8fc7\u8fd9\u4e2a\u8f93\u51fa\uff0c\u60a8\u53ef\u4ee5\u770b\u5230\u94fe\u63a5\u5668\u5728\u89e3\u6790\u548c\u641c\u7d22\u7b26\u53f7\u65f6\u7684\u884c\u4e3a\u3002\n&gt;\n&gt; - `symbol=__libc_start_main; lookup in file=./a.out[0]`\n&gt;\n&gt;     \u8868\u793a\u94fe\u63a5\u5668\u5728\u7a0b\u5e8f `a.out` \u4e2d\u67e5\u627e `__libc_start_main` \u7b26\u53f7\u3002\n&gt;\n&gt; - `lookup in file=/lib/arm-linux-gnueabi/libc.so.6 [0]` \n&gt;\n&gt;     \u8868\u793a\u94fe\u63a5\u5668\u5728 `libc.so.6` \u5e93\u6587\u4ef6\u4e2d\u67e5\u627e `__libc_start_main` \u7b26\u53f7\u3002\n&gt;\n&gt; - `binding file ./a.[0] to /lib/arm-linux-gnueabi/libc.so.6 [0]: normal symbol  __ libc_start_main [GLIBC_2.4] `  \n&gt;\n&gt;     \u8868\u793a `a.out` \u7a0b\u5e8f\u4e0e `libc.so.6` \u5e93\u7ed1\u5b9a\uff0c\u5e76\u4e14\u627e\u5230\u4e86 `__libc_start_main` \u7b26\u53f7\uff0c\u8fd9\u662f\u4e00\u4e2a\u6b63\u5e38\u7684\u7b26\u53f7\uff0c\u5c5e\u4e8e GNU C Library \u7248\u672c 2.4\u3002\n&gt;\n&gt; \u8fd9\u4e2a\u8f93\u51fa\u8bf4\u660e\u4e86 `a.out` \u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\uff0c\u94fe\u63a5\u5668\u662f\u5982\u4f55\u627e\u5230\u5e76\u4f7f\u7528 `__libc_start_main` \u51fd\u6570\u7684\u3002\u8fd9\u4e5f\u5c55\u793a\u4e86 C \u7a0b\u5e8f\u7684\u542f\u52a8\u8fc7\u7a0b\u662f\u5982\u4f55\u4f9d\u8d56\u4e8e C \u5e93\u63d0\u4f9b\u7684 `__libc_start_main` \u51fd\u6570\u7684\u3002\n\n\n\n\n\n\u6240\u4ee5\uff0c\u5f04\u4e86\u4e00\u5806\u4e71\u4e03\u516b\u7cdf\u7684\uff0c\u603b\u7ed3\u4e00\u4e0b`_start` \u548c `__libc_start_main` \u7684\u5173\u7cfb\u3002\n\n- `_start`\n- \u4f5c\u4e3a\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u7531\u7cfb\u7edf\u94fe\u63a5\u5668\u518d\u7a0b\u5e8f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u6307\u5b9a\u3002\n    - \u7531 `objdump` \u7684\u5206\u6790\uff0c_start \u7531\u6c47\u7f16\u8bed\u8a00\u5199\uff0c\u5b9a\u4e49\u5728C\u5e93\u7684\u542f\u52a8\u5bf9\u8c61\u6587\u4ef6\u4e2d\u3002\uff08`crt1.o`\uff1f\u8fd8\u8fdb\u4e00\u6b65\u4e86\u89e3\u5173\u4e8e\u8fd0\u884c\u65f6\u5e93\u51fd\u7684\u5185\u5bb9\uff1f\uff09\n    - \u67e5\u627e\u8d44\u6599\u540e\uff0c\u77e5\u9053 _start \u7684 \u4e3b\u8981\u804c\u8d23\u662f\u8bbe\u7f6e\u7a0b\u5e8f\u7684\u521d\u59cb\u73af\u5883\uff1a\u6808\u3001PC\uff1f\n\n- `__libc_start_main`\n- GNU C Library\uff08`glibc`\uff09\u4e2d\u5b9a\u4e49\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u8d1f\u8d23\u8fdb\u884c\u66f4\u591a\u7684\u7a0b\u5e8f\u521d\u59cb\u5316\u5de5\u4f5c\u3002\n  - \u5b83\u63a5\u6536\u4e00\u4e2a\u6307\u5411 `main` \u51fd\u6570\u7684\u6307\u9488\u548c\u5176\u4ed6\u53c2\u6570\uff0c\u7136\u540e\u8bbe\u7f6e  `argv` \u548c `argc`\uff08\u4f20\u9012\u7ed9 `main` \u51fd\u6570\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff09\u3002\n  - \u8d1f\u8d23\u5728 `main` \u51fd\u6570\u6267\u884c\u524d\u540e\u8c03\u7528\u9759\u6001\u5bf9\u8c61\u7684\u6784\u9020\u548c\u6790\u6784\u51fd\u6570\u3002\n  - \u4e00\u65e6 `main` \u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c`__libc_start_main` \u4f1a\u8fdb\u884c\u6e05\u7406\u5de5\u4f5c\uff0c\u6bd4\u5982\u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5e76\u6700\u7ec8\u8c03\u7528 `exit` \u51fd\u6570\u6765\u7ec8\u6b62\u7a0b\u5e8f\u3002\n- \u4e8c\u8005\u5173\u7cfb\n\n  - `_start` \u662f\u7a0b\u5e8f\u6267\u884c\u7684\u8d77\u70b9\uff0c\u5b83\u9996\u5148\u88ab\u7cfb\u7edf\u8c03\u7528\u3002\n  - `_start` \u7684\u4e00\u4e2a\u5173\u952e\u4efb\u52a1\u662f\u5b9a\u4f4d\u5e76\u8c03\u7528 `__libc_start_main`\u3002\n  - `__libc_start_main` \u6267\u884c\u7a0b\u5e8f\u521d\u59cb\u5316\uff0c\u7136\u540e\u8c03\u7528 `main` \u51fd\u6570\uff0c\u6700\u540e\u5728 `main` \u51fd\u6570\u8fd4\u56de\u540e\u8d1f\u8d23\u7a0b\u5e8f\u7684\u6e05\u7406\u548c\u9000\u51fa\u3002\n</code></pre> <p>\u6211\u518d\u7b80\u5355\u603b\u7ed3\u4e00\u53e5\u8bdd\uff0c\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u5e76\u51c6\u5907\u6267\u884c\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u5bfb\u627e _start \u7b26\u53f7\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u7684\u5165\u53e3\u70b9\u3002 <code>_start</code> \u4e00\u822c\u8fd8\u662f\u6bd4\u8f83\u7b80\u77ed\u7684\u3002\u4ed6\u53ea\u505a\u6700\u57fa\u672c\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u7acb\u5373\u5c06\u63a7\u5236\u6743\u8f6c\u4ea4\u7ed9<code>__libc_start_main</code>\u3002</p> <p><code>__libc_start_main</code> \u5b8c\u6210\u4e86\u5269\u4f59\u7684\u521d\u59cb\u5316\u4efb\u52a1\uff0c\u5e76\u6700\u7ec8\u8c03\u7528 <code>main</code> \u51fd\u6570\uff0c\u5f00\u59cb\u6267\u884c\u7a0b\u5e8f\u7684\u4e3b\u4f53\u90e8\u5206\u3002</p> <ul> <li> <p>\u67e5\u8d44\u6599\u8fc7\u7a0b\u4e2d\uff1a</p> <ul> <li> <p>\u901a\u8fc7 nm \u547d\u4ee4\u770b\u770b \u53ef\u6267\u884c\u6587\u4ef6\u7684\u7b26\u53f7\u4fe1\u606f\u3001\u76f8\u5173 _start \u7684\u5185\u5bb9\uff1f</p> <p></p> </li> <li> <p><code>ld --verbose | grep ENTRY</code></p> <p>\u8f93\u51fa <code>ENTRY(_start)</code></p> </li> <li> <p>\u94fe\u63a5\u5668\u811a\u672c Linker Script</p> <p>\u94fe\u63a5\u5668\u811a\u672c\uff08Linker Script\uff09\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u5b83\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u7684\u6307\u4ee4\uff0c\u7528\u4e8e\u63a7\u5236\u94fe\u63a5\u5668\uff08Linker\uff09\u5982\u4f55\u5c06\u591a\u4e2a\u76ee\u6807\u6587\u4ef6\uff08Object Files\uff0c\u901a\u5e38\u662f <code>.o</code> \u6587\u4ef6\uff09\u548c\u5e93\u6587\u4ef6\uff08Library Files\uff09\u94fe\u63a5\u6210\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff08Executable File\uff09\u6216\u8005\u5e93\u6587\u4ef6\u3002\u94fe\u63a5\u5668\u811a\u672c\u53ef\u4ee5\u7531\u7a0b\u5e8f\u5458\u81ea\u5b9a\u4e49\u7f16\u5199\uff0c\u4e5f\u53ef\u4ee5\u7531\u7f16\u8bd1\u5668\u6839\u636e\u9ed8\u8ba4\u8bbe\u7f6e\u81ea\u52a8\u751f\u6210\u3002</p> <p>\u94fe\u63a5\u5668\u811a\u672c\u7684\u4e3b\u8981\u4f5c\u7528\u5305\u62ec\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u5185\u5b58\u5e03\u5c40\uff1a\u6307\u5b9a\u7a0b\u5e8f\u7684\u5185\u5b58\u5e03\u5c40\uff0c\u5305\u62ec\u4ee3\u7801\u6bb5\uff08.text\uff09\u3001\u6570\u636e\u6bb5\uff08.data\uff09\u3001BSS\u6bb5\uff08.bss\uff09\u548c\u5176\u4ed6\u6bb5\u7684\u4f4d\u7f6e\u548c\u5927\u5c0f\u3002</p> </li> <li> <p>\u5b9a\u4e49\u7b26\u53f7\uff1a\u53ef\u4ee5\u5b9a\u4e49\u6216\u91cd\u5b9a\u4e49\uff08override\uff09\u5168\u5c40\u7b26\u53f7\u7684\u503c\uff0c\u4f8b\u5982\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff08\u5982 <code>_start</code>\uff09\u3002</p> </li> <li> <p>\u5206\u914d\u6bb5\u7a7a\u95f4\uff1a\u4e3a\u4e0d\u540c\u7684\u6bb5\uff08section\uff09\u5206\u914d\u7a7a\u95f4\uff0c\u6307\u5b9a\u6bb5\u7684\u6743\u9650\uff08\u8bfb\u5199\u3001\u6267\u884c\u7b49\uff09\u3002</p> </li> <li> <p>\u91cd\u5b9a\u4f4d\uff1a\u63a7\u5236\u94fe\u63a5\u5668\u5982\u4f55\u8fdb\u884c\u5730\u5740\u91cd\u5b9a\u4f4d\uff08Relocation\uff09\u3002</p> </li> <li> <p>\u641c\u7d22\u548c\u94fe\u63a5\u5e93\uff1a\u6307\u5b9a\u94fe\u63a5\u5668\u641c\u7d22\u5e93\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4ee5\u53ca\u9700\u8981\u94fe\u63a5\u7684\u5e93\u6587\u4ef6\u3002</p> </li> <li> <p>\u8f93\u51fa\u6587\u4ef6\uff1a\u5b9a\u4e49\u8f93\u51fa\u6587\u4ef6\u7684\u683c\u5f0f\u548c\u540d\u79f0\u3002</p> </li> <li> <p>\u521d\u59cb\u5316\u548c\u7ec8\u6b62\u4ee3\u7801\uff1a\u53ef\u4ee5\u6307\u5b9a\u521d\u59cb\u5316\u548c\u7ec8\u6b62\u4ee3\u7801\uff0c\u8fd9\u4e9b\u4ee3\u7801\u5728\u7a0b\u5e8f\u542f\u52a8\u548c\u9000\u51fa\u65f6\u6267\u884c\u3002</p> </li> <li> <p>\u5185\u5b58\u5206\u914d\uff1a\u53ef\u4ee5\u4e3a\u9759\u6001\u5206\u914d\u7684\u5185\u5b58\u8bbe\u7f6e\u7279\u5b9a\u7684\u5185\u5b58\u533a\u57df\u3002</p> </li> </ol> <p>\u94fe\u63a5\u5668\u811a\u672c\u901a\u5e38\u4f7f\u7528\u4e00\u79cd\u7c7b\u4f3c\u4e8e\u6c47\u7f16\u8bed\u8a00\u7684\u8bed\u6cd5\u7f16\u5199\uff0c\u4f46\u5177\u4f53\u8bed\u6cd5\u53ef\u80fd\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u94fe\u63a5\u5668\u6709\u6240\u5dee\u5f02\u3002\u4f8b\u5982\uff0cGNU \u94fe\u63a5\u5668\uff08GNU Linker\uff0c<code>ld</code>\uff09\u4f7f\u7528\u7684\u94fe\u63a5\u5668\u811a\u672c\u8bed\u6cd5\u4e0e MIPS \u94fe\u63a5\u5668\u6216 ARM \u94fe\u63a5\u5668\u7684\u8bed\u6cd5\u4e0d\u540c\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u94fe\u63a5\u5668\u811a\u672c\u793a\u4f8b\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u5b9a\u4e49\u5185\u5b58\u5e03\u5c40\u548c\u8bbe\u7f6e\u7a0b\u5e8f\u5165\u53e3\u70b9\uff1a</p> <pre><code>ENTRY(_start)  /* \u8bbe\u7f6e\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u4e3a _start */\nSECTIONS {\n  . = SIZEOF_HEADERS;  /* \u4ece\u6587\u4ef6\u5934\u540e\u9762\u5f00\u59cb\u5206\u914d\u6bb5 */\n\n  .text : {\n    *(.text)           /* \u6240\u6709\u76ee\u6807\u6587\u4ef6\u7684 .text \u6bb5 */\n  }\n\n  .data : {\n    *(.data)\n  }\n\n  .bss : {\n    *(.bss)\n  }\n\n  /* \u5176\u4ed6\u6bb5\u7684\u5b9a\u4e49 */\n}\n</code></pre> <p>\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u94fe\u63a5\u5668\u811a\u672c\uff0c\u53ef\u4ee5\u5728\u94fe\u63a5\u547d\u4ee4\u4e2d\u901a\u8fc7 <code>-T</code> \u9009\u9879\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u7684\u8def\u5f84\uff1a</p> <pre><code>ld -T mylinkerscript.ld -o my_program my_object.o\n</code></pre> <p>\u8fd9\u91cc <code>mylinkerscript.ld</code> \u662f\u4f60\u7684\u94fe\u63a5\u5668\u811a\u672c\u6587\u4ef6\uff0c<code>my_program</code> \u662f\u6700\u7ec8\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u800c <code>my_object.o</code> \u662f\u94fe\u63a5\u8fc7\u7a0b\u4e2d\u9700\u8981\u7528\u5230\u7684\u76ee\u6807\u6587\u4ef6\u3002</p> </li> <li> <p>\u5404\u79cd\u67e5\u627e \u53c8\u662ffind grep \u7684\u5185\u5bb9\uff0c\u5e94\u8be5\u597d\u597d\u5b66\u4e60\u8fd9\u4e9b\u67e5\u627e\u547d\u4ee4\u4e86\uff0c\u597d\u597d\u7528GPT\u3002</p> </li> </ul> </li> <li> <p>\u5173\u4e8e\u5230\u7b2c\u4e8c\u4e2a\u89d2\u5ea6\uff0c\u6211\u597d\u50cf\u53c8\u56de\u5230\u5e95\u5c42\u4e0a\u4e86\uff0c\u80fd\u4e0d\u80fd\u5c31\u4ece\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u6765\u770b\u770b main \u51fd\u6570\u662f\u600e\u4e48\u88ab\u8c03\u7528\u7684\uff1f\u6bd4\u5982\u8bf4 <code>shell</code> \u7a0b\u5e8f\u600e\u4e48\u63a5\u53d7\u6211\u8f93\u5165\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7136\u540e\u6267\u884c....\u5230\u7b2c\u4e8c\u4e2a\u89d2\u5ea6</p> <p><code>main</code> \u51fd\u6570\u5728\u4e0a\u5c42\u53ef\u4ee5\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u4f46\u662f <code>main</code> \u51fd\u6570\u4e5f\u662f\u88ab\u5176\u4ed6\u7a0b\u5e8f\u8c03\u7528\u5230\u3002</p> <p>\u6211\u4eec\u4e00\u822c\u901a\u8fc7 <code>shell</code> \u8f93\u5165\u6211\u4eec\u4ee3\u7801\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff08make\u81ea\u52a8\u6784\u5efa\u5de5\u5177\u4e5f\u662f\u6700\u7ec8\u5728 shell \u91cc\u8f93\u5165\u7684\uff09\uff0c\u4e4b\u540e\uff0c<code>shell</code> \u4f1a <code>clone</code> \u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u6267\u884c</p> <pre><code>execve(\"./a.out\",char * const argv[], char * const envp[]) \n</code></pre> <p></p> <p><code>execve</code> \u52a0\u8f7d\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u4ece <code>a.out</code> \u7684\u5165\u53e3\u5f00\u59cb\u6267\u884c\uff08\u4e5f\u5c31\u662f\u4e0a\u9762\u7684_start)\uff0c<code>_start()</code> \u8c03\u7528 <code>__libc_start_main()</code>\u3002STFW\u540e\uff0c\u53d1\u73b0 \u522b\u4eba\u7684\u535a\u5ba2\u6709\u4ee3\u7801\u9a8c\u8bc1\uff1a<code>__libc_start_main()</code> \u4e2d\u6709\u4e00\u884c</p> <pre><code>int result = main(argc, argv, __environ MAIN_AUXVEC_PARAM);\n</code></pre> <p>\u4ece\u8fd9\u91cc\u8fdb\u5165 <code>main()</code> \u51fd\u6570\uff0c<code>main()</code> \u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f1a\u5b58\u5728 <code>result</code> \u4e2d\uff0c<code>__libc_start_main()</code> \u4f1a\u76f4\u63a5 <code>exit(result)</code> \uff0c\u4ece\u800c <code>main</code> \u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f1a\u88ab\u7236\u8fdb\u7a0b\u6355\u6349\u5230\u3002</p> <p>\u6267\u884c\u5b8c <code>./a.out</code> \u540e\u7528 <code>echo $&gt;</code> \u6307\u4ee4\u53ef\u4ee5\u6253\u5370 main() \u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002</p> <p>\u4e4b\u540e\u4ea4\u7ed9 <code>__libc_start_main()</code> \u5904\u7406\u4e00\u4e9b\u5185\u5bb9\uff0c\u5982\u68c0\u67e5 <code>atexit()</code> \u662f\u5426\u6709\u6ce8\u518c\u7684\u9000\u51fa\u670d\u52a1\u51fd\u6570\u7b49\u7b49\u3002</p> <p>\u5dee\u4e0d\u591a\u5f97\u4e86\u3002</p> <p>\u518d\u8be6\u7ec6\u70b9\uff0c\u5c31\u5f97\u7ee7\u7eed\u8865\u5145\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5bb9\uff0c\u611f\u89c9\u4e5f\u6ca1\u5fc5\u8981\uff0c\u53ef\u4ee5\u505c\u4e86\u3002</p> </li> </ul> <p>\u597d\u4e86\uff0c\u4ee5\u4e0a\u5c31\u662f\u81ea\u5df1\u505a PA1 \u601d\u8003\u9898\u7684\u65f6\u5019\u65e0\u804a\u67e5\u7740\u73a9\u73a9\u53d1\u73b0\uff0c\u8fd8\u662f\u6709\u633a\u591a\u7684\u4e1c\u897f\u7684\uff0c\u4f46\u662f\u6211\u8fd8\u662f\u6ca1\u6709\u600e\u4e48\u6df1\u5165\u53bb\u67e5\u770b <code>__libc_start_main</code> \u7684\u6e90\u7801\uff0c\u4e5f\u6ca1\u6709\u4ed4\u7ec6\u53bb\u5206\u6790\u8fc7\u6d41\u7a0b \uff0c\u800c\u4e14\uff0c\u5feb\u63a2\u7d22\u5b8c\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u7f51\u4e0a\u4e5f\u8fd8\u662f\u6709\u5f88\u591a\u4eba\u505a\u8fc7\u76f8\u5173\u7684\u89e3\u91ca\u6587\u7ae0\uff0c\u8d28\u91cf\u5e94\u8be5\u6bd4\u6211\u7684\u8981\u9ad8\u4e0d\u5c11\uff0c\u8fd9\u7bc7\u5c31\u5f53\u6210\u81ea\u5df1\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u63a2\u7d22\u56de\u7b54\uff0c\u5e76\u4e14\u7b80\u5355\u5165\u4e2a\u95e8\u5427\uff0c\u66f4\u52a0\u6df1\u5165\u7684\u8bf7\u53c2\u8003\u522b\u5904\u6587\u7ae0\u3002</p> <p>\u6bd4\u5982\uff1a</p> <ul> <li>Linux x86 Program Start Up (dbp-consulting.com)</li> <li>Linux X86 \u7a0b\u5e8f\u542f\u52a8 - main\u51fd\u6570\u662f\u5982\u4f55\u88ab\u6267\u884c\u7684 - \u77e5\u4e4e (zhihu.com)</li> <li>Principles\uff1amain\u51fd\u6570\u6267\u884c\u524d\u540e\u7684\u6d41\u7a0b | Pwn\u8fdb\u4f60\u7684\u5fc3 (ywhkkx.github.io)</li> <li>libc-start.c - csu/libc-start.c - Glibc source code (glibc-2.39.9000) - Bootlin</li> <li>\u4ece\u521b\u5efa\u8fdb\u7a0b\u5230\u8fdb\u5165main\u51fd\u6570\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f - \u77e5\u4e4e (zhihu.com)</li> <li>......</li> </ul>"},{"location":"ysyx/pa/pa1/pa1.html#_48","title":"\u601d\u8003\u9898\u4e8c","text":"<ul> <li> <p>\u7a76\u7adf\u8981\u6267\u884c\u591a\u4e45?</p> <p>\u5728<code>cmd_c()</code>\u51fd\u6570\u4e2d, \u8c03\u7528<code>cpu_exec()</code>\u7684\u65f6\u5019\u4f20\u5165\u4e86\u53c2\u6570<code>-1</code>, \u4f60\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\u5417?</p> </li> <li> <p>\u6f5c\u5728\u7684\u5a01\u80c1 (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\"\u8c03\u7528<code>cpu_exec()</code>\u7684\u65f6\u5019\u4f20\u5165\u4e86\u53c2\u6570<code>-1</code>\", \u8fd9\u4e00\u505a\u6cd5\u5c5e\u4e8e\u672a\u5b9a\u4e49\u884c\u4e3a\u5417? \u8bf7\u67e5\u9605C99\u624b\u518c\u786e\u8ba4\u4f60\u7684\u60f3\u6cd5.</p> </li> </ul> <p></p> <p>Q1:</p> <p>-1 \u53d8\u91cf\u5347\u7ea7\uff1f\u6574\u6570\u63d0\u5347\uff1f</p> <p>\u5728C\u8bed\u8a00\u4e2d\uff0c\u5c06 <code>-1</code> \u4f20\u9012\u7ed9 <code>uint64_t</code> \u7c7b\u578b\u7684\u53c2\u6570 <code>n</code> \u4f1a\u5bfc\u81f4\u4e00\u4e2a\u6574\u6570\u63d0\u5347\uff08integer promotion\uff09\uff0c\u5373\u5c06 <code>-1</code> \u4ece <code>int</code> \u7c7b\u578b\u8f6c\u6362\u4e3a <code>unsigned int</code> \u6216\u66f4\u5927\u7684\u6574\u6570\u7c7b\u578b\u3002\u6574\u6570\u63d0\u5347\u7684\u89c4\u5219\u662f\u5c06\u6709\u7b26\u53f7\u6574\u6570\u8f6c\u6362\u4e3a\u5176\u65e0\u7b26\u53f7\u7684\u7b49\u4ef7\u7c7b\u578b\uff0c\u8fd9\u901a\u5e38\u901a\u8fc7\u5c06\u6709\u7b26\u53f7\u6574\u6570\u7684\u4f4d\u8868\u793a\u76f4\u63a5\u89e3\u91ca\u4e3a\u65e0\u7b26\u53f7\u6574\u6570\u6765\u5b9e\u73b0\u3002</p> <p>\u5bf9\u4e8e <code>int</code> \u7c7b\u578b\uff08\u901a\u5e38\u662f32\u4f4d\u7684\uff09\uff0c<code>-1</code> \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u662f\u6240\u6709\u4f4d\u90fd\u662f1\u3002\u5f53\u8fd9\u4e2a\u503c\u88ab\u63d0\u5347\u5230 <code>uint64_t</code>\uff0864\u4f4d\u65e0\u7b26\u53f7\u6574\u6570\uff09\u65f6\uff0c\u5b83\u5c06\u4fdd\u6301\u76f8\u540c\u7684\u4e8c\u8fdb\u5236\u4f4d\u6a21\u5f0f\uff0c\u4f46\u88ab\u89e3\u91ca\u4e3a\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u5373 <code>UINT64_MAX</code>\uff0c\u8fd9\u662f2\u768464\u6b21\u65b9\u51cf1\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u5c06 <code>-1</code> \u4f20\u9012\u7ed9 <code>uint64_t n</code>\uff1a</p> <pre><code>uint64_t n = -1;\n</code></pre> <p><code>n</code> \u7684\u503c\u5c06\u662f\uff1a</p> <pre><code>18446744073709551615  // UINT64_MAX\n</code></pre> <p>\u5219  <code>for</code> \u5faa\u73af\u5c06\u4ece <code>UINT64_MAX</code> \u5f00\u59cb\u8ba1\u6570\uff0c\u800c\u4e0d\u662f\u4ece <code>-1</code> \u5f00\u59cb\u3002\u5faa\u73af\u5c06\u6267\u884c <code>UINT64_MAX</code> \u6b21\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u6570\u5b57\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u8ba4\u4e3a\u662f\u65e0\u9650\u5faa\u73af\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u51e0\u4e4e\u4e0d\u53ef\u80fd\u6267\u884c\u8fd9\u4e48\u591a\u6b21\u3002</p> <p>Q2\uff1a</p> <p>\u5173\u4e8e\u672a\u5b9a\u4e49\u884c\u4e3a\uff0cC\u6807\u51c6\u786e\u5b9e\u89c4\u5b9a\u4e86\u6574\u6570\u7c7b\u578b\u7684\u8303\u56f4\uff0c\u5c1d\u8bd5\u5c06\u4e00\u4e2a\u503c\u8d4b\u7ed9\u4e00\u4e2a\u7c7b\u578b\uff0c\u5982\u679c\u8be5\u503c\u4e0d\u5728\u8be5\u7c7b\u578b\u7684\u8868\u793a\u8303\u56f4\u5185\uff0c\u5219\u4e3a\u672a\u5b9a\u4e49\u884c\u4e3a\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u6574\u6570\u63d0\u5347\u89c4\u5219\uff0c<code>-1</code> \u88ab\u63d0\u5347\u4e3a\u4e00\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8f6c\u6362\u662f\u5b9a\u4e49\u826f\u597d\u7684\u3002\u60a8\u4f20\u9012\u7684 <code>-1</code> \u5e76\u6ca1\u6709\u76f4\u63a5\u6210\u4e3a <code>uint64_t</code> \u7c7b\u578b\u7684\u503c\uff0c\u800c\u662f\u9996\u5148\u88ab\u63d0\u5347\u4e3a <code>unsigned int</code> \u6216 <code>unsigned long</code>\uff08\u53d6\u51b3\u4e8e\u5e73\u53f0\u548c <code>-1</code> \u7684\u521d\u59cb\u7c7b\u578b\uff09\uff0c\u7136\u540e\u518d\u63d0\u5347\u5230 <code>uint64_t</code>\u3002</p> <p>C99\u6807\u51c6\u4e2d\u5173\u4e8e\u6574\u6570\u63d0\u5347\u7684\u63cf\u8ff0\u53ef\u4ee5\u5728\u4ee5\u4e0b\u90e8\u5206\u627e\u5230\uff1a</p> <ul> <li>C99: 6.3.1.3 \"Integer constants\" \u4e2d\u63d0\u5230\u4e86\u65e0\u7b26\u53f7\u6574\u6570\u5e38\u91cf\u7684\u8868\u793a\u3002</li> <li>C99: 6.5 \"Expressions\" \u4e2d\u7684 \"Integer promotions\" \u5c0f\u8282\u63cf\u8ff0\u4e86\u6574\u6570\u63d0\u5347\u7684\u89c4\u5219\u3002</li> </ul> <p>\u5728C99\u6807\u51c6\u4e2d\uff0c\u5e76\u6ca1\u6709\u76f4\u63a5\u8bf4\u660e\u5c06 <code>int</code> \u7c7b\u578b\u7684 <code>-1</code> \u8d4b\u503c\u7ed9 <code>uint64_t</code> \u7c7b\u578b\u7684\u884c\u4e3a\uff0c\u56e0\u4e3a\u6807\u51c6\u5047\u5b9a\u7c7b\u578b\u8f6c\u6362\u603b\u662f\u5728\u503c\u7684\u5408\u6cd5\u8303\u56f4\u5185\u8fdb\u884c\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u6574\u6570\u63d0\u5347\u7684\u5b58\u5728\uff0c\u8be5\u64cd\u4f5c\u662f\u88ab\u5141\u8bb8\u7684\uff0c\u5e76\u4e14\u7ed3\u679c\u662f\u5b9a\u4e49\u7684\u3002</p>"},{"location":"ysyx/pa/pa1/pa1.html#_49","title":"\u601d\u8003\u9898\u4e09","text":"<p>\u9000\u51fa<code>cpu_exec()</code>\u4e4b\u540e, NEMU\u5c06\u8fd4\u56de\u5230<code>sdb_mainloop()</code>, \u7b49\u5f85\u7528\u6237\u8f93\u5165\u547d\u4ee4. \u4f46\u4e3a\u4e86\u518d\u6b21\u8fd0\u884c\u7a0b\u5e8f, \u4f60\u9700\u8981\u952e\u5165<code>q</code>\u9000\u51faNEMU, \u7136\u540e\u91cd\u65b0\u8fd0\u884c.</p> <p>\u8c01\u6765\u6307\u793a\u7a0b\u5e8f\u7684\u7ed3\u675f?</p> <p>\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u8001\u5e08\u544a\u8bc9\u4f60, \u5f53\u7a0b\u5e8f\u6267\u884c\u5230<code>main()</code>\u51fd\u6570\u8fd4\u56de\u5904\u7684\u65f6\u5019, \u7a0b\u5e8f\u5c31\u9000\u51fa\u4e86, \u4f60\u5bf9\u6b64\u6df1\u4fe1\u4e0d\u7591. \u4f46\u4f60\u662f\u5426\u6000\u7591\u8fc7, \u51ed\u4ec0\u4e48\u7a0b\u5e8f\u6267\u884c\u5230<code>main()</code>\u51fd\u6570\u7684\u8fd4\u56de\u5904\u5c31\u7ed3\u675f\u4e86? \u5982\u679c\u6709\u4eba\u544a\u8bc9\u4f60, \u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u8001\u5e08\u7684\u8bf4\u6cd5\u662f\u9519\u7684, \u4f60\u6709\u529e\u6cd5\u6765\u8bc1\u660e/\u53cd\u9a73\u5417? \u5982\u679c\u4f60\u5bf9\u6b64\u611f\u5174\u8da3, \u8bf7\u5728\u4e92\u8054\u7f51\u4e0a\u641c\u7d22\u76f8\u5173\u5185\u5bb9.</p> <p>\u6709\u59cb\u6709\u7ec8 (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003) \uff08\u5bf9\u5e94 \u601d\u8003\u9898\u4e00\uff09</p> <p>\u5bf9\u4e8eGNU/Linux\u4e0a\u7684\u4e00\u4e2a\u7a0b\u5e8f, \u600e\u4e48\u6837\u624d\u7b97\u5f00\u59cb? \u600e\u4e48\u6837\u624d\u7b97\u662f\u7ed3\u675f? \u5bf9\u4e8e\u5728NEMU\u4e2d\u8fd0\u884c\u7684\u7a0b\u5e8f, \u95ee\u9898\u7684\u7b54\u6848\u53c8\u662f\u4ec0\u4e48\u5462?</p> <p>\u4e0e\u6b64\u76f8\u5173\u7684\u95ee\u9898\u8fd8\u6709: NEMU\u4e2d\u4e3a\u4ec0\u4e48\u8981\u6709<code>nemu_trap</code>? \u4e3a\u4ec0\u4e48\u8981\u6709monitor?</p> <p>\u5c31\u6211\u4e4b\u524d\u7684\u77e5\u8bc6\uff0c\u6211\u53ea\u77e5\u9053 UNIX \u4e2d main\u51fd\u6570\u7ed3\u675f\u540e\uff0c\u7a0b\u5e8f\u7684\u7ed3\u675f\u72b6\u6001\u662f\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684 <code>exit()</code> \u7cfb\u7edf\u8c03\u7528\u6765\u6267\u884c\u7684\uff08\u6216\u8005main\u51fd\u6570\u9690\u5f0f\u8c03\u7528\uff09\uff1b\u8fd8\u6709\u5173\u4e8eCTRL+C \u8fd9\u79cd\u4e2d\u65ad\uff0c\u4e5f\u4f1a\u7ec8\u6b62\u7a0b\u5e8f\u7684\u6267\u884c\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u4f1a\u8fdb\u884c\u8d44\u6e90\u6e05\u7406\uff0c\u5305\u62ec\u91ca\u653e\u5206\u914d\u7ed9\u8be5\u7a0b\u5e8f\u7684\u5185\u5b58\u3001\u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u4fdd\u5b58\u7a0b\u5e8f\u7684\u9000\u51fa\u72b6\u6001\u7b49\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u8fdb\u7a0b\u7ba1\u7406\u548c\u8d44\u6e90\u7ba1\u7406\u673a\u5236\uff1f\u64cd\u4f5c\u7cfb\u7edf\u5177\u4f53\u600e\u4e48\u505a\u7684\u5462\uff1f\u5177\u4f53\u901a\u8fc7\u4ec0\u4e48\u6e05\u7406\uff1f<code>atexit()</code> \uff1f</p> <p>\u662f\u5426\u6709\u4ec0\u4e48\u7279\u5b9a\u7684\u51fd\u6570\u548c\u6c47\u7f16\u6307\u4ee4\u6765\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1f\u5177\u4f53\u662f\u4ec0\u4e48\uff1f</p> <p>atexit\u3001exit\u3001return\u3001abort_main\u51fd\u6570\u9000\u51fa\u524d\u4e0d\u5173\u95ed\u6587\u4ef6\u662f\u4e0d\u662f\u4f1a\u6709\u8d44\u6e90\u6cc4\u9732</p> <p>NEMU/NPC \u7684 Ctrl+C \u9000\u51fa - \u5f20\u627f\u8bd1 - \u4e00\u751f\u4e00\u82af\u53cc\u5468\u5206\u4eab\u4f1a</p> <p>\u901a\u8fc7 <code>int atexit(void (*function)(void));</code> \u51fd\u6570\u6ce8\u518cmain\u51fd\u6570\u7ed3\u675f\u4e4b\u540e\u9700\u8981\u6267\u884c\u7684\u4e1c\u897f\uff1a\u4f20\u8fdb\u53bb\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u5c31\u662f\u6267\u884c\u7684\u5185\u5bb9\u3002</p> <p><code>atexit()</code>\u51fd\u6570\uff1a\u5141\u8bb8\u7a0b\u5e8f\u5458\u6ce8\u518c\u5728\u7a0b\u5e8f\u6b63\u5e38\u7ec8\u6b62\u65f6\u6267\u884c\u7684\u51fd\u6570\u3002\u8fd9\u4e9b\u51fd\u6570\u6309\u7167\u6ce8\u518c\u7684\u9006\u5e8f\u6267\u884c\u3002\u8fd9\u662f\u7528\u4e8e\u6267\u884c\u81ea\u5b9a\u4e49\u6e05\u7406\u5de5\u4f5c\u7684\u4e00\u79cd\u673a\u5236\u3002</p> <p>\u5177\u4f53\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid cleanup(void) {\n    printf(\"Cleanup function called.\\n\");\n}\n\nint main(void) {\n    atexit(cleanup); // \u6ce8\u518c\u6e05\u7406\u51fd\u6570\n    printf(\"Program is running.\\n\");\n    return 0; // \u8fd9\u5c06\u9690\u5f0f\u8c03\u7528 exit()\uff0c\u89e6\u53d1 atexit() \u6ce8\u518c\u7684\u51fd\u6570\n}\n</code></pre> <p>return 0 \u4e4b\u540e\u8c03\u7528 <code>exit()</code> \uff0c\u7136\u540e\u518d\u8c03\u7528\u901a\u8fc7\u4e4b\u524d <code>atexit()</code> \u6ce8\u518c\u7684 <code>cleanup</code> \u51fd\u6570</p> <ol> <li> <p>\u7a0b\u5e8f\u5f00\u59cb</p> <p>\u6211\u89c9\u5f97\u4e4b\u524d\u603b\u7ed3\u7684\u5df2\u7ecf\u53ef\u4ee5\u4e86\uff0c\u53ef\u4ee5\u518d\u53c2\u8003 \u5e95\u5c42\u6280\u672f\u6808\uff0cC\u8bed\u8a00\u7684\u6280\u672f\u5185\u5e55</p> </li> </ol>"},{"location":"ysyx/pa/pa1/pa1.html#_50","title":"\u5173\u4e8e\u7f16\u8bd1\u5668","text":"<p>\u4ece\u8868\u8fbe\u5f0f\u6c42\u503c\u7aa5\u63a2\u7f16\u8bd1\u5668</p> <p>\u4f60\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u5df2\u7ecf\u77e5\u9053, \u7f16\u8bd1\u662f\u4e00\u4e2a\u5c06\u9ad8\u7ea7\u8bed\u8a00\u8f6c\u6362\u6210\u673a\u5668\u8bed\u8a00\u7684\u8fc7\u7a0b. \u4f46\u4f60\u662f\u5426\u66fe\u7ecf\u60f3\u8fc7, \u673a\u5668\u662f\u600e\u4e48\u8bfb\u61c2\u4f60\u7684\u4ee3\u7801\u7684? \u56de\u60f3\u4f60\u5b9e\u73b0\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u8fc7\u7a0b, \u4f60\u662f\u5426\u6709\u4ec0\u4e48\u65b0\u7684\u4f53\u4f1a?</p> <p>\u4e8b\u5b9e\u4e0a, \u8bcd\u6cd5\u5206\u6790\u4e5f\u662f\u7f16\u8bd1\u5668\u7f16\u8bd1\u6e90\u4ee3\u7801\u7684\u7b2c\u4e00\u4e2a\u6b65\u9aa4, \u7f16\u8bd1\u5668\u4e5f\u9700\u8981\u4ece\u4f60\u7684\u6e90\u4ee3\u7801\u4e2d\u8bc6\u522b\u51fatoken, \u8fd9\u4e2a\u529f\u80fd\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5b8c\u6210, \u53ea\u4e0d\u8fc7token\u7684\u7c7b\u578b\u66f4\u591a, \u66f4\u590d\u6742\u800c\u5df2. \u8fd9\u4e5f\u89e3\u91ca\u4e86\u4f60\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5728\u6e90\u4ee3\u7801\u4e2d\u63d2\u5165\u4efb\u610f\u6570\u91cf\u7684\u7a7a\u767d\u5b57\u7b26(\u5305\u62ec\u7a7a\u683c, tab, \u6362\u884c), \u800c\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u7684\u8bed\u4e49; \u4f60\u4e5f\u53ef\u4ee5\u5c06\u6240\u6709\u6e90\u4ee3\u7801\u5199\u5230\u4e00\u884c\u91cc\u9762, \u7f16\u8bd1\u4ecd\u7136\u80fd\u591f\u901a\u8fc7.</p> <p>\u4e00\u4e2a\u548c\u8bcd\u6cd5\u5206\u6790\u76f8\u5173\u7684\u6709\u8da3\u7684\u5e94\u7528\u662f\u8bed\u6cd5\u9ad8\u4eae. \u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a, \u4f60\u53ef\u80fd\u5b8c\u5168\u6ca1\u6709\u60f3\u8fc7\u53ef\u4ee5\u81ea\u5df1\u5199\u4e00\u4e2a\u8bed\u6cd5\u9ad8\u4eae\u7684\u7a0b\u5e8f. \u4e8b\u5b9e\u662f, \u8fd9\u4e9b\u770b\u4f3c\u8fd9\u4e48\u795e\u5947\u7684\u4e1c\u897f, \u5176\u5b9e\u4e5f\u6ca1\u90a3\u4e48\u590d\u6742, \u4f60\u73b0\u5728\u786e\u5b9e\u6709\u80fd\u529b\u6765\u5b9e\u73b0\u5b83: \u628a\u6e90\u4ee3\u7801\u770b\u4f5c\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f93\u5165\u5230\u8bed\u6cd5\u9ad8\u4eae\u7a0b\u5e8f\u4e2d, \u5728\u5faa\u73af\u4e2d\u8bc6\u522b\u51fa\u4e00\u4e2atoken\u4e4b\u540e, \u6839\u636etoken\u7c7b\u578b\u7528\u4e0d\u540c\u7684\u989c\u8272\u5c06\u5b83\u7684\u5185\u5bb9\u91cd\u65b0\u8f93\u51fa\u4e00\u904d\u5c31\u53ef\u4ee5\u4e86. \u5982\u679c\u4f60\u6253\u7b97\u5c06\u9ad8\u4eae\u7684\u4ee3\u7801\u8f93\u51fa\u5230\u7ec8\u7aef\u91cc, \u4f60\u53ef\u4ee5\u4f7f\u7528ANSI\u8f6c\u4e49\u7801\u7684\u989c\u8272\u529f\u80fd.</p> <p>\u5728\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u9012\u5f52\u6c42\u503c\u8fc7\u7a0b\u4e2d, \u903b\u8f91\u4e0a\u5176\u5b9e\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5: \u7b2c\u4e00\u4ef6\u4e8b\u662f\u6839\u636etoken\u6765\u5206\u6790\u8868\u8fbe\u5f0f\u7684\u7ed3\u6784(\u5c5e\u4e8eBNF\u4e2d\u7684\u54ea\u4e00\u79cd\u60c5\u51b5), \u7b2c\u4e8c\u4ef6\u4e8b\u624d\u662f\u6c42\u503c. \u5b83\u4eec\u5728\u7f16\u8bd1\u5668\u4e2d\u4e5f\u6709\u5bf9\u5e94\u7684\u8fc7\u7a0b: \u8bed\u6cd5\u5206\u6790\u5c31\u597d\u6bd4\u5206\u6790\u8868\u8fbe\u5f0f\u7684\u7ed3\u6784, \u53ea\u4e0d\u8fc7\u7f16\u8bd1\u5668\u5206\u6790\u7684\u662f\u7a0b\u5e8f\u7684\u7ed3\u6784, \u4f8b\u5982\u54ea\u4e9b\u662f\u51fd\u6570, \u54ea\u4e9b\u662f\u8bed\u53e5\u7b49\u7b49. \u5f53\u7136\u7a0b\u5e8f\u7684\u7ed3\u6784\u8981\u6bd4\u8868\u8fbe\u5f0f\u7684\u7ed3\u6784\u66f4\u590d\u6742, \u56e0\u6b64\u7f16\u8bd1\u5668\u4e00\u822c\u4f1a\u4f7f\u7528\u4e00\u79cd\u6807\u51c6\u7684\u6846\u67b6\u6765\u5206\u6790\u7a0b\u5e8f\u7684\u7ed3\u6784, \u7406\u89e3\u8fd9\u79cd\u6846\u67b6\u9700\u8981\u66f4\u591a\u7684\u77e5\u8bc6, \u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00\u53d9\u8ff0\u4e86. \u53e6\u5916\u5982\u679c\u4f60\u6709\u5174\u8da3, \u53ef\u4ee5\u770b\u770bC\u8bed\u8a00\u8bed\u6cd5\u7684BNF.</p> <p>\u548c\u8868\u8fbe\u5f0f\u6700\u540e\u7684\u6c42\u503c\u76f8\u5bf9\u7684, \u5728\u7f16\u8bd1\u5668\u4e2d\u5c31\u662f\u4ee3\u7801\u751f\u6210. ICS\u7406\u8bba\u8bfe\u4f1a\u6709\u4e13\u95e8\u7684\u7ae0\u8282\u6765\u8bb2\u89e3C\u4ee3\u7801\u548c\u6c47\u7f16\u6307\u4ee4\u7684\u5173\u7cfb, \u5373\u4f7f\u4f60\u4e0d\u4e86\u89e3\u4ee3\u7801\u5177\u4f53\u662f\u600e\u4e48\u751f\u6210\u7684, \u4f60\u4ecd\u7136\u53ef\u4ee5\u7406\u89e3\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb. \u8fd9\u662f\u56e0\u4e3aC\u4ee3\u7801\u5929\u751f\u5c31\u548c\u6c47\u7f16\u4ee3\u7801\u6709\u5bc6\u5207\u7684\u8054\u7cfb, \u9ad8\u6c34\u5e73C\u7a0b\u5e8f\u5458\u7684\u601d\u7ef4\u751a\u81f3\u53ef\u4ee5\u5728C\u4ee3\u7801\u548c\u6c47\u7f16\u4ee3\u7801\u4e4b\u95f4\u76f8\u4e92\u8f6c\u6362. \u5982\u679c\u8981\u6df1\u7a76\u4ee3\u7801\u751f\u6210\u7684\u8fc7\u7a0b, \u4f60\u4e5f\u4e0d\u96be\u731c\u5230\u662f\u7528\u9012\u5f52\u5b9e\u73b0\u7684: \u4f8b\u5982\u8981\u751f\u6210\u4e00\u4e2a\u51fd\u6570\u7684\u4ee3\u7801, \u5c31\u5148\u751f\u6210\u5176\u4e2d\u6bcf\u4e00\u6761\u8bed\u53e5\u7684\u4ee3\u7801, \u7136\u540e\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u5c06\u5b83\u4eec\u8fde\u63a5\u8d77\u6765.</p> <p>\u6211\u4eec\u901a\u8fc7\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u5b9e\u73b0\u6765\u7aa5\u63a2\u7f16\u8bd1\u5668\u7684\u7ec4\u6210, \u662f\u4e3a\u4e86\u843d\u5b9e\u4e00\u4e2a\u9053\u7406: \u5b66\u4e60\u6c7d\u8f66\u5236\u9020\u4e13\u4e1a\u4e0d\u4ec5\u4ec5\u662f\u4e3a\u4e86\u5b66\u4e60\u5f00\u6c7d\u8f66, \u662f\u8981\u5b66\u4e60\u53d1\u52a8\u673a\u600e\u4e48\u8bbe\u8ba1. \u6211\u4eec\u4e5f\u5f3a\u70c8\u63a8\u8350\u4f60\u5728\u5c06\u6765\u4fee\u8bfb\"\u7f16\u8bd1\u539f\u7406\"\u8bfe\u7a0b, \u6df1\u5165\u5b66\u4e60\"\u5982\u4f55\u8bbe\u8ba1\u53d1\u52a8\u673a\".</p>"},{"location":"ysyx/pa/pa1/pa1.html#_51","title":"\u601d\u8003\u9898\u56db","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u65e0\u7b26\u53f7\u7c7b\u578b? (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u6211\u4eec\u5728\u8868\u8fbe\u5f0f\u6c42\u503c\u4e2d\u7ea6\u5b9a, \u6240\u6709\u8fd0\u7b97\u90fd\u662f\u65e0\u7b26\u53f7\u8fd0\u7b97. \u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u7ea6\u5b9a\u5417? \u5982\u679c\u8fdb\u884c\u6709\u7b26\u53f7\u8fd0\u7b97, \u6709\u53ef\u80fd\u4f1a\u53d1\u751f\u4ec0\u4e48\u95ee\u9898?</p> <p>\u9632\u6b62\u6ea2\u51fa\uff1f</p> <p>\u7b26\u53f7\u9519\u8bef\uff1f</p>"},{"location":"ysyx/pa/pa1/pa1.html#_52","title":"\u601d\u8003\u9898\u4e94","text":"<p>\u96640\u7684\u786e\u5207\u884c\u4e3a</p> <p>\u5982\u679c\u751f\u6210\u7684\u8868\u8fbe\u5f0f\u6709\u96640\u884c\u4e3a, \u4f60\u7f16\u5199\u7684\u8868\u8fbe\u5f0f\u751f\u6210\u5668\u7684\u884c\u4e3a\u53c8\u4f1a\u600e\u4e48\u6837\u5462?</p> <p>\u8f6f\u4e2d\u65ad \u4fe1\u53f7</p> <p>signal\u51fd\u6570</p> <p></p> <ol> <li> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a6\u79cd\u4e0d\u540c\u7c7b\u578b\u4fe1\u53f7</p> <p></p> </li> <li> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u56de\u8c03\u51fd\u6570\u5f62\u5982 <code>void (* handler) (int)</code></p> </li> </ol> <p>\u4fe1\u53f7\u5177\u4f53\u5904\u7406\u6d41\u7a0b\uff1a</p> <ol> <li>CPU \u6267\u884c\u9664\u6cd5\u6307\u4ee4 idiv\uff1b</li> <li>\u53d1\u73b0\u9664\u96f6\u5f02\u5e38\uff0cCPU \u6682\u505c\u5f53\u524d\u7a0b\u5e8f\u8fd0\u884c\uff0c\u4fdd\u5b58\u5f53\u524d\u4e0a\u4e0b\u6587\uff0c\u5e76\u5c06\u63a7\u5236\u6743\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u5c06\u4fe1\u53f7 SIGFPE \u53d1\u9001\u7ed9\u51fa\u9519\u7684\u7a0b\u5e8f\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e\u60c5\u51b5\u6267\u884c\u76f8\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff08\u51fd\u6570\uff09\uff1b</li> <li>\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u82e5\u7a0b\u5e8f\u672a\u9000\u51fa\uff0c\u5219\u5c06\u7a0b\u5e8f\u6267\u884c\u6062\u590d\u5230\u4e4b\u524d\u7684\u4e2d\u65ad\u70b9\uff08\u5373 CPU \u4f1a\u91cd\u65b0\u6267\u884c idiv \u6307\u4ee4\uff09\u3002</li> </ol> <p>\u76f4\u63a5\u770b <code>popen</code> \u7684\u8fd4\u56de\u503c\u5c31\u77e5\u9053\u6267\u884c\u662f\u5426\u6210\u529f\u3002</p> <p>\u7f51\u4e0a\u4e86\u89e3\u5230\u7684\uff1a\u76f4\u63a5\u5728\u7f16\u8bd1\u5668\u5c42\u9762\u641e\u5b9a\uff1a</p> <p>\u5728\u5f00\u542f\u8f83\u9ad8\u7ea7\u7f16\u8bd1\u4f18\u5316\u7684\u60c5\u51b5\u4e0b,\u5e38\u91cf\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u5c06\u4f1a\u662f\u7f16\u8bd1\u671f\u884c\u4e3a\uff0c</p> <p>\u56e0\u6b64\u6700\u7ec8\u7f16\u8bd1\u5668\u4f1a\u5f97\u5230\u4e00\u4e2a <code>expr/0</code> \u7684\u8868\u8fbe\u5f0f,\u5c31\u4f1a\u62a5 <code>warning</code></p> <p>\u6240\u4ee5\u53ea\u9700\u8981\u4fee\u6539\u7f16\u8bd1\u7684\u547d\u4ee4,\u52a0\u4e0a <code>-O2 -Wall -Werror</code> \u5c31\u53ef\u4ee5\u8ba9\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u671f\u5c31\u5f97\u5230\u8868\u8fbe\u5f0f\u7684\u503c\uff0c\u5e76 \u4e14\u628a <code>warning</code> \u53d8\u6210 <code>error</code>\uff0c\u7136\u540e\u6839\u636eGCC\u7684\u8fd4\u56de\u503c\u662f\u5426\u4e3a 0 \u5c31\u53ef\u4ee5\u5224\u65ad\u662f\u5426\u5b58\u5728\u9664 0 \u884c\u4e3a\u4e86\uff0c\u5982\u679c\u5b58\u5728 error\u5c31\u76f4\u63a5\u518d\u751f\u6210\u4e00\u4e2a</p>"},{"location":"ysyx/pa/pa1/pa1.html#_53","title":"\u601d\u8003\u9898\u516d","text":"<p>\u5982\u4f55\u63d0\u9ad8\u65ad\u70b9\u7684\u6548\u7387 (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u5982\u679c\u4f60\u5728\u8fd0\u884c\u7a0d\u5927\u4e00\u4e9b\u7684\u7a0b\u5e8f(\u5982microbench)\u7684\u65f6\u5019\u4f7f\u7528\u65ad\u70b9, \u4f60\u4f1a\u53d1\u73b0\u8bbe\u7f6e\u65ad\u70b9\u4e4b\u540e\u4f1a\u660e\u663e\u5730\u964d\u4f4eNEMU\u6267\u884c\u7a0b\u5e8f\u7684\u6548\u7387. \u601d\u8003\u4e00\u4e0b\u8fd9\u662f\u4e3a\u4ec0\u4e48? \u6709\u4ec0\u4e48\u65b9\u6cd5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5417?</p>"},{"location":"ysyx/pa/pa1/pa1.html#_54","title":"\u601d\u8003\u9898\u4e03","text":"<p>\u8c03\u8bd5\u5668\u8bbe\u7f6e\u65ad\u70b9\u7684\u5de5\u4f5c\u65b9\u5f0f\u548c\u4e0a\u8ff0\u901a\u8fc7\u76d1\u89c6\u70b9\u6765\u6a21\u62df\u65ad\u70b9\u7684\u65b9\u6cd5\u5927\u76f8\u5f84\u5ead. \u4e8b\u5b9e\u4e0a, \u65ad\u70b9\u7684\u5de5\u4f5c\u539f\u7406, \u7adf\u7136\u662f\u4e09\u5341\u516d\u8ba1\u4e4b\u4e2d\u7684\"\u5077\u9f99\u8f6c\u51e4\"! </p> <p>\u5982\u679c\u4f60\u60f3\u63ed\u5f00\u8fd9\u4e00\u795e\u79d8\u7684\u9762\u7eb1, \u4f60\u53ef\u4ee5\u9605\u8bfbHow debuggers work. \u4e86\u89e3\u65ad\u70b9\u7684\u5de5\u4f5c\u539f\u7406\u4e4b\u540e, \u53ef\u4ee5\u5c1d\u8bd5\u601d\u8003\u4e0b\u9762\u7684\u4e24\u4e2a\u95ee\u9898.</p> <p>\u4e00\u70b9\u4e5f\u4e0d\u80fd\u957f?</p> <p>x86\u7684<code>int3</code>\u6307\u4ee4\u4e0d\u5e26\u4efb\u4f55\u64cd\u4f5c\u6570, \u64cd\u4f5c\u7801\u4e3a1\u4e2a\u5b57\u8282, \u56e0\u6b64\u6307\u4ee4\u7684\u957f\u5ea6\u662f1\u4e2a\u5b57\u8282. \u8fd9\u662f\u5fc5\u987b\u7684\u5417? \u5047\u8bbe\u6709\u4e00\u79cdx86\u4f53\u7cfb\u7ed3\u6784\u7684\u53d8\u79cdmy-x86, \u9664\u4e86<code>int3</code>\u6307\u4ee4\u7684\u957f\u5ea6\u53d8\u6210\u4e862\u4e2a\u5b57\u8282\u4e4b\u5916, \u5176\u4f59\u6307\u4ee4\u548cx86\u76f8\u540c. \u5728my-x86\u4e2d, \u4e0a\u8ff0\u6587\u7ae0\u4e2d\u7684\u65ad\u70b9\u673a\u5236\u8fd8\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u5417? \u4e3a\u4ec0\u4e48?</p> <p>\u968f\u5fc3\u6240\u6b32\u7684\u65ad\u70b9</p> <p>\u5982\u679c\u628a\u65ad\u70b9\u8bbe\u7f6e\u5728\u6307\u4ee4\u7684\u975e\u9996\u5b57\u8282(\u4e2d\u95f4\u6216\u672b\u5c3e), \u4f1a\u53d1\u751f\u4ec0\u4e48? \u4f60\u53ef\u4ee5\u5728GDB\u4e2d\u5c1d\u8bd5\u4e00\u4e0b, \u7136\u540e\u601d\u8003\u5e76\u89e3\u91ca\u5176\u4e2d\u7684\u7f18\u7531.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_55","title":"\u601d\u8003\u9898\u5427","text":"<p>sanitizer - \u4e00\u79cd\u5e95\u5c42\u7684assert</p> <p>\u6bb5\u9519\u8bef\u4e00\u822c\u662f\u7531\u4e8e\u975e\u6cd5\u8bbf\u5b58\u9020\u6210\u7684, \u4e00\u79cd\u7b80\u5355\u7684\u60f3\u6cd5\u662f, \u5982\u679c\u6211\u4eec\u80fd\u5728\u6bcf\u4e00\u6b21\u8bbf\u5b58\u4e4b\u524d\u90fd\u7528<code>assert()</code>\u68c0\u67e5\u4e00\u4e0b\u5730\u5740\u662f\u5426\u8d8a\u754c, \u5c31\u53ef\u4ee5\u5728\u6bb5\u9519\u8bef\u53d1\u751f\u4e4b\u524d\u6355\u6349\u5230error\u4e86!</p> <p>\u867d\u7136\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee, \u4f46\u8fd9\u6837\u7684\u4ee3\u7801\u5728\u9879\u76ee\u4e2d\u6709\u5f88\u591a, \u5982\u679c\u8981\u6211\u4eec\u624b\u52a8\u5728\u8fd9\u4e9b\u8bbf\u95ee\u4e4b\u524d\u6dfb\u52a0<code>assert()</code>, \u5c31\u592a\u9ebb\u70e6\u4e86. \u4e8b\u5b9e\u4e0a, \u6700\u9002\u5408\u505a\u8fd9\u4ef6\u4e8b\u60c5\u7684\u662f\u7f16\u8bd1\u5668, \u56e0\u4e3a\u5b83\u80fd\u77e5\u9053\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee\u90fd\u5728\u54ea\u91cc. \u800c\u8ba9\u7f16\u8bd1\u5668\u652f\u6301\u8fd9\u4e2a\u529f\u80fd\u7684\u662f\u4e00\u4e2a\u53eb<code>Address Sanitizer</code>\u7684\u5de5\u5177, \u5b83\u53ef\u4ee5\u81ea\u52a8\u5730\u5728\u6307\u9488\u548c\u6570\u7ec4\u7684\u8bbf\u95ee\u4e4b\u524d\u63d2\u5165\u7528\u6765\u68c0\u67e5\u662f\u5426\u8d8a\u754c\u7684\u4ee3\u7801. GCC\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>-fsanitize=address</code>\u7684\u7f16\u8bd1\u9009\u9879\u6765\u542f\u7528\u5b83. menuconfig\u5df2\u7ecf\u4e3a\u5927\u5bb6\u51c6\u5907\u597d\u76f8\u5e94\u9009\u9879\u4e86, \u4f60\u53ea\u9700\u8981\u6253\u5f00\u5b83:</p> <pre><code>Build Options\n  [*] Enable address sanitizer\n</code></pre> <p>\u7136\u540e\u6e05\u9664\u7f16\u8bd1\u7ed3\u679c\u5e76\u91cd\u65b0\u7f16\u8bd1\u5373\u53ef.</p> <p>\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u6545\u610f\u89e6\u53d1\u4e00\u4e2a\u6bb5\u9519\u8bef, \u7136\u540e\u9605\u8bfb\u4e00\u4e0bAddress Sanitizer\u7684\u62a5\u9519\u4fe1\u606f. \u4e0d\u8fc7\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u7a0b\u5e8f\u7684\u6027\u80fd\u6709\u6240\u4e0b\u964d, \u8fd9\u662f\u56e0\u4e3a\u5bf9\u6bcf\u4e00\u6b21\u8bbf\u5b58\u8fdb\u884c\u68c0\u67e5\u4f1a\u5e26\u6765\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500. \u4f46\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u5e2e\u52a9\u4f60\u8bca\u65adbug\u7684\u5de5\u5177, \u4ed8\u51fa\u8fd9\u4e00\u70b9\u4ee3\u4ef7\u8fd8\u662f\u5f88\u503c\u5f97\u7684, \u800c\u4e14\u4f60\u8fd8\u662f\u53ef\u4ee5\u5728\u65e0\u9700\u8c03\u8bd5\u7684\u65f6\u5019\u5c06\u5176\u5173\u95ed.</p> <p>\u4e8b\u5b9e\u4e0a, \u9664\u4e86\u5730\u5740\u8d8a\u754c\u7684\u9519\u8bef\u4e4b\u5916, Address Sanitizer\u8fd8\u80fd\u68c0\u67e5use-after-free\u7684\u9519\u8bef (\u5373\"\u91ca\u653e\u4ece\u5806\u533a\u7533\u8bf7\u7684\u7a7a\u95f4\u540e\u4ecd\u7136\u7ee7\u7eed\u4f7f\u7528\"\u7684\u9519\u8bef), \u4f60\u77e5\u9053\u5b83\u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e00\u529f\u80fd\u7684\u5417?</p> <p>\u8ba9Address Sanitizer\u8f93\u51fa\u66f4\u7cbe\u786e\u7684\u51fa\u9519\u4f4d\u7f6e</p> <p>\u5982\u679c\u5728\u6dfb\u52a0GDB\u8c03\u8bd5\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b\u6253\u5f00Address Sanitizer, \u5176\u62a5\u9519\u4fe1\u606f\u8fd8\u4f1a\u6307\u51fa\u53d1\u751f\u9519\u8bef\u7684\u5177\u4f53\u4ee3\u7801\u4f4d\u7f6e, \u4e3a\u95ee\u9898\u7684\u5b9a\u4f4d\u63d0\u4f9b\u4fbf\u5229.</p> <p>\u66f4\u591a\u7684sanitizer</p> <p>\u4e8b\u5b9e\u4e0a, GCC\u8fd8\u652f\u6301\u66f4\u591a\u7684sanitizer, \u5b83\u4eec\u53ef\u4ee5\u68c0\u67e5\u5404\u79cd\u4e0d\u540c\u7684\u9519\u8bef, \u4f60\u53ef\u4ee5\u5728<code>man gcc</code>\u4e2d\u67e5\u9605<code>-fsanitize</code>\u76f8\u5173\u7684\u9009\u9879. \u5982\u679c\u4f60\u7684\u7a0b\u5e8f\u5728\u5404\u79cdsanitizer\u5f00\u542f\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u80fd\u6b63\u786e\u5de5\u4f5c, \u5c31\u8bf4\u660e\u4f60\u7684\u7a0b\u5e8f\u8fd8\u662f\u6709\u4e00\u5b9a\u8d28\u91cf\u7684.</p>"},{"location":"ysyx/pa/pa1/pa1.html#_56","title":"\u601d\u8003\u9898\u4e5d","text":"<p>NEMU\u7684\u524d\u4e16\u4eca\u751f</p> <p>\u4f60\u5df2\u7ecf\u5bf9NEMU\u7684\u5de5\u4f5c\u65b9\u5f0f\u6709\u6240\u4e86\u89e3\u4e86. \u4e8b\u5b9e\u4e0a\u5728NEMU\u8bde\u751f\u4e4b\u524d, NEMU\u66fe\u7ecf\u6709\u4e00\u6bb5\u65f6\u95f4\u5e76\u4e0d\u53ebNEMU, \u800c\u662f\u53ebNDB(NJU Debugger), \u540e\u6765\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u624d\u6539\u540d\u4e3aNEMU. \u5982\u679c\u4f60\u60f3\u77e5\u9053\u8fd9\u4e00\u6bb5\u53f2\u524d\u7684\u79d8\u5bc6, \u4f60\u9996\u5148\u9700\u8981\u4e86\u89e3\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898: \u6a21\u62df\u5668(Emulator)\u548c\u8c03\u8bd5\u5668(Debugger)\u6709\u4ec0\u4e48\u4e0d\u540c? \u66f4\u5177\u4f53\u5730, \u548cNEMU\u76f8\u6bd4, GDB\u5230\u5e95\u662f\u5982\u4f55\u8c03\u8bd5\u7a0b\u5e8f\u7684</p>"},{"location":"ysyx/pa/pa1/pa1.html#makefile_1","title":"\u5173\u4e8e Makefile \u7684\u7ec4\u7ec7\u7ed3\u6784","text":"<ol> <li> <p>\u4e3b\u6784\u5efa\u7cfb\u7edf (Makefile)</p> <ul> <li> <p>Sanity Check: \u68c0\u67e5NEMU\u4ed3\u5e93\u7684\u6839\u76ee\u5f55\u3002</p> </li> <li> <p>Include Configuration</p> <p>: \u5305\u542b\u7531menuconfig\u751f\u6210\u7684\u53d8\u91cf\u548c\u89c4\u5219\u3002</p> <ul> <li><code>auto.conf</code>: \u81ea\u52a8\u914d\u7f6e\u6587\u4ef6\u3002</li> <li><code>auto.conf.cmd</code>: \u547d\u4ee4\u914d\u7f6e\u6587\u4ef6\u3002</li> </ul> </li> <li> <p>Variable Extraction</p> <p>: \u4ecemenuconfig\u63d0\u53d6\u53d8\u91cf\u3002</p> <ul> <li><code>GUEST_ISA</code>: \u5ba2\u6237ISA\u3002</li> <li><code>ENGINE</code>: \u5f15\u64ce\u3002</li> <li><code>NAME</code>: \u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d\u3002</li> </ul> </li> <li> <p>Filelist Inclusion</p> <p>: \u5305\u542b\u6240\u6709 <code>filelist.mk</code> \u6587\u4ef6\u4ee5\u5408\u5e76\u6587\u4ef6\u5217\u8868\u3002</p> <ul> <li><code>FILELIST_MK</code>: \u641c\u7d22<code>src</code>\u76ee\u5f55\u4e0b\u7684<code>filelist.mk</code>\u6587\u4ef6\u3002</li> </ul> </li> <li> <p>Source Files Filtering</p> <p>: \u8fc7\u6ee4\u6e90\u6587\u4ef6\uff0c\u6392\u9664\u9ed1\u540d\u5355\u4e2d\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u3002</p> <ul> <li><code>DIRS-BLACKLIST-y</code>: \u9ed1\u540d\u5355\u4e2d\u7684\u76ee\u5f55\u3002</li> <li><code>SRCS-BLACKLIST-y</code>: \u9ed1\u540d\u5355\u4e2d\u7684\u6e90\u6587\u4ef6\u3002</li> <li><code>SRCS-y</code>: \u5305\u542b\u7684\u6e90\u6587\u4ef6\u3002</li> <li><code>SRCS</code>: \u6700\u7ec8\u7684\u6e90\u6587\u4ef6\u5217\u8868\u3002</li> </ul> </li> <li> <p>Compiler and Options</p> <p>: \u63d0\u53d6\u7f16\u8bd1\u5668\u548c\u9009\u9879\u3002</p> <ul> <li><code>CC</code>: \u7f16\u8bd1\u5668\u3002</li> <li><code>CFLAGS_BUILD</code>: \u6784\u5efa\u76f8\u5173\u7684\u7f16\u8bd1\u9009\u9879\u3002</li> <li><code>CFLAGS_TRACE</code>: \u8ddf\u8e2a\u76f8\u5173\u7684\u7f16\u8bd1\u9009\u9879\u3002</li> <li><code>CFLAGS</code>: \u603b\u7f16\u8bd1\u9009\u9879\u3002</li> <li><code>LDFLAGS</code>: \u94fe\u63a5\u9009\u9879\u3002</li> </ul> </li> <li> <p>Include Menuconfig Rules: \u5305\u542bmenuconfig\u7684\u89c4\u5219\u3002</p> </li> <li> <p>Conditional Inclusion</p> <p>: \u6839\u636e\u914d\u7f6e\u6761\u4ef6\u5305\u542b\u4e0d\u540c\u7684Makefile\u3002</p> <ul> <li><code>CONFIG_TARGET_AM</code>: \u5982\u679c\u5b9a\u4e49\uff0c\u5219\u5305\u542b<code>AM_HOME</code>\u7684Makefile\u3002</li> <li>\u5426\u5219\uff0c\u5305\u542bNEMU\u7684<code>native.mk</code>\u3002</li> </ul> </li> </ul> </li> <li> <p>\u6784\u5efa\u914d\u7f6e\u548c\u5de5\u5177\u914d\u7f6e (config.mk)</p> <ul> <li>\u5305\u542b Kconfig \u76f8\u5173\u7684\u89c4\u5219\u548c\u5de5\u5177\u914d\u7f6e\u3002</li> <li>\u63d0\u4f9b\u8f85\u52a9\u51fd\u6570\u548c\u8b66\u544a\u4fe1\u606f\u3002</li> </ul> </li> <li> <p>\u539f\u751f\u89c4\u5219\u914d\u7f6e native.mk)</p> <ul> <li>\u5b9a\u4e49\u7f16\u8bd1\u548c\u94fe\u63a5\u7684\u901a\u7528\u89c4\u5219\u3002</li> <li>\u5305\u62ec\u9884\u5904\u7406\u8f93\u51fa\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u5b9a\u4e49\u3002</li> </ul> </li> <li> <p>\u6784\u5efa\u5de5\u5177\u548c\u8f85\u52a9\u5de5\u5177 build.mk</p> <ul> <li>\u5b9a\u4e49\u7f16\u8bd1\u548c\u94fe\u63a5\u7684\u901a\u7528\u89c4\u5219\u3002</li> <li>\u5305\u62ec\u9884\u5904\u7406\u8f93\u51fa\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u5b9a\u4e49\u3002</li> </ul> </li> </ol>"},{"location":"ysyx/pa/pa2/pa2.html","title":"PA2","text":""},{"location":"ysyx/pa/pa2/pa2.html#-","title":"\u6982\u8ff0 - \u7b80\u5355\u590d\u6742\u7684\u673a\u5668: \u51af\u8bfa\u4f9d\u66fc\u8ba1\u7b97\u673a\u7cfb\u7edf","text":"<ul> <li>task PA2.1: \u5b9e\u73b0\u66f4\u591a\u7684\u6307\u4ee4, \u5728NEMU\u4e2d\u8fd0\u884c\u5927\u90e8\u5206<code>cpu-tests</code></li> <li>task PA2.2: \u5b9e\u73b0klib\u548c\u57fa\u7840\u8bbe\u65bd</li> <li>task PA2.3: \u8fd0\u884cFCEUX, \u63d0\u4ea4\u5b8c\u6574\u7684\u5b9e\u9a8c\u62a5\u544a</li> </ul> <p>\u518d\u914d\u5408\u5b9e\u9645\u7684\u8bb2\u89e3\uff1f\u6bd4\u5982 Linux \u4e2d\u662f\u600e\u4e48\u505a\u8fd9\u4e9b\u5185\u5bb9\u7684\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_1","title":"\u4e0d\u505c\u8ba1\u7b97\u7684\u673a\u5668","text":""},{"location":"ysyx/pa/pa2/pa2.html#_2","title":"\u6307\u4ee4\u5468\u671f","text":"<p>\u5728PA1\u4e2d, \u6211\u4eec\u5df2\u7ecf\u89c1\u8bc6\u5230\u6700\u7b80\u5355\u7684\u8ba1\u7b97\u673aTRM\u7684\u5de5\u4f5c\u65b9\u5f0f:</p> <pre><code>while (1) {\n  \u4ecePC\u6307\u793a\u7684\u5b58\u50a8\u5668\u4f4d\u7f6e\u53d6\u51fa\u6307\u4ee4;\n  \u6267\u884c\u6307\u4ee4; \n  \u66f4\u65b0PC;\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u8c08\u8c08\u8fd9\u4e2a\u8fc7\u7a0b, \u4e5f\u5c31\u662f, CPU\u7a76\u7adf\u662f\u600e\u4e48\u6267\u884c\u4e00\u6761\u6307\u4ee4\u7684. \u5bf9\u4e8e\u5927\u90e8\u5206\u6307\u4ee4\u6765\u8bf4, \u6267\u884c\u5b83\u4eec\u90fd\u53ef\u4ee5\u62bd\u8c61\u6210\u53d6\u6307-\u8bd1\u7801-\u6267\u884c\u7684\u6307\u4ee4\u5468\u671f. </p>"},{"location":"ysyx/pa/pa2/pa2.html#yemu","title":"YEMU","text":"<p>\u8fd9\u4e2a\u8ba1\u7b97\u673a\u67094\u4e2a8\u4f4d\u7684\u5bc4\u5b58\u5668, \u4e00\u4e2a4\u4f4dPC, \u4ee5\u53ca\u4e00\u6bb516\u5b57\u8282\u7684\u5185\u5b58. \u5b83\u652f\u6301R\u578b\u548cM\u578b\u4e24\u79cd\u6307\u4ee4\u683c\u5f0f, 4\u6761\u6307\u4ee4. \u5176\u6307\u4ee4\u624b\u518c\u5982\u4e0b:</p> <pre><code>                                                     4  2  0\n            |                        |        | +----+--+--+\nmov   rt,rs | R[rt] &lt;- R[rs]         | R-type | |0000|rt|rs|\n            |                        |        | +----+--+--+\n            |                        |        | +----+--+--+\nadd   rt,rs | R[rt] &lt;- R[rs] + R[rt] | R-type | |0001|rt|rs|\n            |                        |        | +----+--+--+\n            |                        |        | +----+--+--+\nload  addr  | R[0] &lt;- M[addr]        | M-type | |1110| addr|\n            |                        |        | +----+--+--+\n            |                        |        | +----+--+--+\nstore addr  | M[addr] &lt;- R[0]        | M-type | |1111| addr|\n            |                        |        | +----+--+--+\n</code></pre> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\n#define NREG 4\n#define NMEM 16\n\n// \u5b9a\u4e49\u6307\u4ee4\u683c\u5f0f\ntypedef union {\n  struct { uint8_t rs : 2, rt : 2, op : 4; } rtype;\n  struct { uint8_t addr : 4      , op : 4; } mtype;\n  uint8_t inst;\n} inst_t;\n\n#define DECODE_R(inst) uint8_t rt = (inst).rtype.rt, rs = (inst).rtype.rs\n#define DECODE_M(inst) uint8_t addr = (inst).mtype.addr\n\nuint8_t pc = 0;       // PC, C\u8bed\u8a00\u4e2d\u6ca1\u67094\u4f4d\u7684\u6570\u636e\u7c7b\u578b, \u6211\u4eec\u91c7\u75288\u4f4d\u7c7b\u578b\u6765\u8868\u793a\nuint8_t R[NREG] = {}; // \u5bc4\u5b58\u5668\nuint8_t M[NMEM] = {   // \u5185\u5b58, \u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u8ba1\u7b97z = x + y\u7684\u7a0b\u5e8f\n  0b11100110,  // load  6#     | R[0] &lt;- M[y]\n  0b00000100,  // mov   r1, r0 | R[1] &lt;- R[0]\n  0b11100101,  // load  5#     | R[0] &lt;- M[x]\n  0b00010001,  // add   r0, r1 | R[0] &lt;- R[0] + R[1]\n  0b11110111,  // store 7#     | M[z] &lt;- R[0]\n  0b00010000,  // x = 16\n  0b00100001,  // y = 33\n  0b00000000,  // z = 0\n};\n\nint halt = 0; // \u7ed3\u675f\u6807\u5fd7\n\n// \u6267\u884c\u4e00\u6761\u6307\u4ee4\nvoid exec_once() {\n  inst_t this;\n  this.inst = M[pc]; // \u53d6\u6307\n  switch (this.rtype.op) {\n  //  \u64cd\u4f5c\u7801\u8bd1\u7801       \u64cd\u4f5c\u6570\u8bd1\u7801           \u6267\u884c\n    case 0b0000: { DECODE_R(this); R[rt]   = R[rs];   break; }\n    case 0b0001: { DECODE_R(this); R[rt]  += R[rs];   break; }\n    case 0b1110: { DECODE_M(this); R[0]    = M[addr]; break; }\n    case 0b1111: { DECODE_M(this); M[addr] = R[0];    break; }\n    default:\n      printf(\"Invalid instruction with opcode = %x, halting...\\n\", this.rtype.op);\n      halt = 1;\n      break;\n  }\n  pc ++; // \u66f4\u65b0PC\n}\n\nint main() {\n  while (1) {\n    exec_once();\n    if (halt) break;\n  }\n  printf(\"The result of 16 + 33 is %d\\n\", M[7]);\n  return 0;\n}\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7406\u89e3YEMU\u5982\u4f55\u6267\u884c\u7a0b\u5e8f</p> <p>YEMU\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u7b80\u5316\u7248\u7684NEMU, \u5b83\u4eec\u7684\u539f\u7406\u662f\u76f8\u901a\u7684, \u56e0\u6b64\u4f60\u9700\u8981\u7406\u89e3YEMU\u662f\u5982\u4f55\u6267\u884c\u7a0b\u5e8f\u7684. \u5177\u4f53\u5730, \u4f60\u9700\u8981</p> <ul> <li>\u753b\u51fa\u5728YEMU\u4e0a\u6267\u884c\u7684\u52a0\u6cd5\u7a0b\u5e8f\u7684\u72b6\u6001\u673a</li> <li>\u901a\u8fc7RTFSC\u7406\u89e3YEMU\u5982\u4f55\u6267\u884c\u4e00\u6761\u6307\u4ee4</li> </ul> <p>\u601d\u8003\u4e00\u4e0b, \u4ee5\u4e0a\u4e24\u8005\u6709\u4ec0\u4e48\u8054\u7cfb?</p> <ol> <li> <p>\u753b\u51fa\u5728YEMU\u4e0a\u6267\u884c\u7684\u52a0\u6cd5\u7a0b\u5e8f\u7684\u72b6\u6001\u673a</p> <p>\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u72b6\u6001\u673a\u7684\u89c6\u89d2\u6765\u89e3\u91ca\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u672c\u8d28\u4e86:</p> <p>\u7ed9\u5b9a\u4e00\u4e2a\u7a0b\u5e8f, \u628a\u5b83\u653e\u5230\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u4e2d, \u5c31\u76f8\u5f53\u4e8e\u5728\u72b6\u6001\u6570\u91cf\u4e3a<code>N</code>\u7684\u72b6\u6001\u8f6c\u79fb\u56fe\u4e2d\u6307\u5b9a\u4e86\u4e00\u4e2a\u521d\u59cb\u72b6\u6001, \u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u5c31\u662f\u4ece\u8fd9\u4e2a\u521d\u59cb\u72b6\u6001\u5f00\u59cb, \u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4, \u5c31\u4f1a\u8fdb\u884c\u4e00\u6b21\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb. </p> <p>\u4ece\u8fd9\u4e2a\u521d\u59cb\u72b6\u6001\u5f00\u59cb --&gt; \u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4 --&gt; \u8fdb\u884c\u4e00\u6b21\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb\u3002</p> <p>\u8981\u8868\u793a\u7684\u6709\uff0cPC\uff0cr0\uff0cr1\uff0cM[7]\uff0chalt</p> <p>(3, 16, 33, 0, 0) -&gt; (3, 49, 33, 0, 0) -&gt; (4, 49, 33, 0, 0) -&gt; (4, 49, 33, 49, 0) -&gt; (5, 49, 33, 49, 1)</p> </li> <li> <p>\u901a\u8fc7RTFSC\u7406\u89e3YEMU\u5982\u4f55\u6267\u884c\u4e00\u6761\u6307\u4ee4</p> <ol> <li> <p>\u53d6\u6307</p> <p>\u5728\u5185\u5b58 <code>M[pc]</code> \u5904\u53d6\u51fa\u8981\u6267\u884c\u7684\u6307\u4ee4</p> </li> <li> <p>\u8bd1\u7801</p> <p>\u6839\u636e <code>op</code> \u89e3\u6790\u6307\u4ee4\u7684\u529f\u80fd</p> </li> <li> <p>\u6267\u884c</p> <p><code>switch</code> \u4ee3\u7801\u5757\u4e2d\uff0c\u7684\u6267\u884c\u5185\u5bb9</p> </li> <li> <p>\u66f4\u65b0PC</p> <p>pc++</p> </li> </ol> </li> </ol> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#rtfm","title":"RTFM","text":""},{"location":"ysyx/pa/pa2/pa2.html#rtfsc2","title":"RTFSC(2)","text":"<p>\u7b80\u5355\u8fc7\u4e00\u904d\uff1a</p> <p></p> <p></p> <p>\u4e0b\u9762\u4ee5\u4e00\u6761\u6307\u4ee4\u4e3a\u4f8b\uff0c\u6574\u7406\u5176\u5728 <code>NEMU</code> \u4e2d\u7684\u6267\u884c\u6d41\u7a0b\u3002</p> <pre><code>si\n0x80000008: 01 02 c5 03 lbu a0, 16(t0)\n</code></pre> <p>\u4e3b\u8981\u5206\u6790\u51fd\u6570\uff1a<code>exec_once()</code></p> <pre><code>static void exec_once(Decode *s, vaddr_t pc) {\n  s-&gt;pc = pc;\n  s-&gt;snpc = pc;\n  isa_exec_once(s);\n  cpu.pc = s-&gt;dnpc;\n#ifdef CONFIG_ITRACE\n  char *p = s-&gt;logbuf;\n  p += snprintf(p, sizeof(s-&gt;logbuf), FMT_WORD \":\", s-&gt;pc);\n  int ilen = s-&gt;snpc - s-&gt;pc;\n  int i;\n  uint8_t *inst = (uint8_t *)&amp;s-&gt;isa.inst.val;\n  for (i = ilen - 1; i &gt;= 0; i --) {\n    p += snprintf(p, 4, \" %02x\", inst[i]);\n  }\n  int ilen_max = MUXDEF(CONFIG_ISA_x86, 8, 4);\n  int space_len = ilen_max - ilen;\n  if (space_len &lt; 0) space_len = 0;\n  space_len = space_len * 3 + 1;\n  memset(p, ' ', space_len);\n  p += space_len;\n\n#ifndef CONFIG_ISA_loongarch32r\n  void disassemble(char *str, int size, uint64_t pc, uint8_t *code, int nbyte);\n  disassemble(p, s-&gt;logbuf + sizeof(s-&gt;logbuf) - p,\n      MUXDEF(CONFIG_ISA_x86, s-&gt;snpc, s-&gt;pc), (uint8_t *)&amp;s-&gt;isa.inst.val, ilen);\n#else\n  p[0] = '\\0'; // the upstream llvm does not support loongarch32r\n#endif\n#endif\n}\n</code></pre> <pre><code>int isa_exec_once(Decode *s) {\n   s-&gt;isa.inst.val = inst_fetch(&amp;s-&gt;snpc, 4);\n   return decode_exec(s);\n }        \n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#instruction-fetch-if","title":"\u53d6\u6307(instruction fetch, IF)","text":"<p>\u901a\u8fc7\u51fd\u6570\uff1a</p> <pre><code>static inline uint32_t inst_fetch(vaddr_t *pc, int len) {\n  uint32_t inst = vaddr_ifetch(*pc, len);\n  (*pc) += len;\n  return inst;\n}\nword_t vaddr_ifetch(vaddr_t addr, int len) {\n    return paddr_read(addr, len);                       \n}\n</code></pre> <p>\u6307\u4ee4\u957f\u5ea6\u5728RISC-V\u4e2d\u90fd\u662f\u56fa\u5b9a\u7684\uff0cRV32\uff0c4\u4e2a Byte</p> <p>\u901a\u8fc7 <code>Decode</code> \u7ed3\u6784\u4f53\u5b58 <code>PC</code></p> <pre><code>typedef struct Decode {\n  vaddr_t pc;\n  vaddr_t snpc; // static next pc\n  vaddr_t dnpc; // dynamic next pc\n  ISADecodeInfo isa;\n  IFDEF(CONFIG_ITRACE, char logbuf[128]);\n} Decode;\n NORMAL  include/cpu/decode.h \n</code></pre> <p>\u7531\u6b64\u53ef\u77e5\uff0c\u53d6\u6307\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u8bbf\u5b58\u64cd\u4f5c\u3002</p> <p>\u53d6\u5f97\u6307\u4ee4\uff0c\u5c06\u5176\u5b58\u50a8\u5728 <code>Decode s-&gt;isa.inst.val</code> \u91cc\u3002 </p> <p>\u4e4b\u540e\u5c31\u662f\u5206\u6790\u8fd9\u4e2a\u4e86\u3002</p> <p>\u5177\u4f53\u5730, <code>exec_once()</code>\u63a5\u53d7\u4e00\u4e2a<code>Decode</code>\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\u6307\u9488<code>s</code>, \u8fd9\u4e2a\u7ed3\u6784\u4f53\u7528\u4e8e\u5b58\u653e\u5728\u6267\u884c\u4e00\u6761\u6307\u4ee4\u8fc7\u7a0b\u4e2d\u6240\u9700\u7684\u4fe1\u606f, \u5305\u62ec\u6307\u4ee4\u7684PC, \u4e0b\u4e00\u6761\u6307\u4ee4\u7684PC\u7b49. </p> <p>\u8fd8\u6709\u4e00\u4e9b\u4fe1\u606f\u662fISA\u76f8\u5173\u7684, NEMU\u7528\u4e00\u4e2a\u7ed3\u6784\u7c7b\u578b<code>ISADecodeInfo</code>\u6765\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u62bd\u8c61, \u5177\u4f53\u7684\u5b9a\u4e49\u5728<code>nemu/src/isa/$ISA/include/isa-def.h</code>\u4e2d. </p> <p><code>exec_once()</code>\u4f1a\u5148\u628a\u5f53\u524d\u7684PC\u4fdd\u5b58\u5230<code>s</code>\u7684\u6210\u5458<code>pc</code>\u548c<code>snpc</code>\u4e2d, \u5176\u4e2d<code>s-&gt;pc</code>\u5c31\u662f\u5f53\u524d\u6307\u4ee4\u7684PC, \u800c<code>s-&gt;snpc</code>\u5219\u662f\u4e0b\u4e00\u6761\u6307\u4ee4\u7684PC, \u8fd9\u91cc\u7684<code>snpc</code>\u662f\"static next PC\"\u7684\u610f\u601d.</p>"},{"location":"ysyx/pa/pa2/pa2.html#instruction-decode-id","title":"\u8bd1\u7801(instruction decode, ID)","text":"<pre><code>static int decode_exec(Decode *s) {\n  int rd = 0;\n  word_t src1 = 0, src2 = 0, imm = 0;\n  s-&gt;dnpc = s-&gt;snpc;\n\n  /* \u5982\u4f55\u5339\u914d\u76f8\u5e94\u6307\u4ee4\uff0c\u5e76\u6267\u884c\u76f8\u5e94\u6307\u4ee4 */\n#define INSTPAT_INST(s) ((s)-&gt;isa.inst.val)\n#define INSTPAT_MATCH(s, name, type, ... /* execute body */ ) { \\\n  decode_operand(s, &amp;rd, &amp;src1, &amp;src2, &amp;imm, concat(TYPE_, type)); \\\n  __VA_ARGS__ ; \\\n}\n\n  /* \u6307\u4ee4\u6a21\u5f0f\u5339\u914d\u548c\u6267\u884c */\n  INSTPAT_START();\n  INSTPAT(\"??????? ????? ????? ??? ????? 00101 11\", auipc  , U, R(rd) = s-&gt;pc + imm);\n  INSTPAT(\"??????? ????? ????? 100 ????? 00000 11\", lbu    , I, R(rd) = Mr(src1 + imm, 1));\n  INSTPAT(\"??????? ????? ????? 000 ????? 01000 11\", sb     , S, Mw(src1 + imm, 1, src2));\n\n  INSTPAT(\"0000000 00001 00000 000 00000 11100 11\", ebreak , N, NEMUTRAP(s-&gt;pc, R(10))); // R(10) is $a0\n  INSTPAT(\"??????? ????? ????? ??? ????? ????? ??\", inv    , N, INV(s-&gt;pc));\n  INSTPAT_END();\n\n  R(0) = 0; // reset $zero to 0\n\n  return 0; \n}\n</code></pre> <p>\u8bd1\u7801\u64cd\u4f5c\u7684\u76ee\u7684\u662f\u5f97\u5230\u6307\u4ee4\u7684\u64cd\u4f5c\u548c\u64cd\u4f5c\u5bf9\u8c61\u3002</p> <p>\u7531 <code>risc-v</code> \u624b\u518c\u53ef\u77e5\uff0c\u8fd9\u662f\u7531\u6307\u4ee4\u7684 <code>opcode</code> \u51b3\u5b9a\u7684\u3002</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u6839\u636e\u6307\u4ee4\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u4ece\u53d6\u51fa\u7684\u6307\u4ee4\u4e2d\u8bc6\u522b\u51fa\u76f8\u5e94\u7684<code>opcode</code>\u5373\u53ef\u3002</p> <p>\u548cYEMU\u76f8\u6bd4, NEMU\u4f7f\u7528\u4e00\u79cd\u62bd\u8c61\u5c42\u6b21\u66f4\u9ad8\u7684\u8bd1\u7801\u65b9\u5f0f: \u6a21\u5f0f\u5339\u914d,</p> <p>NEMU\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u6a21\u5f0f\u5b57\u7b26\u4e32\u6765\u6307\u5b9a\u6307\u4ee4\u4e2d<code>opcode</code>\u3002</p> <p>\u8981\u89e3\u6790\u8fd9\u6761\u6307\u4ee4\uff1a</p> <pre><code>INSTPAT_START();\nINSTPAT(\"??????? ????? ????? 100 ????? 00000 11\", lbu, I, R(rd) = Mr(src1 + imm, 1));\nINSTPAT_END();\n</code></pre> <pre><code>INSTPAT(\u6a21\u5f0f\u5b57\u7b26\u4e32, \u6307\u4ee4\u540d\u79f0, \u6307\u4ee4\u7c7b\u578b, \u6307\u4ee4\u6267\u884c\u64cd\u4f5c);\n</code></pre> <p><code>\u6307\u4ee4\u540d\u79f0</code>\u5728\u4ee3\u7801\u4e2d\u4ec5\u5f53\u6ce8\u91ca\u4f7f\u7528, \u4e0d\u53c2\u4e0e\u5b8f\u5c55\u5f00;</p> <p><code>\u6307\u4ee4\u7c7b\u578b</code>\u7528\u4e8e\u540e\u7eed\u8bd1\u7801\u8fc7\u7a0b; </p> <p>\u800c<code>\u6307\u4ee4\u6267\u884c\u64cd\u4f5c</code>\u5219\u662f\u901a\u8fc7C\u4ee3\u7801\u6765\u6a21\u62df\u6307\u4ee4\u6267\u884c\u7684\u771f\u6b63\u884c\u4e3a.</p> <p>\u8fdb\u4e00\u6b65\u5c55\u5f00\uff1a</p> <pre><code>{ const void ** __instpat_end = &amp;&amp;__instpat_end_;\ndo {\n  uint64_t key, mask, shift;\n  pattern_decode(\"??????? ????? ????? 100 ????? 00000 11\", 38, &amp;key, &amp;mask, &amp;shift);\n  if ((((uint64_t)s-&gt;isa.inst.val &gt;&gt; shift) &amp; mask) == key) {\n    {\n      decode_operand(s, &amp;rd, &amp;src1, &amp;src2, &amp;imm, TYPE_I);\n      R(rd) = Mr(src1 + imm, 1)\n    }\n    goto *(__instpat_end);\n  }\n} while (0);\n// ...\n__instpat_end_: ; }\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684<code>&amp;&amp;__instpat_end_</code>\u4f7f\u7528\u4e86GCC\u63d0\u4f9b\u7684\u6807\u7b7e\u5730\u5740\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u6269\u5c55\u529f\u80fd, <code>goto</code>\u8bed\u53e5\u5c06\u4f1a\u8df3\u8f6c\u5230\u6700\u540e\u7684<code>__instpat_end_</code>\u6807\u7b7e. </p> <p>\u6b64\u5916, <code>pattern_decode()</code>\u51fd\u6570\u5728<code>nemu/include/cpu/decode.h</code>\u4e2d\u5b9a\u4e49, \u5b83\u7528\u4e8e\u5c06\u6a21\u5f0f\u5b57\u7b26\u4e32\u8f6c\u6362\u62103\u4e2a\u6574\u578b\u53d8\u91cf.</p> <p><code>pattern_decode()</code>\u51fd\u6570\u5c06\u6a21\u5f0f\u5b57\u7b26\u4e32\u4e2d\u7684<code>0</code>\u548c<code>1</code>\u62bd\u53d6\u5230\u6574\u578b\u53d8\u91cf<code>key</code>\u4e2d, </p> <p><code>mask</code>\u8868\u793a<code>key</code>\u7684\u63a9\u7801, </p> <p>\u800c<code>shift</code>\u5219\u8868\u793a<code>opcode</code>\u8ddd\u79bb\u6700\u4f4e\u4f4d\u7684\u6bd4\u7279\u6570\u91cf, </p> <pre><code>#define macro(i) \\\n   if ((i) &gt;= len) goto finish; \\\n   else { \\\n     char c = str[i]; \\\n     if (c != ' ') { \\\n       Assert(c == '0' || c == '1' || c == '?', \\\n           \"invalid character '%c' in pattern string\", c); \\\n       __key  = (__key  &lt;&lt; 1) | (c == '1' ? 1 : 0); \\\n       __mask = (__mask &lt;&lt; 1) | (c == '?' ? 0 : 1); \\\n       __shift = (c == '?' ? __shift + 1 : 0); \\\n     } \\\n   }\n//....\u5177\u4f53\u770b\u4ee3\u7801\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>key</code> <code>mask</code> <code>shift</code> \u8fdb\u4e00\u6b65\u89e3\u91ca\uff1a</p> <p>\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8bb0\u4f4f\uff0c\u8fd9\u4e9b\u503c\u901a\u5e38\u7528\u4e8e\u4f4d\u64cd\u4f5c\u6216\u6a21\u5f0f\u5339\u914d\u7b97\u6cd5\u4e2d\uff0c\u4ee5\u540e\u6216\u8bb8\u4f1a\u5e38\u7528\u3002</p> <ul> <li> <p><code>key</code>\uff1a\u8868\u793a\u4e00\u4e2a\u4f4d\u6a21\u5f0f\u6216\u5bc6\u94a5\uff0c\u7528\u4e8e\u5339\u914d\u6216\u52a0\u5bc6\u6570\u636e\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u5b83\u662f\u7531\u5b57\u7b26\u4e32\u4e2d <code>'1'</code> \u7684\u4f4d\u7f6e\u7ec4\u6210\u7684\u4f4d\u4e32\u3002</p> <p>\u4e5f\u5c31\u662f\uff1a <code>'1'-&gt;1 '0/?'-&gt;0</code></p> </li> <li> <p><code>mask</code>\uff1a\u901a\u5e38\u7528\u4e8e\u6307\u5b9a\u54ea\u4e9b\u4f4d\u662f\u91cd\u8981\u7684\u6216\u5e94\u8be5\u88ab\u8003\u8651\u7684\u3002\uff08\u4e5f\u5c31\u662f\u90a3\u4e9b 0 \u548c 1\uff0c? \u4e0d\u7ba1\uff09</p> <p>\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u5b83\u7531\u5b57\u7b26\u4e32\u4e2d\u7684 <code>'1'</code> \u548c <code>'?'</code> \u7684\u4f4d\u7f6e\u7ec4\u6210\u3002</p> <p>\u5176\u4e2d <code>'1/0'</code> \u5bf9\u5e94\u63a9\u7801\u4f4d\u4e3a <code>1</code>\uff0c\u800c <code>'?'</code> \u5bf9\u5e94\u63a9\u7801\u4f4d\u4e3a <code>0</code>\u3002</p> </li> <li> <p><code>shift</code>\uff1a</p> <p>\u8868\u793a<code>opcode</code>\u8ddd\u79bb\u6700\u4f4e\u4f4d\u7684\u6bd4\u7279\u6570\u91cf, </p> </li> </ul> <p>\u4e3e\u4e0a\u9762\u4f8b\u5b50\u6765\u8bf4\uff0c</p> <pre><code>key   = 0x4003;\nmask  = 0x707f;\nshift = 0; \n</code></pre> <p>\u8fd9\u91cc\u6709\u70b9\u4e0d\u7406\u89e3\uff0c\u4ec0\u4e48\u53eb\u8868\u793a opcode \u8ddd\u79bb\u6700\u4f4e\u4f4d\u7684\u6bd4\u7279\u6570\u91cf, \u4e00\u76f4\u90fd\u662f0\uff0c\u522b\u7684ISA\u8fd9\u91cc\u53ef\u80fd\u4e0d\u662f0\u7684\u610f\u601d\u662f\u5417\uff1f</p> <p>\u4e4b\u540e\u8fdb\u884c\u5224\u65ad\uff1a</p> <pre><code>if ((((uint64_t)s-&gt;isa.inst.val &gt;&gt; shift) &amp; mask) == key) {\n</code></pre> <p>\u68c0\u67e5\u7ecf\u8fc7\u4f4d\u79fb\u548c\u63a9\u7801\u64cd\u4f5c\u540e\u7684\u6307\u4ee4\u503c\u662f\u5426\u4e0e\u9884\u671f\u7684 <code>key</code> \u76f8\u5339\u914d\u3002</p> <p>\u5982\u679c\u5339\u914d\uff0c\u8bf4\u660e\u5f53\u524d\u6307\u4ee4\u7b26\u5408\u7ed9\u5b9a\u7684\u6a21\u5f0f\uff0c\u89e3\u7801\u8fc7\u7a0b\u5c06\u7ee7\u7eed\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u662f\u89e3\u7801\u64cd\u4f5c\u6570\u5e76\u8bbe\u7f6e\u5bc4\u5b58\u5668 <code>rd</code> \u7684\u503c\uff09\u3002</p> <p>\u73b0\u5728\u901a\u8fc7\u4e4b\u524d\u7684\u6211\u4eec\u77e5\u9053\u4e86\u6307\u4ee4\u7684\u5177\u4f53\u884c\u4e3a\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u64cd\u4f5c\u5bf9\u8c61\u3002(\u54ea\u4e2a\u5bc4\u5b58\u5668\u548c\u7acb\u5373\u6570\u591a\u5c11)</p> <p>\u6846\u67b6\u4ee3\u7801\u901a\u8fc7\u51fd\u6570 <code>decode_operand()</code>\u8fdb\u4e00\u6b65\u5b9e\u73b0\u3002</p> <p>\u6839\u636e\u4f20\u5165\u7684\u6307\u4ee4\u7c7b\u578b <code>type</code> \u6765\u8fdb\u884c\u64cd\u4f5c\u6570\u7684\u8bd1\u7801\u3002</p> <p>\u8bd1\u7801\u7ed3\u679c\u5c06\u8bb0\u5f55\u5230\u51fd\u6570\u53c2\u6570 <code>rd</code>\uff0c<code>src1</code>\uff0c <code>src2</code> \uff0c<code>imm</code>\u4e2d\uff0c</p> <p>\u5206\u522b\u4ee3\u8868\u76ee\u7684\u64cd\u4f5c\u6570\u7684\u5bc4\u5b58\u5668\u53f7\u7801, \u4e24\u4e2a\u6e90\u64cd\u4f5c\u6570\u548c\u7acb\u5373\u6570\u3002</p> <p>\u8bb2\u4e49\uff1a</p> <p>\u6211\u4eec\u4f1a\u53d1\u73b0, \u7c7b\u4f3c\u5bc4\u5b58\u5668\u548c\u7acb\u5373\u6570\u8fd9\u4e9b\u64cd\u4f5c\u6570, \u5176\u5b9e\u662f\u975e\u5e38\u5e38\u89c1\u7684\u64cd\u4f5c\u6570\u7c7b\u578b. \u4e3a\u4e86\u8fdb\u4e00\u6b65\u5b9e\u73b0\u64cd\u4f5c\u6570\u8bd1\u7801\u548c\u6307\u4ee4\u8bd1\u7801\u7684\u89e3\u8026, \u6211\u4eec\u5bf9\u8fd9\u4e9b\u64cd\u4f5c\u6570\u7684\u8bd1\u7801\u8fdb\u884c\u4e86\u62bd\u8c61\u5c01\u88c5:</p> <ul> <li>\u6846\u67b6\u4ee3\u7801\u5b9a\u4e49\u4e86<code>src1R()</code>\u548c<code>src2R()</code>\u4e24\u4e2a\u8f85\u52a9\u5b8f, \u7528\u4e8e\u5bc4\u5b58\u5668\u7684\u8bfb\u53d6\u7ed3\u679c\u8bb0\u5f55\u5230\u76f8\u5e94\u7684\u64cd\u4f5c\u6570\u53d8\u91cf\u4e2d</li> <li>\u6846\u67b6\u4ee3\u7801\u8fd8\u5b9a\u4e49\u4e86<code>immI</code>\u7b49\u8f85\u52a9\u5b8f, \u7528\u4e8e\u4ece\u6307\u4ee4\u4e2d\u62bd\u53d6\u51fa\u7acb\u5373\u6570</li> </ul> <p>\u6240\u4ee5\uff0c\u6309\u7167\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5f97\u5230\uff1a</p> <p></p> <p>\u4ece\u8fd9\u91cc\u5927\u6982\u4e5f\u77e5\u9053\u4e4b\u540e\u8981\u505a\u4ec0\u4e48\u4e86\u3002\u6dfb\u52a0\u6307\u4ee4\u3002</p> <ul> <li> <p>\u8fdb\u4e00\u6b65\u6307\u4ee4\u5206\u6790 <code>src1\u3001src2\u3001imm</code> \u548c \u5b8f <code>BIT</code> <code>BITMASK</code> <code>SEXT</code></p> <pre><code>01 02 c5 03 lbu a0, 16(t0)\n// I\u578b\u6307\u4ee4\n</code></pre> <p><code>R(rd) = Mr(src1 + imm, 1)</code> \u8bbf\u5b58\u64cd\u4f5c\uff0c\u5b9e\u9645\u770b\u5185\u90e8\u7684 <code>src</code> \u548c  <code>imm</code></p> <pre><code>#define src1R() do { *src1 = R(rs1); } while (0)\n#define src2R() do { *src2 = R(rs2); } while (0)\n#define immI() do { *imm = SEXT(BITS(i, 31, 20), 12); } while(0)\n#define immU() do { *imm = SEXT(BITS(i, 31, 12), 20) &lt;&lt; 12; } while(0)\n#define immS() do { *imm = (SEXT(BITS(i, 31, 25), 7) &lt;&lt; 5) | BITS(i, 11, 7); } while(0)\n\nstatic void decode_operand(Decode *s, int *rd, word_t *src1, word_t *src2, word_t *imm, int type) {\n  uint32_t i = s-&gt;isa.inst.val;\n  int rs1 = BITS(i, 19, 15);\n  int rs2 = BITS(i, 24, 20);\n  *rd     = BITS(i, 11, 7);\n  switch (type) {\n    case TYPE_I: src1R();          immI(); break;\n    case TYPE_U:                   immU(); break;\n    case TYPE_S: src1R(); src2R(); immS(); break;\n  }\n}\n</code></pre> <p>\u9996\u5148\uff0c\u901a\u8fc7 <code>BITS</code> \u63d0\u53d6\u5230\u6307\u4ee4\u4e2d\u768415\u523019\u4f4d\uff0c\u4e5f\u5c31\u662f <code>rs1</code>\u3002  <code>rs2</code>\u3001<code>rd</code> \u540c\u7406\u53ef\u5f97\u3002</p> <p>\u770b\u770b\u662f\u5b8f\u5177\u4f53\u662f\u600e\u4e48\u505a\u7684\uff1a</p> <pre><code>#define BITMASK(bits) ((1ull &lt;&lt; (bits)) - 1)\n#define BITS(x, hi, lo) (((x) &gt;&gt; (lo)) &amp; BITMASK((hi) - (lo) + 1)) // similar to x[hi:lo] in verilog\n#define SEXT(x, len) ({ struct { int64_t n : len; } __x = { .n = x }; (uint64_t)__x.n; })    \n</code></pre> <ul> <li> <p><code>BITMASK</code></p> <p>\u751f\u6210\u63a9\u7801\uff0c\u6216\u8005\u8bf4\u751f\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\u3002\u503c\u4e3a1\u7684\u4f4d\uff0c\u5c31\u662f\u6211\u4eec\u8981\u5173\u6ce8\u7684\u3002</p> <p>\u6bd4\u5982\u8bf4\u4e0a\u9762\u7684 19 - 15 + 1 = 5\uff0c\u90a3\u5c31\u662f ((1ull &lt;&lt; 5 ) - 1)</p> <p>\u4e5f\u5c31\u662f <code>0b100000 - 1</code> \u5373 <code>0b0...00011111</code> \u4e5f\u5c31\u662f\u53ea\u770b 5 \u4f4d\u3002</p> </li> <li> <p><code>BITS</code></p> <p>\u63a5\u7740\uff0c\u5c06\u6307\u4ee4\u53f3\u79fb <code>lo</code> \u4f4d\uff0c\u5728\u8fd9\u91cc\u4e5f\u5c31\u662f\u53f3\u79fb15\u4f4d\uff0c</p> <p>??????? ????? ????? 100 ????? 00000 11 \u53d8\u6210 </p> <p>??????? ????? ?????\uff0c\u524d\u9762\u8865\u96f6\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e0e\u4e0a\u521a\u5f00\u59cb\u5f97\u5230\u7684 <code>mask</code> \uff0c\u5373:</p> <p>??????? ????? ?????</p> <p>0..................0011111\uff0c <code>a &amp; 1 = a</code>\u3002</p> <p>\u7531\u6b64\u5f97\u5230 <code>rs1</code> \u7684 <code>5</code> \u4f4d\uff0c\u7136\u540e\u6362\u7b97\u6210\u5341\u8fdb\u5236\u6570\u3002</p> <p>\u4e4b\u540e\u8fdb\u4e00\u6b65\u5c55\u5f00\uff0c<code>src1R()</code> \u8fdb\u4e00\u6b65\u5c55\u5f00</p> <p>\u4e5f\u5c31\u662f\u8bbf\u95ee\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u4e86\u3002</p> </li> <li> <p>\u6700\u540e\uff1a\u5b8f <code>SEXT</code></p> <p><code>#define immI() do { *imm = SEXT(BITS(i, 31, 20), 12); } while(0)</code></p> <p>\u8fd9\u91cc\u540c\u4e0a\u53ef\u5f97\uff0c<code>12</code> \u4f4d\uff0c\u5173\u952e\u5728\u8fd9\u91cc\uff1a</p> <pre><code>// \u8fd9\u6837\u770b\u65b9\u4fbf\u70b9\uff0c\n#define SEXT(x, len) (\n{ \n    struct { \n        int64_t n : len; \n    } __x = { .n = x }; \n    (uint64_t)__x.n;\n})    \n</code></pre> <ul> <li> <p>\u5b83\u521b\u5efa\u4e00\u4e2a\u533f\u540d\u7684\u7ed3\u6784\u4f53\u53d8\u91cf<code>__x</code>\uff0c\u8be5\u7ed3\u6784\u4f53\u6709\u4e00\u4e2a\u540d\u4e3a<code>n</code>\u7684\u4f4d\u57df\uff0c\u5176\u957f\u5ea6\u4e3a<code>len</code>\u4f4d\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2a12\u4f4d\u7684\u4f4d\u57df</p> </li> <li> <p>\u5c06\u503c <code>x</code> \u8d4b\u7ed9 <code>n</code>\uff0c\u7531\u4e8e <code>n</code> \u662f\u7b26\u53f7\u4f4d\u5b57\u6bb5\uff0c\u56e0\u6b64 <code>x</code>\u7684\u9ad8\u4f4d\uff08\u7b26\u53f7\u4f4d\uff09\u5c06\u88ab\u590d\u5236\u5230<code>__x.n</code>\u7684\u6240\u6709\u4f4d\u4e0a\u3002</p> <p>\u5c06 <code>x</code> \u7684 <code>12</code> \u4f4d\u5185\u5bb9\uff0c\u8d4b\u7ed9<code>n</code>\u3002</p> <p>\u518d\u7b26\u53f7\u6269\u5c55\uff1aeg. <code>0x800</code> ---&gt; <code>0xFFFF....FF800</code></p> </li> <li> <p>\u6700\u540e\uff0c\u5c06 <code>__x.n</code> \u5f3a\u5236\u8f6c\u6362\u4e3a <code>uint64_t</code> \u7c7b\u578b\uff0c\u8fd9\u5c06\u8fd4\u56de\u7b26\u53f7\u6269\u5c55\u540e\u768464\u4f4d\u503c\u3002</p> <p>\u8fd9\u4e00\u6b65\u5b9e\u9645\u4e0a\u5e76\u4e0d\u4f1a\u6539\u53d8 <code>n</code> \u7684\u4f4d\u6a21\u5f0f\uff0c\u4f46\u4f1a\u6539\u53d8\u5b83\u7684 \u89e3\u91ca\u65b9\u5f0f \uff1a\u4ece\u4e00\u4e2a\u6709\u7b26\u53f7\u7684\u4f4d\u5b57\u6bb5\u53d8\u4e3a\u4e00\u4e2a\u65e0\u7b26\u53f7\u7684\u6574\u6570\u3002</p> </li> </ul> <p>\u7efc\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u5b8f\uff0c\u63a5\u53d7\u4e00\u4e2a\u6307\u5b9a\u4f4d\u6570 <code>len</code> \u7684\u4e8c\u8fdb\u5236\u6570 <code>x</code> \uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u6570\u8fdb\u884c64\u4f4d\u7684\u7b26\u53f7\u6269\u5c55\uff0c\u90a3\u4e3a\u4ec0\u4e48\u8981 len \u5462\uff1f\u8981\u662f\u4f20\u8fdb\u6765\u7684 <code>x</code> \u548c <code>len</code> \u4f4d\u6570\u4e0d\u4e00\u6837\u5462\uff1f</p> <ul> <li>\u7075\u6d3b\u6027\uff1a<code>len</code>\u53c2\u6570\u5141\u8bb8<code>SEXT</code>\u5b8f\u5904\u7406\u4e0d\u540c\u957f\u5ea6\u7684\u4f4d\u5b57\u6bb5\u3002\u8fd9\u610f\u5473\u7740\u5b8f\u53ef\u4ee5\u7528\u4e8e\u4e0d\u540c\u957f\u5ea6\u7684\u7acb\u5373\u6570\uff0c\u63d0\u4f9b\u66f4\u5927\u7684\u7075\u6d3b\u6027\u3002</li> <li>\u5b89\u5168\u6027\uff1a\u901a\u8fc7\u663e\u5f0f\u6307\u5b9a\u4f4d\u5b57\u6bb5\u7684\u957f\u5ea6\uff0c\u53ef\u4ee5\u907f\u514d\u5728\u63d0\u53d6\u548c\u7b26\u53f7\u6269\u5c55\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u9519\u8bef\u3002\u5982\u679c<code>x</code>\u7684\u957f\u5ea6\u4e0e<code>len</code>\u4e0d\u5339\u914d\uff0c\u90a3\u4e48\u7b26\u53f7\u6269\u5c55\u7684\u7ed3\u679c\u53ef\u80fd\u4e0d\u6b63\u786e\uff0c\u56e0\u6b64<code>len</code>\u53c2\u6570\u786e\u4fdd\u4e86\u64cd\u4f5c\u7684\u51c6\u786e\u6027\u3002</li> <li>\u517c\u5bb9\u6027\uff1aRISC-V\u6307\u4ee4\u96c6\u4e2d\u53ef\u80fd\u6709\u4e0d\u540c\u957f\u5ea6\u7684\u7acb\u5373\u6570\uff0c<code>len</code>\u53c2\u6570\u4f7f\u5f97<code>SEXT</code>\u5b8f\u53ef\u4ee5\u9002\u7528\u4e8e\u5404\u79cd\u4e0d\u540c\u957f\u5ea6\u7684\u7acb\u5373\u6570\uff0c\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u517c\u5bb9\u6027\u3002</li> </ul> <p>GPT\u7684\u611f\u89c9\u5e9f\u8bdd\u3002\u4e0d\u5339\u914d\u5c31 ub</p> </li> </ul> </li> </ul> <p>\u518d\u56de\u5230\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u5b8f\u5728\u505a\u7684\u4e8b\u60c5\uff0c\u5c31\u662fC\u8bed\u8a00\u4e2d\u600e\u4e48\u6a21\u62dfRISC-V\u7684\u8fd9\u79cd\u6269\u5c55\uff08Verilog\uff09\uff0c\u771f\u662f\u5929\u624d\u554a\uff01nice : )</p> <p>\u73b0\u5728\u6211\u4eec\u7b97\u662f\u641e\u660e\u767d\u4e86\u5177\u4f53\u7684\u8bd1\u7801\u8fc7\u7a0b\u3002</p> <p>\u4e4b\u540e\u7f16\u5199\u66f4\u591a\u7684\u6307\u4ee4\uff0c\u4e5f\u5c31\u8f7b\u800c\u6613\u4e3e\u4e86\u3002</p> <ul> <li> <p>\u8865\u5145\u4e00\u4e9b\uff0c\u5173\u4e8e\u8bbf\u95ee\u5bc4\u5b58\u5668</p> <p>\u6211\u4eec\u8bbf\u95ee\u5bc4\u5b58\u5668\u901a\u8fc7\u8fd9\u4e2a\u5b8f\uff1a<code>#define R(i) gpr(i)</code> \uff0c<code>gpr(i)</code>\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u6570\u7ec4\u6765\u6a21\u62df\u7684\u5bc4\u5b58\u5668\u7684\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e0b\u6807\u6765\u8bbf\u95ee\u5230\u662f\u54ea\u4e2a\u5bc4\u5b58\u5668\uff0c\u600e\u4e48\u8ba1\u7b97\u51fa\u4e0b\u6807\u7684\u503c\uff1f</p> <p>\u901a\u8fc7\u5904\u7406\u4f4d\u64cd\u4f5c\u7684\u4e24\u4e2a <code>BITMASK</code> \u548c <code>BITS</code> \u5b8f\uff0c\u63d0\u53d6\u6307\u4ee4\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d <code>rs1\u3001rs2\u3001rd</code> \u90a3\u51e0\u4f4d\uff0c\u5373\u53ef\u83b7\u53d6\u4e0b\u6807\uff0c\u77e5\u9053\u662f\u54ea\u4e2a\u5bc4\u5b58\u5668\u3002\u8fd9\u662f\u7531\u4e8e <code>risc-v</code> \u5bc4\u5b58\u5668\u662f\u76f4\u63a5\u901a\u8fc7\u6570\u5b57\u547d\u540d\u3002</p> <p></p> </li> </ul> <p>\u8bb2\u4e49\uff1a</p> <ul> <li> <p><code>decode_operand</code>\u4e2d\u7528\u5230\u4e86\u5b8f<code>BITS</code>\u548c<code>SEXT</code></p> <p>\u5b83\u4eec\u5747\u5728<code>nemu/include/macro.h</code>\u4e2d\u5b9a\u4e49, \u5206\u522b\u7528\u4e8e\u4f4d\u62bd\u53d6\u548c\u7b26\u53f7\u6269\u5c55</p> </li> <li> <p><code>decode_operand</code>\u4f1a\u9996\u5148\u7edf\u4e00\u5bf9\u76ee\u6807\u64cd\u4f5c\u6570\u8fdb\u884c\u5bc4\u5b58\u5668\u64cd\u4f5c\u6570\u7684\u8bd1\u7801, </p> <p>\u5373\u8c03\u7528<code>*rd = BITS(i, 11, 7)</code>, \u4e0d\u540c\u7684\u6307\u4ee4\u7c7b\u578b\u53ef\u4ee5\u89c6\u60c5\u51b5\u4f7f\u7528<code>rd</code></p> <p>\u5373\u4ece <code>i</code> \u91cc\u9762\u63d0\u53d6 7 \u5230 11 \u4f4d\u7684\u5185\u5bb9\u3002</p> </li> <li> <p>\u5728\u6a21\u5f0f\u5339\u914d\u8fc7\u7a0b\u7684\u6700\u540e\u6709\u4e00\u6761<code>inv</code>\u7684\u89c4\u5219, </p> <p>\u8868\u793a\"\u82e5\u524d\u9762\u6240\u6709\u7684\u6a21\u5f0f\u5339\u914d\u89c4\u5219\u90fd\u65e0\u6cd5\u6210\u529f\u5339\u914d, \u5219\u5c06\u8be5\u6307\u4ee4\u89c6\u4e3a\u975e\u6cd5\u6307\u4ee4</p> </li> </ul> <p>\u5206\u6790\u5b8c\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u53c8\u4e00\u6b21\u611f\u89c9\u5230 <code>risc-v</code> \u67b6\u6784\u7684\u7b80\u6d01\u548c\u4f18\u79c0\u3002</p> <p>opcode \u4ee3\u8868\u6307\u4ee4\u64cd\u4f5c\u7801\uff0cimm \u4ee3\u8868\u7acb\u5373\u6570\uff0cfunct3 \u548c funct7 \u4ee3\u8868\u6307\u4ee4\u5bf9\u5e94\u7684\u529f\u80fd\uff0crs1\u3001rs2 \u548c rd \u5219\u5206\u522b\u4ee3\u8868\u6e90\u5bc4\u5b58\u5668 1\u3001\u6e90\u5bc4\u5b58\u5668 2 \u4ee5\u53ca\u76ee\u6807\u5bc4\u5b58\u5668\u3002</p> <p><code>risc-v</code> \u7684\u4e00\u4e2a\u6307\u4ee4\u63d0\u4f9b\u4e09\u4e2a\u5bc4\u5b58\u5668\u64cd\u4f5c\u6570\uff0c\u4e0d\u50cf x86 \u4e00\u6837\u8ba9\u6e90\u64cd\u4f5c\u6570\u548c\u76ee\u7684\u64cd\u4f5c\u6570\u5171\u4eab\u4e00\u4e2a\u5b57\u6bb5\uff1a<code>MOV \u76ee\u7684\u64cd\u4f5c\u6570\uff0c\u6e90\u64cd\u4f5c\u6570</code>\uff0c\u76f8\u6bd4 x86 \u6307\u4ee4\uff0c<code>risc-v</code> \u51cf\u5c11\u4e86\u8f6f\u4ef6\u7684\u7a0b\u5e8f\u64cd\u4f5c\u3002</p> <p>\u8fd8\u6709\uff0c\u6e90\u5bc4\u5b58\u5668 <code>rs1\u3001rs2\u3001rd</code>\uff0c\u90fd\u8bbe\u8ba1\u56fa\u5b9a\u5728\u6240\u6709 <code>risc-v</code> \u6307\u4ee4\u540c\u6837\u7684\u4f4d\u7f6e\u4e0a\uff0c\u6307\u4ee4\u8bd1\u7801\u76f8\u5bf9\u7b80\u5355\u3002</p> <p>\u90a3\uff0c\u6307\u4ee4\u5728 CPU \u6d41\u6c34\u7ebf\u4e2d\u6267\u884c\u65f6\uff0c\u53ef\u4ee5\u5148\u5f00\u59cb\u8bbf\u95ee\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u518d\u5b8c\u6210\u6307\u4ee4\u89e3\u7801\uff1f</p> <ul> <li> <p>\u601d\u8003\u9898 </p> <p>\u7acb\u5373\u6570\u80cc\u540e\u7684\u6545\u4e8b(1)</p> <p>\u6846\u67b6\u4ee3\u7801\u901a\u8fc7<code>inst_fetch()</code>\u51fd\u6570\u8fdb\u884c\u53d6\u6307, \u522b\u770b\u8fd9\u91cc\u5c31\u8fd9\u4e48\u4e00\u884c\u4ee3\u7801, \u5176\u5b9e\u80cc\u540e\u9690\u85cf\u7740\u9488\u5bf9\u5b57\u8282\u5e8f\u7684\u614e\u91cd\u8003\u8651. </p> <p>\u5927\u90e8\u5206\u540c\u5b66\u7684\u4e3b\u673a\u90fd\u662fx86\u5c0f\u7aef\u673a, \u5f53\u4f60\u4f7f\u7528\u9ad8\u7ea7\u8bed\u8a00\u6216\u8005\u6c47\u7f16\u8bed\u8a00\u5199\u4e86\u4e00\u4e2a32\u4f4d\u5e38\u6570<code>0x1234</code>\u7684\u65f6\u5019, \u5728\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u4ee3\u7801\u4e2d, \u8fd9\u4e2a\u5e38\u6570\u5bf9\u5e94\u7684\u5b57\u8282\u5e8f\u5217\u5982\u4e0b(\u5047\u8bbe\u8fd9\u4e2a\u5e38\u6570\u5728\u5185\u5b58\u4e2d\u7684\u8d77\u59cb\u5730\u5740\u662fx):</p> <pre><code>x   x+1  x+2  x+3\n+----+----+----+----+\n| 34 | 12 | 00 | 00 |\n+----+----+----+----+\n</code></pre> <p>\u800c\u5927\u591a\u6570PC\u673a\u90fd\u662f\u5c0f\u7aef\u67b6\u6784(\u6211\u4eec\u76f8\u4fe1\u6ca1\u6709\u540c\u5b66\u4f1a\u4f7f\u7528IBM\u5927\u578b\u673a\u6765\u505aPA), \u5f53NEMU\u8fd0\u884c\u7684\u65f6\u5019,</p> <pre><code>imm = inst_fetch(pc, 4);\n</code></pre> <p>\u8fd9\u884c\u4ee3\u7801\u4f1a\u5c06<code>34 12 00 00</code>\u8fd9\u4e2a\u5b57\u8282\u5e8f\u5217\u539f\u5c01\u4e0d\u52a8\u5730\u4ece\u5185\u5b58\u8bfb\u5165<code>imm</code>\u53d8\u91cf\u4e2d, \u4e3b\u673a\u7684CPU\u4f1a\u6309\u7167\u5c0f\u7aef\u65b9\u5f0f\u6765\u89e3\u91ca\u8fd9\u4e00\u5b57\u8282\u5e8f\u5217, \u4e8e\u662f\u4f1a\u5f97\u5230<code>0x1234</code>, \u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\u7ed3\u679c.</p> <p>Motorola 68k\u7cfb\u5217\u7684\u5904\u7406\u5668\u90fd\u662f\u5927\u7aef\u67b6\u6784\u7684. \u73b0\u5728\u95ee\u9898\u6765\u4e86, \u8003\u8651\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5:</p> <ul> <li>\u5047\u8bbe\u6211\u4eec\u9700\u8981\u5c06NEMU\u8fd0\u884c\u5728Motorola 68k\u7684\u673a\u5668\u4e0a(\u628aNEMU\u7684\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210Motorola 68k\u7684\u673a\u5668\u7801)</li> <li>\u5047\u8bbe\u6211\u4eec\u9700\u8981\u628aMotorola 68k\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u7684ISA\u52a0\u5165\u5230NEMU\u4e2d</li> </ul> <p>\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b, \u4f60\u9700\u8981\u6ce8\u610f\u4e9b\u4ec0\u4e48\u95ee\u9898? \u4e3a\u4ec0\u4e48\u4f1a\u4ea7\u751f\u8fd9\u4e9b\u95ee\u9898? \u600e\u4e48\u89e3\u51b3\u5b83\u4eec?</p> <p>\u4e8b\u5b9e\u4e0a\u4e0d\u4ec5\u4ec5\u662f\u7acb\u5373\u6570\u7684\u8bbf\u95ee, \u957f\u5ea6\u5927\u4e8e1\u5b57\u8282\u7684\u5185\u5b58\u8bbf\u95ee\u90fd\u9700\u8981\u8003\u8651\u7c7b\u4f3c\u7684\u95ee\u9898. \u6211\u4eec\u5728\u8fd9\u91cc\u628a\u95ee\u9898\u7edf\u4e00\u629b\u51fa\u6765, \u4ee5\u540e\u5c31\u4e0d\u518d\u5355\u72ec\u8ba8\u8bba\u4e86.</p> <ol> <li> <p>\u5c06NEMU\u8fd0\u884c\u5728Motorola 68k \u4e0a</p> <p>NEMU\u8fd0\u884c\u5728\u6211\u7684\u4e3b\u673a\u4e0a\u65f6\uff0c\u6211\u7684\u4e3b\u673a\u6309\u7167\u5c0f\u7aef\u5e8f\u5217\u8fde\u7eed\u8bfb\u53d6\u5185\u5b58\u4e2d4\u4e2abyte\u7684\u5185\u5bb9\u8fdb\u53d8\u91cf\uff0c\u800c\u8fd0\u884c\u5728Motorola 68k \u4e0a\u4f1a\u6309\u7167\u5927\u7aef\u65b9\u5f0f\u6765\u8bfb\u53d6\u8fd94\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u6bcf\u6b21\u6d89\u53ca\u5230\u8bbf\u5b58\u548c\u7acb\u5373\u6570\u90fd\u5f97\u81ea\u5df1\u624b\u52a8\u5730\u8f6c\u6362\u5927\u5c0f\u7aef\u3002</p> <p>\u5177\u4f53\uff1a</p> <pre><code>uint32_t little2big(uint32_t value) {\n    return ((value &amp; 0x000000FF) &lt;&lt; 24) |\n           ((value &amp; 0x0000FF00) &lt;&lt;  8) |\n           ((value &amp; 0x00FF0000) &gt;&gt;  8) |\n           ((value &amp; 0xFF000000) &gt;&gt; 24); \n}\n\nbool is_little_endian(void) {\n    int i = 1;\n    unsigned char *c = (unsigned char *)&amp;i;\n    return *c ? true : false;\n}\n\nint main(void) {\n    uint32_t test = 0x12345678;\n    char *first = (char *)&amp;test;\n    printf(\"low--%x %x %x %x--high\\n\",\n           *first, *(first + 1), *(first + 2), *(first + 3));\n\n    test = little2big(test);\n    first = (char *)&amp;test;\n    printf(\"low--%x %x %x %x--high\\n\",\n           *first, *(first + 1), *(first + 2), *(first + 3));\n    return 0;\n}\n</code></pre> </li> <li> <p>\u628aMotorola 68k\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u7684ISA\u52a0\u5165\u5230NEMU\u4e2d</p> <p>\u5305\u62ec\u6307\u4ee4\u8bd1\u7801\u3001\u6267\u884c\uff08\u5927\u5c0f\u7aef\u7684\u5904\u7406\uff09\u3002</p> <pre><code>uint32_t little2big_new(uint8_t *ptr) {\n    return (uint32_t)((ptr[0] &lt;&lt; 24) | (ptr[1] &lt;&lt; 16) | (ptr[2] &lt;&lt; 8) | (ptr[3]));\n}\n</code></pre> </li> </ol> <p>\u7acb\u5373\u6570\u80cc\u540e\u7684\u6545\u4e8b(2)</p> <p>mips32\u548criscv32\u7684\u6307\u4ee4\u957f\u5ea6\u53ea\u670932\u4f4d, \u56e0\u6b64\u5b83\u4eec\u4e0d\u80fd\u50cfx86\u90a3\u6837, \u628aC\u4ee3\u7801\u4e2d\u768432\u4f4d\u5e38\u6570\u76f4\u63a5\u7f16\u7801\u5230\u4e00\u6761\u6307\u4ee4\u4e2d. \u601d\u8003\u4e00\u4e0b, mips32\u548criscv32\u5e94\u8be5\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898</p> <p>206-MIPS\u6307\u4ee4\u7b80\u4ecb - \u7b2c\u4e8c\u8bb2 \u6307\u4ee4\u7cfb\u7edf\u4f53\u7cfb\u7ed3\u6784 | Coursera</p> <p>\u770b\u4e4b\u524d\u7b14\u8bb0\u3002\u5370\u8c61\u4e2dMIPS\u662f\u7acb\u5373\u6570\u5de6\u79fb\u7684\uff0c\u7136\u540e\u8fdb\u884c\u62fc\u63a5\u3002</p> <p>\u200b   </p> </li> <li> <p>\u589e\u52a0\u9884\u5904\u7406\u7ed3\u679c\u663e\u793a</p> <p>\u6211\u8fd9\u91cc\u76f4\u63a5\u7167\u6284 <code>OBJ</code> \u7684\u5199\u6cd5</p> <pre><code>//...\u524d\u9762\u4ee3\u7801\nOBJS = $(SRCS:%.c=$(OBJ_DIR)/%.o) $(CXXSRC:%.cc=$(OBJ_DIR)/%.o)\nINTERMEDIATES = $(SRCS:%.c=$(PREPROCESS_DIR)/%.i) $(CXXSRC:%.cc=$(PREPROCESS_DIR)/%.i)\n\npreprocess: $(INTERMEDIATES)\n\n$(PREPROCESS_DIR)/%.i: %.c\n    @echo + CC $&lt;\n    @mkdir -p $(dir $@)\n    @$(CC) $(CFLAGS) -E -o $@ $&lt;\n\n$(PREPROCESS_DIR)/%.i: %.cc\n    @echo + CXX $&lt;\n    @mkdir -p $(dir $@)\n    @$(CXX) $(CFLAGS) -E -o $@ $&lt;\n//...\u540e\u9762\u4ee3\u7801\n// script/build.mk\n</code></pre> <p>\u53e6\u5916\u590d\u4e60\u4e00\u4e9b <code>Makefile</code> \u77e5\u8bc6\uff1a</p> <ol> <li> <p>\u5173\u4e8e <code>|</code> \u662f\u4ec0\u4e48\uff1f</p> <p>\u6211\u7684\u81ea\u7528 Makefile \u6a21\u677f\u4ecb\u7ecd_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u5728Makefile\u4e2d\uff0c<code>|</code> \u7b26\u53f7\u540e\u9762\u7684\u5185\u5bb9\u88ab\u79f0\u4e3a\u201c\u5f3a\u5236\u76ee\u6807\u201d\uff08forcing targets\uff09\u3002\u5f53\u5f3a\u5236\u76ee\u6807\u53d1\u751f\u53d8\u5316\u65f6\uff0c<code>|</code> \u7b26\u53f7\u4e4b\u524d\u7684\u89c4\u5219\u5c06\u88ab\u91cd\u65b0\u6267\u884c\uff0c\u5373\u4f7f\u89c4\u5219\u672c\u8eab\u7684\u4f9d\u8d56\u9879\u6ca1\u6709\u6539\u53d8\u3002</p> <p>\u5728\u4f60\u63d0\u4f9b\u7684Makefile\u7247\u6bb5\u4e2d\uff1a</p> <pre><code>$(PREPROCESS_DIR)/%.i: %.c | $(PRE_C)\n  @echo + CC $&lt;\n  @mkdir -p $(dir $@)\n  @$(CC) $(CFLAGS) -E -o $@ $&lt;\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>| $(PRE_C)</code> \u8868\u793a\uff0c\u5982\u679c <code>$(PRE_C)</code> \u4ee3\u8868\u7684\u6587\u4ef6\u6216\u76ee\u6807\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u5373\u4f7f <code>%.c</code> \u6ca1\u6709\u53d8\u5316\uff0c\u4e5f\u4f1a\u89e6\u53d1 <code>$(PREPROCESS_DIR)/%.i</code> \u7684\u89c4\u5219\u6267\u884c\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ol> <li> <p>\u547d\u4ee4\u53d8\u66f4\uff1a\u5982\u679c\u4f60\u7684\u6784\u5efa\u7cfb\u7edf\u9700\u8981\u5728\u67d0\u4e9b\u6761\u4ef6\u6216\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\u65f6\u91cd\u65b0\u8fd0\u884c\u547d\u4ee4\uff0c\u5373\u4f7f\u5b9e\u9645\u7684\u6e90\u6587\u4ef6\u6ca1\u6709\u53d8\u5316\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5f3a\u5236\u76ee\u6807\u6765\u786e\u4fdd\u547d\u4ee4\u88ab\u6267\u884c\u3002</p> </li> <li> <p>\u73af\u5883\u53d8\u66f4\uff1a\u5f53\u7f16\u8bd1\u73af\u5883\uff08\u5982\u7f16\u8bd1\u5668\u7248\u672c\u3001\u7f16\u8bd1\u9009\u9879\u7b49\uff09\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u91cd\u65b0\u751f\u6210\u6240\u6709\u4e2d\u95f4\u6587\u4ef6\uff0c\u5373\u4f7f\u6e90\u4ee3\u7801\u6ca1\u6709\u6539\u53d8\u3002</p> </li> <li> <p>\u4f9d\u8d56\u5173\u7cfb\uff1a\u5982\u679c\u751f\u6210 <code>.i</code> \u6587\u4ef6\u7684\u8fc7\u7a0b\u4f9d\u8d56\u4e8e\u67d0\u4e9b\u7279\u5b9a\u7684\u811a\u672c\u6216\u914d\u7f6e\u6587\u4ef6\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u662f <code>$(PRE_C)</code>\uff09\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>|</code> \u6765\u786e\u4fdd\u8fd9\u4e9b\u53d8\u66f4\u80fd\u591f\u89e6\u53d1\u91cd\u65b0\u751f\u6210\u3002</p> </li> </ol> <p>\u7b80\u800c\u8a00\u4e4b\uff0c<code>| $(PRE_C)</code> \u8868\u793a\u5982\u679c <code>$(PRE_C)</code> \u6240\u4ee3\u8868\u7684\u6587\u4ef6\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u90a3\u4e48\u6240\u6709\u4f9d\u8d56\u4e8e\u8fd9\u4e2a\u5f3a\u5236\u76ee\u6807\u7684 <code>.i</code> \u6587\u4ef6\u90fd\u5c06\u88ab\u91cd\u65b0\u751f\u6210\uff0c\u4e0d\u7ba1\u5b83\u4eec\u7684\u6e90 <code>.c</code> \u6587\u4ef6\u662f\u5426\u88ab\u4fee\u6539\u8fc7\u3002\u8fd9\u662f\u4e00\u79cd\u786e\u4fdd\u4f9d\u8d56\u4e8e\u7279\u5b9a\u73af\u5883\u6216\u914d\u7f6e\u7684\u6784\u5efa\u8fc7\u7a0b\u80fd\u591f\u6b63\u786e\u66f4\u65b0\u7684\u65b9\u6cd5\u3002</p> <p>\u6709\u70b9\u6df7\u4e71\uff1f</p> <p>\u518d\u770b\u770b</p> <p>| \u548c @ \u77e5\u8bc6</p> <ul> <li> <p><code>|</code> \u5f3a\u5236\u547d\u4ee4\uff08Forcing Command\uff09</p> <p><code>$(OBJ_DIR)/%.o: %.c | $(PREPROCESS_DIR) preprocess</code></p> <p><code>|</code> \u5728 Makefile \u4e2d\u7528\u4f5c\u5f3a\u5236\u547d\u4ee4\uff0c\u5b83\u544a\u8bc9 make \u5f15\u64ce\uff0c\u5982\u679c\u5f3a\u5236\u547d\u4ee4\u540e\u9762\u5217\u51fa\u7684\u4efb\u4f55\u4e00\u4e2a\u76ee\u6807\u5728\u4fee\u6539\u65f6\u95f4\u4e0a\u665a\u4e8e\u7b2c\u4e00\u4e2a\u975e\u5f3a\u5236\u547d\u4ee4\u7684\u76ee\u6807\uff0c\u90a3\u4e48\u5c31\u6267\u884c\u975e\u5f3a\u5236\u547d\u4ee4\u6765\u91cd\u65b0\u6784\u5efa\u76ee\u6807\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u786e\u4fdd | \u540e\u9762\u7684\u5185\u5bb9\u5728\u76ee\u6807\u4e4b\u540e\u8fd0\u884c\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li><code>$(PREPROCESS_DIR) preprocess</code>\uff1a\u8fd9\u662f\u5f3a\u5236\u547d\u4ee4\u90e8\u5206\uff0c\u610f\u5473\u7740\u5982\u679c <code>$(PREPROCESS_DIR)</code> \u76ee\u5f55\u6216 <code>preprocess</code> \u76ee\u6807\u5728\u4efb\u4f55 <code>.o</code> \u6587\u4ef6\u4e4b\u524d\u88ab\u4fee\u6539\uff0c\u90a3\u4e48\u5c31\u4f1a\u6267\u884c <code>.o</code> \u6587\u4ef6\u7684\u751f\u6210\u547d\u4ee4\u3002</li> </ul> <p>### \u5177\u4f53\u89e3\u91ca</p> <ul> <li>\u5982\u679c <code>$(PREPROCESS_DIR)</code> \u76ee\u5f55\u4e0d\u5b58\u5728\u6216 <code>preprocess</code> \u76ee\u6807\u9700\u8981\u91cd\u65b0\u6267\u884c\uff08\u4f8b\u5982\uff0c\u9884\u5904\u7406\u6587\u4ef6\u88ab\u5220\u9664\u6216\u66f4\u65b0\u4e86\uff09\uff0c\u5219\u6267\u884c\u7f16\u8bd1\u547d\u4ee4 <code>$(CC) $(CFLAGS) -c -o $@ $^</code> \u6765\u751f\u6210 <code>.o</code> \u6587\u4ef6\u3002</li> <li><code>$^</code> \u662f\u4e00\u4e2a\u81ea\u52a8\u53d8\u91cf\uff0c\u5b83\u4ee3\u8868\u6240\u6709\u7684\u4f9d\u8d56\u9879\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u662f <code>%.c</code> \u6a21\u5f0f\u5339\u914d\u7684 <code>.c</code> \u6587\u4ef6\uff09\u3002</li> </ul> </li> <li> <p>\u5728\u6307\u4ee4\u7684\u5f00\u5934\u52a0\u4e2a @</p> <p>\u8868\u793amake\u7684\u65f6\u5019\uff0c\u5728\u7ec8\u7aef\u4e0d\u663e\u793a\u51fa\u6765\u8be5\u6761\u547d\u4ee4\u3002</p> </li> </ul> </li> <li> <p>\u5173\u4e8e\u66ff\u6362</p> <pre><code>SOURCES=$(wildcard src/**/*.c src/*.c)                      \nOBJECTS=$(patsubst %.c,%.o,$(SOURCES))             \n\nTEST_SRC=$(wildcard tests/*_tests.c)\nTESTS=$(patsubst %.c,%,$(TEST_SRC)) \n</code></pre> </li> </ol> </li> </ul> <p>\u7ee7\u7eed\u770b\u6307\u4ee4\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#execute-ex","title":"\u6267\u884c(execute, EX)","text":"<p>\u8bd1\u7801\u7ed3\u675f\u540e\uff0c\u4ee3\u7801\u4f1a\u6267\u884c\u6a21\u5f0f\u5339\u914d\u4e2d\u6307\u5b9a\u7684 \u6307\u4ee4\u6267\u884c\u64cd\u4f5c\uff0c\u90e8\u5206\u64cd\u4f5c\u4f1a\u7528\u5230\u8bd1\u7801\u7684\u7ed3\u679c\uff0c\u5e76\u901a\u8fc7C\u4ee3\u7801\u6765\u6a21\u62df\u6307\u4ee4\u6267\u884c\u7684\u771f\u6b63\u884c\u4e3a\u3002</p> <p>\u6bd4\u5982\u8bf4 <code>lbu</code> \u6307\u4ee4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7 <code>R(rd) = M[src1 + imm]</code> / <code>R(rd) = Mr(src1 + imm, 1)</code> \u5c06\u7acb\u5373\u6570\u548c\u6e90\u5bc4\u5b58\u56681\u7684\u503c\u76f8\u52a0\u5b58\u5230\u76ee\u7684\u5bc4\u5b58\u5668\u4e2d\uff0c\u5373\u5b8c\u6210\u6307\u4ee4\u6267\u884c\u3002</p> <p>\u4e4b\u540e <code>decode_exec()</code>\u51fd\u6570\u5c06\u4f1a\u8fd4\u56de<code>0</code>, \u5e76\u4e00\u8def\u8fd4\u56de\u5230<code>exec_once()</code>\u51fd\u6570\u4e2d. \u4e0d\u8fc7\u76ee\u524d\u4ee3\u7801\u5e76\u6ca1\u6709\u4f7f\u7528\u8fd9\u4e2a\u8fd4\u56de\u503c, \u56e0\u6b64\u53ef\u4ee5\u5ffd\u7565\u5b83.</p>"},{"location":"ysyx/pa/pa2/pa2.html#pc","title":"\u66f4\u65b0 PC","text":"<p>\u8fd9\u90e8\u5206\u76f4\u63a5\u770b\u8bb2\u4e49\u5373\u53ef\uff0c\u4e86\u89e3\u6e05\u695a\u4e86\u9759\u6001\u6307\u4ee4\u548c\u52a8\u6001\u6307\u4ee4\u3002</p> <p>\u6700\u540e\u662f\u66f4\u65b0PC. \u66f4\u65b0PC\u7684\u64cd\u4f5c\u975e\u5e38\u7b80\u5355, \u53ea\u9700\u8981\u628a<code>s-&gt;dnpc</code>\u8d4b\u503c\u7ed9<code>cpu.pc</code>\u5373\u53ef. \u6211\u4eec\u4e4b\u524d\u63d0\u5230\u4e86<code>snpc</code>\u548c<code>dnpc</code>, \u73b0\u5728\u6765\u8bf4\u660e\u4e00\u4e0b\u5b83\u4eec\u7684\u533a\u522b.</p> <p>\u9759\u6001\u6307\u4ee4\u548c\u52a8\u6001\u6307\u4ee4</p> <p>\u5728\u7a0b\u5e8f\u5206\u6790\u9886\u57df\u4e2d, \u9759\u6001\u6307\u4ee4\u662f\u6307\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u7684\u6307\u4ee4, \u52a8\u6001\u6307\u4ee4\u662f\u6307\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6307\u4ee4. \u4f8b\u5982\u5bf9\u4e8e\u4ee5\u4e0b\u6307\u4ee4\u5e8f\u5217</p> <pre><code>100: jmp 102\n101: add\n102: xor\n</code></pre> <p><code>jmp</code>\u6307\u4ee4\u7684\u4e0b\u4e00\u6761\u9759\u6001\u6307\u4ee4\u662f<code>add</code>\u6307\u4ee4, \u800c\u4e0b\u4e00\u6761\u52a8\u6001\u6307\u4ee4\u5219\u662f<code>xor</code>\u6307\u4ee4.</p> <p>\u6709\u4e86\u9759\u6001\u6307\u4ee4\u548c\u52a8\u6001\u6307\u4ee4\u8fd9\u4e24\u4e2a\u6982\u5ff5\u4e4b\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u8bf4\u660e<code>snpc</code>\u548c<code>dnpc</code>\u7684\u533a\u522b\u4e86: </p> <p><code>snpc</code>\u662f\u4e0b\u4e00\u6761\u9759\u6001\u6307\u4ee4, \u800c<code>dnpc</code>\u662f\u4e0b\u4e00\u6761\u52a8\u6001\u6307\u4ee4. </p> <ul> <li>\u5bf9\u4e8e\u987a\u5e8f\u6267\u884c\u7684\u6307\u4ee4, \u5b83\u4eec\u7684<code>snpc</code>\u548c<code>dnpc</code>\u662f\u4e00\u6837\u7684; </li> <li>\u4f46\u5bf9\u4e8e\u8df3\u8f6c\u6307\u4ee4, <code>snpc</code>\u548c<code>dnpc</code>\u5c31\u4f1a\u6709\u6240\u4e0d\u540c, <code>dnpc</code>\u5e94\u8be5\u6307\u5411\u8df3\u8f6c\u76ee\u6807\u7684\u6307\u4ee4.</li> </ul> <p>\u663e\u7136, \u6211\u4eec\u5e94\u8be5\u4f7f\u7528<code>s-&gt;dnpc</code>\u6765\u66f4\u65b0PC, \u5e76\u4e14\u5728\u6307\u4ee4\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u6b63\u786e\u5730\u7ef4\u62a4<code>s-&gt;dnpc</code>.</p> <pre><code> static void exec_once(Decode *s, vaddr_t pc) { \n     s-&gt;pc = pc;\n     s-&gt;snpc = pc;\n     isa_exec_once(s);                          \n     cpu.pc = s-&gt;dnpc;\n     //....\n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#_3","title":"\u7ed3\u6784\u5316\u7a0b\u5e8f\u8bbe\u8ba1","text":"<p>\u633a\u91cd\u8981\u7684\u3002\u4e0d\u65ad\u5730\u5b66\u4e60\uff0c\u6539\u8fdb....</p> <p>\u5b9e\u73b0\u4ee3\u7801\u89e3\u8026\uff0c\u63d0\u9ad8\u53ef\u7ef4\u62a4\u6027\u3002\u3002\u3002</p> <p>\u627e\u51fa\u5171\u540c\u7279\u5f81\u3002</p> <p>\u4e00\u79cd\u597d\u7684\u505a\u6cd5\u662f\u628a\u8bd1\u7801, \u6267\u884c\u548c\u64cd\u4f5c\u6570\u5bbd\u5ea6\u7684\u76f8\u5173\u4ee3\u7801\u5206\u79bb\u5f00\u6765, \u5b9e\u73b0\u89e3\u8026, \u4e5f\u5c31\u662f\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u63d0\u5230\u7684\u7ed3\u6784\u5316\u7a0b\u5e8f\u8bbe\u8ba1. </p> <p>\u5728\u6846\u67b6\u4ee3\u7801\u4e2d, \u5b9e\u73b0\u8bd1\u7801\u548c\u6267\u884c\u4e4b\u95f4\u7684\u89e3\u8026\u7684\u662f\u901a\u8fc7 <code>INSTPAT</code> \u5b9a\u4e49\u7684\u6a21\u5f0f\u5339\u914d\u89c4\u5219, \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5206\u522b\u7f16\u5199\u8bd1\u7801\u548c\u6267\u884c\u7684\u5185\u5bb9, </p> <p>\u7136\u540e\u6765\u8fdb\u884c\u7ec4\u5408\u4e86: \u8fd9\u6837\u7684\u8bbe\u8ba1\u53ef\u4ee5\u5f88\u5bb9\u6613\u5b9e\u73b0\u6267\u884c\u884c\u4e3a\u76f8\u540c\u4f46\u8bd1\u7801\u65b9\u5f0f\u4e0d\u540c\u7684\u591a\u6761\u6307\u4ee4. </p> <p>\u5bf9\u4e8ex86, \u5b9e\u73b0\u64cd\u4f5c\u6570\u5bbd\u5ea6\u548c\u8bd1\u7801, \u6267\u884c\u8fd9\u4e24\u8005\u4e4b\u95f4\u7684\u89e3\u8026\u7684\u662f<code>ISADecodeInfo</code>\u7ed3\u6784\u4f53\u4e2d\u7684<code>width</code>\u6210\u5458, \u5b83\u4eec\u8bb0\u5f55\u4e86\u64cd\u4f5c\u6570\u5bbd\u5ea6, \u8bd1\u7801\u548c\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u6839\u636e\u5b83\u4eec\u8fdb\u884c\u4e0d\u540c\u7684\u64cd\u4f5c, \u901a\u8fc7\u540c\u4e00\u4efd\u8bd1\u7801\u548c\u6267\u884c\u7684\u4ee3\u7801\u5b9e\u73b0\u4e0d\u540c\u64cd\u4f5c\u6570\u5bbd\u5ea6\u7684\u529f\u80fd.</p> <p>\u8fd9\u91cc\u53ef\u80fd\u6211\u5f00\u59cb\u611f\u53d7\u4e0d\u5230\uff0c\u5e94\u8be5\u8981\u914d\u5408\u4e00\u4e9b\u9ad8\u7ea7 \u4ee3\u7801\u6280\u5de7\u548c\u8f6f\u4ef6\u5de5\u7a0b\u8fdb\u4e00\u6b65\u4e86\u89e3\u3002</p> <ul> <li> <p>Task</p> <p>\u9664\u4e86<code>nemu/src/device</code>\u548c<code>nemu/src/isa/$ISA/system</code>\u4e4b\u5916, NEMU\u7684\u5176\u5b83\u4ee3\u7801\u4f60\u90fd\u5df2\u7ecf\u6709\u80fd\u529b\u7406\u89e3\u4e86. \u56e0\u6b64\u4e0d\u8981\u89c9\u5f97\u8bb2\u4e49\u4e2d\u6ca1\u6709\u63d0\u5230\u7684\u6587\u4ef6\u5c31\u4e0d\u9700\u8981\u770b, \u5c1d\u8bd5\u5c3d\u53ef\u80fd\u5730\u7406\u89e3\u6bcf\u4e00\u5904\u7ec6\u8282\u5427! \u5728\u4f60\u9047\u5230bug\u7684\u65f6\u5019, \u8fd9\u4e9b\u7ec6\u8282\u5c31\u4f1a\u6210\u4e3a\u5e2e\u52a9\u4f60\u8c03\u8bd5\u7684\u7ebf\u7d22.</p> </li> <li> <p><code>src/engine</code></p> <p>\u4e00\u4e9b\u76f8\u5173\u7684\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6</p> </li> <li> <p><code>src/utils/</code></p> <p>\u4e00\u4e9b\u5de5\u5177\u4ee3\u7801\uff1a</p> <p><code>disasm.cc</code> </p> <ul> <li>\u8fd9\u662f\u4e00\u4e2aC++\u6e90\u6587\u4ef6\uff0c\u7528\u4e8e\u5b9e\u73b0\u6c47\u7f16\u5668\u548c\u53cd\u6c47\u7f16\u5668\u7684\u529f\u80fd\u3002</li> <li>\u5b83\u5305\u542b\u4e86\u521d\u59cb\u5316\u53cd\u6c47\u7f16\u5668\u7684\u51fd\u6570<code>init_disasm</code>\uff0c\u8be5\u51fd\u6570\u8bbe\u7f6e\u76ee\u6807\u5e73\u53f0\u5e76\u521b\u5efa\u5fc5\u8981\u7684LLVM\u7ec4\u4ef6\u3002</li> <li>\u8fd8\u6709\u4e00\u4e2a<code>disassemble</code>\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u673a\u5668\u7801\u53cd\u6c47\u7f16\u6210\u4eba\u7c7b\u53ef\u8bfb\u7684\u6307\u4ee4\u3002</li> </ul> <p><code>filelist.mk</code></p> <ul> <li>\u5b83\u68c0\u67e5\u914d\u7f6e\u5b8f<code>CONFIG_ITRACE</code>\u548c<code>CONFIG_IQUEUE</code>\u662f\u5426\u5b9a\u4e49\uff0c\u5e76\u636e\u6b64\u8bbe\u7f6e\u7f16\u8bd1\u6e90\u6587\u4ef6\u548c\u7f16\u8bd1\u9009\u9879\u3002</li> </ul> <p><code>log.c</code> </p> <ul> <li>\u8fd9\u4e2aC\u6e90\u6587\u4ef6\u63d0\u4f9b\u4e86\u65e5\u5fd7\u8bb0\u5f55\u7684\u529f\u80fd\u3002</li> <li>\u5b83\u5305\u542b\u4e86\u521d\u59cb\u5316\u65e5\u5fd7\u6587\u4ef6\u7684\u51fd\u6570<code>init_log</code>\uff0c\u4ee5\u53ca\u68c0\u67e5\u662f\u5426\u5e94\u8be5\u8bb0\u5f55\u65e5\u5fd7\u7684\u51fd\u6570<code>log_enable</code>\u3002</li> <li>\u65e5\u5fd7\u7cfb\u7edf\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u6216\u6587\u4ef6\u3002</li> </ul> <p><code>state.c</code> </p> <ul> <li>\u8fd9\u4e2aC\u6e90\u6587\u4ef6\u7ba1\u7406NEMU\u6a21\u62df\u5668\u7684\u72b6\u6001\u3002</li> <li>\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a<code>NEMUState</code>\u7ed3\u6784\u4f53\uff0c\u7528\u4e8e\u8ddf\u8e2a\u6a21\u62df\u5668\u7684\u72b6\u6001\uff08\u4f8b\u5982\u505c\u6b62\u3001\u8fd0\u884c\u3001\u9000\u51fa\uff09\u3002</li> <li>\u8fd8\u5305\u542b\u4e86\u4e00\u4e2a\u51fd\u6570<code>is_exit_status_bad</code>\uff0c\u7528\u4e8e\u68c0\u67e5\u6a21\u62df\u5668\u7684\u9000\u51fa\u72b6\u6001\u662f\u5426\u8868\u793a\u9519\u8bef</li> </ul> <p><code>timer.c</code></p> <ul> <li>\u8fd9\u4e2aC\u6e90\u6587\u4ef6\u63d0\u4f9b\u4e86\u65f6\u95f4\u76f8\u5173\u7684\u529f\u80fd\u3002</li> <li>\u5b83\u5305\u542b\u4e86\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u51fd\u6570<code>get_time</code>\uff0c\u8be5\u51fd\u6570\u57fa\u4e8e\u4e0d\u540c\u7684\u914d\u7f6e\u4f7f\u7528\u4e0d\u540c\u7684\u65f6\u95f4\u6e90\u3002</li> <li>\u8fd8\u6709\u4e00\u4e2a<code>init_rand</code>\u51fd\u6570\uff0c\u7528\u4e8e\u521d\u59cb\u5316\u968f\u673a\u6570\u751f\u6210\u5668\uff0c\u901a\u5e38\u4f7f\u7528\u5f53\u524d\u65f6\u95f4\u4f5c\u4e3a\u79cd\u5b50\u3002</li> </ul> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#c","title":"\u8fd0\u884c\u7b2c\u4e00\u4e2a C \u7a0b\u5e8f  (\u2b50)","text":"<pre><code>make ARCH=$ISA-nemu ALL=dummy run\n</code></pre> <p>\u4e3a\u4e86\u65b9\u4fbf\u53d9\u8ff0, \u8bb2\u4e49\u5c06\u7528<code>$ISA</code>\u6765\u8868\u793a\u4f60\u9009\u62e9\u7684ISA, \u4f8b\u5982\u5bf9\u4e8e<code>nemu/src/isa/$ISA/reg.c</code>, \u82e5\u4f60\u9009\u62e9\u7684\u662fx86, \u5b83\u5c06\u8868\u793a<code>nemu/src/isa/x86/reg.c</code>; \u82e5\u4f60\u9009\u62e9\u7684\u662friscv32, \u5b83\u5c06\u8868\u793a<code>nemu/src/isa/riscv32/reg.c</code>. </p> <p>\u9664\u975e\u8bb2\u4e49\u660e\u786e\u8bf4\u660e, \u5426\u5219<code>$ISA</code>\u603b\u662f\u8868\u793a\u4f60\u9009\u62e9\u7684ISA, \u800c\u4e0d\u662f<code>$ISA</code>\u8fd9\u56db\u4e2a\u5b57\u7b26.</p> <p></p> <p>\u8981\u5b9e\u73b0\u54ea\u4e9b\u6307\u4ee4\u624d\u80fd\u8ba9<code>dummy</code>\u5728NEMU\u4e2d\u8fd0\u884c\u8d77\u6765\u5462? </p> <p>\u7b54\u6848\u5c31\u5728\u5176\u53cd\u6c47\u7f16\u7ed3\u679c (<code>am-kernels/tests/cpu-tests/build/dummy-$ISA-nemu.txt</code>) \u4e2d: \u4f60\u53ea\u9700\u5b9e\u73b0\u90a3\u4e9b\u76ee\u524d\u8fd8\u6ca1\u5b9e\u73b0\u7684\u6307\u4ee4\u5c31\u53ef\u4ee5\u4e86. </p> <p>\u6846\u67b6\u4ee3\u7801\u5f15\u5165\u7684\u6a21\u5f0f\u5339\u914d\u89c4\u5219, \u5bf9\u5728NEMU\u4e2d\u5b9e\u73b0\u5ba2\u6237\u6307\u4ee4\u63d0\u4f9b\u4e86\u5f88\u5927\u7684\u4fbf\u5229, \u4e3a\u4e86\u5b9e\u73b0\u4e00\u6761\u65b0\u6307\u4ee4, \u4f60\u53ea\u9700\u8981\u5728<code>nemu/src/isa/$ISA/inst.c</code>\u4e2d\u6dfb\u52a0\u6b63\u786e\u7684\u6a21\u5f0f\u5339\u914d\u89c4\u5219\u5373\u53ef.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4ec0\u4e48\u6267\u884c\u4e86\u672a\u5b9e\u73b0\u6307\u4ee4\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u62a5\u9519\u4fe1\u606f</p> <p>RTFSC, \u7406\u89e3\u6267\u884c\u672a\u5b9e\u73b0\u6307\u4ee4\u7684\u65f6\u5019, NEMU\u5177\u4f53\u4f1a\u600e\u4e48\u505a.</p> <pre><code>(nemu) si\ninvalid opcode(PC = 0x80000000):\n    13 04 00 00 17 91 00 00 ...\n    00000413 00009117...\nThere are two cases which will trigger this unexpected exception:\n1. The instruction at PC = 0x80000000 is not implemented.\n2. Something is implemented incorrectly.\nFind this PC(0x80000000) in the disassembling result to distinguish which case it is.\n\nIf it is the first case, see\n       _                         __  __                         _ \n      (_)                       |  \\/  |                       | |\n  _ __ _ ___  ___ ________   __ | \\  / | __ _ _ __  _   _  __ _| |\n | '__| / __|/ __|______\\ \\ / / | |\\/| |/ _` | '_ \\| | | |/ _` | |\n | |  | \\__ \\ (__        \\ V /  | |  | | (_| | | | | |_| | (_| | |\n |_|  |_|___/\\___|        \\_/   |_|  |_|\\__,_|_| |_|\\__,_|\\__,_|_|\n\nfor more details.\n\nIf it is the second case, remember:\n* The machine is always right!\n* Every line of untested code is always wrong!\n\n0x80000000: 00 00 04 13 addi    s0, zero, 0\n[src/cpu/cpu-exec.c:123 cpu_exec] nemu: ABORT at pc = 0x80000000\n[src/cpu/cpu-exec.c:91 statistic] host time spent = 3,292 us\n[src/cpu/cpu-exec.c:92 statistic] total guest instructions = 1\n[src/cpu/cpu-exec.c:93 statistic] simulation frequency = 303 inst/s\n</code></pre> <p>\u7ecf\u8fc7\u524d\u9762\u7684\u6307\u4ee4\u5206\u6790\uff0c\u5927\u6982\u4e5f\u77e5\u9053\u4e86\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u4e0a\u9762\u7684\u5185\u5bb9\u4e86\uff0c\u76f4\u63a5\u770b\u4ee3\u7801\u5c31\u884c\u3002</p> <pre><code>// src/isa/riscv64/inst.c\nINSTPAT(\"??????? ????? ????? ??? ????? ????? ??\", inv    , N, INV(s-&gt;pc));\n\n// include/cpu/cpu.h\n#define INV(thispc) invalid_inst(thispc)\n\n// src/engine/interpreter/hostcall.c\nvoid set_nemu_state(int state, vaddr_t pc, int halt_ret) {\n  difftest_skip_ref();\n  nemu_state.state = state;\n  nemu_state.halt_pc = pc;\n  nemu_state.halt_ret = halt_ret;\n}\n\n__attribute__((noinline))\nvoid invalid_inst(vaddr_t thispc) {\n  uint32_t temp[2];\n  vaddr_t pc = thispc;\n  temp[0] = inst_fetch(&amp;pc, 4);\n  temp[1] = inst_fetch(&amp;pc, 4);\n\n  uint8_t *p = (uint8_t *)temp;\n  printf(\"invalid opcode(PC = \" FMT_WORD \"):\\n\"\n      \"\\t%02x %02x %02x %02x %02x %02x %02x %02x ...\\n\"\n      \"\\t%08x %08x...\\n\",\n      thispc, p[0], p[1], p[2], p[3], p[4], p[5], p[6], p[7], temp[0], temp[1]);\n\n  printf(\"There are two cases which will trigger this unexpected exception:\\n\"\n      \"1. The instruction at PC = \" FMT_WORD \" is not implemented.\\n\"\n      \"2. Something is implemented incorrectly.\\n\", thispc);\n  printf(\"Find this PC(\" FMT_WORD \") in the disassembling result to distinguish which case it is.\\n\\n\", thispc);\n  printf(ANSI_FMT(\"If it is the first case, see\\n%s\\nfor more details.\\n\\n\"\n        \"If it is the second case, remember:\\n\"\n        \"* The machine is always right!\\n\"\n        \"* Every line of untested code is always wrong!\\n\\n\", ANSI_FG_RED), isa_logo);\n\n  set_nemu_state(NEMU_ABORT, thispc, -1);\n}\n</code></pre> </li> </ul> <p>\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u5b8c\u5584\u66f4\u591a\u7684\u6307\u4ee4\u4e86\uff0c\u67e5\u770b\u53cd\u6c47\u7f16\u77e5\u9053\u8981\u5b9e\u73b0\u54ea\u4e9b</p> <pre><code>/home/jai/ysyx-workbench/am-kernels/tests/cpu-tests/build/dummy-riscv32-nemu.elf:     file format elf32-littleriscv\n\n\nDisassembly of section .text:\n\n80000000 &lt;_start&gt;:\n80000000:   00000413            li  s0,0\n80000004:   00009117            auipc   sp,0x9\n80000008:   ffc10113            addi    sp,sp,-4 # 80009000 &lt;_end&gt;\n8000000c:   00c000ef            jal ra,80000018 &lt;_trm_init&gt;\n\n80000010 &lt;main&gt;:\n80000010:   00000513            li  a0,0\n80000014:   00008067            ret\n\n80000018 &lt;_trm_init&gt;:\n80000018:   ff010113            addi    sp,sp,-16\n8000001c:   00000517            auipc   a0,0x0\n80000020:   01c50513            addi    a0,a0,28 # 80000038 &lt;_etext&gt;\n80000024:   00112623            sw  ra,12(sp)\n80000028:   fe9ff0ef            jal ra,80000010 &lt;main&gt;\n8000002c:   00050513            mv  a0,a0\n80000030:   00100073            ebreak\n80000034:   0000006f            j   80000034 &lt;_trm_init+0x1c&gt;\n</code></pre> <p>\u63d0\u9192\uff1a</p> <p>\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe</p> <p>\u5982\u679c\u4f60\u9009\u62e9\u7684ISA\u4e0d\u662fx86, \u5728\u67e5\u770b\u5ba2\u6237\u7a0b\u5e8f\u7684\u4e8c\u8fdb\u5236\u4fe1\u606f(\u5982<code>objdump</code>, <code>readelf</code>\u7b49)\u65f6, \u9700\u8981\u4f7f\u7528\u76f8\u5e94\u7684\u4ea4\u53c9\u7f16\u8bd1\u7248\u672c, \u5982<code>mips-linux-gnu-objdump</code>, <code>riscv64-linux-gnu-readelf</code>\u7b49. </p> <p>\u7279\u522b\u5730, \u5982\u679c\u4f60\u9009\u62e9\u7684ISA\u662friscv32, \u4e5f\u53ef\u4ee5\u4f7f\u7528riscv64\u4e3a\u524d\u7f00\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe.</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f <code>li  s0,0</code> \u3001<code>ret</code> \u90fd\u662f\u662f\u4e00\u6761\u4f2a\u6307\u4ee4\u3002</p> <p>\u5728RISC-V\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u6307\u4ee4\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a\u666e\u901a\u6307\u4ee4\u548c\u4f2a\u6307\u4ee4\u3002</p> <p></p> <p></p> <p></p> <p>\u5177\u4f53\u6765\u8bf4\uff0c<code>li</code> \u7684\u5341\u516d\u8fdb\u5236/\u4e8c\u8fdb\u5236\u5b9e\u73b0\u4e3a\uff1a</p> <pre><code>80000000: 00000413            li  s0,0\n0000 0000 0000 0000 0000 0100 0001 0011\n</code></pre> <p>\u8fd9\u91cc\u67e5\u8868\u5bf9\u5e94\u5230 <code>addi</code> \u6307\u4ee4\u4e0a\uff0c\u7531\u6b64\u53ef\u4ee5\u5f97\u51fa\u4e00\u4e2a\u7ed3\u8bba\uff0c\u53f3\u8fb9\u53cd\u6c47\u7f16\u51fa\u6765\u7684\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u9605\u8bfb\uff0c\u771f\u6b63\u5b9e\u73b0\u5bf9\u5e94\u7684\u6307\u4ee4\u64cd\u4f5c\u8fd8\u5f97\u662f\u770b\u5de6\u8fb9\u7684\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b <code>jal</code> \u6307\u4ee4\uff0cJ \u578b\u6307\u4ee4\u5b9e\u73b0\u5176\u7acb\u5373\u6570\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p> <ol> <li>\u4e0d\u592a\u7406\u89e3\u5176\u4e2d <code>jal</code> \u7684\u7acb\u5373\u6570\u4e3a\u4ec0\u4e48\u8981\u4e24\u5b57\u8282\u5bf9\u9f50(\u5de6\u79fb 1 \u4f4d)</li> <li>\u5b9e\u73b0 <code>immJ</code> \u9047\u5230\u4e00\u4e9b\u56f0\u60d1\u3002 </li> <li>\u4e3a\u4ec0\u4e48 <code>jalr</code> \u7684\u7b2c\u4e00\u4f4d\u9700\u8981\u53d6\u53cd\uff1f</li> </ol> <p>RISC-V\u6307\u4ee4\u96c6\u8bb2\u89e3\uff085\uff09\u6761\u4ef6\u548c\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4 - \u77e5\u4e4e (zhihu.com)</p> <ul> <li> <p>Q1</p> <p><code>jal</code> \u4f5c\u4e3a <code>RV32I</code> \u4e2d\u552f\u4e00\u7684 J \u578b\u6307\u4ee4\u3002</p> <p>\u5177\u4f53\u6307\u4ee4\u683c\u5f0f\uff1a<code>jal rd\uff0coffset</code> <code>x[rd] = pc+4; pc += sext(offset)</code></p> <p></p> <p>\u8fd9\u6761\u6307\u4ee4\u628a\u4e0b\u4e00\u6761\u6307\u4ee4(PC + 4) \u88c5\u8f7d\u5230 <code>rd</code> \u4e2d\uff0c\u7136\u540e PC += \u7b26\u53f7\u6269\u5c55\u540e\u7684\u504f\u79fb\u503c\u3002\uff08\u7b26\u53f7\u6269\u5c55\u4e4b\u524d\u5df2\u7ecf\u4e86\u89e3\uff09</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u504f\u79fb\u91cf\u662f2\u5b57\u8282\u5bf9\u9f50\u7684(offset [20:1])\uff0c\u867d\u7136RV32I\u4e2d\u6240\u6709\u7684\u6307\u4ee4\u5730\u5740\u90fd\u662f4\u5b57\u8282\u5bf9\u9f50\u7684\uff0c\u4f46\u662fJAL\u8fd8\u53ef\u80fd\u88ab\u7528\u4e8e\u517c\u5bb9C\u6269\u5c55\u6307\u4ee4\u96c6\uff0c\u6240\u4ee5\u5c31\u9ed8\u8ba4offset bit 0\u4e3a0(\u53732\u5b57\u8282\u5bf9\u9f50)\u3002</p> <p>\u8fd9\u91cc\u4e5f\u5927\u6982\u6709\u601d\u8def\uff0c\u56de\u60f3\u8d77\u4e4b\u524d\u7684\u770b\u4e3a\u4ec0\u4e48\u9700\u8981\u5b57\u8282\u5bf9\u9f50\u7684\u5185\u5bb9\u4e2d\u60f3\u5230\u7684\u975e\u5bf9\u9f50\u5b58\u50a8\u5668\u8bbf\u95ee\u5f02\u5e38\u3002</p> <p>\u5728RV32I\u4e2d\uff0c\u6240\u6709\u6307\u4ee4\u90fd\u662f4\u5b57\u8282\u5bf9\u9f50\u7684\uff0c\u5e76\u4e14\u9700\u5bf9\u9f50\u523032\u4f4d\u5b58\u50a8\u5668\u5730\u5740\u7684\u8fb9\u754c\u4e0a\uff0c\u4e0d\u7136\u4f1a\u5bfc\u81f4\u975e\u5bf9\u9f50\u5b58\u50a8\u5668\u8bbf\u95ee\u5f02\u5e38\u3002</p> <p>\u5148\u4e86\u89e3\u4e00\u4e0b C \u6269\u5c55</p> <p></p> <p>C\u6269\u5c55\uff08Compressed Instruction Extension\uff09\uff1a\u5b83\u5141\u8bb8\u4f7f\u752816\u4f4d\u7684\u6307\u4ee4\u6765\u5b9e\u73b0\u4e0e32\u4f4d\u6307\u4ee4\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4ece\u800c\u51cf\u5c11\u7a0b\u5e8f\u7684\u4ee3\u7801\u5927\u5c0f\uff0c\u63d0\u9ad8\u4ee3\u7801\u5bc6\u5ea6\u3002\u8fd9\u5bf9\u4e8e\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7b49\u5bf9\u5185\u5b58\u7a7a\u95f4\u6709\u9650\u5236\u7684\u5e94\u7528\u573a\u666f\u975e\u5e38\u6709\u7528\u3002C\u6269\u5c55\u5e76\u4e0d\u662f\u7279\u5b9a\u4e8eC\u8bed\u8a00\u7684\u6269\u5c55\uff0c\u800c\u662f\u5bf9\u6307\u4ee4\u96c6\u7684\u4e00\u79cd\u538b\u7f29\u6280\u672f\u3002</p> <p>RV \u7684 C \u6269\u5c55\u80fd\u4e0e\u5176\u5b83\u6240\u6709\u6807\u51c6\u6269\u5c55\u517c\u5bb9\u3002C \u6269\u5c55\u5141\u8bb8 16 \u4f4d\u6307\u4ee4\u53ef\u4ee5\u81ea\u7531\u5730\u548c 32 \u4f4d\u6307\u4ee4\u6df7\u5408\u6267\u884c\uff0c\u5e76\u8fd0\u884c 32 \u4f4d\u6307\u4ee4\u53ef\u4ee5\u5728\u4efb\u4f55 16 \u4f4d\u8fb9\u754c\u5f00\u59cb\u3002</p> <p>\u56de\u5230\u4e0a\u9762\u7684\u95ee\u9898\uff0c <code>jal</code> \u6307\u4ee4\u7684\u7acb\u5373\u6570\u90e8\u5206\u8bbe\u8ba1\u4e3a 2 \u5b57\u8282\u5bf9\u9f50\uff0c\u662f\u4e3a\u4e86\u786e\u4fdd\u5f53\u4f7f\u7528C\u6269\u5c55\u6307\u4ee4\u96c6\u65f6\uff0c\u5373\u4f7f\u572816\u4f4d\u7684\u6307\u4ee4\u7a7a\u95f4\u5185\uff0c\u4e5f\u80fd\u4fdd\u6301\u6b63\u786e\u7684\u8df3\u8f6c\u5730\u5740\u5bf9\u9f50\u3002\u8fd9\u662f\u56e0\u4e3aC\u6269\u5c55\u6307\u4ee4\u96c6\u4e2d\u7684\u8df3\u8f6c\u6307\u4ee4\u53ef\u80fd\u9700\u8981\u5728\u8f83\u5c0f\u7684\u5730\u5740\u8303\u56f4\u5185\u8fdb\u884c\u8df3\u8f6c\uff0c\u800c2\u5b57\u8282\u5bf9\u9f50\u53ef\u4ee5\u63d0\u4f9b\u76f8\u5bf9\u66f4\u5927\u7684\u8df3\u8f6c\u8303\u56f4\u3002</p> <p>\u5176\u4ed6\u539f\u56e0\uff1a</p> <p>\u6b64\u5916\uff0c2\u5b57\u8282\u5bf9\u9f50\u7684\u8bbe\u8ba1\u4e5f\u6709\u52a9\u4e8e\u7b80\u5316\u786c\u4ef6\u5b9e\u73b0\u3002\u7531\u4e8eRISC-V\u7684JAL\u6307\u4ee4\u9700\u8981\u5c0620\u4f4d\u7684\u7acb\u5373\u6570\u5de6\u79fb\u4e00\u4f4d\u540e\u4e0e\u5f53\u524d\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u76f8\u52a0\u6765\u8ba1\u7b97\u8df3\u8f6c\u76ee\u6807\u5730\u5740\uff0c\u5982\u679c\u7acb\u5373\u6570\u662f2\u5b57\u8282\u5bf9\u9f50\u7684\uff0c\u90a3\u4e48\u5728\u5de6\u79fb\u64cd\u4f5c\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u4e00\u4e2a\u5076\u6570\uff0c\u4ece\u800c\u907f\u514d\u4e86\u5bf9\u9f50\u9519\u8bef\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1aRISC-V \u6307\u4ee4\u96c6\u4ecb\u7ecd\uff08\u4e8c\uff09 - \u77e5\u4e4e (zhihu.com)</p> </li> <li> <p>Q2</p> <p>\u8fd9\u91cc\u5927\u6982\u4e5f\u660e\u767d\u4e3a\u4ec0\u4e48\u5404\u79cd\u6307\u4ee4\u7c7b\u578b\u7684\u7acb\u5373\u6570\u79fb\u4f4d\u4e86\u3002</p> <p>\u62fc\u4f4d\u7f6e\u3002</p> <pre><code>#define immI() do { *imm = SEXT(BITS(i, 31, 20), 12); } while(0)\n#define immU() do { *imm = SEXT(BITS(i, 31, 12), 20) &lt;&lt; 12; } while(0)\n#define immS() do { *imm = (SEXT(BITS(i, 31, 25), 7) &lt;&lt; 5) | BITS(i, 11, 7); } while(0)\n</code></pre> <ul> <li> <p>U\u578b\u6307\u4ee4\u901a\u8fc7 <code>BITS</code> \u5f97\u5230 20 \u4f4d\u7684\u7acb\u5373\u6570\u540e\uff0c\u5de6\u79fb12\u4f4d\u5f97\u523032\u4f4d\u7acb\u5373\u6570\uff0c\u5982\u679c\u4e3aRV64I\uff0c\u5219\u7b26\u53f7\u6269\u5c55\u5f97\u5230 64 \u4f4d\u3002</p> <p>\u8fd9\u7c7b\u6307\u4ee4\u5305\u542b\uff1aPC \u76f8\u5bf9\u5bfb\u5740 <code>auipc</code> \u548c <code>lui</code>\u3002</p> <p>\u5bf9\u4e8e <code>auipc rd, imm</code></p> <p>\u8fd9\u6761\u6307\u4ee4\u628a imm \u5de6\u79fb 12 \u4f4d\uff0c\u5e76\u5e26\u7b26\u53f7\u6269\u5c55\u81f3 32/64 \u4f4d\u7acb\u5373\u6570\uff0c\u518d\u52a0\u4e0a\u5f53\u524d PC \u503c\uff0c\u7136\u540e\u5b58\u50a8\u5230 rd \u5bc4\u5b58\u5668\u4e2d\u3002</p> <p>\u56e0\u4e3a\u5de6\u79fb12\u4f4d\u5f97\u5230\u7684\u7ed3\u679c\u8868\u793a\u7684\u662f\u5730\u5740\u7684\u9ad820\u4f4d\u90e8\u5206\uff0c\u4f4e12\u4f4d\u5747\u4e3a0\uff0c</p> <p>\u6545\u6b64\u6307\u4ee4\u53ea\u80fd\u5bfb\u5740\u5230\u4e0e 4KB \u5bf9\u9f50\u7684\u5730\u5740\u3002</p> <p>\u4f46\u518d\u914d\u5408jalr\u6307\u4ee4\u768412\u4f4d\u7acb\u5373\u6570\uff0c\u7a0b\u5e8f\u5c31\u80fd\u5c06\u6267\u884c\u6d41\u7a0b\u8f6c\u79fb\u5230\u4efb\u4f5532\u4f4dpc\u76f8\u5bf9\u5730\u5740</p> <p>\u914d\u5408load/store\u3001addi\u7b49\u6307\u4ee4\u768412\u7acb\u5373\u6570\uff0c\u7a0b\u5e8f\u5c31\u80fd\u8bbf\u95ee\u4efb\u4f5532\u4f4dPC\u76f8\u5bf9\u5730\u5740\u7684\u6570\u636e\u3002</p> <p>\u6545\u6b64\u6761\u6307\u4ee4\u7684\u5bfb\u5740\u8303\u56f4\u53ef\u8fbe PC \u00b1 2GB \uff082<sup>32</sup> = 4GB\uff09</p> <pre><code>------------------------------------\n|        |&lt;------PC------&gt;|        |\n------------------------------------\n0..... PC-2GB...........PC+2GB......0XFFFFF...FFF\n</code></pre> <p>\u800c\u5bf9\u4e8e <code>lui rd, imm</code>\uff0c\u5b83\u4ec5\u628a\u7acb\u5373\u6570\u7ed3\u679c\u5de6\u79fb12\u4f4d\u653e\u5230 rd \u4e2d\uff0c\u4e0d\u505a\u5176\u4ed6\u76f8\u5173\u7684\u3002</p> </li> <li> <p>S\u578b\u6307\u4ee4\u901a\u8fc7 <code>BITS</code> \u5f97\u5230 7\u4f4d + 5 \u4f4d\u7684\u7acb\u5373\u6570\u3002</p> </li> </ul> <p>\u5176\u5b9e\u5bf9\u6211\u4eec\u6765\u8bf4\uff0c\u9996\u8981\u76ee\u7684\u5c31\u662f\u80fd\u62fc\u63a5\u8d77\u6765\u7f16\u7a0b\u4e00\u4e2a32\u4f4d\u6570\u5373\u53ef\u3002</p> </li> <li> <p>Q3</p> <pre><code>INSTPAT(\"??????? ????? ????? 000 ????? 11001 11\", jalr   , I, volatile word_t t = s-&gt;pc + 4, s-&gt;dnpc = (src1 + imm) &amp; ~(word_t)1), R(rd) = t;\n</code></pre> <p>\u53d6\u53cd\u4e3a\u4e86\u8fdb\u884c\u5730\u5740\u5bf9\u9f50\u5904\u7406\u3002\u786e\u4fdd\u5730\u5740\u662f\u5076\u6570\uff08\u56e0\u4e3a RISC-V \u662f\u5076\u6570\u5bf9\u9f50\u7684\u6307\u4ee4\u96c6\uff09\u3002</p> <p>\u4f7f\u7528\u6309\u4f4d\u53d6\u53cd\u64cd\u4f5c\u7b26<code>~</code>\u548c\u6309\u4f4d\u4e0e\u64cd\u4f5c<code>&amp;</code>\u6765\u786e\u4fdd\u7ed3\u679c\u5730\u5740\u662f\u5076\u6570\u3002</p> <p><code>~(word_t)1</code>\u4f1a\u751f\u6210\u4e00\u4e2a\u6240\u6709\u4f4d\u90fd\u662f1\u9664\u4e86\u6700\u4f4e\u4f4d\u662f0\u7684\u6570\uff08\u56e0\u4e3a<code>word_t</code>\u662f\u65e0\u7b26\u53f7\u7c7b\u578b\u4ee5<code>~1</code>\u4f1a\u5f97\u5230\u5168\u90e8\u4f4d\u90fd\u662f1\u7684\u6570\uff0c\u9664\u4e86\u6700\u4f4e\u4f4d\u662f0\uff09\u3002</p> <p>\u5982\u679c <code>src1</code> \u7684\u503c\u52a0\u4e0a <code>imm</code> \u540e\u5f97\u5230\u7684\u5730\u5740\u4e0d\u662f\u5076\u6570\uff0c\u90a3\u4e48<code>s-&gt;dnpc</code>\u5c06\u6307\u5411\u4e00\u4e2a\u5947\u6570\u5730\u5740\uff0c\u8fd9\u8fdd\u53cd\u4e86RISC-V\u6307\u4ee4\u5bf9\u9f50\u7684\u8981\u6c42\u3002</p> <p>\u56e0\u4e3a <code>jalr</code> \u662f <code>I</code> \u578b\u6307\u4ee4\uff0c\u6ca1\u6709\u6211\u81ea\u5df1/\u6846\u67b6\u589e\u52a0\u7684\u5de6\u79fb\u64cd\u4f5c\u4fdd\u8bc1\u751f\u6210\u7684\u7acb\u5373\u6570\u52a0\u4e0aPC\u503c\u4e3a\u5076\u6570\uff0c\u6240\u4ee5\u9700\u8981\u6211\u624b\u52a8\u5199\u597d <code>jalr</code> \u4fdd\u6301 <code>imm[0] = 0</code> \u7684\u884c\u4e3a\u3002</p> <p>\u603b\u7ed3\uff1a\u5982\u679c\u662f <code>I</code> <code>U</code> <code>S</code> <code>J</code> <code>B</code> \u578b\u6307\u4ee4\uff0c\u90a3\u4e0d\u7528\u81ea\u5df1\u8fdb\u884c\u7acb\u5373\u6570\u7684\u5bf9\u9f50\uff1f</p> <p>\u5982\u679c\u662f <code>J</code> \u578b \u548c <code>B</code> \u578b\u548c <code>U</code> \u578b\u90a3\u5c31\u4e0d\u7528\u4e86\u3002</p> </li> <li> <p>\u53e6\u5916\u60f3\u7684\uff1a</p> <p>you may forget add sext for your instruction if you don't add sext by macro to extend your imm. </p> </li> </ul> <p>\u7efc\u4e0a\uff0c\u8865\u5145\u5b9e\u73b0 <code>immJ</code>\uff1a</p> <pre><code>#define immJ()  do { \\\n    SEXT( \\\n    (BITS(i, 31, 31) &lt;&lt; 19) | \\\n    (BITS(i, 19, 12) &lt;&lt; 11) | \\\n    BITS(i, 12, 12) | \\\n    (BITS(i, 30, 21))) &lt;&lt; 1, 21)  \\\n}while(0)\n</code></pre> <p>\u7559\u5751</p> <p>\u8001\u662f\u5728\u8bf4\u5bf9\u9f50\u5bf9\u9f50\uff0c\u4ec0\u4e48\u662f\u5bf9\u9f50\uff1f\u5bf9\u9f50\u7528\u6765\u5e72\u4ec0\u4e48\uff1f\u5177\u4f53\u7684\u5e94\u7528\u6848\u4f8b\uff1f</p> <ul> <li> <p>\u4e00\u4e9b\u9519\u8bef\uff1a</p> <pre><code>\u8fd9\u4e2a\u53ef\u4ee5\uff1as-&gt;dnpc = (src1 + imm) &amp; ~(word_t)1;     R(rd) = s-&gt;pc + 4);\n\u8fd9\u4e2a\u4e0d\u884c\uff1as-&gt;dnpc = (R(src1) + imm) &amp; ~(word_t)1;     R(rd) = s-&gt;pc + 4);\n</code></pre> <p>\u8fd9\u91cc\u5fd8\u8bb0\u4e86\uff1asrc1\u662f\u7528\u5b8f\u7684\u4e86\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_4","title":"\u666e\u901a\u6307\u4ee4","text":"<p>\u666e\u901a\u6307\u4ee4\u662fRISC-V\u6307\u4ee4\u96c6\u67b6\u6784\u4e2d\u5b9a\u4e49\u7684\u6307\u4ee4\uff0c\u5b83\u4eec\u76f4\u63a5\u7531\u5904\u7406\u5668\u6267\u884c\u3002\u8fd9\u4e9b\u6307\u4ee4\u5305\u62ec\uff1a</p> <ul> <li>\u52a0\u8f7d\u548c\u5b58\u50a8\u6307\u4ee4\uff08\u5982<code>lw</code>, <code>sw</code>\uff09</li> <li>\u7b97\u672f\u6307\u4ee4\uff08\u5982<code>add</code>, <code>sub</code>\uff09</li> <li>\u903b\u8f91\u6307\u4ee4\uff08\u5982<code>and</code>, <code>or</code>\uff09</li> <li>\u5206\u652f\u6307\u4ee4\uff08\u5982<code>beq</code>, <code>bne</code>\uff09</li> <li>\u63a7\u5236\u6307\u4ee4\uff08\u5982<code>jal</code>, <code>jalr</code>\uff09</li> </ul> <p>\u666e\u901a\u6307\u4ee4\u662f\u786c\u4ef6\u76f4\u63a5\u6267\u884c\u7684\uff0c\u5b83\u4eec\u5bf9\u5e94\u4e8eRISC-V\u5904\u7406\u5668\u7684\u786c\u4ef6\u64cd\u4f5c\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_5","title":"\u4f2a\u6307\u4ee4","text":"<p>\u4f2a\u6307\u4ee4\u4e0d\u662fRISC-V\u6307\u4ee4\u96c6\u7684\u4e00\u90e8\u5206\uff0c\u800c\u662f\u7531\u6c47\u7f16\u5668\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u5904\u7406\u7684\u7279\u6b8a\u6307\u4ee4\u3002\u5b83\u4eec\u7528\u4e8e\u7b80\u5316\u6c47\u7f16\u7a0b\u5e8f\u7684\u7f16\u5199\uff0c\u63d0\u4f9b\u4e00\u4e9b\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u4f46\u6700\u7ec8\u4f1a\u88ab\u6c47\u7f16\u5668\u8f6c\u6362\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u666e\u901a\u6307\u4ee4\u3002\u5e38\u89c1\u7684\u4f2a\u6307\u4ee4\u5305\u62ec\uff1a</p> <ul> <li><code>.text</code>\uff1a\u6307\u793a\u6c47\u7f16\u5668\u63a5\u4e0b\u6765\u7684\u6307\u4ee4\u662f\u7a0b\u5e8f\u7684\u6587\u672c\u90e8\u5206\u3002</li> <li><code>.data</code>\uff1a\u6307\u793a\u6c47\u7f16\u5668\u63a5\u4e0b\u6765\u7684\u6307\u4ee4\u662f\u6570\u636e\u90e8\u5206\u3002</li> <li><code>.globl</code>\uff1a\u58f0\u660e\u4e00\u4e2a\u5168\u5c40\u7b26\u53f7\u3002</li> <li><code>.align</code>\uff1a\u5bf9\u9f50\u6307\u4ee4\uff0c\u7528\u4e8e\u786e\u4fdd\u6570\u636e\u6216\u6307\u4ee4\u5728\u5185\u5b58\u4e2d\u7684\u5bf9\u9f50\u3002</li> <li><code>.word</code>\uff1a\u5b9a\u4e49\u4e00\u4e2a\u6216\u591a\u4e2a32\u4f4d\u7684\u5b57\u3002</li> <li><code>.byte</code>\uff1a\u5b9a\u4e49\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e\u3002</li> <li><code>nop</code>\uff1a\u65e0\u64cd\u4f5c\uff0c\u901a\u5e38\u7528\u4f5c\u5360\u4f4d\u7b26\u6216\u5ef6\u8fdf\u3002</li> </ul> <p>\u4f2a\u6307\u4ee4\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u63d0\u4f9b\u7ed9\u7a0b\u5e8f\u5458\u4e00\u79cd\u66f4\u76f4\u89c2\u548c\u65b9\u4fbf\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u6c47\u7f16\u4ee3\u7801\uff0c\u5b83\u4eec\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u88ab\u8f6c\u6362\u6210\u5b9e\u9645\u7684\u673a\u5668\u6307\u4ee4\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_6","title":"\u533a\u522b","text":"<ul> <li>\u6267\u884c\u5c42\u9762\uff1a\u666e\u901a\u6307\u4ee4\u7531\u5904\u7406\u5668\u6267\u884c\uff0c\u800c\u4f2a\u6307\u4ee4\u7531\u6c47\u7f16\u5668\u5904\u7406\u3002</li> <li>\u76ee\u7684\uff1a\u666e\u901a\u6307\u4ee4\u7528\u4e8e\u5b9e\u73b0\u5177\u4f53\u7684\u64cd\u4f5c\uff0c\u4f2a\u6307\u4ee4\u7528\u4e8e\u7b80\u5316\u7f16\u7a0b\u548c\u63d0\u4f9b\u7f16\u8bd1\u65f6\u7684\u63a7\u5236\u3002</li> <li>\u8f6c\u6362\uff1a\u4f2a\u6307\u4ee4\u5728\u7f16\u8bd1\u65f6\u4f1a\u88ab\u8f6c\u6362\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u666e\u901a\u6307\u4ee4\u3002</li> <li>\u53ef\u89c1\u6027\uff1a\u666e\u901a\u6307\u4ee4\u5728\u6700\u7ec8\u7684\u673a\u5668\u4ee3\u7801\u4e2d\u53ef\u89c1\uff0c\u4f2a\u6307\u4ee4\u5219\u4e0d\u4f1a\u3002 </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_7","title":"\u8fd0\u884c\u66f4\u591a\u7684\u7a0b\u5e8f","text":"<p>\u8bb2\u4e49\uff1a</p> <p>\u672a\u6d4b\u8bd5\u4ee3\u7801\u6c38\u8fdc\u662f\u9519\u7684, \u4f60\u9700\u8981\u66f4\u591a\u7684\u6d4b\u8bd5\u7528\u4f8b\u6765\u6d4b\u8bd5\u4f60\u7684NEMU. \u6211\u4eec\u5728<code>am-kernels/tests/cpu-tests/</code>\u76ee\u5f55\u4e0b\u51c6\u5907\u4e86\u4e00\u4e9b\u7b80\u5355\u7684\u6d4b\u8bd5\u7528\u4f8b. \u5728\u8be5\u76ee\u5f55\u4e0b\u6267\u884c</p> <pre><code>make ARCH=$ISA-nemu ALL=xxx run\n</code></pre> <p>\u5176\u4e2d<code>xxx</code>\u4e3a\u6d4b\u8bd5\u7528\u4f8b\u7684\u540d\u79f0(\u4e0d\u5305\u542b<code>.c</code>\u540e\u7f00).</p> <p>\u4e0a\u8ff0<code>make run</code>\u7684\u547d\u4ee4\u6700\u7ec8\u4f1a\u542f\u52a8NEMU, \u5e76\u8fd0\u884c\u76f8\u5e94\u7684\u5ba2\u6237\u7a0b\u5e8f. \u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528GDB\u6765\u8c03\u8bd5NEMU\u8fd0\u884c\u5ba2\u6237\u7a0b\u5e8f\u7684\u60c5\u51b5, \u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4:</p> <pre><code>make ARCH=$ISA-nemu ALL=xxx gdb\n</code></pre> <p>\u9664\u4e86 <code>string</code> \u548c <code>hello-str</code> \u8fd8\u9700\u8981\u5b9e\u73b0\u989d\u5916\u7684\u5185\u5bb9\u624d\u80fd\u8fd0\u884c(\u5177\u4f53\u5728\u540e\u7eed\u5c0f\u8282\u4ecb\u7ecd), \u76ee\u524d\u53ef\u4ee5\u5148\u4f7f\u7528\u5176\u5b83\u6d4b\u8bd5\u7528\u4f8b\u8fdb\u884c\u6d4b\u8bd5.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6307\u4ee4\u540d\u5bf9\u7167</p> <p>AT&amp;T\u683c\u5f0f\u53cd\u6c47\u7f16\u7ed3\u679c\u4e2d\u7684\u5c11\u91cf\u6307\u4ee4, \u4e0e\u624b\u518c\u4e2d\u5217\u51fa\u7684\u6307\u4ee4\u540d\u79f0\u4e0d\u7b26, \u5982x86\u7684<code>cltd</code>, mips32\u548criscv32\u5219\u6709\u4e0d\u5c11\u4f2a\u6307\u4ee4(pseudo instruction). \u9664\u4e86STFW\u4e4b\u5916, \u4f60\u6709\u529e\u6cd5\u5728\u624b\u518c\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u6307\u4ee4\u5417? \u5982\u679c\u6709\u7684\u8bdd, \u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u529e\u6cd5\u662f\u6709\u6548\u7684\u5462?</p> <p>\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u4f2a\u6307\u4ee4\uff08Pseudo-instruction\uff09\u662f\u6c47\u7f16\u5668\u63d0\u4f9b\u7684\uff0c\u5b83\u4eec\u5728\u6c47\u7f16\u65f6\u4f1a\u88ab\u8f6c\u6362\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u9645\u7684\u673a\u5668\u6307\u4ee4\u3002\u4f2a\u6307\u4ee4\u4f7f\u5f97\u6c47\u7f16\u8bed\u8a00\u7a0b\u5e8f\u66f4\u52a0\u6613\u8bfb\u548c\u6613\u4e8e\u7f16\u5199\uff0c\u4f46\u5b83\u4eec\u5e76\u4e0d\u662fCPU\u5b9e\u9645\u6267\u884c\u7684\u6307\u4ee4\u3002\u4e0d\u540c\u67b6\u6784\u7684\u6c47\u7f16\u8bed\u8a00\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u4f2a\u6307\u4ee4\u96c6\u3002</p> <p>\u5bf9\u4e8e\u60a8\u63d0\u5230\u7684\u51e0\u79cd\u6307\u4ee4\u548c\u67b6\u6784\uff1a</p> <ol> <li> <p>x86\u7684<code>cltd</code>\uff1a\u8fd9\u662fAT&amp;T\u8bed\u6cd5\u4e2d\u7684\u4e00\u4e2a\u6307\u4ee4\uff0c\u5b83\u4ee3\u8868\u201cConvert Long to Doubleword\u201d\u3002\u5728Intel\u8bed\u6cd5\u4e2d\uff0c\u8fd9\u4e2a\u6307\u4ee4\u88ab\u79f0\u4e3a<code>cwde</code>\uff08Convert Word to Extended\uff09\u3002<code>cltd</code>\u5c06\u4e00\u4e2a32\u4f4d\u7684\u957f\u6574\u578b\uff08<code>long</code>\uff09\u6269\u5c55\u523064\u4f4d\u7684\u53cc\u500d\u957f\u6574\u578b\uff08<code>long long</code>\u6216<code>doubleword</code>\uff09\u3002\u5728\u624b\u518c\u4e2d\uff0c\u8fd9\u4e2a\u6307\u4ee4\u901a\u5e38\u5bf9\u5e94\u4e8e\u5b9e\u9645\u7684\u673a\u5668\u6307\u4ee4\uff0c\u6bd4\u5982<code>cwde</code>\u3002</p> </li> <li> <p>MIPS32\u7684\u4f2a\u6307\u4ee4\uff1aMIPS\u67b6\u6784\u4e2d\u6709\u8bb8\u591a\u4f2a\u6307\u4ee4\uff0c\u4f8b\u5982<code>li</code>\uff08Load Immediate\uff09\uff0c\u5b83\u7528\u4e8e\u5c06\u7acb\u5373\u6570\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u4e2d\u3002\u5728MIPS\u7684\u6c47\u7f16\u5668\u4e2d\uff0c<code>li</code>\u53ef\u80fd\u88ab\u8f6c\u6362\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u9645\u7684\u6307\u4ee4\uff0c\u5982<code>addiu</code>\uff08Add Immediate Unsigned\uff09\uff0c\u5982\u679c\u7acb\u5373\u6570\u9002\u5408\u5355\u6761\u6307\u4ee4\u7684\u8bdd\u3002</p> </li> <li> <p>RISC-V\u7684\u4f2a\u6307\u4ee4\uff1aRISC-V\u540c\u6837\u6709\u4f2a\u6307\u4ee4\uff0c\u5b83\u4eec\u88ab\u8bbe\u8ba1\u4e3a\u63d0\u4f9b\u66f4\u7b80\u6d01\u7684\u6c47\u7f16\u8bed\u8a00\u7f16\u7a0b\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c<code>li</code>\u5728RISC-V\u4e2d\u4e5f\u662f\u7528\u6765\u52a0\u8f7d\u7acb\u5373\u6570\u5230\u5bc4\u5b58\u5668\u3002RISC-V\u7684\u6c47\u7f16\u5668\u4f1a\u5c06<code>li</code>\u8f6c\u6362\u6210\u5408\u9002\u7684RISC-V\u673a\u5668\u6307\u4ee4\uff0c\u5982<code>addi</code>\uff08Add Immediate\uff09\u3002</p> </li> </ol> <p>\u8981\u627e\u5230\u624b\u518c\u4e2d\u7684\u5bf9\u5e94\u6307\u4ee4\uff0c\u60a8\u53ef\u4ee5\uff1a</p> <ul> <li>\u67e5\u770b\u6c47\u7f16\u5668\u6587\u6863\uff1a\u6c47\u7f16\u5668\u7684\u6587\u6863\u901a\u5e38\u4f1a\u5217\u51fa\u5b83\u652f\u6301\u7684\u6240\u6709\u4f2a\u6307\u4ee4\u4ee5\u53ca\u5b83\u4eec\u5bf9\u5e94\u7684\u5b9e\u9645\u673a\u5668\u6307\u4ee4\u3002</li> <li>\u67e5\u9605\u67b6\u6784\u7684\u5b98\u65b9\u624b\u518c\uff1a\u5b98\u65b9\u7684\u67b6\u6784\u624b\u518c\u4f1a\u8be6\u7ec6\u5217\u51fa\u6240\u6709\u6709\u6548\u7684\u673a\u5668\u6307\u4ee4\u548c\u5b83\u4eec\u7684\u7f16\u7801\u3002</li> <li>\u4f7f\u7528\u53cd\u6c47\u7f16\u5de5\u5177\uff1a\u5c06\u4f2a\u6307\u4ee4\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u53cd\u6c47\u7f16\uff0c\u67e5\u770b\u751f\u6210\u7684\u5b9e\u9645\u673a\u5668\u6307\u4ee4\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u529e\u6cd5\u6709\u6548\uff1f</p> <ul> <li>\u6c47\u7f16\u5668\u7684\u4e00\u81f4\u6027\uff1a\u5927\u591a\u6570\u6c47\u7f16\u5668\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u5219\u6765\u8f6c\u6362\u4f2a\u6307\u4ee4\uff0c\u8fd9\u610f\u5473\u7740\u4e00\u65e6\u60a8\u4e86\u89e3\u4e86\u8fd9\u4e9b\u89c4\u5219\uff0c\u5c31\u53ef\u4ee5\u9884\u6d4b\u4f2a\u6307\u4ee4\u5982\u4f55\u88ab\u8f6c\u6362\u3002</li> <li>\u67b6\u6784\u624b\u518c\u7684\u5b8c\u6574\u6027\uff1a\u67b6\u6784\u624b\u518c\u63d0\u4f9b\u4e86\u6240\u6709\u6307\u4ee4\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u5305\u62ec\u5b83\u4eec\u7684\u64cd\u4f5c\u548c\u7f16\u7801\uff0c\u8fd9\u662f\u7406\u89e3\u4f2a\u6307\u4ee4\u5982\u4f55\u5de5\u4f5c\u7684\u57fa\u77f3\u3002</li> <li>\u5de5\u5177\u7684\u8f85\u52a9\uff1a\u53cd\u6c47\u7f16\u5de5\u5177\u53ef\u4ee5\u76f4\u63a5\u663e\u793a\u4f2a\u6307\u4ee4\u5bf9\u5e94\u7684\u5b9e\u9645\u673a\u5668\u6307\u4ee4\uff0c\u4e3a\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e86\u76f4\u89c2\u7684\u53c2\u8003\u3002</li> </ul> <p>\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u77e5\u9053RISC-V\u4e2d<code>li</code>\u4f2a\u6307\u4ee4\u5982\u4f55\u5de5\u4f5c\uff0c\u60a8\u53ef\u4ee5\u67e5\u9605RISC-V\u7684\u5b98\u65b9\u624b\u518c\uff0c\u627e\u5230<code>addi</code>\u6307\u4ee4\u7684\u63cf\u8ff0\uff0c\u6216\u8005\u4f7f\u7528RISC-V\u7684\u6c47\u7f16\u5668\u548c\u53cd\u6c47\u7f16\u5668\u6765\u89c2\u5bdf<code>li</code>\u5982\u4f55\u88ab\u8f6c\u6362\u3002</p> </li> <li> <p>\u601d\u8003\u9898\uff08\u53ef\u9009\uff09</p> <p>mips32\u7684\u5206\u652f\u5ef6\u8fdf\u69fd</p> <p>\u4e3a\u4e86\u63d0\u5347\u5904\u7406\u5668\u7684\u6027\u80fd, mips\u4f7f\u7528\u4e86\u4e00\u79cd\u53eb\u5206\u652f\u5ef6\u8fdf\u69fd\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u7684\u6280\u672f. \u91c7\u7528\u8fd9\u79cd\u6280\u672f\u4e4b\u540e, \u7a0b\u5e8f\u7684\u6267\u884c\u987a\u5e8f\u4f1a\u53d1\u751f\u4e00\u4e9b\u6539\u53d8: \u6211\u4eec\u628a\u7d27\u8ddf\u5728\u8df3\u8f6c\u6307\u4ee4(\u5305\u62ec\u6709\u6761\u4ef6\u548c\u65e0\u6761\u4ef6)\u4e4b\u540e\u7684\u9759\u6001\u6307\u4ee4\u79f0\u4e3a\u5ef6\u8fdf\u69fd, \u90a3\u4e48\u7a0b\u5e8f\u5728\u6267\u884c\u5b8c\u8df3\u8f6c\u6307\u4ee4\u540e, \u4f1a\u5148\u6267\u884c\u5ef6\u8fdf\u69fd\u4e2d\u7684\u6307\u4ee4, \u518d\u6267\u884c\u4f4d\u4e8e\u8df3\u8f6c\u76ee\u6807\u7684\u6307\u4ee4. \u4f8b\u5982</p> <pre><code>100: beq 200\n101: add\n102: xor\n...\n200: sub\n201: j   102\n202: slt\n</code></pre> <p>\u82e5<code>beq</code>\u6307\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u4e3a\u8df3\u8f6c, \u5219\u76f8\u5e94\u7684\u52a8\u6001\u6307\u4ee4\u6d41\u4e3a<code>100 -&gt; 101 -&gt; 200</code>; \u82e5<code>beq</code>\u6307\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u4e3a\u4e0d\u8df3\u8f6c, \u5219\u76f8\u5e94\u7684\u52a8\u6001\u6307\u4ee4\u6d41\u4e3a<code>100 -&gt; 101 -&gt; 102</code>; \u800c\u5bf9\u4e8e<code>j</code>\u6307\u4ee4, \u76f8\u5e94\u7684\u52a8\u6001\u6307\u4ee4\u6d41\u4e3a<code>201 -&gt; 202 -&gt; 102</code>.</p> <p>\u4f60\u4e00\u5b9a\u4f1a\u5bf9\u8fd9\u79cd\u53cd\u76f4\u89c9\u7684\u6280\u672f\u5982\u4f55\u63d0\u5347\u5904\u7406\u5668\u6027\u80fd\u800c\u611f\u5230\u7591\u60d1. \u4e0d\u8fc7\u8fd9\u9700\u8981\u4f60\u5148\u4e86\u89e3\u4e00\u4e9b\u5fae\u7ed3\u6784\u7684\u77e5\u8bc6, \u4f8b\u5982\u5904\u7406\u5668\u6d41\u6c34\u7ebf\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00, \u4f46\u8fd9\u5df2\u7ecf\u8d85\u51fa\u4e86ICS\u7684\u8bfe\u7a0b\u8303\u56f4\u4e86, \u6240\u4ee5\u6211\u4eec\u4e5f\u4e0d\u8be6\u7ec6\u89e3\u91ca\u4e86, \u611f\u5174\u8da3\u7684\u8bdd\u53ef\u4ee5STFW.</p> <p>\u4f46\u6211\u4eec\u53ef\u4ee5\u77e5\u9053, \u5ef6\u8fdf\u69fd\u6280\u672f\u9700\u8981\u8f6f\u786c\u4ef6\u534f\u540c\u624d\u80fd\u6b63\u786e\u5de5\u4f5c: mips\u624b\u518c\u4e2d\u63cf\u8ff0\u4e86\u8fd9\u4e00\u7ea6\u5b9a, \u5904\u7406\u5668\u8bbe\u8ba1\u8005\u6309\u7167\u8fd9\u4e00\u7ea6\u5b9a\u8bbe\u8ba1\u5904\u7406\u5668, \u800c\u7f16\u8bd1\u5668\u5f00\u53d1\u8005\u5219\u4f1a\u8ba9\u7f16\u8bd1\u5668\u8d1f\u8d23\u5728\u5ef6\u8fdf\u69fd\u4e2d\u653e\u7f6e\u4e00\u6761\u6709\u610f\u4e49\u7684\u6307\u4ee4, \u4f7f\u5f97\u65e0\u8bba\u662f\u5426\u8df3\u8f6c, \u6309\u7167\u8fd9\u4e00\u7ea6\u5b9a\u7684\u6267\u884c\u987a\u5e8f\u90fd\u80fd\u5f97\u5230\u6b63\u786e\u7684\u6267\u884c\u7ed3\u679c.</p> <p>\u5982\u679c\u4f60\u662f\u7f16\u8bd1\u5668\u5f00\u53d1\u8005, \u4f60\u5c06\u4f1a\u5982\u4f55\u5bfb\u627e\u5408\u9002\u7684\u6307\u4ee4\u653e\u5230\u5ef6\u8fdf\u69fd\u4e2d\u5462?</p> <p>mips32-NEMU\u7684\u5206\u652f\u5ef6\u8fdf\u69fd</p> <p>\u65e2\u7136mips\u6709\u8fd9\u6837\u7684\u7ea6\u5b9a, \u800c\u7f16\u8bd1\u5668\u4e5f\u5df2\u7ecf\u9075\u5faa\u8fd9\u4e00\u7ea6\u5b9a, \u90a3\u4e48\u5bf9\u4e8emips32\u7f16\u8bd1\u5668\u751f\u6210\u7684\u7a0b\u5e8f, \u6211\u4eec\u4e5f\u5e94\u8be5\u9075\u5faa\u8fd9\u4e00\u7ea6\u5b9a\u6765\u89e3\u91ca\u5176\u8bed\u4e49. \u8fd9\u610f\u5473\u7740, mips32-NEMU\u4f5c\u4e3a\u4e00\u4e2a\u6a21\u62df\u7684mips32 CPU, \u4e5f\u9700\u8981\u5b9e\u73b0\u5206\u652f\u5ef6\u8fdf\u69fd\u6280\u672f, \u624d\u80fd\u6b63\u786e\u5730\u652f\u6491mips32\u7a0b\u5e8f\u7684\u8fd0\u884c.</p> <p>\u4e8b\u5b9e\u4e0a, gcc\u4e3amips32\u7a0b\u5e8f\u7684\u751f\u6210\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>-fno-delayed-branch</code>\u7684\u7f16\u8bd1\u9009\u9879, \u8ba9mips32\u7a0b\u5e8f\u4e2d\u7684\u5ef6\u8fdf\u69fd\u4e2d\u90fd\u653e\u7f6e<code>nop</code>\u6307\u4ee4. \u8fd9\u6837\u4ee5\u540e, \u6267\u884c\u8df3\u8f6c\u6307\u4ee4\u4e4b\u540e, \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u8df3\u8f6c\u76ee\u6807\u7684\u6307\u4ee4\u4e86, \u56e0\u4e3a\u5ef6\u8fdf\u69fd\u4e2d\u90fd\u662f<code>nop</code>\u6307\u4ee4, \u5c31\u7b97\u4e0d\u6267\u884c\u5b83, \u4e5f\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u7684\u6b63\u786e\u6027.</p> <p>\u6211\u4eec\u5df2\u7ecf\u5728\u7f16\u8bd1mips32\u7a0b\u5e8f\u7684\u547d\u4ee4\u4e2d\u6dfb\u52a0\u4e86\u8fd9\u4e00\u7f16\u8bd1\u9009\u9879, \u4e8e\u662f\u6211\u4eec\u5728\u5b9e\u73b0mips32-NEMU\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u8fdb\u884c\u7b80\u5316, \u65e0\u9700\u5b9e\u73b0\u5206\u652f\u5ef6\u8fdf\u69fd\u4e86.</p> <p>\u5bf9PA\u6765\u8bf4, \u53bb\u6389\u5ef6\u8fdf\u69fd\u8fd8\u6709\u5176\u5b83\u7684\u597d\u5904, \u6211\u4eec\u4f1a\u5728\u540e\u7eed\u5185\u5bb9\u4e2d\u8fdb\u884c\u8ba8\u8bba.</p> <p>\u4e86\u89e3\u4e00\u4e0b\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_8","title":"\u4e00\u4e9b\u8bb0\u5f55","text":"<ul> <li> <p>\u5b9e\u73b0 <code>src1 + src2</code>\u5199\u6210\u4e86 <code>src1+ src1</code></p> </li> <li> <p><code>andi, I, R(rd) = src1 &amp; imm</code> \u8fd9\u79cd\u6307\u4ee4\uff0c\u770b\u6e05\u695a\uff0c\u662f <code>src1 &amp; imm</code> \u4e0d\u662f <code>src1 &amp; src2</code> </p> </li> <li> <p>\u7279\u522b\u6ce8\u610f\u4e0b\u540c\u65f6\u6709\u7b26\u53f7\u6269\u5c55\u548c\u96f6\u6269\u5c55\u7684\u6307\u4ee4\uff0c\u6bd4\u5982\u8bf4 <code>slt\u3001sltu</code>\u3001<code>bge\u3001bgeu</code> \u7b49\u7b49</p> <p>\u770b\u6e05\u76ee\u6807\u6570\u9700\u4e0d\u9700\u8981\u6269\u5c55\u7b26\u53f7\u3002</p> </li> <li> <p>RV32M: \u5b9e\u73b0 <code>mulh</code> \u7684\u95ee\u9898 \u91cd\u8981</p> <p>\u63a8\u8350\u9605\u8bfb\uff1a</p> <p>Multiplication Examples Using the Fixed-Point Representation - Technical Articles (allaboutcircuits.com)</p> <p>\u8bb2\u5f97\u5f88\u4e0d\u9519\u3002</p> <p>\u8865\u7801\u4e58\u6cd5\u8ba1\u7b97</p> <pre><code>MULH  (Multiply High)\n\nmulh rd, rs1, rs2\n\nx[rd] = (x[rs1] * x[rs2]) \u226bXLEN\n\n\u628a\u5bc4\u5b58\u5668 x[rs2]\u4e0e\u5bc4\u5b58\u5668 x[rs1]\u76f8\u4e58\uff0cx[rs1] x[rs2]\u90fd\u89c6\u4e3a\u4e8c\u8fdb\u5236\u8865\u7801(\u90fd\u4e3a\u6709\u7b26\u53f7\u6570)\uff0c\u5c06\u4e58\u79ef\u7684\u9ad8\u4f4d(\u5de632\u4f4d)\u5199\u5165x[rd]\u3002\n\n//\u4e8c\u8fdb\u5236\u8865\u7801(2\u7684\u8865\u7801)\uff1a(\u8ba1\u7b97\u673a\u4e2d\u8d1f\u6570\u7684\u8868\u793a\u65b9\u5f0f)\n\u7b2c\u4e00\u6b65\uff0c\u6bcf\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u90fd\u53d6\u53cd\u503c\uff0c0\u53d8\u62101\uff0c1\u53d8\u62100\u3002\n\u7b2c\u4e8c\u6b65\uff0c\u5c06\u4e0a\u4e00\u6b65\u7684\u5f97\u5230\u7684\u503c\u52a01\n</code></pre> <p>\u5c06 x[rs2] \u4e0e x[rs1] \u89c6\u4e3a\u8865\u7801\u5e76\u76f8\u4e58 \u610f\u5473\u7740\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u88ab\u89c6\u4e3a\u6709\u7b26\u53f7\u6574\u6570\uff08\u8865\u7801\u5f62\u5f0f\uff09\uff0c\u5373\u4f7f\u5b83\u4eec\u5b9e\u9645\u4e0a\u662f\u65e0\u7b26\u53f7\u6574\u6570\u3002</p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5c06\u6e90\u64cd\u4f5c\u6570\u89c6\u4e3a\u6709\u7b26\u53f7\u6574\u6570\u8fdb\u884c\u76f8\u4e58\u3002</li> <li>\u5c06\u4e58\u79ef\u7684\u9ad8\u4f4d\u90e8\u5206\u63d0\u53d6\u51fa\u6765\u3002</li> <li>\u5c06\u63d0\u53d6\u51fa\u6765\u7684\u9ad8\u4f4d\u90e8\u5206\u8d4b\u503c\u7ed9\u76ee\u6807\u5bc4\u5b58\u5668\u3002</li> </ol> <p>\u8865\u7801\u662f\u4e00\u79cd\u7528\u4e8e\u8868\u793a\u6709\u7b26\u53f7\u6574\u6570\u7684\u4e8c\u8fdb\u5236\u7f16\u7801\u65b9\u5f0f\uff0c\u5176\u4e2d\u6700\u9ad8\u4f4d\uff08\u7b26\u53f7\u4f4d\uff09\u4e3a0\u8868\u793a\u6b63\u6570\uff0c\u4e3a1\u8868\u793a\u8d1f\u6570\u3002</p> </li> <li> <p>\u6ce8\u610f\u5de6\u79fb\u53f3\u79fb\u7684\u987a\u5e8f\u3002</p> <p><code>sra</code> <code>srl</code>\u3002\u3002\u3002\u3002</p> </li> <li> <p>\u5173\u4e8e\u9664\u6cd5/\u53d6\u4f59\u7684\u8fb9\u754c\u503c\u5904\u7406</p> <p></p> <p>\u8fd4\u56de\u51681: <code>0xffffffff</code></p> </li> <li> <p>\u7559\u5751</p> <p>\u518d\u5f00\u4e86address sanitizer\u540e\uff0c\u65f6\u6709\u65f6\u65e0\u5730\u62a5\u4e00\u4e9b\u6bb5\u9519\u8bef\u81f4\u547d\u9519\u8bef\uff0c\u7b49\u6211\u6709\u7a7a\u56de\u6765\u770b\u770b\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#am","title":"\u7a0b\u5e8f\uff0c\u8fd0\u884c\u65f6\u73af\u5883\u4e0eAM","text":""},{"location":"ysyx/pa/pa2/pa2.html#_9","title":"\u8fd0\u884c\u65f6\u73af\u5883","text":"<p>\u4ece\u76f4\u89c9\u4e0a\u6765\u770b, \u8ba9\u4ec5\u4ec5\u53ea\u4f1a\"\u8ba1\u7b97\"\u7684TRM\u6765\u652f\u6491\u4e00\u4e2a\u529f\u80fd\u9f50\u5168\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fd0\u884c\u8fd8\u662f\u4e0d\u592a\u73b0\u5b9e\u7684. \u8fd9\u7ed9\u6211\u4eec\u7684\u611f\u89c9\u5c31\u662f, \u8ba1\u7b97\u673a\u4e5f\u6709\u4e00\u5b9a\u7684\"\u529f\u80fd\u5f3a\u5f31\"\u4e4b\u5206, \u8ba1\u7b97\u673a\u8d8a\"\u5f3a\u5927\", \u5c31\u80fd\u8dd1\u8d8a\u590d\u6742\u7684\u7a0b\u5e8f. \u6362\u53e5\u8bdd\u8bf4, \u7a0b\u5e8f\u7684\u8fd0\u884c\u5176\u5b9e\u662f\u5bf9\u8ba1\u7b97\u673a\u7684\u529f\u80fd\u6709\u9700\u6c42\u7684. \u5728\u4f60\u8fd0\u884cHello World\u7a0b\u5e8f\u65f6, \u4f60\u6572\u5165\u4e00\u6761\u547d\u4ee4(\u6216\u8005\u70b9\u51fb\u4e00\u4e0b\u9f20\u6807), \u7a0b\u5e8f\u5c31\u6210\u529f\u8fd0\u884c\u4e86, \u4f46\u8fd9\u80cc\u540e\u5176\u5b9e\u9690\u85cf\u7740\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1\u8005\u548c\u5e93\u51fd\u6570\u5f00\u53d1\u8005\u7684\u65e0\u6570\u6c57\u6c34. \u4e00\u4e2a\u4e8b\u5b9e\u662f, \u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u90fd\u9700\u8981\u8fd0\u884c\u65f6\u73af\u5883\u7684\u652f\u6301, \u5305\u62ec\u52a0\u8f7d, \u9500\u6bc1\u7a0b\u5e8f, \u4ee5\u53ca\u63d0\u4f9b\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u5404\u79cd\u52a8\u6001\u94fe\u63a5\u5e93(\u4f60\u7ecf\u5e38\u4f7f\u7528\u7684\u5e93\u51fd\u6570\u5c31\u662f\u8fd0\u884c\u65f6\u73af\u5883\u63d0\u4f9b\u7684)\u7b49. \u4e3a\u4e86\u8ba9\u5ba2\u6237\u7a0b\u5e8f\u5728NEMU\u4e2d\u8fd0\u884c, \u73b0\u5728\u8f6e\u5230\u4f60\u6765\u63d0\u4f9b\u76f8\u5e94\u7684\u8fd0\u884c\u65f6\u73af\u5883\u7684\u652f\u6301\u4e86.</p> <p>\u6839\u636eKISS\u6cd5\u5219, \u6211\u4eec\u5148\u6765\u8003\u8651\u6700\u7b80\u5355\u7684\u8fd0\u884c\u65f6\u73af\u5883\u662f\u4ec0\u4e48\u6837\u7684. \u6362\u53e5\u8bdd\u8bf4, \u4e3a\u4e86\u8fd0\u884c\u6700\u7b80\u5355\u7684\u7a0b\u5e8f, \u6211\u4eec\u9700\u8981\u63d0\u4f9b\u4ec0\u4e48\u5462? \u5176\u5b9e\u7b54\u6848\u5df2\u7ecf\u5728PA1\u4e2d\u4e86: \u53ea\u8981\u628a\u7a0b\u5e8f\u653e\u5728\u6b63\u786e\u7684\u5185\u5b58\u4f4d\u7f6e, \u7136\u540e\u8ba9PC\u6307\u5411\u7b2c\u4e00\u6761\u6307\u4ee4, \u8ba1\u7b97\u673a\u5c31\u4f1a\u81ea\u52a8\u6267\u884c\u8fd9\u4e2a\u7a0b\u5e8f, \u6c38\u4e0d\u505c\u6b62.</p> <p>\u4e0d\u8fc7, \u867d\u7136\u8ba1\u7b97\u673a\u53ef\u4ee5\u6c38\u4e0d\u505c\u6b62\u5730\u6267\u884c\u6307\u4ee4, \u4f46\u4e00\u822c\u7684\u7a0b\u5e8f\u90fd\u662f\u4f1a\u7ed3\u675f\u7684, \u6240\u4ee5\u8fd0\u884c\u65f6\u73af\u5883\u9700\u8981\u5411\u7a0b\u5e8f\u63d0\u4f9b\u4e00\u79cd\u7ed3\u675f\u8fd0\u884c\u7684\u65b9\u6cd5. \u806a\u660e\u7684\u4f60\u5df2\u7ecf\u80fd\u60f3\u5230, \u6211\u4eec\u5728PA1\u4e2d\u63d0\u5230\u7684\u90a3\u6761\u4eba\u5de5\u6dfb\u52a0\u7684<code>nemu_trap</code>\u6307\u4ee4, \u5c31\u662f\u8ba9\u7a0b\u5e8f\u6765\u7ed3\u675f\u8fd0\u884c\u7684.</p> <p>\u6240\u4ee5, \u53ea\u8981\u6709\u5185\u5b58, \u6709\u7ed3\u675f\u8fd0\u884c\u7684\u65b9\u5f0f, \u52a0\u4e0a\u5b9e\u73b0\u6b63\u786e\u7684\u6307\u4ee4, \u5c31\u53ef\u4ee5\u652f\u6491\u6700\u7b80\u5355\u7a0b\u5e8f\u7684\u8fd0\u884c\u4e86. \u800c\u8fd9, \u4e5f\u53ef\u4ee5\u7b97\u662f\u6700\u7b80\u5355\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e86.</p>"},{"location":"ysyx/pa/pa2/pa2.html#_10","title":"\u5c06\u8fd0\u884c\u65f6\u73af\u5883\u5c01\u88c5\u6210\u5e93","text":"<p>\u8fd0\u884c\u65f6\u73af\u5883\u7684\u4e00\u79cd\u666e\u904d\u7684\u5b58\u5728\u65b9\u5f0f: \u5e93. </p> <p>\u901a\u8fc7\u5e93, \u8fd0\u884c\u7a0b\u5e8f\u6240\u9700\u8981\u7684\u516c\u5171\u8981\u7d20\u88ab\u62bd\u8c61\u6210API, \u4e0d\u540c\u7684\u67b6\u6784\u53ea\u9700\u8981\u5b9e\u73b0\u8fd9\u4e9bAPI, \u4e5f\u5c31\u76f8\u5f53\u4e8e\u5b9e\u73b0\u4e86\u652f\u6491\u7a0b\u5e8f\u8fd0\u884c\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u8fd9\u63d0\u5347\u4e86\u7a0b\u5e8f\u5f00\u53d1\u7684\u6548\u7387: \u9700\u8981\u7684\u65f6\u5019\u53ea\u8981\u8c03\u7528\u8fd9\u4e9bAPI, \u5c31\u80fd\u4f7f\u7528\u8fd0\u884c\u65f6\u73af\u5883\u63d0\u4f9b\u7684\u76f8\u5e94\u529f\u80fd.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u8fd9\u53c8\u80fd\u600e\u4e48\u6837\u5462</p> <p>\u601d\u8003\u4e00\u4e0b, \u8fd9\u6837\u7684\u62bd\u8c61\u8fd8\u4f1a\u5e26\u6765\u54ea\u4e9b\u597d\u5904\u5462? \u4f60\u5f88\u5feb\u5c31\u4f1a\u4f53\u4f1a\u5230\u8fd9\u4e9b\u597d\u5904\u4e86.</p> <p>\u786c\u4ef6(\u4e0d\u540c\u67b6\u6784\u7684CPU)\u4e3a everything\uff08\u5305\u62ec\u64cd\u4f5c\u7cfb\u7edf\uff09\u63d0\u4f9b\u8fd0\u884c\u65f6\u73af\u5883\u3002</p> <p>\u5c06\u6765\u6211\u8981\u6362\u522b\u7684\u67b6\u6784\u8fc7\u6765\uff0c\u90a3\u4e0d\u662f\u5f88\u65b9\u4fbf\uff1f\u4f46\u662f\u4f1a\u6709\u6027\u80fd\u635f\u8017</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#am-bare-metal","title":"AM - \u88f8\u673a(bare-metal)\u8fd0\u884c\u65f6\u73af\u5883  (\u2b50)","text":"<p>\u533a\u5206 \u5e73\u53f0\u548c\u67b6\u6784</p> <p>\u6846\u67b6\u901a\u8fc7 \"ISA-\u5e73\u53f0\" \u7684\u4e8c\u5143\u7ec4\u6765\u8868\u793a\u4e00\u4e2a\u67b6\u6784, \u4f8b\u5982<code>mips32-nemu</code>. </p> <ul> <li>\u5e73\u53f0\uff1a\u6307\u7684\u662fAM\u5b9e\u73b0\u7684\u8fd0\u884c\u5e73\u53f0\uff0c\u4f8b\u5982NEMU\u5e73\u53f0\uff0c\u5b83\u662f\u4e00\u4e2a\u6a21\u62df\u5668\u5e73\u53f0\uff0c\u5141\u8bb8AM\u5728\u4e0d\u540c\u7684\u786c\u4ef6\u6216\u8f6f\u4ef6\u73af\u5883\u4e2d\u8fd0\u884c\u3002</li> <li>\u67b6\u6784\uff1a\u6307\u7684\u662fAM\u6a21\u62df\u7684\u5904\u7406\u5668\u67b6\u6784\uff0c\u5982MIPS32\u3001RISC-V 32\u4f4d\u548c64\u4f4d\u3001x86\u7b49\u3002\u6bcf\u79cd\u67b6\u6784\u90fd\u6709\u5176\u7279\u5b9a\u7684\u5b9e\u73b0\u548c\u5934\u6587\u4ef6\u5b9a\u4e49\u3002</li> </ul> <p>\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff08Linux/Windows/RTOS...\uff09-&gt; \u8fd0\u884c\u5728\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\u67b6\u6784\uff08risc-v32/64 x86 arm mips...\uff09\u4e0a -&gt; \u6307\u4ee4\u96c6\u67b6\u6784\u4f9d\u6258\u4e8e\u7269\u7406\u786c\u4ef6/\u6a21\u62df\u5668/\u865a\u62df\u673a</p> <p>\u6838\u5fc3\u529f\u80fd</p> <ul> <li> <p>\u62bd\u8c61</p> <p>\u628a\u5b9e\u73b0\u590d\u6742\u529f\u80fd\u7684\u9700\u6c42\u90fd\u6536\u96c6\u8d77\u6765, \u5c06\u5b83\u4eec\u62bd\u8c61\u6210\u7edf\u4e00\u7684API\u63d0\u4f9b\u7ed9\u7a0b\u5e8f, \u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u53ef\u4ee5\u652f\u6491\u5404\u79cd\u7a0b\u5e8f\u8fd0\u884c\u5728\u5404\u79cd\u67b6\u6784\u4e0a\u7684\u5e93\u4e86.</p> <p>\u5177\u4f53\u5730, \u6bcf\u4e2a\u67b6\u6784\u90fd\u6309\u7167\u5b83\u4eec\u7684\u7279\u6027\u5b9e\u73b0\u8fd9\u7ec4API; \u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u76f4\u63a5\u8c03\u7528\u8fd9\u7ec4API\u5373\u53ef, \u65e0\u9700\u5173\u5fc3\u81ea\u5df1\u5c06\u6765\u8fd0\u884c\u5728\u54ea\u4e2a\u67b6\u6784\u4e0a. \u7531\u4e8e\u8fd9\u7ec4\u7edf\u4e00\u62bd\u8c61\u7684API\u4ee3\u8868\u4e86\u7a0b\u5e8f\u8fd0\u884c\u5bf9\u8ba1\u7b97\u673a\u7684\u9700\u6c42, \u6240\u4ee5\u6211\u4eec\u628a\u8fd9\u7ec4API\u79f0\u4e3a\u62bd\u8c61\u8ba1\u7b97\u673a.</p> </li> <li> <p>\u6a21\u5757\u5316</p> <pre><code>AM = TRM + IOE + CTE + VME + MPE\n</code></pre> <ul> <li>TRM(Turing Machine) - \u56fe\u7075\u673a, \u6700\u7b80\u5355\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u57fa\u672c\u7684\u8ba1\u7b97\u80fd\u529b</li> <li>IOE(I/O Extension) - \u8f93\u5165\u8f93\u51fa\u6269\u5c55, \u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u8f93\u51fa\u8f93\u5165\u7684\u80fd\u529b</li> <li>CTE(Context Extension) - \u4e0a\u4e0b\u6587\u6269\u5c55, \u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u4e0a\u4e0b\u6587\u7ba1\u7406\u7684\u80fd\u529b</li> <li>VME(Virtual Memory Extension) - \u865a\u5b58\u6269\u5c55, \u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u865a\u5b58\u7ba1\u7406\u7684\u80fd\u529b</li> <li>MPE(Multi-Processor Extension) - \u591a\u5904\u7406\u5668\u6269\u5c55, \u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u591a\u5904\u7406\u5668\u901a\u4fe1\u7684\u80fd\u529b (MPE\u8d85\u51fa\u4e86ICS\u8bfe\u7a0b\u7684\u8303\u56f4, \u5728PA\u4e2d\u4e0d\u4f1a\u6d89\u53ca)</li> </ul> <p>\u611f\u89c9\u8fd9\u51e0\u4e2a\u6a21\u5757\u6709\u70b9\u50cf\u51af\u8bfa\u4f9d\u66fc\u67b6\u6784\uff0c\u597d\u50cf\u5c31\u662f\u90a3\u4e48\u56de\u4e8b\u3002</p> </li> </ul> <p>\u7ed3\u5408\u81ea\u5df1\u6284\u6284\u5199\u5199\u753b\u753b\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709AM? (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u6709\u81ea\u5df1\u7684\u8fd0\u884c\u65f6\u73af\u5883. AM\u548c\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u73af\u5883\u6709\u4ec0\u4e48\u4e0d\u540c\u5462? \u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u4e9b\u4e0d\u540c?</p> <p></p> <p>\u5148\u60f3\u60f3AM\u505a\u4e86\u4ec0\u4e48\uff0c\u6700\u4e3b\u8981\u7684\u529f\u80fd\u4e2a\u4eba\u8ba4\u4e3a\u662f\u62bd\u8c61\uff0c\u800c\u4e14\u662f\u66f4\u4f4e\u5c42\u6b21\u7684\u76f4\u63a5\u5bf9\u786c\u4ef6\u7684\u62bd\u8c61\u3002</p> <p>\u4f20\u7edf\u5b9e\u73b0\u662f\uff0cOS\uff08HAL\u5c42\uff09\u76f4\u63a5\u7ba1\u7406\u786c\u4ef6\u8d44\u6e90\uff0cOS\u901a\u5e38\u9488\u5bf9\u7684\u662f\u7279\u5b9a\u7684\u786c\u4ef6\u67b6\u6784\uff0c\u8fd9\u91cc\u66f4\u52a0\u5f3a\u8c03\u7684\u662f\u5bf9\u786c\u4ef6\u7684\u4e13\u5c5e\u6027\u3002\uff08\u5982\u76f4\u63a5\u8bfb\u5199\u5185\u5b58\u3001\u76f4\u63a5\u64cd\u4f5c\u5916\u8bbe\uff09</p> <p>\u8fd9\u5177\u4f53\u4e00\u70b9\u7406\u89e3\uff0c\u53ef\u4ee5\u60f3\u6210x86-64\u7684CPU\u3001loongarch\u7684CPU\u3001ARM\u7684CPU\u7b49\uff1b\u8fd8\u6709\u53ea\u80fd\u8fd0\u884c\u5728\u67d0\u79cd\u67b6\u6784\u4e0b\u7684\u4e0d\u540c\u5382\u5bb6\u7684\u5185\u5b58\u6761\u3001\u9f20\u6807\u3001\u952e\u76d8\u3001\u786c\u76d8\u7b49\u7b49\uff1f</p> <p>\u6bd4\u5982\u8bf4 PC \u7aef\u7684 CPU \u7edd\u5927\u90e8\u5206\u4e3ax64\u7684\uff0c\u90a3\u8fd9\u4e2a OS \u7684\u76f8\u5173\u5b9e\u73b0\u5c31\u53ea\u9002\u914d\u4e8e\u8fd9\u79cdx64\u6307\u4ee4\u96c6\uff0c\u8981\u662f\u6362\u5230ARM\u7684\uff0c\u90a3\u8fd9\u4e2a OS \u80af\u5b9a\u5c31\u8dd1\u4e0d\u8d77\u6765\u4e86\uff0c\u80af\u5b9a\u4e00\u5806\u9519\u8bef\u4e86\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e00\u5806\u9519\u8bef\uff1f</p> <p>\u4e8c\u8005\u6700\u6839\u672c\u7684\u7f16\u7a0b\u6a21\u578b\u5c31\u4e0d\u540c\uff0c\u6307\u4ee4\u96c6\u7684\u590d\u6742\u6027\u3001\u5bc4\u5b58\u5668\u7684\u6570\u91cf\u548c\u7528\u9014\u3001\u5185\u5b58\u7ba1\u7406\u548cI/O\u8bbf\u95ee\u65b9\u5f0f\u3001\u4ee5\u53ca\u5f02\u5e38\u548c\u4e2d\u65ad\u5904\u7406\u673a\u5236\u7b49\u7b49\u65b9\u9762\u90fd\u4e0d\u540c\u3002\u6309\u4ee5\u524d\u6765\u8bf4\uff0cARM\u7684\u7f16\u7a0b\u6a21\u578b\u66f4\u52a0\u6ce8\u91cd\u80fd\u6548\u548c\u7b80\u6d01\uff0c\u800cx86-64\u5219\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u6307\u4ee4\u548c\u7075\u6d3b\u6027\uff0c\u73b0\u4ee3\u7a76\u7adf\u505a\u4e86\u4ec0\u4e48\u4f18\u5316\u6539\u8fdb\u4e0d\u8ba8\u8bba\u3002</p> <p>\u800c\u65b0\u52a0\u5165\u7684\u4e00\u5c42 AM \u5c31\u66f4\u52a0\u5f3a\u8c03\u4e86\u901a\u7528\u6027\u3002\u5b83\u5c4f\u853d\u4e86\u5404\u4e2a\u6307\u4ee4\u96c6\u67b6\u6784\uff08CPU\uff09\u7684\u533a\u522b\uff0c\u5c06 ARM\u3001x86-64\u7b49\u6307\u4ee4\u96c6\u540c\u610f\u62bd\u8c61\u6210\u4e86\u4e00\u5c42\u7684API\uff0c\u4e0a\u5c42\u7684\u7a0b\u5e8f\uff08\u5305\u62ecOS\uff09\u53ea\u9700\u8981\u76f4\u63a5\u8c03\u7528\u8fd9\u7ec4API\u5373\u53ef, \u65e0\u9700\u5173\u5fc3\u81ea\u5df1\u5c06\u6765\u8fd0\u884c\u5728\u54ea\u4e2a\u67b6\u6784\u4e0a\uff0c\u6216\u8005\u8bf4\u6b3a\u9a97\u4e86OS\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u8fdb\u4e00\u6b65\u5212\u5206\u51fa\u5c42\u6b21\u56fe\uff1a</p> <pre><code>+----------------+    \u5e94\u7528\u7a0b\u5e8f\u7f16\u5199\u548c\u8fd0\u884c\u7684\u5730\u65b9\n|   \u5e94\u7528\u7a0b\u5e8f\u5c42     |   \u5229\u7528AM\u63d0\u4f9b\u7684API\n+----------------+\n        |\n        | \u8c03\u7528AM\u7684API\n        |\n+----------------+    \u62bd\u8c61\u5c42\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u8fd0\u884c\u65f6\u73af\u5883\n|   \u62bd\u8c61\u673a\u5668\u5c42    |    AM = TRM + IOE + CTE + VME + MPE\n+----------------+\n        |\n        | \u63d0\u4f9b\u7269\u7406\u8ba1\u7b97\u8d44\u6e90\n        |\n+----------------+    \n|      ISA       | RISC-V\u3001x86-64\u3001ARM\u3001MIPS...\n+----------------+\n+----------------+    \u7269\u7406\u786c\u4ef6\u8bbe\u5907\n|     \u786c\u4ef6\u5c42       |\n+----------------+\n</code></pre> <p>\u518d\u56de\u5230\u8fd0\u884c\u65f6\u73af\u5883\uff0cAM\u8fdb\u884c\u4e86\u4e00\u5c42\u62bd\u8c61\u4e4b\u540e\uff0c\u5f00\u59cb\u4e3a\u4e0a\u5c42\u4e5f\u5c31\u662f\u8f6f\u4ef6\u7a0b\u5e8f\uff0c\u63d0\u4f9b\u5b83\u4eec\u8fd0\u884c\u80cc\u540e\u7684\u652f\u6301\u3002</p> <p>\u8fd9\u91cc\u518d\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u660e AM \u8fd9\u5c42\u62bd\u8c61\u662f\u600e\u4e48\u63d0\u4f9b\u8fd0\u884c\u65f6\u73af\u5883\u7684\uff0c\u6bd4\u5982\u8bf4 x86-64\u3001ARM\u548c risc-v \u7684\u9000\u51fa\u6307\u4ee4\u7684\u5dee\u5f02\uff08\u88f8\u673a\u4e2d\uff0c\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u62bd\u8c61\uff09\uff1a</p> <ul> <li> <p>x86</p> <p><code>int 0x80</code> / <code>syscall</code></p> </li> <li> <p>ARM</p> <ul> <li>Bare-metal\u9000\u51fa\uff1a\u5728\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u88f8\u673a\uff08bare-metal\uff09\u73af\u5883\u4e2d\uff0c\u9000\u51fa\u7a0b\u5e8f\u53ef\u80fd\u6d89\u53ca\u5230\u76f4\u63a5\u5c06\u63a7\u5236\u6743\u4ea4\u8fd8\u7ed9\u542f\u52a8\u7a0b\u5e8f\u6216\u91cd\u7f6e\u5904\u7406\u5668\u3002</li> </ul> </li> <li> <p>RISC-V</p> <ul> <li><code>ecall</code>\u6216<code>ebreak</code>\u6307\u4ee4\uff1a\u5728\u8c03\u8bd5\u6216\u6d4b\u8bd5\u73af\u5883\u4e2d\uff0c<code>ecall</code>\uff08\u7528\u4e8eRISC-V\u7684\u7cfb\u7edf\u8c03\u7528\uff09\u6216<code>ebreak</code>\uff08\u7528\u4e8e\u89e6\u53d1\u8c03\u8bd5\u5f02\u5e38\uff09\u6307\u4ee4\u53ef\u4ee5\u88ab\u7528\u4e8e\u9000\u51fa\u7a0b\u5e8f\u6216\u89e6\u53d1\u8c03\u8bd5\u5668\u3002</li> </ul> </li> </ul> <p>\u8fd9\u91cc\u53ef\u80fd\u4e3e\u9000\u51fa\u7684\u4f8b\u5b50\u4e0d\u592a\u597d\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5df2\u7ecf\u5c01\u4e86\u4e00\u5c42\uff0cLinux\u4e0b\u7684 ARM\u548cx86 \u90fd\u662f\u63d0\u4f9b\u7cfb\u7edf exit \u9000\u51fa\uff0c\u53ef\u80fd\u4e3e\u88f8\u673a\u7684\u4f8b\u5b50\u66f4\u80fd\u4f53\u4f1a\u5230\u5dee\u5f02\u6027\u3002</p> <p>\u518d\u56de\u60f3\u4e00\u4e0b AM \u505a\u4e86\u4ec0\u4e48\uff0cAM \u529f\u80fd\u4e4b\u4e00\uff0c\u5bf9\u5404\u4e2a\u6307\u4ee4\u96c6\u67b6\u6784\u8fdb\u884c\u4e86\u62bd\u8c61\u3002</p> <p>\u5373\uff0cAM \u7684\u8fd0\u884c\u65f6\u73af\u5883\u53ef\u4ee5\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u66f4\u597d\u5730\u5229\u7528\u5df2\u6709\u7684\u786c\u4ef6\u529f\u80fd\uff0c\u53ef\u4ee5\u505a\u5230\u67b6\u6784\u548cOS\u7684\u89e3\u8026\u3002 </p> <p>\u4e5f\u53ef\u4ee5\u4ece I/O \u7684\u89d2\u5ea6\u7406\u89e3\u770b\u770b\uff1a</p> <ul> <li>x86-64\u67b6\u6784\u4e2d\u7684I/O\u64cd\u4f5c\uff1a<ol> <li>\u7aef\u53e3\u6620\u5c04I/O\uff1a\u5728x86-64\u67b6\u6784\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u7684\u6307\u4ee4\u5982<code>IN</code>\u548c<code>OUT</code>\u6765\u8bbf\u95eeI/O\u7aef\u53e3\u3002\u8fd9\u4e9b\u6307\u4ee4\u4f7f\u7528\u7aef\u53e3\u53f7\u6765\u4e0e\u5916\u56f4\u8bbe\u5907\u8fdb\u884c\u901a\u4fe126\u3002</li> <li>\u5185\u5b58\u6620\u5c04I/O\uff1ax86-64\u67b6\u6784\u652f\u6301\u5c06I/O\u8bbe\u5907\u6620\u5c04\u5230\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u8bfb\u5199\u8fd9\u4e9b\u5185\u5b58\u5730\u5740\u6765\u4e0e\u8bbe\u5907\u901a\u4fe1\u3002\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0cI/O\u64cd\u4f5c\u770b\u8d77\u6765\u50cf\u662f\u5bf9\u666e\u901a\u5185\u5b58\u7684\u8bbf\u95ee27\u3002</li> <li>I/O\u6307\u4ee4\uff1ax86-64\u67b6\u6784\u63d0\u4f9b\u4e86\u4e13\u95e8\u7684I/O\u6307\u4ee4\uff0c\u5982<code>MOV</code>\u6307\u4ee4\u53ef\u4ee5\u7528\u4e8e\u7aef\u53e3\u6620\u5c04I/O\u64cd\u4f5c\uff0c\u800c\u5185\u5b58\u6620\u5c04I/O\u5219\u4f7f\u7528\u666e\u901a\u7684\u5185\u5b58\u8bbf\u95ee\u6307\u4ee426\u3002</li> </ol> </li> <li>ARM\u67b6\u6784\u4e2d\u7684I/O\u64cd\u4f5c\uff1a<ol> <li>\u5b58\u50a8\u5668\u6620\u5c04I/O\uff1aARM\u67b6\u6784\u901a\u5e38\u4f7f\u7528\u5b58\u50a8\u5668\u6620\u5c04I/O\u65b9\u5f0f\uff0c\u5c06I/O\u7aef\u53e3\u5730\u5740\u4f5c\u4e3a\u7279\u6b8a\u7684\u5b58\u50a8\u5668\u5730\u5740\u3002\u4e0ex86-64\u4e0d\u540c\uff0cARM\u67b6\u6784\u4e2d\u7684I/O\u5355\u5143\u901a\u5e38\u88ab\u6807\u8bc6\u4e3a\u975eCacheable\uff08\u975e\u7f13\u5b58\uff09\u548c\u975eBufferable\uff08\u975e\u7f13\u51b2\uff0929\u3002</li> <li>\u534f\u5904\u7406\u5668\u548c\u5916\u8bbe\uff1aARM\u67b6\u6784\u53ef\u80fd\u5305\u542b\u7279\u5b9a\u7684I/O\u534f\u5904\u7406\u5668\u6216\u5916\u8bbe\uff0c\u8fd9\u4e9b\u5728x86-64\u4e2d\u53ef\u80fd\u4e0d\u5b58\u5728\u3002\u8fd9\u4e9b\u534f\u5904\u7406\u5668\u6216\u5916\u8bbe\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u7684\u6307\u4ee4\u96c6\u8fdb\u884c\u8bbf\u95ee\u548c\u63a7\u523629\u3002</li> <li>\u76f4\u63a5\u5b58\u50a8\u5668\u8bbf\u95ee(DMA)\uff1aARM\u67b6\u6784\u652f\u6301DMA\uff0c\u5141\u8bb8\u5728\u4e0d\u9700\u8981CPU\u4ecb\u5165\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u6570\u636e\u5757\u4f20\u8f93\u5230\u5b58\u50a8\u5668\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u5728I/O\u6570\u636e\u6d41\u91cf\u8f83\u5927\u65f6\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u7cfb\u7edf\u6027\u80fd29\u3002</li> </ol> </li> </ul> <p>\u4e0d\u540c\u7684 ISA \u7684 I/O \u64cd\u4f5c --&gt;\u7cfb\u7edf\u8c03\u7528 --&gt; \u4f4e\u7ea7 I/O --&gt; \u6807\u51c6 I/O</p> <p>\uff08\u867d\u7136\u4e0d\u662fAM, \u4f46\u662f\u601d\u60f3\u4e00\u81f4\uff09</p> <p>\u800c\u64cd\u4f5c\u7cfb\u7edf\u6240\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u73af\u5883\u5462\uff0c\u62bd\u8c61\u5c42\u6b21\u66f4\u9ad8\uff0c\u53ef\u4ee5\u770b\u770b\u4e0a\u9762\u7684 I/O \u7684\u7cfb\u7edf\u8c03\u7528\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e00\u5c42\u53ef\u4ee5\u8bf4\u662f\u5bf9 AM \u8fd0\u884c\u65f6\u73af\u5883\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\u3002</p> <p>\u5982\u679c\u4f60\u662f\u73a9\u8fc7\u5d4c\u5165\u5f0f\uff0c\u90a3\u4f60\u4e5f\u80af\u5b9a\u5e38\u5e38\u542c\u8bf4\u8fc7\u88f8\u673a\u548c\u4e0aOS\u8fd9\u4e9b\u6982\u5ff5\u3002</p> <ul> <li>\u88f8\u673a\u662f\u6307\u5728\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u7a0b\u5e8f\u7684\u7cfb\u7edf\u3002\u5728\u88f8\u673a\u7cfb\u7edf\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u76f4\u63a5\u4e0e\u786c\u4ef6\u4ea4\u4e92\uff0c\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u4f5c\u4e3a\u4e2d\u4ecb\u3002</li> <li>\u4e0e\u88f8\u673a\u76f8\u5bf9\uff0c\u201c\u4e0a\u64cd\u4f5c\u7cfb\u7edf\u201d\u662f\u6307\u5728\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e0a\u8fd0\u884c\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u3002\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u670d\u52a1\u548c\u7ba1\u7406\u529f\u80fd\uff0c\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u80fd\u591f\u66f4\u5bb9\u6613\u5730\u5f00\u53d1\u548c\u8fd0\u884c\u3002</li> </ul> <p>\u5728\u6ca1\u6709AM\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u4ece\u88f8\u673a\u5230\u4e0a\u7cfb\u7edf\u8fd9\u4e2a\u8fc7\u7a0b\uff0cOS kernel \u7684HAL\u4e5f\u662f\u76f4\u63a5\u7ba1\u7406\u786c\u4ef6\u8d44\u6e90\uff0c\u4f46\u662f\u5462\uff0c\u8fd9\u91cc\u7684OS\u627f\u62c5\u7684\u4efb\u52a1\u66f4\u52a0\u591a\uff0c\u6bd4\u5982\u7ba1\u7406\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u3001\u5185\u5b58\u7ba1\u7406\u3001\u7cfb\u7edf\u8c03\u7528\u3001\u8bbe\u5907\u9a71\u52a8\u3001\u7528\u6237\u754c\u9762\u3001\u5b89\u5168\u6027\u5904\u7406\u7b49\u3002\u5b83\u4e0a\u9762\u8fd9\u4e9b\u4efb\u52a1\uff0c\u76f8\u5f53\u4e8e\u4e5f\u662f\u5728\u4e3a\u66f4\u52a0\u4e0a\u5c42\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u80cc\u540e\u7684\u652f\u6301\uff08\u4e5f\u5c31\u662f OS \u7684\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e86\uff09\uff0c\u5373OS\u5c4f\u853d\u4e86\u786c\u4ef6\uff0c\u8ba9 User \u53ef\u4ee5\u76f4\u63a5\u8c03\u7528API\u4e86\u3002</p> <p>\u6240\u4ee5\u6211\u53ef\u4ee5\u5927\u6982\u603b\u7ed3\u51fa\u4e00\u4e0b\uff1aAM \u548c OS \u8fd0\u884c\u65f6\u73af\u5883\u5dee\u5f02\u5728\u4e8e\u62bd\u8c61\u5c42\u6b21\u7684\u4e0d\u540c\u548c\u9762\u5411\u5bf9\u8c61\u7684\u4e0d\u540c\u3002AM\u6709\u70b9\u50cf\u5d4c\u5165\u5f0f\u91cc\u5e38\u8bf4\u7684\u88f8\u673a\uff0c\u4f46\u662f AM \u91cd\u70b9\u5728\u4e8e\u62bd\u8c61\u8fd9\u4e00\u6700\u91cd\u8981\u7684\u7279\u6027\uff0c\u76f4\u63a5\u4e0e\u786c\u4ef6\u4ea4\u4e92\u7684\u540c\u65f6\u8fd8\u589e\u5f3a\u4e86\u79fb\u690d\u6027\uff1b\u800cOS\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u867d\u7136\u4e5f\u4f1a\u627f\u62c5\u4e00\u4e9b\u62bd\u8c61\u786c\u4ef6\u7ba1\u7406\u786c\u4ef6\u8d44\u6e90\u7684\u8d23\u4efb\uff0c\u4f46\u662f\u66f4\u4e3b\u8981\u7684\u4efb\u52a1\u662f\u4e3a\u4e0a\u5c42\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9bAPI\u63a5\u53e3\u3002</p> <p>\u8fd9\u91cc\u8fd8\u53ef\u4ee5\u8ffd\u6eaf\u4e00\u4e0b AM \u7684\u5386\u53f2\u516b\u5366\uff0c\u5b9e\u9645\u4e0a\u662f\u5f53\u65f6 jyy \u548c yzh \u8001\u5e08\u96c6\u6210\u5357\u5927\u7684\u5404\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u5b9e\u9a8c\u505a\u51fa\u7684\u4e00\u4e2a\u60f3\u6cd5\uff1a\u81ea\u5df1\u5199\u4e2aCPU\uff08\u7ec4\u6210\u539f\u7406lab\uff09 \uff0c\u4e0a\u9762\u8dd1\u81ea\u5236 OS\uff08OSlab\uff09\uff0c\u4e0a\u9762\u8dd1\u81ea\u5236\u7f16\u8bd1\u5668\u7684\u7a0b\u5e8f\uff08\u7f16\u8bd1\u539f\u7406lab\uff09\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u662f NEMU \u6a21\u62df\u5668\uff0c\u4e0a\u9762\u53c8\u53ef\u4ee5\u8dd1 OS...\uff08\u9012\u5f52\uff09</p> <p>\u4f46\u662f\u56e0\u4e3a\u5404\u4e2a\u5b9e\u9a8c\u4f7f\u7528\u7684\u6307\u4ee4\u96c6\u67b6\u6784\u4e0d\u4e00\u6837\uff08x86\u3001MIPS\uff09\uff0c\u6240\u4ee5\uff0c\u60f3\u51fa\u4e86 AM \u8fd9\u4e00\u62db\u96c6\u6210\uff0c\u6765\u5c4f\u853d\u5404\u4e2a\u6307\u4ee4\u96c6\u67b6\u6784\u7684\u5dee\u5f02\uff0c\u4e4b\u540e\u8fdb\u4e00\u6b65\u6269\u5c55\u3002</p> <p>\u8fd9\u4e5f\u8fdb\u4e00\u6b65\u4f53\u73b0\u4e86\u62bd\u8c61\u8fd9\u4e00\u601d\u60f3\u3002\uff08\u5f00\u73a9\u7b11~\uff09</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u4e5f\u52c9\u5f3a\u56de\u7b54\u4e86\u8fd9\u4e2a\u95ee\u9898\u5427\uff1f\u4f46\u8fd8\u662f\u611f\u89c9\u6709\u4e9b\u4e0d\u592a\u5bf9\u7684\u5730\u65b9\uff0c\u8fd9\u91cc\u518d\u7559\u4e2a\u5751\uff0c\u4ee5\u540e\u53ef\u80fd\u4f1a\u6709\u65b0\u7684\u60f3\u6cd5\u3002</p> <p>Runtime system - Wikipedia</p> <p>new\uff1aABI \u548c\u4e0a\u9762\u7684\u5185\u5bb9\u662f\u5426\u6709\u5173\u7cfb\uff1f</p> </li> </ul> <p></p> <p></p> <p></p> <p>Linux \u52a0\u4e00\u4e2a\u7528AM\u5b9e\u73b0\u7684arch\uff0c\u90a3\u662f\u4e0d\u662f\u8bf4\uff0c\u6211\u6bcf\u4e00\u4e2a\u4eba\u90fd\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684\u67b6\u6784\uff1f\u4e0d\u8fc7\u8fd9\u6837\u610f\u4e49\u4e0d\u5927\u5e94\u8be5\u3002</p> <p>\u597d\u597d\u7406\u89e3\u4e0a\u9762\u7684\u8bdd\uff0c\u7406\u89e3AM\u7684\u771f\u6b63\u542b\u4e49\u3002</p> <p>\u8ba9rtt \u8dd1\u5728am\u4e0a\uff0c\u8fd9\u6837\u65e0\u8bba\u4ec0\u4e48\u67b6\u6784\uff0c\u90fd\u53ef\u4ee5\u4e86\u3002</p> <p>\u8fd8\u6709 nemu \u5e73\u53f0\u8fd9\u4e00\u70b9\uff0c\u5b83\u662f\u4e00\u6b3e\u6a21\u62df\u5668\uff0c\u6a21\u62df\u5404\u79cd\u6307\u4ee4\u96c6\u67b6\u6784\u7684\u884c\u4e3a\uff0c\u6240\u4ee5\u4e5f\u5c31\u76f8\u5f53\u4e8e\u5404\u79cd\u786c\u4ef6\u4e86\uff0c\u7136\u540e\uff0c\u6211\u4eec\u628a am \u8dd1\u5728 nemu\u4e0a\uff0c\u90a3rtt\uff08OS\uff09\u8dd1\u5728am\u4e0a\uff0c\u8fd9\u5c31\u5b8c\u6210\u4e86\u4e00\u9879big\u4efb\u52a1\u4e86\u3002</p> <p>\uff08\u8865\u5145\u6cf0\u6653\u79d1\u6280\u7684\u6a21\u62df\u5668\u548c\u4eff\u771f\u5668\u6587\u7ae0\uff09</p> <p>\u5047\u5982\u8bf4\u8981\u6dfb\u52a0 nemu \u5bf9 Loongarch\u7684\u652f\u6301\uff0c\u90a3\u53ea\u9700\u8981loongarch\u5b9e\u73b0\u6307\u4ee4\u96c6\u76f8\u5173\u884c\u4e3a\uff0c\u7136\u540e\u5728 AM \u4e0a\u5c31\u53ef\u4ee5\u79fb\u690d\u5404\u79cd\u4e1c\u897f\u4e86\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#rtfsc3","title":"RTFSC(3) (\u2b50)","text":"<p>\u6784\u5efa am \u7684\u6846\u67b6</p> <p></p> <p>\u94fe\u63a5\u811a\u672c\u544a\u8bc9\u6211\u4eec\u4ece_start \u5f00\u59cb\uff0c\u7136\u540e\u8df3\u5230 _trm_init()\uff0c\u7136\u540e\u518d\u8c03\u7528main()\uff0cmain\u4e4b\u540e\u8c03halt()</p> <p>\u8fd9\u91cc\u9762\u67e5\u627e\u4e1c\u897f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u953b\u70bc\u4e00\u4e0b\u81ea\u5df1\u7684\u547d\u4ee4\u884c\u5de5\u5177\u7684\u4f7f\u7528\u80fd\u529b\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#am_1","title":"am \u6574\u4f53\u6846\u67b6","text":"<pre><code>abstract-machine\n\u251c\u2500\u2500 am                                  # AM\u76f8\u5173\n\u2502   \u251c\u2500\u2500 include\n\u2502   \u2502   \u251c\u2500\u2500 amdev.h\n\u2502   \u2502   \u251c\u2500\u2500 am.h\n\u2502   \u2502   \u2514\u2500\u2500 arch                        # \u67b6\u6784\u76f8\u5173\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\n\u2502   \u251c\u2500\u2500 Makefile\n\u2502   \u2514\u2500\u2500 src\n\u2502       \u251c\u2500\u2500 mips\n\u2502       \u2502   \u251c\u2500\u2500 mips32.h\n\u2502       \u2502   \u2514\u2500\u2500 nemu                    # mips32-nemu\u76f8\u5173\u7684\u5b9e\u73b0\n\u2502       \u251c\u2500\u2500 native\n\u2502       \u251c\u2500\u2500 platform\n\u2502       \u2502   \u2514\u2500\u2500 nemu                    # \u4ee5NEMU\u4e3a\u5e73\u53f0\u7684AM\u5b9e\u73b0\n\u2502       \u2502       \u251c\u2500\u2500 include\n\u2502       \u2502       \u2502   \u2514\u2500\u2500 nemu.h\n\u2502       \u2502       \u251c\u2500\u2500 ioe                 # IOE\n\u2502       \u2502       \u2502   \u251c\u2500\u2500 audio.c\n\u2502       \u2502       \u2502   \u251c\u2500\u2500 disk.c\n\u2502       \u2502       \u2502   \u251c\u2500\u2500 gpu.c\n\u2502       \u2502       \u2502   \u251c\u2500\u2500 input.c\n\u2502       \u2502       \u2502   \u251c\u2500\u2500 ioe.c\n\u2502       \u2502       \u2502   \u2514\u2500\u2500 timer.c\n\u2502       \u2502       \u251c\u2500\u2500 mpe.c               # MPE, \u5f53\u524d\u4e3a\u7a7a\n\u2502       \u2502       \u2514\u2500\u2500 trm.c               # TRM\n\u2502       \u251c\u2500\u2500 riscv\n\u2502       \u2502   \u251c\u2500\u2500 nemu                    # riscv32(64)\u76f8\u5173\u7684\u5b9e\u73b0\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 cte.c               # CTE\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 start.S             # \u7a0b\u5e8f\u5165\u53e3\n\u2502       \u2502   \u2502   \u251c\u2500\u2500 trap.S\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 vme.c               # VME\n\u2502       \u2502   \u2514\u2500\u2500 riscv.h\n\u2502       \u2514\u2500\u2500 x86\n\u2502           \u251c\u2500\u2500 nemu                    # x86-nemu\u76f8\u5173\u7684\u5b9e\u73b0\n\u2502           \u2514\u2500\u2500 x86.h\n\u251c\u2500\u2500 klib                                # \u5e38\u7528\u51fd\u6570\u5e93\n\u251c\u2500\u2500 Makefile                            # \u516c\u7528\u7684Makefile\u89c4\u5219\n\u2514\u2500\u2500 scripts                             # \u6784\u5efa/\u8fd0\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6/\u955c\u50cf\u7684Makefile\n    \u251c\u2500\u2500 isa\n    \u2502   \u251c\u2500\u2500 mips32.mk\n    \u2502   \u251c\u2500\u2500 riscv32.mk\n    \u2502   \u251c\u2500\u2500 riscv64.mk\n    \u2502   \u2514\u2500\u2500 x86.mk\n    \u251c\u2500\u2500 linker.ld                       # \u94fe\u63a5\u811a\u672c\n    \u251c\u2500\u2500 mips32-nemu.mk\n    \u251c\u2500\u2500 native.mk\n    \u251c\u2500\u2500 platform\n    \u2502   \u2514\u2500\u2500 nemu.mk\n    \u251c\u2500\u2500 riscv32-nemu.mk\n    \u251c\u2500\u2500 riscv64-nemu.mk\n    \u2514\u2500\u2500 x86-nemu.mk\n</code></pre> <ol> <li> <p>am: \u6838\u5fc3\u76ee\u5f55\uff0c\u5305\u542b\u4e0d\u540c\u67b6\u6784\u7684\u62bd\u8c61\u673a\u5668\u5b9e\u73b0\u3002</p> <ul> <li>include: AM\u7684\u5934\u6587\u4ef6\u3002<ul> <li>amdev.h, am.h: AM\u8bbe\u5907\u548cAM\u672c\u8eab\u7684\u58f0\u660e\u6587\u4ef6\u3002</li> <li>arch: \u5b58\u653e\u67b6\u6784\u76f8\u5173\u7684\u5934\u6587\u4ef6\u5b9a\u4e49\u3002</li> </ul> </li> <li>Makefile: \u7528\u4e8e\u6784\u5efaAM\u7684Makefile\u3002</li> <li>src: AM\u7684\u5177\u4f53\u5b9e\u73b0\u4ee3\u7801\u3002<ul> <li>native: \u5bbf\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684AM\u5b9e\u73b0\u3002</li> <li>platform: \u4e0d\u540c\u5e73\u53f0\u7684AM\u5b9e\u73b0\u3002<ul> <li>nemu: \u4ee5NEMU\u6a21\u62df\u5668\u4e3a\u5e73\u53f0\u7684AM\u5b9e\u73b0\u3002<ul> <li>include: NEMU\u5e73\u53f0\u4e13\u7528\u7684\u5934\u6587\u4ef6\uff0c\u5982nemu.h\u3002</li> <li>ioe: \u8f93\u5165/\u8f93\u51fa\u6267\u884c\u73af\u5883\u76f8\u5173\u4ee3\u7801\uff0c\u5982audio.c, disk.c\u7b49\u3002</li> <li>mpe.c: \u591a\u5904\u7406\u5668\u73af\u5883\u7684\u5b9e\u73b0\uff0c\u5f53\u524d\u4e3a\u7a7a\u3002</li> <li>trm.c:  \u56fe\u7075\u673a\uff0c\u6700\u7b80\u5355\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u4ec5\u9700\u5c11\u91cf API \u5373\u53ef\u652f\u6491\u7a0b\u5e8f\u8fd0\u884c\u3002</li> </ul> </li> <li>\u5176\u4ed6\u5e73\u53f0: QEMU\u3001SPIM\u3001\u865a\u62df\u673a\u3001FPGA\u3001\u5d4c\u5165\u5f0f\u7cfb\u7edf...</li> </ul> </li> <li>mips: MIPS\u67b6\u6784\u76f8\u5173\u7684AM\u5b9e\u73b0\u3002<ul> <li>mips32.h: MIPS32\u67b6\u6784\u7684\u5934\u6587\u4ef6\u3002</li> <li>nemu: \u4e0eMIPS32-nemu\u6a21\u62df\u5668\u76f8\u5173\u7684\u5b9e\u73b0\u3002</li> </ul> </li> <li>riscv: RISC-V\u67b6\u6784\u76f8\u5173\u7684AM\u5b9e\u73b0\u3002<ul> <li>nemu: RISCV32(64)-nemu\u6a21\u62df\u5668\u76f8\u5173\u7684\u5b9e\u73b0\u3002<ul> <li>cte.c: \u4e0a\u4e0b\u6587\u5207\u6362\u76f8\u5173\u4ee3\u7801\u3002</li> <li>start.S: \u7a0b\u5e8f\u5165\u53e3\u6587\u4ef6\u3002</li> <li>trap.S: \u9677\u9631\u5904\u7406\u4ee3\u7801\u3002</li> <li>vme.c: \u865a\u62df\u5185\u5b58\u76f8\u5173\u7684\u4ee3\u7801\u3002</li> </ul> </li> <li>riscv.h: RISC-V\u67b6\u6784\u7684\u5934\u6587\u4ef6\u3002</li> </ul> </li> <li>x86: x86\u67b6\u6784\u76f8\u5173\u7684AM\u5b9e\u73b0\u3002<ul> <li>nemu: x86-nemu\u6a21\u62df\u5668\u76f8\u5173\u7684\u5b9e\u73b0\u3002</li> <li>x86.h: x86\u67b6\u6784\u7684\u5934\u6587\u4ef6\u3002</li> </ul> </li> <li>...\u66f4\u591a\u67b6\u6784\uff08loongarch\u3001\u6469\u6258\u7f57\u62c9...\uff09\u7684 AM \u5b9e\u73b0</li> </ul> </li> </ul> </li> <li> <p>klib: \u5b58\u653e\u4e00\u4e9b\u67b6\u6784\u65e0\u5173\u7684\u5e38\u7528\u7684\u5e93\u51fd\u6570, \u65b9\u4fbf\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1</p> </li> <li> <p>Makefile: \u516c\u7528\u7684 Makefile \u89c4\u5219\uff0c\u53ef\u80fd\u5305\u542b\u4e86\u6784\u5efaAM\u65f6\u4f1a\u7528\u5230\u7684\u901a\u7528\u6307\u4ee4\u3002</p> </li> <li> <p>scripts: \u5b58\u653e\u6784\u5efa\u548c\u8fd0\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u955c\u50cf\u7684Makefile\u811a\u672c\u3002</p> <ul> <li> <p>isa: \u5b58\u653e\u4e0d\u540c\u6307\u4ee4\u96c6\u67b6\u6784\uff08ISA\uff09\u7684Makefile\uff0c\u5982mips32.mk, riscv32.mk\u7b49\u3002</p> </li> <li> <p>linker.ld: \u94fe\u63a5\u811a\u672c\uff0c\u7528\u4e8e\u786e\u5b9a\u7a0b\u5e8f\u7684\u5185\u5b58\u5e03\u5c40\u3002</p> </li> <li> <p>mips32-nemu.mk, riscv32-nemu.mk, x86-nemu.mk: \u5206\u522b\u9488\u5bf9MIPS32, RISC-V 32\u4f4d\u548cx86\u67b6\u6784\u7684nemu\u6a21\u62df\u5668\u7684Makefile\u3002</p> <p>\u8fd8\u6709\uff1ariscv32e-npc.mk\u3001spike.mk\u3001x86-qemu.mk\u3001x86_64-qemu.mk</p> </li> <li> <p>platform: \u5e73\u53f0\u76f8\u5173\u7684\u6784\u5efa\u811a\u672c\u3002</p> <ul> <li>nemu.mk: \u9488\u5bf9NEMU\u5e73\u53f0\u7684\u6784\u5efa\u811a\u672c\u3002</li> <li>\u672a\u6765\u66f4\u591a\u5e73\u53f0\u6784\u5efa\u811a\u672c\uff0cqemu.mk\u3001FPGA\u3001npc.mk...</li> </ul> </li> <li> <p>native.mk: \u9488\u5bf9\u539f\u751f\u5e73\u53f0\u7684\u6784\u5efa\u811a\u672c\u3002</p> </li> </ul> </li> </ol> <p>\u6574\u4f53\u4e0a\u770b\uff0cAM \u6846\u67b6\u8bbe\u8ba1\u5f97\u633a\u4f18\u79c0\u3001\u6a21\u5757\u5316\uff0c\u6bcf\u79cd\u67b6\u6784\u548c\u5e73\u53f0\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u3002</p> <p>\u8fd9\u6837\u7684\u8bbe\u8ba1\u8ba9 AM \u53ef\u4ee5\u8f7b\u677e\u5730\u6269\u5c55\u5230\u65b0\u7684\u67b6\u6784\u6216\u5e73\u53f0\u4e0a\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#makefile","title":"\u76f8\u5173 Makefile","text":"<p>\u91cc\u9762\u4e00\u4e9b\u5e38\u89c1\u7684\u51fd\u6570\uff1a</p> <p>appprefix\u3001addsuffix\u3001basename</p> <p>\u5728\u770b\u8fd9\u4e9bMakefile\u7684\u65f6\u5019\u6709\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u4e0d\u540c\u76ee\u5f55\u4e0b\u7684\u8fd9\u4e9bMakefile\u600e\u4e48\u5efa\u7acb\u8d77\u8054\u7cfb\u5462\uff1f</li> <li>\u4e0d\u540c\u76ee\u5f55\u4e0b\u6709\u51e0\u4e2a\u540d\u5b57\u76f8\u540c\u7684mk\uff0c\u600e\u4e48\u533a\u522b\u548c\u8054\u7cfb\u8d77\u6765\uff1f</li> </ul> <p>\u5206\u6790\u4e4b\u524d\u8fd8\u662f\u5148\u7406\u6e05 ISA-\u5e73\u53f0 \u8fd9\u4e00\u4e8c\u5143\u7ec4\uff1a</p> <ul> <li> <p>\u67b6\u6784/ISA\uff1a\u6307\u7684\u662fAM\u6a21\u62df\u7684\u5904\u7406\u5668\u67b6\u6784\uff0c\u5982MIPS32\u3001RISC-V 32\u4f4d\u548c64\u4f4d\u3001x86\u7b49\u3002</p> </li> <li> <p>\u5e73\u53f0\uff1a\u6307\u7684\u662fAM\u5b9e\u73b0\u7684\u8fd0\u884c\u5e73\u53f0\uff0c\u4f8b\u5982 nemu\uff0cnative\uff08\u5bbf\u4e3b\u673a\u3001GNU/Linux\uff09\u3001qemu\u3001FPGA\u3001\u88f8\u673a\u7b49\u5e73\u53f0\u3002</p> </li> </ul> <p>\u5373\u4e0d\u540c\u6307\u4ee4\u96c6\u67b6\u6784\uff08risc-v x86 arm mips...\uff09\u7684 CPU / \u673a\u5668\u8fd0\u884c\u5728\u4e0d\u540c\u7684 OS \u6216\u8005\u88f8\u673a\u4e0a\u3002</p> <p>\u8fd9\u91cc\u4ee5riscv32-nemu\u4e3a\u4f8b\u5b50\u5206\u6790\u3002</p> <ol> <li> <p>\u5217\u51fa\u76f8\u5173\u7684 <code>makefile</code></p> <pre><code>find . -type f -name \"*.mk\" -o -name \"Makefile\" | sort \n./am/Makefile\n./am/src/x86/qemu/boot/Makefile\n./klib/Makefile\n./Makefile\n./scripts/isa/loongarch32r.mk\n./scripts/isa/mips32.mk\n./scripts/isa/riscv.mk\n./scripts/isa/x86_64.mk\n./scripts/isa/x86.mk\n./scripts/loongarch32r-nemu.mk\n./scripts/mips32-nemu.mk\n./scripts/native.mk\n./scripts/platform/nemu.mk\n./scripts/platform/npc.mk\n./scripts/platform/qemu.mk\n./scripts/riscv32e-nemu.mk\n./scripts/riscv32e-npc.mk\n./scripts/riscv32-nemu.mk\n./scripts/riscv64-nemu.mk\n./scripts/spike.mk\n./scripts/x86_64-qemu.mk\n./scripts/x86-nemu.mk\n./scripts/x86-qemu.mk\n</code></pre> <p>\u6311\u51fa\u76f8\u5173\u7684\u3002</p> <pre><code>./Makefile\n./am/Makefile\n./klib/Makefile\n./scripts/isa/riscv.mk\n./scripts/platform/nemu.mk\n./scripts/riscv32-nemu.mk\n</code></pre> <p>\u8fd9\u91cc\u53ef\u4ee5\u731c\u6d4b\u4e00\u4e0b\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u65e2\u7136 AM \u8981\u5c4f\u853d ISA \u548c\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u90a3\u81ea\u52a8\u5316\u6784\u5efa\u5de5\u5177\u9700\u8981\u505a\u54ea\u4e9b\u529f\u592b\u5462\u3002\uff08\u60f3\u5230\u4e86\u4ea4\u53c9\u7f16\u8bd1\u54a7\uff09</p> <p>\u7279\u5b9a ISA \u6839\u636e\u81ea\u8eab\u67b6\u6784\u7684\u7279\u70b9\u548c\u7f16\u8bd1\u5668\u6807\u5fd7\u3001\u4f18\u5316\u9009\u9879\u548c\u6c47\u7f16\u5668\u6307\u4ee4\u7b49\u5185\u5bb9\u9700\u8981\u4e00\u4e2a .mk\uff1b</p> <p>\u7279\u5b9a\u5e73\u53f0\u6709\u5404\u81ea\u7684\u89c4\u5b9a\u7684\u94fe\u63a5\u811a\u672c\uff0c\u5b9a\u4e49\u5404\u81ea\u7684\u5185\u5b58\u5165\u53e3\u548c\u522b\u7684\u94fe\u63a5\u65f6\u914d\u7f6e\u9700\u8981\u4e00\u4e2a .mk\uff1b</p> <p>\u7efc\u5408\u4e24\u8005\u7684 AM \u5b9e\u73b0\uff08\u4e0d\u540c\u7684 trm+ioe+cte+vme\uff09\u4e5f\u9700\u8981\u4e00\u4e2a .mk\uff1b</p> <p>\u518d\u52a0\u4e0a\u672c\u8eab\u6784\u5efa AM \u5c31\u9700\u8981\u4e00\u4e9b .mk\u3002\u8bd5\u8bd5\u770b\u3002</p> </li> <li> <p>\u5404\u5c42\u6784\u5efa</p> <ul> <li> <p>\u9876\u5c42Makefile (<code>./Makefile</code>):</p> <ul> <li>\u8fd9\u4e2aMakefile\u662f\u6784\u5efa\u7cfb\u7edf\u7684\u5165\u53e3\u70b9\u3002</li> <li>\u5b83\u5b9a\u4e49\u4e86\u57fa\u672c\u7684\u8bbe\u7f6e\u548c\u68c0\u67e5\uff0c\u6bd4\u5982\u8bbe\u7f6e\u9ed8\u8ba4\u76ee\u6807\u3001\u68c0\u67e5\u73af\u5883\u53d8\u91cf<code>$AM_HOME</code>\u548c<code>$ARCH</code>\uff0c\u4ee5\u53ca\u63d0\u53d6\u6307\u4ee4\u96c6\u67b6\u6784\uff08<code>ISA</code>\uff09\u548c\u5e73\u53f0\uff08<code>PLATFORM</code>\uff09\u3002</li> <li>\u8bbe\u7f6e\u7f16\u8bd1\u6807\u5fd7\u3001\u7f16\u8bd1\u5668\u3001\u94fe\u63a5\u5668\u548c\u5176\u4ed6\u5de5\u5177\u3002</li> <li>\u5b9a\u4e49\u4e86\u7f16\u8bd1\u89c4\u5219\uff0c\u7528\u4e8e\u4ece\u6e90\u6587\u4ef6\u751f\u6210\u5bf9\u8c61\u6587\u4ef6\uff0c\u4ee5\u53ca\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u6587\u4ef6\u94fe\u63a5\u6210\u6700\u7ec8\u7684\u4e8c\u8fdb\u5236\u6620\u50cf\u3002</li> </ul> </li> <li> <p>\u67b6\u6784\u7279\u5b9a\u7684Makefile (<code>./scripts/isa/riscv.mk</code>):</p> <ul> <li>\u4e3aRISC-V\u67b6\u6784\u63d0\u4f9b\u7279\u5b9a\u7684\u7f16\u8bd1\u6807\u5fd7\u548c\u8bbe\u7f6e\u3002</li> <li>\u5b9a\u4e49\u4e86\u4ea4\u53c9\u7f16\u8bd1\u5668\u524d\u7f00\u3001\u901a\u7528\u7f16\u8bd1\u6807\u5fd7\u3001\u6c47\u7f16\u6807\u5fd7\u548c\u94fe\u63a5\u6807\u5fd7\u3002</li> <li>\u5141\u8bb8\u8986\u76d6\u5728\u9876\u5c42Makefile\u4e2d\u5b9a\u4e49\u7684<code>ARCH_H</code>\u53d8\u91cf\u3002</li> </ul> </li> <li> <p>\u5e73\u53f0\u7279\u5b9a\u7684Makefile (<code>./scripts/platform/nemu.mk</code>):</p> <ul> <li>\u4e3aNEMU\u5e73\u53f0\u63d0\u4f9b\u7279\u5b9a\u7684\u6e90\u6587\u4ef6\u5217\u8868\u548c\u7f16\u8bd1\u6807\u5fd7\u3002</li> <li>\u5305\u62ec\u94fe\u63a5\u5668\u811a\u672c\u7684\u8def\u5f84\u548c\u94fe\u63a5\u6807\u5fd7\uff0c\u4ee5\u53caNEMU\u6a21\u62df\u5668\u7684\u7279\u5b9a\u6807\u5fd7\u3002</li> </ul> </li> <li> <p>\u7279\u5b9a\u67b6\u6784\u548c\u5e73\u53f0\u7ec4\u5408\u7684Makefile (<code>./scripts/riscv32-nemu.mk</code>):</p> <ul> <li>\u5305\u542b\u67b6\u6784\u548c\u5e73\u53f0\u7279\u5b9a\u7684Makefile\u3002</li> <li>\u6dfb\u52a0\u7279\u5b9a\u4e8eRISC-V 32\u4f4d\u67b6\u6784\u7684\u7f16\u8bd1\u6807\u5fd7\uff0c\u5982<code>-march=rv32im_zicsr</code>\u548c<code>-mabi=ilp32</code>\u3002</li> <li>\u6307\u5b9a\u4e86RISC-V\u67b6\u6784\u7684\u6e90\u6587\u4ef6\uff0c\u5305\u62ec\u5165\u53e3\u70b9<code>start.S</code>\uff0c\u4e0a\u4e0b\u6587\u5207\u6362<code>cte.c</code>\uff0c\u9677\u9631\u5904\u7406<code>trap.S</code>\u548c\u865a\u62df\u5185\u5b58\u6269\u5c55<code>vme.c</code>\u3002</li> </ul> </li> </ul> </li> <li> <p>\u603b\u4f53\u6784\u5efa\u8fc7\u7a0b</p> <ol> <li>\u73af\u5883\u8bbe\u7f6e\uff1a\u7528\u6237\u8bbe\u7f6e<code>AM_HOME</code>\u73af\u5883\u53d8\u91cf\u6307\u5411AM\u7684\u6839\u76ee\u5f55\uff0c\u5e76\u8bbe\u7f6e<code>ARCH</code>\u73af\u5883\u53d8\u91cf\u4e3a<code>riscv32-nemu</code>\u3002</li> <li>\u8c03\u7528\u9876\u5c42Makefile\uff1a\u7528\u6237\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c <code>make ARCH=riscv32-nemu</code>\u3002</li> <li>\u5305\u542b\u7279\u5b9aMakefile\uff1a\u9876\u5c42Makefile\u5305\u542b<code>./scripts/riscv32-nemu.mk</code>\uff0c\u5b83\u8fdb\u4e00\u6b65\u5305\u542b<code>./scripts/isa/riscv.mk</code>\u548c<code>./scripts/platform/nemu.mk</code>\u3002</li> <li>\u8bbe\u7f6e\u7f16\u8bd1\u6807\u5fd7\uff1a\u6839\u636e\u5305\u542b\u7684Makefile\uff0c\u8bbe\u7f6e\u7f16\u8bd1\u6807\u5fd7\uff0c\u5982\u4f18\u5316\u7ea7\u522b\u3001\u67b6\u6784\u7279\u5b9a\u7684\u7f16\u8bd1\u6807\u5fd7\u548c\u94fe\u63a5\u6807\u5fd7\u3002</li> <li>\u5b9a\u4e49\u6e90\u6587\u4ef6\u548c\u76ee\u6807\uff1a\u5b9a\u4e49\u6e90\u6587\u4ef6\u5217\u8868\uff08<code>AM_SRCS</code>\uff09\u548c\u6784\u5efa\u76ee\u6807\uff08\u5982<code>IMAGE</code>\u548c<code>ARCHIVE</code>\uff09\u3002</li> <li>\u7f16\u8bd1\u6e90\u6587\u4ef6\uff1a\u7f16\u8bd1\u5668\u6839\u636e\u89c4\u5219\u7f16\u8bd1\u6bcf\u4e2a\u6e90\u6587\u4ef6\uff0c\u751f\u6210\u5bf9\u8c61\u6587\u4ef6\uff08<code>.o</code>\uff09\u3002</li> <li>\u94fe\u63a5\u4e8c\u8fdb\u5236\u6620\u50cf\uff1a\u94fe\u63a5\u5668\u5c06\u6240\u6709\u5bf9\u8c61\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u751f\u6210\u6700\u7ec8\u7684ELF\u4e8c\u8fdb\u5236\u6587\u4ef6\uff08<code>IMAGE.elf</code>\uff09\u3002</li> <li>\u751f\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a\u4f7f\u7528<code>objcopy</code>\u5de5\u5177\u5c06ELF\u6587\u4ef6\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u4ee5\u4fbf\u5728NEMU\u6a21\u62df\u5668\u4e0a\u8fd0\u884c\u3002</li> <li>\u8fd0\u884c\u548c\u8c03\u8bd5\uff1a\u63d0\u4f9b<code>run</code>\u548c<code>gdb</code>\u76ee\u6807\uff0c\u7528\u4e8e\u5728NEMU\u4e0a\u8fd0\u884c\u7a0b\u5e8f\u548c\u8c03\u8bd5\u3002</li> </ol> </li> </ol> <p>\u6240\u4ee5\uff0c\u518d\u56de\u53bb\u770b\u770b\u8fd9\u4e2a\u5fc5\u505a\u9898\uff1a</p> <p>\u901a\u8fc7\u6279\u5904\u7406\u6a21\u5f0f\u8fd0\u884cNEMU</p> <p>\u6211\u4eec\u77e5\u9053, \u5927\u90e8\u5206\u540c\u5b66\u5f88\u53ef\u80fd\u4f1a\u8fd9\u4e48\u60f3: \u53cd\u6b63\u6211\u4e0d\u9605\u8bfbMakefile, \u8001\u5e08\u52a9\u6559\u4e5f\u4e0d\u77e5\u9053, \u603b\u89c9\u5f97\u4e0d\u770b\u4e5f\u65e0\u6240\u8c13.</p> <p>\u6240\u4ee5\u5728\u8fd9\u91cc\u6211\u4eec\u52a0\u4e00\u9053\u5fc5\u505a\u9898: \u6211\u4eec\u4e4b\u524d\u542f\u52a8NEMU\u7684\u65f6\u5019, \u6bcf\u6b21\u90fd\u9700\u8981\u624b\u52a8\u952e\u5165<code>c</code>\u624d\u80fd\u8fd0\u884c\u5ba2\u6237\u7a0b\u5e8f. </p> <p>\u4f46\u5982\u679c\u4e0d\u662f\u4e3a\u4e86\u4f7f\u7528NEMU\u4e2d\u7684sdb, \u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u8282\u7701<code>c</code>\u7684\u952e\u5165. NEMU\u4e2d\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6279\u5904\u7406\u6a21\u5f0f, \u53ef\u4ee5\u5728\u542f\u52a8NEMU\u4e4b\u540e\u76f4\u63a5\u8fd0\u884c\u5ba2\u6237\u7a0b\u5e8f. \u8bf7\u4f60\u9605\u8bfbNEMU\u7684\u4ee3\u7801\u5e76\u5408\u9002\u5730\u4fee\u6539Makefile, \u4f7f\u5f97\u901a\u8fc7AM\u7684Makefile\u53ef\u4ee5\u9ed8\u8ba4\u542f\u52a8\u6279\u5904\u7406\u6a21\u5f0f\u7684NEMU.</p> <p>\u4f60\u73b0\u5728\u4ecd\u7136\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u9053\u5fc5\u505a\u9898, \u4f46\u5f88\u5feb\u4f60\u5c31\u4f1a\u611f\u5230\u4e0d\u90a3\u4e48\u65b9\u4fbf\u4e86.</p> <p>\u65e2\u7136\u662f\u548cNEMU\u76f8\u5173\u7684\uff0c\u770bam\u5c31\u6ca1\u5565\u7528\u4e86\u5427\uff0c\u53ea\u662f\u5728\u7f16\u8bd1\u6784\u5efaNEMU\u7684\u65f6\u5019\uff0c\u9700\u8981\u5728\u5e73\u53f0\u76f8\u5173\u7684.mk\u52a0\u4e00\u4e9b\u7f16\u8bd1flag\u4e86\u5427\uff1a(<code>./scripts/platform/nemu.mk</code>)\u3002</p> <p>\u56de\u53bb\u770b\u770bnemu\u7684\u53c2\u6570\uff0c</p> <pre><code>static int parse_args(int argc, char *argv[]) {\n  const struct option table[] = {\n    {\"batch\"    , no_argument      , NULL, 'b'},\n    {\"log\"      , required_argument, NULL, 'l'},\n    {\"diff\"     , required_argument, NULL, 'd'},\n    {\"port\"     , required_argument, NULL, 'p'},\n    {\"help\"     , no_argument      , NULL, 'h'},\n    {0          , 0                , NULL,  0 },\n  };\n  int o;\n  while ( (o = getopt_long(argc, argv, \"-bhl:d:p:\", table, NULL)) != -1) {\n    switch (o) {\n      case 'b': sdb_set_batch_mode(); break;\n      case 'p': sscanf(optarg, \"%d\", &amp;difftest_port); break;\n      case 'l': log_file = optarg; break;\n      case 'd': diff_so_file = optarg; break;\n      case 1: img_file = optarg; return 0;\n      default:\n        printf(\"Usage: %s [OPTION...] IMAGE [args]\\n\\n\", argv[0]);\n        printf(\"\\t-b,--batch              run with batch mode\\n\");\n        printf(\"\\t-l,--log=FILE           output log to FILE\\n\");\n        printf(\"\\t-d,--diff=REF_SO        run DiffTest with reference REF_SO\\n\");\n        printf(\"\\t-p,--port=PORT          run DiffTest with port PORT\\n\");\n        printf(\"\\n\");\n        exit(0);\n    }\n  }\n  return 0;\n}\n</code></pre> <p>\u8fd8\u771f\u7ed9\u6211\u8f7b\u800c\u6613\u4e3e\u5730\u627e\u5230\u4e86\u3002\u3002</p> <p>\u52a0\u4e2a-b\uff1a   </p> <pre><code> 14 NEMUFLAGS += -l $(shell dirname $(IMAGE).elf)/nemu-log.txt\n 15 NEMUFLAGS += -b\n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#am-kernels","title":"am-kernels","text":"<p>\u4e00\u4e9b\u76f8\u5173\u7684\u6d4b\u8bd5\uff0c\u672a\u6765\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199\u4e00\u4e9b\u5462\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_11","title":"\u5b9e\u73b0\u5e38\u7528\u7684\u5e93\u51fd\u6570","text":"<p>\u5b9e\u73b0\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570</p> <p>\u6839\u636e\u9700\u8981\u5b9e\u73b0<code>abstract-machine/klib/src/string.c</code>\u4e2d\u5217\u51fa\u7684\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570, \u8ba9<code>cpu-tests</code>\u4e2d\u7684\u6d4b\u8bd5\u7528\u4f8b<code>string</code>\u53ef\u4ee5\u6210\u529f\u8fd0\u884c. \u5173\u4e8e\u8fd9\u4e9b\u5e93\u51fd\u6570\u7684\u5177\u4f53\u884c\u4e3a, \u8bf7\u52a1\u5fc5RTFM.</p> <pre><code>int printf(const char *fmt, ...) {\n  panic(\"Not implemented\");\n}\n\nint vsprintf(char *out, const char *fmt, va_list ap) {\n  panic(\"Not implemented\");\n}\n\nint sprintf(char *out, const char *fmt, ...) {\n  panic(\"Not implemented\");\n}\n\nint snprintf(char *out, size_t n, const char *fmt, ...) {\n  panic(\"Not implemented\");\n}\n\nint vsnprintf(char *out, size_t n, const char *fmt, va_list ap) {\n  panic(\"Not implemented\");\n}\n\n//stdio.c\n</code></pre> <pre><code>void *malloc(size_t size) {\n  // On native, malloc() will be called during initializaion of C runtime.\n  // Therefore do not call panic() here, else it will yield a dead recursion:\n  //   panic() -&gt; putchar() -&gt; (glibc) -&gt; malloc() -&gt; panic()\n#if !(defined(__ISA_NATIVE__) &amp;&amp; defined(__NATIVE_USE_KLIB__))\n  panic(\"Not implemented\");\n#endif\n  return NULL;\n}\n//stdlib.c\n</code></pre> <pre><code>size_t strlen(const char *s) {\n  panic(\"Not implemented\");\n}\n\nchar *strcpy(char *dst, const char *src) {\n  panic(\"Not implemented\");\n}\n\nchar *strncpy(char *dst, const char *src, size_t n) {\n  panic(\"Not implemented\");\n}\n\nchar *strcat(char *dst, const char *src) {\n  panic(\"Not implemented\");\n}\n\nint strcmp(const char *s1, const char *s2) {\n  panic(\"Not implemented\");\n}\n\nint strncmp(const char *s1, const char *s2, size_t n) {\n  panic(\"Not implemented\");\n}\n\nvoid *memset(void *s, int c, size_t n) {\n  panic(\"Not implemented\");\n}\n\nvoid *memmove(void *dst, const void *src, size_t n) {\n  panic(\"Not implemented\");\n}\n\nvoid *memcpy(void *out, const void *in, size_t n) {\n  panic(\"Not implemented\");\n}\n\nint memcmp(const void *s1, const void *s2, size_t n) {\n  panic(\"Not implemented\");\n}\n//string.c\n</code></pre> <p><code>cpu_tests/string.c</code></p> <ul> <li> <p>int strcmp(const char s1, const char s2)</p> <p></p> </li> <li> <p>char strcat(char dst, const char *src) </p> <p></p> <p></p> <p>\u6ce8\u610f\u5b57\u7b26\u4e32\u62fc\u63a5\u4e4b\u540e\u5f97\u5230s1+s2\uff0c\u4f46\u662f\u8fd4\u56de\u7684\u662fs1\u7684\u5730\u5740\u3002</p> </li> <li> <p>char strcpy(char dst, const char *src)</p> <p></p> <p>\u6ce8\u610f\u6b63\u786e\u8fd4\u56de dest \u7684\u8d77\u59cb\u5730\u5740\u3002</p> <p>\u6ce8\u610f\u5305\u62ec\u7ec8\u6b62\u7b26\u3002</p> </li> <li> <p>int memcmp(const void s1, const void s2, size_t n)</p> <p></p> </li> <li> <p>void memset(void s, int c, size_t n) </p> <p></p> </li> <li> <p>void memcpy(void out, const void *in, size_t n)</p> <p></p> <p>\u8fd9\u5c31\u662f\u672a\u5b9a\u4e49\u884c\u4e3a\u662f\u5417\uff1f</p> <p>\u672a\u5b9a\u4e49\u884c\u4e3a\u5176\u5b9e\u5c31\u5728\u4f60\u8eab\u8fb9. \u6bd4\u5982\u91ce\u6307\u9488\u7684\u89e3\u5f15\u7528, \u4f1a\u53d1\u751f\u4ec0\u4e48\u5b8c\u5168\u65e0\u6cd5\u9884\u6599. \u8fd8\u6709\u4f60\u7ecf\u5e38\u4f7f\u7528\u7684<code>memcpy()</code>, \u5982\u679c\u6e90\u533a\u95f4\u548c\u76ee\u7684\u533a\u95f4\u6709\u91cd\u53e0\u65f6, \u5b83\u7684\u884c\u4e3a\u4f1a\u600e\u4e48\u6837? \u5982\u679c\u4f60\u4ece\u6765\u6ca1\u6709\u601d\u8003\u8fc7\u8fd9\u4e2a\u95ee\u9898, \u4f60\u5e94\u8be5\u53bb<code>man</code>\u4e00\u4e0b, \u7136\u540e\u601d\u8003\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837. </p> <p>\u8fd8\u6709\u4e00\u79cd\u6709\u4eba\u6b22\u559c\u6709\u4eba\u6101\u7684\u73b0\u8c61\u662f\u57fa\u4e8e\u672a\u5b9a\u4e49\u884c\u4e3a\u7684\u7f16\u8bd1\u4f18\u5316: \u65e2\u7136\u6e90\u4ee3\u7801\u7684\u884c\u4e3a\u662f\u672a\u5b9a\u4e49\u7684, \u7f16\u8bd1\u5668\u57fa\u4e8e\u6b64\u8fdb\u884c\u5404\u79cd\u5947\u8469\u4f18\u5316\u5f53\u7136\u4e5f\u4e0d\u7b97\u8fdd\u53cd\u7ea6\u5b9a. apsys12.pdf (washington.edu) \u8fd9\u7bc7\u6587\u7ae0\u5217\u4e3e\u4e86\u4e00\u4e9b\u8ba9\u4f60\u5927\u5f00\u773c\u754c\u7684\u82b1\u5f0f\u7f16\u8bd1\u4f18\u5316\u4f8b\u5b50, \u770b\u5b8c\u4e4b\u540e\u4f60\u5c31\u4f1a\u5237\u65b0\u5bf9\u7a0b\u5e8f\u884c\u4e3a\u7684\u7406\u89e3\u4e86</p> </li> </ul> <p>\u7ea0\u6b63\u4e00\u4e9b\u4e4b\u524d\u7684\u6982\u5ff5\uff1a</p> <p>\u6211\u5bf9\u6307\u9488\u7684\u7528\u6cd5\u6709\u4e9b\u8ff7\u60d1\uff1a</p> <pre><code>63 void *memset(void *s, int c, size_t n) {\n64     unsigned char *p = (unsigned char *)s;\n65     \n66     for (size_t i = 0; i &lt; n; i++) {\n67         p[i] = (unsigned char)c;\n68     }\n69     return s;\n70 }\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\uff0c\u4e3a\u4ec0\u4e48\u9700\u898164\u884c\u7684\u8d4b\u503c\u5462\uff1f</p> <p>\u65e2\u7136\u8d4b\u503c\u4e86\uff0c\u90a3\u4e0d\u5e94\u8be5\u6307\u5411\u7684\u662f\u540c\u4e00\u7247\u7a7a\u95f4\u5417\uff1f\u8fd8\u662f\u8bf4\u53ea\u662f\u5b58\u7740\u521a\u5f00\u59cb\u7684\u65f6\u5019\u7684\u5730\u5740\uff1f \u8fd9\u4e2a\u6307\u9488\u662f\u6307\u5411\u8fd8\u662f\u5b58\u5730\u5740\uff1f</p> <p>\u8fd9\u79cd\u7406\u89e3\u65b9\u5f0f\u6211\u4e00\u76f4\u5f88\u8ff7\u60d1\uff0c\u611f\u89c9\u4e24\u79cd\u90fd\u53ef\u4ee5\uff0c\u4f46\u662f\u6709\u65f6\u5019\u53c8\u4e0d\u884c\u3002\u53c8\u6bd4\u5982\u8bf4\u4e0b\u9762\u8fd9\u79cd\uff1a</p> <pre><code>char *strcpy(char *dst, const char *src) {\n VALIDATE_PTR(dst);\n VALIDATE_PTR(src);\n char *start = dst;\n while ((*dst++ = *src++) != '\\0');\n return start;\n}\n</code></pre> <p>\u518d\u6bd4\u5982\u8fd9\u79cd\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u662f\u6211\u8bf4\u7684\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5411\u524d\u9762\u51e0\u4e2a\u4e00\u6837\uff0c\u597d\u50cf\u5b58\u5730\u5740\u4e00\u6837\uff0c\u4fdd\u5b58\u5f00\u5934\u7684\u4f4d\u7f6e\uff1f</p> <pre><code>char *strncpy(char *dst, const char *src, size_t n) {\n VALIDATE_PTR(dst);\n VALIDATE_PTR(src);\n size_t i = 0;\n for (i = 0; i &lt; n &amp;&amp; src[i] != '\\0'; i++) {\n     dst[i] = src[i];\n }\n for (; i &lt; n; i++) {\n     dst[i] = '\\0';\n }\n return dst;\n}\n</code></pre> <ul> <li> <p>\u6307\u9488\u548c\u5730\u5740</p> <ul> <li> <p>\u6307\u9488\uff1a\u6307\u9488\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u5b58\u50a8\u4e86\u53e6\u4e00\u4e2a\u53d8\u91cf\u7684\u5185\u5b58\u5730\u5740\u3002\u901a\u8fc7\u6307\u9488\uff0c\u53ef\u4ee5\u95f4\u63a5\u8bbf\u95ee\u548c\u64cd\u4f5c\u5b83\u6240\u6307\u5411\u7684\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u5730\u5740\uff1a\u5730\u5740\u662f\u5185\u5b58\u4e2d\u67d0\u4e2a\u7279\u5b9a\u4f4d\u7f6e\u7684\u6807\u8bc6\u3002\u6bcf\u4e2a\u53d8\u91cf\u5728\u5185\u5b58\u4e2d\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u5730\u5740\u3002</p> </li> </ul> </li> <li> <p>\u6307\u9488\u8d4b\u503c</p> </li> </ul> <p>\u5c06\u4e00\u4e2a\u6307\u9488\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u6307\u9488\u65f6\uff0c\u8fd9\u4e24\u4e2a\u6307\u9488\u4f1a\u6307\u5411\u76f8\u540c\u7684\u5185\u5b58\u5730\u5740\u3002\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u90fd\u6307\u5411\u540c\u4e00\u7247\u7a7a\u95f4\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec\u6765\u8bbf\u95ee\u548c\u4fee\u6539\u76f8\u540c\u7684\u6570\u636e\u3002</p> <p>\u6240\u4ee5\u6211\u4e0a\u9762\u7684\u4e24\u4e2a\u89d2\u5ea6\u662f\u4e0d\u51b2\u7a81\u7684\u3002\u6bd4\u5982\u8bf4\u6700\u521d\u7684\u4f8b\u5b50\u7684 <code>memset</code> \u51fd\u6570\uff1a</p> <pre><code>unsigned char *p = (unsigned char *)s;\n...\nreturn s;\n</code></pre> <p>\u4e24\u4e2a\u6307\u9488\u53d8\u91cf\u786e\u5b9e\u662f\u5b58\u7684\u76f8\u5173\u53d8\u91cf\u7684\u5185\u5b58\u5730\u5740\uff0c\u8fdb\u884c\u4e86\u53d8\u91cf\u8d4b\u503c\u4e4b\u540e\uff0c\u5b83\u4eec\u786e\u5b9e\u662f\u6307\u5411\u7684\u540c\u4e00\u7247\u7a7a\u95f4\u3002\u56e0\u4e3a \u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u8fd9\u4e24\u4e2a\u53d8\u91cf\u5b58\u7684\u4e1c\u897f\u662f\u4e00\u81f4\u7684\uff0c\u6307\u5411\u7684\u5730\u65b9\u4e00\u6837\u3002</p> <p>\u4f46\u662f\u4e4b\u540e\u6211\u4eec\u5bf9\u5176\u4e2d\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u8fdb\u884c\u76f8\u5173\u52a0\u51cf\u64cd\u4f5c\u7684\u4e4b\u540e\uff0c\u4e8c\u8005\u5c31\u4e0d\u662f\u6307\u5411\u540c\u4e00\u5757\u533a\u57df\u4e86\uff08\u4e0a\u9762\u7684p\uff0cp\u4e4b\u540e\u8fdb\u884c\u76f8\u5173\u8d4b\u503c\uff09\uff0c\u800c\u6307\u9488 s \u4f9d\u7136\u5b58\u7740\u4f20\u8fdb\u6765\u7684\u5b57\u7b26\u4e32\u7684\u9996\u5730\u5740\u3002</p> <p>\u6240\u4ee5\u4e24\u79cd\u89d2\u5ea6\u7406\u89e3\u90fd\u662f\u6ca1\u95ee\u9898\u7684\u3002</p> <p>GPT \u4e3e\u7684\u4f8b\u5b50\uff1a</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u4e66\u5e97\uff08\u5185\u5b58\u7a7a\u95f4\uff09\uff0c\u4e66\u5e97\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u5740\uff08\u5185\u5b58\u5730\u5740\uff09\u3002\u4f60\u548c\u5c0f\u660e\u90fd\u6709\u4e00\u672c\u5730\u5740\u7c3f\uff08\u6307\u9488\u53d8\u91cf\uff09\uff0c\u4e0a\u9762\u8bb0\u5f55\u4e86\u4e66\u5e97\u7684\u5730\u5740\u3002</p> <ol> <li>\u521d\u59cb\u72b6\u6001\uff1a\u4f60\u548c\u5c0f\u660e\u7684\u5730\u5740\u7c3f\u90fd\u8bb0\u5f55\u4e86\u4e66\u5e97\u7684\u539f\u59cb\u5730\u5740\u3002\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u5730\u5740\u6307\u5411\u4e86\u4e66\u5e97\u7684\u4e00\u7cfb\u5217\u4e66\u7c4d\uff08\u5b57\u7b26\u4e32\u7684\u5b57\u7b26\u5e8f\u5217\uff09\u3002</li> <li>\u4e66\u5e97\u642c\u8fc1\uff1a\u4e66\u5e97\u51b3\u5b9a\u642c\u8fc1\u5230\u4e00\u4e2a\u65b0\u7684\u5730\u5740\uff0c\u4f46\u8fd9\u4e2a\u642c\u8fc1\u8fc7\u7a0b\u6709\u70b9\u7279\u6b8a\u3002\u5b83\u4e0d\u662f\u5b8c\u5168\u642c\u8d70\uff0c\u800c\u662f\u5728\u539f\u6709\u4e66\u7c4d\u7684\u524d\u9762\u589e\u52a0\u4e86\u4e00\u4e9b\u65b0\u7684\u4e66\u67b6\uff08\u5728\u5b57\u7b26\u4e32\u524d\u9762\u586b\u5145\u4e86\u4e00\u4e9b\u5b57\u7b26\uff09\u3002\u4e66\u5e97\u8fd8\u4fdd\u7559\u4e86\u4e00\u4e2a\u79d8\u5bc6\u901a\u9053\uff08\u539f\u59cb\u6307\u9488 <code>s</code>\uff09\uff0c\u53ef\u4ee5\u76f4\u63a5\u56de\u5230\u4e66\u5e97\u7684\u539f\u59cb\u4f4d\u7f6e\u3002</li> <li>\u5730\u5740\u7c3f\u66f4\u65b0\uff1a\u4f60\u7684\u5730\u5740\u7c3f\u81ea\u52a8\u66f4\u65b0\u4e86\uff0c\u73b0\u5728\u6307\u5411\u4e86\u65b0\u7684\u4e66\u67b6\u4f4d\u7f6e\uff08\u6307\u9488 <code>p</code> \u6307\u5411\u4e86\u65b0\u7684\u5185\u5b58\u5730\u5740\uff0c\u5373\u586b\u5145\u540e\u7684\u5b57\u7b26\u4e32\u8d77\u59cb\u4f4d\u7f6e\uff09\u3002\u4f46\u5c0f\u660e\u7684\u5730\u5740\u7c3f\u6ca1\u6709\u66f4\u65b0\uff0c\u4ecd\u7136\u6307\u5411\u4e66\u5e97\u7684\u539f\u59cb\u4f4d\u7f6e\u3002</li> <li>\u5bfb\u627e\u4e66\u5e97\u7ed3\u5c3e\uff1a\u5373\u4f7f\u4e66\u5e97\u589e\u52a0\u4e86\u65b0\u7684\u4e66\u67b6\uff0c\u5c0f\u660e\u7684\u5730\u5740\u7c3f\u4ecd\u7136\u53ef\u4ee5\u5e2e\u52a9\u4ed6\u627e\u5230\u4e66\u5e97\u7684\u7ed3\u5c3e\u3002\u56e0\u4e3a\u4e66\u5e97\u642c\u8fc1\u65f6\u4fdd\u7559\u4e86\u79d8\u5bc6\u901a\u9053\uff0c\u5c0f\u660e\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u901a\u9053\uff0c\u4ece\u539f\u59cb\u4f4d\u7f6e\u5f00\u59cb\uff0c\u4e00\u76f4\u8d70\u5230\u4e66\u5e97\u7684\u6700\u540e\uff0c\u5373\u4f7f\u4e66\u5e97\u7684\u524d\u9762\u5df2\u7ecf\u589e\u52a0\u4e86\u65b0\u7684\u4e66\u67b6\u3002</li> <li>\u7ed3\u675f\uff1a\u5c0f\u660e\u4f7f\u7528\u4ed6\u7684\u5730\u5740\u7c3f\u627e\u5230\u4e86\u4e66\u5e97\u7684\u7ed3\u5c3e\uff0c\u800c\u4f60\u5219\u901a\u8fc7\u66f4\u65b0\u540e\u7684\u5730\u5740\u7c3f\u627e\u5230\u4e86\u65b0\u7684\u4e66\u67b6\u4f4d\u7f6e\u3002\u5c3d\u7ba1\u4e24\u4e2a\u5730\u5740\u7c3f\u6700\u7ec8\u6307\u5411\u4e86\u4e0d\u540c\u7684\u201c\u4f4d\u7f6e\u201d\uff0c\u4f46\u5b83\u4eec\u90fd\u53ef\u4ee5\u6b63\u786e\u5730\u5b8c\u6210\u4efb\u52a1\u3002</li> </ol> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5173\u4e8e memcmp \u548c strcmp\uff0cstrcpy/strncpy\u548cmemcpy \u4e4b\u7c7b\u7684\u5173\u4e8e\u5b57\u7b26\u4e32\u548c\u5185\u5b58\u76f8\u5173\u7684\u51fd\u6570\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e24\u8005\u90fd\u5e26\u6709cmp\u3001cpy\u7b49\u7684\u529f\u80fd\uff1f</p> <p>\u4ee5 *cpy \u4e3a\u4f8b\uff1a</p> <ul> <li><code>strcpy</code>\uff1a<ul> <li>\u529f\u80fd\uff1a\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u3002</li> <li>\u53c2\u6570\uff1a\u9700\u8981\u4e24\u4e2a <code>char*</code> \u7c7b\u578b\u7684\u5b57\u7b26\u4e32\u5730\u5740\uff0c\u6e90\u5b57\u7b26\u4e32\u548c\u76ee\u6807\u5b57\u7b26\u4e32\u3002</li> <li>\u7279\u70b9\uff1a\u590d\u5236\u64cd\u4f5c\u4f1a\u4e00\u76f4\u8fdb\u884c\u5230\u6e90\u5b57\u7b26\u4e32\u7684\u7ec8\u6b62\u5b57\u7b26 <code>\\0</code>\uff0c\u4e0d\u5b89\u5168\uff0c\u53ef\u80fd\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa\u3002</li> </ul> </li> <li><code>strncpy</code>\uff1a<ul> <li>\u529f\u80fd\uff1a\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u524d <code>n</code> \u4e2a\u5b57\u7b26\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u3002</li> <li>\u53c2\u6570\uff1a\u9700\u8981\u4e09\u4e2a\u53c2\u6570\uff0c\u76ee\u6807\u5b57\u7b26\u4e32\u3001\u6e90\u5b57\u7b26\u4e32\u548c\u8981\u590d\u5236\u7684\u5b57\u7b26\u6570 <code>size_t</code>\u3002</li> <li>\u7279\u70b9\uff1a\u6700\u591a\u590d\u5236 <code>n</code> \u4e2a\u5b57\u7b26\uff0c\u5982\u679c\u6e90\u5b57\u7b26\u4e32\u77ed\u4e8e <code>n</code>\uff0c\u5219\u5269\u4f59\u90e8\u5206\u586b\u5145 <code>\\0</code>\uff1b\u5982\u679c\u6e90\u5b57\u7b26\u4e32\u957f\u4e8e <code>n</code>\uff0c\u5219\u53ea\u590d\u5236\u524d <code>n</code> \u4e2a\u5b57\u7b26\u3002</li> </ul> </li> <li> <p><code>memcpy</code>\uff1a</p> <ul> <li>\u529f\u80fd\uff1a\u5c06\u4e00\u5757\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\u590d\u5236\u5230\u53e6\u4e00\u5757\u5185\u5b58\u4e2d\u3002</li> <li>\u53c2\u6570\uff1a\u9700\u8981\u4e09\u4e2a\u53c2\u6570\uff0c\u76ee\u6807\u5185\u5b58\u5730\u5740\u3001\u6e90\u5185\u5b58\u5730\u5740\u548c\u8981\u590d\u5236\u7684\u5b57\u8282\u6570 <code>size_t</code>\u3002</li> <li>\u7279\u70b9\uff1a\u53ef\u4ee5\u590d\u5236\u4efb\u610f\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e0d\u4ec5\u9650\u4e8e\u5b57\u7b26\u4e32\uff0c\u4e14\u590d\u5236\u65f6\u4e0d\u68c0\u67e5\u7ec8\u6b62\u5b57\u7b26\u3002\u5982\u679c\u5185\u5b58\u533a\u57df\u91cd\u53e0\uff0c\u884c\u4e3a\u672a\u5b9a\u4e49\u3002</li> </ul> </li> <li> <p><code>strcpy</code> \u9047\u5230\u7a7a\u5b57\u7b26\u4e32 '\\0' \u590d\u5236\u64cd\u4f5c\u505c\u6b62\u3002</p> </li> <li><code>strncpy</code> \u590d\u5236\u6307\u5b9a\u6570\u91cf\u7684\u5b57\u7b26\uff0c\u7ed3\u5c3e\u662f\u5426\u542b\u6709 '\\0' \uff0c\u770b\u60c5\u51b5\u3002</li> <li><code>memcpy</code> \u590d\u5236\u6307\u5b9a\u5185\u5b58\u5b57\u8282\uff0c\u4e3b\u8981\u533a\u522b\u662f\u4e0d\u9650\u4e8e\u5b57\u7b26\u4e32\uff0c\u4e14\u6709UB\u3002</li> </ul> <p>cmp\uff1a</p> <p>\u540c\u7406\u4e5f\u662f\uff1a<code>memcmp</code> \u6bd4\u8f83\u6307\u5b9a\u5185\u5b58\u5757\u7684\u4efb\u610f\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e0d\u4ec5\u9650\u4e8e\u5b57\u7b26\u4e32\uff0c\u6bd4\u8f83\u65f6\u4e0d\u5305\u62ec\u7a7a\u5b57\u7b26\u4e32 '\\0'</p> <p><code>strcmp</code> \uff1a\u6bd4\u8f83\u662f\u57fa\u4e8e\u5b57\u7b26\u7684\uff0c\u9047\u5230\u5b57\u7b26\u4e32\u7ec8\u6b62\u7b26 <code>\\0</code> \u505c\u6b62\u6bd4\u8f83\u3002</p> <p>\u6700\u540e\u8fdb\u4e00\u6b65\u4e3e\u4f8b\uff1a</p> <pre><code>if\uff08strcmp\uff08aAbsC ylNumHigh\uff0c bAbsCylNumHigh\uff09 &lt;=0 &amp;&amp; strcmp\uff08aAbsCylN umLow\uff0cbAbsCylNu mLow\uff09&lt;=0 &amp;&amp; strcmp\uff08aSecNum\uff0c .bSecNum\uff09&lt; 0\uff09\n</code></pre> <p>\u6216</p> <pre><code>if\uff08memcmp\uff08aAbsC ylNumHigh\uff0c bAbsCylNumHigh\uff0c 2\uff09&lt;=0 &amp;&amp; memcmp\uff08aAbsCylN umLow\uff0cbAbsCylNu mLow\uff0c2\uff09&lt;=0 &amp;&amp; memcmp\uff08aSecNum\uff0c .bSecNum\uff0c2\uff09&lt;0 \uff09\n</code></pre> <p><code>strcmp</code> \u4e00\u76f4\u6bd4\u8f83\uff0c\u76f4\u5230\u9047\u5230\u7ec8\u6b62\u5b57\u7b26\uff0c</p> <p><code>memcmp</code> \u5c06\u6bd4\u8f83\u7ed9\u5b9a\u5927\u5c0f\u7aef\u5185\u5b58\u5757\uff0c</p> <p>difference between memcmp and strcmp.... - C / C++ (bytes.com)</p> <p>String/Array Comparison (The GNU C Library)</p> </li> </ul> <p><code>hello-str</code> :</p> <ul> <li> <p>int sprintf(char out, const char fmt, ...)</p> <p>\u8fd9\u91cc\u5b9e\u73b0\u51fa\u4e86\u70b9\u5c0f\u95ee\u9898\uff0c\u5fd8\u8bb0\u8003\u8651\u53cd\u8f6c\u5b57\u7b26\u4e32\u7684\u95ee\u9898\u4e86\u3002</p> <pre><code>int itoa(int n, char *out, int base) {\n    if (n &lt; 0) {\n        *out++ = '-';\n         n = -n;\n    }\n    int len = 0;\n    do {\n        int digit = n % base;\n        *out++ = (digit &lt; 10) ? '0' + digit : 'a' + (digit - 10);\n        len++;\n    } while ((n /= base) &gt; 0);\n    *out = '\\0';\n    return len;\n    }\n</code></pre> <p>\u6539\u52a8\u540e\uff1a</p> <pre><code>void reverse(char *start, int len) {\n    if (start &amp;&amp; len &gt; 0) {\n        char *end = start + len - 1;\n        while (start &lt; end) {\n            char temp = *start;\n            *start = *end;\n            *end = temp;\n\n            start++;\n            end--;\n        }\n    }\n}\n\nint itoa(int n, char *out, int base) { \n    assert(out);\n    int len = 0;\n    bool is_neg = false;\n    if (is_neg) {\n        n = -n;\n    }\n    do {\n        int digit = n % base;\n        *out++ = (digit &lt; 10) ? '0' + digit : 'a' + (digit - 10);\n        len++;\n    } while ((n /= base) &gt; 0);\n\n    if (is_neg) {\n        *out = '-';\n        len++;\n    }\n    *out = '\\0';\n    reverse(out - len, len);\n\n    return len;\n}\n</code></pre> </li> <li> <p>\u601d\u8003\u9898</p> <p>stdarg\u662f\u5982\u4f55\u5b9e\u73b0\u7684?</p> <p><code>stdarg.h</code>\u4e2d\u5305\u542b\u4e00\u4e9b\u83b7\u53d6\u51fd\u6570\u8c03\u7528\u53c2\u6570\u7684\u5b8f, \u5b83\u4eec\u53ef\u4ee5\u770b\u505a\u662f\u8c03\u7528\u7ea6\u5b9a\u4e2d\u5173\u4e8e\u53c2\u6570\u4f20\u9012\u65b9\u5f0f\u7684\u62bd\u8c61. \u4e0d\u540cISA\u7684ABI\u89c4\u8303\u4f1a\u5b9a\u4e49\u4e0d\u540c\u7684\u51fd\u6570\u53c2\u6570\u4f20\u9012\u65b9\u5f0f, \u5982\u679c\u8ba9\u4f60\u6765\u5b9e\u73b0\u8fd9\u4e9b\u5b8f, \u4f60\u4f1a\u5982\u4f55\u5b9e\u73b0?</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_12","title":"\u91cd\u65b0\u8ba4\u8bc6\u8ba1\u7b97\u673a: \u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42","text":"<p>\u5b9e\u9645\uff1a</p> TRM \u8ba1\u7b97 \u5185\u5b58\u7533\u8bf7 \u7ed3\u675f\u8fd0\u884c \u6253\u5370\u4fe1\u606f \u8fd0\u884c\u73af\u5883 - malloc()/free() - printf() AM API - heap halt() putch() ISA\u63a5\u53e3 \u6307\u4ee4 \u7269\u7406\u5185\u5b58\u5730\u5740\u7a7a\u95f4 nemu_trap\u6307\u4ee4 I/O\u65b9\u5f0f \u786c\u4ef6\u6a21\u5757 \u5904\u7406\u5668 \u7269\u7406\u5185\u5b58 Monitor \u4e32\u53e3 \u7535\u8def\u5b9e\u73b0 cpu_exec() pmem[] nemu_state serial_io_handler() <p>\u91cd\u8981\u601d\u60f3</p> <p>\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u5b8f\u89c2\u89c6\u89d2: \u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42</p> <p>\u5728\u4e4b\u524d\u7684PA\u4e2d, \u6211\u4eec\u4e00\u76f4\u90fd\u5728\u5f3a\u8c03\"\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a\"\u8fd9\u4e2a\u5fae\u89c2\u89c6\u89d2, \u8ba9\u5927\u5bb6\u7ad9\u5728\u5e95\u5c42\u6765\u7406\u89e3\u8fd9\u4e2a\u72b6\u6001\u673a\u662f\u5982\u4f55\u5de5\u4f5c\u7684. \u73b0\u5728\u6211\u4eec\u7ec8\u4e8e\u6709\u673a\u4f1a\u5411\u9ad8\u5c42\u8fdc\u773a, \u6765\u7406\u89e3\u8ba1\u7b97\u673a\u662f\u5982\u4f55\u628a\u5e95\u5c42\u7684\u529f\u80fd\u7ecf\u8fc7\u5c42\u5c42\u62bd\u8c61, \u6700\u7ec8\u652f\u6491\u7a0b\u5e8f\u7684\u8fd0\u884c.</p> <p>\u6bcf\u4e00\u5c42\u62bd\u8c61\u90fd\u6709\u5b83\u5b58\u5728\u7684\u7406\u7531:</p> <ul> <li>\u6982\u5ff5\u76f8\u540c\u7684\u4e00\u4e2a\u786c\u4ef6\u6a21\u5757\u6709\u7740\u4e0d\u540c\u7684\u5b9e\u73b0\u65b9\u5f0f, \u6bd4\u5982\u5904\u7406\u5668\u65e2\u53ef\u4ee5\u901a\u8fc7NEMU\u4e2d\u7b80\u5355\u7684\u89e3\u91ca\u65b9\u5f0f\u6765\u5b9e\u73b0, \u4e5f\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3cQEMU\u4e2d\u9ad8\u6027\u80fd\u7684\u4e8c\u8fdb\u5236\u7ffb\u8bd1\u65b9\u5f0f\u6765\u5b9e\u73b0, \u751a\u81f3\u53ef\u4ee5\u901a\u8fc7verilog\u7b49\u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00\u6765\u5b9e\u73b0\u4e00\u4e2a\u771f\u5b9e\u7684\u5904\u7406\u5668.</li> <li>ISA\u662f\u786c\u4ef6\u5411\u8f6f\u4ef6\u63d0\u4f9b\u7684\u53ef\u4ee5\u64cd\u4f5c\u786c\u4ef6\u7684\u63a5\u53e3</li> <li>AM\u7684API\u5bf9\u4e0d\u540cISA(\u5982x86/mips32/riscv32)\u7684\u63a5\u53e3\u8fdb\u884c\u4e86\u62bd\u8c61, \u4e3a\u4e0a\u5c42\u7684\u7a0b\u5e8f\u5c4f\u853dISA\u76f8\u5173\u7684\u7ec6\u8282</li> <li>\u8fd0\u884c\u65f6\u73af\u5883\u53ef\u4ee5\u901a\u8fc7\u5bf9AM\u7684API\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5, \u5411\u7a0b\u5e8f\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u529f\u80fd</li> </ul> <p>\u8fd9\u4e9b\u62bd\u8c61\u90fd\u662f\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u5728\u5404\u79cd\u5404\u6837\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7f16\u5199\u8fd0\u884c\u4e94\u82b1\u516b\u95e8\u7684\u7a0b\u5e8f, \u4f60\u5c06\u8981\u5728PA3\u4e2d\u8fd0\u884c\u7684\u4ed9\u5251\u5947\u4fa0\u4f20, \u4e5f\u90fd\u662f\u901a\u8fc7\u5c42\u5c42\u62bd\u8c61\u5206\u89e3\u6210\u6700\u57fa\u672c\u7684\u786c\u4ef6\u64cd\u4f5c, \u6700\u540e\u4ee5\u72b6\u6001\u673a\u7684\u65b9\u5f0f\u6765\u8fd0\u884c.</p> <p>\u4efb\u52a1\u5b8f\u89c2\uff1a</p> <p>PA\u7a76\u7adf\u5728\u505a\u4ec0\u4e48?</p> <p>\u5230\u6b64\u4e3a\u6b62, \u6211\u4eec\u5df2\u7ecf\u5c06PA\u4e2d\u6700\u91cd\u8981\u7684\u4e24\u4e2a\u5173\u4e8e\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u89c6\u89d2\u4ecb\u7ecd\u5b8c\u4e86:</p> <ul> <li>\u5fae\u89c2\u89c6\u89d2: \u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a</li> <li>\u5b8f\u89c2\u89c6\u89d2: \u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42</li> </ul> <p>PA\u5269\u4e0b\u7684\u5185\u5bb9\u5c31\u662f\u501f\u9274AM\u7684\u542f\u53d1, \u6309\u7167\u8ba1\u7b97\u673a\u53d1\u5c55\u53f2\u7684\u987a\u5e8f\u7ed9\u8ba1\u7b97\u673a\u786c\u4ef6\u6dfb\u52a0\u5404\u79cd\u65b0\u7279\u6027, \u5e76\u5f3a\u5316\u8fd0\u884c\u65f6\u73af\u5883\u7684\u529f\u80fd, \u6700\u540e\u8fd0\u884c\u5404\u79cd\u66f4\u590d\u6742\u7684\u7a0b\u5e8f. PA\u4f1a\u628a\u6dfb\u52a0\u65b0\u7279\u6027\u7684\u8fc7\u7a0b\u4f5c\u4e3a\u6848\u4f8b, \u8ba9\u5927\u5bb6\u4e0d\u65ad\u5730\u4ece\u8fd9\u4e24\u4e2a\u89c6\u89d2\u6765\u7406\u89e3\"\u7a0b\u5e8f\u5982\u4f55\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\". \u5177\u4f53\u5730, \u5728PA2\u7684\u6700\u540e, \u6211\u4eec\u4f1a\u6dfb\u52a0IOE\u6765\u5b9e\u73b0\u4e00\u4e2a\u51af\u8bfa\u4f9d\u66fc\u8ba1\u7b97\u673a\u7cfb\u7edf; \u5728PA3\u4e2d, \u6211\u4eec\u4f1a\u6dfb\u52a0CTE, \u6765\u652f\u6301\u6279\u5904\u7406\u7cfb\u7edf\u7684\u8fd0\u884c; \u5728\u6700\u540e\u7684PA4\u4e2d, \u6211\u4eec\u4f1a\u6dfb\u52a0VME, \u6765\u8fd0\u884c\u4e00\u4e2a\u7b80\u5355\u53c8\u9177\u70ab\u7684\u5206\u65f6\u591a\u4efb\u52a1\u7cfb\u7edf.</p> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u7ed9\u51faPA\u7684\u4e00\u4e2a\u5168\u5c40\u6982\u5ff5\u56fe(\u56fe\u4e2d\u7684\"\u8fd0\u884c\u65f6\u73af\u5883\"\u5305\u542b\u4e86AM, klib, \u751a\u81f3\u662fOS\u548clibc), \u8fd9\u4e2a\u56fe\u7684\u4e09\u7ef4\u5750\u6807\u8f74\u603b\u7ed3\u4e86PA\u4e2d3\u4e2a\u6700\u91cd\u8981\u7684\u7ed3\u8bba, \u4e5f\u5411\u5927\u5bb6\u5c55\u793a\u4e86PA\u6784\u5efa\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5168\u8fc7\u7a0b. \u5927\u5bb6\u5728\u505a\u5b9e\u9a8c\u7684\u65f6\u5019\u4e5f\u53ef\u4ee5\u591a\u591a\u601d\u8003: \u6211\u73b0\u5728\u5199\u7684\u4ee3\u7801\u7a76\u7adf\u4f4d\u4e8e\u54ea\u4e00\u4e2a\u62bd\u8c61\u5c42? \u4ee3\u7801\u7684\u5177\u4f53\u884c\u4e3a\u7a76\u7adf\u662f\u4ec0\u4e48?</p> <p></p>"},{"location":"ysyx/pa/pa2/pa2.html#2","title":"\u57fa\u7840\u8bbe\u65bd(2)","text":""},{"location":"ysyx/pa/pa2/pa2.html#bug-","title":"bug\u8bca\u65ad\u7684\u5229\u5668 - \u8e2a\u8ff9","text":""},{"location":"ysyx/pa/pa2/pa2.html#itrace-mtrace","title":"itrace \u548c mtrace","text":"<ul> <li> <p>\u5b9e\u73b0 iringbuf \u65f6\u5173\u4e8e sprintf \u51fd\u6570\u7528\u5230\u4e0d\u719f\u7ec3\u3002</p> <p></p> </li> <li> <p>itrace\uff08\u4f7f\u7528 <code>disassemble</code> \u51fd\u6570\u7684\u4e00\u4e9b\u95ee\u9898\uff09\uff1a\u8f93\u51fa\u53cd\u6c47\u7f16\u76f8\u5173\u5185\u5bb9\uff0c\u5728 buf \u540e\u8ffd\u52a0\u53cd\u6c47\u7f16\u6307\u4ee4\u3002</p> <p><code>disassemble</code> \u51fd\u6570\u662f\u76f4\u63a5\u5c06 \u5185\u5bb9\u590d\u5236\u5230\u4f60\u4f20\u8fdb\u6765\u7684str\u7684\uff0c\u6240\u4ee5\uff0c\u5e94\u8be5\u7528\u6307\u9488\u7ee7\u7eed\u8ffd\u52a0\u5185\u5bb9\u3002</p> </li> <li> <p>\u6dfb\u52a0kconfig\u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u9ed8\u8ba4\u6dfb\u52a0prefix: CONFIG_</p> </li> <li> <p>\u719f\u6089\u51e0\u4e2a\u683c\u5f0f</p> <pre><code>// ----------- mtrace -----------\n void display_pread(paddr_t addr, int len) {\n     // load\n     printf(\"pread addr: \" FMT_PADDR \" len = %d\\n\", addr, len);\n }\n\n void display_pwrite(paddr_t addr, int len, word_t data) {\n     // store\n     printf(\"pwrite addr: \" FMT_PADDR \" len = %d, data = \" FMT_WORD \"\\n\", addr, len, data);           \n }\n\n\n// common.h\n#if CONFIG_MBASE + CONFIG_MSIZE &gt; 0x100000000ul\n#define PMEM64 1\n#endif\n\ntypedef MUXDEF(CONFIG_ISA64, uint64_t, uint32_t) word_t;\ntypedef MUXDEF(CONFIG_ISA64, int64_t, int32_t)  sword_t;\n#define FMT_WORD MUXDEF(CONFIG_ISA64, \"0x%016\" PRIx64, \"0x%08\" PRIx32)\n\ntypedef word_t vaddr_t;\ntypedef MUXDEF(PMEM64, uint64_t, uint32_t) paddr_t;\n#define FMT_PADDR MUXDEF(PMEM64, \"0x%016\" PRIx64, \"0x%08\" PRIx32)\ntypedef uint16_t ioaddr_t;\n\n#include &lt;debug.h&gt;\n\n#endif                    \n</code></pre> </li> <li> <p>\u6dfb\u52a0mtrace\u7684\u5dee\u8ddd\uff1a</p> <pre><code>[src/cpu/cpu-exec.c:125 cpu_exec] nemu: HIT GOOD TRAP at pc = 0x8000012c\n[src/cpu/cpu-exec.c:92 statistic] host time spent = 84,984 us\n[src/cpu/cpu-exec.c:93 statistic] total guest instructions = 13,277\n[src/cpu/cpu-exec.c:94 statistic] simulation frequency = 156,229 inst/s\n\u6ca1\u52a0\n\n[src/cpu/cpu-exec.c:125 cpu_exec] nemu: HIT GOOD TRAP at pc = 0x8000012c\n[src/cpu/cpu-exec.c:92 statistic] host time spent = 402,670 us\n[src/cpu/cpu-exec.c:93 statistic] total guest instructions = 13,277\n[src/cpu/cpu-exec.c:94 statistic] simulation frequency = 32,972 inst/s\n\u52a0\u4e86\n</code></pre> </li> <li> <p>\u9047\u5230\u95ee\u9898\uff0c\u5f00\u4e86 sanitizer \u53bb\u6d4b\u8bd5\u4e4b\u524d\u7684 cpu-test\u53cd\u800c\u4e0d\u8fc7\u4e86\u3002</p> <p>\u6709\u4e9b\u4ee3\u7801\u6709\u65f6\u80fd\u8fc7\uff0c\u6709\u65f6\u4e0d\u80fd\u8fc7\u3002</p> <p>\u54ea\u91cc\u5199\u7684\u6709\u95ee\u9898\u54a7</p> <p>\u4f7f\u7528gdb\u548c sanitizer \u663e\u793a\u66f4\u591a\u4fe1\u606f\uff0c\u4f46\u662f\u8fd9\u4e2a\u6784\u5efa\u7cfb\u7edf\u6709\u70b9\u4e0d\u65b9\u4fbf\uff1f</p> <p>\u600e\u4e48\u611f\u89c9\u662f\u4e2a\u5927\u5751\uff0c\u7559\u7740</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#elf","title":"ELF \u7b26\u53f7\u8868\u76f8\u5173\u77e5\u8bc6","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6211\u4eec\u5728<code>am-kernels/tests/cpu-tests/tests/add.c</code>\u4e2d\u5b9a\u4e49\u4e86\u5b8f<code>NR_DATA</code>, \u540c\u65f6\u4e5f\u5728<code>add()</code>\u51fd\u6570\u4e2d\u5b9a\u4e49\u4e86\u5c40\u90e8\u53d8\u91cf<code>c</code>\u548c\u5f62\u53c2<code>a</code>, <code>b</code>, \u4f46\u4f60\u4f1a\u53d1\u73b0\u5728\u7b26\u53f7\u8868\u4e2d\u627e\u4e0d\u5230\u548c\u5b83\u4eec\u5bf9\u5e94\u7684\u8868\u9879, \u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837? \u601d\u8003\u4e00\u4e0b, \u4ec0\u4e48\u624d\u7b97\u662f\u4e00\u4e2a\u7b26\u53f7(symbol)?</p> <p>GPT:</p> <p>\u7b26\u53f7\uff08Symbol\uff09\u5728\u7f16\u7a0b\u548c\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\u901a\u5e38\u6307\u7684\u662f\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u7684\u6807\u8bc6\u7b26\uff0c\u6bd4\u5982\u53d8\u91cf\u540d\u3001\u5e38\u91cf\u540d\u3001\u5b8f\u5b9a\u4e49\u3001\u51fd\u6570\u540d\u7b49\u3002\u8fd9\u4e9b\u6807\u8bc6\u7b26\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u88ab\u7528\u6765\u8bc6\u522b\u548c\u8bbf\u95ee\u7a0b\u5e8f\u4e2d\u7684\u4e0d\u540c\u5143\u7d20\u3002\u7b26\u53f7\u8868\uff08Symbol Table\uff09\u662f\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u5b58\u50a8\u8fd9\u4e9b\u7b26\u53f7\u53ca\u5176\u76f8\u5173\u4fe1\u606f\uff0c\u6bd4\u5982\u6570\u636e\u7c7b\u578b\u3001\u4f5c\u7528\u57df\u3001\u5185\u5b58\u5730\u5740\u7b49\u3002</p> <p>\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f1a\u521b\u5efa\u7b26\u53f7\u8868\u4ee5\u5e2e\u52a9\u7ba1\u7406\u548c\u8bbf\u95ee\u7a0b\u5e8f\u4e2d\u7684\u7b26\u53f7\u3002\u4f46\u662f\uff0c\u5e76\u975e\u6240\u6709\u7684\u6807\u8bc6\u7b26\u90fd\u4f1a\u88ab\u5305\u542b\u5728\u7b26\u53f7\u8868\u4e2d\u3002\u6839\u636e[<sup>8</sup>]\u548c[<sup>9</sup>]\u7684\u89e3\u91ca\uff0c\u7b26\u53f7\u8868\u901a\u5e38\u5305\u542b\u4ee5\u4e0b\u7c7b\u578b\u7684\u7b26\u53f7\uff1a</p> <ol> <li> <p>\u5168\u5c40\u7b26\u53f7\uff08Global Symbols\uff09\uff1a\u5728\u6a21\u5757\u5185\u90e8\u5b9a\u4e49\u4e14\u80fd\u88ab\u5176\u4ed6\u6a21\u5757\u5f15\u7528\u7684\u7b26\u53f7\u3002\u8fd9\u5305\u62ec\u975e\u9759\u6001\u7684C\u51fd\u6570\u548c\u5168\u5c40\u53d8\u91cf\u3002</p> </li> <li> <p>\u5916\u90e8\u7b26\u53f7\uff08External Symbols\uff09\uff1a\u7531\u5176\u4ed6\u6a21\u5757\u5b9a\u4e49\u5e76\u88ab\u5f53\u524d\u6a21\u5757\u5f15\u7528\u7684\u5168\u5c40\u7b26\u53f7\u3002</p> </li> <li> <p>\u5c40\u90e8\u7b26\u53f7\uff08Local Symbols\uff09\uff1a\u4ec5\u7531\u5f53\u524d\u6a21\u5757\u5b9a\u4e49\u548c\u5f15\u7528\u7684\u672c\u5730\u7b26\u53f7\u3002\u8fd9\u901a\u5e38\u5305\u62ec\u5728\u6a21\u5757\u5185\u90e8\u5b9a\u4e49\u7684\u9759\u6001\u51fd\u6570\u548c\u5168\u5c40\u53d8\u91cf\u3002</p> </li> </ol> <p>\u56de\u5230\u9898\u76ee\uff0c\u5173\u4e8e\u662f\u5426\u7ba1\u7406\u7b26\u53f7\u7684\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li>\u5b8f\u5b9a\u4e49\uff08Macro Definitions\uff09\uff1a\u5b8f\u901a\u5e38\u5728\u9884\u5904\u7406\u9636\u6bb5\u5c55\u5f00\uff0c\u5b83\u4eec\u4e0d\u662f\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u5b9e\u4f53\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5728\u7b26\u53f7\u8868\u4e2d\u62e5\u6709\u6761\u76ee\u3002\u5b8f<code>NR_DATA</code>\u5728\u7f16\u8bd1\u65f6\u4f1a\u88ab\u66ff\u6362\u4e3a\u76f8\u5e94\u7684\u503c\uff0c\u6240\u4ee5\u5b83\u4e0d\u4f1a\u51fa\u73b0\u5728\u6700\u7ec8\u7684\u7b26\u53f7\u8868\u4e2d\u3002</li> <li>\u5c40\u90e8\u53d8\u91cf\uff08Local Variables\uff09\uff1a\u5c40\u90e8\u53d8\u91cf\u662f\u5728\u6808\u4e0a\u5206\u914d\u7684\uff0c\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u4ec5\u9650\u4e8e\u51fd\u6570\u8c03\u7528\u671f\u95f4\u3002\u63a5\u5668\u4e0d\u5173\u5fc3\u90a3\u4e9b\u5206\u914d\u5728\u6808\u4e2d\u7684\u4e34\u65f6\u6027\u5c40\u90e8\u53d8\u91cf\uff0c\u56e0\u6b64\u5b83\u4eec\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u5728\u7b26\u53f7\u8868\u4e2d\u3002</li> <li>\u5f62\u53c2\uff08Parameters\uff09\uff1a\u51fd\u6570\u7684\u5f62\u53c2\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u4e5f\u88ab\u89c6\u4e3a\u5c40\u90e8\u53d8\u91cf\uff0c\u5b83\u4eec\u7684\u5b58\u50a8\u4f4d\u7f6e\u548c\u751f\u547d\u5468\u671f\u4e0e\u5c40\u90e8\u53d8\u91cf\u76f8\u540c\uff0c\u56e0\u6b64\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5f62\u53c2\u540c\u6837\u4e0d\u4f1a\u51fa\u73b0\u5728\u7b26\u53f7\u8868\u4e2d\u3002</li> </ul> <p>\u53c2\u8003 CSAPP \u7b2c\u4e03\u7ae0\u3002</p> <p>\u7b26\u53f7\u8868\u4e2d\u7684\u6761\u76ee\u4e3b\u8981\u7528\u4e8e\u90a3\u4e9b\u5728\u7a0b\u5e8f\u7684\u591a\u4e2a\u90e8\u5206\u9700\u8981\u5f15\u7528\u7684\u5b9e\u4f53\uff0c\u6bd4\u5982\u5168\u5c40\u53d8\u91cf\u548c\u51fd\u6570\uff0c\u5b83\u4eec\u9700\u8981\u5728\u7a0b\u5e8f\u7684\u4e0d\u540c\u90e8\u5206\u88ab\u8bc6\u522b\u548c\u8bbf\u95ee\u3002\u7b26\u53f7\u8868\u662f\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u7528\u6765\u89e3\u6790\u6807\u8bc6\u7b26\u548c\u786e\u5b9a\u5b83\u4eec\u5730\u5740\u7684\u91cd\u8981\u5de5\u5177\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf<code>int globalVar;</code>\u548c\u4e00\u4e2a\u51fd\u6570<code>int add(int a, int b) { ... }</code>\uff0c\u8fd9\u4e24\u4e2a\u90fd\u53ef\u80fd\u4f1a\u5728\u7b26\u53f7\u8868\u4e2d\u62e5\u6709\u6761\u76ee\u3002\u5168\u5c40\u53d8\u91cf<code>globalVar</code>\u53ef\u4ee5\u5728\u7a0b\u5e8f\u7684\u591a\u4e2a\u5730\u65b9\u88ab\u8bbf\u95ee\uff0c\u800c\u51fd\u6570<code>add</code>\u53ef\u4ee5\u88ab\u7a0b\u5e8f\u7684\u5176\u4ed6\u90e8\u5206\u8c03\u7528\u3002\u8fd9\u4e9b\u7b26\u53f7\u7684\u6761\u76ee\u5c06\u5305\u542b\u5b83\u4eec\u7684\u7c7b\u578b\u3001\u4f5c\u7528\u57df\u548c\u5185\u5b58\u5730\u5740\u7b49\u4fe1\u606f\u3002</p> </li> </ul> <pre><code>   String and symbol tables\n       String table sections hold null-terminated character sequences, commonly called  strings.   The\n       object  file uses these strings to represent symbol and section names.  One references a string\n       as an index into the string table section.  The first byte, which is index zero, is defined  to\n       hold a null byte ('\\0').  Similarly, a string table's last byte is defined to hold a null byte,\n       ensuring null termination for all strings.\n\n       An object file's symbol table holds information needed to locate and relocate a program's  sym\u2010\n       bolic definitions and references.  A symbol table index is a subscript into this array.\n\n           typedef struct {\n               uint32_t      st_name;\n               Elf32_Addr    st_value;\n               uint32_t      st_size;\n               unsigned char st_info;\n               unsigned char st_other;\n               uint16_t      st_shndx;\n           } Elf32_Sym;\n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#ftrace","title":"ftrace (\u2b50)","text":"<p>\u8981\u5b9e\u73b0ftrace, \u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u51fd\u6570\u8c03\u7528\u548c\u8fd4\u56de\u76f8\u5173\u7684\u6307\u4ee4\u5c31\u53ef\u4ee5\u4e86</p> <p>RISC-V\u67b6\u6784\u4e2d\uff0c\u51fd\u6570\u8c03\u7528\u548c\u8fd4\u56de\u76f8\u5173\u7684\u6307\u4ee4\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ol> <li>JAL (Jump and Link)\uff1a\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u3002\u8fd9\u6761\u6307\u4ee4\u7528\u4e8e\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u3002\u5b83\u4f1a\u5c06\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\uff08\u901a\u5e38\u7528\u4e8e\u4fdd\u5b58\u8fd4\u56de\u5730\u5740\uff09\uff0c\u7136\u540e\u5c06\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08PC\uff09\u8df3\u8f6c\u5230\u6307\u5b9a\u7684\u5730\u5740\u3002\u683c\u5f0f\u4e3a <code>JAL rd, address</code>\uff0c\u5176\u4e2d<code>rd</code>\u662f\u76ee\u6807\u5bc4\u5b58\u5668\uff0c<code>address</code>\u662f\u8981\u8df3\u8f6c\u7684\u76ee\u6807\u5730\u5740\u3002\u5728\u51fd\u6570\u8c03\u7528\u4e2d\uff0c\u901a\u5e38\u5c06\u8fd4\u56de\u5730\u5740\u4fdd\u5b58\u5728\u5bc4\u5b58\u5668<code>ra</code>\uff08return address\uff09\u4e2d\u3002</li> <li>JALR (Jump and Link Register)\uff1a\u57fa\u4e8e\u5bc4\u5b58\u5668\u7684\u65e0\u6761\u4ef6\u8df3\u8f6c\u6307\u4ee4\u3002\u8fd9\u6761\u6307\u4ee4\u5141\u8bb8\u4f60\u57fa\u4e8e\u4e00\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u8fdb\u884c\u8df3\u8f6c\uff0c\u5e76\u5c06\u8fd4\u56de\u5730\u5740\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\u3002\u683c\u5f0f\u4e3a <code>JALR rd, rs1, offset</code>\uff0c\u5176\u4e2d<code>rd</code>\u662f\u76ee\u6807\u5bc4\u5b58\u5668\uff0c<code>rs1</code>\u662f\u57fa\u51c6\u5bc4\u5b58\u5668\uff0c<code>offset</code>\u662f\u504f\u79fb\u91cf\u3002\u8fd9\u6761\u6307\u4ee4\u5e38\u7528\u4e8e\u901a\u8fc7\u51fd\u6570\u6307\u9488\u8fdb\u884c\u8c03\u7528[<sup>12</sup>][<sup>14</sup>]\u3002</li> <li>RET (Return)\uff1a\u8fd4\u56de\u6307\u4ee4\u3002\u5728RISC-V\u4e2d\uff0c<code>RET</code>\u6307\u4ee4\u662f<code>JALR</code>\u6307\u4ee4\u7684\u4e00\u4e2a\u7279\u4f8b\uff0c\u7528\u4e8e\u4ece\u5b50\u7a0b\u5e8f\u8fd4\u56de\u3002\u5b83\u5c06<code>ra</code>\u5bc4\u5b58\u5668\u7684\u503c\u4f5c\u4e3a\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u503c\uff0c\u4ece\u800c\u8fd4\u56de\u5230\u8c03\u7528\u51fd\u6570\u7684\u4f4d\u7f6e\u7ee7\u7eed\u6267\u884c\u3002\u683c\u5f0f\u4e3a <code>RET</code> \u6216 <code>JALR x0, ra, 0</code>\uff0c\u5176\u4e2d<code>x0</code>\u662f\u59cb\u7ec8\u4e3a0\u7684\u5bc4\u5b58\u5668[<sup>13</sup>]\u3002</li> <li>AUIPC (Add Upper Immediate to PC)\uff1a\u8fd9\u6761\u6307\u4ee4\u7528\u4e8e\u5c06PC\u7684\u9ad820\u4f4d\u4e0e\u4e00\u4e2a\u7acb\u5373\u6570\u76f8\u52a0\uff0c\u751f\u6210\u4e00\u4e2a32\u4f4d\u7684\u5730\u5740\u3002\u5b83\u901a\u5e38\u4e0e<code>JALR</code>\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u8ba1\u7b97\u5e76\u8df3\u8f6c\u5230\u4e00\u4e2a\u8f83\u5927\u7684\u504f\u79fb\u8ddd\u79bb[<sup>12</sup>]\u3002</li> </ol> <p>\u5728RISC-V\u4e2d\uff0c\u51fd\u6570\u8c03\u7528\u548c\u8fd4\u56de\u7684\u5b9e\u73b0\u9075\u5faa\u7279\u5b9a\u7684\u8c03\u7528\u7ea6\u5b9a\uff0c\u5176\u4e2d\u5305\u62ec\u53c2\u6570\u548c\u8fd4\u56de\u503c\u901a\u8fc7\u5bc4\u5b58\u5668\u4f20\u9012\uff0c\u4ee5\u53ca\u8c03\u7528\u8005\u548c\u88ab\u8c03\u7528\u8005\u5173\u4e8e\u5bc4\u5b58\u5668\u4f7f\u7528\u7684\u7ea6\u5b9a\u3002\u8fd9\u4e9b\u7ea6\u5b9a\u786e\u4fdd\u4e86\u4e0d\u540c\u51fd\u6570\u95f4\u7684\u6b63\u786e\u4ea4\u4e92\u548c\u8fd4\u56de\u8def\u5f84\u7684\u6b63\u786e\u6027\u3002</p> <p>\u5728\u51fd\u6570\u8c03\u7528\u6307\u4ee4\u4e2d\u8bb0\u5f55\u76ee\u6807\u5730\u5740, \u8868\u793a\u5c06\u8981\u8c03\u7528\u67d0\u4e2a\u51fd\u6570; </p> <p>\u7136\u540e\u5728\u51fd\u6570\u8fd4\u56de\u6307\u4ee4\u4e2d\u8bb0\u5f55\u5f53\u524dPC, \u8868\u793a\u5c06\u8981\u4ecePC\u6240\u5728\u7684\u51fd\u6570\u8fd4\u56de. </p> <p>\u5728\u76f8\u5173\u6307\u4ee4\u7684\u5b9e\u73b0\u4e2d\u6dfb\u52a0\u4ee3\u7801\u6765\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd.</p> <p>\u4f46\u76ee\u6807\u5730\u5740\u548cPC\u503c\u4ecd\u7136\u7f3a\u5c11\u7a0b\u5e8f\u8bed\u4e49, \u5982\u679c\u6211\u4eec\u80fd\u628a\u5b83\u4eec\u7ffb\u8bd1\u6210\u51fd\u6570\u540d, \u5c31\u66f4\u5bb9\u6613\u7406\u89e3\u4e86!</p> <p>\u600e\u4e48\u505a\uff0c\u901a\u8fc7 elf \u7684\u7b26\u53f7\u8868\u3002</p> <p>\u901a\u8fc7\u7b26\u53f7\u8868, \u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u51fd\u6570\u540d\u4e0e\u5176\u5730\u5740\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002\u4f46readelf\u8f93\u51fa\u7684\u4fe1\u606f\u662f\u5df2\u7ecf\u7ecf\u8fc7\u89e3\u6790\u7684, \u5b9e\u9645\u4e0a\u7b26\u53f7\u8868\u4e2d<code>Name</code> \u5c5e\u6027\u5b58\u653e\u7684\u662f\u5b57\u7b26\u4e32\u5728\u5b57\u7b26\u4e32\u8868(string table)\u4e2d\u7684\u504f\u79fb\u91cf</p> <p>\u5b57\u7b26\u4e32\u8868\u53ea\u4e0d\u8fc7\u662f\u628a\u6807\u8bc6\u7b26\u7684\u5b57\u7b26\u4e32\u62fc\u63a5\u8d77\u6765\u800c\u5df2.</p> <p>\u5c06\u7ed9\u5b9a\u7684\u5730\u5740\u7ffb\u8bd1\u6210\u51fd\u6570\u540d\uff1a\u7531\u4e8e\u51fd\u6570\u7684\u8303\u56f4\u662f\u4e92\u4e0d\u76f8\u4ea4\u7684, \u6211\u4eec\u53ef\u4ee5\u9010\u9879\u626b\u63cf\u7b26\u53f7\u8868\u4e2d<code>Type</code>\u5c5e\u6027\u4e3a<code>FUNC</code>\u7684\u6bcf\u4e00\u4e2a\u8868\u9879, \u68c0\u67e5\u7ed9\u51fa\u7684\u5730\u5740\u662f\u5426\u843d\u5728\u533a\u95f4<code>[Value, Value + Size)</code>\u5185\u3002</p> <ul> <li>\u82e5\u662f, \u5219\u6839\u636e\u8868\u9879\u4e2d\u7684 <code>Name</code> \u5c5e\u6027\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u627e\u5230\u76f8\u5e94\u7684\u5b57\u7b26\u4e32, \u4f5c\u4e3a\u51fd\u6570\u540d\u8fd4\u56de. </li> <li>\u5982\u679c\u6ca1\u6709\u627e\u5230\u7b26\u5408\u8981\u6c42\u7684\u7b26\u53f7\u8868\u8868\u9879, \u53ef\u4ee5\u8fd4\u56de\u5b57\u7b26\u4e32\"???\", \u4e0d\u8fc7\u8fd9\u5f88\u53ef\u80fd\u662f\u4f60\u7684\u5b9e\u73b0\u9519\u8bef\u5bfc\u81f4\u7684, \u4f60\u9700\u8981\u518d\u6b21\u68c0\u67e5\u4f60\u7684\u5b9e\u73b0.</li> </ul> <p>\u603b\u7ed3\uff1a</p> <ol> <li> <p>\u89e3\u6790 elf \u6587\u4ef6</p> <p>\u4eceelf \u6587\u4ef6\u4e2d\u8bfb\u51fa\u7b26\u53f7\u8868\u548c\u5b57\u7b26\u4e32\u8868</p> </li> <li> <p>\u4e3aNEMU \u4f20\u5165\u4e00\u4e2a elf \u6587\u4ef6\uff0cparse_args()</p> </li> <li> <p>\u4fee\u6539 jal jalr \u6307\u4ee4\uff0c\u8bc6\u522b\u51fa \u51fd\u6570\u8c03\u7528\u6307\u4ee4\u548c\u51fd\u6570\u8fd4\u56de\u6307\u4ee4\u3002</p> </li> <li> <p>\u89e3\u6790\u7b26\u53f7\u8868\u548c\u5b57\u7b26\u4e32\u8868\uff0c\u8bb0\u5f55\u76ee\u6807\u5730\u5740\u548c\u5f53\u524d\u7684PC\uff0c\u89e3\u6790\u5b57\u7b26\u4e32\u8868\u77e5\u9053\u8c03\u7528\u7684\u662f\u54ea\u4e2a\u51fd\u6570</p> </li> <li> <p>\u6ca1\u6709\u597d\u597d\u5206\u6790\u8fd9\u91cc\uff0c\u73b0\u5728\u8981\u8865\u56de\u6765\u4e86</p> <pre><code>while ( (o = getopt_long(argc, argv, \"-bhl:d:p:e:\", table, NULL)) != -1) {\n    switch (o) {\n      case 'b': sdb_set_batch_mode(); break;\n      case 'p': sscanf(optarg, \"%d\", &amp;difftest_port); break;\n      case 'l': log_file = optarg; break;\n      case 'd': diff_so_file = optarg; break;\n      case 'e': elf_file = optarg; break;\n      case 1: img_file = optarg; return 0;\n      default:\n        printf(\"Usage: %s [OPTION...] IMAGE [args]\\n\\n\", argv[0]);\n        printf(\"\\t-b,--batch              run with batch mode\\n\");\n        printf(\"\\t-l,--log=FILE           output log to FILE\\n\");\n        printf(\"\\t-d,--diff=REF_SO        run DiffTest with reference REF_SO\\n\");\n        printf(\"\\t-p,--port=PORT          run DiffTest with port PORT\\n\");\n        printf(\"\\t-e,--elf=elf_file       parse elf_file\");\n        printf(\"\\n\");\n        exit(0);\n    }\n  }\n</code></pre> <p><code>getopt</code>\u7cfb\u5217\u51fd\u6570\u7528\u4e8e\u89e3\u6790\u547d\u4ee4\u884c\u9009\u9879\u3002\u8fd9\u4e9b\u51fd\u6570\u5141\u8bb8\u7a0b\u5e8f\u901a\u8fc7\u547d\u4ee4\u884c\u63a5\u6536\u9009\u9879\u548c\u53c2\u6570\uff0c\u8fd9\u5728\u7f16\u5199\u9700\u8981\u7528\u6237\u8f93\u5165\u914d\u7f6e\u7684\u7a0b\u5e8f\u65f6\u975e\u5e38\u6709\u7528\u3002\u4e0b\u9762\u6211\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u8fd9\u4e9b\u51fd\u6570\u7684\u7528\u6cd5\uff0c\u5e76\u7ed3\u5408\u4f60\u63d0\u4f9b\u7684\u4ee3\u7801\u793a\u4f8b\u8fdb\u884c\u89e3\u91ca\u3002</p> <p>\u6240\u4ee5\u5728 \u7f16\u8bd1 <code>riscv32-nemu</code> \u9700\u8981\u6307\u5b9a\u65b0\u7684\u53c2\u6570\u4f20\u5165elf\u6587\u4ef6\u4e86\uff0c</p> <pre><code>NEMUFLAGS += -l $(shell dirname $(IMAGE).elf)/nemu-log.txt\nNEMUFLAGS += -b\nNEMUFLAGS += -e $(IMAGE).elf\n//abstract-machine/scripts/platform/nemu.mk \n</code></pre> </li> <li> <p>\u590d\u4e60\u4e00\u4e0b\u51e0\u4e2a\u5b8f</p> <ul> <li><code>Log()</code>\u662f<code>printf()</code>\u7684\u5347\u7ea7\u7248, \u4e13\u95e8\u7528\u6765\u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f, \u540c\u65f6\u8fd8\u4f1a\u8f93\u51fa\u4f7f\u7528<code>Log()</code>\u6240\u5728\u7684\u6e90\u6587\u4ef6, \u884c\u53f7\u548c\u51fd\u6570. \u5f53\u8f93\u51fa\u7684\u8c03\u8bd5\u4fe1\u606f\u8fc7\u591a\u7684\u65f6\u5019, \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b9a\u4f4d\u5230\u4ee3\u7801\u4e2d\u7684\u76f8\u5173\u4f4d\u7f6e</li> <li><code>Assert()</code>\u662f<code>assert()</code>\u7684\u5347\u7ea7\u7248, \u5f53\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u5047\u65f6, \u5728assertion fail\u4e4b\u524d\u53ef\u4ee5\u8f93\u51fa\u4e00\u4e9b\u4fe1\u606f</li> <li><code>panic()</code>\u7528\u4e8e\u8f93\u51fa\u4fe1\u606f\u5e76\u7ed3\u675f\u7a0b\u5e8f, \u76f8\u5f53\u4e8e\u65e0\u6761\u4ef6\u7684assertion fail</li> </ul> </li> <li> <p>\u5b57\u7b26\u4e32\u7d22\u5f15\u600e\u4e48\u627e\uff1f</p> <pre><code>    // \u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u73b0\u5728\u8fd8\u9700\u8981\u5728\u6bb5\u8868\u4e2d\u627e\u5230\u5b57\u7b26\u4e32\u8868\n    // \u4f46\u662f\u600e\u4e48\u83b7\u5f97\u5728\u5b57\u7b26\u4e32\u8868\u5728\u6bb5\u8868\u4e2d\u7684\u7d22\u5f15\u5462\uff1f\u5c31\u5411\u7b26\u53f7\u8868\u7684sym_index\n</code></pre> <p>\u95ee\u9898\uff1a\u5982\u4f55\u627e\u5230\u5b57\u7b26\u4e32\u8868\u7684\u7d22\u5f15\uff1f</p> <p>\u5728ELF\u683c\u5f0f\u4e2d\uff0c\u7b26\u53f7\u8868\uff08<code>SHT_SYMTAB</code>\uff09\u7684\u6bcf\u4e2a\u6761\u76ee\u90fd\u6709\u4e00\u4e2a<code>st_name</code>\u5b57\u6bb5\uff0c\u5b83\u662f\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u6307\u5411\u5b57\u7b26\u4e32\u8868\u4e2d\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u5b57\u7b26\u4e32\u8868\u901a\u5e38\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662f\u52a8\u6001\u7b26\u53f7\u8868\uff08<code>SHT_DYNSYM</code>\uff09\u7684\uff0c\u53e6\u4e00\u4e2a\u662f\u5e38\u89c4\u7b26\u53f7\u8868\u7684\u3002\u5b57\u7b26\u4e32\u8868\u7684\u7d22\u5f15\u5b58\u50a8\u5728\u7b26\u53f7\u8868\u5934\u7684<code>sh_link</code>\u5b57\u6bb5\u4e2d\uff0c\u8be5\u5b57\u6bb5\u6307\u5411\u5305\u542b\u7b26\u53f7\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u8868\u3002</p> <p>\u4e3a\u4ec0\u4e48\u80fd\u8fd9\u6837\uff1f</p> <p>\u5728ELF\uff08Executable and Linkable Format\uff09\u6587\u4ef6\u683c\u5f0f\u4e2d\uff0c\u6bcf\u4e2a\u8282\uff08section\uff09\u90fd\u6709\u5176\u5934\u90e8\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u88ab\u5b58\u50a8\u5728<code>Elf64_Shdr</code>\u7ed3\u6784\u4f53\u4e2d\u3002\u5bf9\u4e8e\u7b26\u53f7\u8868\uff08<code>SHT_SYMTAB</code>\uff09\uff0c\u5176\u5934\u90e8\u4fe1\u606f\u4e2d\u7684\u67d0\u4e9b\u5b57\u6bb5\u7279\u522b\u91cd\u8981\uff1a</p> <ul> <li><code>sh_name</code>\uff1a\u7b26\u53f7\u8868\u7684\u540d\u79f0\uff0c\u5728\u6587\u4ef6\u4e2dsection\u540d\u79f0\u5b57\u7b26\u4e32\u8868\u4e2d\u7684\u504f\u79fb\u91cf\u3002</li> <li><code>sh_type</code>\uff1a\u7b26\u53f7\u8868\u7684\u7c7b\u578b\uff0c\u5bf9\u4e8e\u7b26\u53f7\u8868\u6765\u8bf4\u5e94\u8be5\u662f<code>SHT_SYMTAB</code>\u3002</li> <li><code>sh_flags</code>\uff1a\u7b26\u53f7\u8868\u7684\u5c5e\u6027\u6807\u5fd7\u3002</li> <li><code>sh_addr</code>\uff1a\u5982\u679c\u6b64section\u5e94\u8be5\u88ab\u653e\u5165\u5185\u5b58\uff0c\u8fd9\u662f\u5176\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740\u3002</li> <li><code>sh_offset</code>\uff1a\u7b26\u53f7\u8868\u7684\u6587\u4ef6\u504f\u79fb\u91cf\u3002</li> <li><code>sh_size</code>\uff1a\u7b26\u53f7\u8868\u7684\u5927\u5c0f\u3002</li> <li><code>sh_link</code>\uff1a\u94fe\u63a5\u5230\u5176\u4ed6section\u7684\u7d22\u5f15\u3002\u5bf9\u4e8e\u7b26\u53f7\u8868\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u901a\u5e38\u6307\u5411\u5b57\u7b26\u4e32\u8868\u3002</li> <li><code>sh_info</code>\uff1a\u63d0\u4f9b\u4e86\u6b64section\u989d\u5916\u4fe1\u606f\u7684\u503c\u3002\u5bf9\u4e8e\u7b26\u53f7\u8868\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u901a\u5e38\u8868\u793a\u7b26\u53f7\u7684\u7ed1\u5b9a\u4fe1\u606f\u3002</li> <li><code>sh_addralign</code>\uff1asection\u5730\u5740\u7684\u5bf9\u9f50\u8981\u6c42\u3002</li> <li><code>sh_entsize</code>\uff1a\u5982\u679csection\u5305\u542b\u4e00\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684entry\u6570\u7ec4\uff0c\u8fd9\u662f\u6bcf\u6761entry\u7684\u5927\u5c0f\u3002</li> </ul> <p><code>sh_link</code>\u5b57\u6bb5\u5bf9\u4e8e\u7b26\u53f7\u8868\u6765\u8bf4\u7279\u522b\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u4e32\u8868\u7684\u7d22\u5f15\u3002\u5b57\u7b26\u4e32\u8868\uff08<code>.shstrtab</code>\u6216<code>SHT_STRTAB</code>\uff09\u662f\u4e00\u4e2a\u5305\u542b\u4e86\u6240\u6709section\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u8868\uff0c\u4ee5\u53ca\u7b26\u53f7\u8868\u4e2d\u6bcf\u4e2a\u7b26\u53f7\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u8868\u3002\u5728\u7b26\u53f7\u8868\u4e2d\uff0c\u6bcf\u4e2a\u7b26\u53f7\u7684<code>st_name</code>\u5b57\u6bb5\u662f\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u7528\u4e8e\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u5b9a\u4f4d\u8be5\u7b26\u53f7\u7684\u540d\u79f0\u3002</p> </li> <li> <p>\u7559\u5751\uff1adone</p> <p>\u8bc6\u522b\u4e0d\u540c\u4f4d\u6570\u7684elf\u683c\u5f0f\u95ee\u9898\uff0c\u4e4b\u524d\u7528\u4e86elf64\uff0c\u4f46\u662f\u6211\u7684\u6307\u4ee4\u96c6\u662friscv32\u7684\uff0c\u751f\u6210\u7684\u662felf32\u7684\uff0c\u5728\u5199\u7684\u65f6\u5019\u8981\u6ce8\u610f\uff0c\u6211\u521a\u5f00\u59cb\u7528\u4e8664\u4f4d\u7684\uff0c\u5bfc\u81f4\u8f93\u51fa\u7684\u7b26\u53f7\u8868\u4e2a\u6570\u4e0d\u4e00\u6837\u3002</p> <p>\u90a3\u6211\u60f3\u80fd\u4e0d\u80fd\u50cfwordt\u90a3\u6837\u4e5f\u7528\u5b8f\u5c01\u88c5\u4e0d\u540c\u4f4d\u6570\u7684\u7248\u672c</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u6211\u4e00\u76f4\u7528\u6570\u7ec4\uff1f</p> <p>\u4ece\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\u300b\u4e00\u4e66\u770b\u5230\uff0c\u5f88\u591a\u8fd9\u79cd\u8868\u90fd\u7528\u201c\u6570\u7ec4\"\u6765\u7ef4\u62a4\u554a\u3002</p> </li> <li> <p>\u5b9e\u73b0\u51fd\u6570\u8fd4\u56de\u6307\u4ee4\u7684\u8303\u56f4\uff1a[Value, Value + Size)</p> <pre><code>int find_symbol_func(vaddr_t target, bool is_call) {\n    int i = 0;\n    for (; i &lt; ftrace_table_size; i++) {\n        //if (ftrace_tab[i].info == STT_FUNC) {\n        if (ELF32_ST_TYPE(ftrace_tab[i].info) == STT_FUNC) {\n            if (is_call) {\n                if (ftrace_tab[i].addr == target) break;\n            } else {\n                if (ftrace_tab[i].addr &lt;= target &amp;&amp; target &lt; ftrace_tab[i].addr + ftrace_tab[i].size) break;\n            }\n        }\n    }\n    return i &lt; ftrace_table_size ? i : -1;\n}\n</code></pre> </li> <li> <p>\u8865\u5751</p> <p>\u4e00\u4e2a\u6708\u6ca1\u5f04\u4e4b\u540e\u53d1\u73b0\uff0c\u4e4b\u524d\u5b9e\u73b0\u597d\u7684ftrace\u529f\u80fd\u66f4\u5c31\u6709 bug\u4e86\u3002\u4e00\u901a\u5bf9\u6bd4\u53d1\u73b0\u5b9e\u9645\u4e0a\u662fjal\u6307\u4ee4\u5b9e\u73b0\u7684\u987a\u5e8f\u51fa\u4e86\u70b9\u95ee\u9898\u3002</p> <p>\u6709 bug\uff1a\uff08\u8f83\u665a\u7684\u672c\u672c\uff09</p> <p></p> <p>\u6b63\u5e38\uff1a\uff08\u8f83\u65e9\u7684\u7248\u672c\uff09</p> <p></p> <p>\u5f53\u65f6\u624b\u518c\u6284\u7cca\u6d82\u4e86\uff0c\u5982\u679c\u6211\u5148\u8fdb\u884c\u4e86\u76ee\u7684\u5bc4\u5b58\u5668\u7684\u8d4b\u503c\uff0c\u90a3\u5c31\u4f1a\u5f71\u54cd\u5230ftrace\u7684\u529f\u80fd\u3002\u540e\u6765\u8fd8\u662f\u5199\u61f5\u903c\u4e86\u3002</p> <p>\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff0c\u5728\u67e5\u627ebug\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u6211\u662f\u4e00\u4e2a\u4e2a\u51fd\u6570\u53bb\u770b\u6211\u5199\u7684elf\u89e3\u6790\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u662f\u5426\u6709\u5fc5\u8981\u505a\u4e00\u4e2a\u50cfreadelf\u8f93\u51fa\u7684\u90a3\u6837\uff0c\u5c06\u5404\u79cd\u7b26\u53f7\u50cf\u4e00\u5f20\u8868\u4e00\u6837\u6253\u5370\u51fa\u6765\uff1f</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u679c\u4f60\u4ed4\u7ec6\u89c2\u5bdf\u4e0a\u6587<code>recursion</code>\u7684\u793a\u4f8b\u8f93\u51fa, \u4f60\u4f1a\u53d1\u73b0\u4e00\u4e9b\u6709\u8da3\u7684\u73b0\u8c61. \u5177\u4f53\u5730, \u6ce8\u91ca(1)\u5904\u7684<code>ret</code>\u7684\u51fd\u6570\u662f\u548c\u5bf9\u5e94\u7684<code>call</code>\u5339\u914d\u7684, \u4e5f\u5c31\u662f\u8bf4, <code>call</code>\u8c03\u7528\u4e86<code>f2</code>, \u800c\u4e0e\u4e4b\u5bf9\u5e94\u7684<code>ret</code>\u4e5f\u662f\u4ece<code>f2</code>\u8fd4\u56de; \u4f46\u6ce8\u91ca(2)\u6240\u6307\u793a\u7684\u4e00\u7ec4<code>call</code>\u548c<code>ret</code>\u7684\u60c5\u51b5\u5374\u6709\u6240\u4e0d\u540c, <code>call</code>\u8c03\u7528\u4e86<code>f1</code>, \u4f46\u5374\u4ece<code>f0</code>\u8fd4\u56de; \u6ce8\u91ca(3)\u6240\u6307\u793a\u7684\u4e00\u7ec4<code>call</code>\u548c<code>ret</code>\u4e5f\u51fa\u73b0\u4e86\u7c7b\u4f3c\u7684\u73b0\u8c61, <code>call</code>\u8c03\u7528\u4e86<code>f1</code>, \u4f46\u5374\u4ece<code>f3</code>\u8fd4\u56de.</p> <p>\u5c1d\u8bd5\u7ed3\u5408\u53cd\u6c47\u7f16\u7ed3\u679c, \u5206\u6790\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u8fd9\u4e00\u73b0\u8c61.</p> <p>\u4e3a\u4ec0\u4e48\u6211\u81ea\u5df1\u7684\u5b9e\u73b0\u597d\u50cf\u6ca1\u6709\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff1f</p> <p>\u4f46\u662f\u6211\u5728\u81ea\u5df1\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\u548c\u8fd4\u56de\u7684\u65f6\u5019\u4e5f\u4e86\u89e3\u5230\u5404\u79cd\u6307\u4ee4\u6709\u4e24\u4e2a\u7248\u672c\uff1a\u4e00\u79cd\u4fdd\u5b58\u8fd4\u56de\u5730\u5740\uff0c\u4e00\u79cd\u4e0d\u4fdd\u5b58\u3002</p> <p>\u8fd9\u91cc\u5c31\u6709\u70b9\u50cf\u4e4b\u524d\u4e86\u89e3\u8fc7\u7684\u5c3e\u9012\u5f52\u548c\u5c3e\u8c03\u7528\uff1f</p> <p>\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u662f\u6307\u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0c\u7f16\u8bd1\u5668\u53ef\u4ee5\u76f4\u63a5 \u5229\u7528\u8df3\u8f6c\u6307\u4ee4\u53d6\u4ee3\u51fd\u6570\u8c03\u7528\u6307\u4ee4\uff0c\u6765\u201c\u6a21\u62df\u201d\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u3002</p> <p>\u8fd9\u6837\u505a\uff0c\u4fbf\u53ef\u4ee5\u7701\u53bb\u51fd\u6570\u8c03\u7528\u6808\u5e27\u7684\u4e0d\u65ad\u521b\u5efa\u548c\u9500\u6bc1\u8fc7\u7a0b\uff1b\u800c\u4e14\uff0c\u9012\u5f52\u51fd\u6570\u5728\u6574\u4e2a\u8c03\u7528\u671f\u95f4\u90fd\u4ec5\u5728\u6808\u5185\u5b58\u4e2d\u7ef4\u62a4\u7740\u4e00\u4e2a\u6808\u5e27\uff0c\u56e0\u6b64\u53ea\u4f7f\u7528\u4e86\u6709\u9650\u7684\u6808\u5185\u5b58\u3002</p> <p>\u5bf9\u4e8e\u51fd\u6570\u4f53\u8f83\u4e3a\u5c0f\u5de7\uff0c\u5e76\u4e14\u53ef\u80fd\u4f1a\u8fdb\u884c\u8f83\u591a\u6b21\u9012\u5f52\u8c03\u7528\u7684\u51fd\u6570\uff0c\u5c3e\u9012\u5f52\u8c03\u7528\u4f18\u5316\u53ef\u4ee5\u5e26\u6765\u53ef\u89c2\u7684\u6267\u884c\u6548\u7387\u63d0\u5347\u3002</p> <p>\u6240\u4ee5\u8fd8\u5f97\u8bb0\u5f55\u4e00\u4e0b\u90a3\u4e9b\u88ab\u5c3e\u8c03\u7528\u4f18\u5316\u7684\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u600e\u4e48\u7ef4\u62a4\uff1f</p> <p>\u7559\u5751 </p> <p>\u5148\u7528\u7740\u522b\u4eba\u7684\u5148\u3002</p> </li> <li> <p>\u603b\u7ed3\u89e3\u6790 ELF\u00a0\u6587\u4ef6\u7684\u8fc7\u7a0b</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5bfb\u627e\"Hello World!\"</p> <p>\u5728Linux\u4e0b\u7f16\u5199\u4e00\u4e2aHello World\u7a0b\u5e8f, \u7f16\u8bd1\u540e\u901a\u8fc7\u4e0a\u8ff0\u65b9\u6cd5\u627e\u5230ELF\u6587\u4ef6\u7684\u5b57\u7b26\u4e32\u8868, \u4f60\u53d1\u73b0\"Hello World!\"\u5b57\u7b26\u4e32\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u7684\u4ec0\u4e48\u4f4d\u7f6e? \u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837?</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char *test = \"hello World!\";\n    printf(\"%s\\n\",test);\n    return 0;\n}\n</code></pre> <p>\u597d\u50cf\u4e0d\u5728\u5b57\u7b26\u4e32\u8868\uff1f\u6211\u81ea\u5df1\u5199\u7684\u5728.rodata\u6bb5.</p> <pre><code>[18] .rodata           PROGBITS         0000000000002000  00002000 \n     0000000000000011  0000000000000000   A       0     0     4\n\n 81   [28] .symtab           SYMTAB           0000000000000000  00003040\n 82        0000000000000360  0000000000000018          29    18     8\n 83   [29] .strtab           STRTAB           0000000000000000  000033a0\n 84        00000000000001db  0000000000000000           0     0     1\n</code></pre> <pre><code>00002000  01 00 02 00 68 65 6c 6c  6f 20 57 6f 72 6c 64 21  |....hello World!| \n</code></pre> <p>\u62fc\u63a5\u51fa\u6765\u7684\u7b26\u53f7\u8868\u6ca1\u6709\u8fd9\u4e2a\uff1f\u6211\u518d\u6362\u4e00\u79cd\u5199\u6cd5\u770b\u770b</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    printf(\"hello world!\\n\");\n    return 0;\n}\n</code></pre> <p>\u8fd8\u662f\u5728rodata\u6bb5\u3002</p> <p>\u60f3\u60f3\u5b57\u7b26\u4e32\u8868\u7684\u6982\u5ff5\uff0c\u4ed6\u662f\u5b58\u4ec0\u4e48\u7684\u3002</p> <p>\u5b57\u7b26\u4e32\u8868\uff08<code>.strtab</code>\uff09\u901a\u5e38\u7528\u4e8e\u5b58\u50a8\u7a0b\u5e8f\u4e2d\u7528\u5230\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u4ee5\u4fbf\u4e8e\u94fe\u63a5\u5668\u548c\u8c03\u8bd5\u5668\u4f7f\u7528\u3002\u7136\u800c\uff0c\u5b83\u5e76\u4e0d\u76f4\u63a5\u5b58\u50a8<code>.rodata</code>\u6bb5\u4e2d\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u3002\u5b57\u7b26\u4e32\u8868\u4e3b\u8981\u7528\u4e8e==\u5b58\u50a8\u7b26\u53f7\u8868\u4e2d\u7684\u5b57\u7b26\u4e32==\uff0c\u6bd4\u5982\u53d8\u91cf\u540d\u3001\u5e38\u91cf\u540d\u7b49\uff0c\u800c\u4e0d\u662f\u7a0b\u5e8f\u4e2d\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u3002</p> <p>\u56e0\u6b64\uff0c\u5728ELF\u6587\u4ef6\u4e2d\u67e5\u627e<code>\"Hello World!\"</code>\u5b57\u7b26\u4e32\u65f6\uff0c\u6211\u4eec\u5e76\u4e0d\u4f1a\u4f1a\u5728\u5b57\u7b26\u4e32\u8868\u4e2d\u627e\u5230\u5b83\uff0c\u800c\u662f\u5e94\u8be5\u5728<code>.rodata</code>\u6bb5\u4e2d\u627e\u5230\u3002</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5197\u4f59\u7684\u7b26\u53f7\u8868</p> <ol> <li> <p>\u60c5\u51b5\u4e00</p> <p>\u5728Linux\u4e0b\u7f16\u5199\u4e00\u4e2aHello World\u7a0b\u5e8f, \u7136\u540e\u4f7f\u7528<code>strip</code>\u547d\u4ee4\u4e22\u5f03\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u7684\u7b26\u53f7\u8868:</p> <pre><code>gcc -o hello hello.c\nstrip -s hello\n</code></pre> <p>\u7528<code>readelf</code>\u67e5\u770bhello\u7684\u4fe1\u606f, \u4f60\u4f1a\u53d1\u73b0\u7b26\u53f7\u8868\u88ab\u4e22\u5f03\u4e86, \u6b64\u65f6\u7684hello\u7a0b\u5e8f\u80fd\u6210\u529f\u8fd0\u884c\u5417?</p> </li> <li> <p>\u60c5\u51b5\u4e8c</p> <p>\u76ee\u6807\u6587\u4ef6\u4e2d\u4e5f\u6709\u7b26\u53f7\u8868, \u6211\u4eec\u540c\u6837\u53ef\u4ee5\u4e22\u5f03\u5b83:</p> <pre><code>gcc -c hello.c\nstrip -s hello.o\n</code></pre> <p>\u7528<code>readelf</code>\u67e5\u770bhello.o\u7684\u4fe1\u606f, \u4f60\u4f1a\u53d1\u73b0\u7b26\u53f7\u8868\u88ab\u4e22\u5f03\u4e86. \u5c1d\u8bd5\u5bf9hello.o\u8fdb\u884c\u94fe\u63a5:</p> <pre><code>gcc -o hello hello.o\n</code></pre> </li> </ol> <p>\u4f60\u53d1\u73b0\u4e86\u4ec0\u4e48\u95ee\u9898? \u5c1d\u8bd5\u5bf9\u6bd4\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5, \u5e76\u5206\u6790\u5176\u4e2d\u7684\u539f\u56e0.</p> <p>\u5f53\u751f\u6210\u4e86\u53ef\u6267\u884c\u6587\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u4e0b\u4e00\u6b65\u7684\u5185\u5bb9\u5c31\u662f\u5c06elf\u6587\u4ef6\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\uff08\u60f3\u60f3\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a\u8fd9\u4e2a\u89c6\u89d2\uff0c\u4ece\u5185\u5b58\u4e2d\u53d6\u4e00\u6761\u6307\u4ee4\u6267\u884c\uff0c\u4e0d\u65ad\u5faa\u73af\uff09CPU\u4ece\u5185\u5b58\u4e2d\u53d6\u5f97\u6307\u4ee4\uff0c\u4e00\u6b65\u6b65\u6267\u884c\u5373\u53ef\u3002</p> <p>\u800c\u7b26\u53f7\u8868\u5462\uff1f\u5b83\u662f\u7f16\u8bd1\u5668\u4e3a\u4e86\u7ba1\u7406\u548c\u8bbf\u95ee\u7a0b\u5e8f\u7528\u5230\u7684\u5404\u79cd\u7c7b\u578b\u7684\u7b26\u53f7\u6240\u521b\u5efa\u51fa\u6765\u7684\u4e00\u5f20\u8868\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e9b\u7b26\u53f7\u8868\u7528\u4e8e\u6807\u8bc6\u8fd9\u4e9b\u7b26\u53f7\u7684\u5730\u5740\u3002</p> <p>\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u7a0b\u5e8f\u4e2d\u7684\u4ee3\u7801\u548c\u6570\u636e\u5df2\u7ecf\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u7279\u5b9a\u4f4d\u7f6e\uff0cCPU\u76f4\u63a5\u901a\u8fc7\u5185\u5b58\u5730\u5740\u6765\u8bbf\u95ee\u5b83\u4eec\uff0c\u4e0d\u518d\u9700\u8981\u7b26\u53f7\u540d\u6765\u89e3\u6790\u8fd9\u4e9b\u5730\u5740\u3002\uff08\u53e6\u5916\u52a8\u6001\u94fe\u63a5\u4e5f\u662f\u4e00\u6837\uff0c\u5bf9\u4e8e\u52a8\u6001\u94fe\u63a5\u7684\u5e93\uff0c\u7b26\u53f7\u8868\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u7531\u52a8\u6001\u94fe\u63a5\u5668\u4f7f\u7528\uff0c\u4ee5\u89e3\u6790\u7a0b\u5e8f\u5bf9\u5e93\u4e2d\u51fd\u6570\u548c\u53d8\u91cf\u7684\u5f15\u7528\uff0c\u4f46\u662f\uff0c\u4e00\u65e6\u8fd9\u4e9b\u5f15\u7528\u88ab\u89e3\u6790\u5e76\u4e14\u7a0b\u5e8f\u5df2\u7ecf\u8fd0\u884c\uff0c\u7b26\u53f7\u8868\u5c31\u4e0d\u518d\u88ab\u9700\u8981\u3002\u8c03\u8bd5\u540c\u7406\u3002\uff09</p> <p>\u800c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5462\uff0c\u94fe\u63a5\u671f\u95f4\u662f\u9700\u8981\u7b26\u53f7\u8868\u6765\u6807\u8bc6\u5404\u4e2a\u7b26\u53f7\u7684\u4f4d\u7f6e\u7684\uff0c\u5982\u679c\u4e22\u5f03\u4e86\u7b26\u53f7\u8868\uff0c\u94fe\u63a5\u5668\u627e\u4e0d\u5230\u5fc5\u8981\u7684\u7b26\u53f7\u5b9a\u4e49\uff0c\u65e0\u6cd5\u5b8c\u6210\u5730\u5740\u5206\u914d\u548c\u7b26\u53f7\u89e3\u6790\uff0c\u5bfc\u81f4\u94fe\u63a5\u5931\u8d25\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5728\u4e22\u5f03\u7b26\u53f7\u8868\u540e\uff0c\u94fe\u63a5\u8fc7\u7a0b\u4f1a\u62a5\u9519\uff0c\u63d0\u793a\u672a\u5b9a\u4e49\u7684\u5f15\u7528\u3002</p> </li> <li> <p>ftrace\u7684\u529f\u80fd\uff1a</p> <p>trace\u4e0e\u6027\u80fd\u4f18\u5316</p> <p>\u6211\u4eec\u8ba9\u5927\u5bb6\u5728NEMU\u5b9e\u73b0trace\u5de5\u5177, \u662f\u4f5c\u4e3a\u4e00\u79cd\u57fa\u7840\u8bbe\u65bd\u6765\u5e2e\u52a9\u5927\u5bb6\u8fdb\u884c\u8c03\u8bd5. \u4e8b\u5b9e\u4e0a, trace\u9664\u4e86\u53ef\u4ee5\u5e2e\u52a9\u5927\u5bb6\u8ba4\u8bc6\u7a0b\u5e8f\u5982\u4f55\u8fd0\u884c\u4e4b\u5916, \u8fd8\u53ef\u4ee5\u6307\u5bfc\u5f00\u53d1\u8005\u8fdb\u884c\u7a0b\u5e8f\u548c\u7cfb\u7edf\u7684\u4f18\u5316, \u4f8b\u5982:</p> <ul> <li>\u53ef\u4ee5\u57fa\u4e8eftrace\u8fdb\u4e00\u6b65\u5206\u6790\u51fa\u8c03\u7528<code>memcpy()</code>\u65f6\u7684\u53c2\u6570\u60c5\u51b5, \u6bd4\u5982<code>dest</code>\u548c<code>src</code>\u662f\u5426\u5bf9\u9f50, \u62f7\u8d1d\u7684\u5185\u5b58\u957f\u5ea6\u662f\u957f\u8fd8\u662f\u77ed, \u7136\u540e\u6839\u636e\u9891\u7e41\u51fa\u73b0\u7684\u7ec4\u5408\u5bf9<code>memcpy()</code>\u7684\u7b97\u6cd5\u5b9e\u73b0\u8fdb\u884c\u4f18\u5316</li> <li>\u53ef\u4ee5\u57fa\u4e8eftrace\u7edf\u8ba1\u51fd\u6570\u8c03\u7528\u7684\u6b21\u6570, \u5bf9\u8bbf\u95ee\u6b21\u6570\u8f83\u591a\u7684\u51fd\u6570\u8fdb\u884c\u4f18\u5316, \u53ef\u4ee5\u663e\u8457\u63d0\u5347\u7a0b\u5e8f\u7684\u6027\u80fd</li> <li>\u53ef\u4ee5\u57fa\u4e8eitrace\u8fc7\u6ee4\u51fa\u5206\u652f\u8df3\u8f6c\u6307\u4ee4\u7684\u6267\u884c\u60c5\u51b5, \u4f5c\u4e3a\u5206\u652f\u9884\u6d4b\u5668(\u73b0\u4ee3\u5904\u7406\u5668\u4e2d\u7684\u4e00\u4e2a\u63d0\u5347\u6027\u80fd\u7684\u90e8\u4ef6)\u7684\u8f93\u5165, \u6765\u8c03\u6574\u5206\u652f\u9884\u6d4b\u5668\u7684\u5b9e\u73b0, \u4ece\u800c\u63d0\u5347\u5904\u7406\u5668\u7684\u6027\u80fd</li> <li>\u53ef\u4ee5\u57fa\u4e8emtrace\u5f97\u5230\u7a0b\u5e8f\u7684\u8bbf\u5b58\u5e8f\u5217, \u4f5c\u4e3a\u7f13\u5b58(\u73b0\u4ee3\u5904\u7406\u5668\u4e2d\u7684\u53e6\u4e00\u4e2a\u63d0\u5347\u6027\u80fd\u7684\u90e8\u4ef6)\u6a21\u578b\u7684\u8f93\u5165, \u5bf9\u9884\u53d6\u7b97\u6cd5\u548c\u66ff\u6362\u7b97\u6cd5\u7684\u4f18\u5316\u8fdb\u884c\u6307\u5bfc(\u4f60\u5c06\u4f1a\u5728Lab4\u4e2d\u4f53\u4f1a\u8fd9\u4e00\u70b9)</li> </ul> <p>trace\u5bf9\u6027\u80fd\u4f18\u5316\u6765\u8bf4\u5982\u6b64\u91cd\u8981, \u662f\u56e0\u4e3atrace\u53cd\u6620\u4e86\u7a0b\u5e8f\u8fd0\u884c\u7684\u771f\u5b9e\u884c\u4e3a, \u5982\u679c\u4f60\u62cd\u8111\u888b\u4f18\u5316\u4e86\u7a0b\u5e8f\u4e2d\u4e00\u4e2a\u53ea\u4f1a\u8c03\u75281\u6b21\u7684\u51fd\u6570, \u53ef\u4ee5\u60f3\u8c61\u8fd9\u6837\u7684\u4f18\u5316\u5bf9\u7a0b\u5e8f\u603b\u4f53\u6027\u80fd\u51e0\u4e4e\u6ca1\u6709\u4efb\u4f55\u63d0\u5347. \u800ctrace\u5176\u5b9e\u5411\u6211\u4eec\u5c55\u793a\u4e86\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u7ec6\u8282\u4e8b\u4ef6, \u5982\u679c\u6211\u4eec\u5bf9\u8fd9\u4e9b\u4e8b\u4ef6\u8fdb\u884c\u7edf\u8ba1\u610f\u4e49\u4e0a\u7684\u5206\u6790, \u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u54ea\u4e9b\u4e8b\u4ef6\u624d\u662f\u9891\u7e41\u53d1\u751f\u7684, \u800c\u4f18\u5316\u8fd9\u4e9b\u9891\u7e41\u53d1\u751f\u7684\u4e8b\u4ef6, \u624d\u80fd\u4ece\u7edf\u8ba1\u610f\u4e49\u4e0a\u63d0\u5347\u7a0b\u5e8f\u548c\u7cfb\u7edf\u7684\u6027\u80fd, \u8fd9\u624d\u662f\u6027\u80fd\u4f18\u5316\u7684\u79d1\u5b66\u65b9\u6cd5.</p> </li> </ol>"},{"location":"ysyx/pa/pa2/pa2.html#_13","title":"\u51fd\u6570\u539f\u578b\u548c\u5934\u6587\u4ef6","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u5305\u542b\u76f8\u5e94\u7684\u5934\u6587\u4ef6\uff1a <pre><code>#include &lt;unistd.h&gt; // \u5bf9\u4e8e POSIX \u7cfb\u7edf\uff0c\u5982 Linux \u6216 macOS\n// \u6216\u8005\n#include &lt;getopt.h&gt; // \u67d0\u4e9b\u7cfb\u7edf\u53ef\u80fd\u9700\u8981\u8fd9\u4e2a\n</code></pre></p>"},{"location":"ysyx/pa/pa2/pa2.html#getopt","title":"getopt\u51fd\u6570","text":"<p><code>getopt</code>\u51fd\u6570\u662f\u6700\u57fa\u672c\u7684\u547d\u4ee4\u884c\u89e3\u6790\u51fd\u6570\uff0c\u5176\u539f\u578b\u5982\u4e0b\uff1a <pre><code>int getopt(int argc, char * const argv[], const char *optstring);\n</code></pre> - <code>argc</code>\u548c<code>argv</code>\u662f<code>main</code>\u51fd\u6570\u7684\u53c2\u6570\uff0c\u5206\u522b\u4ee3\u8868\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u91cf\u548c\u5217\u8868\u3002 - <code>optstring</code>\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6307\u660e\u4e86\u7a0b\u5e8f\u53ef\u4ee5\u63a5\u53d7\u54ea\u4e9b\u5355\u4e2a\u5b57\u7b26\u7684\u9009\u9879\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_14","title":"\u8fd4\u56de\u503c","text":"<ul> <li><code>getopt</code>\u8fd4\u56de\u4e0b\u4e00\u4e2a\u9009\u9879\u5b57\u7b26\uff0c\u6216\u8005\u5f53\u6ca1\u6709\u66f4\u591a\u9009\u9879\u65f6\u8fd4\u56de<code>-1</code>\u3002</li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_15","title":"\u5916\u90e8\u53d8\u91cf","text":"<ul> <li><code>extern char *optarg;</code> \u6307\u5411\u5f53\u524d\u9009\u9879\u7684\u53c2\u6570\u5b57\u7b26\u4e32\u3002</li> <li><code>extern int optind;</code> \u662f\u4e0b\u4e00\u4e2a\u8981\u88ab\u89e3\u6790\u7684<code>argv</code>\u5143\u7d20\u7684\u7d22\u5f15\u3002</li> <li><code>extern int opterr;</code> \u7528\u4e8e\u62a5\u544a\u9519\u8bef\u3002</li> <li><code>optopt</code>\u662f\u5f53\u524d\u88ab\u89e3\u6790\u7684\u9009\u9879\u3002</li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#getopt_long","title":"getopt_long\u51fd\u6570","text":"<p><code>getopt_long</code>\u51fd\u6570\u7528\u4e8e\u89e3\u6790\u957f\u9009\u9879\uff0c\u5176\u539f\u578b\u5982\u4e0b\uff1a <pre><code>int getopt_long(int argc, char * const argv[],\n                 const char *optstring,\n                 const struct option *longopts, int *longindex);\n</code></pre> - <code>longopts</code>\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\u6570\u7ec4\uff0c\u5b9a\u4e49\u4e86\u957f\u9009\u9879\u7684\u540d\u79f0\u548c\u5904\u7406\u65b9\u5f0f\u3002 - <code>longindex</code>\u662f\u4e00\u4e2a\u6307\u5411\u6574\u6570\u7684\u6307\u9488\uff0c\u7528\u4e8e\u8fd4\u56de\u5339\u914d\u7684\u957f\u9009\u9879\u5728<code>longopts</code>\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#option","title":"\u7ed3\u6784\u4f53option","text":"<p><pre><code>struct option {\n  const char *name;      // \u957f\u9009\u9879\u7684\u540d\u79f0\n  int has_arg;           // \u9009\u9879\u662f\u5426\u9700\u8981\u53c2\u6570\n  int *flag;             // \u5982\u679c\u975eNULL\uff0c\u5c06\u7ed3\u679c\u5b58\u50a8\u5728\u8fd9\u4e2a\u5730\u5740\n  int val;               // \u5982\u679cflag\u4e3aNULL\uff0c\u8fd4\u56de\u8fd9\u4e2a\u503c\n};\n</code></pre> - <code>name</code>\u662f\u957f\u9009\u9879\u7684\u540d\u79f0\uff0c\u5982<code>\"batch\"</code>\u6216<code>\"log\"</code>\u3002 - <code>has_arg</code>\u6307\u660e\u9009\u9879\u662f\u5426\u9700\u8981\u53c2\u6570\uff0c\u901a\u5e38\u4e3a<code>no_argument</code>\u6216<code>required_argument</code>\u3002 - <code>flag</code>\u5982\u679c\u975eNULL\uff0c\u5f53\u9009\u9879\u88ab\u89e6\u53d1\u65f6\uff0c\u5c06<code>val</code>\u7684\u503c\u8d4b\u7ed9<code>flag</code>\u6307\u5411\u7684\u53d8\u91cf\u3002 - <code>val</code>\u662f\u5f53\u9009\u9879\u88ab\u89e6\u53d1\u65f6\uff0c\u5982\u679c<code>flag</code>\u4e3aNULL\uff0c\u8fd4\u56de\u7684\u503c\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_16","title":"\u793a\u4f8b\u4ee3\u7801\u89e3\u6790","text":"<p>\u4e0b\u9762\u662f\u4f60\u63d0\u4f9b\u7684<code>parse_args</code>\u51fd\u6570\u7684\u89e3\u6790\uff1a</p> <p><pre><code>static int parse_args(int argc, char *argv[]) {\n  const struct option table[] = {\n    // name       has_arg  flag   val\n    {\"batch\",     no_argument, NULL, 'b'},\n    {\"log\",       required_argument, NULL, 'l'},\n    {\"diff\",      required_argument, NULL, 'd'},\n    {\"port\",      required_argument, NULL, 'p'},\n    {\"elf\",       required_argument, NULL, 'e'},\n    {\"help\",      no_argument, NULL, 'h'},\n    {0, 0, 0, 0}, // \u7ec8\u6b62\u9879\n  };\n  // ...\n}\n</code></pre> \u8fd9\u4e2a\u51fd\u6570\u4f7f\u7528<code>getopt_long</code>\u6765\u89e3\u6790\u547d\u4ee4\u884c\u9009\u9879\u3002<code>table</code>\u6570\u7ec4\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u53ef\u4ee5\u63a5\u53d7\u7684\u957f\u9009\u9879\u3002</p> <ul> <li><code>\"batch\"</code>\u662f\u4e00\u4e2a\u4e0d\u9700\u8981\u53c2\u6570\u7684\u9009\u9879\uff0c\u7528\u6237\u8f93\u5165<code>-batch</code>\u65f6\uff0c<code>val</code>\u4e3a<code>'b'</code>\u3002</li> <li><code>\"log\"</code>\u662f\u4e00\u4e2a\u9700\u8981\u53c2\u6570\u7684\u9009\u9879\uff0c\u7528\u6237\u8f93\u5165<code>-log=FILE</code>\u65f6\uff0c<code>FILE</code>\u7684\u503c\u5c06\u901a\u8fc7<code>optarg</code>\u83b7\u5f97\u3002</li> </ul> <p>\u5728<code>while</code>\u5faa\u73af\u4e2d\uff0c<code>getopt_long</code>\u88ab\u8c03\u7528\u6765\u83b7\u53d6\u4e0b\u4e00\u4e2a\u9009\u9879\u3002<code>switch</code>\u8bed\u53e5\u6839\u636e\u9009\u9879\u7684\u503c\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_17","title":"\u5b9e\u9645\u4f8b\u5b50","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4ee5\u4e0b\u547d\u4ee4\u884c\u5de5\u5177<code>mytool</code>\uff0c\u5b83\u63a5\u53d7\u4ee5\u4e0b\u9009\u9879\uff1a - <code>-b</code>\uff1a\u6279\u91cf\u6a21\u5f0f - <code>-l FILE</code>\uff1a\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230<code>FILE</code> - <code>-d REF_SO</code>\uff1a\u4f7f\u7528<code>REF_SO</code>\u4f5c\u4e3a\u53c2\u8003\u8fdb\u884c\u5dee\u5f02\u6d4b\u8bd5</p> <p>\u7528\u6237\u7684\u547d\u4ee4\u884c\u53ef\u80fd\u5982\u4e0b\uff1a <pre><code>./mytool -b -l log.txt -d reference.so\n</code></pre></p> <p>\u7a0b\u5e8f\u5c06\u89e3\u6790\u8fd9\u4e9b\u9009\u9879\uff0c\u5e76\u6839\u636e\u7528\u6237\u7684\u9009\u62e9\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_18","title":"\u7ed3\u8bba","text":"<p><code>getopt</code>\u548c<code>getopt_long</code>\u662f\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u89e3\u6790\u547d\u4ee4\u884c\u9009\u9879\u3002\u901a\u8fc7\u5b9a\u4e49\u6e05\u6670\u7684\u9009\u9879\u548c\u53c2\u6570\uff0c\u5b83\u4eec\u53ef\u4ee5\u5e2e\u52a9\u4f60\u521b\u5efa\u7528\u6237\u53cb\u597d\u7684\u547d\u4ee4\u884c\u754c\u9762\u3002\u4f60\u63d0\u4f9b\u7684<code>parse_args</code>\u51fd\u6570\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5b9e\u8df5\u4f8b\u5b50\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u548c\u76f8\u5173\u7684\u7ed3\u6784\u4f53\u6765\u5904\u7406\u590d\u6742\u7684\u547d\u4ee4\u884c\u53c2\u6570\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#-bhldpe","title":"\u89e3\u91ca<code>\"-bhl:d:p:e:\"</code>\u53c2\u6570\u5b57\u7b26\u4e32","text":"<p>\u53c2\u6570\u5b57\u7b26\u4e32<code>\"-bhl:d:p:e\"</code>\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u53ef\u4ee5\u63a5\u53d7\u7684\u77ed\u9009\u9879\u3002\u6bcf\u4e2a\u5b57\u7b26\u4ee3\u8868\u4e00\u4e2a\u9009\u9879\uff0c\u540e\u9762\u8ddf\u7740\u7684\u5192\u53f7<code>:</code>\u8868\u793a\u8be5\u9009\u9879\u662f\u5426\u9700\u8981\u4e00\u4e2a\u53c2\u6570\u3002</p> <ul> <li><code>b</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>b</code>\u7684\u9009\u9879\uff0c\u4e0d\u9700\u8981\u53c2\u6570\u3002</li> <li><code>h</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>h</code>\u7684\u9009\u9879\uff0c\u4e0d\u9700\u8981\u53c2\u6570\u3002</li> <li><code>l</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>l</code>\u7684\u9009\u9879\uff0c\u9700\u8981\u4e00\u4e2a\u53c2\u6570\uff08\u4f8b\u5982<code>-l filename</code>\uff09\u3002</li> <li><code>d</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>d</code>\u7684\u9009\u9879\uff0c\u9700\u8981\u4e00\u4e2a\u53c2\u6570\u3002</li> <li><code>p</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>p</code>\u7684\u9009\u9879\uff0c\u9700\u8981\u4e00\u4e2a\u53c2\u6570\u3002</li> <li><code>e</code>\uff1a\u8868\u793a\u6709\u4e00\u4e2a\u540d\u4e3a<code>e</code>\u7684\u9009\u9879\uff0c\u9700\u8981\u4e00\u4e2a\u53c2\u6570\u3002</li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_19","title":"\u4e3a\u4ec0\u4e48\u9009\u9879\u4e2d\u6709<code>:</code>\uff1f","text":"<p>\u5728<code>getopt</code>\u548c<code>getopt_long</code>\u4e2d\uff0c\u9009\u9879\u540e\u7684\u5355\u4e2a\u5192\u53f7<code>:</code>\u7528\u6765\u6307\u793a\u8be5\u9009\u9879\u9700\u8981\u4e00\u4e2a\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u9009\u9879<code>-p</code>\uff0c\u540e\u9762\u8ddf\u7740<code>:</code>\uff0c\u5219\u7528\u6237\u5fc5\u987b\u63d0\u4f9b<code>-p</code>\u9009\u9879\u7684\u53c2\u6570\uff0c\u5982<code>-p 1234</code>\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#optarg","title":"<code>optarg</code>\u7684\u4f7f\u7528","text":"<p><code>optarg</code>\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u6307\u5411\u5f53\u524d\u9009\u9879\u7684\u53c2\u6570\u5b57\u7b26\u4e32\u3002\u5f53\u89e3\u6790\u5230\u9700\u8981\u53c2\u6570\u7684\u9009\u9879\u65f6\uff0c<code>optarg</code>\u4f1a\u88ab\u8d4b\u503c\u4e3a\u8be5\u53c2\u6570\u7684\u5b57\u7b26\u4e32\u3002</p> <ul> <li>\u5bf9\u4e8e<code>case 'l'</code>\uff1a\u7528\u6237\u53ef\u80fd\u8f93\u5165<code>-l filename</code>\uff0c\u6b64\u65f6<code>log_file</code>\u53d8\u91cf\u5c06\u88ab\u8d4b\u503c\u4e3a<code>optarg</code>\uff0c\u5373<code>filename</code>\u3002</li> <li>\u5bf9\u4e8e<code>case 'p'</code>\uff1a\u7528\u6237\u53ef\u80fd\u8f93\u5165<code>-p 1234</code>\uff0c\u6b64\u65f6<code>sscanf(optarg, \"%d\", &amp;difftest_port);</code>\u5c06\u628a<code>optarg</code>\uff08\u5373\u5b57\u7b26\u4e32<code>\"1234\"</code>\uff09\u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u5e76\u8d4b\u503c\u7ed9<code>difftest_port</code>\u53d8\u91cf\u3002</li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_20","title":"\u4ee3\u7801\u5206\u6790","text":"<ul> <li><code>while</code>\u5faa\u73af\u4e0d\u65ad\u8c03\u7528<code>getopt_long</code>\uff0c\u76f4\u5230\u6ca1\u6709\u66f4\u591a\u7684\u9009\u9879\u3002</li> <li><code>switch</code>\u8bed\u53e5\u6839\u636e<code>getopt_long</code>\u8fd4\u56de\u7684\u5f53\u524d\u9009\u9879\u5b57\u7b26\u6765\u6267\u884c\u76f8\u5e94\u7684\u4ee3\u7801\u3002</li> <li><code>case 'b'</code>\uff1a\u5982\u679c\u7528\u6237\u8f93\u5165\u4e86<code>-b</code>\u9009\u9879\uff0c\u8c03\u7528<code>sdb_set_batch_mode()</code>\u51fd\u6570\u3002</li> <li><code>case 'p'</code>\uff1a\u5982\u679c\u7528\u6237\u8f93\u5165\u4e86<code>-p</code>\u9009\u9879\uff0c\u89e3\u6790<code>optarg</code>\u4e3a\u6574\u6570\uff0c\u5e76\u8d4b\u503c\u7ed9<code>difftest_port</code>\u3002</li> <li><code>case 'l'</code>\uff1a\u5982\u679c\u7528\u6237\u8f93\u5165\u4e86<code>-l</code>\u9009\u9879\uff0c\u5c06<code>optarg</code>\u8d4b\u503c\u7ed9<code>log_file</code>\u3002</li> <li><code>case 'd'</code>\uff1a\u5982\u679c\u7528\u6237\u8f93\u5165\u4e86<code>-d</code>\u9009\u9879\uff0c\u5c06<code>optarg</code>\u8d4b\u503c\u7ed9<code>diff_so_file</code>\u3002</li> <li><code>case 'e'</code>\uff1a\u5982\u679c\u7528\u6237\u8f93\u5165\u4e86<code>-e</code>\u9009\u9879\uff0c\u76ee\u524d\u6ca1\u6709\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\uff08<code>break</code>\uff09\u3002</li> <li><code>case 1</code>\uff1a\u8fd9\u901a\u5e38\u4e0d\u662f\u6807\u51c6\u7528\u6cd5\u3002\u53ef\u80fd\u7684\u610f\u56fe\u662f\u5904\u7406\u957f\u9009\u9879<code>img_file</code>\uff0c\u4f46\u8fd9\u4e0d\u662f<code>getopt_long</code>\u7684\u6807\u51c6\u8fd4\u56de\u503c\u3002\u901a\u5e38\uff0c\u957f\u9009\u9879\u7684\u7d22\u5f15+1\u88ab\u8fd4\u56de\uff0c\u800c\u4e0d\u662f1\u3002</li> <li><code>default</code>\uff1a\u5982\u679c\u6ca1\u6709\u5339\u914d\u7684\u9009\u9879\uff0c\u6253\u5370\u7528\u6cd5\u4fe1\u606f\u5e76\u9000\u51fa\u7a0b\u5e8f\u3002</li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_21","title":"\u6ce8\u610f","text":"<p>\u4ee3\u7801\u4e2d\u7684<code>case 1:</code>\u548c<code>case 'e':</code>\u53ef\u80fd\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u6f84\u6e05\u6216\u4fee\u6b63\u3002\u7279\u522b\u662f\uff0c<code>case 'e':</code>\u540e\u9762\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u64cd\u4f5c\uff0c\u8fd9\u53ef\u80fd\u610f\u5473\u7740\u4e0e<code>-e</code>\u76f8\u5173\u7684\u529f\u80fd\u5c1a\u672a\u5b9e\u73b0\uff0c\u6216\u8005\u4e0d\u9700\u8981\u4efb\u4f55\u53c2\u6570\u3002\u6b64\u5916\uff0c<code>case 1:</code>\u901a\u5e38\u4e0d\u662f<code>getopt_long</code>\u7684\u6807\u51c6\u7528\u6cd5\uff0c\u9664\u975e\u6709\u7279\u5b9a\u7684\u4e0a\u4e0b\u6587\u6216\u81ea\u5b9a\u4e49\u5904\u7406\u3002</p> <p>\u5e0c\u671b\u8fd9\u6709\u52a9\u4e8e\u4f60\u7406\u89e3<code>getopt_long</code>\u7684\u7528\u6cd5\u548c\u76f8\u5173\u7684\u547d\u4ee4\u884c\u53c2\u6570\u89e3\u6790\u673a\u5236\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#sh_link","title":"\u4e3a\u4ec0\u4e48<code>sh_link</code>\u53ef\u4ee5\u6307\u5411\u5b57\u7b26\u4e32\u8868\uff1f","text":"<ul> <li> <p>\u8bbe\u8ba1\u539f\u56e0\uff1aELF\u683c\u5f0f\u7684\u8bbe\u8ba1\u5141\u8bb8\u5c06\u7b26\u53f7\u540d\u79f0\u4e0e\u7b26\u53f7\u4fe1\u606f\u5206\u79bb\uff0c\u7b26\u53f7\u540d\u79f0\u5b58\u50a8\u5728\u5355\u72ec\u7684\u5b57\u7b26\u4e32\u8868\u4e2d\uff0c\u800c\u7b26\u53f7\u4fe1\u606f\u5b58\u50a8\u5728\u7b26\u53f7\u8868\u4e2d\u3002\u8fd9\u79cd\u5206\u79bb\u4f7f\u5f97\u7b26\u53f7\u540d\u79f0\u7684\u7ba1\u7406\u66f4\u52a0\u9ad8\u6548\uff0c\u7279\u522b\u662f\u5f53\u591a\u4e2a\u7b26\u53f7\u6709\u76f8\u540c\u7684\u540d\u79f0\u65f6\uff0c\u5b83\u4eec\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u540d\u79f0\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f\u5728\u6bcf\u4e2a\u7b26\u53f7\u6761\u76ee\u4e2d\u91cd\u590d\u5b58\u50a8\u3002</p> </li> <li> <p>\u5b9e\u73b0\u65b9\u5f0f\uff1a\u5f53\u89e3\u6790\u5668\u8bfb\u53d6\u7b26\u53f7\u8868\u7684\u5934\u90e8\u4fe1\u606f\u65f6\uff0c\u5b83\u4f1a\u67e5\u770b<code>sh_link</code>\u5b57\u6bb5\u3002\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u662f\u5b57\u7b26\u4e32\u8868\u5728\u6240\u6709section\u5934\u90e8\u4fe1\u606f\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\u3002\u901a\u8fc7\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\uff0c\u89e3\u6790\u5668\u53ef\u4ee5\u5728section\u5934\u90e8\u4fe1\u606f\u6570\u7ec4\u4e2d\u627e\u5230\u6b63\u786e\u7684\u5b57\u7b26\u4e32\u8868\u5934\u90e8\uff0c\u8fdb\u800c\u8bfb\u53d6\u5305\u542b\u6240\u6709\u7b26\u53f7\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u8868\u3002</p> </li> <li> <p>\u4f7f\u7528\u573a\u666f\uff1a\u5f53\u89e3\u6790\u5668\u9700\u8981\u6253\u5370\u6216\u663e\u793a\u7b26\u53f7\u4fe1\u606f\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528\u6bcf\u4e2a\u7b26\u53f7\u6761\u76ee\u4e2d\u7684<code>st_name</code>\u504f\u79fb\u91cf\u6765\u4ece\u5b57\u7b26\u4e32\u8868\u4e2d\u83b7\u53d6\u7b26\u53f7\u7684\u540d\u79f0\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_22","title":"\u793a\u4f8b\uff1a","text":"<p>\u5047\u8bbe\u4f60\u5df2\u7ecf\u8bfb\u53d6\u4e86ELF\u6587\u4ef6\u7684\u8282\u5934\u8868\uff0c\u5e76\u4e14\u5b9a\u4f4d\u5230\u4e86\u7b26\u53f7\u8868\u7684\u5934\u90e8\u4fe1\u606f\u3002\u8981\u83b7\u53d6\u7b26\u53f7\u540d\u79f0\uff0c\u4f60\u9700\u8981\uff1a</p> <ol> <li> <p>\u4ece\u7b26\u53f7\u8868\u5934\u90e8\u4fe1\u606f\uff08<code>sh_tab[symtab_index]</code>\uff09\u4e2d\u8bfb\u53d6<code>sh_link</code>\u5b57\u6bb5\uff0c\u5f97\u5230\u5b57\u7b26\u4e32\u8868\u7684\u7d22\u5f15\u3002</p> </li> <li> <p>\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\u6765\u83b7\u53d6\u5b57\u7b26\u4e32\u8868\u7684\u5934\u90e8\u4fe1\u606f\u3002</p> </li> <li> <p>\u904d\u5386\u7b26\u53f7\u8868\uff0c\u4f7f\u7528\u6bcf\u4e2a\u7b26\u53f7\u7684<code>st_name</code>\u4f5c\u4e3a\u504f\u79fb\u91cf\uff0c\u4ece\u5b57\u7b26\u4e32\u8868\u4e2d\u83b7\u53d6\u7b26\u53f7\u540d\u79f0\u3002</p> </li> </ol> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48<code>sh_link</code>\u5b57\u6bb5\u53ef\u4ee5\u7528\u4e8e\u6307\u5411\u5b57\u7b26\u4e32\u8868\uff0c\u5e76\u5728\u89e3\u6790ELF\u6587\u4ef6\u65f6\u7528\u4e8e\u83b7\u53d6\u7b26\u53f7\u540d\u79f0\u7684\u539f\u56e0\u3002\u8fd9\u79cd\u8bbe\u8ba1\u662fELF\u683c\u5f0f\u89c4\u8303\u7684\u4e00\u90e8\u5206\uff0c\u65e8\u5728\u63d0\u4f9b\u4e00\u79cd\u9ad8\u6548\u4e14\u6807\u51c6\u5316\u7684\u65b9\u5f0f\u6765\u7ba1\u7406\u7a0b\u5e8f\u4e2d\u7684\u7b26\u53f7\u548c\u5b83\u4eec\u7684\u540d\u79f0\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#am_2","title":"AM\u4f5c\u4e3a\u57fa\u7840\u8bbe\u65bd","text":"<p>\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\u662f, \u6211\u4eec\u771f\u7684\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u628a\u8f6f\u4ef6\u79fb\u690d\u5230\u5176\u5b83\u786c\u4ef6\u4e0a\u8fdb\u884c\u6d4b\u8bd5\u5417? \u806a\u660e\u7684\u4f60\u5e94\u8be5\u60f3\u8d77\u6765AM\u7684\u6838\u5fc3\u601d\u60f3\u4e86: \u901a\u8fc7\u4e00\u7ec4\u62bd\u8c61\u7684API\u628a\u7a0b\u5e8f\u548c\u67b6\u6784\u89e3\u8026. AM\u7684\u601d\u60f3\u4fdd\u8bc1\u4e86\u8fd0\u884c\u5728AM\u4e4b\u4e0a\u7684\u4ee3\u7801(\u5305\u62ecklib)\u90fd\u662f\u67b6\u6784\u65e0\u5173\u7684, \u8fd9\u6070\u6070\u589e\u52a0\u4e86\u4ee3\u7801\u7684\u53ef\u79fb\u690d\u6027. </p> <p>\u60f3\u8c61\u4e00\u4e0b, \u5982\u679c<code>string.c</code>\u7684\u4ee3\u7801\u4e2d\u6709\u4e00\u6761\u53ea\u80fd\u5728NEMU\u4e2d\u6267\u884c\u7684<code>nemu_trap</code>\u6307\u4ee4, \u90a3\u4e48\u5b83\u5c31\u65e0\u6cd5\u5728\u771f\u673a\u4e0a\u8fd0\u884c.</p> <p><code>abstract-machine</code>\u4e2d\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u67b6\u6784\u53eb<code>native</code>, \u662f\u7528GNU/Linux\u9ed8\u8ba4\u7684\u8fd0\u884c\u65f6\u73af\u5883\u6765\u5b9e\u73b0\u7684AM API. \u4f8b\u5982\u6211\u4eec\u901a\u8fc7<code>gcc hello.c</code>\u7f16\u8bd1\u7a0b\u5e8f\u65f6, \u5c31\u4f1a\u7f16\u8bd1\u5230GNU/Linux\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u73af\u5883; \u4f60\u5728PA1\u8bd5\u73a9\u7684\u8d85\u7ea7\u739b\u4e3d, \u4e5f\u662f\u7f16\u8bd1\u5230<code>native</code>\u4e0a\u5e76\u8fd0\u884c. \u548c<code>$ISA-nemu</code>\u76f8\u6bd4, <code>native</code>\u6709\u5982\u4e0b\u597d\u5904:</p> <ul> <li>\u76f4\u63a5\u8fd0\u884c\u5728\u771f\u673a\u4e0a, \u53ef\u4ee5\u76f8\u4fe1\u771f\u673a\u7684\u884c\u4e3a\u6c38\u8fdc\u662f\u5bf9\u7684</li> <li>\u5c31\u7b97\u8f6f\u4ef6\u6709bug, \u5728<code>native</code>\u4e0a\u8c03\u8bd5\u4e5f\u6bd4\u8f83\u65b9\u4fbf(\u4f8b\u5982\u53ef\u4ee5\u4f7f\u7528GDB, \u6bd4NEMU\u7684monitor\u65b9\u4fbf\u5f88\u591a)</li> </ul> <p>\u56e0\u6b64, \u4e0e\u5176\u5728<code>$ISA-nemu</code>\u4e2d\u76f4\u63a5\u8c03\u8bd5\u8f6f\u4ef6, \u8fd8\u4e0d\u5982\u5728<code>native</code>\u4e0a\u628a\u8f6f\u4ef6\u8c03\u5bf9, \u7136\u540e\u518d\u6362\u5230<code>$ISA-nemu</code>\u4e2d\u8fd0\u884c, \u6765\u5bf9NEMU\u8fdb\u884c\u6d4b\u8bd5. \u5728<code>abstract-machine</code>\u4e2d, \u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u628a\u7a0b\u5e8f\u7f16\u8bd1\u5230\u53e6\u4e00\u4e2a\u67b6\u6784\u4e0a\u8fd0\u884c, \u4f8b\u5982\u5728<code>am-kernels/tests/cpu-tests/</code>\u76ee\u5f55\u4e0b\u6267\u884c</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u751f\u6210native\u7684\u53ef\u6267\u884c\u6587\u4ef6</p> <p>\u9605\u8bfb\u76f8\u5173Makefile, \u5c1d\u8bd5\u7406\u89e3 <code>abstract-machine</code> \u662f\u5982\u4f55\u751f\u6210<code>native</code>\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684.</p> <p>\u600e\u4e48\u5c06make\u00a0-nB\u00a0\u8f93\u51fa\u7684\u5185\u5bb9\u91cd\u65b0\u6392\u597d\u5e8f\uff0c\u770b\u770bysyx\u7684am\u6846\u67b6\u7684\u5185\u5bb9</p> <pre><code>make ARCH=riscv32-nemu -nB | sort | less\nmake ARCH=native -nB | sort | less\n</code></pre> <ol> <li> <p>\u6839\u636e\u4e4b\u524d AM \u7684 <code>Makefile</code> \u5206\u6790\u53ef\u5f97\u3002\u4ee5\u9876\u5c42\u7684Makefile\u4e3a\u4e3b</p> <p>\u73af\u5883\u53d8\u91cf <code>$ARCH</code> \u7684\u8bbe\u7f6e\uff0c\u7528\u6237\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c <code>make ARCH=native</code>\u3002</p> </li> <li> <p>\u9996\u5148\u662f\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5f97\u662fnative\u5e73\u53f0\u7684\u5de5\u5177\u3002</p> <p>Makefile \u4e2d\u6709\u4e00\u4e2a\u53d8\u91cf <code>CROSS_COMPILE</code>\uff0c\u5728 native \u4e0b\u8fd0\u884c\u7684\u65f6\u5019\u8fd9\u4e2a\u53d8\u91cf\u6ca1\u6709\u8d4b\u503c\uff0c\u6240\u4ee5 Makefile \u4e0d\u4f1a\u4f7f\u7528\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u7f16\u8bd1\u4ee3\u7801\uff0c\u800c\u662f\u7528 native \u7684 gcc \u548c binutils\u3002</p> </li> <li> <p>\u7136\u540e\u5305\u542b\u7279\u5b9a\u5e73\u53f0\u7684Makefile\uff0c<code>abstract-machine/scripts/native.mk</code>\uff0c\u63d0\u4f9b\u672c\u5e73\u53f0\u7684\u5b9e\u73b0\u7684 trm + ioe + cte + vme + mpe + trap.s + ....</p> </li> <li> <p>\u7136\u540e\u8fdb\u4e00\u6b65\u8bbe\u7f6e\u901a\u7528\u76f8\u5173\u6807\u5fd7\u548c\u53d8\u91cf\u548c\u7f16\u8bd1\u6807\u5fd7\uff0c\u5982\uff0c\u5de5\u4f5c\u76ee\u5f55\u3001\u5b58\u653e\u7ed3\u679c\u7684\u76ee\u5f55\u3001\u8981\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u5217\u8868\u3001OBJS\u3001LIBS\u3001\u7528\u54ea\u4e2a\u7f16\u8bd1\u5668\u3001\u5305\u542b\u5bf9\u5e94\u5e73\u53f0\u7684\u7684\u5934\u6587\u4ef6 <code>am/include/arch/native.h</code> \u7b49\u7b49\u3002</p> <p>\u8fd9\u91cc\u8981\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u5217\u8868\u7531 AM \u4e0b\u7684 <code>Makefile</code> \u548c\u5bf9\u5e94\u6d4b\u8bd5\u76ee\u5f55\u4e0b\u7684Makefile\u7ed9\u51fa\u3002</p> <p>\u6d41\u7a0b\u548c\u4e4b\u524dPA2.2\u7684AM RTFSC \u5185\u5bb9\u6846\u67b6\u7c7b\u4f3c\u3002</p> <pre><code>NAME     := am\nSRCS      = $(addprefix src/, $(AM_SRCS))\nINC_PATH += $(AM_HOME)/am/src\n\ninclude $(AM_HOME)/Makefile\n\n//abstract-machine/am/Makefile\n</code></pre> <pre><code>NAME = amtest                               \nSRCS = $(shell find src/ -name \"*.[cS]\")                          \ninclude $(AM_HOME)/Makefile    \n\nam-kernels/tests/am-tests/\n// \u968f\u4fbf\u627e\u4e86\u4e2a\uff0c\u5176\u4ed6\u90fd\u5dee\u4e0d\u591a\n</code></pre> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u5f88\u5173\u952e\u7684\u8fd9\u91cc\uff1a</p> <pre><code>ARCH_H := arch/$(ARCH).h\nCFLAGS   += -O2 -MMD -Wall -Werror $(INCFLAGS) \\\n            -D__ISA__=\\\"$(ISA)\\\" -D__ISA_$(shell echo $(ISA) | tr a-z A-Z)__ \\\n            -D__ARCH__=$(ARCH) -D__ARCH_$(shell echo $(ARCH) | tr a-z A-Z | tr - _) \\\n            -D__PLATFORM__=$(PLATFORM) -D__PLATFORM_$(shell echo $(PLATFORM) | tr a-z A-Z | tr - _) \\\n            -DARCH_H=\\\"$(ARCH_H)\\\" \\\n            -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector \\\n            -Wno-main -U_FORTIFY_SOURCE -fvisibility=hidden\nCXXFLAGS +=  $(CFLAGS) -ffreestanding -fno-rtti -fno-exceptions\nASFLAGS  += -MMD $(INCFLAGS)\nLDFLAGS  += -z noexecstack\n\n//abstract-machine/Makefile\n</code></pre> <p>\u8be6\u7ec6\u770b\u770bCFLAGS\u8fd9\u4e48\u4e00\u5927\u5806\u7684\u4e1c\u897f\u662f\u5e72\u4ec0\u4e48\u7684\u3002</p> <p>\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c<code>CFLAGS</code> \u662f\u7528\u4e8e\u8bbe\u7f6e C \u7f16\u8bd1\u5668\u7684\u884c\u4e3a\u548c\u9009\u9879\u7684\u73af\u5883\u53d8\u91cf\u3002\u8fd9\u4e9b\u9009\u9879\u63a7\u5236\u7f16\u8bd1\u5668\u5982\u4f55\u7f16\u8bd1\u6e90\u4ee3\u7801\u3002\u4e0b\u9762\u662f\u5bf9\u8fd9\u4e9b\u9009\u9879\u7684\u89e3\u91ca\uff1a</p> <ol> <li> <p><code>-O2</code>\uff1a\u4f18\u5316\u7ea7\u522b\uff0c<code>-O2</code> \u8868\u793a\u7f16\u8bd1\u5668\u4f1a\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u7684\u8fd0\u884c\u6548\u7387\uff0c\u4f46\u4e0d\u4f1a\u727a\u7272\u8fc7\u591a\u7684\u7f16\u8bd1\u65f6\u95f4\u3002</p> </li> <li> <p><code>-MMD</code>\uff1a\u751f\u6210\u4f9d\u8d56\u6587\u4ef6\uff0c\u8fd9\u4f1a\u544a\u8bc9\u7f16\u8bd1\u5668\u751f\u6210\u4e00\u4e2a\u5305\u542b\u6240\u6709\u5934\u6587\u4ef6\u4f9d\u8d56\u7684 <code>.d</code> \u6587\u4ef6\u3002</p> </li> <li> <p><code>-Wall</code>\uff1a\u6253\u5f00\u51e0\u4e4e\u6240\u6709\u7684\u8b66\u544a\u4fe1\u606f\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u53d1\u73b0\u6f5c\u5728\u7684\u95ee\u9898\u3002</p> </li> <li> <p><code>-Werror</code>\uff1a\u5c06\u6240\u6709\u8b66\u544a\u5f53\u4f5c\u9519\u8bef\u6765\u5904\u7406\u3002</p> </li> <li> <p><code>(INCFLAGS)</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u901a\u5e38\u5305\u542b\u7f16\u8bd1\u5668\u7684\u5305\u542b\u8def\u5f84\uff08<code>-I</code>\uff09\u9009\u9879\u3002</p> </li> <li> <p><code>-D__ISA__=\\\"$(ISA)\\\"</code>\uff1a\u5b9a\u4e49\u5b8f <code>__ISA__</code>\uff0c\u5e76\u5c06 <code>$(ISA)</code> \u7684\u503c\u4f5c\u4e3a\u5b57\u7b26\u4e32\u53c2\u6570\u4f20\u9012\u3002</p> </li> <li> <p><code>-D__ISA_$(shell echo $(ISA) | tr a-z A-Z)__</code>\uff1a\u5b9a\u4e49\u5b8f <code>__ISA_</code> \u540e\u9762\u8ddf\u7740 <code>$(ISA)</code> \u53d8\u91cf\u503c\u7684\u5927\u5199\u5f62\u5f0f\u3002</p> </li> <li> <p><code>-D__ARCH__=$(ARCH)</code> \u548c <code>-D__ARCH_$(shell echo $(ARCH) | tr a-z A-Z | tr - _)</code>\uff1a\u7c7b\u4f3c\u5730\uff0c\u5b9a\u4e49 <code>__ARCH__</code> \u548c <code>__ARCH_</code> \u5b8f\uff0c\u5206\u522b\u4ee5\u539f\u6837\u548c\u5927\u5199\u5f62\u5f0f\u3002</p> </li> <li> <p><code>-D__PLATFORM__=$(PLATFORM)</code> \u548c <code>-D__PLATFORM_$(shell echo $(PLATFORM) | tr a-z A-Z | tr - _)</code>\uff1a\u5b9a\u4e49 <code>__PLATFORM__</code> \u548c <code>__PLATFORM_</code> \u5b8f\uff0c\u540c\u6837\u4ee5\u539f\u6837\u548c\u5927\u5199\u5f62\u5f0f\u3002</p> </li> <li> <p><code>-DARCH_H=\\\"$(ARCH_H)\\\"</code>\uff1a\u5b9a\u4e49 <code>ARCH_H</code> \u5b8f\uff0c\u5e76\u5c06 <code>$(ARCH_H)</code> \u7684\u503c\u4f5c\u4e3a\u5b57\u7b26\u4e32\u53c2\u6570\u4f20\u9012\u3002</p> </li> <li> <p><code>-fno-asynchronous-unwind-tables</code>\uff1a\u7981\u7528\u5f02\u6b65\u5c55\u5f00\u8868\u7684\u751f\u6210\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u7a0b\u5e8f\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>-fno-builtin</code>\uff1a\u544a\u8bc9\u7f16\u8bd1\u5668\u4e0d\u8981\u4f7f\u7528\u5185\u7f6e\u51fd\u6570\u3002</p> </li> <li> <p><code>-fno-stack-protector</code>\uff1a\u7981\u7528\u6808\u4fdd\u62a4\u3002</p> </li> <li> <p><code>-Wno-main</code>\uff1a\u7981\u7528\u5bf9 <code>main</code> \u51fd\u6570\u7684\u8b66\u544a\u3002</p> </li> <li> <p><code>-U_FORTIFY_SOURCE</code>\uff1a\u53d6\u6d88\u5b9a\u4e49\u5b8f <code>_FORTIFY_SOURCE</code>\uff0c\u8fd9\u4e2a\u5b8f\u901a\u5e38\u7528\u4e8e\u52a0\u5f3a\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u3002</p> </li> <li> <p><code>-fvisibility=hidden</code>\uff1a\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u7b26\u53f7\u53ef\u89c1\u6027\u4e3a\u9690\u85cf\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c\u672a\u660e\u786e\u6307\u5b9a\uff0c\u6240\u6709\u7b26\u53f7\u90fd\u4e0d\u4f1a\u88ab\u5bfc\u51fa\u3002</p> </li> </ol> <p><code>CXXFLAGS</code> \u5305\u542b\u4e86 <code>CFLAGS</code> \u7684\u6240\u6709\u9009\u9879\uff0c\u5e76\u6dfb\u52a0\u4e86\u9488\u5bf9 C++ \u7f16\u8bd1\u5668\u7684\u7279\u5b9a\u9009\u9879\uff1a</p> <ul> <li> <p><code>-ffreestanding</code>\uff1a\u544a\u8bc9\u7f16\u8bd1\u5668\u6b63\u5728\u7f16\u8bd1\u7684\u7a0b\u5e8f\u4e0d\u4f9d\u8d56\u4e8e\u4e3b\u673a\u7cfb\u7edf\u7684\u6807\u51c6 C \u5e93\u3002</p> </li> <li> <p><code>-fno-rtti</code>\uff1a\u7981\u7528\u8fd0\u884c\u65f6\u7c7b\u578b\u4fe1\u606f\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u7a0b\u5e8f\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>-fno-exceptions</code>\uff1a\u7981\u7528\u5f02\u5e38\u5904\u7406\u3002</p> </li> </ul> <p><code>ASFLAGS</code> \u5305\u542b\u4e86 <code>-MMD</code> \u548c <code>INCFLAGS</code>\uff0c\u7528\u4e8e\u6c47\u7f16\u5668\u3002</p> <p><code>LDFLAGS</code> \u5305\u542b\u4e86 <code>-z noexecstack</code>\uff0c\u8fd9\u662f\u4e00\u4e2a\u94fe\u63a5\u5668\u9009\u9879\uff0c\u7528\u4e8e\u6807\u8bb0\u6808\u4e0d\u53ef\u6267\u884c\uff0c\u8fd9\u53ef\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u3002</p> <p>\u8fd9\u4e9b\u9009\u9879\u901a\u5e38\u7528\u4e8e\u63a7\u5236\u7f16\u8bd1\u5668\u7684\u884c\u4e3a\uff0c\u4f18\u5316\u7a0b\u5e8f\u6027\u80fd\uff0c\u589e\u5f3a\u5b89\u5168\u6027\uff0c\u4ee5\u53ca\u5b9a\u4e49\u5b8f\u4ee5\u4f9b\u4ee3\u7801\u4e2d\u4f7f\u7528\u3002</p> <p>gcc\u8fd9\u79cd\u7f16\u8bd1\u9009\u9879\u7684\u64cd\u4f5c\u8fd8\u662f\u633a\u591a\u7684\u3002</p> <p>\u8fd9\u91cc\u5e94\u8be5\u770b\u770b\u76f8\u5173\u7684\u6587\u6863\u7684\uff1agcc\u7684\u8fd9\u79cd\u7f16\u8bd1\u9009\u9879\u547d\u540d\u4e5f\u662f\u5947\u5947\u602a\u602a\u7684</p> <p></p> <p>GCC \u7f16\u8bd1\u5668\u7684\u547d\u4ee4\u9009\u9879\u901a\u5e38\u9075\u5faa\u4e00\u5b9a\u7684\u547d\u540d\u89c4\u5219\uff0c\u8fd9\u4e9b\u89c4\u5219\u6709\u52a9\u4e8e\u7528\u6237\u7406\u89e3\u6bcf\u4e2a\u9009\u9879\u7684\u4f5c\u7528\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u547d\u540d\u89c4\u5219\u53ca\u5176\u542b\u4e49\uff1a</p> <ol> <li><code>-f</code>\uff1a\u8fd9\u4e2a\u524d\u7f00\u901a\u5e38\u7528\u4e8e\u8868\u793a\u201cflavor\u201d\uff08\u98ce\u5473\uff09\u6216\u201cflag\u201d\uff08\u6807\u5fd7\uff09\uff0c\u610f\u5473\u7740\u8fd9\u4e9b\u9009\u9879\u7528\u6765\u8bbe\u7f6e\u7f16\u8bd1\u5668\u7684\u884c\u4e3a\u6216\u7279\u6027\u3002\u4f8b\u5982\uff0c<code>-fPIC</code> \u8868\u793a\u751f\u6210\u4e0e\u4f4d\u7f6e\u65e0\u5173\u7684\u4ee3\u7801\uff0c\u9002\u7528\u4e8e\u751f\u6210\u5171\u4eab\u5e93\u3002</li> <li><code>-W</code>\uff1a\u8fd9\u4e2a\u524d\u7f00\u4ee3\u8868\u201cwarning\u201d\uff08\u8b66\u544a\uff09\uff0c\u8fd9\u4e9b\u9009\u9879\u7528\u6765\u63a7\u5236\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u53d1\u51fa\u7684\u8b66\u544a\u4fe1\u606f\u3002\u4f8b\u5982\uff0c<code>-Wall</code> \u9009\u9879\u7528\u6765\u6253\u5f00\u51e0\u4e4e\u6240\u6709\u7684\u8b66\u544a\u4fe1\u606f\u3002</li> <li><code>-D</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u7528\u4e8e\u5b9a\u4e49\u5b8f\u3002\u5b83\u544a\u8bc9\u7f16\u8bd1\u5668\u5728\u9884\u5904\u7406\u9636\u6bb5\u5b9a\u4e49\u4e00\u4e2a\u5b8f\u3002\u4f8b\u5982\uff0c<code>-DDEBUG</code> \u4f1a\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a <code>DEBUG</code> \u7684\u5b8f\u3002</li> </ol> </li> <li> <p>\u7136\u540e\u6839\u636e\u7f16\u8bd1\u89c4\u5219\u7f16\u8bd1\u6bcf\u4e2a\u6587\u4ef6\uff0c\u751f\u6210\u5bf9\u8c61\u6587\u4ef6\uff08<code>.o</code>\uff09\u3002</p> <pre><code>### Rule (compile): a single `.c` -&gt; `.o` (gcc)\n$(DST_DIR)/%.o: %.c\n    @mkdir -p $(dir $@) &amp;&amp; echo + CC $&lt;\n    @$(CC) -std=gnu11 $(CFLAGS) -c -o $@ $(realpath $&lt;)\n...\n</code></pre> <p>\u4e3b\u8981\u662f\u6d4b\u8bd5\u91cc\u9762 hello.o \u3001main.o \u4e4b\u7c7b\u7684\u3002</p> </li> <li> <p>\u94fe\u63a5\u5668\u5c06\u6240\u6709\u5bf9\u8c61\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u751f\u6210\u6700\u7ec8\u7684ELF\u4e8c\u8fdb\u5236\u6587\u4ef6\uff08<code>IMAGE.elf</code>\uff09\u3002</p> <pre><code>### Rule (link): objects (`*.o`) and libraries (`*.a`) -&gt; `IMAGE.elf`, the final ELF binary to be pac    ked into image (ld)\n$(IMAGE).elf: $(OBJS) $(LIBS)\n    @echo + LD \"-&gt;\" $(IMAGE_REL).elf\n    @$(LD) $(LDFLAGS) -o $(IMAGE).elf --start-group $(LINKAGE) --end-group\n</code></pre> </li> </ol> </li> <li> <p>\u601d\u8003\u9898</p> <pre><code>make ALL=string ARCH=native run\n</code></pre> <p>\u5373\u53ef\u5c06<code>string</code>\u7a0b\u5e8f\u7f16\u8bd1\u5230<code>native</code>\u5e76\u8fd0\u884c. \u7531\u4e8e\u6211\u4eec\u4f1a\u5c06\u7a0b\u5e8f\u7f16\u8bd1\u5230\u4e0d\u540c\u7684\u67b6\u6784\u4e2d, \u56e0\u6b64\u4f60\u9700\u8981\u6ce8\u610f<code>make</code>\u547d\u4ee4\u4e2d\u7684<code>ARCH</code>\u53c2\u6570. \u5982\u679c<code>string</code>\u7a0b\u5e8f\u6ca1\u6709\u901a\u8fc7\u6d4b\u8bd5, \u7ec8\u7aef\u5c06\u4f1a\u8f93\u51fa</p> <pre><code>make[1]: *** [run] Error 1 \n</code></pre> <p>\u5947\u602a\u7684\u9519\u8bef\u7801</p> <p>\u4e3a\u4ec0\u4e48\u9519\u8bef\u7801\u662f<code>1</code>\u5462? \u4f60\u77e5\u9053<code>make</code>\u7a0b\u5e8f\u662f\u5982\u4f55\u5f97\u5230\u8fd9\u4e2a\u9519\u8bef\u7801\u7684\u5417?</p> <p>LLM:</p> <p>\u5bf9\u4e8e\u9519\u8bef\u7801<code>1</code>\uff0c\u8fd9\u901a\u5e38\u662f\u4e00\u4e2a\u901a\u7528\u7684\u9519\u8bef\u7801\uff0c\u8868\u793a\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u4f46\u5e76\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u9519\u8bef\u539f\u56e0\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9519\u8bef\u7801<code>1</code>\u662f\u4e00\u4e2a\u901a\u7528\u7684\u5931\u8d25\u6307\u793a\uff0c\u53ef\u80fd\u7531\u591a\u79cd\u539f\u56e0\u5f15\u8d77\uff0c\u4f8b\u5982\u8bed\u6cd5\u9519\u8bef\u3001\u8d44\u6e90\u4e0d\u8db3\u3001\u6743\u9650\u95ee\u9898\u7b49\u3002</p> <p>\u5728<code>make</code>\u7a0b\u5e8f\u4e2d\uff0c\u9519\u8bef\u7801\u7684\u4f20\u9012\u673a\u5236\u5982\u4e0b\uff1a</p> <ol> <li><code>make</code>\u6267\u884cMakefile\u4e2d\u7684\u547d\u4ee4\u3002</li> <li>\u5982\u679c\u547d\u4ee4\u6210\u529f\u6267\u884c\uff0c\u5b83\u4f1a\u8fd4\u56de<code>0</code>\uff08\u8868\u793a\u6210\u529f\uff09\u3002</li> <li>\u5982\u679c\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u7684\u9519\u8bef\u7801\u3002</li> <li><code>make</code>\u6355\u83b7\u8fd9\u4e2a\u9519\u8bef\u7801\uff0c\u5e76\u6839\u636e\u9519\u8bef\u7801\u6765\u51b3\u5b9a\u662f\u5426\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u547d\u4ee4\u6216\u505c\u6b62\u6784\u5efa\u8fc7\u7a0b\u3002</li> </ol> <p>\u5728<code>make[1]: *** [run] Error 1</code>\u8fd9\u6761\u9519\u8bef\u4fe1\u606f\u4e2d\uff0c<code>make[1]</code>\u8868\u793a\u8fd9\u662f<code>make</code>\u7684\u7b2c\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c<code>[run]</code>\u662f\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u76ee\u6807\uff0c\u800c<code>Error 1</code>\u8868\u793a\u8be5\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u5e76\u8fd4\u56de\u4e86\u9519\u8bef\u7801<code>1</code>\u3002</p> <p>\u770b\u770b <code>GNU make</code> \u624b\u518c\u548c shell \u9519\u8bef\u7801</p> <p></p> <p></p> <p>\u624b\u518c\u8bf4\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u95ee\u9898\u4e0d\u662f\u6765\u81eamake\uff0c\u662f\u7a0b\u5e8f\u51fa\u4e86\u95ee\u9898\uff0c\u6240\u4ee5\u5e94\u8be5\u770b\u770bshell\u7684\u9519\u8bef\u7801\uff08RTFW\u5373\u53ef\uff09</p> <p>Exit Codes With Special Meanings (die.net)</p> <pre><code>Exit code 0        Success\nExit code 1        General errors, Miscellaneous errors, such as \"divide by zero\" and other impermissible operations\nExit code 2        Misuse of shell builtins (according to Bash documentation)        Example: empty_function() {}\n</code></pre> </li> </ul> <p>\u6ce8\u610f\uff1a</p> <p>\u6846\u67b6\u4ee3\u7801\u7f16\u8bd1\u5230<code>native</code>\u7684\u65f6\u5019\u9ed8\u8ba4\u94fe\u63a5\u5230glibc\uff0c\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e9b\u5e93\u51fd\u6570\u7684\u8c03\u7528\u94fe\u63a5\u5230\u6211\u4eec\u7f16\u5199\u7684klib\u6765\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <p>\u4ee5\u901a\u8fc7\u5728<code>abstract-machine/klib/include/klib.h</code> \u4e2d\u901a\u8fc7\u5b9a\u4e49\u5b8f<code>__NATIVE_USE_KLIB__</code>\u6765\u628a\u5e93\u51fd\u6570\u94fe\u63a5\u5230klib. \u5982\u679c\u4e0d\u5b9a\u4e49\u8fd9\u4e2a\u5b8f, \u5e93\u51fd\u6570\u5c06\u4f1a\u94fe\u63a5\u5230glibc, \u53ef\u4ee5\u4f5c\u4e3a\u6b63\u786e\u7684\u53c2\u8003\u5b9e\u73b0\u6765\u8fdb\u884c\u5bf9\u6bd4.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e0a\u9762\u7684\u5185\u5bb9\u662f\u5982\u4f55\u5b9e\u73b0\u7684?</p> <p>\u4e3a\u4ec0\u4e48\u5b9a\u4e49\u5b8f<code>__NATIVE_USE_KLIB__</code>\u4e4b\u540e\u5c31\u53ef\u4ee5\u628a<code>native</code>\u4e0a\u7684\u8fd9\u4e9b\u5e93\u51fd\u6570\u94fe\u63a5\u5230klib? \u8fd9\u5177\u4f53\u662f\u5982\u4f55\u53d1\u751f\u7684? \u5c1d\u8bd5\u6839\u636e\u4f60\u5728\u8bfe\u5802\u4e0a\u5b66\u4e60\u7684\u94fe\u63a5\u76f8\u5173\u7684\u77e5\u8bc6\u89e3\u91ca\u8fd9\u4e00\u73b0\u8c61.</p> <p>\u6ca1\u6709\u5565\u601d\u8def\uff0c\u5148\u6839\u636e\u4ee5\u524d\u770bFreeRTOS\u6e90\u7801\u7684\u65f6\u5019\u7ecf\u9a8c\u63a8\u65ad\u4e00\u4e0b\u3002\u662f\u4e0d\u662f\u7528\u6761\u4ef6\u7f16\u8bd1\u3001\u5b8f\u5f00\u5173\u4e4b\u7c7b\u7684\u4e1c\u897f\uff1f</p> <p>\u5bf9\u4e8e\u91cc\u9762\u7684klib\u5b9e\u73b0\uff0c\u786e\u5b9e\u662f\u6709\uff1a\u5b8f\u5f00\u5173\u7684\uff1a</p> <p><code>#if !defined(__ISA_NATIVE__) || defined(__NATIVE_USE_KLIB__)</code></p> <p>\u4f46\u662f\u600e\u4e48\u5c06\u8fd9\u4e2a\u5b8f\u548c\u662f\u5426\u94fe\u63a5\u5230\u5e93\u51fd\u6570\u8054\u7cfb\u8d77\u6765\uff1f</p> <p>\u597d\u50cf\u5176\u5b9e\u5f88\u7b80\u5355\uff1f\u6211\u6ca1\u6709\u4f7f\u7528\u6807\u51c6\u5e93\u7684\u5934\u6587\u4ef6\uff08\u6ca1\u6709\u5199 <code>#include &lt;stdio.h&gt;</code>\uff09\uff0c\u90a3\u94fe\u63a5\u7684\u65f6\u5019\u80af\u5b9a\u662f\u4f7f\u7528\u7528\u6237\u81ea\u5df1\u624b\u5199\u7684\u51fd\u6570\u3002</p> <p>\u5f53\u624b\u5199\u51fd\u6570\u4e0e glibc \u5e93\u51fd\u6570\u540d\u79f0\u51b2\u7a81\u65f6\uff0c\u4f18\u5148\u94fe\u63a5\u7528\u6237\u624b\u5199\u7684\u51fd\u6570\uff0c\u8fd9\u6837\u5c31\u8fbe\u5230\u4e86\u4f7f\u7528 klib \u7684\u6548\u679c\u3002</p> <pre><code>void  *memmove   (void *dst, const void *src, size_t n);\nint    memcmp    (const void *s1, const void *s2, size_t n);\nsize_t strlen    (const char *s);\nchar  *strcat    (char *dst, const char *src);\nchar  *strcpy    (char *dst, const char *src);\nchar  *strncpy   (char *dst, const char *src, size_t n);\nint    strcmp    (const char *s1, const char *s2);\nint    strncmp   (const char *s1, const char *s2, size_t n);\n\n// stdlib.h\nvoid   srand     (unsigned int seed);\nint    rand      (void);\nvoid  *malloc    (size_t size);\n...\nNORMAL  abstract-machine/klib/include/klib.h  \n</code></pre> <p>\u5f88\u57fa\u7840\u7684\u95ee\u9898\u5440\uff0c\u6211\u8c03\u7528\u7684\u8fd9\u4e2a\u51fd\u6570\uff0c\u8981\u4e48\u6709\u58f0\u660e\u548c\u51fd\u6570\u4f53\uff0c\u8981\u4e48\u5728\u94fe\u63a5\u7684\u9636\u6bb5\u80fd\u627e\u5230\u5e93\u6587\u4ef6\uff0c\u627e\u4e0d\u5230\u5c31\u62a5\u9519\uff0c\u627e\u5230\u54ea\u4e2a\u5c31\u7528\u54ea\u4e2a\uff0c\u54ea\u91cc\u7ba1\u662f\u4e0d\u662f\u6807\u51c6\u5e93\u91cc\u7684\u3002\u4e00\u65f6\u95f4\u8111\u888b\u6ca1\u8f6c\u8fc7\u6765\u3002</p> <p>\u53e6\u5916\uff1acc \u7f16\u8bd1\u65f6 \u4f7f\u7528 -fno-builtin \u9009\u9879\u5c31\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7f16\u5199\u7684\u5e93\u51fd\u6570\u540c\u540d\u51fd\u6570</p> <p>\u6bd4\u5982\u4e00\u4e2aC\u7a0b\u5e8f\uff1a</p> <pre><code>//#include &lt;stdio.h&gt;\nint main() {\n\nprintf(\"hello World!\");\nreturn 0;\n}\n</code></pre> <p>\u806a\u660e\u7684\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u5e2e\u4f60\u6dfb\u52a0\u4e0a\u53bb\uff0c\u5047\u5982\u8bf4\u4e0d\u806a\u660e\u6216\u8005\u8bf4\u4f60\u5206\u6b65\u624b\u52a8\u7f16\u8bd1\u94fe\u63a5\uff0c\u90a3\u5c31\u4e0d\u884c\u4e86\u3002</p> <pre><code>/test_c/start_program$ ld hello.o\nld: warning: cannot find entry symbol _start; defaulting to 0000000000401000\nld: hello.o: in function `main':\nhello.c:(.text+0x18): undefined reference to `printf'\n</code></pre> <p>\u7a0b\u5e8f\u7684 <code>_start</code> \u6bb5\u901a\u5e38\u662f\u5728\u7f16\u8bd1\u548c\u94fe\u63a5\u8fc7\u7a0b\u4e2d\u7531\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u81ea\u52a8\u751f\u6210\u7684\u3002<code>_start</code> \u662f\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u5f53\u64cd\u4f5c\u7cfb\u7edf\u52a0\u8f7d\u7a0b\u5e8f\u5e76\u5f00\u59cb\u6267\u884c\u65f6\uff0c\u5b83\u9996\u5148\u6267\u884c <code>_start</code> \u51fd\u6570\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u4ee5\u4e0b\u662f <code>_start</code> \u6bb5\u751f\u6210\u7684\u4e00\u822c\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u7f16\u8bd1\u9636\u6bb5\uff1a\u7f16\u8bd1\u5668\u5c06 C \u8bed\u8a00\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u6216\u673a\u5668\u4ee3\u7801\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f1a\u8bc6\u522b\u51fa <code>main</code> \u51fd\u6570\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u8d77\u70b9\u3002</p> </li> <li> <p>\u6c47\u7f16\u9636\u6bb5\uff1a\u6c47\u7f16\u5668\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u6362\u6210\u673a\u5668\u4ee3\u7801\uff0c\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff08.o \u6587\u4ef6\uff09\u3002\u5728\u8fd9\u4e00\u6b65\uff0c\u5982\u679c\u7f16\u8bd1\u5668\u914d\u7f6e\u4e3a\u751f\u6210 <code>_start</code> \u7b26\u53f7\uff0c\u5b83\u53ef\u80fd\u4f1a\u5728\u76ee\u6807\u6587\u4ef6\u4e2d\u5305\u542b\u4e00\u4e2a <code>_start</code> \u7b26\u53f7\u3002</p> </li> <li> <p>\u94fe\u63a5\u9636\u6bb5\uff1a\u94fe\u63a5\u5668\u5c06\u591a\u4e2a\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u5fc5\u8981\u7684\u5e93\u94fe\u63a5\u5728\u4e00\u8d77\uff0c\u751f\u6210\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\u94fe\u63a5\u5668\u4f1a\u8bc6\u522b <code>_start</code> \u7b26\u53f7\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002\u5982\u679c\u76ee\u6807\u6587\u4ef6\u4e2d\u6ca1\u6709 <code>_start</code> \u7b26\u53f7\uff0c\u94fe\u63a5\u5668\u53ef\u80fd\u4f1a\u4f7f\u7528 C \u5e93\u4e2d\u7684 <code>_start</code> \u51fd\u6570\u4f5c\u4e3a\u5165\u53e3\u70b9\u3002</p> </li> <li> <p>C \u8fd0\u884c\u65f6\u542f\u52a8\u4ee3\u7801\uff1a\u5728\u8bb8\u591a\u7cfb\u7edf\u4e2d\uff0cC \u8fd0\u884c\u65f6\u5e93\uff08\u5982 GNU libc\uff09\u63d0\u4f9b\u4e86 <code>_start</code> \u51fd\u6570\u7684\u5b9e\u73b0\uff08\u4e4b\u524d\u5206\u6790\u7684<code>__glibc_start_main</code>\uff09\u3002\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u6267\u884c\u7a0b\u5e8f\u542f\u52a8\u524d\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u5982\u8bbe\u7f6e\u6808\u3001\u521d\u59cb\u5316 BSS \u6bb5\u3001\u8c03\u7528\u5168\u5c40\u6784\u9020\u51fd\u6570\u7b49\u3002\u7136\u540e\uff0c\u5b83\u4f1a\u8c03\u7528 <code>main</code> \u51fd\u6570\u3002</p> </li> <li> <p>\u64cd\u4f5c\u7cfb\u7edf\u7684\u52a0\u8f7d\u5668\uff1a\u64cd\u4f5c\u7cfb\u7edf\u7684\u52a0\u8f7d\u5668\u8d1f\u8d23\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u8bbe\u7f6e\u7a0b\u5e8f\u8ba1\u6570\u5668\u6307\u5411 <code>_start</code> \u51fd\u6570\u7684\u5730\u5740\u3002</p> </li> </ol> <p><code>_start</code> \u51fd\u6570\u7684\u786e\u5207\u884c\u4e3a\u548c\u5b9e\u73b0\u53ef\u80fd\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u7cfb\u7edf\u548c\u7f16\u8bd1\u5668\u800c\u6709\u6240\u4e0d\u540c\u3002</p> <p>\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u53ef\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u5982 <code>mainCRTStartup</code>\uff08\u5728 Windows \u4e0a\uff09\u6216 <code>crt0</code>\uff08\u5728\u67d0\u4e9b Unix \u7cfb\u7edf\u4e0a\uff09\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>_start</code> \u6bb5\u7684\u751f\u6210\u662f\u7f16\u8bd1\u548c\u94fe\u63a5\u8fc7\u7a0b\u4e2d\u81ea\u52a8\u5316\u7684\u4e00\u90e8\u5206\uff0c\u7531\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u6839\u636e\u7cfb\u7edf\u89c4\u8303\u548c\u7f16\u8bd1\u5668\u7684\u914d\u7f6e\u6765\u5904\u7406\u3002\u5f00\u53d1\u8005\u901a\u5e38\u4e0d\u9700\u8981\u624b\u52a8\u7f16\u5199 <code>_start</code> \u51fd\u6570\uff0c\u9664\u975e\u4ed6\u4eec\u9700\u8981\u6267\u884c\u7279\u5b9a\u7684\u542f\u52a8\u4ee3\u7801\u3002</p> <p>\u8fd9\u91cc\u5e94\u8be5\u5bf9\u4e00\u4e2aup\u4e3b\u7684\u76f8\u5173\u89c6\u9891\u6709\u70b9\u5370\u8c61\u3002\u8bf4\u8bf4Linux\u4e0a\u7684\u8fde\u63a5\u5668</p> <p>\u5047\u5982\u8bf4\u6211\u8981\u5199\u4e00\u4e2a\u94fe\u63a5\u5668\uff0c\u6211\u8be5\u600e\u4e48\u505a\uff1f\u6709\u70b9\u60f3\u4e86\u3002</p> <p>\u7b2c\u4e00\u8bfe - \u642d\u5efa\u5f00\u53d1\u73af\u5883\uff0c\u521d\u59cb\u5316\u9879\u76ee \u300a\u4ece\u96f6\u5f00\u59cb\u5b9e\u73b0\u94fe\u63a5\u5668\u300b</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u7f16\u5199\u53ef\u79fb\u690d\u7684\u7a0b\u5e8f</p> <p>\u4e3a\u4e86\u4e0d\u635f\u5bb3\u7a0b\u5e8f\u7684\u53ef\u79fb\u690d\u6027, \u4f60\u7f16\u5199\u7a0b\u5e8f\u7684\u65f6\u5019\u4e0d\u80fd\u518d\u505a\u4e00\u4e9b\u67b6\u6784\u76f8\u5173\u7684\u5047\u8bbe\u4e86, \u6bd4\u5982\"\u6307\u9488\u7684\u957f\u5ea6\u662f4\u5b57\u8282\"\u5c06\u4e0d\u518d\u6210\u7acb, \u56e0\u4e3a\u5728 <code>native</code>\u4e0a\u6307\u9488\u957f\u5ea6\u662f8\u5b57\u8282, \u6309\u7167\u8fd9\u4e2a\u5047\u8bbe\u7f16\u5199\u7684\u7a0b\u5e8f, \u5728<code>native</code>\u4e0a\u8fd0\u884c\u5f88\u6709\u53ef\u80fd\u4f1a\u89e6\u53d1\u6bb5\u9519\u8bef.</p> <p>\u5f53\u7136, \u89e3\u51b3\u95ee\u9898\u7684\u65b9\u6cd5\u8fd8\u662f\u6709\u7684, \u81f3\u4e8e\u8981\u600e\u4e48\u505a, \u8001\u89c4\u77e9, STFW\u5427.</p> <p>\u4f7f\u7528 <code>uintptr_t</code></p> <p><code>uintptr_t</code> \u662f C \u8bed\u8a00\u4e2d\u7684\u4e00\u4e2a\u6807\u51c6\u7c7b\u578b\uff0c\u5b9a\u4e49\u5728 <code>&lt;stdint.h&gt;</code> \u5934\u6587\u4ef6\u4e2d\u3002\u5b83\u662f\u4e00\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\u7c7b\u578b\uff0c\u5176\u5927\u5c0f\u8db3\u4ee5\u5b58\u50a8\u4efb\u4f55\u6307\u9488\u7684\u503c\u3002<code>uintptr_t</code> \u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u4f9b\u4e00\u4e2a\u901a\u7528\u7684\u6307\u9488\u5927\u5c0f\u7684\u6574\u6570\u7c7b\u578b\uff0c\u4ee5\u907f\u514d\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u56e0\u4e3a\u6307\u9488\u5927\u5c0f\u4e0d\u4e00\u81f4\u800c\u5bfc\u81f4\u7684\u53ef\u79fb\u690d\u6027\u95ee\u9898\u3002</p> <p>\u5728\u7f16\u5199\u53ef\u79fb\u690d\u7684\u7a0b\u5e8f\u65f6\uff0c\u4f7f\u7528 <code>uintptr_t</code> \u53ef\u4ee5\u786e\u4fdd\u4f60\u7684\u7a0b\u5e8f\u5728\u4e0d\u540c\u7684\u7cfb\u7edf\u67b6\u6784\u4e0a\u90fd\u80fd\u591f\u6b63\u786e\u5730\u5904\u7406\u6307\u9488\u7684\u503c\uff0c\u65e0\u8bba\u662f\u572832\u4f4d\u8fd8\u662f64\u4f4d\u7684\u7cfb\u7edf\u4e0a\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u9700\u8981\u5c06\u6307\u9488\u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u6216\u8005\u5728\u6574\u6570\u548c\u6307\u9488\u4e4b\u95f4\u8fdb\u884c\u8f6c\u6362\uff0c\u4f7f\u7528 <code>uintptr_t</code> \u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u6307\u9488\u5927\u5c0f\u4e0d\u540c\u800c\u5f15\u53d1\u7684\u9519\u8bef\u3002</p> <p>\u8fd9\u91cc\u662f\u4e00\u4e2a\u4f7f\u7528 <code>uintptr_t</code> \u7684\u7b80\u5355\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\nint main() {\n    void *ptr = NULL;\n    uintptr_t ptr_as_uint = (uintptr_t)ptr;  // \u5c06\u6307\u9488\u8f6c\u6362\u4e3a uintptr_t \u7c7b\u578b\u7684\u6574\u6570\n    printf(\"Pointer as integer: %\" PRIuPTR \"\\n\", ptr_as_uint);\n\n    // \u4e5f\u53ef\u4ee5\u5c06 uintptr_t \u8f6c\u6362\u56de\u6307\u9488\u7c7b\u578b\n    void *ptr_from_uint = (void *)ptr_as_uint;\n    return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u5c06\u4e00\u4e2a\u6307\u9488\u8f6c\u6362\u4e3a <code>uintptr_t</code> \u7c7b\u578b\u7684\u6574\u6570\uff0c\u7136\u540e\u6253\u5370\u51fa\u6765\u3002\u4e4b\u540e\uff0c\u6211\u4eec\u53c8\u5c06\u8fd9\u4e2a\u6574\u6570\u8f6c\u6362\u56de\u6307\u9488\u7c7b\u578b\u3002\u8fd9\u79cd\u8f6c\u6362\u5728\u5904\u7406\u6307\u9488\u7b97\u672f\u6216\u8005\u9700\u8981\u5c06\u6307\u9488\u4e0e\u6574\u6570\u8fdb\u884c\u6bd4\u8f83\u65f6\u975e\u5e38\u6709\u7528\u3002</p> <p>\u8bb0\u4f4f\uff0c\u5c3d\u7ba1 <code>uintptr_t</code> \u53ef\u4ee5\u89e3\u51b3\u5f88\u591a\u4e0e\u6307\u9488\u5927\u5c0f\u76f8\u5173\u7684\u53ef\u79fb\u690d\u6027\u95ee\u9898\uff0c\u4f46\u7f16\u5199\u53ef\u79fb\u690d\u7684\u7a0b\u5e8f\u8fd8\u9700\u8981\u8003\u8651\u5176\u4ed6\u56e0\u7d20\uff0c\u6bd4\u5982\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u3001\u5b57\u8282\u987a\u5e8f\uff08\u5927\u7aef\u6216\u5c0f\u7aef\uff09\u3001\u5e93\u51fd\u6570\u7684\u53ef\u7528\u6027\u7b49\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#klib","title":"\u6d4b\u8bd5\u4f60\u7684klib","text":"<p>\u5f53\u6211\u5199\u4e00\u4e2a\u6d4b\u8bd5\u7684\u65f6\u5019\uff0cMakefile\u662f\u600e\u4e48\u8ba9\u4ed6\u8dd1\u8d77\u6765\u7684\u3002</p> <p>\u7f16\u5199\u540e, \u53ef\u4ee5\u5148\u5728native\u4e0a\u7528glibc\u7684\u5e93\u51fd\u6570\u6765\u6d4b\u8bd5\u4f60\u7f16\u5199\u7684\u6d4b\u8bd5\u4ee3\u7801, </p> <p>\u7136\u540e\u5728native\u4e0a\u7528\u8fd9\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u6765\u6d4b\u8bd5\u4f60\u7684klib\u5b9e\u73b0, </p> <p>\u6700\u540e\u518d\u5728NEMU\u4e0a\u8fd0\u884c\u8fd9\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u6765\u6d4b\u8bd5\u4f60\u7684NEMU\u5b9e\u73b0.</p> <p>\u53e6\u5916\uff1a\u6ce8\u610f\uff01</p> <p>\u597d\u4e86, \u73b0\u5728\u4f60\u5c31\u53ef\u4ee5\u5728<code>native</code>\u4e0a\u6d4b\u8bd5/\u8c03\u8bd5\u4f60\u7684klib\u5b9e\u73b0\u4e86, \u8fd8\u53ef\u4ee5\u4f7f\u7528<code>putch()</code>\u8fdb\u884c\u5b57\u7b26\u8f93\u51fa\u6765\u5e2e\u52a9\u4f60\u8c03\u8bd5, \u751a\u81f3\u662fGDB. \u5b9e\u73b0\u6b63\u786e\u540e, \u518d\u5c06\u7a0b\u5e8f\u7f16\u8bd1\u5230<code>$ISA-nemu</code>(\u8bb0\u5f97\u79fb\u9664\u8c03\u8bd5\u65f6\u63d2\u5165\u7684<code>putch()</code>), \u5bf9NEMU\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7f16\u5199\u66f4\u591a\u7684\u6d4b\u8bd5</p> <p>\u5c1d\u8bd5\u7406\u89e3\u4e0a\u8ff0\u6d4b\u8bd5\u4ee3\u7801\u662f\u5982\u4f55\u8fdb\u884c\u6d4b\u8bd5\u7684, \u5e76\u5728<code>am-kernels/tests/</code>\u76ee\u5f55\u4e0b\u65b0\u589e\u4e00\u4e2a\u9488\u5bf9klib\u7684\u6d4b\u8bd5\u96c6<code>klib-tests</code>, \u6d4b\u8bd5\u96c6\u7684\u6587\u4ef6\u7ed3\u6784\u53ef\u4ee5\u53c2\u8003<code>am-kernels/tests/am-tests</code>\u6216<code>am-kernels/kernels/hello</code>.</p> <p>\u7136\u540e\u9488\u5bf9\u4e0a\u6587\u6240\u8ff0\u7684\u7b2c\u4e00\u7c7b\u5199\u5165\u51fd\u6570\u7f16\u5199\u76f8\u5e94\u7684\u6d4b\u8bd5\u4ee3\u7801. \u7f16\u5199\u6d4b\u8bd5\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u4e00\u4e9b\u5730\u65b9:</p> <ul> <li><code>memcpy()</code>\u7684\u884c\u4e3a\u5728\u533a\u95f4\u91cd\u53e0\u7684\u65f6\u5019\u662fUB, \u4f60\u53ef\u4ee5\u5728\u904d\u5386\u7684\u65f6\u5019\u68c0\u67e5\u533a\u95f4\u662f\u5426\u91cd\u53e0, \u82e5\u662f, \u5219\u8df3\u8fc7\u6b64\u6b21\u68c0\u67e5; \u6216\u8005\u4f7f\u7528\u53e6\u4e00\u4e2a\u76f8\u540c\u7684\u6570\u7ec4\u6765\u4f5c\u4e3a<code>src</code>, \u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u91cd\u53e0\u7684\u60c5\u51b5</li> <li>\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\u9700\u8981\u989d\u5916\u6ce8\u610f<code>\\0</code>\u548c\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898</li> </ul> <p>\u7f16\u5199\u540e, \u4f60\u53ef\u4ee5\u5148\u5728native\u4e0a\u7528glibc\u7684\u5e93\u51fd\u6570\u6765\u6d4b\u8bd5\u4f60\u7f16\u5199\u7684\u6d4b\u8bd5\u4ee3\u7801, \u7136\u540e\u5728native\u4e0a\u7528\u8fd9\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u6765\u6d4b\u8bd5\u4f60\u7684klib\u5b9e\u73b0, \u6700\u540e\u518d\u5728NEMU\u4e0a\u8fd0\u884c\u8fd9\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u6765\u6d4b\u8bd5\u4f60\u7684NEMU\u5b9e\u73b0.</p> <p>\u4eff\u7167\u7684 <code>am-kernels/kernels/hello</code> \u6846\u67b6\u3002</p> <p></p> <pre><code>#include &lt;klibtest.h&gt;\n\nvoid test_memset();\nvoid test_memcpy(); \n\nint main(const char *args) {\n    switch (args[0]) {\n        case '1': test_memset(); putstr(\"memset pass\\n\"); break; \n        case '2': test_memcpy(); putstr(\"memcpy pass\\n\"); break;\n            // ......\n        default: \n            putstr(\"Usage: make run mainargs=*\\n\");\n            putstr(\"  1: memset\");\n            putstr(\"  2: memcpy\");\n    }\n    return 0;\n}\n</code></pre> <p>\u601d\u8003\u9898</p> </li> <li> <p>\u8fd9\u4e9b\u5e93\u51fd\u6570\u8fd9\u4e48\u7b80\u5355, \u6211\u53ef\u4ee5\u4e0d\u6d4b\u8bd5\u5417?</p> <p>\u53ef\u4ee5. \u4e0d\u8fc7\u672a\u6d4b\u8bd5\u4ee3\u7801\u6c38\u8fdc\u662f\u9519\u7684, \u4ee5\u540e\u4f60\u8fd8\u4f1a\u4f7f\u7528\u8fd9\u4e9b\u5e93\u51fd\u6570\u6765\u7f16\u5199\u66f4\u590d\u6742\u7684\u7a0b\u5e8f(\u4f8b\u5982OS), \u5982\u679c\u4f60\u4ee5\u540e\u4e0d\u60f3\u88ab\u81ea\u5df1\u5751\u4e86, \u73b0\u5728\u8fd8\u662f\u597d\u597d\u82b1\u65f6\u95f4\u6765\u6d4b\u8bd5\u4e00\u4e0b\u5427. \u53e6\u5916, \u5982\u679c\u4f60\u4ee5\u540e\u60f3\u4f18\u5316\u8fd9\u4e9b\u5e93\u51fd\u6570(\u4f8b\u5982<code>memcpy()</code>\u548c<code>memset()</code>\u662f\u4ee5\u540e\u7528\u5f97\u6bd4\u8f83\u591a\u7684\u4e24\u4e2a\u51fd\u6570), \u4f60\u53ef\u80fd\u4f1a\u7f16\u5199\u4e00\u4e2a\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b\u7684\u7b97\u6cd5, \u5230\u4e86\u90a3\u65f6\u5019, \u4f60\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u6d4b\u8bd5\u662f\u591a\u4e48\u91cd\u8981\u4e86.</p> </li> </ul> <p>\u771f\u7ed9\u6211\u5e72\u51fa\u4e86\u4e00\u4e9b\u95ee\u9898\uff1a</p> <p>strlen:</p> <pre><code>   9 size_t strlen(const char *s) {\n   10     if (!s) return 0;\n   11 \n   12     size_t len = 0;\n   13     while (*s++ != '\\0') {                                                                                                \n   14         len++;\n   15     }\n   16     return len;\n   17 }\n</code></pre> <p>*s\u4e00\u5f00\u59cb\u6ca1\u6709++\uff0c\u4e00\u76f4\u6b7b\u5faa\u73af\uff01\u8fd8\u597d\u67e5\u51fa\u6765\u4e86\uff01</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7f16\u5199\u66f4\u591a\u7684\u6d4b\u8bd5(2)</p> <p>\u5c1d\u8bd5\u4e3a<code>klib-tests</code>\u6dfb\u52a0\u9488\u5bf9\u7b2c\u4e8c\u7c7b\u53ea\u8bfb\u51fd\u6570\u7684\u6d4b\u8bd5, \u4f8b\u5982<code>memcmp()</code>, <code>strlen()</code>\u7b49. \u601d\u8003\u4e00\u4e0b, \u5e94\u8be5\u5982\u4f55\u5f97\u5230\u51fd\u6570\u7684\u9884\u671f\u8f93\u51fa?</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u7f16\u5199\u66f4\u591a\u7684\u6d4b\u8bd5(3)</p> <p>\u5c1d\u8bd5\u4e3a<code>klib-tests</code>\u6dfb\u52a0\u9488\u5bf9\u683c\u5f0f\u5316\u8f93\u51fa\u51fd\u6570\u7684\u6d4b\u8bd5. \u4f60\u53ef\u4ee5\u5148\u901a\u8fc7<code>sprintf()</code>\u628a\u5b9e\u9645\u8f93\u51fa\u6253\u5370\u5230\u4e00\u4e2a\u7f13\u51b2\u533a\u4e2d, \u7136\u540e\u901a\u8fc7<code>strcmp()</code>\u6765\u548c\u9884\u671f\u8f93\u51fa\u8fdb\u884c\u5bf9\u6bd4.</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u8003\u8651\u5b9e\u73b0\u4f4d\u5bbd, \u7cbe\u5ea6, \u957f\u5ea6\u4fee\u9970\u7b26\u7b49\u529f\u80fd, \u7136\u540e\u751f\u6210\u76f8\u5e94\u7684\u6d4b\u8bd5\u7528\u4f8b\u6765\u8fdb\u884c\u6d4b\u8bd5.</p> <p>\u672a\u6765\u518d\u591a\u66f4\u591a\u7684\u6d4b\u8bd5</p> </li> </ul> <p>\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u4e0d\u6d4b\u8bd5\u7684\u4ee3\u7801\u6c38\u8fdc\u90fd\u662f\u9519\u7684\uff0c\u627e\u51fa\u4e86\u51e0\u4e2a\u51fd\u6570\u5b9e\u73b0\u7684\u9519\u8bef\u95ee\u9898\uff01</p> <p><code>itoa</code>\u3001<code>strlen</code>...\u672a\u6765\u518d\u5b9e\u73b0\u66f4\u591a\u5185\u5bb9\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#differential-testing","title":"Differential Testing  (\u2b50)","text":"<p>\u53ea\u662f\u540d\u5b57\u542c\u8d77\u6765\u6bd4\u8f83nb\uff0c\u4f46\u5176\u5b9e\u672c\u8d28\u5f88\u7b80\u5355\uff08\u5c31\u662f\u5bf9\u62cd\uff09\uff0c\u4f46\u662f\u53c8\u662f\u975e\u5e38\u91cd\u8981\u3002</p> <p>\u53c8\u4e00\u6b21\u56de\u987e \u7a0b\u5e8f\u548c\u8ba1\u7b97\u673a\u662f\u4e2a\u72b6\u6001\u673a \u6982\u5ff5\uff1a</p> <p>\u6211\u4eec\u521a\u624d\u63d0\u5230\u4e86\"\u72b6\u6001\", \u90a3\"\u72b6\u6001\"\u5177\u4f53\u6307\u7684\u662f\u4ec0\u4e48\u5462? \u6211\u4eec\u5728PA1\u4e2d\u5df2\u7ecf\u8ba4\u8bc6\u5230, \u7a0b\u5e8f\u548c\u8ba1\u7b97\u673a\u90fd\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u72b6\u6001\u673a, \u72b6\u6001\u53ef\u4ee5\u8868\u793a\u6210\u4e00\u4e2a\u4e8c\u5143\u7ec4<code>S = &lt;R, M&gt;</code>, \u5176\u4e2d<code>R</code>\u662f\u5bc4\u5b58\u5668\u7684\u503c, <code>M</code>\u662f\u5185\u5b58\u7684\u503c. </p> <p>\u8981\u68c0\u67e5\u6307\u4ee4\u7684\u5b9e\u73b0\u662f\u5426\u6b63\u786e, \u53ea\u8981\u68c0\u67e5\u6267\u884c\u6307\u4ee4\u4e4b\u540eDUT\u548cREF\u7684\u72b6\u6001\u662f\u5426\u4e00\u81f4\u5c31\u53ef\u4ee5\u4e86! DiffTest\u53ef\u4ee5\u975e\u5e38\u53ca\u65f6\u5730\u6355\u6349\u5230error, \u7b2c\u4e00\u6b21\u53d1\u73b0NEMU\u7684\u72b6\u6001\u4e0e\u771f\u673a\u4e0d\u4e00\u6837\u7684\u65f6\u5019, \u5c31\u662f\u56e0\u4e3a\u5f53\u524d\u6267\u884c\u7684\u6307\u4ee4\u5b9e\u73b0\u6709\u8bef\u5bfc\u81f4\u7684. \u8fd9\u65f6\u5019\u5176\u5b9e\u79bberror\u975e\u5e38\u63a5\u8fd1, \u9632\u6b62\u4e86error\u8fdb\u4e00\u6b65\u4f20\u64ad\u7684\u540c\u65f6, \u8981\u56de\u6eaf\u627e\u5230fault\u4e5f\u5bb9\u6613\u5f97\u591a.</p> <p>\u7559\u5751 \u5173\u4e8eerror \u548c failure \u548c fault \u7684\u533a\u5206</p> <pre><code>void init_difftest(char *ref_so_file, long img_size, int port) {\n  assert(ref_so_file != NULL);\n\n  void *handle;\n  handle = dlopen(ref_so_file, RTLD_LAZY);\n  assert(handle);\n\n  ref_difftest_memcpy = dlsym(handle, \"difftest_memcpy\");\n  assert(ref_difftest_memcpy);\n\n  ref_difftest_regcpy = dlsym(handle, \"difftest_regcpy\");\n  assert(ref_difftest_regcpy);\n\n  ref_difftest_exec = dlsym(handle, \"difftest_exec\");\n  assert(ref_difftest_exec);\n\n  ref_difftest_raise_intr = dlsym(handle, \"difftest_raise_intr\");\n  assert(ref_difftest_raise_intr);\n\n  void (*ref_difftest_init)(int) = dlsym(handle, \"difftest_init\");\n  assert(ref_difftest_init);\n\n  Log(\"Differential testing: %s\", ANSI_FMT(\"ON\", ANSI_FG_GREEN));\n  Log(\"The result of every instruction will be compared with %s. \"\n      \"This will help you a lot for debugging, but also significantly reduce the performance. \"\n      \"If it is not necessary, you can turn it off in menuconfig.\", ref_so_file);\n\n  ref_difftest_init(port);\n  ref_difftest_memcpy(RESET_VECTOR, guest_to_host(RESET_VECTOR), img_size, DIFFTEST_TO_REF);\n  ref_difftest_regcpy(&amp;cpu, DIFFTEST_TO_REF);     \n}\n</code></pre> <ul> <li> <p>\u6253\u5f00\u4f20\u5165\u7684\u52a8\u6001\u5e93\u6587\u4ef6<code>ref_so_file</code>.</p> </li> <li> <p>\u901a\u8fc7\u52a8\u6001\u94fe\u63a5\u5bf9\u52a8\u6001\u5e93\u4e2d\u7684\u4e0a\u8ff0API\u7b26\u53f7\u8fdb\u884c\u7b26\u53f7\u89e3\u6790\u548c\u91cd\u5b9a\u4f4d, \u8fd4\u56de\u5b83\u4eec\u7684\u5730\u5740.</p> <p>\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u8c03\u7528\u52a8\u6001\u5e93\u7684\u51fd\u6570\u3002\uff08dlsym\u4e5f\u53ef\u4ee5\u4e86\u89e3\u4e00\u4e0b\uff09</p> </li> <li> <p>\u5bf9REF\u7684DIffTest\u529f\u80fd\u8fdb\u884c\u521d\u59cb\u5316, \u5177\u4f53\u884c\u4e3a\u56e0REF\u800c\u5f02.</p> </li> <li> <p>\u5c06DUT\u7684guest memory\u62f7\u8d1d\u5230REF\u4e2d.</p> </li> <li> <p>\u5c06DUT\u7684\u5bc4\u5b58\u5668\u72b6\u6001\u62f7\u8d1d\u5230REF\u4e2d.</p> </li> </ul> <ul> <li> <p>\u505a</p> <p>\u5b9e\u73b0DiffTest \u4e0a\u6587\u5728\u4ecb\u7ecdAPI\u7ea6\u5b9a\u7684\u65f6\u5019, \u63d0\u5230\u4e86\u5bc4\u5b58\u5668\u72b6\u6001r\u9700\u8981\u628a\u5bc4\u5b58\u5668\u6309\u7167\u67d0\u79cd\u987a\u5e8f\u6392\u5217. \u4f60\u9996\u5148\u9700\u8981RTFSC, \u4ece\u4e2d\u627e\u51fa\u8fd9\u4e00\u987a\u5e8f, \u5e76\u68c0\u67e5\u4f60\u7684NEMU\u5b9e\u73b0\u662f\u5426\u5df2\u7ecf\u6ee1\u8db3\u7ea6\u675f.</p> <p>\u7136\u540e\u5728 <code>isa_difftest_checkregs()</code> \u4e2d\u6dfb\u52a0\u76f8\u5e94\u7684\u4ee3\u7801, \u5b9e\u73b0DiffTest\u7684\u6838\u5fc3\u529f\u80fd. \u5b9e\u73b0\u6b63\u786e\u540e, \u4f60\u5c06\u4f1a\u5f97\u5230\u4e00\u6b3e\u65e0\u6bd4\u5f3a\u5927\u7684\u6d4b\u8bd5\u5de5\u5177.</p> <p>\u4f53\u4f1a\u5230DiffTest\u7684\u5f3a\u5927\u4e4b\u540e, \u4e0d\u59a8\u601d\u8003\u4e00\u4e0b: \u4f5c\u4e3a\u4e00\u79cd\u57fa\u7840\u8bbe\u65bd, DiffTest\u80fd\u5e2e\u52a9\u4f60\u8282\u7701\u591a\u5c11\u8c03\u8bd5\u7684\u65f6\u95f4\u5462?</p> <pre><code>const char* xpr_name[] = {\n  \"zero\", \"ra\", \"sp\",  \"gp\",  \"tp\", \"t0\",  \"t1\",  \"t2\",\n  \"s0\",   \"s1\", \"a0\",  \"a1\",  \"a2\", \"a3\",  \"a4\",  \"a5\",\n  \"a6\",   \"a7\", \"s2\",  \"s3\",  \"s4\", \"s5\",  \"s6\",  \"s7\",\n  \"s8\",   \"s9\", \"s10\", \"s11\", \"t3\", \"t4\",  \"t5\",  \"t6\"\n};\n\nconst char* fpr_name[] = {\n  \"ft0\", \"ft1\", \"ft2\",  \"ft3\",  \"ft4\", \"ft5\", \"ft6\",  \"ft7\",\n  \"fs0\", \"fs1\", \"fa0\",  \"fa1\",  \"fa2\", \"fa3\", \"fa4\",  \"fa5\",\n  \"fa6\", \"fa7\", \"fs2\",  \"fs3\",  \"fs4\", \"fs5\", \"fs6\",  \"fs7\",\n  \"fs8\", \"fs9\", \"fs10\", \"fs11\", \"ft8\", \"ft9\", \"ft10\", \"ft11\"\n};\n\nconst char* vr_name[] = {\n  \"v0\",  \"v1\",  \"v2\",  \"v3\",  \"v4\",  \"v5\",  \"v6\",  \"v7\",\n  \"v8\",  \"v9\",  \"v10\", \"v11\", \"v12\", \"v13\", \"v14\", \"v15\",\n  \"v16\", \"v17\", \"v18\", \"v19\", \"v20\", \"v21\", \"v22\", \"v23\",\n  \"v24\", \"v25\", \"v26\", \"v27\", \"v28\", \"v29\", \"v30\", \"v31\"\n};\n// ...\nnemu/tools/spike-diff/repo/disasm/regnames.cc\n</code></pre> <pre><code>const char *regs[] = {\n  \"$0\", \"ra\", \"sp\", \"gp\", \"tp\", \"t0\", \"t1\", \"t2\",\n  \"s0\", \"s1\", \"a0\", \"a1\", \"a2\", \"a3\", \"a4\", \"a5\",\n  \"a6\", \"a7\", \"s2\", \"s3\", \"s4\", \"s5\", \"s6\", \"s7\",\n  \"s8\", \"s9\", \"s10\", \"s11\", \"t3\", \"t4\", \"t5\", \"t6\"\n};\n</code></pre> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u532a\u5937\u6240\u601d\u7684QEMU\u884c\u4e3a (\u6709\u70b9\u96be\u5ea6)</p> <p>\u5728\u4e00\u4e9b\u65e7\u7248\u7684mips32-QEMU\u4e2d, \u4ec5\u5728\u4e0a\u8ff0\u6307\u4ee4\u7684PC\u503c\u540e12\u4f4d\u4e3a<code>0xffc</code>\u65f6, \u624d\u4f1a\u8fdb\u884c\u6307\u4ee4\u6253\u5305. \u8fd9\u4e2a\u6253\u5305\u6761\u4ef6\u770b\u4e0a\u53bb\u975e\u5e38\u5947\u602a, \u4f60\u77e5\u9053\u53ef\u80fd\u7684\u539f\u56e0\u662f\u4ec0\u4e48\u5417</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>Spike\u4e0d\u652f\u6301\u4e0d\u5bf9\u9f50\u7684\u8bbf\u5b58</p> <p>RISC-V\u4f5c\u4e3a\u4e00\u4e2aRISC\u67b6\u6784, \u901a\u5e38\u662f\u4e0d\u652f\u6301\u4e0d\u5bf9\u9f50\u8bbf\u5b58\u7684, \u5728Spike\u4e2d\u6267\u884c\u4e00\u6761\u5730\u5740\u4e0d\u5bf9\u9f50\u7684\u8bbf\u5b58\u6307\u4ee4\u5c06\u4f1a\u629b\u51fa\u5f02\u5e38, \u8ba9PC\u8df3\u8f6c\u5230<code>0</code>. \u4f46NEMU\u4e3a\u4e86\u7b80\u5316, \u6ca1\u6709\u5b9e\u73b0\u8fd9\u6837\u7684\u529f\u80fd, \u56e0\u6b64\u5982\u679c\u8ba9NEMU\u548cSpike\u540c\u65f6\u6267\u884c\u8fd9\u6837\u7684\u6307\u4ee4, DiffTest\u5c06\u4f1a\u62a5\u9519. \u4e0d\u8fc7\u8fd9\u5f88\u53ef\u80fd\u662f\u4f60\u7684\u8f6f\u4ef6\u5b9e\u73b0(\u4f8b\u5982klib)\u6709\u95ee\u9898, \u8bf7\u68c0\u67e5\u5e76\u4fee\u6539\u76f8\u5173\u4ee3\u7801.</p> </li> </ul> <pre><code>bool isa_difftest_checkregs(CPU_state *ref_r, vaddr_t pc) {\n    int reg_num = ARRLEN(cpu.gpr);\n    int i = 0;\n    bool flag = true;\n    if (ref_r-&gt;pc != cpu.pc) {\n        return false;\n    }\n    for (i = 0; i &lt; reg_num; i++) {\n        if (ref_r-&gt;gpr[i] != cpu.gpr[i]) {\n            printf(\"2.now reg is %s, ref_r-&gt;gpr:%u, but dut_gpr:%u\\n\",\n                   regs[i], ref_r-&gt;gpr[i],cpu.gpr[i]);\n            return false;\n        }\n    }\n    if (flag == false) {\n        for (i = 0; i &lt; reg_num; i++) {\n            if (ref_r-&gt;gpr[i] &gt;= 0x80000000) {\n                printf(\"ref-%3s         %#x\\n\", regs[i], ref_r-&gt;gpr[i]);\n            } else {\n                printf(\"ref-%3s         %d\\n\", regs[i],ref_r-&gt;gpr[i]);\n            }\n        }\n    }\n  return true;\n}\n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#_23","title":"\u4e00\u952e\u56de\u5f52\u6d4b\u8bd5","text":"<p>\u6269\u5c55\u9605\u8bfb: NEMU \u7684\u672c\u8d28</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6355\u6349\u6b7b\u5faa\u73af(\u6709\u70b9\u96be\u5ea6)</p> <p>NEMU\u9664\u4e86\u4f5c\u4e3a\u6a21\u62df\u5668\u4e4b\u5916, \u8fd8\u5177\u6709\u7b80\u5355\u7684\u8c03\u8bd5\u529f\u80fd, \u53ef\u4ee5\u8bbe\u7f6e\u65ad\u70b9, \u67e5\u770b\u7a0b\u5e8f\u72b6\u6001. \u5982\u679c\u8ba9\u4f60\u4e3aNEMU\u6dfb\u52a0\u5982\u4e0b\u529f\u80fd</p> <p>\u5f53\u7528\u6237\u7a0b\u5e8f\u9677\u5165\u6b7b\u5faa\u73af\u65f6, \u8ba9\u7528\u6237\u7a0b\u5e8f\u6682\u505c\u4e0b\u6765, \u5e76\u8f93\u51fa\u76f8\u5e94\u7684\u63d0\u793a\u4fe1\u606f</p> <p>\u4f60\u89c9\u5f97\u5e94\u8be5\u5982\u4f55\u5b9e\u73b0? \u5982\u679c\u4f60\u611f\u5230\u7591\u60d1, \u5728\u4e92\u8054\u7f51\u4e0a\u641c\u7d22\u76f8\u5173\u4fe1\u606f.</p> <p>\u4e0d\u53ef\u89e3\u95ee\u9898\u2014\u505c\u673a\u95ee\u9898\u8bc1\u660e - MwingFly - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u770b\u770b\u8fd9\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u4eba\u4e3a\u5730\u89c4\u5b9a\u4e00\u4e2a\u65f6\u95f4\u3002</p> <p>\u56e0\u4e3a C \u7684\u6b7b\u5faa\u73af\u4e3b\u8981\u6765\u81ea while \u548c do while</p> <p>\u9012\u5f52\u6682\u4e14\u4e0d\u8ba8\u8bba\uff0c\u65e0\u7a77\u9012\u5f52\u4f1a\u5bfc\u81f4StackOverflow\uff0c\u786c\u4ef6\u4e0a\u5c31\u4f1a\u62a5\u9519\uff0c\u53ef\u4ee5\u5ffd\u7565</p> <p>\u90a3\u80fd\u4e0d\u80fd\u8ba9\u8ba1\u7b97\u673a\u5de5\u5177\u6765\u6355\u83b7\u51fa\u73b0\u8fd9\u4e24\u4e2a\u4e1c\u897f\u7684\u5730\u65b9\uff1f\u7528\u50cf\u5b9a\u65f6\u5668\u4e00\u6837\u7684\u4e1c\u897f\uff0c\u8ba1\u5230\u67d0\u4e2a\u503c\uff0c\u6ea2\u51fa\uff0c\u8868\u793a\u6b7b\u5faa\u73af\uff1f</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_24","title":"\u8f93\u5165\u8f93\u51fa","text":""},{"location":"ysyx/pa/pa2/pa2.html#cpu","title":"\u8bbe\u5907\u4e0eCPU","text":"<p>I/O \u7f16\u5740\uff1a\u7aef\u53e3 I/O\uff0cMMI/O</p>"},{"location":"ysyx/pa/pa2/pa2.html#io","title":"\u7aef\u53e3 I/O","text":"<p>API, \u884c\u4e3a, RTFM... \u6ca1\u9519, \u6211\u4eec\u53c8\u518d\u6b21\u770b\u5230\u4e86\u8ba1\u7b97\u673a\u7cfb\u7edf\u8bbe\u8ba1\u7684\u4e00\u4e2a\u4f8b\u5b50: \u8bbe\u5907\u5411CPU\u66b4\u9732\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u63a5\u53e3, \u628a\u8bbe\u5907\u5185\u90e8\u7684\u590d\u6742\u884c\u4e3a(\u751a\u81f3\u4e00\u4e9b\u6a21\u62df\u7535\u8def\u7684\u7279\u6027)\u8fdb\u884c\u62bd\u8c61, CPU\u53ea\u9700\u8981\u4f7f\u7528\u8fd9\u4e00\u63a5\u53e3\u8bbf\u95ee\u8bbe\u5907, \u5c31\u53ef\u4ee5\u5b9e\u73b0\u671f\u671b\u7684\u529f\u80fd.</p> <p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u5904\u5904\u8574\u542b\u62bd\u8c61\u7684\u601d\u60f3, \u53ea\u8981\u7406\u89e3\u5176\u4e2d\u7684\u539f\u7406, \u518d\u52a0\u4e0aRTFM\u7684\u6280\u80fd, \u4f60\u5c31\u80fd\u638c\u63e1\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5168\u90e8!</p>"},{"location":"ysyx/pa/pa2/pa2.html#io_1","title":"\u5185\u5b58\u6620\u5c04 I/O","text":"<p>\u5c06\u7269\u7406\u5185\u5b58\u7684\u8bbf\u95ee\u91cd\u5b9a\u5411\u5230 I/O\u5730\u5740\u7a7a\u95f4\u3002CPU\u5c1d\u8bd5\u8bbf\u95ee\u8fd9\u90e8\u5206\u7269\u7406\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u6700\u7ec8\u662f\u8bbf\u95ee\u4e86\u76f8\u5e94\u7684 I/O \u8bbe\u5907\uff0cCPU \u5374\u6d51\u7136\u4e0d\u77e5\u3002\u8fd9\u6837\u5b50 CPU\u5c31\u53ef\u4ee5\u901a\u8fc7\u666e\u901a\u7684\u8bbf\u5b58\u6307\u4ee4\u6765\u8bbf\u95ee\u8bbe\u5907\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7406\u89e3volatile\u5173\u952e\u5b57</p> <p>\u4e5f\u8bb8\u4f60\u4ece\u6765\u90fd\u6ca1\u542c\u8bf4\u8fc7C\u8bed\u8a00\u4e2d\u6709<code>volatile</code>\u8fd9\u4e2a\u5173\u952e\u5b57, \u4f46\u5b83\u4eceC\u8bed\u8a00\u8bde\u751f\u5f00\u59cb\u5c31\u4e00\u76f4\u5b58\u5728. <code>volatile</code>\u5173\u952e\u5b57\u7684\u4f5c\u7528\u5341\u5206\u7279\u522b, \u5b83\u7684\u4f5c\u7528\u662f\u907f\u514d\u7f16\u8bd1\u5668\u5bf9\u76f8\u5e94\u4ee3\u7801\u8fdb\u884c\u4f18\u5316. \u4f60\u5e94\u8be5\u52a8\u624b\u4f53\u4f1a\u4e00\u4e0b<code>volatile</code>\u7684\u4f5c\u7528, \u5728GNU/Linux\u4e0b\u7f16\u5199\u4ee5\u4e0b\u4ee3\u7801:</p> <pre><code>void fun() {\n  extern unsigned char _end;  // _end\u662f\u4ec0\u4e48?\n  volatile unsigned char *p = &amp;_end;\n  *p = 0;\n  while(*p != 0xff);\n  *p = 0x33;\n  *p = 0x34;\n  *p = 0x86;\n}\n</code></pre> <p>\u7136\u540e\u4f7f\u7528<code>-O2</code>\u7f16\u8bd1\u4ee3\u7801. \u5c1d\u8bd5\u53bb\u6389\u4ee3\u7801\u4e2d\u7684<code>volatile</code>\u5173\u952e\u5b57, \u91cd\u65b0\u4f7f\u7528<code>-O2</code>\u7f16\u8bd1, \u5e76\u5bf9\u6bd4\u53bb\u6389<code>volatile</code>\u524d\u540e\u53cd\u6c47\u7f16\u7ed3\u679c\u7684\u4e0d\u540c.</p> <p>\u4f60\u6216\u8bb8\u4f1a\u611f\u5230\u7591\u60d1, \u4ee3\u7801\u4f18\u5316\u4e0d\u662f\u4e00\u4ef6\u597d\u4e8b\u60c5\u5417? \u4e3a\u4ec0\u4e48\u4f1a\u6709<code>volatile</code>\u8fd9\u79cd\u5947\u8469\u7684\u5b58\u5728? \u601d\u8003\u4e00\u4e0b, \u5982\u679c\u4ee3\u7801\u4e2d<code>p</code>\u6307\u5411\u7684\u5730\u5740\u6700\u7ec8\u88ab\u6620\u5c04\u5230\u4e00\u4e2a\u8bbe\u5907\u5bc4\u5b58\u5668, \u53bb\u6389<code>volatile</code>\u53ef\u80fd\u4f1a\u5e26\u6765\u4ec0\u4e48\u95ee\u9898?</p> <p>\u6ca1\u6709volatile\uff1a</p> <p></p> <p>\u6709volatile\uff1a</p> <p></p> <p>\u8fd9\u662f\u76f4\u63a5\u5c06while\u540e\u9762\u7684\u8d4b\u503c\u5185\u5bb9\u53bb\u6389\u4e86\u3002</p> <p>\u7f16\u8bd1\u5668\u5728\u8fd9\u91cc\u8ba4\u4e3awhile\u9677\u5165\u6b7b\u5faa\u73af\u4e86\uff0c\u540e\u9762\u7684\u8d4b\u503c\u90fd\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u6545\u800c\u53bb\u6389\u4e86\u3002</p> <p>\u4f46\u662f\u6709\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a_end \u662f\u4e00\u4e2a extern \u7684\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u51fd\u6570\u4f53\u5916\u90e8\u7684\u64cd\u4f5c\u4f1a\u6539\u53d8\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u662f\u7f16\u8bd1\u5668\u8ba4\u4e3a\u5728\u672c\u51fd\u6570\u4e2d p \u5c31\u662f\u4e0d\u4f1a\u53d8\u7684\u4e86\uff0c\u8fdb\u800c\u5bfc\u81f4\u6709\u95ee\u9898\u7684\u4f18\u5316\u3002\u5982\u679c\u522b\u7684\u64cd\u4f5c\u6539\u53d8\u4e86 p \u7684\u503c\uff0c\u4f7f\u5176\u8df3\u8fc7\u6b7b\u5faa\u73af\u4e86\uff0c\u9700\u8981\u7528\u5230\u540e\u9762\u7684\u90a3\u51e0\u4e2a\u8d4b\u503c\u7684\u6570\u636e\uff0c\u4f46\u662f\u7f16\u8bd1\u5668\u4f18\u5316\u6389\u4e86\u5c31\u4f1a\u5bfc\u81f4\u6709\u95ee\u9898\u3002</p> <p>\u50cf\u9898\u76ee\u6240\u8bf4\u7684\uff0c\u5982\u679c_end\u8fd8\u662f\u4e00\u4e2a\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u5730\u5740\uff0c\u90a3CPU\u5c06\u65e0\u6cd5\u54cd\u5e94\u8bbe\u5907\u7684\u76f8\u5173\u884c\u4e3a\uff0c\u540e\u679c\u5f88\u4e25\u91cd\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_25","title":"\u72b6\u6001\u673a\u89c6\u89d2\u4e0b\u7684\u8f93\u5165\u8f93\u51fa","text":"<p>\u503c\u5f97\u9605\u8bfb</p> <p>\u6211\u4eec\u5728PA1\u4e2d\u63d0\u5230, \u8ba1\u7b97\u673a\u548c\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a\u72b6\u6001\u673a, \u8fd9\u4e2a\u72b6\u6001\u673a\u7684\u72b6\u6001\u53ef\u4ee5\u8868\u793a\u6210<code>S = &lt;R, M&gt;</code>, \u5176\u4e2d<code>R</code>\u662f\u5bc4\u5b58\u5668\u7684\u72b6\u6001, <code>M</code>\u662f\u5185\u5b58\u7684\u72b6\u6001. \u8ba1\u7b97\u673a\u6dfb\u52a0\u8f93\u5165\u8f93\u51fa\u7684\u529f\u80fd\u4e4b\u540e, \u6211\u4eec\u5e94\u8be5\u5982\u4f55\u7406\u89e3\u8f93\u5165\u8f93\u51fa\u7684\u884c\u4e3a\u5462?</p> <p>\u6211\u4eec\u53ef\u4ee5\u628a\u8bbe\u5907\u5206\u6210\u4e24\u90e8\u5206, \u4e00\u90e8\u5206\u662f\u6570\u5b57\u7535\u8def. \u6211\u4eec\u521a\u624d\u7c97\u7565\u5730\u4ecb\u7ecd\u4e86\u4e00\u4e9b\u8bbe\u5907\u63a7\u5236\u5668\u7684\u529f\u80fd, \u4f8b\u5982\u6211\u4eecCPU\u53ef\u4ee5\u4ece\u952e\u76d8\u63a7\u5236\u5668\u4e2d\u8bfb\u51fa\u6309\u952e\u4fe1\u606f. \u65e2\u7136\u662f\u6570\u5b57\u7535\u8def, \u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5176\u4e2d\u7684\u65f6\u5e8f\u903b\u8f91\u7535\u8def\u770b\u6210\u662f\u8bbe\u5907\u6570\u5b57\u7535\u8def\u90e8\u5206\u7684\u72b6\u6001<code>D</code>. \u4f46<code>D</code>\u6bd4\u8f83\u7279\u6b8a, \u8ba1\u7b97\u673a\u53ea\u80fd\u901a\u8fc7\u7aef\u53e3I/O\u6307\u4ee4\u6216\u8005\u5185\u5b58\u6620\u5c04I/O\u7684\u8bbf\u5b58\u6307\u4ee4\u6765\u8bbf\u95ee\u548c\u4fee\u6539<code>D</code>.</p> <p>\u6709\u610f\u601d\u7684\u662f\u8bbe\u5907\u7684\u53e6\u4e00\u90e8\u5206: \u6a21\u62df\u7535\u8def, \u5b83\u4e5f\u53ef\u4ee5\u6539\u53d8<code>D</code>. \u4f8b\u5982\u952e\u76d8\u901a\u8fc7\u68c0\u67e5\u6309\u952e\u4f4d\u7f6e\u7684\u7535\u5bb9\u53d8\u5316\u6765\u5224\u65ad\u662f\u5426\u6709\u6309\u952e\u88ab\u6309\u4e0b, \u82e5\u6709, \u5219\u4f1a\u5c06\u6309\u952e\u4fe1\u606f\u5199\u5165\u5230\u952e\u76d8\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u4e2d. \u800c\u6309\u952e\u4f4d\u7f6e\u7684\u7535\u5bb9\u662f\u5426\u53d1\u751f\u53d8\u5316, \u53c8\u662f\u7531\u7269\u7406\u4e16\u754c\u4e2d\u7684\u7528\u6237\u662f\u5426\u6309\u4e0b\u6309\u952e\u51b3\u5b9a\u7684. \u6240\u4ee5\u6211\u4eec\u4f1a\u8bf4, \u8bbe\u5907\u662f\u8fde\u63a5\u8ba1\u7b97\u673a\u548c\u7269\u7406\u4e16\u754c\u7684\u6865\u6881.</p> <pre><code>  \u72b6\u6001\u673a\u6a21\u578b           |           \u72b6\u6001\u673a\u6a21\u578b\u4e4b\u5916\n  S = &lt;R, M&gt;         |        D\n  \u8ba1\u7b97\u673a/\u7a0b\u5e8f  &lt;----I/O\u6307\u4ee4----&gt; \u8bbe\u5907 &lt;----\u6a21\u62df\u7535\u8def----&gt; \u7269\u7406\u4e16\u754c\n                     |\n                     |\n</code></pre> <p>\u8981\u5bf9\u8bbe\u5907\u7684\u72b6\u6001\u548c\u884c\u4e3a\u8fdb\u884c\u5efa\u6a21\u662f\u4e00\u4ef6\u5f88\u56f0\u96be\u7684\u4e8b\u60c5, \u9664\u4e86\u8bbe\u5907\u672c\u8eab\u7684\u884c\u4e3a\u4e94\u82b1\u516b\u95e8\u4e4b\u5916, \u8bbe\u5907\u7684\u72b6\u6001\u8fd8\u65f6\u65f6\u523b\u523b\u53d7\u5230\u7269\u7406\u4e16\u754c\u7684\u5f71\u54cd. \u4e8e\u662f, \u6211\u4eec\u5728\u5bf9\u72b6\u6001\u673a\u6a21\u578b\u7684\u884c\u4e3a\u8fdb\u884c\u6269\u5c55\u7684\u65f6\u5019, \u5e76\u4e0d\u8003\u8651\u5c06<code>D</code>\u52a0\u5165\u5230<code>S</code>\u4e2d, \u800c\u662f\u4ec5\u4ec5\u5bf9\u8f93\u5165\u8f93\u51fa\u76f8\u5173\u6307\u4ee4\u7684\u884c\u4e3a\u8fdb\u884c\u5efa\u6a21:</p> <ul> <li>\u6267\u884c\u666e\u901a\u6307\u4ee4\u65f6, \u72b6\u6001\u673a\u6309\u7167TRM\u7684\u6a21\u578b\u8fdb\u884c\u72b6\u6001\u8f6c\u79fb</li> <li>\u6267\u884c\u8bbe\u5907\u8f93\u51fa\u76f8\u5173\u7684\u6307\u4ee4(\u5982x86\u7684<code>out</code>\u6307\u4ee4\u6216\u8005RISC\u67b6\u6784\u7684MMIO\u5199\u6307\u4ee4)\u65f6, \u72b6\u6001\u673a\u9664\u4e86\u66f4\u65b0PC\u4e4b\u5916, \u5176\u5b83\u72b6\u6001\u5747\u4fdd\u6301\u4e0d\u53d8, \u4f46\u8bbe\u5907\u7684\u72b6\u6001\u548c\u7269\u7406\u4e16\u754c\u5219\u4f1a\u53d1\u751f\u76f8\u5e94\u7684\u53d8\u5316</li> <li>\u6267\u884c\u8bbe\u5907\u8f93\u5165\u76f8\u5173\u7684\u6307\u4ee4(\u5982x86\u7684<code>in</code>\u6307\u4ee4\u6216\u8005RISC\u67b6\u6784\u7684MMIO\u8bfb\u6307\u4ee4)\u65f6, \u72b6\u6001\u673a\u7684\u8f6c\u79fb\u5c06\u4f1a\"\u5206\u53c9\": \u72b6\u6001\u673a\u4e0d\u518d\u50cfTRM\u90a3\u6837\u6709\u552f\u4e00\u7684\u65b0\u72b6\u6001\u4e86, \u72b6\u6001\u673a\u5177\u4f53\u4f1a\u8f6c\u79fb\u5230\u54ea\u4e00\u4e2a\u65b0\u72b6\u6001, \u5c06\u53d6\u51b3\u4e8e\u6267\u884c\u8fd9\u6761\u6307\u4ee4\u65f6\u8bbe\u5907\u7684\u72b6\u6001</li> </ul> <p></p> <p>\u4f8b\u5982, \u4e0a\u56fe\u4e2d\u7684\u7a0b\u5e8f\u5c06\u8981\u6267\u884c\u6307\u4ee4<code>in addr, r</code>, \u8fd9\u6761\u6307\u4ee4\u5c06\u4f1a\u4ece\u8bbe\u5907\u5730\u5740<code>addr</code>\u4e2d\u8bfb\u5165\u4e00\u4e2a\u6570\u636e\u5230CPU\u7684\u5bc4\u5b58\u5668<code>r</code>\u4e2d. \u4e0d\u59a8\u5047\u8bbe\u8fd9\u4e2a\u8bbe\u5907\u5730\u5740\u5bf9\u5e94\u7684\u662f\u67d0\u952e\u76d8\u63a7\u5236\u5668, \u6267\u884c\u8fd9\u6761\u6307\u4ee4\u4e4b\u540e, <code>r</code>\u4e2d\u7684\u503c\u53ef\u80fd\u662f<code>0x01</code>, \u8868\u793a\u8bfb\u5230\"\u6309\u4e0b\u626b\u63cf\u7801\u4e3a1\u7684\u6309\u952e\"\u7684\u4fe1\u606f; \u4e5f\u53ef\u80fd\u662f<code>0x81</code>, \u8868\u793a\u8bfb\u5230\"\u91ca\u653e\u626b\u63cf\u7801\u4e3a1\u7684\u6309\u952e\"\u7684\u4fe1\u606f; \u4e5f\u53ef\u80fd\u662f<code>0x0</code>, \u8868\u793a\u6ca1\u6709\u4efb\u4f55\u6309\u952e\u4fe1\u606f. \u8fd9\u4e00\u6b65\u4e0d\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb\u4f1a\u5f71\u54cd\u5230\u540e\u7eed\u7a0b\u5e8f\u7684\u8fd0\u884c, \u4f8b\u5982\u67d0\u4e2a\u6e38\u620f\u4f1a\u6839\u636e\u8bfb\u5165\u7684\u6309\u952e\u4fe1\u606f\u51b3\u5b9a\u5982\u4f55\u54cd\u5e94, \u4f46\u4e0d\u96be\u7406\u89e3, \u6e38\u620f\u5982\u4f55\u54cd\u5e94\u90fd\u662f\u901a\u8fc7TRM\u4e2d\u666e\u901a\u7684\u8ba1\u7b97\u6307\u4ee4\u6765\u5b9e\u73b0\u7684, \u548c\u8f93\u5165\u8f93\u51fa\u6ca1\u6709\u5173\u7cfb.</p> <p>**\u8fd9\u4e2a\u6269\u5c55\u4e4b\u540e\u7684\u72b6\u6001\u673a\u6a21\u578b\u4ece\u5fae\u89c2\u7684\u89d2\u5ea6\u544a\u8bc9\u6211\u4eec, \u8bbe\u5907\u7684\u8f93\u5165\u8f93\u51fa\u90fd\u662f\u901a\u8fc7CPU\u7684\u5bc4\u5b58\u5668\u6765\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u7684. **</p> <p>\u8f93\u5165\u8f93\u51fa\u5bf9\u7a0b\u5e8f\u7684\u5f71\u54cd\u4e5f\u4ec5\u4ec5\u4f53\u73b0\u5728\u8f93\u5165\u65f6\u4f1a\u8fdb\u884c\u4e00\u6b21\u4e0d\u80fd\u63d0\u524d\u786e\u5b9a\u7684\u72b6\u6001\u8f6c\u79fb, \u8fd9\u57fa\u672c\u4e0a\u5c31\u662f\u7a0b\u5e8f\u773c\u4e2d\u8f93\u5165\u8f93\u51fa\u7684\u5168\u90e8.</p> <p>\u901a\u8fc7\u5185\u5b58\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u7684\u8f93\u5165\u8f93\u51fa</p> <p>\u6211\u4eec\u77e5\u9053<code>S = &lt;R, M&gt;</code>, \u4e0a\u6587\u4ecb\u7ecd\u7684\u7aef\u53e3I/O\u548c\u5185\u5b58\u6620\u5c04I/O\u90fd\u662f\u901a\u8fc7\u5bc4\u5b58\u5668<code>R</code>\u6765\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u7684. \u5f88\u81ea\u7136\u5730, \u6211\u4eec\u53ef\u4ee5\u8003\u8651, \u6709\u6ca1\u6709\u901a\u8fc7\u5185\u5b58<code>M</code>\u6765\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u7684\u8f93\u5165\u8f93\u51fa\u65b9\u5f0f\u5462?</p> <p>\u5176\u5b9e\u662f\u6709\u7684, \u8fd9\u79cd\u65b9\u5f0f\u53ebDMA. \u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd, \u4e00\u4e9b\u590d\u6742\u7684\u8bbe\u5907\u4e00\u822c\u90fd\u4f1a\u5e26\u6709DMA\u7684\u529f\u80fd. \u4e0d\u8fc7\u5728NEMU\u4e2d\u7684\u8bbe\u5907\u90fd\u6bd4\u8f83\u7b80\u5355, \u5173\u4e8eDMA\u7684\u7ec6\u8282\u6211\u4eec\u5c31\u4e0d\u5c55\u5f00\u4ecb\u7ecd\u4e86.</p>"},{"location":"ysyx/pa/pa2/pa2.html#nemu","title":"NEMU \u4e2d\u8f93\u5165\u548c\u8f93\u51fa","text":""},{"location":"ysyx/pa/pa2/pa2.html#io_2","title":"\u6620\u5c04\u548c I/O \u65b9\u5f0f","text":"<p>\u5185\u5b58\u548c\u5916\u8bbe\u5728CPU\u6765\u770b\u5e76\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c, \u53ea\u4e0d\u8fc7\u90fd\u662f\u4e00\u4e2a\u5b57\u8282\u7f16\u5740\u7684\u5bf9\u8c61\u800c\u5df2.</p> <p>\u4e0d\u7ba1\u662f <code>MMIO</code> \u548c <code>port-io</code> \u90fd\u662f\u8981\u901a\u8fc7 <code>map_read</code> \u548c <code>map_write</code> \u7684\uff0c</p>"},{"location":"ysyx/pa/pa2/pa2.html#_26","title":"\u8bbe\u5907","text":"<p>NEMU\u4f7f\u7528SDL\u5e93\u6765\u5b9e\u73b0\u8bbe\u5907\u7684\u6a21\u62df, <code>nemu/src/device/device.c</code>\u542b\u6709\u548cSDL\u5e93\u76f8\u5173\u7684\u4ee3\u7801. <code>init_device()</code>\u51fd\u6570\u4e3b\u8981\u8fdb\u884c\u4ee5\u4e0b\u5de5\u4f5c:</p> <ul> <li>\u8c03\u7528<code>init_map()</code>\u8fdb\u884c\u521d\u59cb\u5316.</li> <li>\u5bf9\u4e0a\u8ff0\u8bbe\u5907\u8fdb\u884c\u521d\u59cb\u5316, \u5176\u4e2d\u5728\u521d\u59cb\u5316VGA\u65f6\u8fd8\u4f1a\u8fdb\u884c\u4e00\u4e9b\u548cSDL\u76f8\u5173\u7684\u521d\u59cb\u5316\u5de5\u4f5c, \u5305\u62ec\u521b\u5efa\u7a97\u53e3, \u8bbe\u7f6e\u663e\u793a\u6a21\u5f0f\u7b49;</li> <li>\u7136\u540e\u4f1a\u8fdb\u884c\u5b9a\u65f6\u5668(alarm)\u76f8\u5173\u7684\u521d\u59cb\u5316\u5de5\u4f5c. \u5b9a\u65f6\u5668\u7684\u529f\u80fd\u5728PA4\u6700\u540e\u624d\u4f1a\u7528\u5230, \u76ee\u524d\u53ef\u4ee5\u5ffd\u7565\u5b83.</li> </ul> <p>\u53e6\u4e00\u65b9\u9762, <code>cpu_exec()</code>\u5728\u6267\u884c\u6bcf\u6761\u6307\u4ee4\u4e4b\u540e\u5c31\u4f1a\u8c03\u7528<code>device_update()</code>\u51fd\u6570, \u8fd9\u4e2a\u51fd\u6570\u9996\u5148\u4f1a\u68c0\u67e5\u8ddd\u79bb\u4e0a\u6b21\u8bbe\u5907\u66f4\u65b0\u662f\u5426\u5df2\u7ecf\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4, \u82e5\u662f, \u5219\u4f1a\u5c1d\u8bd5\u5237\u65b0\u5c4f\u5e55, \u5e76\u8fdb\u4e00\u6b65\u68c0\u67e5\u662f\u5426\u6709\u6309\u952e\u6309\u4e0b/\u91ca\u653e, \u4ee5\u53ca\u662f\u5426\u70b9\u51fb\u4e86\u7a97\u53e3\u7684<code>X</code>\u6309\u94ae; \u5426\u5219\u5219\u76f4\u63a5\u8fd4\u56de, \u907f\u514d\u68c0\u67e5\u8fc7\u4e8e\u9891\u7e41, \u56e0\u4e3a\u4e0a\u8ff0\u4e8b\u4ef6\u53d1\u751f\u7684\u9891\u7387\u662f\u5f88\u4f4e\u7684</p>"},{"location":"ysyx/pa/pa2/pa2.html#ioe","title":"\u5c06\u8f93\u5165\u8f93\u51fa\u62bd\u8c61\u6210 IOE","text":"<p>\u8bbe\u5907\u8bbf\u95ee\u7684\u5177\u4f53\u5b9e\u73b0\u662f\u67b6\u6784\u76f8\u5173\u7684, \u6bd4\u5982NEMU\u7684VGA\u663e\u5b58\u4f4d\u4e8e\u7269\u7406\u5730\u5740\u533a\u95f4<code>[0xa1000000, 0xa1080000)</code>, \u4f46\u5bf9<code>native</code>\u7684\u7a0b\u5e8f\u6765\u8bf4, \u8fd9\u662f\u4e00\u4e2a\u4e0d\u53ef\u8bbf\u95ee\u7684\u975e\u6cd5\u533a\u95f4, \u56e0\u6b64<code>native</code>\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u522b\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7c7b\u4f3c\u7684\u529f\u80fd. </p> <p>\u81ea\u7136\u5730, \u8bbe\u5907\u8bbf\u95ee\u8fd9\u4e00\u67b6\u6784\u76f8\u5173\u7684\u529f\u80fd, \u5e94\u8be5\u5f52\u5165AM\u4e2d. \u4e0eTRM\u4e0d\u540c, \u8bbe\u5907\u8bbf\u95ee\u662f\u4e3a\u8ba1\u7b97\u673a\u63d0\u4f9b\u8f93\u5165\u8f93\u51fa\u7684\u529f\u80fd, \u56e0\u6b64\u6211\u4eec\u628a\u5b83\u4eec\u5212\u5165\u4e00\u7c7b\u65b0\u7684API, \u540d\u5b57\u53ebIOE(I/O Extension).</p> <p>\u8981\u5982\u4f55\u5bf9\u4e0d\u540c\u67b6\u6784\u7684\u8bbe\u5907\u8bbf\u95ee\u62bd\u8c61\u6210\u7edf\u4e00\u7684API\u5462? </p> <p>\u56de\u60f3\u4e00\u4e0b\u5728\u7a0b\u5e8f\u770b\u6765, \u8bbf\u95ee\u8bbe\u5907\u5176\u5b9e\u60f3\u505a\u4ec0\u4e48: \u8bbf\u95ee\u8bbe\u5907 = \u8bfb\u51fa\u6570\u636e + \u5199\u5165\u6570\u636e + \u63a7\u5236\u72b6\u6001. </p> <p>\u8fdb\u4e00\u6b65\u7684, \u63a7\u5236\u72b6\u6001\u672c\u8d28\u4e0a\u4e5f\u662f\u8bfb/\u5199\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u64cd\u4f5c, \u6240\u4ee5\u8bbf\u95ee\u8bbe\u5907 = \u8bfb/\u5199\u64cd\u4f5c.</p> <pre><code>bool ioe_init();\nvoid ioe_read(int reg, void *buf);\nvoid ioe_write(int reg, void *buf);\n</code></pre> <ol> <li> <p>\u7b2c\u4e00\u4e2aAPI\u7528\u4e8e\u8fdb\u884cIOE\u76f8\u5173\u7684\u521d\u59cb\u5316\u64cd\u4f5c. \u540e\u4e24\u4e2aAPI\u5206\u522b\u7528\u4e8e\u4ece\u7f16\u53f7\u4e3areg\u7684\u5bc4\u5b58\u5668\u4e2d\u8bfb\u51fa\u5185\u5bb9\u5230\u7f13\u51b2\u533abuf\u4e2d, \u4ee5\u53ca\u5f80\u7f16\u53f7\u4e3areg\u5bc4\u5b58\u5668\u4e2d\u5199\u5165\u7f13\u51b2\u533abuf\u4e2d\u7684\u5185\u5bb9. </p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f, \u8fd9\u91cc\u7684reg\u5bc4\u5b58\u5668\u5e76\u4e0d\u662f\u4e0a\u6587\u8ba8\u8bba\u7684\u8bbe\u5907\u5bc4\u5b58\u5668, \u56e0\u4e3a\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u7f16\u53f7\u662f\u67b6\u6784\u76f8\u5173\u7684. </p> <p>\u5728IOE\u4e2d, \u6211\u4eec\u5e0c\u671b\u91c7\u7528\u4e00\u79cd\u67b6\u6784\u65e0\u5173\u7684\"\u62bd\u8c61\u5bc4\u5b58\u5668\", \u8fd9\u4e2areg\u5176\u5b9e\u662f\u4e00\u4e2a\u529f\u80fd\u7f16\u53f7, \u6211\u4eec\u7ea6\u5b9a\u5728\u4e0d\u540c\u7684\u67b6\u6784\u4e2d, \u540c\u4e00\u4e2a\u529f\u80fd\u7f16\u53f7\u7684\u542b\u4e49\u4e5f\u662f\u76f8\u540c\u7684, \u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u62bd\u8c61.</p> </li> <li> <p><code>abstract-machine/am/include/amdev.h</code>\u4e2d\u5b9a\u4e49\u4e86\u5e38\u89c1\u8bbe\u5907\u7684\"\u62bd\u8c61\u5bc4\u5b58\u5668\"\u7f16\u53f7\u548c\u76f8\u5e94\u7684\u7ed3\u6784.</p> <pre><code>#define AM_DEVREG(id, reg, perm, ...) \\\n  enum { AM_##reg = (id) }; \\\n  typedef struct { __VA_ARGS__; } AM_##reg##_T;\n\nAM_DEVREG( 1, UART_CONFIG,  RD, bool present);\nAM_DEVREG( 2, UART_TX,      WR, char data);\nAM_DEVREG( 3, UART_RX,      RD, char data);\nAM_DEVREG( 4, TIMER_CONFIG, RD, bool present, has_rtc);\nAM_DEVREG( 5, TIMER_RTC,    RD, int year, month, day, hour, minute, second);\nAM_DEVREG( 6, TIMER_UPTIME, RD, uint64_t us);\n...\n</code></pre> <p>\u8fd9\u4e9b\u5b9a\u4e49\u662f\u67b6\u6784\u65e0\u5173\u7684, \u6bcf\u4e2a\u67b6\u6784\u5728\u5b9e\u73b0\u5404\u81ea\u7684IOE API\u65f6, \u90fd\u9700\u8981\u9075\u5faa\u8fd9\u4e9b\u5b9a\u4e49(\u7ea6\u5b9a). </p> <p>\u4e3a\u4e86\u65b9\u4fbf\u5730\u5bf9\u8fd9\u4e9b\u62bd\u8c61\u5bc4\u5b58\u5668\u8fdb\u884c\u8bbf\u95ee, klib\u4e2d\u63d0\u4f9b\u4e86 <code>io_read()</code> \u548c <code>io_write()</code> \u8fd9\u4e24\u4e2a\u5b8f, \u5b83\u4eec\u5206\u522b\u5bf9<code>ioe_read()</code>\u548c<code>ioe_write()</code>\u8fd9\u4e24\u4e2aAPI\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5.</p> </li> <li> <p>\u7279\u522b\u5730, NEMU\u4f5c\u4e3a\u4e00\u4e2a\u5e73\u53f0, \u8bbe\u5907\u7684\u884c\u4e3a\u662f\u4e0eISA\u65e0\u5173\u7684.</p> <p>\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u5728<code>abstract-machine/am/src/platform/nemu/ioe/</code>\u76ee\u5f55\u4e0b\u5b9e\u73b0\u4e00\u4efdIOE, \u6765\u4f9bNEMU\u5e73\u53f0\u7684\u67b6\u6784\u5171\u4eab.</p> <p>\u5176\u4e2d, <code>abstract-machine/am/src/platform/nemu/ioe/ioe.c</code>\u4e2d\u5b9e\u73b0\u4e86\u4e0a\u8ff0\u7684\u4e09\u4e2aIOE API, <code>ioe_read()</code>\u548c<code>ioe_write()</code>\u90fd\u662f\u901a\u8fc7\u62bd\u8c61\u5bc4\u5b58\u5668\u7684\u7f16\u53f7\u7d22\u5f15\u5230\u4e00\u4e2a\u5904\u7406\u51fd\u6570, \u7136\u540e\u8c03\u7528\u5b83. </p> </li> </ol> <p>\u7279\u522b\u7406\u6e05\u4e00\u4e0b\u8fd9\u4e9b\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u5185\u5bb9\uff1a</p> <p>\u7279\u522b\u518d\u6b21\u7406\u89e3\u4ee5\u4e0bAM\u7684\u4f5c\u7528\uff0cISA\u548c\u5e73\u53f0\u4e4b\u95f4\u600e\u4e48\u4e92\u76f8\u4f5c\u7528</p> <pre><code>abstract-machine/am/src/platform/nemu/ioe/\nabstract-machine/am/include/amdev.h\n</code></pre>"},{"location":"ysyx/pa/pa2/pa2.html#_27","title":"\u4e32\u53e3","text":"<ul> <li> <p>\u5fc5\u505a</p> <p>\u8fd0\u884cHello World</p> <p>\u5982\u679c\u4f60\u9009\u62e9\u4e86x86, \u4f60\u9700\u8981\u5b9e\u73b0<code>in</code>, <code>out</code>\u6307\u4ee4. \u5177\u4f53\u5730, \u4f60\u9700\u8981RTFSC, \u7136\u540e\u5728<code>in</code>\u6307\u4ee4\u548c<code>out</code>\u6307\u4ee4\u7684\u5b9e\u73b0\u4e2d\u6b63\u786e\u8c03\u7528<code>pio_read()</code>\u548c<code>pio_write()</code>. \u5982\u679c\u4f60\u9009\u62e9\u7684\u662fmips32\u548criscv32, \u4f60\u4e0d\u9700\u8981\u5b9e\u73b0\u989d\u5916\u7684\u4ee3\u7801, \u56e0\u4e3aNEMU\u7684\u6846\u67b6\u4ee3\u7801\u5df2\u7ecf\u652f\u6301MMIO\u4e86.</p> <p>\u5b9e\u73b0\u540e, \u5728<code>am-kernels/kernels/hello/</code>\u76ee\u5f55\u4e0b\u952e\u5165</p> <pre><code>make ARCH=$ISA-nemu run\n</code></pre> <p>\u5982\u679c\u4f60\u7684\u5b9e\u73b0\u6b63\u786e, \u4f60\u5c06\u4f1a\u770b\u5230\u7a0b\u5e8f\u5f80\u7ec8\u7aef\u8f93\u51fa\u4e00\u4e9b\u4fe1\u606f(\u8bf7\u6ce8\u610f\u4e0d\u8981\u8ba9\u8f93\u51fa\u6df9\u6ca1\u5728\u8c03\u8bd5\u4fe1\u606f\u4e2d).</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f, \u8fd9\u4e2ahello\u7a0b\u5e8f\u548c\u6211\u4eec\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u5199\u7684\u7b2c\u4e00\u4e2ahello\u7a0b\u5e8f\u6240\u5904\u7684\u62bd\u8c61\u5c42\u6b21\u662f\u4e0d\u4e00\u6837\u7684: </p> <p>\u8fd9\u4e2ahello\u7a0b\u5e8f\u53ef\u4ee5\u8bf4\u662f\u76f4\u63a5\u8fd0\u884c\u5728\u88f8\u673a\u4e0a, \u53ef\u4ee5\u5728AM\u7684\u62bd\u8c61\u4e4b\u4e0a\u76f4\u63a5\u8f93\u51fa\u5230\u8bbe\u5907(\u4e32\u53e3); </p> <p>\u56de\u60f3\u4e00\u4e0b\u73a9\u5d4c\u5165\u5f0f\u7684\u65f6\u5019\u7528\u4e32\u53e3\u6253\u5370\u7684\u64cd\u4f5c\u3002</p> <p>\u65e0\u8bba\u600e\u4e48\u6837\uff0c\u6211\u4eec\u90fd\u9700\u8981\u4e00\u4e2a\u4e1c\u897f\u6765\u663e\u793a\u8f93\u51fa\uff0c\u5c4f\u5e55\u3001\u4e32\u53e3\u52a9\u624b\u3002</p> <p>\u6211\u4eec\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u5199\u7684hello\u7a0b\u5e8f\u4f4d\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a, \u4e0d\u80fd\u76f4\u63a5\u64cd\u4f5c\u8bbe\u5907, \u53ea\u80fd\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u8fdb\u884c\u8f93\u51fa, \u8f93\u51fa\u7684\u6570\u636e\u8981\u7ecf\u8fc7\u5f88\u591a\u5c42\u62bd\u8c61\u624d\u80fd\u5230\u8fbe\u8bbe\u5907\u5c42. \u6211\u4eec\u4f1a\u5728PA3\u4e2d\u8fdb\u4e00\u6b65\u4f53\u4f1a\u64cd\u4f5c\u7cfb\u7edf\u7684\u4f5c\u7528.</p> <p>\u672a\u6765\u770b\u770b</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>ARCH= riscv32-nemu\u7684\u65f6, \u4e3a\u4ec0\u4e48putch \u6267\u884c\u8fd9\u4e2a\u5c31\u80fd\u6253\u5370\u6570\u636e\u5230\u5c4f\u5e55\u3002</p> <p><code>C void putch(char ch) {   outb(SERIAL_PORT, ch); }</code> </p> <p>```C // load static inline uint8_t  inb(uintptr_t addr) { return (volatile uint8_t  )addr; } static inline uint16_t inw(uintptr_t addr) { return (volatile uint16_t )addr; } static inline uint32_t inl(uintptr_t addr) { return (volatile uint32_t )addr; }</p> <p>// store static inline void outb(uintptr_t addr, uint8_t  data) { (volatile uint8_t  )addr = data; } static inline void outw(uintptr_t addr, uint16_t data) { (volatile uint16_t )addr = data; } static inline void outl(uintptr_t addr, uint32_t data) { (volatile uint32_t )addr = data; } <pre><code>\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u6b21\u8bbf\u5b58\u64cd\u4f5c\uff0c\u5f80\u8fd9\u4e2a\u5730\u5740\u5199\u5185\u5bb9\uff0c\u8f93\u51fa\u5230\u4e3b\u673a\u7684\u7ec8\u7aef\u4e0a\u3002\n\n\u8bb2\u4e49\uff1a\u6bcf\u5f53CPU\u5f80\u6570\u636e\u5bc4\u5b58\u5668\u4e2d\u5199\u5165\u6570\u636e\u65f6, \u4e32\u53e3\u4f1a\u5c06\u6570\u636e\u4f20\u9001\u5230\u4e3b\u673a\u7684\u6807\u51c6\u9519\u8bef\u6d41\u8fdb\u884c\u8f93\u51fa\u3002`nemu/src/device/serial.c`\n\n```C\nstatic void serial_putc(char ch) {\n   MUXDEF(CONFIG_TARGET_AM, putch(ch), putc(ch, stderr));\n}\n</code></pre></p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u8bbe\u5907\u548cDiffTest</p> <p>\u5728\u72b6\u6001\u673a\u89c6\u89d2\u4e0b, \u6267\u884c\u4e00\u6761\u8f93\u5165\u6307\u4ee4\u4f1a\u8ba9\u72b6\u6001\u673a\u7684\u72b6\u6001\u8f6c\u79fb\u53d8\u5f97\u4e0d\u552f\u4e00, \u65b0\u72b6\u6001\u53d6\u51b3\u4e8e\u8bbe\u5907\u7684\u72b6\u6001. \u7531\u4e8eNEMU\u4e2d\u8bbe\u5907\u7684\u884c\u4e3a\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684, \u4e0eREF\u4e2d\u7684\u6807\u51c6\u8bbe\u5907\u7684\u884c\u4e3a\u4e0d\u5b8c\u5168\u4e00\u6837 (\u4f8b\u5982NEMU\u4e2d\u7684\u4e32\u53e3\u603b\u662f\u5c31\u7eea\u7684, \u4f46QEMU\u4e2d\u7684\u4e32\u53e3\u4e5f\u8bb8\u5e76\u4e0d\u662f\u8fd9\u6837), \u8fd9\u5bfc\u81f4\u5728NEMU\u4e2d\u6267\u884c\u8f93\u5165\u6307\u4ee4\u7684\u7ed3\u679c\u4f1a\u548cREF\u6709\u6240\u4e0d\u540c. </p> <p>\u4e3a\u4e86\u4f7f\u5f97DiffTest\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c, \u6846\u67b6\u4ee3\u7801\u5728\u8bbf\u95ee\u8bbe\u5907\u7684\u8fc7\u7a0b\u4e2d\u8c03\u7528\u4e86<code>difftest_skip_ref()</code>\u51fd\u6570 (\u89c1<code>nemu/include/device/map.h</code>\u4e2d\u5b9a\u4e49\u7684<code>find_mapid_by_addr()</code>\u51fd\u6570)\u6765\u8df3\u8fc7\u4e0eREF\u7684\u68c0\u67e5.</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u7406\u89e3mainargs</p> <p>\u8bf7\u4f60\u901a\u8fc7RTFSC\u7406\u89e3\u8fd9\u4e2a\u53c2\u6570\u662f\u5982\u4f55\u4ece<code>make</code>\u547d\u4ee4\u4e2d\u4f20\u9012\u5230<code>hello</code>\u7a0b\u5e8f\u4e2d\u7684, </p> <p><code>$ISA-nemu</code>\u548c<code>native</code>\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u4f20\u9012\u65b9\u6cd5, \u90fd\u503c\u5f97\u4f60\u53bb\u4e86\u89e3\u4e00\u4e0b.</p> <ol> <li> <p>riscv32-nemu</p> <ol> <li> <p>C\u51fd\u6570\u600e\u4e48\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\uff1a</p> <p>am/src/riscv/nemu/start.S  ---&gt;  am/src/platform/nemu/trm.c (trm_init())\u8fd9\u91cc\u7684main\u51fd\u6570</p> <pre><code>...\n#ifndef MAINARGS\n#define MAINARGS \"\"\n#endif\nstatic const char mainargs[] = MAINARGS;\n\nvoid putch(char ch) {\n  outb(SERIAL_PORT, ch);\n}\n\nvoid halt(int code) {\n  nemu_trap(code);\n\n  // should not reach here\n  while (1);\n}\n\nvoid _trm_init() {\n  int ret = main(mainargs);\n  halt(ret);\n}        \n</code></pre> </li> <li> <p>\u90a3\u600e\u4e48\u901a\u8fc7shell\u4f20\u8fdb\u6765\u8fd9\u4e2a\u5b8fMAINARGS\uff1f</p> <p>gcc\u521a\u597d\u5c31\u6709\u8fd9\u4e2a\u6807\u5fd7 <code>-D name=definition</code></p> <p>\u770b\u770b Makefile \u91cc\u6709\u6ca1\u6709\uff1f</p> <pre><code>CFLAGS += -DMAINARGS=\\\"$(mainargs)\\\"\nCFLAGS += -I$(AM_HOME)/am/src/platform/nemu/include\n\n//abstract-machine/scripts/platform/nemu.mk \n</code></pre> </li> <li> <p>\u5927\u6982\u6e05\u695a\u6d41\u7a0b</p> <p>shell \u63a5\u6536 mainargs \u53c2\u6570\u4e4b\u540e\uff0c\u4f20\u7ed9\u81ea\u52a8\u5316\u6784\u5efa\u5de5\u5177 make\uff0cmake \u518d\u653e\u5230Makefile\u91cc\u3002\u4e4b\u540e run\uff0c\u8fdb\u884c\u81ea\u52a8\u5316\u6784\u5efa\u7684\u65f6\u5019\uff0c\u9884\u5904\u7406\u5668\u9636\u6bb5\u5c06\u8fd9\u4e2a\u5b8f\u6dfb\u52a0\u5230\u6e90\u4ee3\u7801\u4e2d\u53bb\uff0c\u8fd9\u6837\u5b50\u7b2c\u4e00\u70b9\u4e2d\u7684\u5b8f MAINARGS \u5c31\u6709\u3002</p> </li> </ol> </li> <li> <p>native</p> <p>shell\u5230makefile\u4f20\u8fdb\u6765mainargs\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u4e0d\u540c\u7684\u662f\u600e\u4e48\u8fdb\u5165C\u51fd\u6570\u3002</p> <p>\u4e0d\u5bf9\uff01\u4e0a\u9762\u662fnemu\u7684\u3002\u4f46\u8fd8\u662f\u4ece\u51fd\u6570\u5f80\u4e0b\u5f00\u59cb\u5206\u6790\u5427\u3002</p> <p>\u7528 -nB \u548c\u7528 grep \u90fd\u627e\u5230\u4e86platform.c/.o\u4e0b\u9762\u8fd9\u4e2a\u5185\u5bb9\uff1a</p> <p>native\u7528\u7684\u662f \u5e93\u51fd\u6570\u91cc\u7684 <code>getenv</code></p> <pre><code>static void init_platform() __attribute__((constructor));\nstatic void init_platform() {\n    ......\n    const char *args = getenv(\"mainargs\");\n    halt(main(args ? args : \"\")); // call main here!\n}\n//src/native/platform.c\n</code></pre> <p></p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u51fd\u6570\u6211\u6709\u70b9\u8ff7\u60d1\uff0c \u5b83\u7684\u4f5c\u7528\u4e0d\u662f\u627e\u5230\u7279\u5b9a\u540d\u79f0\u7684\u73af\u5883\u53d8\u91cf\u53ca\u503c\u5417\uff0c\u4f46\u662f\u8fd9\u4e2amainargs \u662f\u7531\u6211\u5728 shell \u8f93\u5165\u7684\uff0c\u8fd9\u662f\u73af\u5883\u53d8\u91cf\u5417\uff1fRTFW\u3002</p> <p>\u770b\u5230\u8fd9\u4e2anative\u76f8\u5173  \u7684\u4ee3\u7801\uff0c\u611f\u89c9\u597d\u50cf\u53c8\u6389\u8fdb\u4e86\u4e0d\u77e5\u9053\u4ec0\u4e48\u5751\u3002C++\u91cc\u7684\u6784\u9020\u51fd\u6570\uff1f</p> <p>\u5b83\u7684trm_init() \u8c03\u7528\u7684\u662f\u8fd9\u4e2a\uff1a</p> <pre><code>// This dummy function will be called in trm.c.\n// The purpose of this dummy function is to let linker add this file to the object\n// file set. Without it, the constructor of @_init_platform will not be linked.\nvoid __am_platform_dummy() {             \n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b9e\u9645\u7531 init_platform\u6765\u505a\u4e86\u8c03\u7528main\u51fd\u6570\u53c2\u6570\u7684\u4e8b\u60c5\uff0c\u6709\u56de\u5230\u4e0a\u9762\u7684\u5185\u5bb9\u3002\u5148\u522b\u7ba1native\u7684\u76f8\u5173\u4ee3\u7801\u3002</p> <p>\u73b0\u5728\u5173\u952e\u7684\u662f\u8fd9\u4e2amainargs\uff0c\u4e3a\u4ec0\u4e48\u662f\u73af\u5883\u53d8\u91cf\uff1f</p> <p></p> <p>\u7f51\u4e0a\u627e\u4e86\u4e00\u5806\uff0c\u6ca1\u770b\u5230\u6709\u4ec0\u4e48\u4eba\u8bb2\uff0c\u7ffb\u624b\u518c\u770b\u770b</p> <p>Environment Variables (opengroup.org)</p> <p></p> <p>\u5927\u6982\u4e5f\u80fd\u660e\u767d\uff0c\u547d\u4ee4\u884c\u4e2d\u8bbe\u7f6e\u7684\u53d8\u91cf\uff08\u4f9d\u7136\u8981\u5f62\u5982: name=value \u4e0d\u80fd\u6709\u7a7a\u683c\uff0cmakefile\u4e2d\u7684\u53ef\u4ee5\u6709\uff09\uff0c\u8fd9\u4e9b\u53d8\u91cf\u7684\u503c\u88ab\u4f20\u9012\u7ed9make\u5de5\u5177\uff0c\u5e76\u5728make\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u6bcf\u4e2a make \u8c03\u7528\u7684\u547d\u4ee4\u7684\u73af\u5883\u4e2d\u3002</p> <p>\u989d\u5916\u53d1\u73b0\u4e00\u4e2a\u597d\u73a9\u7684\uff1a</p> <p>Variables in make can come from the environment in which make is run. Every environment variable that make sees when it starts up is transformed into a make variable with the same name and value. However, an explicit assignment in the makefile, or with a command argument, overrides the environment. (If the \u2018-e\u2019 flag is specified, then values from the environment override assignments in the makefile. See Section 9.8 [Summary of Options], page 114. But this is not recommended practice.)  </p> <p>\u4f1a\u5c06\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\u8f6c\u5230makefile\u91cc\uff1f\u505a\u4e2a\u5b9e\u9a8c\uff1a</p> <pre><code>$(DST_DIR)/%.o: %.c\n+   echo $(NVBOARD_HOME)\n    @mkdir -p $(dir $@) &amp;&amp; echo + CC $&lt;                               \n    @$(CC) -std=gnu11 $(CFLAGS) -c -o $@ $(realpath $&lt;)\n    \n//abstract-machine/Makefile\n</code></pre> <p>\u5728\u548cam\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u80af\u5b9a\u662f\u6ca1\u6709\u8fd9\u4e2aNVBOARD\uff08\u8fd9\u662f\u6211\u7684\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff09</p> <p>\u7ed3\u679c\uff1a</p> <p>\u597d\u4e86\u5927\u6982\u61c2\u4e86\u3002\u5173\u952e\u5c31\u662f\u8fd9\u4e2a\u51fd\u6570 <code>getenv</code> \u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u4e0b\uff0c\u7279\u5b9a\u540d\u79f0\u7684\u73af\u5883\u53d8\u91cf</p> </li> </ol> </li> </ul> <p>\u5fc5\u505a\u9898\uff1a</p> <ol> <li> <p>\u5b9e\u73b0printf</p> <p>\u6709\u4e86<code>putch()</code>, \u6211\u4eec\u5c31\u53ef\u4ee5\u5728klib\u4e2d\u5b9e\u73b0<code>printf()</code>\u4e86.</p> <p>\u4f60\u4e4b\u524d\u5df2\u7ecf\u5b9e\u73b0\u4e86<code>sprintf()</code>\u4e86, \u5b83\u548c<code>printf()</code>\u7684\u529f\u80fd\u975e\u5e38\u76f8\u4f3c, \u8fd9\u610f\u5473\u7740\u5b83\u4eec\u4e4b\u95f4\u4f1a\u6709\u4e0d\u5c11\u91cd\u590d\u7684\u4ee3\u7801. \u4f60\u5df2\u7ecf\u89c1\u8bc6\u5230Copy-Paste\u7f16\u7a0b\u4e60\u60ef\u7684\u574f\u5904\u4e86, \u601d\u8003\u4e00\u4e0b, \u5982\u4f55\u7b80\u6d01\u5730\u5b9e\u73b0\u5b83\u4eec\u5462?</p> <p>\u5b9e\u73b0\u4e86<code>printf()</code>\u4e4b\u540e, \u4f60\u5c31\u53ef\u4ee5\u5728AM\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u8f93\u51fa\u8c03\u8bd5\u6cd5\uff08 \u56de\u53bbPA2.2 klibtests\u770b\u770b\u6d4b\u8bd5\uff1f\uff09\u4e86. </p> </li> <li> <p>\u8fd0\u884calu-tests</p> <p>\u6211\u4eec\u5728<code>am-kernels/tests/alu-tests/</code>\u76ee\u5f55\u4e0b\u79fb\u690d\u4e86\u4e00\u4e2a\u4e13\u95e8\u6d4b\u8bd5\u5404\u79cdC\u8bed\u8a00\u8fd0\u7b97\u7684\u7a0b\u5e8f, \u5b9e\u73b0<code>printf()</code>\u540e\u4f60\u5c31\u53ef\u4ee5\u8fd0\u884c\u5b83\u4e86. \u7f16\u8bd1\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u82b1\u8d391\u5206\u949f.</p> </li> </ol> <ul> <li> <p>\u5b9e\u73b0 printf </p> <p>\u6211\u60f3\u80fd\u4e0d\u80fd\u501f\u52a9 <code>sprintf</code> \u6765\u5b9e\u73b0 <code>printf</code> \uff0c\u6700\u5927\u7684\u95ee\u9898\uff0c\u600e\u4e48\u4f20\u53c2\uff1f</p> <p>\u7528vsprintf\u8fd9\u79cd</p> <p>vsprintf\u548c sprintf\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u591a\u4e86\u4e2av\uff1f\u6307\u7684\u662f\u4ec0\u4e48\uff1f</p> <pre><code>int printf(const char *fmt, ...) {\n    char buf[256];\n    va_list args;\n    va_start(args, fmt);\n    int len = vsprintf(buf, fmt, args);\n    for (int i = 0; i &lt; len; i++) {\n        putch(buf[i]);\n    }\n    va_end(args);\n    return 0; // \u8fd4\u56de\u503c\u901a\u5e38\u4e3a\u5199\u5165\u7684\u5b57\u7b26\u6570\uff0c\u8fd9\u91cc\u7b80\u5316\u5904\u7406\n}\n</code></pre> <p>\u8fd9\u91cc\u7684\u5b9e\u73b0\u597d\u50cf\u8fd8\u662f\u6709\u70b9\u95ee\u9898\u7684\uff0c\u7559\u5751\uff0c\u4e4b\u540e\u518d\u770b\u770b\u3002</p> <p>c/c++\u4e2dprintf\u51fd\u6570\u7684\u5e95\u5c42\u5b9e\u73b0_printf\u5e95\u5c42\u5b9e\u73b0-CSDN\u535a\u5ba2</p> <p>printf\u51fd\u6570\u5b9e\u73b0\u7684\u6df1\u5165\u5256\u6790 - \u5f20\u540c\u5149 - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>sscanf \u548c sprintf \u51fd\u6570\uff0c\u672c\u8d28\u4e0a\u5728\u505a\u7684\u662f\u4ee5\u5b57\u7b26\u4e32\u4e3a\u4e2d\u95f4\u503c\uff0c\u505a\u5404\u79cd\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u81ea\u5b66c\u8bed\u8a00\u7684\u65f6\u5019\uff0c\u8fd8\u771f\u6ca1\u600e\u4e48\u91cd\u89c6\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_28","title":"\u65f6\u949f","text":"<p>\u600e\u4e48\u505a\u5230\u8ba1\u65f6\u7684\uff1a\u7528\u8fd9\u4e2a\u82af\u7247\u8ba1\u65f6\u5668\uff08i8253\uff09</p> <p>\u6709\u65f6\u949f, \u7a0b\u5e8f\u624d\u53ef\u4ee5\u63d0\u4f9b\u65f6\u95f4\u76f8\u5173\u7684\u4f53\u9a8c</p> <p>\u4f8b\u5982\u6e38\u620f\u7684\u5e27\u7387, \u7a0b\u5e8f\u7684\u5feb\u6162\u7b49. <code>nemu/src/device/timer.c</code>\u6a21\u62df\u4e86i8253\u8ba1\u65f6\u5668\u7684\u529f\u80fd. </p> <p>\u8ba1\u65f6\u5668\u7684\u5927\u90e8\u5206\u529f\u80fd\u90fd\u88ab\u7b80\u5316, \u53ea\u4fdd\u7559\u4e86\"\u53d1\u8d77\u65f6\u949f\u4e2d\u65ad\"\u7684\u529f\u80fd(\u76ee\u524d\u6211\u4eec\u4e0d\u4f1a\u7528\u5230). </p> <p>\u540c\u65f6\u6dfb\u52a0\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u65f6\u949f. i8253\u8ba1\u65f6\u5668\u521d\u59cb\u5316\u65f6\u4f1a\u5206\u522b\u6ce8\u518c<code>0x48</code>\u5904\u957f\u5ea6\u4e3a8\u4e2a\u5b57\u8282\u7684\u7aef\u53e3, \u4ee5\u53ca<code>0xa0000048</code>\u5904\u957f\u5ea6\u4e3a8\u5b57\u8282\u7684MMIO\u7a7a\u95f4, \u5b83\u4eec\u90fd\u4f1a\u6620\u5c04\u5230\u4e24\u4e2a32\u4f4d\u7684RTC\u5bc4\u5b58\u5668. CPU\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u6765\u83b7\u5f97\u752864\u4f4d\u8868\u793a\u7684\u5f53\u524d\u65f6\u95f4.</p> <p>\u5c0f\u64cd\u4f5c</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u8bbe\u7f6e\u4e00\u4e2a64\u4f4d\u7684RTC\u5bc4\u5b58\u5668?</p> <p>\u6211\u4eec\u5e0c\u671b\u8bbe\u5907\u7684\u8bbe\u8ba1\u4e0eCPU\u89e3\u8026, \u65e0\u8bba\u8bbe\u5907\u63a5\u5165\u5230\u4f55\u79cd\u67b6\u6784\u7684CPU\u90fd\u80fd\u5de5\u4f5c. \u4f4632\u4f4d\u7684CPU\u65e0\u6cd5\u4e00\u6b21\u8bbf\u95ee64\u4f4d\u7684\u8bbe\u5907\u5bc4\u5b58\u5668, \u56e0\u6b64\u5c06\u4e00\u4e2a64\u4f4d\u7684\u529f\u80fd\u62c6\u5206\u6210\u4e24\u4e2a32\u4f4d\u7684\u8bbe\u5907\u5bc4\u5b58\u5668, \u53ef\u540c\u65f6\u652f\u6301\u63a5\u516532\u4f4d\u548c64\u4f4dCPU.</p> <p><code>abstract-machine/am/include/amdev.h</code>\u4e2d\u4e3a\u65f6\u949f\u7684\u529f\u80fd\u5b9a\u4e49\u4e86\u4e24\u4e2a\u62bd\u8c61\u5bc4\u5b58\u5668:</p> <ul> <li><code>AM_TIMER_RTC</code>, AM\u5b9e\u65f6\u65f6\u949f(RTC, Real Time Clock), \u53ef\u8bfb\u51fa\u5f53\u524d\u7684\u5e74\u6708\u65e5\u65f6\u5206\u79d2. PA\u4e2d\u6682\u4e0d\u4f7f\u7528.</li> <li><code>AM_TIMER_UPTIME</code>, AM\u7cfb\u7edf\u542f\u52a8\u65f6\u95f4, \u53ef\u8bfb\u51fa\u7cfb\u7edf\u542f\u52a8\u540e\u7684\u5fae\u79d2</li> </ul> <p>\u8865\u5145\uff1a</p> <p>RTC - \u5b9e\u65f6\u65f6\u949f</p> <p>RTC\u6cdb\u6307\u6d41\u901d\u901f\u7387\u4e0e\u771f\u5b9e\u65f6\u95f4\u4e00\u81f4\u7684\u65f6\u949f, \u7528\u6237\u53ef\u6839\u636eRTC\u8fdb\u884c\u4e00\u6bb5\u65f6\u95f4\u7684\u6d4b\u91cf. </p> <p>\u6309\u7167\u8fd9\u4e2a\u5b9a\u4e49, \u4e0a\u8ff0\u4e24\u4e2aAM\u62bd\u8c61\u5bc4\u5b58\u5668\u90fd\u5c5e\u4e8eRTC, \u4e0d\u8fc7\u5b83\u4eec\u7684\u4fa7\u91cd\u70b9\u6709\u6240\u4e0d\u540c:</p> <ul> <li><code>AM_TIMER_RTC</code>\u5f3a\u8c03\u8bfb\u51fa\u7684\u65f6\u95f4\u4e0e\u73b0\u5b9e\u65f6\u95f4\u5b8c\u5168\u4e00\u81f4</li> <li><code>AM_TIMER_UPTIME</code>\u5219\u4fa7\u91cd\u7cfb\u7edf\u542f\u52a8\u540e\u7ecf\u8fc7\u7684\u65f6\u95f4, \u5373\u4ece0\u5f00\u59cb\u8ba1\u6570.</li> </ul> <p>\u867d\u7136NEMU\u4e2d\u7684\u8bbe\u5907\u5bc4\u5b58\u5668\u7684\u540d\u79f0\u4e5f\u53ebRTC, \u4f46\u4e3a\u4e86\u652f\u6301<code>AM_TIMER_UPTIME</code>\u7684\u529f\u80fd, \u5b83\u4e0d\u5fc5\u5b9e\u73b0\u6210<code>AM_TIMER_RTC</code>.</p> <p>\u4ed4\u7ec6RTFSC\uff01\u90fd\u8bf4\u4e86\uff1a</p> <pre><code>int main(const char *args) {\n  switch (args[0]) {\n    CASE('h', hello);\n    CASE('i', hello_intr, IOE, CTE(simple_trap));\n    CASE('d', devscan, IOE);\n    CASE('m', mp_print, MPE);\n    CASE('t', rtc_test, IOE);\n    CASE('k', keyboard_test, IOE);\n    CASE('v', video_test, IOE);\n    CASE('a', audio_test, IOE);\n    CASE('p', vm_test, CTE(vm_handler), VME(simple_pgalloc, simple_pgfree));\n    case 'H':\n    default:\n      printf(\"Usage: make run mainargs=*\\n\");\n      for (int ch = 0; ch &lt; 256; ch++) {\n        if (tests[ch]) {\n          printf(\"  %c: %s\\n\", ch, tests[ch]);\n        }\n      }\n  }\n  return 0;\n}          \n\n// am-kernels/tests/am-tests/src/main.c \n</code></pre> <pre><code>make ARCH=riscv32-nemu run mainargs=t\n</code></pre> <p>\u60f3\u60f3\u600e\u4e48\u4f20mainargs\u8fdb\u53bb\u7684\u3002</p> <p>\u542c\u8bf4\u8fd9\u91cc\u6709\u4e2a\u5751\uff1a</p> <pre><code>static void rtc_io_handler(uint32_t offset, int len, bool is_write) {\n  assert(offset == 0 || offset == 4);\n  if (!is_write &amp;&amp; offset == 4) {\n    uint64_t us = get_time();\n    rtc_port_base[0] = (uint32_t)us;\n    rtc_port_base[1] = us &gt;&gt; 32;\n  }\n}\n\n//nemu/src/device/timer.c\n</code></pre> <p>\u6bcf\u8bfb\u53d6\u4e00\u6b21\u65f6\u95f4\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u4ece\u800c\u8bfb\u53d6</p> <p>\u6ce8\u610f</p> <p>\u4e0d\u8981\u5728native\u94fe\u63a5\u5230klib\u65f6\u8fd0\u884cIOE\u76f8\u5173\u7684\u6d4b\u8bd5</p> <p><code>native</code>\u7684IOE\u662f\u57fa\u4e8eSDL\u5e93\u5b9e\u73b0\u7684, \u5b83\u4eec\u5047\u8bbe\u5e38\u7528\u5e93\u51fd\u6570\u7684\u884c\u4e3a\u4f1a\u7b26\u5408glibc\u6807\u51c6, \u4f46\u6211\u4eec\u81ea\u5df1\u5b9e\u73b0\u7684klib\u901a\u5e38\u4e0d\u80fd\u6ee1\u8db3\u8fd9\u4e00\u8981\u6c42. \u56e0\u6b64<code>__NATIVE_USE_KLIB__</code>\u4ec5\u4f9b\u6d4b\u8bd5klib\u5b9e\u73b0\u7684\u65f6\u5019\u4f7f\u7528, \u6211\u4eec\u4e0d\u8981\u6c42\u5728\u5b9a\u4e49<code>__NATIVE_USE_KLIB__</code>\u7684\u60c5\u51b5\u4e0b\u6b63\u786e\u8fd0\u884c\u6240\u6709\u7a0b\u5e8f.</p> <p>\u770b\u770bNEMU\u8dd1\u591a\u5feb</p> <p>\u6709\u4e86\u65f6\u949f\u4e4b\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e2a\u7a0b\u5e8f\u8dd1\u591a\u5feb, \u4ece\u800c\u6d4b\u8bd5\u8ba1\u7b97\u673a\u7684\u6027\u80fd. \u5c1d\u8bd5\u5728NEMU\u4e2d\u4f9d\u6b21\u8fd0\u884c\u4ee5\u4e0bbenchmark(\u5df2\u7ecf\u6309\u7167\u7a0b\u5e8f\u7684\u590d\u6742\u5ea6\u6392\u5e8f, \u5747\u5728<code>am-kernel/benchmarks/</code>\u76ee\u5f55\u4e0b; \u53e6\u5916\u8dd1\u5206\u65f6\u8bf7\u5173\u95edNEMU\u7684\u76d1\u89c6\u70b9, trace\u4ee5\u53caDiffTest, \u540c\u65f6\u53d6\u6d88menuconfig\u4e2d\u7684 <code>Enable debug information</code>\u5e76\u91cd\u65b0\u7f16\u8bd1NEMU, \u4ee5\u83b7\u5f97\u8f83\u4e3a\u771f\u5b9e\u7684\u8dd1\u5206):</p> <ul> <li>dhrystone</li> <li>coremark</li> <li>microbench</li> </ul> <p>\u6210\u529f\u8fd0\u884c\u540e\u4f1a\u8f93\u51fa\u8dd1\u5206. \u5176\u4e2dmicrobench\u8dd1\u5206\u4ee5<code>i9-9900K @ 3.60GHz</code>\u7684\u5904\u7406\u5668\u4e3a\u53c2\u7167, <code>100000</code>\u5206\u8868\u793a\u4e0e\u53c2\u7167\u673a\u5668\u6027\u80fd\u76f8\u5f53, <code>100</code>\u5206\u8868\u793a\u6027\u80fd\u4e3a\u53c2\u7167\u673a\u5668\u7684\u5343\u5206\u4e4b\u4e00. \u9664\u4e86\u548c\u53c2\u7167\u673a\u5668\u6bd4\u8f83\u4e4b\u5916, \u4e5f\u53ef\u4ee5\u548c\u5c0f\u4f19\u4f34\u8fdb\u884c\u6bd4\u8f83. \u5982\u679c\u628a\u4e0a\u8ff0benchmark\u7f16\u8bd1\u5230<code>native</code>, \u8fd8\u53ef\u4ee5\u6bd4\u8f83<code>native</code>\u7684\u6027\u80fd.</p> <p>\u53e6\u5916, microbench\u63d0\u4f9b\u4e86\u56db\u4e2a\u4e0d\u540c\u89c4\u6a21\u7684\u6d4b\u8bd5\u96c6, \u5305\u62ec<code>test</code>, <code>train</code>, <code>ref</code>\u548c<code>huge</code>. \u4f60\u53ef\u4ee5\u5148\u8fd0\u884c<code>test</code>\u89c4\u6a21, \u5b83\u53ef\u4ee5\u8f83\u5feb\u5730\u8fd0\u884c\u7ed3\u675f, \u6765\u68c0\u67e5NEMU\u5b9e\u73b0\u7684\u6b63\u786e\u6027, \u7136\u540e\u518d\u8fd0\u884c<code>ref</code>\u89c4\u6a21\u6765\u6d4b\u91cf\u6027\u80fd. \u5177\u4f53\u7684\u8fd0\u884c\u65b9\u6cd5\u8bf7\u9605\u8bfbREADME.</p> <p>\u6b64\u5916, <code>huge</code>\u89c4\u6a21\u4e00\u822c\u7528\u4e8e\u771f\u673a\u7684\u6d4b\u8bd5, \u5728NEMU\u4e2d\u9700\u8981\u8fd0\u884c\u5f88\u957f\u65f6\u95f4, \u6211\u4eec\u4e0d\u8981\u6c42\u4f60\u8fd0\u884c\u5b83.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>RTFSC\u4e86\u89e3\u4e00\u5207\u7ec6\u8282</p> <p>\u5173\u4e8e<code>AM_TIMER_UPTIME</code>\u7684\u5b9e\u73b0, \u6211\u4eec\u5728\u6846\u67b6\u4ee3\u7801\u4e2d\u57cb\u4e86\u4e00\u4e9b\u5c0f\u5751, \u5982\u679c\u4f60\u6ca1\u6709\u4fee\u590d\u76f8\u5173\u7684\u95ee\u9898, \u4f60\u53ef\u80fd\u4f1a\u5728\u8fd0\u884cbenchmark\u7684\u65f6\u5019\u51fa\u73b0\u8dd1\u5206\u4e0d\u6b63\u786e\u7684\u73b0\u8c61. </p> <p>\u8fd9\u662f\u4e3a\u4e86\u5f3a\u8feb\u5927\u5bb6\u8ba4\u771fRTFSC\u4e86\u89e3\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4e00\u5207\u7ec6\u8282: benchmark\u8bfb\u53d6\u65f6\u949f\u4fe1\u606f\u7684\u65f6\u5019, \u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7a76\u7adf\u53d1\u751f\u4e86\u4ec0\u4e48? \u53ea\u6709\u8fd9\u6837\u4f60\u624d\u80fd\u628a\u65f6\u949f\u76f8\u5173\u7684bug\u8c03\u8bd5\u6b63\u786e.</p> </li> </ul> <p>\u5404\u79cd\u95ee\u9898\uff1a</p> <ol> <li> <p>floating point expection</p> <p>\u6ca1\u518d\u51fa\u73b0\u8fc7\uff1f</p> </li> <li> <p>\u65f6\u949f\u7684\u8bfb\u53d6\u65f6\u95f4\u95ee\u9898\u3002</p> <p>\u8981\u5148\u8bfb\u53d6\u9ad8\u4f4d\u7684\u5185\u5bb9\u3002</p> <p>\u7559\u5751\uff1a\u6691\u5047\u597d\u597d\u5730\u8bfb\u8bfb\u4ee3\u7801\uff0c\u7406\u89e3\u4ed6\u8fd9\u4e48\u505a\u7684\u6bcf\u4e00\u6b65</p> <pre><code>static void rtc_io_handler(uint32_t offset, int len, bool is_write) {\n   assert(offset == 0 || offset == 4);\n   if (!is_write &amp;&amp; offset == 4) {\n     uint64_t us = get_time();\n     rtc_port_base[0] = (uint32_t)us;\n     rtc_port_base[1] = us &gt;&gt; 32;\n   }\n }\n</code></pre> </li> <li> <p>mulhu\u3001ori\u3001stli\u3001lbu\u6307\u4ee4\u6ca1\u5b9e\u73b0</p> </li> </ol> <pre><code>// slti\n    INSTPAT(\"??????? ????? ????? 010 ????? 00100 11\", slti   , I, R(rd) = ((sword_t)src1 &lt; (sword_t)imm) ); \n</code></pre> <p>\u8fd9\u91cc\u4e00\u5f00\u59cb\u53ea\u52a0\u4e86imm\u7684swordt</p> <p>\u6ca1\u9519\u5c31\u662f\u8fd9\u91cc\u5bfc\u81f4\u90a3\u4e2aDhrystone\u8fc7\u4e0d\u4e86</p> <p>\u7559\u5751</p> <p></p> <p>\u597d\u597d\u770b\u624b\u518c\uff0c\u5148\u8fdb\u884c\u6269\u5c55\uff0c\u4e4b\u540e\u518d\u5206\u522b\u8bbf\u5b58\u6709\u7b26\u53f7\u548c\u65e0\u7b26\u53f7\u6570</p> <p>\u8fd8\u6709\uff1amulhu\u7684\u7ed3\u679c\uff0c\u662f\u5c06\u4e24\u4e2a32\u4f4d\u6570\u4e58\u8d77\u6765\u5f97\u5230\u768464\u4f4d\u6570\u7684\u9ad832\u4f4d\u653e\u5230rd\u91cc\uff1a</p> <p></p> <ul> <li> <p>\u5b9e\u73b0\u65f6\u949f\u4e4b\u540e\u7684\u5c0f\u6e38\u620f\uff1a</p> <p></p> </li> </ul> <p>\u5728\u6211\u8fd0\u884c\u7b2c\u4e00\u4e2a\u6e38\u620f\u540e\uff0c\u6ca1\u6709\u53cd\u5e94\uff0c\u4e00\u76f4\u90fd\u662f\u9ed1\u5c4f\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u540e\u6765\u8865\u5145\uff0c\u505a\u5b8c\u4e4b\u540eVGA\u548c\u51af\u8bfa\u4f9d\u66fc\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e4b\u540e\u53c8\u53ef\u4ee5\u4e86\uff1f</p> <p>\u662f\u81ea\u5df1\u8865\u5145\u5b9e\u73b0\u7684 <code>klib</code>\u7684\u5404\u79cd\u95ee\u9898\uff0c <code>memcpy</code> \u3001<code>malloc</code> \u7b49\u7b49</p> <p>\u53c8\u8c08\u5230\u4e86\u5185\u5b58\u5bf9\u9f50\uff0c<code>malloc</code> \u5bf9\u5185\u5b58\u5730\u5740\u6709\u8981\u6c42\u3002\uff08\u7528\u5404\u79cd\u5b8f\uff09</p> <p>\u5b9e\u73b0memcpy()\u51fd\u6570\u53ca\u8fc7\u7a0b\u603b\u7ed3 - Infinite_feng - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u7559\u5751</p> <p>\u8fd9\u91cc\u81ea\u5df1\u5728\u5b9e\u73b0malloc\u7684\u65f6\u5019\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u90e8\u9759\u6001\u53d8\u91cf\u6ce8\u610f\uff0c\u5206\u522b\u5728 native \u548c riscv32-nemu \u4f7f\u7528\u7684\u65f6\u5019\u8981\u6ce8\u610f\uff1a</p> <p></p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>NEMU\u548c\u8bed\u8a00\u89e3\u91ca\u5668</p> <p>microbench\u4e2d\u6709\u4e00\u4e2a\u53eb<code>bf</code>\u7684\u6d4b\u8bd5\u9879\u76ee, \u5b83\u662fBrainf**k\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u8bed\u8a00\u7684\u4e00\u4e2a\u89e3\u91ca\u5668. Brainf**k\u8bed\u8a00\u975e\u5e38\u7b80\u5355, \u5b83\u53ea\u67098\u79cd\u6307\u4ee4, \u8fde\u53d8\u91cf\u7684\u6982\u5ff5\u90fd\u6ca1\u6709, \u56e0\u6b64\u975e\u5e38\u63a5\u8fd1\u673a\u5668\u8bed\u8a00. \u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u9605\u8bfb<code>bf.c</code>\u7684\u4ee3\u7801, \u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e48\u7b80\u5355\u7684\u4e00\u4e2a\u8bed\u8a00\u89e3\u91ca\u5668\u548c\u770b\u4e0a\u53bb\u5f88\u590d\u6742\u7684NEMU\u4ece\u539f\u7406\u4e0a\u6765\u770b\u8fd8\u662f\u6709\u76f8\u4f3c\u4e4b\u5904\u7684.</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#-dtrace","title":"\u8bbe\u5907\u8bbf\u95ee\u7684\u8e2a\u8ff9 - dtrace","text":"<ul> <li> <p>\u7559\u5751</p> <p>\u6211\u5728 <code>trace.c</code> \u91cc\u9762\u52a0\u5165\u5173\u4e8e <code>dtrace</code> \u7684\u4e1c\u897f\u540e\uff0c\u7f16\u8bd1\u5c31\u62a5\u5173\u4e8e Log\u672a\u5b9a\u4e49\u7684\u9519\u3002</p> <p>\u6211\u628a\u5b83\u653e\u5230 <code>src/device/map.c</code> \u91cc\u4e86\uff0c\u4ee5\u540e\u518d\u770b\u770b\u3002</p> <p>\u9519\u8bef\u4fe1\u606f\u6307\u51fa\u7f16\u8bd1\u5668\u5728 <code>utils.h</code> \u4e2d\u9047\u5230\u4e86 <code>IOMap</code> \u7c7b\u578b\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u7c7b\u578b\u3002\u8fd9\u901a\u5e38\u610f\u5473\u7740 <code>IOMap</code> \u8fd9\u4e2a\u7c7b\u578b\u6ca1\u6709\u5728\u7f16\u8bd1\u5668\u5f53\u524d\u7684\u4e0a\u4e0b\u6587\u4e2d\u88ab\u5b9a\u4e49\u6216\u58f0\u660e\u3002</p> <p>\u4ece\u60a8\u63d0\u4f9b\u7684\u4ee3\u7801\u548c\u9519\u8bef\u4fe1\u606f\u6765\u770b\uff0c\u4ee5\u4e0b\u662f\u53ef\u80fd\u7684\u539f\u56e0\u548c\u89e3\u51b3\u529e\u6cd5\uff1a</p> <ol> <li> <p>\u7f3a\u5c11 <code>IOMap</code> \u5b9a\u4e49\uff1a\u5982\u679c <code>IOMap</code> \u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u578b\uff0c\u786e\u4fdd\u5b83\u5728 <code>utils.h</code> \u6216\u5176\u4ed6\u5df2\u7ecf\u5305\u542b\u7684\u5934\u6587\u4ef6\u4e2d\u88ab\u5b9a\u4e49\u6216\u58f0\u660e\u3002</p> </li> <li> <p>\u5305\u542b\u987a\u5e8f\u95ee\u9898\uff1a\u5982\u679c <code>IOMap</code> \u5b9a\u4e49\u5728\u67d0\u4e2a\u5934\u6587\u4ef6\u4e2d\uff0c\u53ef\u80fd\u5b58\u5728\u5305\u542b\u987a\u5e8f\u7684\u95ee\u9898\u3002\u786e\u4fdd\u6240\u6709\u5fc5\u8981\u7684\u5934\u6587\u4ef6\u90fd\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u5305\u542b\u3002</p> </li> <li> <p>\u5faa\u73af\u4f9d\u8d56\uff1a\u5982\u679c\u591a\u4e2a\u5934\u6587\u4ef6\u76f8\u4e92\u5305\u542b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u9519\u8bef\u3002\u68c0\u67e5\u662f\u5426\u6709\u5faa\u73af\u4f9d\u8d56\uff0c\u5e76\u5c1d\u8bd5\u91cd\u65b0\u7ec4\u7ec7\u4ee3\u7801\u4ee5\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002</p> </li> <li> <p>\u62fc\u5199\u6216\u5927\u5c0f\u5199\u9519\u8bef\uff1a\u68c0\u67e5 <code>IOMap</code> \u7684\u62fc\u5199\u662f\u5426\u6b63\u786e\uff0c\u5305\u62ec\u5927\u5c0f\u5199\u3002</p> </li> <li> <p>\u6587\u4ef6\u8def\u5f84\u95ee\u9898\uff1a\u786e\u4fdd\u7f16\u8bd1\u5668\u80fd\u591f\u627e\u5230\u5305\u542b <code>IOMap</code> \u5b9a\u4e49\u7684\u5934\u6587\u4ef6\u3002\u5982\u679c\u5934\u6587\u4ef6\u4e0d\u5728\u6807\u51c6\u8def\u5f84\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u6307\u5b9a\u6b63\u786e\u7684\u8def\u5f84\u3002</p> </li> <li> <p>\u7f16\u8bd1\u73af\u5883\u95ee\u9898\uff1a\u5982\u679c <code>IOMap</code> \u5b9a\u4e49\u5728\u5176\u4ed6\u9879\u76ee\u6216\u5e93\u4e2d\uff0c\u786e\u4fdd\u8fd9\u4e9b\u5e93\u5df2\u7ecf\u88ab\u6b63\u786e\u5730\u6dfb\u52a0\u5230\u7f16\u8bd1\u73af\u5883\u4e2d\u3002</p> </li> <li> <p>\u6e05\u7406\u7f16\u8bd1\uff1a\u6709\u65f6\u5019\uff0c\u4e4b\u524d\u7684\u7f16\u8bd1\u7ed3\u679c\u53ef\u80fd\u4f1a\u5e72\u6270\u5f53\u524d\u7684\u7f16\u8bd1\u3002\u5c1d\u8bd5\u6e05\u7406\u4e4b\u524d\u7684\u7f16\u8bd1\u7ed3\u679c\uff0c\u7136\u540e\u91cd\u65b0\u7f16\u8bd1\u3002</p> </li> <li> <p>\u68c0\u67e5 <code>device/map.h</code>\uff1a\u7531\u4e8e\u9519\u8bef\u53d1\u751f\u5728\u5305\u542b <code>device/map.h</code> \u4e4b\u540e\uff0c\u68c0\u67e5\u8fd9\u4e2a\u6587\u4ef6\u662f\u5426\u6b63\u786e\u5b9a\u4e49\u4e86 <code>IOMap</code>\uff0c\u5e76\u4e14\u6ca1\u6709\u5176\u4ed6\u7f16\u8bd1\u9519\u8bef\u3002</p> </li> <li> <p>\u68c0\u67e5 <code>itrace.c</code>\uff1a\u60a8\u63d0\u5230\u4e86 <code>itrace.c</code>\uff0c\u68c0\u67e5\u8fd9\u4e2a\u6587\u4ef6\u662f\u5426\u4e5f\u5305\u542b\u4e86 <code>IOMap</code> \u7684\u4f7f\u7528\uff0c\u5e76\u4e14\u662f\u5426\u5728\u7f16\u8bd1\u4e4b\u524d\u6b63\u786e\u5305\u542b\u4e86\u5b9a\u4e49 <code>IOMap</code> \u7684\u5934\u6587\u4ef6\u3002</p> </li> <li> <p>\u67e5\u770b\u5177\u4f53\u5b9e\u73b0\uff1a\u5982\u679c <code>IOMap</code> \u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\u6216\u7c7b\uff0c\u786e\u4fdd\u5b83\u7684\u5b9e\u73b0\uff08\u5b9a\u4e49\uff09\u5728\u67d0\u4e2a\u5730\u65b9\u88ab\u5305\u542b\uff0c\u5e76\u4e14\u6ca1\u6709\u8bed\u6cd5\u9519\u8bef\u3002</p> </li> </ol> <p>\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u901a\u5e38\u9700\u8981\u68c0\u67e5\u4ee3\u7801\u7684\u7ec4\u7ec7\u7ed3\u6784\u548c\u7f16\u8bd1\u6307\u4ee4\u3002\u5982\u679c <code>IOMap</code> \u662f\u4e00\u4e2a\u5916\u90e8\u5e93\u6216\u6846\u67b6\u7684\u4e00\u90e8\u5206\uff0c\u8bf7\u786e\u4fdd\u5df2\u7ecf\u6309\u7167\u8be5\u5e93\u7684\u6587\u6863\u6b63\u786e\u5730\u8bbe\u7f6e\u4e86\u7f16\u8bd1\u73af\u5883\u3002\u5982\u679c <code>IOMap</code> \u662f\u60a8\u9879\u76ee\u7684\u4e00\u90e8\u5206\uff0c\u8bf7\u786e\u4fdd\u5b83\u7684\u5b9a\u4e49\u5728\u88ab\u4f7f\u7528\u4e4b\u524d\u5df2\u7ecf\u88ab\u5305\u542b\u3002</p> <ul> <li> <p>\u7a81\u7136\u60f3\u5230\u4e00\u4e0bdifftest\u7684\u601d\u60f3\uff0c\u5047\u5982\u8bf4\u6211\u7f16\u8bd1\u7684\u65f6\u5019\u4e2a\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff0c\u7528\u8fd9\u4e2a\u770b\u770b\u597d\u7684\uff1a</p> <pre><code>make ARCH=native -nB | sort | less\n</code></pre> </li> </ul> </li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u6211\u6ca1\u6709\u5728 vga \u90e8\u5206\u6dfb\u52a0 dtrace\uff0c\u770b mtrace \u5373\u53ef\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#_29","title":"\u952e\u76d8","text":"<p>\u8fd9\u91cc\u5b9e\u73b0\u7684\u6709\u70b9\u61f5\u903c\uff0c\u53c2\u8003native\u7684\u76f8\u5173\u5b9e\u73b0\u548c\u4e86\u89e3 <code>nemu/src/device/keyboard.c</code> \u662f\u600e\u4e48\u5199\u7684\uff0c</p> <p>\u4e3b\u8981\u662f\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u4e2a\u626b\u63cf\u7801\uff0c\u7136\u540e\u4e3a\u4ec0\u4e48\u8981 &amp; 0x8000\uff0c\u8fd9\u548ci8042\u82af\u7247\u6240\u652f\u6301\u7684\u6709\u4ec0\u4e48\u5173\u7cfb\u5417\uff1f</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u68c0\u6d4b\u591a\u4e2a\u952e\u540c\u65f6\u88ab\u6309\u4e0b?</p> <p>\u5728\u6e38\u620f\u4e2d, \u5f88\u591a\u65f6\u5019\u9700\u8981\u5224\u65ad\u73a9\u5bb6\u662f\u5426\u540c\u65f6\u6309\u4e0b\u4e86\u591a\u4e2a\u952e, \u4f8b\u5982RPG\u6e38\u620f\u4e2d\u7684\u516b\u65b9\u5411\u884c\u8d70, \u683c\u6597\u6e38\u620f\u4e2d\u7684\u7ec4\u5408\u62db\u5f0f\u7b49\u7b49. \u6839\u636e\u952e\u76d8\u7801\u7684\u7279\u6027, \u4f60\u77e5\u9053\u8fd9\u4e9b\u529f\u80fd\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5417?</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#vgavideo-graphical-array","title":"VGA(video graphical array)","text":"<ul> <li> <p>\u505a</p> <p>\u5b9e\u4e0a, VGA\u8bbe\u5907\u8fd8\u6709\u4e24\u4e2a\u5bc4\u5b58\u5668: \u5c4f\u5e55\u5927\u5c0f\u5bc4\u5b58\u5668\u548c\u540c\u6b65\u5bc4\u5b58\u5668. \u6211\u4eec\u5728\u8bb2\u4e49\u4e2d\u5e76\u672a\u4ecb\u7ecd\u5b83\u4eec, \u6211\u4eec\u628a\u5b83\u4eec\u4f5c\u4e3a\u76f8\u5e94\u7684\u7ec3\u4e60\u7559\u7ed9\u5927\u5bb6. \u5177\u4f53\u5730, \u5c4f\u5e55\u5927\u5c0f\u5bc4\u5b58\u5668\u7684\u786c\u4ef6(NEMU)\u529f\u80fd\u5df2\u7ecf\u5b9e\u73b0, \u4f46\u8f6f\u4ef6(AM)\u8fd8\u6ca1\u6709\u53bb\u4f7f\u7528\u5b83; \u800c\u5bf9\u4e8e\u540c\u6b65\u5bc4\u5b58\u5668\u5219\u76f8\u53cd, \u8f6f\u4ef6(AM)\u5df2\u7ecf\u5b9e\u73b0\u4e86\u540c\u6b65\u5c4f\u5e55\u7684\u529f\u80fd, \u4f46\u786c\u4ef6(NEMU)\u5c1a\u672a\u6dfb\u52a0\u76f8\u5e94\u7684\u652f\u6301.</p> <p>\u597d\u4e86, \u63d0\u793a\u5df2\u7ecf\u8db3\u591f\u5566, \u81f3\u4e8e\u8981\u5728\u4ec0\u4e48\u5730\u65b9\u6dfb\u52a0\u4ec0\u4e48\u6837\u7684\u4ee3\u7801, \u5c31\u7531\u4f60\u6765RTFSC\u5427. \u8fd9\u4e5f\u662f\u660e\u767d\u8f6f\u786c\u4ef6\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u7684\u5f88\u597d\u7684\u7ec3\u4e60. \u5b9e\u73b0\u540e, \u5411<code>__am_gpu_init()</code>\u4e2d\u6dfb\u52a0\u5982\u4e0b\u6d4b\u8bd5\u4ee3\u7801:</p> <pre><code>--- abstract-machine/am/src/platform/nemu/ioe/gpu.c\n+++ abstract-machine/am/src/platform/nemu/ioe/gpu.c\n@@ -6,2 +6,8 @@\nvoid __am_gpu_init() {\n+  int i;\n+  int w = 0;  // TODO: get the correct width\n+  int h = 0;  // TODO: get the correct height\n+  uint32_t *fb = (uint32_t *)(uintptr_t)FB_ADDR;\n+  for (i = 0; i &lt; w * h; i ++) fb[i] = i;\n+  outl(SYNC_ADDR, 1);\n }\n</code></pre> <p>\u5176\u4e2d\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684<code>w</code>\u548c<code>h</code>\u5e76\u672a\u8bbe\u7f6e\u6b63\u786e\u7684\u503c, \u4f60\u9700\u8981\u9605\u8bfb<code>am-tests</code>\u4e2d\u7684<code>display test</code>\u6d4b\u8bd5, \u7406\u89e3\u5b83\u5982\u4f55\u83b7\u53d6\u6b63\u786e\u7684\u5c4f\u5e55\u5927\u5c0f, \u7136\u540e\u4fee\u6539\u4e0a\u8ff0\u4ee3\u7801\u7684<code>w</code>\u548c<code>h</code>. \u4f60\u53ef\u80fd\u8fd8\u9700\u8981\u5bf9<code>gpu.c</code>\u4e2d\u7684\u4ee3\u7801\u8fdb\u884c\u4e00\u4e9b\u4fee\u6539. \u4fee\u6539\u540e, \u5728<code>$ISA-nemu</code>\u4e2d\u8fd0\u884c<code>am-tests</code>\u4e2d\u7684<code>display test</code>\u6d4b\u8bd5, \u5982\u679c\u4f60\u7684\u5b9e\u73b0\u6b63\u786e, \u4f60\u4f1a\u770b\u5230\u65b0\u7a97\u53e3\u4e2d\u8f93\u51fa\u4e86\u5168\u5c4f\u7684\u989c\u8272\u4fe1\u606f.</p> <p>\u5b9e\u73b0IOE(4)</p> <p>\u4e8b\u5b9e\u4e0a, \u521a\u624d\u8f93\u51fa\u7684\u989c\u8272\u4fe1\u606f\u5e76\u4e0d\u662f<code>display test</code>\u671f\u671b\u8f93\u51fa\u7684\u753b\u9762, \u8fd9\u662f\u56e0\u4e3a<code>AM_GPU_FBDRAW</code>\u7684\u529f\u80fd\u5e76\u672a\u6b63\u786e\u5b9e\u73b0. \u4f60\u9700\u8981\u6b63\u786e\u5730\u5b9e\u73b0<code>AM_GPU_FBDRAW</code>\u7684\u529f\u80fd. \u5b9e\u73b0\u540e, \u91cd\u65b0\u8fd0\u884c<code>display test</code>. \u5982\u679c\u4f60\u7684\u5b9e\u73b0\u6b63\u786e, \u4f60\u5c06\u4f1a\u770b\u5230\u65b0\u7a97\u53e3\u4e2d\u8f93\u51fa\u4e86\u76f8\u5e94\u7684\u52a8\u753b\u6548\u679c.</p> <p>\u5b9e\u73b0\u6b63\u786e\u540e, \u4f60\u5c31\u53ef\u4ee5\u53bb\u6389\u4e0a\u6587\u6dfb\u52a0\u7684\u6d4b\u8bd5\u4ee3\u7801\u4e86.  </p> <p>\u5173\u952e\uff1a\u5411\u5c4f\u5e55<code>(x, y)</code>\u5750\u6807\u5904\u7ed8\u5236<code>w*h</code>\u7684\u77e9\u5f62\u56fe\u50cf. \u56fe\u50cf\u50cf\u7d20\u6309\u884c\u4f18\u5148\u65b9\u5f0f\u5b58\u50a8\u5728<code>pixels</code>\u4e2d</p> <p>\u7559\u5751\uff1a\u9700\u8981\u77e5\u9053\u5982\u4f55\u5b58\u50cf\u7d20\u70b9\u7684\uff1a__am_gpu_fbdraw()</p> <p>\u9700\u8981\u53c2\u8003\u4e00\u4e9b\u6587\u7ae0</p> <p>frame buffer \u2014\u2014\u5e27\u7f13\u51b2\u533a-CSDN\u535a\u5ba2</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u8fd0\u884c\u6f14\u793a\u7a0b\u5e8f(2)</p> <p>\u6b63\u786e\u5b9e\u73b0VGA\u540e, \u91cd\u65b0\u5b9a\u4e49<code>am-kernels/kernels/demo/include/io.h</code>\u4e2d<code>HAS_GUI</code>, \u4f60\u5c31\u53ef\u4ee5\u5728NEMU\u4e0a\u8fd0\u884c\u56fe\u5f62\u7248\u672c\u7684\u6f14\u793a\u7a0b\u5e8f\u4e86. \u8fd0\u884c\u7ed3\u675f\u540e, \u4f60\u8fd8\u53ef\u4ee5\u6309<code>Q</code>\u952e\u9000\u51fa\u6f14\u793a\u7a0b\u5e8f.</p> <p>\u8fd0\u884c\u7ea2\u767d\u673a\u6a21\u62df\u5668(3)</p> <p>\u6b63\u786e\u5b9e\u73b0VGA\u540e, \u91cd\u65b0\u5b9a\u4e49<code>fceux-am/src/config.h</code>\u4e2d\u7684<code>HAS_GUI</code>, \u4f60\u5c31\u53ef\u4ee5\u5728NEMU\u4e0a\u8fd0\u884c\u56fe\u5f62\u7248\u672c\u7684FCEUX\u4e86.</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_30","title":"\u58f0\u5361\uff08\u9009\u505a\uff09","text":"<p>\u5357\u5927-ICS2021 PA2.3 \u5b66\u4e60\u7b14\u8bb0&amp;\u8bb0\u5f55_\u5357\u4eac\u5927\u5b66ics pa-CSDN\u535a\u5ba2</p>"},{"location":"ysyx/pa/pa2/pa2.html#_31","title":"\u51af\u8bfa\u4f9d\u66fc\u8ba1\u7b97\u673a\u7cfb\u7edf","text":"<p>\u5c55\u793a\u4f60\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf</p> <p>\u5b8c\u6574\u5b9e\u73b0IOE\u540e, \u6211\u4eec\u8fd8\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u9177\u70ab\u7684\u7a0b\u5e8f:</p> <ul> <li> <p>\u5e7b\u706f\u7247\u64ad\u653e(\u5728<code>am-kernels/kernels/slider/</code>\u76ee\u5f55\u4e0b). \u7a0b\u5e8f\u5c06\u6bcf\u96945\u79d2\u5207\u6362<code>images/</code>\u76ee\u5f55\u4e0b\u7684\u56fe\u7247.</p> </li> <li> <p>\u6253\u5b57\u5c0f\u6e38\u620f(\u5728<code>am-kernels/kernels/typing-game/</code>\u76ee\u5f55\u4e0b). </p> <p></p> </li> <li> <p>\u6f14\u793a\u7a0b\u5e8f\u96c6\u5408(\u5728<code>am-kernels/kernels/demo/</code>\u76ee\u5f55\u4e0b).</p> </li> <li> <p>\"Bad Apple!!\" PV\u7684\u64ad\u653e(\u5728<code>am-kernels/kernels/bad-apple/</code>\u76ee\u5f55\u4e0b).</p> </li> <li> <p>\u8d2a\u5403\u86c7(\u5728<code>am-kernels/kernels/snake/</code>\u76ee\u5f55\u4e0b).</p> </li> <li> <p>\u7b80\u5355\u7684\u7ea2\u767d\u673a\u6a21\u62df\u5668LiteNES(\u5728<code>am-kernels/kernels/litenes/</code>\u76ee\u5f55\u4e0b). \u4e0d\u8fc7LiteNES\u7684\u6027\u80fd\u6bd4\u8f83\u4f4e, \u5728NEMU\u4e0a\u53ea\u80fd\u8dd1\u5341\u51e0FPS, \u800c\u4e14\u53ea\u80fd\u8fd0\u884c\u8d85\u7ea7\u739b\u4e3d.</p> </li> <li> <p>\u5b8c\u6574\u7684\u7ea2\u767d\u673a\u6a21\u62df\u5668FCEUX. \u6ca1\u9519, \u6211\u4eec\u5728PA1\u4e2d\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u7684\u7ea2\u767d\u673a\u6a21\u62df\u5668, \u73b0\u5728\u4e5f\u5df2\u7ecf\u53ef\u4ee5\u5728NEMU\u4e2d\u8fd0\u884c\u8d77\u6765\u4e86!</p> </li> </ul> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6e38\u620f\u662f\u5982\u4f55\u8fd0\u884c\u7684</p> <p>\u8bf7\u4f60\u4ee5\u6253\u5b57\u5c0f\u6e38\u620f\u4e3a\u4f8b, \u7ed3\u5408\"\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u4e24\u4e2a\u89c6\u89d2, \u6765\u5256\u6790\u6253\u5b57\u5c0f\u6e38\u620f\u7a76\u7adf\u662f\u5982\u4f55\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\u7684. \u5177\u4f53\u5730, \u5f53\u4f60\u6309\u4e0b\u4e00\u4e2a\u5b57\u6bcd\u5e76\u547d\u4e2d\u7684\u65f6\u5019, \u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf(NEMU, ISA, AM, \u8fd0\u884c\u65f6\u73af\u5883, \u7a0b\u5e8f) \u662f\u5982\u4f55\u534f\u540c\u5de5\u4f5c, \u4ece\u800c\u8ba9\u6253\u5b57\u5c0f\u6e38\u620f\u5b9e\u73b0\u51fa\"\u547d\u4e2d\"\u7684\u6e38\u620f\u6548\u679c?</p> <p>\u6253\u5b57\u5c0f\u6e38\u620f\u53ea\u6709\u4e0d\u5230200\u884c\u7684\u7b80\u5355\u4ee3\u7801, \u975e\u5e38\u9002\u5408\u5927\u5bb6RTFSC. \u5982\u679c\u4f60\u53d1\u73b0\u81ea\u5df1\u96be\u4ee5\u7406\u89e3\u6253\u5b57\u5c0f\u6e38\u620f\u7684\u5177\u4f53\u884c\u4e3a, \u4f60\u9700\u8981\u7ed9\u81ea\u5df1\u6572\u54cd\u8b66\u949f\u4e86: \u4f60\u5728\u505aPA\u7684\u65f6\u5019\u5f88\u6709\u53ef\u80fd\u53ea\u5173\u6ce8\u600e\u4e48\u628a\u5fc5\u505a\u5185\u5bb9\u7684\u4ee3\u7801\u5199\u5bf9, \u800c\u4e0d\u53bb\u601d\u8003\u8fd9\u4e9b\u4ee3\u7801\u548c\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5173\u7cfb. \u4eceICS\u548cPA\u7684\u89d2\u5ea6\u6765\u8bf4, \u8fd9\u79cd\u505a\u6cd5\u662f\u4e0d\u53ca\u683c\u7684, \u800c\u4e14\u5f88\u5feb\u4f60\u5c31\u4f1a\u5403\u82e6\u5934\u4e86.</p> </li> <li> <p>\u601d\u8003\u9898(\u5fc5\u505a)</p> <p>\u89c2\u5bdf\u7a0b\u5e8f\u5982\u4f55\u8fd0\u884c</p> <p>RTFSC\u662f\u4ece\u9759\u6001\u89c6\u89d2\u7406\u89e3\u7a0b\u5e8f\u5982\u4f55\u8fd0\u884c, \u4e8b\u5b9e\u4e0a\u6211\u4eec\u8fd8\u80fd\u591f\u4ece\u52a8\u6001\u89c6\u89d2\u53bb\u7406\u89e3\u7a0b\u5e8f\u5982\u4f55\u8fd0\u884c: \u6211\u4eec\u5148\u89c2\u5bdf\u7a0b\u5e8f\u8fd0\u884c\u65f6\u523b\u7684\u884c\u4e3a, \u770b\u770b\u5b83\u5b9e\u9645\u4e0a\u505a\u4e86\u4ec0\u4e48. \u8fd9\u6b63\u662ftrace\u7684\u4f5c\u7528! \u6211\u4eec\u4e4b\u6240\u4ee5\u5728NEMU\u4e2d\u8981\u6c42\u5927\u5bb6\u5b9e\u73b0\u5404\u79cdtrace\u5de5\u5177, \u5176\u5b9e\u662f\u5728\u5f15\u5bfc\u5927\u5bb6\u4ece\u5404\u4e2a\u5c42\u6b21\u89c2\u5bdf\u7a0b\u5e8f\u8fd0\u884c\u65f6\u523b\u7684\u884c\u4e3a, \u8fd9\u4e5f\u7b26\u5408PA\"\u7406\u89e3\u7a0b\u5e8f\u5982\u4f55\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\"\u7684\u7ec8\u6781\u76ee\u6807.</p> <p>\u5c1d\u8bd5\u6253\u5f00NEMU\u4e2d\u7684\u6240\u6709trace\u5de5\u5177, \u7136\u540e\u8fd0\u884c\u6253\u5b57\u5c0f\u6e38\u620f, \u4f60\u4f1a\u53d1\u73b0ftrace\u548cdtrace\u5bf9\u4f60\u56de\u7b54\u4e0a\u8ff0\u5fc5\u7b54\u9898\u6709\u975e\u5e38\u5927\u7684\u5e2e\u52a9.</p> <p>\u4f53\u4f1a\u5230AM\u7684\u597d\u5904\u4e86\u5427?</p> <p>\u542c\u95fb\u8fd9\u5b66\u671f\u7684\u6570\u5b57\u7535\u8def\u5b9e\u9a8c\u7684\u5927\u4f5c\u4e1a\u53ef\u4ee5\u9009\u62e9\u8bbe\u8ba1\u4e00\u4e2a\u5355\u5468\u671fCPU. \u73b0\u5728\u6709\u4e86\u8fd9\u4e48\u591a\u4e30\u5bcc\u7684AM\u5e94\u7528, \u5173\u952e\u662f\u8fd9\u4e9bAM\u5e94\u7528\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u79fb\u690d\u5230\u4efb\u610f\u67b6\u6784, \u5728\u81ea\u5df1\u8bbe\u8ba1\u7684CPU\u4e0a\u8fd0\u884c\u8d85\u7ea7\u739b\u4e3d\u548c\u9b42\u6597\u7f57\u7b49\u7ecf\u5178\u6e38\u620f, \u5c55\u793a\u6548\u679c\u9177\u70ab\u5f97\u8981\u4e0a\u5929!</p> <p>AM\u5c31\u662f\u4e3a\u6559\u5b66\u5b9e\u9a8c\u800c\u751f. \u65e2\u7136\u8fd9\u6837, \u4f60\u8fd8\u7b49\u4ec0\u4e48\u5462?</p> </li> <li> <p>\u91cd\u8981RTFSC</p> <p>RTFSC\u6307\u5357</p> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u5217\u51fa\u76ee\u524d\u5927\u5bb6\u5e94\u8be5\u8bfb\u8fc7\u5e76\u7406\u89e3\u7684\u4ee3\u7801, \u4f9b\u5927\u5bb6\u8fdb\u884c\u81ea\u6211\u68c0\u8ba8:</p> <ul> <li>NEMU\u4e2d\u9664\u4e86<code>fixdep</code>, <code>kconfig</code>, \u4ee5\u53ca\u6ca1\u6709\u9009\u62e9\u7684ISA\u4e4b\u5916\u7684\u5168\u90e8\u5df2\u6709\u4ee3\u7801(\u5305\u62ecMakefile)</li> <li><code>abstract-machine/am/</code>\u4e0b\u4e0e$ISA-nemu\u76f8\u5173\u7684, \u9664\u53bbCTE\u548cVME\u4e4b\u5916\u7684\u4ee3\u7801</li> <li><code>abstract-machine/klib/</code>\u4e2d\u7684\u6240\u6709\u4ee3\u7801</li> <li><code>abstract-machine/Makefile</code>\u548c<code>abstract-machine/scripts/</code>\u4e2d\u7684\u6240\u6709\u4ee3\u7801</li> <li><code>am-kernels/tests/cpu-tests/</code>\u4e2d\u7684\u6240\u6709\u4ee3\u7801</li> <li><code>am-kernels/tests/am-tests/</code>\u4e2d\u8fd0\u884c\u8fc7\u7684\u6d4b\u8bd5\u4ee3\u7801</li> <li><code>am-kernels/benchmarks/microbench/bench.c</code></li> <li><code>am-kernels/kernels/</code>\u4e2d\u7684<code>hello</code>, <code>slider</code>\u548c<code>typing-game</code>\u7684\u6240\u6709\u4ee3\u7801</li> </ul> <p>\u5982\u679c\u4f60\u53d1\u73b0\u81ea\u5df1\u4e0d\u80fd\u7406\u89e3\u8fd9\u4e9b\u4ee3\u7801\u7684\u884c\u4e3a, \u5c31\u8d76\u7d27\u770b\u770b\u5427. \u591a\u770b\u4e00\u4e2a\u6587\u4ef6, bug\u5c11\u8c03\u51e0\u5929, \u5230\u4e86PA3\u4f60\u5c31\u4f1a\u9886\u6559\u5230\u4e86.</p> </li> </ul> <p>===\u6ce8\u610f\uff0c\u5728\u8dd1 litenes \u739b\u4e3d\u5965\u7684\u65f6\u5019\u8bb0\u5f97\u5173\u6389 trace \u548c difftest\u3002\u5e76\u4e14trace.c\u91cc\u90a3\u4e2a\u6ce8\u91ca==</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>LiteNES\u5982\u4f55\u5de5\u4f5c?</p> <p>\u53e6\u4e00\u4e2a\u503c\u5f97RTFSC\u7684\u9879\u76ee\u662fLiteNES, \u9664\u4e86\u5185\u7f6erom\u4e4b\u5916, \u4ee3\u7801\u603b\u6570\u5927\u7ea61500\u884c. \u5173\u952e\u662f\u8fd9\u4e2a\u5c0f\u5de7\u73b2\u73d1\u7684\u9879\u76ee\u91cc\u9762\u5df2\u7ecf\u5305\u542b\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf: CPU, \u5185\u5b58, MMIO, \u4ee5\u53ca\u624b\u67c4(psg), \u5361\u5e26(mmc)\u548c\u56fe\u5f62\u5904\u7406\u5668(ppu)\u8fd9\u4e09\u4e2a\u5916\u8bbe. \u9664\u4e86ppu\u7684\u5185\u90e8\u5b9e\u73b0\u7ec6\u8282\u4e4b\u5916, \u5176\u4f59\u7684\u90e8\u5206\u4f60\u90fd\u5df2\u7ecf\u6709\u80fd\u529b\u53bb\u7406\u89e3\u4e86.</p> <p>\u6709\u8da3\u7684\u662f, LiteNES\u53ef\u4ee5\u770b\u6210\u662fNEMU\u548cAM\u7a0b\u5e8f\u7684\u878d\u5408. \u5c1d\u8bd5\u9605\u8bfbLiteNES\u7684\u4ee3\u7801, \u7406\u89e3LiteNES\u4f5c\u4e3a\u4e00\u4e2a\u5b8c\u6574\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf, \u4e0a\u8ff0\u90e8\u4ef6\u5982\u4f55\u4ea4\u4e92, \u4ee5\u53caLiteNES\u4f5c\u4e3a\u4e00\u4e2aAM\u7a0b\u5e8f, \u5982\u4f55\u901a\u8fc7AM\u63d0\u4f9b\u7684API\u6765\u5b9e\u73b0\u6e38\u620f\u6548\u679c. \u6211\u4eec\u63d0\u4f9b6502\u5904\u7406\u5668(NES\u7684CPU)\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u4ee5\u53caNES PPU(\u56fe\u5f62\u5904\u7406\u5668)\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u7684\u8d44\u6599\u4f9b\u5927\u5bb6\u53c2\u8003.</p> </li> <li> <p>\u9009\u505a\u9898</p> <p>\u4f18\u5316LiteNES</p> <p>\u6211\u4eec\u5728LiteNES\u4e2d\u9ed8\u8ba4\u5f00\u542f\u4e86\u8df3\u5e27\u6a21\u5f0f, \u53ea\u6e32\u67d31/2\u7684\u5e27. \u867d\u7136\u5728<code>native</code>\u4e0a\u53ef\u4ee5\u8dd1\u6ee160FPS, \u4f46\u5373\u4f7f\u5f00\u542f\u8df3\u5e27\u6a21\u5f0f, \u5728NEMU\u4e2d\u4e5f\u53ea\u80fd\u8dd1\u5341\u51e0FPS.</p> <p>NEMU\u7684\u6027\u80fd\u786e\u5b9e\u4e0d\u9ad8, \u4f46LiteNES\u4e5f\u662f\u534a\u65a4\u516b\u4e24, \u4ee3\u7801\u8fd8\u6709\u975e\u5e38\u591a\u53ef\u4ee5\u4f18\u5316\u7684\u7a7a\u95f4. \u6211\u4eec\u624b\u4e0a\u6709\u4e00\u4e2a\u7ecf\u8fc7\u66b4\u529b\u4f18\u5316\u7684LiteNES, \u5b83\u5728microbench\u8dd1\u5206\u4e3a<code>236</code>\u5206\u7684<code>x86-nemu</code>\u4e0a\u4e5f\u53ef\u4ee5\u8dd1\u6ee160 FPS, \u5728microbench\u8dd1\u5206\u4e3a<code>400</code>\u5206\u7684<code>riscv32-nemu</code>\u751a\u81f3\u53ef\u4ee5\u8dd1\u5230100 FPS!</p> <p>\u4e3a\u4e86\u5c3d\u53ef\u80fd\u5c4f\u853d\u771f\u673a\u548cNEMU\u5b9e\u73b0\u5e26\u6765\u7684\u6027\u80fd\u5dee\u5f02, \u6211\u4eec\u53ef\u4ee5\u5728\u8bb0\u5f55FPS\u7684\u540c\u65f6, \u628amicrobench\u7684\u8dd1\u5206\u4e5f\u4e00\u540c\u8bb0\u5f55\u4e0b\u6765, \u7136\u540e\u8ba1\u7b97<code>FPS/\u8dd1\u5206</code>\u8fd9\u4e2a\u6307\u6807, \u6765\u8861\u91cf\u5355\u4f4d\u8ba1\u7b97\u80fd\u529b\u8d21\u732e\u7684FPS, \u901a\u8fc7\u5b83\u53ef\u4ee5\u5927\u81f4\u53cd\u6620\u51faLiteNES\u672c\u8eab\u7684\u6027\u80fd. \u6bd4\u5982\u6211\u4eec\u4e0a\u624b\u7684\u66b4\u529b\u4f18\u5316\u7248\u672c, \u5728<code>x86-nemu</code>\u4e0a\u8ba1\u7b97\u8fd9\u4e2a\u6307\u6807, \u7ed3\u679c\u662f<code>60/236 = 0.2542</code>; \u800c\u5728<code>riscv32-nemu</code>\u4e0a\u8ba1\u7b97\u5219\u662f<code>100/400 = 0.2500</code>, \u7ed3\u679c\u8fd8\u662f\u6bd4\u8f83\u4e00\u81f4\u7684.</p> <p>\u5982\u679c\u4f60\u5df2\u7ecf\u5b8c\u6210\u4e86\u5fc5\u505a\u7684\u5185\u5bb9\u800c\u53c8\u95f2\u6765\u65e0\u4e8b, \u53ef\u4ee5\u5c1d\u8bd5\u6765\u4f18\u5316LiteNES\u7684\u4ee3\u7801, \u5e76\u548c\u5c0f\u4f19\u4f34PK\u4f18\u5316\u540e\u7684\u6027\u80fd\u5427! \u4e0d\u8fc7, \u4f60\u6253\u7b97\u600e\u4e48\u6765\u8fdb\u884c\u4f18\u5316\u5462?</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5728NEMU\u4e0a\u8fd0\u884cNEMU</p> <p>\u8fd9\u542c\u4e0a\u53bb\u6709\u70b9\u75af\u72c2, \u4f46\u4ed4\u7ec6\u60f3\u60f3\u4e5f\u6ca1\u4ec0\u4e48\u4e0d\u53ef\u4ee5\u7684, \u6bd5\u7adfNEMU\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u7a0b\u5e8f. <code>am-kernels/kernels/nemu/</code>\u76ee\u5f55\u4e0b\u5df2\u7ecf\u51c6\u5907\u4e86\u4e00\u4e2aMakefile, \u4f60\u53ef\u4ee5\u5728\u8fd9\u4e00\u76ee\u5f55\u4e0b\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4:</p> <pre><code>make ARCH=$ISA-nemu mainargs=/home/user/ics2023/am-kernels/kernels/hello/build/hello-$ISA-nemu.bin\n</code></pre> <p>\u5b83\u4f1a\u8fdb\u884c\u5982\u4e0b\u7684\u5de5\u4f5c:</p> <ol> <li>\u4fdd\u5b58NEMU\u5f53\u524d\u7684\u914d\u7f6e\u9009\u9879</li> <li>\u52a0\u8f7d\u4e00\u4e2a\u65b0\u7684\u914d\u7f6e\u6587\u4ef6, \u5c06NEMU\u7f16\u8bd1\u5230AM\u4e0a, \u5e76\u628a<code>mainargs</code>\u6307\u793abin\u6587\u4ef6\u4f5c\u4e3a\u8fd9\u4e2aNEMU\u7684\u955c\u50cf\u6587\u4ef6</li> <li>\u6062\u590d\u7b2c1\u6b65\u4e2d\u4fdd\u5b58\u7684\u914d\u7f6e\u9009\u9879</li> <li>\u91cd\u65b0\u7f16\u8bd1NEMU, \u5e76\u628a\u7b2c2\u6b65\u4e2d\u7684NEMU\u4f5c\u4e3a\u955c\u50cf\u6587\u4ef6\u6765\u8fd0\u884c</li> </ol> <p>\u7b2c2\u6b65\u628aNEMU\u7f16\u8bd1\u5230AM\u65f6, \u914d\u7f6e\u7cfb\u7edf\u4f1a\u5b9a\u4e49\u5b8f<code>CONFIG_TARGET_AM</code>, \u6b64\u65f6NEMU\u7684\u884c\u4e3a\u548c\u4e4b\u524d\u76f8\u6bd4\u6709\u6240\u53d8\u5316:</p> <ul> <li>sdb, DiffTest\u7b49\u8c03\u8bd5\u529f\u80fd\u4e0d\u518d\u5f00\u542f, \u56e0\u4e3aAM\u65e0\u6cd5\u63d0\u4f9b\u5b83\u6240\u9700\u8981\u7684\u5e93\u51fd\u6570(\u5982\u6587\u4ef6\u8bfb\u5199, \u52a8\u6001\u94fe\u63a5, \u6b63\u5219\u8868\u8fbe\u5f0f\u7b49)</li> <li>\u901a\u8fc7AM IOE\u6765\u5b9e\u73b0NEMU\u7684\u8bbe\u5907</li> </ul> <p>\u601d\u8003\u4e00\u4e0b, \u5982\u679c\u5728\u5185\u5c42NEMU(\u5373\u7f16\u8bd1\u5230AM\u7684NEMU)\u4e0a\u8fd0\u884c\u6253\u5b57\u6e38\u620f:</p> <pre><code>make ARCH=$ISA-nemu mainargs=\u6253\u5b57\u6e38\u620f\u7684\u8def\u5f84\n</code></pre> <p>\u6b64\u65f6\u7684\u6253\u5b57\u6e38\u620f\u53c8\u662f\u7ecf\u5386\u4e86\u600e\u4e48\u6837\u7684\u8fc7\u7a0b\u624d\u80fd\u8bfb\u53d6\u6309\u952e/\u5237\u65b0\u5c4f\u5e55\u7684\u5462?</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_32","title":"\u5fc5\u7b54\u9898","text":""},{"location":"ysyx/pa/pa2/pa2.html#yemu_1","title":"\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a \u7406\u89e3YEMU\u7684\u6267\u884c\u8fc7\u7a0b, \u8fd9\u91cc","text":"<p>(https://ysyx.oscc.cc/docs/ics-pa/2.1.html#\u7406\u89e3yemu\u5982\u4f55\u6267\u884c\u7a0b\u5e8f).</p> <p>\u4e4b\u524d\u5df2\u7ecf\u56de\u7b54</p>"},{"location":"ysyx/pa/pa2/pa2.html#rtfsc-nemu","title":"RTFSC: \u6574\u7406\u4e00\u6761\u6307\u4ee4\u5728NEMU\u4e2d\u7684\u6267\u884c\u8fc7\u7a0b,","text":"<p>(https://ysyx.oscc.cc/docs/ics-pa/2.2.html#rtfsc\u7406\u89e3\u6307\u4ee4\u6267\u884c\u7684\u8fc7\u7a0b).</p> <p>\u8be6\u7ec6\u90e8\u5206\u770b\u524d\u9762\u7684\u56de\u7b54\u3002</p> <ol> <li><code>execute()</code>\u7684\u5faa\u73af\u4e2d\u6267\u884c\u7684<code>exec_once()</code>\u5185\uff0c\u5c06<code>pc</code>\u8d4b\u503c\u7ed9<code>s-&gt;pc</code>\u548c<code>s-&gt;npc</code>\uff0c\u7136\u540e\u6267\u884c<code>isa_exec_once()</code>\uff0c\u7136\u540e\u8ba9<code>cpu.pc = s-&gt;dpc</code>\uff0c<code>isa_exec_once()</code>\u8fd9\u4e2a\u51fd\u6570\u4e2d\u6709\u4e00\u6761\u6267\u884c\u7684\u6267\u884c\u8fc7\u7a0b\u3002</li> <li>\u9996\u5148\u53d6\u6307\uff0c<code>s-&gt;isa.inst.val = inst_fetch(&amp;s-&gt;snpc, 4);</code>\u8fd9\u6761\u8bed\u53e5\u53d6\u51fa\u6307\u4ee4\u5e76\u5c06<code>s-&gt;npc</code>\u589e\u52a0\u8be5\u6761\u6307\u4ee4\u7684\u957f\u5ea6\u3002</li> <li>\u7136\u540e\u662f\u8bd1\u7801\u548c\u6267\u884c\uff0c<code>decode_exec(s)</code>\u4e2d\u901a\u8fc7\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u6765\u5bf9\u6307\u4ee4\u8fdb\u884c\u8bd1\u7801\u548c\u6267\u884c</li> </ol>"},{"location":"ysyx/pa/pa2/pa2.html#_33","title":"\u7a0b\u5e8f\u5982\u4f55\u8fd0\u884c: \u7406\u89e3\u6253\u5b57\u5c0f\u6e38\u620f\u5982\u4f55\u8fd0\u884c","text":"<p>(https://ysyx.oscc.cc/docs/ics-pa/2.5.html#\u6e38\u620f\u662f\u5982\u4f55\u8fd0\u884c\u7684).**</p> <p>\u57fa\u4e8e riscv32\uff08ISA\uff09 \uff0c\u6211\u4eec\u63d0\u4f9b\u597d\u4e86\u786c\u4ef6\uff08NMEU\uff09CPU\uff08\u5bc4\u5b58\u5668\uff09\u3001\u5185\u5b58\uff0c\u4ee5\u53ca\u5404\u79cd I/O \u8bbe\u5907\uff1atimer\u3001keyboard\u3001vga\u7b49\u7b49\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u5e0c\u671b\u9694\u7edd\u4e0e ISA \u76f8\u5173\u7684\u5185\u5bb9\uff0c\u5c06\u5176\u62bd\u8c61\u6210 API\uff0c\u4e0a\u5c42\u7a0b\u5e8f\u5458\u53ea\u9700\u8c03\u7528 API \u5373\u53ef\uff0c\u65e0\u9700\u5173\u5fc3\u5177\u4f53\u7684\u67b6\u6784\u7ec6\u8282\uff0c\u56e0\u6b64\u8fd9\u7ec4\u62bd\u8c61\u5e95\u5c42\u7684 API \u4ee3\u8868\u4e86\u7a0b\u5e8f\u8fd0\u884c\u5bf9\u8ba1\u7b97\u673a\u7684\u8981\u6c42\uff0c\u4e5f\u5c31\u662f AM \u62bd\u8c61\u8ba1\u7b97\u673a\uff0c\u8fdb\u4e00\u6b65\u62bd\u8c61\u76f8\u5173\u7684\u786c\u4ef6\uff08CPU\u3001memory\u3001\u5404\u79cd I/O \u8bbe\u5907...\uff09\u3002\u8fdb\u800c\u5212\u5206\u51fa\u4e86 IOE\u3001TRM\u3001\u901a\u7528\u5e93\u51fd\u6570\u7b49\u5185\u5bb9\u3002\u73b0\u5728\u7a0b\u5e8f\u6e38\u620f\u5c31\u53ef\u4ee5\u5f00\u59cb\u8fd0\u884c\u4e86\u3002</p> <p>\u5148\u770b\u770bIO\u8c03\u7528\u6d41\u7a0b\uff0c\u518d\u6765\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#io_3","title":"I/O \u8c03\u7528\u6d41\u7a0b","text":"<p>\u6839\u636e\u524d\u9762\u7684 <code>rtc_test</code> \u81ea\u884c\u603b\u7ed3\u7684 I/O \u8c03\u7528\u6d41\u7a0b</p> <p>klib\u4e2d\u63d0\u4f9b\u4e86<code>io_read()</code>\u548c<code>io_write()</code>\u8fd9\u4e24\u4e2a\u5b8f, \u5b83\u4eec\u5206\u522b\u5bf9<code>ioe_read()</code>\u548c<code>ioe_write()</code>\u8fd9\u4e24\u4e2aAPI\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5.</p> <pre><code>0x8000000c:  call [_trm_init@0x80001030]\n0x80001040:    call [main@0x80000e48]\n0x80000e8c:      call [???@0x80000fe0]\n0x80000ff0:        call [ioe_init@0x800010e4]\n0x80001124:          call [__am_gpu_init@0x800011dc]\n0x800011dc:           ret [__am_gpu_init]\n0x80001128:          call [__am_timer_init@0x80001178]\n0x80001178:           ret [__am_timer_init]\n0x8000112c:          call [__am_audio_init@0x800012d0]\n0x800012d0:           ret [__am_audio_init]\n0x8000113c:         ret [ioe_init]\n0x80000ff4:        call [rtc_test@0x80000010]\n0x80000070:          call [ioe_read@0x80001140]\n0x80001158:            call [__am_timer_uptime@0x8000117c]\n0x80001190:             ret [__am_timer_uptime]\n0x80000084:            call [__udivdi3@0x8000194c]\n0x800016a0:             ret [__udivmoddi4]\n// \u8fd9\u91cc\u611f\u89c9 ftrace\u5b9e\u73b0\u7684\u6709\u70b9\u95ee\u9898\n</code></pre> <p>\u901a\u8fc7 <code>rtc_test</code> \u634b\u4e00\u4e0b I/O \u8c03\u7528\u6d41\u7a0b</p> <pre><code>void rtc_test() {\n  AM_TIMER_RTC_T rtc;\n  int sec = 1;\n  while (1) {\n    while(io_read(AM_TIMER_UPTIME).us / 1000000 &lt; sec) ;\n    rtc = io_read(AM_TIMER_RTC);\n    printf(\"%d-%d-%d %02d:%02d:%02d GMT (\", rtc.year, rtc.month, rtc.day, rtc.hour, rtc.minute, rtc.second);\n    if (sec == 1) {                                                                                                       \n      printf(\"%d second).\\n\", sec);\n    } else {\n      printf(\"%d seconds).\\n\", sec);\n    }\n    sec ++;\n  }\n}\n</code></pre> <p>\u5176\u5b9e\u5173\u952e\u5c31\u8fd9\u90e8\u5206</p> <ul> <li> <p>\u5e94\u7528\u7a0b\u5e8f\uff1a</p> <p>io_read\uff08ioe_read\uff09 -&gt; \u5230\u65f6\u95f4 printf</p> </li> <li> <p>AM \u5c42\uff1a</p> <p>\u4e0d\u65ad\u5730\u8c03\u7528 io_read(AM_TIMER_UPTIME) -&gt; ioe_read -&gt; __am_timer_uptime (\u8fd9\u90e8\u5206\u4e3a AM \u7684 IOE \u62bd\u8c61) \u83b7\u53d6\u7cfb\u7edf\u65f6\u95f4\u3002</p> </li> <li> <p>\u786c\u4ef6 CPU /\u5185\u5b58/\u8bbe\u5907\u90e8\u5206\uff08NEMU\uff09\uff1a </p> <p><code>inl(RTC_ADDR)</code> \u83b7\u53d6\u5b58\u50a8\u5728 DEVICE_BASE + RTC_ADDR = 0xa0000000 \u7684\u7cfb\u7edf\u65f6\u95f4\uff0c\u9ad8\u4f4e\u5404\u56db\u4e2a\u5b57\u8282\u3002 </p> <p>-&gt; <code>load</code> \u7c7b\u6307\u4ee4\uff1a<code>lw a4,76(a5)</code>\u3001<code>lw a4,72(a5)</code> </p> </li> </ul> <p></p> <p>\u81f3\u4e8elw\u6307\u4ee4\uff0c\u66f4\u597d\u7406\u89e3\uff0c\u5b9e\u9645\u4e3a\u8bbf\u5b58\u6307\u4ee4\u3002</p> <pre><code>#define Mr vaddr_read\n...\n INSTPAT(\u201c...\u201d lw     , I, R(rd) = SEXT(Mr(src1 + imm, 4), 32)); \n...\n</code></pre> <p>-&gt; paddr_read</p> <p>\u6839\u636e\u5185\u5b58\u8303\u56f4\uff0c\u770b \u8bfb\u8bbe\u5907(mmio) \u8fd8\u662f \u666e\u901a\u8bbf\u5b58\uff0c\u8fd9\u91cc\u80af\u5b9a\u662f <code>mmio_read</code></p> <p></p> <p>-&gt; map_read -&gt; \u8c03\u7528\u56de\u8c03\u51fd\u6570 map-&gt;callbak</p> <p><code>map-&gt;callbak</code> \u4e5f\u5c31\u662f\u4e4b\u524d\u6ce8\u518c\u7684 <code>rtc_io_handler</code>\u3002</p> <p>\u7136\u540e\u8bfb\u53d6\u5230\u7684\u65f6\u95f4\u76f8\u5173\u4fe1\u606f\uff0c\u5b58\u5230\u5730\u5740\u4e3a <code>rtc_port_base</code> \u91cc\uff0c\u4e5f\u5c31\u662f \u7ed3\u6784\u4f53 <code>IOMAP</code> \u91cc\u7684 <code>space</code>\u3002</p> <p></p> <p></p> <p>\u7531\u6b64\u53ef\u603b\u7ed3\u5b9e\u9645\u7684 IO \u8c03\u7528\u6d41\u7a0b\u7684\u5173\u952e\u5728\u4e8e <code>mmio.c</code> \u548c <code>map.c</code> \uff1a</p> <ul> <li> <p><code>mmio.c</code> \u5728\u4e8e\u7ba1\u7406\u6bcf\u4e2a\u5b9e\u9645\u7684\u8bbe\u5907\uff08\u4ee5\u7ed3\u6784\u4f53 <code>IOMap</code>  \u5f62\u5f0f)\u7684\uff0c\u5bf9\u4e0a\u62bd\u8c61\uff0c\u5bf9\u4e0b\u63a5\u53e3\u3002</p> <p>\u5bf9\u62bd\u8c61\u5c42 AM\uff0c\u5728\u4e0a\u9762\u6267\u884c\u76f8\u5173\u7684 <code>__am_xxx_xxx</code>\uff0c<code>mmio.c</code> \u63a5\u6536\u5bf9\u4e0e\u67b6\u6784\u65e0\u5173\u7684\u62bd\u8c61\u5bc4\u5b58\u5668( <code>AM_##reg\u3001AM_##reg##_T</code> ) \u7684\u64cd\u4f5c\uff0c\u5c06\u64cd\u4f5c\u5bf9\u8c61\uff1a\u62bd\u8c61\u8bbe\u5907\u5bc4\u5b58\u5668\u8f6c\u6362\u6210\u5b9e\u9645\u7684\u8bbe\u5907\u5bc4\u5b58\u5668\uff08IOMap\uff09\u3002</p> <p>\u5bf9\u4e0b\u5c42\uff1a\u5177\u4f53\u8f6c\u6362\uff1a\u901a\u8fc7 <code>fetch_mmio_map</code> \u51fd\u6570 (\u901a\u8fc7 <code>IOMap maps[]</code> \u7684\u6570\u7ec4\u504f\u79fb\uff0c\u5f88\u5e38\u89c1\u7684\u64cd\u4f5c ) \u83b7\u53d6\u672c\u6b21\u64cd\u4f5c\u7684\u8bbe\u5907\uff0c\u7136\u540e\u8fdb\u4e00\u6b65\u4ea4\u7ed9 map.c\u3002</p> <p>\u5173\u952e\u5c31\u5728\u4e8e\uff1a</p> <p>\u83b7\u53d6\u7ed9\u5b9a\u5730\u5740(eg. DEVICE_BASE + RTC_ADDR)\u7684 IOMap \u7ed3\u6784\u4f53\uff0c</p> <p>\u4f20\u7ed9 map\uff08AM_DEV --&gt; IOMap\uff09</p> </li> <li> <p><code>map.c</code> \u7ba1\u7406\u771f\u5b9e\u8bbe\u5907\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5173\u952e\u5728\u4e8e\u5c06\u8bbe\u5907\u5730\u5740\u8f6c\u6362\u6210\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740\u3001\u6267\u884c\u5177\u4f53\u56de\u8c03\u51fd\u6570</p> <p>\u5728\u6bcf\u4e00\u4e2a\u8bbe\u5907\u90fd\u521d\u59cb\u5316\u597d\uff0c\u5206\u914d\u597d\u7a7a\u95f4\u4e4b\u540e\uff1a</p> <pre><code>./nemu/src/device/io/map.c:uint8_t* new_space(int size)\n\n./nemu/src/device/audio.c:  audio_base = (uint32_t *)new_space(space_size);\n./nemu/src/device/audio.c:  sbuf = (uint8_t *)new_space(CONFIG_SB_SIZE);\n./nemu/src/device/keyboard.c:  i8042_data_port_base = (uint32_t *)new_space(4);\n./nemu/src/device/sdcard.c:  base = (uint32_t *)new_space(0x80);\n./nemu/src/device/serial.c:  serial_base = new_space(8);\n./nemu/src/device/timer.c:  rtc_port_base = (uint32_t *)new_space(8);\n./nemu/src/device/vga.c:  vgactl_port_base = (uint32_t *)new_space(8);\n./nemu/src/device/vga.c:  vmem = new_space(screen_size());\n\n    /...all device register -&gt; io_space\n</code></pre> <p>\u6211\u4eec\u5b9e\u9645\u8981\u64cd\u4f5c\u7684\u8bbe\u5907\u5bc4\u5b58\u5668\u4e5f\u5c31\u662f <code>xxx_port_base</code> \u7684\u8fd9\u4e00\u7247\u7a7a\u95f4\u3002</p> <p>\u672c\u8d28\u4e0a\u5c31\u662f <code>map.c</code> \u4e2d\u901a\u8fc7 \u5806 \u7533\u8bf7\u7684 <code>io_space</code> \u8fd9\u4e00\u7247\u5185\u5b58\u3002</p> </li> <li> <p>\u5177\u4f53\u4f8b\u5b50\u7406\u89e3</p> <pre><code>add_mmio_map(\"rtc\", CONFIG_RTC_MMIO, rtc_port_base, 8, rtc_io_handler);\nvoid add_mmio_map(const char *name, paddr_t addr, void *space, uint32_t len, io_callback_t callback) {\n    ...\nmaps[nr_map]= (IOMap){ .name = name, .low = addr, .high = addr + len - 1,\n.space = space, .callback = callback };\n       ...\n}\n// CONFIG_RTC_MMIO=0xa0000048\n// dtrace: read        rtc at 0xa000004c len: 4\n// map-&gt;high: 0xa000004f map-&gt;low: 0xa0000048 map-&gt;space: 0x175\n// dtrace: read        rtc at 0xa0000048 len: 4\n// map-&gt;high: 0xa000004f map-&gt;low: 0xa0000048 map-&gt;space: 0x175\n\nword_t map_read(paddr_t addr, int len, IOMap *map){ \n paddr_t offset = addr - map-&gt;low;\n invoke_callback(map-&gt;callback, offset, len, false); // prepare data to read\n word_t ret = host_read(map-&gt;space + offset, len);\n return ret;\n}\n// \u6ce8\u518c\u7684\u8bbe\u5907\u5bc4\u5b58\u5668 rtc_port_base \u5728\u5185\u5b58 0xa0000048 ~ 0xa000004f\uff0c\u5bc4\u5b58\u5668\u5927\u5c0f\u4e3a 8byte \n// \u5b9e\u9645\u8bbf\u95ee\u7684addr: 0xa000004c\u30010xa0000048 \u5f80\u540e\u56db\u4e2abyte\uff0c\u786e\u5b9e\u5bf9\u5e94\u4e0a\u4e86\u3002\n\n// \u6240\u4ee5\u8981\u8bbf\u95ee\u7684\u7269\u7406\u5730\u5740\u662fmap -&gt; space + offest: \u5bc4\u5b58\u5668 + offest\nstatic void rtc_io_handler(uint32_t offset, int len, bool is_write) {\n    assert(offset == 0 || offset == 4);\n    if (!is_write &amp;&amp; offset == 4) {\n        uint64_t us = get_time();\n        rtc_port_base[0] = (uint32_t)us;\n        rtc_port_base[1] = us &gt;&gt; 32;\n    }\n}\n\n// \u7a81\u7136\u610f\u8bc6\u5230\u4e00\u4e2abug\uff0c\u8981\u662f\u6211rtc\u5148\u8bfb\u53d6\u4f4e\u4f4d\u65f6\u95f4\uff0c\u4e0d\u5c31\u9519\u4e86\uff1fyes\n// \u7b2c\u4e00\u6b21 inl \u8bfb\u53d6\u7684\u65f6\u4e0a\u4e00\u6b21\u7684\u65f6\u95f4\n// \u7b2c\u4e8c\u6b21\u624d\u65f6\u5bf9\u7684\u65f6\u95f4\uff1f\u51d1\u5de7\u5bf9\u4e86\u3002\nstatic inline word_t host_read(void *addr, int len) {\nswitch (len) {\n  case 1: return *(uint8_t  *)addr;\n  case 2: return *(uint16_t *)addr;\n  case 4: return *(uint32_t *)addr;\n  IFDEF(CONFIG_ISA64, case 8: return *(uint64_t *)addr);\n  default: MUXDEF(CONFIG_RT_CHECK, assert(0), return 0);\n}\n}\n\u548c dtrace \u5bf9\u5e94\u4e0a\u4e86\n</code></pre> <p>\u5404\u4e2a\u8bbe\u5907\u6ce8\u518c\u7684\u5bc4\u5b58\u5668\uff0c\u901a\u8fc7 <code>MMIO</code> \u6620\u5c04\u5230\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5171\u540c\u7ec4\u6210\u4e86 <code>io_space</code> \u3002</p> <p>\u6839\u636e <code>io_space</code> \u548c\u4e0a\u9762\u6ce8\u518c\u5728 <code>IOMap</code> \u91cc\u7684\u672c\u8bbe\u5907\u4fe1\u606f</p> <p>\u6267\u884c\u5bbf\u4e3b\u673a\u76f8\u5173\u64cd\u4f5c\uff1a</p> <ul> <li>host_read \u8bfb\u53d6 map-&gt;space</li> <li>\u5b9e\u9645\u8bbe\u5907\u64cd\u4f5c\uff1a\u8bbe\u5907\u7684\u56de\u8c03\u51fd\u6570\uff08audio\u3001vga\u8fd9\u79cd\u76f4\u63a5\u64cd\u4f5c\u5185\u5b58\u7684\uff0c\u6709buffer\u7684\u9664\u5916\uff09\u3002</li> </ul> </li> </ul> <p>\u8fd9\u91cc\u53ef\u80fd\u4f1a\u6709\u70b9\u8bef\u533a\uff08\u62bd\u8c61\u548c\u865a\u62df\u5316\uff09\uff0c\u5c31\u662f\u8ba4\u4e3a\u4ece\u4e0a\u5c42\u4f20\u4e0b\u6765\u7684\u5730\u5740\u4e0d\u90fd\u4e00\u6837\u5417\uff1f(0xa0000048)\u4f55\u6765\u865a\u62df\u5730\u5740\uff1f\u6ce8\u610f\u6211\u4eec\u4e4b\u540e\u53ea\u8981\u5bf9\u4e8e\u5730\u5740\u7a7a\u95f4\u6dfb\u52a0\u76f8\u5e94\u7684\u865a\u62df\u5316\u5904\u7406\uff0c\u90a3\u5c31\u6709\u8fd9\u4e2a\u610f\u601d\u4e86\u3002\u8003\u8651\u5230\u7cfb\u7edf\u7684\u590d\u6742\u6027\uff0c\u76ee\u524d NEMU \u6ca1\u6709\u52a0\u5165\u865a\u62df\u5316\u76f8\u5173\u7684\uff0cPA4 \u4f1a\u6709\uff0c\u4f46\u662f\u76ee\u524d\u5df2\u7ecf\u5177\u5907\u5f62\u72b6\u4e86\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1alow\u3001high\u5b9e\u9645\u4e0a\u4e3a\u865a\u62df\u5730\u5740\uff0c\u4e5f\u5c31\u662f CPU \u786c\u4ef6(NEMU) \u63d0\u4f9b\u7ed9 \u4e0a\u5c42\u7684AM\u7684\uff0c\u800c\u771f\u6b63\u7684\u7269\u7406\u5730\u5740\u4e3a <code>io_space</code>\uff0c\u4e5f\u5c31\u662f\u5404\u4e2a\u5bc4\u5b58\u5668\u7ec4\u6210\u7684\u5730\u5740\u7a7a\u95f4\u3002\u522b\u770b\u4e0a\u9762\u7684 <code>dtrace</code> \u5bf9\u4e8e\u4e24\u8005\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u53ea\u8981\u6211\u4eec\u5728mmio\u8fd9\u4e00\u5c42\u4ea4\u7ed9 <code>map</code> \u7684\u8fd9\u4e00\u5c42\uff0c\u52a0\u5165\u4e00\u4e9b\u865a\u62df\u5316\u7684\u4e1c\u897f\uff0c\u4fee\u6539\u4e00\u4e9b\u6838\u5fc3\u51fd\u6570 <code>fetch_mmio_map()</code> \u6211\u4eec\u81ea\u7136\u5c31\u80fd\u770b\u5230\u76f8\u5bf9\u5e94\u7684\u6548\u679c\u4e86\u3002</p> <ul> <li> <p>\u8865\u5145</p> <p>\u8fd9\u91cc\u901a\u8bfb\u4e00\u904d\u6846\u67b6\u4ee3\u7801\u53d1\u73b0\uff1a</p> <p>\u5bf9\u4e8e <code>NEMU</code> \u62bd\u8c61\u65f6\uff08native\u4e2d\u5c31\u4e0d\u4e00\u6837\uff09\uff0c\u53ea\u6709\u4e32\u53e3\u662f\u76f4\u63a5\u8c03\u7528 <code>outb</code> \u6765\u63a7\u5236\u8bbe\u5907\u7684\uff1a\u4e00\u65b9\u9762\u662f\u6846\u67b6\u4ee3\u7801\u5c06\u4e32\u53e3\u8f93\u51fa\u7684\u5185\u5bb9\u4e5f\u52a0\u5165\u5230 TRM \u91cc\u53bb\u4e86\uff0c\u53e6\u4e00\u65b9\u9762\u662f \u4e32\u53e3 \u6700\u4e3a\u7b80\u5355\u3002\uff08\u53ef\u4ee5\u5bf9\u6bd4 <code>native</code> \u6765\u770b\uff09</p> <p>\u5176\u4ed6\u7684\u8bbe\u5907\u90fd\u8fdb\u884c\u4e86\u5148\u4e00\u6b65\u5c01\u88c5\u4e4b\u540e\u624d\u5728\u5185\u90e8\u8c03\u7528 <code>inl</code> / <code>outb</code> \u7684\uff1a</p> <p>\u9996\u5148\u5c06\u8bbe\u5907\u5168\u90e8\u62bd\u8c61\u6210\u62bd\u8c61\u5bc4\u5b58\u5668\uff08<code>amdev.h</code>\uff09\u4ee5\u53ca\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u7ed3\u6784\u4f53(<code>AM_##reg##_T</code>) \uff1a</p> <pre><code>AM_DEVREG( 1, UART_CONFIG,  RD, bool present);\nAM_DEVREG( 2, UART_TX,      WR, char data);\nAM_DEVREG( 3, UART_RX,      RD, char data);\nAM_DEVREG( 4, TIMER_CONFIG, RD, bool present, has_rtc);\nAM_DEVREG( 5, TIMER_RTC,    RD, int year, month, day, hour, minute, second);\nAM_DEVREG( 6, TIMER_UPTIME, RD, uint64_t us);\nAM_DEVREG( 7, INPUT_CONFIG, RD, bool present);\nAM_DEVREG( 8, INPUT_KEYBRD, RD, bool keydown; int keycode);\nAM_DEVREG( 9, GPU_CONFIG,   RD, bool present, has_accel; int width, height, vmemsz);\nAM_DEVREG(10, GPU_STATUS,   RD, bool ready);\nAM_DEVREG(11, GPU_FBDRAW,   WR, int x, y; void *pixels; int w, h; bool sync);\nAM_DEVREG(12, GPU_MEMCPY,   WR, uint32_t dest; void *src; int size);\nAM_DEVREG(13, GPU_RENDER,   WR, uint32_t root);\n...\n</code></pre> <p>\u5bf9\u4e8e \u8bbe\u5907\u7684\u5177\u4f53\u884c\u4e3a\u8fdb\u884c\u5c01\u88c5\uff1a</p> <pre><code>static void *lut[128] = {\n  [AM_TIMER_CONFIG] = __am_timer_config,\n  [AM_TIMER_RTC   ] = __am_timer_rtc,\n  [AM_TIMER_UPTIME] = __am_timer_uptime,\n\n  [AM_INPUT_CONFIG] = __am_input_config,\n  [AM_INPUT_KEYBRD] = __am_input_keybrd,\n\n  [AM_GPU_CONFIG  ] = __am_gpu_config,\n  [AM_GPU_FBDRAW  ] = __am_gpu_fbdraw,\n  [AM_GPU_STATUS  ] = __am_gpu_status,\n\n  [AM_UART_CONFIG ] = __am_uart_config, (false)\n  [AM_AUDIO_CONFIG] = __am_audio_config,\n  [AM_AUDIO_CTRL  ] = __am_audio_ctrl,\n  // ...\n}\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7 <code>io_read(AM__TIMER_UPTIME)</code> / <code>io_write(AM_XXX_XXX)</code> ( <code>ioe_read</code> / <code>ioe_write</code> ) \u8bfb\u5199\u8fd9\u4e9b\u8c03\u7528\u4e0a\u8ff0\u7684\u8bbe\u5907\u884c\u4e3a\uff0c\u8bfb\u5199\u62bd\u8c61\u5bc4\u5b58\u5668\u3002</p> <p>\u8bbe\u5907\u884c\u4e3a\u7684\u51fd\u6570\u4f53\u5185\u90e8\u624d\u662f\u5b9e\u9645 <code>inl/outb</code>\u6307\u4ee4\u3002</p> <p>\u53c8\u662f\u62bd\u8c61\u548c\u5c01\u88c5\u7684\u827a\u672f\u554a</p> <p>\u901a\u8fc7\u672c\u6d41\u7a0b\uff0c\u5176\u4ed6\u7684I/O\u8bbe\u5907\u4e5f\u662f\u7c7b\u4f3c\u7684</p> </li> </ul>"},{"location":"ysyx/pa/pa2/pa2.html#_34","title":"\u4ece\u6253\u5b57\u5c0f\u6e38\u620f\u5206\u6790\u8ba1\u7b97\u673a\u7cfb\u7edf","text":"<pre><code>ioe_init();\nvideo_init();\npanic_on(!io_read(AM_TIMER_CONFIG).present, \"requires timer\");         \npanic_on(!io_read(AM_INPUT_CONFIG).present, \"requires keyboard\");\nprintf(\"Type 'ESC' to exit\\n\");\nint current = 0, rendered = 0;\nuint64_t t0 = io_read(AM_TIMER_UPTIME).us;\n</code></pre> <p>\u76f8\u5173 \u521d\u59cb\u5316\u3002</p> <p>\u91cd\u70b9\u770b\u5c4f\u5e55video\uff1a</p> <pre><code>void video_init() {\n   screen_w = io_read(AM_GPU_CONFIG).width;\n   screen_h = io_read(AM_GPU_CONFIG).height;\n\n   extern char font[];\n   for (int i = 0; i &lt; CHAR_W * CHAR_H; i++)\n     blank[i] = COL_PURPLE;\n\n   uint32_t blank_line[screen_w];\n   for (int i = 0; i &lt; screen_w; i++)\n     blank_line[i] = COL_PURPLE;\n\n   for (int y = 0; y &lt; screen_h; y ++)\n     io_write(AM_GPU_FBDRAW, 0, y, blank_line, screen_w, 1, false);\n\n   for (int ch = 0; ch &lt; 26; ch++) {\n     char *c = &amp;font[CHAR_H * ch];\n     for (int i = 0, y = 0; y &lt; CHAR_H; y++)\n       for (int x = 0; x &lt; CHAR_W; x++, i++) {\n         int t = (c[y] &gt;&gt; (CHAR_W - x - 1)) &amp; 1;\n         texture[WHITE][ch][i] = t ? COL_WHITE : COL_PURPLE;\n         texture[GREEN][ch][i] = t ? COL_GREEN : COL_PURPLE;\n         texture[RED  ][ch][i] = t ? COL_RED   : COL_PURPLE;\n       }\n   }\n }\n</code></pre> <p>\u4e3b\u8981\u8c03\u7528\u7684 am\u7684 vga\uff1aAM_GPU_FBDRAW\u3002\u8bfb\u53d6\u5c4f\u5e55\u5bbd\u5ea6\uff0c\u521d\u59cb\u5316\u4e00\u4e9b\u5185\u5bb9\u3002</p> <p>\u7a0b\u5e8f -&gt; AM -&gt; NEMU \u786c\u4ef6\uff08VGA)\u663e\u793a\u50cf\u7d20 -&gt; \u8fd8\u662f\u540c\u4e4b\u524d\u5206\u6790\u7684 IO\u8c03\u7528\u6d41\u7a0b\u4e00\u6837\u3002\uff08\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\uff09</p> <p>\u4e0b\u9762\u4ec5\u770bwrite\uff0c\u4e5f\u5c31\u662ffbdraw</p> <p>ioe_write  -&gt; ioe_write (AM_GPU_FBDRAW) -&gt; __am_gpu_fbdraw \u8d1f\u8d23\u7ed8\u56fe AM \u7684 IOE \u62bd\u8c61 </p> <pre><code>#define io_read(reg) \\\n  ({ reg##_T __io_param; \\\n    ioe_read(reg, &amp;__io_param); \\\n    __io_param; })\n\n#define io_write(reg, ...) \\\n  ({ reg##_T __io_param = (reg##_T) { __VA_ARGS__ }; \\\n    ioe_write(reg, &amp;__io_param); })\n\n//nemu/include/macro.h\n\n typedef void (*handler_t)(void *buf);\n static void *lut[128] = {\n   [AM_TIMER_CONFIG] = __am_timer_config,\n   [AM_TIMER_RTC   ] = __am_timer_rtc,\n   [AM_TIMER_UPTIME] = __am_timer_uptime,\n   [AM_INPUT_CONFIG] = __am_input_config,\n   [AM_INPUT_KEYBRD] = __am_input_keybrd,\n   [AM_GPU_CONFIG  ] = __am_gpu_config,\n   [AM_GPU_FBDRAW  ] = __am_gpu_fbdraw,\n    //...\n };\n\n...\n void ioe_read (int reg, void *buf) { ((handler_t)lut[reg])(buf); }\n void ioe_write(int reg, void *buf) { ((handler_t)lut[reg])(buf); }    \n//abstract-machine/am/src/platform/nemu/ioe/ioe.c\n\nAM_DEVREG(11, GPU_FBDRAW,   WR, int x, y; void *pixels; int w, h; bool sync);\n//abstract-machine/am/include/amdev.h\n</code></pre> <p>-&gt; outl \u5199\u5185\u5b58 sync = 1\uff1b</p> <p></p> <p></p> <p>\u5bf9\u4e8e\u786c\u4ef6\u90e8\u5206\uff08CPU /\u5185\u5b58/\u8bbe\u5907\uff09NEMU\uff1a</p> <p>\u8fd9\u91cc\u7684__am_gpu_fbdraw \u5e76\u6ca1\u6709\u771f\u6b63\u5b9e\u73b0\u753b\u56fe\u64cd\u4f5c\uff0c\u53ea\u662f\u628a\u9700\u8981\u7ed8\u5236\u7684\u50cf\u7d20\u70b9\u5b58\u5230\u4e86framebuffer\uff08FB_ADDR\uff09\u3002</p> <p>\u8981\u5237\u65b0\u7684\u8bdd\uff0c\u6700\u7ec8\u8fd8\u662f\u770b\u5e94\u7528\u7a0b\u5e8f\u7684\u6bcf\u6b21\u8c03\u7528 io_write \u6307\u5b9a sync \u4e3a true\u7684\u5237\u65b0\u3002</p> <p>\u8fdb\u4e00\u6b65\u5230 CPU \u76f8\u5173\u7684\u4ee3\u7801\uff1a</p> <pre><code>static void execute(uint64_t n) {\n  Decode s;\n  for (;n &gt; 0; n --) {\n    exec_once(&amp;s, cpu.pc);\n    g_nr_guest_inst ++;\n    trace_and_difftest(&amp;s, cpu.pc);\n    if (nemu_state.state != NEMU_RUNNING) break;\n    IFDEF(CONFIG_DEVICE, device_update());\n  }\n}\n//src/cpu/cpu-exec.c\n\nvoid device_update() {\n  static uint64_t last = 0;\n  uint64_t now = get_time();\n  if (now - last &lt; 1000000 / TIMER_HZ) {\n    return;\n  }\n  last = now;\n\n  IFDEF(CONFIG_HAS_VGA, vga_update_screen());\n\n#ifndef CONFIG_TARGET_AM\n  SDL_Event event;\n  while (SDL_PollEvent(&amp;event)) {\n    switch (event.type) {\n      case SDL_QUIT:\n        nemu_state.state = NEMU_QUIT;\n        break;\n#ifdef CONFIG_HAS_KEYBOARD\n      // If a key was pressed\n      case SDL_KEYDOWN:\n      case SDL_KEYUP: {\n        uint8_t k = event.key.keysym.scancode;\n        bool is_keydown = (event.key.type == SDL_KEYDOWN);\n        send_key(k, is_keydown);\n        break;\n      }\n#endif\n      default: break;\n    }\n  }\n#endif\n//src/device/device.c\n\n\nstatic inline void update_screen() {\n   io_write(AM_GPU_FBDRAW, 0, 0, vmem, screen_width(), screen_height(), true);\n }\n #endif\n #endif\n\n void vga_update_screen() {\n   // TODO: call `update_screen()` when the sync register is non-zero,\n   // then zero out the sync register\n   uint32_t sync = vgactl_port_base[1];\n   if (sync) {\n     update_screen();\n     vgactl_port_base[1] = 0;\n   }\n\n//src/device/vga.c\n</code></pre> <p>\u5728\u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4\u540e\uff0c\u5982\u679csync\u4e3a\u771f\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u7acb\u5373\u540c\u6b65\u7f13\u51b2\u3002</p> <p>cpu\u90fd\u4f1a\u6267\u884c device_update-&gt; vga_update_screen -&gt;update_screen\uff0c\u4ee5\u6b64\u6765\u5237\u65b0\u5c4f\u5e55\u3002</p> <p>\u4e4b\u540e\u5c31\u662f while(1) \u5185\uff1a </p> <pre><code>0x800007f4:                            call [ioe_read@0x800009a8]\n0x800009c0:                              call [__am_timer_uptime@0x800009e4]\n0x800009f8:                               ret [__am_timer_uptime]\n0x80000818:                              call [__udivdi3@0x80000e88]\n0x80000bdc:                               ret [__udivmoddi4]\n0x8000082c:                              call [game_logic_update@0x800000dc]\n0x80000194:                               ret [game_logic_update]\n0x8000083c:                              call [ioe_read@0x800009a8]\n0x800009c0:                                call [__am_input_keybrd@0x80000a1c]\n0x80000a40:                                 ret [__am_input_keybrd]\n0x8000086c:                                call [render@0x800001a8]\n0x80000234:                                  call [ioe_write@0x800009c4]\n0x800009dc:                                    call [__am_gpu_fbdraw@0x80000a74]\n0x80000b28:                                     ret [__am_gpu_fbdraw]\n0x80000234:                                    call [ioe_write@0x800009c4]\n0x800009dc:                                      call [__am_gpu_fbdraw@0x80000a74]\n0x80000b28:                                       ret [__am_gpu_fbdraw]\n// ... repeat ... ioe_write\u3001__am_gpu_fbdraw\n0x80000334:  call [ioe_write@0x800009c4]\n0x800009dc:    call [__am_gpu_fbdraw@0x80000a74]\n0x80000b28:     ret [__am_gpu_fbdraw]\n0x80000340:    call [putch@0x80000880]\n0x80000888:     ret [putch]\n// ... repeat...  putch\n0x80000340:    call [putch@0x80000880]\n0x80000888:     ret [putch]\n0x80001010:    call [vsprintf@0x80001140]\n0x80001240:      call [itoa@0x80001048]\n0x800010f4:        call [strcpy@0x80001278]\n0x80001290:         ret [strcpy]\n0x80001108:       ret [itoa]\n0x80001240:      call [itoa@0x80001048]\n0x800010f4:        call [strcpy@0x80001278]\n0x80001290:         ret [strcpy]\n0x80001108:       ret [itoa]\n0x80001240:      call [itoa@0x80001048]\n0x800010f4:        call [strcpy@0x80001278]\n0x80001290:         ret [strcpy]\n0x80001108:       ret [itoa]\n0x80001204:     ret [vsprintf]\n0x80001028:    call [putch@0x80000880]\nH0x80000888:     ret [putch]\n... repeat...\n0x80001028:    call [putch@0x80000880]\n80x80000888:     ret [putch]\n0x80001044:   ret [printf] // render()\n</code></pre> <p>\u6e38\u620f\u903b\u8f91\uff1a</p> <ol> <li> <p>\u66f4\u65b0\u5c4f\u5e55\u4e4b\u524d\uff1agame_logic_update()</p> <p>new_char \u751f\u6210\u65b0\u7684\u5b57\u7b26\uff0c\u4e4b\u540e \u66f4\u65b0\u6bcf\u4e2a\u5b57\u7b26\u7684\u4f4d\u7f6e\u548c\u72b6\u6001\u3002</p> </li> <li> <p>\u8c03\u7528render\u51fd\u6570\uff0c\u66f4\u65b0\u5c4f\u5e55</p> <pre><code>if (current &gt; rendered) {\n  render();\n  rendered = current;\n}\nvoid render() {\n  static int x[NCHAR], y[NCHAR], n = 0;\n                                                    \n  for (int i = 0; i &lt; n; i++) {\n    io_write(AM_GPU_FBDRAW, x[i], y[i], blank, CHAR_W, CHAR_H, false);\u3001\n  }\n                                                    \n  n = 0;\n  for (int i = 0; i &lt; LENGTH(chars); i++) {\n    struct character *c = &amp;chars[i];\n    if (c-&gt;ch) {\n      x[n] = c-&gt;x; y[n] = c-&gt;y; n++;\n      int col = (c-&gt;v &gt; 0) ? WHITE : (c-&gt;v &lt; 0 ? GREEN : RED);\n      io_write(AM_GPU_FBDRAW, c-&gt;x, c-&gt;y, texture[col][c-&gt;ch - 'A'], CHAR_W, CHAR_H, false);\n    }\n  }\n  io_write(AM_GPU_FBDRAW, 0, 0, NULL, 0, 0, true);\n  for (int i = 0; i &lt; 40; i++) putch('\\b');\n  printf(\"Hit: %d; Miss: %d; Wrong: %d\", hit, miss, wrong);\n}\n</code></pre> <ul> <li>\u9996\u5148\uff0c\u6e05\u9664\u4e4b\u524d\u6e32\u67d3\u7684\u5b57\u7b26\u3002</li> <li>\u7136\u540e\uff0c\u904d\u5386<code>chars</code>\u6570\u7ec4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u7b26\u5b9e\u4f8b\uff0c\u6839\u636e\u5176\u4f4d\u7f6e<code>x</code>\u548c<code>y</code>\uff0c\u4f7f\u7528<code>io_write(AM_GPU_FBDRAW)</code>\u51fd\u6570\u5728\u5c4f\u5e55\u4e0a\u7ed8\u5236\u5b57\u7b26\u3002</li> <li>\u6839\u636e\u5b57\u7b26\u7684\u901f\u5ea6<code>v</code>\u548c\u7c7b\u578b\uff0c\u9009\u62e9\u6b63\u786e\u7684\u989c\u8272\u548c\u7eb9\u7406\u8fdb\u884c\u6e32\u67d3\u3002</li> <li>\u6e32\u67d3\u51fd\u6570\u8fd8\u4f1a\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u7edf\u8ba1\u4fe1\u606f\uff0c\u5305\u62ec\u547d\u4e2d\u6570<code>hit</code>\u3001\u672a\u547d\u4e2d\u6570<code>miss</code>\u548c\u9519\u8bef\u6570<code>wrong</code>\u3002</li> </ul> </li> </ol> <p>ioe_read \u4e0d\u65ad\u8bbf\u95ee\u5185\u5b58\uff0c\u8bfb\u53d6 timer \u8bbe\u5907\uff0c\u83b7\u53d6\u7cfb\u7edf\u65f6\u95f4\uff0c\u7528\u4e8e\u8ba1\u7b97\u5e27\u6570\u3002\uff08\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\uff1a\u7a0b\u5e8f -&gt; AM -&gt; \u786c\u4ef6 \uff0c\u540c\u4e4b\u524d\u5206\u6790\u7684 IO\u6d41\u7a0b\uff09</p> <p>\u4e4b\u540e\u4e0d\u65ad\u68c0\u67e5\u952e\u76d8\u662f\u5426\u6309\u4e0b\uff0c\u672c\u8d28\u662f\u8fdb\u884c\u5185\u5b58\u8bfbinl -&gt; \u7a7f\u8fc7 AM \u62bd\u8c61\u5c42 -&gt; \u5230\u8fbeNEMU \u8bbf\u95ee\u5185\u5b58 -&gt; \u77e5\u9053\u662f\u8bbe\u5907\u5185\u5b58 -&gt; map_read-&gt;  host_read -&gt; \u8bfb\u53d6\u6570\u636e\u3002</p> <p>\u4f20\u5165 check_hit()\uff0c\u68c0\u6d4b\u6309\u4e0b\u7684\u6570\u636e\u662f\u5426\u548c\u4e0a\u4e00\u5e27\u5c4f\u5e55\u4e0a\u66f4\u65b0\u7684\u5b57\u7b26\uff08struct character\uff09\u4e00\u81f4\u3002</p> <p>\u4e00\u81f4\u5c31\u589e\u52a0hit\u8ba1\u6570\uff0c\u5e76\u8bbe\u7f6e\u4e3a\u5b57\u7b26\u901f\u5ea6\u4e3a\u8d1f\uff0c\u5411\u4e0a\u79fb\u52a8\u79bb\u5f00\u5c4f\u5e55\u3002</p> <p>\u6700\u540erender\u6e32\u67d3\u5c4f\u5e55\uff0c\u540c\u521d\u59cb\u7684vga\u76f8\u5173\u914d\u7f6e\u3002</p> <p>\u4e0d\u65ad\u5faa\u73af\u3002</p>"},{"location":"ysyx/pa/pa2/pa2.html#1","title":"\u7f16\u8bd1\u4e0e\u94fe\u63a5(1)","text":"<p>\u5728<code>nemu/include/cpu/ifetch.h</code>\u4e2d, \u4f60\u4f1a\u770b\u5230\u7531<code>static inline</code>\u5f00\u5934\u5b9a\u4e49\u7684<code>inst_fetch()</code>\u51fd\u6570. \u5206\u522b\u5c1d\u8bd5\u53bb\u6389<code>static</code>, \u53bb\u6389<code>inline</code>\u6216\u53bb\u6389\u4e24\u8005, \u7136\u540e\u91cd\u65b0\u8fdb\u884c\u7f16\u8bd1, \u4f60\u53ef\u80fd\u4f1a\u770b\u5230\u53d1\u751f\u9519\u8bef. \u8bf7\u5206\u522b\u89e3\u91ca\u4e3a\u4ec0\u4e48\u8fd9\u4e9b\u9519\u8bef\u4f1a\u53d1\u751f/\u4e0d\u53d1\u751f? \u4f60\u6709\u529e\u6cd5\u8bc1\u660e\u4f60\u7684\u60f3\u6cd5\u5417?</p> <p>\u5355\u72ec\u53bb\u6389\u54ea\u4e00\u4e2a\u90fd\u6ca1\u62a5\u9519\uff0c\u4f46\u662f\u53bb\u6389\u4e24\u4e2a\u5c31\u4f1a\u62a5\u9519\uff1a</p> <p></p> <p>\u91cd\u5b9a\u4e49\u7684\u9519\u8bef\uff0c\u90a3\u770b\u770b\u5728\u54ea\u4e9b\u5730\u65b9\u6709\u8fd9\u4e2a\u5934\u6587\u4ef6\uff1a</p> <p></p> <p>inst.c \u548c hostcall.c \u90fd\u6709\u8fd9\u4e2a\u5934\u6587\u4ef6\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u94fe\u63a5\u9519\u8bef\u4e5f\u5f88\u5408\u7406\u4e86\u3002</p> <ul> <li> <p>\u53ea\u5199 static\uff1a\u672a\u62a5\u9519</p> <p>static \u7684\u4f5c\u7528\u5bf9\u4e8e\u51fd\u6570\u6765\u8bf4\uff0c\u4e3b\u8981\u5c31\u662f\u6539\u53d8\u5176\u4f5c\u7528\u57df\u3002</p> <ul> <li>\u5047\u5982\u6ca1\u6709 static \u7684\u4fee\u9970\u3002\u7f16\u8bd1\u5668\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5bf9\u5404\u4e2a\u7a0b\u5e8f\u5355\u72ec\u7f16\u8bd1\u4e0d\u4f1a\u62a5\u9519\uff0c\u7f16\u8bd1\u5668\u4f1a\u5c06 inst_fetch \u5199\u8fdb\u6bcf\u4e2a.c\u6587\u4ef6\u7f16\u8bd1\u51fa\u6765\u7684.o\u6587\u4ef6\u7684\u7b26\u53f7\u8868\u4e2d\uff08externals\uff09\uff0c\u8fd9\u6837\u5728\u94fe\u63a5\u8fd9\u4e24\u4e2a\u76ee\u6807\u6587\u4ef6\u7684\u65f6\u5019\u5e94\u8be5\u5c31\u4f1a\u6709\u4e24\u4e2a\u76f8\u540c\u7684\u7b26\u53f7\uff0c\u5bfc\u81f4\u51fd\u6570\u51b2\u7a81\u3002\uff08\u5982\u4e0a\u56fe\uff09</li> <li>\u5982\u679c\u6709 static\uff0c\u51fd\u6570\u7684\u4f5c\u7528\u7a7a\u95f4\u5c31\u53ea\u5728\u672c\u6587\u4ef6\u4e2d\uff0c\u4e5f\u5c31\u662f\u7f16\u8bd1\u5668\u751f\u6210\u7b26\u53f7\u8868\u4e2d\u7c7b\u578b\u4e3a Local symbol\u3002</li> </ul> </li> <li> <p>\u53ea\u5199 inline\uff1a\u672a\u62a5\u9519\u3002</p> <p>inline \u6307\u793a\u7f16\u8bd1\u5668\u5c1d\u8bd5\u5c06\u51fd\u6570\u4f53\u5d4c\u5165\u5230\u6bcf\u4e2a\u8c03\u7528\u70b9\uff0c\u4ee5\u907f\u514d\u51fd\u6570\u8c03\u7528\u7684\u5f00\u9500\uff08\u6bd4\u5982\u4fdd\u5b58\u548c\u6062\u590d\u51fd\u6570\u8fd4\u56de\u5730\u5740\u7b49\uff0c\u5373\u6808\u5e27\u7684\u5207\u6362\uff09\uff0c\u6240\u4ee5 inline \u51fd\u6570\u548c\u5b8f\u662f\u6bd4\u8f83\u7c7b\u4f3c\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u5b58\u5728\u51fd\u6570\u5165\u53e3/\u540d\u79f0\uff0c\u5373\u7b26\u53f7\u8868\u4e2d\u5c31\u6ca1\u6709\u5c5e\u6027\u4e3aFUNC\u7684\u7b26\u53f7\u4e86\uff0c\u81ea\u7136\u5404\u4e2a .o \u6587\u4ef6\u7684\u7b26\u53f7\u8868\u4e2d\u4e5f\u5c31\u6ca1\u6709\u8fd9\u4e2a\u7b26\u53f7\u4e86\uff0c\u90a3\u4e5f\u5c31\u4e0d\u4f1a\u6709\u51b2\u7a81\uff0c\u4e0d\u4f1a\u62a5\u9519\u3002</p> </li> </ul> <p>\u5177\u4f53\u9a8c\u8bc1\u53ef\u4ee5 <code>readelf</code> / <code>nm</code> <code>nemu</code>\u7684 <code>elf</code> \u6587\u4ef6\uff0c\u770b\u770b\u76f8\u5173\u7b26\u53f7\u5c31\u77e5\u9053\u4e86</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd9\u91cc\u518d\u603b\u7ed3\u4e00\u4e0b\u5173\u4e8e static inline \u51fd\u6570\u7684\u5185\u5bb9\uff1a</p> <ol> <li> <p>inline</p> <ul> <li> <p>\u660e\u786e\u4e00\u70b9\uff0c<code>inline</code> \u51fd\u6570\u53ea\u662f\u5bf9\u7f16\u8bd1\u5668\u7684\u4e00\u79cd\u5efa\u8bae\u800c\u5df2\uff0c\u7a76\u7adf\u8981\u4e0d\u8981\u5185\u8054\uff0c\u53d6\u51b3\u4e8e\u6211\u7684\u51fd\u6570\u590d\u4e0d\u590d\u6742\uff0c\u800c\u590d\u4e0d\u590d\u6742\u53c8\u662f\u7531\u7f16\u8bd1\u5668\u6765\u5224\u65ad\u7684\u3002\u6240\u4ee5\uff0c<code>inline</code> \u53ea\u662f\u4e00\u79cd\u5efa\u8bae\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u51fd\u6570\u91cc\u9762\u51fa\u73b0\uff1a\u9012\u5f52\u3001switch\u3001\u7b49\u7b49\u5185\u5bb9\uff0c\u7f16\u8bd1\u5668\u90fd\u4e0d\u4f1a\u5c55\u5f00\u3002</p> </li> <li> <p>\u56e0\u4e3a\u5185\u8054\u51fd\u6570\u8981\u5728\u8c03\u7528\u7684\u5730\u65b9\u5c55\u5f00\uff0c\u90a3\u5c31\u662f\u8bf4\uff1a</p> <p>\u5728\u672c\u7f16\u8bd1\u5355\u5143\u5185\uff0c\u9700\u8981\u6709\u5185\u8054\u51fd\u6570\u7684\u51fd\u6570\u4f53\uff0c\u5426\u5219\uff0c\u90a3\u5c31\u662f\u975e\u5185\u8054\u51fd\u6570\u7684\u8c03\u7528\u4e86\u3002\u8fd9\u6837\u5c31\u8981\u6c42\u6211\u4eec\u5728\u6bcf\u4e2a\u8c03\u7528\u4e86\u5185\u8054\u51fd\u6570\u7684\u6587\u4ef6\u4e2d\u90fd\u6709\u5176\u5bf9\u5e94\u7684\u5b9e\u73b0\uff0c\u90a3\u81ea\u7136\u5c06\u5185\u8054\u51fd\u6570\u653e\u5230\u5934\u6587\u4ef6\u4e2d\u662f\u6bd4\u8f83\u5408\u9002\u7684\u3002</p> </li> </ul> </li> <li> <p>static inline</p> <p>\u7531\u4e8e\u5185\u8054\u51fd\u6570\u5fc5\u987b\u8981\u6709\u51fd\u6570\u4f53\u5728\u672c\u7f16\u8bd1\u5355\u5143\uff0c\u90a3\u5c31\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u591a\u4e2a\u6587\u4ef6\u4f7f\u7528\u8fd9\u4e2a <code>inline</code> \u51fd\u6570\uff0c\u90a3\u5c31\u4f1a\u51fa\u73b0\u4e0a\u56fe\u7684\u91cd\u5b9a\u4e49\u73b0\u8c61\uff08\u94fe\u63a5\u9636\u6bb5\uff09\u3002</p> <p>\u6240\u4ee5\uff0c\u4f7f\u7528 <code>static inline</code> \u5c31\u80fd\u6bd4\u8f83\u597d\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f7f\u7528 <code>static</code>\uff0c\u51fd\u6570\u4ec5\u5728\u6587\u4ef6\u5185\u90e8\u53ef\u89c1\uff0c\u4e0d\u4f1a\u6c61\u67d3\u547d\u540d\u7a7a\u95f4\u3002\u8fd9\u6837\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a inline \u5728\u4e0d\u540c\u7684 .c \u6587\u4ef6\u4e2d\u751f\u6210\u4e86\u4e0d\u540c\u7684\u5b9e\u4f8b\uff0c\u800c\u4e14\u540d\u5b57\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002</p> <p>\u5f53\u7136\u76f4\u63a5: <code>extern inline int func(xxxxx);</code> \u4e5f\u53ef\uff0c\u4f46\u662f\u7e41\u7410\u3002</p> <p>\u7f51\u4e0a\uff1a</p> <p>PS: inline\u4fee\u9970\u7b26\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u4e0d\u4e00\u6837\u3002</p> <p>IAR\u4e2d\u9700\u8981\u624b\u52a8\u5f00\u53d1 \u5e76\u76f4\u63a5\u53ef\u4ee5\u4f7f\u7528\uff0ckeil\u4e2d\u76f4\u63a5__inline\u5373\u53ef \u53ea\u8981\u4e0d\u662fO0\u5c31\u4f1a\u6709\u5185\u8054\u5904\u7406@20140417</p> </li> <li> <p>\u603b\u7ed3</p> <ul> <li>\u4e00\u822c static \u548c inline \u914d\u5408\u4f7f\u7528</li> <li>\u5c06\u5185\u8054\u51fd\u6570\u653e\u5230\u5934\u6587\u4ef6\u4e2d\u3002</li> </ul> </li> <li> <p>\u5b9e\u4f8b</p> <p>\u4e00\u70b9\u4e94\u7f16\u7a0b\u7684\u7fa4\u8ba8\u8bba\u7684\u5185\u5bb9\u3002\u641e\u5f97\u6211\u73b0\u5728\u53c8\u662f\u5f88\u8ff7\u7cca\u5404\u79cd\u5185\u5bb9\uff0c</p> <p>\u8fd8\u662f\u590d\u4e60\u4e00\u4e9b\u76f8\u5173\u7684\u5185\u5bb9\u3002</p> <ul> <li> <p>\u5b9a\u4e49\u548c\u58f0\u660e\u533a\u522b\uff08define and declaration\uff09</p> <p>c++ - What is the difference between a definition and a declaration? - Stack Overflow</p> </li> <li> <p>GCC \u624b\u518c</p> <p></p> </li> </ul> </li> </ol>"},{"location":"ysyx/pa/pa2/pa2.html#2_1","title":"\u7f16\u8bd1\u4e0e\u94fe\u63a5(2)","text":"<ol> <li> <p>\u5728<code>nemu/include/common.h</code>\u4e2d\u6dfb\u52a0\u4e00\u884c<code>volatile static int dummy;</code> \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u8bf7\u95ee\u91cd\u65b0\u7f16\u8bd1\u540e\u7684NEMU\u542b\u6709\u591a\u5c11\u4e2a<code>dummy</code>\u53d8\u91cf\u7684\u5b9e\u4f53? \u4f60\u662f\u5982\u4f55\u5f97\u5230\u8fd9\u4e2a\u7ed3\u679c\u7684?</p> <p></p> <p></p> <p>nm\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684\u7b26\u53f7\uff0c36-2  = 34</p> <p>\u6216\u8005\u7528grep\u770b\u9884\u5904\u7406\u540e\u7684\u6587\u4ef6 35- 1 = 34  ./build\u91cc\u7684\uff0c\u9664\u53bb\u4e00\u6761\u5934\u6587\u4ef6\u91cc\u7684</p> </li> <li> <p>\u6dfb\u52a0\u4e0a\u9898\u4e2d\u7684\u4ee3\u7801\u540e, \u518d\u5728<code>nemu/include/debug.h</code>\u4e2d\u6dfb\u52a0\u4e00\u884c<code>volatile static int dummy;</code> \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u8bf7\u95ee\u6b64\u65f6\u7684NEMU\u542b\u6709\u591a\u5c11\u4e2a<code>dummy</code>\u53d8\u91cf\u7684\u5b9e\u4f53? \u4e0e\u4e0a\u9898\u4e2d<code>dummy</code>\u53d8\u91cf\u5b9e\u4f53\u6570\u76ee\u8fdb\u884c\u6bd4\u8f83, \u5e76\u89e3\u91ca\u672c\u9898\u7684\u7ed3\u679c.</p> <pre><code>grep -r \"volatile static int dummy\" ./build/ 2&gt; /dev/null  |sort |uniq | less | wc -l\n</code></pre> <p>\u8fd8\u662f\u4e00\u6837\uff0c\u90fd\u662f34</p> </li> <li> <p>\u4fee\u6539\u6dfb\u52a0\u7684\u4ee3\u7801, \u4e3a\u4e24\u5904<code>dummy</code>\u53d8\u91cf\u8fdb\u884c\u521d\u59cb\u5316:<code>volatile static int dummy = 0;</code> \u7136\u540e\u91cd\u65b0\u7f16\u8bd1NEMU. \u4f60\u53d1\u73b0\u4e86\u4ec0\u4e48\u95ee\u9898? \u4e3a\u4ec0\u4e48\u4e4b\u524d\u6ca1\u6709\u51fa\u73b0\u8fd9\u6837\u7684\u95ee\u9898? (\u56de\u7b54\u5b8c\u672c\u9898\u540e\u53ef\u4ee5\u5220\u9664\u6dfb\u52a0\u7684\u4ee3\u7801.)</p> <p>\u548c\u4e4b\u524d\u4e00\u6837\uff1f\u6ca1\u62a5\u9519\uff1f</p> </li> </ol>"},{"location":"ysyx/pa/pa2/pa2.html#makefile_1","title":"\u4e86\u89e3Makefile","text":"<p>\u8bf7\u63cf\u8ff0\u4f60\u5728 <code>am-kernels/kernels/hello/</code> \u76ee\u5f55\u4e0b\u6572\u5165 <code>make ARCH=$ISA-nemu</code>\u540e, <code>make</code> \u7a0b\u5e8f\u5982\u4f55\u7ec4\u7ec7 .c \u548c .h \u6587\u4ef6, </p> <p>\u6700\u7ec8\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6 <code>am-kernels/kernels/hello/build/hello-$ISA-nemu.elf</code>. </p> <p>(\u8fd9\u4e2a\u95ee\u9898\u5305\u62ec\u4e24\u4e2a\u65b9\u9762: <code>Makefile</code> \u7684\u5de5\u4f5c\u65b9\u5f0f\u548c\u7f16\u8bd1\u94fe\u63a5\u7684\u8fc7\u7a0b.) </p> <p>\u5173\u4e8e <code>Makefile</code> \u5de5\u4f5c\u65b9\u5f0f\u7684\u63d0\u793a:</p> <ul> <li><code>Makefile</code>\u4e2d\u4f7f\u7528\u4e86\u53d8\u91cf, \u5305\u542b\u6587\u4ef6\u7b49\u7279\u6027</li> <li><code>Makefile</code>\u8fd0\u7528\u5e76\u91cd\u5199\u4e86\u4e00\u4e9bimplicit rules</li> <li>\u5728<code>man make</code>\u4e2d\u641c\u7d22<code>-n</code>\u9009\u9879, \u4e5f\u8bb8\u4f1a\u5bf9\u4f60\u6709\u5e2e\u52a9</li> <li>RTFM</li> </ul> <p>\u4e0a\u9762\u8fd9\u4e9bmakefile\u770b\u8d77\u6765\u6bd4\u8f83\u56f0\u96be\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u7528\u4e86\u53d8\u91cf\u548c\u5404\u79cd\u8bed\u6cd5\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u518d\u56de\u60f3\uff1aeverything is state-machine</p> <p>\u6240\u4ee5 makefile \u4e5f\u662f\u72b6\u6001\u673a\u3002</p> <p>makefile run\u8d77\u6765\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u6267\u884c\u4e0d\u540c\u7684\u547d\u4ee4\u3002(A-command --&gt; B-command --&gt; .....)</p> <p>\u867d\u7136\u770b\u8d77\u6765\u56f0\u96be\uff0c\u4f46\u662fmakefile\u8dd1\u8d77\u6765\u4e4b\u540e\uff0c\u5c31\u80fd\u901a\u8fc7 trace \u601d\u60f3\u6765\u5206\u6790\u5b83\uff0c\u53c8\u5e78\u8fd0\u7684\uff0cmakefile \u81ea\u5e26 trace: <code>make - nB</code></p> <ul> <li><code>-n</code> \u6216 <code>--just-print</code>\uff1a\u544a\u8bc9 <code>make</code> \u53ea\u6253\u5370\u5c06\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u800c\u4e0d\u5b9e\u9645\u6267\u884c\u5b83\u4eec\u3002</li> <li><code>-B</code> \u6216 <code>--always-make</code>\uff1a\u544a\u8bc9 <code>make</code> \u4e0d\u8981\u76f8\u4fe1\u4efb\u4f55\u73b0\u6709\u7684\u76ee\u6807\u6587\u4ef6\uff0c\u91cd\u65b0\u6784\u5efa\u6240\u6709\u7684\u76ee\u6807\u3002</li> </ul> <p>jyy\u8001\u5e08\u7684\u4e00\u4e2a\u770bmakefile\u7684\u597d\u65b9\u6cd5\uff1a</p> <pre><code>log:\n    make -nB \\\n        | grep -ve '^\\(\\#\\|echo\\|mkdir\\|make\\)' \\\n        | sed \"s#$(AM_HOME)#\\AM#g\" \\\n        | sed \"s#$(PWD)#.#g\" \\\n        | vim -           \n        #&gt; compile.log\n</code></pre> <p>\u518d\u914d\u5408 vim \u7684\u6587\u672c\u66ff\u6362\uff1a<code>%s/[ \\t]\\+/\\r/g</code> </p> <p>\u81ea\u5df1\u770b\u6548\u679c\uff0camazing~</p>"},{"location":"ysyx/pa/pa3/pa3.html","title":"PA3","text":""},{"location":"ysyx/pa/pa3/pa3.html#-","title":"\u6982\u8ff0 - \u7a7f\u8d8a\u65f6\u7a7a\u7684\u65c5\u7a0b: \u6279\u5904\u7406\u7cfb\u7edf","text":"<p>\u6ca1\u6709\u8c03\u4e0d\u51fa\u7684bug, \u53ea\u6709\u4e0d\u7406\u89e3\u7684\u7cfb\u7edf</p> <ul> <li>task PA3.1: \u5b9e\u73b0\u81ea\u9677\u64cd\u4f5c<code>yield()</code></li> <li>task PA3.2: \u5b9e\u73b0\u7528\u6237\u7a0b\u5e8f\u7684\u52a0\u8f7d\u548c\u7cfb\u7edf\u8c03\u7528, \u652f\u6491TRM\u7a0b\u5e8f\u7684\u8fd0\u884c</li> <li>task PA3.3: \u8fd0\u884c\u4ed9\u5251\u5947\u4fa0\u4f20\u5e76\u5c55\u793a\u6279\u5904\u7406\u7cfb\u7edf, \u63d0\u4ea4\u5b8c\u6574\u7684\u5b9e\u9a8c\u62a5\u544a</li> </ul> <p>\u5904\u7406\u5668\u7684\u786c\u4ef6\u4fdd\u62a4\u673a\u5236\u4e3b\u8981\u662f\u901a\u8fc7\u7279\u6743\u7ea7\u522b\uff08Privilege Levels\uff09\u3001\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08Memory Management Unit, MMU\uff09\u3001\u5206\u6bb5\u548c\u5206\u9875\u673a\u5236\u6765\u5b9e\u73b0\u7684\u3002\u7279\u6743\u7ea7\u522b\u786e\u4fdd\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4ee3\u7801\uff08\u9ad8\u7279\u6743\u7ea7\u522b\uff09\u80fd\u591f\u8bbf\u95ee\u6240\u6709\u786c\u4ef6\u8d44\u6e90\uff0c\u800c\u7528\u6237\u7a7a\u95f4\u7684\u7a0b\u5e8f\uff08\u4f4e\u7279\u6743\u7ea7\u522b\uff09\u5219\u53d7\u5230\u9650\u5236\uff0c\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u67d0\u4e9b\u786c\u4ef6\u8d44\u6e90\u548c\u6267\u884c\u7279\u5b9a\u7684\u6307\u4ee4\uff0c\u4ece\u800c\u4fdd\u62a4\u7cfb\u7edf\u5b89\u5168\u7a33\u5b9a\u3002</p>"},{"location":"ysyx/pa/pa3/pa3.html#pa31","title":"PA3.1\u6279\u5904\u7406\u7cfb\u7edf","text":""},{"location":"ysyx/pa/pa3/pa3.html#_1","title":"\u6765\u81ea\u64cd\u4f5c\u7cfb\u7edf\u7684\u65b0\u9700\u6c42","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4ec0\u4e48\u662f\u64cd\u4f5c\u7cfb\u7edf? (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u8fd9\u53ef\u662f\u4e2a\u5927\u95ee\u9898, \u6211\u4eec\u4e5f\u9f13\u52b1\u4f60\u5b66\u4e60\u5b8c\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u4e4b\u540e\u518d\u56de\u6765\u91cd\u65b0\u5ba1\u89c6\u5b83.</p> <p>\u6211\u89c9\u5f97\u5bf9\u4e8e\u8ba1\u7b97\u673a\u6765\u8bf4\uff0c\u5c31\u662f\u5411\u4e0b\u7ba1\u7406\u7cfb\u7edf\u786c\u4ef6\u8d44\u6e90\uff0c\u5411\u4e0a\u63d0\u4f9b API \u63a5\u53e3 \u7559\u5751</p> </li> </ul> <p>\u786c\u4ef6\u5982\u4f55\u5b9e\u73b0\u5176\u64cd\u4f5c\u7cfb\u7edf\u6240\u8c13\u7684\u4fdd\u62a4\u6a21\u5f0f\u3001\u7279\u6743\u7ea7\u3001\u68c0\u67e5\u3001\u5185\u6838\u6a21\u5f0f\u3001\u7528\u6237\u6a21\u5f0f...\u4e00\u5927\u5806\u7684\u6982\u5ff5\u3002</p> <p>\u4fdd\u62a4\u673a\u5236\u7684\u672c\u8d28: \u5728\u786c\u4ef6\u4e2d\u52a0\u5165\u4e00\u4e9b\u4e0e\u7279\u6743\u7ea7\u68c0\u67e5\u76f8\u5173\u7684\u95e8\u7535\u8def(\u4f8b\u5982\u6bd4\u8f83\u5668\u7535\u8def), \u5982\u679c\u53d1\u73b0\u4e86\u975e\u6cd5\u64cd\u4f5c, \u5c31\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u4fe1\u53f7, \u8ba9CPU\u8df3\u8f6c\u5230\u4e00\u4e2a\u7ea6\u5b9a\u597d\u7684\u76ee\u6807\u4f4d\u7f6e, \u5e76\u8fdb\u884c\u540e\u7eed\u5904\u7406.</p>"},{"location":"ysyx/pa/pa3/pa3.html#_2","title":"\u7b49\u7ea7\u68ee\u4e25\u7684\u5236\u5ea6","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7a76\u7adf\u600e\u4e48\u7406\u89e3trap\u548c\u5f02\u5e38\u8fd9\u4e2a\u4e1c\u897f\uff1ftrap\u7a76\u7adf\u4ec0\u4e48\uff1f\u8fd8\u6709\u7cfb\u7edf\u8c03\u7528\uff1f\u5bf9\u4e8e\u8fd9\u4e9b\u6982\u5ff5\u5f88\u6df7\u4e71</p> <p>\u4ece\u8fd9\u4e2a\u4e1c\u897f\u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u800c\u53d1\u660e\u7684\u5f00\u59cb\u8bb2\u8d77\u4e86\u3002</p> <ol> <li> <p>trap</p> <p>\u6700\u521d\u7684OS\u5c31\u662f\u4e00\u7cfb\u5217\u7684API\uff0c\u5c01\u88c5\u4e86\u4e00\u4e9b <code>low-level I/O</code> \u7684\u786c\u4ef6\u64cd\u4f5c\uff08\u6bd4\u5982\u50cf\u5355\u7247\u673a\u4e2d\u7684\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\u3001\u5bc4\u5b58\u5668\uff09\u3002</p> <p>\u786c\u4ef6 --&gt; <code>low-level</code> I/O \u64cd\u4f5c\u3001\u64cd\u4f5c\u786c\u4ef6\u7684\u6307\u4ee4 --&gt; OS API </p> <p>\u4f46\u662f\u524d\u8f88\u4eec\u89c9\u5f97\u8fd9\u6837\u5b50\u592a\u5371\u9669\u4e86\uff0c\u6ca1\u6709\u4e00\u70b9\u9690\u79c1\uff0c\u6240\u4ee5\u4ed6\u4eec\u60f3\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5b58\u5728\u4e24\u79cd\u6a21\u5f0f(\u7ea7\u522b)\uff1a</p> <p>\u4e00\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5e94\u7528\u7a0b\u5e8f\u667a\u80fd\u505a\u4e00\u4e9b\u76f8\u5bf9\u5b89\u5168\u7684\u64cd\u4f5c\uff0c\u5c24\u5176\u4e0d\u5141\u8bb8\u76f4\u63a5\u8bbf\u95ee\u786c\u4ef6\uff0c\u4e0d\u4f1a\u4e00\u6761\u6307\u4ee4\u5e72\u7206\u673a\u5668\u7684\u4e00\u4e9b\u64cd\u4f5c\uff1b</p> <p>\u53e6\u4e00\u4e2a\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u53ef\u4ee5\u5b8c\u5168\u8bbf\u95ee\u7cfb\u7edf\u7684\u786c\u4ef6\uff0c\u56e0\u6b64\u53ef\u4ee5\u6267\u884c\u8bf8\u5982\u53d1\u8d77 I/O \u8bf7\u6c42\u6216\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u66f4\u591a\u5185\u5b58\u7b49\u529f\u80fd\u3002  </p> <p>\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u7528\u6237\u6001\u548c\u5185\u6838\u6001\uff0c\uff08\u73b0\u4ee3\u7684OS\u66f4\u52a0\u590d\u6742\uff09</p> <p>\u90a3\u6211\u4eec\u8981\u600e\u4e48\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u5462\uff1f\uff08\u8fd9\u91cc\u8bf4\u7684\u5b66\u672f\u4e00\u70b9\u5c31\u662f\u5207\u6362\u6267\u884c\u6d41\uff09</p> <p>\u901a\u8fc7\u4e00\u4e2a\u53eb\u7cfb\u7edf\u8c03\u7528\u7684\u4e1c\u897f\uff08\u8fd9\u91cc\u524d\u4eba\u7684\u60f3\u6cd5\u662f\u5728\u6307\u4ee4\u96c6\u91cc\u6dfb\u52a0\u4e00\u4e9b\u7279\u6b8a\u7684\u786c\u4ef6\u6307\u4ee4\u548c\u786c\u4ef6\u72b6\u6001\uff0c\u901a\u5e38\u901a\u8fc7\u4e00\u4e2a\u79f0\u4e3a\u9677\u9631\uff08trap\uff09\u7684\u7279\u6b8a\u786c\u4ef6\u6307\u4ee4\uff09</p> <ul> <li>mips32\u63d0\u4f9b <code>syscall</code> \u6307\u4ee4\u4f5c\u4e3a\u81ea\u9677\u6307\u4ee4</li> <li>riscv32\u63d0\u4f9b <code>ecall</code> \u6307\u4ee4\u4f5c\u4e3a\u81ea\u9677\u6307\u4ee4</li> <li>x86\u63d0\u4f9b <code>int</code>\u6307\u4ee4\u4f5c\u4e3a\u81ea\u9677\u6307\u4ee4</li> </ul> <p>\u4e8e\u662f\uff0c\u7cfb\u7edf\u8c03\u7528\uff08system call\uff09\u8fd9\u4e2a\u6982\u5ff5\u8bde\u751f\u4e86\uff0c\u5176\u5185\u90e8\u7684\u5b9e\u73b0\u5c31\u662f\u901a\u8fc7trap/\u81ea\u9677\u6307\u4ee4\u3002</p> <p>\u518d\u56de\u6765\u770b\u770b\u8bb2\u4e49\u5404\u8282\u7684\u5185\u5bb9\u5c31\u660e\u767d\u4e86\uff1a</p> <ul> <li> <p>\u7b49\u7ea7\u9650\u5236\uff1a\u786c\u4ef6\u4fdd\u62a4\u673a\u5236</p> <p>\u4e3a\u4e86\u963b\u6b62\u7a0b\u5e8f\u5c06\u6267\u884c\u6d41\u5207\u6362\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u4efb\u610f\u4f4d\u7f6e, \u786c\u4ef6\u4e2d\u9010\u6e10\u51fa\u73b0\u4fdd\u62a4\u673a\u5236\u76f8\u5173\u7684\u529f\u80fd, </p> <p>i386\u4e2d\u5f15\u5165\u4e86\u4fdd\u62a4\u6a21\u5f0f(protected mode)\u548c\u7279\u6743\u7ea7(privilege level)\u7684\u6982\u5ff5, </p> <p>mips32\u5904\u7406\u5668\u53ef\u4ee5\u8fd0\u884c\u5728\u5185\u6838\u6a21\u5f0f\u548c\u7528\u6237\u6a21\u5f0f, </p> <p>riscv32\u5219\u6709\u673a\u5668\u6a21\u5f0f(M-mode), \u76d1\u63a7\u8005\u6a21\u5f0f(S-mode)\u548c\u7528\u6237\u6a21\u5f0f(U-mode). </p> <p>\u8fd9\u4e9b\u6982\u5ff5\u7684\u601d\u60f3\u90fd\u662f\u7c7b\u4f3c\u7684: \u7b80\u5355\u5730\u8bf4, \u53ea\u6709\u9ad8\u7279\u6743\u7ea7\u7684\u7a0b\u5e8f\u624d\u80fd\u53bb\u6267\u884c\u4e00\u4e9b\u7cfb\u7edf\u7ea7\u522b\u7684\u64cd\u4f5c, \u5982\u679c\u4e00\u4e2a\u7279\u6743\u7ea7\u4f4e\u7684\u7a0b\u5e8f\u5c1d\u8bd5\u6267\u884c\u5b83\u6ca1\u6709\u6743\u9650\u6267\u884c\u7684\u64cd\u4f5c, CPU\u5c06\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u4fe1\u53f7, \u6765\u963b\u6b62\u8fd9\u4e00\u975e\u6cd5\u884c\u4e3a\u7684\u53d1\u751f. \u4e00\u822c\u6765\u8bf4, \u6700\u9002\u5408\u62c5\u4efb\u7cfb\u7edf\u7ba1\u7406\u5458\u7684\u89d2\u8272\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e86, \u5b83\u62e5\u6709\u6700\u9ad8\u7684\u7279\u6743\u7ea7, \u53ef\u4ee5\u6267\u884c\u6240\u6709\u64cd\u4f5c; \u800c\u9664\u975e\u7ecf\u8fc7\u5141\u8bb8, \u8fd0\u884c\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u7528\u6237\u7a0b\u5e8f\u4e00\u822c\u90fd\u5904\u4e8e\u6700\u4f4e\u7684\u7279\u6743\u7ea7, \u5982\u679c\u5b83\u8bd5\u56fe\u7834\u574f\u793e\u4f1a\u7684\u548c\u8c10, \u5b83\u5c06\u4f1a\u88ab\u5224\"\u6b7b\u5211\".</p> </li> <li> <p>\u8fdb\u4e00\u6b65\u533a\u5206</p> <p>\u6709\u4e86\u5f3a\u5927\u7684\u786c\u4ef6\u4fdd\u62a4\u673a\u5236, \u7528\u6237\u7a0b\u5e8f\u5c06\u65e0\u6cd5\u628a\u6267\u884c\u6d41\u5207\u6362\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u4efb\u610f\u4ee3\u7801\u4e86. </p> <p>\u4f46\u4e3a\u4e86\u5b9e\u73b0\u6700\u7b80\u5355\u7684\u64cd\u4f5c\u7cfb\u7edf, \u786c\u4ef6\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u79cd\u53ef\u4ee5\u9650\u5236\u5165\u53e3\u7684\u6267\u884c\u6d41\u5207\u6362\u65b9\u5f0f. </p> <p>\u8fd9\u79cd\u65b9\u5f0f\u5c31\u662f\u81ea\u9677\u6307\u4ee4, \u7a0b\u5e8f\u6267\u884c\u81ea\u9677\u6307\u4ee4\u4e4b\u540e, \u5c31\u4f1a\u9677\u5165\u5230\u64cd\u4f5c\u7cfb\u7edf\u9884\u5148\u8bbe\u7f6e\u597d\u7684\u8df3\u8f6c\u76ee\u6807, \u53bb\u6267\u884c\u76f8\u5173\u7684\u5904\u7406\u51fd\u6570. </p> <p>\u8fd9\u4e2a\u8df3\u8f6c\u76ee\u6807\u4e5f\u79f0\u4e3a\u5f02\u5e38\u5165\u53e3\u5730\u5740.</p> <p>\u8fd9\u4e00\u8fc7\u7a0b\u662fISA\u89c4\u8303\u7684\u4e00\u90e8\u5206, \u79f0\u4e3a\u4e2d\u65ad/\u5f02\u5e38\u54cd\u5e94\u673a\u5236. </p> <p>\u5927\u90e8\u5206ISA\u5e76\u4e0d\u533a\u5206CPU\u7684\u5f02\u5e38\u548c\u81ea\u9677, \u751a\u81f3\u662f\u5c06\u4f1a\u5728PA4\u6700\u540e\u4ecb\u7ecd\u7684\u786c\u4ef6\u4e2d\u65ad, \u800c\u662f\u5bf9\u5b83\u4eec\u8fdb\u884c\u7edf\u4e00\u7684\u54cd\u5e94. \u76ee\u524d\u6211\u4eec\u5e76\u672a\u52a0\u5165\u786c\u4ef6\u4e2d\u65ad, \u56e0\u6b64\u5148\u628a\u8fd9\u4e2a\u673a\u5236\u7b80\u79f0\u4e3a\"\u5f02\u5e38\u54cd\u5e94\u673a\u5236\"\u5427.</p> </li> </ul> <p></p> </li> <li> <p>\u5f02\u5e38</p> <p>\u4e4b\u524d\u5bf9\u4e8e\u5f02\u5e38\u548c\u4e2d\u65ad\u8fd9\u4e48\u4e9b\u4e2a\u6982\u5ff5\u5341\u5206\u8ff7\u60d1\uff0c\u4f46\u73b0\u5728\u6709\u4e86\u4e00\u70b9\u601d\u8def\u4e86\uff1a</p> <p>\u4e0d\u540c\u7684 ISA \u5bf9\u5f02\u5e38/\u4e2d\u65ad/trap\u6709\u7740\u4e0d\u540c\u7684\u89e3\u91ca\uff0c\u6709\u4e9b ISA \u4f1a\u533a\u5206\uff0c\u6709\u4e9b\u5219\u4e0d\u4f1a\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5148\u4ece\u6bd4\u8f83\u5e38\u7528\u7684\u6307\u4ee4\u96c6\u4e00\u4e2a\u4e2a\u5206\u6790\uff1ax86 -&gt; ARM -&gt; RISC-V\uff0c\u5e76\u8bf4\u8bf4\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4e4b\u95f4\u7531\u5f02\u5e38\u3001\u4e2d\u65ad\u4e2d\u7684\u54ea\u4e2a\u6765\u5207\u6362\u3002\uff08\u6700\u540e\u90fd\u662f\u901a\u8fc7\u4e00\u6761\u786c\u4ef6\u6307\u4ee4trap\u6765\u5207\u6362\u7684\uff0c\u4f46\u662f\u5f80\u4e0a\u5c42\u4e00\u70b9\uff0c\u662f\u4e2d\u65ad\u8fd8\u662f\u5f02\u5e38\u5f15\u8d77\u7684\uff1f\uff09</p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u53ea\u533a\u5206\u4e0d\u540c ISA \u4e0b\u7684\u5f02\u5e38\u548c\u4e2d\u65ad\uff0c\u4e0d\u8be6\u7ec6\u8bb2\u89e3\u5404\u4e2a ISA \u5982\u4f55\u5904\u7406\u5f02\u5e38\u548c\u4e2d\u65ad\u3002</p> <ol> <li> <p>x86</p> <p>x86 - \u64cd\u4f5c\u7cfb\u7edf\uff1a\u4e2d\u65ad\u3001\u9677\u9631\u3001\u5f02\u5e38\u3001\u6545\u969c\u3001\u7ec8\u6b62_\u4e2d\u65ad\u9677\u5165\u6545\u969c\u4e2d\u6b62\u7684\u6982\u5ff5-CSDN\u535a\u5ba2</p> <p></p> <p></p> <ul> <li> <p>\u4e2d\u65ad</p> <p>intel \u89c4\u5b9a\u7684\u662f\u4e2d\u65ad\u7528\u4e8e\u5904\u7406\u5904\u7406\u5668\u5916\u90e8\u7684\u4e8b\u4ef6</p> </li> <li> <p>\u5f02\u5e38</p> <p>\u5f02\u5e38 \u5904\u7406\u7684\u662f\u5904\u7406\u5668\u5728\u6267\u884c\u6307\u4ee4\u65f6\u68c0\u6d4b\u81ea\u8eab\u72b6\u6001\u7684\u6761\u4ef6\uff08\u6bd4\u5982\u9664\u96f6\u3001\u65e0\u6548\u64cd\u4f5c\u7801\u3001\u6d6e\u70b9\u5f02\u5e38\uff09</p> </li> </ul> <p>\u8fd9\u91cc\u770b\u4e0a\u9762\u90a3\u7bc7\u6587\u7ae0\u5373\u53ef\u3002</p> <p>\u5173\u952e\uff1a\u5f02\u5e38\u662f\u540c\u6b65\u7684\uff0c\u4e2d\u65ad\u662f\u5f02\u6b65\u7684\u3002</p> </li> <li> <p>ARM</p> <p>ARM\u5b98\u65b9\u89c4\u5b9a\uff0c\u5f02\u5e38\u5305\u62ec\u4e2d\u65ad\uff0c\u66f4\u5177\u4f53\u4e00\u70b9\uff1a\u5f02\u5e38\u5305\u62ec\u4e0b\u9762\u7684\u5185\u5bb9\uff1a</p> <p></p> <p></p> <p></p> <p>ARM\u5f02\u5e38\u5904\u7406\uff08\u5f02\u5e38\u6e90\u7684\u5206\u7c7b\u3001\u5f02\u5e38\u7684\u54cd\u5e94\u6d41\u7a0b\uff09-CSDN\u535a\u5ba2</p> <p>ARM\u7684\u5f02\u5e38\u54cd\u5e94\u8fc7\u7a0b_arm\u5f02\u5e38\u54cd\u5e94\u8fc7\u7a0b-CSDN\u535a\u5ba2</p> <p>\u4e2a\u4eba\u89c9\u5f97\u8fd9\u4e24\u7bc7\u535a\u5ba2\u53ef\u4ee5\u6982\u62ec\uff0c\u5982\u6709\u66f4\u8be6\u7ec6\uff0c\u53ef\u4ee5\u67e5\u9605ARM\u6307\u4ee4\u96c6\u7684\u624b\u518c\uff08\u4e0d\u540c\u67b6\u6784\u7684\u5747\u53ef\uff09\uff0c\u5c31\u4e0d\u518d\u8d58\u8ff0\u3002</p> </li> <li> <p>RISC-V</p> <p>RISC-V spec \u89c4\u5b9a\uff0c\u5f02\u5e38\u5904\u7406\u548c\u4e2d\u65ad\u5904\u7406\u90fd\u5c5e\u4e8e\u5f02\u5e38\u3002</p> <p></p> <p>\u5f02\u5e38\u5305\u62ec\uff1a</p> <ol> <li> <p>\u4e2d\u65ad</p> <p>\u4e3b\u8981\u6765\u81ea\u5916\u90e8\u8bbe\u5907\u7684\u4e2d\u65ad\u5f15\u811a\uff0c\u8fde\u63a5\u5230\u4e2d\u65ad\u63a7\u5236\u5668\uff0c\u7531\u4e2d\u65ad\u63a7\u5236\u5668\u8d1f\u8d23\u4e2d\u65ad\u4f18\u5148\u7ea7\u8c03\u5ea6\uff0c\u7136\u540e\u5728\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\u7ed9RISC-V\u5904\u7406\u5668\uff0c\u6539\u53d8\u5904\u7406\u5668\u7684\u6267\u884c\u6d41\u3002</p> <p>\u4e2d\u65ad\u5c5e\u4e8e\u5f02\u6b65\u5f02\u5e38\u7684\u4e00\u79cd</p> </li> <li> <p>\u5f02\u5e38</p> <p>\u5f02\u5e38\u4e3b\u8981\u5305\u62ec\uff1a\u6307\u4ee4\u8bbf\u95ee\u5f02\u5e38\u548c\u6570\u636e\u8bbf\u95ee\u5f02\u5e38\u3002</p> <p>\u6570\u636e\u8bbf\u95ee\u5f02\u5e38\u5305\u62ec\uff1a\u52a0\u8f7d\u8bbf\u95ee\u5f02\u5e38\u548c\u5b58\u50a8\u8bbf\u95ee\u5f02\u5e38\u3002</p> <p>\u6bd4\u5982\uff1a\u5904\u7406\u5668\u6253\u5f00MMU\u540e\uff0c\u8bbf\u95ee\u5185\u5b58\u5730\u5740\u53d1\u73b0\u4e86\u9519\u8bef\uff08\u7f3a\u9875\u7b49\uff09\uff0c\u5904\u7406\u5668\u5185\u90e8\u7684MMU\u6355\u83b7\u8fd9\u4e9b\u9519\u8bef\u5e76\u62a5\u544a\u7ed9\u5904\u7406\u5668\uff0c\u4ece\u800c\u89e6\u53d1\u7f3a\u9875\u5f02\u5e38\u3002</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528</p> <p>\u7cfb\u7edf\u8c03\u7528\u5141\u8bb8\u8f6f\u4ef6\u4e3b\u52a8\u901a\u8fc7\u7279\u6b8a\u6307\u4ee4\u6765\u8bf7\u6c42\u66f4\u9ad8\u7279\u6743\u6a21\u5f0f\u7684\u7a0b\u5e8f\u6240\u63d0\u4f9b\u7684\u670d\u52a1\u3002\u7c7b\u4f3c\u4e8e\u6700\u5f00\u59cbtrap\u7684\u529f\u80fd\u3002</p> </li> </ol> </li> <li> <p>\u5bf9\u4e8e\u6211\u5f53\u65f6\u63d0\u51fa\u7684\u8fd9\u4e2a\u95ee\u9898\uff0c\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4e4b\u95f4\u7531\u5f02\u5e38\u3001\u4e2d\u65ad\u4e2d\u7684\u54ea\u4e2a\u6765\u5207\u6362\uff1f\uff08\u6700\u540e\u90fd\u662f\u901a\u8fc7\u4e00\u6761\u786c\u4ef6\u6307\u4ee4trap\u6765\u5207\u6362\u7684\uff0c\u4f46\u662f\u5f80\u4e0a\u5c42\u4e00\u70b9\uff0c\u662f\u4e2d\u65ad\u8fd8\u662f\u5f02\u5e38\u5f15\u8d77\u7684\uff1f\uff09</p> <p>\u5b9e\u9645\u4e0a\u6211\u95ee\u7684\u5c31\u6709\u95ee\u9898</p> <p>\u5f02\u5e38\u548c\u4e2d\u65ad\u672c\u8eab\u5e76\u4e0d\u76f4\u63a5\u8d1f\u8d23\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4e4b\u95f4\u7684\u5207\u6362\uff0c\u800c\u662f\u5bfc\u81f4\u8fd9\u79cd\u5207\u6362\u7684\u89e6\u53d1\u4e8b\u4ef6\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0d\u540c\u67b6\u6784\u4e0b\u63d0\u4f9b\u7684 trap \u6307\u4ee4\u6765\u4e3b\u52a8\u5207\u6362\u3002</p> <p>\u8fd9\u91cc \u7559\u5751\uff0c\u5728\u5b8c\u6210\u4e86PA3.1\u540e\u518d\u6765\u56de\u7b54\uff0c\u987a\u4fbf\u4ee5 RISC-V \u7684\u89c6\u89d2\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u3002\u56e0\u4e3a\u5904\u7406\u5668\u548c <code>os</code> \u9700\u8981\u914d\u5408\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002</p> <p>\u8fdb\u4e00\u6b65\u603b\u7ed3\u53d1\u751f\u5f02\u5e38\u4e4b\u540e\u7684\uff1a</p> <ol> <li>\u89e6\u53d1\u4e8b\u4ef6\uff1a\u65e0\u8bba\u662f\u7531\u4e8e\u5f02\u5e38\u3001\u4e2d\u65ad\u8fd8\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u5f53\u4e00\u4e2a\u4e8b\u4ef6\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u4ecb\u5165\u5904\u7406\u65f6\uff0c\u5b83\u4f1a\u89e6\u53d1\u4e00\u4e2a\u5904\u7406\u5668\u7684\u4e2d\u65ad\u5411\u91cf\u6216\u5f02\u5e38\u5411\u91cf\u3002</li> <li>\u4fdd\u5b58\u72b6\u6001\uff1a\u5904\u7406\u5668\u5728\u54cd\u5e94\u5f02\u5e38\u6216\u4e2d\u65ad\u65f6\uff0c\u4f1a\u81ea\u52a8\u4fdd\u5b58\u5f53\u524d\u7684\u4e0a\u4e0b\u6587\uff0c\u5305\u62ec\u7a0b\u5e8f\u8ba1\u6570\u5668\u548c\u5176\u4ed6\u5bc4\u5b58\u5668\u7684\u72b6\u6001\uff0c\u4ee5\u4fbf\u4e4b\u540e\u53ef\u4ee5\u6062\u590d\u6267\u884c\u3002</li> <li>\u7279\u6743\u7ea7\u522b\u53d8\u66f4\uff1a\u5927\u591a\u6570\u73b0\u4ee3\u5904\u7406\u5668\u5177\u6709\u6539\u53d8\u7279\u6743\u7ea7\u522b\u7684\u673a\u5236\uff0c\u901a\u5e38\u4e0e\u5f02\u5e38\u548c\u4e2d\u65ad\u5904\u7406\u76f8\u5173\u3002\u5f53\u4e2d\u65ad\u6216\u5f02\u5e38\u53d1\u751f\u65f6\uff0c\u5904\u7406\u5668\u4f1a\u81ea\u52a8\u4ece\u5f53\u524d\u7684\u6267\u884c\u7ea7\u522b\uff08\u7528\u6237\u6001\u6216\u5185\u6838\u6001\uff09\u5207\u6362\u5230\u4e00\u4e2a\u66f4\u9ad8\u7684\u7279\u6743\u7ea7\u522b\uff08\u901a\u5e38\u662f\u5185\u6838\u6001\uff09\u3002</li> <li>\u6267\u884c\u5904\u7406\u7a0b\u5e8f\uff1a\u5904\u7406\u5668\u4f1a\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u4e2d\u65ad\u670d\u52a1\u4f8b\u7a0b\uff08ISR\uff09\u6216\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002\u8fd9\u4e9b\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u5728\u5185\u6838\u6001\uff0c\u62e5\u6709\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u5b8c\u5168\u8bbf\u95ee\u6743\u9650\u3002</li> <li>\u7cfb\u7edf\u8c03\u7528\u7ea6\u5b9a\uff1a\u5bf9\u4e8e\u7cfb\u7edf\u8c03\u7528\uff0c\u4e0d\u540c\u67b6\u6784\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u7ea6\u5b9a\u3002\u4f8b\u5982\uff1a<ul> <li>\u5728x86\u67b6\u6784\u4e2d\uff0c<code>int 0x80</code>\u6216<code>syscall</code>\u6307\u4ee4\u7528\u4e8e\u89e6\u53d1\u7cfb\u7edf\u8c03\u7528\u3002\u5904\u7406\u5668\u54cd\u5e94\u8fd9\u4e2a\u6307\u4ee4\uff0c\u4fdd\u5b58\u5f53\u524d\u72b6\u6001\uff0c\u5e76\u8df3\u8f6c\u5230\u64cd\u4f5c\u7cfb\u7edf\u5b9a\u4e49\u7684\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\u3002</li> <li>\u5728MIPS\u67b6\u6784\u4e2d\uff0c<code>syscall</code>\u6307\u4ee4\u7528\u4e8e\u53d1\u8d77\u7cfb\u7edf\u8c03\u7528\uff0c\u540c\u6837\u4f1a\u89e6\u53d1\u5904\u7406\u5668\u5207\u6362\u5230\u5185\u6838\u6001\u5e76\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\u3002</li> <li>\u5728RISC-V\u67b6\u6784\u4e2d\uff0c<code>ecall</code>\uff08Environment Call\uff09\u6307\u4ee4\u7528\u4e8e\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u4ee5\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u3002</li> </ul> </li> <li>\u4e0a\u4e0b\u6587\u5207\u6362\uff1a\u5982\u679c\u9700\u8981\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5728\u5904\u7406\u7a0b\u5e8f\u4e2d\u6267\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6bd4\u5982\u5728\u591a\u4efb\u52a1\u73af\u5883\u4e2d\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u3002</li> <li>\u8fd4\u56de\u7528\u6237\u6001\uff1a\u4e00\u65e6\u5f02\u5e38\u6216\u4e2d\u65ad\u88ab\u5904\u7406\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8d1f\u8d23\u5c06\u63a7\u5236\u6743\u5b89\u5168\u5730\u8fd4\u56de\u7ed9\u7528\u6237\u6001\u7684\u7a0b\u5e8f\u3002\u8fd9\u901a\u5e38\u6d89\u53ca\u5230\u6062\u590d\u4e4b\u524d\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\uff0c\u5e76\u53ef\u80fd\u6539\u53d8\u5904\u7406\u5668\u7684\u7279\u6743\u7ea7\u522b\u3002</li> </ol> <p>GPT</p> </li> </ol> </li> </ol> <p>\u6b63\u5728\u5c1d\u8bd5\u4e3a\u60a8\u5728\u4e92\u8054\u7f51\u641c\u7d22\u76f8\u5173\u8d44\u6599...</p> <p>\u5f00\u59cb\u83b7\u53d6\u8d44\u6599...</p> <p>\u627e\u5230\u4e86\u7b2c 1 \u7bc7\u8d44\u6599\uff1a\u4ec0\u4e48\u662f\u7cfb\u7edf\u8c03\u7528?\u4e3a\u4ec0\u4e48\u8981\u7528\u7cfb\u7edf\u8c03\u7528?-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 2 \u7bc7\u8d44\u6599\uff1a\u64cd\u4f5c\u7cfb\u7edf\u539f\u7406\u4e0e\u6e90\u7801\u5b9e\u4f8b\u8bb2\u89e3\uff1a\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0 - \u77e5\u4e4e</p> <p>\u627e\u5230\u4e86\u7b2c 3 \u7bc7\u8d44\u6599\uff1a\u6df1\u5165XV6\uff1a\u9677\u9631\u4e0e\u7cfb\u7edf\u8c03\u7528\u7684\u63a2\u7d22\u4e4b\u65c5 - \u767e\u5ea6\u667a\u80fd\u4e91</p> <p>\u627e\u5230\u4e86\u7b2c 4 \u7bc7\u8d44\u6599\uff1a\u6df1\u5165\u7406\u89e3\u7cfb\u7edf\u8c03\u7528 - lwis - \u535a\u5ba2\u56ed</p> <p>\u627e\u5230\u4e86\u7b2c 5 \u7bc7\u8d44\u6599\uff1aLinux\u7cfb\u7edf\u8c03\u7528\u6982\u8ff0\u4e0e\u5b9e\u4f8b\u5206\u6790_\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\u4e3e\u4f8b-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 6 \u7bc7\u8d44\u6599\uff1a\u590d\u4e60\u8865\u5145\u4e00\u70b9\u7cfb\u7edf\u8c03\u7528\u5b9e\u4f8b_\u4e3e\u4e2a\u4f8b\u5b50\u7cfb\u7edf\u8c03\u7528-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 7 \u7bc7\u8d44\u6599\uff1a\u64cd\u4f5c\u7cfb\u7edf\u539f\u7406\u4e0e\u6e90\u7801\u5b9e\u4f8b\u8bb2\u89e3\uff1a043 \u7cfb\u7edf\u8c03\u7528\u7684\u539f\u7406\u548c\u6e90\u7801\u5b9e\u4f8b</p> <p>\u627e\u5230\u4e86\u7b2c 8 \u7bc7\u8d44\u6599\uff1a\u7cfb\u7edf\u8c03\u7528 - Linux \u5185\u6838\u5982\u4f55\u5904\u7406\u7cfb\u7edf\u8c03\u7528 - \u300aLinux \u5185\u6838\u63ed\u79d8 ...</p> <p>\u627e\u5230\u4e86\u7b2c 9 \u7bc7\u8d44\u6599\uff1aChapter 4 \u9677\u9631\u548c\u7cfb\u7edf\u8c03\u7528 \uff08Traps and system calls\uff09</p> <p>\u627e\u5230\u4e86\u7b2c 10 \u7bc7\u8d44\u6599\uff1aXV6\u5b66\u4e60\u4e4b\u65c5\uff1a\u6df1\u5165\u9677\u9631\u4e0e\u7cfb\u7edf\u8c03\u7528 - \u767e\u5ea6\u667a\u80fd\u4e91</p> <p>\u627e\u5230\u4e86\u7b2c 11 \u7bc7\u8d44\u6599\uff1a\u6df1\u5165XV6\uff1a\u9677\u9631\u4e0e\u7cfb\u7edf\u8c03\u7528\u7684\u63a2\u7d22\u4e4b\u65c5-\u767e\u5ea6\u5f00\u53d1\u8005\u4e2d\u5fc3</p> <p>\u627e\u5230\u4e86\u7b2c 12 \u7bc7\u8d44\u6599\uff1a\u7b2c4\u7ae0 \u9677\u9631\u548c\u7cfb\u7edf\u8c03\u7528 - \u7b80\u4e66</p> <ul> <li> <p>\u7cfb\u7edf\u8c03\u7528\uff08System Call\uff09</p> <p>\u7cfb\u7edf\u8c03\u7528\u662f\u7528\u6237\u7a0b\u5e8f\u5411\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u8bf7\u6c42\u670d\u52a1\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u7528\u6237\u7a0b\u5e8f\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u53ef\u4ee5\u8bf7\u6c42\u64cd\u4f5c\u7cfb\u7edf\u6267\u884c\u7279\u5b9a\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u6587\u4ef6\u64cd\u4f5c\u3001\u8fdb\u7a0b\u63a7\u5236\u3001\u901a\u4fe1\u7b49\u3002\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0\u901a\u5e38\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u7528\u6237\u7a0b\u5e8f\u901a\u8fc7\u7279\u5b9a\u7684\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\u53d1\u8d77\u8bf7\u6c42\u3002</li> <li>CPU\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u3002</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u63a5\u6536\u8bf7\u6c42\uff0c\u5e76\u6839\u636e\u7cfb\u7edf\u8c03\u7528\u53f7\u627e\u5230\u5bf9\u5e94\u7684\u5185\u6838\u51fd\u6570\u6267\u884c\u3002</li> <li>\u5185\u6838\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u7528\u6237\u7a0b\u5e8f\uff0cCPU\u518d\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002</li> </ol> </li> <li> <p>\u9677\u9631\uff08trap\uff09</p> <p>\u9677\u9631\u662f\u4e00\u79cd\u7531\u8f6f\u4ef6\u89e6\u53d1\u7684\u4e2d\u65ad\uff0c\u7528\u4e8e\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\u3002\u5728\u7528\u6237\u7a0b\u5e8f\u4e2d\uff0c\u5f53\u9700\u8981\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u4f1a\u6267\u884c\u4e00\u6761\u7279\u6b8a\u7684\u6307\u4ee4\uff08\u5982<code>int</code>\u6216<code>syscall</code>\uff09\uff0c\u8fd9\u6761\u6307\u4ee4\u4f1a\u89e6\u53d1\u4e00\u4e2a\u8f6f\u4ef6\u4e2d\u65ad\uff0c\u5373\u9677\u9631\u3002\u5904\u7406\u5668\u6355\u83b7\u5230\u9677\u9631\u540e\uff0c\u4f1a\u5c06\u63a7\u5236\u6743\u8f6c\u4ea4\u7ed9\u5185\u6838\u7684\u9677\u9631\u5904\u7406\u7a0b\u5e8f\u3002</p> </li> </ul> <p>\u603b\u7ed3\uff0c\u7cfb\u7edf\u8c03\u7528\u7684\u80cc\u540e\u662f trap \u6307\u4ee4</p> <p>\u7559\u5751 \u8fd9\u91cc\u5728\u5b8c\u6210\u4e86PA4\u4e4b\u540e\u6709\u4e86\u4e00\u70b9\u5b9e\u9645\u7684\u786c\u4ef6\u4f53\u4f1a\u518d\u56de\u6765\u5199\u5199\u3002</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u63a5\u4e0a\uff0c\u90a3\u5bf9\u4e8e\u73b0\u5728\u6765\u8bf4\uff0c\u7cfb\u7edf\u8c03\u7528\u548c\u5e93\u51fd\u6570\u8fd9\u79cd\u8fc7\u7a0b\u8c03\u7528\u8fd8\u6709\u4ec0\u4e48\u533a\u522b\uff1f \u6bd4\u5982 <code>glibc</code> \u548c\u7cfb\u7edf\u8c03\u7528\u80cc\u540e\u5b9e\u73b0trap\u7684\u6307\u4ee4\u6709\u4ec0\u4e48\u5173\u7cfb\u548c\u533a\u522b</p> <p><code>glibc</code> \u5230\u6700\u540e\u90fd\u672c\u8d28\u662f\u4e0d\u662f\u8fd8\u662f\u7cfb\u7edf\u8c03\u7528\uff1f\u8fd8\u662f\u8981\u8fdb\u884c\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u5207\u6362\uff1f</p> <p>\u6211\u634b\u4e00\u4e0b\uff0c\u5047\u5982\u8bf4\u6211\u5199\u4e00\u4e2a\u4ee3\u7801\uff0c\u5199\u4e86\u4e00\u884c <code>printf</code>\uff0c\u5176\u5bf9\u5e94\u5230\u5185\u90e8\u7684\u7cfb\u7edf\u8c03\u7528\u662f <code>write</code>\uff0c\u6700\u7ec8\u8f93\u51fa\u5230\u7ec8\u7aef\u4e0a\uff08\u5185\u90e8\u8fd8\u6709\u5f88\u591a\u7ec6\u8282\uff09\uff0c\u5176\u5bf9\u5e94\u4e0a\u7684\u5185\u90e8\u6307\u4ee4\u5c31\u8fd8\u662f\u9700\u8981\u7528\u5230trap\u8fd9\u4e2a\u6307\u4ee4\u6765\u5207\u6362\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u6765\u5bf9\u786c\u4ef6\u8fdb\u884c\u64cd\u63a7\u3002</p> <p>\u662f\u7684\uff0c\u60a8\u7406\u89e3\u7684\u57fa\u672c\u6b63\u786e\u3002glibc\uff08GNU C Library\uff09\u4e2d\u7684\u8bb8\u591a\u51fd\u6570\uff0c\u5305\u62ec<code>printf</code>\uff0c\u6700\u7ec8\u53ef\u80fd\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u5b83\u4eec\u7684\u529f\u80fd\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u89e3\u91ca\uff1a</p> <ol> <li> <p>\u5e93\u51fd\u6570\u4e0e\u7cfb\u7edf\u8c03\u7528\u7684\u5173\u7cfb\uff1aglibc \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5e93\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u4e3a\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684\u63a5\u53e3\u6765\u6267\u884c\u5404\u79cd\u64cd\u4f5c\uff0c\u5305\u62ec I/O\u3001\u5185\u5b58\u7ba1\u7406\u3001\u8fdb\u7a0b\u63a7\u5236\u7b49\u3002\u8fd9\u4e9b\u5e93\u51fd\u6570\u7684\u5b9e\u73b0\u901a\u5e38\u4f1a\u5728\u5fc5\u8981\u65f6\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u3002</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528\u7684\u5fc5\u8981\u6027\uff1a\u5f53\u5e93\u51fd\u6570\u9700\u8981\u6267\u884c\u4e00\u4e9b\u53ea\u80fd\u7531\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5b8c\u6210\u7684\u64cd\u4f5c\u65f6\uff08\u6bd4\u5982\u5199\u5165\u6587\u4ef6\u3001\u6539\u53d8\u6587\u4ef6\u72b6\u6001\u3001\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u7b49\uff09\uff0c\u5b83\u4eec\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8bf7\u6c42\u5185\u6838\u670d\u52a1\u3002\u7cfb\u7edf\u8c03\u7528\u662f\u7528\u6237\u7a7a\u95f4\u7a0b\u5e8f\u4e0e\u5185\u6838\u7a7a\u95f4\u4ea4\u4e92\u7684\u552f\u4e00\u5b89\u5168\u65b9\u5f0f\u3002</p> </li> <li> <p>\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\uff1a\u7cfb\u7edf\u8c03\u7528\u786e\u5b9e\u6d89\u53ca\u5230\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u3002\u8fd9\u662f\u901a\u8fc7\u7279\u5b9a\u7684\u786c\u4ef6\u6307\u4ee4\u5b9e\u73b0\u7684\uff0c\u6bd4\u5982\u5728 x86 \u67b6\u6784\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>int</code> \u6216 <code>syscall</code> \u6307\u4ee4\u6765\u89e6\u53d1\u9677\u9631\uff08trap\uff09\uff0c\u4ece\u800c\u5b9e\u73b0\u72b6\u6001\u5207\u6362\u3002</p> </li> <li> <p><code>printf</code> \u548c <code>write</code> \u7684\u5173\u7cfb\uff1a<code>printf</code> \u662f glibc \u4e2d\u7684\u4e00\u4e2a\u683c\u5f0f\u5316\u8f93\u51fa\u51fd\u6570\uff0c\u5b83\u5728\u5185\u90e8\u53ef\u80fd\u4f1a\u8c03\u7528 <code>write</code> \u7cfb\u7edf\u8c03\u7528\u6765\u5c06\u683c\u5f0f\u5316\u540e\u7684\u5b57\u7b26\u4e32\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff08\u901a\u5e38\u662f\u7ec8\u7aef\uff09\u3002<code>write</code> \u7cfb\u7edf\u8c03\u7528\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u7528\u6237\u7a7a\u95f4\u7684\u7f13\u51b2\u533a\u4f20\u8f93\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</p> </li> <li> <p>\u4f7f\u7528 trap \u6307\u4ee4\uff1a\u5f53 glibc \u4e2d\u7684 <code>write</code> \u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u5982\u679c\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u5b83\u4f1a\u4f7f\u7528 trap \u6307\u4ee4\uff08\u5982 <code>int 0x80</code> \u6216 <code>syscall</code>\uff09\u6765\u8bf7\u6c42\u5185\u6838\u670d\u52a1\u3002\u8fd9\u4e2a\u6307\u4ee4\u4f1a\u5bfc\u81f4 CPU \u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4f1a\u5904\u7406\u8fd9\u4e2a\u8c03\u7528\u3002</p> </li> <li> <p>\u8f93\u51fa\u5230\u7ec8\u7aef\uff1a\u5f53 <code>write</code> \u7cfb\u7edf\u8c03\u7528\u88ab\u7528\u4e8e\u6807\u51c6\u8f93\u51fa\u65f6\uff0c\u5185\u6838\u4f1a\u5c06\u6570\u636e\u53d1\u9001\u5230\u63a7\u5236\u53f0\u9a71\u52a8\u7a0b\u5e8f\uff0c\u8be5\u9a71\u52a8\u7a0b\u5e8f\u4f1a\u4e0e\u786c\u4ef6\u4ea4\u4e92\uff0c\u6700\u7ec8\u5c06\u6570\u636e\u663e\u793a\u5728\u7528\u6237\u7684\u7ec8\u7aef\u4e0a\u3002</p> </li> </ol> <p>\u5173\u4e8e\u6807\u51c6IO\u548c\u4f4e\u7ea7IO\u548c\u7cfb\u7edf\u8c03\u7528\uff0cwrite\u3001read\u3001open\u7b49\u7b49\uff1a\u4e4b\u524d\u770b\u5230\u7684\u4e00\u5f20\u56fe\uff1a</p> <p></p> <p>\u6807\u51c6 IO \u63a5\u53e3\u5728\u5b9e\u73b0\u65f6\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528\u6240\u5728\u5e73\u53f0\u63d0\u4f9b\u7684\u4f4e\u7ea7 IO \u63a5\u53e3\u3002</p> <p>\u800c\u4f4e\u7ea7 IO \u63a5\u53e3\u5728\u6bcf\u6b21\u8c03\u7528\u65f6\uff0c\u90fd\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u5b8c\u6210\u76f8\u5e94\u7684 IO \u64cd\u4f5c\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u6d89\u53ca\u5230\u8fdb\u7a0b\u5728\u7528\u6237\u6a21\u5f0f\u4e0e\u5185\u6838\u6a21\u5f0f\u4e4b\u95f4\u7684\u8f6c\u6362\uff0c\u5176\u6210\u672c\u8f83\u9ad8\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#pa31_1","title":"PA3.1\u7a7f\u8d8a\u65f6\u7a7a\u7684\u65c5\u7a0b","text":""},{"location":"ysyx/pa/pa3/pa3.html#riscv32","title":"riscv32","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7279\u6b8a\u7684\u539f\u56e0? (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u8fd9\u4e9b\u7a0b\u5e8f\u72b6\u6001(x86\u7684eflags, cs, eip; mips32\u7684epc, status, cause; riscv32\u7684mepc, mstatus, mcause)\u5fc5\u987b\u7531\u786c\u4ef6\u6765\u4fdd\u5b58\u5417? \u80fd\u5426\u901a\u8fc7\u8f6f\u4ef6\u6765\u4fdd\u5b58? \u4e3a\u4ec0\u4e48?</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_3","title":"\u72b6\u6001\u673a\u89c6\u89d2\u4e0b\u7684\u5f02\u5e38\u54cd\u5e94\u673a\u5236","text":""},{"location":"ysyx/pa/pa3/pa3.html#cte","title":"\u5c06\u4e0a\u4e0b\u6587\u7ba1\u7406\u62bd\u8c61\u6210CTE","text":"<p>\u8bfe\u5916\u9605\u8bfb</p> <p>\u7528\u8f6f\u4ef6\u6a21\u62df\u6307\u4ee4</p> <p>\u5728\u4e00\u4e9b\u5d4c\u5165\u5f0f\u573a\u666f\u4e2d, \u5904\u7406\u5668\u5bf9\u4f4e\u529f\u8017\u7684\u8981\u6c42\u975e\u5e38\u4e25\u683c, \u5f88\u591a\u65f6\u5019\u90fd\u4f1a\u53bb\u6389\u6d6e\u70b9\u5904\u7406\u5355\u5143FPU\u6765\u8282\u7701\u529f\u8017. \u8fd9\u65f6\u5019\u5982\u679c\u8f6f\u4ef6\u8981\u6267\u884c\u4e00\u6761\u6d6e\u70b9\u6307\u4ee4, \u5904\u7406\u5668\u5c31\u4f1a\u629b\u51fa\u4e00\u4e2a\u975e\u6cd5\u6307\u4ee4\u7684\u5f02\u5e38. \u6709\u4e86\u5f02\u5e38\u54cd\u5e94\u673a\u5236, \u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5f02\u5e38\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\u6a21\u62df\u8fd9\u6761\u975e\u6cd5\u6307\u4ee4\u7684\u6267\u884c\u4e86, \u539f\u7406\u548cPA2\u4e2d\u7684\u6307\u4ee4\u6267\u884c\u8fc7\u7a0b\u975e\u5e38\u7c7b\u4f3c. \u5728\u4e0d\u5e26FPU\u7684\u5404\u79cd\u5904\u7406\u5668\u4e2d, \u90fd\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u6267\u884c\u6d6e\u70b9\u6307\u4ee4.</p> <p>\u5728AM\u4e2d\u6267\u884c\u6d6e\u70b9\u6307\u4ee4\u662fUB</p> <p>\u6362\u53e5\u8bdd\u8bf4, AM\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e0d\u652f\u6301\u6d6e\u70b9\u6570. \u8fd9\u542c\u4e0a\u53bb\u592a\u66b4\u529b\u4e86. \u4e4b\u6240\u4ee5\u8fd9\u6837\u51b3\u5b9a, \u662f\u56e0\u4e3aIEEE 754\u662f\u4e2a\u5de5\u4e1a\u7ea7\u6807\u51c6, \u4e3a\u4e86\u5f62\u5f0f\u5316\u903b\u8f91\u4e0a\u7684soundness\u548ccompleteness, \u6807\u51c6\u91cc\u9762\u53ef\u80fd\u4f1a\u6709\u5404\u79cd\u5947\u602a\u7684\u8bbe\u5b9a, \u4f8b\u5982\u4e0d\u540c\u7684\u820d\u5165\u65b9\u5f0f, inf\u548cnan\u7684\u5f15\u5165\u7b49\u7b49, \u4f5c\u4e3a\u6559\u5b66\u5176\u5b9e\u6ca1\u6709\u5fc5\u8981\u53bb\u7406\u89e3\u5b83\u4eec\u7684\u6240\u6709\u7ec6\u8282; \u4f46\u5982\u679c\u8981\u53bb\u5b9e\u73b0\u4e00\u4e2a\u6b63\u786e\u7684FPU, \u4f60\u5c31\u6ca1\u6cd5\u6446\u8131\u8fd9\u4e9b\u7ec6\u8282\u4e86.</p> <p>\u548cPA2\u4e2d\u7684\u5b9a\u70b9\u6307\u4ee4\u4e0d\u540c, \u6d6e\u70b9\u6307\u4ee4\u5728PA\u4e2d\u7528\u5230\u7684\u573a\u5408\u6bd4\u8f83\u5c11, \u800c\u4e14\u6211\u4eec\u6709\u522b\u7684\u65b9\u5f0f\u53ef\u4ee5\u7ed5\u5f00, \u6240\u4ee5\u5c31\u600e\u4e48\u7b80\u5355\u600e\u4e48\u6765\u4e86, \u4e8e\u662f\u5c31UB\u5427. \u5f53\u7136, \u5982\u679c\u4f60\u611f\u5174\u8da3, \u4f60\u4e5f\u53ef\u4ee5\u8003\u8651\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5316\u7248\u7684FPU. \u6bd5\u7adf\u662fUB, \u5982\u679c\u4f60\u7684FPU\u884c\u4e3a\u6b63\u786e, \u4e5f\u4e0d\u7b97\u8fdd\u53cd\u89c4\u5b9a.</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u53e6\u4e00\u4e2aUB</p> <p>\u53e6\u4e00\u79cd\u4f60\u53ef\u80fd\u4f1a\u78b0\u5230\u7684UB\u662f\u6808\u6ea2\u51fa, \u5bf9, \u5c31\u662fstackoverflow\u7684\u90a3\u4e2a. \u68c0\u6d4b\u6808\u6ea2\u51fa\u9700\u8981\u4e00\u4e2a\u66f4\u5f3a\u5927\u7684\u8fd0\u884c\u65f6\u73af\u5883, AM\u80af\u5b9a\u662f\u65e0\u80fd\u4e3a\u529b\u4e86, \u4e8e\u662f\u5c31UB\u5427.</p> <p>\u4e0d\u8fc7, AM\u7a76\u7adf\u7ed9\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u591a\u5927\u7684\u6808\u7a7a\u95f4\u5462? \u4e8b\u5b9e\u4e0a, \u5982\u679c\u4f60\u5728PA2\u7684\u65f6\u5019\u5c1d\u8bd5\u52aa\u529b\u4e86\u89e3\u6bcf\u4e00\u5904\u7ec6\u8282, \u4f60\u5df2\u7ecf\u77e5\u9053\u8fd9\u4e2a\u95ee\u9898\u7684\u7b54\u6848\u4e86; \u5982\u679c\u4f60\u6ca1\u6709, \u4f60\u9700\u8981\u53cd\u601d\u4e00\u4e0b\u81ea\u5df1\u4e86, \u8fd8\u662f\u8ba4\u771fRTFSC\u5427.</p> <p>\u6808\u7684\u5927\u5c0f</p> <pre><code>ENTRY(_start)\nPHDRS { text PT_LOAD; data PT_LOAD; }\n\nSECTIONS {\n  /* _pmem_start and _entry_offset are defined in LDFLAGS */\n  . = _pmem_start + _entry_offset;\n  .text : {\n    *(entry)\n    *(.text*)\n  } : text\n  etext = .;\n  _etext = .;\n  .rodata : {\n    *(.rodata*)\n  }\n  .data : {\n    *(.data)\n  } : data\n  edata = .;\n  _data = .;\n  .bss : {\n    _bss_start = .;\n    *(.bss*)\n    *(.sbss*)\n    *(.scommon)\n  }\n  _stack_top = ALIGN(0x1000);\n  . = _stack_top + 0x8000;\n  _stack_pointer = .;\n  end = .;\n  _end = .;\n  _heap_start = ALIGN(0x1000);\n}\n</code></pre> <p>\u6808\u7684\u5927\u5c0f\uff1a0x8000 \u5e76\u5bf9\u9f50\u5230\u6700\u63a5\u8fd1\u7684 4KB</p> <p>\u8fd9\u91cc\uff0c<code>_stack_top</code> \u662f\u6808\u7684\u9876\u90e8\u5730\u5740\uff0c\u800c <code>_stack_pointer</code> \u662f\u6808\u6307\u9488\u7684\u521d\u59cb\u503c\uff0c\u5b83\u8bbe\u7f6e\u5728 <code>_stack_top</code> \u5730\u5740\u4e0a\u52a0\u4e0a <code>0x8000</code> \u7684\u4f4d\u7f6e\u3002\u8fd9\u610f\u5473\u7740\u6808\u7684\u5927\u5c0f\u662f\u4ece <code>_stack_top</code> \u5730\u5740\u5f00\u59cb\u5411\u4e0b\u589e\u957f\u7684\uff0c\u76f4\u5230 <code>_stack_pointer</code> \u6240\u6307\u5411\u7684\u5730\u5740\u3002\u56e0\u6b64\uff0c\u6808\u7684\u5927\u5c0f\u662f <code>0x8000</code> \u5b57\u8282\uff0c\u6216\u8005\u8bf4\u662f 32768 \u5b57\u8282\u3002\u8fd9\u76f8\u5f53\u4e8e 32KB \u7684\u6808\u7a7a\u95f4\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_4","title":"\u8bbe\u7f6e\u5f02\u5e38\u5165\u53e3\u5730\u5740","text":"<pre><code>abstract-machine/am/include/am.h\n// \u67b6\u6784\u65e0\u5173\uff0c\u4e13\u6ce8\u4e8eAM\uff08eg. context \u7684 event\uff09\n\n/home/jai/ysyx-workbench/abstract-machine/am/include/arch\n// \u67b6\u6784\u76f8\u5173\n</code></pre>"},{"location":"ysyx/pa/pa3/pa3.html#_5","title":"\u5b9e\u73b0\u5f02\u5e38\u54cd\u5e94\u673a\u5236","text":"<ul> <li> <p>PA\u4e0d\u6d89\u53ca\u7279\u6743\u7ea7\u7684\u5207\u6362, RTFM\u7684\u65f6\u5019\u4f60\u4e0d\u9700\u8981\u5173\u5fc3\u548c\u7279\u6743\u7ea7\u5207\u6362\u76f8\u5173\u7684\u5185\u5bb9.</p> </li> <li> <p>\u505a</p> <p>\u5b9e\u73b0\u5f02\u5e38\u54cd\u5e94\u673a\u5236</p> <p>\u4f60\u9700\u8981\u5b9e\u73b0\u4e0a\u6587\u63d0\u5230\u7684\u65b0\u6307\u4ee4, \u5e76\u5b9e\u73b0<code>isa_raise_intr()</code>\u51fd\u6570. \u7136\u540e\u9605\u8bfb<code>cte_init()</code>\u7684\u4ee3\u7801, \u627e\u51fa\u76f8\u5e94\u7684\u5f02\u5e38\u5165\u53e3\u5730\u5740.</p> <p>\u5982\u679c\u4f60\u9009\u62e9mips32\u548criscv32, \u4f60\u4f1a\u53d1\u73b0status/mstatus\u5bc4\u5b58\u5668\u4e2d\u6709\u975e\u5e38\u591a\u72b6\u6001\u4f4d, \u4e0d\u8fc7\u76ee\u524d\u5b8c\u5168\u4e0d\u5b9e\u73b0\u8fd9\u4e9b\u72b6\u6001\u4f4d\u7684\u529f\u80fd\u4e5f\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u7684\u6267\u884c, \u56e0\u6b64\u76ee\u524d\u53ea\u9700\u8981\u5c06status/mstatus\u5bc4\u5b58\u5668\u770b\u6210\u4e00\u4e2a\u53ea\u7528\u4e8e\u5b58\u653e32\u4f4d\u6570\u636e\u7684\u5bc4\u5b58\u5668\u5373\u53ef.</p> <p>\u5b9e\u73b0\u540e, \u91cd\u65b0\u8fd0\u884c<code>yield test</code>, \u5982\u679c\u4f60\u53d1\u73b0NEMU\u786e\u5b9e\u8df3\u8f6c\u5230\u4f60\u627e\u5230\u7684\u5f02\u5e38\u5165\u53e3\u5730\u5740, \u8bf4\u660e\u4f60\u7684\u5b9e\u73b0\u6b63\u786e(NEMU\u4e5f\u53ef\u80fd\u56e0\u4e3a\u89e6\u53d1\u4e86\u672a\u5b9e\u73b0\u6307\u4ee4\u800c\u7ec8\u6b62\u8fd0\u884c).</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_6","title":"\u4fdd\u5b58\u4e0a\u4e0b\u6587","text":"<p>\u6210\u529f\u8df3\u8f6c\u5230\u5f02\u5e38\u5165\u53e3\u5730\u5740\u4e4b\u540e, \u6211\u4eec\u5c31\u8981\u5728\u8f6f\u4ef6\u4e0a\u5f00\u59cb\u771f\u6b63\u7684\u5f02\u5e38\u5904\u7406\u8fc7\u7a0b\u4e86. \u4f46\u662f, \u8fdb\u884c\u5f02\u5e38\u5904\u7406\u7684\u65f6\u5019\u4e0d\u53ef\u907f\u514d\u5730\u9700\u8981\u7528\u5230\u901a\u7528\u5bc4\u5b58\u5668, \u7136\u800c\u770b\u770b\u73b0\u5728\u7684\u901a\u7528\u5bc4\u5b58\u5668, \u91cc\u9762\u5b58\u653e\u7684\u90fd\u662f\u6267\u884c\u6d41\u5207\u6362\u4e4b\u524d\u7684\u5185\u5bb9. \u8fd9\u4e9b\u5185\u5bb9\u4e5f\u662f\u4e0a\u4e0b\u6587\u7684\u4e00\u90e8\u5206, \u5982\u679c\u4e0d\u4fdd\u5b58\u5c31\u8986\u76d6\u5b83\u4eec, \u5c06\u6765\u5c31\u65e0\u6cd5\u6062\u590d\u8fd9\u4e00\u4e0a\u4e0b\u6587\u4e86. \u4f46\u901a\u5e38\u786c\u4ef6\u5e76\u4e0d\u8d1f\u8d23\u4fdd\u5b58\u5b83\u4eec, \u56e0\u6b64\u9700\u8981\u901a\u8fc7\u8f6f\u4ef6\u4ee3\u7801\u6765\u4fdd\u5b58\u5b83\u4eec\u7684\u503c. x86\u63d0\u4f9b\u4e86<code>pusha</code>\u6307\u4ee4, \u7528\u4e8e\u628a\u901a\u7528\u5bc4\u5b58\u5668\u7684\u503c\u538b\u6808; \u800cmips32\u548criscv32\u5219\u901a\u8fc7<code>sw</code>\u6307\u4ee4\u5c06\u5404\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u4f9d\u6b21\u538b\u6808.</p> <p>\u9664\u4e86\u901a\u7528\u5bc4\u5b58\u5668\u4e4b\u5916, \u4e0a\u4e0b\u6587\u8fd8\u5305\u62ec:</p> <ul> <li>\u89e6\u53d1\u5f02\u5e38\u65f6\u7684PC\u548c\u5904\u7406\u5668\u72b6\u6001. \u5bf9\u4e8ex86\u6765\u8bf4\u5c31\u662feflags, cs\u548ceip, x86\u7684\u5f02\u5e38\u54cd\u5e94\u673a\u5236\u5df2\u7ecf\u5c06\u5b83\u4eec\u4fdd\u5b58\u5728\u5806\u6808\u4e0a\u4e86; \u5bf9\u4e8emips32\u548criscv32\u6765\u8bf4, \u5c31\u662fepc/mepc\u548cstatus/mstatus\u5bc4\u5b58\u5668, \u5f02\u5e38\u54cd\u5e94\u673a\u5236\u628a\u5b83\u4eec\u4fdd\u5b58\u5728\u76f8\u5e94\u7684\u7cfb\u7edf\u5bc4\u5b58\u5668\u4e2d, \u6211\u4eec\u8fd8\u9700\u8981\u5c06\u5b83\u4eec\u4ece\u7cfb\u7edf\u5bc4\u5b58\u5668\u4e2d\u8bfb\u51fa, \u7136\u540e\u4fdd\u5b58\u5728\u5806\u6808\u4e0a.</li> <li>\u5f02\u5e38\u53f7. \u5bf9\u4e8ex86, \u5f02\u5e38\u53f7\u7531\u8f6f\u4ef6\u4fdd\u5b58; \u800c\u5bf9\u4e8emips32\u548criscv32, \u5f02\u5e38\u53f7\u5df2\u7ecf\u7531\u786c\u4ef6\u4fdd\u5b58\u5728cause/mcause\u5bc4\u5b58\u5668\u4e2d, \u6211\u4eec\u8fd8\u9700\u8981\u5c06\u5176\u4fdd\u5b58\u5728\u5806\u6808\u4e0a.</li> <li> <p>\u5730\u5740\u7a7a\u95f4. \u8fd9\u662f\u4e3aPA4\u51c6\u5907\u7684, \u5728x86\u4e2d\u5bf9\u5e94\u7684\u662f<code>CR3</code>\u5bc4\u5b58\u5668, \u4ee3\u7801\u901a\u8fc7\u4e00\u6761<code>pushl $0</code>\u6307\u4ee4\u5728\u5806\u6808\u4e0a\u5360\u4f4d, mips32\u548criscv32\u5219\u662f\u5c06\u5730\u5740\u7a7a\u95f4\u4fe1\u606f\u4e0e0\u53f7\u5bc4\u5b58\u5668\u5171\u7528\u5b58\u50a8\u7a7a\u95f4, \u53cd\u6b630\u53f7\u5bc4\u5b58\u5668\u7684\u503c\u603b\u662f0, \u4e5f\u4e0d\u9700\u8981\u4fdd\u5b58\u548c\u6062\u590d. \u4e0d\u8fc7\u76ee\u524d\u6211\u4eec\u6682\u65f6\u4e0d\u4f7f\u7528\u5730\u5740\u7a7a\u95f4\u4fe1\u606f, \u4f60\u76ee\u524d\u53ef\u4ee5\u5ffd\u7565\u5b83\u4eec\u7684\u542b\u4e49.</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5bf9\u6bd4\u5f02\u5e38\u5904\u7406\u4e0e\u51fd\u6570\u8c03\u7528</p> <p>\u6211\u4eec\u77e5\u9053\u8fdb\u884c\u51fd\u6570\u8c03\u7528\u7684\u65f6\u5019\u4e5f\u9700\u8981\u4fdd\u5b58\u8c03\u7528\u8005\u7684\u72b6\u6001: \u8fd4\u56de\u5730\u5740, \u4ee5\u53cacalling convention\u4e2d\u9700\u8981\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668. \u800cCTE\u5728\u4fdd\u5b58\u4e0a\u4e0b\u6587\u7684\u65f6\u5019\u5374\u8981\u4fdd\u5b58\u66f4\u591a\u7684\u4fe1\u606f. \u5c1d\u8bd5\u5bf9\u6bd4\u5b83\u4eec, \u5e76\u601d\u8003\u4e24\u8005\u4fdd\u5b58\u4fe1\u606f\u4e0d\u540c\u662f\u4ec0\u4e48\u539f\u56e0\u9020\u6210\u7684.</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u8be1\u5f02\u7684x86\u4ee3\u7801</p> <p>x86\u7684<code>trap.S</code>\u4e2d\u6709\u4e00\u884c<code>pushl %esp</code>\u7684\u4ee3\u7801, \u4e4d\u770b\u4e4b\u4e0b\u5176\u884c\u4e3a\u5341\u5206\u8be1\u5f02. \u4f60\u80fd\u7ed3\u5408\u524d\u540e\u7684\u4ee3\u7801\u7406\u89e3\u5b83\u7684\u884c\u4e3a\u5417? Hint: \u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a.</p> </li> </ul> <p>\u91cd\u65b0\u7ec4\u7ec7Context\u7ed3\u6784\u4f53</p> <p>\u4f60\u7684\u4efb\u52a1\u5982\u4e0b:</p> <ul> <li>\u5b9e\u73b0\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\u7684\u65b0\u6307\u4ee4, \u8be6\u60c5\u8bf7RTFM.</li> <li>\u7406\u89e3\u4e0a\u4e0b\u6587\u5f62\u6210\u7684\u8fc7\u7a0b\u5e76RTFSC, \u7136\u540e\u91cd\u65b0\u7ec4\u7ec7<code>abstract-machine/am/include/arch/$ISA-nemu.h</code> \u4e2d\u5b9a\u4e49\u7684 <code>Context</code>\u7ed3\u6784\u4f53\u7684\u6210\u5458, \u4f7f\u5f97\u8fd9\u4e9b\u6210\u5458\u7684\u5b9a\u4e49\u987a\u5e8f\u548c <code>abstract-machine/am/src/$ISA/nemu/trap.S</code>\u4e2d\u6784\u9020\u7684\u4e0a\u4e0b\u6587\u4fdd\u6301\u4e00\u81f4.</li> </ul> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f, \u867d\u7136\u6211\u4eec\u76ee\u524d\u6682\u65f6\u4e0d\u4f7f\u7528\u4e0a\u6587\u63d0\u5230\u7684\u5730\u5740\u7a7a\u95f4\u4fe1\u606f, \u4f46\u4f60\u5728\u91cd\u65b0\u7ec4\u7ec7<code>Context</code>\u7ed3\u6784\u4f53\u65f6\u4ecd\u7136\u9700\u8981\u6b63\u786e\u5730\u5904\u7406\u5730\u5740\u7a7a\u95f4\u4fe1\u606f\u7684\u4f4d\u7f6e, \u5426\u5219\u4f60\u53ef\u80fd\u4f1a\u5728PA4\u4e2d\u9047\u5230\u96be\u4ee5\u7406\u89e3\u7684\u9519\u8bef.</p> <p>\u5b9e\u73b0\u4e4b\u540e, \u4f60\u53ef\u4ee5\u5728<code>__am_irq_handle()</code>\u4e2d\u901a\u8fc7<code>printf</code>\u8f93\u51fa\u4e0a\u4e0b\u6587<code>c</code>\u7684\u5185\u5bb9, \u7136\u540e\u901a\u8fc7\u7b80\u6613\u8c03\u8bd5\u5668\u89c2\u5bdf\u89e6\u53d1\u81ea\u9677\u65f6\u7684\u5bc4\u5b58\u5668\u72b6\u6001, \u4ece\u800c\u68c0\u67e5\u4f60\u7684<code>Context</code>\u5b9e\u73b0\u662f\u5426\u6b63\u786e.</p> <p>\u7ed9\u4e00\u4e9b\u63d0\u793a\u5427</p> <p>\"\u5b9e\u73b0\u65b0\u6307\u4ee4\"\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684, \u4f60\u5df2\u7ecf\u5728PA2\u4e2d\u5b9e\u73b0\u4e86\u5f88\u591a\u6307\u4ee4\u4e86. \"\u91cd\u65b0\u7ec4\u7ec7\u7ed3\u6784\u4f53\"\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u8da3\u7684\u9898\u76ee, \u5982\u679c\u4f60\u4e0d\u77e5\u9053\u8981\u505a\u4ec0\u4e48, \u4e0d\u59a8\u4ece\u8bfb\u61c2\u9898\u76ee\u5f00\u59cb. \u9898\u76ee\u5927\u6982\u7684\u610f\u601d\u5c31\u662f, \u6839\u636e<code>trap.S</code>\u91cc\u9762\u7684\u5185\u5bb9, \u6765\u5b9a\u4e49<code>$ISA-nemu.h</code>\u91cc\u9762\u7684\u4e00\u4e2a\u7ed3\u6784\u4f53. <code>trap.S</code>\u660e\u663e\u662f\u6c47\u7f16\u4ee3\u7801, \u800c<code>$ISA-nemu.h</code>\u91cc\u9762\u5219\u662f\u4e00\u4e2a\u7528C\u8bed\u8a00\u5b9a\u4e49\u7684\u7ed3\u6784\u4f53. \u6c47\u7f16\u4ee3\u7801\u548cC\u8bed\u8a00... \u7b49\u7b49, \u4f60\u597d\u50cf\u60f3\u8d77\u4e86ICS\u8bfe\u672c\u7684\u67d0\u4e9b\u5185\u5bb9...</p> <p>\u914d\u5408 <code>trap.S</code> \u4e2d\u5b9a\u4e49\u7684\u5b8f\u987a\u5e8f\uff1a</p> <pre><code>#define CONTEXT_SIZE  ((NR_REGS + 3 + 1) * XLEN)\n#define OFFSET_SP     ( 2 * XLEN)\n#define OFFSET_CAUSE  ((NR_REGS + 0) * XLEN)\n#define OFFSET_STATUS ((NR_REGS + 1) * XLEN)\n#define OFFSET_EPC    ((NR_REGS + 2) * XLEN)\n</code></pre> <p>\u753b\u51fa\u5982\u4e0b\u56fe\uff1a</p> <pre><code>|         | &lt;-- sp\n| pdir    | \n| mepc    |\n| mstatus |   \n| mcause  |\n| x31     |   \n| x30     |\n...\n| x3      |\n|         |\n| x1      |\n|         | &lt;-- sp (addi sp, sp, -CONTEXT_SIZE)\n</code></pre> <p>\u53c8\u56e0\u4e3a\u7ed3\u6784\u4f53\u6210\u5458\u5728\u5185\u5b58\u4e2d\u7684\u6392\u5e03\u987a\u5e8f\uff1a</p> <p>Structure members are stored sequentially in the order in which they are declared: the first member has the lowest memory address and the last member the highest.</p> <p>\u5176\u5b9e\u4e5f\u5f88\u597d\u7406\u89e3\uff0c\u8bbf\u95ee\u7b2c\u4e00\u4e2a\u7ed3\u6784\u4f53\u6210\u5458(offset = 0)\uff0c\u60f3\u8bbf\u95ee\u4e0b\u9762\u7684\u6210\u5458\u4f9d\u6b21\u52a0 offset\u3002</p> <p>\u5982\u679c\u518d\u8003\u8651\u7ed3\u6784\u4f53\u6210\u5458\u548c\u5165\u6808\u987a\u5e8f\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u4e2a\u6210\u5458\u5728\u76f8\u5bf9\u6808\u5e95\uff0c\u6700\u540e\u4e00\u4e2a\u6210\u5458\u5728\u76f8\u5bf9\u6808\u9876\u3002\u7531\u6b64\u8c03\u6574\uff1a</p> <pre><code>struct Context {\n  uintptr_t gpr[NR_REGS];\n  uintptr_t mcause;\n  uintptr_t mstatus;\n  uintptr_t mepc;\n  void *pdir;\n};\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u6210\u5458\u3002</p> <pre><code>__am_asm_trap:\n  addi sp, sp, -CONTEXT_SIZE\n\n  MAP(REGS, PUSH)\n\n  csrr t0, mcause\n  csrr t1, mstatus\n  csrr t2, mepc\n\n  STORE t0, OFFSET_CAUSE(sp)\n  STORE t1, OFFSET_STATUS(sp)\n  STORE t2, OFFSET_EPC(sp)\n\n  # set mstatus.MPRV to pass difftest\n  li a0, (1 &lt;&lt; 17)\n  or t1, t1, a0\n  csrw mstatus, t1\n\n  mv a0, sp\n  jal __am_irq_handle\n\n  LOAD t1, OFFSET_STATUS(sp)\n  LOAD t2, OFFSET_EPC(sp)\n  csrw mstatus, t1\n  csrw mepc, t2\n\n  MAP(REGS, POP)\n\n  addi sp, sp, CONTEXT_SIZE\n  mret\n</code></pre> <p>\u4e3b\u8981\u7814\u7a76\u4e00\u4e0b\u6c47\u7f16\u548c\u51fd\u6570\u8c03\u7528\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u524d\u9762\u5c06 <code>gpr</code> \u3001<code>csr</code> \u5165\u6808\u4e4b\u540e\uff0c\u8fd9\u91cc\u7684\u5f02\u5e38\u5904\u7406\u4ee3\u7801\u76f4\u63a5\u5c06 <code>sp</code> \u8d4b\u503c\u7ed9 <code>a0</code> \u3002</p> <p>\u5173\u4e8e <code>riscv</code> \u6574\u578b <code>gpr</code> \u5728\u51fd\u6570\u8c03\u7528\u89c4\u8303\u4e2d\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5177\u4f53\u770b\u770b spec </p> <p></p> <p>\u6240\u4ee5 <code>sp</code> \u4f5c\u4e3a\u53c2\u6570\u4f20\u7ed9 <code>__am_irq_handle</code>\uff0c\u4e5f\u5c31\u662f\u9898\u76ee\u6240\u8bf4\u7684 <code>Context *c</code>\uff0c\u4e0d\u8fc7\u5462\u662f\u4f20\u8fdb\u53bb\u7684\u6808\u6307\u9488\uff0c\u6240\u4ee5\u5177\u4f53\u600e\u4e48\u4f7f\u7528\u6808\u4e0a\u9762\u7684\u5185\u5bb9\u8fdb\u4e00\u6b65\u770b\u6c47\u7f16\u4ee3\u7801\u3002\u8fd9\u91cc\u53c8\u5f15\u51fa\u4e00\u4e9b\u95ee\u9898\uff0c\u76f4\u63a5\u4f20\u5165\u6808\u6307\u9488\u7ed9\u51fd\u6570\uff0c\u90a3\u8fd9\u4e2a\u6307\u9488\u6307\u5411\u7684\u662f\u7ed3\u6784\u4f53\u7684\u54ea\u4e00\u4e2a\u6210\u5458\u5462\uff1f\u7b2c\u4e00\u4e2a\u8fd8\u662f\u6700\u540e\u4e00\u4e2a\uff1f</p> <p>\u7b2c\u4e00\u4e2a\u6210\u5458\u3002</p> <p>\u5fc5\u7b54\u9898(\u9700\u8981\u5728\u5b9e\u9a8c\u62a5\u544a\u4e2d\u56de\u7b54) - \u7406\u89e3\u4e0a\u4e0b\u6587\u7ed3\u6784\u4f53\u7684\u524d\u4e16\u4eca\u751f</p> <p>\u4f60\u4f1a\u5728<code>__am_irq_handle()</code>\u4e2d\u770b\u5230\u6709\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7ed3\u6784\u6307\u9488<code>c</code>, </p> <p><code>c</code> \u6307\u5411\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u7a76\u7adf\u5728\u54ea\u91cc?  \u8fd9\u4e2a\u4e0a\u4e0b\u6587\u7ed3\u6784\u53c8\u662f\u600e\u4e48\u6765\u7684?  \u5177\u4f53\u5730, \u8fd9\u4e2a\u4e0a\u4e0b\u6587\u7ed3\u6784\u6709\u5f88\u591a\u6210\u5458, \u6bcf\u4e00\u4e2a\u6210\u5458\u7a76\u7adf\u5728\u54ea\u91cc\u8d4b\u503c\u7684?  <code>$ISA-nemu.h</code>, <code>trap.S</code>, \u4e0a\u8ff0\u8bb2\u4e49\u6587\u5b57, \u4ee5\u53ca\u4f60\u521a\u521a\u5728NEMU\u4e2d\u5b9e\u73b0\u7684\u65b0\u6307\u4ee4, \u8fd9\u56db\u90e8\u5206\u5185\u5bb9\u53c8\u6709\u4ec0\u4e48\u8054\u7cfb?</p> <p>\u5982\u679c\u4f60\u4e0d\u662f\u8111\u888b\u8db3\u591f\u7075\u5149, \u8fd8\u662f\u4e0d\u8981\u773c\u7741\u7741\u5730\u76ef\u7740\u4ee3\u7801\u770b\u4e86, \u7406\u89e3\u7a0b\u5e8f\u7684\u7ec6\u8282\u884c\u4e3a\u8fd8\u662f\u8981\u4ece\u72b6\u6001\u673a\u89c6\u89d2\u5165\u624b. </p>"},{"location":"ysyx/pa/pa3/pa3.html#_7","title":"\u4e8b\u4ef6\u5206\u53d1","text":""},{"location":"ysyx/pa/pa3/pa3.html#_8","title":"\u6062\u590d\u4e0a\u4e0b\u6587","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4ece\u52a04\u64cd\u4f5c\u770bCISC\u548cRISC</p> <p>\u4e8b\u5b9e\u4e0a, \u81ea\u9677\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u5f02\u5e38\u7c7b\u578b. \u6709\u4e00\u79cd\u6545\u969c\u7c7b\u5f02\u5e38, \u5b83\u4eec\u8fd4\u56de\u7684PC\u548c\u89e6\u53d1\u5f02\u5e38\u7684PC\u662f\u540c\u4e00\u4e2a, \u4f8b\u5982\u7f3a\u9875\u5f02\u5e38, \u5728\u7cfb\u7edf\u5c06\u6545\u969c\u6392\u9664\u540e, \u5c06\u4f1a\u91cd\u65b0\u6267\u884c\u76f8\u540c\u7684\u6307\u4ee4\u8fdb\u884c\u91cd\u8bd5, \u56e0\u6b64\u5f02\u5e38\u8fd4\u56de\u7684PC\u65e0\u9700\u52a04. \u6240\u4ee5\u6839\u636e\u5f02\u5e38\u7c7b\u578b\u7684\u4e0d\u540c, \u6709\u65f6\u5019\u9700\u8981\u52a04, \u6709\u65f6\u5019\u5219\u4e0d\u9700\u8981\u52a0.</p> <p>\u8fd9\u65f6\u5019, \u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\u4e86: \u51b3\u5b9a\u8981\u4e0d\u8981\u52a04\u7684, \u662f\u786c\u4ef6\u8fd8\u662f\u8f6f\u4ef6\u5462? CISC\u548cRISC\u7684\u505a\u6cd5\u6b63\u597d\u76f8\u53cd, CISC\u90fd\u4ea4\u7ed9\u786c\u4ef6\u6765\u505a, \u800cRISC\u5219\u4ea4\u7ed9\u8f6f\u4ef6\u6765\u505a. \u601d\u8003\u4e00\u4e0b, \u8fd9\u4e24\u79cd\u65b9\u6848\u5404\u6709\u4ec0\u4e48\u53d6\u820d? \u4f60\u8ba4\u4e3a\u54ea\u79cd\u66f4\u5408\u7406\u5462? \u4e3a\u4ec0\u4e48?     </p> </li> </ul> <p>\u5728\u505a\u4e0a\u9762\u7684\u4e00\u5806\u4e1c\u897f\u7684\u65f6\u5019\uff0c\u770b\u7684\u8fd8\u662f\u300aRISC-V\u4f53\u7cfb\u7ed3\u6784\u7f16\u7a0b\u4e0e\u5b9e\u73b0\u300b\u548c\u624b\u518c\uff0c\u4e24\u8005\u6df7\u8d77\u6765\uff0c\u5c31\u5bf9\u4e2d\u65ad\u3001\u5f02\u5e38\u3001\u7cfb\u7edf\u8c03\u7528\u6655\u4e86\u3002</p> <p>\u4f46\u662f\u51b7\u9759\u4e4b\u540e\uff0c\u53d1\u73b0\u5176\u5b9e\u5c31\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff08\u5f02\u5e38\u7684\u4e00\u79cd\uff09\uff0c\u5c31\u8fd9\u4e48\u7b80\u5355\u3002\u6574\u4f53\u6d41\u7a0b\u8fd8\u662f\u633a\u6e05\u6670\u3002\u591a\u8bfb\u51e0\u904d\u8bb2\u4e49\u3002</p> <pre><code> //asm volatile(\"li a7, -1; ecall\");\n asm volatile(\"li a7, 11; ecall\");\n</code></pre> <p>\u53ea\u662f\u8d4b\u4e2a\u503c\uff0c\u548cmcause \u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</p>"},{"location":"ysyx/pa/pa3/pa3.html#-etrace","title":"\u5f02\u5e38\u5904\u7406\u7684\u8e2a\u8ff9 - etrace","text":"<p>\u5904\u7406\u5668\u629b\u51fa\u5f02\u5e38\u4e5f\u53ef\u4ee5\u53cd\u6620\u7a0b\u5e8f\u6267\u884c\u7684\u884c\u4e3a, \u56e0\u6b64\u6211\u4eec\u4e5f\u53ef\u4ee5\u8bb0\u5f55\u5f02\u5e38\u5904\u7406\u7684\u8e2a\u8ff9(exception trace). \u4f60\u4e5f\u8bb8\u8ba4\u4e3a\u5728CTE\u4e2d\u901a\u8fc7<code>printf()</code>\u8f93\u51fa\u4fe1\u606f\u4e5f\u53ef\u4ee5\u8fbe\u5230\u7c7b\u4f3c\u7684\u6548\u679c, \u4f46\u8fd9\u4e00\u65b9\u6848\u548c\u5728NEMU\u4e2d\u5b9e\u73b0\u7684etrace\u8fd8\u662f\u6709\u5982\u4e0b\u533a\u522b:</p> <ul> <li>\u6253\u5f00etrace\u4e0d\u6539\u53d8\u7a0b\u5e8f\u7684\u884c\u4e3a(\u5bf9\u7a0b\u5e8f\u6765\u8bf4\u662f\u975e\u4fb5\u5165\u5f0f\u7684): \u4f60\u5c06\u6765\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9bbug, \u5f53\u4f60\u5c1d\u8bd5\u63d2\u5165\u4e00\u4e9b<code>printf()</code>\u4e4b\u540e, bug\u7684\u884c\u4e3a\u5c31\u4f1a\u53d1\u751f\u53d8\u5316. \u5bf9\u4e8e\u8fd9\u6837\u7684bug, etrace\u8fd8\u662f\u53ef\u4ee5\u5e2e\u52a9\u4f60\u8fdb\u884c\u8bca\u65ad, \u56e0\u4e3a\u5b83\u662f\u5728NEMU\u4e2d\u8f93\u51fa\u7684, \u4e0d\u4f1a\u6539\u53d8\u7a0b\u5e8f\u7684\u884c\u4e3a.</li> <li>etrace\u4e5f\u4e0d\u53d7\u7a0b\u5e8f\u884c\u4e3a\u7684\u5f71\u54cd: \u5982\u679c\u7a0b\u5e8f\u5305\u542b\u4e00\u4e9b\u81f4\u547d\u7684bug\u5bfc\u81f4\u65e0\u6cd5\u8fdb\u5165\u5f02\u5e38\u5904\u7406\u51fd\u6570, \u90a3\u5c31\u65e0\u6cd5\u5728CTE\u4e2d\u8c03\u7528<code>printf()</code>\u6765\u8f93\u51fa; \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b, etrace\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c</li> </ul> <p>\u4e8b\u5b9e\u4e0a, QEMU\u548cSpike\u4e5f\u5b9e\u73b0\u4e86\u7c7b\u4f3cetrace\u7684\u529f\u80fd, \u5982\u679c\u5728\u4e0a\u9762\u8fd0\u884c\u7684\u7cfb\u7edf\u8f6f\u4ef6\u53d1\u751f\u9519\u8bef, \u5f00\u53d1\u8005\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u529f\u80fd\u5feb\u901f\u5730\u8fdb\u884cbug\u7684\u5b9a\u4f4d\u548c\u8bca\u65ad.</p> <p>\u5b9e\u73b0\u7684trace \u4e0d\u5e94\u8be5\u7528printf\uff1f</p> <p>printf\u4f1a\u6539\u53d8\u7a0b\u5e8f\u7684\u884c\u4e3a\uff1f\u5237\u65b0\u7f13\u51b2\u533a\uff1f</p> <p>\u591a\u770b\u770b\u4e00\u4e9bblog\u6709\u8bb2\u8fc7\u8fd9\u4e2a\u95ee\u9898\u3002</p> <ul> <li> <p>\u5fc5\u7b54\u9898</p> <p>\u5fc5\u7b54\u9898(\u9700\u8981\u5728\u5b9e\u9a8c\u62a5\u544a\u4e2d\u56de\u7b54) - \u7406\u89e3\u7a7f\u8d8a\u65f6\u7a7a\u7684\u65c5\u7a0b</p> <p>\u4ece<code>yield test</code>\u8c03\u7528<code>yield()</code>\u5f00\u59cb, \u5230\u4ece<code>yield()</code>\u8fd4\u56de\u7684\u671f\u95f4, \u8fd9\u4e00\u8d9f\u65c5\u7a0b\u5177\u4f53\u7ecf\u5386\u4e86\u4ec0\u4e48? \u8f6f(AM, <code>yield test</code>)\u786c(NEMU)\u4ef6\u662f\u5982\u4f55\u76f8\u4e92\u534f\u52a9\u6765\u5b8c\u6210\u8fd9\u8d9f\u65c5\u7a0b\u7684? \u4f60\u9700\u8981\u89e3\u91ca\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\u7684\u6bcf\u4e00\u5904\u7ec6\u8282, \u5305\u62ec\u6d89\u53ca\u7684\u6bcf\u4e00\u884c\u6c47\u7f16\u4ee3\u7801/C\u4ee3\u7801\u7684\u884c\u4e3a, \u5c24\u5176\u662f\u4e00\u4e9b\u6bd4\u8f83\u5173\u952e\u7684\u6307\u4ee4/\u53d8\u91cf. \u4e8b\u5b9e\u4e0a, \u4e0a\u6587\u7684\u5fc5\u7b54\u9898\"\u7406\u89e3\u4e0a\u4e0b\u6587\u7ed3\u6784\u4f53\u7684\u524d\u4e16\u4eca\u751f\"\u5df2\u7ecf\u6db5\u76d6\u4e86\u8fd9\u8d9f\u65c5\u7a0b\u4e2d\u7684\u4e00\u90e8\u5206, \u4f60\u53ef\u4ee5\u628a\u5b83\u7684\u56de\u7b54\u5305\u542b\u8fdb\u6765.</p> <p>\u522b\u88ab\"\u6bcf\u4e00\u884c\u4ee3\u7801\"\u5413\u5230\u4e86, \u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u5c31\u5927\u7ea650\u884c\u4ee3\u7801, \u8981\u5b8c\u5168\u7406\u89e3\u900f\u5f7b\u5e76\u4e0d\u662f\u4e0d\u53ef\u80fd\u7684. \u6211\u4eec\u4e4b\u6240\u4ee5\u8bbe\u7f6e\u8fd9\u9053\u5fc5\u7b54\u9898, \u662f\u4e3a\u4e86\u5f3a\u8feb\u4f60\u7406\u89e3\u6e05\u695a\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u6bcf\u4e00\u5904\u7ec6\u8282. \u8fd9\u4e00\u7406\u89e3\u662f\u5982\u6b64\u91cd\u8981, \u4ee5\u81f3\u4e8e\u5982\u679c\u4f60\u7f3a\u5c11\u5b83, \u63a5\u4e0b\u6765\u4f60\u9762\u5bf9bug\u51e0\u4e4e\u662f\u675f\u624b\u65e0\u7b56.</p> <pre><code>Context *simple_trap(Event ev, Context *ctx) {                   \n  switch(ev.event) {                                             \n    case EVENT_IRQ_TIMER:                                        \n      putch('t'); break;\n    case EVENT_IRQ_IODEV:                                        \n      putch('d'); break;                                         \n    case EVENT_YIELD:                                            \n      putch('y'); break;                                         \n    default:                                                     \n      panic(\"Unhandled event\"); break;\n  }\n  return ctx;\n}\n\nvoid hello_intr() {\n  printf(\"Hello, AM World @ \" __ISA__ \"\\n\");\n  printf(\"  t = timer, d = device, y = yield\\n\");\n  io_read(AM_INPUT_CONFIG);\n  iset(1);\n  while (1) {\n    //for (volatile int i = 0; i &lt; 10000000; i++) ;\n    for (volatile int i = 0; i &lt; 1000; i++) ;\n    yield();\n  }\n}\n// abstarct-machine/tests/am-tests/src/tests/intr.c\n\nCASE('i', hello_intr, IOE, CTE(simple_trap));\n// am-kernels/tests/am-tests/src/main.c\n\n#define IOE ({ ioe_init();  })\n#define CTE(h) ({ Context *h(Event, Context *); cte_init(h); })\n#define VME(f1, f2) ({ void *f1(int); void f2(void *); vme_init(f1, f2); })\n#define MPE ({ mpe_init(entry); })\n\nextern void (*entry)();\n\n#define CASE(id, entry_, ...) \\                                                                                           \n  case id: { \\\n    void entry_(); \\\n    entry = entry_; \\\n    __VA_ARGS__; \\\n    entry_(); \\\n    break; \\\n  }\n\n// am-kernels/tests/am-tests/include/amtest.h\n</code></pre> <p>\u5176\u5b9e\u5f88\u597d\u7406\u89e3\u7684\uff0c\u4ece main \u51fd\u6570\u8c03\u7528 <code>ioe_init()</code> \u548c <code>cte_init()</code> \u5f00\u59cb\uff0c\u4e00\u6b65\u6b65\u5230\u5e95\u5c42\uff0c\u914d\u5408\u7740\u672c\u8bb2\u7684\u5404\u8282\u9898\u76ee\u5c31\u80fd\u5f88\u597d\u7684\u7406\u89e3\u3002</p> <ol> <li> <p><code>cte_init()</code> \u76f8\u5173\u521d\u59cb\u5316</p> <p>\u5c06 <code>simple_trap</code> \u4f5c\u4e3a\u4f20\u5165\u4f5c\u4e3a <code>handle</code> \u4e5f\u5c31\u662f\u4e4b\u540e <code>__am_irq_handle</code> \u8981\u4f7f\u7528\u7684\u3002</p> <pre><code>static Context* (*user_handler)(Event, Context*) = NULL;\n\nContext* __am_irq_handle(Context *c) {\n  if (user_handler) {                      \n    Event ev = {0};\n    switch (c-&gt;mcause) {\n      // always in machine mode\n      case 0xb:\n            if(c-&gt;GPR1 == -1) {\n                 ev.event = EVENT_YIELD; break;\n            } \n      default: ev.event = EVENT_ERROR; break;\n    }\n\n    c = user_handler(ev, c);\n    assert(c != NULL);\n  }\n\n  return c;\n}\n\nextern void __am_asm_trap(void);\n\nbool cte_init(Context*(*handler)(Event, Context*)) {\n  // initialize exception entry\n  asm volatile(\"csrw mtvec, %0\" : : \"r\"(__am_asm_trap));\n\n  // register event handler\n  user_handler = handler;\n\n  return true;\n}\n\nContext *kcontext(Area kstack, void (*entry)(void *), void *arg) {\n  return NULL;\n}\n\nvoid yield() {\n #ifdef __riscv_e\n   asm volatile(\"li a5, -1; ecall\");\n #else\n   //asm volatile(\"li a7, -1; ecall\");\n   // pass the difftest\n   asm volatile(\"li a7, 11; ecall\");\n #endif\n }\n</code></pre> </li> <li> <p>\u67e5\u770b <code>ftrace</code> \u548c <code>abstract-machine/am/src/riscv/nemu/trap.S</code> \u6e05\u695a\u6d41\u7a0b \uff08\u4ec5\u5173\u6ce8\u4e3b\u8981\u63a7\u5236\u6d41\uff09</p> <pre><code> 16 0x8000000c:  call [_trm_init@0x80001030]\n 17 0x80001040:    call [main@0x80000e48]                                  \n 19 0x80000f54:        call [ioe_init@0x800010e4]\n ...\n 26 0x8000113c:         ret [ioe_init]\n 27 0x80000f60:        call [cte_init@0x80001400]\n 28 0x8000141c:         ret [cte_init]\n 29 0x80000f64:        call [hello_intr@0x8000076c]\n...\n163 0x800007a0:            call [iset@0x8000142c]\n164 0x8000142c:            ret [iset]\n165 0x800007c8:            call [yield@0x80001420]\n166 0x800014d4:              call [__am_irq_handle@0x80001370]\n167 0x800013c8:                call [simple_trap@0x80000690]\n168 0x8000071c:                  call [putch@0x80001018]\n169 0x80001020:                  ret [putch]\n170 0x80000730:                ret [simple_trap]\n171 0x800013d8:              ret [__am_irq_handle]\n172 0x800014d4:            call [__am_irq_handle@0x80001370]\n173 0x800013c8:              call [simple_trap@0x80000690]\n174 0x8000071c:                call [putch@0x80001018]\n175 0x80001020:                   ret [putch]\n176 0x80000730:                 ret [simple_trap]\n177 0x800013d8:               ret [__am_irq_handle]\n</code></pre> <p>\u4e3b\u8981\u662f\u5173\u6ce8 <code>iset(1)</code> \u4e4b\u540e\u7684\u4e0d\u65ad\u5faa\u73af\uff08163 - 177\uff09</p> <p>\u9996\u5148\u8f6f\u4ef6 \u4e3b\u52a8\u8c03\u7528 <code>yield</code> \u8fdb\u5165\u81ea\u9677\uff0c<code>riscv</code>\u4e2d \uff1a<code>asm volatile(\"li a7, -1; ecall\");</code></p> <pre><code>#define ECALL(dnpc) {\\\n     bool success; \\\n     dnpc = (isa_raise_intr(isa_reg_str2val(\"a7\", &amp;success), s-&gt;pc)); \\\n }\n\n  INSTPAT(\"0000000 00000 00000 000 00000 11100 11\", ecall  , I, ECALL(s-&gt;dnpc);\n           IFDEF(CONFIG_ETRACE,etrace_log();));\n\n//inst.c\n\n// ECALL\nword_t isa_raise_intr(word_t NO, vaddr_t epc) {\n    cpu.csr.mepc = epc;       \n    cpu.csr.mcause = NO;\n\n    cpu.csr.mstatus &amp;= ~(1 &lt;&lt; 7);\n\n    // \u628a\u5f02\u5e38\u53d1\u751f\u524d\u7684 MIE \u5b57\u6bb5 \u4fdd\u5b58\u5230 MPIE \u5b57\u6bb5 \n    cpu.csr.mstatus |= ((cpu.csr.mstatus &amp; (1 &lt;&lt; 3)) &lt;&lt; 4);\n    // \u4fdd\u5b58\u5904\u7406\u5668\u6a21\u5f0f MPP bit[9:8] 0b11 M mode\n    cpu.csr.mstatus |= ((1 &lt;&lt; 11) + (1 &lt;&lt; 12));\n    // \u5173\u95ed\u672c\u5730\u4e2d\u65ad MIE = 0\n    cpu.csr.mstatus &amp;= ~(1 &lt;&lt; 3);\n\n    return cpu.csr.mtvec;\n}   \n</code></pre> <p>\u5f02\u5e38\u76f8\u5e94\u6d41\u7a0b\uff1a</p> <pre><code>SR[mepc] &lt;- PC\nSR[mcause] &lt;- \u4e00\u4e2a\u63cf\u8ff0\u5931\u8d25\u539f\u56e0\u7684\u53f7\u7801\nPC &lt;- SR[mtvec]\n</code></pre> <pre><code>// Arch-dependent processor context\n typedef struct Context Context;\n\n // An event of type @event, caused by @cause of pointer @ref\n typedef struct {\n   enum {\n     EVENT_NULL = 0,\n     EVENT_YIELD, EVENT_SYSCALL, EVENT_PAGEFAULT, EVENT_ERROR,\n     EVENT_IRQ_TIMER, EVENT_IRQ_IODEV,\n   } event;\n   uintptr_t cause, ref;\n   const char *msg;\n } Event;\n// abstract-machine/am/include/am.h\n\nstruct Context {\n   // TODO: fix the order of these members to match trap.S\n   uintptr_t gpr[NR_REGS];\n   uintptr_t mcause, mstatus, mepc;                                                                                        \n   void *pdir;\n };\n// abstract-machine/am/include/arch/riscv.h\n\nContext* (*user_handler)(Event, Context*)\n</code></pre> <p>\u4fdd\u5b58/\u914d\u7f6e\u76f8\u5173\u5bc4\u5b58\u5668\u540e\uff0c\u4fdd\u5b58\u597d\u5f53\u524d\u7684\u4e0a\u4e0b\u6587\uff08\u4e8b\u4ef6 + \u5bc4\u5b58\u5668\uff09\u3002</p> <p>\u627e\u5230\u5f02\u5e38\u5165\u53e3\u5730\u5740\uff1a<code>__am_asm_trap</code>\u3002\u4e0b\u4e00\u6b65\u7684\u8f6c\u79fb\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>__am_asm_trap:\n    ...\n  jal __am_irq_handle \n    ...\n  mret\n</code></pre> <p><code>__am_asm_trap</code> \u5c06 <code>csr</code> \u548c <code>gpr</code> \u4f5c\u4e3a\u4e0a\u4e0b\u6587\u4f20\u7ed9 <code>__am_irq_handle</code> \uff0c</p> <p><code>__am_irq_handle</code> \u901a\u8fc7\u5224\u65ad\u7a0b\u5e8f\u4e0a\u4e0b\u6587\uff08<code>mcause</code>\uff09\uff0c\u5224\u65ad\u51fa\u54ea\u4e00\u4e8b\u4ef6\uff08EVENT_YIELD\uff09 </p> <p>\u4e4b\u540e\u4ea4\u7ed9 <code>user_handler</code> (<code>simple_trap</code>)\uff08\u8f6f\u4ef6\u5c42\uff09\u6839\u636e\u5177\u4f53\u4e8b\u4ef6\u8fdb\u884c\u5b9e\u9645\u7684\u5f02\u5e38\u5904\u7406\u3002</p> <pre><code>Context *simple_trap(Event ev, Context *ctx) {\n  switch(ev.event) {\n    case EVENT_IRQ_TIMER:\n      putch('t'); break;\n    case EVENT_IRQ_IODEV:\n      putch('d'); break;\n    case EVENT_YIELD:\n      putch('y'); break;\n    default:\n      panic(\"Unhandled event\"); break;\n  }\n  return ctx;\n}   \n</code></pre> <p>\u505a\u5230PA3.2\u521a\u5f00\u59cb\u9047\u5230\u6b7b\u5faa\u73af\uff0c\u56de\u6765\u5199\uff1a</p> <p>\u8fd9\u91cc\u6211\u4e00\u76f4\u6ca1\u60f3\u660e\u767d\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u7684\u662f\u7cfb\u7edf\u8c03\u7528\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u5728\u54ea\u91cc\u5199\u90a3\u4e2a epc+4;</p> <p>\u634b\u4e86\u4e00\u4e0b\u8c03\u7528\u903b\u8f91\uff1a</p> <p><code>yield</code> -&gt; <code>cte_init</code> -&gt; <code>yield</code> -&gt; <code>ecall</code> -&gt; <code>__am_asm_trap</code> -&gt; <code>__am_irq_handle</code> -&gt; <code>user_handler</code> -&gt;<code>simple_trap</code> -&gt; <code>mret</code></p> <p>\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u8981\u4e48\u4f60\u5728\u8fd4\u56de\u4e4b\u524d\u52a0\uff0c\u8981\u4e48\u4f60\u5728\u8fd4\u56de\u7684\u65f6\u5019\u52a0\uff0c\u81ea\u5df1\u80fd\u63a7\u5236\u5373\u53ef\u3002</p> <p>\u73b0\u5728\u6211\u4e3a\u4e86\u80fd\u8fc7 <code>difftest</code>\uff0c\u6240\u4ee5\u6211\u52a0\u5728\u4e86<code>__am_irq_handler</code> \u5904</p> <p>\u5904\u7406\u5b8c\u6210\u540e\uff0c\u518d\u5c06\u65b0\u7684 <code>csr</code> \u548c <code>gpr</code> \u5b58\u56de\u53bb\u3002</p> <p>\u5b8c\u6210\u4e4b\u540e\uff0c\u6062\u590d\u4e0a\u4e0b\u6587\uff1a<code>mret</code> </p> <pre><code>#define MRET { \\\n    cpu.csr.mstatus &amp;= ~(1&lt;&lt;3); \\\n    cpu.csr.mstatus |= ((cpu.csr.mstatus &amp; (1 &lt;&lt; 7)) &gt;&gt; 4); \\\n    cpu.csr.mstatus &amp;= ~((1&lt;&lt;11)+(1&lt;&lt;12)); \\\n    cpu.csr.mstatus |= (1&lt;&lt;7); \\\n    s-&gt;dnpc = cpu.csr.mepc; \\\n}\n</code></pre> <p>\u8fd9\u6837\u4e00\u6b21\u5f02\u5e38\u54cd\u5e94\u5c31\u5b8c\u6210\u4e86\u3002\u4e4b\u540ewhile(1) \u5faa\u73af\u91cd\u590d\u4e0a\u9762\u8fc7\u7a0b\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u8c13\u662f\u4f53\u73b0\u4e86\u4ec0\u4e48\u53eb\u62bd\u8c61\u3002</p> <p>\uff08OS\uff1f\uff09\u8f6f\u4ef6(main.c/hello_str) &lt;--&gt; AM (cte) \u5c01\u88c5\u7684 <code>gpr</code> \u3001<code>csr</code>  &lt;--&gt; \u786c\u4ef6CPU NEMU </p> <p>\u200b                                                \u67b6\u6784\u65e0\u5173                                         \u67b6\u6784\u76f8\u5173          </p> <p>\u5bf9\u4e8e\u5f02\u5e38\uff0c\u5173\u952e\u5728\u4e8e AM \u7684 <code>__am_irq_handle</code> \u5982\u4f55\u505a\u597d\u4e2d\u95f4\u4eba\u5c06\u4e0a\u4e0b\u6587 <code>event</code> \u3001<code>gpr</code>\u3001<code>csr</code> \u5982\u4f55\u4f20\u7ed9\u4e24\u65b9\uff0c\u800c\u4e0d\u662f\u8ba9\u8f6f\u4ef6\u76f4\u63a5\u63a7\u5236 CPU\u3002\u4e00\u65b9\u5b9e\u9645\u54cd\u5e94\uff08AM \u4e4b\u4e0a\u7684\u8f6f\u4ef6\uff09\uff0c\u4e00\u65b9 CPU \u6307\u4ee4\u6267\u884c\u3002\uff08AM \u4e4b\u4e0b\u7684\u786c\u4ef6  \uff09</p> </li> </ol> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#pa32","title":"PA3.2 \u7528\u6237\u7a0b\u5e8f\u548c\u7cfb\u7edf\u8c03\u7528","text":""},{"location":"ysyx/pa/pa3/pa3.html#_9","title":"\u6700\u7b80\u5355\u7684\u64cd\u4f5c\u7cfb\u7edf","text":"<p>bug\uff1a\u5b9e\u73b0\u7684 <code>printf</code> \u6709\u95ee\u9898\uff0c\u7ed9\u7684 <code>buf</code> \u592a\u5c0f\u4e86\uff0c\u5bfc\u81f4 <code>StackOverflow</code>\uff0c\u5f71\u54cd\u4e86 PC \u5f02\u5e38\u3002</p> <p>\u8fd9\u91cc\u91cd\u65b0\u7ed9\u4e3a <code>buf[2048]</code></p> <ul> <li> <p>\u9605\u8bfb</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u4e2aC\u7a0b\u5e8f</p> <p>\u4f60\u4e5f\u8bb8\u6709\u70b9\u4e0d\u6562\u76f8\u4fe1, \u4f46\u6846\u67b6\u4ee3\u7801\u7684.c\u548c.h\u6587\u4ef6\u65e0\u7591\u8574\u542b\u7740\u8fd9\u94c1\u4e00\u822c\u7684\u4e8b\u5b9e, \u751a\u81f3\u8fde\u7f16\u8bd1\u65b9\u5f0f\u4e5f\u770b\u4e0d\u51fa\u4ec0\u4e48\u7279\u6b8a\u7684\u5730\u65b9. GNU/Linux\u4e5f\u662f\u8fd9\u6837: \u5982\u679c\u4f60\u9605\u8bfb\u5b83\u7684\u6e90\u4ee3\u7801, \u5c31\u4f1a\u53d1\u73b0GNU/Linux\u53ea\u4e0d\u8fc7\u662f\u4e2a\u5de8\u5927\u7684C\u7a0b\u5e8f\u800c\u5df2.</p> <p>\u90a3\u4e48\u548c\u4e00\u822c\u7684C\u7a0b\u5e8f\u76f8\u6bd4, \u64cd\u4f5c\u7cfb\u7edf\u7a76\u7adf\u6709\u4f55\u7279\u6b8a\u4e4b\u5904\u5462? \u5b8c\u6210PA3\u4e4b\u540e, \u76f8\u4fe1\u4f60\u5c31\u4f1a\u7565\u77e5\u4e00\u4e8c\u4e86.</p> <p>\u786e\u5b9e\uff01\u4e00\u6837\u7684\u914d\u7f6e\u4e86\u94fe\u63a5\u6587\u4ef6\uff0c<code>stext</code> \u6bb5\u3001<code>start_kernel</code> \u3002\u53ea\u662f\u6ca1\u6709\u6807\u51c6\u7684 <code>main</code> \u51fd\u6570\u5165\u53e3\u3002</p> <p>\u53ea\u4e0d\u8fc7\u5b83\u7684\u6743\u9650\u66f4\u9ad8\uff0c\u62bd\u8c61\u4e86\u786c\u4ef6\u8d44\u6e90\uff0c\u5411\u4e0a\u63d0\u4f9b\u4e86 \u63a5\u53e3\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_10","title":"\u52a0\u8f7d\u7b2c\u4e00\u4e2a\u7528\u6237\u7a0b\u5e8f","text":"<p>\u5b9e\u73b0loader\u7684\u4efb\u52a1\uff1a</p> <ul> <li> <p>\u53ef\u6267\u884c\u6587\u4ef6\u5728\u54ea\u91cc?</p> <p>\u4f4d\u4e8e<code>ramdisk.img</code>\u4e2d\uff0c<code>navy-apps</code> \u88ab\u653e\u5728\u5730\u5740 <code>0x83000000</code> \u5904\u3002</p> </li> <li> <p>\u4ee3\u7801\u548c\u6570\u636e\u5728\u53ef\u6267\u884c\u6587\u4ef6\u7684\u54ea\u4e2a\u4f4d\u7f6e?</p> <p><code>.data .text .bss</code> <code>section</code>\u4f5c\u4e3a\u94fe\u63a5\u89c6\u89d2\u7684\u4ee3\u7801\u548c\u6570\u636e</p> <p>\u7a0b\u5e8f\u88c5\u8f7d\u7684\u89c6\u89d2\uff0c\u5728\u8fd9\u51e0\u4e2a <code>segment</code> \u4e2d\uff0c\u8981\u88c5\u8f7d\u7684\u5177\u4f53\u66f4\u8981\u770b <code>PT_LOAD</code></p> <pre><code> Section to Segment mapping:\n  Segment Sections...\n   00     .riscv.attributes \n   01     .text .rodata \n   02     .data .sdata .sbss .bss \n   03  \n</code></pre> </li> <li> <p>\u4ee3\u7801\u548c\u6570\u636e\u6709\u591a\u5c11?</p> <p>\u5404\u4e2a <code>segment</code> \u7684 <code>FileSize</code></p> <pre><code>Program Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  RISCV_ATTRIBUT 0x0068c7 0x00000000 0x00000000 0x0002e 0x00000 R   0x1\n  LOAD           0x000000 0x83000000 0x83000000 0x05a47 0x05a47 R E 0x1000\n  LOAD           0x006000 0x83006000 0x83006000 0x0089c 0x008d8 RW  0x1000\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10\n</code></pre> </li> <li> <p>\"\u6b63\u786e\u7684\u5185\u5b58\u4f4d\u7f6e\"\u5728\u54ea\u91cc?</p> <p><code>[VirtAddr, VirtAddr + MemSiz)</code></p> </li> </ul> <p>Q1:</p> <p>\u6211\u4eec\u5148\u8bf4\u660e\u4e00\u4e0b\u7528\u6237\u7a0b\u5e8f\u662f\u4ece\u54ea\u91cc\u6765\u7684. \u7528\u6237\u7a0b\u5e8f\u8fd0\u884c\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a, \u7531\u4e8e\u8fd0\u884c\u65f6\u73af\u5883\u7684\u5dee\u5f02, \u6211\u4eec\u4e0d\u80fd\u628a\u7f16\u8bd1\u5230AM\u4e0a\u7684\u7a0b\u5e8f\u653e\u5230\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c. \u4e3a\u6b64, \u6211\u4eec\u51c6\u5907\u4e86\u4e00\u4e2a\u65b0\u7684\u5b50\u9879\u76eeNavy-apps, \u4e13\u95e8\u7528\u4e8e\u7f16\u8bd1\u51fa\u64cd\u4f5c\u7cfb\u7edf\u7684\u7528\u6237\u7a0b\u5e8f. </p> <p>\u8bb2\u4e49...</p> <p>\u53ef\u6267\u884c\u6587\u4ef6\u4f4d\u4e8e <code>ramdisk</code> \u504f\u79fb\u4e3a0\u5904, \u8bbf\u95ee\u5b83\u5c31\u53ef\u4ee5\u5f97\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282.</p> <p>\u4e3a\u4e86\u56de\u7b54\u5269\u4e0b\u7684\u95ee\u9898, \u6211\u4eec\u9996\u5148\u9700\u8981\u4e86\u89e3\u53ef\u6267\u884c\u6587\u4ef6\u662f\u5982\u4f55\u7ec4\u7ec7\u7684. \u4f60\u5e94\u8be5\u5df2\u7ecf\u5728\u8bfe\u5802\u4e0a\u5b66\u4e60\u8fc7ELF\u6587\u4ef6\u683c\u5f0f\u4e86, \u5b83\u9664\u4e86\u5305\u542b\u7a0b\u5e8f\u672c\u8eab\u7684\u4ee3\u7801\u548c\u9759\u6001\u6570\u636e\u4e4b\u5916, \u8fd8\u5305\u62ec\u4e00\u4e9b\u7528\u6765\u63cf\u8ff0\u5b83\u4eec\u7684\u4fe1\u606f, \u5426\u5219\u6211\u4eec\u8fde\u4ee3\u7801\u548c\u6570\u636e\u4e4b\u95f4\u7684\u5206\u754c\u7ebf\u5728\u54ea\u91cc\u90fd\u4e0d\u77e5\u9053. </p> <p>\u8fd9\u4e9b\u4fe1\u606f\u63cf\u8ff0\u4e86\u53ef\u6267\u884c\u6587\u4ef6\u7684\u7ec4\u7ec7\u5f62\u5f0f, \u4e0d\u540c\u7ec4\u7ec7\u5f62\u5f0f\u5f62\u6210\u4e86\u4e0d\u540c\u683c\u5f0f\u7684\u53ef\u6267\u884c\u6587\u4ef6, \u4f8b\u5982Windows\u4e3b\u6d41\u7684\u53ef\u6267\u884c\u6587\u4ef6\u662fPE(Portable Executable)\u683c\u5f0f, \u800cGNU/Linux\u4e3b\u8981\u4f7f\u7528ELF(Executable and Linkable Format)\u683c\u5f0f. \u56e0\u6b64\u4e00\u822c\u60c5\u51b5\u4e0b, \u4f60\u4e0d\u80fd\u5728Windows\u4e0b\u628a\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u62f7\u8d1d\u5230GNU/Linux\u4e0b\u6267\u884c, \u53cd\u4e4b\u4ea6\u7136. ELF\u662fGNU/Linux\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6807\u51c6\u683c\u5f0f, \u8fd9\u662f\u56e0\u4e3aGNU/Linux\u9075\u5faaSystem V ABI(Application Binary Interface).</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6211\u4eec\u63d0\u5230\u4e86\u4ee3\u7801\u548c\u6570\u636e\u90fd\u5728\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u9762, \u4f46\u5374\u6ca1\u6709\u63d0\u5230\u5806(heap)\u548c\u6808(stack). \u4e3a\u4ec0\u4e48\u5806\u548c\u6808\u7684\u5185\u5bb9\u6ca1\u6709\u653e\u5165\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u9762? \u90a3\u7a0b\u5e8f\u8fd0\u884c\u65f6\u523b\u7528\u5230\u7684\u5806\u548c\u6808\u53c8\u662f\u600e\u4e48\u6765\u7684? AM\u7684\u4ee3\u7801\u662f\u5426\u80fd\u7ed9\u4f60\u5e26\u6765\u4e00\u4e9b\u542f\u53d1?</p> <p>\u5806\u548c\u6808\u5b9e\u9645\u662f\u5728\u5185\u5b58\u4e2d\u5212\u5206\u51fa\u6765\u7684\u3002\u800c\u8fd9\u4e2a\u5927\u5c0f\u4e5f\u662f OS \u53ef\u4ee5\u8c03\u63a7\u7684\uff0c\u5c31\u50cf <code>FreeRTOS</code> \u4e2d\u5212\u5206\u51fa\u591a\u5c11\u7684\u6700\u591a\u6808\u7a7a\u95f4\u548c\u5806\u7a7a\u95f4\uff1a</p> <p></p> <p>\u770b AM \u7684\u4ee3\u7801\uff0c\u7531\u8d77\u59cb\u7684\u94fe\u63a5\u6587\u4ef6\u6765\u6307\u5b9a\u3002\u6808\u5728\u5185\u5b58\u4e2d\u5360\u4e86 0x8000, \u4e5f\u5c31\u662f 32KB\uff0c\u901a\u8fc7\u6808\u6307\u9488\u4f7f\u7528\u3002</p> <p>\u800c\u5806\u5b83\u6307\u5b9a\u4e86\u5f00\u59cb\uff0c\u5b9e\u9645\u5206\u914d\u9700\u8981\u901a\u8fc7 <code>malloc</code> \u548c <code>free</code>\uff0c\u5728AM \u4e2d\uff0c\u5bf9\u5c31\u662f\u4e00\u4e2aheap\u7ed3\u6784\u4f53\u53d8\u91cf\uff0c\u4e5f\u662f\u6307\u5b9a\u5f00\u5934\u7ed3\u5c3e\u3002</p> <p><code>_start</code> -&gt; \u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u5806\u6808 \u521d\u59cb\u5316 -&gt; <code>main</code> \u51fd\u6570</p> <pre><code>_stack_top = ALIGN(0x1000);\n. = _stack_top + 0x8000;\n_stack_pointer = .;\nend = .;\n_end = .;\n_heap_start = ALIGN(0x1000);\n// linker.ld\n\n_start: \n  mv s0, zero\n  la sp, _stack_pointer\n  jal _trm_init\n\n// riscv/nemu/start.S\n\n./abstract-machine/am/src/platform/nemu/trm.c:Area heap = RANGE(&amp;_heap_start, PMEM_END);\n</code></pre> <p>\u5bf9\u6bd4 AM \u548c \u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f \u88f8\u673a \u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u533a\u522b\u3002</p> <p>\u5176\u4e2d\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u533a\u522b\u5c31\u662f\uff0c\u6211\u7528\u6237\u7a0b\u5e8f\u80fd\u5426\u76f4\u63a5\u64cd\u4f5c\u5185\u5b58\u7b49\u786c\u4ef6\u8d44\u6e90\uff0c\u8fd9\u91cc\u5bf9\u4e8e\u73a9\u5d4c\u5165\u5f0f\u7684\u6765\u8bf4\uff0c\u8fd8\u662f\u6bd4\u8f83\u597d\u7406\u89e3\u7684\u3002</p> <p>\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u5c31\u76f8\u5f53\u4e8e\u5728 AM \u4e0a\u52a0\u4e86\u4e00\u5c42\u62bd\u8c61\uff0c\u7531AM \u4f5c\u4e3a OS \u7684\u8fd0\u884c\u65f6\u73af\u5883\u652f\u6301\uff08\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\uff09\uff0c\u7528\u6237\u7a0b\u5e8f\u8981\u4f7f\u7528\u786c\u4ef6\u8d44\u6e90\uff1a\u5806\u548c\u6808\uff0c\u5c31\u5f97\u4f7f\u7528 OS \u63d0\u4f9b\u7684\u5404\u4e2a\u63a5\u53e3\u3002\u4e00\u822c\u6765\u8bf4\u7528\u6237\u4e0d\u80fd\u6539\uff0c\u4f46\u662f\u5d4c\u5165\u5f0f\u7684 RTOS \u8d34\u8fd1\u786c\u4ef6\u5c31\u53ef\u4ee5\u3002</p> <p>GPT:</p> <p>\u7a0b\u5e8f\u8fd0\u884c\u65f6\u523b\u7528\u5230\u7684\u5806\u548c\u6808\u662f\u600e\u4e48\u6765\u7684\uff1f</p> <ul> <li>\u6808\uff1a\u5f53\u7a0b\u5e8f\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u6808\u7a7a\u95f4\u3002\u8fd9\u4e2a\u6808\u7a7a\u95f4\u7684\u5927\u5c0f\u901a\u5e38\u5728\u521b\u5efa\u7ebf\u7a0b\u65f6\u786e\u5b9a\uff0c\u4f46\u4e5f\u53ef\u4ee5\u7531\u64cd\u4f5c\u7cfb\u7edf\u52a8\u6001\u8c03\u6574\u3002</li> <li>\u5806\uff1a\u5806\u7a7a\u95f4\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7ba1\u7406\u7684\u3002\u5f53\u7a0b\u5e8f\u8bf7\u6c42\u5206\u914d\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4ece\u5806\u4e2d\u5206\u914d\u4e00\u5757\u5185\u5b58\u7ed9\u7a0b\u5e8f\u3002\u5f53\u7a0b\u5e8f\u91ca\u653e\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u5185\u5b58\u5f52\u8fd8\u5230\u5806\u4e2d\uff0c\u4f9b\u4ee5\u540e\u4f7f\u7528\u3002</li> </ul> <p>\u626f\u8fdc\u4e86\uff0c\u81f3\u4e8e\u8bf4\u4e3a\u4ec0\u4e48\u4e0d\u5c06\u5806\u6808\u653e\u5165\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\uff0c</p> <p>\u9996\u5148\uff0c\u6808\u7684\u5927\u5c0f\u901a\u5e38\u5728\u7f16\u8bd1\u65f6\u786e\u5b9a\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u65f6\u6839\u636e\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u9700\u8981\u52a8\u6001\u53d8\u5316\u3002\u800c\u4e14\uff0c\u6808\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u6808\u7a7a\u95f4\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u9884\u5148\u5b9a\u4e49\u3002</p> <p>\u5173\u4e8e\u5806\uff0c\u5806\u662f\u7a0b\u5e8f\u8fd0\u884c\u65f6\u52a8\u6001\u5206\u914d\u7684\uff0c\u5176\u5927\u5c0f\u548c\u4f7f\u7528\u60c5\u51b5\u5b8c\u5168\u53d6\u51b3\u4e8e\u7a0b\u5e8f\u7684\u8fd0\u884c\u903b\u8f91\uff0c\u4e5f\u5c31\u662f\u7a0b\u5e8f\u5458\u7684\u81ea\u5df1\u5199\u7684\uff08AM \u5c31\u5b9a\u4e49\u4e86\u5404\u5f00\u59cb\uff0c\u5177\u4f53\u600e\u4e48\u4f7f\u7528\u770b\u8fd0\u884c\u5728\u5176\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\uff09\u3002\u6240\u4ee5\uff0c\u7531\u4e8e\u5806\u7684\u4f7f\u7528\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u8981\u662f\u5f88\u5927\u600e\u4e48\u529e\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u7f16\u8bd1\u65f6\u5c31\u786e\u5b9a\u5176\u5927\u5c0f\u548c\u5185\u5bb9\u653e\u5165\u53ef\u6267\u884c\u6587\u4ef6\u4e2d</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u8bc6\u522b\u4e0d\u540c\u683c\u5f0f\u7684\u53ef\u6267\u884c\u6587\u4ef6?</p> <p>\u5982\u679c\u4f60\u5728GNU/Linux\u4e0b\u6267\u884c\u4e00\u4e2a\u4eceWindows\u62f7\u8fc7\u6765\u7684\u53ef\u6267\u884c\u6587\u4ef6, \u5c06\u4f1a\u62a5\u544a\"\u683c\u5f0f\u9519\u8bef\". \u601d\u8003\u4e00\u4e0b, GNU/Linux\u662f\u5982\u4f55\u77e5\u9053\"\u683c\u5f0f\u9519\u8bef\"\u7684?</p> <p>ELF\u7684\u6587\u4ef6\u5934\uff1aELF\u9b54\u6570\u3001\u6587\u4ef6\u673a\u5668\u5b57\u8282\u957f\u5ea6\u3001\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\u3001\u7248\u672c\u3001\u8fd0\u884c\u5e73\u53f0\u3001ABI\u7248\u672c\u3001\u786c\u4ef6\u5e73\u53f0\u7b49\u7b49</p> </li> </ul> <p>ELF\u6587\u4ef6\u63d0\u4f9b\u4e86\u4e24\u4e2a\u89c6\u89d2\u6765\u7ec4\u7ec7\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6,</p> <ul> <li>\u4e00\u4e2a\u662f\u9762\u5411\u94fe\u63a5\u8fc7\u7a0b\u7684section\u89c6\u89d2, \u8fd9\u4e2a\u89c6\u89d2\u63d0\u4f9b\u4e86\u7528\u4e8e\u94fe\u63a5\u4e0e\u91cd\u5b9a\u4f4d\u7684\u4fe1\u606f(\u4f8b\u5982\u7b26\u53f7\u8868);</li> <li>\u53e6\u4e00\u4e2a\u662f\u9762\u5411\u6267\u884c\u7684segment\u89c6\u89d2, \u8fd9\u4e2a\u89c6\u89d2\u63d0\u4f9b\u4e86\u7528\u4e8e\u52a0\u8f7d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4fe1\u606f. </li> </ul> <p>\u901a\u8fc7<code>readelf</code>\u547d\u4ee4, \u6211\u4eec\u8fd8\u53ef\u4ee5\u770b\u5230section\u548csegment\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb: \u4e00\u4e2asegment\u53ef\u80fd\u75310\u4e2a\u6216\u591a\u4e2asection\u7ec4\u6210, \u4f46\u4e00\u4e2asection\u53ef\u80fd\u4e0d\u88ab\u5305\u542b\u4e8e\u4efb\u4f55segment\u4e2d.</p> <p>\u4ee5\u524d\u4e00\u76f4\u8ba4\u4e3asection \u548c segment \u90fd\u662f\u4e00\u4e2a\u4e1c\u897f...</p> <p>\u6240\u4ee5\u5e38\u8bf4\u7684\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u662f section</p> <p></p> <p></p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4f7f\u7528<code>readelf</code>\u67e5\u770b\u4e00\u4e2aELF\u6587\u4ef6\u7684\u4fe1\u606f, \u4f60\u4f1a\u770b\u5230\u4e00\u4e2asegment\u5305\u542b\u4e24\u4e2a\u5927\u5c0f\u7684\u5c5e\u6027, \u5206\u522b\u662f<code>FileSiz</code>\u548c<code>MemSiz</code>, \u8fd9\u662f\u4e3a\u4ec0\u4e48? \u518d\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b, \u4f60\u4f1a\u53d1\u73b0<code>FileSiz</code>\u901a\u5e38\u4e0d\u4f1a\u5927\u4e8e\u76f8\u5e94\u7684<code>MemSiz</code>, \u8fd9\u53c8\u662f\u4e3a\u4ec0\u4e48?</p> <p></p> <ul> <li><code>p_filesz</code>\uff1a\u8868\u793a\u4e0d\u540c\u7684 <code>segment</code> \u5728 ELF \u6587\u4ef6\u4e2d\u7684\u5927\u5c0f\uff0c\u5373\u5b9e\u9645\u4ece\u6587\u4ef6\u4e2d\u52a0\u8f7d\u5230\u5185\u5b58\u7684\u5b57\u8282\u6570\u3002</li> <li><code>p_memsz</code>\uff1a\u8868\u793a\u4e0d\u540c\u7684 <code>segment</code> \u5728\u5185\u5b58\u4e2d\u7684\u5927\u5c0f\uff0c\u5373\u5728\u5185\u5b58\u4e2d\u4e3a\u8be5\u6bb5\u5206\u914d\u7684\u603b\u5b57\u8282\u6570\u3002</li> </ul> <p>\u81f3\u4e8e\u8bf4\u4e3a\u4ec0\u4e48 <code>FileSiz</code> \u4e0d\u5927\u4e8e <code>MemSiz</code> \uff0c\u6211\u89c9\u5f97\u662f\u4e3a\u4e86\u5185\u5b58\u5bf9\u9f50\u3002\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u8981\u6c42\u5185\u5b58\u6bb5\u7684\u5927\u5c0f\u548c\u5730\u5740\u6309\u7167\u7279\u5b9a\u7684\u5bf9\u9f50\u8fb9\u754c\u6765\u5206\u914d\uff0c\u5373\u4f7f\u6587\u4ef6\u4e2d\u7684\u5b9e\u9645\u6570\u636e\u4e0d\u9700\u8981\u8fd9\u4e48\u591a\u7a7a\u95f4\u3002\u56e0\u6b64\uff0c<code>p_memsz</code> \u53ef\u80fd\u6bd4 <code>p_filesz</code> \u5927\uff0c\u4ee5\u6ee1\u8db3\u5185\u5b58\u5bf9\u9f50\u7684\u8981\u6c42\u3002</p> <p>\u66f4\u591a\u9605\u8bfb\uff1a</p> <ol> <li>The compiler, assembler, linker, loader and process address space tutorial - hacking the process of building programs using C language: notes and illustrations (tenouk.com)</li> <li>ELF specification</li> <li><code>man 5 elf</code></li> </ol> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6e05\u96f6?</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u5c06 <code>[VirtAddr + FileSiz, VirtAddr + MemSiz)</code> \u5bf9\u5e94\u7684\u7269\u7406\u533a\u95f4\u6e05\u96f6?</p> <p></p> <p>\u4e5f\u4f53\u73b0\u4e86\u4e3a\u4ec0\u4e48 <code>.bss section</code> \u6ca1\u6709\u5185\u5bb9\u3002</p> </li> </ul> <p>loader\u7684\u5de5\u4f5c\u5411\u6211\u4eec\u5c55\u73b0\u51fa\u4e86\u7a0b\u5e8f\u7684\u6700\u4e3a\u539f\u59cb\u7684\u72b6\u6001: \u6bd4\u7279\u4e32! \u52a0\u8f7d\u7a0b\u5e8f\u5176\u5b9e\u5c31\u662f\u628a\u8fd9\u4e00\u6beb\u4e0d\u8d77\u773c\u7684\u6bd4\u7279\u4e32\u653e\u7f6e\u5728\u6b63\u786e\u7684\u4f4d\u7f6e, </p> <p>\u4f46\u8fd9\u5176\u4e2d\u53c8\u6298\u5c04\u51fa\"\u5b58\u50a8\u7a0b\u5e8f\"\u7684\u5212\u65f6\u4ee3\u601d\u60f3: \u5f53\u64cd\u4f5c\u7cfb\u7edf\u5c06\u63a7\u5236\u6743\u4ea4\u7ed9\u5b83\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u628a\u5b83\u89e3\u91ca\u6210\u6307\u4ee4\u5e76\u9010\u6761\u6267\u884c. loader\u8ba9\u8ba1\u7b97\u673a\u7684\u751f\u547d\u5468\u671f\u7a81\u7834\u7a0b\u5e8f\u7684\u8fb9\u754c: \u4e00\u4e2a\u7a0b\u5e8f\u7ed3\u675f\u5e76\u4e0d\u610f\u5473\u7740\u8ba1\u7b97\u673a\u505c\u6b62\u5de5\u4f5c, \u8ba1\u7b97\u673a\u5c06\u7ec8\u5176\u4e00\u751f\u5c65\u884c\u6267\u884c\u7a0b\u5e8f\u7684\u4f7f\u547d.</p> <ul> <li> <p>\u5b9e\u73b0SYS_yield\u7cfb\u7edf\u8c03\u7528</p> <p>\u4f60\u9700\u8981:</p> <ol> <li>\u5728<code>abstract-machine/am/include/arch/</code>\u76ee\u5f55\u4e0b\u7684\u76f8\u5e94\u5934\u6587\u4ef6\u4e2d\u5b9e\u73b0\u6b63\u786e\u7684<code>GPR?</code>\u5b8f, \u8ba9\u5b83\u4eec\u4ece\u4e0a\u4e0b\u6587<code>c</code>\u4e2d\u83b7\u5f97\u6b63\u786e\u7684\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u5bc4\u5b58\u5668.</li> <li>\u6dfb\u52a0<code>SYS_yield</code>\u7cfb\u7edf\u8c03\u7528.</li> <li>\u8bbe\u7f6e\u7cfb\u7edf\u8c03\u7528\u7684\u8fd4\u56de\u503c.</li> </ol> <p>\u91cd\u65b0\u8fd0\u884cdummy\u7a0b\u5e8f, \u5982\u679c\u4f60\u7684\u5b9e\u73b0\u6b63\u786e, \u4f60\u4f1a\u770b\u5230dummy\u7a0b\u5e8f\u53c8\u89e6\u53d1\u4e86\u4e00\u4e2a\u53f7\u7801\u4e3a<code>0</code>\u7684\u7cfb\u7edf\u8c03\u7528. \u67e5\u770b<code>nanos-lite/src/syscall.h</code>, \u4f60\u4f1a\u53d1\u73b0\u5b83\u662f\u4e00\u4e2a<code>SYS_exit</code>\u7cfb\u7edf\u8c03\u7528. \u8fd9\u8bf4\u660e\u4e4b\u524d\u7684<code>SYS_yield</code>\u5df2\u7ecf\u6210\u529f\u8fd4\u56de, \u89e6\u53d1<code>SYS_exit</code>\u662f\u56e0\u4e3adummy\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5, \u51c6\u5907\u9000\u51fa\u4e86.</p> </li> <li> <p>\u5b9e\u73b0SYS_exit\u7cfb\u7edf\u8c03\u7528</p> <p>\u4f60\u9700\u8981\u5b9e\u73b0<code>SYS_exit</code>\u7cfb\u7edf\u8c03\u7528, \u5b83\u4f1a\u63a5\u6536\u4e00\u4e2a\u9000\u51fa\u72b6\u6001\u7684\u53c2\u6570. \u4e3a\u4e86\u65b9\u4fbf\u6d4b\u8bd5, \u6211\u4eec\u76ee\u524d\u5148\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\u8c03\u7528<code>halt()</code>. \u5b9e\u73b0\u6210\u529f\u540e, \u518d\u6b21\u8fd0\u884cdummy\u7a0b\u5e8f, \u4f60\u4f1a\u770b\u5230<code>HIT GOOD TRAP</code>\u7684\u4fe1\u606f.</p> </li> </ul> <p>\u5b8c\u6210\u8fd9\u4e24\u4e2a\u540e\uff0c\u4e86\u89e3\u786c\u4ef6\u548c\u8f6f\u4ef6\u7684\u5bf9\u4e8e\u4e00\u4e2a\u76f8\u5bf9\u5b8c\u6574\u7684\u4e8b\u4ef6\u7684\u5904\u7406\u6d41\u7a0b\uff0c\u4e5f\u5bf9\u8f6f\u4ef6\u548c\u786c\u4ef6\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u6709\u4e86\u4e00\u70b9\u4e86\u89e3\u3002</p> <p>\u8fdb\u4e00\u6b65\u4f53\u73b0\u5230\u5185\u5bb9\u4e0a\u5c31\u662f \u7cfb\u7edf\u8c03\u7528\u548c\u5f02\u5e38\uff0c\u518d\u8fdb\u4e00\u6b65\u5c31\u662fOS \u548c \u5904\u7406\u5668\u3002</p> <ol> <li> <p>\u5173\u4e8eOS\u5185\u6838\u6001\u548c\u7528\u6237\u6001\uff0c\u4ec0\u4e48 U \u6a21\u5f0f\u548c M \u6a21\u5f0f</p> <p>\u521d\u770b\u8bb2\u4e49\u63d0\u5230\u8fd9\u51e0\u4e2a\u5185\u5bb9\u611f\u89c9\u5f88\u5bb9\u6613\u6df7\u6dc6\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e5f\u662f\u8fc7\u4e8e\u7ea0\u7ed3\u540d\u8bcd\u6982\u5ff5\u3001\u6ca1\u6709\u7406\u6e05\u8f6f\u4ef6\u786c\u4ef6\u5982\u4f55\u534f\u540c\u7684\u8868\u73b0\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u7a0b\u5e8f\u63a7\u5236\u786c\u4ef6\u7684\u5b89\u5168\u6027\u95ee\u9898\uff0c\u524d\u8f88\u4eec\u5e0c\u671b\u8fd9\u4e2a\u63a7\u5236\u786c\u4ef6\u7684\u7a0b\u5e8f\u4e0d\u90a3\u4e48\u968f\u4fbf\u88ab\u5165\u4fb5\uff0c\u4e5f\u5c31\u662f\u5e0c\u671b\u5c06\u64cd\u4f5c\u7cfb\u7edf\u4fdd\u62a4\u8d77\u6765\uff0c</p> <p>\u6240\u4ee5\u524d\u8f88\u4eec\u5904\u4e8e\u5b89\u5168\u7684\u8003\u8651\uff0c\u8fdb\u800c\u63d0\u51fa\u4e86 \u7b49\u7ea7\u68ee\u4e25\u7684\u5236\u5ea6\uff0c\u4e5f\u5c31\u662f\u5728\u786c\u4ef6\u5904\u7406\u5668\u4e0a\uff0c\u51fa\u73b0\u4e86\u5f3a\u5927\u7684\u4fdd\u62a4\u673a\u5236\u3002\u4e5f\u5c31\u662f\u6211\u4eec\u73b0\u5728\u770b\u5230\u7684\u5982\uff1a<code>riscv32</code> \u7684\u673a\u5668\u6a21\u5f0f(M-mode)\u3001 \u76d1\u63a7\u8005\u6a21\u5f0f(S-mode)\u3001\u7528\u6237\u6a21\u5f0f(U-mode)\uff1bi386\u548cMIPS\u4e5f\u662f\u7c7b\u4f3c\u7684\u6982\u5ff5\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u662f\u4e3a\u4e86\u5c06\u4e0d\u540c\u5730\u4f4d\u7684\u7a0b\u5e8f\uff08\u8f6f\u4ef6\uff09\u533a\u5206\u5f00\u6765\uff0c\u5904\u7406\u5668\uff08\u786c\u4ef6\uff09\u6765\u5e2e\u5fd9\u4e86\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u6709\u9ad8\u7279\u6743\u7ea7\u7684\u7a0b\u5e8f\u624d\u80fd\u53bb\u6267\u884c\u4e00\u4e9b\u7279\u522b\u7684\u64cd\u4f5c\u4e86\uff08\u786c\u4ef6\u7cfb\u7edf\u7ea7\u522b\u7684\u64cd\u4f5c\uff09</p> <p>\u8fd8\u662f\u60f3\u60f3\uff0c\u7a0b\u5e8f\u600e\u4e48\u63a7\u5236\u786c\u4ef6\uff1f\u6307\u4ee4\uff01\u5bf9\uff01</p> <p>\u8fdb\u4e00\u6b65\uff0c\u4ece\u4e00\u4e2a\u7279\u6743\u7ea7\u4f4e\u7684\u7a0b\u5e8f\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7279\u6743\u7ea7\u9ad8\u7684\u7a0b\u5e8f\u4e2d\uff0c\u8f6f\u4ef6\u548c\u786c\u4ef6\u600e\u4e48\u4ea4\u4e92\u662f\u600e\u4e48\u77e5\u9053\u7684\uff1f\u8ba1\u7b97\u673a\u80fd\u770b\u61c2\u7684\u53ea\u6709\u6307\u4ee4\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u6761\u6307\u4ee4\uff0c\u4ece\u4f4e\u7ea7\u522b\u7684\u7a0b\u5e8f\u8fdb\u5165\u9ad8\u7ea7\u522b\u7a0b\u5e8f\uff0c\u90a3\u5c31\u662f\u81ea\u9677\u6307\u4ee4\u3002\u8f6f\u4ef6\u8fdb\u5165\u4e86\uff0c\u786c\u4ef6\u4e5f\u4e0d\u80fd\u843d\u4e0b\uff0c\u4e5f\u5c31\u662f\u5904\u7406\u5668\u6a21\u5f0f\u5f97\u53d1\u751f\u53d8\u5316\u4e86\u3002\uff08User mode -&gt; machine mode\uff09\uff08\u8f6f\u4ef6\u3001\u786c\u4ef6\u8fdb\u5165\u6ca1\u6709\u5148\u540e\u3002\u8f6f\u4ef6\u7684\u5730\u4f4d\u672c\u6765\u5c31\u662f\u786c\u4ef6\u4fdd\u62a4\u673a\u5236\u7ed9\u7684\u3002\uff09</p> <p>\u6240\u4ee5\u518d\u56de\u5934\u770b\u770b\u8fd9\u51e0\u4e2a\u6982\u5ff5\uff0c\u4e5f\u5c31\u5f88\u597d\u7406\u89e3\u4e86\u3002</p> <p>\u7528\u6237\u7a0b\u5e8f\u8c03\u7528 <code>ecall</code>\uff0c\u79bb\u5f00\u672c\u7a0b\u5e8f\uff0c\u8fdb\u5165\u6bd4\u7528\u6237\u7a0b\u5e8f\u9ad8\u7ea7\u7684\u7a0b\u5e8f\uff1aOS\uff08\u8fd9\u6837\u5b50\u8bf4\u53ef\u80fd\u4e0d\u592a\u597d\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e5f\u8fd0\u884c\u5728 OS \u4e0a\uff0c\u4f46\u662f\u4e3a\u4e86\u7406\u89e3\uff09\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684 kernel \u5c42\u3001user\u5c42\uff1b</p> <p>\u5904\u7406\u5668\u6a21\u5f0f\u4e5f\u5207\u6362\u5230\u66f4\u9ad8\u7ea7\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f U -&gt;M\u3002</p> </li> <li> <p>\u90a3\u7cfb\u7edf\u8c03\u7528\u548c\u5f02\u5e38\u4e5f\u662f\u7c7b\u4f3c\u7684</p> <p>\u8fd9\u4e8c\u8005\u4f5c\u4e3a\u4e8b\u4ef6\uff0c\u80af\u5b9a\u662f\u9700\u8981\u786c\u4ef6\u548c\u8f6f\u4ef6\u6765\u8fdb\u884c\u534f\u540c\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5\uff0c\u4e5f\u5c31\u4e0d\u8981\u975e\u60f3\u7740\u5c06\u786c\u4ef6\u548c\u8f6f\u4ef6\u5212\u5206\u8fd9\u4e48\u5f00\u3002</p> <p>\u5173\u4e8e\u4e8c\u8005\u5b9a\u4e49\uff0c\u4ee5 <code>risc-v spec</code> \u4e3a\u51c6\uff0c\u56e0\u4e3a\u5b83\u5212\u5206\u7684\u6bd4\u8f83\u5177\u4f53\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u4f5c\u4e3a\u5f02\u5e38\u7684\u4e00\u79cd\uff0c\u7cfb\u7edf\u8c03\u7528\u5141\u8bb8\u8f6f\u4ef6\u4e3b\u52a8\u901a\u8fc7\u7279\u6b8a\u6307\u4ee4\u8bf7\u6c42\u66f4\u9ad8\u7279\u6743\u6a21\u5f0f\u7684\u7a0b\u5e8f\u6240\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u4e5f\u5c31\u662fOS \u63d0\u4f9b\u7684\u670d\u52a1\u3002</p> <p>\u90a3\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u662f\u4e0d\u662f\u8981\u7528\u90a3\u4e2a\u81ea\u9677\u6307\u4ee4 <code>ecall</code> \u4e86\uff1fyes\u3002</p> <p>\u4f46\u662f\u4e3a\u4ec0\u4e48\u53eb <code>exception call</code> \u5462\uff1f\u4e0d\u76f4\u63a5\u53eb <code>syscall</code> \u7cfb\u7edf\u8c03\u7528\u4f5c\u4e3a <code>ecall</code> \u6700\u4e3a\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u4f46\u4e5f\u4e0d\u80fd\u53ea\u7ed9\u5b83\u5e72\u6d3b\u3002</p> <p><code>ecall</code> \u6307\u4ee4\u4e4b\u524d\u53eb <code>scall</code>\uff0c\u5305\u62ec\u73b0\u5728 Linux \u6e90\u7801\u91cc\u90fd\u7528\u7684\u662f <code>scall</code>\uff0c\u540e\u6765\u6539\u4e3a\u4e86 <code>ecall</code>\u3002\u539f\u56e0\u662f\u8be5\u6307\u4ee4\u4e0d\u4ec5\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd8\u53ef\u4ee5\u63d0\u4f9b\u66f4\u901a\u7528\u5316\u7684\u529f\u80fd\u3002</p> <p>\u8fd9\u4e5f\u5c31\u662f\u6211\u4eec\u5728PA \u91cc\u5199\u7684\u8fd9\u4e24\u79cd\u4e8b\u4ef6\u4e86\u3002</p> <pre><code>static Context* do_event(Event e, Context* c) {\n  switch (e.event) {\n    case EVENT_YIELD: printf(\"event: yield.\\n\"); break;\n    case EVENT_SYSCALL: do_syscall(c); break;\n    default: panic(\"Unhandled event ID = %d\", e.event);\n  }\n  return c;\n}\n</code></pre> <p>\u5c3d\u7ba1 \u7cfb\u7edf\u8c03\u7528 \u548c \u81ea\u9677<code>YIELD</code> \u90fd\u662f\u901a\u8fc7\u81ea\u9677\u6307\u4ee4\u6765\u5b9e\u73b0\u7684\uff0c\u4f46\u662f \u7cfb\u7edf\u8c03\u7528 \u548c \u81ea\u9677<code>YIELD</code> \u89e6\u53d1\u7684\u662f\u4e0d\u540c\u7684\u4e8b\u4ef6</p> <p>\u867d\u7136\u5185\u90e8\u7684\u5b9e\u73b0\u4e00\u6837\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u533a\u5206\u5f00\u6765\u7684\u3002\u600e\u4e48\u533a\u5206\uff1f\u90a3\u5c31\u5f97\u533a\u5206\u51fa\u7cfb\u7edf\u8c03\u7528\u53f7\u548c\u4e4b\u524d\u7684\u5f02\u5e38\u53f7\u8fd9\u4e24\u4e2a\u4e1c\u897f\u4e86\u3002</p> <p><code>mcause</code> \u5bc4\u5b58\u5668\u5b58\u653e\u7684\u662f\u5f02\u5e38\u539f\u56e0\uff08\u5f02\u5e38\u53f7\uff09\uff0c<code>a7</code> \u5b58\u653e\u7684\u662f\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u8fd9\u4e24\u4e2a\u662f\u4e0d\u4e00\u6837\u7684\u4e1c\u897f\u3002</p> <p>\u5bf9\u5e94\u7684\u51fd\u6570\u529f\u80fd\uff0c\u4e5f\u5c31\u662f<code>__am_irq_handle</code>\u8d1f\u8d23\u8bc6\u522b\u54ea\u4e2a\u5f02\u5e38\u53f7\uff0c<code>do_event</code> \u8d1f\u8d23\u8bc6\u522b\u54ea\u4e2a\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>\u8fd9\u91cc\u548c\u5b9e\u9645\u7684 <code>mcause</code> \u5bc4\u5b58\u5668\u76f8\u6bd4\u662f\u4e0d\u4e00\u6837\u7684\uff0cPA \u8fd9\u91cc\u4e3a\u4e86\u7b80\u5316\uff0c\u6240\u4ee5\u4e00\u76f4\u90fd\u662f<code>mcause</code> \u5b58 M-mode \uff0c\u4e5f\u5c31\u662f csr \u7684bit[9:8]\uff0c\u4e00\u76f4\u90fd\u662f11(0xb)\u3002</p> <p>\u5b9e\u9645 spec \u5e76\u4e0d\u4f1a\u5c06 YIELD \u4f5c\u4e3a\u4e00\u4e2a\u5f02\u5e38\u7c7b\u578b\uff0c\u4f46\u4f5c\u4e3a\u4f5c\u4e3a\u4e8b\u4ef6\u6211\u4eec\u8fd8\u662f\u5f97\u533a\u5206\u3002</p> <p>riscv spec \u89c4\u5b9a\u5f02\u5e38\u4e09\u79cd\uff1a\u540c\u6b65\u5f02\u5e38\uff08\u6307\u4ee4\u548c\u6570\u636e\u5f02\u5e38\uff09\u3001\u5f02\u6b65\u5f02\u5e38\uff08\u4e2d\u65ad\uff09\u3001\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>\u53ea\u662f\u6211\u4eec\u76ee\u524d\u8fd8\u6ca1\u6709\u5b9e\u73b0\u4e2d\u65ad\uff0c\u8fd8\u672a\u8fdb\u4e00\u6b65\u533a\u5206\uff0cPA4\u518d\u8bf4\u3002</p> <ul> <li> <p><code>YIELD</code>\u4e8b\u4ef6</p> <ul> <li>\u76f4\u63a5\u8fdb\u5165\u5904\u7406\u5668\u7684M\u6a21\u5f0f\uff0c<code>YIELD</code> \u4e8b\u4ef6\u901a\u5e38\u662f\u4e00\u79cd\u4e2d\u65ad\u6216\u4fe1\u53f7\uff0c\u7528\u4e8e\u89e6\u53d1\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u5668\uff0c\u8ba9\u5f53\u524d\u8fdb\u7a0b\u653e\u5f03 CPU\u3002</li> <li>\u5728 PA \u4e2d\uff0c\u6211\u4eec\u89c4\u5b9a \u5f53\u5904\u7406\u5668\u4e00\u76f4\u5904\u4e8e M mode\uff0c\u5e76\u4e14 <code>GPR1/a7</code> \u5bc4\u5b58\u5668\u7684\u503c\u4e3a <code>-1</code> \u65f6\uff0c\u89e6\u53d1 <code>YIELD</code> \u4e8b\u4ef6\u3002</li> <li>\u8fd9\u79cd\u4e8b\u4ef6\u901a\u5e38\u662f\u7531\u786c\u4ef6\u6216\u64cd\u4f5c\u7cfb\u7edf\u7684\u5176\u4ed6\u90e8\u5206\u89e6\u53d1\u7684\uff0c\u800c\u4e0d\u662f\u7531\u7528\u6237\u7a0b\u5e8f\u76f4\u63a5\u53d1\u8d77\u7684\u3002</li> </ul> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528\u4e8b\u4ef6\uff0c</p> <ul> <li>\u7cfb\u7edf\u8c03\u7528\u662f\u4e00\u79cd\u673a\u5236\uff0c\u4f5c\u4e3a \u81ea\u9677\u6307\u4ee4 \u6700\u4e3a\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u7531\u7528\u6237\u7a0b\u5e8f\u53d1\u8d77\uff0c\u663e\u5f0f\u8c03\u7528\uff0c\u5141\u8bb8\u7528\u6237\u7a7a\u95f4\u7684\u7a0b\u5e8f\u8bf7\u6c42\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u63d0\u4f9b\u7684\u670d\u52a1\u3002</li> <li>\u7cfb\u7edf\u8c03\u7528\u6839\u636e <code>GPR1/a7</code> \u7cfb\u7edf\u8c03\u7528\u53f7\u6267\u884c\u5404\u79cd\u64cd\u4f5c\uff0c\u5982\u6587\u4ef6\u64cd\u4f5c\u3002</li> </ul> </li> <li>\u4e8c\u8005\u5bf9\u6bd4 \uff08GPT\u603b\u7ed3\uff09<ul> <li>\u4e0d\u540c\u7684\u89e6\u53d1\u673a\u5236\uff1a<ul> <li><code>SYS_yield</code> \u7cfb\u7edf\u8c03\u7528\u662f\u7531\u7528\u6237\u7a0b\u5e8f\u663e\u5f0f\u8c03\u7528\u7684\uff0c\u662f\u4e00\u79cd\u534f\u4f5c\u5f0f\u8c03\u5ea6\u7684\u65b9\u5f0f\u3002</li> <li><code>YIELD</code> \u4e8b\u4ef6\u53ef\u80fd\u662f\u7531\u786c\u4ef6\u4e2d\u65ad\u3001\u64cd\u4f5c\u7cfb\u7edf\u7684\u5176\u4ed6\u90e8\u5206\u6216\u7528\u6237\u7a0b\u5e8f\u7684\u67d0\u4e9b\u64cd\u4f5c\u9690\u5f0f\u89e6\u53d1\u7684\u3002</li> </ul> </li> <li>\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\uff1a<ul> <li><code>SYS_yield</code> \u7cfb\u7edf\u8c03\u7528\u901a\u5e38\u7528\u4e8e\u7a0b\u5e8f\u9700\u8981\u7b49\u5f85\u67d0\u4e9b\u8d44\u6e90\uff08\u5982 I/O \u64cd\u4f5c\uff09\u5b8c\u6210\u65f6\uff0c\u4e3b\u52a8\u8ba9\u51fa CPU\u3002</li> <li><code>YIELD</code> \u4e8b\u4ef6\u53ef\u80fd\u7528\u4e8e\u5904\u7406\u65f6\u949f\u4e2d\u65ad\u3001\u786c\u4ef6\u4e8b\u4ef6\u6216\u5176\u4ed6\u9700\u8981\u7acb\u5373\u8c03\u5ea6\u7684\u573a\u666f\u3002</li> </ul> </li> <li>\u7075\u6d3b\u6027\u548c\u63a7\u5236\uff1a<ul> <li>\u7cfb\u7edf\u8c03\u7528\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u7075\u6d3b\u548c\u53ef\u63a7\u7684\u65b9\u5f0f\u6765\u8bf7\u6c42\u64cd\u4f5c\u7cfb\u7edf\u670d\u52a1\uff0c\u5305\u62ec\u8fdb\u7a0b\u8c03\u5ea6\u3002</li> <li>\u4e8b\u4ef6\u9a71\u52a8\u7684 <code>YIELD</code> \u673a\u5236\u5219\u63d0\u4f9b\u4e86\u4e00\u79cd\u5feb\u901f\u54cd\u5e94\u7cfb\u7edf\u72b6\u6001\u53d8\u5316\u7684\u65b9\u5f0f\u3002</li> </ul> </li> </ul> </li> </ul> </li> </ol> <p>\u800c\u5bf9\u4e8e\u4e00\u4e2a\u5f02\u5e38\u53d1\u751f\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRISC-V \u5904\u7406\u5668\u6240\u6709\u7684\u5f02\u5e38\u90fd\u8981\u5728 M \u6a21\u5f0f\u4e0b\u5904\u7406\u3002</p> <p>\u800c\u5bf9\u4e8e\u89e6\u53d1\u5f02\u5e38\uff0c\u6211\u4eec\u662f\u901a\u8fc7\u6307\u4ee4 <code>ecall</code> \u6765\u8fdb\u884c\u7684\u3002\u6700\u4e3b\u8981\u7684\u76ee\u7684\u5c31\u662f\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u4e0d\u8fc7PA\u6ca1\u6709\u8fd9\u6837\u505a\uff0c\u6211\u4eec\u4e00\u76f4\u90fd\u662f\u8fd0\u884c M \u6a21\u5f0f\u4e0b\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\u6211\u4e0b\u9762\u5199\u7684\u521a\u597d\u5c31\u6709\u95ee\u9898\uff0c\u5c31\u662f\u6ca1\u6709\u7406\u89e3 PA \u4e00\u76f4\u8fd0\u884c M \u6a21\u5f0f\uff1bmcause \u548c \u5b58\u50a8\u7cfb\u7edf\u8c03\u7528\u53f7\u7684\u5bc4\u5b58\u5668 \u4e8c\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u7684\u6700\u597d\u4f8b\u5b50\uff1a</p> <p>dummy \u8c03\u7528\u6d41\u7a0b\uff1a</p> <ol> <li> <p>\u7528\u6237\u7a0b\u5e8fdummy\u8c03\u7528 <code>_syscall_</code> \u89e6\u53d1 syscall\uff08\u7cfb\u7edf\u8c03\u7528\u53f7\u4e3a1\uff09</p> <p><code>ecall</code>  \u8fdb\u884c\u5f02\u5e38\u54cd\u5e94\u3002\u8fdb\u5165 <code>__am_asm_trap</code> \u5c06 <code>csr</code> \u548c <code>gpr</code> \u4f5c\u4e3a\u4e0a\u4e0b\u6587\u4f20\u7ed9 <code>__am_irq_handle</code> \uff0c</p> <p><code>__am_irq_handle</code> \u901a\u8fc7\u5224\u65ad\u7a0b\u5e8f\u4e0a\u4e0b\u6587\uff08<code>mcause</code>\uff09\uff0c\u5224\u65ad\u51fa\u54ea\u4e00\u4e8b\u4ef6\uff08EVENT_YIELD\uff09 </p> <p>\u4e4b\u540e\u4ea4\u7ed9 <code>user_handler</code>\uff08\u8f6f\u4ef6\u5c42\uff09\u6839\u636e\u5177\u4f53\u4e8b\u4ef6\u8fdb\u884c\u5b9e\u9645\u7684\u5f02\u5e38\u5904\u7406\u3002</p> <pre><code>// \u6709\u95ee\u9898\uff1a\nContext* __am_irq_handle(Context *c) {\n  if (user_handler) {\n    Event ev = {0};\n    printf(\"aaaaaa%d\\n\", c-&gt;mcause);\n    switch (c-&gt;mcause) {\n      case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: case 8: case 9: \n          ev.event = EVENT_SYSCALL; c-&gt;mepc += 4; break;\n      case 11:               \n          ev.event = EVENT_YIELD; c-&gt;mepc += 4; break;\n      default: ev.event = EVENT_ERROR; break;\n    }                 \n    c = user_handler(ev, c);        \n    assert(c != NULL);    \n  }    \n  return c;\n}\n                                \n// \u6539\u52a8\u540e\uff1a\nContext* __am_irq_handle(Context *c) {\n    if (user_handler) {\n        Event ev = {0};\n        switch (c-&gt;mcause) {\n              case 0xb:\n              if (c-&gt;GPR1 == -1) { // YIELD\n                    ev.event = EVENT_YIELD; c-&gt;mepc += 4;\n                } else if (c-&gt;GPR1 &gt;= 0 &amp;&amp; c-&gt;GPR1 &lt;= 19){ // system call (include sys_yield)\n                  ev.event = EVENT_SYSCALL; c-&gt;mepc += 4;   \n              } else {\n                  printf(\"unknown type \");\n              }\n            break;\n        default: ev.event = EVENT_ERROR; break;\n    }\n                                \n    c = user_handler(ev, c);\n    assert(c != NULL);\n  }\n                                \n  return c;\n}\n\n\n//abstract-machine/am/src/riscv/nemu/cte.c\n// \u62bd\u8c61\u5c42\n</code></pre> <p><code>__am_irq_handle</code> \u5224\u65ad\u673a\u5668\u6240\u5728\u7684\u6a21\u5f0f\uff0c<code>NEMU</code> \u4e00\u76f4\u5904\u4e8eM-mode</p> <p>\u89e6\u53d1 \u7cfb\u7edf\u8c03\u7528\u53f71\uff1asys_yield\u3002</p> <p>\u73b0\u5728\u6709 OS \u4e86\uff0c\u8fdb\u800c\u8c03\u7528 <code>do_event()</code> \u5212\u5206\u51fa\u4e8b\u4ef6 \uff1a<code>EVENT_SYSCALL</code> </p> <pre><code>static Context* do_event(Event e, Context* c) {\n  switch (e.event) {\n    case EVENT_YIELD: printf(\"event: yield.\\n\"); break;                 \n    case EVENT_SYSCALL: do_syscall(c); break;\n    default: panic(\"Unhandled event ID = %d\", e.event);\n  }\n  return c;\n}\n// nanos-lite/src/irq.c\n// \n</code></pre> <pre><code>...\nint sys_yield() {\n    yield(); // CTE\u7684 yield\n    return 0;\n}\nvoid sys_exit(int code) {\n     halt(code);\n}\nvoid do_syscall(Context *c) {\n  uintptr_t a[4];\n  a[0] = c-&gt;GPR1; // a7\n  a[1] = c-&gt;GPR2; // a0\n  a[2] = c-&gt;GPR3; // a1\n  a[3] = c-&gt;GPR4; // a2\n                                \n  switch (a[0]) {\n    case SYS_exit: sys_exit(a[0]); break;\n    case SYS_yield: c-&gt;GPRx = sys_yield(); break;\n    default: panic(\"Unhandled syscall ID = %d\", a[0]);\n  }\n}   \n...\n//nanos-lite/src/syscall.c\n                                \n#ifndef __SYSCALL_H__\n#define __SYSCALL_H__\n                                \nenum {\n  SYS_exit,     \n...\n};  \n                                \n#endif\n// nanos-lite/src/syscall.h\n</code></pre> <p>\u5185\u90e8\u5b9e\u9645\u662f\u5728\u8c03\u7528\u81ea\u9677\u6307\u4ee4\u3002</p> </li> <li> <p>\u8c03\u7528\u81ea\u9677\u6307\u4ee4</p> <p>\u4fdd\u5b58 \u4e0a\u4e0b\u6587\uff0c\u7ee7\u7eed\u8c03\u7528 <code>__am_irq_handle</code>\uff0c\u89e6\u53d1 <code>cte</code> \u7684 case 11 -&gt; EVENT_YIELD</p> <p>\u8c03\u7528 <code>do_event</code> \uff0c\u89e6\u53d1 EVENT_YIELD \uff0c\u6253\u5370 <code>printf(\"event: yield.\\n\");</code></p> </li> <li> <p>\u4e0b\u4e00\u6b65\u8fd4\u56de\u9000\u51fa</p> <p>dummy \u5c31\u8c03\u7528\u4e86\u4e00\u6761\u6307\u4ee4\uff0c\u4e0b\u4e00\u6b65\u8be5\u8c03\u7528\u5e93\u7684\u9000\u51fa\uff1aexit\u4e86</p> <pre><code>#define SYS_yield 1\nextern int _syscall_(int, uintptr_t, uintptr_t, uintptr_t);      \nint main() { \n  return _syscall_(SYS_yield, 0, 0, 0);\n}\n                                \n// navy-apps/tests/dummy/dummy.c\n</code></pre> <pre><code>void halt(int code) {\n  nemu_trap(code);   \n                                    \n  // should not reach here\n  while (1);\n}\n//abstract-machine/am/src/platform/nemu/trm.c\n                                \n#if defined(__ISA_X86__)\n# define EXPECT_TYPE EM_386\n# define nemu_trap(code) asm volatile (\"int3\" : :\"a\"(code))\n#elif defined(__ISA_MIPS32__)\n# define EXPECT_TYPE \n# define nemu_trap(code) asm volatile (\"move $v0, %0; sdbbp\" : :\"r\"(code))\n#elif defined(__riscv)\n# define EXPECT_TYPE EM_RISCV\n# define nemu_trap(code) asm volatile(\"mv a0, %0; ebreak\" : :\"r\"(code))\n#elif defined(__ISA_LOONGARCH32R__)\n# define EXPECT_TYPE \n# define nemu_trap(code) asm volatile(\"move $a0, %0; break 0\" : :\"r\"(code))\n#elif\n# error unsupported ISA __ISA__\n#endif\n                                \n//abstract-machine/am/src/platform/nemu/include/nemu.h\n</code></pre> <p>\u5b9e\u9645\u4e0a\u89e6\u53d1\u7684\u662f 0 \u53f7\u7cfb\u7edf\u8c03\u7528\uff1aSYS_exit\u3002</p> <p>\u603b\u7ed3\uff1a\u81ea\u9677\u6307\u4ee4\u4e3a <code>ecall</code> \uff0c\u7cfb\u7edf\u8c03\u7528\u9700\u8981\u901a\u8fc7\u81ea\u9677\u6307\u4ee4  <code>ecall</code> \u6765\u5b9e\u73b0 \u4ece \u7528\u6237\u533a \u5230 \u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u533a</p> <ul> <li><code>EVENT_SYSCALL</code> -&gt; \u901a\u8fc7  \u5b9e\u73b0</li> </ul> </li> </ol>"},{"location":"ysyx/pa/pa3/pa3.html#_11","title":"\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u73af\u5883","text":"<p>\u8fd9\u90e8\u5206\u8bb2\u4e49\u611f\u89c9\u5199\u7684\u633a\u597d\u7684\uff1a\u53ef\u4ee5\u591a\u8bfb\u51e0\u904d</p>"},{"location":"ysyx/pa/pa3/pa3.html#_12","title":"\u7cfb\u7edf\u8c03\u7528","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>RISC-V\u7cfb\u7edf\u8c03\u7528\u53f7\u7684\u4f20\u9012</p> <p>\u5982\u679c\u4f60\u9009\u62e9\u7684\u662fRISC-V, \u4f60\u4f1a\u53d1\u73b0\u5b83\u5e76\u4e0d\u662f\u901a\u8fc7<code>a0</code>\u6765\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7. </p> <p>\u4e8b\u5b9e\u4e0a, \u6211\u4eec\u53c2\u8003\u4e86RISC-V Linux\u7684\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u4f20\u9012\u7684\u7ea6\u5b9a: \u5373\u5728RISC-V Linux\u4e0a\u4e5f\u662f\u901a\u8fc7\u8fd9\u4e2a\u5bc4\u5b58\u5668\u6765\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7\u7684. \u4f60\u89c9\u5f97RISC-V Linux\u4e3a\u4ec0\u4e48\u6ca1\u6709\u4f7f\u7528<code>a0</code>\u6765\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7\u5462?</p> <p>\u901a\u8fc7 <code>a7</code>  /  <code>a5</code> \u6765\u4f20\u9012</p> <pre><code>#ifdef __riscv_e\n#define GPR1 gpr[15] // a5\n#else\n#define GPR1 gpr[17] // a7\n#endif   \n#define GPR2 gpr[10] // a0\n#define GPR3 gpr[11] // a1\n#define GPR4 gpr[12] // a2\n#define GPRx gpr[10] // a0\n</code></pre> <p>\u731c\u6d4b\u662f\u548c\u51fd\u6570\u4f20\u53c2\uff1fRISC-V \u7684\u6574\u578b GPR\u8c03\u7528\u89c4\u8303\u5199\u5230\uff1a\u51fd\u6570\u7684\u524d8\u4e2a\u53c2\u6570\u7528\u5bc4\u5b58\u5668\uff1aa0~a7\u4f20\u9012\u3002\u591a\u7684\u7528\u6808\uff1b\u51fd\u6570\u8fd4\u56de\u53c2\u6570\u4fdd\u5b58\u5230a0\u548ca1\u5bc4\u5b58\u5668\uff1a</p> <p>\u56e0\u4e3a\u662f\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6240\u4ee5\u662f\u5728\u5bf9\u4e0a\u5c42\u63d0\u4f9b\u8d44\u6e90\u62bd\u8c61 API\u3002\u6240\u4ee5\u7528\u51fd\u6570\u3002</p> <p>\u4f7f\u7528 <code>a7</code> \u800c\u4e0d\u662f <code>a0</code> \u6765\u4f20\u9012\u7cfb\u7edf\u8c03\u7528\u53f7\u662f\u51fa\u4e8e\u5bf9\u73b0\u6709\u51fd\u6570\u8c03\u7528\u89c4\u8303\u7684\u517c\u5bb9\u6027\u8003\u8651\u3002</p> <p>\u5982\u679c\u4f7f\u7528 <code>a0</code> \u4f5c\u4e3a\u7cfb\u7edf\u8c03\u7528\u53f7\u7684\u4f20\u9012\uff0c\u53ef\u80fd\u4f1a\u4e0e\u666e\u901a\u51fd\u6570\u8c03\u7528\u7684\u53c2\u6570\u4f20\u9012\u51b2\u7a81\uff0c\u8fd8\u6709\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\u51fd\u6570\u8fd4\u56de\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u5c06\u8fd4\u56de\u503c\u8bb0\u5f55\u5728 <code>a0</code> \u5bc4\u5b58\u5668\u91cc\uff1f\u611f\u89c9\u4e0d\u662f\u5f88\u6e05\u695a</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#trm","title":"\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a\u7684 TRM","text":""},{"location":"ysyx/pa/pa3/pa3.html#_13","title":"\u6807\u51c6\u8f93\u51fa","text":"<p>\u8fd9\u91cc\u521a\u505a\u5230\u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u5019\u662f\u61f5\u903c\uff0cexit\u3001yield \u534a\u731c\u534a\u61f5\u5730\u5b9e\u73b0\uff0c\u5230write\u8fd9\u91cc\u5c31\u61f5\u4e86\u3002</p> <p>\u54ea\u91cc\u6709write\uff1f\u81ea\u5df1\u5199\uff1f\u518d\u5199\u4e00\u8fb9\u54ea\u4e2aputch\uff1f\u770b\u7740\u90a3\u4e2ananos-lite\u7684syscall.c \u50bb\u695e\u3002</p> <p>\u5b9e\u9645\u4e0a\u8fd8\u662f\u5bf9\u5c42\u6b21\u4e0d\u6e05\uff1a</p> <p>\u5728GNU/Linux\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u60f3\u8981\u8f93\u51fa\u662f\u901a\u8fc7 <code>SYS_write</code> \u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\u7684\uff0c\u7528\u6237\u7a0b\u5e8f\u60f3\u8981\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u4e00\u4e9b\u7cfb\u7edf\u786c\u4ef6\u7ea7\u522b\u7684\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u5b9e\u73b0\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u901a\u8fc7 <code>ecall</code> \u8fdb\u884c\u8bbf\u95ee\u7279\u6743\u8d44\u6e90\uff08\u786c\u4ef6\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7\u8fd9\u4e2a\u624b\u6bb5\u6765\u8de8\u8d8a\u7a0b\u5e8f\u7684\u7ea7\u522b\uff0c\u4e5f\u5c31\u662f\u4ece\u7528\u6237\u4ee3\u7801\u5230\u64cd\u4f5c\u7cfb\u7edf\u4ee3\u7801\uff08\u5f53\u7136\u8fd8\u6709\u5904\u7406\u5668\u6a21\u5f0f\u7684\u66f4\u6539\uff0c\u4e0d\u8fc7 PA \u4e00\u76f4\u90fd\u662f M\uff0c\u6240\u4ee5\u4e0d\u8ba8\u8bba\uff09\u3002\u6240\u4ee5\u73b0\u5728user\u5230\u64cd\u4f5c\u7cfb\u7edf\u5c42\u4e86\uff08\u600e\u4e48\u6765\u7684\uff0clibos\u7684\u63a5\u53e3\uff09\uff0c\u8981\u64cd\u4f5c\u786c\u4ef6\u8d44\u6e90\u4e86\uff0c\u800c\u6211\u4eec\u7684\u64cd\u4f5c\u7cfb\u7edf\u662f\u5efa\u7acb\u5728 <code>am</code> \u4e0a\u7684\uff0c\u6211\u4eec\u62bd\u8c61\u4e00\u5c42\u65b9\u4fbf\u7406\u89e3\uff0c\u64cd\u4f5c\u786c\u4ef6\u73b0\u5728\u5c31\u662f\u8981\u64cd\u4f5c <code>am</code> \u4e86\uff0c\u6240\u4ee5\uff0c<code>am</code> \u4f1a\u6709 \u76f8\u5173 API \u63d0\u4f9b\u7ed9\u66f4\u4e0a\u5c42\u7684 <code>nanos-lite</code>\u3002</p> <p>\u518d\u56de\u8fc7\u5934\u6765\u770b\u8fd9\u4e2a\u8981\u6211\u4eec\u5b9e\u73b0\u7684\u5185\u5bb9\uff1a</p> <p>\u6240\u4ee5\u8f93\u51fa\u7684\u7cfb\u7edf\u8c03\u7528\u53c8\u8981\u662f\u8981\u4f9d\u9760\u786c\u4ef6\uff1a</p> <p><code>nemu/uart memory</code> &lt;-&gt; <code>amputch</code>  &lt;-&gt; <code>IOE</code> &lt;-&gt; <code>nanos-lite: write</code> &lt;-&gt; <code>syscall libos</code>  &lt;-&gt; <code>navy-apps</code></p> <p>\u73b0\u5728\uff0c\u8f6e\u5230\u6211\u4eec\u6765\u8854\u63a5 <code>hal</code>\u5c42\uff08<code>am</code>\uff09\u3001\u7cfb\u7edf\u8c03\u7528\uff08<code>nanos-lite</code>\uff09\u3001\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\uff08<code>libos</code>\uff09\u4e86\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u51e0\u4e2a\u90fd\u662f\u8981\u7528\u5230\u7684\uff0c\u7528 <code>am</code> \u7684 API \u5b8c\u5584 \u7cfb\u7edf\u8c03\u7528\uff0c\u5b8c\u5584\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\u3002</p> <p>\u603b\u7ed3\u51fa\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\u7684\u6d41\u7a0b\uff1a</p> <p><code>navy</code> \u8981\u6539</p> <p><code>nanos-lite</code> <code>do_syscall</code> \u8981\u8fdb\u4e00\u6b65\u6dfb\u52a0\u5177\u4f53\u7684\u884c\u4e3a</p> <p>\u5b9e\u73b0\u5177\u4f53\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5199\u5b8c\u4e0a\u9762\u7684\u5185\u5bb9\u4e4b\u540e\uff0c\u6211\u5728\u60f3\uff0c\u90a3Linux\u9a71\u52a8\u662f\u5728\u505a\u54ea\u4e00\u5c42\u5462\uff1f\u5e73\u65f6\u7684\u5d4c\u5165\u5f0f\u5de5\u4f5c\uff0c\u53ef\u4ee5\u7c7b\u6bd4\u5230\u54ea\u4e00\u5c42\u5462\uff1f</p> <p>\u7ed3\u5408\u6587\u4ef6\u7cfb\u7edf\u601d\u8003\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u9759\u6b62\u7684\uff0c\u5177\u6709\u4f4d\u7f6e\u6982\u5ff5\uff0c\u652f\u6301 <code>lseek</code> \u64cd\u4f5c\uff0c\u5b58\u50a8\u8fd9\u4e9b\u6587\u4ef6\u7684\u8bbe\u5907\u79f0\u4e3a\u5757\u8bbe\u5907</li> <li>\u6d41\u52a8\u7684\uff0c\u53ea\u6709\u987a\u5e8f\u5173\u7cfb\uff0c\u4e0d\u652f\u6301 <code>lseek</code> \u64cd\u4f5c\uff0c\u76f8\u5e94\u7684\u8bbe\u5907\u79f0\u4e3a\u5b57\u7b26\u8bbe\u5907</li> </ul> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_14","title":"\u5806\u533a\u7ba1\u7406","text":"<p>\u5728Navy\u7684Newlib\u4e2d, <code>sbrk()</code>\u6700\u7ec8\u4f1a\u8c03\u7528<code>_sbrk()</code>, \u5b83\u5728<code>navy-apps/libs/libos/src/syscall.c</code>\u4e2d\u5b9a\u4e49. \u6846\u67b6\u4ee3\u7801\u8ba9<code>_sbrk()</code>\u603b\u662f\u8fd4\u56de<code>-1</code>, \u8868\u793a\u5806\u533a\u8c03\u6574\u5931\u8d25, \u4e8b\u5b9e\u4e0a, \u7528\u6237\u7a0b\u5e8f\u5728\u7b2c\u4e00\u6b21\u8c03\u7528<code>printf()</code>\u7684\u65f6\u5019\u4f1a\u5c1d\u8bd5\u901a\u8fc7<code>malloc()</code>\u7533\u8bf7\u4e00\u7247\u7f13\u51b2\u533a, \u6765\u5b58\u653e\u683c\u5f0f\u5316\u7684\u5185\u5bb9. \u82e5\u7533\u8bf7\u5931\u8d25, \u5c31\u4f1a\u9010\u4e2a\u5b57\u7b26\u8fdb\u884c\u8f93\u51fa. </p> <p>\u5982\u679c\u4f60\u5728Nanos-lite\u4e2d\u6253\u5f00strace, \u4f60\u4f1a\u53d1\u73b0\u7528\u6237\u7a0b\u5e8f\u901a\u8fc7<code>printf()</code>\u8f93\u51fa\u7684\u65f6\u5019, \u786e\u5b9e\u662f\u9010\u4e2a\u5b57\u7b26\u5730\u8c03\u7528<code>write()</code>\u6765\u8f93\u51fa\u7684.</p> <p>\u4e00\u5f00\u59cb\u8fd8\u771f\u6ca1\u770b\u51fa\u6765\uff0c\u8bf4\u660e\u524d\u9762\u5c31\u662fwrite\u5b9e\u73b0\u7684\u5c31\u6709\u95ee\u9898\uff0c\u5c31\u653e\u4e86\u4e2aputch\uff0c\u90fd\u6ca1\u6709\u8003\u8651\u8fc7\u54c8\u54c8\u54c8\u3002</p> <ul> <li> <p>\u989d\u5916\u9605\u8bfb1</p> <p>\u7f13\u51b2\u533a\u4e0e\u7cfb\u7edf\u8c03\u7528\u5f00\u9500 \u4f60\u5df2\u7ecf\u4e86\u89e3\u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u4e86. \u4e8b\u5b9e\u4e0a, \u5982\u679c\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5343\u8f9b\u4e07\u82e6\u5730\u9677\u5165\u64cd\u4f5c\u7cfb\u7edf\u53ea\u662f\u4e3a\u4e86\u8f93\u51fa\u533a\u533a\u4e00\u4e2a\u5b57\u7b26, \u90a3\u5c31\u592a\u4e0d\u5212\u7b97\u4e86. \u4e8e\u662f\u6709\u4e86\u6279\u5904\u7406(batching)\u7684\u6280\u672f: \u5c06\u4e00\u4e9b\u7b80\u5355\u7684\u4efb\u52a1\u7d2f\u79ef\u8d77\u6765, \u7136\u540e\u518d\u4e00\u6b21\u6027\u8fdb\u884c\u5904\u7406. \u7f13\u51b2\u533a\u662f\u6279\u5904\u7406\u6280\u672f\u7684\u6838\u5fc3, </p> <p><code>libc</code>\u4e2d\u7684<code>fread</code>()\u548c<code>fwrite</code>()\u6b63\u662f\u901a\u8fc7\u7f13\u51b2\u533a\u6765\u5c06\u6570\u636e\u7d2f\u79ef\u8d77\u6765, \u7136\u540e\u518d\u901a\u8fc7\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u8fdb\u884c\u5904\u7406. </p> <p>\u4f8b\u5982\u901a\u8fc7\u4e00\u4e2a1024\u5b57\u8282\u7684\u7f13\u51b2\u533a, \u5c31\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u76f4\u63a5\u8f93\u51fa1024\u4e2a\u5b57\u7b26, \u800c\u4e0d\u9700\u8981\u901a\u8fc71024\u6b21\u7cfb\u7edf\u8c03\u7528\u6765\u9010\u4e2a\u5b57\u7b26\u5730\u8f93\u51fa. \u663e\u7136, \u540e\u8005\u7684\u5f00\u9500\u6bd4\u524d\u8005\u5927\u5f97\u591a.</p> <p>\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u5728GNU/Linux\u4e0a\u7f16\u5199\u76f8\u5e94\u7684\u7a0b\u5e8f, \u6765\u7c97\u7565\u6d4b\u8bd5\u4e00\u4e0b\u4e00\u6b21write()\u7cfb\u7edf\u8c03\u7528\u7684\u5f00\u9500, \u7136\u540e\u548c\u8fd9\u7bc7\u6587\u7ae0\u5bf9\u6bd4\u4e00\u4e0b.Measurements of system call performance and overhead - Arkanis Development</p> <p>\u8fd8\u6709\u4e00\u4e2a\u53ef\u79fb\u690d\u6027\u7684\u95ee\u9898\uff0c\u8fd9\u4e5f\u5c31\u5bf9\u5e94\u4e86\u4e00\u4e2a\u9762\u8bd5\u9898\u76ee\uff1a\u5173\u4e8e\u7cfb\u7edf\u8c03\u7528\u548clibc\u5e93\u7684\u8054\u7cfb\u548c\u533a\u522b\u3002\u6700\u540e\u603b\u7ed3\u3002</p> </li> <li> <p>\u989d\u5916\u9605\u8bfb2</p> <p>printf\u548c\u6362\u884c</p> <p>\u6211\u4eec\u5728PA1\u7684\u65f6\u5019\u63d0\u793a\u8fc7\u5927\u5bb6, \u4f7f\u7528<code>printf()</code>\u8c03\u8bd5\u65f6\u9700\u8981\u6dfb\u52a0<code>\\n</code>, \u73b0\u5728\u7ec8\u4e8e\u53ef\u4ee5\u89e3\u91ca\u4e3a\u4ec0\u4e48\u4e86: <code>fwrite()</code>\u7684\u5b9e\u73b0\u4e2d\u6709\u7f13\u51b2\u533a, <code>printf()</code>\u6253\u5370\u7684\u5b57\u7b26\u4e0d\u4e00\u5b9a\u4f1a\u9a6c\u4e0a\u901a\u8fc7<code>write()</code>\u7cfb\u7edf\u8c03\u7528\u8f93\u51fa, \u4f46\u9047\u5230<code>\\n</code>\u65f6\u53ef\u4ee5\u5f3a\u884c\u5c06\u7f13\u51b2\u533a\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u8f93\u51fa. \u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u9605\u8bfb<code>navy-apps/libs/libc/src/stdio/wbuf.c</code>, \u8fd9\u4e2a\u6587\u4ef6\u5b9e\u73b0\u4e86\u7f13\u51b2\u533a\u7684\u529f\u80fd.</p> </li> <li> <p>\u9009\u505a\u9898</p> <p>\u652f\u6301\u591a\u4e2aELF\u7684ftrace</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u4e86\u89e3C\u5e93\u4e2d<code>printf()</code>\u5230<code>write()</code>\u7684\u8fc7\u7a0b, ftrace\u5c06\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5de5\u5177. \u4f46\u6211\u4eec\u77e5\u9053, Nanos-lite\u548c\u5b83\u52a0\u8f7d\u7684\u7528\u6237\u7a0b\u5e8f\u662f\u4e24\u4e2a\u72ec\u7acb\u7684ELF\u6587\u4ef6, \u8fd9\u610f\u5473\u7740, \u5982\u679c\u6211\u4eec\u7ed9NEMU\u7684ftrace\u6307\u5b9a\u5176\u4e2d\u4e00\u65b9\u7684ELF\u6587\u4ef6, \u90a3\u4e48ftrace\u5c31\u65e0\u6cd5\u6b63\u786e\u5c06\u53e6\u4e00\u65b9\u7684\u5730\u5740\u7ffb\u8bd1\u6210\u6b63\u786e\u7684\u51fd\u6570\u540d. \u4e8b\u5b9e\u4e0a, \u6211\u4eec\u53ef\u4ee5\u8ba9NEMU\u7684ftrace\u652f\u6301\u591a\u4e2aELF: \u5982\u679c\u4e00\u4e2a\u5730\u5740\u4e0d\u5c5e\u4e8e\u67d0\u4e2aELF\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u51fd\u6570, \u90a3\u5c31\u5c1d\u8bd5\u4e0b\u4e00\u4e2aELF. \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f, ftrace\u5c31\u53ef\u4ee5\u540c\u65f6\u8ffd\u8e2aNanos-lite\u548c\u7528\u6237\u7a0b\u5e8f\u7684\u51fd\u6570\u8c03\u7528\u4e86.</p> </li> <li> <p>\u601d\u8003\u98981</p> <p>\u518d\u6b21\u56de\u987e\u7cfb\u7edf\u8c03\u7528\u548c\u5f02\u5e38\u7684\u5173\u7cfb\uff0c\u7ffb\u770b\u524d\u9762\u7684\u5185\u5bb9\u3002</p> <p>\u5728RISC-V\u5904\u7406\u5668\u4e2d\uff0c\u5f02\u5e38\u53d1\u751f\u540e CPU \u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\uff1f\u8f6f\u4ef6OS \u53c8\u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\uff1f</p> </li> <li> <p>\u601d\u8003\u9898/\u5fc5\u7b54\u98982</p> <p>\u5fc5\u7b54\u9898(\u9700\u8981\u5728\u5b9e\u9a8c\u62a5\u544a\u4e2d\u56de\u7b54) - hello\u7a0b\u5e8f\u662f\u4ec0\u4e48, \u5b83\u4ece\u800c\u4f55\u6765, \u8981\u5230\u54ea\u91cc\u53bb</p> <p>\u5230\u6b64\u4e3a\u6b62, PA\u4e2d\u7684\u6240\u6709\u7ec4\u4ef6\u5df2\u7ecf\u5168\u90e8\u4eae\u76f8, \u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e5f\u5f00\u59cb\u8d8b\u4e8e\u5b8c\u6574. \u4f60\u4e5f\u5df2\u7ecf\u5728\u8fd9\u4e2a\u81ea\u5df1\u521b\u9020\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e0a\u8dd1\u8d77\u4e86hello\u8fd9\u4e2a\u7b2c\u4e00\u4e2a\u8fd8\u8bf4\u5f97\u8fc7\u53bb\u7684\u7528\u6237\u7a0b\u5e8f (dummy\u662f\u7ed9\u5927\u5bb6\u70ed\u8eab\u7528\u7684, \u4e0d\u7b97), \u597d\u6d88\u606f\u662f, \u6211\u4eec\u5df2\u7ecf\u8ddd\u79bb\u8fd0\u884c\u4ed9\u5251\u5947\u4fa0\u4f20\u4e0d\u8fdc\u4e86(\u4e0b\u4e00\u4e2a\u9636\u6bb5\u5c31\u662f\u5566).</p> <p>\u4e0d\u8fc7\u6309\u7167PA\u7684\u4f20\u7edf, \u5149\u662f\u8dd1\u8d77\u6765\u8fd8\u662f\u4e0d\u591f\u7684, \u4f60\u8fd8\u8981\u660e\u767d\u5b83\u7a76\u7adf\u600e\u4e48\u8dd1\u8d77\u6765\u624d\u884c. \u4e8e\u662f\u6765\u56de\u7b54\u8fd9\u9053\u5fc5\u7b54\u9898\u5427:</p> <p>\u6211\u4eec\u77e5\u9053<code>navy-apps/tests/hello/hello.c</code>\u53ea\u662f\u4e00\u4e2aC\u6e90\u6587\u4ef6, \u5b83\u4f1a\u88ab\u7f16\u8bd1\u94fe\u63a5\u6210\u4e00\u4e2aELF\u6587\u4ef6. </p> <ol> <li>\u90a3\u4e48, hello\u7a0b\u5e8f\u4e00\u5f00\u59cb\u5728\u54ea\u91cc? </li> <li>\u5b83\u662f\u600e\u4e48\u51fa\u73b0\u5185\u5b58\u4e2d\u7684? </li> <li>\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u5728\u76ee\u524d\u7684\u5185\u5b58\u4f4d\u7f6e? </li> <li>\u5b83\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5728\u54ea\u91cc? </li> <li>\u7a76\u7adf\u662f\u600e\u4e48\u6267\u884c\u5230\u5b83\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u7684? </li> <li>hello\u7a0b\u5e8f\u5728\u4e0d\u65ad\u5730\u6253\u5370\u5b57\u7b26\u4e32, \u6bcf\u4e00\u4e2a\u5b57\u7b26\u53c8\u662f\u7ecf\u5386\u4e86\u4ec0\u4e48\u624d\u4f1a\u6700\u7ec8\u51fa\u73b0\u5728\u7ec8\u7aef\u4e0a?</li> </ol> <p>\u4e0a\u9762\u4e00\u53e3\u6c14\u95ee\u4e86\u5f88\u591a\u95ee\u9898, \u6211\u4eec\u60f3\u8bf4\u7684\u662f, \u8fd9\u5176\u4e2d\u8574\u542b\u7740\u975e\u5e38\u591a\u9700\u8981\u4f60\u7406\u89e3\u7684\u7ec6\u8282. \u6211\u4eec\u5e0c\u671b\u4f60\u80fd\u591f\u8ba4\u771f\u6574\u7406\u5176\u4e2d\u6d89\u53ca\u7684\u6bcf\u4e00\u884c\u4ee3\u7801, \u7136\u540e\u7528\u81ea\u5df1\u7684\u8bed\u8a00\u878d\u4f1a\u8d2f\u901a\u5730\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u7406\u89e3\u63cf\u8ff0\u6e05\u695a, \u800c\u4e0d\u662f\u673a\u68b0\u5730\u5206\u70b9\u56de\u7b54\u8fd9\u51e0\u4e2a\u95ee\u9898.</p> <p>\u540c\u6837\u5730, \u4e0a\u4e00\u9636\u6bb5\u7684\u5fc5\u7b54\u9898\"\u7406\u89e3\u7a7f\u8d8a\u65f6\u7a7a\u7684\u65c5\u7a0b\"\u4e5f\u5df2\u7ecf\u6db5\u76d6\u4e86\u4e00\u90e8\u5206\u5185\u5bb9, \u4f60\u53ef\u4ee5\u628a\u5b83\u7684\u56de\u7b54\u5305\u542b\u8fdb\u6765, \u4f46\u9700\u8981\u63cf\u8ff0\u6e05\u695a\u6709\u5dee\u5f02\u7684\u5730\u65b9. \u53e6\u5916, C\u5e93\u4e2d<code>printf()</code>\u5230<code>write()</code>\u7684\u8fc7\u7a0b\u6bd4\u8f83\u7e41\u7410, \u800c\u4e14\u4e5f\u4e0d\u5c5e\u4e8ePA\u7684\u4e3b\u7ebf\u5185\u5bb9, \u8fd9\u4e00\u90e8\u5206\u4e0d\u5fc5\u5c55\u5f00\u56de\u7b54. \u800c\u4e14\u4f60\u4e5f\u5df2\u7ecf\u5728PA2\u4e2d\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684<code>printf()</code>\u4e86, \u76f8\u4fe1\u4f60\u4e5f\u4e0d\u96be\u7406\u89e3\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u8fc7\u7a0b. \u5982\u679c\u4f60\u5bf9Newlib\u7684\u5b9e\u73b0\u611f\u5174\u8da3, \u4f60\u4e5f\u53ef\u4ee5RTFSC.</p> <p>\u603b\u4e4b, \u6263\u9664C\u5e93\u4e2d<code>printf()</code>\u5230<code>write()</code>\u8f6c\u6362\u7684\u90e8\u5206, \u5269\u4e0b\u7684\u4ee3\u7801\u5c31\u662f\u4f60\u5e94\u8be5\u7406\u89e3\u900f\u5f7b\u7684\u4e86. \u4e8e\u662f, \u52aa\u529b\u53bb\u7406\u89e3\u6bcf\u4e00\u884c\u4ee3\u7801\u5427!</p> <p></p> <p>\u9996\u5148\uff0c<code>hello.c</code> \u5728 <code>navy-apps</code> \u5c42\uff0c\u5e76\u88ab\u7f16\u8bd1\u6210\u4e00\u4e2a <code>elf</code> \u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f4d\u4e8e\u76f8\u5173\u5e94\u7528\u7a0b\u5e8f\u7684 <code>build</code> \u4e2d</p> <p>\u4e00\u822c\u6765\u8bf4, \u7a0b\u5e8f\u5e94\u8be5\u5b58\u653e\u5728\u6c38\u4e45\u5b58\u50a8\u7684\u4ecb\u8d28\u4e2d(\u6bd4\u5982\u78c1\u76d8). \u4f46\u8981\u5728NEMU\u4e2d\u5bf9\u78c1\u76d8\u8fdb\u884c\u6a21\u62df\u662f\u4e00\u4e2a\u7565\u663e\u590d\u6742\u5de5\u4f5c, \u56e0\u6b64\u5148\u8ba9Nanos-lite\u628a\u5176\u4e2d\u7684\u4e00\u6bb5\u5185\u5b58\u4f5c\u4e3a\u78c1\u76d8\u6765\u4f7f\u7528. \u8fd9\u6837\u7684\u78c1\u76d8\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u540d\u5b57, \u53eb <code>ramdisk</code>.</p> <p>\u4e4b\u540e\u8be5\u53ef\u6267\u884c\u6587\u4ef6\u91cd\u547d\u540d\u4e3a <code>ramdisk.img</code> \u653e\u5165 <code>nanos-lite</code> \u7684\u6307\u5b9a\u6587\u4ef6\u5939\uff0c</p> <p>\u4e4b\u540e\u7f16\u8bd1 <code>nanos-lite</code> \uff0c\u7f16\u8bd1\u671f\u95f4\u4f1a\u628a <code>ramdisk</code> \u5305\u542b\u8fdb <code>nanos-lite</code></p> <p>\u81f3\u4e8e <code>hello</code> \u600e\u4e48\u51fa\u73b0\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u7b80\u6613\u88c5\u8f7d\u5668 <code>loader</code> \u4f1a\u5c06\u5176\u88c5\u8f7d\u5230\u5185\u5b58\u7684 <code>[ramdisk_start, ramdisk_end]</code> \u5904\u3002</p> <pre><code>.section .data\n.global ramdisk_start, ramdisk_end\nramdisk_start:\n.incbin \"build/ramdisk.img\"\nramdisk_end:      \n\n// nanos-lite/src/resources.S\n</code></pre> <p>\u53ef\u6267\u884c\u6587\u4ef6\u4f4d\u4e8e <code>ramdisk</code> \u504f\u79fb\u4e3a0\u5904, \u8bbf\u95ee\u5b83\u5c31\u53ef\u4ee5\u5f97\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282.</p> <pre><code>ramdisk_read(&amp;eh, 0, sizeof(Elf_Ehdr));\n//...\n// nanos-lite/src/loader.c\n</code></pre> <p>\u81f3\u4e8e\u8bf4\u4e3a\u4ec0\u4e48\u51fa\u73b0\u5728\u76ee\u524d\u7684\u5185\u5b58\u4f4d\u7f6e\uff1a</p> <p>\u6846\u67b6\u7ea6\u5b9a\u597d\uff1a</p> <p>\u4e3a\u4e86\u907f\u514d\u548cNanos-lite\u7684\u5185\u5bb9\u4ea7\u751f\u51b2\u7a81, \u6211\u4eec\u7ea6\u5b9a\u76ee\u524d\u7528\u6237\u7a0b\u5e8f\u9700\u8981\u88ab\u94fe\u63a5\u5230\u5185\u5b58\u4f4d\u7f6e <code>0x83000000</code>(riscv32)\u9644\u8fd1\uff0c</p> <p>Navy\u5df2\u7ecf\u8bbe\u7f6e\u597d\u4e86\u76f8\u5e94\u7684\u9009\u9879(\u89c1<code>navy-apps/scripts/$ISA.mk</code>\u4e2d\u7684<code>LDFLAGS</code>\u53d8\u91cf). </p> <p>\u4e4b\u540e\uff0c<code>nanos-lite</code> \u4f1a\u88ab\u548c <code>am</code> \u4e00\u8d77\u88ab\u7f16\u8bd1\u6210 <code>elf</code> \u53ef\u6267\u884c\u6587\u4ef6\u5e76\u5c06\u5176\u53d1\u9001\u88ab<code>nemu</code>\uff0c\u7136\u540e\u6267\u884c <code>nemu</code>\u3002</p> <p>\u6211\u4eec\u5177\u4f53\u6765\u5206\u6790\u8fd9\u90e8\u5206\u8fc7\u7a0b\u548c\u7b2c\u56db\u4e2a\u95ee\u9898\u4e4b\u540e\u7684\u51e0\u4e2a\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u7b2c\u4e00\u6761\u6307\u4ee4\uff0c\u6709\u4e86PA1\u7684\u7ecf\u9a8c\u548c\u8bb2\u4e49\u7684\u660e\u793a\uff0c \u8fd8\u662f\u5f88\u6e05\u6670\u7684\u3002</p> <p><code>_start -&gt; call_main -&gt; main</code></p> <p>\u7528\u6237\u7a0b\u5e8f\u7684\u5165\u53e3\u4f4d\u4e8e <code>navy-apps/libs/libos/src/crt0/start.S</code> \u4e2d\u7684 <code>_start()</code> \u51fd\u6570\u3002<code>_start()</code>\u51fd\u6570\u4f1a\u8c03\u7528 <code>navy-apps/libs/libos/src/crt0/crt0.c</code> \u4e2d\u7684 <code>call_main()</code> \u51fd\u6570, \u7136\u540e\u8c03\u7528\u7528\u6237\u7a0b\u5e8f\u7684<code>main()</code>\u51fd\u6570, \u4ece<code>main()</code>\u51fd\u6570\u8fd4\u56de\u540e\u4f1a\u8c03\u7528<code>exit()</code>\u7ed3\u675f\u8fd0\u884c.</p> <pre><code>.globl  _start          \n_start:\n//... \u4e0d\u540c ISA \u4e0b\u7684\u64cd\u4f5c\n  mv s0, zero\n  jal call_main\n\n// navy-apps/libs/libos/src/crt0/start.S\n\nint main(int argc, char *argv[], char *envp[]);\nextern char **environ;\nvoid call_main(uintptr_t *args) {\n  char *empty[] =  {NULL };\n  environ = empty;\n  exit(main(0, empty, empty));\n  assert(0);\n}\n// navy-apps/libs/libos/src/crt0/crt0.c\n\u8fd9\u91cc\u6bd4\u8f83\u6709\u610f\u601d\uff0c\u73af\u5883\u53d8\u91cf\u4e3a NULL\uff0c\u6a21\u62df\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u73af\u5883\u3002\n</code></pre> <p>\u6211\u4eec\u518d\u901a\u8fc7\u53cd\u6c47\u7f16\u5de5\u5177\u751f\u6210\uff1a</p> <p></p> <p>\u4f46\u662f\u6709\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u600e\u4e48\u6267\u884c\u5230\u8fd9\u6761\u6307\u4ee4\u7684\uff1f\u56de\u60f3\u4e00\u4e0b\u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5c42\u6b21\uff0c\u6211\u4eec\u7684 <code>navy-apps</code> \u662f\u8fd0\u884c\u5728 <code>nanos-lite</code> \u4e0a\u7684\uff0c\u800c <code>nanos-lite</code> \u53c8\u662f\u8fd0\u884c\u5728 <code>AM</code> \u4e4b\u4e0a\u7684\uff0c<code>AM</code> \u53c8\u662f\u5728 <code>NEMU</code> \u786c\u4ef6\u4e0a\u7684\u3002\u6240\u4ee5\uff0c\u8bb0\u5f97\u56de\u53bb\u770b NEMU \u548c AM\u3002</p> <p>\u9996\u5148\u524d\u9762\u7684 <code>nanos-lite</code> \u548c <code>am</code> \u5df2\u7ecf\u6253\u5305\u597d\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u4e3a\u4e0a\u5c42\u5e93\u51fd\u6570\u548c\u5e94\u7528\u7a0b\u5e8f\u505a\u597d\u4e86\u8fd0\u884c\u65f6\u73af\u5883\u3002\u5f53 <code>loader</code> \u5c06 <code>hello</code> \u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\u65f6\uff0c\u6211\u4eec\u5c31\u8be5\u4ece <code>ramdisk</code>  \u7684 <code>offset</code> \u4e3a 0 \u5904\u5f00\u59cb\u6267\u884c <code>_start</code> \uff0c\u5177\u4f53\u600e\u4e48\u6267\u884c\u4e00\u6761\u6307\u4ee4\uff0c\u5728 PA2 \u4e2d\u5df2\u7ecf\u8bf4\u7684\u5f88\u660e\u767d\u4e86\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002</p> <p>\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff1ahello\u7a0b\u5e8f\u5728\u4e0d\u65ad\u5730\u6253\u5370\u5b57\u7b26\u4e32, \u6bcf\u4e00\u4e2a\u5b57\u7b26\u53c8\u662f\u7ecf\u5386\u4e86\u4ec0\u4e48\u624d\u4f1a\u6700\u7ec8\u51fa\u73b0\u5728\u7ec8\u7aef\u4e0a?</p> <p>\u8fd9\u4e2a\u95ee\u9898\u633a\u597d\u7684\u3002\u6253\u5370\u8c03\u7528\u7684 <code>printf</code>\uff0c\u9996\u5148 </p> <p>\u8fd8\u662f\u5148\u770b\u770b write</p> <p>\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u8c03\u7528 <code>write -&gt; _write_r -&gt; _write</code> \u8fdb\u800c\u901a\u8fc7\u81ea\u9677\u6307\u4ee4\u6765\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u53c2\u8003\u524d\u6587\u8fdb\u5165 <code>__am_asm_trap</code> \u7684\u8fc7\u7a0b\uff0c\u8fdb\u5165\u5230 <code>__am_irq_handle</code> \u5206\u53d1\u4e8b\u4ef6\u3002</p> <p>\u8fdb\u800c\u8c03\u7528 <code>use_handle</code> \u4e5f\u5c31\u662f <code>do_event()</code> \uff0c\u5728 <code>nanos-lite</code> \u8fd9\u4e00\u5c42\uff0c\u4e00\u76f4\u65f6 <code>do_event</code> \u6765\u8fdb\u4e00\u6b65\u5bf9\u4e8b\u4ef6\u5206\u53d1\u540e\u8fdb\u884c\u5904\u7406\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bb0\u4f4f\uff0c\u4ee5\u540e\u5e94\u8be5\u4e5f\u4f1a\u7528\u3002</p> <pre><code>static Context* do_event(Event e, Context* c) {\n   switch (e.event) {\n     case EVENT_YIELD: printf(\"event: yield.\\n\"); break;\n     case EVENT_SYSCALL: do_syscall(c); break;\n     default: panic(\"Unhandled event ID = %d\", e.event);\n   }      \n   return c;\n }\n void init_irq(void) {\n   //Log(\"Initializing interrupt/exception handler...\");\n   cte_init(do_event);\n }\n// nanos-lite/src/irq.c\n</code></pre> <p>\u89e6\u53d1SYSCALL\uff0c\u8fdb\u5165\u518d\u5224\u65ad\u662f\u54ea\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1a</p> <pre><code>int sys_yield() {\n}\nvoid sys_exit(int code) {\n}\nint sys_write(int fd, const void *buf, int count) {\n}   \n\nswitch (a[0]) {\n  case SYS_exit: strace(); sys_exit(a[0]); break;\n  case SYS_yield: c-&gt;GPRx = sys_yield(); break;\n  case SYS_write: c-&gt;GPRx = sys_write(a[1], (char *)a[2], a[3]); break;\n  case SYS_brk: c-&gt;GPRx = 0; break;\n  default: panic(\"Unhandled syscall ID = %d\", a[0]);\n}\n</code></pre> <p>\u8fdb\u800c\u4f7f\u7528\u7531 <code>am</code> \u5c42\u63d0\u4f9b\u7ed9 <code>nanos-lite</code> \u7684\u76f8\u5173\u64cd\u7eb5\u786c\u4ef6\u8d44\u6e90\u7684\u4e00\u4e9b\u5c01\u88c5\u63a5\u53e3\uff0c <code>sys_xxx</code>\u3002\u5b8c\u6210\u4e4b\u540e\uff0c<code>do_syscall</code> -&gt; <code>do_event</code> -&gt;</p> <p><code>__am_irq_handle</code> -&gt; <code>_write</code> \u8fd4\u56de\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\u4f4d\u7f6e\u3002\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u5bf9\u4e8e<code>printf</code>\uff0c\u6211\u901a\u8fc7 \u7ec8\u7aef\u4e0a\u7684 <code>ftrace</code>  \u548c <code>hello-riscv32</code> \u7684\u53cd\u6c47\u7f16\u4e00\u4e00\u5bf9\u6bd4\u5f97\u51fa\u5177\u4f53\u6d41\u7a0b\u3002</p> <pre><code>// \u624b\u52a8\u5bf9\u6bd4\u8865\u5168 \uff08\n0x83000118:              call [printf@0x83000188]  // \u6ce8\u610f\u8fd9\u91cc\u662f \u5e94\u7528\u7a0b\u5e8f\u7684\n0x830001cc:                call [_vfprintf_r@0x83000244]\n0x83000310:                  call [__sfputs_r@0x83000c3c]\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000380:                  call [&lt;_vfprintf_r+0x994&gt;@0x830005fc]\n0x83000960:                    call [&lt;__sfputs_r&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000310:                    call [&lt;_vfprintf_r+0x994&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0] \n0x83003464:                      ret [&lt;_fputc_r&gt;             \n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0]\n0x83004364:                        call [&lt;_fflush_r&gt;@0x830045d0]\n0x83004500:                          call [&lt;__swrite&gt;@0x830035bc]\n0x83000208:                            call [&lt;_write&gt;@0x83004a44]\n0x800008dc:                              call [__am_irq_handle@0x80000740]\n0x800007b0:                                call [do_event@0x80000210]\n0x80000238:                                  call [do_syscall@0x80000014]\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n... \u91cd\u590dputch \u5f88\u591a\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n0x800000ac:                                    call [printf@0x80000a18] // klib\u7684\n0x80000ab8:                                      call [vsprintf@0x80000bec]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cec:                                        call [itoa@0x80000af4]\n0x80000ba0:                                          call [strcpy@0x80000974]\n0x8000098c:                                          ret [strcpy]\n0x80000bb4:                                        ret [itoa]\n0x80000cb0:                                      ret [vsprintf]\n... putch\n0x80000ad0:                                      call [putch@0x80000494]\n0x8000049c:                                      ret [putch]\n0x80000af0:                                    ret [printf]\n0x800000c8:                                  ret [do_syscall]\n0x8000024c:                                ret [do_event]\n0x800007c0:                              ret [__am_irq_handle]\n0x83004a4c:                            ret [_write]\n0x83000220:                          ret __swrite\n0x830044b0:                        ret [_fflush_r]\n0x830042e8:                      ret [_fputc_r]\n0x83000cd4:                    ret [_vfprintf_r]\n0x8300049c:                  ret [_vfprintf_r+0x994]\n0x83000380:                ret [_vfprintf_r]\n0x830001d8:              ret [printf]  // \u5e94\u7528\u7a0b\u5e8f\u7684\n</code></pre> <p>\u770b\u5b8c\u6d41\u7a0b\uff0c\u5927\u6982\u6e05\u695a\u4e86 <code>hello</code> \u5b57\u7b26\u4e32\u600e\u4e48\u4e00\u6b65\u6b65\u4ece\u5e94\u7528\u7a0b\u5e8f\u5230\u4e0b\u5c42\u786c\u4ef6\uff0c\u518d\u4ece\u4e0b\u6b21\u4e00\u6b65\u6b65\u8fd4\u56de\u5230\u4e0a\u5c42\u7684\u4e86\uff01</p> <p><code>write(FD_STDOUT, buf, len)</code></p> <p>\u8fd9\u91cc\u8fd8\u6709\u6709\u4e2a\u95ee\u9898\u5c31\u662f\uff1a<code>printf</code> \u5230\u5e95\u662f\u8c01\u7684\uff1f\u90fd\u6709\uff1f\u4f46\u662f\u600e\u4e48\u533a\u5206\uff0c\u4e0a\u9762\u662f\u56e0\u4e3a\u6211\u624b\u52a8\u8865\u5145\uff0c\u800c\u540c\u540d\u7684\u3002</p> <p>\u80af\u5b9a\u7684\u662f\uff0c\u4e0a\u5c42\u7684 <code>printf</code> \u662f\u4f1a\u8c03\u7528\u6211\u7684 <code>klib</code> \u7684\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\uff08\u7ecf\u8fc7\u9a8c\u8bc1\uff0c\u5728 <code>klib</code> \u7684 <code>printf</code> \u91cc\u52a0\u4e86\u9a8c\u8bc1\uff09</p> <p>\u9519\u4e86\uff01\u8fd9\u4e2a <code>0x800000ac:    call [printf@0x80000a18] // klib\u7684</code> \u662f \u5173\u4e8estrace\u7684\uff0c\u4e0a\u9762\u7684\u5206\u6790\u662f\u6ca1\u6709printf\u90a3\u90e8\u5206\u7684\uff01</p> <p>\u6b63\u786e\u7684\uff1a</p> <pre><code>// \u624b\u52a8\u5bf9\u6bd4\u8865\u5168 \uff08\n0x83000118:              call [printf@0x83000188]  // \u6ce8\u610f\u8fd9\u91cc\u662f \u5e94\u7528\u7a0b\u5e8f\u7684\n0x830001cc:                call [_vfprintf_r@0x83000244]\n0x83000310:                  call [__sfputs_r@0x83000c3c]\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000380:                  call [&lt;_vfprintf_r+0x994&gt;@0x830005fc]\n0x83000960:                    call [&lt;__sfputs_r&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000310:                    call [&lt;_vfprintf_r+0x994&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0] \n0x83003464:                      ret [&lt;_fputc_r&gt;             \n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0]\n0x83004364:                        call [&lt;_fflush_r&gt;@0x830045d0]\n0x83004500:                          call [&lt;__swrite&gt;@0x830035bc]\n0x83000208:                            call [&lt;_write&gt;@0x83004a44]\n0x800008dc:                              call [__am_irq_handle@0x80000740]\n0x800007b0:                                call [do_event@0x80000210]\n0x80000238:                                  call [do_syscall@0x80000014]\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n... \u91cd\u590dputch \u5f88\u591a\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n0x800000c8:                                  ret [do_syscall]\n0x8000024c:                                ret [do_event]\n0x800007c0:                              ret [__am_irq_handle]\n0x83004a4c:                            ret [_write]\n0x83000220:                          ret __swrite\n0x830044b0:                        ret [_fflush_r]\n0x830042e8:                      ret [_fputc_r]\n0x83000cd4:                    ret [_vfprintf_r]\n0x8300049c:                  ret [_vfprintf_r+0x994]\n0x83000380:                ret [_vfprintf_r]\n0x830001d8:              ret [printf]  // \u5e94\u7528\u7a0b\u5e8f\u7684\n</code></pre> <p>\u73b0\u5728\u66f4\u6e05\u6670\u4e86\uff01\u4e0a\u5c42printf\u5c31\u662f\u4e00\u6b65\u6b65\u4e0b\u6765\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6253\u5370\u51fa\u5b57\u7b26\u7684\u3002</p> <p>\u53e6\u5916\uff1a</p> <p><code>build/nanos-lite-riscv32-nemu.txt</code> :</p> <pre><code>80000000 &lt;_start&gt;:\n80000000:   00000413            li  s0,0\n80000004:   0001c117            auipc   sp,0x1c\n80000008:   ffc10113            addi    sp,sp,-4 # 8001c000 &lt;_end&gt;\n8000000c:   5fc000ef            jal ra,80000608 &lt;_trm_init&gt;      \n80000608 &lt;_trm_init&gt;:\n80000618:   c29ff0ef            jal ra,80000240 &lt;main&gt;\n8000061c:   00050513            mv  a0,a0\n80000620:   00100073            ebreak\n80000624:   0000006f            j   80000624 &lt;_trm_init+0x1c&gt;\n80000240 &lt;main&gt;:\n80000240:   ff010113            addi    sp,sp,-16\n80000244:   00001597            auipc   a1,0x1\n...\n8000025c:   11d000ef            jal ra,80000b78 &lt;printf&gt;\n80000260:   00002417            auipc   s0,0x2\n...\n80000280:   0f9000ef            jal ra,80000b78 &lt;printf&gt;\n...\n800002ac:   0cd000ef            jal ra,80000b78 &lt;printf&gt;\n800002b0:   f55ff0ef            jal ra,80000204 &lt;init_mm&gt;\n800002b4:   d5dff0ef            jal ra,80000010 &lt;init_device&gt;\n800002b8:   304000ef            jal ra,800005bc &lt;init_ramdisk&gt;\n800002bc:   0d8000ef            jal ra,80000394 &lt;init_irq&gt;\n800002c0:   110000ef            jal ra,800003d0 &lt;init_fs&gt;\n800002c4:   ef5ff0ef            jal ra,800001b8 &lt;init_proc&gt;\n...\n800002e0:   099000ef            jal ra,80000b78 &lt;printf&gt;\n800002e4:   6a4000ef            jal ra,80000988 &lt;yield&gt;\n...\n80000300:   079000ef            jal ra,80000b78 &lt;printf&gt;\n80000304:   00100513            li  a0,1\n80000308:   2f4000ef            jal ra,800005fc &lt;halt&gt;\n800005fc &lt;halt&gt;:\n800005fc:   00050513            mv  a0,a0\n80000600:   00100073            ebreak\n80000604:   0000006f            j   80000604 &lt;halt+0x8&gt;\n</code></pre> <p><code>hello-riscv32.txt</code></p> <pre><code>83004d60 &lt;_start&gt;:\n83004d60:   00000413            li  s0,0\n83004d64:   004000ef            jal ra,83004d68 &lt;call_main&gt;\n\n83004d68 &lt;call_main&gt;:\n...\n83004d90:   328080e7            jalr    808(ra) # 830000b4 &lt;main&gt;\n...\n83004d98:   080080e7            jalr    128(ra) # 83004e14 &lt;exit&gt;\n\n830000b4 &lt;main&gt;:                   \n830000e0:   04c080e7            jalr    76(ra) # 83000128 &lt;write&gt;\n...\n830000f8:   00c12783            lw  a5,12(sp)\n...\n83000118:   074080e7            jalr    116(ra) # 83000188 &lt;printf&gt;\n...\n83000124:   fd5ff06f            j   830000f8 &lt;main+0x44&gt;\n\n// \u5e94\u7528\u5c42\u7cfb\u7edf\u8c03\u7528: write -&gt; _write_r -&gt; _write\n83004a44 &lt;_write&gt;:\n83004a44:   00400893            li  a7,4\n83004a48:   00000073            ecall\n83004a4c:   00008067            ret\n\n// printf -&gt; _vfprintf_r -&gt; __sfputs_r -&gt; _fputc_r -&gt; _putc_r -&gt; __sinit -&gt; __swbuf_r ....\u627e\u4e0d\u5230\u4e86...\n_sbrk_r -&gt; _sbrk\n83004a50 &lt;_sbrk&gt;:\n83004a50:   00050793            mv  a5,a0\n83004a54:   00900893            li  a7,9\n83004a58:   00000593            li  a1,0\n83004a5c:   00000613            li  a2,0\n83004a60:   00000073            ecall\n..\n83004a74:   e2470713            addi    a4,a4,-476 # 83006894 &lt;program_break.12&gt;\n...\n83004a88:   00008067            ret\n</code></pre> </li> <li> <p>\u601d\u8003\u98983</p> <p>\u56de\u7b54libc\u5e93 \u548c \u7cfb\u7edf\u8c03\u7528\u7684\u533a\u522b\uff1f</p> </li> </ul> <p>PA3.3 \u548c PA3.2 3.1\u7684\u5173\u6ce8\u91cd\u70b9\uff0c\u533a\u522b\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\uff08\u4e0d\u662f\u4e0d\u7528\u524d\u9762\u7684\uff0c\u7528\u7684\u8fd8\u662f\u633a\u591a\u7684\uff09\u3002\u6545\u5206\u5f00\uff0c\u5c42\u6b21\u66f4\u597d\u4e00\u4e00\u70b9\uff08\u597d\u50cf\u4e5f\u6ca1\u3002</p>"},{"location":"ysyx/pa/pa3/pa3.html#pa33","title":"PA3.3 \u7b80\u6613\u6587\u4ef6\u7cfb\u7edf","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6587\u4ef6\u504f\u79fb\u91cf\u548c\u7528\u6237\u7a0b\u5e8f</p> <p>\u4e8b\u5b9e\u4e0a\u5728\u771f\u6b63\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d, \u628a\u504f\u79fb\u91cf\u653e\u5728\u6587\u4ef6\u8bb0\u5f55\u8868\u4e2d\u7ef4\u62a4\u4f1a\u5bfc\u81f4\u7528\u6237\u7a0b\u5e8f\u65e0\u6cd5\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd. \u4f46\u89e3\u91ca\u8fd9\u4e2a\u95ee\u9898\u9700\u8981\u7406\u89e3\u4e00\u4e9b\u8d85\u51fa\u8bfe\u7a0b\u8303\u56f4\u7684\u77e5\u8bc6, \u6211\u4eec\u5728\u6b64\u5c31\u4e0d\u5c55\u5f00\u53d9\u8ff0\u4e86. \u4f60\u53ef\u4ee5\u5728\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u7684\u65f6\u5019\u518d\u6765\u601d\u8003\u8fd9\u4e2a\u95ee\u9898.</p> <p>\u7531\u4e8eNanos-lite\u662f\u4e00\u4e2a\u7cbe\u7b80\u7248\u7684\u64cd\u4f5c\u7cfb\u7edf, \u4e0a\u8ff0\u95ee\u9898\u6682\u65f6\u4e0d\u4f1a\u51fa\u73b0, \u4e3a\u4e86\u7b80\u5316\u5b9e\u73b0, \u6211\u4eec\u8fd8\u662f\u628a\u504f\u79fb\u91cf\u653e\u5728\u6587\u4ef6\u8bb0\u5f55\u8868\u4e2d\u8fdb\u884c\u7ef4\u62a4.</p> </li> <li> <p>\u4e00\u6b21\u7279\u522b\u7684bug\u7ecf\u9a8c\uff1a\u76f4\u63a5\u6539ELF</p> <pre><code>int fs_open(const char *pathname, int flags, int mode) {\n    int len = sizeof(file_table) / sizeof(Finfo);\n    for (int i = 3; i &lt; len ; i++) {\n        if (strcmp(file_table[i].name, pathname) == 0) {\n            file_table[i].open_offset = 0;\n           //file_table[i].disk_offset = 0;\n           //printf(\"fs_open:%s file_table[%d]\\n\",file_table[i].name, i);\n           return i;\n        }\n    }\n    panic(\"No such file: %s\\n\", pathname);\n    return 0;\n}\n</code></pre> <pre><code>        file_table[i].open_offset = 0;\n       //file_table[i].disk_offset = 0;\n</code></pre> <p>\u56e0\u4e3a\u8d70\u795e\u4e86\uff0c<code>open_offset</code> \u6572\u6210\u4e86 <code>disk_offset</code> \u5c31\u5bfc\u81f4\u6211\u7684ELF\u68c0\u6d4b\u4e00\u76f4\u8fc7\u4e0d\u53bb\u3002</p> <p>\u5f00\u5934\u7684 ident \u4e00\u76f4\u662f OggS\u3002\u4e00\u5ea6\u6000\u7591\u662f\u7f16\u8bd1\u94fe\u63a5\u7684\u987a\u5e8f\u95ee\u9898</p> <p></p> <p>\u79bb\u8c31\u7684\u662f\uff0c\u6211\u751a\u81f3\u624b\u52a8\u8c03\u6574\u4e86 <code>ramdisk.img</code> \u91cc\u9762\u7684\u987a\u5e8f\uff0c\u5148\u628a ELF \u653e\u5230\u4e86\u5f00\u5934\uff0c\u4f46\u662f\u4e4b\u540e\u5404\u79cd\u95ee\u9898\u51fa\u73b0\u3002\u60f3\u5230\u6d4b\u8bd5\u7a0b\u5e8f\u5e94\u8be5\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u81ea\u5df1\u7684loader\u90e8\u5206\u6709\u70b9\u95ee\u9898\uff0c\u8981\u4e48\u662f\u504f\u79fb\u9519\u4e86\uff0c\u8981\u4e48\u5b9e\u73b0\u9519\u4e86\uff0c\u53d1\u73b0\u786e\u5b9e\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_15","title":"\u4e00\u5207\u7686\u6587\u4ef6","text":"<p>\u6587\u4ef6\u7684\u672c\u8d28\u5c31\u662f\u5b57\u8282\u5e8f\u5217\u3002\u4f8b\u5b50\uff1a</p> <ul> <li>\u5185\u5b58\u662f\u4ee5\u5b57\u8282\u7f16\u5740\u7684, \u5929\u7136\u5c31\u662f\u4e00\u4e2a\u5b57\u8282\u5e8f\u5217, \u56e0\u800c\u6211\u4eec\u4e4b\u524d\u4f7f\u7528\u7684ramdisk\u4f5c\u4e3a\u5b57\u8282\u5e8f\u5217\u4e5f\u66f4\u52a0\u663e\u800c\u6613\u89c1\u4e86</li> <li>\u7ba1\u9053(shell\u547d\u4ee4\u4e2d\u7684<code>|</code>)\u662f\u4e00\u79cd\u5148\u8fdb\u5148\u51fa\u7684\u5b57\u8282\u5e8f\u5217, \u672c\u8d28\u4e0a\u5b83\u662f\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u961f\u5217\u7f13\u51b2\u533a</li> <li>\u78c1\u76d8\u4e5f\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u5b57\u8282\u5e8f\u5217: \u6211\u4eec\u53ef\u4ee5\u4e3a\u78c1\u76d8\u4e0a\u7684\u6bcf\u4e00\u4e2a\u5b57\u8282\u8fdb\u884c\u7f16\u53f7, \u4f8b\u5982\u7b2cx\u67f1\u9762\u7b2cy\u78c1\u5934\u7b2cz\u6247\u533a\u4e2d\u7684\u7b2cn\u5b57\u8282, \u628a\u78c1\u76d8\u4e0a\u7684\u6240\u6709\u5b57\u8282\u6309\u7167\u7f16\u53f7\u7684\u5927\u5c0f\u8fdb\u884c\u6392\u5217, \u4fbf\u5f97\u5230\u4e86\u4e00\u4e2a\u5b57\u8282\u5e8f\u5217</li> <li>socket(\u7f51\u7edc\u5957\u63a5\u5b57)\u4e5f\u662f\u4e00\u79cd\u5b57\u8282\u5e8f\u5217, \u5b83\u6709\u4e00\u4e2a\u7f13\u51b2\u533a, \u8d1f\u8d23\u5b58\u653e\u63a5\u6536\u5230\u7684\u7f51\u7edc\u6570\u636e\u5305, \u4e0a\u5c42\u5e94\u7528\u5c06socket\u4e2d\u7684\u5185\u5bb9\u770b\u505a\u662f\u5b57\u8282\u5e8f\u5217, \u5e76\u901a\u8fc7\u4e00\u4e9b\u7279\u6b8a\u7684\u6587\u4ef6\u64cd\u4f5c\u6765\u5904\u7406\u5b83\u4eec. \u6211\u4eec\u5728PA2\u4e2d\u4ecb\u7ecd\u4e86DiffTest, \u5982\u679c\u4f60RTFSC, \u5c31\u4f1a\u53d1\u73b0\u5176\u4e2d\u7684<code>qemu-diff</code>\u5c31\u662f\u901a\u8fc7socket\u4e0eQEMU\u8fdb\u884c\u901a\u4fe1\u7684, \u800c\u64cd\u4f5csocket\u7684\u65b9\u5f0f\u5c31\u662f<code>fgetc()</code>\u548c<code>fputc()</code></li> <li>\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u4e9b\u4fe1\u606f\u53ef\u4ee5\u4ee5\u5b57\u8282\u5e8f\u5217\u7684\u65b9\u5f0f\u66b4\u9732\u7ed9\u7528\u6237, \u4f8b\u5982CPU\u7684\u914d\u7f6e\u4fe1\u606f</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u4e00\u4e9b\u7279\u6b8a\u7684\u529f\u80fd, \u5982\u968f\u673a\u6570\u751f\u6210\u5668, \u4e5f\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u65e0\u7a77\u957f\u7684\u5b57\u8282\u5e8f\u5217</li> <li>\u751a\u81f3\u4e00\u4e9b\u975e\u5b58\u50a8\u7c7b\u578b\u7684\u786c\u4ef6\u4e5f\u53ef\u4ee5\u770b\u6210\u662f\u5b57\u8282\u5e8f\u5217: \u6211\u4eec\u5728\u952e\u76d8\u4e0a\u6309\u987a\u5e8f\u6572\u5165\u6309\u952e\u7684\u7f16\u7801\u5f62\u6210\u4e86\u4e00\u4e2a\u5b57\u8282\u5e8f\u5217, \u663e\u793a\u5668\u4e0a\u6bcf\u4e00\u4e2a\u50cf\u7d20\u7684\u5185\u5bb9\u6309\u7167\u5176\u987a\u5e8f\u4e5f\u53ef\u4ee5\u770b\u505a\u662f\u5b57\u8282\u5e8f\u5217...</li> </ul> <p>\u65e2\u7136\u6587\u4ef6\u5c31\u662f\u5b57\u8282\u5e8f\u5217, \u90a3\u5f88\u81ea\u7136\u5730, \u4e0a\u9762\u8fd9\u4e9b\u4e94\u82b1\u516b\u95e8\u7684\u5b57\u8282\u5e8f\u5217\u5e94\u8be5\u90fd\u53ef\u4ee5\u770b\u6210\u6587\u4ef6. Unix\u5c31\u662f\u8fd9\u6837\u505a\u7684, \u56e0\u6b64\u6709\"\u4e00\u5207\u7686\u6587\u4ef6\"(Everything is a file)\u7684\u8bf4\u6cd5. </p> <p>\u771f\u662f\u592a\u5389\u5bb3\u4e86\uff01</p> <p>\u66f4\u8fdb\u4e00\u6b65\u7684\u4f8b\u5b50\uff1a</p> <p>\u8fd9\u79cd\u505a\u6cd5\u6700\u76f4\u89c2\u7684\u597d\u5904\u5c31\u662f\u4e3a\u4e0d\u540c\u7684\u4e8b\u7269\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u63a5\u53e3: \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u7684\u63a5\u53e3\u6765\u64cd\u4f5c\u8ba1\u7b97\u673a\u4e0a\u7684\u4e00\u5207, \u800c\u4e0d\u5fc5\u5bf9\u5b83\u4eec\u8fdb\u884c\u8be6\u7ec6\u7684\u533a\u5206: \u4f8b\u5982 <code>navy-apps/Makefile</code>\u7684<code>ramdisk</code>\u89c4\u5219\u901a\u8fc7\u7ba1\u9053\u628a\u5404\u4e2ashell\u5de5\u5177\u7684\u8f93\u5165\u8f93\u51fa\u8fde\u8d77\u6765, \u751f\u6210\u6587\u4ef6\u8bb0\u5f55\u8868</p> <pre><code>wc -c $(FSIMG_FILES) | grep -v 'total$$' | sed -e 's+ ./fsimg+ +' |\n  awk -v sum=0 '{print \"\\x7b\\x22\" $$2 \"\\x22\\x2c \" $$1 \"\\x2c \" sum \"\\x7d\\x2c\";sum += $$1}' &gt;&gt; $(RAMDISK_H)\n</code></pre> <p>\u81f3\u6211\u4eec\u5728PA2\u4e2d\u63d0\u4f9b\u7684\"\u5c0f\u661f\u661f\"\u793a\u4f8b\u97f3\u9891, \u4e5f\u662f\u901a\u8fc7\u7b80\u5355\u7684\u6587\u4ef6\u64cd\u4f5c\u66b4\u529b\u62fc\u63a5\u800c\u6210\u7684</p> <pre><code>cat Do.ogg Do.ogg So.ogg So.ogg La.ogg La.ogg So.ogg &gt; little-star.ogg\n</code></pre> <p>more...</p>"},{"location":"ysyx/pa/pa3/pa3.html#_16","title":"\u865a\u62df\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5b9e\u73b0 VFS \u7684\u5173\u952e</p> <pre><code>typedef struct {\n  char *name;         // \u6587\u4ef6\u540d\n  size_t size;        // \u6587\u4ef6\u5927\u5c0f\n  size_t disk_offset;  // \u6587\u4ef6\u5728ramdisk\u4e2d\u7684\u504f\u79fb\n  ReadFn read;        // \u8bfb\u51fd\u6570\u6307\u9488\n  WriteFn write;      // \u5199\u51fd\u6570\u6307\u9488\n} Finfo;\n</code></pre> <p>\u5176\u4e2d<code>ReadFn</code>\u548c<code>WriteFn</code>\u5206\u522b\u662f\u4e24\u79cd\u51fd\u6570\u6307\u9488, \u5b83\u4eec\u7528\u4e8e\u6307\u5411\u771f\u6b63\u8fdb\u884c\u8bfb\u5199\u7684\u51fd\u6570, \u5e76\u8fd4\u56de\u6210\u529f\u8bfb\u5199\u7684\u5b57\u8282\u6570. \u6709\u4e86\u8fd9\u4e24\u4e2a\u51fd\u6570\u6307\u9488, \u6211\u4eec\u53ea\u9700\u8981\u5728\u6587\u4ef6\u8bb0\u5f55\u8868\u4e2d\u5bf9\u4e0d\u540c\u7684\u6587\u4ef6\u8bbe\u7f6e\u4e0d\u540c\u7684\u8bfb\u5199\u51fd\u6570, \u5c31\u53ef\u4ee5\u901a\u8fc7<code>f-&gt;read()</code>\u548c<code>f-&gt;write()</code>\u7684\u65b9\u5f0f\u6765\u8c03\u7528\u5177\u4f53\u7684\u8bfb\u5199\u51fd\u6570\u4e86.</p> <ul> <li> <p>\u9605\u8bfb</p> <p>\u7528C\u8bed\u8a00\u6a21\u62df\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b</p> <p>VFS\u7684\u5b9e\u73b0\u5c55\u793a\u4e86\u5982\u4f55\u7528C\u8bed\u8a00\u6765\u6a21\u62df\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5: \u4f8b\u5982\u901a\u8fc7\u7ed3\u6784\u4f53\u6765\u5b9e\u73b0\u7c7b\u7684\u5b9a\u4e49, \u7ed3\u6784\u4f53\u4e2d\u7684\u666e\u901a\u53d8\u91cf\u53ef\u4ee5\u770b\u4f5c\u7c7b\u7684\u6210\u5458, \u51fd\u6570\u6307\u9488\u5c31\u53ef\u4ee5\u770b\u4f5c\u7c7b\u7684\u65b9\u6cd5, \u7ed9\u51fd\u6570\u6307\u9488\u8bbe\u7f6e\u4e0d\u540c\u7684\u51fd\u6570\u53ef\u4ee5\u5b9e\u73b0\u65b9\u6cd5\u7684\u91cd\u8f7d...</p> <p>\u8fd9\u8bf4\u660e, OOP\u4e2d\u90a3\u4e9b\u770b\u4f3c\u865a\u65e0\u7f25\u7f08\u7684\u6982\u5ff5\u4e5f\u6ca1\u6bd4C\u8bed\u8a00\u9ad8\u7ea7\u5230\u54ea\u91cc\u53bb, \u53ea\u4e0d\u8fc7\u662fOOP\u7684\u7f16\u8bd1\u5668\u5e2e\u6211\u4eec\u505a\u4e86\u66f4\u591a\u7684\u4e8b\u60c5, \u7f16\u8bd1\u6210\u673a\u5668\u4ee3\u7801\u4e4b\u540e, OOP\u4e5f\u5c31\u4e0d\u5b58\u5728\u4e86. </p> <p>Object-Oriented Programming With ANSI-C \u8fd9\u672c\u4e66\u4e13\u95e8\u4ecb\u7ecd\u4e86\u5982\u4f55\u7528ANSI-C\u6765\u6a21\u62dfOOP\u7684\u5404\u79cd\u6982\u5ff5\u548c\u529f\u80fd. \u5728GNU/Linux\u7684\u5185\u6838\u4ee3\u7801\u4e2d, \u5f88\u591a\u5730\u65b9\u4e5f\u6709OOP\u7684\u5f71\u5b50.</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#ioe","title":"\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a\u7684 IOE","text":"<p>\u57fa\u4e8e VFS \u5c06 IOE \u62bd\u8c61\u6210\u6587\u4ef6\u3002</p> <ul> <li> <p>\u5b9e\u73b0gettimeofday</p> <p>\u8fd9\u91cc\u518d\u63d0\u9192\u4e00\u53e5\uff1a\u4e0a\u5c42\u7684\u5e93\u51fd\u6570\uff0c\u7531Newlibc\u63d0\u4f9b\uff0c\u4f46\u662f\u5b83\u4f9d\u8d56\u7684\u7cfb\u7edf\u7cfb\u7edf\u8c03\u7528\u662f\u7531\u5176\u6240\u5728 OS \u63d0\u4f9b\u7684\u3002\uff08\u8fd9\u91cc\u7684\u662flibos\uff09</p> </li> </ul> <p>\u4f7f\u7528 ioe_read \u8fd8\u662f io_read \uff1f\u63d0\u4f9b\u7ed9 <code>nanos-lite</code> \u7684\u7a76\u7adf\u662f \u54ea\u4e2a\uff1f</p> <p>\u770b\u770b am-test\u5c31\u77e5\u9053\u4e86\u3002</p> <p>io_read</p> <pre><code>#define io_read(reg) \\\n  ({ reg##_T __io_param; \\\n    ioe_read(reg, &amp;__io_param); \\\n    __io_param; })\n\n#define io_write(reg, ...) \\\n  ({ reg##_T __io_param = (reg##_T) { __VA_ARGS__ }; \\\n    ioe_write(reg, &amp;__io_param); })\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6211\u4eec\u628a\u6587\u4ef6\u770b\u6210\u5b57\u8282\u5e8f\u5217, \u5927\u90e8\u5206\u5b57\u8282\u5e8f\u5217\u90fd\u662f\"\u9759\u6b62\"\u7684, \u4f8b\u5982\u5bf9\u4e8eramdisk\u548c\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6, \u5982\u679c\u6211\u4eec\u4e0d\u5bf9\u5b83\u4eec\u8fdb\u884c\u4fee\u6539, \u5b83\u4eec\u5c31\u4f1a\u4e00\u76f4\u4f4d\u4e8e\u540c\u4e00\u4e2a\u5730\u65b9, \u8fd9\u6837\u7684\u5b57\u8282\u5e8f\u5217\u5177\u6709\"\u4f4d\u7f6e\"\u7684\u6982\u5ff5; \u4f46\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u5b57\u8282\u5e8f\u5217\u5e76\u4e0d\u662f\u8fd9\u6837, \u4f8b\u5982\u952e\u5165\u6309\u952e\u7684\u5b57\u8282\u5e8f\u5217\u662f\"\u6d41\u52a8\"\u7684, \u88ab\u8bfb\u51fa\u4e4b\u540e\u5c31\u4e0d\u5b58\u5728\u4e86, \u8fd9\u6837\u7684\u5b57\u8282\u5e8f\u5217\u4e2d\u7684\u5b57\u8282\u4e4b\u95f4\u53ea\u6709\u987a\u5e8f\u5173\u7cfb, \u4f46\u65e0\u6cd5\u7f16\u53f7, \u56e0\u6b64\u5b83\u4eec\u6ca1\u6709\"\u4f4d\u7f6e\"\u7684\u6982\u5ff5. </p> <p>\u5c5e\u4e8e\u524d\u8005\u7684\u6587\u4ef6\u652f\u6301<code>lseek</code>\u64cd\u4f5c, \u5b58\u50a8\u8fd9\u4e9b\u6587\u4ef6\u7684\u8bbe\u5907\u79f0\u4e3a\"\u5757\u8bbe\u5907\"; \u800c\u5c5e\u4e8e\u540e\u8005\u7684\u6587\u4ef6\u5219\u4e0d\u652f\u6301<code>lseek</code>\u64cd\u4f5c, \u76f8\u5e94\u7684\u8bbe\u5907\u79f0\u4e3a\"\u5b57\u7b26\u8bbe\u5907\". \u771f\u5b9e\u7684\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u4f1a\u5bf9<code>lseek</code>\u64cd\u4f5c\u8fdb\u884c\u62bd\u8c61, \u6211\u4eec\u5728Nanos-lite\u4e2d\u8fdb\u884c\u4e86\u7b80\u5316, \u5c31\u4e0d\u5b9e\u73b0\u8fd9\u4e00\u62bd\u8c61\u4e86.</p> <p>\u7528fopen()\u8fd8\u662fopen()?</p> <p>\u8fd9\u662f\u4e2a\u975e\u5e38\u503c\u5f97\u601d\u8003\u7684\u95ee\u9898. \u4f60\u9700\u8981\u601d\u8003\u8fd9\u4e24\u7ec4API\u5177\u4f53\u884c\u4e3a\u7684\u533a\u522b, \u7136\u540e\u5206\u6790<code>/dev/events</code>\u8fd9\u4e2a\u7279\u6b8a\u6587\u4ef6\u5e94\u8be5\u7528\u54ea\u79cd\u51fd\u6570\u6765\u64cd\u4f5c. \u6211\u4eec\u5df2\u7ecf\u5728\u67d0\u4e00\u4e2a\u84dd\u8272\u4fe1\u606f\u6846\u4e2d\u7ed9\u51fa\u4e00\u4e9b\u63d0\u793a\u4e86.</p> <p>\u6807\u51c6 IO \u548c \u7cfb\u7edf\u8c03\u7528/\u4f4e\u7ea7 IO \u7684\u91cd\u8981\u533a\u522b\u5c31\u5728\u4e8e\u6709\u6ca1\u6709\u7f13\u51b2\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u5b57\u7b26\u8bbe\u5907 <code>/dev/events</code> \u3002\u6211\u80fd\u7406\u89e3\u4e3a\u5199\u5165\u901f\u5ea6\u975e\u5e38\u6162\uff0c\u5e76\u4e0d\u9700\u8981\u7f13\u51b2\uff0c\u6240\u4ee5\u7528 open \u5373\u53ef\u3002</p> <p>\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u533a\u522b\u5c31\u662f\u53ef\u79fb\u690d\u6027\uff0c\u4f46\u662f\u5728PA\u4e2d\u6ca1\u6709\u8fdb\u4e00\u6b65\u5c55\u73b0\uff0c\u5148\u4e0d\u8ba8\u8bba\u3002</p> <p>\u8fd9\u91cc\u7684 open \u4e3a\u4ec0\u4e48\u6709\u4e24\u4e2a\u58f0\u660e\uff1fC\u8bed\u8a00\u4e0d\u662f\u4e0d\u652f\u6301\u51fd\u6570\u91cd\u8f7d\u5417\uff1f\u5e94\u8be5\u4f7f\u7528\u7684\u4ec0\u4e48\u624b\u6bb5\u5b9e\u73b0\u7684\uff1f\u53d8\u53c2\uff1f</p> </li> </ul> <p>\u5b8c\u6210PA3.3\u7684\u7b2c\u4e00\u90e8\u5206\u540e\uff0c\u597d\u597d\u7406\u89e3\u8fd9\u4e2aVFS\uff0c\u611f\u89c9\u725b\u903c\u7684</p> <ul> <li> <p>\u5728NDL\u4e2d\u83b7\u53d6\u5c4f\u5e55\u5927\u5c0f</p> <p>\u5173\u4e8e\u753b\u5e03\u548c\u5c4f\u5e55\u5927\u5c0f\u600e\u4e48\u7406\u89e3\uff1f</p> <p>\u5176\u4e2d\"\u753b\u5e03\"\u662f\u4e00\u4e2a\u9762\u5411\u7a0b\u5e8f\u7684\u6982\u5ff5, \u7a0b\u5e8f\u7ed8\u56fe\u65f6\u7684\u5750\u6807\u90fd\u662f\u9488\u5bf9\u753b\u5e03\u6765\u8bbe\u5b9a\u7684, \u8fd9\u6837\u7a0b\u5e8f\u5c31\u65e0\u9700\u5173\u5fc3\u7cfb\u7edf\u5c4f\u5e55\u7684\u5927\u5c0f, \u4ee5\u53ca\u9700\u8981\u5c06\u56fe\u50cf\u7ed8\u5236\u5230\u7cfb\u7edf\u5c4f\u5e55\u7684\u54ea\u4e00\u4e2a\u4f4d\u7f6e. </p> <p>NDL\u53ef\u4ee5\u6839\u636e\u7cfb\u7edf\u5c4f\u5e55\u5927\u5c0f\u4ee5\u53ca\u753b\u5e03\u5927\u5c0f, \u6765\u51b3\u5b9a\u5c06\u753b\u5e03\"\u8d34\"\u5230\u54ea\u91cc, \u4f8b\u5982\u8d34\u5230\u5c4f\u5e55\u5de6\u4e0a\u89d2\u6216\u8005\u5c45\u4e2d, \u4ece\u800c\u5c06\u753b\u5e03\u7684\u5185\u5bb9\u5199\u5165\u5230frame buffer\u4e2d\u6b63\u786e\u7684\u4f4d\u7f6e.</p> </li> </ul> <p>\u53e6\u5916\uff0c\u8fd9\u91cc\u9700\u8981\u5c06\u5c4f\u5e55\u5927\u5c0f\u4ece <code>buf</code> \u4e2d\u8bfb\u51fa\u6765\uff0c\u7528 <code>sscanf</code> \uff1f\u4f46\u662f\u6211\u597d\u50cf\u6ca1\u6709\u5b9e\u73b0\u8fd9\u4e2a\u5e93\u51fd\u6570\uff1f\u56de\u60f3\u4e00\u4e0b\u81ea\u5df1\u7684\u5b9e\u73b0</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u7528\u6237\u7a0b\u5e8f\u8fdb\u884c\u6807\u51c6\u8f93\u5165\u8f93\u51fa, \u64cd\u4f5c\u7cfb\u7edf\u51c6\u5907\u4e86\u4e09\u4e2a\u9ed8\u8ba4\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26:</p> <pre><code>#define FD_STDIN 0\n#define FD_STDOUT 1\n#define FD_STDERR 2\n</code></pre> <p>\u5b83\u4eec\u5206\u522b\u5bf9\u5e94\u6807\u51c6\u8f93\u5165<code>stdin</code>, \u6807\u51c6\u8f93\u51fa<code>stdout</code>\u548c\u6807\u51c6\u9519\u8bef<code>stderr</code>. </p> <p>\u6211\u4eec\u5e38\u4f7f\u7528\u7684printf, \u6700\u7ec8\u4f1a\u8c03\u7528<code>write(FD_STDOUT, buf, len)</code>\u8fdb\u884c\u8f93\u51fa; \u800cscanf\u5c06\u4f1a\u901a\u8fc7\u8c03\u7528<code>read(FD_STDIN, buf, len)</code>\u8fdb\u884c\u8bfb\u5165.</p> <p>\u800c <code>write</code>/<code>read</code> \u7cfb\u7edf\u8c03\u7528\u8fdb\u4e00\u6b65\u8c03\u7528 <code>fs_write</code>/<code>fs_read</code>\uff0c\u8fdb\u800c\u5728\u91cc\u9762\u5224\u65ad\u662f\u4e0d\u662f\u6709\u81ea\u5df1\u7684\u90a3\u5957\u8bfb/\u5199\u51fd\u6570</p> <p></p> <p>\u6240\u4ee5\u61c2\u4e86\uff0c\u672c\u8d28\u4e0a\u8fd8\u662f\u8c03\u7528\u7684 <code>ram_disk_read</code>\u3002</p> <ul> <li> <p>\u628aVGA\u663e\u5b58\u62bd\u8c61\u6210\u6587\u4ef6</p> <ol> <li> <p>write\uff1a</p> <p>\u8fd9\u91cc\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u9047\u5230\u4e86\u4e2a\u95ee\u9898\uff0c\u53d1\u73b0\u6211\u7684 lseek \u7684\u504f\u79fb\u91cf\u6709\u70b9\u95ee\u9898\uff0c\u5199\u5165\u662f\u5bf9\u7684\uff0c\u4f46\u5230wrtie\u8bfb\u53d6\u7684\u65f6\u4e00\u76f4\u8bfb\u4e3a0\uff0c\u6709\u70b9\u5947\u602a\u3002</p> <p>\u8fd9\u5b9e\u9645\u4e0a\u548c\u6211\u5728\u5b9e\u73b0\u4e32\u53e3\u65f6\u5b9e\u73b0\u7684 <code>fs_write</code> \u548c <code>fs_read</code> \u6709\u5173\u3002</p> <p>\u5bf9\u4e8e\u7279\u5b9a\u8bbe\u5907\uff0c\u6307\u5b9a\u4e86\u8bfb\u5199\u51fd\u6570\u7684\u7684\u65f6\u5019\uff0c\u6211\u662f\u4f7f\u7528\u76f4\u63a5\u4f20\u5165 <code>offset</code> \u4e3a 0\uff0c\u56e0\u4e3a\u76f4\u63a5\u5e26\u5165\u4e86\u4e32\u53e3\u7684 <code>offset</code>\uff0c\u6ca1\u6709\u8003\u8651\u8fc7\u540e\u9762\u7684\uff1a\uff08\u8fd9\u91cc\u6216\u8bb8\u4e4b\u540e\u6539\u4e00\u4e9b\uff0c\u6539\u4e3a\u7279\u5b9a\u7684fd\uff0c\u5c06\u6240\u6709\u7684VFS\u63a5\u53e3\u7684\u8bfb\u5199\u51fd\u6570\u90fd\u521d\u59cb\u5316\u4e3a <code>ramdisk_read/ramdisk_write</code> \u597d\u4e86\uff09</p> <pre><code>    if (file_table[fd].read !=  NULL)\n        return file_table[fd].read(buf, 0, len);\n\n    if (file_table[fd].write != NULL)\n        return file_table[fd].write(buf, 0, len);\n</code></pre> <p>\u8fd9\u6837\u5b50\uff0c\u5982\u679c\u9700\u8981\u914d\u5408 <code>lseek</code> \u4f7f\u7528 <code>read/write</code> \u90a3\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> <p>\u65e5\u5fd7\u6587\u4ef6\u3001\u591a\u8fdb\u7a0b\u591a\u6587\u4ef6\u7684\u64cd\u4f5c\u3001<code>metadata</code> \u7684\u5904\u7406 </p> <p>\u8fd8\u662f\u6ca1\u6709\u5bf9 VFS \u7406\u89e3\u3002</p> </li> <li> <p>\u5173\u4e8e\u50cf\u7d20</p> <pre><code>void NDL_DrawRect(uint32_t *pixels, int x, int y, int w, int h) {\n    assert(w &gt; 0 &amp;&amp; w &lt;= screen_w);\n    assert(h &gt; 0 &amp;&amp; h &lt;= screen_h);\n    if (w == 0 &amp;&amp; h == 0) {\n        w = screen_w;\n        h = screen_h;\n    }\n    x += (screen_w - canvas_w) / 2;\n    y += (screen_h - canvas_h) / 2;\n    for (int row = 0; row &lt; h; row++) {\n        int offset = (y + row) * screen_w + x;\n        lseek(fbdev, offset * 4, SEEK_SET);\n        write(fbdev, pixels + (row * w), w * 4);\n        //fseek(fbdev, (long)offset, SEEK_SET); // \u4e58\u4ee5 sizeof(uint32_t) \u6765\u5f97\u5230\u5b57\u8282\u504f\u79fb\u91cf\n        //fwrite(pixels + (row * w), 4, w, fbdev); \n    }\n}\n</code></pre> <pre><code>size_t fb_write(const void *buf, size_t offset, size_t len) {    \n    offset /= 4;\n    ctl.pixels = (uint32_t *)buf;    \n    ctl.x = offset % screen_w;\n    ctl.y = offset / screen_w;\n    // line precedence\n    ctl.w = len / 4;\n    ctl.h = 1;\n    ctl.sync = true; // refresh now\n    io_write(AM_GPU_FBDRAW, ctl.x, ctl.y, ctl.pixels, ctl.w, ctl.h, ctl.sync);\n    return len;\n}\n</code></pre> <p>\u8fd9\u91cc\u7a76\u7adf\u8981\u4e0d\u8981\u4e58\u4ee54byte\u6765\u5bf9\u9f50\u50cf\u7d20\u7684\u5355\u4f4d\u3002</p> <p>\u8981\u4e48\u4f60\u90fd\u5bf9\u4e0a\uff0c\u8981\u4e48\u90fd\u4e0d\u5bf9\uff08nanos-lite\u548cndl\uff09</p> <p>\u5b9e\u9645\u4e0a\u4e5f\u5c31\u662f\u4e00\u6b21\u5199\u591a\u5c11\u4e2abyte\uff0c\u6709\u70b9\u50cf memcpy \u4e00\u6b21\u62f7\u8d1d\u591a\u4e2abyte\u7684\u4f18\u5316\u3002</p> </li> </ol> </li> <li> <p>\u5b9e\u73b0\u5c45\u4e2d\u7684\u753b\u5e03</p> <p>\u76f8\u5173\u51e0\u4f55\u8ba1\u7b97\u5373\u53ef\u3002</p> </li> <li> <p>\u5173\u4e8e\u7cfb\u7edf\u5c4f\u5e55(\u5373 <code>frame buffer</code> ), <code>NDL_OpenCanvas()</code>\u6253\u5f00\u7684\u753b\u5e03, \u4ee5\u53ca<code>NDL_DrawRect()</code>\u6307\u793a\u7684\u7ed8\u5236\u533a\u57df\u4e4b\u95f4\u7684\u4f4d\u7f6e\u5173\u7cfb.</p> <ol> <li>\u5c4f\u5e55\u5927\u5c0f\u5b9a\u4e49\u4e86\u7269\u7406\u663e\u793a\u8bbe\u5907\u7684\u663e\u793a\u80fd\u529b\u3002</li> <li>\u753b\u5e03\u662f\u7a0b\u5e8f\u7528\u6765\u7ed8\u5236\u56fe\u50cf\u7684\u865a\u62df\u7a7a\u95f4\uff0c\u5176\u5927\u5c0f\u548c\u4f4d\u7f6e\u53ef\u4ee5\u72ec\u7acb\u4e8e\u5c4f\u5e55\u5927\u5c0f\u3002</li> <li>\u663e\u5b58\u662f\u5b9e\u9645\u5b58\u50a8\u56fe\u50cf\u6570\u636e\u7684\u5730\u65b9\uff0c\u5176\u5185\u5bb9\u6700\u7ec8\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\u3002</li> </ol> <p><code>NDL_OpenCanvas</code> \u51fd\u6570\u7528\u4e8e\u8bbe\u7f6e\u753b\u5e03\u5927\u5c0f\uff0c <code>NDL_DrawRect</code> \u7528\u4e8e\u5c06\u753b\u5e03\u4e0a\u7684\u56fe\u50cf\u7ed8\u5236\u5230\u663e\u5b58\u7684\u6307\u5b9a\u4f4d\u7f6e\u3002</p> <p><code>dispinfo_read</code> \u51fd\u6570\u7528\u4e8e\u8bfb\u53d6\u5c4f\u5e55\u5927\u5c0f\u4fe1\u606f\uff0c\u4ee5\u4fbf\u6b63\u786e\u5730\u5c06\u753b\u5e03\u5185\u5bb9\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\u3002</p> </li> <li> <p>\u91cd\u8981</p> <p>\u68b3\u7406 VFS \u600e\u4e48\u5b9e\u73b0\u5404\u4e2a\u8bbe\u5907\u90fd\u62bd\u8c61\u7684\u3002\u5173\u4e8e\u5b57\u7b26\u8bbe\u5907\u548c\u5757\u8bbe\u5907\u3002</p> <p>\u7559\u5751 \u5b8c\u6210 PA3\u540e\u505a</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#pa33_1","title":"PA3.3\u7cbe\u5f69\u7eb7\u5448\u7684\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u53c8\u4e00\u6b21\u63d0\u9192\u4f60\u8be5\u68b3\u7406\u4e00\u4e0b\u5c42\u6b21\u73af\u5883\u4e86\u3002</p> <p>\u786c\u4ef6\u5c42NEMU --&gt; HAL AM --&gt; OS <code>nanos-lite</code> --&gt; \u7cfb\u7edf\u8c03\u7528\u63a5\u53e3 + <code>libc</code>  --&gt; <code>navy-apps</code> </p> <p>\u5728\u524d\u4e00\u8282\u4e3b\u8981\u5b9e\u73b0\u4e86\u5728 <code>Nanos-lite</code> \u5bf9\u786c\u4ef6\u6587\u4ef6\u7684\u8bfb\u5199\u3002\u4ee5 <code>NDL</code> \u4e3a\u4f8b\uff0c\u7b80\u5355\u5bf9\u5e95\u5c42\u8fdb\u884c\u4e86\u4e00\u4e9b\u5c01\u88c5\u3002</p> <p>\u73b0\u5728\u8981\u505a\u7684\u5e94\u8be5\u662f\u5728\u79fb\u690d\u522b\u7684\u5e93\uff08SDL\u3001fixedpt\u3001\uff09\uff0c\u5141\u8bb8\u66f4\u591a\u7684 <code>navy-apps</code> </p>"},{"location":"ysyx/pa/pa3/pa3.html#_17","title":"\u66f4\u4e30\u5bcc\u7684\u8fd0\u884c\u65f6\u73af\u5883","text":""},{"location":"ysyx/pa/pa3/pa3.html#_18","title":"\u591a\u5a92\u4f53\u5e93","text":""},{"location":"ysyx/pa/pa3/pa3.html#_19","title":"\u5b9a\u70b9\u7b97\u672f","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u6bd4\u8f83fixedpt\u548cfloat</p> <p><code>fixedpt</code>\u548c<code>float</code>\u7c7b\u578b\u7684\u6570\u636e\u90fd\u662f32\u4f4d, \u5b83\u4eec\u90fd\u53ef\u4ee5\u8868\u793a2^32\u4e2a\u4e0d\u540c\u7684\u6570. \u4f46\u7531\u4e8e\u8868\u793a\u65b9\u6cd5\u4e0d\u4e00\u6837, <code>fixedpt</code>\u548c<code>float</code>\u80fd\u8868\u793a\u7684\u6570\u96c6\u662f\u4e0d\u4e00\u6837\u7684. \u601d\u8003\u4e00\u4e0b, \u6211\u4eec\u7528<code>fixedpt</code>\u6765\u6a21\u62df\u8868\u793a<code>float</code>, \u8fd9\u5176\u4e2d\u9690\u542b\u7740\u54ea\u4e9b\u53d6\u820d?</p> <p>float \u7559\u5751\u3002</p> <p><code>fixedpt</code> \uff1a24.8\uff1a\u8868\u793a\u6574\u6570\u90e8\u5206\u536024\u4f4d, \u5c0f\u6570\u90e8\u5206\u53608\u4f4d, \u5b9e\u6570\u7684\u5c0f\u6570\u70b9\u603b\u662f\u56fa\u5b9a\u4f4d\u4e8e\u7b2c8\u4f4d\u4e8c\u8fdb\u5236\u6570\u7684\u5de6\u8fb9. \u672c\u8d28\u662f<code>int32_t</code>\u7c7b\u578b.</p> <p>\u5c06\u5c0f\u6570\u4e58 2<sup>8</sup> \u5de6\u79fb 8\u4f4d\uff0c\u8d85\u8fc7 8\u4f4d\u7684\u4e3a \u6574\u6570</p> <p>eg. <code>float 7.5</code> --&gt; <code>fixedpt 7.5 =</code>  7.5 * 2<sup>8</sup> </p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u795e\u5947\u7684fixedpt_rconst</p> <p>\u9605\u8bfb<code>fixedpt_rconst()</code>\u7684\u4ee3\u7801, \u4ece\u8868\u9762\u4e0a\u770b, \u5b83\u5e26\u6709\u975e\u5e38\u660e\u663e\u7684\u6d6e\u70b9\u64cd\u4f5c, \u4f46\u4ece\u7f16\u8bd1\u7ed3\u679c\u6765\u770b\u5374\u6ca1\u6709\u4efb\u4f55\u6d6e\u70b9\u6307\u4ee4. \u4f60\u77e5\u9053\u5176\u4e2d\u7684\u539f\u56e0\u5417?</p> <pre><code>#if FIXEDPT_BITS == 32\ntypedef int32_t fixedpt;\ntypedef int64_t fixedptd;\ntypedef uint32_t fixedptu;\ntypedef uint64_t fixedptud;\n#elif FIXEDPT_BITS == 64\ntypedef int64_t fixedpt;\ntypedef __int128_t fixedptd;\ntypedef uint64_t fixedptu;\ntypedef __uint128_t fixedptud;\n#else\n#error \"FIXEDPT_BITS must be equal to 32 or 64\"\n#endif\n\n#ifndef FIXEDPT_WBITS\n#define FIXEDPT_WBITS   24\n#endif\n\n...\n#define FIXEDPT_FBITS   (FIXEDPT_BITS - FIXEDPT_WBITS)\n...\n#define fixedpt_rconst(R) ((fixedpt)((R) * FIXEDPT_ONE + ((R) &gt;= 0 ? 0.5 : -0.5)))\n#define fixedpt_fromint(I) ((fixedptd)(I) &lt;&lt; FIXEDPT_FBITS)\n#define fixedpt_toint(F) ((F) &gt;&gt; FIXEDPT_FBITS)\n#define fixedpt_add(A,B) ((A) + (B))\n#define fixedpt_sub(A,B) ((A) - (B))\n#define fixedpt_fracpart(A) ((fixedpt)(A) &amp; FIXEDPT_FMASK)\n\n#define FIXEDPT_ONE ((fixedpt)((fixedpt)1 &lt;&lt; FIXEDPT_FBITS))\n</code></pre> <p>\u7c7b\u578b\u8f6c\u6362\u3002\u66f4\u91cd\u8981\u7684\u9760\u7f16\u8bd1\u5668\u8f6c\u6362\u51fa\u7ed3\u679c\u3002</p> <p>\u504f\u79fb\u91cf\uff1a<code>+0.5</code>\uff0c<code>-0.5</code>\uff1a\u5e38\u89c1\u7684 <code>round</code>\u64cd\u4f5c\uff1a\u56db\u820d\u4e94\u5165\u3002</p> <p>\u52a0\u4e0a\u8fd9\u4e2a\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u8f83\u63a5\u8fd1\u7684\u6d6e\u70b9\u6570\u3002</p> <p>\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b63\u5982\u8fd9\u4e2a\u5b8f\u7684\u540d\u5b57\u4e2d\u7684const\uff0c\u8fd9\u79cd\u8f6c\u6362\u53ea\u9002\u5408\u7f16\u8bd1\u671f\u7684\u8f6c\u6362\u3002\u5982\u679c\u662f\u8fd0\u884c\u65f6\u8f6c\u6362\uff0c\u5c31\u8981\u9760\u6211\u4eec\u5b9e\u73b0\u7684\u51e0\u4e2a API \u4e86\u3002</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u5c06\u6d6e\u70b9\u53d8\u91cf\u8f6c\u6362\u6210fixedpt\u7c7b\u578b?</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a<code>void *p</code>\u7684\u6307\u9488\u53d8\u91cf, \u5b83\u6307\u5411\u4e86\u4e00\u4e2a32\u4f4d\u53d8\u91cf, \u8fd9\u4e2a\u53d8\u91cf\u7684\u672c\u8d28\u662f<code>float</code>\u7c7b\u578b, \u5b83\u7684\u771f\u503c\u843d\u5728<code>fixedpt</code>\u7c7b\u578b\u53ef\u8868\u793a\u7684\u8303\u56f4\u4e2d. \u5982\u679c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u51fd\u6570<code>fixedpt fixedpt_fromfloat(void *p)</code>, \u5982\u4f55\u5728\u4e0d\u5f15\u5165\u6d6e\u70b9\u6307\u4ee4\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u5b83?</p> <p>\u5728\u4e0d\u4f7f\u7528\u6d6e\u70b9\u6307\u4ee4\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u56fa\u5b9a\u70b9\u6570\uff08fixedpt\uff09\u9700\u8981\u4e00\u4e9b\u4f4d\u64cd\u4f5c\u548c\u6570\u5b66\u8ba1\u7b97\u3002\u8fd9\u91cc\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u8f6c\u6362\u65b9\u6cd5\uff0c\u5b83\u5c06\u4e00\u4e2a\u4ee5 <code>void*</code> \u6307\u9488\u5f62\u5f0f\u7ed9\u51fa\u7684 <code>float</code> \u503c\u8f6c\u6362\u4e3a <code>fixedpt</code> \u7c7b\u578b\uff1a</p> <ol> <li>\u8bfb\u53d6\u6d6e\u70b9\u6570\u7684\u4f4d\u8868\u793a\uff1a\u9996\u5148\uff0c\u5c06 <code>float</code> \u503c\u7684\u5185\u5b58\u8868\u793a\u590d\u5236\u5230\u4e00\u4e2a <code>int</code> \u7c7b\u578b\u7684\u53d8\u91cf\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u8bbf\u95ee\u5176\u4f4d\u6a21\u5f0f\u3002</li> <li>\u89e3\u91ca\u4e3a\u6574\u6570\uff1a\u5c06\u8fd9\u4e2a <code>int</code> \u503c\u89e3\u91ca\u4e3a\u4e00\u4e2a <code>float</code> \u7684\u4f4d\u6a21\u5f0f\uff0c\u7136\u540e\u6839\u636e IEEE 754 \u6807\u51c6\u89e3\u91ca\u5176\u7b26\u53f7\u3001\u6307\u6570\u548c\u5c3e\u6570\u3002</li> <li>\u7f29\u653e\u548c\u820d\u5165\uff1a\u5c06\u6d6e\u70b9\u6570\u7684\u5c3e\u6570\u90e8\u5206\u4e58\u4ee5\u4e00\u4e2a\u7f29\u653e\u56e0\u5b50\uff08\u4f8b\u5982\uff0c\u5982\u679c <code>fixedpt</code> \u662f 24 \u4f4d\u6574\u6570\uff0c\u7f29\u653e\u56e0\u5b50\u53ef\u4ee5\u662f (2^{8})\uff09\uff0c\u7136\u540e\u820d\u5165\u5230\u6700\u8fd1\u7684\u6574\u6570\u3002</li> <li>\u7ec4\u5408\u7ed3\u679c\uff1a\u5c06\u7f29\u653e\u548c\u820d\u5165\u540e\u7684\u6574\u6570\u90e8\u5206\u4e0e\u539f\u59cb\u7b26\u53f7\u7ec4\u5408\uff0c\u5f62\u6210\u6700\u7ec8\u7684 <code>fixedpt</code> \u503c\u3002</li> </ol> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5b9e\u73b0\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;assert.h&gt;\n\ntypedef int fixedpt; // \u5047\u8bbefixedpt\u662f32\u4f4d\u6574\u6570\n\n// \u5c06void*\u6307\u9488\u8f6c\u6362\u4e3afloat*\u6307\u9488\nstatic inline float *float_ptr(void *p) {\n    return (float*)p;\n}\n\n// \u5c06float\u8f6c\u6362\u4e3afixedpt\nfixedpt fixedpt_fromfloat(void *p) {\n    float *f = float_ptr(p);\n    uint32_t f_bits = *(uint32_t*)f; // \u8bfb\u53d6float\u7684\u4f4d\u8868\u793a\n    int sign = (f_bits &gt;&gt; 31) ? -1 : 1; // \u7b26\u53f7\u4f4d\n    int exponent = ((f_bits &gt;&gt; 23) &amp; 0xFF) - 127; // \u6307\u6570\n    uint32_t mantissa = (f_bits &amp; 0x7FFFFF) | 0x800000; // \u5c3e\u6570\n\n    if (exponent == -127) { // \u68c0\u6d4b\u662f\u5426\u4e3a\u975e\u89c4\u683c\u5316\u6570\u6216\u7279\u6b8a\u503c\n        return 0; // \u7279\u6b8a\u503c\u6216\u975e\u89c4\u683c\u5316\u6570\uff0c\u8fd4\u56de0\n    }\n\n    // \u8ba1\u7b97\u5b9e\u9645\u7684\u6d6e\u70b9\u6570\u503c\n    fixedpt result = sign * (mantissa &lt;&lt; 8) * (1 &lt;&lt; (exponent - 23));\n    return result;\n}\n\nint main() {\n    float f = 3.14159265f; // \u6d4b\u8bd5\u6d6e\u70b9\u6570\n    fixedpt fx;\n\n    fx = fixedpt_fromfloat(&amp;f);\n    printf(\"Fixed point value: %d\\n\", fx);\n\n    assert(fx == 31457); // \u5047\u8bbefixedpt\u662f24\u4f4d\u6574\u6570\uff0c\u5c0f\u6570\u70b9\u56fa\u5b9a\u5728\u6700\u540e8\u4f4d\u4e4b\u524d\n\n    printf(\"All tests passed successfully!\\n\");\n    return 0;\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff1a - <code>fixedpt_fromfloat</code> \u51fd\u6570\u9996\u5148\u5c06 <code>void*</code> \u6307\u9488\u8f6c\u6362\u4e3a <code>float*</code> \u6307\u9488\u3002 - \u7136\u540e\u8bfb\u53d6 <code>float</code> \u503c\u7684\u4f4d\u8868\u793a\uff0c\u5e76\u5c06\u5176\u89e3\u91ca\u4e3a\u7b26\u53f7\u3001\u6307\u6570\u548c\u5c3e\u6570\u3002 - \u6700\u540e\uff0c\u8ba1\u7b97\u5b9e\u9645\u7684\u6d6e\u70b9\u6570\u503c\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a <code>fixedpt</code> \u7c7b\u578b\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5047\u8bbe <code>fixedpt</code> \u662f\u4e00\u4e2a 32 \u4f4d\u6574\u6570\uff0c\u4e14\u6d6e\u70b9\u6570\u7684\u503c\u5728 <code>fixedpt</code> \u7c7b\u578b\u53ef\u8868\u793a\u7684\u8303\u56f4\u5185\u3002\u5982\u679c\u6d6e\u70b9\u6570\u7684\u503c\u8d85\u51fa\u4e86 <code>fixedpt</code> \u7c7b\u578b\u7684\u8303\u56f4\uff0c\u53ef\u80fd\u9700\u8981\u989d\u5916\u7684\u9519\u8bef\u5904\u7406\u903b\u8f91\u3002\u6b64\u5916\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4f7f\u7528\u6d6e\u70b9\u6307\u4ee4\uff0c\u56e0\u6b64\u907f\u514d\u4e86\u6d6e\u70b9\u6570\u7684\u820d\u5165\u8bef\u5dee\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#navy","title":"Navy \u4f5c\u4e3a\u57fa\u7840\u8bbe\u65bd","text":"<p>\u4e2a\u4eba\u89c9\u5f97\u8bb2\u4e49\u7684\u8fd9\u90e8\u5206\u633a\u597d\u7684\uff0c\u5199\u4e0b\u6765</p> <p>\u5728 <code>am</code> \u4e2d\u6211\u4eec\u5e38\u4f1a\u7528 <code>ARCH=native</code> \u6765\u5bf9\u6bd4\u6d4b\u8bd5 <code>ARCH=riscv32-nemu</code> \u5b9e\u73b0\u7684 <code>am</code> \u7684 API \u662f\u5426\u6b63\u786e\uff1a</p> <pre><code>|------|\n| NEMU |\n|------| &lt;--- Linux native for am\u3001riscv32 for am \n|  AM  |\n|------|\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528 <code>Linux native</code> \u7684\u529f\u80fd\u6765\u5b9e\u73b0 <code>Navy</code> \u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u5373\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173\u7684\u8fd0\u884c\u65f6\u73af\u5883\uff1a</p> <ul> <li><code>libos</code></li> <li><code>libc (Newlib)</code></li> <li>\u4e00\u4e9b\u7279\u6b8a\u7684\u6587\u4ef6</li> </ul> <p>\u7c7b\u4f3c\u5728 <code>am</code> \u4e2d\u7528 <code>Linux native</code> \u7684\u529f\u80fd\u5b9e\u73b0AM\u7684API\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528 <code>Linux native</code> \u7684\u529f\u80fd\u6765\u5b9e\u73b0\u4e0a\u8ff0\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u4ece\u800c\u652f\u6491\u76f8\u540c\u7684Navy\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u6765\u5355\u72ec\u5bf9\u5b83\u4eec\u8fdb\u884c\u6d4b\u8bd5\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e0eNavy\u5e94\u7528\u7a0b\u5e8f\u7684\u89e3\u8026.</p> <p>\u6211\u4eec\u5728 Navy \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684 ISA \u53eb <code>native</code> \u6765\u5b9e\u73b0\u4e0a\u8ff0\u7684\u89e3\u8026\uff0c\u5b83\u548c\u5176\u5b83 ISA \u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a</p> <ul> <li>\u94fe\u63a5\u65f6\u7ed5\u5f00 <code>libos</code> \u548c <code>Newlib</code>\uff0c\u8ba9\u5e94\u7528\u7a0b\u5e8f\u76f4\u63a5\u94fe\u63a5 <code>Linux</code> \u7684 <code>glibc</code></li> <li>\u901a\u8fc7\u4e00\u4e9b <code>Linux native</code> \u7684\u673a\u5236\u5b9e\u73b0 <code>/dev/events</code>, <code>/dev/fb</code> \u7b49\u7279\u6b8a\u6587\u4ef6\u7684\u529f\u80fd\uff0c\u89c1 <code>navy-apps/libs/libos/src/native.cpp</code></li> <li>\u7f16\u8bd1\u5230 <code>Navy native</code> \u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>gdb</code> \u6765\u8c03\u8bd5\uff0c\u89c1 <code>navy-apps/scripts/native.mk</code>\uff0c\u800c\u7f16\u8bd1\u5230\u5176\u5b83 ISA \u7684\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u5728 <code>Nanos-lite</code> \u7684\u652f\u6491\u4e0b\u8fd0\u884c</li> </ul> <p>\u53ef\u4ee5\u5728\u6d4b\u8bd5\u7a0b\u5e8f\u6240\u5728\u7684\u76ee\u5f55\u4e0b\u8fd0\u884c <code>make ISA=native run</code>\uff0c\u6765\u628a\u6d4b\u8bd5\u7a0b\u5e8f\u7f16\u8bd1\u5230 Navy native \u4e0a\u5e76\u76f4\u63a5\u8fd0\u884c\u3002</p> <p>\u867d\u7136Navy\u7684 <code>native</code> \u548cAM\u4e2d\u7684 <code>native</code> \u540c\u540d\uff0c\u4f46\u5b83\u4eec\u7684\u673a\u5236\u662f\u4e0d\u540c\u7684:</p> <ul> <li>\u5728AM native\u4e0a\u8fd0\u884c\u7684\u7cfb\u7edf, \u9700\u8981AM, Nanos-lite, libos, libc\u8fd9\u4e9b\u62bd\u8c61\u5c42\u6765\u652f\u6491\u4e0a\u8ff0\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u5728AM\u4e2d\u7684 <code>ARCH=native</code>, \u5728Navy\u4e2d\u5bf9\u5e94\u7684\u662f<code>ISA=am_native</code>; \uff08\u4e5f\u5c31\u662f\u5bf9\u4e8e\u6211\u4e2a\u4eba\u5bf9\u7535\u8111\uff0c\u6211\u7684\u786c\u4ef6\u5e73\u53f0\u7684\u6307\u4ee4\u96c6\u662f X86 \u7684\uff0c\u6bcf\u4e2a\u4eba\u7684\u7535\u8111\u7684ISA\u4e0d\u4e00\u5b9a\u4e00\u6837\u3002\u4e5f\u5c31\u662f\u5728 NEMU\u3001AM\u8fd9\u4e00\u5c42\u7684\uff09</li> <li>\u800c\u5728Navy native\u4e2d, \u4e0a\u8ff0\u8fd0\u884c\u65f6\u73af\u5883\u662f\u76f4\u63a5\u7531Linux native\u5b9e\u73b0\u7684.\uff08\u4e5f\u5c31\u662f\u5728 Navy \u8fd9\u4e00\u5c42\uff0c\u7528 <code>Linux</code> \u539f\u751f\u5e73\u53f0\u7684\u5185\u5bb9\uff1a\uff09</li> </ul> <p>\u4f60\u53ef\u4ee5\u5728<code>bmp-test</code>\u6240\u5728\u7684\u76ee\u5f55\u4e0b\u8fd0\u884c<code>make ISA=native run</code>, \u6765\u628a<code>bmp-test</code>\u7f16\u8bd1\u5230Navy native\u4e0a\u5e76\u76f4\u63a5\u8fd0\u884c, \u8fd8\u53ef\u4ee5\u901a\u8fc7<code>make ISA=native gdb</code>\u5bf9\u5b83\u8fdb\u884c\u8c03\u8bd5. </p> <p>\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728Linux native\u7684\u73af\u5883\u4e0b\u5355\u72ec\u6d4b\u8bd5Navy\u4e2d\u9664\u4e86libos\u548cNewlib\u4e4b\u5916\u7684\u6240\u6709\u4ee3\u7801\u4e86(\u4f8b\u5982NDL\u548cminiSDL). </p> <p>\u5c31\u662f\u63a7\u5236\u53d8\u91cf</p> <p>\u6539\uff1a<code>bmp-test</code> \u53cd\u6620\u51fa\u4e00\u4e9b VGA \u7684\u4e00\u4e9b\u95ee\u9898\u3002\u4e4b\u524d <code>NDL_DrawRect</code> \u7684\u5b9e\u73b0\u4e2d\u6ca1\u6709\u8003\u8651\u5230 <code>lseek</code> \u548c <code>write</code> \u662f\u4ee5\u5b57\u8282\u5bfb\u5740\u7684\uff0c\u800c <code>pixels</code> \u7684\u5355\u4f4d\u4e3a <code>4</code> \u5b57\u8282\uff0c\u6240\u4ee5\u6b63\u786e\u7684\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>// \u5411\u753b\u5e03`(x, y)`\u5750\u6807\u5904\u7ed8\u5236`w*h`\u7684\u77e9\u5f62\u56fe\u50cf, \u5e76\u5c06\u8be5\u7ed8\u5236\u533a\u57df\u540c\u6b65\u5230\u5c4f\u5e55\u4e0a\n// \u56fe\u50cf\u50cf\u7d20\u6309\u884c\u4f18\u5148\u65b9\u5f0f\u5b58\u50a8\u5728`pixels`\u4e2d, \u6bcf\u4e2a\u50cf\u7d20\u752832\u4f4d\u6574\u6570\u4ee5`00RRGGBB`\u7684\u65b9\u5f0f\u63cf\u8ff0\u989c\u8272\nvoid NDL_DrawRect(uint32_t *pixels, int x, int y, int w, int h) {\n    if (w == 0 &amp;&amp; h == 0) {\n        w = screen_w;\n        h = screen_h;\n    }\n    assert(w &gt; 0 &amp;&amp; w &lt;= screen_w);\n    assert(h &gt; 0 &amp;&amp; y &lt;= screen_h);\n\n    //x += (screen_w - canvas_w) / 2;\n    //y += (screen_h - canvas_h) / 2;\n    // Directly modify the canvas offset coordinates on x, y\n    // Or define a reference variable\n    // int ref_x, ref_y; Adjust here, then add to x,y\n    for (int row = 0; row &lt; h; row++) {\n        int offset = (y + row) * screen_w + x;\n        lseek(fbdev, offset * 4, SEEK_SET);\n        write(fbdev, pixels + (row * w), w * 4);\n    }\n}\n\n// maybe also can write AM_GPU_FBDRAW directly\nsize_t fb_write(const void *buf, size_t offset, size_t len) {\n    AM_GPU_CONFIG_T ev = io_read(AM_GPU_CONFIG);\n    int width = ev.width;\n\n    offset /= 4;\n    len /= 4;\n    int y = offset / width;\n    int x = offset - y * width;\n\n    io_write(AM_GPU_FBDRAW, x, y, (void *)buf, len, 1, true);\n    return len;\n}\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u795e\u5947\u7684LD_PRELOAD</p> <p><code>bmp-test</code>\u9700\u8981\u6253\u5f00\u4e00\u4e2a\u8def\u5f84\u4e3a<code>/share/pictures/projectn.bmp</code>\u7684\u6587\u4ef6, \u4f46\u5728Linux native\u4e2d, \u8fd9\u4e2a\u8def\u5f84\u5bf9\u5e94\u7684\u6587\u4ef6\u5e76\u4e0d\u5b58\u5728. \u4f46\u6211\u4eec\u8fd8\u662f\u628a<code>bmp-test</code>\u6210\u529f\u8fd0\u884c\u8d77\u6765\u4e86, \u4f60\u77e5\u9053\u8fd9\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5417? \u5982\u679c\u4f60\u611f\u5174\u8da3, \u53ef\u4ee5\u5728\u4e92\u8054\u7f51\u4e0a\u641c\u7d22<code>LD_PRELOAD</code>\u76f8\u5173\u7684\u5185\u5bb9.</p> <p>LD_PRELOAD\u662fLinux\u7cfb\u7edf\u7684\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u5b83\u53ef\u4ee5\u5f71\u54cd\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u7684\u94fe\u63a5\uff08Runtime linker\uff09\uff0c\u5b83\u5141\u8bb8\u4f60\u5b9a\u4e49\u5728\u7a0b\u5e8f\u8fd0\u884c\u524d\u4f18\u5148\u52a0\u8f7d\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002</p> <p>\u8fd9\u4e2a\u529f\u80fd\u4e3b\u8981\u5c31\u662f\u7528\u6765\u6709\u9009\u62e9\u6027\u7684\u8f7d\u5165\u4e0d\u540c\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684\u76f8\u540c\u51fd\u6570\u3002\u901a\u8fc7\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e3b\u7a0b\u5e8f\u548c\u5176\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u4e2d\u95f4\u52a0\u8f7d\u522b\u7684\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u751a\u81f3\u8986\u76d6\u6b63\u5e38\u7684\u51fd\u6570\u5e93\u3002\u4e00\u65b9\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u6b64\u529f\u80fd\u6765\u4f7f\u7528\u81ea\u5df1\u7684\u6216\u662f\u66f4\u597d\u7684\u51fd\u6570\uff08\u65e0\u9700\u522b\u4eba\u7684\u6e90\u7801\uff09\uff0c\u800c\u53e6\u4e00\u65b9\u9762\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4ee5\u5411\u522b\u4eba\u7684\u7a0b\u5e8f\u6ce8\u5165\u7a0b\u5e8f\uff0c\u4ece\u800c\u8fbe\u5230\u7279\u5b9a\u7684\u76ee\u7684\u3002</p> <p><code>LD_PRELOAD</code>\u662f\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u53ea\u4f5c\u7528\u4e8e\u52a8\u6001\u94fe\u63a5\u7684\u5e93\uff0c\u7528\u4e8e\u6307\u793a\u52a0\u8f7d\u5668\u5728\u88c5\u5728C\u8bed\u8a00\u8fd0\u884c\u5e93\u4e4b\u524d\u8f7d\u5165<code>LD_PRELOAD</code>\u6307\u5b9a\u7684\u5171\u4eab\u94fe\u63a5\u5e93\uff0c\u8fbe\u5230 inject \u540c\u540d\u51fd\u6570\u7684\u76ee\u7684\u3002</p> <p>\u5728<code>navy-apps/scripts/native.mk</code>\u53ef\u4ee5\u770b\u5230,</p> <pre><code>run: app env\n  @LD_PRELOAD=$(NAVY_HOME)/libs/libos/build/native.so $(APP) $(mainargs)\n</code></pre> <p>\u901a\u8fc7\u52ab\u6301<code>fopen</code>\u3001<code>open</code>\u7b49\u9879\u76ee\u7528\u5230\u7684\u5e93\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u628a<code>path</code>\u91cd\u5b9a\u5411\u5230\u771f\u6b63\u7684\u78c1\u76d8\u4f4d\u7f6e\uff0c\u518d\u7528\u539f\u59cb\u7684<code>glibc</code>\u51fd\u6570\u53bb\u8c03\u7528\u3002</p> <p>\u53c2\u8003 ICS PA 3 (vgalaxy.work) \u8ddf\u7740\u8def\u5f84\u81ea\u5df1 RTFSC \u4e86\u4e00\u904d\uff0c\u4e5f\u662f\u5f88\u6709\u7528\uff0c\u8fd8\u662f\u6ca1\u5b66\u70b9 C++\uff0c\u611f\u89c9\u8fd8\u884c\u3002</p> <p>\u67e5\u770b\u7f16\u8bd1\u4fe1\u606f\uff1a</p> <pre><code>Redirecting file open: /share/pictures/projectn.bmp -&gt; /home/jai/ysyx-workbench/navy-apps/fsimg/share/pictures/projectn.bmp\n</code></pre> <pre><code>static inline void get_fsimg_path(char *newpath, const char *path) {\n  sprintf(newpath, \"%s%s\", fsimg_path, path);\n}\n\nstatic const char* redirect_path(char *newpath, const char *path) {\n  get_fsimg_path(newpath, path);\n  if (0 == access(newpath, 0)) {\n    fprintf(stderr, \"Redirecting file open: %s -&gt; %s\\n\", path, newpath);\n    return newpath;\n  }\n  return path;\n}\n</code></pre> <p>\u7a0b\u5e8f\u6267\u884c <code>Init</code> \u7c7b\u7684\u6784\u9020\u51fd\u6570\u3002</p> <pre><code>struct Init {\n  Init() {\n    glibc_fopen = (FILE*(*)(const char*, const char*))dlsym(RTLD_NEXT, \"fopen\");\n    assert(glibc_fopen != NULL);\n    glibc_open = (int(*)(const char*, int, ...))dlsym(RTLD_NEXT, \"open\");\n    assert(glibc_open != NULL);\n    glibc_read = (ssize_t (*)(int fd, void *buf, size_t count))dlsym(RTLD_NEXT, \"read\");\n    assert(glibc_read != NULL);\n    glibc_write = (ssize_t (*)(int fd, const void *buf, size_t count))dlsym(RTLD_NEXT, \"write\");\n    assert(glibc_write != NULL);\n    glibc_execve = (int(*)(const char*, char *const [], char *const []))dlsym(RTLD_NEXT, \"execve\");\n    assert(glibc_execve != NULL);\n\n    dummy_fd = memfd_create(\"dummy\", 0);\n    assert(dummy_fd != -1);\n    dispinfo_fd = dummy_fd;\n\n    char *navyhome = getenv(\"NAVY_HOME\");\n    assert(navyhome);\n    sprintf(fsimg_path, \"%s/fsimg\", navyhome);\n\n    char newpath[512];\n    get_fsimg_path(newpath, \"/bin\");\n    setenv(\"PATH\", newpath, 1); // overwrite the current PATH\n\n    SDL_Init(0);\n    if (!getenv(\"NWM_APP\")) {\n      open_display();\n      open_event();\n    }\n    open_audio();\n  }\n  ~Init() {\n  }\n};\n\nInit init;\n//~/ysyx-workbench/navy-apps/libs/libos/src/native.cpp\n</code></pre> <p><code>dlsym</code> \u51fd\u6570\u4ece\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u6216\u8005\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u83b7\u53d6\u5230\u7b26\u53f7\u5730\u5740\u2026\u2026</p> <p><code>fsimg_path</code> \u5373\u4e3a <code>navy-apps/fsimg</code>\u3002</p> <pre><code>FILE *fopen(const char *path, const char *mode) {\n  char newpath[512];\n  return glibc_fopen(redirect_path(newpath, path), mode);\n}\n\nint open(const char *path, int flags, ...) {\n  if (strcmp(path, \"/proc/dispinfo\") == 0) {\n    return dispinfo_fd;\n  } else if (strcmp(path, \"/dev/events\") == 0) {\n    return evt_fd;\n  } else if (strcmp(path, \"/dev/fb\") == 0) {\n    return fb_memfd;\n  } else if (strcmp(path, \"/dev/sb\") == 0) {\n    return sb_fifo[1];\n  } else if (strcmp(path, \"/dev/sbctl\") == 0) {\n    return sbctl_fd;\n  } else {\n    char newpath[512];\n    return glibc_open(redirect_path(newpath, path), flags);\n  }\n}\n</code></pre> <p>\u7ed3\u5408\u4e0a\u9762\u7684 <code>LD_PRELOAD</code>\uff0c\u63a8\u6d4b\u8fd9\u91cc\u7684 <code>fopen</code> \u6210\u529f override \u6389\u4e86\u5e93\u51fd\u6570\uff0c\u800c\u539f\u6765\u7684\u5e93\u51fd\u6570\u901a\u8fc7\u91cd\u547d\u540d\u7684\u65b9\u5f0f\u53d8\u6210\u4e86 <code>glibc_fopen</code>\u3002</p> <p>\u8fd9\u91cc\u7684 <code>fopen</code> \u5c06\u539f\u6765\u7684\u6587\u4ef6\u8def\u5f84\u5982 <code>/share/pictures/projectn.bmp</code> \u66ff\u6362\u6210\u4e86</p> <p><code>/home/jai/ysyx-workbench/navy-apps/fsimg/share/pictures/projectn.bmp</code>\uff01</p> <p>\u8c03\u7528\u8f68\u8ff9\uff1a</p> <pre><code>fopen -&gt; redirect_path -&gt; get_fsimg_path -&gt; glibc_fopen\n</code></pre> <p>\u4f46\u662f\u5982\u4f55\u5bf9\u7279\u6b8a\u6587\u4ef6\u8fdb\u884c\u6a21\u62df\uff1f...</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>Wine, WSL\u548c\u8fd0\u884c\u65f6\u73af\u5883\u517c\u5bb9</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Linux native\u6765\u5b9e\u73b0Navy\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u4ece\u800c\u53ef\u4ee5\u8ba9Navy\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5728Linux native\u4e0a\u8fd0\u884c. \u90a3\u4e48\u6211\u4eec\u80fd\u4e0d\u80fd\u5b9e\u73b0\u5176\u5b83\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u6bd4\u5982\u5728Linux\u4e2d\u63d0\u4f9b\u4e00\u5957\u517c\u5bb9Windows\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u4ece\u800c\u652f\u6301Windows\u5e94\u7528\u7a0b\u5e8f\u5728Linux\u4e0a\u7684\u8fd0\u884c\u5462?</p> <p>Wine\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u9879\u76ee, \u5b83\u901a\u8fc7Linux\u7684\u8fd0\u884c\u65f6\u73af\u5883\u5b9e\u73b0Windows\u76f8\u5173\u7684API. \u53e6\u4e00\u4e2a\u65b9\u5411\u76f8\u53cd\u7684\u9879\u76ee\u662fWSL\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00, \u5b83\u662f\u901a\u8fc7Windows\u7684\u8fd0\u884c\u65f6\u73af\u5883\u6765\u5b9e\u73b0Linux\u7684API, \u4ece\u800c\u652f\u6491Linux\u7a0b\u5e8f\u5728Windows\u4e0a\u7684\u8fd0\u884c, \u4e0d\u8fc7WSL\u8fd8\u4fee\u6539\u4e86Windows\u5185\u6838, \u8ba9\u5b83\u5bf9Linux\u7a0b\u5e8f\u63d0\u4f9b\u4e13\u95e8\u7684\u652f\u6301. \u4f46\u5b8c\u6574\u7684Linux\u548cWindows\u8fd0\u884c\u65f6\u73af\u5883\u592a\u590d\u6742\u4e86, \u56e0\u6b64\u4e00\u4e9b\u5bf9\u8fd0\u884c\u65f6\u73af\u5883\u4f9d\u8d56\u7a0b\u5ea6\u6bd4\u8f83\u590d\u6742\u7684\u7a0b\u5e8f\u81f3\u4eca\u4e5f\u5f88\u96be\u5728Wine\u6216WSL\u4e0a\u5b8c\u7f8e\u8fd0\u884c, \u4ee5\u81f3\u4e8eWSL2\u629b\u5f03\u4e86\"\u8fd0\u884c\u65f6\u73af\u5883\u517c\u5bb9\"\u7684\u6280\u672f\u8def\u7ebf, \u8f6c\u800c\u91c7\u7528\u865a\u62df\u673a\u7684\u65b9\u5f0f\u6765\u5b8c\u7f8e\u8fd0\u884cLinux\u7cfb\u7edf. </p> <p>\u53cd\u89c2Navy\u7684\u8fd0\u884c\u65f6\u73af\u5883\u5374\u662f\u975e\u5e38\u7b80\u5355, \u6211\u4eec\u901a\u8fc7\u4e0d\u5230300\u884c\u7684<code>native.cpp</code>\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5b83\u4e86, \u4e0d\u8fc7\u5982\u679c\u4f60\u7406\u89e3\u4e86\u5176\u4e2d\u7684\u6982\u5ff5, \u4f60\u4e5f\u5c31\u660e\u767d\u7c7b\u4f3cWSL\u8fd9\u4e9b\u8eab\u8fb9\u7684\u6280\u672f\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u4e86.</p> <p>\u503c\u5f97\u9605\u8bfb\u7684\u4e00\u4e2a C++\u9879\u76ee \u7559\u5751</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#navy_1","title":"Navy \u7684\u5e94\u7528\u7a0b\u5e8f","text":""},{"location":"ysyx/pa/pa3/pa3.html#nslider-nju-slider","title":"NSlider (NJU Slider)","text":"<ul> <li> <p>\u505a</p> <p>\u8fd0\u884cNSlider1,2</p> <p>\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u811a\u672c\u6765\u628aPDF\u7248\u672c\u7684, \u6bd4\u4f8b\u4e3a4:3\u7684\u5e7b\u706f\u7247\u8f6c\u6362\u6210BMP\u56fe\u50cf, \u5e76\u62f7\u8d1d\u5230<code>navy-apps/fsimg/</code>\u4e2d. \u4f60\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684PDF\u6587\u4ef6, \u7136\u540e\u53c2\u8003\u76f8\u5e94\u7684README\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c. \u4f46\u4f60\u53ef\u80fd\u4f1a\u5728\u8f6c\u6362\u65f6\u9047\u5230\u4e00\u4e9b\u95ee\u9898, \u5177\u4f53\u8bf7\u81ea\u884c\u89e3\u51b3.</p> <p>\u7136\u540e\u5728miniSDL\u4e2d\u5b9e\u73b0<code>SDL_UpdateRect()</code>, \u5982\u679c\u4f60\u7684\u5b9e\u73b0\u6b63\u786e, \u8fd0\u884cNSlider\u65f6\u5c06\u4f1a\u663e\u793a\u7b2c\u4e00\u5f20\u5e7b\u706f\u7247. \u4f60\u5f88\u53ef\u80fd\u662f\u7b2c\u4e00\u6b21\u63a5\u89e6SDL\u7684API, \u4e3a\u6b64\u4f60\u8fd8\u9700\u8981RTFM, \u5e76\u901a\u8fc7RTFSC\u6765\u7406\u89e3\u5df2\u6709\u4ee3\u7801\u7684\u884c\u4e3a.</p> <p>\u4e86\u89e3\u4e00\u4e0b <code>SDL_Surface</code> </p> <pre><code>typedef struct {\n    int16_t x, y;\n    uint16_t w, h;\n} SDL_Rect;\n\ntypedef union {\n  struct {\n    uint8_t r, g, b, a;\n  };\n  uint32_t val;\n} SDL_Color;\n\ntypedef struct {\n    int ncolors;\n    SDL_Color *colors;\n} SDL_Palette;\ntypedef struct {\n    SDL_Palette *palette;\n    uint8_t BitsPerPixel;\n    uint8_t BytesPerPixel;\n    uint8_t Rloss, Gloss, Bloss, Aloss;\n    uint8_t Rshift, Gshift, Bshift, Ashift;\n    uint32_t Rmask, Gmask, Bmask, Amask;\n} SDL_PixelFormat;\ntypedef struct {\n    uint32_t flags;\n    SDL_PixelFormat *format;\n    int w, h;\n    uint16_t pitch;\n    uint8_t *pixels;\n} SDL_Surface;\n\n// libs/libminiSDL/include/sdl-video.h\n</code></pre> <p>\u6839\u636e\u50cf\u7d20\u7684\u683c\u5f0f</p> <p></p> <p>\u597d\u50cf\u8fd8\u5f97\u770b\u683c\u5f0f\u591a\u5c11\u4f4d\u989c\u8272\u3002\u3002\u3002\u5d29\u6e83\u4e86\uff0c\u4e0d\u77e5\u9053\u4e3a\u5565\u770b\u5230\u8fd9\u4e9b\u989c\u8272\u76f8\u5173\u7684\u6211\u90fd\u4e0d\u60f3\u770b....\uff08\u597d\u50cf\u4e0d\u559c\u6b22\u5f04\u8fd9\u4e2a\u8ba1\u7b97\u673a\u56fe\u5f62\u5b66\u7684\u4e1c\u897f\u3002\u3002\u3002\uff08\u505a\u5b8c\u4e4b\u540e\u56de\u6765\u53d1\u73b0\uff0c\u6709\u7f51\u4e0a\u7684\u8d44\u6599\u5f15\u5bfc\u5c31\u597d\u3002\u3002\u3002\u4f46\u662f\u8fd8\u662f\u5f88\u4e0d\u60f3\u5f04\u3002\u3002\u3002\u3002\uff09</p> <ul> <li> <p>\u50cf\u7d20\u683c\u5f0f\u4e3a32\u4f4d</p> <p>\u4e3b\u8981\u662f\u5c06\u50cf\u7d20\u6570\u636e\u4ece <code>Surface</code> \u5185\u90e8\u6570\u636e\u8f6c\u4e3a\u752832\u4f4d <code>\u03b1RGB</code> \u683c\u5f0f\u8868\u793a\uff0c\u5176\u4e2d\u6bcf\u4e2a\u901a\u9053\uff08\u7ea2\u8272\u3001\u7eff\u8272\u3001\u84dd\u8272\u3001\u900f\u660e\u5ea6\uff09\u5360\u7528 8 \u4f4d\u3002</p> <p>\u753b\u56fe\u7406\u89e3\uff1a</p> <pre><code>// each_pixel_offset = offset * 4\n// n: 0-&gt;b 1-&gt;g 2-&gt;b 3-&gt;a\nbuf[i++] = (uint32_t)(s-&gt;pixels[start_pos + 4 * offset + 3] &lt;&lt; 24 |\n            s-&gt;pixels[start_pos + 4 * offset + 2] &lt;&lt; 16 |\n            s-&gt;pixels[start_pos + 4 * offset + 1] &lt;&lt; 8 |\n            s-&gt;pixels[start_pos + 4 * offset]); \n</code></pre> <p>\u5177\u4f53\u5e94\u8be5\u6bd4\u8f83\u597d\u61c2\u3002</p> <p>\u8f6c\u6210 <code>\u03b1RGB</code> \u683c\u5f0f</p> </li> <li> <p>\u50cf\u7d20\u683c\u5f0f\u4e3a8\u4f4d</p> <p>\u8fd9\u91cc\u770b\u7f51\u4e0a\u7684\uff0c\u6ca1\u60f3\u8fc7\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u50cf\u7d20\u4f7f\u7528\u4e00\u4e2a\u5b57\u8282\u6765\u5b58\u50a8\u989c\u8272\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5b58\u50a8\u989c\u8272\u503c\u3002\u989c\u8272\u7d22\u5f15\u5bf9\u5e94\u4e8e\u8c03\u8272\u677f\uff08palette\uff09\u4e2d\u7684\u4e00\u4e2a\u989c\u8272\uff0c\u8c03\u8272\u677f\u662f\u4e00\u4e2a\u989c\u8272\u6570\u7ec4\uff0c\u5b9a\u4e49\u4e86\u7d22\u5f15\u4e0e\u5b9e\u9645\u989c\u8272\u503c\u4e4b\u95f4\u7684\u6620\u5c04\u3002</p> <pre><code>SDL_Color rgba_color = s-&gt;format-&gt;palette-&gt;colors[s-&gt;pixels[start_pos + offset]];\nbuf[i++] = rgba_color.a &lt;&lt; 24 | rgba_color.r &lt;&lt; 16 | rgba_color.g &lt;&lt; 8 | rgba_color.b;\n</code></pre> <ul> <li> <p>\u901a\u8fc7 <code>s-&gt;pixels[start_pos + offset]</code> \u83b7\u53d6\u5f53\u524d\u50cf\u7d20\u7684\u7d22\u5f15\u503c\u3002</p> </li> <li> <p>\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\u503c\u4ece <code>s-&gt;format-&gt;palette</code> \u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u989c\u8272\u503c\u3002<code>s-&gt;format-&gt;palette</code> \u662f\u4e00\u4e2a\u6307\u5411\u8c03\u8272\u677f\u7684\u6307\u9488\uff0c\u8c03\u8272\u677f\u662f\u4e00\u4e2a <code>SDL_Color</code> \u6570\u7ec4\uff0c\u6bcf\u4e2a <code>SDL_Color</code> \u7ed3\u6784\u5305\u542b RGBA \u56db\u4e2a\u901a\u9053\u7684\u503c\u3002</p> </li> <li> <p>\u597d\u50cf\u8fd9\u5c31\u662f\u4e4b\u524d\u8bf4\u7684\u8c03\u8272\u677f\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>8 \u4f4d\u989c\u8272\u6df1\u5ea6\uff1a\u6bcf\u4e2a\u50cf\u7d20\u7528\u4e00\u4e2a\u5b57\u8282\u8868\u793a\uff0c\u5b58\u50a8\u7684\u662f\u8c03\u8272\u677f\u7d22\u5f15\u3002</li> <li>\u8c03\u8272\u677f\uff1a\u4e00\u4e2a\u989c\u8272\u6570\u7ec4\uff0c\u5b9a\u4e49\u4e86\u7d22\u5f15\u4e0e\u5b9e\u9645\u989c\u8272\u503c\u4e4b\u95f4\u7684\u6620\u5c04\u3002</li> <li>\u8f6c\u6362\u8fc7\u7a0b\uff1a\u901a\u8fc7\u7d22\u5f15\u4ece\u8c03\u8272\u677f\u4e2d\u83b7\u53d6\u989c\u8272\u503c\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u989c\u8272\u503c\u8f6c\u6362\u4e3a RGBA \u683c\u5f0f\uff0c\u5b58\u50a8\u5230\u7f13\u51b2\u533a\u4e2d\u3002</li> </ul> </li> </ul> </li> </ul> <p>\u989d\u5916\u88c5\u4e86\u4e2a\u8fd9\u4e2a\uff1a</p> <pre><code>sudo apt install imagemagick\n</code></pre> <p>\u6539\u4e86\u4e2a <code>xml</code> \u7684\u914d\u7f6e\u6743\u9650\uff1a</p> <pre><code>&lt;policymap&gt;\n   ...\n  &lt;policy domain=\"coder\" rights=\"read | write\" pattern=\"PDF\" /&gt;\n  ...\n&lt;/policymap&gt;\n</code></pre> <p>\u8fd8\u662f RTFM: SDL_KeyboardEvent (libsdl.org)</p> <p>\u8fd9\u91cc\u548c\u5b9e\u73b0 <code>event_read</code> \u6709\u70b9\u50cf\uff0c\u53ea\u4e0d\u8fc7\u90a3\u91cc\u662f\u5199\u5165\uff0c\u8fd9\u91cc\u521a\u597d\u8bfb\u51fa\u3002</p> <p>\u56e0\u4e3a <code>NSlider</code> \u53ea\u7528\u5230\u4e86<code>key</code> <code>event</code> \uff0c\u6240\u4ee5\u53ea\u5b9e\u73b0\u529f\u80fd\u5373\u53ef\u3002</p> <p>\u4e00\u5f00\u59cb\u60f3\u7740\u8bfb\u51fa\u6765 <code>key_code</code>\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e <code>nanos-lite</code> \u4e2d\u6309\u952e\u4e8b\u4ef6\u7684\u62bd\u8c61\u6210\u7684\u6587\u4ef6\u5e76\u6ca1\u6709\u5199\u5165 <code>key_code</code>\uff0c\u90a3\u5c31\u8f6e\u8be2\u597d\u4e86\u3002 </p> <pre><code>int SDL_WaitEvent(SDL_Event *event) {\n    char buf[64];\n    char key_type[8], key_name[8];\n    memset(buf, '\\0', sizeof(buf));\n\n    while(NDL_PollEvent(buf, sizeof(buf)) == 0);\n\n    sscanf(buf, \"%s %s\\n\", key_type, key_name);\n    event-&gt;key.type = buf[1] == 'd' ? SDL_KEYDOWN : SDL_KEYUP;\n\n    for(size_t i = 0; i &lt; NR_KEYS; ++i){\n        if (strcmp(key_name, keyname[i]) == 0) {\n            event-&gt;key.keysym.sym = i;\n            break;\n        }   \n    }   \n  return 1;\n} \n</code></pre> <p>\u53e6\u5916\u53ef\u4ee5\u770b\u770b\u8fd9\u4e2a\u529f\u80fd\u662f\u600e\u4e48\u5b9e\u73b0\uff0c\u600e\u4e48\u505a\u5230\u6309\u952e\u4e0b\u4e00\u9875\u7684\uff08\u5305\u4e91\u5c97\u8001\u5e08\u597d\u50cf\u6709\u4e2a\u7814\u7a76\u751f\u9762\u8bd5\u95ee\u9898\u5c31\u662f\u8fd9\u4e2a\u7c7b\u4f3c\u7684\u597d\u50cf\uff0c\u4e0d\u8fc7\u770b\u91cd\u7cfb\u7edf\uff09</p> <p>\u6570\u5b57\u952e+\u4e0a\u4e0b\uff0c\u8de8\u9875\u8df3\u8f6c\u8fd8\u633a\u597d\u73a9\u54c8\u54c8\u3002</p> </li> </ul> <p>\u8c03\u7528\u6d41\u7a0b\uff1a</p> <ul> <li>for nanos-lite: fs_open / fs_read (events_read) / fs_close</li> <li>for native: (overrided) open / read / close</li> </ul> <p>\u6ce8\u610framdisk\u955c\u50cf\u7684\u5927\u5c0f</p> <p>\u6211\u4eec\u8ba9ramdisk\u955c\u50cf\u7684\u5185\u5bb9\u94fe\u63a5\u5230Nanos-lite\u7684\u6570\u636e\u6bb5, \u800c\u53c8\u628a\u7528\u6237\u7a0b\u5e8f\u52a0\u8f7d\u5230\u5185\u5b58\u4f4d\u7f6e <code>0x3000000</code>(x86)\u6216<code>0x83000000</code>(mips32\u6216riscv32)\u9644\u8fd1, \u8fd9\u9690\u542b\u4e86\u4e00\u4e2a\u5047\u8bbe: ramdisk\u955c\u50cf\u7684\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc748MB. \u5982\u679c\u8fd9\u4e2a\u5047\u8bbe\u4e0d\u6ee1\u8db3, ramdisk\u4e2d\u7684\u5185\u5bb9\u5c31\u53ef\u80fd\u88ab\u8986\u76d6, \u9020\u6210\u96be\u4ee5\u7406\u89e3\u7684\u9519\u8bef. \u56e0\u6b64\u4f60\u9700\u8981\u6ce8\u610framdisk\u955c\u50cf\u7684\u5927\u5c0f, \u4e0d\u8981\u653e\u5165\u8fc7\u591a\u8fc7\u5927\u7684\u6587\u4ef6.</p> <p>\u8bf4\u4e0d\u5b9a\u4f1a\u9047\u5230\u5751...</p> <pre><code>CROSS_COMPILE = riscv64-linux-gnu-\nLNK_ADDR = $(if $(VME), 0x40000000, 0x83000000)                       \nCFLAGS  += -fno-pic -march=rv64g -mcmodel=medany\nLDFLAGS += --no-relax -Ttext-segment $(LNK_ADDR)\n</code></pre>"},{"location":"ysyx/pa/pa3/pa3.html#menu","title":"MENU (\u5f00\u673a\u83dc\u5355)","text":"<p>\u4e3b\u8981\u5b9e\u73b0\uff1a</p> <ul> <li><code>SDL_FillRect()</code>: \u5f80\u753b\u5e03\u7684\u6307\u5b9a\u77e9\u5f62\u533a\u57df\u4e2d\u586b\u5145\u6307\u5b9a\u7684\u989c\u8272</li> <li><code>SDL_BlitSurface()</code>: \u5c06\u4e00\u5f20\u753b\u5e03\u4e2d\u7684\u6307\u5b9a\u77e9\u5f62\u533a\u57df\u590d\u5236\u5230\u53e6\u4e00\u5f20\u753b\u5e03\u7684\u6307\u5b9a\u4f4d\u7f6e</li> </ul> <p>\u5f00\u673a\u83dc\u5355\u8fd8\u4f1a\u663e\u793a\u4e00\u4e9b\u82f1\u6587\u5b57\u4f53, \u8fd9\u4e9b\u5b57\u4f53\u7684\u4fe1\u606f\u4ee5BDF\u683c\u5f0f\u5b58\u50a8, Navy\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2alibbdf\u5e93\u6765\u89e3\u6790BDF\u683c\u5f0f, \u751f\u6210\u76f8\u5e94\u5b57\u7b26\u7684\u50cf\u7d20\u4fe1\u606f, \u5e76\u5c01\u88c5\u6210SDL\u7684<code>Surface</code>. \u5b9e\u73b0\u4e86<code>SDL_BlitSurface()</code>\u4e4b\u540e, \u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5728\u5c4f\u5e55\u4e0a\u8f93\u51fa\u5b57\u7b26\u4e32\u7684\u50cf\u7d20\u4fe1\u606f\u4e86.</p> <p>\u8bb0\u5f97\u94fe\u63a5\u5e93</p> <p>\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u7684\u65f6\u5019 API \u9047\u5230\uff1a</p> <p></p> <p>\u81ea\u5df1\u9047\u5230\u7684\u95ee\u9898\u7684\uff0c\u603b\u7ed3\u81ea\u5df1\u5b9e\u73b0\u7684\u539f\u56e0\uff1a</p> <ol> <li> <p>\u524d\u9762\u7684 <code>NDL_OpenCanvas</code> \u5b9e\u73b0\u7684\u6709\u5751\uff1a</p> <pre><code>/*\nif (*w == 0 &amp;&amp; *h == 0) {\n    canvas_h = screen_h;\n    canvas_w = screen_w;\n} else {\n    canvas_h = *h;\n    canvas_w = *w;\n}\n*/\n</code></pre> <p>// \u6253\u5f00\u4e00\u5f20(w) X (h)\u7684\u753b\u5e03 // \u5982\u679cw\u548ch\u5747\u4e3a0, \u5219\u5c06\u7cfb\u7edf\u5168\u5c4f\u5e55\u4f5c\u4e3a\u753b\u5e03, \u5e76\u5c06w\u548ch\u5206\u522b\u8bbe\u4e3a\u7cfb\u7edf\u5c4f\u5e55\u7684\u5927\u5c0f</p> <p>else \u90e8\u5206\u5199\u53cd\u4e86..</p> </li> <li> <p>\u81ea\u5df1\u89e3\u6790\u7684\u50cf\u7d20\u6570\u636e\u6709\u5751</p> <pre><code>// \u5f80\u753b\u5e03\u7684\u6307\u5b9a\u77e9\u5f62\u533a\u57df\u4e2d\u586b\u5145\u6307\u5b9a\u7684\u989c\u8272\nvoid SDL_FillRect(SDL_Surface *dst, SDL_Rect *dstrect, uint32_t color) {\n    assert(dst != NULL);\n    int x, y, w, h;\n    uint32_t start_pos = 0;\n    if (dstrect) {\n        start_pos = (dstrect-&gt;y * dst-&gt;w) + dstrect-&gt;x;\n        x = dstrect-&gt;x; y = dstrect-&gt;y;\n        w = dstrect-&gt;w; h = dstrect-&gt;h;\n    } else {\n        x = y = 0;\n        w = dst-&gt;w; h = dst-&gt;h;\n    }\n\n    uint8_t bits_per_pixel = dst-&gt;format-&gt;BitsPerPixel;\n    uint32_t *pixels = (uint32_t *)(dst-&gt;pixels);\n    if (bits_per_pixel == 32) {\n        for (int row = 0; row &lt; h; row++) {\n            uint32_t dstrect_offset = row * dst-&gt;w;\n            memset(pixels[start_pos + dstrect_offset],\n                   color, (dst-&gt;w) * sizeof(uint32_t) );\n        }\n    } else if (bits_per_pixel == 8) {\n\n    } else {\n        printf(\"now unsupported pixel bites %u.\\n\", bits_per_pixel);\n    }\n}\n</code></pre> </li> </ol> <p>\u505a\u5230\u8fd9\u91cc\u7684\u611f\u89c9\uff0c\u771f\u7684\u597d\u70e6\u554a\u8fd9\u79cd\u5929\u5929\u5199\u5e93\u7684....</p> <p>\u53e6\u5916\u66b4\u9732\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u53c8\u662f\u4e0d\u4e0d\u597d\u770b\u8bb2\u4e49\u5bf9\u4e8eAPI\u89c4\u5b9a\u7684\u884c\u4e3a\u7684\uff0c\u8fd8\u6709\u81ea\u5df1\u5199\u7740\u5199\u7740\u5c31\u5199\u98de\u4e86\uff0c\u542c\u7740\u6b4c\u5199\u5f88\u723d\uff0c\u7ed9\u81ea\u5df1\u57cb\u5751\u67e5bug\u66f4tm\u723d</p>"},{"location":"ysyx/pa/pa3/pa3.html#nterm-nju-terminal","title":"NTerm (NJU Terminal)","text":"<p>\u6bd4\u8f83\u7b80\u5355\uff0c\u6ce8\u610fRTFM\u7684\u8981\u6c42\u3002</p> <ul> <li> <p>\u9009\u505a\u9898</p> <p>\u5b9e\u73b0\u5185\u5efa\u7684echo\u547d\u4ee4</p> <p>\u5728\u5167\u5efaShell\u4e2d\u89e3\u6790\u547d\u4ee4\u548c\u4f60\u5728PA1\u4e2d\u5b9e\u73b0\u7b80\u6613\u8c03\u8bd5\u5668\u7684\u547d\u4ee4\u89e3\u6790\u975e\u5e38\u7c7b\u4f3c, \u800c\u4e14Navy\u4e2d\u7684Newlib\u5df2\u7ecf\u63d0\u4f9b\u4e86\u6807\u51c6\u5e93\u51fd\u6570\u4e86, \u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5167\u5efa\u7684<code>echo</code>\u547d\u4ee4.</p> <p>\u8fd9\u91cc\u7559\u7740\u5230\u5b66\u70b9C++\u505a\uff0c\u521a\u597d\u4f5c\u4e3a\u4e00\u4e2a\u7ec3\u624b\u7684\u9879\u76ee\u3002\u76f4\u63a5\u770b\u4e8e\u4ed5\u742a\u8001\u5e08\u7684\u8bfe\u7a0b\u5feb\u901f\u5b66\u4e60C\u548cC++\uff0c\u57fa\u7840\u8bed\u6cd5\u548c\u4f18\u5316\u7b56\u7565\uff0c\u5b66\u4e86\u4e0d\u518d\u6015\u6307\u9488(\u5357\u79d1\u5927\u8ba1\u7b97\u673a\u7cfb\u539f\u7248)_i</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#flappy-bird","title":"Flappy Bird","text":"<p>\u5b9e\u73b0 IMG_LOAD:</p> <p>\u4e0a\u8ff0API\u63a5\u53d7\u4e00\u4e2a\u56fe\u7247\u6587\u4ef6\u7684\u8def\u5f84, \u7136\u540e\u628a\u56fe\u7247\u7684\u50cf\u7d20\u4fe1\u606f\u5c01\u88c5\u6210SDL\u7684<code>Surface</code>\u7ed3\u6784\u5e76\u8fd4\u56de. \u8fd9\u4e2aAPI\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u5982\u4e0b:</p> <ol> <li>\u7528libc\u4e2d\u7684\u6587\u4ef6\u64cd\u4f5c\u6253\u5f00\u6587\u4ef6, \u5e76\u83b7\u53d6\u6587\u4ef6\u5927\u5c0fsize</li> <li>\u7533\u8bf7\u4e00\u6bb5\u5927\u5c0f\u4e3asize\u7684\u5185\u5b58\u533a\u95f4buf</li> <li>\u5c06\u6574\u4e2a\u6587\u4ef6\u8bfb\u53d6\u5230buf\u4e2d</li> <li>\u5c06buf\u548csize\u4f5c\u4e3a\u53c2\u6570, \u8c03\u7528<code>STBIMG_LoadFromMemory()</code>, \u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>SDL_Surface</code>\u7ed3\u6784\u7684\u6307\u9488</li> <li>\u5173\u95ed\u6587\u4ef6, \u91ca\u653e\u7533\u8bf7\u7684\u5185\u5b58</li> <li> <p>\u8fd4\u56de<code>SDL_Surface</code>\u7ed3\u6784\u6307\u9488</p> </li> <li> <p>\u9009\u505a\u9898</p> <p>\u6b64\u5916, Flappy Bird\u4e5f\u662f\u4e00\u4e2a\u9002\u5408\u5927\u5bb6\u9605\u8bfb\u7684\u9879\u76ee: \u9605\u8bfb\u5b83\u4e0d\u9700\u8981\u4e86\u89e3\u8fc7\u591a\u7684\u77e5\u8bc6\u80cc\u666f, \u800c\u4e14\u5927\u5bb6\u5f88\u5bb9\u6613\u719f\u6089\u6e38\u620f\u7684\u89c4\u5219, \u7136\u540e\u5c31\u53ef\u4ee5\u53bb\u4e86\u89e3\u6e38\u620f\u7684\u6548\u679c\u662f\u5982\u4f55\u7528\u4ee3\u7801\u5b9e\u73b0\u51fa\u6765\u7684.</p> <p>\u4e5f\u662f\u5b66\u4e86C++\u518d\u770b</p> </li> </ol> <p>\u53c8\u7206\u4e86\u4e00\u6b21\u96f7</p> <p>\u57fa\u4e8e\u4e0b\u9762\u4ee3\u7801\u7684\uff1a\u5e94\u8be5\u662f <code>SDL_BlitSurface</code> \u6709\u95ee\u9898\uff0c\u5bfc\u81f4\u9700\u8981\u5728 <code>NDL_Init()</code> \u52a0\u4e00\u884c\u65e0\u7f18\u65e0\u6545\u7684printf\u4ee3\u7801\uff0c\u4f30\u8ba1\u662f\u54ea\u91cc\u91ce\u6307\u9488\u8dd1\u98de\u4e86\uff0c\u6216\u8005\u524d\u9762\u8bf4\u7684\u6570\u636e\u683c\u5f0f\u89e3\u6790\u6709\u95ee\u9898\u3002</p> <pre><code>void SDL_BlitSurface(SDL_Surface *src, SDL_Rect *srcrect, SDL_Surface *dst, SDL_Rect *dstrect) {\n    //printf(\"dst-&gt;format-&gt;BitsPerPixe is %d\\n\",dst-&gt;format-&gt;BitsPerPixel);\n    assert(dst &amp;&amp; src);\n    assert(dst-&gt;format-&gt;BitsPerPixel == src-&gt;format-&gt;BitsPerPixel);\n\n    int w = 0, h = 0;\n    uint32_t s_start_pos = 0;\n    uint32_t d_start_pos = 0;\n    // srcrect and dstrecr == NULL RTFM\n    if (srcrect) {\n        s_start_pos = (srcrect-&gt;y * src-&gt;w) + srcrect-&gt;x;\n        w = srcrect-&gt;w; h = srcrect-&gt;h;\n    } else {\n        w = src-&gt;w; h = src-&gt;h;\n    }\n\n    if (dstrect) {\n        d_start_pos = (dstrect-&gt;y * dst-&gt;w) + dstrect-&gt;x;\n    }\n\n    uint8_t bits_per_pixel = dst-&gt;format-&gt;BitsPerPixel;\n    if (bits_per_pixel == 32) {\n        for (int row = 0; row &lt; h; row++) {\n            uint32_t srcrect_offset = row * src-&gt;w;\n            uint32_t dstrect_offset = row * dst-&gt;w;\n            // Note: need to change the pointer type\n            //      before you can manipulate the pointer movement. \n            memcpy((uint32_t *)dst-&gt;pixels + d_start_pos + dstrect_offset,\n                   (uint32_t *)src-&gt;pixels + s_start_pos + srcrect_offset,\n                   (src-&gt;w) * sizeof(uint32_t));\n        }\n    } else if (bits_per_pixel == 8) {\n        for (int row = 0; row &lt; h; ++row) {\n            uint32_t srcrect_offset = row * src-&gt;w;\n            uint32_t dstrect_offset = row * dst-&gt;w;\n            memcpy((uint8_t *)dst-&gt;pixels + d_start_pos + srcrect_offset,\n                  (uint8_t *)src-&gt;pixels + s_start_pos + dstrect_offset,\n                  (src-&gt;w) * sizeof(uint8_t));  \n        }\n    } else {\n        printf(\"now unsupported pixel bites %u.\\n\", bits_per_pixel);\n    }\n}\n\n\n\nvoid SDL_FillRect(SDL_Surface *dst, SDL_Rect *dstrect, uint32_t color) {\n    int32_t start_pos = 0;\n    uint32_t sf_row_num = dst-&gt;h;\n    uint32_t sf_col_num = dst-&gt;w;\n    uint32_t rec_row_num = dst-&gt;h;\n    uint32_t rec_col_num = dst-&gt;w;\n    if (dstrect) {\n        start_pos = dstrect-&gt;x + dstrect-&gt;y * dst-&gt;w;\n        rec_row_num = dstrect-&gt;h;\n        rec_col_num = dstrect-&gt;w;\n    }\n\n    uint8_t bits_per_pixel = dst-&gt;format-&gt;BitsPerPixel;\n    if (bits_per_pixel == 32) {\n        for (int row = 0; row &lt; rec_row_num; ++row)\n            memset((uint32_t *)dst-&gt;pixels + start_pos + row * sf_col_num,\n                   color, rec_col_num * sizeof(uint32_t));\n    } else if (bits_per_pixel == 8) {\n        for (int row = 0; row &lt; rec_row_num; ++row)\n            memset((uint8_t *)dst-&gt;pixels + start_pos + row * sf_col_num,\n                    color, rec_col_num * sizeof(uint8_t));\n    } else {\n        printf(\"unsupported pixel bites %d!\\n\", dst-&gt;format-&gt;BitsPerPixel);\n    }\n}\n\n// \u5c06\u753b\u5e03\u4e2d\u7684\u6307\u5b9a\u77e9\u5f62\u533a\u57df\u540c\u6b65\u5230\u5c4f\u5e55\u4e0a.\n// \u5728 (x,y) \u5904\u753b w * h \u5927\u5c0f\u7684\u77e9\u5f62\n// \u540cNDL\n// SDL_Surface -&gt; RGBA format(32bit)\nvoid SDL_UpdateRect(SDL_Surface *s, int x, int y, int w, int h) {\n    assert(s != NULL);\n    // improtant: only w == 0 &amp;&amp; h == 0, then set the s size.\n    if (w == 0 &amp;&amp; h == 0) {\n        w = s-&gt;w;\n        h = s-&gt;h;\n    }\n\n    uint8_t bits_per_pixel = s-&gt;format-&gt;BitsPerPixel;\n    uint32_t len = w * h;\n    uint32_t *buf = malloc(sizeof(uint32_t) * len);\n    uint32_t start_pos = (y * s-&gt;w) + x;\n    size_t i = 0;\n    for (size_t row = 0; row &lt; h; ++row) {\n        for (size_t col = 0; col &lt; w; ++col) {\n            uint32_t offset = (row * s-&gt;w) + col;\n            // follow SDL_CreateRGBSurface...\n            if (bits_per_pixel == 32) {\n                buf[i++] = (uint32_t)(s-&gt;pixels[start_pos + 4 * offset + 3] &lt;&lt; 24 |\n                            s-&gt;pixels[start_pos + 4 * offset + 2] &lt;&lt; 16 |\n                            s-&gt;pixels[start_pos + 4 * offset + 1] &lt;&lt; 8 |\n                            s-&gt;pixels[start_pos + 4 * offset]);\n            } else if (bits_per_pixel == 8) {\n                SDL_Color rgba_color =\n                    s-&gt;format-&gt;palette-&gt;colors[s-&gt;pixels[start_pos + offset]];\n                buf[i++] = rgba_color.a &lt;&lt; 24 | rgba_color.r &lt;&lt; 16 |\n                            rgba_color.g &lt;&lt; 8 | rgba_color.b;\n            } else {\n                printf(\"now unsupported pixel bites %u.\\n\",\n                        bits_per_pixel);\n            }\n        }\n    }\n    NDL_DrawRect(buf, x, y, w, h);\n    free(buf);\n}\n</code></pre> <p>bug\uff1a</p> <pre><code>// \u5e26 printf\u7684\n17820 83011288 &lt;NDL_Init&gt;:\n17821 83011288:   fa010113            addi    sp,sp,-96\n17822 8301128c:   0000e517            auipc   a0,0xe\n17823 83011290:   35850513            addi    a0,a0,856 # 8301f5e4 &lt;keyname+0x204&gt;\n17824 83011294:   04112e23            sw  ra,92(sp)\n17825 83011298:   04812c23            sw  s0,88(sp)\n17826 8301129c:   00003097            auipc   ra,0x3\n17827 830112a0:   c64080e7            jalr    -924(ra) # 83013f00 &lt;printf&gt;\n\n17828 830112a4:   0000e517            auipc   a0,0xe\n17829 830112a8:   64850513            addi    a0,a0,1608 # 8301f8ec &lt;__func__.0+0x54&gt;\n\n17830 830112ac:   00000097            auipc   ra,0x0\n17831 830112b0:   1b0080e7            jalr    432(ra) # 8301145c &lt;getenv&gt;\n17832 830112b4:   00010417            auipc   s0,0x10\n17833 830112b8:   78840413            addi    s0,s0,1928 # 83021a3c &lt;evtdev&gt;\n17834 830112bc:   00050663            beqz    a0,830112c8 &lt;NDL_Init+0x40&gt;\n17835 830112c0:   00300793            li  a5,3\n17836 830112c4:   00f42023            sw  a5,0(s0)\n17837 830112c8:   00000593            li  a1,0\n17838 830112cc:   0000e517            auipc   a0,0xe\n17839 830112d0:   68c50513            addi    a0,a0,1676 # 8301f958 &lt;__func__.0+0xc0&gt;\n17840 830112d4:   00001097            auipc   ra,0x1\n\n\n// \u4e0d\u5e26printf\u7684\uff1a\n17820 83011288 &lt;NDL_Init&gt;:\n17821 83011288:   fa010113            addi    sp,sp,-96\n\n17822 8301128c:   0000e517            auipc   a0,0xe\n17823 83011290:   65050513            addi    a0,a0,1616 # 8301f8dc &lt;__func__.0+0x54&gt;\n17824 83011294:   04812c23            sw  s0,88(sp)\n17825 83011298:   04112e23            sw  ra,92(sp)\n\n17826 8301129c:   00000097            auipc   ra,0x0\n17827 830112a0:   1b0080e7            jalr    432(ra) # 8301144c &lt;getenv&gt;\n17828 830112a4:   00010417            auipc   s0,0x10\n17829 830112a8:   79840413            addi    s0,s0,1944 # 83021a3c &lt;evtdev&gt;\n17830 830112ac:   00050663            beqz    a0,830112b8 &lt;NDL_Init+0x30&gt;\n17831 830112b0:   00300793            li  a5,3\n17832 830112b4:   00f42023            sw  a5,0(s0)\n17833 830112b8:   00000593            li  a1,0\n17834 830112bc:   0000e517            auipc   a0,0xe\n17835 830112c0:   68c50513            addi    a0,a0,1676 # 8301f948 &lt;__func__.0+0xc0&gt;\n17836 830112c4:   00001097            auipc   ra,0x1\n</code></pre> <p>\u4e00\u4e2a\u597d\u7684\u7248\u672c\uff1a</p> <pre><code>void SDL_BlitSurface(SDL_Surface *src, SDL_Rect *srcrect, SDL_Surface *dst, SDL_Rect *dstrect) {\n    assert(dst &amp;&amp; src);\n    assert(dst-&gt;format-&gt;BitsPerPixel == src-&gt;format-&gt;BitsPerPixel);\n\n    if(src-&gt;format-&gt;BitsPerPixel == 32){\n        uint32_t* src_pixels = (uint32_t*)src-&gt;pixels;\n        uint32_t* dst_pixels = (uint32_t*)dst-&gt;pixels;\n\n        int rect_w, rect_h, src_x, src_y, dst_x, dst_y;\n        //RTFM. If srcrect == NULL, the entire surface is copied.\n        //If dstrect == NULL, then the destination position (upper left corner) is (0, 0).\n        if (srcrect){\n          rect_w = srcrect-&gt;w; rect_h = srcrect-&gt;h;\n          src_x = srcrect-&gt;x; src_y = srcrect-&gt;y;\n        }else {\n          rect_w = src-&gt;w; rect_h = src-&gt;h;\n          src_x = 0; src_y = 0;\n        }\n        if (dstrect){\n          dst_x = dstrect-&gt;x, dst_y = dstrect-&gt;y;\n        }else {\n          dst_x = 0; dst_y = 0;\n        }\n\n        for (int i = 0; i &lt; rect_h; ++i){\n          int offset1 = (dst_y + i) * dst-&gt;w + dst_x;\n          int offset2 = (src_y + i) * src-&gt;w + src_x;\n          for (int j = 0; j &lt; rect_w; ++j){\n            dst_pixels[offset1 + j] = src_pixels[offset2 + j];\n          }\n        }\n    }else if(src-&gt;format-&gt;BitsPerPixel == 8){\n        //printf(\"hello \\n\");\n        uint8_t* src_pixels = (uint8_t*)src-&gt;pixels;\n        uint8_t* dst_pixels = (uint8_t*)dst-&gt;pixels;\n\n        int rect_w, rect_h, src_x, src_y, dst_x, dst_y;\n        if (srcrect){\n          rect_w = srcrect-&gt;w; rect_h = srcrect-&gt;h;\n          src_x = srcrect-&gt;x; src_y = srcrect-&gt;y;\n        }else {\n          rect_w = src-&gt;w; rect_h = src-&gt;h;\n          src_x = 0; src_y = 0;\n        }\n        if (dstrect){\n          dst_x = dstrect-&gt;x, dst_y = dstrect-&gt;y;\n        }else {\n          dst_x = 0; dst_y = 0;\n        }\n\n        for (int i = 0; i &lt; rect_h; ++i){\n          int offset1 = (dst_y + i) * dst-&gt;w + dst_x;\n          int offset2 = (src_y + i) * src-&gt;w + src_x;\n          for (int j = 0; j &lt; rect_w; ++j){\n            dst_pixels[offset1 + j] = src_pixels[offset2 + j];\n          }\n        }\n    }else{\n        printf(\"In [video.c][SDL_BlitSurface] : Invalid BitsPerPixel\\n\");\n        assert(0);\n    }\n}\n\nvoid SDL_FillRect(SDL_Surface *dst, SDL_Rect *dstrect, uint32_t color) {\n  uint32_t *pixels = (uint32_t *)dst-&gt;pixels;\n  int rect_h, rect_w, rect_x, rect_y;\n\n  if (dstrect == NULL){\n    rect_w = dst-&gt;w;\n    rect_h = dst-&gt;h;\n    rect_x = 0;\n    rect_y = 0;\n  }else {\n    rect_w = dstrect-&gt;w;\n    rect_h = dstrect-&gt;h;\n    rect_x = dstrect-&gt;x;\n    rect_y = dstrect-&gt;y;\n  }\n  //printf(\"%d %d %d %d\\n\",rect_h,rect_w,rect_x,rect_y);\n  for (int i = 0; i &lt; rect_h; ++i){\n    int offset = (rect_y + i) * dst-&gt;w + rect_x;\n    for (int j = 0; j &lt; rect_w; ++j){\n      pixels[offset + j] = color; //pixels[(rect_y + i) * dst_w + rect_x + j] = color;\n    }\n  }\n}\n\n/*\nstatic inline uint32_t translate_color(SDL_Color *color){\n  return (color-&gt;a &lt;&lt; 24) | (color-&gt;r &lt;&lt; 16) | (color-&gt;g &lt;&lt; 8) | color-&gt;b;\n  //return color;\n}\n\nvoid SDL_UpdateRect(SDL_Surface *s, int x, int y, int w, int h) {\n    //If all the args are 0, then we update the whole screen.\n\n    //printf(\"here is SDL_UpdateRect! bits is %d\\n\",s-&gt;format-&gt;BitsPerPixel);\n    //printf(\"x,y,w,h: %d %d %d %d\\n\",x,y,w,h);\n    if(s-&gt;format-&gt;BitsPerPixel == 32){\n        if (w == 0 &amp;&amp; h == 0 &amp;&amp; x ==0 &amp;&amp; y == 0){\n          //printf(\"%d %d\\n\", s-&gt;w, s-&gt;h);\n          NDL_DrawRect((uint32_t *)s-&gt;pixels, 0, 0, s-&gt;w, s-&gt;h);\n          return ;\n        }\n\n        //To update part of the screen.\n        uint32_t *pixels = malloc(w * h * sizeof(uint32_t));\n        assert(pixels);\n        uint32_t *src = (uint32_t *)s-&gt;pixels;\n        //for (int i = 0; i &lt; h; ++i){\n          //memcpy(&amp;pixels[i * w], &amp;src[(y + i) * s-&gt;w + x], sizeof(uint32_t) * w);\n        //} //This is an alternative version.\n        for (int i=0;i&lt;h;i++){\n            int offset1 = i*w;\n            int offset2 = (y+i)*s-&gt;w + x;\n            for(int j=0;j&lt;w;j++)\n                pixels[offset1 + j] = src[offset2 + j];\n        }\n\n        NDL_DrawRect(pixels, x, y, w, h);\n\n        free(pixels);\n    }else if(s-&gt;format-&gt;BitsPerPixel == 8){\n       if (w == 0 &amp;&amp; h == 0 &amp;&amp; x ==0 &amp;&amp; y == 0){\n          w = s-&gt;w; h = s-&gt;h; x = 0;  y = 0;\n        }\n        uint32_t *pixels = malloc(w * h * sizeof(uint32_t));\n        assert(pixels);\n        uint8_t *src = (uint8_t *)s-&gt;pixels;\n\n        for (int i = 0; i &lt; h; i++){\n          int offset1 = i*w;\n          int offset2 = (y + i) * s-&gt;w + x;\n          for (int j = 0; j &lt; w; j++){\n            pixels[offset1 + j] = translate_color(&amp;s-&gt;format-&gt;palette-&gt;colors[src[offset2 + j]]);\n          }\n        }\n        NDL_DrawRect(pixels, x, y, w, h);\n\n        free(pixels);\n\n        //printf(\"finish update\\n\");\n    }else{\n        printf(\"In [video.c][SDL_UpdateRect] : Invalid BitsPerPixel\\n\");\n        assert(0);\n    }\n\n}\n*/\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\"\u7684\u5e94\u7528: \u79fb\u690d\u548c\u6d4b\u8bd5</p> <p>\u6211\u4eec\u5728\u79fb\u690d\u6e38\u620f\u7684\u65f6\u5019, \u4f1a\u6309\u987a\u5e8f\u5728\u56db\u79cd\u73af\u5883\u4e2d\u8fd0\u884c\u6e38\u620f:</p> <ul> <li>\u7eaf\u7cb9\u7684Linux native: \u548cProject-N\u7684\u7ec4\u4ef6\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb, \u7528\u4e8e\u4fdd\u8bc1\u6e38\u620f\u672c\u8eab\u786e\u5b9e\u53ef\u4ee5\u6b63\u786e\u8fd0\u884c. \u5728\u66f4\u6362\u5e93\u7684\u7248\u672c\u6216\u8005\u4fee\u6539\u6e38\u620f\u4ee3\u7801\u4e4b\u540e, \u90fd\u4f1a\u5148\u5728Linux native\u4e0a\u8fdb\u884c\u6d4b\u8bd5.</li> <li>Navy\u4e2d\u7684native: \u7528Navy\u4e2d\u7684\u5e93\u66ff\u4ee3Linux native\u7684\u5e93, \u6d4b\u8bd5\u6e38\u620f\u662f\u5426\u80fd\u5728Navy\u5e93\u7684\u652f\u6491\u4e0b\u6b63\u786e\u8fd0\u884c.</li> <li>AM\u4e2d\u7684native: \u7528Nanos-lite, libos\u548cNewlib\u66ff\u4ee3Linux\u7684\u7cfb\u7edf\u8c03\u7528\u548cglibc, \u6d4b\u8bd5\u6e38\u620f\u662f\u5426\u80fd\u5728Nanos-lite\u53ca\u5176\u8fd0\u884c\u65f6\u73af\u5883\u7684\u652f\u6491\u4e0b\u6b63\u786e\u8fd0\u884c.</li> <li>NEMU: \u7528NEMU\u66ff\u4ee3\u771f\u673a\u786c\u4ef6, \u6d4b\u8bd5\u6e38\u620f\u662f\u5426\u80fd\u5728NEMU\u7684\u652f\u6491\u4e0b\u6b63\u786e\u8fd0\u884c.</li> </ul> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5, \u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u5feb\u5b9a\u4f4d\u5230bug\u6240\u5728\u7684\u62bd\u8c61\u5c42\u6b21. \u6211\u4eec\u4e4b\u6240\u4ee5\u80fd\u8fd9\u6837\u505a, \u90fd\u662f\u5f97\u76ca\u4e8e\"\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\"\u8fd9\u4e2a\u7ed3\u8bba: \u6211\u4eec\u53ef\u4ee5\u628a\u67d0\u4e2a\u62bd\u8c61\u5c42\u4e4b\u4e0b\u7684\u90e8\u5206\u66ff\u6362\u6210\u4e00\u4e2a\u53ef\u9760\u7684\u5b9e\u73b0, \u5148\u72ec\u7acb\u6d4b\u8bd5\u4e00\u4e2a\u62bd\u8c61\u5c42\u7684\u4e0d\u53ef\u9760\u5b9e\u73b0, \u7136\u540e\u518d\u628a\u5176\u5b83\u62bd\u8c61\u5c42\u7684\u4e0d\u53ef\u9760\u5b9e\u73b0\u9010\u4e2a\u66ff\u6362\u8fdb\u6765\u5e76\u6d4b\u8bd5. \u4e0d\u8fc7\u8fd9\u8981\u6c42\u4f60\u7f16\u5199\u7684\u4ee3\u7801\u90fd\u662f\u53ef\u79fb\u690d\u7684, \u5426\u5219\u5c06\u65e0\u6cd5\u652f\u6301\u62bd\u8c61\u5c42\u7684\u66ff\u6362.</p> <p>\u5c3d\u7ba1\u529f\u80fd\u5b9e\u73b0\u7684\u78d5\u78d5\u7eca\u7eca\uff0c\u4f46\u662f\u6700\u4e3b\u8981\u662f\u7406\u89e3\u6982\u5ff5\uff01\u7406\u6e05\u5c42\u6b21\u3002</p> <p>\u8fd9\u91cc\u8fd8\u662f\u63a8\u8350\u770b\u770b\u8fd9\u4e2a\u535a\u4e3b\u7684\uff1aICS PA 3 (vgalaxy.work)</p> <p>\u57fa\u672c\u8d34\u51fa\u4e86\u81ea\u5df1\u7684\u5b9e\u73b0\u8fc7\u7a0b\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#pal","title":"PAL (\u4ed9\u5251\u5947\u4fa0\u4f20)","text":"<p>\u6700\u671f\u5f85\u7684\u4e00\u4e2a\u54c8\u54c8\uff0c\u5176\u5b9e\u5df2\u7ecf\u5728\u4e0d\u77e5\u4e0d\u89c9\u4e2d\u5b8c\u6210\u4e86\u54c8\u54c8\uff0c\u524d\u9762\u81ea\u5df1\u50bb\u50bb\u5730\u770b\u5230MENU \u8fd0\u884c\u4e0d\u4e86\uff0c\u8fd8\u628a 8\u4f4d \u50cf\u7d20\u7684\u5199\u4e86\u54c8\u54c8\u54c8\u3002</p> <p>\u4f46\u662f\u8fd0\u884c\u4e0d\u4e86\uff0c\u53c8\u662f\u4e4b\u524d\u90a3\u4e2aout of bound \u7684 bug\uff0c</p> <p>\u516b\u6210\u81ea\u5df1\u81ea\u5df1\u5199\u7684 8\u4f4d pixels \u6709\u70b9\u95ee\u9898\u3002\u7a0d\u5fae\u6298\u817e\u4e00\u4e0b\uff0c\u518d\u8865\u5145\u4e00\u4e0b WaitEvent\u548cPollEvent\uff0c\u5b9e\u73b0\u4e2a <code>SDL_GetKeyState</code> \u6709\u4e86~~</p> <p></p> <p>\u611f\u89c9\u8fd8\u4e0d\u9519~\u6309\u952e\u7a0d\u5fae\u5361\u4e86\u70b9\uff0c\u5176\u4ed6\u90fd\u8fd8\u597d\u3002</p> <p>\u73a9\u4e86\u4e00\u4f1a\u53d1\u73b0\u81ea\u5df1\u8fd8\u662f\u633a\u559c\u6b22\u73a9\u8fd9\u79cd\u6e38\u620f\u7684\u54c8\u54c8\u3002\u7f51\u4e0a\u627e\u627e\u770b\u80fd\u4e0d\u80fd\u914d\u5408\u7740\u653b\u7565\u7ee7\u7eed\u73a9\u73a9</p> <p></p> <p></p> <p></p> <p></p> <p></p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u539f\u7248\u7684\u4ed9\u5251\u5947\u4fa0\u4f20\u662f\u9488\u5bf9Windows\u5e73\u53f0\u5f00\u53d1\u7684, \u56e0\u6b64\u5b83\u5e76\u4e0d\u80fd\u5728GNU/Linux\u4e2d\u8fd0\u884c(\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48\u5417?), \u4e5f\u4e0d\u80fd\u5728Navy-apps\u4e2d\u8fd0\u884c.</p> <p>\u53ef\u6267\u884c\u6587\u4ef6\u7684\u683c\u5f0f\u4e0d\u4e00\u6837\u3002</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u6846\u67b6\u662f\u5982\u4f55\u5de5\u4f5c\u7684?</p> <p>\u6211\u4eec\u5728PA2\u4e2d\u8ba8\u8bba\u8fc7\u4e00\u4e2a\u6e38\u620f\u7684\u57fa\u672c\u6846\u67b6, \u5c1d\u8bd5\u9605\u8bfb\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u4ee3\u7801, \u627e\u51fa\u57fa\u672c\u6846\u67b6\u662f\u901a\u8fc7\u54ea\u4e9b\u51fd\u6570\u5b9e\u73b0\u7684. \u627e\u5230\u4e4b\u540e, \u53ef\u80fd\u4f1a\u5bf9\u4f60\u8c03\u8bd5\u4ed9\u5251\u5947\u4fa0\u4f20\u5e26\u6765\u4e00\u5b9a\u7684\u5e2e\u52a9. \u867d\u7136\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u4ee3\u7801\u5f88\u591a, \u4f46\u4e3a\u4e86\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898, \u4f60\u5e76\u4e0d\u9700\u8981\u9605\u8bfb\u5927\u91cf\u7684\u4ee3\u7801.</p> <pre><code>while (1) {\n  \u7b49\u5f85\u65b0\u7684\u4e00\u5e27();  // AM_TIMER_UPTIME\n  \u5904\u7406\u7528\u6237\u6309\u952e();  // AM_INPUT_KEYBRD\n  \u66f4\u65b0\u6e38\u620f\u903b\u8f91();  // TRM\n  \u7ed8\u5236\u65b0\u7684\u5c4f\u5e55();  // AM_GPU_FBDRAW\n}\n</code></pre> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u811a\u672c\u5f15\u64ce</p> <p>\u5728<code>navy-apps/apps/pal/repo/src/game/script.c</code>\u4e2d\u6709\u4e00\u4e2a<code>PAL_InterpretInstruction()</code>\u7684\u51fd\u6570, \u5c1d\u8bd5\u5927\u81f4\u4e86\u89e3\u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u548c\u884c\u4e3a. \u7136\u540e\u5927\u80c6\u731c\u6d4b\u4e00\u4e0b, \u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u5f00\u53d1\u8005\u662f\u5982\u4f55\u5f00\u53d1\u8fd9\u6b3e\u6e38\u620f\u7684? \u4f60\u5bf9\"\u6e38\u620f\u5f15\u64ce\"\u662f\u5426\u6709\u65b0\u7684\u8ba4\u8bc6?</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4e0d\u518d\u795e\u79d8\u7684\u79d8\u6280</p> <p>\u7f51\u4e0a\u6d41\u4f20\u7740\u4e00\u4e9b\u5173\u4e8e\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u79d8\u6280, \u5176\u4e2d\u7684\u82e5\u5e72\u6761\u79d8\u6280\u5982\u4e0b:</p> <ol> <li>\u5f88\u591a\u4eba\u5230\u4e86\u4e91\u59e8\u90a3\u91cc\u90fd\u4f1a\u53bb\u62ff\u4e09\u6b21\u94b1, \u5176\u5b9e\u62ff\u4e00\u6b21\u5c31\u4f1a\u8ba9\u94b1\u7bb1\u7206\u6ee1! \u4f60\u62ff\u4e86\u4e00\u6b21\u94b1\u5c31\u53bb\u4e70\u5251\u628a\u94b1\u7528\u5230\u53ea\u5269\u4e00\u5343\u591a, \u7136\u540e\u53bb\u9053\u58eb\u90a3\u91cc, \u5148\u4e0d\u8981\u4e0a\u697c, \u53bb\u638c\u67dc\u90a3\u91cc\u4e70\u9152, \u591a\u4e70\u51e0\u6b21\u4f60\u5c31\u4f1a\u53d1\u73b0\u94b1\u7528\u4e0d\u5b8c\u4e86.</li> <li>\u4e0d\u65ad\u4f7f\u7528\u4e7e\u5764\u4e00\u63b7(\u94b1\u5fc5\u987b\u591a\u4e8e\u4e94\u5343\u6587)\u7528\u5230\u8d22\u4ea7\u4f4e\u4e8e\u4e94\u5343\u6587, \u94b1\u4f1a\u66b4\u589e\u5230\u4e0a\u9650, \u5982\u6b64\u4e00\u6765\u5c31\u6709\u7528\u4e0d\u5b8c\u7684\u94b1\u4e86</li> <li>\u5f53\u674e\u900d\u9065\u7b49\u7ea7\u5230\u8fbe99\u7ea7\u65f6, \u75285~10\u53ea\u91d1\u8695\u738b, \u7ecf\u9a8c\u70b9\u53c8\u8dd1\u51fa\u6765\u4e86, \u800c\u4e14\u5347\u7ea7\u6240\u9700\u7ecf\u9a8c\u4f1a\u53d8\u56de\u521d\u671f5~10\u7ea7\u5185\u7684\u7ecf\u9a8c\u503c, \u7136\u540e\u53bb\u6253\u654c\u4eba\u6216\u7528\u91d1\u8695\u738b\u5347\u7ea7, \u53ef\u4ee5\u5b66\u5230\u7075\u513f\u7684\u6cd5\u672f(\u4ece\u4e94\u6c14\u671d\u5143\u5f00\u59cb); \u5347\u5230199\u7ea7\u540e\u518d\u75285~10\u53ea\u91d1\u8695\u738b, \u7ecf\u9a8c\u70b9\u518d\u8dd1\u51fa\u6765, \u6240\u9700\u5347\u7ea7\u7ecf\u9a8c\u4e5f\u662f\u5f88\u4f4e, \u53ef\u4ee5\u5b66\u5230\u6708\u5982\u7684\u6cd5\u672f(\u4ece\u4e00\u9633\u6307\u5f00\u59cb); \u5230299\u7ea7\u540e\u518d\u752810~30\u53ea\u91d1\u8695\u738b, \u7ecf\u9a8c\u70b9\u51fa\u6765\u540e\u7ee7\u7eed\u5347\u7ea7, \u53ef\u5b66\u5230\u963f\u5974\u7684\u6cd5\u672f(\u4ece\u4e07\u8681\u8680\u8c61\u5f00\u59cb).</li> </ol> <p>\u5047\u8bbe\u8fd9\u4e9b\u4e0a\u8ff0\u8fd9\u4e9b\u79d8\u6280\u5e76\u975e\u6e38\u620f\u5236\u4f5c\u4eba\u5458\u7684\u672c\u610f, \u8bf7\u5c1d\u8bd5\u89e3\u91ca\u8fd9\u4e9b\u79d8\u6280\u4e3a\u4ec0\u4e48\u80fd\u751f\u6548.</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#am-kernels","title":"am-kernels","text":"<p>\u505a\u5230\u8fd9\u91cc\u7684\u65f6\u5019\uff0c\u9700\u8981\u7406\u6e05\u8c03\u7528\u6d41\u7a0b\uff0c\u4e0d\u7136\u6709\u76f8\u540c\u7684\u4e1c\u897f\u4f1a\u5f88\u61f5\u903c\uff1a</p> <ol> <li><code>am-kernels</code> \u4f5c\u4e3a\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd0\u884c\u5728 <code>navy-apps</code> \uff0c\u5176\u4f7f\u7528\u7684\u662f <code>libam</code> \u4e2d\u5b9e\u73b0\u7684 API</li> <li>API \u901a\u8fc7 Navy \u7684\u8fd0\u884c\u65f6\u73af\u5883 \u5b9e\u73b0\uff0c</li> <li>\u8fdb\u4e00\u6b65\uff0cNavy \u7684\u8fd0\u884c\u65f6\u73af\u5883 \u53c8\u4f1a\u4f9d\u8d56\u4e8e \u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u5c31\u662f <code>libos</code> \u5411\u4e0a\u63d0\u4f9b\u7684 \u7cfb\u7edf\u8c03\u7528\u63a5\u53e3 \u548c \u5404\u79cd\u6807\u51c6\u5e93\u51fd\u6570\u63a5\u53e3\u3002</li> <li><code>libos</code> \u5411\u4e0b\u5b9e\u9645\u4e0a\u5c01\u88c5\u4e86 <code>nanos-lite</code> \u7684\u5404\u79cd\u7cfb\u7edf\u8c03\u7528\u3002</li> <li>\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0\u6709\u4e9b\u4f1a\u4f7f\u7528 \u4f4d\u4e8ehal\u5c42 \u7684 <code>am</code> \u7684 API</li> <li><code>am</code> \u7684 API \u53c8\u4f1a\u4f7f\u7528 \u786c\u4ef6 <code>NEMU</code> </li> </ol> <p>\u5177\u4f53\u5bf9\u4e8e\u800c\u5bf9\u4e8e <code>am-kernels</code>\uff0c\u4ee5\u4e00\u4e2a\u5b9e\u9645\u7684\u7cfb\u7edf\u8c03\u7528\u4e3a\u4f8b\uff1a</p> <pre><code>(Navy) __am_timer_uptime -&gt; gettimeofday -&gt; sys_gettimeofday -&gt; io_read -&gt; ioe_read -&gt; (AM) _am_timer_uptime\n</code></pre> <p>\u540c\u540d\u4e86\uff1f\u5e76\u4e0d\uff0c\u7f16\u8bd1\u5668\u4f1a\u533a\u5206\u3002</p> <p>\u5b9e\u73b0 <code>libam</code> \u76f8\u5173API \u4e4b\u540e\uff0c</p> <p><code>navy-apps/apps/am-kernels/Makefile</code> \u4f1a\u628a <code>libam</code> \u52a0\u5165\u94fe\u63a5\u7684\u5217\u8868\u3002</p> <p>\u5728 <code>navy-apps/apps/am-kernels</code> \u76ee\u5f55\u4e0b\u952e\u5165\uff1a</p> <pre><code>make ISA=riscv32 ALL=typing-game install\nmake ISA=riscv32 ALL=coremark install\nmake ISA=riscv32 ALL=dhrystone install\n</code></pre> <p>\u751f\u6210\u5bf9\u5e94\u7684 \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> <p>\u6216\u8005\u76f4\u63a5\u5728 <code>nanos-lite</code> \u4e0b\uff0c\u50cf\u4e4b\u524d\u4e00\u6837 <code>update</code>\uff0c<code>run</code> \u5373\u53ef\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5728Navy\u4e2d\u8fd0\u884cmicrobench</p> <p>\u5c1d\u8bd5\u628amicrobench\u7f16\u8bd1\u5230Navy\u5e76\u8fd0\u884c, \u4f60\u5e94\u8be5\u4f1a\u53d1\u73b0\u8fd0\u884c\u9519\u8bef, \u8bf7\u5c1d\u8bd5\u5206\u6790\u539f\u56e0.</p> <p>\u8fd9\u91cc\u4e4b\u540e\u518d\u5c1d\u8bd5\u628a\u522b\u7684\u5e94\u7528\u52a0\u8fdb\u6765\uff0c\u4f46\u662f\uff1a</p> <ol> <li>\u4fee\u6539 <code>navy-apps/apps/am-kernels/Makefile</code></li> <li>\u4f3c\u4e4e\u65e0\u6cd5\u6307\u5b9a mainargs</li> <li>\u5927\u90e8\u5206\u6d4b\u8bd5\u90fd\u56e0\u4e3a\u5185\u5b58\u4e0d\u8db3\u800c\u8df3\u8fc7\u4e86\u2026\u2026</li> </ol> <p>\u624b\u52a8\u66f4\u6539</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#fceux","title":"FCEUX","text":"<p>\u7a0d\u5fae\u6539\u4e00\u4e0b\u8def\u5f84\uff1a<code>FCEUX_PATH = $(AM_HOME)/../fceux-am</code></p> <p>\u8fd8\u6709\u70b9\u95ee\u9898\uff1a<code>fceux-am/src/drivers/sdl/sdl.cpp</code></p> <pre><code>#undef __NO_FILE_SYSTEM__\n\n#ifdef __NO_FILE_SYSTEM__\nint main(const char *romname)\n#else\nint main(int argc, char *argv[])\n#endif\n{\n  ioe_init();\n    .....\n  printf(\"ROM is %s\\n\", romname);\n ....   \n}\n//\n</code></pre> <p>\u8fd0\u884c\u5728 OS \u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53c2\u6570\u600e\u4e48\u6307\u5b9a\uff1f\u4e5f\u5c31\u662fromname\u53c2\u6570\uff0c\u6ca1\u6cd5\u6307\u5b9a\u5c31\u4e00\u76f4\u4e00\u76f4\u89e3\u5f15\u7528 <code>NULL</code>\u3002\u5728\u54ea\u91cc\u4f20\u53c2\u6211\u6ca1\u627e\u5230</p> <p>\u90a3\u5c31\u80fd\u4e0d\u80fd\u7528 argv\u7684\uff1f\u81ea\u5df1 undef \u4e2a<code>__NO_FILE_SYSTEM__</code> \u5427 \u6216\u8005\u901a\u7528\u4e00\u70b9\uff0c\u76f4\u63a5\u5728 <code>Makefile</code> \u91cc\u5b9a\u4e49</p> <p>\u4e0d\u8fc7\u4e3a\u5565\u6211\u5728\u5404\u4e2a\u5730\u65b9\u90fd\u8bbe\u7f6e\u4e86\u4f46\u662f\u90fd\u4e0d\u884c\uff0c\u6240\u4ee5\u6211\u76f4\u63a5\u5728 \u51fd\u6570\u4e2d\u7684\u5b9a\u4e49\u4e86\uff0c\u6709\u7528\u8bb0\u5f97\u53d6\u6d88\u3002</p> <p>\u53e6\u4e00\u4e2a\u662f\u5728native\u4e0a\u8dd1\u4e86\u8dd1\uff0c\u52a0\u4e86\u70b9\u4e1c\u897f\uff0c\u540c\u6837\u8fd8\u8981\u624b\u52a8\u53d6\u6d88\uff0c\u6216\u8bb8\u641e\u641e <code>Makefile</code> \u4e5f\u53ef\u4ee5\u7684\u3002</p> <pre><code>#define __riscv__\n\n#if defined(__X86__)\n# define nemu_trap(code) asm volatile (\"int3\" : :\"a\"(code))\n#elif defined(__MIPS32__)     \n# define nemu_trap(code) asm volatile (\"move $v0, %0; sdbbp\" : :\"r\"(code))\n#elif defined(__riscv__)\n# define nemu_trap(code) asm volatile(\"mv a0, %0; ebreak\" : :\"r\"(code))\n#elif defined(__LOONGARCH32R__)\n# define nemu_trap(code) asm volatile(\"move $a0, %0; break 0\" : :\"r\"(code))\n#elif\n# error unsupported ISA __ISA__\n#endif\n\nvoid putch(char ch) {\n    putchar(ch);\n}\n\nvoid halt(int code) {\n    nemu_trap(code);\n\n    // should not reach here          \n    while (1);\n}\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u5728Navy\u4e0a\u8fd0\u884cNanos-lite?</p> <p>\u65e2\u7136\u80fd\u5728Navy\u4e0a\u8fd0\u884c\u57fa\u4e8eAM\u7684FCEUX, \u90a3\u4e48\u4e3a\u4e86\u70ab\u8000, \u5728Navy\u4e0a\u8fd0\u884cNanos-lite\u4e5f\u5e76\u4e0d\u662f\u4e0d\u53ef\u80fd\u7684. \u601d\u8003\u4e00\u4e0b, \u5982\u679c\u60f3\u5728Navy\u4e0a\u5b9e\u73b0CTE, \u6211\u4eec\u8fd8\u9700\u8981\u4e9b\u4ec0\u4e48\u5462?</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5e94\u8be5\u662f\u53ef\u4ee5\u7ee7\u7eed\u5728 <code>navy-apps</code> \u4e0a\u7ee7\u7eed\u8fd0\u884c <code>nanos-lite</code> \u7684\uff0c\u7ee7\u7eed\u65e0\u9650\u5957\u5a03\u3002</p> <p>\u60f3\u60f3\uff0cCTE \u62bd\u8c61\u4e86\u4ec0\u4e48\uff1f\u62bd\u8c61 <code>gpr</code>\u3001<code>csr</code> \u7ed9\u4e0a\u5c42\u3002\u56de\u770b\u8bb2\u4e49\uff1a</p> <p>\u6211\u4eec\u521a\u624d\u63d0\u5230\u4e86\u7a0b\u5e8f\u7684\u72b6\u6001, \u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6709\u4e00\u4e2a\u7b49\u4ef7\u7684\u672f\u8bed, \u53eb\"\u4e0a\u4e0b\u6587\". \u56e0\u6b64, \u786c\u4ef6\u63d0\u4f9b\u7684\u4e0a\u8ff0\u5728\u64cd\u4f5c\u7cfb\u7edf\u548c\u7528\u6237\u7a0b\u5e8f\u4e4b\u95f4\u5207\u6362\u6267\u884c\u6d41\u7684\u529f\u80fd, \u5728\u64cd\u4f5c\u7cfb\u7edf\u770b\u6765, \u90fd\u53ef\u4ee5\u5212\u5165\u4e0a\u4e0b\u6587\u7ba1\u7406\u7684\u4e00\u90e8\u5206.</p> <p>\u4e0eIOE\u4e00\u6837, \u4e0a\u4e0b\u6587\u7ba1\u7406\u7684\u5177\u4f53\u5b9e\u73b0\u4e5f\u662f\u67b6\u6784\u76f8\u5173\u7684: \u4f8b\u5982\u4e0a\u6587\u63d0\u5230, x86/mips32/riscv32\u4e2d\u5206\u522b\u901a\u8fc7<code>int</code>/<code>syscall</code>/<code>ecall</code>\u6307\u4ee4\u6765\u8fdb\u884c\u81ea\u9677, <code>native</code>\u4e2d\u751a\u81f3\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u795e\u5947\u7684\u5e93\u51fd\u6570\u6765\u6a21\u62df\u76f8\u5e94\u7684\u529f\u80fd; \u800c\u4e0a\u4e0b\u6587\u7684\u5177\u4f53\u5185\u5bb9, \u5728\u4e0d\u540c\u7684\u67b6\u6784\u4e0a\u4e5f\u663e\u7136\u4e0d\u4e00\u6837(\u6bd4\u5982\u5bc4\u5b58\u5668\u5c31\u5df2\u7ecf\u4e0d\u4e00\u6837\u4e86). \u4e8e\u662f, \u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u4e0b\u6587\u7ba1\u7406\u7684\u529f\u80fd\u5212\u5165\u5230AM\u7684\u4e00\u7c7b\u65b0\u7684API\u4e2d, \u540d\u5b57\u53ebCTE(ConText Extension).</p> <p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662f, \u5982\u4f55\u5c06\u4e0d\u540c\u67b6\u6784\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406\u529f\u80fd\u62bd\u8c61\u6210\u7edf\u4e00\u7684API\u5462? \u6362\u53e5\u8bdd\u8bf4, \u6211\u4eec\u9700\u8981\u601d\u8003, \u64cd\u4f5c\u7cfb\u7edf\u7684\u5904\u7406\u8fc7\u7a0b\u5176\u5b9e\u9700\u8981\u54ea\u4e9b\u4fe1\u606f?</p> <ul> <li>\u9996\u5148\u5f53\u7136\u662f\u5f15\u53d1\u8fd9\u6b21\u6267\u884c\u6d41\u5207\u6362\u7684\u539f\u56e0, \u662f\u7a0b\u5e8f\u96640, \u975e\u6cd5\u6307\u4ee4, \u8fd8\u662f\u89e6\u53d1\u65ad\u70b9, \u53c8\u6216\u8005\u662f\u7a0b\u5e8f\u81ea\u613f\u9677\u5165\u64cd\u4f5c\u7cfb\u7edf? \u6839\u636e\u4e0d\u540c\u7684\u539f\u56e0, \u64cd\u4f5c\u7cfb\u7edf\u90fd\u4f1a\u8fdb\u884c\u4e0d\u540c\u7684\u5904\u7406.  </li> <li>\u7136\u540e\u5c31\u662f\u7a0b\u5e8f\u7684\u4e0a\u4e0b\u6587\u4e86, \u5728\u5904\u7406\u8fc7\u7a0b\u4e2d, \u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u8bfb\u51fa\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e00\u4e9b\u5bc4\u5b58\u5668, \u6839\u636e\u5b83\u4eec\u7684\u4fe1\u606f\u6765\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5904\u7406. \u4f8b\u5982\u64cd\u4f5c\u7cfb\u7edf\u8bfb\u51faPC\u6240\u6307\u5411\u7684\u975e\u6cd5\u6307\u4ee4, \u770b\u770b\u5176\u662f\u5426\u80fd\u88ab\u6a21\u62df\u6267\u884c. \u4e8b\u5b9e\u4e0a, \u901a\u8fc7\u8fd9\u4e9b\u4e0a\u4e0b\u6587, \u64cd\u4f5c\u7cfb\u7edf\u8fd8\u80fd\u5b9e\u73b0\u4e00\u4e9b\u795e\u5947\u7684\u529f\u80fd, \u4f60\u5c06\u4f1a\u5728PA4\u4e2d\u4e86\u89e3\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f.</li> </ul> <p>...</p> <p>\u5bf9\u4e8e\u4e0a\u4e0b\u6587, \u6211\u4eec\u53ea\u80fd\u5c06\u63cf\u8ff0\u4e0a\u4e0b\u6587\u7684\u7ed3\u6784\u4f53\u7c7b\u578b\u540d\u7edf\u4e00\u6210<code>Context</code>, \u81f3\u4e8e\u5176\u4e2d\u7684\u5177\u4f53\u5185\u5bb9, \u5c31\u65e0\u6cd5\u8fdb\u4e00\u6b65\u8fdb\u884c\u62bd\u8c61\u4e86. \u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\u4e0d\u540c\u67b6\u6784\u4e4b\u95f4\u4e0a\u4e0b\u6587\u4fe1\u606f\u7684\u5dee\u5f02\u8fc7\u5927, \u6bd4\u5982mips32\u670932\u4e2a\u901a\u7528\u5bc4\u5b58\u5668, \u5c31\u4ece\u8fd9\u4e00\u70b9\u6765\u770b, mips32\u548cx86\u7684<code>Context</code>\u6ce8\u5b9a\u662f\u65e0\u6cd5\u62bd\u8c61\u6210\u5b8c\u5168\u7edf\u4e00\u7684\u7ed3\u6784\u7684. \u6240\u4ee5\u5728AM\u4e2d, <code>Context</code>\u7684\u5177\u4f53\u6210\u5458\u4e5f\u662f\u7531\u4e0d\u540c\u7684\u67b6\u6784\u81ea\u5df1\u5b9a\u4e49\u7684, \u6bd4\u5982<code>x86-nemu</code>\u7684<code>Context</code>\u7ed3\u6784\u4f53\u5728<code>abstract-machine/am/include/arch/x86-nemu.h</code>\u4e2d\u5b9a\u4e49. \u56e0\u6b64, \u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5bf9<code>Context</code>\u6210\u5458\u7684\u76f4\u63a5\u5f15\u7528, \u90fd\u5c5e\u4e8e\u67b6\u6784\u76f8\u5173\u7684\u884c\u4e3a, \u4f1a\u635f\u574f\u64cd\u4f5c\u7cfb\u7edf\u7684\u53ef\u79fb\u690d\u6027. \u4e0d\u8fc7\u5927\u591a\u6570\u60c5\u51b5\u4e0b, \u64cd\u4f5c\u7cfb\u7edf\u5e76\u4e0d\u9700\u8981\u5355\u72ec\u8bbf\u95ee<code>Context</code>\u7ed3\u6784\u4e2d\u7684\u6210\u5458. CTE\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7684\u63a5\u53e3, \u6765\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u5728\u5fc5\u8981\u7684\u65f6\u5019\u8bbf\u95ee\u5b83\u4eec, \u4ece\u800c\u4fdd\u8bc1\u64cd\u4f5c\u7cfb\u7edf\u7684\u76f8\u5173\u4ee3\u7801\u4e0e\u67b6\u6784\u65e0\u5173.</p> <p><code>navy</code> \u63d0\u4f9b\u64cd\u4f5c <code>gpr</code>\u3001<code>csr</code> \u7684 API\u7ed9\u4e0a\u5c42\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#oslab0","title":"oslab0","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u673a\u667a\u7684\u4f60\u4e5f\u8bb8\u4f1a\u60f3: \u54c7\u585e, \u4e0b\u5b66\u671f\u7684oslab0\u6211\u4e0d\u5c31\u6709\u4f18\u79c0\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u4e86\u5417? \u4e0d\u8fc7\u6211\u4eec\u5df2\u7ecf\u5bf9\u53d1\u5e03\u7684\u4ee3\u7801\u8fdb\u884c\u4e86\u67d0\u79cd\u7279\u6b8a\u7684\u5904\u7406. \u5728\u6cae\u4e27\u4e4b\u4f59, \u4e0d\u59a8\u601d\u8003\u4e00\u4e0b, \u5982\u679c\u8981\u4f60\u6765\u5b9e\u73b0\u8fd9\u4e00\u7279\u6b8a\u7684\u5904\u7406, \u4f60\u4f1a\u5982\u4f55\u5b9e\u73b0? \u8fd9\u548cPA1\u4e2d\u7684\u8868\u8fbe\u5f0f\u6c42\u503c\u6709\u4ec0\u4e48\u76f8\u4f3c\u4e4b\u5904\u5417?</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#nplayer-nju-player-pa2","title":"NPlayer (NJU Player) \uff08\u9009\u505a\uff1a\u9700\u5b8c\u6210PA2\u58f0\u5361\uff09","text":""},{"location":"ysyx/pa/pa3/pa3.html#pal_1","title":"PAL (\u5e26\u97f3\u4e50\u548c\u97f3\u6548)","text":""},{"location":"ysyx/pa/pa3/pa3.html#flappy-bird_1","title":"Flappy Bird (\u5e26\u97f3\u6548\uff09","text":"<p>\u8fd9\u4e09\u4e2a\u91cc\u9762\u5f88\u591a C++ \u7684\u4e1c\u897f\uff0c\u53ef\u4ee5\u597d\u597d\u73a9\u3002</p>"},{"location":"ysyx/pa/pa3/pa3.html#3","title":"\u57fa\u7840\u8bbe\u65bd(3)","text":""},{"location":"ysyx/pa/pa3/pa3.html#difftest","title":"\u81ea\u7531\u5f00\u5173DiffTest\u6a21\u5f0f","text":""},{"location":"ysyx/pa/pa3/pa3.html#_20","title":"\u5feb\u7167","text":"<p>\u7a0b\u5e8f\u662f\u4e2a <code>S = &lt;R, M&gt;</code> \u7684\u72b6\u6001\u673a</p> <p>\u5bc4\u5b58\u5668\u53ef\u4ee5\u8868\u793a\u4e3a <code>R = {GPR, PC, SR}</code>\uff0c\u5176\u4e2d <code>SR</code> \u4e3a\u7cfb\u7edf\u5bc4\u5b58\u5668</p> <p>\u8fd8\u662f\u611f\u89c9\u6ca1\u5565\u7528\uff0c\u56e0\u4e3a NEMU \u4e00\u76f4\u90fd\u662f <code>batch mode</code></p>"},{"location":"ysyx/pa/pa3/pa3.html#_21","title":"\u5c55\u793a\u4f60\u7684\u6279\u5904\u7406\u7cfb\u7edf","text":"<p>\u4f60\u4e4b\u524d\u5df2\u7ecf\u5728Navy\u4e0a\u6267\u884c\u4e86\u5f00\u673a\u83dc\u5355\u548cNTerm, \u4f46\u5b83\u4eec\u90fd\u4e0d\u652f\u6301\u6267\u884c\u5176\u5b83\u7a0b\u5e8f. \u8fd9\u662f\u56e0\u4e3a\"\u6267\u884c\u5176\u5b83\u7a0b\u5e8f\"\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u7cfb\u7edf\u8c03\u7528\u6765\u652f\u6301, \u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u5c31\u662f<code>SYS_execve</code>, \u5b83\u7684\u4f5c\u7528\u662f\u7ed3\u675f\u5f53\u524d\u7a0b\u5e8f\u7684\u8fd0\u884c, \u5e76\u542f\u52a8\u4e00\u4e2a\u6307\u5b9a\u7684\u7a0b\u5e8f. \u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u6bd4\u8f83\u7279\u6b8a, \u5982\u679c\u5b83\u6267\u884c\u6210\u529f, \u5c31\u4e0d\u4f1a\u8fd4\u56de\u5230\u5f53\u524d\u7a0b\u5e8f\u4e2d, \u5177\u4f53\u4fe1\u606f\u53ef\u4ee5\u53c2\u8003<code>man execve</code>. </p> <p>\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528, \u4f60\u53ea\u9700\u8981\u5728\u76f8\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u51fd\u6570\u4e2d\u8c03\u7528<code>naive_uload()</code>\u5c31\u53ef\u4ee5\u4e86. \u76ee\u524d\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3<code>filename</code>\u5373\u53ef, <code>argv</code>\u548c<code>envp</code>\u8fd9\u4e24\u4e2a\u53c2\u6570\u53ef\u4ee5\u6682\u65f6\u5ffd\u7565.</p> <ul> <li> <p>\u505a1</p> <p>\u53ef\u4ee5\u8fd0\u884c\u5176\u5b83\u7a0b\u5e8f\u7684\u5f00\u673a\u83dc\u5355</p> <p>\u4f60\u9700\u8981\u5b9e\u73b0<code>SYS_execve</code>\u7cfb\u7edf\u8c03\u7528, \u7136\u540e\u901a\u8fc7\u5f00\u673a\u83dc\u5355\u6765\u8fd0\u884c\u5176\u5b83\u7a0b\u5e8f. \u4f60\u5df2\u7ecf\u5b9e\u73b0\u8fc7\u5f88\u591a\u7cfb\u7edf\u8c03\u7528\u4e86, \u9700\u8981\u6ce8\u610f\u54ea\u4e9b\u7ec6\u8282, \u8fd9\u91cc\u5c31\u4e0d\u5570\u55e6\u4e86.</p> <p>\u5c55\u793a\u4f60\u7684\u6279\u5904\u7406\u7cfb\u7edf</p> <p>\u6709\u4e86\u5f00\u673a\u83dc\u5355\u7a0b\u5e8f\u4e4b\u540e, \u5c31\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5b9e\u73b0\u4e00\u4e2a\u6709\u70b9\u6837\u5b50\u7684\u6279\u5904\u7406\u7cfb\u7edf\u4e86. \u4f60\u53ea\u9700\u8981\u4fee\u6539<code>SYS_exit</code>\u7684\u5b9e\u73b0, \u8ba9\u5b83\u8c03\u7528<code>SYS_execve</code>\u6765\u518d\u6b21\u8fd0\u884c<code>/bin/menu</code>, \u800c\u4e0d\u662f\u76f4\u63a5\u8c03\u7528<code>halt()</code>\u6765\u7ed3\u675f\u6574\u4e2a\u7cfb\u7edf\u7684\u8fd0\u884c. \u8fd9\u6837\u4ee5\u540e, \u5728\u4e00\u4e2a\u7528\u6237\u7a0b\u5e8f\u7ed3\u675f\u7684\u65f6\u5019, \u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u81ea\u52a8\u518d\u6b21\u8fd0\u884c\u5f00\u673a\u83dc\u5355\u7a0b\u5e8f, \u8ba9\u7528\u6237\u9009\u62e9\u4e00\u4e2a\u65b0\u7684\u7a0b\u5e8f\u6765\u8fd0\u884c.</p> <p>\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355</p> <p>\u4f7f\u7528 <code>exit</code> \u7ed3\u675f\u7684 Navy / AM \u7a0b\u5e8f\u4e0d\u591a\uff0c\u8fd8\u662f\u7528\u51e0\u4e2a\u8dd1\u5206\u7684\u5427\u3002</p> </li> </ul> <p>\u968f\u7740\u5e94\u7528\u7a0b\u5e8f\u6570\u91cf\u7684\u589e\u52a0, \u4f7f\u7528\u5f00\u673a\u83dc\u5355\u6765\u8fd0\u884c\u7a0b\u5e8f\u5c31\u4e0d\u662f\u90a3\u4e48\u65b9\u4fbf\u4e86: \u4f60\u9700\u8981\u4e0d\u65ad\u5730\u5f80\u5f00\u673a\u83dc\u5355\u4e2d\u6dfb\u52a0\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f. \u4e00\u79cd\u6bd4\u8f83\u65b9\u4fbf\u7684\u505a\u6cd5\u662f\u901a\u8fc7NTerm\u6765\u8fd0\u884c\u8fd9\u4e9b\u7a0b\u5e8f, \u4f60\u53ea\u8981\u952e\u5165\u7a0b\u5e8f\u7684\u8def\u5f84, \u4f8b\u5982<code>/bin/pal</code>.</p> <ul> <li> <p>\u505a</p> <p>\u5c55\u793a\u4f60\u7684\u6279\u5904\u7406\u7cfb\u7edf(2)</p> <p>\u5728NTerm\u7684\u5167\u5efaShell\u4e2d\u5b9e\u73b0\u547d\u4ee4\u89e3\u6790, \u628a\u952e\u5165\u7684\u547d\u4ee4\u4f5c\u4e3a\u53c2\u6570\u8c03\u7528<code>execve()</code>. \u7136\u540e\u628aNTerm\u4f5c\u4e3aNanos-lite\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u7a0b\u5e8f, \u5e76\u4fee\u6539<code>SYS_exit</code>\u7684\u5b9e\u73b0, \u8ba9\u5b83\u518d\u6b21\u8fd0\u884c<code>/bin/nterm</code>. \u76ee\u524d\u6211\u4eec\u6682\u4e0d\u652f\u6301\u53c2\u6570\u7684\u4f20\u9012, \u4f60\u53ef\u4ee5\u5148\u5ffd\u7565\u547d\u4ee4\u7684\u53c2\u6570.</p> <p>\u952e\u5165\u547d\u4ee4\u7684\u5b8c\u6574\u8def\u5f84\u662f\u4e00\u4ef6\u76f8\u5bf9\u7e41\u7410\u7684\u4e8b\u60c5. \u56de\u60f3\u6211\u4eec\u4f7f\u7528<code>ls</code>\u7684\u65f6\u5019, \u5e76\u4e0d\u9700\u8981\u952e\u5165<code>/bin/ls</code>. \u8fd9\u662f\u56e0\u4e3a\u7cfb\u7edf\u4e2d\u5b9a\u4e49\u4e86<code>PATH</code>\u8fd9\u4e2a\u73af\u5883\u53d8\u91cf, \u4f60\u53ef\u4ee5\u901a\u8fc7<code>man execvp</code>\u6765\u9605\u8bfb\u76f8\u5173\u7684\u884c\u4e3a. </p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba9NTerm\u4e2d\u7684\u5167\u5efaShell\u652f\u6301\u8fd9\u4e00\u529f\u80fd, \u4f60\u53ea\u9700\u8981\u901a\u8fc7<code>setenv()</code>\u51fd\u6570\u6765\u8bbe\u7f6e<code>PATH=/bin</code>, \u7136\u540e\u8c03\u7528<code>execvp()</code>\u6765\u6267\u884c\u65b0\u7a0b\u5e8f\u5373\u53ef. \u8c03\u7528<code>setenv()</code>\u65f6\u9700\u8981\u5c06<code>overwrite</code>\u53c2\u6570\u8bbe\u7f6e\u4e3a<code>0</code>, \u8fd9\u662f\u4e3a\u4e86\u53ef\u4ee5\u5728Navy native\u4e0a\u5b9e\u73b0\u540c\u6837\u7684\u6548\u679c.</p> <p>\u4e3aNTerm\u4e2d\u7684\u5167\u5efaShell\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u7684\u652f\u6301</p> <p>\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u4efb\u52a1, \u4f60\u53ea\u9700\u8981RTFM\u4e86\u89e3<code>setenv()</code>\u548c<code>execvp()</code>\u7684\u884c\u4e3a, \u5e76\u5bf9\u5167\u5efaShell\u7684\u4ee3\u7801\u8fdb\u884c\u5c11\u91cf\u4fee\u6539, \u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u548c\u4f60\u5e73\u65f6\u7684\u4f7f\u7528\u4f53\u9a8c\u975e\u5e38\u76f8\u4f3c\u7684Shell\u4e86.</p> <pre><code>static void sh_handle_cmd(const char *cmd) {\n    char tmp_cmd[64];\n    strcpy(tmp_cmd, cmd);\n    tmp_cmd[strlen(cmd) - 1] = '\\0';\n    setenv(\"PATH\", \"/bin\", 0);\n    execvp(tmp_cmd, NULL);\n}\n// navy-apps/apps/nterm/src/builtin-sh.cpp\n</code></pre> </li> </ul> <p>\u5c55\u793a~\uff01\uff1a</p> <p>\u8fd8\u662f\u8981\u6ce8\u610f <code>ramdisk</code> \u7684\u5927\u5c0f\u7684\uff0c\u6211\u76f4\u63a5\u6539\u4e86\u76f8\u5173\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u94fe\u63a5\u4f4d\u7f6e\uff1a</p> <pre><code>...\nLNK_ADDR = $(if $(VME), 0x40000000, 0x87000000)\n...\n</code></pre> <p>\u76f4\u63a5\u5c55\u793a\u89c6\u9891\uff01</p> <ul> <li> <p>\u601d\u8003\u9898\uff01\uff01\uff01</p> <p>\u7ec8\u6781\u62f7\u95ee</p> <p>\u81ea\u53e4\u4ee5\u6765, \u8ba1\u7b97\u673a\u7cfb\u7edf\u65b9\u5411\u7684\u8bfe\u7a0b\u5c31\u6709\u4e00\u4e2a\u7ec8\u6781\u62f7\u95ee:</p> <p>\u5f53\u4f60\u5728\u7ec8\u7aef\u952e\u5165<code>./hello</code>\u8fd0\u884cHello World\u7a0b\u5e8f\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u7a76\u7adf\u505a\u4e86\u4e9b\u4ec0\u4e48? </p> <p>\u4f60\u5df2\u7ecf\u5b9e\u73b0\u4e86\u6279\u5904\u7406\u7cfb\u7edf, \u5e76\u4e14\u6210\u529f\u901a\u8fc7NTerm\u6765\u8fd0\u884c\u5176\u5b83\u7a0b\u5e8f. \u5c3d\u7ba1\u6211\u4eec\u7684\u6279\u5904\u7406\u7cfb\u7edf\u7ecf\u8fc7\u4e86\u8bf8\u591a\u7b80\u5316, \u4f46\u8fd8\u662f\u4fdd\u7559\u4e86\u8ba1\u7b97\u673a\u53d1\u5c55\u53f2\u7684\u7cbe\u9ad3. \u5b9e\u73b0\u4e86\u6279\u5904\u7406\u7cfb\u7edf\u4e4b\u540e, \u4f60\u5bf9\u4e0a\u8ff0\u7684\u7ec8\u6781\u62f7\u95ee\u6709\u4ec0\u4e48\u65b0\u7684\u8ba4\u8bc6?</p> <p>\u77e5\u4e4e\u7684\u6709\u4e00\u4e2a\u56de\u7b54\u8bf4\u7684\uff1a<code>int a = 2;</code> \u8ba1\u7b97\u673a\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f\u597d\u50cf\u662fCMU\u7684\u5185\u5bb9\u3002</p> <p>\u5728 PA3.2 \u7684\u7ed3\u5c3e\u6211\u4eec\u5df2\u7ecf\u56de\u7b54\u8fc7\u8fd9\u4e2a\u95ee\u9898\u4e86\uff0c\u4f46\u90a3\u662f\u5728\u6ca1\u6709\u6279\u5904\u7406\u7cfb\u7edf\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u65f6\u5019\u7684\uff0c\u90a3\u65f6\u7684\u8ba1\u7b97\u673a\u4e5f\u80fd\u6b63\u5e38\u8fd0\u884c\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f46\u5bf9\u4e8e\u73b0\u4ee3\u7684\u6211\u4eec\u6765\u8bf4\uff0c\u90a3\u4e9b\u5185\u5bb9\u5c31\u592a\u53e4\u8001\u4e86\uff0c\u6240\u4ee5\uff0c\u5728 PA3.3 \u6211\u4eec\u6784\u5efa\u4e86\u6587\u4ef6\u7cfb\u7edf\uff08<code>sfs</code>\u3001<code>ramdisk</code>\uff09\u548c\u6279\u5904\u7406\u7cfb\u7edf\uff08\u7a0b\u5e8f\u6267\u884c\u5b8c\u4e00\u4e2a\u7a0b\u5e8f\u540e\uff0c\u81ea\u52a8\u81f3\u6267\u884c\u4e0b\u4e00\u4e2a\uff09\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e9b\u7a0d\u5fae\u73b0\u4ee3\u3001\u5185\u5bb9\u66f4\u591a\u3001\u66f4\u590d\u6742\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u91cd\u65b0\u56de\u7b54\u4e00\u904d\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e4b\u524d PA3.2 \u7684\u56de\u7b54\u4e5f\u53ea\u662f\u7b80\u5355\u7684\u4ece\u7cfb\u7edf\u8c03\u7528\u5c42\u9762\u5f00\u59cb\u5f80\u4e0b\u8bb2\u8d77\u3002\u5728\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u610f\u8bc6\u5230\u6211\u4eecPA3\u5b8c\u6210\u4e86\u8fd9\u4e2a\u95ee\u9898\u7b54\u6848\u76841.0\uff0c\u7b49\u5230 PA4 \u4e4b\u540e\uff0c\u5b8c\u6210\u4e86\u5206\u65f6\u591a\u4efb\u52a1\u3001\u4e0e\u66f4\u591a OS \u76f8\u5173\u7684\u5185\u5bb9\u4e4b\u540e\uff0c\u5e94\u8be5\u8fd8\u4f1a\u518d\u7b80\u5355\u8865\u5145\u4e00\u4e9b\u3002\u518d\u4e4b\u540e\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5206\u6790\u5b9e\u9645\u7684 Linux\u4e0a\u7684\u952e\u76d8\u76f8\u5173\u7684\u5185\u5bb9\uff08X11\u3001Socket \u901a\u4fe1...\uff09</p> <p>\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u6211\u4e3b\u8981\u914d\u5408\u7740\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\u7684\u4e24\u4e2a\u89c6\u89d2\u4ee5\u53ca\u4e00\u4e2a\u7269\u7406\u8ba1\u7b97\u673a\uff1a</p> <ul> <li>\u5fae\u89c2\u89c6\u89d2\uff1a\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a</li> <li>\u5b8f\u89c2\u89c6\u89d2\uff1a\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42</li> <li>\u4e8c\u8fdb\u5236\u7684\u8ba1\u7b97\u673a\u7269\u7406\u672c\u4f53\uff1a\u6a21\u62df\u7535\u8def-&gt;\u6570\u5b57\u7535\u8def-----\u6267\u884c\u5404\u79cd\u529f\u80fd\u7684\u7535\u8def\u8bbe\u5907</li> </ul> <p>\u9996\u5148\u4e0a\u6765\u7684\u95ee\u9898\u5c31\u7ed9\u4e86\u5f88\u591a\u660e\u663e\u548c\u4e0d\u90a3\u4e48\u660e\u663e\u7684\u5185\u5bb9\uff1a\u7ec8\u7aef\u3001\u952e\u5165\u3001hello world\u5b57\u7b26\u4e32\u3001\u663e\u793a\u5668\u3001\u7a0b\u5e8f...</p> <p>\u6211\u4eec\u5148\u522b\u641e\u8fd9\u4e48\u591a\u7684\u5185\u5bb9\uff0c\u4e00\u70b9\u70b9\u56de\u5fc6\u8d77\u4e4b\u524d\u505a\u8fc7\u7684\u5185\u5bb9\u3002</p> <p>\u5148\u4ece\u7a0b\u5e8f\u5f00\u59cb\uff1a\u201c\u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a\u201d\uff0c\u5373\u6211\u4eec\u5199\u7684\u7a0b\u5e8f\u5c31\u662f\u5728\u65e0\u6570\u4e2a\u4e0d\u540c\u7684\u72b6\u6001\u4e4b\u95f4\u4e0d\u65ad\u5207\u6362\uff0c\u518d\u5177\u8c61\u4e00\u70b9\u7684\u4f53\u73b0\u5c31\u662f\uff0c\u7a0b\u5e8f\u5c31\u662f\u4e0d\u540c\u7684\u6307\u4ee4\u5e8f\u5217\uff0c\u6211\u4eec\u7684\u8ba1\u7b97\u673a\u5c31\u662f\u5728\u6267\u884c\u8fd9\u4e9b\u5e8f\u5217\uff08\u7a0b\u5e8f\uff09\uff1a</p> <pre><code>while (1) {\n  \u4ecePC\u6307\u793a\u7684\u5b58\u50a8\u5668\u4f4d\u7f6e\u53d6\u51fa\u6307\u4ee4;\n  \u6267\u884c\u6307\u4ee4;\n  \u66f4\u65b0PC;\n}\n// PA1\uff1a\u6700\u7b80\u5355\u7684\u8ba1\u7b97\u673a\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u4e0d\u9700\u8981\u522b\u7684\u4e1c\u897f\uff0c\u53ea\u8981\u8ba1\u7b97\u673a\u80fd\u6267\u884c\u6211\u4eec\u7ed9\u51fa\u7684\u6307\u4ee4\uff08\u7a0b\u5e8f\uff09\uff0c\u90a3\u5c31\u5e94\u8be5\u80fd\u5b9e\u73b0\u9898\u76ee\u6240\u8bf4\u7684\u663e\u793a <code>Hello World</code>  \uff1a</p> <p>\u7b49\u7b49\uff1f\u663e\u793a\uff1f\u90a3\u4e0d\u5c31\u662f\u8bf4\u8ba1\u7b97\u673a\u5f97\u544a\u8bc9\u6211\u4eec\u5b83\u6267\u884c\u8fc7\u540e\u7684\u5185\u5bb9\uff1f\u9700\u8981\u6709\u4e1c\u897f\u6765\u663e\u793a\u5b83\u7684\u5185\u5bb9\uff1f\u7528\u7535\u706f\u6ce1\u4f5c\u4e3a\u663e\u793a\u884c\u4e0d\u884c\u3001\u7528\u5f00\u5173\u7684\u63b0\u4e0a\u63b0\u4e0b\u884c\u4e0d\u884c\uff1f\u884c\uff0c\u53ea\u8981\u662f\u80fd\u4f20\u9012\u4e8c\u8fdb\u5236\u4fe1\u606f\u7684\uff08\u6211\u4eec\u7684\u8ba1\u7b97\u673a\u57fa\u4e8e\u4e8c\u8fdb\u5236\u7684\uff09\uff08\u9999\u519c\u771fnb\uff09\uff0c\u5b9e\u9645\u4e0a\u4e00\u4e24\u767e\u5e74\u524d\u7684\u4eba\u4eec\u8fd8\u771f\u662f\u5c31\u8fd9\u4e48\u505a\u7684\u3002\u8fd9\u6837\u5b50\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u6982\u5ff5\u53eb\u505a\u8ba1\u7b97\u673a\u7684\u8bbe\u5907\u8f93\u51fa\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f60\u5c31\u80fd\u8054\u60f3\u5230\u4e4b\u524d\u5199\u8fc7\u7684\u73a9\u610f\u4e86\uff0c\u4e32\u884c\u901a\u4fe1\u63a5\u53e3\uff1fVGA\uff1f\u663e\u793a\u5668\uff1f\u73b0\u5728\u4eba\u4eec\u5c31\u662f\u7528\u8fd9\u79cd\u7684\u8f93\u51fa\u8bbe\u5907\uff0c\u663e\u793a\u8bbe\u5907\uff1b\u65e2\u7136\u8f93\u51fa\u7684\u6709\u4e86\uff0c\u90a3\u5f88\u81ea\u7136\u4e5f\u5c31\u8054\u60f3\u5230\u600e\u4e48\u6211\u8981\u600e\u4e48\u7ed9\u8ba1\u7b97\u673a\u8981\u6267\u884c\u7684\u6307\u4ee4\u4e86\uff0c\u8fd9\u5c31\u662f\u8f93\u5165\u4e86\uff0c\u60f3\u60f3\u4e4b\u524d\u5b9e\u73b0\u7684\u952e\u76d8\u8bbe\u5907\u3002</p> <p>\u597d\u4e86\u73b0\u5728\u6211\u4eec\u53ea\u662f\u7b80\u5355\u7684\u56de\u987e\u4e00\u4e0b\u7269\u7406\u8bbe\u5907\uff0c\u6211\u4eec\u4e4b\u540e\u5e94\u8be5\u66f4\u591a\u5173\u6ce8\u7684\u662f\u7a0b\u5e8f\uff08\u6307\u4ee4\uff09\u4e86\u3002</p> <p>\u56de\u60f3PA3.2\u6700\u540e\u7684\u5fc5\u7b54\u9898\uff0c\u6211\u4eec\u6b63\u597d\u56de\u7b54\u7684\u5c31\u662f <code>hello</code> \u7a0b\u5e8f\u7684\u6765\u6e90\u3002\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u7167\u642c\u90a3\u90e8\u5206\u3002</p> <p><code>hello</code> \u7a0b\u5e8f\u4f4d\u4e8e <code>apps</code> \u5c42\uff0c\u4e5f\u5c31\u662f\u5e94\u7528\u5c42\uff0c\u5b83\u5e76\u88ab\u7f16\u8bd1\u6210\u4e00\u4e2a <code>elf</code> \u53ef\u6267\u884c\u6587\u4ef6\uff08\u7f16\u8bd1\u5668\u65b9\u9762\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u4e0d\u6df1\u5165\u8ba8\u8bba\uff0c\u4e0d\u662f PA\u8ba8\u8bba\u7684\u91cd\u70b9\uff0c\u6211\u4eec\u5173\u6ce8\u7684\u662f\u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5c42\u6b21\uff09\uff0c\u4f4d\u4e8e\u76f8\u5173\u5e94\u7528\u7a0b\u5e8f\u7684 <code>build</code> \u4e2d\u3002</p> <p>\u8fd9\u91cc\u53c8\u8981\u60f3\u60f3\u7a0b\u5e8f\u5728\u8ba1\u7b97\u673a\u4e0a\u8fd0\u884c\u7684\u53e6\u4e00\u4e2a\u89c6\u89d2\u4e86\uff1a\u201c\u8ba1\u7b97\u673a\u662f\u4e2a\u62bd\u8c61\u5c42\u201d\u3002</p> <p>\u60f3\u5fc5\u505a\u5230\u8fd9\u91cc\u7684\u4f60\u4e00\u5b9a\u5bf9\u5404\u79cd\u5c42\u5df2\u7ecf\u4e86\u7136\u4e8e\u80f8\u4e86\uff0c\u4f46\u6211\u8fd8\u662f\u76f4\u63a5\u8d34\u56fe\uff1a</p> <p>\u8fd9\u662f\u51e0\u5e74\u524d\u7684\u56fe\u4e86\uff0c\u6709\u4e9b\u5730\u65b9\u4e0d\u662f\u5f88\u5bf9\uff0c\u4f46\u662f\u5c42\u6b21\u57fa\u672c\u4e00\u6837\u3002</p> <p></p> <p>\u73b0\u4ee3\u7684 \u6216\u8005\u8bf4\u6211\u4eec\u5728\u4e0a\u9762\u5199\u7684 <code>hello</code> \u7a0b\u5e8f\u4f4d\u4e8e\u7684\u662f \u5e94\u7528\u5c42\uff08<code>navy-apps</code>\uff09\uff0c\u4ed6\u60f3\u8981\u7684\u6548\u679c\u662f\u5c06 <code>Hello World</code>  \u8f93\u51fa\u5230\u663e\u793a\u8bbe\u5907\u4e2d\uff0c\u4e5f\u5c31\u662f\u60f3\u8981\u901a\u8fc7\u5e94\u7528\u5c42\u7684\u4ee3\u7801\u63a7\u5236\u786c\u4ef6\u3002</p> <p>\u5982\u679c\u6211\u4eec\u662f\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\uff0c\u90a3\u76f4\u63a5AM\u5c42\u5c31\u591f\u4e86\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5728\u5b9e\u73b0\u7684 IOE \u7684\u5404\u79cd API\uff0c\u8fd9\u91cc\u5982\u679c\u4f60\u8fd8\u5728 os \u4e4b\u4e0a\u7684 navy-apps \u8dd1\u4e86\u5b9e\u73b0 IOE API \uff0c\u60f3\u5fc5\u4f60\u4f1a\u6709\u4e00\u4e9b\u4f53\u4f1a\u4e86\u3002</p> <p>\u4f46\u662f\u73b0\u5728\u7684\u8f6f\u4ef6\u590d\u6742\u5ea6\u4e0a\u53bb\u4e86\uff0c\u6211\u4eec\u8981\u7f16\u5199\u7684\u662f\u4e00\u4e2a\u73b0\u4ee3\u5b8c\u6574\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\uff0c\u6211\u4eec\u9700\u8981 os\u3001\u786c\u4ef6\u4fdd\u62a4\u673a\u5236\u3001\u6587\u4ef6\u7cfb\u7edf\u4e86\u3002\u5c31\u4e0d\u80fd\u518d\u50cf\u4e4b\u524d\u4e00\u6837\u90a3\u4e48\u7b80\u5355\u7684\u7406\u89e3\u4e86\u3002</p> <p>\u8fd9\u91cc\u518d\u63d2\u4e00\u53e5\uff1a</p> <p>\u5b9e\u9645\u4e0a\u5982\u679c\u6211\u4eec\u662f\u7f16\u5199 MCU \u76f8\u5173\u7684\u4ee3\u7801\uff0c\u4e3b\u8981\u7684\u6d3b\u52a8\u5c42\u5728\u4e8e\u88f8\u673a\uff0c\u4e5f\u5c31\u662f\u786c\u4ef6\u6216\u8005\u518d\u52a0\u4e2a <code>am (HAL)</code>\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u7684\u5e94\u7528\u5c42\u5c31\u662f\u88f8\u673a\u786c\u4ef6\uff08NEMU\uff09\u8fd9\u4e00\u5c42\u4e86\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u4ec0\u4e48\u62bd\u8c61\u7684\u4e1c\u897f\u4e86\u3002</p> <p>\u5b9e\u9645\u4e0a\u5728\u8fc7\u53bb\u7684\u51e0\u5341\u5e74\u91cc\uff0c\u4ece\u4e8b\u5d4c\u5165\u5f0f\u9886\u57df\u7684\u76f8\u5173\u4eba\u5458\u5927\u591a\u90fd\u662f\u7535\u5b50\u4e13\u4e1a\u51fa\u8eab\uff0c\u65e2\u7136\u8981\u5e72\u786c\u4ef6\u53c8\u8981\u5e72\u8f6f\u4ef6\uff0c\u80af\u5b9a\u662f\u5b66\u4e0d\u6df1\u7684\uff0c\u57fa\u672c\u6ca1\u6709\u8fdb\u884c\u8fc7\u8f6f\u4ef6\u5c42\u9762\u76f8\u5173\u6df1\u5165\u7684\u5b66\u4e60\uff0c\u5982\u57fa\u672c\u4e0d\u4f1a\u8003\u8651\u50cf\u4e92\u8054\u7f51\u9886\u57df\u8c08\u8bba\u7684\u6bd4\u8f83\u591a\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3001\u8f6f\u4ef6\u67b6\u6784\u7b49\u7b49\u7684\u5185\u5bb9\u3002</p> <p>\u5176\u5b9e\u4e5f\u60c5\u6709\u53ef\u539f\uff0c\u90a3\u4e2a\u65f6\u5019\u57fa\u672c\u90fd\u662f\u7528 MCU \u7684 controller \u529f\u80fd\uff0c\u7b80\u5355\u7684\u4ee3\u7801\u5c31\u80fd\u5b8c\u6210\u5f88\u591a\u7684\u4efb\u52a1\u4e86\uff0c\u4f46\u662f\u5982\u4eca\u65f6\u4ee3\u65e9\u5c31\u53d8\u4e86\uff0c\u4e2d\u5c0f\u578b\u516c\u53f8\uff08\u5927\u516c\u53f8\u4e0d\u8bc4\u4ef7\uff09\uff0c\u5e0c\u671b\u4f60\u5565\u90fd\u80fd\u5e72\uff0c\u8981\u6c42\u4f60\u5e72\u4e00\u4e9b\u6bd4\u8f83\u4e2d\u5927\u578b\u5927\u578b\u7684\u9879\u76ee\u4e86\uff08\u6bd4\u5982\u8bf4\u4e00\u4e9b\u8f66\u8f86\u4eea\u8868\u8981\u6c42\u9177\u70ab\u3001\u667a\u80fd\u5bb6\u7535\u7528\u6237\u4f53\u9a8c\u3001\u624b\u673a\u3001ARM + MCP \u7b49\u7b49\uff0c\u4ee3\u7801\u91cf\u57fa\u672c\u90fd\u662f\u4e0a\u4e07\u884c\u8d77\u6b65\uff0c\u8ddf\u91cd\u8981\u7684\u662f\u9700\u8981\u4f60\u6709\u9605\u8bfb\u5927\u578b\u6e90\u7801\u7684\u80fd\u529b\uff09\uff0c\u800c\u4e14\uff0c\u4e00\u4e9b\u5d4c\u5165\u5f0f\u8bbe\u5907\u5df2\u7ecf\u53d8\u5f97\u5f88\u590d\u6742\u4e86\uff0c\u8f6f\u4ef6\u786c\u4ef6\u7684\u590d\u6742\u6027\u4e0a\u5347\u633a\u591a\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u6709\u76f8\u5173\u8f6f\u4ef6\u7684\u57fa\u7840\u5b66\u4e60\uff0c\u4f60\u672a\u6765\u5341\u51e0\u5e74\u7684\u5b66\u4e60\u4f1a\u5f88\u5403\u529b\u3002</p> <p>\u8fd9\u91cc\u4e4b\u524d\u770b\u5230\u8fc7\u4e00\u4e2a\u97e6\u4e1c\u5c71\u8001\u5e08\u7684\u89c6\u9891\uff0c\u611f\u89c9\u633a\u4e0d\u9519\u7684\uff1a\u65f6\u4ee3\u53d8\u4e86\uff0c\u5d4c\u5165\u5f0f\u5de5\u7a0b\u5e08\u7684\u6838\u5fc3\u80fd\u529b</p> <p>\u6240\u4ee5\u6211\u4eec\u4e00\u6b65\u6b65\u5f80\u4e0b\u3002</p> <p><code>hello</code> \u4e3b\u8981\u6838\u5fc3\u529f\u80fd\u5c31\u662f <code>printf(const char *, ...)</code>\uff0c\u8fd9\u662f\u4e00\u4e2a <code>library</code> \u63d0\u4f9b\u7684\u76f8\u5173\u529f\u80fd\uff0c\u4e3b\u8981\u662f\u8fde\u63a5\u53ef\u7684\u662f \u5e94\u7528\u5c42 \u548c\u64cd\u4f5c\u7cfb\u7edf\u7cfb\u5c42\uff0c\u5176\u4e2d\u4e3b\u8981\u76f8\u5173\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u5c42\u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528\u529f\u80fd\u3002</p> <p>\u5bf9\u4e8eprintf\u7684\u5185\u90e8\u8c03\u7528\u6d41\u7a0b\uff0c\u524d\u9762\u5df2\u7ecf\u6709\u4e86\u4e00\u4e9b\u603b\u7ed3\uff0c\u6211\u4eec\u76f4\u63a5\u8df3\u8dc3\u5230\u7cfb\u7edf\u8c03\u7528 <code>write</code> \u90a3\u4e00\u90e8\u5206\u3002</p> <pre><code>0x83000118:              call [printf@0x83000188]  // \u6ce8\u610f\u8fd9\u91cc\u662f \u5e94\u7528\u7a0b\u5e8f\u7684\n0x830001cc:                call [_vfprintf_r@0x83000244]\n0x83000310:                  call [__sfputs_r@0x83000c3c]\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                    call [_fputc_r@0x830017f0]\n0x83003464:                    ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000380:                  call [&lt;_vfprintf_r+0x994&gt;@0x830005fc]\n0x83000960:                    call [&lt;__sfputs_r&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n0x83000cd4:                    ret [&lt;__sfputs_r&gt;]\n0x83000310:                    call [&lt;_vfprintf_r+0x994&gt;@0x83000c3c]\n0x83000c88:                      call [_fputc_r@0x830017f0]\n0x83003464:                      ret [_fputc_r]\n... \u91cd\u590d_fputc_r\n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0] \n0x83003464:                      ret [&lt;_fputc_r&gt;             \n0x83000c88:                      call [&lt;_fputc_r&gt;@0x830017f0]\n0x83004364:                        call [&lt;_fflush_r&gt;@0x830045d0]\n0x83004500:                          call [&lt;__swrite&gt;@0x830035bc]\n0x83000208:                            call [&lt;_write&gt;@0x83004a44]\n0x800008dc:                              call [__am_irq_handle@0x80000740]\n0x800007b0:                                call [do_event@0x80000210]\n0x80000238:                                  call [do_syscall@0x80000014]\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n... \u91cd\u590dputch \u5f88\u591a\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n0x80000104:                                    call [putch@0x80000494]\n0x8000049c:                                    ret [putch]\n0x800000c8:                                  ret [do_syscall]\n0x8000024c:                                ret [do_event]\n0x800007c0:                              ret [__am_irq_handle]\n0x83004a4c:                            ret [_write]\n0x83000220:                          ret __swrite\n0x830044b0:                        ret [_fflush_r]\n0x830042e8:                      ret [_fputc_r]\n0x83000cd4:                    ret [_vfprintf_r]\n0x8300049c:                  ret [_vfprintf_r+0x994]\n0x83000380:                ret [_vfprintf_r]\n0x830001d8:              ret [printf]  // \u5e94\u7528\u7a0b\u5e8f\u7684\n</code></pre> <p>\u5b9e\u9645\u4e0a\u8fd9\u91cc\u53c8\u8981\u56de\u6765\u8c08\u8c08\u7cfb\u7edf\u8c03\u7528\u6982\u5ff5\u7684\u95ee\u9898\u4e86\uff0c\u8fd9\u91cc\u8fd8\u662f\u548c\u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u4fdd\u62a4\u673a\u5236\u6709\u5173\u7cfb\uff0c\uff08\u56de\u53bb\u7ffb\u770b\u524d\u9762\u7cfb\u7edf\u8c03\u7528\u548c\u5f02\u5e38\u5904\u7406\u7684\u5185\u5bb9\uff09</p> <p>\u7528\u6237\u7a0b\u5e8f\u60f3\u8981\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f\u60f3\u8981\u4f7f\u7528\u4e00\u4e9b\u7cfb\u7edf\u786c\u4ef6\u7ea7\u522b\u7684\u8d44\u6e90\uff08\u663e\u793a\u5668\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8fd9\u4e00\u673a\u5236\u6765\u5b9e\u73b0\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u91cc\u7684\u7279\u6743\u7ea7\u4f4e\u7684\u7528\u6237\u7a0b\u5e8f\u4ee3\u7801\u9700\u8981\u8fdb\u5165\u5230\u7279\u6743\u7ea7\u9ad8\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e86\uff0c\u786c\u4ef6\u5904\u7406\u5668\u4e5f\u8981\u8fdb\u5165\u5230\u66f4\u9ad8\u7ea7\u7ea7\u522b\u7684\u6a21\u5f0f\u4e86\u3002</p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u7528\u6237\u7a0b\u5e8f\u60f3\u8981\u4f7f\u7528\u786c\u4ef6\u8d44\u6e90\uff0c\u88abos\u770b\u4f5c\u662f\u4e00\u79cd\u5f02\u5e38\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f\u7cfb\u7edf\u8c03\u7528\u3002RISC-V \u5177\u4f53\u901a\u8fc7 <code>ecall</code> \u6307\u4ee4\u6765\u5904\u7406\u5f02\u5e38</p> </li> <li> <p>\u8c03\u7528 <code>_syscall_</code> \uff08<code>libos</code>\uff1a\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\uff1a\u5e94\u7528\u5c42\u548c\u64cd\u4f5c\u7cfb\u7edf\u7cfb\u7edf\uff09 \u89e6\u53d1 <code>syscall</code> \uff0c\u4f7f\u7528 <code>ecall</code>  \u8fdb\u884c\u5f02\u5e38\u54cd\u5e94\u3002</p> <pre><code>_syscall_((intptr_t)SYS_write, (intptr_t)fd, (intptr_t)buf, (intptr_t)count);   --&gt;\nasm volatile (\"ecall\" : \"=r\" (ret) : \"r\"(_gpr1), \"r\"(_gpr2), \"r\"(_gpr3), \"r\"(_gpr4));\n</code></pre> <p>\u8fd9\u91cc\u7684\u8c03\u7528\u6307\u4ee4\uff0c\u662f\u786c\u4ef6\uff08NEMU\uff09\u6267\u884c\u7684\u5594\uff0c\u6267\u884c\u5b8c\u540e\uff0c\u7a0b\u5e8f\u548c\u5904\u7406\u5668\u7684\u7ea7\u522b\u90fd\u5207\u6362\u3002</p> <p>\u4e4b\u540e\u518d\u53bb\u5f80\u54ea\u4e00\u5c42\u5462\uff1f</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406\u673a\u5236\uff1a\u4e8b\u4ef6\u5206\u53d1\u548c\u6267\u884c</p> <ol> <li> <p>\u8fdb\u5165\u5f02\u5e38\u5904\u7406\u5730\u5740\u5165\u53e3\uff0c\u5c06\u4e0a\u4e0b\u6587\u4fdd\u5b58\u5728\u6808\u4e0a\uff1a <code>csr</code>\u3001<code>gpr</code>\uff0c</p> </li> <li> <p>\u5c06 <code>csr</code> \u548c <code>gpr</code> \u4f5c\u4e3a\u4e0a\u4e0b\u6587\u4f20\u7ed9 <code>__am_irq_handle</code> \uff0c</p> </li> <li> <p><code>__am_irq_handle</code> \u901a\u8fc7\u5224\u65ad\u7a0b\u5e8f\u4e0a\u4e0b\u6587\uff08<code>mcause</code>\uff09\u7684\u5f02\u5e38\u53f7\uff0c\u5224\u65ad\u51fa\u54ea\u4e00\u4e8b\u4ef6\uff08EVENT_YIELD\uff09\uff0c\u4e5f\u5c31\u662f\u54ea\u4e00\u79cd\u5f02\u5e38\uff1a</p> <ol> <li>\u5f02\u6b65\u5f02\u5e38\uff1a\u4e2d\u65ad</li> <li>\u540c\u6b65\u5f02\u5e38\uff1a\u6307\u4ee4\u548c\u6570\u636e\u5f02\u5e38\uff1a\u5185\u5b58\u8bbf\u95ee\u4e0d\u5bf9\u9f50\u3001\u7f3a\u9875\u5f02\u5e38...</li> </ol> <pre><code>switch (c-&gt;mcause) {\n    case 0xb:\n        if (c-&gt;GPR1 == -1) { // YIELD\n            ev.event = EVENT_YIELD; c-&gt;mepc += 4;\n        } else if (c-&gt;GPR1 &gt;= 0 &amp;&amp; c-&gt;GPR1 &lt;= 19){ // system call (include sys_yield)\n            ev.event = EVENT_SYSCALL; c-&gt;mepc += 4;   \n        } else {\n            rintf(\"unknown type \");\n        }\n        break;\n    default: ev.event = EVENT_ERROR; break;\n\n// AM (HAL)\n</code></pre> <p>\u8fdb\u884c\u4e8b\u4ef6\u5224\u65ad\u5b8c\u540e\uff0c\u4e4b\u540e\u4ea4\u7ed9 <code>user_handler</code> \u3002</p> <p>\u8fd9\u91cc\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c42\u505a\u7684\u5c31\u662f\u8fdb\u4e00\u6b65\u7684\u4e8b\u4ef6\u5206\u53d1\u548c\u5b9e\u9645\u7684\u5f02\u5e38\u5904\u7406\uff0c\u4e5f\u5c31\u662f <code>do_event</code> \uff08\u672a\u6765\u80af\u5b9a\u8fd8\u4f1a\u6dfb\u52a0\u4e2d\u65ad\u7684\u5185\u5bb9\u3002</p> <pre><code>static Context* do_event(Event e, Context* c) {\n  switch (e.event) {\n    case EVENT_YIELD: printf(\"event: yield.\\n\"); break;\n    case EVENT_SYSCALL: do_syscall(c); break;\n    default: panic(\"Unhandled event ID = %d\", e.event);\n  }\n  return c;\n}\n// nanos-lite\n</code></pre> <p>\u7cfb\u7edf\u8c03\u7528\u5b9e\u9645\u5904\u7406\uff1a <code>do_syscall()</code></p> <pre><code> void do_syscall(Context *c) {\n     ...\n   switch (a[0]) {\n     case SYS_exit: strace(); sys_exit(a[0]); break;\n     case SYS_yield: c-&gt;GPRx = sys_yield(); break;\n     case SYS_open: c-&gt;GPRx = fs_open((const char *)a[1], a[2], a[3]); break;\n     case SYS_read: c-&gt;GPRx = fs_read(a[1], (void *)a[2],a[3]); break;\n     case SYS_write: c-&gt;GPRx = fs_write(a[1], (const void *)a[2], a[3]); break;\n     case SYS_close: c-&gt;GPRx = fs_close(a[1]); break;\n     case SYS_lseek: c-&gt;GPRx = fs_lseek(a[1], a[2], a[3]); break;\n     case SYS_brk: c-&gt;GPRx = 0; break;\n     case SYS_gettimeofday: c-&gt;GPRx = sys_gettimeofday((struct timeval *)a[1], (struct timezone *)a[2]); break;\n     case SYS_execve: sys_execve(c); break;   \n     default: panic(\"Unhandled syscall ID = %d\", a[0]);\n   }\n     ...\n }\n// nanos-lite\n</code></pre> <p>\u8fdb\u884c <code>fs_write</code></p> </li> </ol> </li> <li> <p>\u4e00\u5207\u7686\u6587\u4ef6 --&gt; VFS</p> <p>\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c06\u7a0b\u5e8f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u653e\u5728 <code>ramdisk</code> \u4e4b\u4e2d\uff0c\u4e2a\u4eba\u628a\u5b83\u79f0\u4e3a\u7a0b\u5e8f\u6587\u4ef6\u3002\uff08ramdisk \u7684\u8bfb\u5199\uff09</p> <pre><code>0\n+-------------+---------+----------+-----------+--\n|    file0    |  file1  |  ......  |   filen   |\n+-------------+---------+----------+-----------+--\n \\           / \\       /            \\         /\n  +  size0  +   +size1+              + sizen +\n</code></pre> <p>\u4f46\u662f\u5bf9\u4e8e\u7528\u6237\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5b83\u4eec\u4e5f\u8981\u5904\u7406\u6570\u636e\u548c\u4fee\u6539\u7a0b\u5e8f\u6587\u4ef6\uff0c\u4f46\u662f\u7528\u6237\u7a0b\u5e8f\u4e0d\u77e5\u9053\u7a0b\u5e8f\u6587\u4ef6\u4f4d\u4e8e <code>ramdisk</code> \u7684\u54ea\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u66f4\u4f55\u51b5\u7a0b\u5e8f\u6587\u4ef6\u4f1a\u52a8\u6001\u5730\u589e\u5220\uff0c\u7528\u6237\u7a0b\u5e8f\u5e76\u4e0d\u77e5\u60c5\u3002\u56e0\u6b64\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u9700\u8981\u5728\u5b58\u50a8\u4ecb\u8d28\u7684\u9a71\u52a8\u7a0b\u5e8f\u4e4b\u4e0a\uff0c\u4e3a\u7528\u6237\u7a0b\u5e8f\u63d0\u4f9b\u4e00\u79cd\u66f4\u9ad8\u7ea7\u7684\u62bd\u8c61\uff0c\u90a3\u5c31\u662f\u6587\u4ef6\u3002\uff08\u8fd9\u91cc\u7684\u6587\u4ef6\u548c\u524d\u9762\u7a0b\u5e8f\u6587\u4ef6\u6709\u4e00\u70b9\u5dee\u5f02\uff0c\u4f46\u662f\u4ece\u8fd9\u4e4b\u540e\u533a\u5206\u7684\u610f\u4e49\u4e5f\u4e0d\u5927\u4e86\uff09</p> <p>\u8bb0\u4f4f\u6587\u4ef6\u7684\u672c\u8d28\uff1a\u5b57\u8282\u5e8f\u5217\u3002</p> <p>\u6211\u4eec\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u9645\u5904\u7406\u51fd\u6570\u76ee\u7684\u4e5f\u5c31\u662f\u8981\u64cd\u4f5c\u5404\u79cd\u786c\u4ef6\u8d44\u6e90\u3002\u7531\u4e8e\u4e00\u5207\u7686\u6587\u4ef6\u7684\u601d\u60f3\uff0c\u6211\u4eec\u80fd\u591f\u4ee5\u6587\u4ef6\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u6765\u63a7\u5236\u666e\u901a\u6587\u4ef6\u548c\u5404\u79cd\u8bbe\u5907\u7684\u7279\u6b8a\u6587\u4ef6\uff08socket\u3001\u78c1\u76d8\u3001\u6309\u952e\u7684\u7f16\u7801\u3001\u663e\u793a\u5668\u4e0a\u7684\u4e00\u4e2a\u50cf\u7d20\u7684\u5185\u5bb9...\uff09\u3002\u4f46\u662f\u7531\u4e8e\u7279\u6b8a\u6587\u4ef6\u8fc7\u591a\u8fc7\u4e8e\u6df7\u4e71\uff0c\u52a0\u4e86\u4e00\u5c42 VFS \u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u5373\uff1a</p> <pre><code>-------------------------\n|         VFS           |\n-------------------------\n|\u8bbe\u5907\u62bd\u8c61\u5c42  +  ramdisk   |\n-------------------------\n</code></pre> <p>VFS \u7684\u6838\u5fc3\u5728\u4e8e \u4e0b\u9762\u7684\u4e24\u4e2a\u51fd\u6570\u6307\u9488\uff0c</p> <p>\u6211\u4eec\u80fd\u901a\u8fc7 <code>f-&gt;read()</code> \u548c <code>f-&gt;write()</code> \u7684\u65b9\u5f0f\u6765\u8c03\u7528\u4e0d\u540c\u6587\u4ef6\u7684\u5177\u4f53\u8bfb\u5199\u51fd\u6570\u4e86.</p> <pre><code>typedef struct {\n  ...\n  ReadFn read;        // \u8bfb\u51fd\u6570\u6307\u9488\n  WriteFn write;      // \u5199\u51fd\u6570\u6307\u9488\n  ...\n} Finfo;\n//nanos-lite\n</code></pre> <pre><code>[FD_STDIN]    = {\"stdin\", 0, 0, invalid_read, invalid_write, 0}, // 0\n[FD_STDOUT]   = {\"stdout\", 0, 0, invalid_read, serial_write, 0},\n[FD_STDERR]   = {\"stderr\", 0, 0, invalid_read, serial_write, 0},\n[FD_EVENT]    = {\"/dev/events\", 0, 0, events_read, invalid_write, 0},\n[FD_DISPINFO] = {\"/proc/dispinfo\",0 ,0, dispinfo_read, invalid_write, 0},\n[FD_FB]       = {\"/dev/fb\", 0, 0, invalid_read, fb_write, 0},\n\nsize_t fs_write(int fd, const void *buf, size_t len) {\n    assert(fd &gt;= 0 &amp;&amp; fd &lt; NR_FILE);\n    if (file_table[fd].write)\n        return file_table[fd].write(buf, file_table[fd].open_offset, len);\n\n    size_t open_offset = file_table[fd].open_offset;\n    size_t size = file_table[fd].size;\n    size_t real_len = len;\n    if (open_offset + len &gt; size)\n        real_len = size - open_offset;\n\n    size_t ret = ramdisk_write(buf, file_table[fd].disk_offset + open_offset, real_len);\n    file_table[fd].open_offset += real_len;\n    return ret;\n}\n\n//nanos-lite\n</code></pre> <p>\u4ece os \u8fd9\u4e00\u5c42\u6211\u4eec\u53d1\u73b0\uff0c\u60f3\u8981\u64cd\u63a7\u8fd9\u4e00\u4e2a\u786c\u4ef6\u8bbe\u5907\u8fd8\u771f\u662f\u9ebb\u70e6\u5462\u3002</p> <p>\u4e0d\u8fc7\u6211\u4eec\u7ee7\u7eed\u5411\u4e0b\u63a2\u7d22\u3002</p> </li> <li> <p>\u6587\u4ef6\u64cd\u4f5c\u7684\u4e4b\u4e0b\u7684\u786c\u4ef6\u64cd\u4f5c</p> <p>\u8981\u5c06\u5b57\u7b26\u8f93\u51fa\u5230\u5c4f\u5e55\u7684\u6587\u4ef6\u64cd\u4f5c\u51fd\u6570\u5982\u4e0b\uff1a</p> <pre><code>size_t serial_write(const void *buf, size_t offset, size_t len) {\n    for (int i = 0; i &lt; len; i++) { \n        putch(*((const char *)buf+ i));\n    }\n    return len;\n}\n//nanos-lite\n</code></pre> <p>\u8fd9\u4e5f\u5c31\u662f\u8fde\u63a5 <code>am</code>\uff08HAL\uff09 \u5c42\u7684\u51fd\u6570\u4e86</p> <p>\u8fd9\u4e00\u5c42\u6211\u4eec\u4f7f\u7528 <code>am</code> \u63d0\u4f9b\u7ed9 <code>os</code> \u7684\u63a5\u53e3\u6765\u8fdb\u4e00\u6b65\u64cd\u4f5c\u786c\u4ef6\u3002</p> <pre><code>// ----------------------- TRM: Turing Machine -----------------------\nextern   Area        heap;\nvoid     putch       (char ch);\nvoid     halt        (int code) __attribute__((__noreturn__));\n\n// -------------------- IOE: Input/Output Devices --------------------\nbool     ioe_init    (void);\nvoid     ioe_read    (int reg, void *buf);\nvoid     ioe_write   (int reg, void *buf);\n#include \"amdev.h\"\n\n// ---------- CTE: Interrupt Handling and Context Switching ----------\nbool     cte_init    (Context *(*handler)(Event ev, Context *ctx));\nvoid     yield       (void);\nbool     ienabled    (void);\nvoid     iset        (bool enable);\nContext *kcontext    (Area kstack, void (*entry)(void *), void *arg);\n\n// ----------------------- VME: Virtual Memory -----------------------\nbool     vme_init    (void *(*pgalloc)(int), void (*pgfree)(void *));\nvoid     protect     (AddrSpace *as);\nvoid     unprotect   (AddrSpace *as);\nvoid     map         (AddrSpace *as, void *vaddr, void *paddr, int prot);\nContext *ucontext    (AddrSpace *as, Area kstack, void *entry);\n\n// ---------------------- MPE: Multi-Processing ----------------------\nbool     mpe_init    (void (*entry)());\nint      cpu_count   (void);\nint      cpu_current (void);\nint      atomic_xchg (int *addr, int newval);\n\n//am\u5411\u4e0a\n</code></pre> </li> <li> <p>\u5177\u4f53\u5230\u786c\u4ef6</p> <p>\u5bf9\u4e8e nemu \u786c\u4ef6\u6765\u8bf4\uff1a</p> <pre><code>void putch(char ch) {\n  outb(SERIAL_PORT, ch);\n}\n// \u786c\u4ef6-AM\n</code></pre> <p>\u6216\u8bb8\u4e0a\u9762\u7684\u5185\u5bb9\u548c\u5b9e\u9645\u7684\u4e32\u53e3\u4e0d\u592a\u4e00\u6837\uff0c\u6211\u4eec\u518d\u770b\u770bnative\u7684\uff0c\u5c31\u5927\u6982\u80fd\u77e5\u9053\u5b9e\u9645\u4e2d\u7684\u4e32\u53e3\u6536\u53d1\uff0c\u6253\u5370\u6d41\u7a0b\u662f\u4ec0\u4e48\u6837\u4e86\u3002</p> <pre><code>void __am_uart_init() {\n  int ret = fcntl(STDIN_FILENO, F_GETFL);\n  assert(ret != -1);\n  int flag = ret | O_NONBLOCK;\n  ret = fcntl(STDIN_FILENO, F_SETFL, flag);\n  assert(ret != -1);\n}\n\nvoid __am_uart_config(AM_UART_CONFIG_T *cfg) {\n  cfg-&gt;present = true;\n}\n\nvoid __am_uart_tx(AM_UART_TX_T *uart) {\n  putchar(uart-&gt;data);\n}\n\nvoid __am_uart_rx(AM_UART_RX_T *uart) {\n  int ret = fgetc(stdin);\n  if (ret == EOF) ret = -1;\n  uart-&gt;data = ret;\n}\n\nvoid putch(char ch) {\n  putchar(ch);\n}\n// \u786c\u4ef6--am: native\n</code></pre> </li> </ol> <p>\u81f3\u6b64\u5927\u7ea6\u7684 <code>hello</code> \u7684\u6d41\u7a0b\u4e5f\u5c31\u6e05\u695a\u4e86\u3002</p> <p>\u4f46\u662f\u600e\u4e48\u6211\u4eec\u600e\u4e48\u901a\u8fc7\u952e\u76d8\u7684\u8f93\u5165\u7ed9\u8ba1\u7b97\u673a\u5462\uff1f\u6700\u7ec8\u53c8\u662f\u600e\u4e48\u8f93\u51fa\u5230\u7ec8\u7aef\u4e0a\u5462\uff1f\u8ba1\u7b97\u673a\u5185\u90e8\u6d41\u7a0b\u4e5f\u662f\u548c\u4e0a\u9762\u4e32\u53e3\u7c7b\u4f3c\uff0c</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5c4f\u5e55\u4e0a\u663e\u793a\u5185\u5bb9/\u8bfb\u53d6\u952e\u76d8\u5404\u4e2a\u7801\u503c\u7684\u672c\u8d28\uff0c\u4e5f\u5c31\u662f\u5f80\u67d0\u4e2a\u6b63\u786e\u5185\u5b58\u5730\u5740\u8bfb/\u5199\u4e00\u4e9b\u6b63\u786e\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5c4f\u5e55\u5185\u90e8/\u952e\u76d8\u5185\u90e8\u7684\u7535\u5b50\u5668\u4ef6\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u5de5\u4f5c\uff0c\u8ba1\u7b97\u673a\u8f93\u51fa\u76f8\u5173\u5185\u5bb9/\u8f93\u5165\u7ed9\u8ba1\u7b97\u673a\u76f8\u5173\u5185\u5bb9\uff0c\u7136\u540e\u6839\u636e\u56fd\u9645\u7684 ASIC \u7801\u8868\uff0c\u4f1a\u8f93\u51fa/\u8bfb\u53d6\u4e00\u4e2a\u6211\u4eec\u80fd\u770b\u5230\u5b57\u7b26\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u6837\u5b50\u597d\u50cf\u8fd8\u6ca1\u6709get\u5230\u6279\u5904\u7406\u7cfb\u7edf\u7684\u7cbe\u9ad3\uff1a\u7a0b\u5e8f\u6267\u884c\u5b8c\u4e00\u4e2a\u7a0b\u5e8f\u540e\uff0c\u81ea\u52a8\u6267\u884c\u4e0b\u4e00\u4e2a\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u5728\u8ba1\u7b97\u673a\u6267\u884c\u5b8c\u8fd9\u4e2a <code>hello</code> \u7a0b\u5e8f\u540e\uff0c\u4f1a\u6267\u884cramdisk\u4e2d\u7684\u4e0b\u4e00\u4e2a\u7a0b\u5e8f\u3002\uff08\u5bf9\u4e8e\u8fd9\u4e00\u70b9\u6211\u6df1\u6709\u4f53\u4f1a\uff0c\u5f53\u65f6\u5b9e\u73b0sfs\u65f6\u5019\uff0c\u56e0\u4e3a <code>open_offset</code> \u7684\u95ee\u9898\uff0c\u6211\u76f4\u63a5\u624b\u52a8\u8c03\u6574\u4e86 ELF \u6587\u4ef6\u7684\u987a\u5e8f\uff0c\u6ca1\u60f3\u5230\u786e\u5b9e\u80fd\u6b63\u786e\u6267\u884c\u4e00\u90e8\u5206\uff01\uff09</p> <p>\u7b49\u7b49\uff1f\u90a3\u662f\u54ea\u4e2a\u7a0b\u5e8f\u6765\u6267\u884c\u6700\u5f00\u59cb\u7684\u90a3\u4e2a <code>hello</code> \u7684\u5462\uff1f\u518d\u6b21\u56de\u60f3\u6279\u5904\u7406\u7cfb\u7edf\u7684\u5173\u952e\uff1a\u6709\u4e00\u4e2a\u540e\u53f0\u7a0b\u5e8f\uff0c\u5f53\u4e00\u4e2a\u524d\u53f0\u7a0b\u5e8f\u6267\u884c\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u540e\u53f0\u7a0b\u5e8f\u5c31\u4f1a\u81ea\u52a8\u52a0\u8f7d\u4e00\u4e2a\u65b0\u7684\u524d\u53f0\u7a0b\u5e8f\u6765\u6267\u884c\u3002\u8fd9\u4e2a\u540e\u53f0\u7a0b\u5e8f\u4e0d\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5417\uff1f\uff01</p> <p>\u6211\u4eec\u641e\u51fa\u6765\u7684\u90a3\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u9664\u4e86\u4e3a\u4e86\u7ba1\u7406\u66f4\u52a0\u590d\u6742\u7684\u7a0b\u5e8f\uff0c\u4ed6\u6700\u521d\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u5b9e\u73b0\u6279\u5904\u7406\u7684\u5440\uff08\u4f1a\u60f3\u8d77\u6700\u65e9\u6295\u5165\u4f7f\u7528\u7684 OSGM-NAA I/O - Wikipedia \uff0c\u5b83\u7684\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u81ea\u52a8\u52a0\u8f7d\u65b0\u7684\u7a0b\u5e8f\u554a\uff09\uff1a</p> <ul> <li>\u7528\u6237\u7a0b\u5e8f\u6267\u884c\u7ed3\u675f\u4e4b\u540e, \u53ef\u4ee5\u8df3\u8f6c\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u4ee3\u7801\u7ee7\u7eed\u6267\u884c</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u52a0\u8f7d\u4e00\u4e2a\u65b0\u7684\u7528\u6237\u7a0b\u5e8f\u6765\u6267\u884c</li> </ul> <p>\u6240\u4ee5\u6211\u4eec\u518d\u56de\u5230 <code>os</code> \u7684\u88c5\u8f7d <code>hello</code> \u7a0b\u5e8f\u4e4b\u540e\uff0c</p> <pre><code>void init_proc() {\n  switch_boot_pcb();\n\n  Log(\"Initializing processes...\");\n\n  // load program here\n  naive_uload(NULL, \"/bin/hello\");\n  //naive_uload(NULL, \"/bin/menu\");\n}\n//nanos-lite\n</code></pre> <p>\u7ee7\u7eed\u7a0b\u5e8f\u52a0\u8f7d <code>naive_uload(NULL, \"/bin/menu\");</code> \u4e4b\u540e\uff1a\u6267\u884c\u4e4b\u540e\u7684\u5185\u5bb9\uff01\uff08\u53ef\u80fd\u65e0\u6cd5\u6267\u884c\uff0c\u4f46\u662f\u5e2e\u52a9\u7406\u89e3\uff09</p> <p>\u6211\u4eec\u518d\u5207\u6362\u5230 <code>menu</code> \u7684\u5185\u5bb9\uff0c\u5728\u524d\u9762\u5206\u6790\u7684\u952e\u76d8\u3001\u663e\u793a\u5668\u5916\u8bbe\u7b49\u5185\u5bb9\u7684\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u8fdb\u4e00\u6b65\u8fdb\u5165\u5230 <code>NTerm</code>\uff0c\u6211\u4eec\u8f6c\u53d8\u6210\u901a\u8fc7 \u4e0e\u7ec8\u7aef\u4ea4\u4e92\u6765\u63a7\u5236\u7a0b\u5e8f\u4e86\u3002\u4e5f\u5c31\u662f\uff0c\u8fd0\u884c\u5728 os \u4e4b\u4e0a\u7684 NTerm \u7a0b\u5e8f\uff0c\u6211\u4eec\u80fd\u591f\u901a\u8fc7\u952e\u5165 <code>pal</code>\u3001<code>nslider</code>\u7b49\u5185\u5bb9\u6765\u63a5\u7740\u6267\u884c\u4e0b\u4e00\u4e2a\u7a0b\u5e8f\u4e86\u3002</p> <p>\u8fd9\u6837\u5b50\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u6765\u770b\u770b <code>hello</code> \u7a0b\u5e8f\u7684\u5185\u5bb9\uff0c<code>hello</code> \u8fd0\u884c\u5728 <code>os</code> \u4e4b\u4e0a\uff0c\u5728 <code>hello</code> \u53ef\u6267\u884c\u6587\u4ef6\u751f\u6210\u4e4b\u524d\uff0c\u6211\u4eec\u7684 <code>NEMU</code>\u3001<code>am</code>\u3001<code>nanos-lite</code> \u5df2\u7ecf\u7f16\u8bd1\u751f\u6210\u597d\u4e86\u4e00\u4e2a\u8d85\u7ea7\u5927\u7684\u540e\u53f0\u7a0b\u5e8f\u4e86\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5c31\u662f <code>os</code>\u3002\u5728\u8fd9\u4e2a <code>os</code> \u4e4b\u4e0a\uff0c\u6211\u4eec\u52a0\u8f7d <code>hello</code> \u7a0b\u5e8f\uff0c\u662f\u4e0d\u662f\u5c31\u56de\u5230\u4e0a\u9762\u7684\u5185\u5bb9\u4e86\uff1f\u5b8c\u6210\u4e4b\u540e\uff0c \u6211\u4eec\u7684 <code>os</code> \u81ea\u52a8\u52a0\u8f7d <code>menu</code>\u3001<code>NTerm</code> \u4e0d\u5c31\u5b9e\u73b0\u4e86\u6279\u5904\u7406\u4e86\u5417\uff1f</p> <p>\u81f3\u6b64\uff0c\u622a\u6b62 PA3\u7684\u5185\u5bb9\uff0c\u5173\u4e8e <code>\u5f53\u4f60\u5728\u7ec8\u7aef\u952e\u5165./hello\u8fd0\u884cHello World\u7a0b\u5e8f\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u7a76\u7adf\u505a\u4e86\u4e9b\u4ec0\u4e48?</code> \u8fd9\u4e2a\u95ee\u9898\uff0c\u4e5f\u7b97\u662f\u6709\u4e86\u4e00\u70b9\u56de\u7b54\u4e86\u3002</p> <p>\u4e4b\u540e\u7684PA4 \u505a\u7684\u5206\u65f6\u591a\u4efb\u52a1\uff0c\u5e94\u8be5\u4f1a\u66f4\u52a0\u7684\u7cbe\u5f69\u5462~</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_22","title":"\u5fc5\u7b54\u9898","text":"<ul> <li> <p>\u7406\u89e3\u4e0a\u4e0b\u6587\u7ed3\u6784\u4f53\u7684\u524d\u4e16\u4eca\u751f (\u89c1PA3.1\u9636\u6bb5)</p> </li> <li> <p>\u7406\u89e3\u7a7f\u8d8a\u65f6\u7a7a\u7684\u65c5\u7a0b (\u89c1PA3.1\u9636\u6bb5)</p> </li> <li> <p>hello\u7a0b\u5e8f\u662f\u4ec0\u4e48, \u5b83\u4ece\u800c\u4f55\u6765, \u8981\u5230\u54ea\u91cc\u53bb (\u89c1PA3.2\u9636\u6bb5)</p> </li> <li> <p>\u4ed9\u5251\u5947\u4fa0\u4f20\u7a76\u7adf\u5982\u4f55\u8fd0\u884c \u8fd0\u884c\u4ed9\u5251\u5947\u4fa0\u4f20\u65f6\u4f1a\u64ad\u653e\u542f\u52a8\u52a8\u753b, \u52a8\u753b\u91cc\u4ed9\u9e64\u5728\u7fa4\u5c71\u4e2d\u98de\u8fc7. </p> <p>\u8fd9\u4e00\u52a8\u753b\u662f\u901a\u8fc7<code>navy-apps/apps/pal/repo/src/main.c</code>\u4e2d\u7684<code>PAL_SplashScreen()</code>\u51fd\u6570\u64ad\u653e\u7684. \u9605\u8bfb\u8fd9\u4e00\u51fd\u6570, \u53ef\u4ee5\u5f97\u77e5\u4ed9\u9e64\u7684\u50cf\u7d20\u4fe1\u606f\u5b58\u653e\u5728\u6570\u636e\u6587\u4ef6<code>mgo.mkf</code>\u4e2d. \u8bf7\u56de\u7b54\u4ee5\u4e0b\u95ee\u9898: \u5e93\u51fd\u6570, libos, Nanos-lite, AM, NEMU\u662f\u5982\u4f55\u76f8\u4e92\u534f\u52a9, \u6765\u5e2e\u52a9\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u4ee3\u7801\u4ece<code>mgo.mkf</code>\u6587\u4ef6\u4e2d\u8bfb\u51fa\u4ed9\u9e64\u7684\u50cf\u7d20\u4fe1\u606f, \u5e76\u4e14\u66f4\u65b0\u5230\u5c4f\u5e55\u4e0a? \u6362\u4e00\u79cdPA\u7684\u7ecf\u5178\u95ee\u6cd5: \u8fd9\u4e2a\u8fc7\u7a0b\u7a76\u7adf\u7ecf\u5386\u4e86\u4e9b\u4ec0\u4e48? (Hint: \u5408\u7406\u4f7f\u7528\u5404\u79cdtrace\u5de5\u5177, \u53ef\u4ee5\u5e2e\u52a9\u4f60\u66f4\u5bb9\u6613\u5730\u7406\u89e3\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u884c\u4e3a)</p> </li> </ul>"},{"location":"ysyx/pa/pa3/pa3.html#_23","title":"\u76f8\u5173\u9762\u8bd5\u9898","text":"<ul> <li> <p>syscall\u548cglibc\u6709\u4ec0\u4e48\u533a\u522b</p> <p>\u6240\u4ee5\u8981\u95ee\u7684\u662f\u8fd9\u4e2a\uff01stdio\u57fa\u4e8ewrite.\u5b9e\u73b0\uff1f \u5b57\u7b26\u8bbe\u5907\u548c\u5757\u8bbe\u5907\uff1f</p> <p>stdio\u5e26\u7f13\u51b2\u533a \u683c\u5f0f\u5316</p> <p>\u4e00\u4e2a\u5e95\u5c42 \u4e00\u4e2a\u5e94\u7528\u5c42</p> <p>\u8fd8\u53ef\u4ee5\u518d\u770b\u770b\u5173\u4e8eLinux\u7cfb\u7edf\u9ad8\u7ea7\u7f16\u7a0b\u7684\u5185\u5bb9\u3002</p> <p>\u627e\u5230\u4e86\u7b2c 1 \u7bc7\u8d44\u6599\uff1a3\u5206\u949f\u4e86\u89e3syscall\u7cfb\u7edf\u8c03\u7528|\u8be6\u7ec6\u6613\u61c2\u7684\u6d41\u7a0b-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 2 \u7bc7\u8d44\u6599\uff1a\u638c\u63e1Linux syscall\u51fd\u6570\uff0c\u6df1\u5165\u89e3\u6790\u5185\u6838\u673a\u5236 | \u300aLinux \u2026</p> <p>\u627e\u5230\u4e86\u7b2c 3 \u7bc7\u8d44\u6599\uff1aLinux \u4e0b\u7cfb\u7edf\u8c03\u7528\u7684\u4e09\u79cd\u65b9\u6cd5 - hazir - \u535a\u5ba2\u56ed</p> <p>\u627e\u5230\u4e86\u7b2c 4 \u7bc7\u8d44\u6599\uff1aglibc\u5206\u6790\u4e00 \u7cfb\u7edf\u8c03\u7528_glibc\u548c\u7cfb\u7edf\u8c03\u7528-CSDN\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 5 \u7bc7\u8d44\u6599\uff1aLinux syscall\u8fc7\u7a0b\u5206\u6790\uff08\u4e07\u5b57\u957f\u6587\uff09-\u817e\u8baf\u4e91\u5f00\u53d1\u8005\u793e\u533a-\u817e\u8baf\u4e91</p> <p>\u627e\u5230\u4e86\u7b2c 6 \u7bc7\u8d44\u6599\uff1a\u7cfb\u7edf\u8c03\u7528 - Linux \u5185\u6838\u5982\u4f55\u5904\u7406\u7cfb\u7edf\u8c03\u7528 - \u300aLinux \u5185\u6838\u63ed\u79d8 ...</p> <p>\u627e\u5230\u4e86\u7b2c 7 \u7bc7\u8d44\u6599\uff1aLinux\u7cfb\u7edf\u8c03\u7528(syscall)\u539f\u7406 - Gityuan\u535a\u5ba2 | \u8881\u8f89\u8f89\u7684\u6280\u672f\u535a\u5ba2</p> <p>\u627e\u5230\u4e86\u7b2c 8 \u7bc7\u8d44\u6599\uff1aeglibc-syscall | rww's Blog</p> <p>\u627e\u5230\u4e86 8 \u7bc7\u8d44\u6599\u4f5c\u4e3a\u53c2\u8003\uff1a</p> <p>\u5173\u4e8e <code>syscall</code> \u548c <code>glibc</code> \u7684\u533a\u522b\uff0c\u6211\u627e\u5230\u4e86\u4e00\u4e9b\u8d44\u6599\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5173\u952e\u70b9\u7684\u603b\u7ed3\uff1a</p> <ol> <li>\u7cfb\u7edf\u8c03\u7528\uff08syscall\uff09 \u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7ed9\u7a0b\u5e8f\u4ee5\u8bf7\u6c42\u5185\u6838\u670d\u52a1\u7684\u4e00\u79cd\u673a\u5236\uff0c\u5b83\u662f\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u4e4b\u95f4\u7684\u6865\u6881\u3002\u7cfb\u7edf\u8c03\u7528\u786e\u4fdd\u8d44\u6e90\u4f7f\u7528\u7684\u5b89\u5168\u6027\u548c\u6709\u6548\u6027\uff0c\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u6267\u884c\u6587\u4ef6\u64cd\u4f5c\u3001\u8fdb\u7a0b\u63a7\u5236\u3001\u901a\u4fe1\u7b49\u64cd\u4f5c1\u3002</li> <li><code>syscall</code> \u6307\u4ee4\u662f Linux \u5185\u6838\u4e2d\u7528\u4e8e\u89e6\u53d1\u7cfb\u7edf\u8c03\u7528\u7684\u6307\u4ee4\uff0c\u5b83\u51cf\u5c11\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\uff0c\u63d0\u4f9b\u4e86\u4ece\u7528\u6237\u6a21\u5f0f\u5230\u5185\u6838\u6a21\u5f0f\u7684\u66f4\u76f4\u63a5\u7684\u8fc7\u6e21\uff0c\u6027\u80fd\u66f4\u9ad8\uff0c\u4f46\u53ef\u80fd\u5728\u65e7\u673a\u5668\u4e0a\u4e0d\u5982 <code>int 0x80</code> \u6307\u4ee4\u517c\u5bb91\u3002</li> <li>glibc\uff08GNU C Library\uff09\u662f Linux \u7cfb\u7edf\u4e2d\u4f7f\u7528\u7684\u5f00\u6e90\u7684\u6807\u51c6 C \u5e93\uff0c\u5b83\u5c01\u88c5\u4e86\u5927\u91cf\u7684\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\uff0c\u5e76\u63d0\u4f9b\u4e86\u66f4\u9ad8\u5c42\u6b21\u3001\u66f4\u6613\u7528\u7684 API\u3002glibc \u5e93\u4f7f\u5f97\u7a0b\u5e8f\u5458\u53ef\u4ee5\u4e0d\u5fc5\u76f4\u63a5\u4e0e\u5e95\u5c42\u7cfb\u7edf\u8c03\u7528\u6253\u4ea4\u9053\uff0c\u800c\u662f\u901a\u8fc7\u5e93\u63d0\u4f9b\u7684\u51fd\u6570\u6765\u5b9e\u73b0\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u64cd\u4f5c23\u3002</li> <li>glibc \u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528 API \u4e0e\u5185\u6838\u7279\u5b9a\u7684\u7cfb\u7edf\u8c03\u7528\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\uff0c\u901a\u5e38\u6bcf\u4e2a\u7279\u5b9a\u7684\u7cfb\u7edf\u8c03\u7528\u90fd\u5bf9\u5e94\u81f3\u5c11\u4e00\u4e2a glibc \u5c01\u88c5\u7684\u5e93\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u7cfb\u7edf\u63d0\u4f9b\u7684\u6253\u5f00\u6587\u4ef6\u7cfb\u7edf\u8c03\u7528 <code>sys_open</code> \u5bf9\u5e94\u7684\u662f glibc \u4e2d\u7684 <code>open</code> \u51fd\u65703\u3002</li> <li>\u5982\u679c\u5185\u6838\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u800c glibc \u6ca1\u6709\u5c01\u88c5\u8fd9\u4e2a\u8c03\u7528\uff0c\u7a0b\u5e8f\u5458\u53ef\u4ee5\u4f7f\u7528 glibc \u63d0\u4f9b\u7684 <code>syscall</code> \u51fd\u6570\u76f4\u63a5\u8c03\u7528\u8be5\u7cfb\u7edf\u8c03\u7528\u3002\u8fd9\u4e2a <code>syscall</code> \u51fd\u6570\u5141\u8bb8\u7a0b\u5e8f\u5458\u6307\u5b9a\u7cfb\u7edf\u8c03\u7528\u53f7\u548c\u53c2\u6570\uff0c\u76f4\u63a5\u4e0e\u5185\u6838\u4ea4\u4e923\u3002</li> <li>glibc \u5e93\u7684\u53e6\u4e00\u4e2a\u4f18\u52bf\u662f\u5b83\u63d0\u4f9b\u4e86\u9519\u8bef\u5904\u7406\u673a\u5236\uff0c\u5f53\u7cfb\u7edf\u8c03\u7528\u5931\u8d25\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u8d1f\u6570\uff0c\u5e76\u5c06 <code>errno</code> \u53d8\u91cf\u8bbe\u7f6e\u4e3a\u76f8\u5e94\u7684\u9519\u8bef\u7801\uff0c\u65b9\u4fbf\u7a0b\u5e8f\u5458\u8fdb\u884c\u9519\u8bef\u5904\u74062\u3002</li> <li>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u638c\u63e1 syscall \u51fd\u6570\u5bf9\u4e8e\u8fdb\u884c Linux \u7cfb\u7edf\u7f16\u7a0b\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u65e0\u8bba\u662f\u76f4\u63a5\u4f7f\u7528 syscall \u8fd8\u662f\u901a\u8fc7 glibc \u5e93\u63d0\u4f9b\u7684\u5c01\u88c5\u51fd\u65702\u3002</li> </ol> <p>\u901a\u8fc7\u8fd9\u4e9b\u8d44\u6599\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u51fa <code>syscall</code> \u662f\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u4e0a\u7528\u4e8e\u5b9e\u73b0\u7528\u6237\u7a0b\u5e8f\u548c\u5185\u6838\u4ea4\u4e92\u7684\u673a\u5236\uff0c\u800c <code>glibc</code> \u662f\u5728\u7528\u6237\u7a7a\u95f4\u63d0\u4f9b\u7684\u4e00\u4e2a\u5e93\uff0c\u7528\u4e8e\u7b80\u5316\u5bf9\u8fd9\u4e9b\u7cfb\u7edf\u8c03\u7528\u7684\u4f7f\u7528\u3002\u4e24\u8005\u5728 Linux \u7cfb\u7edf\u4e2d\u90fd\u626e\u6f14\u7740\u91cd\u8981\u7684\u89d2\u8272\uff0c\u4f46\u5b83\u4eec\u670d\u52a1\u4e8e\u4e0d\u540c\u7684\u5c42\u9762\u548c\u76ee\u7684\u3002</p> </li> </ul> <p>\u200b    </p>"},{"location":"ysyx/pa/pa3/pa3.html#_24","title":"\u5b66\u5230\u7684\u4e1c\u897f","text":"<ol> <li> <p>\u591a\u4f7f\u7528 assert \u548c \u9632\u5fa1\u6027\u7f16\u7a0b\uff0c\u5c3d\u5feb\u627e\u5230\u62a5\u9519\u8bef\u7684\u4f4d\u7f6e</p> </li> <li> <p>\u4ee3\u7801\u4f18\u5148\u7ea7\u7684\u95ee\u9898\uff08\u5199\u9053fixedpt-test\uff09\uff0c\u7528\u62ec\u53f7\uff01</p> </li> <li> <p>const</p> <p>\u6211\u662f\u5efa\u8bae\u5c3d\u91cf\u4f7f\u7528const\uff0c\u5c3d\u91cf\u7684\u628a\u4e0d\u671f\u671b\u4fee\u6539\u7684\u5bf9\u8c61\u90fd\u52a0\u4e0aconst\uff0c\u8fd9\u6837\u5982\u679c\u4f60\u4e0d\u5c0f\u5fc3\u4fee\u6539\u4e86\u8fd9\u4e2a\u4e0d\u671f\u671b\u88ab\u4fee\u6539\u7684\u5bf9\u8c61\uff0c\u7f16\u8bd1\u5668\u4e00\u5b9a\u4f1a\u544a\u8bc9\u4f60 \u8bf7\u4e0d\u8981\u76f8\u4fe1\u81ea\u5df1\uff0c\u56e0\u4e3a\u4f60\u5728\u5199\u4ee3\u7801\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u4fee\u6539\u4e86\u67d0\u4e2a/\u67d0\u4e9b\u4e0d\u671f\u671b\u4fee\u6539\u7684\u5bf9\u8c61\uff0cconst\u662f\u4e2a\u597d\u4e1c\u897f\uff0c\u5c1d\u8bd5\u4fee\u6539const\u5bf9\u8c61\uff0c\u7f16\u8bd1\u5668\u4e00\u5b9a\u4f1a\u544a\u8bc9\u4f60\uff0c\u8fd9\u5c31\u7701\u4e0b\u4e86\u4f60\u5750\u5728\u7535\u8111\u9762\u524d\u51e0\u4e2a\u5c0f\u65f6\u7684debug\uff0c\u5f88\u662f\u503c\u5f97</p> <p>\u8fd9\u91cc\u53ef\u80fd\u548c\u4e4b\u524d\u7684bug\u6709\uff0c\u6709\u91ce\u6307\u9488</p> </li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\u9762\u5411\u5bf9\u8c61\u64cd\u4f5c\uff0c\u600e\u4e48\u5b9e\u73b0 C with class \u8fd9\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50</p> </li> </ol>"},{"location":"ysyx/pa/pa4/pa4.html","title":"PA4","text":"<p>\u6982\u8ff0 - \u865a\u5b9e\u4ea4\u9519\u7684\u9b54\u6cd5: \u5206\u65f6\u591a\u4efb\u52a1</p> <ul> <li>task PA4.1: \u5b9e\u73b0\u57fa\u672c\u7684\u591a\u9053\u7a0b\u5e8f\u7cfb\u7edf, \u652f\u6301\u5e26\u53c2\u6570\u7684\u4ed9\u5251\u5947\u4fa0\u4f20\u4e0eHello\u5185\u6838\u7ebf\u7a0b\u7684\u5206\u65f6\u8fd0\u884c</li> <li>task PA4.2: \u5b9e\u73b0\u652f\u6301\u865a\u5b58\u7ba1\u7406\u7684\u591a\u9053\u7a0b\u5e8f\u7cfb\u7edf</li> <li>task PA4.3: \u5b9e\u73b0\u62a2\u5360\u5f0f\u5206\u65f6\u591a\u4efb\u52a1\u7cfb\u7edf, \u5e76\u63d0\u4ea4\u5b8c\u6574\u7684\u5b9e\u9a8c\u62a5\u544a</li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_1","title":"\u591a\u9053\u7a0b\u5e8f","text":"<p>\u76ee\u524d\u7684\u6279\u5904\u7406\u7cfb\u7edf\uff1a\u53ea\u80fd\u540c\u65f6\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u53ea\u6709\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u7ed3\u675f\u6267\u884c\u4e4b\u540e\uff0c\u624d\u4f1a\u5f00\u59cb\u6267\u884c\u4e0b\u4e00\u4e2a\u7a0b\u5e8f\u3002</p> <p>\u8fd9\u4e5f\u6b63\u662f\u6279\u5904\u7406\u7cfb\u7edf\u7684\u4e00\u4e2a\u7f3a\u9677\uff1a\u5982\u679c\u5f53\u524d\u7a0b\u5e8f\u6b63\u5728\u7b49\u5f85\u8f93\u5165\u8f93\u51fa\uff0c\u90a3\u4e48\u6574\u4e2a\u7cfb\u7edf\u90fd\u4f1a\u56e0\u6b64\u800c\u505c\u987f\u3002</p> <p>\u5728\u771f\u5b9e\u7684\u8ba1\u7b97\u673a\u4e2d\uff0c\u548cCPU\u7684\u6027\u80fd\u76f8\u6bd4\uff0c\u8f93\u5165\u8f93\u51fa\u662f\u975e\u5e38\u7f13\u6162\u7684\uff1a\u4ee5\u78c1\u76d8\u4e3a\u4f8b\uff0c\u78c1\u76d8\u8fdb\u884c\u4e00\u6b21\u8bfb\u5199\u9700\u8981\u82b1\u8d39\u5927\u7ea65\u6beb\u79d2\u7684\u65f6\u95f4\uff0c\u4f46\u5bf9\u4e8e\u4e00\u4e2a2GHz\u7684CPU\u6765\u8bf4\uff0c\u5b83\u9700\u8981\u82b1\u8d3910,000,000\u4e2a\u5468\u671f\u6765\u7b49\u5f85\u78c1\u76d8\u64cd\u4f5c\u7684\u5b8c\u6210\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e0e\u5176\u8ba9\u7cfb\u7edf\u9677\u5165\u65e0\u610f\u4e49\u7684\u7b49\u5f85\uff0c\u8fd8\u4e0d\u5982\u7528\u8fd9\u4e9b\u65f6\u95f4\u6765\u8fdb\u884c\u4e00\u4e9b\u6709\u610f\u4e49\u7684\u5de5\u4f5c\u3002</p> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u60f3\u6cd5\u5c31\u662f, \u5728\u7cfb\u7edf\u4e00\u5f00\u59cb\u7684\u65f6\u5019\u52a0\u8f7d\u591a\u4e2a\u7a0b\u5e8f, \u7136\u540e\u8fd0\u884c\u7b2c\u4e00\u4e2a; \u5f53\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\u9700\u8981\u7b49\u5f85\u8f93\u5165\u8f93\u51fa\u7684\u65f6\u5019, \u5c31\u5207\u6362\u5230\u7b2c\u4e8c\u4e2a\u7a0b\u5e8f\u6765\u8fd0\u884c; \u5f53\u7b2c\u4e8c\u4e2a\u7a0b\u5e8f\u4e5f\u9700\u8981\u7b49\u5f85\u7684\u65f6\u5019, \u5c31\u7ee7\u7eed\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u7a0b\u5e8f\u6765\u8fd0\u884c, \u5982\u6b64\u7c7b\u63a8.</p> <p>\u8fd9\u5c31\u662f\u591a\u9053\u7a0b\u5e8f\u7684\u57fa\u672c\u601d\u60f3\u3002Computer multitasking - Wikipedia</p> <p>\u8981\u5b9e\u73b0\u4e00\u4e2a\u591a\u9053\u7a0b\u5e8f\u64cd\u4f5c\u7cfb\u7edf, \u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u4e24\u70b9\u5c31\u53ef\u4ee5\u4e86:</p> <ul> <li> <p>\u5728\u5185\u5b58\u4e2d\u53ef\u4ee5\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u8fdb\u7a0b</p> <p>\u8ba9 <code>loader</code> \u628a \u4e0d\u540c\u7684\u8fdb\u7a0b\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5185\u5b58\u4f4d\u7f6e\u4e2d\uff0c\u8fdb\u7a0b\u52a0\u8f7d\u7684\u672c\u8d28\u5c31\u662f\u4e00\u4e9b\u5185\u5b58\u62f7\u8d1d\u64cd\u4f5c\u3002</p> <p>\u4f46\u662f <code>loader</code> \u600e\u4e48\u77e5\u9053\u52a0\u5230\u54ea\u91cc\uff1f\u4e0d\u540c\u7684\u8fdb\u7a0b\u5360\u636e\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u8fd8\u6709\u53ef\u80fd\u4f1a\u53d8\uff0c\u600e\u4e48\u505a\uff1f</p> </li> <li> <p>\u5728\u6ee1\u8db3\u67d0\u4e9b\u6761\u4ef6\u7684\u60c5\u51b5\u4e0b, \u53ef\u4ee5\u8ba9\u6267\u884c\u6d41\u5728\u8fd9\u4e9b\u8fdb\u7a0b\u4e4b\u95f4\u5207\u6362</p> <p>\u5207\u6362\u6808\u3002</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u6211\u4eec\u53ea\u8981\u8ba9loader\u628a\u4e0d\u540c\u7684\u8fdb\u7a0b\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5185\u5b58\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u4e86, \u52a0\u8f7d\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e9b\u5185\u5b58\u62f7\u8d1d\u7684\u64cd\u4f5c, \u56e0\u6b64\u5e76\u6ca1\u6709\u4ec0\u4e48\u56f0\u96be\u7684\u5730\u65b9.</p> <p>\u5176\u5b9e\u6211\u5728\u9a97\u4f60!</p> <p>\u5bf9\u6211\u4eec\u76ee\u524d\u5b9e\u73b0\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u6765\u8bf4, \"\u628a\u4e0d\u540c\u7684\u8fdb\u7a0b\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5185\u5b58\u4f4d\u7f6e\"\u5176\u5b9e\u662f\u4e00\u4ef6\u5f88\u9ebb\u70e6\u7684\u4e8b\u60c5, \u4f60\u80fd\u60f3\u660e\u767d\u4e3a\u4ec0\u4e48\u5417? \u5982\u679c\u60f3\u4e0d\u660e\u767d\u4e5f\u6ca1\u5173\u7cfb, \u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u9636\u6bb5\u8be6\u7ec6\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898.</p> <p><code>loader</code> \u4f5c\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u90a3\u4e0d\u5f97\u8bb0\u5f55\u4e0d\u540c\u7684\u8fdb\u7a0b\u88c5\u8f7d\u5230\u7a0b\u5e8f\u7684\u54ea\u4e2a\u4f4d\u7f6e\u4e86\uff1f\u4e0d\u7136\u8981\u52a0\u8f7d\u7684\u65b0\u7684\u8fdb\u7a0b\u7684\u65f6\u5019\u5206\u914d\u5230\u7684\u7a7a\u95f2\u533a\u57df\u5b9e\u9645\u4e0a\u662f\u522b\u7684\u8fdb\u7a0b\u7684\u5462\uff1f\u600e\u4e48\u505a\uff1f\u64cd\u4f5c\u7cfb\u7edf\u8bb0\u5f55\u4e0b\u6765\uff1f\u518d\u9605\u8bfb \u7a0b\u5e8f\u548c\u5185\u5b58\u7684\u4f4d\u7f6e</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1, \u6211\u4eec\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u76f4\u63a5\u5b9a\u4e49\u4e00\u4e9b\u6d4b\u8bd5\u51fd\u6570\u6765\u4f5c\u4e3a\u7a0b\u5e8f, \u56e0\u4e3a\u7a0b\u5e8f\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e9b\u6709\u610f\u4e49\u7684\u6307\u4ee4\u5e8f\u5217, \u76ee\u524d\u6211\u4eec\u4e0d\u5fc5\u5728\u610f\u8fd9\u4e9b\u6307\u4ee4\u5e8f\u5217\u5230\u5e95\u4ece\u4f55\u800c\u6765. \u4e0d\u8fc7, \u4e00\u4e2a\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\u6808, \u6211\u4eec\u9700\u8981\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u5404\u81ea\u7684\u6808\u7a7a\u95f4.</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u6808\u7a7a\u95f4?</p> <p>\u5982\u679c\u4e0d\u540c\u7684\u8fdb\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a\u6808\u7a7a\u95f4, \u4f1a\u53d1\u751f\u4ec0\u4e48\u5462?</p> <p>\u5b9e\u9645\u4e0a\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6808\u5c31\u662f\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6838\u5fc3\uff0c\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u4ea7\u751f\u6216\u4f7f\u7528\u7684\u4e0d\u540c\u7684\u6570\u636e\u6216\u591a\u6216\u5c11\u90fd\u8981\u653e\u5728\u6808\u4e0a\uff0c\u5982\u679c\u4e0d\u540c\u7684\u8fdb\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a\u6808\u7a7a\u95f4\uff0c\u90a3\u4e0d\u540c\u7684\u8fdb\u7a0b\u5c31\u4f7f\u7528\u4f1a\u7528\u5230\u4e0d\u5c5e\u4e8e\u672c\u8fdb\u7a0b\u7684\u6570\u636e\uff0c\u53c8\u96be\u4ee5\u60f3\u8c61\u7684\u9519\u8bef\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_2","title":"\u4e0a\u4e0b\u6587\u5207\u6362","text":"<p>\u4e2a\u4eba\u63a8\u8350\uff0c\u5982\u679c\u6b64\u65f6\u5df2\u7ecf\u5bf9\u4e8e <code>RTOS</code> \u7684\u5185\u90e8\u673a\u5236\u6709\u4e00\u4e9b\u4e86\u89e3\u7684\u8bdd\uff0c\u53ef\u4ee5\u7ed3\u5408\u8d77\u6765\u770b\u770b\u3002</p> <p>\u5728PA3\u4e2d, \u6211\u4eec\u5df2\u7ecf\u63d0\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u548c\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6267\u884c\u6d41\u5207\u6362, \u5e76\u4ecb\u7ecd\u4e86\"\u4e0a\u4e0b\u6587\"\u7684\u6982\u5ff5: \u4e0a\u4e0b\u6587\u7684\u672c\u8d28\u5c31\u662f\u8fdb\u7a0b\u7684\u72b6\u6001. </p> <p>\u6362\u53e5\u8bdd\u8bf4, \u6211\u4eec\u73b0\u5728\u9700\u8981\u8003\u8651\u7684\u662f, \u5982\u4f55\u5728\u591a\u4e2a\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362.</p> <p>\u4e3a\u4e86\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u5728<code>am-kernels</code>\u4e2d\u4e3a\u5927\u5bb6\u51c6\u5907\u4e86\u4e00\u4e2a\u7ea630\u884c\u7684\u64cd\u4f5c\u7cfb\u7edf<code>yield-os</code>, \u5b83\u521b\u5efa\u4e86\u4e24\u4e2a\u6267\u884c\u6d41, \u5728CTE\u7684\u652f\u6491\u4e0b\u4ea4\u66ff\u8f93\u51fa<code>A</code>\u548c<code>B</code>. \u4f60\u53ef\u4ee5\u5728<code>native</code>\u4e0a\u8fd0\u884c<code>yield-os</code>\u6765\u67e5\u770b\u5b83\u7684\u884c\u4e3a.</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5207\u6362\u4e0a\u4e0b\u6587\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4e5f\u5c31\u4ee3\u8868\u7740\u5207\u6362\u8fdb\u7a0b\u4e86\u3002</p> <p>Linus \u66fe\u7ecf\u6700\u5f00\u59cb\u505a\u7684 <code>Linux</code> \u96cf\u5f62\u7684\u4e00\u4e2a\u529f\u80fd\uff1f\uff01\uff08\u63a8\u8350\u9605\u8bfbLinus \u7684\u81ea\u4f20\uff1a\u300ajust for fun\u300b\uff09</p>"},{"location":"ysyx/pa/pa4/pa4.html#_3","title":"\u57fa\u672c\u539f\u7406","text":"<p>\u57fa\u4e8e CTE\uff0c\u5047\u8bbe\u4e24\u4e2a\u8fdb\u7a0bA\u3001B</p> <ol> <li>\u5047\u8bbe\u8fdb\u7a0b A \u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u89e6\u53d1\u4e86\u7cfb\u7edf\u8c03\u7528\uff0c\u9677\u5165\u5230\u5185\u6838\u3002</li> <li>\u6839\u636e <code>__am_asm_trap()</code> \u7684\u4ee3\u7801\uff0cA \u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u5c06\u4f1a\u88ab\u4fdd\u5b58\u5230 A \u7684\u6808\u4e0a\u3002</li> <li>\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u5b8c\u6bd5\u4e4b\u540e\uff0c<code>__am_asm_trap()</code> \u4f1a\u6839\u636e\u6808\u4e0a\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u6765\u6062\u590d A \u7684\u4e0a\u4e0b\u6587\u3002</li> <li>\u5982\u679c\u6211\u4eec\u5148\u4e0d\u7740\u6025\u6062\u590d A \u7684\u4e0a\u4e0b\u6587\uff0c\u800c\u662f\u5148\u5c06\u6808\u9876\u6307\u9488\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b B \u7684\u6808\u4e0a\uff0c\u7531\u4e8e B \u7684\u6808\u4e0a\u5b58\u653e\u4e86\u4e4b\u524d B \u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\uff0c\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u5c31\u4f1a\u6839\u636e\u8fd9\u4e00\u7ed3\u6784\u6765\u6062\u590d B \u7684\u4e0a\u4e0b\u6587\u3002</li> <li>\u4ece <code>__am_asm_trap()</code> \u8fd4\u56de\u4e4b\u540e\uff0c\u6211\u4eec\u5df2\u7ecf\u5728\u8fd0\u884c\u8fdb\u7a0b B \u4e86\u3002</li> </ol> <p></p> <p>\u90a3\u8fdb\u7a0bA\u5230\u54ea\u91cc\u53bb\u4e86\u5462? \u522b\u62c5\u5fc3, \u5b83\u53ea\u662f\u88ab\u6682\u65f6\"\u6302\u8d77\"\u4e86\u800c\u5df2. \u5728\u88ab\u6302\u8d77\u4e4b\u524d, \u5b83\u5df2\u7ecf\u628a\u4e0a\u4e0b\u6587\u7ed3\u6784\u4fdd\u5b58\u5230\u81ea\u5df1\u7684\u6808\u4e0a\u4e86, \u5982\u679c\u5c06\u6765\u7684\u67d0\u4e00\u65f6\u523b\u6808\u9876\u6307\u9488\u88ab\u5207\u6362\u5230A\u7684\u6808\u4e0a, \u4ee3\u7801\u5c06\u4f1a\u6839\u636e\u6808\u4e0a\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u6765\u6062\u590dA\u7684\u4e0a\u4e0b\u6587, A\u5c06\u5f97\u4ee5\u5524\u9192\u5e76\u6267\u884c. </p> <p>\u6240\u4ee5, \u4e0d\u540c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u5176\u5b9e\u5c31\u662f\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6808\u5207\u6362!</p>"},{"location":"ysyx/pa/pa4/pa4.html#_4","title":"\u8fdb\u7a0b\u63a7\u5236\u5757","text":"<p>\u7531\u4e8e\u6bcf\u6b21\u6808\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u67b6\u6784\u7684\u4f4d\u7f6e\u4e0d\u56fa\u5b9a\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6307\u9488\u6765\u8bb0\u5f55\u4e0a\u4e0b\u6587\u7ed3\u6784\u7684\u4f4d\u7f6e\uff1a <code>context pointer(cp)</code>\u3002\u5f53\u60f3\u8981\u627e\u5230\u5176\u4ed6\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u65f6\uff0c\u53ea\u8981\u5bfb\u627e\u8fd9\u4e2a\u8fdb\u7a0b\u7684 <code>cp</code> \u6307\u9488\u5373\u53ef\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6709\u4e0d\u5c11\u4fe1\u606f\u90fd\u662f\u8fdb\u7a0b\u76f8\u5173\u7684\uff0c\u9664\u4e86\u521a\u624d\u63d0\u5230\u7684\u4e0a\u4e0b\u6587\u6307\u9488 <code>cp</code> \u4e4b\u5916\uff0c\u4e0a\u6587\u63d0\u5230\u7684\u6808\u7a7a\u95f4\u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u5bf9\u8fd9\u4e9b\u8fdb\u7a0b\u76f8\u5173\u7684\u4fe1\u606f\u8fdb\u884c\u7ba1\u7406\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f7f\u7528\u4e00\u79cd\u53eb\u8fdb\u7a0b\u63a7\u5236\u5757(PCB, process control block)\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e3a\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u7ef4\u62a4\u4e00\u4e2aPCB\u3002</p> <p>\u8054\u60f3\u5230 <code>FreeRTOS</code> \u7684 <code>TCB</code> \u7ed3\u6784\u4f53\u4e86\u3002</p> <p><code>yield-os</code> \u7684 PCB \u7ed3\u6784\u4f53\uff1a</p> <pre><code>#define STACK_SIZE (4096 * 8)\ntypedef union {\n  uint8_t stack[STACK_SIZE];\n  struct {\n    Context *cp;\n  };\n} PCB;\n</code></pre> <p>\u6ce8\u610f\u8fd9\u662f\u4e2a\u8054\u5408\u4f53 <code>union</code>\uff0c\u53e6\u5916\u6808\u7684\u5927\u5c0f\uff1a32KB\u3002</p> <p>\u5728\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u628aPCB\u4e2d\u7684 <code>cp</code> \u6307\u9488\u8fd4\u56de\u7ed9CTE\u7684 <code>__am_irq_handle()</code>\u51fd\u6570\u5373\u53ef\uff0c\u5269\u4f59\u90e8\u5206\u7684\u4ee3\u7801\u4f1a\u6839\u636e\u4e0a\u4e0b\u6587\u7ed3\u6784\u6062\u590d\u4e0a\u4e0b\u6587\u3002</p> <p>\u66f4\u5177\u4f53\u4e00\u70b9\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5165\u6808\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\uff08<code>gpr</code>\u3001<code>csr</code>...\uff09\uff0c\u901a\u8fc7\u4e00\u4e2a <code>PCB</code> \u7ed3\u6784\u4f53\u6765\u7ba1\u7406\uff0c</p> <p>\u8fd8\u662f\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5bf9\u4e8e\u521a\u521a\u52a0\u8f7d\u5b8c\u7684\u8fdb\u7a0b\uff0c\u6211\u4eec\u600e\u4e48\u5207\u6362\u5230\u5b83\u6765\u8ba9\u5b83\u8fd0\u884c\u8d77\u6765\u5462? </p>"},{"location":"ysyx/pa/pa4/pa4.html#_5","title":"\u5185\u6838\u7ebf\u7a0b","text":"<ol> <li> <p>\u521b\u5efa\u5185\u6838\u7ebf\u7a0b\u4e0a\u4e0b\u6587</p> <p>\u5f88\u7b80\u5355\uff0c\u65e2\u7136\u4e0a\u4e0b\u6587\u5207\u6362\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4ee3\u8868\u4e86\u8fdb\u7a0b\u5207\u6362\uff0c\u90a3\u6211\u4eec\u624b\u52a8\u7ed9\u8fd9\u4e2a\u8fdb\u7a0b\u4e00\u4e9b\u4e0a\u4e0b\u6587\u7ed3\u6784\u4e0d\u5c31\u884c\u4e86\uff1f</p> <p>\u7b54\u6848\u5f88\u7b80\u5355, \u6211\u4eec\u53ea\u9700\u8981\u5728\u8fdb\u7a0b\u7684\u6808\u4e0a\u4eba\u5de5\u521b\u5efa\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7ed3\u6784, \u4f7f\u5f97\u5c06\u6765\u5207\u6362\u7684\u65f6\u5019\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u7ed3\u6784\u6765\u6b63\u786e\u5730\u6062\u590d\u4e0a\u4e0b\u6587\u5373\u53ef.</p> <p>\u4e0a\u6587\u63d0\u5230\uff0c\u6211\u4eec\u5148\u628a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u76f4\u63a5\u5b9a\u4e49\u7684\u4e00\u4e9b\u6d4b\u8bd5\u51fd\u6570\u4f5c\u4e3a\u7a0b\u5e8f\u3002</p> <p><code>yield-os</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a\u6d4b\u8bd5\u51fd\u6570 <code>f()</code>\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u4efb\u52a1\u5c31\u662f\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a\u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u5207\u6362\u5230\u5b83\u6765\u6267\u884c\u3002\u8fd9\u6837\u7684\u6267\u884c\u6d41\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u540d\u79f0, \u53eb\"\u5185\u6838\u7ebf\u7a0b\"(kernel thread)\u3002</p> <p>\u8fd9\u91cc\u7684\u610f\u601d\u4e5f\u5c31\u662f\u4e4b\u524d\u8bf4\u7684\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u540e\u53f0\u7a0b\u5e8f\u6765\u7ba1\u7406\u524d\u53f0\u7a0b\u5e8f\u3002\u4e4b\u524d\u6211\u4eec\u7684\u7a0b\u5e8f\u662f\u6309\u7167\u5728 <code>ramdisk</code> \u4e2d\u5b58\u653e\u7684\u987a\u5e8f\u8fd0\u884c\u5373\u53ef\uff0c\u73b0\u5728\u662f\u5404\u4e2a\u8fdb\u7a0b\u8981\u8fdb\u884c\u5207\u6362\uff0c\u9700\u8981\u4e00\u4e2a\u7a0b\u5e8f\u6765\u534f\u8c03\uff0c\u5c31\u662f\u8fd9\u4e2a \u5185\u6838\u7ebf\u7a0b\u4e86\u3002</p> <p>\u4e0a\u9762\u7684\u6709\u70b9\u95ee\u9898\uff0c\u8fd8\u6ca1\u5230\u7528\u6237\u8fdb\u7a0b\u5462\u3002</p> <p>\u5e94\u8be5\u662f\u6211\u4eec\u73b0\u5728\u505a\u7684\u5c31\u662f\u521b\u5efa\u4e24\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u8ba9\u4ed6\u4eec\u4e92\u76f8\u8fd0\u884c\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u53eb\"\u5185\u6838\u8fdb\u7a0b\"?</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u7b49\u4ef7\u4e8e\"\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\", \u662f\u4e2a\u4e0d\u9519\u7684\u95ee\u9898. \u800c\u4e14\u8fd9\u8fd8\u5c5e\u4e8e\u8003\u7814\u516b\u80a1\u7684\u5185\u5bb9\u5462, \u4e8e\u662f\u4f60\u80af\u5b9a\u53ef\u4ee5\u901a\u8fc7STFW\u627e\u5230\u5f88\u591a\u4e94\u82b1\u516b\u95e8\u7684\u7b54\u6848, \u6bd4\u5982\"\u7ebf\u7a0b\u66f4\u52a0\u8f7b\u91cf\u7ea7\", \"\u7ebf\u7a0b\u6ca1\u6709\u72ec\u7acb\u7684\u8d44\u6e90\"\u7b49\u7b49.</p> <p>\u5982\u679c\u8981\u8fdb\u4e00\u6b65\u89e3\u91ca\"\u4ec0\u4e48\u662f\u8f7b\u91cf\u7ea7\", \"\u72ec\u7acb\u7684\u8d44\u6e90\u662f\u4ec0\u4e48\u610f\u601d\", \u5728PA\u4e2d\u53ef\u80fd\u6bd4\u8f83\u56f0\u96be. \u4e0d\u8fc7\u5728PA\u4e2d\u4e5f\u4e0d\u5fc5\u6df1\u7a76\u8fd9\u4e2a\u95ee\u9898, \u76ee\u524d\u4f60\u53ea\u9700\u8981\u628a\u5b83\u4eec\u90fd\u770b\u6210\u6267\u884c\u6d41\u5c31\u53ef\u4ee5\u4e86, \u66f4\u91cd\u8981\u7684\u662f, \u8fd9\u4e24\u8005\u4f60\u90fd\u5c06\u4f1a\u5b9e\u73b0, \u5728\u4ee3\u7801\u4e2d\u4eb2\u81ea\u53bb\u611f\u53d7\u5b83\u4eec\u7684\u533a\u522b\u4e0d\u662f\u4e00\u4e2a\u66f4\u597d\u7684\u9009\u62e9\u5417? \u53e6\u5916, \u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u53bb\u4fee\u8bfb\u4e0b\u5b66\u671f\u7684\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u4e5f\u4e0d\u9519.</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5185\u6838\u4e2d\u6240\u6709\u6b63\u5728\u6267\u884c\u7684\u51fd\u6570\u90fd\u5171\u7528\u4e00\u4e2a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u2014\u2014\u4e5f\u5c31\u662f\u5185\u6838\u5730\u5740\u7a7a\u95f4\uff0c\u8fd9\u662f\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6700\u5927\u7684\u533a\u522b\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5c06\u4f1a\u6709\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u4f1a\u8bf4\u7ebf\u7a0b\u66f4\u8f7b\uff0c\u56e0\u4e3a\u6784\u9020\u865a\u62df\u5730\u5740\u7a7a\u95f4\u9700\u8981\u65f6\u95f4\u5f00\u9500\u3002</p> <p>\u8fd9\u91cc\u518d\u770b\u770b PA4\u6700\u540e\u7684\u8bb2\u4e49  \u4f53\u9a8c\u865a\u62df\u5316 - \u7a97\u53e3\u7ba1\u7406\u5668NWM  \u8fd9\u4e00\u90e8\u5206\u3002</p> </li> </ul> <p>\u521b\u5efa\u5185\u6838\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u662f\u901a\u8fc7CTE\u63d0\u4f9b\u7684<code>kcontext()</code>\u51fd\u6570 (\u5728<code>abstract-machine/am/src/riscv/nemu/cte.c</code>\u4e2d\u5b9a\u4e49)\u6765\u5b9e\u73b0\u7684, \u5176\u4e2d\u7684\"k\"\u4ee3\u8868\u5185\u6838. <code>kcontext()</code>\u7684\u539f\u578b\u662f</p> <pre><code>Context* kcontext(Area kstack, void (*entry)(void *), void *arg);\n</code></pre> <p>\u5176\u4e2d <code>kstack</code> \u662f\u6808\u7684\u8303\u56f4\uff0c<code>entry</code> \u662f\u5185\u6838\u7ebf\u7a0b\u7684\u5165\u53e3\uff0c<code>arg</code> \u5219\u662f\u5185\u6838\u7ebf\u7a0b\u7684\u53c2\u6570\u3002</p> <p>\u6b64\u5916, <code>kcontext()</code>\u8981\u6c42\u5185\u6838\u7ebf\u7a0b\u4e0d\u80fd\u4ece<code>entry</code>\u8fd4\u56de, \u5426\u5219\u5176\u884c\u4e3a\u662f\u672a\u5b9a\u4e49\u7684. </p> <p>\u4f60\u9700\u8981\u5728<code>kstack</code>\u7684\u5e95\u90e8\u521b\u5efa\u4e00\u4e2a\u4ee5<code>entry</code>\u4e3a\u5165\u53e3\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784(\u76ee\u524d\u4f60\u53ef\u4ee5\u5148\u5ffd\u7565<code>arg</code>\u53c2\u6570), \u7136\u540e\u8fd4\u56de\u8fd9\u4e00\u7ed3\u6784\u7684\u6307\u9488.</p> <p><code>yield-os</code>\u4f1a\u8c03\u7528<code>kcontext()</code>\u6765\u521b\u5efa\u4e0a\u4e0b\u6587, \u5e76\u628a\u8fd4\u56de\u7684\u6307\u9488\u8bb0\u5f55\u5230PCB\u7684<code>cp</code>\u4e2d:</p> <pre><code>|               |\n+---------------+ &lt;---- kstack.end\n|               |\n|    context    |\n|               |\n+---------------+ &lt;--+\n|               |    |\n|               |    |\n|               |    |\n|               |    |\n+---------------+    |\n|       cp      | ---+\n+---------------+ &lt;---- kstack.start\n|               |\n</code></pre> </li> <li> <p>\u7ebf\u7a0b/\u8fdb\u7a0b\u8c03\u5ea6</p> <p>\u4e0a\u4e0b\u6587\u7684\u521b\u5efa\u548c\u5207\u6362\u662fCTE\u7684\u5de5\u4f5c\uff0c\u800c\u5177\u4f53\u5207\u6362\u5230\u54ea\u4e2a\u4e0a\u4e0b\u6587\uff0c\u5219\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u51b3\u5b9a\u7684\uff0c\u8fd9\u9879\u4efb\u52a1\u53eb\u505a\u8fdb\u7a0b\u8c03\u5ea6\u3002</p> <p>\u8fdb\u7a0b\u8c03\u5ea6\u662f\u7531<code>schedule()</code>\u51fd\u6570\u6765\u5b8c\u6210\u7684\uff0c\u5b83\u7528\u4e8e\u8fd4\u56de\u5c06\u8981\u8c03\u5ea6\u7684\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u65b9\u5f0f\u6765\u8bb0\u5f55\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u54ea\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u6837\u6211\u4eec\u624d\u80fd\u5728 <code>schedule()</code> \u4e2d\u8fd4\u56de\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u4ee5\u5b9e\u73b0\u591a\u4efb\u52a1\u7684\u6548\u679c\u3002\u8fd9\u4e00\u5de5\u4f5c\u662f\u901a\u8fc7 <code>current</code> \u6307\u9488\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u7528\u4e8e\u6307\u5411\u5f53\u524d\u8fd0\u884c\u8fdb\u7a0b\u7684PCB\u3002</p> <p>\u8fd9\u6837, \u6211\u4eec\u5c31\u53ef\u4ee5\u5728 <code>schedule()</code> \u4e2d\u901a\u8fc7 <code>current</code> \u6765\u51b3\u5b9a\u63a5\u4e0b\u6765\u8981\u8c03\u5ea6\u54ea\u4e00\u4e2a\u8fdb\u7a0b\u4e86\u3002\u4e0d\u8fc7\u5728\u8c03\u5ea6\u4e4b\u524d, \u6211\u4eec\u8fd8\u9700\u8981\u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u6307\u9488\u4fdd\u5b58\u5728PCB\u5f53\u4e2d\uff1a</p> <pre><code>static PCB pcb[2], pcb_boot, \n        *current = &amp;pcb_boot;\nstatic Context *schedule(Event ev, Context *prev) {  \n  // save the context pointer\n  current-&gt;cp = prev;\n\n  // switch between pcb[0] and pcb[1]\n  current = (current == &amp;pcb[0] ? &amp;pcb[1] : &amp;pcb[0]);\n\n  // then return the new context\n  return current-&gt;cp;\n}\n</code></pre> <p>\u6ce8\u610f\u6240\u9009\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u662f\u901a\u8fc7 <code>kcontext()</code> \u521b\u5efa\u7684\uff0c\u5728 <code>schedule()</code> \u4e2d\u624d\u51b3\u5b9a\u8981\u5207\u6362\u5230\u5b83\uff0c\u7136\u540e\u5728CTE\u7684 <code>__am_asm_trap()</code> \u4e2d\u624d\u771f\u6b63\u5730\u6062\u590d\u8fd9\u4e00\u4e0a\u4e0b\u6587\uff08<code>__am_irq_handle</code> \u4e4b\u540e\uff09\u3002</p> <ul> <li> <p>\u9605\u8bfb</p> <p>\u673a\u5236\u548c\u7b56\u7565\u89e3\u8026</p> <p>\u8fd9\u5176\u5b9e\u4f53\u73b0\u4e86\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\u7684\u4e00\u79cd\u91cd\u8981\u539f\u5219: \u673a\u5236\u548c\u7b56\u7565\u89e3\u8026. \u673a\u5236\u89e3\u51b3\u7684\u662f\"\u80fd\u4e0d\u80fd\u505a\"\u7684\u95ee\u9898, \u800c\u7b56\u7565\u89e3\u51b3\u7684\u5219\u662f\"\u600e\u4e48\u505a\u597d\"\u7684\u95ee\u9898. \u663e\u7136, \u7b56\u7565\u9700\u8981\u673a\u5236\u7684\u652f\u6491, \u673a\u5236\u9700\u8981\u7b56\u7565\u6765\u53d1\u6325\u6700\u5927\u7684\u6548\u679c.</p> <p>\u89e3\u8026\u7684\u597d\u5904\u5c31\u5f88\u660e\u663e\u4e86: \u4ee3\u7801\u91cd\u7528\u7387\u9ad8, \u800c\u4e14\u5bb9\u6613\u7406\u89e3. \u5728Project-N\u4e2d, \u8fd9\u4e00\u89e3\u8026\u51e0\u4e4e\u505a\u5230\u4e86\u6781\u81f4: \u673a\u5236\u548c\u7b56\u7565\u88ab\u5206\u79bb\u5230\u4e24\u4e2a\u5b50\u9879\u76ee\u4e2d. \u6bd4\u5982, \"\u4e0a\u4e0b\u6587\u5207\u6362\"\u8fd9\u4e00\u673a\u5236\u662f\u5728AM\u7684CTE\u4e2d\u5b9e\u73b0\u7684, \u5b83\u8ba9\u7cfb\u7edf\u53ef\u4ee5\u505a\u5230\"\u6267\u884c\u6d41\u7684\u5207\u6362\"\u8fd9\u4ef6\u4e8b; \u800c\u5177\u4f53\u8981\u5207\u6362\u5230\u54ea\u4e00\u4e2a\u6267\u884c\u6d41, \u5219\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u7684.</p> <p>AM\u7684\u53e6\u5916\u4e00\u4e2a\u597d\u5904\u662f\u5c06\u5e95\u5c42\u786c\u4ef6\u7684\u884c\u4e3a\u62bd\u8c61\u6210\u7cfb\u7edf\u7ea7\u673a\u5236, AM\u4e0a\u7684\u5e94\u7528(\u5305\u62ecOS)\u53ea\u9700\u8981\u8c03\u7528\u8fd9\u4e9b\u7cfb\u7edf\u7ea7\u673a\u5236, \u5e76\u5b9e\u73b0\u76f8\u5e94\u7684\u7b56\u7565\u5373\u53ef. \u5f53\u7136\u76ee\u524d<code>schedule()</code>\u4e2d\u7684\u7b56\u7565\u975e\u5e38\u7b80\u5355, \u4e0b\u5b66\u671f\u7684\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c, \u751a\u81f3\u662f\u73b0\u5b9e\u4e2d\u66f4\u590d\u6742\u7684\u8fdb\u7a0b\u8c03\u5ea6\u7b56\u7565, \u90fd\u53ef\u4ee5\u5728AM\u63d0\u4f9b\u7684\u540c\u4e00\u4e2a\u673a\u5236\u4e4b\u4e0a\u5b9e\u73b0.</p> </li> </ul> <p>\u5c06\u6808\u9876\u6307\u9488\u5207\u6362\u5230\u65b0\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\uff1a<code>mv sp, a0</code>\u3002\u5728\u5207\u6362\u5230\u8fdb\u7a0b B \u4e4b\u524d\uff0c\u8fdb\u7a0b B \u7684\u4e0a\u4e0b\u6587\u88ab\u4fdd\u5b58\u4e86\u6808\u4e0a\u3002</p> <pre><code>...\nmv a0, sp\njal __am_irq_handle              \nmv sp, a0\n...\n</code></pre> <p>\u4e4b\u524d\u5c06 <code>sp</code> \u6307\u9488\u4f20\u7ed9 <code>a0</code> \u662f\u56e0\u4e3a\u8fd9\u662fRISC-V \u7684calling convention\uff0c\u4f7f\u7528 <code>a0</code> \u4f5c\u4e3a\u4f20\u9012\u51fd\u6570\u53c2\u6570\u7684\u5bc4\u5b58\u5668\uff0c\u800c\u5c06 <code>sp</code> \u8d4b\u7ed9 <code>a0</code> \uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u8bbf\u95ee\uff0c\u672c\u8fdb\u7a0b\u7684\u6808\u7684\u6574\u4e2a\u4e0a\u4e0b\u6587\u67b6\u6784\u3002\u5728\u8c03\u7528 <code>__am_irq_handle</code> \u540e\uff0c\u5176\u5185\u90e8\u4e5f\u5df2\u7ecf\u8c03\u7528\u4e86 <code>user_handler(schedule)</code> \u5c06\u4e4b\u524d\u4f20\u8fdb\u6765\u7684\uff0c\u539f\u6765\u6307\u5411\u672c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u7684\u6307\u9488\uff0c\u73b0\u5728\u6307\u5411\u65b0\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\uff08\u8fd9\u4e2a\u65f6\u5019\u5c31\u5df2\u7ecf\u5728\u65b0\u7684\u8fdb\u7a0b\u4e86\uff0c\u53ea\u662f\u7f3a\u4e4f <code>sp</code> \u6307\u5411\u4f4d\u7f6e\uff09\uff1b\u540c\u65f6 <code>schedule</code> \u4e5f\u8fd4\u56de\u4e86\u65b0\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u7684\u4f4d\u7f6e\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u65f6\u5019\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u4f53\u8fd8\u662f\u5b58\u5728\u4e86 <code>a0</code> \u5bc4\u5b58\u5668\u4e2d\uff0c\u90a3\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c06\u5176\u62ff\u51fa\u6765\uff0c\u653e\u5230\u65b0\u8fdb\u7a0b\u7684\u6808\u9876\u6307\u9488\u4e2d\u3002\u8fd9\u6837\u4e5f\u5c31\u8fbe\u5230\u4e86\u5c06\u6808\u9876\u6307\u9488\u5207\u6362\u5230\u65b0\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u7684\u6548\u679c\u3002</p> <p>\u8fd9\u91cc\u6539\u52a8\u4e00\u4e9b <code>ecall</code> \u548c <code>ret</code>,\u5148\u505a\u4e2a\u4fdd\u5b58</p> <pre><code> #define MRET { s-&gt;dnpc = cpu.csr.mepc;}\n\n// ECALL\nword_t isa_raise_intr(word_t NO, vaddr_t epc) {\n    cpu.csr.mepc = epc;\n    cpu.csr.mcause = NO;\n    \n    /*\n    cpu.csr.mstatus &amp;= ~(1 &lt;&lt; 7);\n\n    // \u628a\u5f02\u5e38\u53d1\u751f\u524d\u7684 MIE \u5b57\u6bb5 \u4fdd\u5b58\u5230 MPIE \u5b57\u6bb5 \n    cpu.csr.mstatus |= ((cpu.csr.mstatus &amp; (1 &lt;&lt; 3)) &lt;&lt; 4);\n    // \u4fdd\u5b58\u5904\u7406\u5668\u6a21\u5f0f MPP bit[9:8] 0b11 M mode\n    cpu.csr.mstatus |= ((1 &lt;&lt; 11) + (1 &lt;&lt; 12));\n    // \u5173\u95ed\u672c\u5730\u4e2d\u65ad MIE = 0\n    cpu.csr.mstatus &amp;= ~(1 &lt;&lt; 3);\n    */\n\n    return cpu.csr.mtvec;\n}\n</code></pre> </li> <li> <p>\u5185\u6838\u7ebf\u7a0b\u7684\u53c2\u6570</p> <p>\u5f88\u7b80\u5355\uff0c\u5b9e\u9645\u5c31\u662f\u51fd\u6570\u4f20\u53c2\u7684\u5185\u5bb9\u3002\u53ea\u9700\u8981\u6839\u636e\u51fd\u6570\u8c03\u7528\u7684\u6d41\u7a0b\uff0c\u8ba9 <code>kcontext</code> \u6309\u7167\u8c03\u7528\u7ea6\u5b9a\uff0c\u5c06\u53c2\u6570 <code>arg</code> \u653e\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u5373\u53ef\uff0c\u4e3b\u8981\u662f\u7ed9 <code>f()</code> \u7528\u3002</p> <p>\u7528 <code>a0</code></p> </li> </ol> <p>\u5728\u771f\u5b9e\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d, \u5185\u6838\u4e2d\u7684\u5f88\u591a\u540e\u53f0\u4efb\u52a1, \u5b88\u62a4\u670d\u52a1\u548c\u9a71\u52a8\u7a0b\u5e8f\u90fd\u662f\u4ee5\u5185\u6838\u7ebf\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\u7684. \u5982\u679c\u4f60\u6267\u884c<code>ps aux</code>, \u4f60\u5c31\u4f1a\u770b\u5230\u7cfb\u7edf\u4e2d\u6709\u5f88\u591aCOMMAND\u4e2d\u5e26\u6709\u4e2d\u62ec\u53f7\u7684\u5185\u6838\u7ebf\u7a0b(\u4f8b\u5982<code>[kthreadd]</code>). \u800c\u521b\u5efa\u548c\u6267\u884c\u5b83\u4eec\u7684\u539f\u7406, \u4e5f\u662f\u548c\u4e0a\u9762\u7684\u5b9e\u9a8c\u5185\u5bb9\u975e\u5e38\u76f8\u4f3c(\u5f53\u7136\u5177\u4f53\u5b9e\u73b0\u80af\u5b9a\u4f1a\u6709\u6240\u4e0d\u540c).</p>"},{"location":"ysyx/pa/pa4/pa4.html#os","title":"OS \u4e2d\u7684\u4e0a\u4e0b\u6587\u5207\u6362","text":""},{"location":"ysyx/pa/pa4/pa4.html#rt-thread","title":"RT-Thread","text":"<p>RT-Thread\u4e2d\u6709\u4e24\u4e2a\u62bd\u8c61\u5c42, \u4e00\u4e2a\u662fBSP(Board Support Package), \u53e6\u4e00\u4e2a\u662flibcpu.</p> <ul> <li>BSP\u4e3a\u5404\u79cd\u578b\u53f7\u7684\u677f\u5361\u5b9a\u4e49\u4e86\u4e00\u5957\u516c\u5171\u7684API, \u5e76\u57fa\u4e8e\u8fd9\u5957API\u5b9e\u73b0RT-Thread\u5185\u6838; \u800c\u5bf9\u4e8e\u4e00\u6b3e\u677f\u5361, \u53ea\u9700\u8981\u5b9e\u73b0\u76f8\u5e94\u7684API, \u5c31\u53ef\u4ee5\u5c06RT-Thread\u5185\u6838\u8fd0\u884c\u5728\u8fd9\u6b3e\u677f\u5361\u4e0a. </li> <li>libcpu\u5219\u662f\u4e3a\u5404\u79cdCPU\u67b6\u6784\u5b9a\u4e49\u4e86\u4e00\u5957\u516c\u5171\u7684API, RT-Thread\u5185\u6838\u4e5f\u4f1a\u8c03\u7528\u5176\u4e2d\u7684\u67d0\u4e9bAPI. </li> </ul> <p>\u8fd9\u4e00\u601d\u60f3\u548cAM\u975e\u5e38\u7c7b\u4f3c. \u5f53\u7136, BSP\u4e5f\u4e0d\u4ec5\u4ec5\u662f\u9488\u5bf9\u771f\u5b9e\u7684\u677f\u5361, \u4e5f\u53ef\u4ee5\u5bf9\u5e94QEMU\u7b49\u6a21\u62df\u5668, \u6bd5\u7adfRT-Thread\u5185\u6838\u65e0\u9700\u5173\u5fc3\u5e95\u5c42\u662f\u5426\u662f\u4e00\u4e2a\u771f\u5b9e\u7684\u677f\u5361.</p> <p></p> <p>\u7528AM\u7684API\u6765\u5b9e\u73b0BSP\u7684API, \u5177\u4f53\u89c1<code>rt-thread-am/bsp/abstract-machine/</code>\u76ee\u5f55\u4e0b\u7684\u4ee3\u7801. \u7528\u5230\u7684AM API\u5982\u4e0b:</p> <ul> <li>\u7528TRM\u7684heap\u5b9e\u73b0RT-Thread\u4e2d\u7684\u5806</li> <li>\u7528TRM\u7684<code>putch()</code>\u5b9e\u73b0RT-Thread\u4e2d\u7684\u4e32\u53e3\u8f93\u51fa\u529f\u80fd</li> <li>\u6682\u4e0d\u4f7f\u7528IOE</li> <li>\u7528CTE\u7684<code>iset()</code>\u5b9e\u73b0RT-Thread\u4e2d\u5f00/\u5173\u4e2d\u65ad\u529f\u80fd</li> <li>\u901a\u8fc7CTE\u5b9e\u73b0RT-Thread\u4e2d\u4e0a\u4e0b\u6587\u7684\u521b\u5efa\u548c\u5207\u6362\u529f\u80fd. \u6b64\u90e8\u5206\u4ee3\u7801\u5e76\u672a\u5b9e\u73b0, \u6211\u4eec\u5c06\u5b83\u4f5c\u4e3a\u9009\u505a\u4f5c\u4e1a.</li> </ul> <p>\u5bf9\u4e8e <code>RT-Thread</code> \u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5148\u7b80\u5355\u68b3\u7406\u4e00\u4e0b\u5c42\u6b21\uff0c\u4e2a\u4eba\u611f\u89c9\u8bb2\u4e49\u7684\u8fd9\u90e8\u5206\u6bd4\u8f83\u4e71\u3002</p> <ol> <li> <p>\u4e0a\u4e0b\u6587\u521b\u5efa</p> <p>\u5b9e\u73b0\uff1a<code>rt-thread-am/bsp/abstract-machine/src/context.c</code> \u4e2d\u7684 <code>rt_hw_stack_init()</code> \u51fd\u6570\uff1a</p> <pre><code>rt_uint8_t *rt_hw_stack_init(void *tentry, void *parameter, rt_uint8_t *stack_addr, void *texit);\n</code></pre> <p>\u5b83\u7684\u529f\u80fd\u662f\u4ee5 <code>stack_addr</code> \u4e3a\u6808\u5e95\u521b\u5efa\u4e00\u4e2a\u5165\u53e3\u4e3a <code>tentry</code> \uff0c\u53c2\u6570\u4e3a <code>parameter</code> \u7684\u4e0a\u4e0b\u6587\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2a\u4e0a\u4e0b\u6587\u7ed3\u6784\u7684\u6307\u9488\u3002</p> <p>\u6b64\u5916\uff0c\u82e5\u4e0a\u4e0b\u6587\u5bf9\u5e94\u7684\u5185\u6838\u7ebf\u7a0b\u4ece <code>tentry</code> \u8fd4\u56de\uff0c\u5219\u8c03\u7528<code>texit</code>\uff0c<code>RT-Thread</code> \u4f1a\u4fdd\u8bc1\u4ee3\u7801\u4e0d\u4f1a\u4ece <code>texit</code> \u4e2d\u8fd4\u56de\u3002</p> <p>\u95ee\u9898\uff1a</p> <ol> <li> <p>\u4f20\u5165\u7684 <code>stack_addr</code> \u53ef\u80fd\u6ca1\u6709\u4efb\u4f55\u5bf9\u9f50\u9650\u5236\uff0c\u6700\u597d\u5c06\u5b83\u5bf9\u9f50\u5230 <code>sizeof(uintptr_t)</code> \u518d\u4f7f\u7528.</p> </li> <li> <p>CTE\u7684 <code>kcontext()</code> \u8981\u6c42\u4e0d\u80fd\u4ece\u5165\u53e3\u8fd4\u56de\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u79cd\u65b0\u7684\u65b9\u5f0f\u6765\u652f\u6301 <code>texit</code> \u7684\u529f\u80fd\u3002</p> <p>\u4e00\u79cd\u65b9\u5f0f\u662f\u6784\u9020\u4e00\u4e2a\u5305\u88f9\u51fd\u6570, \u8ba9\u5305\u88f9\u51fd\u6570\u6765\u8c03\u7528 <code>tentry</code>\uff0c\u5e76\u5728 <code>tentry</code> \u8fd4\u56de\u540e\u8c03\u7528 <code>texit</code>\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u5305\u88f9\u51fd\u6570\u4f5c\u4e3a <code>kcontext()</code> \u7684\u771f\u6b63\u5165\u53e3\uff0c\u4e0d\u8fc7\u8fd9\u8fd8\u8981\u6c42\u6211\u4eec\u5c06 <code>tentry</code>\uff0c<code>parameter</code> \u548c <code>texit</code> \u8fd9\u4e09\u4e2a\u53c2\u6570\u4f20\u7ed9\u5305\u88f9\u51fd\u6570\uff0c\u5e94\u8be5\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u4f20\u53c2\u95ee\u9898\u5462\uff1f</p> </li> <li> <p>\u5173\u4e8e\u5bf9\u9f50\uff0c\u7a76\u7adf\u662f\u9009\u62e9\u5411\u4e0a\u8fd8\u662f\u5411\u4e0b\u5bf9\u9f50\uff1f</p> <ol> <li>\u5411\u4e0a\u5bf9\u9f50\uff08Round Up\uff09\uff1a<ul> <li>\u5185\u5b58\u5206\u914d\uff1a\u5f53\u9700\u8981\u5206\u914d\u4e00\u5757\u5185\u5b58\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u786e\u4fdd\u8fd9\u5757\u5185\u5b58\u7684\u8d77\u59cb\u5730\u5740\u662f\u67d0\u4e2a\u7279\u5b9a\u5927\u5c0f\uff08\u59824\u5b57\u8282\u30018\u5b57\u8282\u7b49\uff09\u7684\u500d\u6570\u3002\u4f7f\u7528<code>ROUNDUP</code>\u5b8f\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5411\u4e0a\u53d6\u6574\u7684\u5730\u5740\u3002</li> <li>\u6570\u636e\u7ed3\u6784\u5bf9\u9f50\uff1a\u67d0\u4e9b\u6570\u636e\u7ed3\u6784\u53ef\u80fd\u9700\u8981\u6309\u7167\u7279\u5b9a\u7684\u5bf9\u9f50\u8fb9\u754c\u5b58\u50a8\uff0c\u4ee5\u786e\u4fdd\u8bbf\u95ee\u65f6\u7684\u6548\u7387\u548c\u7b26\u5408\u786c\u4ef6\u8981\u6c42\u3002</li> </ul> </li> <li>\u5411\u4e0b\u5bf9\u9f50\uff08Round Down\uff09\uff1a<ul> <li>\u5185\u5b58\u5730\u5740\u8c03\u6574\uff1a\u5982\u679c\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u4e0d\u5728\u6240\u9700\u7684\u5bf9\u9f50\u8fb9\u754c\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528<code>ROUNDDOWN</code>\u5b8f\u5c06\u5730\u5740\u5411\u4e0b\u8c03\u6574\u5230\u6700\u8fd1\u7684\u5bf9\u9f50\u8fb9\u754c\u3002</li> <li>\u7f13\u5b58\u884c\u5bf9\u9f50\uff1a\u5728\u5904\u7406\u7f13\u5b58\u884c\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u786e\u4fdd\u6570\u636e\u5728\u7f13\u5b58\u884c\u7684\u5f00\u59cb\u5904\uff0c\u4ee5\u907f\u514d\u7f13\u5b58\u884c\u51b2\u7a81\u548c\u63d0\u9ad8\u7f13\u5b58\u6548\u7387\u3002</li> </ul> </li> </ol> </li> </ol> </li> <li> <p>\u4e0a\u4e0b\u6587\u5207\u6362</p> <p>\u5b9e\u73b0 <code>rt-thread-am/bsp/abstract-machine/src/context.c</code> \u4e2d\u7684 <code>rt_hw_context_switch_to()</code>\u3001 <code>rt_hw_context_switch()</code> \u51fd\u6570:</p> <pre><code>void rt_hw_context_switch_to(rt_ubase_t to);\nvoid rt_hw_context_switch(rt_ubase_t from, rt_ubase_t to);\n</code></pre> <p>\u5176\u4e2d <code>rt_ubase_t</code> \u7c7b\u578b\u5176\u5b9e\u662f <code>unsigned long</code>\uff0c<code>to</code> \u548c <code>from</code> \u90fd\u662f\u6307\u5411\u4e0a\u4e0b\u6587\u6307\u9488\u53d8\u91cf\u7684\u6307\u9488(\u4e8c\u7ea7\u6307\u9488)\u3002</p> <ul> <li><code>rt_hw_context_switch_to()</code> \u7528\u4e8e\u5207\u6362\u5230 <code>to</code> \u6307\u5411\u7684\u4e0a\u4e0b\u6587\u6307\u9488\u53d8\u91cf\u6240\u6307\u5411\u7684\u4e0a\u4e0b\u6587\u3002</li> <li><code>rt_hw_context_switch()</code> \u8fd8\u9700\u8981\u989d\u5916\u5c06\u5f53\u524d\u4e0a\u4e0b\u6587\u7684\u6307\u9488\u5199\u5165 <code>from</code> \u6307\u5411\u7684\u4e0a\u4e0b\u6587\u6307\u9488\u53d8\u91cf\u4e2d\u3002</li> </ul> <p>\u4e3a\u4e86\u8fdb\u884c\u5207\u6362\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>yield()</code> \u89e6\u53d1\u4e00\u6b21\u81ea\u9677\uff0c\u5728\u4e8b\u4ef6\u5904\u7406\u56de\u8c03\u51fd\u6570 <code>ev_handler()</code> \u4e2d\u8bc6\u522b\u51fa <code>EVENT_YIELD</code> \u4e8b\u4ef6\u540e\uff0c\u518d\u5904\u7406<code>to</code> \u548c <code>from</code>. </p> <p>\u540c\u6837\u5730, \u6211\u4eec\u9700\u8981\u601d\u8003\u5982\u4f55\u5c06<code>to</code>\u548c<code>from</code>\u8fd9\u4e24\u4e2a\u53c2\u6570\u4f20\u7ed9<code>ev_handler()</code>.</p> <p>\u5728<code>rt-thread-am/bsp/abstract-machine/src/context.c</code>\u4e2d\u8fd8\u6709\u4e00\u4e2a<code>rt_hw_context_switch_interrupt()</code>\u51fd\u6570, \u4e0d\u8fc7\u76ee\u524dRT-Thread\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e0d\u4f1a\u8c03\u7528\u5b83, \u56e0\u6b64\u76ee\u524d\u53ef\u4ee5\u5ffd\u7565\u5b83.</p> </li> <li> <p>\u53c2\u6570\u95ee\u9898</p> <p>\u6839\u636e\u5206\u6790\uff0c\u4e0a\u9762\u4e24\u4e2a\u529f\u80fd\u7684\u5b9e\u73b0\u90fd\u9700\u8981\u5904\u7406\u4e00\u4e9b\u7279\u6b8a\u7684\u53c2\u6570\u4f20\u9012\u95ee\u9898\u3002</p> <ul> <li> <p>\u5bf9\u4e8e\u4e0a\u4e0b\u6587\u7684\u5207\u6362\uff0c\u4ee5 <code>rt_hw_context_switch()</code> \u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981\u5728 <code>rt_hw_context_switch()</code> \u4e2d\u8c03\u7528 <code>yield()</code> , \u7136\u540e\u5728<code>ev_handler()</code> \u4e2d\u83b7\u5f97 <code>from</code> \u548c <code>to</code>\u3002</p> <p><code>rt_hw_context_switch()</code>\u548c <code>ev_handler()</code> \u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u51fd\u6570\uff0c\u4f46\u7531\u4e8eCTE\u673a\u5236\u7684\u5b58\u5728\uff0c\u4f7f\u5f97 <code>rt_hw_context_switch()</code> \u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 <code>ev_handler()</code>\u3002\u56e0\u6b64\uff0c\u4e00\u79cd\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u501f\u52a9\u5168\u5c40\u53d8\u91cf\u6765\u4f20\u9012\u4fe1\u606f\u3002</p> <p>\u5371\u9669\u7684\u5168\u5c40\u53d8\u91cf(1)</p> <p>\u5168\u5c40\u53d8\u91cf\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u53ea\u6709\u4e00\u4e2a\u526f\u672c, \u5982\u679c\u6574\u4e2a\u7cfb\u7edf\u4e2d\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b, \u8fd9\u901a\u5e38\u662f\u5b89\u5168\u7684. \u6211\u4eec\u5728C\u8bed\u8a00\u8bfe\u4e0a\u7f16\u5199\u7684\u7a0b\u5e8f\u90fd\u5c5e\u4e8e\u8fd9\u79cd\u60c5\u51b5, \u6240\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u5e76\u4e0d\u4f1a\u9020\u6210\u660e\u663e\u7684\u6b63\u786e\u6027\u95ee\u9898. \u4f46\u5982\u679c\u7cfb\u7edf\u4e2d\u5b58\u5728\u591a\u4e2a\u7ebf\u7a0b, \u5e76\u4e14\u5b83\u4eec\u4f7f\u7528\u540c\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u7684\u65f6\u95f4\u6bb5\u6709\u91cd\u53e0, \u5c31\u53ef\u80fd\u4f1a\u9020\u6210\u95ee\u9898.</p> <p>\u4e0d\u8fc7\u76ee\u524d\u6211\u4eec\u7684\u786c\u4ef6\u65e2\u672a\u5b9e\u73b0\u4e2d\u65ad, \u4e5f\u4e0d\u652f\u6301\u591a\u5904\u7406\u5668, \u4ece\u7f16\u7a0b\u6a21\u578b\u6765\u770b\u548cC\u8bed\u8a00\u8bfe\u5dee\u4e0d\u591a, \u56e0\u6b64\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u8fd8\u662f\u53ef\u4ee5\u7684.</p> <p>\u5371\u9669\u7684\u5168\u5c40\u53d8\u91cf(2)</p> <p>\u5982\u679c\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6765\u4f20\u9012\u4fe1\u606f, \u8003\u8651\u4ee5\u4e0b\u573a\u666f, \u53ef\u80fd\u4f1a\u51fa\u73b0\u4ec0\u4e48\u95ee\u9898?</p> <ul> <li>\u5728\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e2d, \u4e24\u4e2a\u5904\u7406\u5668\u540c\u65f6\u8c03\u7528<code>rt_hw_context_switch()</code></li> <li>\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528<code>rt_hw_context_switch()</code>\u540e\u5199\u5165\u4e86\u5168\u5c40\u53d8\u91cf, \u4f46\u9a6c\u4e0a\u5230\u6765\u4e86\u65f6\u949f\u4e2d\u65ad, \u4f7f\u5f97\u7cfb\u7edf\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b, \u4f46\u8fd9\u4e2a\u7ebf\u7a0b\u4e5f\u8c03\u7528\u4e86<code>rt_hw_context_switch()</code></li> </ul> <p>\u5371\u9669\u7684\u5168\u5c40\u53d8\u91cf(4) </p> <p>\u80fd\u5426\u4e0d\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6765\u5b9e\u73b0\u4e0a\u4e0b\u6587\u7684\u5207\u6362\u5462?</p> <p>\u540c\u6837\u5730, \u6211\u4eec\u9700\u8981\u5bfb\u627e\u4e00\u79cd\u4e0d\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5b58\u50a8\u7a7a\u95f4. \u4e0d\u8fc7\u5bf9\u4e8e\u8c03\u7528<code>rt_hw_context_switch()</code>\u7684\u7ebf\u7a0b\u6765\u8bf4, \u5b83\u7684\u6808\u6b63\u5728\u88ab\u4f7f\u7528, \u5f80\u5176\u4e2d\u5199\u5165\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6, \u751a\u81f3\u53ef\u80fd\u4f1a\u8986\u76d6\u5df2\u6709\u6570\u636e, \u4f7f\u5f53\u524d\u7ebf\u7a0b\u5d29\u6e83. <code>to</code>\u7684\u6808\u867d\u7136\u5f53\u524d\u4e0d\u4f7f\u7528, \u4e5f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u5171\u4eab, \u4f46\u9700\u8981\u8003\u8651\u5982\u4f55\u8ba9<code>ev_handler()</code>\u8bbf\u95ee\u5230<code>to</code>\u7684\u6808, \u8fd9\u53c8\u56de\u5230\u4e86\u6211\u4eec\u4e00\u5f00\u59cb\u60f3\u8981\u89e3\u51b3\u7684\u95ee\u9898.</p> <p>\u9664\u4e86\u6808\u4e4b\u5916, \u8fd8\u6709\u6ca1\u6709\u5176\u4ed6\u4e0d\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5b58\u50a8\u7a7a\u95f4\u5462? \u563f\u563f, \u5176\u5b9e\u524d\u6587\u4e5f\u5df2\u7ecf\u63d0\u5230\u8fc7\u5b83\u4e86, \u90a3\u5c31\u662fPCB! \u56e0\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2aPCB, \u800c\u4e00\u4e2a\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u540c\u65f6\u8c03\u5ea6\u591a\u6b21, \u6240\u4ee5\u901a\u8fc7PCB\u6765\u4f20\u9012\u4fe1\u606f\u4e5f\u662f\u4e00\u4e2a\u53ef\u884c\u7684\u65b9\u6848. \u8981\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684PCB, \u81ea\u7136\u662f\u7528<code>current</code>\u6307\u9488\u4e86.</p> <p>\u5728RT-Thread\u4e2d, \u53ef\u4ee5\u901a\u8fc7\u8c03\u7528<code>rt_thread_self()</code>\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u7684PCB. \u9605\u8bfbRT-Thread\u4e2dPCB\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49, \u6211\u4eec\u53d1\u73b0\u5176\u4e2d\u6709\u4e00\u4e2a\u6210\u5458<code>user_data</code>, \u5b83\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e, \u8fd9\u610f\u5473\u7740RT-Thread\u4e2d\u8c03\u5ea6\u76f8\u5173\u7684\u4ee3\u7801\u5fc5\u5b9a\u4e0d\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u6210\u5458, \u56e0\u6b64\u5b83\u5f88\u9002\u5408\u6211\u4eec\u7528\u6765\u4f20\u9012\u4fe1\u606f. \u4e0d\u8fc7\u4e3a\u4e86\u907f\u514d\u8986\u76d6<code>user_data</code>\u4e2d\u7684\u5df2\u6709\u6570\u636e, \u6211\u4eec\u53ef\u4ee5\u5148\u628a\u5b83\u4fdd\u5b58\u5728\u4e00\u4e2a\u4e34\u65f6\u53d8\u91cf\u4e2d, \u5728\u4e0b\u6b21\u5207\u6362\u56de\u5f53\u524d\u7ebf\u7a0b\u5e76\u4ece<code>rt_hw_context_switch()</code>\u8fd4\u56de\u4e4b\u524d\u518d\u6062\u590d\u5b83. \u81f3\u4e8e\u8fd9\u4e2a\u4e34\u65f6\u53d8\u91cf, \u5f53\u7136\u662f\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u4e86, \u6bd5\u7adf\u5c40\u90e8\u53d8\u91cf\u662f\u5728\u6808\u4e0a\u5206\u914d\u7684, \u5b8c\u7f8e!</p> <p>\u5bf9\u4e8e\u4e0a\u9762\u4e24\u4e2a\u7248\u672c\u90fd\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e0b\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u4e0a\u4e0b\u6587\u521b\u5efa\uff0c</p> <p>\u5bf9\u4e8e\u4e0a\u4e0b\u6587\u7684\u521b\u5efa\uff0c\u95ee\u9898\u5c31\u66f4\u590d\u6742\u4e86\uff1a\u8c03\u7528 <code>rt_hw_stack_init()</code> \u548c\u6267\u884c\u5305\u88f9\u51fd\u6570\u7684\u4e24\u4e2a\u7ebf\u7a0b\u5e76\u4e0d\u76f8\u540c.</p> <p>\u5371\u9669\u7684\u5168\u5c40\u53d8\u91cf(3)</p> <p>\u5982\u679c\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6765\u4f20\u9012\u4fe1\u606f, \u800c\u4ee3\u7801\u8fde\u7eed\u8c03\u7528\u4e86\u4e24\u6b21 <code>rt_hw_stack_init()</code> , \u4f1a\u9020\u6210\u4ec0\u4e48\u95ee\u9898?</p> <p>\u56e0\u6b64, \u6211\u4eec\u9700\u8981\u5bfb\u627e\u53e6\u4e00\u79cd\u89e3\u51b3\u65b9\u6848. \u56de\u8fc7\u5934\u6765\u770b, \u5168\u5c40\u53d8\u91cf\u9020\u6210\u95ee\u9898\u7684\u539f\u56e0\u662f\u5b83\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab, \u4e3a\u4e86\u5f97\u5230\u6b63\u786e\u7684\u89e3\u51b3\u65b9\u6848, \u6211\u4eec\u5e94\u8be5\u53cd\u5176\u9053\u800c\u884c\u4e4b: \u4f7f\u7528\u4e00\u79cd==\u4e0d\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5b58\u50a8\u7a7a\u95f4==. \u563f\u563f, \u5176\u5b9e\u524d\u6587\u5df2\u7ecf\u63d0\u5230\u8fc7\u5b83\u4e86, \u90a3\u5c31\u662f\u6808\uff01</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u8ba9 <code>rt_hw_stack_init()</code> \u5c06\u5305\u88f9\u51fd\u6570\u7684\u4e09\u4e2a\u53c2\u6570\u653e\u5728\u4e0a\u4e0b\u6587\u7684\u6808\u4e2d, \u5c06\u6765\u5305\u88f9\u51fd\u6570\u6267\u884c\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u4ece\u6808\u4e2d\u53d6\u51fa\u8fd9\u4e09\u4e2a\u53c2\u6570, \u800c\u4e14\u7cfb\u7edf\u4e2d\u7684\u5176\u4ed6\u7ebf\u7a0b\u90fd\u4e0d\u80fd\u8bbf\u95ee\u5b83\u4eec.</p> <p>\u6700\u540e\u8fd8\u9700\u8981\u8003\u8651\u53c2\u6570\u6570\u91cf\u7684\u95ee\u9898, <code>kcontext()</code> \u8981\u6c42\u5165\u53e3\u51fd\u6570\u53ea\u80fd\u63a5\u53d7\u4e00\u4e2a\u7c7b\u578b\u4e3a<code>void *</code>\u7684\u53c2\u6570. \u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u81ea\u884c\u7ea6\u5b9a\u7528\u4f55\u79cd\u7c7b\u578b\u6765\u89e3\u6790\u8fd9\u4e2a\u53c2\u6570(\u6574\u6570, \u5b57\u7b26, \u5b57\u7b26\u4e32, \u6307\u9488\u7b49\u7686\u53ef), \u4e8e\u662f\u8fd9\u5c31\u6210\u4e86\u4e00\u4e2aC\u8bed\u8a00\u7684\u7f16\u7a0b\u9898\u4e86.</p> <p>\u8fd9\u91cc\u5c31\u5f88\u50cf <code>abstract-machine/am/src/riscv/nemu/trap.S</code> \u4f20\u9012\u7ed3\u6784\u4f53\u6307\u9488\u7ed9 <code>__am_irq_handle</code> \u7684\u5185\u5bb9\uff0c\u5b9e\u73b0\u7c7b\u4f3c\uff0c\u5c31\u6709\u79cd\u56de\u5230\u4e4b\u524d\u8bfb <code>FreeRTOS</code> \u6e90\u7801\u7684\u611f\u89c9\u4e86\uff0c\u53e6\u5916\uff0c\u8fd9\u91cc\u9762\u7684C\u8bed\u8a00\u6307\u9488\u4e5f\u73a9\u7684\u82b1\u8d77\u6765\u4e86\uff0c\u9700\u8981\u518d\u770b\u770b \u4e8c\u7ea7\u6307\u9488 \u548c \u51fd\u6570\u6307\u9488 \u7684\u5185\u5bb9\u3002</p> </li> </ul> </li> </ol> <p>\u7528\u5230\u7684 RT-Thread \u624b\u518c</p> <pre><code>typedef struct rt_thread *  rt_thread_t\n    \u7ebf\u7a0b\u7c7b\u578b\u6307\u9488\u5b9a\u4e49\n</code></pre> <p>\u66f4\u591a\u53c2\u8003\uff1aRT-Thread API\u53c2\u8003\u624b\u518c: RT-Thread \u7b80\u4ecb</p> <p>RT-Thread\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\uff0c\u975e\u5e38\u8be6\u7ec6\uff0c\u901a\u4fd7\u6613\u61c2\uff01\uff01\uff01_rt\uff0cthread\uff0c\u542f\u52a8\u6d41\u7a0b-CSDN\u535a\u5ba2</p> <p>RT-Thread\u6e90\u7801\u5b66\u4e60\u7b2c\u4e00\u7bc7\uff0c\u5206\u6790\u88f8\u673a\u7a0b\u5e8f\u7684\u5f00\u59cb\u4ee3\u7801 - OSCHINA - \u4e2d\u6587\u5f00\u6e90\u6280\u672f\u4ea4\u6d41\u793e\u533a</p>"},{"location":"ysyx/pa/pa4/pa4.html#nanos-lite","title":"Nanos-lite","text":"<p>\u8fd9\u91cc\u76f4\u63a5\u7167\u642c <code>yield-os</code></p> <pre><code>void init_proc() {\n  context_kload(&amp;pcb[0], hello_fun, \"123\");\n  context_kload(&amp;pcb[1], hello_fun, \"456\");\n  switch_boot_pcb();\n\n  Log(\"Initializing processes...\");\n\n  // load program here\n  //naive_uload(NULL, \"/bin/menu\");\n  //naive_uload(NULL, \"/bin/bmp-test\");\n}\n</code></pre> <pre><code>void hello_fun(void *arg) {\n  int j = 1;\n  while (1) {\n    Log(\"Hello World from Nanos-lite with arg '%s' for the %dth time!\", (const char *)arg, j);\n    j ++;\n    yield();\n  }\n}\n</code></pre> <p>\u8c03\u7528<code>kcontext()</code>\u6765\u521b\u5efa\u4e0a\u4e0b\u6587, \u5e76\u628a\u8fd4\u56de\u7684\u6307\u9488\u8bb0\u5f55\u5230PCB\u7684<code>cp</code>\u4e2d</p> <pre><code>void context_kload(PCB *pcb, void (*entry)(void *), void *arg) {\n    Area stack = {\n        .start = pcb-&gt;stack,\n        .end = pcb-&gt;stack + STACK_SIZE\n    };\n    pcb-&gt;cp = kcontext(stack, entry, arg);      \n}   \n</code></pre> <p><code>riscv32-nemu</code> \u548c <code>native</code> \u90fd\u6210\u529f\u8fd0\u884c\uff1a</p> <p></p>"},{"location":"ysyx/pa/pa4/pa4.html#_6","title":"\u7528\u6237\u8fdb\u7a0b","text":""},{"location":"ysyx/pa/pa4/pa4.html#_7","title":"\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587","text":"<p>PA3 \u7684 <code>naive_uload()</code> \u76f4\u63a5\u901a\u8fc7\u51fd\u6570\u8c03\u7528\u6765\u8f6c\u79fb\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u4ee3\u7801\uff0c\u90a3\u65f6\u5019\u7528\u7684\u8fd8\u662f\u5185\u6838\u6808\uff0c\u6808\u6ea2\u51fa\u5c31 G\uff0c\u4f1a\u635f\u574f\u64cd\u4f5c\u7cfb\u7edf\u7684\u6570\u636e\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u662f\u5728\u591a\u9053\u7a0b\u5e8f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u7cfb\u7edf\u8fd0\u884c\u7684\u8fdb\u7a0b\u5c31\u4e0d\u6b62\u4e00\u4e2a\u4e86\uff0c\u5982\u679c\u8ba9\u7528\u6237\u8fdb\u7a0b\u7ee7\u7eed\u4f7f\u7528\u5185\u6838\u533a\u7684\u6808\uff0c\u5c31\u4f1a\u5f71\u54cd\u5230\u5176\u5b83\u8fdb\u7a0b\u7684\u8fd0\u884c\u3002</p> <ul> <li> <p>\u9605\u8bfb</p> <p>\u5982\u679c\u5185\u6838\u7ebf\u7a0b\u53d1\u751f\u4e86\u6808\u6ea2\u51fa, \u600e\u4e48\u529e?</p> <p>\u5982\u679c\u80fd\u68c0\u6d4b\u51fa\u6765, \u6700\u597d\u7684\u65b9\u6cd5\u5c31\u662f\u89e6\u53d1kernel panic, \u56e0\u4e3a\u8fd9\u65f6\u5019\u5185\u6838\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u518d\u53ef\u4fe1, \u5982\u679c\u5c06\u4e00\u4e2a\u88ab\u7834\u574f\u7684\u6570\u636e\u5199\u56de\u78c1\u76d8, \u5c06\u4f1a\u9020\u6210\u65e0\u6cd5\u6062\u590d\u7684\u6bc1\u706d\u6027\u635f\u574f.</p> <p>\u597d\u6d88\u606f\u662f, \u5185\u6838\u7ebf\u7a0b\u7684\u6b63\u786e\u6027\u53ef\u4ee5\u7531\u5185\u6838\u5f00\u53d1\u4eba\u5458\u6765\u4fdd\u8bc1, \u8fd9\u81f3\u5c11\u8981\u6bd4\u4fdd\u8bc1\u90a3\u4e9b\u6765\u8def\u4e0d\u660e\u7684\u7528\u6237\u8fdb\u7a0b\u7684\u6b63\u786e\u6027\u8981\u7b80\u5355\u591a\u4e86. </p> <p>\u800c\u574f\u6d88\u606f\u5219\u662f, \u5927\u90e8\u5206\u7684\u5185\u6838bug\u90fd\u662f\u7b2c\u4e09\u65b9\u9a71\u52a8\u7a0b\u5e8f\u5bfc\u81f4\u7684: \u6808\u6ea2\u51fa\u7b97\u662f\u5c11\u89c1\u7684\u4e86, \u66f4\u591a\u7684\u662fuse-after-free, double-free, \u8fd8\u6709\u96be\u4ee5\u6349\u6478\u7684\u5e76\u53d1bug. \u800c\u9762\u5bf9\u6d77\u91cf\u7684\u7b2c\u4e09\u65b9\u9a71\u52a8\u7a0b\u5e8f, \u5185\u6838\u5f00\u53d1\u4eba\u5458\u4e5f\u96be\u4ee5\u9010\u4e00\u4fdd\u8bc1\u5176\u6b63\u786e\u6027. \u5982\u679c\u4f60\u60f3\u5230\u4e00\u4e2a\u53ef\u4ee5\u63d0\u5347\u9a71\u52a8\u7a0b\u5e8f\u4ee3\u7801\u8d28\u91cf\u7684\u65b9\u6cd5, \u90a3\u5c31\u662f\u4e3a\u8ba1\u7b97\u673a\u7cfb\u7edf\u9886\u57df\u4f5c\u51fa\u8d21\u732e\u4e86.</p> <p>Linux \u9a71\u52a8\u5f00\u53d1\u6d89\u53ca\u5230\u7684\u5185\u5bb9\uff1f</p> </li> </ul> <p>\u56e0\u6b64\uff0c\u548c\u5185\u6838\u7ebf\u7a0b\u4e0d\u540c\uff0c\u7528\u6237\u8fdb\u7a0b\u7684\u4ee3\u7801\uff0c\u6570\u636e\u548c\u5806\u6808\u90fd\u5e94\u4f4d\u4e8e\u7528\u6237\u533a\uff0c\u800c\u4e14\u9700\u8981\u4fdd\u8bc1\u7528\u6237\u8fdb\u7a0b\u80fd\u4e14\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u6570\u636e\u548c\u5806\u6808\u3002</p> <p>\u4e3a\u4e86\u533a\u522b\u5f00\u6765\uff0c\u6211\u4eec\u628aPCB\u4e2d\u7684\u6808\u79f0\u4e3a\u5185\u6838\u6808\uff0c\u4f4d\u4e8e\u7528\u6237\u533a\u7684\u6808\u79f0\u4e3a\u7528\u6237\u6808\u3002</p> <p>\u4e8e\u662f\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6709\u522b\u4e8e <code>kcontext()</code> \u7684\u65b9\u5f0f\u6765\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u4e3a\u6b64 AM \u989d\u5916\u51c6\u5907\u4e86\u4e00\u4e2aAPI <code>ucontext()</code> (\u5728 <code>~/ysyx-workbench/abstract-machine/am/src/riscv/nemu/vme.c</code>\u4e2d\u5b9a\u4e49)\uff0c\u539f\u578b\uff1a</p> <pre><code>Context* ucontext(AddrSpace *as, Area kstack, void *entry);\n</code></pre> <ul> <li>\u53c2\u6570 <code>as</code> \u7528\u4e8e\u9650\u5236\u7528\u6237\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u7684\u5185\u5b58\uff0c\u6211\u4eec\u5728\u4e0b\u4e00\u9636\u6bb5\u624d\u4f1a\u4f7f\u7528\uff0c\u76ee\u524d\u53ef\u4ee5\u5ffd\u7565\u5b83\u3002 </li> <li><code>kstack</code> \u662f\u5185\u6838\u6808, \u7528\u4e8e\u5206\u914d\u4e0a\u4e0b\u6587\u7ed3\u6784\uff0c<code>entry</code> \u5219\u662f\u7528\u6237\u8fdb\u7a0b\u7684\u5165\u53e3. </li> </ul> <p>\u7531\u4e8e\u76ee\u524d\u6211\u4eec\u5ffd\u7565\u4e86<code>as</code>\u53c2\u6570, \u6240\u4ee5<code>ucontext()</code>\u7684\u5b9e\u73b0\u548c<code>kcontext()</code>\u51e0\u4e4e\u4e00\u6837, \u751a\u81f3\u6bd4<code>kcontext()</code>\u66f4\u7b80\u5355: \u8fde\u53c2\u6570\u90fd\u4e0d\u9700\u8981\u4f20\u9012. </p> <p><code>ucontext</code> \u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>Context *ucontext(AddrSpace *as, Area kstack, void *entry) {\n    void *stack_end = kstack.end;\n    Context *base = (Context *) ((uint8_t *)stack_end - sizeof(Context));\n    // just pass the difftest\n    base-&gt;mstatus = 0x1800;\n    base-&gt;mepc = (uintptr_t)entry;\n    return base;\n}            \n</code></pre> <p>\u4e0d\u8fc7\u4f60\u8fd8\u662f\u9700\u8981\u601d\u8003, \u5bf9\u4e8e\u7528\u6237\u8fdb\u7a0b\u6765\u8bf4, \u5b83\u9700\u8981\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u72b6\u6001\u6765\u5f00\u59cb\u6267\u884c\u5462?</p> <p>\u7a0b\u5e8f\u662f\u4e2a <code>S = &lt;R, M&gt;</code> \u7684\u72b6\u6001\u673a</p> <p>\u5bc4\u5b58\u5668\u53ef\u4ee5\u8868\u793a\u4e3a <code>R = {GPR, PC, SR}</code>\uff0c\u5176\u4e2d <code>SR</code> \u4e3a\u7cfb\u7edf\u5bc4\u5b58\u5668</p> <p>\u5bc4\u5b58\u5668\u548c\u5185\u5b58\u90fd\u51c6\u5907\u597d\u4e86\uff0c\u7528\u6237\u8fdb\u7a0b\u5f00\u59cb\uff0c\u51c6\u5907\u5230\u4ec0\u4e48\u7a0b\u5ea6\uff1f</p> <p>\u4e0a\u4e0b\u6587\u7684\u672c\u8d28\u5c31\u662f\u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u90a3\u8fdb\u7a0b\u548c\u4e0a\u4e0b\u6587\u5728\u5207\u6362\u8fdb\u7a0b\u8fd9\u4e00\u89d2\u5ea6\uff0c\u5c31\u662f\u7c7b\u4f3c\u7684\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5c31\u53d8\u6210\u4e86\u7528\u6237\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u9700\u8981\u51c6\u5907\u5230\u4ec0\u4e48\u7a0b\u5ea6\uff1f\u6700\u7b80\u5355\u7684\uff0c\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u6bcf\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u7684\u5404\u81ea\u7684\u8d44\u6e90\u5c31\u662f\u5404\u8fdb\u7a0b\u7684\u6808\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u6808\u5f97\u51c6\u5907\u597d\u3002</p> <p>\u53e6\u4e00\u4e2a\u65b9\u9762\uff0c \u5728\u6211\u4eec\u7684 NEMU \u4e2d\uff0c\u5bc4\u5b58\u5668\u4e5f\u5c31\u662f\u4e00\u5757\u5185\u5b58\uff0c\u6309\u4e4b\u524d\u7684\u5185\u5bb9\uff0c\u4e5f\u5df2\u7ecf\u5165\u6808\u3002 <p>\u4e8b\u5b9e\u4e0a\uff0c\u7528\u6237\u6808\u7684\u5206\u914d\u662fISA\u65e0\u5173\u7684\uff0c\u6240\u4ee5\u7528\u6237\u6808\u76f8\u5173\u7684\u90e8\u5206\u5c31\u4ea4\u7ed9 Nanos-lite \u6765\u8fdb\u884c\uff0c<code>ucontext()</code> \u65e0\u9700\u5904\u7406\u3002\u76ee\u524d\u6211\u4eec\u8ba9 Nanos-lite \u628a <code>heap.end</code> \u4f5c\u4e3a\u7528\u6237\u8fdb\u7a0b\u7684\u6808\u9876\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u6808\u9876\u8d4b\u7ed9\u7528\u6237\u8fdb\u7a0b\u7684\u6808\u6307\u9488\u5bc4\u5b58\u5668\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u54ce\u5440\uff0c\u6808\u6307\u9488\u5bc4\u5b58\u5668\u53ef\u662fISA\u76f8\u5173\u7684\uff0c\u5728Nanos-lite\u91cc\u9762\u4e0d\u65b9\u4fbf\u5904\u7406\u3002\u522b\u7740\u6025, \u8fd8\u8bb0\u5f97\u7528\u6237\u8fdb\u7a0b\u7684\u90a3\u4e2a <code>_start</code> \u5417? \u5728\u90a3\u91cc\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9bISA\u76f8\u5173\u7684\u64cd\u4f5c\u3002\u4e8e\u662f Nanos-lite\u548cNavy\u4f5c\u4e86\u4e00\u9879\u7ea6\u5b9a\uff1aNanos-lite \u628a\u6808\u9876\u4f4d\u7f6e\u8bbe\u7f6e\u5230 <code>GPRx</code> \u4e2d\uff0c\u7136\u540e\u7531 Navy \u91cc\u9762\u7684 <code>_start</code> \u6765\u628a\u6808\u9876\u4f4d\u7f6e\u771f\u6b63\u8bbe\u7f6e\u5230\u6808\u6307\u9488\u5bc4\u5b58\u5668\u4e2d\u3002</p> <p>Nanos-lite\u53ef\u4ee5\u628a\u4e0a\u8ff0\u5de5\u4f5c\u5c01\u88c5\u5230 <code>context_uload()</code> \u51fd\u6570\u4e2d, \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u52a0\u8f7d\u7528\u6237\u8fdb\u7a0b\u4e86\u3002\u5982\u4e0b\uff1a</p> <pre><code>void context_uload(PCB *pcb, const char *process_name) {\n    uintptr_t entry = naive_uload(pcb, process_name);\n    Area stack = {\n        .start = heap.end - STACK_SIZE,\n        .end   = heap.end\n    };\n    Log(\"name: %s\", process_name);\n    Log(\"entry: %d\", entry);\n    Log(\"stack.start: %d, stack.end: %d\", stack.start, stack.end);\n\n    pcb-&gt;cp = ucontext(&amp;pcb-&gt;as, stack, (void *)entry);\n    pcb-&gt;cp-&gt;GPRx = (uintptr_t)heap.end;\n}\n</code></pre> <p>\u4e00\u76f4\u5fd8\u4e86\u8fd4\u56de <code>ucontext</code> \u7684\u503c\uff0c\u7ed9 \u5f53\u524d\u7ebf\u7a0b\u7684 <code>cp</code> \u8bb0\u5f55\u8be5\u7528\u6237\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u4f4d\u7f6e\u3002\u76ee\u7684\u5728\u4e8e\u627e\u5230\u8981\u7684\u8c03\u5ea6\u7684\u4e0a\u4e0b\u6587\u7684\u5165\u53e3</p> <p>\u770b\u6765\u8fd8\u662f\u6709\u70b9\u61f5\u61f5\u61c2\u61c2\u3002</p> <p>\u628a\u5176\u4e2d\u4e00\u4e2a <code>hello_fun()</code> \u5185\u6838\u7ebf\u7a0b\u66ff\u6362\u6210\uff1a\u7528\u6237\u8fdb\u7a0b\u4ed9\u5251\u5947\u4fa0\u4f20\uff1a</p> <pre><code>context_uload(&amp;pcb[1], \"/bin/pal\");\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u8fd8\u9700\u8981\u5728 <code>serial_write()</code>\u3001<code>events_read()</code> \u548c <code>fb_write()</code> \u7684\u5f00\u5934\u8c03\u7528 <code>yield()</code>\uff0c\u6765\u6a21\u62df\u8bbe\u5907\u8bbf\u95ee\u7f13\u6162\u7684\u60c5\u51b5\u3002\u6dfb\u52a0\u4e4b\u540e\uff0c\u8bbf\u95ee\u8bbe\u5907\u65f6\u5c31\u8981\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4ece\u800c\u5b9e\u73b0\u591a\u9053\u7a0b\u5e8f\u7cfb\u7edf\u7684\u529f\u80fd\u3002</p> <p>\u6bcf\u6b21\u89e6\u53d1 <code>YIELD</code> \u4e8b\u4ef6\uff0c\u5728\u5404\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u8c03\u5ea6\u3002</p> <p>\u8fd0\u884c\u6210\u529f\uff0c\u8fd8\u771f\u662f\u5361\u7206\u4e86\uff0c\u8fd9\u4e2a\u6a21\u62df\u8bbe\u5907\u8bbf\u95ee\u7f13\u6162\u662f\u771f\u7684\u6162 (\u5173\u4e86 <code>difftest</code> \u548c <code>trace</code> \u5e94\u8be5\u4f1a\u53d8\u5feb\u5f88\u591a\uff09</p> <p></p> <p>\u4f46\u662f\u5728 Navy native \u4e0b\u4e00\u76f4\u9ed1\u5c4f\uff0c\u5c31\u548c\u4e4b\u524d\u5728 Navy native \u4e0a \u8fd0\u884c <code>bmp-test</code> \u4e00\u6837 \uff08\uff08</p> <p>\u786e\u5b9e\u6ca1\u6709\u76f8\u5173\u7684API\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u7528\u7684\u662f \u81ea\u5df1\u5b9e\u73b0\u7684 <code>NDL</code> \u5440\uff1f</p> <p>\u518d\u56de\u770b\u4e00\u4e0b Navy native \u7684\u8fd0\u884c\u65f6\u73af\u5883\u662f\u4ec0\u4e48\uff1f\uff0c\u76f4\u63a5\u7531 Linux native \u63d0\u4f9b\u7684\uff0c\u7528\u7684 Linux \u539f\u751f\u5e73\u53f0\u7684\u5185\u5bb9\u6765\u9a8c\u8bc1\u81ea\u5df1\u7684 <code>NDL</code> \u548c <code>miniSDL</code> \u7684\u5b9e\u73b0\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u76ee\u524d\u770b\u6765\u662f\u6709\u7684</p> <p></p> <p>\u4e0d\u5bf9\uff0c\u7a81\u7136\u50bb\u4e86\uff0c\u8bb2\u4e49\u8981\u6c42\u7684\u662f\u5728 <code>am-native</code> <code>nanos-lite</code> \u6d4b\u6d4b</p> <p>\u628a <code>GPRx</code> \u653e\u5230 <code>rsp</code> \u4e2d\uff0c\u641e\u5b9a\u3002</p> <p></p> <p>\u8fd9\u662f\u771f\u7684\u5feb\u591a\u4e86\u54c8\u54c8\u54c8\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e00\u5c71\u4e0d\u80fd\u85cf\u4e8c\u864e?</p> <p>\u5c1d\u8bd5\u628a<code>hello_fun()</code>\u6362\u6210Navy\u4e2d\u7684<code>hello</code>:</p> <pre><code>-context_kload(&amp;pcb[0], (void *)hello_fun, NULL);\n+context_uload(&amp;pcb[0], \"/bin/hello\");\n context_uload(&amp;pcb[1], \"/bin/pal\");\n</code></pre> <p>\u4f60\u53d1\u73b0\u4e86\u4ec0\u4e48\u95ee\u9898? \u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837? \u601d\u8003\u4e00\u4e0b, \u7b54\u6848\u4f1a\u5728\u4e0b\u4e00\u9636\u6bb5\u63ed\u6653!</p> <p></p> <p>\u8f93\u51fa\u6253\u5370\u770b\u770b\u5404\u4e2a\u7528\u6237\u7a0b\u5e8f\u7684\u6808\u4f4d\u7f6e\uff08\u8fd9\u4e2a\u6211\u8fd8\u6ca1\u6709\u5b9e\u73b0 <code>printf</code> \u66f4\u591a\u7684\u683c\u5f0f\u5316\u5b57\u7b26\uff0c\u53ea\u80fd\u7528<code>%d</code> <code>%s</code> \u5148\uff09\u8f6c\u6362\u4e00\u4e0b\uff1a</p> <pre><code>name: /bin/hello  entry: 83004D40 stack.start: 87ff 8000, stack.end: 8800 0000\nname: /bin/pal    entry: 83041BD0 stack.start: 87ff 8000, stack.end: 8800 0000\n</code></pre> <p>\u53ef\u4ee5\u731c\u6d4b\u5e94\u8be5\u662f\u5171\u7528\u540c\u4e00\u4e2a\u7528\u6237\u6808\u7684\u95ee\u9898\uff0c\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u5e94\u8be5\u6709\u5404\u81ea\u7684\u6808\u624d\u5bf9\u3002\u6216\u8bb8\u662f\u6211\u4e0a\u9762\u5b9e\u73b0\u7684\u6709\u95ee\u9898\uff1f</p> <p>\u5e94\u8be5\u4e0d\u662f\uff0c\u770b\u8bb2\u4e49\uff1a\u76ee\u524d\u6211\u4eec\u628a <code>heap.end</code> \u4f5c\u4e3a\u7528\u6237\u8fdb\u7a0b\u7684\u6808\u9876\uff0c\u4e5f\u5c31\u662f\u4e24\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5171\u540c\u4f7f\u7528\u4ece\u8fd9\u91cc\u5f00\u59cb\u7684\u6808\u7a7a\u95f4\u3002</p> <p>\u4e0b\u9762\u518d\u56de\u770b\u4e00\u4e9b AM \u7684\u4ee3\u7801:</p> <pre><code>...\nLDFLAGS   += -T $(AM_HOME)/scripts/linker.ld \\\n             --defsym=_pmem_start=0x80000000 --defsym=_entry_offset=0x0\n...\n//abstract-machine/scripts/platform/nemu.mk\n</code></pre> <pre><code>...\n_stack_top = ALIGN(0x1000);\n. = _stack_top + 0x8000;\n_stack_pointer = .;\nend = .;\n_end = .;\n_heap_start = ALIGN(0x1000);\n...\n//abstract-machine/scripts/linker.ld\n</code></pre> <pre><code>...\nCONFIG_MSIZE=0x8000000\n...\n//nemu/include/config/auto.conf\n</code></pre> <p>\u914d\u5408 AM \u7684\u5185\u5bb9\u548c\u6211\u4eec\u5728 PA \u5f00\u59cb\u7684\u65f6\u5019\u770b\u5230\u7684\uff0c\u7ed9 NEMU \u5212\u5206\u7684\u7a7a\u95f4\uff1a<code>0x8000 0000 ~ 0x87ff ffff</code> \u4e0a\u9762\u7684\u7528\u6237\u6808\u6808\u9876\u521a\u597d\u5c31\u662f <code>8800 0000</code> \uff08\u6ce8\u610f\u6808\u9876\u7684\u6808\u5e95\u3001\u6808\u7684\u5f00\u59cb\u548c\u7ed3\u675f \u7684\u533a\u522b\uff09\u3002</p> <p>\u6211\u4eec\u4e0a\u9762\u5b9e\u73b0\u7684\u7528\u6237\u6808\u7a7a\u95f4\u5927\u5c0f\u4e5f\u5c31\u662f <code>STACK_SIZE</code>\uff0c\u6070\u597d\u5c31\u662f 32 KB \u4e5f\u5c31\u662f 0x8000\u3002</p> <pre><code>#STACK_SIZE (8 * PGSIZE)\n#define PGSIZE 4096\n</code></pre> <p>\u53e6\u5916\uff0c\u65e2\u7136\u662f\u4e00\u4e2a\u5e94\u7528\u53ef\u4ee5\u6709\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u6808\u7a7a\u95f4\uff1f\u8fd9\u4e00\u4e2a\u5e94\u7528\u4e4b\u95f4\u7684\u4e0d\u540c\u8fdb\u7a0b\u600e\u4e48\u901a\u4fe1\uff1fIPC\u673a\u5236\uff1f</p> <p>\u4f46\u662f\u5177\u4f53\u5171\u7528\u4e86\u4ec0\u4e48\uff1f\u7528\u6237\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u4ece <code>_start</code> \u5f80\u540e\u7684\u51fd\u6570\u6808\u5e27\u7b49\u7b49\u5185\u5bb9\uff1f\uff1f</p> <p>\u7b49\u7b49\uff0c\u65e2\u7136\u8fd9\u4e9b\u90fd\u662f\u5171\u4eab\u7684\uff0c\u90a3\u5e94\u8be5\u7528\u6237\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u5e94\u8be5\u4e5f\u662f\u5171\u4eab\u7684\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u4e2a\u7528\u6237\u8fdb\u7a0b\u4f1a\u8986\u76d6\u7b2c\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u7684\u5185\u5bb9\uff1f</p> <p>\u54e6\uff0c\u9700\u8981\u7528\u5230\u865a\u62df\u5730\u5740\uff1f\u5bf9\u5185\u5b58\u8fdb\u884c\u7ba1\u7406\uff1f</p> <p>\u4e24\u4e2a\u8fdb\u7a0b\u5206\u914d\u540c\u6837\u7684\u865a\u62df\u5730\u5740\uff0c\u4f46\u662f\u7269\u7406\u5730\u5740\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_8","title":"\u7528\u6237\u8fdb\u7a0b\u7684\u53c2\u6570","text":"<ol> <li> <p>\u7ed9\u7528\u6237\u8fdb\u7a0b\u4f20\u9012\u53c2\u6570</p> <p>\u5173\u4e8e <code>argc</code> / <code>argv</code> / <code>envp</code> \u7684\u5185\u5bb9\u5df2\u7ecf\u770b\u8fc7\u5f88\u591a\u4e86\uff0c\u8fd9\u91cc\u7701\u7565\u3002</p> <p>\u5f53\u6211\u4eec\u5728\u7ec8\u7aef\u952e\u5165 </p> <pre><code>make ARCH=riscv32-nemu run\n</code></pre> <p><code>ARCH=riscv32-nemu</code> \u548c <code>run</code> \u8fd9\u4e24\u4e2a\u53c2\u6570\u4ee5\u53ca\u73af\u5883\u53d8\u91cf\u90fd\u662f\u600e\u4e48\u4f20\u9012\u7ed9 <code>make</code> \u7a0b\u5e8f\u7684 <code>main()</code> \u51fd\u6570\u7684\u5462?</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5b9e\u9645\u4e0a\u5728 PA2 \u7684\u65f6\u5019\uff0c\u65e0\u804a\u7ffb make \u7684\u624b\u518c\u5df2\u7ecf\u77e5\u9053\u4e2a\u5927\u6982\u4e86\u3002</p> <p>\u65e2\u7136\u7528\u6237\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf\u6765\u521b\u5efa\u7684\uff0c\u5f88\u81ea\u7136\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf\u7684\u4f20\u9012\u5c31\u9700\u8981\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u8d1f\u8d23\u3002</p> <p>\u6700\u9002\u5408\u5b58\u653e\u53c2\u6570\u548c\u73af\u5883\u53d8\u91cf\u7684\u5730\u65b9\u5c31\u662f\u7528\u6237\u6808\u4e86\uff0c\u56e0\u4e3a\u5728\u9996\u6b21\u5207\u6362\u5230\u7528\u6237\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u7528\u6237\u6808\u4e0a\u7684\u5185\u5bb9\u5c31\u5df2\u7ecf\u53ef\u4ee5\u88ab\u7528\u6237\u8fdb\u7a0b\u8bbf\u95ee\u3002\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u5728\u52a0\u8f7d\u7528\u6237\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u8d1f\u8d23\u628a <code>argc/argv/envp</code> \u4ee5\u53ca\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u653e\u5728\u7528\u6237\u6808\u4e2d\uff0c\u5e76\u628a\u5b83\u4eec\u7684\u5b58\u653e\u65b9\u5f0f\u548c\u4f4d\u7f6e\u4f5c\u4e3a\u548c\u7528\u6237\u8fdb\u7a0b\u7684\u7ea6\u5b9a\u4e4b\u4e00\uff0c\u8fd9\u6837\u7528\u6237\u8fdb\u7a0b\u5728 <code>_start</code> \u4e2d\u5c31\u53ef\u4ee5\u6839\u636e\u7ea6\u5b9a\u8bbf\u95ee\u5b83\u4eec\u4e86\u3002</p> <p>\u8fd9\u9879\u7ea6\u5b9a\u5176\u5b9e\u5c5e\u4e8eABI\u7684\u5185\u5bb9\uff0cABI\u624b\u518c\u6709\u4e00\u8282 Process Initialization \u7684\u5185\u5bb9\uff0c\u91cc\u9762\u8be6\u7ec6\u7ea6\u5b9a\u4e86\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e3a\u7528\u6237\u8fdb\u7a0b\u7684\u521d\u59cb\u5316\u63d0\u4f9b\u54ea\u4e9b\u4fe1\u606f\u3002\u4e0d\u8fc7 Project-N \u7cfb\u7edf\u91cc\u9762\u53ea\u9700\u8981\u4e00\u4e2a\u7b80\u5316\u7248\u7684 Process Initialization \u5c31\u591f\u4e86\uff1a \u64cd\u4f5c\u7cfb\u7edf\u5c06 <code>argc/argv/envp</code> \u53ca\u5176\u76f8\u5173\u5185\u5bb9\u653e\u7f6e\u5230\u7528\u6237\u6808\u4e0a\uff0c\u7136\u540e\u5c06 <code>GPRx</code> \u8bbe\u7f6e\u4e3a <code>argc</code> \u6240\u5728\u7684\u5730\u5740\u3002</p> <pre><code>|               |\n+---------------+ &lt;---- ustack.end\n|  Unspecified  |\n+---------------+\n|               | &lt;----------+\n|    string     | &lt;--------+ |\n|     area      | &lt;------+ | |\n|               | &lt;----+ | | |\n|               | &lt;--+ | | | |\n+---------------+    | | | | |\n|  Unspecified  |    | | | | |\n+---------------+    | | | | |\n|     NULL      |    | | | | |\n+---------------+    | | | | |\n|    ......     |    | | | | |\n+---------------+    | | | | |\n|    envp[1]    | ---+ | | | |\n+---------------+      | | | |\n|    envp[0]    | -----+ | | |\n+---------------+        | | |\n|     NULL      |        | | |\n+---------------+        | | |\n| argv[argc-1]  | -------+ | |\n+---------------+          | |\n|    ......     |          | |\n+---------------+          | |\n|    argv[1]    | ---------+ |\n+---------------+            |\n|    argv[0]    | -----------+\n+---------------+\n|      argc     |\n+---------------+ &lt;---- cp-&gt;GPRx\n|               |\n</code></pre> <p>\u4e0a\u56fe\u628a\u8fd9\u4e9b\u53c2\u6570\u5206\u6210\u4e24\u90e8\u5206, \u4e00\u90e8\u5206\u662f\u5b57\u7b26\u4e32\u533a\u57df(string area)\uff0c\u53e6\u4e00\u90e8\u5206\u662f<code>argv/envp</code>\u8fd9\u4e24\u4e2a\u5b57\u7b26\u4e32\u6307\u9488\u6570\u7ec4, \u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6307\u9488, \u800c\u8fd9\u4e9b\u5b57\u7b26\u4e32\u6307\u9488\u90fd\u4f1a\u6307\u5411\u5b57\u7b26\u4e32\u533a\u57df\u4e2d\u7684\u67d0\u4e2a\u5b57\u7b26\u4e32. \u6b64\u5916, \u4e0a\u56fe\u4e2d\u7684<code>Unspecified</code>\u8868\u793a\u4e00\u6bb5\u4efb\u610f\u957f\u5ea6(\u4e5f\u53ef\u4e3a0)\u7684\u95f4\u9694, \u5b57\u7b26\u4e32\u533a\u57df\u4e2d\u5404\u4e2a\u5b57\u7b26\u4e32\u7684\u987a\u5e8f\u4e5f\u4e0d\u4f5c\u8981\u6c42, \u53ea\u8981\u7528\u6237\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7<code>argv/envp</code>\u8bbf\u95ee\u5230\u6b63\u786e\u7684\u5b57\u7b26\u4e32\u5373\u53ef. \u8fd9\u4e9b\u53c2\u6570\u7684\u653e\u7f6e\u683c\u5f0f\u4e0eABI\u624b\u518c\u4e2d\u7684\u63cf\u8ff0\u975e\u5e38\u7c7b\u4f3c, \u4f60\u4e5f\u53ef\u4ee5\u53c2\u8003ICS\u8bfe\u672c\u7b2c\u4e03\u7ae0\u7684\u67d0\u4e2a\u56fe\u3002 </p> <ol> <li>\u83b7\u53d6 <code>envp</code>\u3001<code>argv</code> \u7684\u5143\u7d20\u4e2a\u6570\uff0c\u5206\u914d\u597d\u6307\u9488\u6570\u7ec4\u7684\u7a7a\u95f4\uff0c\u5206\u914d\u597d\u6307\u9488\u6570\u7ec4\u4e2d\u5b58\u7684\u5b57\u7b26\u4e32\u6307\u9488\u7684\u7a7a\u95f4\uff08\u6ce8\u610f\u5bf9\u9f50\uff09\u3002</li> <li>\u5c06\u5b57\u7b26\u4e32\u653e\u5230\u7528\u6237\u6808\u5408\u9002\u7684\u5730\u65b9\u3002\uff08\u53c2\u8003 ABI\u624b\u518c\u7684\u90e8\u5206\uff09</li> </ol> <p>\u7136\u540e\uff0c\u6839\u636e\u8fd9\u4e00\u7ea6\u5b9a\uff0c\u4fee\u6539Navy\u4e2d <code>_start</code> \u7684\u4ee3\u7801\uff0c\u628a <code>argc</code> \u7684\u5730\u5740\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 <code>call_main()</code> \u3002\u7136\u540e\u4fee\u6539 <code>call_main()</code> \u7684\u4ee3\u7801, \u8ba9\u5b83\u89e3\u6790\u51fa\u771f\u6b63\u7684 <code>argc/argv/envp</code> , \u5e76\u8c03\u7528 <code>main()</code>\u3002\u8fd9\u6837\u4ee5\u540e\uff0c\u7528\u6237\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u63a5\u6536\u5230\u5c5e\u4e8e\u5b83\u7684\u53c2\u6570\u4e86\u3002</p> <ul> <li> <p>\u91cd\u8981\u9605\u8bfb</p> <p>\u9605\u8bfbABI\u624b\u518c, \u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf</p> <p>\u4e8b\u5b9e\u4e0a, ABI\u624b\u518c\u662fISA, OS, \u7f16\u8bd1\u5668, \u8fd0\u884c\u65f6\u73af\u5883, C\u8bed\u8a00\u548c\u7528\u6237\u8fdb\u7a0b\u7684\u6865\u6881, \u975e\u5e38\u503c\u5f97\u5927\u5bb6\u53bb\u9605\u8bfb. </p> <p>ICS\u8bfe\u672c\u4e0a\u90a3\u4e9b\u8ba9\u4f60\u6478\u4e0d\u7740\u5934\u8111\u7684\u7ea6\u5b9a, \u5927\u90e8\u5206\u4e5f\u662f\u51fa\u81eaABI\u624b\u518c. Linux\u4e0a\u9075\u5b88\u7684ABI\u662fSystem V ABI, \u5b83\u53c8\u5206\u4e3a\u4e24\u90e8\u5206:</p> <ul> <li>\u4e00\u90e8\u5206\u662f\u548c\u5904\u7406\u5668\u65e0\u5173\u7684generic ABI(gABI), \u4f8b\u5982ELF\u683c\u5f0f, \u52a8\u6001\u8fde\u63a5, \u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784\u7b49; </li> <li>\u53e6\u4e00\u90e8\u5206\u662f\u548c\u5904\u7406\u5668\u76f8\u5173\u7684processor specific ABI(psABI), \u4f8b\u5982\u8c03\u7528\u7ea6\u5b9a, \u64cd\u4f5c\u7cfb\u7edf\u63a5\u53e3, \u7a0b\u5e8f\u52a0\u8f7d\u7b49. </li> </ul> <p>\u4f60\u81f3\u5c11\u4e5f\u5e94\u8be5\u53bb\u770b\u770bABI\u624b\u518c\u7684\u76ee\u5f55, \u7ffb\u4e00\u4e0b\u6b63\u6587\u90e8\u5206\u7684\u56fe, \u8fd9\u6837\u4f60\u5c31\u4f1a\u5bf9ABI\u624b\u518c\u6709\u4e00\u4e2a\u5927\u81f4\u7684\u4e86\u89e3. \u5982\u679c\u4f60\u613f\u610f\u6df1\u5165\u63a8\u6572\u4e00\u4e0b\"\u4e3a\u4ec0\u4e48\u8fd9\u6837\u7ea6\u5b9a\", \u90a3\u5c31\u662f\u771f\u6b63\u7684\"\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e86\".</p> </li> </ul> <p>\u672c\u8282\u9047\u5230\u7684\u5404\u79cd\u95ee\u9898</p> <p>\u5927\u90e8\u5206\u90fd\u662f\u81ea\u5df1\u57fa\u7840\u4e0d\u884c\uff0c\u81ea\u5df1\u7ed9\u81ea\u5df1\u57cb\u96f7\u4e86...</p> <ol> <li> <p><code>strlen</code> \u3001<code>strcpy</code> \u7684\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u90fd\u8981\u53d8\u6210\u76f4\u63a5\u5224\u65ad <code>NULL</code> \u5462\uff1f\u4e0d\u80fd\u76f4\u63a5\u89e3\u5f15\u7528\u5224\u65ad\u662f\u4e0d\u662f\u7b49\u4e8e \u7a7a\u5b57\u7b26\uff1f </p> <p>\u66f4\u65b0\uff0c\u73b0\u5728\u53c8\u53d8\u56de\u4e4b\u524d\u7684\uff0c\u5224\u65ad\u7a7a\u5b57\u7b26\u7684\u7248\u672c\u4e86\uff1fbug...</p> </li> <li> <p><code>call_main</code>  \u7684\u95ee\u9898</p> <pre><code>void call_main(uintptr_t *args) {\n    uintptr_t *base = args;\n    int argc = *((int *)base);\n    base++;\n\n    char **argv = (char **)base;\n    base += (argc + 1);\n\n    char **envp = (char **)base;                                                                                               \n    environ = envp;\n    exit(main(argc, argv, envp));\n    assert(0);\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u8981\u7528\u4e8c\u7ea7\u6307\u9488\u8868\u793a\uff0c\u76f4\u63a5\u7528\u6307\u9488\u6570\u7ec4\u8868\u793a\u4e0d\u884c\uff1f</p> </li> <li> <p>\u83ab\u540d\u5176\u5999\u7684bug\uff1a</p> <p></p> <p>\u7a81\u7136\u5c31\u8bfb\u53d6\u4e0d\u5230 \u5c4f\u5e55\u7684\u5927\u5c0f\u4e86\u3002</p> <p>\u4e00\u6b65\u6b65\u6eaf\u6e90\uff0c<code>sprintf</code> \u51fa\u95ee\u9898\u4e86\u3002</p> <p>\u61d2\u5f97\u67e5\u4e86\uff0c\u5728 <code>github</code> \u4e0a\u627e\u4e86\u4e00\u4e2a\u4f6c\u7684\u5b9e\u73b0\uff0c\u521a\u597d\u548c\u81ea\u5df1\u4e4b\u524d\u7684\u60f3\u6cd5\u7c7b\u4f3c\uff0c\u505a\u4e00\u4e2a\u901a\u7528\u7684\u8f93\u51fa\u51fd\u6570\uff0c\u4f46\u540e <code>printf</code>  \u5bb6\u65cf\u7684\u5404\u4e2a\u51fd\u6570\u8c03\u7528\u5b83\uff1a\u6211\u914d\u5408 GPT \u6284\u4e86\u4e00\u4e2a\u81ea\u5df1\u7684\u7248\u672c\u3002</p> <pre><code>typedef void (*putter_t)(char ch, void *buf, size_t idx, size_t maxlen);\n\nstatic void putter_out_(char ch, void *buf, size_t idx, size_t maxlen) {\n  (void)buf;\n  (void)idx;\n  (void)maxlen;\n  if (ch) {\n    putch(ch);\n  }\n}\n\nstatic void putter_buf_(char ch, void *buf, size_t idx, size_t maxlen) {\n  if (idx &lt; maxlen) {\n    ((char *)buf)[idx] = ch;\n  }\n}\n\nstatic void reverse_(char *str, int length) {\n  int start = 0;\n  int end = length - 1;\n  while (start &lt; end) {\n    str[start] ^= str[end];\n    str[end] ^= str[start];\n    str[start] ^= str[end];\n    end--;\n    start++;\n  }\n}\n\nstatic void put_literal_(putter_t put, void *buf, const char *str, size_t *p_idx, size_t maxlen) {\n  while (*str != '\\0') {\n    put(*str, buf, *p_idx, maxlen);\n    str++;\n    (*p_idx)++;\n  }\n}\n\nstatic void\nitoa_(putter_t put, char *buf, int num, int base, size_t *p_idx, size_t maxlen, int zpad_width) {\n  bool is_neg = false;\n  static char str[32] = {0};\n  size_t idx = 0;\n  zpad_width = zpad_width &lt;= 0 ? 1 : zpad_width;\n  if (num &lt; 0 &amp;&amp; base == 10) {\n    is_neg = true;\n    num = -num;\n  }\n  while (num != 0) {\n    int rem = num % base;\n    str[idx++] = (rem &gt; 9) ? (rem - 10) + 'a' : rem + '0';\n    num /= base;\n  }\n  while (idx &lt; zpad_width - (is_neg ? 1 : 0)) {\n    str[idx++] = '0';\n  }\n  if (is_neg) {\n    str[idx++] = '-';\n  }\n  reverse_(str, idx);\n  for (size_t i = 0; i &lt; idx; i++) {\n    put(str[i], buf, (*p_idx)++, maxlen);\n  }\n}\n\nstatic void utoa_(putter_t put,\n                  char *buf,\n                  unsigned int num,\n                  int base,\n                  size_t *p_idx,\n                  size_t maxlen,\n                  int zpad_width) {\n  static char str[32] = {0};\n  size_t idx = 0;\n  zpad_width = zpad_width &lt;= 0 ? 1 : zpad_width;\n  while (num != 0) {\n    unsigned int rem = num % base;\n    str[idx++] = (rem &gt; 9) ? (rem - 10) + 'a' : rem + '0';\n    num /= base;\n  }\n  while (idx &lt; zpad_width) {\n    str[idx++] = '0';\n  }\n  reverse_(str, idx);\n  for (size_t i = 0; i &lt; idx; i++) {\n    put(str[i], buf, (*p_idx)++, maxlen);\n  }\n}\n\nstatic int vsnprintf_(putter_t put, char *buf, const size_t maxlen, const char *fmt, va_list ap) {\n  size_t idx = 0;\n\n  while (*fmt != '\\0') {\n    if (*fmt != '%') {\n      put(*fmt, buf, idx++, maxlen);\n      fmt++;\n      continue;\n    }\n    fmt++;\n\n    int zpad_width = 0;\n\n    switch (*fmt) {\n      case '0':\n        zpad_width = atoi(++fmt);\n        while (*fmt &gt;= '0' &amp;&amp; *fmt &lt;= '9') {\n          fmt++;\n        }\n        break;\n      default: break;\n    }\n\n    switch (*fmt) {\n      case 's': {\n        char *p = va_arg(ap, char *);\n        while (*p != '\\0') {\n          put(*(p++), buf, idx++, maxlen);\n        }vb\n        fmt++;\n        break;\n      }\n      case 'd': {\n        int x = va_arg(ap, int);\n        itoa_(put, buf, x, 10, &amp;idx, maxlen, zpad_width);\n        fmt++;\n        break;\n      }\n      case 'u': {\n        unsigned int u = va_arg(ap, unsigned int);\n        utoa_(put, buf, u, 10, &amp;idx, maxlen, zpad_width);\n        fmt++;\n        break;\n      }\n      case 'x': {\n        unsigned int u = va_arg(ap, unsigned int);\n        utoa_(put, buf, u, 16, &amp;idx, maxlen, zpad_width);\n        fmt++;\n        break;\n      }\n      case 'p': {\n        uintptr_t u = va_arg(ap, uintptr_t);\n        if (u == (uintptr_t)NULL) {\n          put_literal_(put, buf, \"(null)\", &amp;idx, maxlen);\n        } else {\n          put_literal_(put, buf, \"0x\", &amp;idx, maxlen);\n          utoa_(put, buf, u, 16, &amp;idx, maxlen, zpad_width);\n        }\n        fmt++;\n        break;\n      }\n      case 'c': {\n        char ch = (char)va_arg(ap, int);\n        put(ch, buf, idx++, maxlen);\n        fmt++;\n        break;\n      }\n      default: {\n        put(*fmt, buf, idx++, maxlen);\n        fmt++;\n        break;\n      }\n    }\n  }\n\n  put(0, buf, idx &lt; maxlen ? idx : maxlen - 1, maxlen);\n  return (int)idx;\n}\n\nint vsnprintf(char *out, size_t n, const char *fmt, va_list ap) {\n  return vsnprintf_(putter_buf_, out, n, fmt, ap);\n}\n\nint snprintf(char *out, size_t n, const char *fmt, ...) {\n  va_list args;\n  va_start(args, fmt);\n  int result = vsnprintf(out, n, fmt, args);\n  va_end(args);\n  return result;\n}\n\nint vsprintf(char *out, const char *fmt, va_list ap) {\n  return vsnprintf(out, (size_t)-1, fmt, ap);\n}\n\nint sprintf(char *out, const char *fmt, ...) {\n  va_list args;\n  va_start(args, fmt);\n  int result = vsprintf(out, fmt, args);\n  va_end(args);\n  return result;\n}\n\nint printf(const char *fmt, ...) {\n  va_list args;\n  va_start(args, fmt);\n  char buf[1];\n  int result = vsnprintf_(putter_out_, buf, (size_t)-1, fmt, args);\n  va_end(args);\n  return result;\n}\n\nint putchar(int ch) {\n  putch((char)ch);\n  return ch;\n}\n\n#endif\n</code></pre> </li> <li> <p>\u4e8c\u7ea7\u6307\u9488</p> <pre><code>while (envp != NULL &amp;&amp; envp[envpc] != NULL) envpc++; \nwhile (argv != NULL &amp;&amp; argv[argc] != NULL) argc++;    \n</code></pre> <p>\u4e3a\u4ec0\u4e48\u6761\u4ef6\u53ea\u6709 <code>argv[argc] != NULL</code> \u7684\u65f6\u5019\u4e0d\u884c\uff1f\u5fc5\u987b\u8981\u5148\u5224\u65ad <code>argv</code> \u548c <code>envp</code> \uff1f </p> </li> <li> <p>\u5173\u4e8e\u7528\u6237\u6808\u548c\u5185\u6838\u6808</p> <p>\u5728\u51fd\u6570\u6700\u5f00\u59cb\u90a3\u91cc\uff0c\u6211\u4eec\u7528\u7684\u5230\u5e95\u662f\u5185\u6838\u6808\u8fd8\u662f\u7528\u6237\u6808\uff1f</p> <p>\u5185\u6838\u6808\uff01</p> </li> </ol> <p>\u8fd9\u90e8\u5206\u7684\u5185\u5bb9\u4f5c\u4e3a\u6307\u9488\u7684\u7ec3\u4e60\u662f\u771f\u7684\u4e0d\u9519\uff0c\u5404\u79cd\u6307\u9488\u6ee1\u5929\u98de\uff0c\u5f3a\u8f6cNULL\u3001\u4e8c\u7ea7\u6307\u9488\uff0c\u6307\u9488\u8fd0\u7b97\u7b49\u7b49\u90fd\u6709\u5404\u79cd\u95ee\u9898\u3002\u8fd8\u662f\u56de\u53bb\u770b\u770b\u8d44\u6599\u590d\u4e60</p> </li> <li> <p>\u8ba9\u7528\u6237\u6765\u51b3\u5b9a\u7528\u6237\u8fdb\u7a0b\u7684\u53c2\u6570\uff1a\u5b9e\u73b0\u5e26\u53c2\u6570\u7684execve()</p> <p>\u6211\u4eec\u9700\u8981\u628a\u7528\u6237\u6307\u5b9a\u7684\u53c2\u6570\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u6765\u628a\u6307\u5b9a\u7684\u53c2\u6570\u653e\u5230\u65b0\u8fdb\u7a0b\u7684\u7528\u6237\u6808\u91cc\u9762\u3002</p> <p>\u5177\u4f53\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528 <code>SYS_execve</code></p> <pre><code>int execve(const char *filename, char *const argv[], char *const envp[]);\n</code></pre> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e3a\u4ec0\u4e48\u5c11\u4e86\u4e00\u4e2aconst?</p> <p>\u5728<code>main()</code>\u51fd\u6570\u4e2d, <code>argv</code>\u548c<code>envp</code>\u7684\u7c7b\u578b\u662f<code>char * []</code>, \u800c\u5728<code>execve()</code>\u51fd\u6570\u4e2d, \u5b83\u4eec\u7684\u7c7b\u578b\u5219\u662f<code>char *const []</code>. \u4ece\u8fd9\u4e00\u5dee\u5f02\u6765\u770b, <code>main()</code>\u51fd\u6570\u4e2d<code>argv</code>\u548c<code>envp</code>\u6240\u6307\u5411\u7684\u5b57\u7b26\u4e32\u662f\u53ef\u5199\u7684, \u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\u5417?</p> </li> </ul> <p>\u5b9e\u73b0\u5e26\u53c2\u6570\u7684execve()</p> <p>\u6839\u636e\u4e0a\u8ff0\u8bb2\u4e49\u5185\u5bb9, \u5b9e\u73b0\u5e26\u53c2\u6570\u7684<code>execve()</code>. \u6709\u4e00\u4e9b\u7ec6\u8282\u6211\u4eec\u5e76\u6ca1\u6709\u5b8c\u5168\u7ed9\u51fa, \u4f8b\u5982\u8c03\u7528<code>context_uload()</code>\u7684<code>pcb</code>\u53c2\u6570\u5e94\u8be5\u4f20\u5165\u4ec0\u4e48\u5185\u5bb9, \u8fd9\u4e2a\u95ee\u9898\u5c31\u4ea4\u7ed9\u4f60\u6765\u601d\u8003\u5427!</p> <p>\u5b9e\u73b0\u540e, \u8fd0\u884c\u4ee5\u4e0b\u7a0b\u5e8f:</p> <ul> <li>\u6d4b\u8bd5\u7a0b\u5e8f<code>navy-apps/tests/exec-test</code>, \u5b83\u4f1a\u4ee5\u53c2\u6570\u9012\u589e\u7684\u65b9\u5f0f\u4e0d\u65ad\u5730\u6267\u884c\u81ea\u8eab. \u4e0d\u8fc7\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u5b9e\u73b0\u5806\u533a\u5185\u5b58\u7684\u56de\u6536, <code>exec-test</code>\u5728\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e, <code>new_page()</code>\u5c31\u4f1a\u628a<code>0x3000000</code>/<code>0x83000000</code>\u9644\u8fd1\u7684\u5185\u5b58\u5206\u914d\u51fa\u53bb, \u5bfc\u81f4\u7528\u6237\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u88ab\u8986\u76d6. \u76ee\u524d\u6211\u4eec\u65e0\u6cd5\u4fee\u590d\u8fd9\u4e00\u95ee\u9898, \u4f60\u53ea\u9700\u8981\u770b\u5230<code>exec-test</code>\u53ef\u4ee5\u6b63\u786e\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u5373\u53ef.</li> <li>MENU\u5f00\u673a\u83dc\u5355.</li> <li>\u5b8c\u5584NTerm\u7684\u5167\u5efaShell, \u4f7f\u5f97\u5b83\u53ef\u4ee5\u89e3\u6790\u8f93\u5165\u7684\u53c2\u6570, \u5e76\u4f20\u9012\u7ed9\u542f\u52a8\u7684\u7a0b\u5e8f. \u4f8b\u5982\u53ef\u4ee5\u5728NTerm\u4e2d\u952e\u5165<code>pal --skip</code>\u6765\u8fd0\u884c\u4ed9\u5251\u5947\u4fa0\u4f20\u5e76\u8df3\u8fc7\u5546\u6807\u52a8\u753b.</li> </ul> <p>\u7b2c\u4e09\u4e2a \u53ef\u4ee5\u7528 <code>strtok</code> \u3002\u5176\u4ed6\u7684\u89c1\u4e0b\u6587\u4fee bug</p> <p>bug\u00a0\u8bb0\u5f55</p> <ol> <li> <p>\u5173\u4e8e <code>exec-test</code> \u4ee5\u53ca\u81ea\u5df1 <code>context_uload</code> \u5b9e\u73b0\u7684\u95ee\u9898\u3002</p> <p>\u8c03\u4e86\u4e00\u5929\u7684bug\uff1a\u8fd0\u884c <code>exec-test</code> \uff0c\u7528\u6237 <code>main</code> \u53ea\u80fd\u8c03\u7528\u521a\u5f00\u59cb\u7684\u90a3\u4e00\u6b21\uff0c\u4e5f\u5c31\u662f \u4ece <code>context_uload</code> \u8fdb\u7528\u6237\u51fd\u6570\u7684\u90a3\u4e00\u6b21\uff0c\u4e4b\u540e\u5e94\u7528\u7a0b\u5e8f\u540d\u83ab\u540d\u5176\u5999\u7684\u88ab\u541e\u4e86\uff0c\u6ca1\u6cd5\u4e0d\u65ad\u5730\u6267\u884c\u81ea\u8eab\u3002</p> <p>\u53d1\u73b0\u95ee\u9898\u5982\u4e0b\uff1a</p> <pre><code>void context_uload(PCB *pcb, const char *filename, char *const argv[], char *const envp[]) {\n    ...\n    uintptr_t *base = (uintptr_t *)ROUNDDOWN(new_user_stack - space_count, sizeof(uintptr_t));\n    uintptr_t *base_mem = base;\n    ...\n    char *string_area = (char *)base;\n    uintptr_t *string_base = (uintptr_t*)base;\n    char *tmp_argv[argc];\n    char *tmp_envp[envpc];\n    ...\n    for (int i = 0; i &lt; argc; i++) {\n        //strcpy(string_area, argv[i]);\n        strcpy((char *)string_area, (const char *)&amp;argv[i]);\n        //memcpy((void *)&amp;tmp_argv[i], (const void *)&amp;argv[i], sizeof(uintptr_t));\n        tmp_argv[i] = string_area;\n        string_area += strlen((argv[i]) + 1);\n    }\n    for (int i = 0; i &lt; envpc; i++) {\n        //strcpy(string_area, envp[i]);\n        strcpy((char *)string_area, (const char *)&amp;envp[i]);\n        //memcpy((void *)&amp;tmp_envp[i], (const void *)&amp;envp[i], sizeof(uintptr_t));\n        tmp_envp[i] = string_area;\n        string_area += strlen((envp[i]) + 1);\n    }\n    ...\n    base -= (argc + 1) + (envpc + 1);\n    for (int i = 0; i &lt; argc; i++, base++) {\n        *base = (uintptr_t)tmp_argv[i];\n    }\n    *base = (uintptr_t)NULL; // argv[argc] = NULL\n    base++;\n\n    for (int i = 0; i &lt; envpc; i++, base++) {\n        *base = (uintptr_t)tmp_envp[i];\n    }\n    *base = (uintptr_t)NULL; // argv[envpc] = NULL\n    base++;\n    ...\n}\n//loader.c\n</code></pre> <p>\u5b9e\u9645\u662f\u8fd9\u6761 <code>tmp_argv[i] = string_area;</code>  \u548c\u4e4b\u540e\u7684 <code>*base = (uintptr_t)tmp_argv[i];</code> \u5e94\u8be5\u662f\u76f4\u63a5\u62ff\u4f20\u8fdb\u6765\u7684 <code>argv</code> \u8d4b\u503c\u7684\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5b9e\u9645\u4e0a\u8fd8\u662f\u81ea\u5df1\u73a9\u4e0d 6 \u6307\u9488\uff0c\u6709\u5173\u4e8e\u6307\u9488\u8d4b\u503c\u7684\u95ee\u9898\u3002</p> <p><code>tmp_argv[i] = string_area;</code> \u8fd9\u884c\u4ee3\u7801\u5c06 <code>string_area</code> \u7684\u5730\u5740\u8d4b\u503c\u7ed9 <code>tmp_argv[i]</code>\u3002\u8fd9\u610f\u5473\u7740 <code>tmp_argv</code> \u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u6307\u5411 <code>string_area</code> \u6307\u5411\u7684\u5730\u5740\uff0c\u4e4b\u540e\uff0c\u540c\u6837\u7684\u8d4b\u503c\u64cd\u4f5c <code>*base = (uintptr_t)tmp_argv[i]</code>\uff0c\u5bfc\u81f4 \u4f20\u9012\u5e94\u7528\u7a0b\u5e8f\u53c2\u6570\u7684 \u7528\u6237\u6808\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f<code>argc</code>\u3001<code>envp</code> \u4e5f\u5c31\u662f\u6307\u9488\u4e5f\u5c31\u6307\u5411\u4e86  <code>string_area</code> \u8fd9\u90a3\u7247\u533a\u57df\u3002 </p> <p>\u95ee\u9898\u5728\u4e8e <code>string_area</code> \u6307\u5411\u7684\u662f\u4e00\u4e2a\u4e34\u65f6\u7684\u3001\u81ea\u52a8\u5206\u914d\u7684\u6808\u5185\u5b58\uff0c\u662f\u4e00\u4e2a\u6307\u5411\u6808\u4e0a\u4e34\u65f6\u7a7a\u95f4\u7684\u6307\u9488\u3002\u8fd9\u4e2a\u5185\u5b58\u4ec5\u5728 <code>context_uload</code> \u51fd\u6570\u7684\u4f5c\u7528\u57df\u5185\u6709\u6548\u3002\u5f53 <code>context_uload</code> \u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u8fd9\u4e2a\u6808\u5185\u5b58\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u51fd\u6570\u8c03\u7528\u91cd\u7528\uff0c\u5bfc\u81f4\u4e4b\u524d\u5b58\u50a8\u7684\u6307\u9488\u5931\u6548\uff0c\u5373\u51fa\u73b0\u6240\u8c13\u7684\u201c\u60ac\u6302\u6307\u9488\u201d\uff08dangling pointer\uff09\u3002</p> <p>GPT\uff1a</p> <ol> <li>\u6808\u5185\u5b58\u5206\u914d\uff1a \u5728 C \u8bed\u8a00\u4e2d\uff0c\u5c40\u90e8\u53d8\u91cf\u901a\u5e38\u5b58\u50a8\u5728\u6808\u4e0a\u3002\u5f53\u4e00\u4e2a\u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u5b83\u7684\u5c40\u90e8\u53d8\u91cf\u88ab\u5206\u914d\u5728\u8c03\u7528\u8005\u7684\u6808\u5e27\u4e2d\u3002\u5f53\u51fd\u6570\u8fd4\u56de\u65f6\uff0c\u8fd9\u4e9b\u5c40\u90e8\u53d8\u91cf\u7684\u751f\u547d\u5468\u671f\u7ed3\u675f\uff0c\u5b83\u4eec\u5360\u7528\u7684\u5185\u5b58\u53ef\u4ee5\u88ab\u91cd\u65b0\u4f7f\u7528\u3002</li> <li>\u60ac\u6302\u6307\u9488\uff1a \u5982\u679c\u51fd\u6570\u8fd4\u56de\u540e\uff0c\u8fd4\u56de\u503c\u6216\u8f93\u51fa\u53c2\u6570\u5305\u542b\u4e86\u6307\u5411\u5c40\u90e8\u53d8\u91cf\u7684\u6307\u9488\uff0c\u8fd9\u4e9b\u6307\u9488\u5c31\u53d8\u6210\u4e86\u60ac\u6302\u6307\u9488\u3002\u5b83\u4eec\u6307\u5411\u7684\u5185\u5b58\u53ef\u80fd\u5df2\u7ecf\u88ab\u5176\u4ed6\u6570\u636e\u8986\u76d6\uff0c\u56e0\u6b64\u89e3\u5f15\u7528\u8fd9\u4e9b\u6307\u9488\u5c06\u5bfc\u81f4\u672a\u5b9a\u4e49\u884c\u4e3a\u3002</li> <li>\u6307\u9488\u7684\u751f\u547d\u5468\u671f\uff1a \u6307\u9488\u7684\u751f\u547d\u5468\u671f\u5e94\u8be5\u4e0e\u5b83\u6240\u6307\u5411\u7684\u6570\u636e\u7684\u751f\u547d\u5468\u671f\u4e00\u81f4\u3002\u5982\u679c\u6570\u636e\u7684\u751f\u547d\u5468\u671f\u7ed3\u675f\uff08\u4f8b\u5982\uff0c\u5c40\u90e8\u53d8\u91cf\u8d85\u51fa\u4f5c\u7528\u57df\uff09\uff0c\u90a3\u4e48\u6307\u9488\u4e5f\u5e94\u8be5\u505c\u6b62\u4f7f\u7528\u3002</li> </ol> <p>\u4e3a\u4e86\u907f\u514d\u60ac\u6302\u6307\u9488\u95ee\u9898\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528\u5177\u6709\u9002\u5f53\u751f\u547d\u5468\u671f\u548c\u4f5c\u7528\u57df\u7684\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u5b57\u7b26\u4e32\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u89c1\u7684\u65b9\u6cd5\uff1a</p> <ol> <li>\u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\uff1a    \u4f7f\u7528 <code>malloc</code>\u3001<code>calloc</code> \u6216 <code>realloc</code> \u7b49\u51fd\u6570\u4ece\u5806\u4e0a\u5206\u914d\u5185\u5b58\u3002\u8fd9\u6837\u5206\u914d\u7684\u5185\u5b58\u5728\u6ca1\u6709\u660e\u786e\u91ca\u653e\u4e4b\u524d\u4e00\u76f4\u6709\u6548\u3002</li> </ol> <pre><code>char *dynamic_string = malloc(strlen(some_string) + 1);\nif (dynamic_string != NULL) {\n    strcpy(dynamic_string, some_string);\n    // \u4f7f\u7528 dynamic_string...\n    free(dynamic_string); // \u8bb0\u5f97\u5728\u4f7f\u7528\u5b8c\u6bd5\u540e\u91ca\u653e\u5185\u5b58\n}\n</code></pre> <ol> <li>\u9759\u6001\u6216\u5168\u5c40\u5206\u914d\u7684\u5185\u5b58\uff1a    \u9759\u6001\u5206\u914d\u7684\u5185\u5b58\uff08\u4f8b\u5982\uff0c\u4f7f\u7528 <code>static</code> \u5173\u952e\u5b57\u58f0\u660e\u7684\u53d8\u91cf\uff09\u548c\u5168\u5c40\u5206\u914d\u7684\u5185\u5b58\u5728\u6574\u4e2a\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u5185\u90fd\u662f\u6709\u6548\u7684\u3002</li> </ol> <pre><code>static char global_string[100];\nsnprintf(global_string, sizeof(global_string), \"%s\", some_string);\n// \u4f7f\u7528 global_string...\n</code></pre> <ol> <li>\u6808\u5206\u914d\u7684\u5185\u5b58\uff08\u8c28\u614e\u4f7f\u7528\uff09\uff1a    \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4f60\u786e\u5b9a\u590d\u5236\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u8d85\u51fa\u5176\u751f\u547d\u5468\u671f\uff0c\u5e76\u4e14\u590d\u5236\u64cd\u4f5c\u662f\u5728\u51fd\u6570\u5185\u90e8\u5b8c\u6210\u7684\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6808\u5206\u914d\u7684\u5185\u5b58\u3002\u4f46\u662f\uff0c\u8fd9\u8981\u6c42\u4f60\u975e\u5e38\u5c0f\u5fc3\uff0c\u786e\u4fdd\u4e0d\u4f1a\u8fd4\u56de\u6307\u5411\u5c40\u90e8\u53d8\u91cf\u7684\u6307\u9488\u3002</li> </ol> <pre><code>void func() {\n    char stack_string[100];\n    snprintf(stack_string, sizeof(stack_string), \"%s\", some_string);\n    // \u4f7f\u7528 stack_string...\n    // \u6ce8\u610f\uff1a\u4e0d\u8981\u8fd4\u56de\u6307\u5411 stack_string \u7684\u6307\u9488\n}\n</code></pre> <ol> <li>\u4f7f\u7528\u6807\u51c6\u5e93\u63d0\u4f9b\u7684\u5bb9\u5668\uff1a    \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f C++\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 <code>std::string</code> \u6216\u5176\u4ed6\u6807\u51c6\u5e93\u5bb9\u5668\uff0c\u8fd9\u4e9b\u5bb9\u5668\u4f1a\u81ea\u52a8\u7ba1\u7406\u5185\u5b58\u3002</li> </ol> <pre><code>#include &lt;string&gt;\nstd::string my_string = some_string;\n// \u4f7f\u7528 my_string...\n</code></pre> <ol> <li> <p>\u5185\u5b58\u6c60\uff1a    \u5bf9\u4e8e\u9700\u8981\u9891\u7e41\u5206\u914d\u548c\u91ca\u653e\u5185\u5b58\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u4f7f\u7528\u5185\u5b58\u6c60\u6765\u5206\u914d\u5185\u5b58\u3002\u5185\u5b58\u6c60\u9884\u5148\u5206\u914d\u4e00\u5927\u5757\u5185\u5b58\uff0c\u5e76\u5728\u5176\u4e2d\u7ba1\u7406\u5c0f\u5757\u5185\u5b58\u7684\u5206\u914d\u548c\u91ca\u653e\u3002</p> </li> <li> <p>\u590d\u5236\u5230\u7531\u5176\u4ed6\u51fd\u6570\u6216\u6a21\u5757\u7ba1\u7406\u7684\u5185\u5b58\uff1a    \u5982\u679c\u6709\u4e00\u4e2a\u4e13\u95e8\u8d1f\u8d23\u5185\u5b58\u7ba1\u7406\u7684\u6a21\u5757\u6216\u51fd\u6570\uff0c\u4f60\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u590d\u5236\u5230\u90a3\u91cc\u5206\u914d\u7684\u5185\u5b58\u4e2d\uff0c\u5e76\u786e\u4fdd\u8be5\u6a21\u5757\u6216\u51fd\u6570\u5728\u5b57\u7b26\u4e32\u4f7f\u7528\u5b8c\u6bd5\u540e\u6b63\u786e\u91ca\u653e\u5185\u5b58\u3002</p> </li> </ol> <p>\u9009\u62e9\u54ea\u79cd\u65b9\u6cd5\u53d6\u51b3\u4e8e\u4f60\u7684\u5177\u4f53\u9700\u6c42\u548c\u4e0a\u4e0b\u6587\u3002\u91cd\u8981\u7684\u662f\u8981\u786e\u4fdd\u4f60\u590d\u5236\u7684\u5b57\u7b26\u4e32\u6216\u6570\u636e\u7684\u751f\u547d\u5468\u671f\u81f3\u5c11\u4e0e\u4f7f\u7528\u5b83\u4eec\u7684\u4ee3\u7801\u6bb5\u4e00\u6837\u957f\uff0c\u5e76\u4e14\u8981\u907f\u514d\u8fd4\u56de\u6307\u5411\u5c40\u90e8\u53d8\u91cf\u6216\u4e34\u65f6\u6570\u636e\u7ed3\u6784\u7684\u6307\u9488\u3002</p> <p>\u6240\u4ee5\uff0c\u5e94\u8be5\u4f7f\u7528\u51fd\u6570\u53c2\u6570 <code>argv[i]</code> \u8d4b\u503c\u7ed9 <code>tmp_argv[i]</code> \uff0c\u6216\u8005 <code>memcpy</code>\u3002</p> <p>\u4e0d\u8fc7\u53c8\u66b4\u9732\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u6211\u5c06 <code>string_area</code> \u6539\u6210\u7528\u5806\u3001 <code>static</code> \u7684\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u884c\uff1f</p> <p>\u90a3\u5c31\u5e94\u8be5\u770b\u66f4\u521d\u59cb\u7684 <code>base</code> \u6307\u9488\u4e86\uff0c\u4ed6\u4e5f\u662f\u4e34\u65f6\u53d8\u91cf\u3002\u786e\u5b9e\uff0c\u672c\u6765 <code>base</code> \u6307\u9488\u4f5c\u4e3a\u5c06\u7528\u6237\u53c2\u6570\u653e\u5230\u7528\u6237\u6808\u4e0a\u7684\u8f85\u52a9\u5b9e\u73b0\uff0c\u653e\u597d\u4e86\u4e4b\u540e\uff0c<code>base</code> \u6307\u9488\u5b9e\u9645\u4e0a\u4e5f\u6ca1\u6709\u4ec0\u4e48\u7528\u4e86\uff0c\u4e5f\u5c31\u56de\u6536\u4e86\u3002\u6240\u4ee5\uff0c\u5806\u7a7a\u95f4\u3001\u6570\u636e\u8282\u4e5f\u5c31\u6307\u5411\u4e86\u4e00\u7247\u6808\u7a7a\u95f4\u4e86\u3002\u4e00\u6837\u4f1a\u6709\u95ee\u9898\u3002</p> </li> <li> <p>\u8fd0\u884c <code>MENU</code> \u548c <code>nterm</code>\u7684 \u95ee\u9898</p> <ol> <li> <p>\u4f46\u662f\u73b0\u5728\u5230\u8fd0\u884c MENU \u548c NTerm \u5206\u522b \u542f\u52a8 pal\u53c8\u6709\u95ee\u9898\u4e86\uff0c\u4f3c\u4e4e\u540d\u5b57\u53c8\u4e0d\u89c1\u4e86\uff1f</p> <p>\u6709 bug\uff1a\u76f4\u63a5\u6572 <code>/bin/pal</code> \u4f1a\u62a5\u9519</p> <p></p> <p>\u4f46\u662f\u6572 <code>/bin/pal --skip</code> \u53c8\u662f\u53ef\u4ee5\u8fd0\u884c\u7684\uff0c\u4f46\u662f\u4e0d\u80fd\u8df3\u8fc7\u5546\u6807\u52a8\u753b\uff1f\uff1f\uff1f</p> <p></p> <p></p> <p>\u54e6\uff0c\u662f\u4e4b\u524d\u76f4\u63a5\u5728 <code>pal</code> <code>main</code> \u51fd\u6570\u5f00\u59cb \u5199\u7684\u8df3\u8fc7 <code>--skip</code> \u90a3\u4e2a\u65f6\u5019\u662f\u9488\u5bf9 <code>argv</code> \u76f4\u63a5\u4ece <code>context_uload</code> \u4f20\u9012\u7684\uff0c\u73b0\u5728\u662f\u4ece \u7528\u6237\u8fdb\u7a0b <code>menu</code> \u548c <code>nterm</code> \u4f20\u9012\u53c2\u6570\u7ed9\u65b0\u7684\u7528\u6237\u8fdb\u7a0b\u3002\u76f4\u63a5\u6539\u3002</p> <p>\u7136\u540e\u73b0\u5728\u7684\u95ee\u9898\u662f\u600e\u4e48\u4f20\u7ed9\u5b83\u89e3\u6790\u7684\u53c2\u6570\uff0c\u91cd\u65b0\u634b\u4e00\u904d\u7528\u6237\u8fdb\u7a0b\u7684\u3002</p> <p>\u8c03\u4e0d\u51fa\u6765\u3002\u3002\u3002\u627e\u4e0d\u5230\u3002\u3002\u3002</p> <p>\u73b0\u5728\u662f\u76f4\u63a5\u6ca1\u6709\u4e86\u3002\u3002\u3002\u3002</p> <p>\u5728 <code>loader</code> \u4e2d\u8c03\u7528 <code>fs_read</code> \u540e\uff0c\u6587\u4ef6\u540d\u76f4\u63a5\u6ca1\u6389\u4e86\uff1f\uff1f\uff1f</p> <p></p> <p></p> <p></p> <p>\u79bb\u8c31\u554a</p> <p>\u4f46\u662f\u4ed6\u53c8\u80fd\u627e\u5230 \u4ed9\u5251\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\uff1f\uff1f\uff1f\u80fd\u6b63\u786e\u627e\u5230</p> <p></p> <p></p> <p>\u7b49\u4e0b\uff0c\u8fd8\u662f\u6ca1\u6709\u8fdb\u5165\u4ed9\u5251\u7684\u3002</p> <p>\u5361\u5728\u4e86 \u8ba1\u7b97 argv\u7684\u957f\u5ea6 <code>strlen</code> \u7684\u5730\u65b9\uff0c\u800c\u4e14 <code>argv</code> \u7684\u5927\u5c0f\u975e\u5e38\u7684\u5927\uff1a166392 - 4 -4= 166388 \uff0c\u518d\u9664\u4ee5 4 = 41597\uff0c</p> <p>\u518d\u51cf\u6389 1 \u4e2a\u7ed3\u5c3e\uff0c\u4e3a 41596\u3002\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5927\uff1f</p> <p>\u518d\u66f4\u65b0\uff1a\u80fd\u8dd1\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u6ca1\u89e3\u51b3\u8fd9\u4e2a <code>argc</code> \u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5927\u7684\u539f\u56e0\u3002</p> <p>\u89e3\u51b3\uff1a</p> <p>\u6211\u5728 <code>new_page</code> \u5206\u914d\u7684\u65b0\u7a7a\u95f4\u662f\u6307\u5411\u9ad8\u5730\u5740\u7684\uff0c\u4e5f\u5c31\u662f\u5728 <code>context_uload</code> \u91cc\u64cd\u4f5c\u7684\u662f\u6808\u5e95\u4e86\u3002</p> <p>\u4e5f\u5c31\u662f\u6211\u6700\u540e\u4f1a\u51fa\u73b0 \u8986\u76d6\u5230\u4ee3\u7801\u6bb5\u7684\u60c5\u51b5\u3002</p> <p></p> <p>\u8fd8\u662f\u6ce8\u610f\u6808\u5e95\u6808\u9876\u3001\u9ad8\u4f4e\u5730\u5740\u3001stack_start/end \u7684\u533a\u522b\uff0c\u6211\u89c9\u5f97start\u3001end\u8fd9\u6837\u5b50\u5212\u5206\u4e0d\u592a\u597d\uff0c\u8fd8\u662f\u53ebbottom\u3002top\u597d\u4e86\u3002</p> <p>\u4e00\u5f00\u59cb\u6ca1\u8d77\u4f5c\u7528\uff0c\u53d1\u73b0\u662f <code>ramdisk</code> \u592a\u5927\u4e86\uff0c\u5bfc\u81f4\u5185\u6838\u6808\u7684\u5185\u5bb9\u90fd\u8986\u76d6\u5230\u7528\u6237\u7a7a\u95f4\u7684\u4ee3\u7801\u4e86\u3002</p> <p>\u51e0\u4e2a\u5c0f\u65f6\u518d\u770b\u3002\u53c8\u6709\u95ee\u9898\u4e86\uff0c\u4e3a\u4ec0\u4e48\u7528\u6237\u6808\u53c8\u53d8\u6210\u5728 0x83000000\u4e4b\u524d\u4e86\uff1f\uff1f\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u53c2\u6570</p> </li> </ol> </li> </ol> </li> </ol> <p>fs\u91cd\u5199\uff1a</p> <ol> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u6539\u7528\u8fd9\u4e2a\uff1a\u7528\u6307\u9488\u6307\u5411\u8fd9\u7247\u533a\u57df\uff0c\u7528const\u53ea\u8bfb\u3002\u826f\u597d\u7684\u7f16\u7a0b\u4e60\u60ef\u3002</p> <p>\u4f46\u662f\u5bf9\u4e8e\u76f4\u63a5\u4fee\u6539\u7684\u5730\u65b9\uff0c\u8fd8\u662f\u7528\u4ed6\u539f\u6765\u7684\u53d8\u91cf\u597d\u4e86\u3002\u5177\u4f53\u53c2\u8003 <code>fs_read, fs_write, fs_lseek</code> \u7684\u5b9e\u73b0\uff0c\u7528\u7684\u662f <code>finfo</code> \u6307\u9488 \u8fd8\u662f \u76f4\u63a5\u7528 <code>file_table</code> </p> </li> <li> <p>\u6ce8\u610f\u4e34\u65f6\u53d8\u91cf\u3001\u60ac\u6302\u6307\u9488</p> </li> <li> <p>\u6ce8\u610f\u6307\u9488\u7684\u8f6c\u5316</p> <pre><code>void call_main(uintptr_t *args) {  \n    uintptr_t *base = args;  \n    //32\u4f4d\u73af\u5883\n    int argc = *((int *)base);  \n    printf(\"base:%p\\n\", base);  \n    //base += sizeof(int); +16 = 4 * 4byte/\u6bcf\u6307\u9488\u52a01\n    base++ ;           //  +4 = 1 * 4vyte/\u6bcf\u6307\u9488\u52a01\n    printf(\"after base:%p\\n\", base);\n\n    char **argv = (char **)base;\n    base += (argc + 1);\n\n    char **envp = (char **)base;\n    environ = envp;\n\n    exit(main(argc, argv, envp));\n    assert(0);\n}\n</code></pre> <p>\u6539\u6210\u4e0b\u9762\u4e5f\u53ef\u4ee5\uff1a</p> <pre><code>void call_main(uintptr_t *args) { \n    //uintptr_t *base = args;\n    char *base = (char *)args;\n\n    int argc = *((int *)base);\n    printf(\"base:%p\\n\", base);\n    base += sizeof(int);\n    //base++ ;\n    printf(\"after base:%p\\n\", base);\n\n    char **argv = (char **)base;                     \n    base += sizeof(char *) * (argc + 1);\n\n    char **envp = (char **)base;\n    environ = envp;\n\n    exit(main(argc, argv, envp));\n    assert(0);\n}\n</code></pre> <p>\u603b\u7ed3\u4e00\u53e5\u8bdd\uff0c<code>intptr_t</code>\u3001<code>uintptr_r</code>\u53d8\u91cf\u7c7b\u578b\u7528\u4e8e\u8de8\u5e73\u53f0\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u540c\u673a\u5668\u5b57\u957f\uff0816\u4f4d\u300132\u4f4d\u300164\u4f4d\uff09\u6574\u6570\u4e0e\u6307\u9488\u76f8\u4e92\u8f6c\u79fb\u7684\u7684\u901a\u7528\u6027\u3002</p> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684\u60c5\u51b5\uff0c\u6211\u89c9\u5f97\u5e94\u8be5\u7528 <code>char*</code> \u6765\u4fdd\u8bc1\u53ef\u79fb\u690d\u6027\u3002</p> <p>\u4e2a\u4eba\u603b\u7ed3\uff1a</p> \u6570\u636e\u7c7b\u578b 16\u4f4d\u7f16\u8bd1\u5668 32\u4f4d\u7f16\u8bd1\u5668 64\u4f4d\u7f16\u8bd1\u5668 char 1\u5b57\u8282 1\u5b57\u8282 1\u5b57\u8282 char* (\u6307\u9488\u53d8\u91cf) 2\u5b57\u8282 4\u5b57\u8282 8\u5b57\u8282 short int 2\u5b57\u8282 2\u5b57\u8282 2\u5b57\u8282 int 2\u5b57\u8282 4\u5b57\u8282 4\u5b57\u8282 unsigned int 2\u5b57\u8282 4\u5b57\u8282 4\u5b57\u8282 float 4\u5b57\u8282 4\u5b57\u8282 4\u5b57\u8282 double 8\u5b57\u8282 8\u5b57\u8282 8\u5b57\u8282 long 4\u5b57\u8282 4\u5b57\u8282 8\u5b57\u8282 long long 8\u5b57\u8282 8\u5b57\u8282 8\u5b57\u8282 unsigned long 4\u5b57\u8282 4\u5b57\u8282 8\u5b57\u8282 uintptr_t 2\u5b57\u8282 4\u5b57\u8282 8\u5b57\u8282 intptr_t 2\u5b57\u8282 4\u5b57\u8282 8\u5b57\u8282 <ul> <li>char\uff1a\u59cb\u7ec8\u4e3a1\u5b57\u8282\u3002</li> <li>char/int * (\u6307\u9488\u53d8\u91cf)\uff1a\u5176\u5927\u5c0f\u4e0e\u5e73\u53f0\u7684\u6307\u9488\u5927\u5c0f\u4e00\u81f4\u3002</li> <li>short int\uff1a\u59cb\u7ec8\u4e3a2\u5b57\u8282\u3002</li> <li>int\uff1a\u572816\u4f4d\u7f16\u8bd1\u5668\u4e2d\u4e3a2\u5b57\u8282\uff0c\u572832\u4f4d\u548c64\u4f4d\u7f16\u8bd1\u5668\u4e2d\u4e3a4\u5b57\u8282\u3002</li> <li>unsigned int\uff1a\u4e0e <code>int</code> \u7684\u5927\u5c0f\u4e00\u81f4\u3002</li> <li>float\uff1a\u59cb\u7ec8\u4e3a4\u5b57\u8282\u3002</li> <li>double\uff1a\u59cb\u7ec8\u4e3a8\u5b57\u8282\u3002</li> <li>long\uff1a\u572816\u4f4d\u548c32\u4f4d\u7f16\u8bd1\u5668\u4e2d\u4e3a4\u5b57\u8282\uff0c\u572864\u4f4d\u7f16\u8bd1\u5668\u4e2d\u4e3a8\u5b57\u8282\u3002</li> <li>long long\uff1a\u59cb\u7ec8\u4e3a8\u5b57\u8282\u3002</li> <li>unsigned long\uff1a\u4e0e <code>long</code> \u7684\u5927\u5c0f\u4e00\u81f4\u3002</li> <li>uintptr_t \u548c intptr_t\uff1a\u7528\u4e8e\u5b58\u50a8\u6307\u9488\u503c\u7684\u65e0\u7b26\u53f7\u548c\u6709\u7b26\u53f7\u6574\u578b\uff0c\u5176\u5927\u5c0f\u4e0e\u5e73\u53f0\u7684\u6307\u9488\u5927\u5c0f\u4e00\u81f4\u3002 </li> </ul> </li> <li> <p>base</p> <pre><code>|               |\n+---------------+ &lt;---- ustack.end\n|  Unspecified  |\n+---------------+\n|               | &lt;----------+\n|    string     | &lt;--------+ |\n|     area      | &lt;------+ | |\n|               | &lt;----+ | | |\n|               | &lt;--+ | | | |\n+---------------+    | | | | |\n|  Unspecified  |    | | | | |\n+---------------+    | | | | |\n|     NULL      |    | | | | |\n+---------------+    | | | | |\n|    ......     |    | | | | |\n+---------------+    | | | | |\n|    envp[1]    | ---+ | | | |\n+---------------+      | | | |\n|    envp[0]    | -----+ | | |\n+---------------+        | | |\n|     NULL      |        | | |\n+---------------+        | | |\n| argv[argc-1]  | -------+ | |\n+---------------+          | |\n|    ......     |          | |\n+---------------+          | |\n|    argv[1]    | ---------+ |\n+---------------+            |\n|    argv[0]    | -----------+\n+---------------+\n|      argc     |\n+---------------+ &lt;---- cp-&gt;GPRx (\u521a\u5f00\u59cb\u6211\u7684base)\n|               |\n</code></pre> </li> </ol> <p>\u4e3a\u4ec0\u4e48strlen \u4f20\u8fdb\u53bb\u7684\u53c2\u6570\uff0c\u4e3a\u6307\u9488\u6570\u7ec4\uff0c\u52a0\u4e00\u4e2a &amp; \u7f16\u8bd1\u5668\u5c31\u62a5\u9519\uff1f</p> <p>\u8fd8\u6709\u4e3a\u4ec0\u4e48\u73b0\u5728\u7528strlen\u5c31\u884c\u4e86\uff1f\u4e4b\u524d\u7528\u603b\u662f\u7b97\u51fa\u4e2a1\uff1f\uff1f\uff1f\u592a\u795e\u5947\u4e86~\u8ba1\u7b97\u673a</p>"},{"location":"ysyx/pa/pa4/pa4.html#busybox","title":"\u8fd0\u884c <code>Busybox</code>","text":"<p><code>Busybox</code> \u7684 <code>main()</code> \u51fd\u6570\u4f1a\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570\u6765\u8c03\u7528\u76f8\u5e94\u5de5\u5177\u7684\u529f\u80fd\uff1a</p> <pre><code>main -&gt; run_applet_and_exit\n</code></pre> <ol> <li> <p>\u8fd0\u884c <code>Busybox(1)</code></p> <p>\u5c1d\u8bd5\u901a\u8fc7NTerm\u8fd0\u884cBusybox\u4e2d\u7684\u4e00\u4e9b\u7b80\u5355\u547d\u4ee4, \u6bd4\u5982<code>cat</code>\u548c<code>printenv</code>\u7b49. \u5982\u679c\u4f60\u4e0d\u6e05\u695a\u8fd9\u4e9b\u547d\u4ee4\u7684\u7528\u6cd5, \u53ef\u4ee5\u901a\u8fc7<code>man</code>\u6765\u67e5\u9605\u5b83\u4eec. \u6ce8\u610f\u4e0d\u8981\u8ba9\u8fd9\u4e9b\u547d\u4ee4\u7684\u8f93\u51fa\u6df9\u6ca1\u5728<code>hello_fun()</code>\u6253\u5370\u7684\u4fe1\u606f\u4e2d, \u4e3a\u6b64\u4f60\u53ef\u80fd\u9700\u8981\u8c03\u6574<code>hello_fun()</code>\u6253\u5370\u4fe1\u606f\u7684\u9891\u7387.</p> <p>\u5df2\u7ecf\u9ebb\u4e86\u3002</p> </li> </ol> <p>\u4e0d\u8fc7\u4e3a\u4e86\u904d\u5386 <code>PATH</code> \u4e2d\u7684\u8def\u5f84\uff0c <code>execvp()</code> \u53ef\u80fd\u4f1a\u5c1d\u8bd5\u6267\u884c\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u7528\u6237\u7a0b\u5e8f\uff0c\u4f8b\u5982<code>/bin/wc</code>\u3002</p> <p>\u56e0\u6b64Nanos-lite\u5728\u5904\u7406<code>SYS_execve</code> \u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u5019\u5c31\u9700\u8981\u68c0\u67e5\u5c06\u8981\u6267\u884c\u7684\u7a0b\u5e8f\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u7801\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>fs_open()</code> \u6765\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u9700\u8981\u6253\u5f00\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5c31\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u7684\u503c\uff0c\u6b64\u65f6 <code>SYS_execve</code> \u8fd4\u56de <code>-2</code>\u3002</p> <p>\u53e6\u4e00\u65b9\u9762, <code>libos</code> \u4e2d\u7684 <code>execve()</code> \u8fd8\u9700\u8981\u68c0\u67e5\u7cfb\u7edf\u8c03\u7528\u7684\u8fd4\u56de\u503c\uff1a\u5982\u679c\u7cfb\u7edf\u8c03\u7528\u7684\u8fd4\u56de\u503c\u5c0f\u4e8e0\uff0c\u5219\u901a\u5e38\u8868\u793a\u7cfb\u7edf\u8c03\u7528\u5931\u8d25\uff0c\u6b64\u65f6\u9700\u8981\u5c06\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\u503c\u53d6\u8d1f\uff0c\u4f5c\u4e3a\u5931\u8d25\u539f\u56e0\u8bbe\u7f6e\u5230\u4e00\u4e2a\u5168\u5c40\u7684\u5916\u90e8\u53d8\u91cf <code>errno</code>\u4e2d\uff0c\u7136\u540e\u8fd4\u56de <code>-1</code>\u3002</p> <ul> <li> <p>\u9605\u8bfb</p> <p>-2\u548cerrno</p> <p><code>errno</code>\u662fC\u6807\u51c6\u5b9a\u4e49\u7684, \u8fd0\u884c\u65f6\u73af\u5883\u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf, \u7528\u4e8e\u5b58\u653e\u6700\u8fd1\u4e00\u6b21\u5931\u8d25\u7684\u7cfb\u7edf\u8c03\u7528\u6216\u5e93\u51fd\u6570\u8c03\u7528\u7684\u9519\u8bef\u7801. \u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c<code>errno -l</code>\u547d\u4ee4(\u9700\u8981\u901a\u8fc7<code>apt-get</code>\u5b89\u88c5<code>moreutils</code>\u5305) \u6765\u67e5\u770b\u6240\u6709\u7684\u9519\u8bef\u7801\u53ca\u5176\u542b\u4e49, \u4f60\u5e94\u8be5\u80fd\u770b\u5230\u9519\u8bef\u7801<code>2</code>\u662f\u4f60\u6bd4\u8f83\u719f\u6089\u7684\u4e00\u79cd\u9519\u8bef. \u5173\u4e8e<code>errno</code>\u5168\u5c40\u53d8\u91cf\u7684\u66f4\u591a\u4fe1\u606f, \u53ef\u4ee5\u53c2\u8003<code>man 3 errno</code>.</p> </li> <li> <p><code>execvp</code></p> <pre><code>int execvp (const char *file, char * const argv[]) {\n  char *path = getenv (\"PATH\");\n  char buf[MAXNAMLEN];\n\n  /* If $PATH doesn't exist, just pass FILE on unchanged.  */\n  if (!path)\n    return execv (file, argv);\n\n  /* If FILE contains a directory, don't search $PATH.  */\n  if (strchr (file, '/')\n      )\n    return execv (file, argv);\n\n  while (*path)\n    {\n      strccpy (buf, path, PATH_DELIM);\n      /* An empty entry means the current directory.  */\n      if (*buf != 0 &amp;&amp; buf[strlen(buf) - 1] != '/')\n    strcat (buf, \"/\");\n      strcat (buf, file);\n      if (execv (buf, argv) == -1 &amp;&amp; errno != ENOENT)\n    return -1;\n      while (*path &amp;&amp; *path != PATH_DELIM)\n    path++;\n      if (*path == PATH_DELIM)\n    path++;         /* skip over delim */\n    }                                     \n\n  return -1;\n}\n</code></pre> <p>\u67e5\u627e\u5e76\u6267\u884c\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002\u5b83\u9996\u5148\u5728\u5f53\u524d\u76ee\u5f55\u67e5\u627e\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u518d\u5728\u73af\u5883\u53d8\u91cf <code>PATH</code> \u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u67e5\u627e\u3002</p> </li> </ul> <p>\u73b0\u5728\u7684\u95ee\u9898\uff0c\u5982\u679c\u901a\u8fc7\u7528\u6237\u8fdb\u7a0b\u6765\u542f\u52a8\u522b\u7684\u8fdb\u7a0b\uff0c\u5c31\u4f1a\u51fa\u73b0\u6587\u4ef6\u540d\u3001<code>argv</code> \u4e22\u5931\u4e71\u7801\u7684\u60c5\u51b5\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e4b\u524d\u7684 <code>exec-test</code> \u53ea\u80fd\u8dd1 \u51e0\u5341\u6b21\uff0c\u73b0\u5728\u80fd\u8dd1\u51e0\u5343\u6b21\uff1f\uff1f\uff1f</p> <p>\u73b0\u5728\u624d\u662f\u5bf9\u7684\uff1f\u56e0\u4e3a\u521a\u597d\u505c\u5728\u4e86\u63a5\u8fd1 <code>0x87ff ffff</code> \u7684\u5730\u65b9\uff0c\u786e\u5b9e\u662f\u7528\u6237\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u5feb\u7206\u4e86\u3002</p> <p>\u53c8\u4e0d\u884c\u4e86\uff0c\u4e00\u5b9a\u662f\u54ea\u91cc\u51fa\u95ee\u9898\u4e86\u3002</p>"},{"location":"ysyx/pa/pa4/pa4.html#summaryothers","title":"summary\u3001others","text":"<p><code>update</code> \u7684\u5177\u4f53\u884c\u4e3a\u662f\u4ec0\u4e48\uff1a</p> <pre><code>update:\n    $(MAKE) -s -C $(NAVY_HOME) ISA=$(ISA) ramdisk\n    @ln -sf $(NAVY_HOME)/build/ramdisk.img $(RAMDISK_FILE)\n    @ln -sf $(NAVY_HOME)/build/ramdisk.h src/files.h\n    @ln -sf $(NAVY_HOME)/libs/libos/src/syscall.h src/syscall.h\n</code></pre> <p>\u53bb\u5230 <code>navy-apps</code> \u6839\u636e\u6307\u5b9a\u7684 ISA \u7f16\u8bd1\uff0c\u8fdb\u884c\u5404\u79cd\u8f6f\u94fe\u63a5\u3002</p>"},{"location":"ysyx/pa/pa4/pa4.html#_9","title":"\u7a0b\u5e8f\u548c\u5185\u5b58\u4f4d\u7f6e","text":""},{"location":"ysyx/pa/pa4/pa4.html#_10","title":"\u7edd\u5bf9\u4ee3\u7801","text":""},{"location":"ysyx/pa/pa4/pa4.html#_11","title":"\u53ef\u91cd\u5b9a\u4f4d\u4ee3\u7801","text":""},{"location":"ysyx/pa/pa4/pa4.html#_12","title":"\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801","text":"<ul> <li> <p>\u9009\u505a</p> <p>\u5b9e\u73b0\u57fa\u4e8ePIE\u7684loader (\u5efa\u8bae\u4e8c\u5468\u76ee\u601d\u8003)</p> <p>\u5929\u4e0b\u5e76\u6ca1\u6709\u514d\u8d39\u7684\u5348\u9910, PIE\u4e4b\u6240\u4ee5\u80fd\u505a\u5230\u4f4d\u7f6e\u65e0\u5173, \u5176\u5b9e\u662f\u8981\u4f9d\u8d56\u4e8e\u7a0b\u5e8f\u4e2d\u4e00\u4e2a\u53ebGOT(global offset table, \u5168\u5c40\u504f\u79fb\u91cf\u8868)\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u7684\u6570\u636e\u7ed3\u6784. \u8981\u6b63\u786e\u8fd0\u884cPIE, \u52a0\u8f7d\u5668\u9700\u8981\u5728\u52a0\u8f7d\u7a0b\u5e8f\u7684\u65f6\u5019\u5f80GOT\u4e2d\u586b\u5199\u6b63\u786e\u7684\u5185\u5bb9.</p> <p>\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u8ba9Nanos-lite\u7684loader\u652f\u6301PIE, \u5f53\u7136\u8fd9\u9700\u8981\u4e86\u89e3\u4e00\u4e9bELF\u76f8\u5173\u7684\u7ec6\u8282, \u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003ABI\u624b\u518c.</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_13","title":"\u865a\u5b9e\u4ea4\u9519\u7684\u9b54\u6cd5","text":"<p>\u6240\u8c13\u865a\u62df\u5185\u5b58, \u5c31\u662f\u5728\u771f\u6b63\u7684\u5185\u5b58(\u4e5f\u53eb\u7269\u7406\u5185\u5b58)\u4e4b\u4e0a\u7684\u4e00\u5c42\u4e13\u95e8\u7ed9\u8fdb\u7a0b\u4f7f\u7528\u7684\u62bd\u8c61. \u6709\u4e86\u865a\u62df\u5185\u5b58\u4e4b\u540e, \u8fdb\u7a0b\u53ea\u9700\u8981\u8ba4\u4e3a\u81ea\u5df1\u8fd0\u884c\u5728\u865a\u62df\u5730\u5740\u4e0a\u5c31\u53ef\u4ee5\u4e86, \u771f\u6b63\u8fd0\u884c\u7684\u65f6\u5019, \u624d\u628a\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u7269\u7406\u5730\u5740. \u8fd9\u6837, \u6211\u4eec\u53ea\u8981\u628a\u7a0b\u5e8f\u94fe\u63a5\u5230\u4e00\u4e2a\u56fa\u5b9a\u7684\u865a\u62df\u5730\u5740, \u52a0\u8f7d\u7684\u65f6\u5019\u628a\u5b83\u4eec\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740, \u5e76\u7ef4\u62a4\u597d\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb, \u5c31\u53ef\u4ee5\u4e00\u52b3\u6c38\u9038\u5730\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u4e86!</p> <p>\u90a3\u4e48, \u5728\u8fdb\u7a0b\u8fd0\u884c\u7684\u65f6\u5019, \u8c01\u6765\u628a\u865a\u62df\u5730\u5740\u6620\u5c04\u6210\u7269\u7406\u5730\u5740\u5462? \u6211\u4eec\u5728PA1\u4e2d\u5df2\u7ecf\u4e86\u89e3\u5230\u6307\u4ee4\u7684\u751f\u547d\u5468\u671f:</p> <pre><code>while (1) {\n  \u4ecePC\u6307\u793a\u7684\u5b58\u50a8\u5668\u4f4d\u7f6e\u53d6\u51fa\u6307\u4ee4;\n  \u6267\u884c\u6307\u4ee4;\n  \u66f4\u65b0PC;\n}\n</code></pre> <p>\u5982\u679c\u5f15\u5165\u4e86\u865a\u62df\u5185\u5b58\u673a\u5236, PC\u5c31\u662f\u4e00\u4e2a\u865a\u62df\u5730\u5740\u4e86, \u6211\u4eec\u9700\u8981\u5728\u8bbf\u95ee\u5b58\u50a8\u5668\u4e4b\u524d\u5b8c\u6210\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04. \u5c3d\u7ba1\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7740\u8ba1\u7b97\u673a\u4e2d\u7684\u6240\u6709\u8d44\u6e90, \u5728\u8ba1\u7b97\u673a\u770b\u6765\u5b83\u4e5f\u53ea\u662f\u4e00\u4e2a\u7a0b\u5e8f\u800c\u5df2. \u4f5c\u4e3a\u4e00\u4e2a\u5728\u8ba1\u7b97\u673a\u4e0a\u6267\u884c\u7684\u7a0b\u5e8f\u800c\u8a00, \u64cd\u4f5c\u7cfb\u7edf\u5fc5\u5b9a\u65e0\u6cd5\u5e72\u6d89\u6307\u4ee4\u6267\u884c\u7684\u5177\u4f53\u8fc7\u7a0b. \u6240\u4ee5\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u6765\u628a\u865a\u62df\u5730\u5740\u6620\u5c04\u6210\u7269\u7406\u5730\u5740, \u662f\u4e0d\u53ef\u80fd\u5b9e\u73b0\u7684. \u56e0\u6b64, \u5728\u786c\u4ef6\u4e2d\u8fdb\u884c\u8fd9\u4e00\u6620\u5c04\u662f\u552f\u4e00\u7684\u9009\u62e9\u4e86: \u6211\u4eec\u5728\u5904\u7406\u5668\u548c\u5b58\u50a8\u5668\u4e4b\u95f4\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u786c\u4ef6\u6a21\u5757MMU(Memory Management Unit, \u5185\u5b58\u7ba1\u7406\u5355\u5143), \u5b83\u662f\u865a\u62df\u5185\u5b58\u673a\u5236\u7684\u6838\u5fc3, \u80a9\u8d1f\u8d77\u8fd9\u4e00\u673a\u5236\u6700\u91cd\u8981\u7684\u5730\u5740\u6620\u5c04\u529f\u80fd. \u9700\u8981\u8bf4\u660e\u7684\u662f, \u6211\u4eec\u521a\u624d\u63d0\u5230\u7684\"MMU\u4f4d\u4e8e\u5904\u7406\u5668\u548c\u5b58\u50a8\u5668\u4e4b\u95f4\"\u53ea\u662f\u6982\u5ff5\u4e0a\u7684\u8bf4\u6cd5. \u4e8b\u5b9e\u4e0a, \u865a\u62df\u5185\u5b58\u673a\u5236\u5728\u73b0\u4ee3\u8ba1\u7b97\u673a\u4e2d\u662f\u5982\u6b64\u91cd\u8981, \u4ee5\u81f3\u4e8eMMU\u5728\u7269\u7406\u4e0a\u90fd\u5b9e\u73b0\u5728\u5904\u7406\u5668\u82af\u7247\u5185\u90e8\u4e86.</p> <p>\u4f46\u662f, \u53ea\u6709\u64cd\u4f5c\u7cfb\u7edf\u624d\u77e5\u9053\u5177\u4f53\u8981\u628a\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u54ea\u4e9b\u7269\u7406\u5730\u5740\u4e0a. \u6240\u4ee5, \u865a\u62df\u5185\u5b58\u673a\u5236\u662f\u4e00\u4e2a\u8f6f\u786c\u534f\u540c\u624d\u80fd\u5de5\u4f5c\u7684\u673a\u5236</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u8fdb\u884c\u7269\u7406\u5185\u5b58\u7684\u7ba1\u7406, \u52a0\u8f7d\u8fdb\u7a0b\u7684\u65f6\u5019\u51b3\u5b9a\u8981\u628a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u54ea\u4e9b\u7269\u7406\u5730\u5740; \u7b49\u5230\u8fdb\u7a0b\u771f\u6b63\u8fd0\u884c\u4e4b\u524d, \u8fd8\u9700\u8981\u914d\u7f6eMMU, \u628a\u4e4b\u524d\u51b3\u5b9a\u597d\u7684\u6620\u5c04\u843d\u5b9e\u5230\u786c\u4ef6\u4e0a, \u8fdb\u7a0b\u8fd0\u884c\u7684\u65f6\u5019, MMU\u5c31\u4f1a\u8fdb\u884c\u5730\u5740\u8f6c\u6362, \u628a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u5e0c\u671b\u7684\u7269\u7406\u5730\u5740. \u6ce8\u610f\u5230\u8fd9\u4e2a\u6620\u5c04\u662f\u8fdb\u7a0b\u76f8\u5173\u7684: \u4e0d\u540c\u7684\u8fdb\u7a0b\u6709\u4e0d\u540c\u7684\u6620\u5c04, \u8fd9\u610f\u5473\u7740\u5bf9\u4e0d\u540c\u7684\u8fdb\u7a0b\u6765\u8bf4, \u540c\u4e00\u4e2a\u865a\u62df\u5730\u5740\u53ef\u80fd\u4f1a\u88ab\u6620\u5c04\u5230\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740. \u8fd9\u6070\u597d\u4e00\u52b3\u6c38\u9038\u5730\u89e3\u51b3\u4e86\u5185\u5b58\u8986\u76d6\u7684\u95ee\u9898. \u7edd\u5927\u90e8\u5206\u591a\u4efb\u52a1\u64cd\u4f5c\u7cfb\u7edf\u5c31\u662f\u8fd9\u6837\u505a\u7684.</p>"},{"location":"ysyx/pa/pa4/pa4.html#_14","title":"\u8d85\u8d8a\u5bb9\u91cf\u7684\u754c\u9650","text":""},{"location":"ysyx/pa/pa4/pa4.html#_15","title":"\u5206\u9875","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u865a\u5b58\u7ba1\u7406\u4e2dPIC\u7684\u597d\u5904</p> <p>\u6211\u4eec\u4e4b\u524d\u63d0\u5230, PIC\u7684\u5176\u4e2d\u4e00\u4e2a\u597d\u5904\u662f\u53ef\u4ee5\u5c06\u4ee3\u7801\u52a0\u8f7d\u5230\u4efb\u610f\u5185\u5b58\u4f4d\u7f6e\u6267\u884c. \u5982\u679c\u914d\u5408\u865a\u5b58\u7ba1\u7406, PIC\u8fd8\u6709\u4ec0\u4e48\u65b0\u7684\u597d\u5904\u5462? (Hint: \u52a8\u6001\u5e93\u5df2\u7ecf\u5728\u4eab\u53d7\u8fd9\u4e9b\u597d\u5904\u4e86)</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_16","title":"\u5206\u9875\u8fc7\u7a0b\u7684\u8be6\u7ec6\u5b66\u4e60","text":"<ul> <li> <p>\u505a1</p> <p>\u7406\u89e3\u5206\u9875\u7ec6\u8282</p> <ul> <li>i386\u4e0d\u662f\u4e00\u4e2a32\u4f4d\u7684\u5904\u7406\u5668\u5417, \u4e3a\u4ec0\u4e48\u8868\u9879\u4e2d\u7684\u57fa\u5730\u5740\u4fe1\u606f\u53ea\u670920\u4f4d, \u800c\u4e0d\u662f32\u4f4d?</li> <li>\u624b\u518c\u4e0a\u63d0\u5230\u8868\u9879(\u5305\u62ecCR3)\u4e2d\u7684\u57fa\u5730\u5740\u90fd\u662f\u7269\u7406\u5730\u5740, \u7269\u7406\u5730\u5740\u662f\u5fc5\u987b\u7684\u5417? \u80fd\u5426\u4f7f\u7528\u865a\u62df\u5730\u5740?</li> <li>\u4e3a\u4ec0\u4e48\u4e0d\u91c7\u7528\u4e00\u7ea7\u9875\u8868? \u6216\u8005\u8bf4\u91c7\u7528\u4e00\u7ea7\u9875\u8868\u4f1a\u6709\u4ec0\u4e48\u7f3a\u70b9?</li> </ul> <p>\u7c7b\u6bd4\u522b\u7684 ISA \u7684\u5206\u9875\u673a\u5236\u3002 RTFM</p> </li> <li> <p>\u9605\u8bfb</p> <p>iscv64\u9700\u8981\u5b9e\u73b0\u4e09\u7ea7\u9875\u8868</p> <p>riscv32\u7684Sv32\u673a\u5236\u53ea\u80fd\u5bf932\u4f4d\u7684\u865a\u62df\u5730\u5740\u8fdb\u884c\u5730\u5740\u8f6c\u6362, \u4f46riscv64\u7684\u865a\u62df\u5730\u5740\u6700\u957f\u662f64\u4f4d, \u56e0\u6b64\u9700\u8981\u6709\u53e6\u5916\u7684\u673a\u5236\u6765\u652f\u6301\u66f4\u957f\u7684\u865a\u62df\u5730\u5740\u7684\u5730\u5740\u8f6c\u6362. \u5728PA\u4e2d, \u5982\u679c\u4f60\u9009\u62e9\u4e86riscv64, \u90a3\u53ea\u9700\u8981\u5b9e\u73b0Sv39\u4e09\u7ea7\u9875\u8868\u7684\u5206\u9875\u673a\u5236\u5373\u53ef, \u800c\u4e14PA\u53ea\u4f1a\u4f7f\u75284KB\u5c0f\u9875\u9762, \u4e0d\u4f1a\u4f7f\u75282MB\u7684\u5927\u9875\u9762, \u56e0\u6b64\u4f60\u65e0\u9700\u5b9e\u73b0Sv39\u7684\u5927\u9875\u9762\u529f\u80fd. \u5177\u4f53\u7ec6\u8282\u8bf7RTFM.</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u7a7a\u6307\u9488\u771f\u7684\u662f\"\u7a7a\"\u7684\u5417?</p> <p>\u7a0b\u5e8f\u8bbe\u8ba1\u8bfe\u4e0a\u8001\u5e08\u544a\u8bc9\u4f60, \u5f53\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u7684\u503c\u7b49\u4e8eNULL\u65f6, \u4ee3\u8868\u7a7a, \u4e0d\u6307\u5411\u4efb\u4f55\u4e1c\u897f. \u4ed4\u7ec6\u60f3\u60f3, \u771f\u7684\u662f\u8fd9\u6837\u5417? \u5f53\u7a0b\u5e8f\u5bf9\u7a7a\u6307\u9488\u89e3\u5f15\u7528\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u5185\u90e8\u5177\u4f53\u90fd\u505a\u4e86\u4e9b\u4ec0\u4e48? \u4f60\u5bf9\u7a7a\u6307\u9488\u7684\u672c\u8d28\u6709\u4ec0\u4e48\u65b0\u7684\u8ba4\u8bc6?</p> <p>\u4e00\u70b9\u4e94\u7f16\u7a0b\u7fa4\u91cc\u7684\u8ba8\u8bba</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_17","title":"\u7a7a\u6307\u9488\u771f\u7684\u662f\"\u7a7a\"\u7684\u5417?","text":"<p>\u4e0d\u662f\uff0c\u53ea\u662f\u56e0\u4e3a0\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u6ca1\u6709\u6620\u5c04/\u6709\u8f83\u9ad8\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u5730\u5740\u8f6c\u6362\u7684\u65f6\u5019\u4f1a\u4ea7\u751f\u5f02\u5e38\uff0c\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u5219\u4f1a\u6740\u6b7b\u8d8a\u6743\u8bbf\u95ee\u7684\u8fdb\u7a0b\uff08\u4e5f\u5c31\u662f\u4ea7\u751f\u4e86\u6bb5\u9519\u8bef\uff09</p> <p>\u89e3\u5f15\u7528\u7684\u65f6\u5019\uff1a\u83b7\u5f97\u53d8\u91cf\u7684\u503c-&gt;\u8bbf\u95ee0\u5730\u5740-&gt;mmu\u8fdb\u884c\u5730\u5740\u8f6c\u6362-&gt;\u5728\u9875\u8868\u4e2d\u627e\u4e0d\u5230/\u6ca1\u6709\u5bf9\u5e94\u6743\u9650-&gt;\u5f15\u53d1\u5f02\u5e38\uff0c\u8fdb\u5165\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f-&gt;\u8fdb\u7a0b\u88ab\u6740\u6b7b</p>"},{"location":"ysyx/pa/pa4/pa4.html#_18","title":"\u7a7a\u6307\u9488\u771f\u7684\u662f\u7a7a\u7684\u5417","text":"<p>NULL \u662f\u4e00\u4e2a\u6807\u51c6\u89c4\u5b9a\u7684\u5b8f\u5b9a\u4e49\uff0c\u7528\u6765\u8868\u793a\u7a7a\u6307\u9488\u5e38\u91cf\u3002\u5728C\u4e2d\u548c\u65e9\u671f\u7684C++\u4e2d\u5b83\u5c31\u662f0</p> <pre><code>C++\n\n \u4ee3\u7801\u89e3\u8bfb\n\u590d\u5236\u4ee3\u7801#define NULL (void*)0\n</code></pre> <p>\u540e\u6765C++\u6709\u4e86<code>nullptr</code>\u8fd9\u4e2a\u4e1c\u897f\uff0c\u4e0d\u8fc7\u4e0e\u8fd9\u4e2a\u95ee\u9898\u6ca1\u5565\u5173\u7cfb\u3002</p> <p>\u4e0b\u9762\u7684\u90e8\u5206\u5f15\u81ea\u535a\u5ba2\u56ed</p> <p>\u7a0b\u5e8f\u5728\u4f7f\u7528\u7684\u662f\u7cfb\u7edf\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6bb5\uff0c\u7a0b\u5e8f\u4e2d\u7684\u96f6\u503c\u6307\u9488\u6307\u5411\u8fd9\u4e2a\u6bb5\u7684\u5f00\u7aef\uff0c\u4e3a\u4e86\u4fdd\u8bc1NULL\u6982\u5ff5\uff0c\u7cfb\u7edf\u4e3a\u6211\u4eec\u8fd9\u4e2a\u6bb5\u7684\u5f00\u593464K\u5185\u5b58\u505a\u4e86\u82db\u523b\u7684\u89c4\u5b9a\uff0c\u6839\u636e\u865a\u62df\u5185\u5b58\u8bbf\u95ee\u6743\u9650\u63a7\u5236\uff0c\u6211\u4eec\u7a0b\u5e8f\u4e2d\uff08\u4f4e\u8bbf\u95ee\u6743\u9650\uff09\u8bbf\u95ee\u8981\u6c42\u9ad8\u8bbf\u95ee\u6743\u9650\u7684\u8fd964K\u5185\u5b58\u88ab\u89c6\u4f5c\u662f\u4e0d\u5bb9\u8bb8\u7684\uff0c\u6240\u4ee5\u4f1a\u5fc5\u7136\u5f15\u53d1Access Volitation \u9519\u8bef\uff0c\u800c\u8fd9\u9ad8\u6743\u9650\u768464K\u5185\u5b58\u662f\u4e00\u5757\u4fdd\u7559\u5185\u5b58\uff08\u5373\u4e0d\u80fd\u88ab\u7a0b\u5e8f\u52a8\u6001\u5185\u5b58\u5206\u914d\u5668\u5206\u914d\uff0c\u4e0d\u80fd\u88ab\u8bbf\u95ee\uff0c\u4e5f\u4e0d\u80fd\u88ab\u4f7f\u7528\uff09\uff0c\u5c31\u662f\u7b80\u5355\u7684\u4fdd\u7559\uff0c\u4e0d\u4f5c\u4efb\u4f55\u4f7f\u7528\u3002</p> <p>\u56e0\u6b64\u7a7a\u6307\u9488\u4e0d\u662f\u771f\u7684\"\u7a7a\"\u3002\u4f46NULL\u786e\u5b9e\u662f0\u5730\u5740\uff0c\u5b83\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u6ca1\u6709\u6620\u5c04/\u6709\u8f83\u9ad8\u7684\u8bbf\u95ee\u6743\u9650\u3002\u6240\u4ee5\u8bbf\u95ee\u7a7a\u6307\u9488\u7684\u5185\u5bb9\u4f1a\u7206\u6bb5\u9519\u8bef\u3002</p> <p>\u4f5c\u8005\uff1aLunaticskytql \u94fe\u63a5\uff1ahttps://juejin.cn/post/7273025171111952444 \u6765\u6e90\uff1a\u7a00\u571f\u6398\u91d1 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>"},{"location":"ysyx/pa/pa4/pa4.html#_19","title":"\u72b6\u6001\u673a\u89c6\u89d2\u4e0b\u7684\u865a\u5b58\u7ba1\u7406\u673a\u5236","text":"<p>\u6bd4\u8f83\u7279\u6b8a\u7684\u662f<code>fvm()</code>\u8fd9\u4e2a\u51fd\u6570. \u56de\u987ePA3\u4ecb\u7ecd\u7684\u72b6\u6001\u673a\u6a21\u578b\u4e2d\u5f15\u5165\u7684<code>fex()</code>\u51fd\u6570, \u5b83\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5c5e\u4e8e\u72b6\u6001\u673a\u7684\u4e00\u90e8\u5206, \u56e0\u4e3a\u629b\u51fa\u5f02\u5e38\u7684\u5224\u65ad\u65b9\u5f0f\u662f\u548c\u72b6\u6001\u673a\u7684\u5177\u4f53\u72b6\u6001\u65e0\u5173\u7684. </p> <p>\u800c <code>fvm()</code> \u51fd\u6570\u5219\u6709\u6240\u4e0d\u540c\uff0c\u5b83\u53ef\u4ee5\u770b\u505a\u662f\u662f\u72b6\u6001\u673a\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u662f\u56e0\u4e3a <code>fvm()</code> \u51fd\u6570\u662f\u53ef\u4ee5\u901a\u8fc7\u7a0b\u5e8f\u8fdb\u884c\u4fee\u6539\u7684\uff1a\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u51b3\u5b9a\u5982\u4f55\u5efa\u7acb\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u4e4b\u95f4\u7684\u6620\u5c04\u3002</p> <p>\u5177\u4f53\u5730, <code>fvm()</code> \u51fd\u6570\u53ef\u4ee5\u8ba4\u4e3a\u662f\u7cfb\u7edf\u5bc4\u5b58\u5668 <code>SR</code> \u7684\u4e00\u90e8\u5206, \u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u4fee\u6539 <code>SR</code> \u6765\u5bf9\u865a\u5b58\u8fdb\u884c\u7ba1\u7406.</p>"},{"location":"ysyx/pa/pa4/pa4.html#tlb-","title":"TLB - \u5730\u5740\u8f6c\u6362\u7684\u52a0\u901f","text":""},{"location":"ysyx/pa/pa4/pa4.html#vme","title":"\u5c06\u865a\u5b58\u7ba1\u7406\u673a\u5236\u62bd\u8c61\u6210 VME","text":"<p>\u865a\u5b58\u673a\u5236\u7684\u672c\u8d28\uff0c\u5c31\u662f\u4e2a\u6620\u5c04(\u6216\u51fd\u6570)\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u672c\u8d28\u4e0a\u865a\u5b58\u7ba1\u7406\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5728\u7ef4\u62a4\u8fd9\u4e2a\u6620\u5c04\u3002\u4f46\u8fd9\u4e2a\u6620\u5c04\u5e94\u8be5\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5404\u81ea\u7ef4\u62a4\u4e00\u4efd\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5982\u4e0b\u7684\u4e24\u4e2aAPI\uff1a</p> <pre><code>// \u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5730\u5740\u7a7a\u95f4\nvoid protect(AddrSpace *as);\n\n// \u9500\u6bc1\u6307\u5b9a\u7684\u5730\u5740\u7a7a\u95f4\nvoid unprotect(AddrSpace *as);\n</code></pre> <p><code>AddrSpace</code> \uff1a</p> <pre><code>typedef struct AddrSpace {\n  int pgsize;\n  Area area;\n  void *ptr;\n} AddrSpace;\n</code></pre> <p><code>pgsize</code>\u7528\u4e8e\u6307\u793a\u9875\u9762\u7684\u5927\u5c0f, <code>area</code>\u8868\u793a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u7528\u6237\u6001\u7684\u8303\u56f4, <code>ptr</code>\u662f\u4e00\u4e2aISA\u76f8\u5173\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488, \u7528\u4e8e\u6307\u793a\u5177\u4f53\u7684\u6620\u5c04.</p> <p>\u6709\u4e86\u5730\u5740\u7a7a\u95f4, \u6211\u4eec\u8fd8\u9700\u8981\u6709\u76f8\u5e94\u7684API\u6765\u7ef4\u62a4\u5b83\u4eec. \u4e8e\u662f\u5f88\u81ea\u7136\u5c31\u6709\u4e86\u5982\u4e0b\u7684API:</p> <pre><code>void map(AddrSpace *as, void *va, void *pa, int prot);\n</code></pre> <p>\u5b83\u7528\u4e8e\u5c06\u5730\u5740\u7a7a\u95f4<code>as</code>\u4e2d\u865a\u62df\u5730\u5740<code>va</code>\u6240\u5728\u7684\u865a\u62df\u9875, \u4ee5<code>prot</code>\u7684\u6743\u9650\u6620\u5c04\u5230<code>pa</code>\u6240\u5728\u7684\u7269\u7406\u9875. \u5f53<code>prot</code>\u4e2d\u7684present\u4f4d\u4e3a<code>0</code>\u65f6, \u8868\u793a\u8ba9<code>va</code>\u7684\u6620\u5c04\u65e0\u6548. \u7531\u4e8e\u6211\u4eec\u4e0d\u6253\u7b97\u5b9e\u73b0\u4fdd\u62a4\u673a\u5236, \u56e0\u6b64\u6743\u9650<code>prot</code>\u6682\u4e0d\u4f7f\u7528.</p> <ol> <li> <p><code>Sv32</code> \u7684\u9875\u8868\u7ed3\u6784</p> <p><code>page table entry</code>\uff08PTE\uff09\uff1a </p> <p></p> <p></p> <ul> <li> <p>Sv32\u7684\u4e24\u7ea7\u6811\u7ed3\u6784</p> <ul> <li>\u6839\u8282\u70b9\uff1a\u4ee3\u8868\u6574\u4e2a4GiB\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u3002</li> <li>\u7b2c\u4e00\u7ea7\u8282\u70b9\uff1a\u4ece\u6839\u8282\u70b9\u5ef6\u4f38\u51fa 2<sup>10</sup>=1024 \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u4ee3\u8868\u4e00\u4e2a 4 MiB \u7684\u533a\u57df\u3002</li> <li>\u7b2c\u4e8c\u7ea7\u8282\u70b9\uff1a\u6bcf\u4e2a\u7b2c\u4e00\u7ea7\u8282\u70b9\u4e0b\u6302\u8f7d 2<sup>10</sup>=1024 \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u4ee3\u8868\u4e00\u4e2a 4KiB \u7684\u9875\u9762\u3002</li> </ul> <pre><code>      +---------+\n      |  4GiB   |\n      +----+----+\n           |\n+--------+  +--------+  1024    +--------+   \n|  4MiB  |  |  4MiB  | ......   |  4MiB  |       \n+--------+  +--------+          +--------+ \n    |            |.........|.........|................,,..............\n    |                                              |        |       |(\u540c)\n    |----------|---------------------|...\n+--------+  +--------+  1024    +--------+\n|  4KiB  |  |  4KiB  |  ......  |  4KiB  | \n+--------+  +--------+          +--------+ \n</code></pre> </li> </ul> </li> <li> <p>\u5177\u4f53\u76f8\u5173\u5bc4\u5b58\u5668</p> <p></p> <p>\u5206\u9875\u673a\u5236\u7531\u4e00\u4e2a\u540d\u4e3a <code>satp</code>\uff08Supervisor Address Translation and Protection\uff0c\u76d1\u7ba1\u6a21\u5f0f\u5730\u5740\u7ffb\u8bd1\u548c\u4fdd\u62a4\uff09\u7684 S \u6a21\u5f0f CSR \u63a7\u5236\u3002\u5982\u56fe 10.18 \u6240\u793a\u3002</p> <p><code>satp</code> \u6709 3 \u4e2a\u5b57\u6bb5\u3002</p> <ul> <li>MODE \u5b57\u6bb5\u7528\u4e8e\u5f00\u542f\u5206\u9875\u5e76\u9009\u62e9\u9875\u8868\u7ea7\u6570\uff0c\u5176\u7f16\u7801\u5982\u56fe 10.19 \u6240\u793a\u3002</li> <li>ASID\uff08Address Space Identifier\uff0c\u5730\u5740\u7a7a\u95f4\u6807\u8bc6\uff09\u5b57\u6bb5\u662f\u53ef\u9009\u7684\uff0c\u53ef\u7528\u4e8e\u964d\u4f4e\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u3002</li> <li>PPN \u5b57\u6bb5\u4ee54 KiB\u9875\u4e3a\u5355\u4f4d\u5b58\u653e\u6839\u9875\u8868\u7684\u7269\u7406\u9875\u53f7\u3002</li> </ul> <p>\u901a\u5e38 M \u6a21\u5f0f\u8f6f\u4ef6\u5728\u7b2c\u4e00\u6b21\u8fdb\u5165 S \u6a21\u5f0f\u524d\u4f1a\u5c06 <code>satp</code> \u6e05\u96f6\u4ee5\u5173\u95ed\u5206\u9875\uff0c\u7136\u540e S \u6a21\u5f0f\u8f6f\u4ef6\u5728\u521b\u5efa\u9875\u8868\u540e\u5c06\u6b63\u786e\u8bbe\u7f6e <code>satp</code> \u5bc4\u5b58\u5668\u3002<code>satp</code> \u5bc4\u5b58\u5668\u542f\u7528\u5206\u9875\u65f6\uff0c\u5904\u7406\u5668\u5c06\u4ece\u6839\u90e8\u904d\u5386\u9875\u8868\uff0c\u5c06 S \u6a21\u5f0f\u548c U \u6a21\u5f0f\u7684\u865a\u62df\u5730\u5740\u7ffb\u8bd1\u4e3a\u7269\u7406\u5730\u5740\u3002</p> </li> <li> <p>\u5177\u4f53\u8f6c\u6362\u8fc7\u7a0b</p> <p></p> <ol> <li> <p><code>satp.PPN</code> \u7ed9\u51fa\u4e00\u7ea7\u9875\u8868\u7684\u57fa\u5730\u5740\uff0c <code>VA[31:22]</code> \u7ed9\u51fa\u4e00\u7ea7\u7d22\u5f15</p> <p>\u56e0\u6b64\u5904\u7406\u5668\u5c06\u8bfb\u53d6\u4f4d\u4e8e\u5730\u5740 <code>(satp.PPN\u00d74096 + VA[31:22]\u00d74)</code> \u7684 PTE\uff1b</p> </li> <li> <p>\u7531\u4e0a\u5f97\u51fa\u7684 PTE \u5305\u542b\u4e8c\u7ea7\u9875\u8868\u7684\u57fa\u5730\u5740\uff0c <code>VA[21:12]</code> \u7ed9\u51fa\u4e8c\u7ea7\u7d22\u5f15\uff0c</p> <p>\u56e0\u6b64\u5904\u7406\u5668\u5c06\u8bfb\u53d6\u4f4d\u4e8e\u5730\u5740 <code>(PTE.PPN\u00d74096 + VA[21:12]\u00d74)</code> \u7684\u53f6\u5b50 PTE\uff1b  </p> </li> </ol> </li> </ol> <p>\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u518d\u6b21\u6ce8\u610f\u903b\u8f91\u4e0e\u548c\u4f4d\u64cd\u4f5c\u3002</p> <p>\u4f3c\u4e4e\u5f88\u591a\u5730\u65b9\u90fd\u6709\u8fd9\u79cd\u5199\u6cd5\uff1a\u50cf <code>user_handler</code>\u3001<code>vme_init</code>\u3001<code>cte_init</code> \u90fd\u662f\u8fd9\u79cd\u4f20\u8fdb\u6765\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u7684\u505a\u6cd5\uff0c\u8bbe\u7f6e\u76f8\u5173\u7684\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u662f\u4ec0\u4e48\u505a\u6cd5\u5462\uff1f\u662f\u4e0d\u662f\u4e00\u79cd\u56fa\u5b9a\u7684\u5957\u8def\uff1f</p>"},{"location":"ysyx/pa/pa4/pa4.html#nanos-lite_1","title":"\u5728\u5206\u9875\u673a\u5236\u4e0a\u8fd0\u884c Nanos-lite","text":"<p>\u68b3\u7406\u4e00\u4e9b\u5404\u4e2a\u5c42\u6b21</p> <ol> <li> <p>os\u5c42</p> <p>\u5411\u4e0b\u7ba1\u7406\u9875\u8868\u8d44\u6e90\uff0c\u5411\u4e0a\u62bd\u8c61\u63a5\u53e3\u3002<code>pa_allloc()</code>\u3001<code>new_page()</code></p> </li> <li> <p>am\u5c42\uff08<code>VME</code>\uff09</p> <p>\u4e3b\u8981\u529f\u80fd API \u5728\u4e8e <code>map</code> \u51fd\u6570\uff1a\u5b83\u9700\u8981\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4 <code>as</code> \u7684\u9875\u76ee\u5f55\u548c\u9875\u8868\u4e2d\u586b\u5199\u6b63\u786e\u7684\u5185\u5bb9\uff0c\u4f7f\u5f97\u5c06\u6765\u5728\u5206\u9875\u6a21\u5f0f\u4e0b\u8bbf\u95ee\u4e00\u4e2a\u865a\u62df\u9875(\u53c2\u6570 <code>va</code> )\u65f6\uff0c\u786c\u4ef6\uff08<code>nemu</code>\uff09\u8fdb\u884c page table walk \u540e\u5f97\u5230\u7684\u7269\u7406\u9875\uff0c\u6b63\u662f\u4e4b\u524d\u5728\u8c03\u7528<code>map()</code>\u65f6\u7ed9\u51fa\u7684\u76ee\u6807\u7269\u7406\u9875(\u53c2\u6570 <code>pa</code> )\u3002</p> <p>\u518d\u8be6\u7ec6\u4e00\u70b9\u5c31\u662f\uff0c<code>map</code> \u8981\u63d0\u53d6\u7ed9\u51fa\u7684 <code>va</code> \u4e2d\u7684\u5404\u4e2a\u4f4d\uff0c\u6b63\u786e\u5730\u653e\u5230\u4ee5\u53ca\u4e00\u7ea7\u9875\u8868\uff08\u9875\u76ee\u5f55\uff09\u3001\u4e8c\u7ea7\u9875\u8868\u4e2d\uff08\u8fd9\u91cc\u53ea\u5bf9\u4e8e <code>Sv32</code>\uff0c\u522b\u7684\u5206\u9875\u65b9\u6848\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u67e5\u9605\u76f8\u5173\u8d44\u6599\uff09\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u8981\u505a\u7684\u3002</p> </li> <li> <p>\u786c\u4ef6\u5c42\uff08<code>nemu</code>\uff09\u5b9e\u73b0\u5206\u9875\u673a\u5236</p> <p>\u6838\u5fc3\u529f\u80fd\uff1a</p> <ul> <li>\u5224\u65adCPU\u5f53\u524d\u662f\u5426\u5904\u4e8e\u5206\u9875\u6a21\u5f0f\u3002</li> <li>\u5206\u9875\u5730\u5740\u8f6c\u6362\u7684\u5177\u4f53\u8fc7\u7a0b\u3002</li> </ul> <pre><code>// \u68c0\u67e5\u5f53\u524d\u7cfb\u7edf\u72b6\u6001\u4e0b\u5bf9\u5185\u5b58\u533a\u95f4\u4e3a[vaddr, vaddr + len), \u7c7b\u578b\u4e3atype\u7684\u8bbf\u95ee\u662f\u5426\u9700\u8981\u7ecf\u8fc7\u5730\u5740\u8f6c\u6362.\nint isa_mmu_check(vaddr_t vaddr, int len, int type);\n\n// \u5bf9\u5185\u5b58\u533a\u95f4\u4e3a[vaddr, vaddr + len), \u7c7b\u578b\u4e3atype\u7684\u5185\u5b58\u8bbf\u95ee\u8fdb\u884c\u5730\u5740\u8f6c\u6362\npaddr_t isa_mmu_translate(vaddr_t vaddr, int len, int type);\n</code></pre> <p>\u8be6\u7ec6\u7684\u5185\u5bb9\u5177\u4f53\u67e5\u770b \u8bb2\u4e49 \u548c spec\u3002</p> </li> </ol> <p>\u6838\u5fc3\u601d\u60f3\uff1a\u8f6f\u786c\u4ef6\u534f\u540c\u3002<code>map()</code> \u9700\u8981\u6b63\u786e\u5730\u586b\u5199\u9875\u76ee\u5f55\u548c\u9875\u8868\u4e2d\u7684\u5185\u5bb9\uff0c\u786c\u4ef6 <code>nemu</code> page table work\uff0c\u5206\u9875\u5730\u5740\u8f6c\u6362\u624d\u80fd\u53d6\u5f97\u6b63\u786e\u7684\u7269\u7406\u9875\u3002</p> <ul> <li> <p>\u4e00\u4e9b\u95ee\u9898</p> <ul> <li> <p><code>__riscv_xlen</code> \u3001<code>__riscv</code> \u7b49\u8fd9\u4e9b\u5b8f\u5728\u54ea\u91cc\u5b9a\u4e49\uff1fam\u5c42\uff1f\u7ffb\u904d\u4e86\u5f88\u591a\u5730\u65b9\u90fd\u6ca1\u627e\u5230\u3002</p> <p>\u7f51\u4e0a\u627e\u4e86\u4e00\u4e0b\uff0c\u5b9e\u9645\u4e0a\u8fd9\u662f RISCV GCC \u5de5\u5177\u94fe\u9884\u5b9a\u4e49\u7684\u5b8f\u3002</p> <p>\u590d\u4e60\u4e00\u4e0b PA2 \u7684\u5185\u5bb9\uff0c\u627e\u5230 riscv\u5de5\u5177\u94fe\u7684\u76f8\u5173\u67b6\u6784\u5b9a\u4e49\uff1a</p> <pre><code>ARCH_H := arch/$(ARCH).h\nCFLAGS   += -O2 -MMD -Wall -Werror $(INCFLAGS) \\\n           -D__ISA__=\\\"$(ISA)\\\" -D__ISA_$(shell echo $(ISA) | tr a-z A-Z)__ \\\n           -D__ARCH__=$(ARCH) -D__ARCH_$(shell echo $(ARCH) | tr a-z A-Z | tr - _) \\\n           -__PLATFORM__=$(PLATFORM) -D__PLATFORM_$(shell echo $(PLATFORM) | tr a-z A-Z | tr - _) \\\n           -DARCH_H=\\\"$(ARCH_H)\\\" \\\n           -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector \\\n           -Wno-main -U_FORTIFY_SOURCE -fvisibility=hidden\n\n// abstract-machine/Makefile\n</code></pre> <pre><code>CROSS_COMPILE := riscv64-linux-gnu- \nCOMMON_CFLAGS := -fno-pic -march=rv64g -mcmodel=medany -mstrict-align\nCFLAGS        += $(COMMON_CFLAGS) -static                   \nASFLAGS       += $(COMMON_CFLAGS) -O0\nLDFLAGS       += -melf64lriscv                              \n\n# overwrite ARCH_H defined in $(AM_HOME)/Makefile\nARCH_H := arch/riscv.h\n\n// abstract-machine/scripts/isa/riscv.mk\n</code></pre> <pre><code>include $(AM_HOME)/scripts/isa/riscv.mk     \ninclude $(AM_HOME)/scripts/platform/nemu.mk\nCFLAGS  += -DISA_H=\\\"riscv/riscv.h\\\"\nCOMMON_CFLAGS += -march=rv32im_zicsr -mabi=ilp32   # overwrite\nLDFLAGS       += -melf32lriscv                     # overwrite\n\nAM_SRCS += riscv/nemu/start.S \\\n           riscv/nemu/cte.c \\\n           riscv/nemu/trap.S \\\n           riscv/nemu/vme.c\n\n//abstract-machine/scripts/riscv32-nemu.mk\n</code></pre> <p>\u8fd9\u91cc\u518d\u8fdb\u4e00\u6b65\u770b\u770b\u5177\u4f53\u7684\u7f16\u8bd1\u547d\u4ee4\uff1a</p> <pre><code>mkdir -p /home/jai/ysyx-workbench/abstract-machine/am/build/riscv32-nemu/src/riscv/nemu/ &amp;&amp; echo + CC src/riscv/nemu/vme.c\nriscv64-linux-gnu-gcc -std=gnu11 -O2 -MMD -Wall -Werror -I/home/jai/ysyx-workbench/abstract-machine/am/src -I/home/jai/ysyx-workbench/abstract-machine/am/include -I/home/jai/ysyx-workbench/abstract-machine/am/include/ -I/home/jai/ysyx-workbench/abstract-machine/klib/include/ -D__ISA__=\\\"riscv32\\\" -D__ISA_RISCV32__ -D__ARCH__=riscv32-nemu -D__ARCH_RISCV32_NEMU -D__PLATFORM__=nemu -D__PLATFORM_NEMU -DARCH_H=\\\"arch/riscv.h\\\" -fno-asynchronous-unwind-tables -fno-builtin -fno-stack-protector -Wno-main -U_FORTIFY_SOURCE -fvisibility=hidden -fno-pic -march=rv64g -mcmodel=medany -mstrict-align -march=rv32im_zicsr -mabi=ilp32    -static -fdata-sections -ffunction-sections -DMAINARGS=\\\"\\\" -I/home/jai/ysyx-workbench/abstract-machine/am/src/platform/nemu/include -DISA_H=\\\"riscv/riscv.h\\\" -c -o /home/jai/ysyx-workbench/abstract-machine/am/build/riscv32-nemu/src/riscv/nemu/vme.o /home/jai/ysyx-workbench/abstract-machine/am/src/riscv/nemu/vme.c\n</code></pre> <p>\u4e3b\u8981\u5728\u4e8e\u8fd9\u4e24\u4e2a\uff1a</p> <ul> <li><code>-march=rv32im_zicsr</code> \u6307\u5b9a\u4e86\u76ee\u6807\u67b6\u6784\u4e3aRISC-V 32\u4f4d\uff0c\u5305\u542b\u6574\u6570\u6307\u4ee4\u96c6\uff08I\uff09\u3001\u53ef\u9009\u7684\u6807\u51c6\u6269\u5c55\uff08M\uff09\u548cZicsr\uff08\u63a7\u5236\u548c\u72b6\u6001\u5bc4\u5b58\u5668\uff09\u3002</li> <li><code>-mabi=ilp32</code> \u6307\u5b9a\u4e86\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3\u4e3aILP32\uff0c\u8fd9\u662f\u4e00\u79cd32\u4f4d\u7684ABI\uff0c\u5176\u4e2dint\u3001long\u548c\u6307\u9488\u90fd\u662f32\u4f4d\u5bbd\u3002</li> </ul> <p>\u8fd9\u4e24\u8005\u5177\u4f53\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u8fd9\u91cc\u6211\u4eec\u6682\u65f6\u4e0d\u7ba1\uff0c\u6211\u4eec\u73b0\u5728\u77e5\u9053\uff0c\u8fd9\u662friscv32\u67b6\u6784\u7684\u3002</p> <p>\u5728\u7f16\u8bd1\u5668\u4e2d\uff0c<code>-m</code> \u53c2\u6570\u901a\u5e38\u7528\u6765\u6307\u5b9a\u76ee\u6807\u673a\u5668\u7684\u67b6\u6784\u6216\u8005\u7279\u5b9a\u7684\u67b6\u6784\u7279\u6027\u3002\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u53ef\u80fd\u652f\u6301\u4e0d\u540c\u7684 <code>-m</code> \u53c2\u6570\u9009\u9879\uff0c\u4f46\u5b83\u4eec\u5927\u591a\u6570\u9075\u5faa\u76f8\u4f3c\u7684\u6a21\u5f0f\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684 <code>-m</code> \u53c2\u6570\u53ca\u5176\u542b\u4e49\uff1a</p> <ol> <li> <p><code>-m32</code> \u6216 <code>-m64</code>\uff1a\u8fd9\u4e9b\u53c2\u6570\u6307\u5b9a\u751f\u621032\u4f4d\u621664\u4f4d\u4ee3\u7801\u3002\u5728\u67d0\u4e9b\u7f16\u8bd1\u5668\u4e2d\uff0c\u5b83\u4eec\u7528\u6765\u544a\u8bc9\u7f16\u8bd1\u5668\u751f\u6210\u9002\u7528\u4e8e32\u4f4d\u621664\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> </li> <li> <p><code>-march=&lt;architecture&gt;</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u7528\u6765\u6307\u5b9a\u76ee\u6807\u67b6\u6784\u3002\u4f8b\u5982\uff0c\u5728GCC\u4e2d\uff0c<code>-march=native</code> \u53ef\u4ee5\u544a\u8bc9\u7f16\u8bd1\u5668\u4f18\u5316\u4ee3\u7801\u4ee5\u9002\u5e94\u5f53\u524d\u7f16\u8bd1\u673a\u5668\u7684\u67b6\u6784\u3002</p> </li> <li> <p><code>-mtune=&lt;architecture&gt;</code>\uff1a\u4e0e <code>-march</code> \u7c7b\u4f3c\uff0c\u4f46\u8fd9\u4e2a\u53c2\u6570\u7528\u6765\u4f18\u5316\u4ee3\u7801\u4ee5\u9002\u5e94\u7279\u5b9a\u7684\u76ee\u6807\u67b6\u6784\uff0c\u800c\u4e0d\u662f\u5f53\u524d\u7f16\u8bd1\u673a\u5668\u7684\u67b6\u6784\u3002</p> </li> <li> <p><code>-mabi=&lt;ABI&gt;</code>\uff1aABI\u4ee3\u8868\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3\uff08Application Binary Interface\uff09\uff0c\u8fd9\u4e2a\u53c2\u6570\u7528\u6765\u6307\u5b9a\u7f16\u8bd1\u5668\u5e94\u8be5\u9075\u5faa\u7684ABI\u3002\u4e0d\u540c\u7684ABI\u5b9a\u4e49\u4e86\u6570\u636e\u7c7b\u578b\u7684\u5927\u5c0f\u3001\u5bf9\u9f50\u65b9\u5f0f\u3001\u51fd\u6570\u8c03\u7528\u7ea6\u5b9a\u7b49\u3002</p> </li> <li> <p><code>-msoft-float</code> \u6216 <code>-mhard-float</code>\uff1a\u8fd9\u4e9b\u53c2\u6570\u7528\u6765\u6307\u5b9a\u6d6e\u70b9\u6570\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002<code>-msoft-float</code> \u8868\u793a\u4f7f\u7528\u8f6f\u4ef6\u5e93\u6765\u5b9e\u73b0\u6d6e\u70b9\u6570\u8fd0\u7b97\uff0c\u800c <code>-mhard-float</code> \u8868\u793a\u4f7f\u7528\u786c\u4ef6\u6d6e\u70b9\u5355\u5143\u3002</p> </li> <li> <p><code>-mno-&lt;feature&gt;</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u7528\u6765\u7981\u7528\u7279\u5b9a\u7684\u67b6\u6784\u7279\u6027\u3002\u4f8b\u5982\uff0c<code>-mno-sse</code> \u53ef\u4ee5\u544a\u8bc9\u7f16\u8bd1\u5668\u4e0d\u8981\u4f7f\u7528SSE\u6307\u4ee4\u96c6\u3002</p> </li> <li> <p><code>-mgeneral-regs-only</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u5728\u67d0\u4e9b\u7f16\u8bd1\u5668\u4e2d\u7528\u6765\u6307\u5b9a\u4ee3\u7801\u53ea\u80fd\u4f7f\u7528\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u4e0d\u80fd\u4f7f\u7528\u7279\u6b8a\u7684\u5bc4\u5b58\u5668\u3002</p> </li> <li> <p><code>-mthumb</code> \u6216 <code>-marm</code>\uff1a\u5728ARM\u67b6\u6784\u4e2d\uff0c\u8fd9\u4e9b\u53c2\u6570\u7528\u6765\u6307\u5b9a\u751f\u6210Thumb\u6a21\u5f0f\u6216ARM\u6a21\u5f0f\u7684\u4ee3\u7801\u3002</p> </li> <li> <p><code>-mlittle-endian</code> \u6216 <code>-mbig-endian</code>\uff1a\u8fd9\u4e9b\u53c2\u6570\u7528\u6765\u6307\u5b9a\u751f\u6210\u5c0f\u7aef\u6216\u5927\u7aef\u5b57\u8282\u5e8f\u7684\u4ee3\u7801\u3002</p> </li> </ol> <p>\u8fd9\u4e9b\u53ea\u662f\u4e00\u4e9b\u4f8b\u5b50\uff0c\u5177\u4f53\u7684 <code>-m</code> \u53c2\u6570\u9009\u9879\u548c\u5b83\u4eec\u7684\u542b\u4e49\u53ef\u80fd\u4f1a\u6839\u636e\u7f16\u8bd1\u5668\u7684\u4e0d\u540c\u800c\u6709\u6240\u53d8\u5316\u3002\u5728\u4f7f\u7528\u65f6\uff0c\u5e94\u8be5\u67e5\u9605\u76f8\u5e94\u7f16\u8bd1\u5668\u7684\u6587\u6863\u6765\u83b7\u53d6\u51c6\u786e\u7684\u4fe1\u606f\u3002</p> <ol> <li> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff1a<code>vim empty.h</code></p> </li> <li> <p>\u7136\u540e\u4f7f\u7528 GCC -E \u9009\u9879\u5bf9 \u8be5\u6587\u4ef6\u8fdb\u884c\u9884\u5904\u7406\uff0c<code>-dM</code> \u9009\u9879\u8ba9\u7f16\u8bd1\u5668\u6253\u5370\u51fa\u6240\u6709\u7684\u9884\u5b9a\u4e49\u5b8f\u3002\u3002 <code>gcc -E -dM</code></p> </li> <li> <p>\u4f7f\u7528\u4e00\u6b3e\u5de5\u5177\u94fe\uff0cgnu\u7684\uff0c\u5404\u4e2a\u5382\u5bb6\u7684\u90fd\u884c\uff0c\u4e3b\u8981\u662f\u770b\u770b\u6548\u679c\uff0c\u8fd9\u91cc\u5c31\u6309\u4e0a\u9762\u7684\uff1a<code>riscv64-linux-gnu-gcc</code></p> <p>\u8fd9\u91cc\u768464\u4f4d\u5de5\u5177\u94fe\u9ed8\u8ba4\u517c\u5bb932\u4f4d\uff0c\u5176\u4ed6\u5382\u5bb6\u7684\u4e0d\u4e00\u5b9a\uff1f\uff08\u8fdb\u4e00\u6b65\u770b\u770b\u624b\u518c\uff09</p> </li> <li> <p>\u5982\u56fe</p> <p></p> </li> </ol> <p>\u786e\u5b9e\u6709\u60f3\u8981\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u518d\u56de\u53bb\u770b <code>trap.S</code> \u7684\u76f8\u5173\u4ee3\u7801\u5c31\u5f88\u6e05\u6670\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u901a\u8fc7\u8fd9\u79cd\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u7f16\u8bd1\u5668\u76f8\u5173\u5bf9 <code>riscv</code> \u7684\u914d\u7f6e\u4e86\u3002\u4ee5\u540e\u6211\u4eec\u518d\u9047\u5230\u4e00\u4e9b\u964c\u751f\u7684\u5b8f\u5b9a\u4e49\uff0c\u5728\u627e\u904d\u6240\u6709\u6e90\u4ee3\u7801\u90fd\u6ca1\u53d1\u73b0\u5176\u5728\u54ea\u91cc\u88ab\u5b9a\u4e49\u8fc7\uff0c\u5c31\u53ef\u4ee5\u60f3\u60f3\u8fd9\u4e9b\u5b8f\u5b9a\u4e49\u662f\u4e0d\u662f\u7cfb\u7edf\u7f16\u8bd1\u5668\u81ea\u5df1\u5b9a\u4e49\u7684\u3002</p> <p>\u989d\u5916\u770b\u770b\u5f00\u53d1\u8005\u4eec\u7684\u8ba8\u8bba\uff1a\u5173\u4e8egcc\u9884\u5b9a\u4e49\u5b8f \u00b7 Issue #46 \u00b7 loongson/LoongArch-Documentation (github.com)</p> </li> <li> <p><code>-ffreestanding</code>\uff1a\u5141\u8bb8\u7f16\u8bd1\u5668\u5728\u6ca1\u6709\u6807\u51c6C\u5e93\u652f\u6301\u7684\u60c5\u51b5\u4e0b\u7f16\u8bd1\u4ee3\u7801\u3002</p> </li> </ul> </li> </ul> <p><code>native</code>\u3001<code>riscv32-nemu</code> \u90fd\u8fd0\u884c\u6210\u529f\uff1a</p> <p></p> <p></p>"},{"location":"ysyx/pa/pa4/pa4.html#_20","title":"\u5728\u5206\u9875\u673a\u5236\u4e0a\u8fd0\u884c\u7528\u6237\u8fdb\u7a0b","text":"<ol> <li> <p>\u7a0b\u5e8f\u88c5\u8f7d</p> <ol> <li> <p>\u9996\u5148, \u7f16\u8bd1Navy\u5e94\u7528\u7a0b\u5e8f\u7684\u65f6\u5019\u9700\u8981\u4e3a<code>make</code>\u6dfb\u52a0<code>VME=1</code>\u7684\u53c2\u6570, \u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u94fe\u63a5\u5730\u5740\u6539\u4e3a<code>0x40000000</code>, \u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u7528\u6237\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0e\u5185\u6838\u76f8\u4e92\u91cd\u53e0, \u4ece\u800c\u4ea7\u751f\u975e\u9884\u671f\u7684\u9519\u8bef. </p> <p>\u8bb0\u5f97 <code>make update VME=1</code></p> <p>\u8fd9\u65f6, \"\u865a\u62df\u5730\u5740\u4f5c\u4e3a\u7269\u7406\u5730\u5740\u7684\u62bd\u8c61\"\u8fd9\u4e00\u597d\u5904\u5df2\u7ecf\u4f53\u73b0\u51fa\u6765\u4e86: \u539f\u5219\u4e0a\u7528\u6237\u8fdb\u7a0b\u53ef\u4ee5\u8fd0\u884c\u5728\u4efb\u610f\u7684\u865a\u62df\u5730\u5740, \u4e0d\u53d7\u7269\u7406\u5185\u5b58\u5bb9\u91cf\u7684\u9650\u5236. \u6211\u4eec\u8ba9\u7528\u6237\u8fdb\u7a0b\u7684\u4ee3\u7801\u4ece<code>0x40000000</code>\u9644\u8fd1\u5f00\u59cb, \u8fd9\u4e2a\u5730\u5740\u5df2\u7ecf\u4e0d\u5728\u7269\u7406\u5185\u5b58\u7684\u5730\u5740\u7a7a\u95f4\u4e2d(NEMU\u63d0\u4f9b\u7684\u7269\u7406\u5185\u5b58\u662f128MB), \u4f46\u5206\u9875\u673a\u5236\u4fdd\u8bc1\u4e86\u8fdb\u7a0b\u80fd\u591f\u6b63\u786e\u8fd0\u884c. </p> <p>\u8fd9\u6837, \u94fe\u63a5\u5668\u548c\u7a0b\u5e8f\u90fd\u4e0d\u9700\u8981\u5173\u5fc3\u7a0b\u5e8f\u8fd0\u884c\u65f6\u523b\u5177\u4f53\u4f7f\u7528\u54ea\u4e00\u6bb5\u7269\u7406\u5730\u5740, \u5b83\u4eec\u53ea\u8981\u4f7f\u7528\u865a\u62df\u5730\u5740\u5c31\u53ef\u4ee5\u4e86, \u800c\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u4e4b\u95f4\u7684\u6620\u5c04\u5219\u5168\u90e8\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u7684MM\u6765\u7ba1\u7406.</p> </li> <li> <p>\u6b64\u5916, \u6211\u4eec\u8fd8\u9700\u8981\u5bf9\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u8fdb\u884c\u8f83\u591a\u7684\u6539\u52a8. </p> <p>\u6211\u4eec\u9996\u5148\u9700\u8981\u5728\u52a0\u8f7d\u7528\u6237\u8fdb\u7a0b\u4e4b\u524d\u4e3a\u5176\u521b\u5efa\u5730\u5740\u7a7a\u95f4. \u7531\u4e8e\u5730\u5740\u7a7a\u95f4\u662f\u8fdb\u7a0b\u76f8\u5173\u7684, \u6211\u4eec\u5c06<code>AddrSpace</code>\u7ed3\u6784\u4f53\u4f5c\u4e3aPCB\u7684\u4e00\u90e8\u5206. \u8fd9\u6837\u4ee5\u540e, \u6211\u4eec\u53ea\u9700\u8981\u5728 <code>context_uload()</code> \u7684\u5f00\u5934\u8c03\u7528<code>protect()</code>, \u5c31\u53ef\u4ee5\u5b9e\u73b0\u5730\u5740\u7a7a\u95f4\u7684\u521b\u5efa. </p> <p>\u76ee\u524d\u8fd9\u4e2a\u5730\u5740\u7a7a\u95f4\u9664\u4e86\u5185\u6838\u6620\u5c04\u4e4b\u5916\u5c31\u6ca1\u6709\u5176\u5b83\u5185\u5bb9\u4e86, \u5177\u4f53\u53ef\u4ee5\u53c2\u8003<code>abstract-machine/am/src/$ISA/nemu/vme.c</code>.</p> </li> <li> <p>\u4e0d\u8fc7, \u6b64\u65f6<code>loader()</code>\u4e0d\u80fd\u76f4\u63a5\u628a\u7528\u6237\u8fdb\u7a0b\u52a0\u8f7d\u5230\u5185\u5b58\u4f4d\u7f6e<code>0x40000000</code>\u9644\u8fd1\u4e86, \u56e0\u4e3a\u8fd9\u4e2a\u5730\u5740\u5e76\u4e0d\u5728\u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d, \u5185\u6838\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u5b83. <code>loader()</code>\u8981\u505a\u7684\u4e8b\u60c5\u662f, \u83b7\u53d6\u7a0b\u5e8f\u7684\u5927\u5c0f\u4e4b\u540e, \u4ee5\u9875\u4e3a\u5355\u4f4d\u8fdb\u884c\u52a0\u8f7d:</p> <ul> <li>\u7533\u8bf7\u4e00\u9875\u7a7a\u95f2\u7684\u7269\u7406\u9875</li> <li>\u901a\u8fc7<code>map()</code>\u628a\u8fd9\u4e00\u7269\u7406\u9875\u6620\u5c04\u5230\u7528\u6237\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d. \u7531\u4e8eAM native\u5b9e\u73b0\u4e86\u6743\u9650\u68c0\u67e5, \u4e3a\u4e86\u8ba9\u7a0b\u5e8f\u53ef\u4ee5\u5728AM native\u4e0a\u6b63\u786e\u8fd0\u884c, \u4f60\u8c03\u7528<code>map()</code>\u7684\u65f6\u5019\u9700\u8981\u5c06<code>prot</code>\u8bbe\u7f6e\u6210\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c</li> <li>\u4ece\u6587\u4ef6\u4e2d\u8bfb\u5165\u4e00\u9875\u7684\u5185\u5bb9\u5230\u8fd9\u4e00\u7269\u7406\u9875\u4e2d</li> </ul> </li> </ol> <p>\u8fd9\u4e00\u5207\u90fd\u662f\u4e3a\u4e86\u8ba9\u7528\u6237\u8fdb\u7a0b\u5728\u5c06\u6765\u53ef\u4ee5\u6b63\u786e\u5730\u8fd0\u884c: \u7528\u6237\u8fdb\u7a0b\u5728\u5c06\u6765\u4f7f\u7528\u865a\u62df\u5730\u5740\u8bbf\u95ee\u5185\u5b58, \u5728loader\u4e3a\u7528\u6237\u8fdb\u7a0b\u7ef4\u62a4\u7684\u6620\u5c04\u4e0b, \u865a\u62df\u5730\u5740\u88ab\u8f6c\u6362\u6210\u7269\u7406\u5730\u5740, \u901a\u8fc7\u8fd9\u4e00\u7269\u7406\u5730\u5740\u8bbf\u95ee\u5230\u7684\u7269\u7406\u5185\u5b58, \u6070\u597d\u5c31\u662f\u7528\u6237\u8fdb\u7a0b\u60f3\u8981\u8bbf\u95ee\u7684\u6570\u636e.</p> </li> <li> <p>\u7528\u6237\u6808</p> <ol> <li> <p>\u548c<code>loader()</code>\u7c7b\u4f3c, \u6211\u4eec\u9700\u8981\u628a<code>new_page()</code>\u7533\u8bf7\u5f97\u5230\u7684\u7269\u7406\u9875\u901a\u8fc7<code>map()</code>\u6620\u5c04\u5230\u7528\u6237\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d. </p> <p>\u6211\u4eec\u628a\u7528\u6237\u6808\u7684\u865a\u62df\u5730\u5740\u5b89\u6392\u5728\u7528\u6237\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u672b\u5c3e, \u4f60\u53ef\u4ee5\u901a\u8fc7<code>as.area.end</code>\u6765\u5f97\u5230\u672b\u5c3e\u7684\u4f4d\u7f6e, \u7136\u540e\u628a\u7528\u6237\u6808\u7684\u7269\u7406\u9875\u6620\u5c04\u5230<code>[as.area.end - 32KB, as.area.end)</code>\u8fd9\u6bb5\u865a\u62df\u5730\u5740\u7a7a\u95f4.</p> </li> <li> <p>\u6700\u540e, \u4e3a\u4e86\u8ba9\u8fd9\u4e00\u5730\u5740\u7a7a\u95f4\u751f\u6548, \u6211\u4eec\u8fd8\u9700\u8981\u5c06\u5b83\u843d\u5b9e\u5230MMU\u4e2d. \u5177\u4f53\u5730, \u6211\u4eec\u5e0c\u671b\u5728CTE\u6062\u590d\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u7684\u65f6\u5019\u6765\u5207\u6362\u5730\u5740\u7a7a\u95f4. \u4e3a\u6b64, \u6211\u4eec\u9700\u8981\u5c06\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488<code>as-&gt;ptr</code>\u52a0\u5165\u5230\u4e0a\u4e0b\u6587\u4e2d, \u6846\u67b6\u4ee3\u7801\u5df2\u7ecf\u5b9e\u73b0\u4e86\u8fd9\u4e00\u529f\u80fd(\u89c1<code>abstract-machine/am/include/arch/$ISA-nemu.h</code>), \u5728x86\u4e2d\u8fd9\u4e00\u6210\u5458\u4e3a<code>cr3</code>, \u800c\u5728mips32/riscv32\u4e2d\u5219\u4e3a<code>pdir</code>. </p> <p>\u600e\u4e48\u7406\u89e3\u5730\u5740\u7a7a\u95f4\u8fd9\u4e2a\u4e1c\u897f\uff1f</p> <p>\u518d\uff1a</p> <ul> <li>\u4fee\u6539<code>ucontext()</code>\u7684\u5b9e\u73b0, \u5728\u521b\u5efa\u7684\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u8bbe\u7f6e\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488</li> <li>\u5728<code>__am_irq_handle()</code>\u7684\u5f00\u5934\u8c03\u7528<code>__am_get_cur_as()</code> (\u5728<code>abstract-machine/am/src/$ISA/nemu/vme.c</code>\u4e2d\u5b9a\u4e49), \u6765\u5c06\u5f53\u524d\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488\u4fdd\u5b58\u5230\u4e0a\u4e0b\u6587\u4e2d</li> <li>\u5728<code>__am_irq_handle()</code>\u8fd4\u56de\u524d\u8c03\u7528<code>__am_switch()</code> (\u5728<code>abstract-machine/am/src/$ISA/nemu/vme.c</code>\u4e2d\u5b9a\u4e49)\u6765\u5207\u6362\u5730\u5740\u7a7a\u95f4, \u5c06\u88ab\u8c03\u5ea6\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u843d\u5b9e\u5230MMU\u4e2d</li> </ul> </li> </ol> </li> </ol> <p>\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u8981\u533a\u5206\u4ee3\u7801\u6bb5\u548c\u6570\u636e\u6bb5\u662f\u5426\u5728\u540c\u4e00\u4e2a\u9875\u9762\u5417\uff1f \u7559\u5751</p> <ul> <li> <p>\u9009\u505a\u9898</p> <p>\u8ba9DiffTest\u652f\u6301\u5206\u9875\u673a\u5236(2)</p> <p>\u5982\u679c\u4f60\u9009\u62e9\u7684\u662friscv32, \u4e3a\u4e86\u8ba9 <code>DiffTest</code> \u673a\u5236\u6b63\u786e\u5730\u652f\u6301\u7528\u6237\u8fdb\u7a0b\u7684\u8fd0\u884c, \u4f60\u8fd8\u9700\u8981:</p> <ul> <li>\u5b9e\u73b0 <code>M</code> \u548c <code>U</code> \u4e24\u79cd\u7279\u6743\u7ea7\u6a21\u5f0f, \u5177\u4f53\u5730<ul> <li>\u5728NEMU\u4e2d\u5b9e\u73b0<code>mstatus.MPP</code>\u4f4d\u7684\u529f\u80fd</li> <li>\u6267\u884c<code>ecall</code>\u6307\u4ee4\u65f6, \u6839\u636e\u5f53\u524d\u7279\u6743\u7ea7\u629b\u51fa\u4e0d\u540c\u53f7\u7801\u7684\u5f02\u5e38, \u4f46\u5728CTE\u4e2d\u5bf9\u5b83\u4eec\u8fdb\u884c\u7edf\u4e00\u7684\u5904\u7406</li> <li>\u521b\u5efa\u5185\u6838\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u65f6, \u989d\u5916\u5c06<code>mstatus.MPP</code>\u8bbe\u7f6e\u4e3a<code>M</code>\u6a21\u5f0f</li> <li>\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u65f6, \u989d\u5916\u5c06<code>mstatus.MPP</code>\u8bbe\u7f6e\u4e3a<code>U</code>\u6a21\u5f0f</li> </ul> </li> <li>\u586b\u5199\u9875\u8868\u65f6, \u9700\u8981\u989d\u5916\u8bbe\u7f6e<code>R</code>, <code>W</code>, <code>X</code>, <code>U</code>, <code>A</code>, <code>D</code>\u4f4d</li> <li>\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u65f6, \u4e3a<code>mstatus</code>\u989d\u5916\u8bbe\u7f6e<code>MXR</code>\u548c<code>SUM</code>\u4f4d</li> </ul> <p>\u7559\u5751</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5185\u6838\u6620\u5c04\u7684\u4f5c\u7528</p> <p>\u5bf9\u4e8ex86\u548criscv32, \u5728<code>protect()</code>\u4e2d\u521b\u5efa\u5730\u5740\u7a7a\u95f4\u7684\u65f6\u5019, \u6709\u4e00\u5904\u4ee3\u7801\u7528\u4e8e\u62f7\u8d1d\u5185\u6838\u6620\u5c04:</p> <pre><code>// map kernel space\nmemcpy(updir, kas.ptr, PGSIZE);\n</code></pre> <p>\u5c1d\u8bd5\u6ce8\u91ca\u8fd9\u5904\u4ee3\u7801, \u91cd\u65b0\u7f16\u8bd1\u5e76\u8fd0\u884c, \u4f60\u4f1a\u770b\u5230\u53d1\u751f\u4e86\u9519\u8bef. \u8bf7\u89e3\u91ca\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u4e2a\u9519\u8bef.</p> <p></p> <p>\u9875\u76ee\u5f55\u9879\u5931\u6548\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u90fd\u5305\u542b\u4e86\u5185\u6838\u90e8\u5206\u7684\u5730\u5740\u6620\u5c04\u3002\u7c7b\u6bd4\u6bcf\u4e2a PCB \u5728\u5185\u6838\u6808\u90fd\u5b58\u7740 \u7528\u6237\u8fdb\u7a0b\u7684 <code>cp</code> \u6307\u9488\u3002</p> <p>\u5982\u679c\u4e0d\u8fdb\u884c\u62f7\u8d1d\u7684\u8bdd\uff0c\u90a3\u4e4b\u540e\u7528\u6237\u7a0b\u5e8f\u8bf7\u6c42\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u5185\u6838\u8d44\u6e90\u65f6\uff0c\u8bbf\u95ee\u7684\u5c31\u662f\u7528\u6237\u7a7a\u95f4\u7684\u5730\u5740\u4e86\uff08\u672c\u5e94\u8be5\u6620\u5c04\u5230\u5185\u6838\u7a7a\u95f4\u7684\u5730\u5740\uff09\u800c\u5728trap\u7684\u65f6\u5019\u6211\u4eec\u53c8\u6ca1\u6709\u8fdb\u884c\u5730\u5740\u7a7a\u95f4\u7684\u8f6c\u6362\uff08\u5373\u9875\u8868\u9879\u6ca1\u8f6c\u6362\uff09\uff0c\u81ea\u7136\u5c31\u662f\u6709\u95ee\u9898\u4e86\u3002</p> <p>\u60f3\u60f3\u5982\u679c\u5728 <code>trap.S</code> \u91cc\u505a\u8fd9\u4e2a\u8f6c\u6362\uff0c\u4f1a\u7f16\u5199\u8fd9\u4e2a\u5e94\u8be5\u5f88\u6076\u5fc3\uff0c\u5f00\u9500\u5e94\u8be5\u4e5f\u5f88\u5927\u3002</p> </li> <li> <p>bug</p> <p>\u5b9e\u73b0\u7684\u65f6\u5019\u6709\u70b9\u641e\u9519\u4e86 <code>brk</code> \u7684\u53c2\u6570\uff0c\u76f4\u63a5\u4f20\u4e86\u8981\u589e\u957f\u7684\u5b57\u8282\u6570\uff0c\u5e94\u8be5\u662f\u589e\u957f\u5230\u54ea\u4e2a\u5730\u5740 <code>program_break + increment</code> \uff0cbug\u4ece PA3 \u5230\u73b0\u5728\u624d\u53d1\u73b0\u3002\u3002\u3002</p> </li> <li> <p>\u9009\u505a\u9898</p> <p>native\u7684VME\u5b9e\u73b0</p> <p>\u5c1d\u8bd5\u9605\u8bfb<code>native</code>\u7684VME\u5b9e\u73b0, \u4f60\u53d1\u73b0<code>native</code>\u662f\u5982\u4f55\u5b9e\u73b0VME\u7684? \u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fd9\u6837\u505a?</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u53ef\u4ee5\u5728\u7528\u6237\u6808\u91cc\u9762\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5417?</p> <p><code>ucontext()</code>\u7684\u884c\u4e3a\u662f\u5728\u5185\u6838\u6808<code>kstack</code>\u4e2d\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587. \u6211\u4eec\u662f\u5426\u53ef\u4ee5\u5bf9<code>ucontext()</code>\u7684\u884c\u4e3a\u8fdb\u884c\u4fee\u6539, \u8ba9\u5b83\u5728\u7528\u6237\u6808\u4e0a\u521b\u5efa\u7528\u6237\u8fdb\u7a0b\u4e0a\u4e0b\u6587? \u4e3a\u4ec0\u4e48?</p> <p>\u82e5\u8981\u5728\u7528\u6237\u6808\u91cc\u9762\u521b\u5efa\uff0c\u8981\u8003\u8651\u4e0a\u4e0b\u6587\u7684\u4f4d\u7f6e\uff0c\u6808\u9876\u5b58\u653e\u4e86\u7528\u6237\u8fdb\u7a0b\u7684\u53c2\u6570\uff0c\u4e0a\u4e0b\u6587\u82e5\u7d27\u63a5\u7740\u5b58\u653e\uff0c\u53ef\u80fd\u4f1a\u88ab\u8986\u5199\u2026\u2026</p> <p>\u65e0\u8bba\u600e\u4e48\u653e\uff0c\u8981\u662f\u6709\u4e00\u5929\u6808\u6ee1\u4e86\uff0c\u4e0a\u4e0b\u6587\u4e5f\u5c31\u8986\u5199\u4e22\u4e86\uff0c\u8fdb\u7a0b\u5c31\u627e\u4e0d\u5230\u4e86\uff0c\u4e5f\u5c31\u662f\u6302\u4e86\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_21","title":"\u652f\u6301\u865a\u5b58\u7ba1\u7406\u7684\u591a\u9053\u7a0b\u5e8f","text":"<p>\u4e0d\u8fc7\u6211\u4eec\u4f1a\u53d1\u73b0, \u548c\u4e4b\u524d\u76f8\u6bd4, \u5728\u5206\u9875\u673a\u5236\u4e0a\u8fd0\u884c\u7684\u4ed9\u5251\u5947\u4fa0\u4f20\u7684\u6027\u80fd\u6709\u4e86\u660e\u663e\u7684\u4e0b\u964d. \u5c3d\u7ba1NEMU\u5728\u4e32\u884c\u6a21\u62dfMMU\u7684\u529f\u80fd, \u5e76\u4e0d\u80fd\u5b8c\u5168\u4ee3\u8868\u786c\u4ef6MMU\u7684\u771f\u5b9e\u8fd0\u884c\u60c5\u51b5, \u4f46\u8fd9\u4e5f\u8bf4\u660e\u4e86\u865a\u5b58\u673a\u5236\u786e\u5b9e\u4f1a\u5e26\u6765\u989d\u5916\u7684\u8fd0\u884c\u65f6\u5f00\u9500. \u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0, 60\u5e74\u4ee3\u7684\u5de5\u7a0b\u5e08\u666e\u904d\u5bf9\u865a\u5b58\u673a\u5236\u6709\u6240\u987e\u8651, \u4e0d\u6562\u8f7b\u6613\u5728\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u865a\u5b58\u673a\u5236. \u4f46\"\u4e0d\u5fc5\u4fee\u6539\u7a0b\u5e8f\u5373\u53ef\u8ba9\u591a\u4e2a\u7a0b\u5e8f\u5e76\u53d1\u8fd0\u884c\"\u7684\u597d\u5904\u8d8a\u6765\u8d8a\u660e\u663e, \u4ee5\u81f3\u4e8e\u865a\u5b58\u673a\u5236\u6210\u4e3a\u4e86\u73b0\u4ee3\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u6807\u914d.</p> <p>\u8fd9\u91cc\u5728\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u5e38\u5e38\u4e0d\u4f1a\u7528\u5230\u8fd9\u4e2a\u865a\u5b58\u7ba1\u7406\uff1f</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5e76\u53d1\u6267\u884c\u591a\u4e2a\u7528\u6237\u8fdb\u7a0b</p> <p>\u8ba9Nanos-lite\u52a0\u8f7d\u4ed9\u5251\u5947\u4fa0\u4f20\u548chello\u8fd9\u4e24\u4e2a\u7528\u6237\u8fdb\u7a0b; \u6216\u8005\u662f\u52a0\u8f7d NTerm \u548chello\u5185\u6838\u7ebf\u7a0b, \u7136\u540e\u4eceNTerm\u542f\u52a8\u4ed9\u5251\u5947\u4fa0\u4f20, \u4f60\u5e94\u8be5\u4f1a\u5728\u8fd0\u884c\u7684\u65f6\u5019\u89c2\u5bdf\u5230\u9519\u8bef. \u5c1d\u8bd5\u5206\u6790\u8fd9\u4e00\u9519\u8bef\u7684\u539f\u56e0, \u5e76\u603b\u7ed3\u4e3a\u4e86\u652f\u6301\u8fd9\u4e00\u529f\u80fd, \u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4ec0\u4e48\u6837\u7684\u6761\u4ef6.</p> <p>\u8fd9\u53ef\u4ee5\u8bf4\u662f\u4e00\u5468\u76ee\u6700\u96be\u7684\u4e00\u9053\u601d\u8003\u9898\u4e86, \u867d\u7136\u6211\u4eec\u4f1a\u5728PA4\u7684\u6700\u540e\u7ed9\u51fa\u5206\u6790, \u559c\u6b22\u6311\u6218\u7684\u540c\u5b66\u4ecd\u7136\u53ef\u4ee5\u5728\u8fd9\u91cc\u5c1d\u8bd5\u72ec\u7acb\u601d\u8003: \u5982\u679c\u4f60\u80fd\u72ec\u7acb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u8bf4\u660e\u4f60\u5bf9\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u7406\u89e3\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u4e86\u5f97\u4e86.</p> <p>Hint: \u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a.</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_22","title":"\u5206\u65f6\u591a\u4efb\u52a1","text":"<p>\u5982\u679c\u8981\u7528\u4e8e\u4ea4\u4e92\u5f0f\u573a\u666f\uff0c\u7cfb\u7edf\u5c31\u8981\u4ee5\u4e00\u5b9a\u7684\u9891\u7387\u5728\u6240\u6709\u8fdb\u7a0b\u4e4b\u95f4\u6765\u56de\u5207\u6362\uff0c\u4fdd\u8bc1\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u80fd\u53ca\u65f6\u5f97\u5230\u54cd\u5e94\uff0c\u8fd9\u5c31\u662f\u5206\u65f6\u591a\u4efb\u52a1\u3002\u4ece\u89e6\u53d1\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u89d2\u5ea6\u770b\uff0c\u5206\u65f6\u591a\u4efb\u52a1\u53ef\u4ee5\u5206\u6210\u4e24\u7c7b\uff1a </p> <ul> <li> <p>\u534f\u540c\u591a\u4efb\u52a1</p> <p>\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u57fa\u4e8e\u4e00\u4e2a\u7ea6\u5b9a: \u7528\u6237\u8fdb\u7a0b\u5468\u671f\u6027\u5730\u4e3b\u52a8\u8ba9\u51faCPU\u7684\u63a7\u5236\u6743, \u4ece\u800c\u8ba9\u5176\u5b83\u8fdb\u7a0b\u5f97\u5230\u8fd0\u884c\u7684\u673a\u4f1a. \u8fd9\u4ef6\u4e8b\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e00\u4e2a\u7279\u6b8a\u7684\u7cfb\u7edf\u8c03\u7528, \u90a3\u5c31\u662f\u6211\u4eec\u5728PA3\u4e2d\u5b9e\u73b0\u7684<code>SYS_yield</code>. \u5728PA3\u4e2d\u770b\u4f3c\u6ca1\u4ec0\u4e48\u7528\u7684<code>SYS_yield</code>, \u5176\u5b9e\u662f\u534f\u540c\u591a\u4efb\u52a1\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u57fa\u77f3.</p> </li> <li> <p>\u62a2\u5360\u591a\u4efb\u52a1</p> <p>\u5b83\u57fa\u4e8e\u786c\u4ef6\u4e2d\u65ad(\u901a\u5e38\u662f\u65f6\u949f\u4e2d\u65ad)\u5f3a\u884c\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362, \u8ba9\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u8fdb\u7a0b\u516c\u5e73\u5730\u8f6e\u6d41\u8fd0\u884c</p> </li> <li> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_23","title":"\u601d\u8003\u9898","text":"<p>\u5206\u65f6\u548c\u591a\u9053\u7a0b\u5e8f\u8fd9\u4e24\u8005\u5bb9\u6613\u641e\u6df7\uff1f\u8fd8\u6709\u6279\u5904\u7406\u7684\u6982\u5ff5\u3002</p> <p>\u9996\u5148\u6279\u5904\u7406\u7cfb\u7edf\u662f\u6bd4\u8f83\u57fa\u672c\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u8bf4\u8fd8\u6ca1\u6709\u5b9e\u73b0\u591a\u4efb\u52a1\uff0c\u7a0b\u5e8f\u987a\u5e8f\u6267\u884c\u3002</p> <p>\u5176\u6b21\u591a\u9053\u7a0b\u5e8f\u662f\u5728\u6279\u5904\u7406\u7cfb\u7edf\u7684\u57fa\u7840\u4e0a\u53d1\u5c55\u8d77\u6765\u7684\uff0c\u5b83\u5141\u8bb8\u591a\u4e2a\u7a0b\u5e8f\u540c\u65f6\u5728\u5185\u5b58\u4e2d\uff0c\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u963b\u585e\u65f6\uff0c\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u4f46\u5b83\u901a\u5e38\u4e0d\u652f\u6301\u7528\u6237\u4ea4\u4e92\u3002</p> <p>\u6700\u540e\u5206\u65f6\u591a\u4efb\u52a1\u8fdb\u4e00\u6b65\u53d1\u5c55\uff0c\u5141\u8bb8\u591a\u4e2a\u7a0b\u5e8f\u201c\u540c\u65f6\u201d\u8fd0\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u54cd\u5e94\u7528\u6237\u7684\u4ea4\u4e92\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u54cd\u5e94\u6027\u3002</p>"},{"location":"ysyx/pa/pa4/pa4.html#_24","title":"\u6765\u81ea\u5916\u90e8\u7684\u58f0\u97f3","text":"<p>\u6211\u4eec\u5e0c\u671b\u8fbe\u5230\u8fd9\u6837\u4e00\u79cd\u6548\u679c\uff1a\u65f6\u95f4\u4e00\u5230, \u65e0\u8bba\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u6709\u591a\u4e0d\u60c5\u613f\uff0c\u64cd\u4f5c\u7cfb\u7edf\u90fd\u8981\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u5b9e\u73b0\u8fd9\u79cd\u6548\u679c\u7684\u5173\u952e\u5c31\u5728\u4e8e \u65f6\u949f\u3002IOE \u4e2d\u6211\u4eec\u5df2\u7ecf\u52a0\u5165\u4e86\u65f6\u949f\u4e86\uff0c\u4f46\u662f\u8fd8\u4e0d\u80fd\u8fbe\u5230\u6211\u4eec\u7684\u8981\u6c42\uff1a\u6211\u4eec\u5e0c\u671b\u59cb\u7ec8\u80fd\u591f\u4e3b\u52a8\u5730\u901a\u77e5\u5904\u7406\u5668\uff0c\u800c\u4e0d\u662f\u88ab\u52a8\u7684\u7b49\u7740\u5904\u7406\u5668\u6765\u8bbf\u95ee\u3002</p> <p>\u8fd9\u6837\u7684\u901a\u77e5\u673a\u5236\uff0c\u5728\u8ba1\u7b97\u673a\u4e2d\u79f0\u4e3a\u786c\u4ef6\u4e2d\u65ad\u3002\u786c\u4ef6\u4e2d\u65ad\u7684\u5b9e\u8d28\u662f\u4e00\u4e2a\u6570\u5b57\u4fe1\u53f7\uff0c\u5f53\u8bbe\u5907\u6709\u4e8b\u4ef6\u9700\u8981\u901a\u77e5 CPU \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u51fa\u4e2d\u65ad\u4fe1\u53f7\u3002\u8fd9\u4e2a\u4fe1\u53f7\u6700\u7ec8\u4f1a\u4f20\u5230 CPU \u4e2d\uff0c\u5f15\u8d77 CPU \u7684\u6ce8\u610f\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u89e3\u51b3\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ol> <li> <p>\u4e2d\u65ad\u4fe1\u53f7\u600e\u4e48\u4f20\u9012\u5230 CPU \u4e2d\u7684\uff1f</p> <p>\u652f\u6301\u4e2d\u65ad\u673a\u5236\u7684\u8bbe\u5907\u63a7\u5236\u5668\u90fd\u6709\u4e00\u4e2a\u4e2d\u65ad\u5f15\u811a, \u8fd9\u4e2a\u5f15\u811a\u4f1a\u548cCPU\u7684INTR\u5f15\u811a\u76f8\u8fde, \u5f53\u8bbe\u5907\u9700\u8981\u53d1\u51fa\u4e2d\u65ad\u8bf7\u6c42\u7684\u65f6\u5019, \u5b83\u53ea\u8981\u5c06\u4e2d\u65ad\u5f15\u811a\u7f6e\u4e3a\u9ad8\u7535\u5e73, \u4e2d\u65ad\u4fe1\u53f7\u5c31\u4f1a\u4e00\u76f4\u4f20\u5230CPU\u7684INTR\u5f15\u811a\u4e2d. \u4f46\u8ba1\u7b97\u673a\u4e0a\u901a\u5e38\u6709\u591a\u4e2a\u8bbe\u5907, \u800cCPU\u5f15\u811a\u662f\u5728\u5236\u9020\u7684\u65f6\u5019\u5c31\u56fa\u5b9a\u4e86, \u56e0\u800c\u5728CPU\u7aef\u4e3a\u6bcf\u4e00\u4e2a\u8bbe\u5907\u4e2d\u65ad\u5206\u914d\u4e00\u4e2a\u5f15\u811a\u7684\u505a\u6cd5\u662f\u4e0d\u73b0\u5b9e\u7684.</p> <p>\u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u5404\u79cd\u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42, IBM PC\u517c\u5bb9\u673a\u4e2d\u90fd\u4f1a\u5e26\u6709Intel 8259 PIC(Programmable Interrupt Controller, \u53ef\u7f16\u7a0b\u4e2d\u65ad\u63a7\u5236\u5668), \u800cRISC-V\u7cfb\u7edf\u4e2d\u7528\u5f97\u6bd4\u8f83\u591a\u7684\u4e2d\u65ad\u63a7\u5236\u5668\u5219\u662fPLIC(Platform Level Interrupt Controller)\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00. \u4e2d\u65ad\u63a7\u5236\u5668\u6700\u4e3b\u8981\u7684\u4f5c\u7528\u5c31\u662f\u5145\u5f53\u8bbe\u5907\u4e2d\u65ad\u4fe1\u53f7\u7684\u591a\u8def\u590d\u7528\u5668, \u5373\u5728\u591a\u4e2a\u8bbe\u5907\u4e2d\u65ad\u4fe1\u53f7\u4e2d\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u4fe1\u53f7, \u7136\u540e\u8f6c\u53d1\u7ed9CPU.</p> </li> <li> <p>CPU \u5982\u4f55\u54cd\u5e94\u5230\u6765\u7684\u4e2d\u65ad\uff0c\u4e5f\u5c31\u662f\u5177\u4f53\u7684\u4e2d\u65ad\u54cd\u5e94\u6d41\u7a0b\uff08\u540c\u4e4b\u524d\u7684\u5f02\u5e38\u5904\u7406\u5341\u5206\u76f8\u4f3c\uff09\uff1a</p> <p>CPU \u6bcf\u6b21\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u770b\u770b INTR \u5f15\u811a\uff0c\u770b\u662f\u5426\u6709\u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42\u5230\u6765\u3002</p> <p>\u5982\u679c\u4e2d\u65ad\u5230\u6765\uff1a</p> <p>\u5f53CPU\u5904\u4e8e\u5173\u4e2d\u65ad\u72b6\u6001\uff0c\u6b64\u65f6\u5373\u4f7fINTR\u5f15\u811a\u4e3a\u9ad8\u7535\u5e73\uff0cCPU\u4e5f\u4e0d\u4f1a\u54cd\u5e94\u4e2d\u65ad\u3002</p> <p>\u5f53CPU\u6ca1\u6709\u5904\u4e8e\u5173\u4e2d\u65ad\u72b6\u6001\uff0c\u5b83\u9a6c\u4e0a\u54cd\u5e94\u5230\u6765\u7684\u4e2d\u65ad\u8bf7\u6c42\u3002\u6211\u4eec\u521a\u624d\u63d0\u5230\u4e2d\u65ad\u63a7\u5236\u5668\u4f1a\u751f\u6210\u4e00\u4e2a\u4e2d\u65ad\u53f7\uff0cCPU\u5c06\u4f1a\u4fdd\u5b58\u4e2d\u65ad\u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u4e2d\u65ad\u4f5c\u4e3a\u5f02\u5e38\u5904\u7406\u8fc7\u7a0b\u7684\u539f\u56e0\uff0c\u627e\u5230\u5e76\u8df3\u8f6c\u5230\u5165\u53e3\u5730\u5740\uff0c\u8fdb\u884c\u4e00\u4e9b\u548c\u8bbe\u5907\u76f8\u5173\u7684\u5904\u7406\u3002</p> <p>\u6ce8\u610f\uff1aCPU\u7684\u5173\u4e2d\u65ad\u72b6\u6001\u548c\u4e2d\u65ad\u63a7\u5236\u5668\u662f\u72ec\u7acb\u7684\uff0c\u4e2d\u65ad\u63a7\u5236\u5668\u53ea\u8d1f\u8d23\u8f6c\u53d1\u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42\uff0c\u6700\u7ec8CPU\u662f\u5426\u54cd\u5e94\u4e2d\u65ad\u8fd8\u9700\u8981\u7531CPU\u7684\u72b6\u6001\u51b3\u5b9a\u3002</p> </li> </ol> <p>\u7279\u522b\u7684\u5bf9\u4e8e <code>riscv32</code>\uff1a\u5982\u679c <code>mstatus</code> \u4e2d\u7684 MIE \u4f4d\u4e3a0, \u5219 CPU \u5904\u4e8e\u5173\u4e2d\u65ad\u72b6\u6001\u3002</p> <p>\u4e8b\u5b9e\u4e0a, <code>riscv32</code> \u6807\u51c6\u7684\u4e2d\u65ad\u54cd\u5e94\u673a\u5236\u8fd8\u6709\u66f4\u591a\u5185\u5bb9\uff0cPA \u4e2d\u7b80\u5316\u4e86\uff0c\u66f4\u591a\u5185\u5bb9\u67e5\u770b\u624b\u518c\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5bf9CPU\u6765\u8bf4, \u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42\u4f55\u65f6\u5230\u6765\u662f\u4e0d\u53ef\u9884\u6d4b\u7684, \u5728\u5904\u7406\u4e00\u4e2a\u4e2d\u65ad\u8bf7\u6c42\u7684\u65f6\u5019\u5230\u6765\u4e86\u53e6\u4e00\u4e2a\u4e2d\u65ad\u8bf7\u6c42\u4e5f\u662f\u6709\u53ef\u80fd\u7684. \u5982\u679c\u5e0c\u671b\u652f\u6301\u4e2d\u65ad\u5d4c\u5957 -- \u5373\u5728\u8fdb\u884c\u4f18\u5148\u7ea7\u4f4e\u7684\u4e2d\u65ad\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d, \u54cd\u5e94\u53e6\u4e00\u4e2a\u4f18\u5148\u7ea7\u9ad8\u7684\u4e2d\u65ad -- \u90a3\u4e48\u5806\u6808\u5c06\u662f\u4fdd\u5b58\u4e2d\u65ad\u4e0a\u4e0b\u6587\u4fe1\u606f\u7684\u552f\u4e00\u9009\u62e9. \u5982\u679c\u9009\u62e9\u628a\u4e0a\u4e0b\u6587\u4fe1\u606f\u4fdd\u5b58\u5728\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9, \u53d1\u751f\u4e2d\u65ad\u5d4c\u5957\u7684\u65f6\u5019, \u7b2c\u4e00\u6b21\u4e2d\u65ad\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u5c06\u4f1a\u88ab\u4f18\u5148\u7ea7\u9ad8\u7684\u4e2d\u65ad\u5904\u7406\u8fc7\u7a0b\u6240\u8986\u76d6, \u4ece\u800c\u9020\u6210\u707e\u96be\u6027\u7684\u540e\u679c.</p> <p>\u707e\u96be\u6027\u7684\u540e\u679c(\u8fd9\u4e2a\u95ee\u9898\u6709\u70b9\u96be\u5ea6)</p> <p>\u5047\u8bbe\u786c\u4ef6\u628a\u4e2d\u65ad\u4fe1\u606f\u56fa\u5b9a\u4fdd\u5b58\u5728\u67d0\u4e2a\u5185\u5b58\u5730\u5740(\u4f8b\u5982<code>0x1000</code>)\u7684\u4f4d\u7f6e, AM\u4e5f\u603b\u662f\u4ece\u8fd9\u91cc\u5f00\u59cb\u6784\u9020\u4e0a\u4e0b\u6587. \u5982\u679c\u53d1\u751f\u4e86\u4e2d\u65ad\u5d4c\u5957, \u5c06\u4f1a\u53d1\u751f\u4ec0\u4e48\u6837\u7684\u707e\u96be\u6027\u540e\u679c? \u8fd9\u4e00\u707e\u96be\u6027\u7684\u540e\u679c\u5c06\u4f1a\u4ee5\u4ec0\u4e48\u6837\u7684\u5f62\u5f0f\u8868\u73b0\u51fa\u6765? \u5982\u679c\u4f60\u89c9\u5f97\u6beb\u65e0\u5934\u7eea, \u4f60\u53ef\u4ee5\u7528\u7eb8\u7b14\u6a21\u62df\u4e2d\u65ad\u5904\u7406\u7684\u8fc7\u7a0b.</p> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u652f\u6301\u4e2d\u65ad\u5d4c\u5957</p> <p>\u601d\u8003\u4e00\u4e0b, x86, mips32\u548criscv32\u7684\u8f6f\u786c\u4ef6\u8be5\u5206\u522b\u5982\u4f55\u534f\u540c, \u6765\u652f\u6301\u4e2d\u65ad\u5d4c\u5957?</p> <p>\u652f\u6301\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u4e2d\u65ad\u3002\u4e0d\u540c\u7684 ISA \u600e\u4e48\u505a\u7684</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_25","title":"\u62a2\u5360\u591a\u4efb\u52a1","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u53eb\u8fd9\u4e2a\u540d\u5b57\uff1f</p> <p>\u5728 NEMU \u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6dfb\u52a0\u65f6\u949f\u4e2d\u65ad\u8fd9\u4e00\u79cd\u4e2d\u65ad\u5c31\u53ef\u4ee5\u4e86\u3002\u7531\u4e8e\u53ea\u6709\u4e00\u79cd\u4e2d\u65ad\uff0c\u6211\u4eec\u4e5f\u4e0d\u9700\u8981\u901a\u8fc7\u4e2d\u65ad\u63a7\u5236\u5668\u8fdb\u884c\u4e2d\u65ad\u7684\u7ba1\u7406\uff0c\u76f4\u63a5\u8ba9\u65f6\u949f\u4e2d\u65ad\u8fde\u63a5\u5230 CPU \u7684 INTR \u5f15\u811a\u5373\u53ef\u3002\uff08\u65f6\u949f\u4e2d\u65ad\u7684\u4e2d\u65ad\u53f7\uff0c\u4e0d\u540c\u7684ISA\u6709\u4e0d\u540c\u7684\u7ea6\u5b9a\uff09</p> <p>\u5b9e\u73b0\u57fa\u4e8e\u786c\u4ef6\u4e2d\u65ad\u7684\u62a2\u5360\u591a\u4efb\u52a1\uff0c\u5177\u4f53\u8981\u505a\u7684\uff1a</p> <ol> <li> <p>\u786c\u4ef6\u5c42\uff08<code>nemu</code>\uff09\uff1a</p> <p>\u65f6\u949f\u4e2d\u65ad\u901a\u8fc7<code>nemu/src/device/timer.c</code>\u4e2d\u7684<code>timer_intr()</code>\u89e6\u53d1, \u6bcf10ms\u89e6\u53d1\u4e00\u6b21. \u89e6\u53d1\u540e, \u4f1a\u8c03\u7528<code>dev_raise_intr()</code>\u51fd\u6570(\u5728<code>nemu/src/device/intr.c</code>\u4e2d\u5b9a\u4e49). \u4f60\u9700\u8981:</p> <ul> <li> <p>\u5728cpu\u7ed3\u6784\u4f53\u4e2d\u6dfb\u52a0\u4e00\u4e2a<code>bool</code>\u6210\u5458<code>INTR</code>.</p> </li> <li> <p>\u5728<code>dev_raise_intr()</code>\u4e2d\u5c06INTR\u5f15\u811a\u8bbe\u7f6e\u4e3a\u9ad8\u7535\u5e73.</p> </li> <li> <p>\u5728<code>cpu_exec()</code>\u4e2dfor\u5faa\u73af\u7684\u672b\u5c3e\u6dfb\u52a0\u8f6e\u8be2INTR\u5f15\u811a\u7684\u4ee3\u7801, \u6bcf\u6b21\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4\u5c31\u67e5\u770b\u662f\u5426\u6709\u786c\u4ef6\u4e2d\u65ad\u5230\u6765:</p> <pre><code>word_t intr = isa_query_intr();\nif (intr != INTR_EMPTY) {\n  cpu.pc = isa_raise_intr(intr, cpu.pc);\n}\n</code></pre> </li> <li> <p>\u5b9e\u73b0<code>isa_query_intr()</code>\u51fd\u6570(\u5728<code>nemu/src/isa/$ISA/system/intr.c</code>\u4e2d\u5b9a\u4e49):</p> <pre><code>#define IRQ_TIMER 32          // for x86\n#define IRQ_TIMER 0           // for mips32\n#define IRQ_TIMER 0x80000007  // for riscv32\n#define IRQ_TIMER 0x8000000000000007  // for riscv64\n\nword_t isa_query_intr() {\n  if ( ??? ) {\n    cpu.INTR = false;\n    return IRQ_TIMER;\n  }\n  return INTR_EMPTY;\n}\n</code></pre> <p>\u8fd9\u91cc\u518d\u770b\u770b\u624b\u518c\u89c4\u5b9a\u7684\u65f6\u949f\uff08\u5b9a\u65f6\u5668\uff09\u4e2d\u65ad\u53f7</p> <p></p> </li> <li> <p>\u4fee\u6539 <code>isa_raise_intr()</code>\u4e2d\u7684\u4ee3\u7801, \u8ba9\u5904\u7406\u5668\u8fdb\u5165\u5173\u4e2d\u65ad\u72b6\u6001:</p> <ul> <li>riscv32 - \u5c06mstatus.MIE\u4fdd\u5b58\u5230mstatus.MPIE\u4e2d, \u7136\u540e\u5c06mstatus.MIE\u4f4d\u7f6e\u4e3a 0<ul> <li>\u4fee\u6539mret\u6307\u4ee4\u7684\u5b9e\u73b0, \u5c06mstatus.MPIE\u8fd8\u539f\u5230mstatus.MIE\u4e2d, \u7136\u540e\u5c06mstatus.MPIE\u4f4d\u7f6e\u4e3a<code>1</code></li> </ul> </li> </ul> </li> </ul> <p>\u53e6\u5916\uff0c\u5173\u4e8e\u65f6\u95f4\u4e2d\u65ad\u7684\u786c\u4ef6\u5b9e\u73b0\uff1a</p> <p>\u505a\u5230\u8fd9\u91cc\uff0c\u5b9e\u73b0\u4e86 <code>NDL_GetTicks</code> \uff0c\u4e0b\u9762\u7684\u5185\u5bb9\u5e94\u8be5\u90fd\u5f88\u5bb9\u6613\u770b\u61c2\u7684\u3002</p> <pre><code>...\n    // \u6bcf\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4\u68c0\u6d4b\u4e00\u904d\uff0c\u8fd9\u91cc\u4e5f\u80fd\u770b\u51fa\u901a\u8fc7\u8fd9\u4e2a\u5b9a\u65f6\u5668\u5237\u5c4f\u5e55\nvoid device_update() {\n  static uint64_t last = 0;\n  uint64_t now = get_time();\n  if (now - last &lt; 1000000 / TIMER_HZ) {\n    return;\n  }\n  last = now;\n  IFDEF(CONFIG_HAS_VGA, vga_update_screen());\n  ...\n}\n...\n//nemu/src/device/device.c\n\nstatic uint64_t get_time_internal() {\n#if defined(CONFIG_TARGET_AM)\n  uint64_t us = io_read(AM_TIMER_UPTIME).us;\n#elif defined(CONFIG_TIMER_GETTIMEOFDAY)\n  struct timeval now;\n  gettimeofday(&amp;now, NULL);\n  uint64_t us = now.tv_sec * 1000000 + now.tv_usec;\n#else\n  struct timespec now;\n  clock_gettime(CLOCK_MONOTONIC_COARSE, &amp;now);\n  uint64_t us = now.tv_sec * 1000000 + now.tv_nsec / 1000;\n#endif\n  return us;\n}\nuint64_t get_time() {\n  if (boot_time == 0) boot_time = get_time_internal();\n  uint64_t now = get_time_internal();\n  return now - boot_time;\n}\n//nemu/src/utils/timer.c\n\n#define TIMER_HZ 60\n\nvoid add_alarm_handle(alarm_handler_t h) {\n  assert(idx &lt; MAX_HANDLER);\n  handler[idx ++] = h;\n}\nstatic void alarm_sig_handler(int signum) {\n  int i;\n  for (i = 0; i &lt; idx; i ++) {\n    handler[i]();\n  }\n}\nvoid init_alarm() {\n  struct sigaction s;\n  memset(&amp;s, 0, sizeof(s));\n  s.sa_handler = alarm_sig_handler;\n  int ret = sigaction(SIGVTALRM, &amp;s, NULL);\n  Assert(ret == 0, \"Can not set signal handler\");\n\n  struct itimerval it = {};\n  it.it_value.tv_sec = 0;\n  it.it_value.tv_usec = 1000000 / TIMER_HZ;\n  it.it_interval = it.it_value;\n  ret = setitimer(ITIMER_VIRTUAL, &amp;it, NULL);\n  Assert(ret == 0, \"Can not set timer\");\n}\n//nemu/src/device/alarm.c\n#define TIMER_HZ 100\n//nemu/include/device/alarm.h\n</code></pre> <p>\u901a\u8fc7\u4fe1\u53f7\u548c\u5b9a\u65f6\u5668\u6765\u5b9e\u73b0\u5468\u671f\u6027\u7684\u56de\u8c03\u51fd\u6570\u8c03\u7528\u3002\u901a\u8fc7 <code>setitimer</code> \u8c03\u7528\uff0c\u5b9a\u65f6\u5668\u88ab\u8bbe\u7f6e\u4e3a\u6bcf\u9694\u4e00\u5b9a\u65f6\u95f4\uff08\u7531 <code>TIMER_HZ</code> \u51b3\u5b9a\uff09\u89e6\u53d1\u4e00\u6b21\uff0c\u6bcf\u6b21\u89e6\u53d1\u90fd\u4f1a\u6267\u884c\u6240\u6709\u6ce8\u518c\u7684\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u4e5f\u662f\u4e00\u79cd\u5728\u64cd\u4f5c\u7cfb\u7edf\u6216\u6a21\u62df\u5668\u4e2d\u5b9e\u73b0\u5468\u671f\u6027\u4efb\u52a1\u7684\u5e38\u89c1\u65b9\u6cd5\u3002</p> <p>10 <sup>6</sup> / TIMER_HZ = 16666.6667 \u5fae\u79d2\uff0c\u5373\u5b9a\u65f6\u5668\u4f1a\u6bcf\u9694\u5927\u7ea6 16.67 \u6beb\u79d2\u89e6\u53d1\u4e00\u6b21 <code>alarm_sig_handler</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u8c03\u7528\u6240\u6709\u6ce8\u518c\u7684\u56de\u8c03\u51fd\u6570\u3002</p> <p>\u4f46\u662f\u597d\u50cf\u4e0d\u662f\u8bb2\u4e49\u8bb2\u5230\u7684 10ms\u3002\u6240\u4ee5\u6211\u6539\u9519\u4e86 100Hz</p> <p>\u76f8\u5173\u7ed3\u6784\u4f53\u7684\u4f7f\u7528\uff0c\u4e3b\u8981\u662f\u5206\u6790 <code>init_alarm</code> </p> <ul> <li> <p><code>sigaction</code> \u7ed3\u6784\u4f53</p> <ul> <li> <p><code>sigaction</code> \u7ed3\u6784\u4f53\u7528\u4e8e\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u7684\u884c\u4e3a\u3002\u5b83\u5141\u8bb8\u7a0b\u5e8f\u6307\u5b9a\u5982\u4f55\u5904\u7406\u7279\u5b9a\u7684\u4fe1\u53f7\u3002\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u5b83\u88ab\u7528\u6765\u8bbe\u7f6e <code>SIGVTALRM</code> \u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\u3002</p> <pre><code>struct sigaction s;\nmemset(&amp;s, 0, sizeof(s));\ns.sa_handler = alarm_sig_handler;\nint ret = sigaction(SIGVTALRM, &amp;s, NULL);\nAssert(ret == 0, \"Can not set signal handler\");\n</code></pre> <ul> <li><code>struct sigaction s;</code> \u58f0\u660e\u4e86\u4e00\u4e2a <code>sigaction</code> \u7ed3\u6784\u4f53\u53d8\u91cf <code>s</code>\u3002</li> <li><code>memset(&amp;s, 0, sizeof(s));</code> \u4f7f\u7528 <code>memset</code> \u51fd\u6570\u5c06 <code>s</code> \u7684\u5185\u5bb9\u5168\u90e8\u521d\u59cb\u5316\u4e3a0\u3002</li> <li><code>s.sa_handler = alarm_sig_handler;</code> \u8bbe\u7f6e <code>s</code> \u7684 <code>sa_handler</code> \u6210\u5458\u4e3a <code>alarm_sig_handler</code> \u51fd\u6570\uff0c\u8fd9\u610f\u5473\u7740\u5f53 <code>SIGVTALRM</code> \u4fe1\u53f7\u53d1\u751f\u65f6\uff0c<code>alarm_sig_handler</code> \u51fd\u6570\u5c06\u88ab\u8c03\u7528\u3002</li> <li><code>int ret = sigaction(SIGVTALRM, &amp;s, NULL);</code> \u8c03\u7528 <code>sigaction</code> \u51fd\u6570\uff0c\u6ce8\u518c <code>SIGVTALRM</code> \u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\u3002<code>ret</code> \u7528\u4e8e\u63a5\u6536\u8fd4\u56de\u503c\u3002</li> <li><code>Assert(ret == 0, \"Can not set signal handler\");</code> \u65ad\u8a00\u68c0\u67e5\uff0c\u786e\u4fdd\u4fe1\u53f7\u5904\u7406\u5668\u8bbe\u7f6e\u6210\u529f\u3002</li> </ul> </li> </ul> </li> <li> <p><code>itimerval</code> \u7ed3\u6784\u4f53</p> <ul> <li> <p><code>itimerval</code> \u7ed3\u6784\u4f53\u7528\u4e8e\u8bbe\u7f6e\u548c\u83b7\u53d6\u8ba1\u65f6\u5668\uff0c\u5b83\u5b9a\u4e49\u4e86\u8ba1\u65f6\u5668\u7684\u5f53\u524d\u503c\u548c\u4e0b\u4e00\u6b21\u89e6\u53d1\u7684\u95f4\u9694\u3002</p> <pre><code>struct itimerval it = {};\nit.it_value.tv_sec = 0;\nit.it_value.tv_usec = 1000000 / TIMER_HZ;\nit.it_interval = it.it_value;\nret = setitimer(ITIMER_VIRTUAL, &amp;it, NULL);\nAssert(ret == 0, \"Can not set timer\");\n</code></pre> <ul> <li><code>struct itimerval it = {};</code> \u58f0\u660e\u4e86\u4e00\u4e2a <code>itimerval</code> \u7ed3\u6784\u4f53\u53d8\u91cf <code>it</code> \u5e76\u4f7f\u7528\u9ed8\u8ba4\u521d\u59cb\u5316\uff08\u6240\u6709\u6210\u5458\u521d\u59cb\u5316\u4e3a0\uff09\u3002</li> <li><code>it.it_value.tv_sec = 0;</code> \u8bbe\u7f6e\u8ba1\u65f6\u5668\u7684\u8d77\u59cb\u65f6\u95f4\u4e3a0\u79d2\u3002</li> <li><code>it.it_value.tv_usec = 1000000 / TIMER_HZ;</code> \u8bbe\u7f6e\u8ba1\u65f6\u5668\u7684\u5fae\u79d2\u6570\u3002\u8fd9\u91cc <code>1000000</code> \u8868\u793a1\u79d2\u7684\u5fae\u79d2\u6570\uff0c<code>TIMER_HZ</code> \u662f\u5b9a\u65f6\u5668\u7684\u9891\u7387\uff0c\u8868\u793a\u6bcf\u79d2\u89e6\u53d1\u7684\u6b21\u6570\u3002\u4f8b\u5982\uff0c\u5982\u679c <code>TIMER_HZ</code> \u662f100\uff0c\u5219\u6bcf\u79d2\u89e6\u53d1100\u6b21\uff0c\u6bcf\u6b21\u89e6\u53d1\u7684\u95f4\u9694\u662f10\u6beb\u79d2\u3002</li> <li><code>it.it_interval = it.it_value;</code> \u8bbe\u7f6e\u8ba1\u65f6\u5668\u7684\u95f4\u9694\u65f6\u95f4\u4e0e\u8d77\u59cb\u65f6\u95f4\u76f8\u540c\uff0c\u8fd9\u610f\u5473\u7740\u8ba1\u65f6\u5668\u662f\u5468\u671f\u6027\u89e6\u53d1\u7684\u3002</li> <li><code>ret = setitimer(ITIMER_VIRTUAL, &amp;it, NULL);</code> \u8c03\u7528 <code>setitimer</code> \u51fd\u6570\uff0c\u8bbe\u7f6e\u865a\u62df\u8ba1\u65f6\u5668 <code>ITIMER_VIRTUAL</code>\u3002<code>ret</code> \u7528\u4e8e\u63a5\u6536\u8fd4\u56de\u503c\u3002</li> <li><code>Assert(ret == 0, \"Can not set timer\");</code> \u65ad\u8a00\u68c0\u67e5\uff0c\u786e\u4fdd\u8ba1\u65f6\u5668\u8bbe\u7f6e\u6210\u529f\u3002</li> </ul> </li> </ul> </li> </ul> <p>\u603b\u7ed3\u6765\u8bf4\uff0c<code>sigaction</code> \u7ed3\u6784\u4f53\u7528\u4e8e\u8bbe\u7f6e\u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\uff0c\u800c <code>itimerval</code> \u7ed3\u6784\u4f53\u7528\u4e8e\u5b9a\u4e49\u8ba1\u65f6\u5668\u7684\u5f53\u524d\u503c\u548c\u89e6\u53d1\u95f4\u9694\u3002\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u5b83\u4eec\u88ab\u7528\u6765\u8bbe\u7f6e\u4e00\u4e2a\u5468\u671f\u6027\u89e6\u53d1\u7684\u865a\u62df\u8ba1\u65f6\u5668\uff0c\u5f53\u8ba1\u65f6\u5668\u89e6\u53d1\u65f6\uff0c\u4f1a\u8c03\u7528 <code>alarm_sig_handler</code> \u51fd\u6570\u3002</p> <p>\u8fd9\u91cc\u53c8\u6d89\u53ca\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u4ec0\u4e48\u53eb\u4fe1\u53f7\uff1f</p> <p>Understanding Signals in the C Language: Harness the Power of Asynchronous Event Handling | by Razika Bengana | Medium</p> <p>\u8fd9\u7bc7\u6587\u7ae0\u5165\u95e8\u4e86\u89e3\u5373\u53ef\uff0c\u4fe1\u53f7\u662f\u4e00\u79cd\u8f6f\u4ef6\u4e2d\u65ad\uff0c\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u7528\u6765\u5411\u8fdb\u7a0b\u4f20\u9012\u5f02\u6b65\u4e8b\u4ef6\u901a\u77e5\u7684\u4e00\u79cd\u673a\u5236\u3002\u4f46\u662f\u8fd9\u7a76\u7adf\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f\u5e94\u8be5\u662f\u548c\u8fdb\u7a0b\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u6709\u5173\uff0c\u6bd4\u5982 <code>kill</code>\u7b49\uff0c\u4f46\u4e0a\u9762\u7684\u7ed3\u6784\u4f53\u53c8\u662f\u600e\u4e48\u56de\u4e8b\uff1f\u7ee7\u7eed\u4e86\u89e3\uff1a</p> <p>\u76f2\u731c\u548c\u4e0a\u9762\u7684\u7ed3\u6784\u4f53 <code>sigaction</code> \u76f8\u5173\uff08\u5c31\u50cf \u7cfb\u7edf\u8c03\u7528 <code>SYS_gettimeofday</code> \u5b9e\u73b0\u65f6\u95f4\u76f8\u5173\u7684\u5185\u5bb9 \uff09\u3002</p> <p>\u5728 <code>Wikipedia</code> \u548c <code>StackOverflow</code> \u4e0a\u770b\u770b\uff1a</p> <p>sigaction - Wikipedia</p> <p>c - What is the difference between sigaction and signal? - Stack Overflow</p> <p>\u7b80\u5355\u603b\u7ed3 \u4e00\u4e9b <code>signal</code> \u548c <code>sigaction</code> \u7684\u5185\u5bb9</p> <p>\u5728\u5904\u7406\u4fe1\u53f7\u65f6\uff0c<code>signal</code> \u548c <code>sigaction</code> \u90fd\u662f\u7528\u4e8e\u5728\u7a0b\u5e8f\u4e2d\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u51fd\u6570\uff0c\u4f46\u5b83\u4eec\u4e4b\u95f4\u6709\u4e00\u4e9b\u5173\u952e\u7684\u533a\u522b\uff1a</p> <ol> <li>\u6807\u51c6\u548c\u517c\u5bb9\u6027\uff1a</li> <li><code>sigaction()</code> \u662f POSIX \u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u5b83\u5728\u6240\u6709\u7684 POSIX \u517c\u5bb9\u7cfb\u7edf\uff08\u5305\u62ec Linux \u548c UNIX \u7cfb\u7edf\uff09\u4e0a\u90fd\u6709\u5b9a\u4e49\uff0c\u8fd8\u662f\u4f5c\u4e3a\u4e00\u79cd\u7cfb\u7edf\u8c03\u7528\u3002</li> <li><code>signal()</code> \u662f C \u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u5b83\u5728\u51e0\u4e4e\u6240\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u90fd\u53ef\u7528\uff0c\u4f46\u5b83\u7684\u884c\u4e3a\u5728\u4e0d\u540c\u7684\u7cfb\u7edf\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c\u3002</li> <li>\u884c\u4e3a\u7684\u660e\u786e\u6027\uff1a</li> <li><code>sigaction()</code> \u63d0\u4f9b\u4e86\u660e\u786e\u7684\u4fe1\u53f7\u5904\u7406\u884c\u4e3a\u3002\u5b83\u5141\u8bb8\u4f60\u6307\u5b9a\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u88ab\u8c03\u7528\u65f6\u7684\u786e\u5207\u8bed\u4e49\u3002</li> <li><code>signal()</code> \u7684\u884c\u4e3a\u5728\u4e0d\u540c\u7684 UNIX \u7248\u672c\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u5dee\u5f02\uff0c\u8fd9\u4f7f\u5f97\u5b83\u7684\u4f7f\u7528\u4e0d\u591f\u53ef\u9760\u3002</li> <li>\u529f\u80fd\uff1a</li> <li><code>sigaction()</code> \u5141\u8bb8\u4f60\u83b7\u53d6\u548c\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u7684\u884c\u4e3a\uff0c\u5305\u62ec\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3001\u4fe1\u53f7\u5904\u7406\u65f6\u88ab\u963b\u585e\u7684\u4fe1\u53f7\u96c6\u4ee5\u53ca\u4e00\u4e9b\u6807\u5fd7\u3002</li> <li><code>signal()</code> \u901a\u5e38\u53ea\u7528\u4e8e\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5e76\u4e14\u5b83\u7684\u529f\u80fd\u6bd4\u8f83\u6709\u9650\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a</li> <li><code>sigaction()</code> \u7531\u4e8e\u662f POSIX \u6807\u51c6\uff0c\u56e0\u6b64\u5728\u53ef\u79fb\u690d\u6027\u65b9\u9762\u53ef\u80fd\u4e0d\u5982 <code>signal()</code>\uff0c\u540e\u8005\u7531\u4e8e\u662f C \u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u7cfb\u7edf\u90fd\u652f\u6301\u3002</li> <li>\u7136\u800c\uff0c<code>signal()</code> \u7684\u53ef\u79fb\u690d\u6027\u662f\u4ee5\u727a\u7272\u884c\u4e3a\u4e00\u81f4\u6027\u4e3a\u4ee3\u4ef7\u7684\u3002</li> <li>\u63a8\u8350\u4f7f\u7528\uff1a</li> <li>\u7531\u4e8e <code>sigaction()</code> \u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u63a7\u5236\u548c\u66f4\u660e\u786e\u7684\u884c\u4e3a\uff0c\u5b83\u88ab\u63a8\u8350\u7528\u4e8e\u9700\u8981\u7cbe\u786e\u4fe1\u53f7\u5904\u7406\u7684\u7a0b\u5e8f\u3002</li> <li><code>signal()</code> \u7531\u4e8e\u5176\u884c\u4e3a\u7684\u4e0d\u786e\u5b9a\u6027\uff0c\u901a\u5e38\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u8de8\u5e73\u53f0\u517c\u5bb9\u65f6\u3002</li> <li>\u4f7f\u7528\u793a\u4f8b\uff1a</li> <li><code>sigaction()</code> \u7684\u4f7f\u7528\u793a\u4f8b\u901a\u5e38\u6d89\u53ca\u586b\u5145 <code>struct sigaction</code> \u7ed3\u6784\u4f53\uff0c\u5e76\u5c06\u5176\u4f20\u9012\u7ed9 <code>sigaction()</code> \u51fd\u6570\u3002</li> <li><code>signal()</code> \u7684\u4f7f\u7528\u901a\u5e38\u66f4\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f20\u9012\u4fe1\u53f7\u7f16\u53f7\u548c\u5904\u7406\u51fd\u6570\u3002 </li> </ol> </li> <li> <p>AM\u5c42</p> <ul> <li>\u5728CTE\u4e2d\u6dfb\u52a0\u65f6\u949f\u4e2d\u65ad\u7684\u652f\u6301, \u5c06\u65f6\u949f\u4e2d\u65ad\u6253\u5305\u6210<code>EVENT_IRQ_TIMER</code>\u4e8b\u4ef6\u3002\u4e3a\u4e86\u6d4b\u8bd5\u65f6\u949f\u4e2d\u65ad\u786e\u5b9e\u5728\u5de5\u4f5c, \u4f60\u53ef\u4ee5\u5728Nanos-lite\u6536\u5230<code>EVENT_IRQ_TIMER</code>\u4e8b\u4ef6\u540e\u7528<code>Log()</code>\u8f93\u51fa\u4e00\u53e5\u8bdd.</li> </ul> <p>\u6ce8\u610fAM \u548c <code>nemu</code> \u4e4b\u95f4 \u53ea\u6709 <code>ecall</code> \u6307\u4ee4\u548c\u8f6e\u8be2 \u4e2d\u65ad <code>INTR</code>\u5f15\u811a\u5904\u4f1a\u8c03\u7528 <code>isa_raise_intr</code></p> <p>\u6240\u4ee5 <code>etrace</code> \u90a3\u91cc\u90e8\u5206\u4e5f\u53ef\u4ee5\u6539\u6539\u3002\u6709\u70b9\u61d2\u4e86</p> <p>\u6240\u4ee5AM \u5c42\u7684 <code>__am_irq_handle</code> \u5c31\u4e0d\u662f\u5728 <code>0xb</code> \u4e0b\u90a3\u91cc\u5224\u65ad\u4e86\uff0c\u518d\u5f00\u4e00\u4e2a <code>case</code> \u56e0\u4e3a\u8fd8\u6ca1\u6709\u5b9e\u73b0 <code>U-mode</code> \u6240\u4ee5\uff0c\u6682\u65f6\u5c31\u533a\u522b\u5f00\u6765\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u6837\u5b50\u4ee3\u7801\u5199\u7684\u5f88\u4e11\u3002</p> <p>DOTO</p> </li> <li> <p>Nanos-lite</p> <ul> <li>Nanos-lite\u6536\u5230<code>EVENT_IRQ_TIMER</code>\u4e8b\u4ef6\u4e4b\u540e, \u8c03\u7528<code>schedule()</code>\u6765\u5f3a\u5236\u5f53\u524d\u8fdb\u7a0b\u8ba9\u51faCPU, \u540c\u65f6\u4e5f\u53ef\u4ee5\u53bb\u6389\u6211\u4eec\u4e4b\u524d\u5728\u8bbe\u5907\u8bbf\u95ee\u4e2d\u63d2\u5165\u7684<code>yield()</code>\u4e86.</li> <li>\u4e3a\u4e86\u53ef\u4ee5\u8ba9\u5904\u7406\u5668\u5728\u8fd0\u884c\u7528\u6237\u8fdb\u7a0b\u7684\u65f6\u5019\u54cd\u5e94\u65f6\u949f\u4e2d\u65ad, \u4f60\u8fd8\u9700\u8981\u4fee\u6539<code>kcontext()</code>\u548c<code>ucontext()</code>\u7684\u4ee3\u7801, \u5728\u6784\u9020\u4e0a\u4e0b\u6587\u7684\u65f6\u5019, \u8bbe\u7f6e\u6b63\u786e\u4e2d\u65ad\u72b6\u6001, \u4f7f\u5f97\u5c06\u6765\u6062\u590d\u4e0a\u4e0b\u6587\u4e4b\u540eCPU\u5904\u4e8e\u5f00\u4e2d\u65ad\u72b6\u6001.</li> </ul> </li> <li> <p>\u601d\u8003\u9898</p> <p>\u4e2d\u65ad\u548c\u7528\u6237\u8fdb\u7a0b\u521d\u59cb\u5316</p> <p>\u6211\u4eec\u77e5\u9053, \u7528\u6237\u8fdb\u7a0b\u4eceNavy\u7684<code>_start</code>\u5f00\u59cb\u8fd0\u884c, \u5e76\u4e14\u5728<code>_start</code>\u4e2d\u8bbe\u7f6e\u6b63\u786e\u7684\u6808\u6307\u9488. \u5982\u679c\u5728\u7528\u6237\u8fdb\u7a0b\u8bbe\u7f6e\u6b63\u786e\u7684\u6808\u6307\u9488\u4e4b\u524d\u5c31\u5230\u6765\u4e86\u4e2d\u65ad, \u6211\u4eec\u7684\u7cfb\u7edf\u8fd8\u80fd\u591f\u6b63\u786e\u5730\u8fdb\u884c\u4e2d\u65ad\u5904\u7406\u5417?</p> <p>\u53ef\u4ee5\u3002</p> <p>\u4e2d\u65ad\u53d1\u751f\u540e\uff0c\u8fdb\u884c\u4e2d\u65ad\u54cd\u5e94\u5904\u7406\uff0c\u8df3\u8f6c\u5230 <code>__am_asm_trap</code> \u8fdb\u884c\u5904\u7406\uff0c\u5165\u6808\u4fdd\u5b58\u4e0a\u4e0b\u6587\uff0c\u8fdb\u884c\u4e2d\u65ad\u5904\u7406\u3002\u8fd4\u56de\u4e4b\u540e\uff0c\u8ba1\u7b97\u673a\u7684\u72b6\u6001\u548c\u4e2d\u65ad\u524d\u662f\u4e00\u6837\u7684\u3002</p> </li> </ol>"},{"location":"ysyx/pa/pa4/pa4.html#_26","title":"\u57fa\u4e8e\u65f6\u95f4\u7247\u7684\u8fdb\u7a0b\u8c03\u5ea6","text":"<p>\u5728\u62a2\u5360\u591a\u4efb\u52a1\u64cd\u4f5c\u7cfb\u7edf\u4e2d, \u7531\u4e8e\u65f6\u949f\u4e2d\u65ad\u4ee5\u56fa\u5b9a\u7684\u901f\u7387\u5230\u6765, \u65f6\u95f4\u88ab\u5212\u5206\u6210\u957f\u5ea6\u5747\u7b49\u7684\u65f6\u95f4\u7247, \u8fd9\u6837\u7cfb\u7edf\u5c31\u53ef\u4ee5\u8fdb\u884c\u57fa\u4e8e\u65f6\u95f4\u7247\u7684\u8fdb\u7a0b\u8c03\u5ea6\u4e86\u3002</p> <ul> <li> <p>\u4f18\u5148\u7ea7\u8c03\u5ea6\uff1a</p> <p>\u6211\u4eec\u53ef\u4ee5\u4fee\u6539<code>schedule()</code>\u7684\u4ee3\u7801, \u7ed9\u4ed9\u5251\u5947\u4fa0\u4f20\u5206\u914d\u66f4\u591a\u7684\u65f6\u95f4\u7247, \u4f7f\u5f97\u4ed9\u5251\u5947\u4fa0\u4f20\u8c03\u5ea6\u82e5\u5e72\u6b21, \u624d\u8ba9hello\u5185\u6838\u7ebf\u7a0b\u8c03\u5ea61\u6b21. \u8fd9\u662f\u56e0\u4e3ahello\u5185\u6838\u7ebf\u7a0b\u505a\u7684\u4e8b\u60c5\u53ea\u662f\u4e0d\u65ad\u5730\u8f93\u51fa\u5b57\u7b26\u4e32, \u6211\u4eec\u53ea\u9700\u8981\u8ba9hello\u5185\u6838\u7ebf\u7a0b\u5076\u5c14\u8fdb\u884c\u8f93\u51fa, \u4ee5\u786e\u8ba4\u5b83\u8fd8\u5728\u8fd0\u884c\u5c31\u53ef\u4ee5\u4e86.</p> <p>\u53ea\u662f\u5b9e\u73b0\u4e86\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u8c03\u5ea6\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_27","title":"\u62a2\u5360\u548c\u5e76\u53d1","text":"<p>\u4ec0\u4e48\u53eb\u62a2\u5360\uff1f<code>FreeRTOS</code> \u662f\u57fa\u4e8e\u62a2\u5360\u5f0f\u7684\u8c03\u5ea6\uff1f</p> <p></p> <p>\u4e3a\u4e86\u5bf9\u4e2d\u65ad\u7684\u884c\u4e3a\u8fdb\u884c\u5efa\u6a21, \u6211\u4eec\u5bf9<code>fex()</code>\u51fd\u6570\u7684\u5b9a\u4e49\u8fdb\u884c\u6269\u5c55: \u9664\u4e86\u5224\u65ad\u5f53\u524d\u72b6\u6001\u662f\u5426\u9700\u8981\u629b\u51fa\u5f02\u5e38, \u5982\u679c\u5f53\u524d\u5904\u7406\u5668\u5904\u4e8e\u5f00\u4e2d\u65ad\u72b6\u6001, \u8fd8\u9700\u8981\u5224\u65ad\u662f\u5426\u6709\u4e2d\u65ad\u5230\u6765. \u8fd9\u8bf4\u660e\u5728\u6bcf\u6761\u6307\u4ee4\u6267\u884c\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u90fd\u5c06\u6709\u53ef\u80fd\u56e0\u4e3a\u4e2d\u65ad\u5230\u6765\u800c\u8df3\u8f6c\u5230\u4e2d\u65ad\u5904\u7406\u51fd\u6570.</p> <ul> <li> <p>\u9605\u8bfb</p> <p>\u4e2d\u65ad\u7ed9\u8ba1\u7b97\u673a\u7cfb\u7edf\u5e26\u6765\u7684\u4e0d\u786e\u5b9a\u6027\u53ef\u4ee5\u8bf4\u662f\u4e00\u628a\u53cc\u5203\u5251. \u6bd4\u5982GNU/Linux\u5185\u6838\u4f1a\u7ef4\u62a4\u4e00\u4e2aentropy pool, \u7528\u4e8e\u6536\u96c6\u7cfb\u7edf\u4e2d\u7684\u71b5(\u4e0d\u786e\u5b9a\u6027). \u6bcf\u5f53\u4e2d\u65ad\u5230\u6765\u7684\u65f6\u5019, \u5c31\u4f1a\u7ed9\u8fd9\u4e2apool\u6dfb\u52a0\u4e00\u4e9b\u71b5. \u901a\u8fc7\u8fd9\u4e9b\u71b5, \u6211\u4eec\u5c31\u53ef\u4ee5\u751f\u6210\u771f\u6b63\u7684\u968f\u673a\u6570\u4e86, <code>/dev/random</code>\u5c31\u662f\u8fd9\u6837\u505a\u7684. \u6709\u4e86\u771f\u6b63\u7684\u968f\u673a\u6570, \u6076\u610f\u7a0b\u5e8f\u7684\u653b\u51fb\u4e5f\u53d8\u5f97\u76f8\u5bf9\u56f0\u96be\u4e86(\u6bd4\u5982ASLR), \u7cfb\u7edf\u7684\u5b89\u5168\u4e5f\u591a\u4e86\u4e00\u5206\u4fdd\u969c.</p> <p>\u4f46\u53e6\u4e00\u65b9\u9762, \u4e2d\u65ad\u7684\u5b58\u5728\u4e5f\u4e0d\u5f97\u4e0d\u8ba9\u7a0b\u5e8f\u5728\u4e00\u4e9b\u95ee\u9898\u7684\u5904\u7406\u4e0a\u9700\u8981\u4ed8\u51fa\u989d\u5916\u7684\u4ee3\u4ef7. \u7531\u4e8e\u4e2d\u65ad\u968f\u65f6\u53ef\u80fd\u4f1a\u5230\u6765, \u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u6709\u4e00\u4e2a\u5171\u4eab\u7684\u53d8\u91cf<code>v</code>(\u6bd4\u5982\u8fc5\u96f7\u591a\u7ebf\u7a0b\u4e0b\u8f7d\u5171\u4eab\u540c\u4e00\u4e2a\u6587\u4ef6\u7f13\u51b2\u533a), \u4e00\u4e2a\u8fdb\u7a0b<code>A</code>\u5f80<code>v</code>\u4e2d\u5199<code>0</code>, \u521a\u5199\u5b8c\u4e2d\u65ad\u5c31\u5230\u6765, \u4f46\u5f53\u4e0b\u6b21<code>A</code>\u518d\u6b21\u8fd0\u884c\u7684\u65f6\u5019, <code>v</code>\u7684\u503c\u5c31\u53ef\u80fd\u4e0d\u518d\u662f<code>0</code>\u4e86. \u4ece\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u6765\u8bf4, \u8fd9\u4e5f\u662f\u5e76\u53d1\u60f9\u7684\u7978: \u53ef\u80fd\u8fdb\u7a0b<code>B</code>\u5728\u5e76\u53d1\u5730\u4fee\u6539<code>v</code>\u7684\u503c, \u4f46<code>A</code>\u5374\u4e0d\u77e5\u60c5. \u8fd9\u79cd\u7531\u4e8e\u5e76\u53d1\u9020\u6210\u7684bug, \u8fd8\u5e26\u6709\u4e0d\u786e\u5b9a\u6027\u7684\u70d9\u5370: \u5982\u679c\u4e2d\u65ad\u5230\u6765\u7684\u65f6\u673a\u4e0d\u4e00\u6837, \u5c31\u4e0d\u4f1a\u89e6\u53d1\u8fd9\u4e2abug\u4e86. \u6240\u4ee5\u8fd9\u79cdbug\u53c8\u53ebHeisenbug, \u548c\u91cf\u5b50\u529b\u5b66\u7684\u6d4b\u4e0d\u51c6\u539f\u7406\u7c7b\u4f3c, \u4f60\u60f3\u8c03\u8bd5\u5b83\u7684\u65f6\u5019, \u5b83\u53ef\u80fd\u5c31\u4e0d\u51fa\u73b0\u4e86.</p> <p>\u4e0d\u4f46\u662f\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u5171\u4eab\u53d8\u91cf, \u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u66f4\u662f\u5e76\u53d1bug\u7684\u91cd\u707e\u533a. \u6bd4\u5982\u5e76\u53d1\u5199\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\u591a\u4e2a\u7528\u6237\u8fdb\u7a0b\u4f1a\u5171\u4eab\u540c\u4e00\u4e2a\u6587\u4ef6\u504f\u79fb\u91cf, \u5982\u679c\u5904\u7406\u4e0d\u5f53, \u53ef\u80fd\u5c31\u4f1a\u5bfc\u81f4\u5199\u6570\u636e\u4e22\u5931. \u66f4\u4e00\u822c\u5730, \u7528\u6237\u8fdb\u7a0b\u90fd\u4f1a\u5e76\u53d1\u5730\u6267\u884c\u7cfb\u7edf\u8c03\u7528, \u64cd\u4f5c\u7cfb\u7edf\u8fd8\u9700\u8981\u4fdd\u8bc1\u5b83\u4eec\u90fd\u80fd\u6309\u7167\u7cfb\u7edf\u8c03\u7528\u7684\u8bed\u4e49\u6b63\u786e\u5730\u6267\u884c.</p> <p>\u554a, \u8fd8\u662f\u4e0d\u5267\u900f\u90a3\u4e48\u591a\u4e86, \u5927\u5bb6\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u518d\u6162\u6162\u4f53(xiang)\u4f1a(shou)\u4e50(tong)\u8da3(ku)\u5427, \u4e5f\u8bb8\u5230\u65f6\u5019\u4f60\u5c31\u4f1a\u60f3\u5ff5PA\u5355\u7ebf\u7a0b\u7684\u597d\u4e86.</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_28","title":"\u5185\u6838\u6808\u548c\u7528\u6237\u6808","text":"<p>\u5e76\u53d1\u6267\u884c\u591a\u4e2a\u7528\u6237\u8fdb\u7a0b</p> <p>\u8ba9Nanos-lite\u52a0\u8f7d\u4ed9\u5251\u5947\u4fa0\u4f20\u548chello\u8fd9\u4e24\u4e2a\u7528\u6237\u8fdb\u7a0b; \u6216\u8005\u662f\u52a0\u8f7dNTerm\u548chello\u5185\u6838\u7ebf\u7a0b, \u7136\u540e\u4eceNTerm\u542f\u52a8\u4ed9\u5251\u5947\u4fa0\u4f20, \u4f60\u5e94\u8be5\u4f1a\u5728\u8fd0\u884c\u7684\u65f6\u5019\u89c2\u5bdf\u5230\u9519\u8bef. \u5c1d\u8bd5\u5206\u6790\u8fd9\u4e00\u9519\u8bef\u7684\u539f\u56e0, \u5e76\u603b\u7ed3\u4e3a\u4e86\u652f\u6301\u8fd9\u4e00\u529f\u80fd, \u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4ec0\u4e48\u6837\u7684\u6761\u4ef6.</p> <p>\u8fd9\u53ef\u4ee5\u8bf4\u662f\u4e00\u5468\u76ee\u6700\u96be\u7684\u4e00\u9053\u601d\u8003\u9898\u4e86, \u867d\u7136\u6211\u4eec\u4f1a\u5728PA4\u7684\u6700\u540e\u7ed9\u51fa\u5206\u6790, \u559c\u6b22\u6311\u6218\u7684\u540c\u5b66\u4ecd\u7136\u53ef\u4ee5\u5728\u8fd9\u91cc\u5c1d\u8bd5\u72ec\u7acb\u601d\u8003: \u5982\u679c\u4f60\u80fd\u72ec\u7acb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u8bf4\u660e\u4f60\u5bf9\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u7406\u89e3\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u4e86\u5f97\u4e86.</p> <p>Hint: \u7a0b\u5e8f\u662f\u4e2a\u72b6\u6001\u673a.</p>"},{"location":"ysyx/pa/pa4/pa4.html#_29","title":"\u95ee\u9898\u5206\u6790","text":"<p>\u5728A\u8fd0\u884c\u7684\u65f6\u5019, \u6808\u6307\u9488<code>sp</code>\u4f1a\u6307\u5411A\u7684\u7528\u6237\u6808. \u5f53A\u6267\u884c\u7cfb\u7edf\u8c03\u7528, \u6216\u8005\u4e2d\u65ad\u5230\u6765\u7684\u65f6\u5019, \u5c31\u4f1a\u7ecf\u8fc7CTE\u9677\u5165\u64cd\u4f5c\u7cfb\u7edf. </p> <p>\u8fd9\u65f6, \u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u8981\u8c03\u5ea6\u7528\u6237\u8fdb\u7a0bB, \u5b83\u5c31\u4f1a\u628aB\u7684\u4e0a\u4e0b\u6587\u8fd4\u56de\u7ed9CTE, \u5e76\u671f\u671bCTE\u4f9d\u6b21\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c:</p> <ul> <li>\u901a\u8fc7 <code>__am_switch()</code> \u5207\u6362\u5230B\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4</li> <li>\u5728 <code>trap.S</code> \u4e2d\u6062\u590dB\u7684\u4e0a\u4e0b\u6587</li> </ul> <p>\u5177\u4f53\u5730, <code>__am_switch()</code> \u5207\u6362\u5230B\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e4b\u524d, \u9700\u8981\u5148\u8bfb\u51faB\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u4e2d\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488<code>pdir</code>(x86\u4e3a<code>cr3</code>). \u800cB\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u662f\u4e0a\u4e00\u6b21B\u8fdb\u5165CTE\u65f6\u5728B\u7684\u7528\u6237\u6808\u4e0a\u521b\u5efa\u7684, \u4f46B\u7684\u7528\u6237\u6808\u5e76\u4e0d\u5728A\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u91cc\u9762!</p> <p>\u4e8e\u662f, \u4e3a\u4e86\u6b63\u786e\u8bfb\u51faB\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488, \u6211\u4eec\u9700\u8981\u5148\u5207\u6362\u5230B\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4; \u4f46\u53e6\u4e00\u65b9\u9762, \u4e3a\u4e86\u5207\u6362\u5230B\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u6211\u4eec\u9700\u8981\u5148\u6b63\u786e\u8bfb\u51faB\u7684\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488! \u8fd9\u5f62\u6210\u4e86\u4e00\u4e2a\"\u9e21\u548c\u86cb\"\u7684\u5faa\u73af\u4f9d\u8d56\u95ee\u9898. </p> <p>\u4e3a\u4e86\u6253\u7834\u4e0a\u8ff0\u5faa\u73af\u4f9d\u8d56, \u6211\u4eec\u4e0d\u80fd\u5c06\u5730\u5740\u7a7a\u95f4\u63cf\u8ff0\u7b26\u6307\u9488\u4fdd\u5b58\u5230\u7528\u6237\u6808\u4e2d, \u800c\u662f\u5e94\u8be5\u5c06\u5b83\u4fdd\u5b58\u5230\u4e00\u4e2a\u6240\u6709\u7528\u6237\u8fdb\u7a0b\u90fd\u53ef\u89c1\u7684\u5730\u5740\u7a7a\u95f4\u4e2d. \u663e\u7136, \u8fd9\u4e2a\u6240\u6709\u7528\u6237\u8fdb\u7a0b\u90fd\u53ef\u89c1\u7684\u5730\u5740\u7a7a\u95f4, \u5c31\u662f\u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4, \u56e0\u4e3a\u6240\u6709\u865a\u62df\u5730\u5740\u7a7a\u95f4\u90fd\u4f1a\u5305\u542b\u5185\u6838\u6620\u5c04, \u8fd9\u4fdd\u8bc1\u4e86\u65e0\u8bba\u64cd\u4f5c\u7cfb\u7edf\u5207\u6362\u5230\u54ea\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b, \u4ee3\u7801\u90fd\u53ef\u4ee5\u901a\u8fc7\u5185\u6838\u6620\u5c04\u8bbf\u95ee\u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4.</p>"},{"location":"ysyx/pa/pa4/pa4.html#_30","title":"\u6808\u5207\u6362\u7684\u6982\u5ff5\u7ec6\u8282","text":"<p>\u4e3a\u4e86\u5b9e\u73b0\u6808\u5207\u6362, \u6211\u4eec\u9700\u8981\u5b9e\u73b0\u5982\u4e0b\u529f\u80fd:</p> <ul> <li>\u5982\u679c\u662f\u4ece\u7528\u6237\u6001\u8fdb\u5165CTE, \u5219\u5728CTE\u4fdd\u5b58\u4e0a\u4e0b\u6587\u4e4b\u524d, \u5148\u5207\u6362\u5230\u5185\u6838\u6808, \u7136\u540e\u518d\u4fdd\u5b58\u4e0a\u4e0b\u6587</li> <li>\u5982\u679c\u5c06\u6765\u8fd4\u56de\u5230\u7528\u6237\u6001, \u5219\u5728CTE\u4ece\u5185\u6838\u6808\u6062\u590d\u4e0a\u4e0b\u6587\u4e4b\u540e, \u5219\u5148\u5207\u6362\u5230\u7528\u6237\u6808, \u7136\u540e\u518d\u8fd4\u56de</li> </ul> <p>\u6ce8\u610f\u5982\u679c\u6211\u4eec\u662f\u4ece\u5185\u6838\u6001\u8fdb\u5165CTE, \u5219\u65e0\u9700\u5207\u6362; \u82e5\u6b64\u65f6\u6211\u4eec\u9519\u8bef\u5730\u5c06\u6808\u6307\u9488\u518d\u6b21\u6307\u5411\u5185\u6838\u6808\u7684\u5e95\u90e8, \u5185\u6838\u6808\u7684\u5df2\u6709\u5185\u5bb9\u5c06\u4f1a\u88ab\u63a5\u4e0b\u6765\u7684\u538b\u6808\u64cd\u4f5c\u6240\u8986\u76d6!</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u7528\u6237\u6001\u548c\u6808\u6307\u9488</p> <p>\u4e00\u822c\u6765\u8bf4, \u5904\u7406\u5668\u7684\u7279\u6743\u7ea7\u4e5f\u662f\u4e00\u79cd\u72b6\u6001. \u6211\u4eec\u662f\u5426\u53ef\u4ee5\u901a\u8fc7\u6808\u6307\u9488\u7684\u503c\u6765\u5224\u65ad\u5f53\u524d\u4f4d\u4e8e\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001?</p> </li> <li> <p>\u57fa\u672c\u529f\u80fd</p> <p>\u800c\u4e3a\u4e86\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd, \u6211\u4eec\u53c8\u9700\u8981\u89e3\u51b3\u5982\u4e0b\u95ee\u9898:</p> <ul> <li>\u5982\u4f55\u8bc6\u522b\u8fdb\u5165CTE\u4e4b\u524d\u5904\u4e8e\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001? - <code>pp</code> (Previous Privilege)</li> <li>CTE\u7684\u4ee3\u7801\u5982\u4f55\u77e5\u9053\u5185\u6838\u6808\u5728\u4ec0\u4e48\u4f4d\u7f6e? - <code>ksp</code> (Kernel Stack Pointer)</li> <li>\u5982\u4f55\u77e5\u9053\u5c06\u8981\u8fd4\u56de\u7684\u662f\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001? - <code>np</code> (Next Privilege)</li> <li>CTE\u7684\u4ee3\u7801\u5982\u4f55\u77e5\u9053\u7528\u6237\u6808\u5728\u4ec0\u4e48\u4f4d\u7f6e? - <code>usp</code> (User Stack Pointer)</li> </ul> <p>\u6211\u4eec\u4e3a\u6bcf\u4e00\u4e2a\u95ee\u9898\u5206\u522b\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6982\u5ff5\u53d8\u91cf, \u8981\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898, \u5c31\u662f\u8981\u5728CTE\u4e2d\u6b63\u786e\u5730\u7ef4\u62a4\u8fd9\u4e9b\u53d8\u91cf. \u6211\u4eec\u7528\u4f2a\u4ee3\u7801\u6765\u63cf\u8ff0\u9700\u8981\u5b9e\u73b0\u7684\u529f\u80fd, \u5176\u4e2d<code>$sp</code>\u8868\u793a\u6808\u6307\u9488\u5bc4\u5b58\u5668:</p> <pre><code>void __am_asm_trap() {\n  if (pp == USER) {\n    usp = $sp;\n    $sp = ksp;\n  }\n  np = pp;\n\n  // save context\n\n  __am_irq_handle(c);\n\n  // restore context\n\n  pp = np;\n  if (np == USER) {\n    ksp = $sp; // \u4fdd\u5b58\u5185\u6838\u6808\u6307\u9488\uff1a\u5185\u6838\u6808\u4f4d\u7f6e\n    $sp = usp; // \u5207\u6362\u56de\u7528\u6237\u6808\n  }\n\n  return_from_trap();\n}\n</code></pre> <p>\u5982\u679c\u4ece \u7528\u6237\u6001 \u8fdb\u5165\uff0c\u90a3\u5c31\u9700\u8981\u5148\u5207\u6362\u5230 \u5185\u6838\u6808\uff0c\u518d\u8fdb\u884c\u4e0a\u4e0b\u6587\u4fdd\u5b58\uff1b\u5982\u679c\u4ece\u5185\u6838\u6001\u8fdb\u5165\u5c31\u65e0\u9700\u4e86\uff0c\u56e0\u4e3a\u672c\u8eab\u4f7f\u7528\u7684\u5c31\u662f\u5185\u6838\u6808\u3002</p> <p>\u6700\u540e\uff0c\u65e0\u8bba\u524d\u9762\u4ece\u54ea\u4e2a\u6001\u8fdb\u5165\uff0c\u6700\u540e\u90fd\u662f\u8981\u4ece\u5185\u6838\u6808\u6062\u590d\u4e0a\u4e0b\u6587\uff1b\u800c\u8981\u8fd4\u56de\u5230\u54ea\u4e2a\u7279\u6743\u7ea7\u5c31\u9700\u8981\u8003\u8651\u770b\u770b\uff1a\u5982\u679c\u8981\u8fd4\u56de\u5230\u5185\u6838\u6001\uff0c\u90a3\u5f02\u5e38\u5904\u7406\u5b8c\u76f4\u63a5\u8fd4\u56de\u5373\u53ef\uff1b\u5982\u679c\u8981\u8fd4\u56de\u5230\u7528\u6237\u6001\uff0c\u90a3\u5c31\u9700\u8981\u5148\u5207\u6362\u56de\u7528\u6237\u6808\uff0c\u518d\u8fd4\u56de\u3002</p> <p>\u6ce8\u610f\u4e0a\u8ff0\u4f2a\u4ee3\u7801\u53ea\u662f\u63cf\u8ff0\u6982\u5ff5\u4e0a\u7684\u884c\u4e3a, \u5e76\u4e0d\u4ee3\u8868\u4ee3\u7801\u4e5f\u8981\u4e25\u683c\u6309\u7167\u76f8\u5e94\u7684\u987a\u5e8f\u6765\u7f16\u5199, \u4f8b\u5982<code>np = pp;</code>\u53ef\u4ee5\u653e\u5728\u4fdd\u5b58\u4e0a\u4e0b\u6587\u4e4b\u540e, \u751a\u81f3\u662f\u5728<code>__am_irq_handle()</code>\u7684\u5f00\u5934\u6765\u8fdb\u884c. \u4ece\u4f2a\u4ee3\u7801\u4e0a\u770b, \u6211\u4eec\u9700\u8981\u6dfb\u52a0\u7684\u529f\u80fd\u5e76\u4e0d\u590d\u6742.</p> </li> <li> <p>\u4e0a\u4e0b\u6587\u5207\u6362</p> <p>\u4f46\u662f\u4e0d\u8981\u5fd8\u8bb0, \u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u901a\u8fc7CTE\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u5e76\u8fdb\u884c\u5207\u6362, \u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u4ee3\u7801\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u4f1a\u53d1\u751f\u7684\u6761\u4ef6\u4e0b\u4ecd\u7136\u53ef\u4ee5\u6b63\u786e\u5de5\u4f5c,\u6211\u4eec\u9700\u8981\u4ed4\u7ec6\u8003\u91cf\u4e0a\u8ff0\u53d8\u91cf\u7684\u884c\u4e3a. </p> <p>\u7ecf\u8fc7\u4e00\u4e9b\u7b80\u5355\u7684\u5206\u6790, \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ul> <li><code>pp</code>\u548c<code>ksp</code>\u5e76\u4e0d\u4f1a\u53d7\u5230\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f71\u54cd: \u5b83\u4eec\u5728\u79bb\u5f00CTE\u4e4b\u524d\u88ab\u8d4b\u503c, \u4f46\u662f\u5728\u4e0b\u4e00\u6b21\u8fdb\u5165CTE\u7684\u65f6\u5019\u624d\u4f1a\u88ab\u4f7f\u7528, \u671f\u95f4\u5b83\u4eec\u7684\u503c\u4e0d\u4f1a\u6539\u53d8, \u800c\u4e0a\u4e0b\u6587\u5207\u6362\u53ea\u4f1a\u5728\u5b83\u4eec\u88ab\u4f7f\u7528\u4e4b\u540e\u624d\u4f1a\u53d1\u751f. </li> <li>\u4f46<code>np</code>\u548c<code>usp</code>\u5c31\u4e0d\u4e00\u6837\u4e86, \u5b83\u4eec\u5728\u8fdb\u5165CTE\u7684\u65f6\u5019\u88ab\u8d4b\u503c, \u5728\u79bb\u5f00CTE\u4e4b\u524d\u88ab\u4f7f\u7528, \u800c\u671f\u95f4\u53ef\u80fd\u4f1a\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362.</li> </ul> <p>\u6211\u4eec\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u6784\u9020\u51fa\u4e00\u4e2a\u4f8b\u5b50\u6765\u5c55\u793a\u4e0a\u4e0b\u6587\u5207\u6362\u5e26\u6765\u7684\u95ee\u9898.</p> <p>\u5047\u8bbe\u67d0\u7528\u6237\u8fdb\u7a0b\u56e0\u4e3a\u7cfb\u7edf\u8c03\u7528\u6216\u4e2d\u65ad\u5230\u6765\u8fdb\u5165CTE, \u4e0a\u8ff0\u4ee3\u7801\u4f1a\u628a<code>np</code>\u8bbe\u7f6e\u4e3a<code>USER</code>, \u8868\u793a\u4e0b\u4e00\u6b21\u79bb\u5f00CTE\u7684\u65f6\u5019\u5c06\u8981\u8fd4\u56de\u7528\u6237\u6001. \u5982\u679c\u5728\u8fd9\u671f\u95f4\u53d1\u751f\u4e86\u4e0a\u4e0b\u6587\u5207\u6362, \u5207\u6362\u5230\u4e86\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b, \u5185\u6838\u7ebf\u7a0b\u5728\u6062\u590d\u4e0a\u4e0b\u6587\u4e4b\u540e\u67e5\u770b<code>np</code>, \u53d1\u73b0\u662f<code>USER</code>, \u5c31\u4f1a\u9519\u8bef\u5730\u628a<code>usp</code>\u8bbe\u7f6e\u5230<code>$sp</code>, \u6211\u4eec\u77e5\u9053\u5185\u6838\u7ebf\u7a0b\u5e76\u6ca1\u6709\u7528\u6237\u6808, \u4eceCTE\u8fd4\u56de\u65f6, \u5185\u6838\u7ebf\u7a0b\u7684\u6267\u884c\u5c06\u4f1a\u4ea7\u751f\u707e\u96be\u6027\u7684\u540e\u679c.</p> <p>\u5bf9\u4e8e\u8fd9\u4e9b\u53d7\u4e0a\u4e0b\u6587\u5207\u6362\u5f71\u54cd\u7684\u53d8\u91cf, \u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u5730\u5c06\u5b83\u4eec\u5b9a\u4e49\u6210\u5168\u5c40\u53d8\u91cf. \u5b83\u4eec\u672c\u8eab\u662f\u7528\u4e8e\u63cf\u8ff0\u4e0a\u4e0b\u6587\u7684\u5c5e\u6027, \u5e94\u8be5\u8ddf\u968f\u7740\u4e0a\u4e0b\u6587\u4e00\u540c\u8fdb\u884c\u5207\u6362, \u56e0\u6b64\u5728Context\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49\u5b83\u4eec\u624d\u662f\u6b63\u786e\u7684\u505a\u6cd5:</p> <pre><code>void __am_asm_trap() {\n  if (pp == USER) { // pp is global\n    c-&gt;usp = $sp;   // usp should be in Context\n    $sp = ksp;      // ksp is global\n  }\n  c-&gt;np = pp;       // np should be in Context\n\n  // save context\n\n  __am_irq_handle(c);\n\n  // restore context\n\n  pp = c-&gt;np;\n  if (c-&gt;np == USER) {\n    ksp = $sp;\n    $sp = c-&gt;usp;\n  }\n\n  return_from_trap();\n}\n</code></pre> </li> <li> <p>CTE \u91cd\u5165</p> <p>\u9664\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\u4e4b\u5916, \u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651CTE\u7684\u91cd\u5165(re-entry)\u95ee\u9898: \u4ee3\u7801\u662f\u5426\u53ef\u80fd\u5728\u79bb\u5f00CTE\u4e4b\u524d\u53c8\u518d\u6b21\u8fdb\u5165CTE? </p> <p>\u6211\u4eec\u77e5\u9053<code>yield()</code>\u662f\u901a\u8fc7CTE\u6765\u5b9e\u73b0\u7684, \u5982\u679c\u7528\u6237\u8fdb\u7a0b\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u9677\u5165\u5185\u6838\u4e4b\u540e, \u53c8\u6267\u884c\u4e86<code>yield()</code>, \u5c31\u4f1a\u51fa\u73b0CTE\u91cd\u5165\u7684\u73b0\u8c61. \u53e6\u4e00\u79cd\u5f15\u53d1CTE\u91cd\u5165\u7684\u73b0\u8c61\u662f\u4e0a\u6587\u4ecb\u7ecd\u7684\u4e2d\u65ad\u5d4c\u5957: \u7b2c\u4e00\u6b21\u4e2d\u65ad\u5230\u6765\u7684\u65f6\u5019\u4ee3\u7801\u4f1a\u8fdb\u5165CTE, \u4f46\u5728\u7b2c\u4e8c\u6b21\u4e2d\u65ad\u53ef\u80fd\u4f1a\u5728\u4ee3\u7801\u79bb\u5f00CTE\u4e4b\u524d\u5230\u6765. \u4e0d\u8fc7\u5728PA\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u4e2d\u65ad\u5d4c\u5957\u7684\u60c5\u51b5, \u56e0\u4e3a\u6211\u4eec\u8ba9\u5904\u7406\u5668\u5728\u8fdb\u5165CTE\u4e4b\u540e\u5904\u4e8e\u5173\u4e2d\u65ad\u72b6\u6001.</p> <p>CTE\u7684\u91cd\u5165\u4f1a\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5462? \u501f\u52a9\u7a0b\u5e8f\u7684\u72b6\u6001\u673a\u89c6\u89d2\u6765\u5206\u6790\u4ee3\u7801\u7684\u884c\u4e3a, \u6211\u4eec\u5f88\u5bb9\u6613\u5c31\u77e5\u9053\u95ee\u9898\u4e86.</p> <p>\u7cfb\u7edf\u7684\u590d\u6742\u6027(3)</p> <p>\u6211\u4eec\u628aCTE\u91cd\u5165\u95ee\u9898\u4f5c\u4e3a\u72b6\u6001\u673a\u89c6\u89d2\u7684\u4e00\u4e2a\u7ec3\u4e60, \u8bf7\u4f60\u6765\u5c1d\u8bd5\u5206\u6790\u4e0a\u8ff0\u4ee3\u7801\u5728CTE\u91cd\u5165\u7684\u60c5\u51b5\u4e0b\u5b58\u5728\u4ec0\u4e48\u95ee\u9898.</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u9700\u8981\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u8fdb\u884c\u5982\u4e0b\u4fee\u6539:</p> <pre><code>void __am_asm_trap() {\n  if (pp == USER) { // pp is global\n    c-&gt;usp = $sp;   // usp should be in Context\n    $sp = ksp;      // ksp is global\n  }\n  c-&gt;np = pp;       // np should be in Context\n\n  pp = KERNEL;      // support re-entry of CTE\n\n  // save context\n\n  __am_irq_handle(c);\n\n  // restore context\n\n  pp = c-&gt;np;\n  if (c-&gt;np == USER) {\n    ksp = $sp;\n    $sp = c-&gt;usp;\n  }\n\n  return_from_trap();\n}\n</code></pre> </li> <li> <p>\u4f18\u5316</p> <p>\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u8fdb\u884c\u4e00\u4e9b\u7b80\u5355\u7684\u4f18\u5316. </p> <p>\u4e00\u5904\u53ef\u4ee5\u4f18\u5316\u7684\u5730\u65b9\u662f\u628a<code>pp</code>\u7684\u529f\u80fd\u5408\u5e76\u5230<code>ksp</code>\u4e2d, \u8ba9<code>ksp</code>\u65e2\u53ef\u4ee5\u8868\u793a\u5185\u6838\u6808\u7684\u5730\u5740, \u4e5f\u53ef\u4ee5\u8868\u793a\u8fdb\u5165CTE\u4e4b\u524d\u7684\u7279\u6743\u7ea7. \u6ce8\u610f\u5230<code>ksp</code>\u603b\u662f\u5728<code>pp == USER</code>\u7684\u65f6\u5019\u88ab\u4f7f\u7528, \u800c\u4e14<code>ksp</code>\u7684\u503c\u80af\u5b9a\u4e0d\u4e3a<code>0</code>, \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>ksp == 0</code>\u6765\u8868\u793a<code>pp == KERNEL</code>. \u6211\u4eec\u5bf9<code>ksp</code>\u7684\u503c\u8fdb\u884c\u5982\u4e0b\u7684\u7ea6\u5b9a:</p> <ul> <li>\u82e5\u5f53\u524d\u4f4d\u4e8e\u7528\u6237\u6001, \u5219<code>ksp</code>\u7684\u503c\u4e3a\u5185\u6838\u6808\u7684\u6808\u5e95</li> <li>\u82e5\u5f53\u524d(\u4e5f\u5c31\u662f\u8fdb\u6765 <code>__am_asm_trap</code> \u65f6\u7684\u72b6\u6001)\u4f4d\u4e8e\u5185\u6838\u6001, \u5219<code>ksp</code>\u7684\u503c\u4e3a<code>0</code></li> </ul> <p>\u8fd9\u6837\u4ee5\u540e, \u4e0a\u8ff0\u4ee3\u7801\u53ef\u4ee5\u4f18\u5316\u4e3a:</p> <pre><code>void __am_asm_trap() {\n  if (ksp != 0) {   // ksp is global\n    c-&gt;usp = $sp;   // usp should be in Context\n    $sp = ksp;\n  }\n  c-&gt;np = (ksp == 0 ? KERNEL : USER);  // np should be in Context\n\n  ksp = 0;          // support re-entry of CTE\n\n  // save context\n\n  __am_irq_handle(c);\n\n  // restore context\n\n  if (c-&gt;np == USER) {\n    ksp = $sp;\n    $sp = c-&gt;usp;\n  }\n\n  return_from_trap();\n}\n</code></pre> <p>\u53e6\u4e00\u5904\u53ef\u4ee5\u4f18\u5316\u7684\u5730\u65b9\u662f\u628a<code>c-&gt;usp</code>\u7684\u529f\u80fd\u5408\u5e76\u5230<code>c-&gt;sp</code>\u4e2d, \u8ba9<code>c-&gt;sp</code>\u8868\u793a\u8fdb\u5165CTE\u524d<code>$sp</code>\u7684\u503c, \u65e0\u8bba\u8fdb\u5165CTE\u524d\uff0c\u7cfb\u7edf\u662f\u4f4d\u4e8e\u7528\u6237\u6001\u8fd8\u662f\u5185\u6838\u6001. \u540c\u6837\u5730, \u6062\u590d\u4e0a\u4e0b\u6587\u7684\u65f6\u5019, \u76f4\u63a5\u628a<code>c-&gt;sp</code>\u8d4b\u503c\u7ed9<code>$sp</code>\u5373\u53ef. \u8fd9\u6837\u5c31\u65e0\u9700\u5728Context\u7ed3\u6784\u4f53\u4e2d\u989d\u5916\u5b9a\u4e49<code>usp</code>\u4e86, \u56e0\u6b64\u4e0a\u8ff0\u4ee3\u7801\u53ef\u4ee5\u4f18\u5316\u4e3a:</p> <pre><code>void __am_asm_trap() {\n  c-&gt;sp = $sp;\n  if (ksp != 0) {   // ksp is global\n    $sp = ksp;\n  }\n  c-&gt;np = (ksp == 0 ? KERNEL : USER);  // np should be in Context\n\n  ksp = 0;          // support re-entry of CTE\n\n  // save context\n\n  __am_irq_handle(c);\n\n  // restore context\n\n  if (c-&gt;np == USER) {\n    ksp = $sp;\n  }\n  $sp = c-&gt;sp;\n\n  return_from_trap();\n}\n</code></pre> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#riscv32","title":"\u6808\u5207\u6362\u7684\u5177\u4f53\u5b9e\u73b0\uff08riscv32\uff09","text":"<p>riscv32\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53eb<code>mscratch</code>\u7684CSR\u5bc4\u5b58\u5668, \u4e13\u95e8\u4f5c\u4e3a\u4e34\u65f6\u5bc4\u5b58\u5668\u7ed9\u7cfb\u7edf\u8f6f\u4ef6\u4f7f\u7528, \u5b83\u5728\u786c\u4ef6\u7684\u884c\u4e3a\u4e0a\u5e76\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u4e4b\u5904. \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u7ea6\u5b9a:</p> <ul> <li>\u628a\u6982\u5ff5\u4e0a\u7684<code>ksp</code>\u6620\u5c04\u5230<code>mscratch</code>\u5bc4\u5b58\u5668</li> <li>\u5728Context\u7ed3\u6784\u4f53\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u6210\u5458<code>np</code>, \u628a\u6982\u5ff5\u4e0a\u7684<code>c-&gt;np</code>\u6620\u5c04\u5230\u5b83</li> <li>\u628a\u6982\u5ff5\u4e0a\u7684<code>c-&gt;sp</code>\u6620\u5c04\u5230<code>c-&gt;gpr[sp]</code></li> </ul> <p>\u4e0d\u8fc7\u5f53\u4f60\u6253\u7b97\u5b9e\u73b0\u4ee3\u7801\u7684\u65f6\u5019, \u4f60\u4f1a\u53d1\u73b0\u5728\u521a\u8fdb\u5165CTE\u800c\u672a\u5207\u6362\u5230\u5185\u6838\u6808\u4e4b\u524d, \u6211\u4eec\u6839\u672c\u6ca1\u6709\u7a7a\u95f2\u7684\u901a\u7528\u5bc4\u5b58\u5668\u53ef\u4ee5\u4f7f\u7528! \u4e8b\u5b9e\u4e0a, riscv32\u7684\u8bbe\u8ba1\u975e\u5e38\u7cbe\u5de7, \u6211\u4eec\u53ef\u4ee5\u901a\u8fc73\u6761\u6307\u4ee4\u6765\u5b8c\u6210\u5185\u6838\u6808\u7684\u5207\u6362:</p> <pre><code>__am_asm_trap:\n  csrrw sp, mscratch, sp   // (1) atomically exchange sp and mscratch\n  bnez sp, save_context    // (2) take the branch if we trapped from user\n  csrr sp, mscratch        // (3) if we trapped from kernel, restore the original sp\n\nsave_context:\n  // now sp is pointing to the kernel stack\n  // save the context...\n</code></pre> <p>\u4e3a\u4e86\u68c0\u67e5 <code>mscratch</code> \u7684\u503c, \u6211\u4eec\u901a\u8fc7(1)\u5de7\u5999\u5730\u4f7f\u7528\u4e86CSR\u8bbf\u95ee\u6307\u4ee4\u7684\u539f\u5b50\u4ea4\u6362\u529f\u80fd\u6765\u4ea4\u6362<code>sp</code>\u548c<code>mscratch</code>\u7684\u503c, \u8fd9\u6837\u65e2\u53ef\u4ee5\u628a\u539f\u6765\u7684<code>mscratch</code>\u503c\u8bfb\u5230\u901a\u7528\u5bc4\u5b58\u5668 <code>sp</code> \u4e2d\u8fdb\u884c\u6bd4\u8f83(riscv32\u7684\u5206\u652f\u6307\u4ee4\u4e0d\u80fd\u8bbf\u95eeCSR\u5bc4\u5b58\u5668), \u53c8\u53ef\u4ee5\u628a\u539f\u6765\u7684<code>sp</code>\u503c\u4fdd\u5b58\u5230<code>mscratch</code>\u5bc4\u5b58\u5668\u4e2d\u907f\u514d\u88ab\u7834\u574f. </p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7(2)\u5224\u65ad\u521a\u624d\u8bfb\u51fa\u7684 <code>mscratch</code> \u503c(\u5373\u6982\u5ff5\u4e0a\u7684<code>ksp</code>): </p> <p>\u5982\u679c\u503c\u662f <code>0</code>, \u8bf4\u660e\u8fdb\u5165CTE\u4e4b\u524d\u662f\u5185\u6838\u6001, \u800c\u6b64\u65f6\u5185\u6838\u6808\u7684\u6307\u9488\u5df2\u7ecf\u88ab(1)\u4ea4\u6362\u5230<code>mscratch</code>\u5bc4\u5b58\u5668\u4e2d\u4e86, \u4e8e\u662f\u901a\u8fc7(3)\u628a\u5185\u6838\u6808\u7684\u6307\u9488\u8bfb\u56de\u6765; </p> <p>\u5982\u679c\u503c\u4e0d\u662f <code>0</code>, \u8bf4\u660e\u8fdb\u5165CTE\u4e4b\u524d\u662f\u7528\u6237\u6001, \u9700\u8981\u628a<code>sp</code>\u5207\u6362\u5230\u5185\u6838\u6808, \u4f46\u6307\u4ee4(1)\u5df2\u7ecf\u5b8c\u6210\u4e86\u8fd9\u4e00\u5207\u6362\u5de5\u4f5c\u4e86, \u56e0\u6b64\u6b64\u65f6\u76f4\u63a5\u8df3\u8f6c\u5230<code>save_context</code>\u5904\u6765\u4fdd\u5b58\u4e0a\u4e0b\u6587\u5373\u53ef.</p> <p>\u4e34\u65f6\u5bc4\u5b58\u5668\u7684\u65b9\u6848</p> <p>\u540c\u6837\u662f\u4f5c\u4e3aCTE\u7684\u4e34\u65f6\u5bc4\u5b58\u5668, mips32\u9009\u62e9\u5728GPR\u4e2d\u5206\u914d\u51fa<code>k0</code>\u548c<code>k1</code>, \u800criscv32\u5219\u662f\u91c7\u7528<code>mscratch</code>\u8fd9\u4e2aCSR\u5bc4\u5b58\u5668. \u8fd9\u4e24\u79cd\u65b9\u6848\u76f8\u6bd4, \u662f\u5426\u5b58\u5728\u54ea\u4e00\u79cd\u65b9\u6848\u66f4\u4f18? \u4e3a\u4ec0\u4e48?</p> <p>\u7814\u7a76\u4e00\u4e0b\u3002</p> <p>\u8bb0\u5f55\u4e00\u4e9b\u95ee\u9898</p> <ol> <li> <p>\u6c47\u7f16</p> <p>\u5173\u4e8e\u6761\u4ef6\u8bed\u53e5\u5199\u6c47\u7f16\u548c C \u5bf9\u5e94\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p> <pre><code>int main(void) {\n int a = 1;\n if (a == 0) {\n     a = 3;\n }\n a = 5;\n printf(\"a = %d\\n\", a);\n return 0;\n}\n</code></pre> <pre><code>main:\n     addi    sp,sp,-32\n     sw      ra,28(sp)\n     sw      s0,24(sp)\n     addi    s0,sp,32\n     li      a5,1\n     sw      a5,-20(s0)\n     lw      a5,-20(s0)\n     bne     a5,zero,.L2  #  if (a == 0) a != 0\n     li      a5,3\n     sw      a5,-20(s0)\n.L2:\n     li      a5,5\n     sw      a5,-20(s0)\n     lw      a1,-20(s0)\n     lui     a5,%hi(.LC0)\n     addi    a0,a5,%lo(.LC0)\n     call    printf\n     li      a5,0\n     mv      a0,a5\n     lw      ra,28(sp)\n     lw      s0,24(sp)\n     addi    sp,sp,32\n     jr      ra\n</code></pre> <p>\u7d27\u8ddf\u5728 <code>bnez</code> \u4e0b\u4e00\u884c\u7684\u8bed\u53e5\uff0c\u624d\u662f\u6761\u4ef6\u8bed\u53e5\u5185\u90e8\u8981\u6267\u884c\u7684\u3002</p> <p>\u8df3\u8f6c\u7684\u6807\u7b7e\u5904\u662f\u6761\u4ef6\u8bed\u53e5\u7684\u4e0b\u4e00\u6761\u8bed\u53e5\u3002</p> </li> <li> <p>\u5177\u4f53\u5b9e\u73b0</p> <pre><code>#define concat_temp(x, y) x ## y\n#define concat(x, y) concat_temp(x, y)\n#define MAP(c, f) c(f)\n\n#define PRIV_MODE_U 0\n#define PRIV_MODE_S 1\n#define PRIV_MODE_M 3\n\n#if __riscv_xlen == 32\n#define LOAD  lw\n#define STORE sw\n#define XLEN  4\n#else\n#define LOAD  ld\n#define STORE sd\n#define XLEN  8\n#endif\n\n#define REGS_LO16(f) \\\n      f( 1)       f( 3) f( 4) f( 5) f( 6) f( 7) f( 8) f( 9) \\\nf(10) f(11) f(12) f(13) f(14) f(15)\n#ifndef __riscv_e\n#define REGS_HI16(f) \\\n                                    f(16) f(17) f(18) f(19) \\\nf(20) f(21) f(22) f(23) f(24) f(25) f(26) f(27) f(28) f(29) \\\nf(30) f(31)\n#define NR_REGS 32\n#else\n#define REGS_HI16(f)\n#define NR_REGS 16\n#endif\n\n#define REGS(f) REGS_LO16(f) REGS_HI16(f)\n\n#define PUSH(n) STORE concat(x, n), (n * XLEN)(sp);\n#define POP(n)  LOAD  concat(x, n), (n * XLEN)(sp);\n\n#define CONTEXT_SIZE  ((NR_REGS + 3 + 2) * XLEN)\n#define OFFSET_SP     ( 2 * XLEN)\n#define OFFSET_CAUSE  ((NR_REGS + 0) * XLEN)\n#define OFFSET_STATUS ((NR_REGS + 1) * XLEN)\n#define OFFSET_EPC    ((NR_REGS + 2) * XLEN)\n#define OFFSET_NP     ((NR_REGS + 3) * XLEN)\n\n.align 3\n.globl __am_asm_trap\n__am_asm_trap:\n# switch to kernel stack\n  csrrw sp, mscratch, sp   // (1) atomically exchange sp and mscratch\n  bnez sp, create_context_space  // (2) take the branch if we trapped from user\n  csrrw sp, mscratch, sp   // (3) if we trapped from kernel, restore the original sp\n                           // after above 3 inst, sp must be ksp\n# notice the conditional statements in assembly.\ncreate_context_space:\n  addi sp, sp, -CONTEXT_SIZE\n  MAP(REGS, PUSH)\n  # \u5148\u5165\u6808\u4fdd\u5b58\u7528\u5230\u7684GPR, \u4e5f\u5c31\u662f\u8fdb\u5165trap \u524d\u7684\u76f8\u5173\u5bc4\u5b58\u5668\n  # \u5982\u679c\u540e\u9762save_kernel_context\u518d\u4fdd\u5b58\u7684\u8bdd\uff0c\u5b58\u7684\u5c31\u662f\u5207\u6362\u5185\u6838\u6808\u7528\u5230\u7684\u4e00\u4e9b\u5bc4\u5b58\u5668\u4e86\u3002\n\n  # c-&gt;np = (ksp == 0) ? KERNEL : USER;\n  csrr t0, mscratch\n  beqz t0, save_kernel_stack\n\n  csrr t0, mscratch    # exception from user\n  li t1, PRIV_MODE_U   # c-&gt;np = USER\n  j save_kernel_context\n\nsave_kernel_stack:\n  mv t0, sp            # exception from kernel\n  li t1, PRIV_MODE_M   # c-&gt;np = KERNEL\n  addi t0, t0, CONTEXT_SIZE\n\n# \u6211\u4e4b\u540e\u8981\u4f7f\u7528\u8fd9\u4e2a sp \u548c priv\uff0c\u628a\u5b83\u5165\u6808\n# \u4f46\u662f\u53c8\u4e0d\u80fd\u5f71\u54cd\u5230\u8981\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\n# \u80fd\u4e0d\u80fd\u76f4\u63a5\u7528\u8fd9\u91cc\u7684\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u7ed3\u6784\u91cc\u7684sp \u548c t1\uff1f\n# \u6709\u533a\u522b\u5417\uff1f\u6709\u5427\u3002\n# \u6211\u5207\u6362\u5230\u5185\u6838\u7ebf\u7a0b\uff0c\u90a3\u8fd9\u4e2a\u65f6\u5019\u7684\u6808\u6307\u9488\u5e94\u8be5\u6307\u5411\u7684\u662f\u5185\u6838\u6808\u4fdd\u5b58\u7684\u4e0a\u4e0b\u6587\u3002\n# \u4ed6\u91cc\u9762\u7684\u5404\u4e2a\u5bc4\u5b58\u5668\u5e94\u8be5\u4e0d\u4e00\u6837\uff1f\n# \u8981\u4e0d\u76f4\u63a5\u518d\u6269\u5927\u4e00\u4e0b\u6808\u7a7a\u95f4\uff1f\n# \u4e0d\u5bf9\uff0c\u4e00\u6837\u7684\uff0c\u4fdd\u5b58\u4e4b\u524d\u90fd\u8fdb\u884c\u8fc7\u540c\u6837\u7684\u64cd\u4f5c\uff0c\u5e94\u8be5\u53ef\u4ee5.\n# \u54e6\uff0c\u6240\u4ee5\u5728\u521a\u5f00\u59cb\u4fdd\u5b58\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5f00\u6808\u4e86\u3002\n# \u54e6\uff0c\u90fd\u5e2e\u6211\u4eec\u5199\u597d\u4e86\u8fd9\u4e2aOFFSET_SP\n\nsave_kernel_context:\n  # ksp = 0; support re-entry of CTE\n  csrw mscratch, zero\n\n  STORE t0, OFFSET_SP(sp) \n  STORE t1, OFFSET_NP(sp)\n\n csrr t0, mcause\n csrr t1, mstatus\n csrr t2, mepc\n\n STORE t0, OFFSET_CAUSE(sp)\n STORE t1, OFFSET_STATUS(sp)\n STORE t2, OFFSET_EPC(sp)\n\n  # set mstatus.MPRV to pass difftest\n  li a0, (1 &lt;&lt; 17)\n  or t1, t1, a0\n  csrw mstatus, t1\n\n  mv a0, sp\n  jal __am_irq_handle\n  mv sp, a0\n\n  # c-&gt;np != USER\n  LOAD t0, OFFSET_NP(sp)\n  li t1, PRIV_MODE_U\n  bne t0, t1, restore_ksp_ok\n\n  # c-&gt;np == USER\n  # the value of ksp is the bottom of the kernel stack\n  addi t0, sp, CONTEXT_SIZE\n  csrw mscratch, t0\n\nrestore_ksp_ok:\n  LOAD t1, OFFSET_STATUS(sp)\n  LOAD t2, OFFSET_EPC(sp)\n  csrw mstatus, t1\n  csrw mepc, t2\n\n  MAP(REGS, POP)\n\n  # do not forget to restore the sp before entering the CTE\n  LOAD sp, OFFSET_SP(sp)\n  mret\n</code></pre> <pre><code>|         | &lt;-- sp\n| pdir    | \n| np      | \n| mepc    |\n| mstatus |   \n| mcause  |\n| x31     |   \n| x30     |\n...\n| x3      |\n|         |\n| x1      |\n|         | &lt;-- sp (addi sp, sp, -CONTEXT_SIZE)\n</code></pre> </li> <li> <p>\u501f\u52a9 <code>trap.S</code> \u603b\u7ed3\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5185\u5bb9\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u4e0a\u4e0b\u6587\u7684\u672c\u8d28\u5c31\u662f\u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8ba8\u8bba\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4e5f\u5c31\u662f\u8fdb\u7a0b\u5207\u6362\u7684\u5185\u5bb9\u4e86\u3002\u5728 PA4.1 \u4e5f\u662f\u6709\u76f8\u5173\u7684\u5185\u5bb9\u4e86\uff0c\u4f46\u73b0\u5728\u4e3a\u6709\u4e86\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e4b\u540e\uff0c\u8ba9\u73b0\u4ee3\u7684\u8fdb\u7a0b\u5207\u6362\u7684\u6982\u5ff5\u66f4\u52a0\u5b8c\u6574\u3002</p> <p>\u7ed3\u5408\u6559\u6750\u603b\u7ed3\u5173\u4e8e\u8fdb\u7a0b\u5207\u6362\u7684\u6d41\u7a0b\uff08\u8fdb\u4e00\u6b65\u4ee5 <code>FreeRTOS</code> \u6e90\u4ee3\u7801\u770b\u770b\u8c03\u5ea6\uff09</p> </li> <li> <p>\u603b\u7ed3\u4e00\u4e9b\u4e1c\u897f</p> <ul> <li> <p>C struct  \u548c Stack in RISC-V</p> <p>\u5bf9\u4e8e\u6808\u7ed3\u6784\uff0c\u4e00\u822c\u7684\u6307\u4ee4\u96c6\u67b6\u6784\u662f\u901a\u8fc7 push\u3001pop\u7684\uff0c\u4f46\u662f RISC-V isa \u5e76\u6ca1\u6709\u63d0\u4f9b\u4e13\u95e8\u7684\u5165\u6808\u548c\u51fa\u6808\u6307\u4ee4\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u52a0\u6cd5\u4e0eload/store \u6307\u4ee4\u6765\u5b9e\u73b0\u5165\u6808\u548c\u51fa\u6808\uff0c\u800c\u751f\u6210\u6307\u4ee4\u53c8\u662f\u7531\u7f16\u8bd1\u5668\u51b3\u5b9a\u7684\u3002</p> <p>\u7f16\u8bd1\u5668\u4f1a\u6839\u636e RISC-V \u7684\u8c03\u7528\u7ea6\u5b9a\u6765\u751f\u6210\u7ba1\u7406\u6808\u7684\u4ee3\u7801\u3002\u4f8b\u5982\uff0cGCC \u548c LLVM/Clang \u7b49\u7f16\u8bd1\u5668\u90fd\u4f1a\u4e3a RISC-V \u76ee\u6807\u751f\u6210\u7b26\u5408\u5176 ABI\uff08Application Binary Interface\uff09\u89c4\u8303\u7684\u6808\u7ba1\u7406\u4ee3\u7801\u3002\u8fd9\u4e9b\u4ee3\u7801\u786e\u4fdd\u4e86\u51fd\u6570\u8c03\u7528\u65f6\u6808\u7684\u6b63\u786e\u4f7f\u7528\u548c\u6062\u590d\uff0c\u4ee5\u53ca\u5728\u4e0d\u540c\u51fd\u6570\u4e4b\u95f4\u6b63\u786e\u4f20\u9012\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002</p> <p>\u5bf9\u6b64\u8fd9\u6837\u5c31\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u6211\u80fd\u4f7f\u7528\u6c47\u7f16\u7f16\u7a0b\uff0c\u90a3\u6211\u53ef\u4ee5\u4e0d\u901a\u8fc7 LIFO \u8fd9\u4e2a\u987a\u5e8f\u6765\u53d6\u5f97\u6808\u4e2d\u7684\u5143\u7d20\uff0c\u76f4\u63a5\u901a\u8fc7 store \u7c7b\u6307\u4ee4\u7684\u504f\u79fb\u91cf\u6765\u53d6\u5f97\u6808\u7ed3\u6784\u4e2d\u7684\u5143\u7d20\u3002</p> <p>\u5c31\u50cf <code>trap.S</code> \u4e2d\u7684 <code>sp</code> \u504f\u79fb <code>#define OFFSET_SP     ( 2 * XLEN)</code></p> <p>\u5728\u5165\u6808 <code>gpr</code> \u7684 \u65f6\u5019\uff0c\u552f\u72ec\u6ca1\u6709\u5165\u6808 <code>sp</code>\uff0c\u6211\u80fd\u5728\u5728\u4fdd\u5b58\u5185\u6838\u4e0a\u4e0b\u6587\u518d\u6765\u5165\u6808 <code>sp</code>\uff0c\u8fd9\u6837\u7075\u6d3b\u6027\u8fd8\u662f\u633a\u9ad8\u7684\u3002</p> <p>\u8fd9\u4e5f\u5f15\u53d1\u6211\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u522b\u7684\u67b6\u6784\u867d\u7136\u662f\u901a\u8fc7 push\u3001pop \u6307\u4ee4\u6765\u5b58\u653e\u4e00\u4e9b\u6570\u636e\u7684\uff0c\u90a3\u6211\u662f\u4e0d\u662f\u4e5f\u80fd\u901a\u8fc7 <code>sp</code>\u3001<code>fp</code>(\u6808\u5e27\u6307\u9488)\u6765\u8bbf\u95ee\u6808\u7ed3\u6784\u4e2d\u7684\u5185\u5bb9\uff1f\u90a3\u8fd9\u6837\u8fd8\u6709\u5fc5\u8981\u5f15\u5165 push \u6307\u4ee4\u5417\uff1f\u54e6\uff0c\u52a0\u5feb\u901f\u5ea6\uff1f\u3002\u54ce\u5440\u53c8\u56de\u5230\u53e4\u8001\u65f6\u5019\u6ca1\u6709push\u6307\u4ee4\u7684\u65f6\u5019\u4e86\u3002</p> <p>\u5173\u4e8e\u901a\u8fc7 <code>sp</code>\u3001<code>fp</code> \u6765\u8bbf\u95ee\u6808\u4e2d\u7684\u5185\u5bb9\uff0c\u8fd9\u5e94\u8be5\u662f\u7f16\u8bd1\u5668\u505a\u7684\u5185\u5bb9\u3002 </p> <p>\u90a3\u4e3a\u4ec0\u4e48 RISC-V \u4e0d\u5f15\u5165 push \u6307\u4ee4\u5462\uff1f\uff08\u7fa4\u7ec4\u7684\u56de\u7b54\uff1a<code>Zc*</code> \u6269\u5c55\u4e0a\u4e5f\u6709 <code>cm.push</code>\u7b49\uff0c\u4e0d\u8ba8\u8bba\uff09</p> <p>SP \u8981\u6c4216 byte \u5bf9\u9f50\uff0c\u53ef\u80fd\u662f\u4e3a\u4e86\u517c\u5bb9 128-bits\u7684\uff1a\u3010C\u548c\u6c47\u7f16\u3011VLA &amp; alloca &amp; RISC-V\u6c47\u7f16</p> <p>\u8fd9\u53c8\u8ba9\u6211\u60f3\u8d77\u4e86\uff0c\u5173\u4e8e\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6808\u548c\u5185\u5b58\u7ba1\u7406\u4e2d\u7684\u6808\u533a\u522b\u3002</p> </li> <li> <p>\u901a\u8fc7 qemu + gdb \u8de8\u67b6\u6784/\u8de8\u5e73\u53f0\u8c03\u8bd5</p> <p>\u901a\u8fc7qemu+gdb\u5b9e\u73b0\u8de8\u67b6\u6784\u8c03\u8bd5 - \u5218\u8dd1\u8dd1 - \u535a\u5ba2\u56ed (cnblogs.com)</p> </li> </ul> </li> </ol> <p>\u52c9\u5f3a\u5b9e\u73b0</p> <p></p> <p>\u603b\u611f\u89c9\u8fd8\u662f\u6709\u70b9\u95ee\u9898</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>Nanos-lite\u4e0e\u5e76\u53d1bug (\u5efa\u8bae\u4e8c\u5468\u76ee/\u5b66\u5b8c\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u601d\u8003)</p> <p>\u4e0a\u6587\u8ba8\u8bba\u5e76\u53d1\u7684\u65f6\u5019\u63d0\u5230: \u66f4\u4e00\u822c\u5730, \u7528\u6237\u8fdb\u7a0b\u90fd\u4f1a\u5e76\u53d1\u5730\u6267\u884c\u7cfb\u7edf\u8c03\u7528, \u64cd\u4f5c\u7cfb\u7edf\u8fd8\u9700\u8981\u4fdd\u8bc1\u5b83\u4eec\u90fd\u80fd\u6309\u7167\u7cfb\u7edf\u8c03\u7528\u7684\u8bed\u4e49\u6b63\u786e\u5730\u6267\u884c.</p> <p>\u6211\u4eec\u5728PA3\u4e2d\u77e5\u9053<code>printf()</code>\u4f1a\u901a\u8fc7<code>malloc()</code>\u7533\u8bf7\u7f13\u51b2\u533a, \u800c<code>malloc()</code>\u53c8\u53ef\u80fd\u4f1a\u6267\u884c<code>_sbrk()</code>, \u901a\u8fc7<code>SYS_brk</code>\u9677\u5165\u5185\u6838; \u5728\u4e0a\u4e00\u4e2a\u9636\u6bb5\u4e2d, \u6211\u4eec\u5b9e\u73b0\u4e86\u652f\u6301\u5206\u9875\u673a\u5236\u7684<code>mm_brk()</code>, \u5728\u5fc5\u8981\u7684\u65f6\u5019\u5b83\u4f1a\u901a\u8fc7<code>new_page()</code>\u7533\u8bf7\u4e00\u9875. \u800c\u4ed9\u5251\u548chello\u7528\u6237\u8fdb\u7a0b\u90fd\u4f1a\u8c03\u7528<code>printf()</code>, \u4f7f\u5f97\u5b83\u4eec\u53ef\u80fd\u4f1a\u5e76\u53d1\u6267\u884c<code>SYS_brk</code>. \u601d\u8003\u4e00\u4e0b, \u76ee\u524dNanos-lite\u7684\u8bbe\u8ba1\u4f1a\u5bfc\u81f4\u5e76\u53d1bug\u5417? \u4e3a\u4ec0\u4e48?</p> <p>\u4e8c\u8005\u90fd\u8981\u8fdb\u884c\u5806\u5185\u5b58\u7684\u5206\u914d\uff0c\u5e76\u4f7f\u7528\u8fd9 <code>current</code> \u6307\u9488\u6765\u8868\u793a\u5f53\u524d\u8fdb\u7a0b\u3002</p> <p>\u5148\u660e\u786e\u51e0\u70b9\uff0c</p> <ul> <li>\u6211\u4eec\u76ee\u524d\u5b9e\u73b0\u7684 OS \u53ea\u662f\u5728\u4e00\u4e2a\u6838\u4e0a\u7684\uff0c\u5c5e\u4e8e\u4f2a\u5e76\u53d1\u3002</li> <li>\u6211\u4eec\u7684\u62a2\u5360\u591a\u4efb\u52a1\uff08\u5206\u65f6\uff09\u662f\u57fa\u4e8e\u786c\u4ef6\u4e2d\u65ad\u6765\u5b9e\u73b0\u7684\u3002</li> </ul> <p>\u5728\u5173\u4e2d\u65ad\u65f6\uff0c\u9664\u975e\u672c\u7528\u6237\u8fdb\u7a0b\u4e3b\u52a8\u81ea\u9677\u8fdb\u5165\u8c03\u5ea6\uff0c\u5426\u5219\u8be5\u8fdb\u7a0b\u5c06\u4e00\u76f4\u5360\u7528CPU\u8d44\u6e90\uff0c\u6240\u4ee5\uff0c\u5176\u4ed6\u8fdb\u7a0b\u8fd9\u4e2a\u65f6\u5019\u4e0d\u4f1a\u4fee\u6539 <code>current-&gt;max_brk</code>\uff0c\u90a3\u4e48<code>mm_brk</code> \u7684\u64cd\u4f5c\u53ef\u4ee5\u770b\u6210\u662f\u539f\u5b50\u7684\u3002</p> <p>\u4f46\u5728\u5f00\u4e2d\u65ad\u540e\uff0c</p> <ul> <li>\u5f00\u4e86\u4e2d\u65ad\u540e\uff1f</li> </ul> <p>\u4f46\u662f\uff0c\u8fd9\u4e2a <code>current</code> \u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u65e0\u8bba\u6211\u8fdb\u7a0b\u600e\u4e48\u5207\u6362\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u53d8\u91cf\u4f9d\u7136\u5728 <code>.data</code> section \u5440\uff0c\u6211\u8fdb\u884c\u6808\u5207\u6362\u4e5f\u4e0d\u4f1a\u5b58\u8fd9\u4e2a\u53d8\u91cf\u5440\u3002\u6240\u4ee5\uff0c\u8fd8\u662f\u4f1a\u5bfc\u81f4\u5e76\u53d1\u7684 bug \u5427\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u611f\u89c9\u6709\u70b9\u96be\u7406\u89e3\u5e76\u53d1\u3002\u3002\u3002\u8fd8\u662f\u4e0a\u4e86OS \u8bfe\u6765\u89e3\u91ca\u3002</p> <p>\u53e6\u5916\uff0c\u4e00\u70b9\u4e94\u7fa4\u7684\u76f8\u5173\u8ba8\u8bba\uff0c\u5173\u4e8e\u9501\u3001\u539f\u5b50\u3001\u5e76\u53d1\u3001\u4f2a\u5e76\u53d1\u7b49\u7b49\u7684\u6982\u5ff5\u3002</p> <p>\u5355\u7247\u673a\u4e2d\u5b9e\u73b0\u539f\u5b50\u64cd\u4f5c\uff0c\u76f4\u63a5\u5173\u4e2d\u65ad\uff1f\u8fd8\u662f\u4ec0\u4e48\uff1f\u8fd8\u9700\u8981\u5b66\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_31","title":"\u7f16\u5199\u4e0d\u673d\u7684\u4f20\u5947","text":""},{"location":"ysyx/pa/pa4/pa4.html#_32","title":"\u5c55\u793a\u4f60\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf","text":""},{"location":"ysyx/pa/pa4/pa4.html#onscripter","title":"\u8fd0\u884c <code>ONScripter</code> \u6a21\u62df\u5668\uff08\u9009\u505a\uff09","text":""},{"location":"ysyx/pa/pa4/pa4.html#-","title":"\u4e0b\u5b66\u671f\u9884\u544a - \u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u94fa\u57ab","text":""},{"location":"ysyx/pa/pa4/pa4.html#-nwm","title":"\u4f53\u9a8c\u865a\u62df\u5316 - \u7a97\u53e3\u7ba1\u7406\u5668 NWM","text":"<ul> <li> <p>\u601d\u8003\u9898</p> <p>\u5982\u4f55\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b9e\u73b0<code>fork()</code>?</p> <p>\u601d\u8003\u4e00\u4e0b, \u57fa\u4e8e\u4e0a\u8ff0\u529f\u80fd\u7684\u4ecb\u7ecd, \u6211\u4eec\u5e94\u8be5\u5982\u4f55\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b9e\u73b0<code>fork()</code>?</p> <p>\u628a\u8fdb\u7a0b\u770b\u6210\u4e00\u4e2a\u72b6\u6001\u673a\uff0c<code>fork</code> \u62f7\u8d1d \u8fd9\u4e2a\u72b6\u6001\u673a\u7684\u6240\u6709\u72b6\u6001\uff1a\u5bc4\u5b58\u5668\u3001\u5185\u5b58\u3002\u3002</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#-bug","title":"\u4f53\u9a8c\u5e76\u53d1 - \u7ed8\u56fe Bug","text":""},{"location":"ysyx/pa/pa4/pa4.html#-_1","title":"\u4f53\u9a8c\u6301\u4e45\u5316 - \u78c1\u76d8\u548c\u6e38\u620f\u5b58\u6863","text":"<p>\u4f3c\u4e4e\u5f88\u4e0d\u9519...</p> <p>\u7b49\u6709\u7a7a\u6211\u4ece\u5934\u628a\u524d\u9762\u7684\u9009\u505a\u9898\u505a\u4e86\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4ec0\u4e48\u662f\u64cd\u4f5c\u7cfb\u7edf?</p> <p>\u6211\u4eec\u7ed9\u5927\u5bb6\u7b80\u5355\u68b3\u7406\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5728\u865a\u62df\u5316, \u5e76\u53d1, \u548c\u6301\u4e45\u5316\u4e09\u4e2a\u65b9\u9762\u7684\u6311\u6218. \u4f46\u5bf9\u4e00\u4e2a\u7cfb\u7edf\u6765\u8bf4, \u6700\u590d\u6742\u7684\u95ee\u9898\u5219\u662f\u6765\u6e90\u4e8e\u5404\u79cd\u673a\u5236\u4e4b\u95f4\u7684\u4ea4\u4e92: \u591a\u4e2a\u8fdb\u7a0b\u6267\u884c<code>fork()</code>\u540e\u5e76\u53d1\u5730\u901a\u8fc7<code>mmap()</code>\u8bfb\u5199\u78c1\u76d8\u4e0a\u7684\u540c\u4e00\u4e2a\u6587\u4ef6, \u5176\u884c\u4e3a\u4f1a\u600e\u4e48\u6837?</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5e76\u4e0d\u662f\u4e3a\u4e86\u6545\u610f\u5201\u96be\u5927\u5bb6: \u771f\u5b9e\u7684\u95ee\u9898\u5f88\u6709\u53ef\u80fd\u5c31\u662f\u5728\u591a\u4e2a\u6a21\u5757\u548c\u673a\u5236\u7684\u76f8\u4e92\u4f5c\u7528\u4e0b\u4ea7\u751f\u7684, \u8981\u89e3\u51b3\u771f\u5b9e\u7684\u95ee\u9898, \u4f60\u5c31\u9700\u8981\u5b66\u4f1a\u4ece\u591a\u4e2a\u89d2\u5ea6\u7cfb\u7edf\u5730\u601d\u8003. \u64cd\u4f5c\u7cfb\u7edf\u4f5c\u4e3a\u4e00\u4e2a\u4e16\u754c\u4e0a\u6700\u590d\u6742\u7684\u8f6f\u4ef6, \u76f8\u4fe1\u4f60\u5728\u4e0b\u5b66\u671f\u5b66\u4e60\u7684\u65f6\u5019\u4e5f\u4f1a\u5bf9\u7cfb\u7edf\u7684\u590d\u6742\u6027\u6709\u6240\u4f53\u4f1a.</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_33","title":"\u4ece\u4e00\u5230\u65e0\u7a77\u5927","text":"<p>\u4e8b\u5b9e\u4e0a, \u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u5de5\u4f5c\u53ea\u505a\u4e24\u4ef6\u4e8b\u60c5:</p> <ul> <li>make things work</li> <li>make things work better</li> </ul> <p>PA\u8ba9\u5927\u5bb6\u4f53\u4f1a\u4e86\u4e00\u6b21make things work\u7684\u5168\u8fc7\u7a0b. \u5177\u4f53\u5730, PA\u4ee5AM\u4e3a\u4e3b\u7ebf, \u4ece\u96f6\u5f00\u59cb\u5c55\u793a\u4e86\u786c\u4ef6, \u8fd0\u884c\u65f6\u73af\u5883(\u64cd\u4f5c\u7cfb\u7edf)\u548c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u540c\u6b65\u6f14\u8fdb\u7684\u5173\u7cfb:</p> <ul> <li>TRM - \u786c\u4ef6\u6709\u6307\u4ee4\u548c\u5185\u5b58, \u51e0\u4e4e\u65e0\u9700\u4efb\u4f55\u8fd0\u884c\u65f6\u73af\u5883, \u5c31\u80fd\u8fd0\u884c\u6240\u6709\u7684\u53ef\u8ba1\u7b97\u7b97\u6cd5</li> <li>IOE - \u786c\u4ef6\u6dfb\u52a0\u8f93\u5165\u8f93\u51fa, \u8fd0\u884c\u65f6\u73af\u5883\u63d0\u4f9b\u8bbe\u5907\u8bbf\u95ee\u7684\u62bd\u8c61, \u5c31\u80fd\u8fd0\u884c\u5355\u4e00\u7684\u4ea4\u4e92\u5f0f\u7a0b\u5e8f</li> <li>CTE - \u786c\u4ef6\u6dfb\u52a0\u5f02\u5e38\u5904\u7406, \u8fd0\u884c\u65f6\u73af\u5883\u6dfb\u52a0\u4e0a\u4e0b\u6587\u7ba1\u7406, \u5c31\u53ef\u4ee5\u652f\u6301\u6279\u5904\u7406\u7cfb\u7edf, \u8ba9\u7528\u6237\u7a0b\u5e8f\u987a\u5e8f\u5730\u81ea\u52a8\u8fd0\u884c</li> <li>VME - \u786c\u4ef6\u6dfb\u52a0\u865a\u5b58\u673a\u5236, \u8fd0\u884c\u65f6\u73af\u5883\u6dfb\u52a0\u865a\u5b58\u7ba1\u7406, \u5c31\u53ef\u4ee5\u652f\u6301\u5206\u65f6\u591a\u4efb\u52a1, \u8ba9\u591a\u4e2a\u7528\u6237\u7a0b\u5e8f\u5206\u65f6\u8fd0\u884c</li> </ul> <p>\u5f88\u597d\u7684\u9605\u8bfb\u6750\u6599\u3002</p> <ul> <li> <p>\u601d\u8003\u9898</p> <p>\u4e07\u53d8\u4e4b\u5b97 - \u91cd\u65b0\u5ba1\u89c6\u8ba1\u7b97\u673a</p> <p>\u4ec0\u4e48\u662f\u8ba1\u7b97\u673a? \u4e3a\u4ec0\u4e48\u770b\u4f3c\u5e73\u6de1\u65e0\u5947\u7684\u673a\u68b0, \u7adf\u7136\u80fd\u591f\u642d\u5efa\u51fa\u5982\u6b64\u7f24\u7eb7\u591a\u5f69\u7684\u8ba1\u7b97\u673a\u4e16\u754c? \u90a3\u4e9b\u9177\u70ab\u7684\u6e38\u620f\u753b\u9762, \u7a76\u7adf\u548c\u51b7\u51b0\u51b0\u7684\u7535\u8def\u6709\u4ec0\u4e48\u5173\u7cfb?</p> <p></p> <p>\u771f\u662f\u5389\u5bb3\u554a~\uff01</p> </li> </ul>"},{"location":"ysyx/pa/pa4/pa4.html#_34","title":"\u5fc5\u7b54\u9898","text":"<ol> <li> <p>\u5206\u65f6\u591a\u4efb\u52a1\u7684\u5177\u4f53\u8fc7\u7a0b</p> <p>\u8bf7\u7ed3\u5408\u4ee3\u7801, \u89e3\u91ca\u5206\u9875\u673a\u5236\u548c\u786c\u4ef6\u4e2d\u65ad\u662f\u5982\u4f55\u652f\u6491\u4ed9\u5251\u5947\u4fa0\u4f20\u548chello\u7a0b\u5e8f\u5728\u6211\u4eec\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf(Nanos-lite, AM, NEMU)\u4e2d\u5206\u65f6\u8fd0\u884c\u7684.</p> <ul> <li>\u5206\u9875\u673a\u5236 \u5206\u9875\u673a\u5236\u7684\u6700\u5927\u7528\u5904\u5c31\u662f\u7ed9<code>hello</code> \u548c<code>pal</code>\u4e24\u4e2a\u4e0d\u540c\u7684\u8fdb\u7a0b\u4f7f\u7528\u76f8\u540c\u7684\u865a\u62df\u5730\u5740\u4f46\u662f\u6620\u5c04\u5230\u4e86\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u8ba9\u4ed6\u4eec\u7684\u8fd0\u884c\u4e0d\u4f1a\u53d1\u751f\u5185\u5b58\u7684\u51b2\u7a81\uff0c\u4ed6\u4eec\u90fd\u6709\u81ea\u5df1\u7684\u5185\u5b58\u7a7a\u95f4\u3002</li> <li>\u65f6\u949f\u4e2d\u65ad \u56e0\u4e3a\u5206\u9875\u673a\u5236\u7684\u5b58\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e24\u4e2a\u6587\u4ef6\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e2d\u65ad\u673a\u5236\u6765\u5b9e\u73b0\u4e24\u4e2a\u7a0b\u5e8f\u7684\u5206\u65f6\u8fd0\u884c\uff0c\u4e00\u5f00\u59cb\u8fd0\u884c<code>pal</code>\u7684\u865a\u62df\u5730\u5740\uff0c\u7136\u540e\u65f6\u949f\u6765\u63a7\u5236\u4e2d\u65ad\uff0c\u4fdd\u5b58\u597d\u73b0\u573a\u7136\u540e\u8df3\u8f6c\u5230<code>hello</code>\u7684\u865a\u62df\u5730\u5740\u5904\u6267\u884c\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba9CPU\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u4e4b\u95f4\u6765\u56de\u5207\u6362\uff0c\u4fdd\u8bc1\u6211\u4eec\u7684\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u540c\u65f6\u80fd\u8fd0\u884c\uff08\u5b8f\u89c2\u4e0a\u540c\u65f6\u6267\u884c\uff0c\u5fae\u89c2\u4e0a\u5e76\u53d1\u8fd0\u884c\uff09\u3002\u800c\u8fd9\u91cc\u7684\u8c03\u5ea6\u5c31\u662f\u4f9d\u9760\u6211\u4eec\u7684<code>schedule</code> \u51fd\u6570\u5207\u6362\u4e24\u4e2a\u7a0b\u5e8f\u7684\u6267\u884c\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u662f\u4f9d\u9760PCB\u6765\u7ba1\u7406\u8fd9\u4e24\u4e2a\u8fdb\u7a0b\u3002</li> </ul> <p>\u8fd9\u91cc\u5927\u6982\u7684\u6d41\u7a0b\u5c31\u662f\uff1a</p> <ol> <li>\u5148\u628a\u4e24\u4e2a\u4e0d\u540c\u7684\u7a0b\u5e8f\u94fe\u63a5\u5230\u4e0d\u540c\u7684\u5185\u5b58\u7a7a\u95f4\u4e0a\uff0c\u901a\u8fc7\u5206\u9875\u673a\u5236\u8ba9\u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4e92\u4e0d\u5e72\u6d89\u3002</li> <li>\u63a5\u7740 <code>nemu</code> \u4f1a\u68c0\u6d4b\u662f\u5426\u6709\u4e2d\u65ad\u6307\u4ee4\u6765\u5224\u65ad\u662f\u5426\u8981\u53d1\u751f\u786c\u4ef6\u4e2d\u65ad\uff0c\u63a5\u7740\u5c31\u4f1a\u6839\u636e\u4e2d\u65ad\u7684\u7c7b\u578b\u6765\u53d1\u73b0\u8fd9\u662f\u65f6\u949f\u4e2d\u65ad\u540e\u5728\u5904\u7406\u4e8b\u4ef6\u51fd\u6570\u91cc\u8c03\u7528\u6211\u4eec\u7684<code>schedule</code>\u51fd\u6570\u5b9e\u73b0\u8c03\u5ea6\u5207\u6362\uff0c\u8fd9\u91cc\u5305\u62ec\u4e86\u4e0a\u4e0b\u6587\u7684\u4fdd\u5b58\u548c\u5207\u6362\uff0c\u800c\u6211\u4eec\u7684\u64cd\u4f5c\u7cfb\u7edf\u662f\u901a\u8fc7PCB\u6765\u7ba1\u7406\u8fd9\u4e24\u4e2a\u8fdb\u7a0b\u7684\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9e\u73b0\u8fdb\u7a0b\u8c03\u5ea6\uff0c\u5b8c\u6210\u5206\u65f6\u591a\u4efb\u52a1\u4e86\u3002</li> </ol> </li> <li> <p>\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf</p> <p>\u5c1d\u8bd5\u5728Linux\u4e2d\u7f16\u5199\u5e76\u8fd0\u884c\u4ee5\u4e0b\u7a0b\u5e8f:</p> <pre><code>int main() {\nchar *p = \"abc\";\np[0] = 'A';\nreturn 0;\n}\n</code></pre> <p>\u4f60\u4f1a\u770b\u5230\u7a0b\u5e8f\u56e0\u4e3a\u5f80\u53ea\u8bfb\u5b57\u7b26\u4e32\u8fdb\u884c\u5199\u5165\u800c\u89e6\u53d1\u4e86\u6bb5\u9519\u8bef. \u8bf7\u4f60\u6839\u636e\u5b66\u4e60\u7684\u77e5\u8bc6\u548c\u5de5\u5177, \u4ece\u7a0b\u5e8f, \u7f16\u8bd1\u5668, \u94fe\u63a5\u5668, \u8fd0\u884c\u65f6\u73af\u5883, \u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u7b49\u89c6\u89d2\u5206\u6790\"\u5b57\u7b26\u4e32\u7684\u5199\u4fdd\u62a4\u673a\u5236\u662f\u5982\u4f55\u5b9e\u73b0\u7684\". \u6362\u53e5\u8bdd\u8bf4, \u4e0a\u8ff0\u7a0b\u5e8f\u5728\u6267\u884c<code>p[0] = 'A'</code>\u7684\u65f6\u5019, \u8ba1\u7b97\u673a\u7cfb\u7edf\u7a76\u7adf\u53d1\u751f\u4e86\u4ec0\u4e48\u800c\u5f15\u53d1\u6bb5\u9519\u8bef? \u8ba1\u7b97\u673a\u7cfb\u7edf\u53c8\u662f\u5982\u4f55\u4fdd\u8bc1\u6bb5\u9519\u8bef\u4f1a\u53d1\u751f? \u5982\u4f55\u4f7f\u7528\u5408\u9002\u7684\u5de5\u5177\u6765\u8bc1\u660e\u4f60\u7684\u60f3\u6cd5?</p> <p>\u5728 Linux \u73af\u5883\u4e2d\uff0c\u5c1d\u8bd5\u4fee\u6539\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\uff08\u5982\u4e0a\u8ff0\u7a0b\u5e8f\u4e2d\u7684 <code>\"abc\"</code>\uff09\u4f1a\u5f15\u53d1\u6bb5\u9519\u8bef\uff08Segmentation Fault\uff09\uff0c\u56e0\u4e3a\u5b57\u7b26\u4e32\u5e38\u91cf\u901a\u5e38\u5b58\u50a8\u5728\u53ea\u8bfb\u7684\u6570\u636e\u6bb5\u4e2d\u3002\u4e0b\u9762\u662f\u4ece\u4e0d\u540c\u89d2\u5ea6\u5206\u6790\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <ul> <li> <p>\u8fdb\u4e00\u6b65\u5206\u6790</p> <ol> <li> <p>\u7a0b\u5e8f\u89d2\u5ea6</p> <ul> <li>\u7a0b\u5e8f\u4e2d\u7684 <code>p</code> \u662f\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u6307\u9488\uff0c<code>\"abc\"</code> \u88ab\u5b58\u50a8\u5728\u53ea\u8bfb\u7684\u6570\u636e\u6bb5\u4e2d\u3002</li> <li>\u5c1d\u8bd5\u901a\u8fc7 <code>p[0] = 'A';</code> \u4fee\u6539\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5b9e\u9645\u4e0a\u662f\u8bd5\u56fe\u5199\u5165\u4e00\u4e2a\u53ea\u8bfb\u7684\u5185\u5b58\u533a\u57df\u3002</li> </ul> </li> <li> <p>\u7f16\u8bd1\u5668\u89d2\u5ea6</p> <ul> <li>\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u65f6\u4f1a\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u653e\u5728\u4ee3\u7801\u4e2d\u7684\u4e00\u4e2a\u53ea\u8bfb\u533a\u57df\uff0c\u901a\u5e38\u662f <code>.rodata</code> \u6bb5\uff08Read-Only Data Segment\uff09\u3002</li> </ul> </li> <li> <p>\u94fe\u63a5\u5668\u89d2\u5ea6</p> <ul> <li>\u94fe\u63a5\u5668\u5728\u751f\u6210\u6700\u7ec8\u53ef\u6267\u884c\u6587\u4ef6\u65f6\uff0c\u4f1a\u4fdd\u7559\u7f16\u8bd1\u5668\u653e\u7f6e\u7684\u53ea\u8bfb\u5c5e\u6027\u3002</li> </ul> </li> <li> <p>\u8fd0\u884c\u65f6\u73af\u5883\u548c\u64cd\u4f5c\u7cfb\u7edf\u89d2\u5ea6</p> <ul> <li> <p>\u64cd\u4f5c\u7cfb\u7edf\u5728\u52a0\u8f7d\u7a0b\u5e8f\u65f6\uff0c\u4f1a\u6839\u636e\u7a0b\u5e8f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5934\u90e8\u4fe1\u606f\u8bbe\u7f6e\u5185\u5b58\u4fdd\u62a4\u3002\u8fd9\u5305\u62ec\u5c06 <code>.rodata</code> \u6bb5\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u3002</p> </li> <li> <p>\u5f53\u7a0b\u5e8f\u5c1d\u8bd5\u5199\u5165 <code>.rodata</code> \u6bb5\u65f6\uff0c\u5185\u5b58\u4fdd\u62a4\u673a\u5236\u4f1a\u89e6\u53d1\u6bb5\u9519\u8bef\u3002</p> </li> </ul> </li> <li> <p>\u786c\u4ef6\u89d2\u5ea6</p> <ul> <li>CPU\u770b\u61c2\u7684\u53ea\u6709\u6307\u4ee4\u96c6\u91cc\u9762\u89c4\u5b9a\u7684\u6307\u4ee4\u3002\u8bbf\u5b58\u6307\u4ee4\u3002</li> <li> <p>\u73b0\u4ee3 CPU \u6709\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff09\uff0c\u5b83\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u8bbe\u7f6e\u7684\u9875\u8868\u6765\u51b3\u5b9a\u5185\u5b58\u8bbf\u95ee\u6743\u9650\u3002</p> </li> <li> <p>\u5f53\u5c1d\u8bd5\u8fdd\u53cd\u5185\u5b58\u8bbf\u95ee\u6743\u9650\u65f6\uff08\u5982\u5199\u5165\u53ea\u8bfb\u5185\u5b58\uff09\uff0cCPU \u4f1a\u629b\u51fa\u4e00\u4e2a\u4fdd\u62a4\u6545\u969c\uff08Protection Fault\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6355\u83b7\u8fd9\u4e2a\u6545\u969c\u5e76\u7ec8\u6b62\u7a0b\u5e8f\u3002</p> </li> </ul> <p>\u8fd9\u91cc\u53ef\u4ee5\u518d\u7ed3\u5408\u4e4b\u524d\u770b\u770b\u5b66\u4e60\u6781\u5ba2\u65f6\u95f4\u7684\u7b14\u8bb0\u770b\u770b <code>mmu</code> \u548c\u63a5\u6536\u5730\u5740\u7684\u8fdb\u4e00\u6b65\u8f6c\u6362\u3002</p> </li> </ol> </li> <li> <p>\u4f7f\u7528\u5de5\u5177\u6765\u8bc1\u660e</p> <ol> <li>\u4f7f\u7528 <code>objdump</code>\uff1a<ul> <li><code>objdump -T a.out</code> \u53ef\u4ee5\u663e\u793a\u7a0b\u5e8f\u7684\u7b26\u53f7\u8868\u548c\u5185\u5b58\u5730\u5740\uff0c\u67e5\u770b <code>.rodata</code> \u6bb5\u7684\u5730\u5740\u548c\u6743\u9650\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>gdb</code>\uff1a<ul> <li>\u4f7f\u7528 <code>gdb</code> \u9644\u52a0\u5230\u7a0b\u5e8f\u5e76\u8fd0\u884c\uff0c\u5f53\u7a0b\u5e8f\u5d29\u6e83\u65f6\uff0c<code>gdb</code> \u4f1a\u663e\u793a\u6bb5\u9519\u8bef\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u51fa\u9519\u7684\u6307\u4ee4\u548c\u8bbf\u95ee\u7684\u5185\u5b58\u5730\u5740\u3002</li> <li>\u547d\u4ee4 <code>info proc mappings</code> \u53ef\u4ee5\u663e\u793a\u7a0b\u5e8f\u7684\u5185\u5b58\u6620\u5c04\uff0c\u5305\u62ec\u5404\u4e2a\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u548c\u6743\u9650\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>strace</code>\uff1a<ul> <li><code>strace ./a.out</code> \u53ef\u4ee5\u8ffd\u8e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u5c3d\u7ba1\u5b83\u4e0d\u4f1a\u663e\u793a\u5185\u5b58\u8bbf\u95ee\u7684\u5177\u4f53\u7ec6\u8282\uff0c\u4f46\u53ef\u4ee5\u770b\u5230\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u548c\u7cfb\u7edf\u8c03\u7528\u7684\u76f8\u5173\u4fe1\u606f\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>valgrind</code>\uff1a<ul> <li><code>valgrind ./a.out</code> \u53ef\u4ee5\u68c0\u6d4b\u5185\u5b58\u9519\u8bef\uff0c\u5305\u62ec\u975e\u6cd5\u7684\u5185\u5b58\u8bbf\u95ee\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>readelf</code>\uff1a<ul> <li><code>readelf -S a.out</code> \u53ef\u4ee5\u663e\u793a ELF \u7a0b\u5e8f\u7684\u7a0b\u5e8f\u5934\u548c\u8282\u4fe1\u606f\uff0c\u5305\u62ec <code>.rodata</code> \u8282\u7684\u5927\u5c0f\u548c\u4f4d\u7f6e\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>nm</code>\uff1a<ul> <li><code>nm a.out</code> \u53ef\u4ee5\u5217\u51fa\u7a0b\u5e8f\u4e2d\u7684\u7b26\u53f7\u548c\u5b83\u4eec\u6240\u5728\u7684\u8282\uff0c\u6709\u52a9\u4e8e\u786e\u5b9a\u5b57\u7b26\u4e32\u5e38\u91cf\u4f4d\u4e8e\u54ea\u4e2a\u8282\u3002</li> </ul> </li> </ol> </li> </ul> </li> </ol>"},{"location":"ysyx/pa/pa4/pa4.html#_35","title":"\u4e00\u4e9b\u522b\u7684\u73a9\u610f","text":""},{"location":"ysyx/pa/summary/summary.html","title":"Summary","text":""},{"location":"ysyx/pa/summary/summary.html#goal","title":"Goal","text":"<ul> <li> <p>\u4e00\u5b9a\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u57fa\u7840</p> </li> <li> <p>\u7f16\u7801\u80fd\u529b</p> </li> <li> <p>\u5bf9\u6bcf\u4e2a\u95ee\u9898\u6709\u81ea\u5df1\u7684\u601d\u8003\u548c\u5b9e\u8df5</p> <p></p> </li> <li> <p>\uff08*\uff09\u5bf9\u8f6f\u786c\u4ef6\u534f\u540c\u3001\u5d4c\u5165\u5f0f\u611f\u5174\u8da3</p> </li> <li> <p>\uff08*\uff09\u5bf9\u7cfb\u7edf\u8f6f\u4ef6\uff08os\u3001compiler\u7b49\uff09\u611f\u5174\u8da3</p> </li> <li> <p>\uff08*\uff09\u5bf9\u5904\u7406\u5668\u8bbe\u8ba1\u611f\u5174\u8da3</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"ysyx/pa/summary/summary.html#_1","title":"\u76f8\u5173\u95ee\u9898","text":"<ol> <li> <p>\u5982\u5199\u4e0b\u4e00\u53e5 <code>int x = 10;</code> \u80fd\u660e\u767d\u8ba1\u7b97\u673a\u80cc\u540e\u53d1\u751f\u4e86\u4ec0\u4e48</p> <p></p> </li> <li> <p>\u56de\u7b54</p> <p></p> </li> <li> <p>\u4ece\u6309\u4e0b\u952e\u76d8\u5230\u663e\u793a\u5668\u4e0appt\u6362\u5230\u4e0b\u4e00\u9875\u7684\u8fc7\u7a0b\u3002</p> </li> </ol> <p>\u30102024 jyy OS \u8bfe \u603b\u7ed330\u3011</p> <ul> <li> <p>\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ebf\u8bfe\u7a0b\u7684\u6839\u672c\u95ee\u9898\uff1a\u5b57\u8282\u5e8f\u5217\u5982\u4f55\u771f\u6b63\u8fd0\u884c\u8d77\u6765\uff1f\u8fd9\u662f\u5982\u4f55\u548c\u903b\u8f91\u95e8\u8fde\u63a5\u8d77\u6765\u7684\uff1f</p> <p>\u7f16\u7a0b\u8bed\u8a00\u5982\u4f55\u548c\u903b\u8f91\u95e8\u8fde\u63a5\u8d77\u6765\u7684\uff1f\u5e94\u7528\u548c\u786c\u4ef6\u89c6\u89d2\u4e4b\u95f4\u662f\u4ec0\u4e48\uff1f</p> </li> <li> <p>\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u8c03\u8bd5\u5668\uff1f</p> <p>NEMU \u4e2d sdb \u8fd9\u4e2a\u4e1c\u897f\uff0c\u8bf4\u6e05\u695a\u539f\u7406\uff1f</p> <p>\u8c03\u8bd5\u5668\u7684\u539f\u7406\uff1f</p> </li> <li> <p>syscall</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u7f16\u7a0b\u800c\u9020\u51fa\u6765\u7684\u4e1c\u897f\uff1f</p> </li> </ul>"},{"location":"ysyx/pa/summary/summary.html#learn-1-nemu-am-os-app-makefile","title":"Learn 1: <code>NEMU &lt;-&gt; AM &lt;-&gt; os &lt;-&gt; app</code> \u7684 <code>Makefile</code> \u6784\u5efa","text":"<p>\u5728\u505a PA \u548c\u4ee5\u524d\u5b66\u4e60\u8ba1\u7b97\u673a\u7684\u65f6\u5019\uff0c\u88ab\u63d0\u53ca\u5230\u6700\u591a\u7684\u601d\u60f3\u4e4b\u4e00\u5c31\u662f\u5206\u5c42\uff0c\u8fd9\u4e5f\u8ba9\u6211\u5728\u60f3\uff0c\u7406\u8bba\u4e0a\u662f\u8fd9\u4e48\u8bf4\uff0c\u4f46\u662f\u5177\u4f53\u662f\u5982\u4f55\u6784\u5efa\u7684\u5462\uff1f</p> <p>AM \u7a0b\u5e8f\u662f\u600e\u4e48\u8dd1\u5728 NEMU \u4e0a\u7684\uff1f\u518d\u5f80\u4e0a\u7684 OS\u3001APP\uff0c\u7b80\u5355\u8fc7\u6d41\u7a0b\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#nemu","title":"NEMU","text":"<p>...</p>"},{"location":"ysyx/pa/summary/summary.html#am","title":"AM","text":"<p>\u5173\u952e\u5728\u4e8e\uff1a<code>abstract machine/Makefile</code> \u7684\u8fd9\u53e5\u8bdd\uff1a</p> <pre><code> 96 ### Paste in arch-specific configurations (e.g., from `scripts/x86_64-qemu.mk`)\n 97 -include $(AM_HOME)/scripts/$(ARCH).mk    \n\n # $(AM_HOME)/Makefile\n</code></pre> <p>-include \u548c C/C++ \u7684\u9884\u5904\u7406\u5668\u7684 #include \u6307\u4ee4\u7c7b\u4f3c\uff0c\u867d\u7136\u539f\u7406\u4e0a\u4e0d\u592a\u4e00\u6837\uff0c\u4f46\u90fd\u6709\u4e00\u79cd\u590d\u5236\u7c98\u8d34\u7684\u80fd\u529b\u3002</p> <p>From <code>kimi</code>:</p> <p>Makefile \u4e2d\u7684 <code>-include</code> \u6307\u4ee4\u548c C \u9884\u5904\u7406\u5668\u7684 <code>#include</code> \u6307\u4ee4\u5728\u529f\u80fd\u4e0a\u6709\u4e00\u4e9b\u76f8\u4f3c\u4e4b\u5904\uff0c\u4f46\u5b83\u4eec\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u573a\u666f\u662f\u4e0d\u540c\u7684\u3002</p> <ol> <li>C\u9884\u5904\u7406\u5668\u7684 <code>#include</code> \u6307\u4ee4\uff1a</li> <li><code>#include</code> \u662f C/C++ \u9884\u5904\u7406\u5668\u7684\u6307\u4ee4\uff0c\u7528\u4e8e\u5728\u7f16\u8bd1\u524d\u5c06\u6307\u5b9a\u7684\u5934\u6587\u4ef6\u5185\u5bb9\u5305\u542b\u5230\u6e90\u4ee3\u7801\u6587\u4ef6\u4e2d\u3002</li> <li>\u5b83\u7684\u4f5c\u7528\u662f\u590d\u5236\u7c98\u8d34\uff0c\u5373\u5c06\u5934\u6587\u4ef6\u7684\u5185\u5bb9\u76f4\u63a5\u63d2\u5165\u5230\u6e90\u4ee3\u7801\u6587\u4ef6\u4e2d\u76f8\u5e94\u7684\u4f4d\u7f6e\u3002</li> <li> <p>\u9884\u5904\u7406\u5668\u5904\u7406 <code>#include</code> \u6307\u4ee4\u540e\uff0c\u7f16\u8bd1\u5668\u624d\u5f00\u59cb\u7f16\u8bd1\u5904\u7406\u6e90\u4ee3\u7801\u3002</p> </li> <li> <p>Makefile \u7684 <code>-include</code> \u6307\u4ee4\uff1a</p> </li> <li><code>-include</code> \u662f Makefile \u7684\u4e00\u4e2a\u6307\u4ee4\uff0c\u7528\u4e8e\u544a\u8bc9 make \u5de5\u5177\u5728\u6784\u5efa\u76ee\u6807\u4e4b\u524d\u5148\u5305\u542b\uff08\u8bfb\u53d6\uff09\u6307\u5b9a\u7684 Makefile \u6587\u4ef6\u3002</li> <li>\u5b83\u5e76\u4e0d\u662f\u590d\u5236\u7c98\u8d34\u6587\u4ef6\u5185\u5bb9\uff0c\u800c\u662f\u5c06\u6307\u5b9a\u7684 Makefile \u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u548c\u53d8\u91cf\u7b49\u5408\u5e76\u5230\u5f53\u524d Makefile \u4e2d\u3002</li> <li><code>-include</code> \u6307\u4ee4\u901a\u5e38\u7528\u4e8e\u5305\u542b\u901a\u7528\u7684 Makefile \u7247\u6bb5\uff0c\u4ee5\u5b9e\u73b0\u4ee3\u7801\u7684\u590d\u7528\u548c\u6a21\u5757\u5316\u3002</li> </ol> <p>\u5177\u4f53\u6765\u8bf4\uff0c<code>-include</code> \u6307\u4ee4\u5728 Makefile \u4e2d\u7684\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ul> <li>\u5408\u5e76\u89c4\u5219\uff1a\u5c06\u6307\u5b9a Makefile \u4e2d\u5b9a\u4e49\u7684\u89c4\u5219\u548c\u53d8\u91cf\u5408\u5e76\u5230\u5f53\u524d Makefile \u4e2d\u3002</li> <li>\u6761\u4ef6\u5305\u542b\uff1a<code>-include</code> \u6307\u4ee4\u4f1a\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0cmake \u5de5\u5177\u4f1a\u5ffd\u7565\u8be5\u6307\u4ee4\u5e76\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u6307\u4ee4\u3002</li> <li>\u591a\u6b21\u5305\u542b\uff1a\u5982\u679c\u540c\u4e00\u4e2a\u6587\u4ef6\u88ab\u591a\u6b21\u5305\u542b\uff0cmake \u5de5\u5177\u4f1a\u5ffd\u7565\u540e\u7eed\u7684\u5305\u542b\uff0c\u4ee5\u907f\u514d\u91cd\u590d\u5305\u542b\u3002</li> </ul> <p>\u793a\u4f8b\uff1a <pre><code>-include config.mk\n-include common.mk\n</code></pre></p> <p>\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0cmake \u5de5\u5177\u4f1a\u9996\u5148\u5c1d\u8bd5\u5305\u542b <code>config.mk</code> \u6587\u4ef6\uff0c\u7136\u540e\u662f <code>common.mk</code> \u6587\u4ef6\u3002\u5982\u679c\u8fd9\u4e9b\u6587\u4ef6\u5b58\u5728\uff0c\u5b83\u4eec\u7684\u5185\u5bb9\u4f1a\u88ab\u5408\u5e76\u5230\u5f53\u524d Makefile \u4e2d\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u867d\u7136 <code>-include</code> \u548c <code>#include</code> \u5728\u540d\u79f0\u4e0a\u76f8\u4f3c\uff0c\u4f46\u5b83\u4eec\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u573a\u666f\u662f\u4e0d\u540c\u7684\u3002<code>#include</code> \u662f C/C++ \u9884\u5904\u7406\u5668\u7684\u6307\u4ee4\uff0c\u7528\u4e8e\u5728\u7f16\u8bd1\u524d\u5305\u542b\u5934\u6587\u4ef6\uff1b\u800c <code>-include</code> \u662f Makefile \u7684\u6307\u4ee4\uff0c\u7528\u4e8e\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u5305\u542b\u5176\u4ed6 Makefile \u6587\u4ef6\u3002</p> <p>\u66f4\u591a\u4ecb\u7ecd\u53c2\u8003 GNU make \u624b\u518c:</p> <p></p> <p>\u4e4b\u540e\u4fbf\u662f\uff1a</p> <pre><code>  1 include $(AM_HOME)/scripts/isa/riscv.mk                                                                                     \n  2 include $(AM_HOME)/scripts/platform/nemu.mk\n  3 CFLAGS  += -DISA_H=\\\"riscv/riscv.h\\\"\n  4 COMMON_CFLAGS += -march=rv32im_zicsr -mabi=ilp32   # overwrite\n  5 LDFLAGS       += -melf32lriscv                     # overwrite\n  6 \n  7 AM_SRCS += riscv/nemu/start.S \\\n  8            riscv/nemu/cte.c \\\n  9            riscv/nemu/trap.S \\\n 10            riscv/nemu/vme.c\n\n // abstract-machine/scripts/riscv32-nemu.mk\n</code></pre> <p>\u5bf9\u4e8e\u67b6\u6784\u76f8\u5173\u7684\u914d\u7f6e\u548c\u5e73\u53f0\u76f8\u5173\u7684\u914d\u7f6e\uff0c\u8fd9\u91cc\u5173\u6ce8\u6574\u4e2a\u6d41\u7a0b\u7684\u8bdd\u5c31\u770b <code>abstract-machine/scripts/platform/nemu.mk</code></p> <pre><code>AM_SRCS := platform/nemu/trm.c \\\n           platform/nemu/ioe/ioe.c \\\n           platform/nemu/ioe/timer.c \\\n           platform/nemu/ioe/input.c \\\n           platform/nemu/ioe/gpu.c \\\n           platform/nemu/ioe/audio.c \\\n           platform/nemu/ioe/disk.c \\\n           platform/nemu/mpe.c\n\nCFLAGS    += -fdata-sections -ffunction-sections\nLDFLAGS   += -T $(AM_HOME)/scripts/linker.ld \\\n             --defsym=_pmem_start=0x80000000 --defsym=_entry_offset=0x0\nLDFLAGS   += --gc-sections -e _start\nNEMUFLAGS += -l $(shell dirname $(IMAGE).elf)/nemu-log.txt\nNEMUFLAGS += -b\nNEMUFLAGS += -e $(IMAGE).elf\n\nCFLAGS += -DMAINARGS=\\\"$(mainargs)\\\"\nCFLAGS += -I$(AM_HOME)/am/src/platform/nemu/include\n.PHONY: $(AM_HOME)/am/src/platform/nemu/trm.c\n\nimage: $(IMAGE).elf\n    @$(OBJDUMP) -d $(IMAGE).elf &gt; $(IMAGE).txt\n    @echo + OBJCOPY \"-&gt;\" $(IMAGE_REL).bin\n    @$(OBJCOPY) -S --set-section-flags .bss=alloc,contents -O binary $(IMAGE).elf $(IMAGE).bin\n\nrun: image\n    $(MAKE) -C $(NEMU_HOME) ISA=$(ISA) run ARGS=\"$(NEMUFLAGS)\" IMG=$(IMAGE).bin\n\ngdb: image\n    $(MAKE) -C $(NEMU_HOME) ISA=$(ISA) gdb ARGS=\"$(NEMUFLAGS)\" IMG=$(IMAGE).bin\n</code></pre> <p>\u6700\u4e0a\u9762 <code>AM_SRCS</code> \u7684\u5c31\u662f\u8981\u6784\u5efa\u7684 AM \u7a0b\u5e8f\u7684\u6e90\u6587\u4ef6\uff08\u4e00\u90e8\u5206\uff09\u3002</p> <p>\u4e0b\u9762\u5c31\u662f\u5177\u4f53 AM \u600e\u4e48\u548c NEMU \u76f8\u4e92\u914d\u5408\u6784\u5efa\u3002\u914d\u5408 GPT \u89e3\u91ca\uff0c\u5982\u679c\u8f83\u597d\u5730\u5b8c\u6210\u4e86 PA\uff0c\u5e94\u8be5\u90fd\u662f\u914d\u5408\u4e00\u4e9b\u6587\u6863\u8d44\u6599\u90fd\u80fd\u6bd4\u8f83\u719f\u6089\u4e0b\u9762\u7684\u5185\u5bb9\u3002</p> <ul> <li> <p>CFLAGS</p> <ul> <li><code>-fdata-sections</code> \u548c <code>-ffunction-sections</code>\uff1a<ul> <li>\u8fd9\u4e24\u4e2a\u6807\u5fd7\u544a\u8bc9\u7f16\u8bd1\u5668\u5c06\u6bcf\u4e2a\u51fd\u6570\u548c\u6570\u636e\u5206\u522b\u653e\u5165\u4e0d\u540c\u7684\u6bb5\uff08section\uff09\u4e2d\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u94fe\u63a5\u5668\u53ef\u4ee5\u901a\u8fc7 <code>--gc-sections</code> \u6807\u5fd7\u6765\u5220\u9664\u672a\u5f15\u7528\u7684\u6bb5\uff0c\u4ece\u800c\u51cf\u5c0f\u6700\u7ec8\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5927\u5c0f\u3002</li> </ul> </li> <li><code>-DMAINARGS=\\\"$(mainargs)\\\"</code>\uff1a<ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b8f <code>MAINARGS</code>\uff0c\u5e76\u5c06\u5176\u503c\u8bbe\u7f6e\u4e3a <code>$(mainargs)</code> \u53d8\u91cf\u7684\u503c\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u4f20\u9012\u547d\u4ee4\u884c\u53c2\u6570\u7ed9\u7a0b\u5e8f\u3002</li> </ul> </li> <li><code>-I$(AM_HOME)/am/src/platform/nemu/include</code>\uff1a<ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u6307\u5b9a\u4e86\u4e00\u4e2a\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u641c\u7d22\u5305\u542b\u7684\u5934\u6587\u4ef6\u3002</li> </ul> </li> </ul> </li> <li> <p>LDFLAGS</p> <ul> <li> <p><code>-T $(AM_HOME)/scripts/linker.ld</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u6307\u5b9a\u4e86\u94fe\u63a5\u811a\u672c\u7684\u8def\u5f84\u3002\u94fe\u63a5\u811a\u672c\uff08<code>linker.ld</code>\uff09\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u7684\u5185\u5b58\u5e03\u5c40\uff0c\u5305\u62ec\u5404\u4e2a\u6bb5\uff08\u5982\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u3001BSS\u6bb5\u7b49\uff09\u5728\u5185\u5b58\u4e2d\u7684\u653e\u7f6e\u4f4d\u7f6e\u3002</li> </ul> </li> <li> <p><code>--defsym=_pmem_start=0x80000000</code> \u548c <code>--defsym=_entry_offset=0x0</code>\uff1a</p> <ul> <li>\u8fd9\u4e24\u4e2a\u6807\u5fd7\u5b9a\u4e49\u4e86\u4e24\u4e2a\u7b26\u53f7\u7684\u503c\u3002<code>--defsym</code> \u7528\u4e8e\u5728\u94fe\u63a5\u65f6\u5b9a\u4e49\u4e00\u4e2a\u7b26\u53f7\u7684\u503c\u3002</li> <li><code>_pmem_start</code> \u88ab\u5b9a\u4e49\u4e3a <code>0x80000000</code>\uff0c\u8fd9\u901a\u5e38\u8868\u793a\u7a0b\u5e8f\u7684\u7269\u7406\u5185\u5b58\u5f00\u59cb\u5730\u5740\u3002\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u53ef\u80fd\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684\u5185\u5b58\u533a\u57df\u7684\u8d77\u59cb\u5730\u5740\u3002</li> <li><code>_entry_offset</code> \u88ab\u5b9a\u4e49\u4e3a <code>0x0</code>\uff0c\u8fd9\u8868\u793a\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff08\u901a\u5e38\u662f <code>_start</code> \u7b26\u53f7\uff09\u76f8\u5bf9\u4e8e\u67d0\u4e2a\u57fa\u5730\u5740\u7684\u504f\u79fb\u91cf\u3002\u5728\u8fd9\u91cc\uff0c<code>_entry_offset</code> \u88ab\u8bbe\u7f6e\u4e3a <code>0x0</code>\uff0c\u610f\u5473\u7740\u5165\u53e3\u70b9\u5c31\u662f\u57fa\u5730\u5740\u672c\u8eab\u3002</li> </ul> <p>\u8fd9\u91cc\u770b\u8d77\u6765\u6709\u4e24\u4e2a <code>--defsym</code> \u6807\u5fd7\uff0c\u4f46\u5b9e\u9645\u4e0a\u5b83\u4eec\u5b9a\u4e49\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684\u7b26\u53f7\u3002\u8fd9\u5e76\u4e0d\u662f\u9519\u8bef\uff0c\u800c\u662f\u4e24\u4e2a\u72ec\u7acb\u7684\u6307\u4ee4\uff0c\u6bcf\u4e2a\u6307\u4ee4\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e0d\u540c\u7684\u7b26\u53f7\u3002</p> </li> <li> <p><code>--gc-sections</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u544a\u8bc9\u94fe\u63a5\u5668\u5728\u751f\u6210\u6700\u7ec8\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u65f6\uff0c\u5220\u9664\u672a\u5f15\u7528\u7684\u6bb5\u3002\u8fd9\u6709\u52a9\u4e8e\u51cf\u5c0f\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u7279\u522b\u662f\u5728\u4f7f\u7528 <code>-fdata-sections</code> \u548c <code>-ffunction-sections</code> \u65f6\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6807\u5fd7\u4f1a\u751f\u6210\u8bb8\u591a\u5c0f\u7684\u6bb5\u3002</li> </ul> </li> <li> <p><code>-e _start</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u6307\u5b9a\u4e86\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002<code>_start</code> \u662f\u4e00\u4e2a\u7b26\u53f7\uff0c\u901a\u5e38\u5728\u542f\u52a8\u6587\u4ef6\uff08\u5982 <code>crt0.S</code> \u6216\u7c7b\u4f3c\u7684\u6587\u4ef6\uff09\u4e2d\u5b9a\u4e49\uff0c\u8868\u793a\u7a0b\u5e8f\u7684\u8d77\u59cb\u6267\u884c\u70b9\u3002</li> </ul> </li> </ul> </li> <li> <p>NEMUFLAGS</p> <ul> <li> <p><code>-l $(shell dirname $(IMAGE).elf)/nemu-log.txt</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u6307\u5b9a\u4e86 NEMU \u6a21\u62df\u5668\u7684\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\u3002<code>$(shell dirname $(IMAGE).elf)</code> \u4f1a\u5c55\u5f00\u4e3a <code>$(IMAGE).elf</code> \u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u8def\u5f84\u3002</li> </ul> </li> <li> <p><code>-b</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u53ef\u80fd\u662f NEMU \u6a21\u62df\u5668\u7684\u4e00\u4e2a\u9009\u9879\uff0c\u7528\u4e8e\u6307\u5b9a\u4e8c\u8fdb\u5236\u6a21\u5f0f\u6216\u5176\u4ed6\u7279\u5b9a\u7684\u884c\u4e3a\u3002</li> </ul> </li> <li> <p><code>-e $(IMAGE).elf</code>\uff1a</p> <ul> <li>\u8fd9\u4e2a\u6807\u5fd7\u6307\u5b9a\u4e86\u8981\u6267\u884c\u7684 ELF \u6587\u4ef6\u7684\u8def\u5f84\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u91cc\uff0c\u4e5f\u80fd\u7406\u89e3\u4e00\u90e8\u5206\u4e86\u5206\u5c42\u7684\u6784\u5efa\u6d41\u7a0b\u4e86\uff0cAM \u7a0b\u5e8f\u7f16\u8bd1\u597d\u751f\u6210 <code>$(IMAGE).elf</code> \u540e\uff0c\u5c06\u8fd9\u4e2a\u6587\u4ef6\u4f20\u7ed9 NEMU \u7a0b\u5e8f\u3002\uff08\u56de\u60f3\u81ea\u5df1\u505a ftrace \u7684\u65f6\u5019\u770b\u770b\uff09\u3002</p> </li> </ul> </li> </ul> <p>\u8fd9\u91cc\u7684\u90a3\u4e2a\u4f2a\u76ee\u6807\u6709\u70b9\u4e0d\u77e5\u9053\u600e\u4e48\u7406\u89e3\uff1a</p> <pre><code>.PHONY: $(AM_HOME)/am/src/platform/nemu/trm.c\n</code></pre> <p>\u8fd9\u4e2a\u6307\u4ee4\u544a\u8bc9 make\uff0c<code>$(AM_HOME)/am/src/platform/nemu/trm.c</code> \u4e0d\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u800c\u662f\u4e00\u4e2a\u4f2a\u76ee\u6807\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u9632\u6b62 make \u9519\u8bef\u5730\u8ba4\u4e3a\u8fd9\u4e2a\u76ee\u6807\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u5c1d\u8bd5\u627e\u5230\u5b83\u3002\u8fd9\u5728\u5305\u542b\u591a\u4e2a\u6e90\u6587\u4ef6\u548c\u76ee\u5f55\u7684 Makefile \u4e2d\u5f88\u5e38\u89c1\uff0c\u4ee5\u786e\u4fdd\u6240\u6709\u76ee\u6807\u90fd\u88ab\u6b63\u786e\u5730\u89c6\u4e3a\u9700\u8981\u6784\u5efa\u7684\u76ee\u6807\u3002</p> <p></p> <p>\u603b\u7ed3\uff0c\u4f7f\u7528\u4f2a\u76ee\u6807\u53ef\u4ee5\u786e\u4fdd <code>make</code> \u5de5\u5177\u6309\u7167\u6211\u7684\u610f\u56fe\u6267\u884c\u6784\u5efa\u8fc7\u7a0b\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u5730\u4f9d\u8d56\u4e8e\u6587\u4ef6\u7684\u5b58\u5728\u4e0e\u5426\u3002</p> <p>\u5269\u4e0b\u7684\u5c31\u662f\u6784\u5efa\u76f8\u5173\u7684\u76ee\u6807\u4e86\uff0c\u5e94\u8be5\u90fd\u662f\u633a\u597d\u7406\u89e3\u7684\u3002</p> <p>\u53e6\u5916\u8865\u5145\uff1aam\u3001klib \u4e2d\u7684\u5185\u5bb9\u662f\u600e\u4e48\u6784\u5efa\u7684\uff1f</p> <pre><code>60 LIBS     := $(sort $(LIBS) am klib) # lazy evaluation (\"=\") causes infinite recursions\n\n126 \n127 ### Rule (recursive make): build a dependent library (am, klib, ...)\n128 $(LIBS): %:\n129     @$(MAKE) -s -C $(AM_HOME)/$* archive\n\n//abstract-machine/Makefile\n</code></pre> <p></p>"},{"location":"ysyx/pa/summary/summary.html#os","title":"OS","text":"<p>\u4e4b\u540e\u518d\u5230 OS \u600e\u4e48\u8fde\u63a5\u5230 am \u7684\uff0c\u731c\u6d4b\u5e94\u8be5\u4e5f\u662f <code>$(IMAGE).elf</code> \uff0c\u8fd8\u662f\u770b <code>Makefile</code></p> <pre><code>HAS_NAVY = 1\nRAMDISK_FILE = build/ramdisk.img\n\nNAME = nanos-lite\nSRCS = $(shell find -L ./src/ -name \"*.c\" -o -name \"*.cpp\" -o -name \"*.S\")\ninclude $(AM_HOME)/Makefile\n\nifeq ($(ARCH),native)\nISA = am_native\nelse\nINC_PATH += include $(NAVY_HOME)/libs/libc/include\nendif\n\n./src/resources.S: $(RAMDISK_FILE)\n    @touch $@\n\nifeq ($(HAS_NAVY),)\nfiles = $(RAMDISK_FILE) src/files.h src/syscall.h\n# create an empty file if it does not exist\n$(foreach f,$(files),$(if $(wildcard $f),, $(shell touch $f)))\nelse\n\nifeq ($(wildcard $(NAVY_HOME)/libs/libos/src/syscall.h),)\n  $(error $$NAVY_HOME must be a Navy-apps repo)\nendif\n\nupdate:\n    $(MAKE) -s -C $(NAVY_HOME) ISA=$(ISA) ramdisk\n    @ln -sf $(NAVY_HOME)/build/ramdisk.img $(RAMDISK_FILE)\n    @ln -sf $(NAVY_HOME)/build/ramdisk.h src/files.h\n    @ln -sf $(NAVY_HOME)/libs/libos/src/syscall.h src/syscall.h\n\n.PHONY: update\nendif\n</code></pre> <p>\u4e0a\u9762\u7684\u5185\u5bb9\u4e0d\u96be\uff0c\u6211\u81ea\u5df1\u9700\u8981\u6ce8\u610f\u7684\u662f\u83b7\u53d6\u5f53\u524d <code>./src/</code> \u76ee\u5f55\u4e0b\u6587\u4ef6\u7684\u65b9\u5f0f\u3002\u6211\u5df2\u7ecf\u770b\u5230\u5f88\u591a\u79cd\u83b7\u53d6\u8981\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u8fd9\u91cc\u505a\u4e2a\u7b80\u5355\u7684\u603b\u7ed3\u3002</p> <pre><code>SRCS = $(shell find -L ./src/ -name \"*.c\" -o -name \"*.cpp\" -o -name \"*.S\")\n\nAM_SRCS := platform/nemu/trm.c \\\n           platform/nemu/ioe/ioe.c \\\n           platform/nemu/ioe/timer.c \\\n           platform/nemu/ioe/input.c \\\n           platform/nemu/ioe/gpu.c \\\n           platform/nemu/ioe/audio.c \\\n           platform/nemu/ioe/disk.c \\\n           platform/nemu/mpe.c \n\n# -------- \u53d8\u91cf --------\nSOURCES=$(wildcard $(SRC_DIR)/**/*.c $(SRC_DIR)/*.c)\n# \u4fee\u6539OBJECTS\u53d8\u91cf\uff0c\u5c06\u751f\u6210\u7684.o\u6587\u4ef6\u653e\u5230src/lcthw/build\u76ee\u5f55\u4e2d\nOBJECTS=$(patsubst %.c,%.o,$(SOURCES))\n\nTEST_SRC=$(wildcard $(TEST_DIR)/*_tests.c)\nTESTS=$(patsubst %.c,%,$(TEST_SRC))\n</code></pre> <p>\u65b9\u6cd5 1: \u4f7f\u7528 <code>shell</code> \u547d\u4ee4 <pre><code>SRCS = $(shell find -L ./src/ -name \"*.c\" -o -name \"*.cpp\" -o -name \"*.S\")\n</code></pre> - \u4f18\u70b9\uff1a   - \u80fd\u591f\u9012\u5f52\u5730\u67e5\u627e\u6240\u6709\u5339\u914d\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u5b50\u76ee\u5f55\u3002   - \u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 <code>find</code> \u547d\u4ee4\u7684\u53c2\u6570\u6765\u5339\u914d\u591a\u79cd\u7c7b\u578b\u7684\u6587\u4ef6\u3002 - \u7f3a\u70b9\uff1a   - \u6bcf\u6b21 <code>make</code> \u8fd0\u884c\u65f6\u90fd\u4f1a\u6267\u884c <code>find</code> \u547d\u4ee4\uff0c\u8fd9\u53ef\u80fd\u4f1a\u589e\u52a0\u6784\u5efa\u65f6\u95f4\uff0c\u5c24\u5176\u662f\u5728\u6709\u5927\u91cf\u6587\u4ef6\u6216\u6df1\u5c42\u76ee\u5f55\u7ed3\u6784\u65f6\u3002   - <code>find</code> \u547d\u4ee4\u53ef\u80fd\u4f1a\u53d7\u5230\u5f53\u524d shell \u73af\u5883\u7684\u5f71\u54cd\uff0c\u6bd4\u5982\u8def\u5f84\u522b\u540d\u7b49\u3002 </p> <p>\u65b9\u6cd5 2: \u4f7f\u7528 <code>wildcard</code> \u51fd\u6570 \u6216\u8005\u7ed3\u5408 <code>wildcard</code> \u548c <code>patsubst</code> <pre><code>SOURCES=$(wildcard $(SRC_DIR)/**/*.c $(SRC_DIR)/*.c)\n</code></pre> <pre><code>SOURCES=$(wildcard $(SRC_DIR)/**/*.c $(SRC_DIR)/*.c)\nOBJECTS=$(patsubst %.c,%.o,$(SOURCES))\n</code></pre></p> <ul> <li> <p>\u4f18\u70b9\uff1a</p> </li> <li> <p><code>wildcard</code> \u51fd\u6570\u53ef\u4ee5\u5339\u914d\u5f53\u524d\u76ee\u5f55\u548c\u5b50\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002</p> </li> <li><code>patsubst</code> \u51fd\u6570\u53ef\u4ee5\u65b9\u4fbf\u5730\u5c06\u6e90\u6587\u4ef6\u540d\u8f6c\u6362\u4e3a\u76ee\u6807\u6587\u4ef6\u540d\u3002</li> <li> <p>\u8bed\u6cd5\u7b80\u5355\uff0c\u6613\u4e8e\u7406\u89e3\u548c\u4f7f\u7528\u3002</p> </li> <li> <p>\u7f3a\u70b9\uff1a</p> </li> <li> <p>\u4e0d\u80fd\u76f4\u63a5\u9012\u5f52\u5730\u5339\u914d\u6240\u6709\u5b50\u76ee\u5f55\uff0c\u9700\u8981\u624b\u52a8\u4e3a\u6bcf\u4e2a\u5b50\u76ee\u5f55\u6dfb\u52a0\u6a21\u5f0f\u5339\u914d\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6df1\u5c42\u76ee\u5f55\u7ed3\u6784\uff0c\u9700\u8981\u4e3a\u6bcf\u4e2a\u76ee\u5f55\u5355\u72ec\u6dfb\u52a0\u6a21\u5f0f\u5339\u914d\uff0c\u8fd9\u53ef\u80fd\u4f1a\u53d8\u5f97\u7e41\u7410\u3002</p> <p>\u6709\u4e00\u6b21\u79fb\u690d <code>FreeRTOS</code> \u7684\u65f6\u5019\u5c31\u9047\u5230\u8fd9\u90e8\u5206\u7684\u95ee\u9898\uff0c\u7f16\u8bd1\u7684\u65f6\u5019\u4e00\u76f4\u5bf9\u4e8e <code>FreeRTOS</code> \u5185\u90e8\u7684\u4e1c\u897f\u7b26\u53f7\u672a\u5b9a\u4e49\u3002 </p> </li> </ul> <p>\u65b9\u6cd5 3: \u624b\u52a8\u6dfb\u52a0</p> <pre><code>AM_SRCS := platform/nemu/trm.c \\\n           platform/nemu/ioe/ioe.c \\\n           platform/nemu/ioe/timer.c \\\n           platform/nemu/ioe/input.c \\\n           platform/nemu/ioe/gpu.c \\\n           platform/nemu/ioe/audio.c \\\n           platform/nemu/ioe/disk.c \\\n           platform/nemu/mpe.c \n</code></pre> <p>\u8fd9\u79cd\u5c31\u9002\u7528\u6587\u4ef6\u4e0d\u591a\u7684\u65f6\u5019\u5427\u3002</p> <p>\u54ea\u79cd\u65b9\u6cd5\u6bd4\u8f83\u597d\uff1f \u9009\u62e9\u54ea\u79cd\u65b9\u6cd5\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u9879\u76ee\u9700\u6c42\u548c\u4e2a\u4eba\u504f\u597d\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u8003\u8651\u56e0\u7d20\uff1a</p> <ul> <li>\u6027\u80fd\uff1a\u5982\u679c\u9879\u76ee\u6587\u4ef6\u6570\u91cf\u975e\u5e38\u591a\uff0c\u6216\u8005\u76ee\u5f55\u7ed3\u6784\u975e\u5e38\u6df1\uff0c\u4f7f\u7528 <code>shell</code> \u547d\u4ee4\u53ef\u80fd\u4f1a\u66f4\u9ad8\u6548\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u9012\u5f52\u5730\u67e5\u627e\u6240\u6709\u6587\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u4e3a\u6bcf\u4e2a\u5b50\u76ee\u5f55\u5355\u72ec\u6dfb\u52a0\u6a21\u5f0f\u5339\u914d\u3002</li> <li>\u53ef\u8bfb\u6027\uff1a<code>wildcard</code> \u548c <code>patsubst</code> \u7684\u7ec4\u5408\u901a\u5e38\u66f4\u6613\u4e8e\u7406\u89e3\u548c\u7ef4\u62a4\uff0c\u7279\u522b\u662f\u5bf9\u4e8e Makefile \u7684\u65b0\u624b\u6765\u8bf4\u3002</li> <li>\u7075\u6d3b\u6027\uff1a<code>shell</code> \u547d\u4ee4\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u7075\u6d3b\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 <code>find</code> \u547d\u4ee4\u7684\u53c2\u6570\u6765\u5339\u914d\u4e0d\u540c\u7684\u6587\u4ef6\u6a21\u5f0f\u6216\u6267\u884c\u66f4\u590d\u6742\u7684\u6587\u4ef6\u67e5\u627e\u903b\u8f91\u3002</li> <li>\u73af\u5883\u4f9d\u8d56\uff1a<code>shell</code> \u547d\u4ee4\u53ef\u80fd\u4f1a\u53d7\u5230\u5f53\u524d shell \u73af\u5883\u7684\u5f71\u54cd\uff0c\u800c <code>wildcard</code> \u548c <code>patsubst</code> \u51fd\u6570\u5219\u66f4\u52a0\u7a33\u5b9a\u548c\u53ef\u9760\u3002</li> </ul> <p>\u5982\u679c\u9879\u76ee\u6587\u4ef6\u6570\u91cf\u4e0d\u591a\uff0c\u76ee\u5f55\u7ed3\u6784\u4e5f\u4e0d\u590d\u6742\uff0c\u4f7f\u7528 <code>wildcard</code> \u548c <code>patsubst</code> \u7684\u7ec4\u5408\u53ef\u80fd\u662f\u4e00\u4e2a\u7b80\u5355\u4e14\u6613\u4e8e\u7ef4\u62a4\u7684\u9009\u62e9\u3002</p> <p>\u5982\u679c\u8981\u5904\u7406\u5927\u91cf\u7684\u6587\u4ef6\u6216\u6df1\u5c42\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4f7f\u7528 <code>shell</code> \u547d\u4ee4\u53ef\u80fd\u4f1a\u66f4\u5408\u9002\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u9012\u5f52\u5730\u67e5\u627e\u6240\u6709\u6587\u4ef6\uff0c\u51cf\u5c11\u624b\u52a8\u6dfb\u52a0\u6a21\u5f0f\u5339\u914d\u7684\u5de5\u4f5c\u91cf\u3002</p> <p>\u53e6\u5916\uff0c\u8fd9\u91cc\u4f7f\u7528\u4f46\u662f <code>include $(AM_HOME)/Makefile</code>\uff1a</p> <p>\u5728 Makefile \u4e2d\uff0c<code>include</code> \u6307\u4ee4\u7528\u4e8e\u5305\u542b\u53e6\u4e00\u4e2a Makefile \u6587\u4ef6\uff0c\u5c06\u5176\u5185\u5bb9\u5408\u5e76\u5230\u5f53\u524d Makefile \u4e2d\u3002<code>include</code> \u6307\u4ee4\u7684\u884c\u4e3a\u53d6\u51b3\u4e8e\u5b83\u524d\u9762\u662f\u5426\u6709 <code>-</code>\u3002 </p> <p>\u65e0 <code>-</code> \u7684 <code>include</code>\uff1a <pre><code>include $(AM_HOME)/Makefile\n</code></pre> - \u5f53\u4f7f\u7528\u6ca1\u6709 <code>-</code> \u7684 <code>include</code> \u6307\u4ee4\u65f6\uff0c\u5982\u679c\u6307\u5b9a\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c<code>make</code> \u5c06\u4f1a\u62a5\u9519\u5e76\u505c\u6b62\u6267\u884c\u3002\u8fd9\u610f\u5473\u7740\uff0c<code>include</code> \u6307\u4ee4\u662f\u5f3a\u5236\u6027\u7684\uff0c\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684\u6587\u4ef6\u3002 </p> <p>\u6709 <code>-</code> \u7684 <code>include</code>\uff1a <pre><code>-include $(AM_HOME)/Makefile\n</code></pre> - \u5f53\u4f7f\u7528\u6709 <code>-</code> \u7684 <code>include</code> \u6307\u4ee4\u65f6\uff0c\u5982\u679c\u6307\u5b9a\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c<code>make</code> \u4f1a\u5ffd\u7565\u8fd9\u4e2a\u6307\u4ee4\uff0c\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u6307\u4ee4\uff0c\u4e0d\u4f1a\u62a5\u9519\u3002<code>-</code> \u4f7f\u5f97 <code>include</code> \u6307\u4ee4\u53d8\u5f97\u201c\u53ef\u9009\u201d\uff0c\u5373\u4f7f\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd make \u7684\u6267\u884c\u3002</p> <p>\u5728\u4f60\u63d0\u4f9b\u7684\u4ee3\u7801 <code>include $(AM_HOME)/Makefile</code> \u4e2d\uff0c\u6ca1\u6709\u4f7f\u7528 <code>-</code>\uff0c\u8fd9\u901a\u5e38\u610f\u5473\u7740\u8fd9\u4e2a\u5305\u542b\u662f\u5fc5\u987b\u7684\u3002\u5982\u679c <code>$(AM_HOME)/Makefile</code> \u6587\u4ef6\u4e0d\u5b58\u5728\uff0c<code>make</code> \u5c06\u4f1a\u62a5\u9519\u5e76\u505c\u6b62\u6784\u5efa\u8fc7\u7a0b\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u786e\u4fdd\u4e00\u4e9b\u5173\u952e\u7684\u6784\u5efa\u89c4\u5219\u6216\u53d8\u91cf\u5b9a\u4e49\u88ab\u5305\u542b\u8fdb\u6765\u3002</p> <p>\u9009\u62e9\u662f\u5426\u4f7f\u7528 <code>-</code> \u53d6\u51b3\u4e8e\u4f60\u7684\u6784\u5efa\u903b\u8f91\u548c\u9700\u6c42\uff1a - \u5982\u679c\u4f60\u5e0c\u671b\u786e\u4fdd\u67d0\u4e9b Makefile \u7247\u6bb5\u88ab\u5305\u542b\uff0c\u65e0\u8bba\u5b83\u4eec\u662f\u5426\u5b58\u5728\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>-include</code>\u3002 - \u5982\u679c\u4f60\u5e0c\u671b\u786e\u4fdd\u5fc5\u987b\u5305\u542b\u67d0\u4e9b Makefile \u7247\u6bb5\uff0c\u5426\u5219\u6784\u5efa\u5931\u8d25\uff0c\u90a3\u4e48\u4f7f\u7528 <code>include</code>\u3002</p> <p>\u5728\u4f60\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u6ca1\u6709\u4f7f\u7528 <code>-</code> \u53ef\u80fd\u662f\u56e0\u4e3a <code>$(AM_HOME)/Makefile</code> \u662f\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684\u5173\u952e\u6587\u4ef6\uff0c\u9700\u8981\u786e\u4fdd\u5176\u5b58\u5728\u3002</p> <p>\u518d\u56de\u5230\u6574\u4e2a\u6784\u5efa\u6d41\u7a0b\uff0c\u83b7\u53d6\u4e86 SRCS \u53d8\u91cf\u540e\uff0c\u786e\u5b9e\u53c8\u662f\u8981\u7528\u5230\uff1a<code>include $(AM_HOME)/Makefile</code></p> <pre><code>### Collect the files to be linked: object files (`.o`) and libraries (`.a`)\nOBJS      = $(addprefix $(DST_DIR)/, $(addsuffix .o, $(basename $(SRCS))))\nLIBS     := $(sort $(LIBS) am klib) # lazy evaluation (\"=\") causes infinite recursions\nLINKAGE   = $(OBJS) \\\n  $(addsuffix -$(ARCH).a, $(join \\\n    $(addsuffix /build/, $(addprefix $(AM_HOME)/, $(LIBS))), \\\n    $(LIBS) ))\n</code></pre> <pre><code>  1 NAME     := am                                                                                                              \n  2 SRCS      = $(addprefix src/, $(AM_SRCS))\n  3 INC_PATH += $(AM_HOME)/am/src\n  4 \n  5 include $(AM_HOME)/Makefile\n\n// \u4ee5\u8fd9\u4e2a\u7684SRCS abstract-machine/am/Makefile \u4e3a\u4f8b\n</code></pre> <p>\u518d\u914d\u5408\u524d\u9762\u7684 <code>nemu.mk</code> \u4e2d\u7684 <code>AM_SRCS</code></p> <pre><code> 1 include $(AM_HOME)/scripts/isa/riscv.mk\n  2 include $(AM_HOME)/scripts/platform/nemu.mk\n  3 CFLAGS  += -DISA_H=\\\"riscv/riscv.h\\\"\n  4 COMMON_CFLAGS += -march=rv32im_zicsr -mabi=ilp32   # overwrite\n  5 LDFLAGS       += -melf32lriscv                     # overwrite\n  6 \n  7 AM_SRCS += riscv/nemu/start.S \\\n  8            riscv/nemu/cte.c \\\n  9            riscv/nemu/trap.S \\\n 10            riscv/nemu/vme.c   \n\n// abstract-machine/scripts/platform/nemu.mk\n</code></pre>"},{"location":"ysyx/pa/summary/summary.html#basic-summary","title":"Basic Summary","text":""},{"location":"ysyx/pa/summary/summary.html#os_1","title":"OS","text":"<p>\u5230\u8fd9\u91cc\uff0c\u53ef\u4ee5\u76f4\u63a5 <code>make -nB</code> \u770b\u770b\u524d\u9762\u7684 NEMU AM OS \u7684 make \u8fc7\u7a0b\uff1a</p> <pre><code># Building nanos-lite-run [riscv32-nemu]\ntouch src/resources.S\nriscv64-linux-gnu-gcc -MMD -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -fno-pic -march=rv64g -mcmodel=medany -mstrict-align -march=rv32im_zicsr -mabi=ilp32    -O0 -c -o ./build/riscv32-nemu/./src/resources.o ./src/resources.S\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/device.o ./src/device.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/syscall.o ./src/syscall.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/proc.o ./src/proc.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/mm.o ./src/mm.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/main.o ./src/main.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/irq.o ./src/irq.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/fs.o ./src/fs.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/loader.o ./src/loader.c\nriscv64-linux-gnu-gcc -I./include -IAM/am/include/ -IAM/klib/include/ -Iinclude -I/home/jai/ysyx-workbench/navy-apps/libs/libc/include -c -o ./build/riscv32-nemu/./src/ramdisk.o ./src/ramdisk.c\n</code></pre> <p>\u8fd9\u90e8\u5206\u83b7\u53d6\u7684\u662f OS \u7684\u4ee3\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u81ea\u5df1\u518d\u914d\u5408 Makefile \u57fa\u672c\u5c31\u80fd\u61c2\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#amam-kilb","title":"AM\uff08am + kilb\uff09","text":"<pre><code>make -s -C /home/jai/ysyx-workbench/abstract-machine/am archive\n\n# Building am-archive [riscv32-nemu]\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/trm.o AM/am/src/platform/nemu/trm.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/ioe.o AM/am/src/platform/nemu/ioe/ioe.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/timer.o AM/am/src/platform/nemu/ioe/timer.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/input.o AM/am/src/platform/nemu/ioe/input.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/gpu.o AM/am/src/platform/nemu/ioe/gpu.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/audio.o AM/am/src/platform/nemu/ioe/audio.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/ioe/disk.o AM/am/src/platform/nemu/ioe/disk.c\nriscv64-linux-gnu-gcc  -c -o AM/am/build/riscv32-nemu/src/platform/nemu/mpe.o AM/am/src/platform/nemu/mpe.c\nriscv64-linux-gnu-gcc -c -o AM/am/build/riscv32-nemu/src/riscv/nemu/start.o AM/am/src/riscv/nemu/start.S\nriscv64-linux-gnu-gcc -c -o AM/am/build/riscv32-nemu/src/riscv/nemu/cte.o AM/am/src/riscv/nemu/cte.c\nriscv64-linux-gnu-gcc -O0 -c -o AM/am/build/riscv32-nemu/src/riscv/nemu/trap.o AM/am/src/riscv/nemu/trap.S\nriscv64-linux-gnu-gcc -c -o AM/am/build/riscv32-nemu/src/riscv/nemu/vme.o AM/am/src/riscv/nemu/vme.c\n\nriscv64-linux-gnu-ar rcs AM/am/build/am-riscv32-nemu.a \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/trm.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/ioe.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/timer.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/input.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/gpu.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/audio.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/ioe/disk.o \\\n    AM/am/build/riscv32-nemu/src/platform/nemu/mpe.o \\\n    AM/am/build/riscv32-nemu/src/riscv/nemu/start.o \\\n    AM/am/build/riscv32-nemu/src/riscv/nemu/cte.o \\\n    AM/am/build/riscv32-nemu/src/riscv/nemu/trap.o \\\n    AM/am/build/riscv32-nemu/src/riscv/nemu/vme.o\n</code></pre> <pre><code># Building klib-archive [riscv32-nemu]\nriscv64-linux-gnu-gcc -c -o AM/klib/build/riscv32-nemu/src/int64.o AM/klib/src/int64.c\nriscv64-linux-gnu-gcc -c -o AM/klib/build/riscv32-nemu/src/stdlib.o AM/klib/src/stdlib.c\nriscv64-linux-gnu-gcc -c -o AM/klib/build/riscv32-nemu/src/cpp.o AM/klib/src/cpp.c\nriscv64-linux-gnu-gcc -c -o AM/klib/build/riscv32-nemu/src/string.o AM/klib/src/string.c\nriscv64-linux-gnu-gcc -c -o AM/klib/build/riscv32-nemu/src/stdio.o AM/klib/src/stdio.c\nriscv64-linux-gnu-ar rcs AM/klib/build/klib-riscv32-nemu.a \\\n    AM/klib/build/riscv32-nemu/src/int64.o \\\n    AM/klib/build/riscv32-nemu/src/stdlib.o \\\n    AM/klib/build/riscv32-nemu/src/cpp.o \\\n    AM/klib/build/riscv32-nemu/src/string.o \\\n    AM/klib/build/riscv32-nemu/src/stdio.o\n\nriscv64-linux-gnu-ld -z noexecstack -melf64lriscv \\\n    -T AM/scripts/linker.ld --defsym=_pmem_start=0x80000000 \\\n    --defsym=_entry_offset=0x0 --gc-sections -e _start -melf32lriscv \\\n    -o ./build/nanos-lite-riscv32-nemu.elf \\\n    --start-group resources.o device.o syscall.o proc.o mm.o main.o irq.o \\\n    fs.o loader.o ramdisk.o am-riscv32-nemu.a klib-riscv32-nemu.a --end-group\n</code></pre> <p>gcc \u5c06\u8fd9\u90e8\u5206\u7f16\u8bd1\u6210\u76ee\u6807\u6587\u4ef6\u540e\uff0c\u4f7f\u7528 ar \u5c06\u7a0b\u5e8f\u4f9d\u8d56\u5e93\u7f16\u8bd1\u6253\u5305\u6210\u5f52\u6863\u6587\u4ef6\u3002</p> <p>\u518d\u901a\u8fc7\u94fe\u63a5\u811a\u672c\u5bf9\u6574\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u8fdb\u884c\u5e03\u5c40\uff0c\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <pre><code>echo \\# Creating image [riscv32-nemu]\nriscv64-linux-gnu-objdump -d \n    nanos-lite-riscv32-nemu.elf &gt; \\\n    nanos-lite-riscv32-nemu.txt\necho + OBJCOPY \"-&gt;\" build/nanos-lite-riscv32-nemu.bin\nriscv64-linux-gnu-objcopy -S \n    --set-section-flags .bss=alloc,contents \\\n    -O binary nanos-lite-riscv32-nemu.elf nanos-lite-riscv32-nemu.bin\n</code></pre> <p><code>.elf</code> \u6587\u4ef6\uff08Executable and Linkable Format\uff09\u662f\u4e00\u79cd\u6807\u51c6\u6587\u4ef6\u683c\u5f0f\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u540e\u7684\u76ee\u6807\u4ee3\u7801\u3001\u53ef\u6267\u884c\u4ee3\u7801\u6216\u53ef\u91cd\u5b9a\u4f4d\u4ee3\u7801\u3002\u5b83\u5305\u542b\u4e86\u7a0b\u5e8f\u7684\u6587\u672c\uff08\u4ee3\u7801\uff09\u3001\u6570\u636e\u3001\u7b26\u53f7\u8868\u3001\u91cd\u5b9a\u4f4d\u4fe1\u606f\u7b49\uff0c\u662f\u94fe\u63a5\u5668\u7528\u4e8e\u751f\u6210\u6700\u7ec8\u53ef\u6267\u884c\u6587\u4ef6\u7684\u4e2d\u95f4\u4ea7\u7269\u3002</p> <p>\u800c <code>.bin</code> \u6587\u4ef6\uff08Binary File\uff09\u662f\u4e00\u79cd\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5b83\u76f4\u63a5\u5305\u542b\u4e86\u53ef\u4ee5\u5728\u786c\u4ef6\u4e0a\u8fd0\u884c\u7684\u673a\u5668\u4ee3\u7801\u3002<code>.bin</code> \u6587\u4ef6\u901a\u5e38\u4e0d\u5305\u542b\u4efb\u4f55\u989d\u5916\u7684\u5143\u6570\u636e\u6216\u91cd\u5b9a\u4f4d\u4fe1\u606f\uff0c\u5b83\u662f\u4e00\u4e2a\u7eaf\u51c0\u7684\u3001\u53ef\u76f4\u63a5\u88ab\u786c\u4ef6\u6267\u884c\u7684\u6587\u4ef6\u3002</p> <p>\u5728\u5d4c\u5165\u5f0f\u7cfb\u7edf\u6216\u88f8\u673a\u7f16\u7a0b\u4e2d\uff0c\u901a\u5e38\u9700\u8981\u5c06 <code>.elf</code> \u6587\u4ef6\u8f6c\u6362\u4e3a <code>.bin</code> \u6587\u4ef6\uff0c\u539f\u56e0\u5305\u62ec\uff1a</p> <ol> <li> <p>\u7b80\u5316\u6587\u4ef6\u5185\u5bb9\uff1a<code>.elf</code> \u6587\u4ef6\u5305\u542b\u4e86\u8bb8\u591a\u5bf9\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e0d\u5fc5\u8981\u7684\u4fe1\u606f\uff0c\u5982\u8c03\u8bd5\u4fe1\u606f\u3001\u7b26\u53f7\u8868\u7b49\u3002<code>.bin</code> \u6587\u4ef6\u53ea\u5305\u542b\u5b9e\u9645\u7684\u673a\u5668\u4ee3\u7801\u548c\u6570\u636e\uff0c\u6ca1\u6709\u8fd9\u4e9b\u989d\u5916\u4fe1\u606f\uff0c\u56e0\u6b64\u6587\u4ef6\u66f4\u5c0f\uff0c\u9002\u5408\u5b58\u50a8\u548c\u4f20\u8f93\u3002</p> </li> <li> <p>\u76f4\u63a5\u6267\u884c\uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7684\u542f\u52a8\u52a0\u8f7d\u5668\uff08bootloader\uff09\u53ef\u80fd\u53ea\u80fd\u7406\u89e3\u548c\u6267\u884c <code>.bin</code> \u6587\u4ef6\u3002<code>.bin</code> \u6587\u4ef6\u7684\u683c\u5f0f\u66f4\u7b80\u5355\uff0c\u66f4\u5bb9\u6613\u88ab\u786c\u4ef6\u76f4\u63a5\u52a0\u8f7d\u548c\u6267\u884c\u3002</p> </li> <li> <p>\u5185\u5b58\u5e03\u5c40\uff1a<code>.elf</code> \u6587\u4ef6\u4e2d\u7684\u6570\u636e\u548c\u4ee3\u7801\u53ef\u80fd\u9700\u8981\u5728\u5185\u5b58\u4e2d\u91cd\u65b0\u5e03\u5c40\u4ee5\u9002\u5e94\u7279\u5b9a\u7684\u786c\u4ef6\u67b6\u6784\u3002\u4f7f\u7528 <code>objcopy</code> \u5de5\u5177\u53ef\u4ee5\u8c03\u6574\u5185\u5b58\u5e03\u5c40\uff0c\u786e\u4fdd\u4ee3\u7801\u548c\u6570\u636e\u88ab\u653e\u7f6e\u5728\u6b63\u786e\u7684\u5185\u5b58\u5730\u5740\u3002</p> </li> <li> <p>\u53bb\u9664\u4e0d\u5fc5\u8981\u7684\u6bb5\uff1a<code>.elf</code> \u6587\u4ef6\u53ef\u80fd\u5305\u542b\u4e00\u4e9b\u5728\u6700\u7ec8\u4ea7\u54c1\u4e2d\u4e0d\u9700\u8981\u7684\u6bb5\uff0c\u5982 <code>.bss</code> \u6bb5\uff08\u672a\u521d\u59cb\u5316\u7684\u6570\u636e\uff09\u3002\u4f7f\u7528 <code>objcopy</code> \u53ef\u4ee5\u53bb\u9664\u8fd9\u4e9b\u6bb5\uff0c\u51cf\u5c11\u6700\u7ec8\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5927\u5c0f\u3002</p> </li> <li> <p>\u517c\u5bb9\u6027\uff1a\u4e0d\u540c\u7684\u76ee\u6807\u7cfb\u7edf\u53ef\u80fd\u9700\u8981\u4e0d\u540c\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002<code>objcopy</code> \u5de5\u5177\u63d0\u4f9b\u4e86\u7075\u6d3b\u6027\uff0c\u53ef\u4ee5\u751f\u6210\u9002\u5408\u7279\u5b9a\u7cfb\u7edf\u6216\u5904\u7406\u5668\u67b6\u6784\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> </li> </ol> <p>\u5728\u4f60\u63d0\u4f9b\u7684\u547d\u4ee4\u4e2d\uff0c<code>riscv64-linux-gnu-objcopy</code> \u5de5\u5177\u88ab\u7528\u6765\u4ece <code>.elf</code> \u6587\u4ef6\u751f\u6210 <code>.bin</code> \u6587\u4ef6\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86\u4e00\u4e9b\u7279\u5b9a\u7684\u9009\u9879\uff1a</p> <ul> <li><code>-S</code>\uff1a\u53bb\u9664\u6240\u6709\u7b26\u53f7\u4fe1\u606f\u3002</li> <li><code>--set-section-flags .bss=alloc,contents</code>\uff1a\u8bbe\u7f6e <code>.bss</code> \u6bb5\u7684\u5c5e\u6027\uff0c<code>alloc</code> \u8868\u793a\u4e3a\u8be5\u6bb5\u5206\u914d\u7a7a\u95f4\uff0c<code>contents</code> \u8868\u793a\u5305\u542b\u8be5\u6bb5\u7684\u5185\u5bb9\u3002</li> <li><code>-O binary</code>\uff1a\u6307\u5b9a\u8f93\u51fa\u683c\u5f0f\u4e3a\u4e8c\u8fdb\u5236\u3002</li> </ul> <p>\u8fd9\u4e9b\u6b65\u9aa4\u786e\u4fdd\u4e86\u751f\u6210\u7684 <code>.bin</code> \u6587\u4ef6\u662f\u9002\u5408\u76ee\u6807\u7cfb\u7edf\u4f7f\u7528\u7684\uff0c\u5e76\u4e14\u53bb\u9664\u4e86\u4e0d\u5fc5\u8981\u7684\u4fe1\u606f\uff0c\u4f18\u5316\u4e86\u6587\u4ef6\u5927\u5c0f\u548c\u6027\u80fd\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#nemu_1","title":"NEMU","text":"<pre><code>make -C /home/jai/ysyx-workbench/nemu ISA=riscv32 run \\\n    ARGS=\"-l /home/jai/ysyx-workbench/nanos-lite/build/nemu-log.txt \\\n    -b -e /home/jai/ysyx-workbench/nanos-lite/build/nanos-lite-riscv32-nemu.elf\" \\\n    IMG=/home/jai/ysyx-workbench/nanos-lite/build/nanos-lite-riscv32-nemu.bin\n\nmake[1]: Entering directory '/home/jai/ysyx-workbench/nemu'\ngcc -c -o build/obj-riscv32-nemu-interpreter/src/device/device.o src/device/device.c\ngcc -c -o build/obj-riscv32-nemu-interpreter/src/device/alarm.o src/device/alarm.c\n    ......(\u5f88\u591a.c\u6587\u4ef6\u7f16\u8bd1\u6210.o\u6587\u4ef6)\ngcc -c -o build/obj-riscv32-nemu-interpreter/src/memory/vaddr.o src/memory/vaddr.c\ngcc -c -o build/obj-riscv32-nemu-interpreter/src/memory/paddr.o src/memory/paddr.c\ng++ -o /home/jai/ysyx-workbench/nemu/build/riscv32-nemu-interpreter \\\n    /home/jai/ysyx-workbench/nemu/build/obj-riscv32-nemu-interpreter/src/device/device.o \\\n    /home/jai/ysyx-workbench/nemu/build/obj-riscv32-nemu-interpreter/src/device/alarm.o \\\n    ...(\u4e0a\u9762\u7684.o\u6587\u4ef6)\n    NEMU/build/obj-riscv32-nemu-interpreter/src/memory/vaddr.o \\\n    NEMU/build/obj-riscv32-nemu-interpreter/src/memory/paddr.o \\\n    -O2 -O2  -Og -ggdb3   -lSDL2 -lreadline -ldl -pie\n\n//\u6267\u884c\uff1a\n/home/jai/ysyx-workbench/nemu/build/riscv32-nemu-interpreter \\\n    -l /home/jai/ysyx-workbench/nanos-lite/build/nemu-log.txt \\\n    -b -e /home/jai/ysyx-workbench/nanos-lite/build/nanos-lite-riscv32-nemu.elf \\\n    /home/jai/ysyx-workbench/nanos-lite/build/nanos-lite-riscv32-nemu.bin\n</code></pre> <p>\u7f16\u8bd1\u597d NEMU \u7684\u6e90\u4ee3\u7801\uff0c\u7136\u540e\u6253\u5305\u6210 <code>riscv32-nemu-interpreter</code>\uff0c\u5176\u4f5c\u4e3a\u4e00\u4e2aC\u7a0b\u5e8f\uff0c\u63a5\u53d7\u547d\u4ee4\u884c\u4f20\u8fdb\u6765\u7684\u53c2\u6570\uff0c\u4f7f\u7528\u5404\u79cd\u53c2\u6570\uff08<code>-b -l -e</code>\uff09\u63a5\u6536\u955c\u50cf\u6587\u4ef6\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#app","title":"APP","text":"<p>\u5728\u524d\u9762\u6784\u5efa\u597d\u6d41\u7a0b\u540e\uff0c\u5728\u8fd9\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f\u4ee5\u53e6\u4e00\u79cd\u65b9\u5f0f\u88c5\u8f7d\u8fdb OS \u4e86\uff1a<code>nanos-lite/src/proc.c</code> \u3001<code>nanos-lite/src/loader.c</code></p> <pre><code>static uintptr_t loader(PCB *pcb, const char *filename) \nvoid naive_uload(PCB *pcb, const char *filename)\nvoid context_uload(PCB *pcb, const char *filename, char *const argv[], char *const envp[])\n</code></pre> <p>\u4f7f\u7528\u4e0d\u540c\u7684\u8fdb\u7a0b loader \u88c5\u8f7d\u4e0d\u540c\u7684\u5e94\u7528\u3002</p> <p>\u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00\u5206\u6790 <code>navy-apps/Makefile</code> \uff0c\u5176\u5185\u5bb9\u548c AM \u7684\u5f88\u50cf\u3002</p> <pre><code>118 ### Rule (recursive make): build dependent libraries (libc, libos, ...)\n119 libs:\n120     @for t in $(LIBS); do $(MAKE) -s -C $(NAVY_HOME)/libs/$$t archive; done\n121 \n122 ### Rule (link): objects (`*.o`) and libraries (`*.a`) -&gt; `$(APP)`, the final ELF binary to be packed into application (ld)\n123 $(APP): $(OBJS) libs\n124     @echo + LD \"-&gt;\" $(shell realpath $@ --relative-to .)\n125     @$(LD) $(LDFLAGS) -o $@ $(WL)--start-group $(LINKAGE) $(WL)--end-group\n</code></pre> <p>\u4ece\u8fd9\u91cc\u5f00\u59cb\u518d\u4e00\u6b65\u6b65\u5411\u4e0b\u5206\u6790\u7f16\u8bd1\u7684\u5185\u5bb9\u5373\u53ef\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#_2","title":"\u8bb2\u4e49\u7b54\u6848","text":"<p>\u5728\u8ba9NEMU\u8fd0\u884c\u5ba2\u6237\u7a0b\u5e8f\u4e4b\u524d, \u6211\u4eec\u9700\u8981\u5c06\u5ba2\u6237\u7a0b\u5e8f\u7684\u4ee3\u7801\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6. \u9700\u8981\u8bf4\u660e\u7684\u662f, \u6211\u4eec\u4e0d\u80fd\u4f7f\u7528gcc\u7684\u9ed8\u8ba4\u9009\u9879\u76f4\u63a5\u7f16\u8bd1, \u56e0\u4e3a\u9ed8\u8ba4\u9009\u9879\u4f1a\u6839\u636eGNU/Linux\u7684\u8fd0\u884c\u65f6\u73af\u5883\u5c06\u4ee3\u7801\u7f16\u8bd1\u6210\u8fd0\u884c\u5728GNU/Linux\u4e0b\u7684\u53ef\u6267\u884c\u6587\u4ef6. \u4f46\u6b64\u65f6\u7684NEMU\u5e76\u4e0d\u80fd\u4e3a\u5ba2\u6237\u7a0b\u5e8f\u63d0\u4f9bGNU/Linux\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u5728NEMU\u4e2d\u65e0\u6cd5\u6b63\u786e\u8fd0\u884c\u4e0a\u8ff0\u53ef\u6267\u884c\u6587\u4ef6, \u56e0\u6b64\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528gcc\u7684\u9ed8\u8ba4\u9009\u9879\u6765\u7f16\u8bd1\u7528\u6237\u7a0b\u5e8f.</p> <p>\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u4ea4\u53c9\u7f16\u8bd1. \u6211\u4eec\u9700\u8981\u5728GNU/Linux\u4e0b\u6839\u636eAM\u7684\u8fd0\u884c\u65f6\u73af\u5883\u7f16\u8bd1\u51fa\u80fd\u591f\u5728<code>$ISA-nemu</code>\u8fd9\u4e2a\u65b0\u73af\u5883\u4e2d\u8fd0\u884c\u7684\u53ef\u6267\u884c\u6587\u4ef6. \u4e3a\u4e86\u4e0d\u8ba9\u94fe\u63a5\u5668ld\u4f7f\u7528\u9ed8\u8ba4\u7684\u65b9\u5f0f\u94fe\u63a5, \u6211\u4eec\u8fd8\u9700\u8981\u63d0\u4f9b\u63cf\u8ff0<code>$ISA-nemu</code>\u7684\u8fd0\u884c\u65f6\u73af\u5883\u7684\u94fe\u63a5\u811a\u672c. AM\u7684\u6846\u67b6\u4ee3\u7801\u5df2\u7ecf\u628a\u76f8\u5e94\u7684\u914d\u7f6e\u51c6\u5907\u597d\u4e86, \u4e0a\u8ff0\u7f16\u8bd1\u548c\u94fe\u63a5\u9009\u9879\u4e3b\u8981\u4f4d\u4e8e<code>abstract-machine/Makefile</code> \u4ee5\u53ca<code>abstract-machine/scripts/</code>\u76ee\u5f55\u4e0b\u7684\u76f8\u5173<code>.mk</code>\u6587\u4ef6\u4e2d. \u7f16\u8bd1\u751f\u6210\u4e00\u4e2a\u53ef\u4ee5\u5728NEMU\u7684\u8fd0\u884c\u65f6\u73af\u5883\u4e0a\u8fd0\u884c\u7684\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b:</p> <ul> <li>gcc\u5c06<code>$ISA-nemu</code>\u7684AM\u5b9e\u73b0\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210\u76ee\u6807\u6587\u4ef6, \u7136\u540e\u901a\u8fc7ar\u5c06\u8fd9\u4e9b\u76ee\u6807\u6587\u4ef6\u4f5c\u4e3a\u4e00\u4e2a\u5e93, \u6253\u5305\u6210\u4e00\u4e2a\u5f52\u6863\u6587\u4ef6<code>abstract-machine/am/build/am-$ISA-nemu.a</code></li> <li>gcc\u628a\u5e94\u7528\u7a0b\u5e8f\u6e90\u6587\u4ef6(\u5982<code>am-kernels/tests/cpu-tests/tests/dummy.c</code>)\u7f16\u8bd1\u6210\u76ee\u6807\u6587\u4ef6</li> <li>\u901a\u8fc7gcc\u548car\u628a\u7a0b\u5e8f\u4f9d\u8d56\u7684\u8fd0\u884c\u5e93(\u5982<code>abstract-machine/klib/</code>)\u4e5f\u7f16\u8bd1\u5e76\u6253\u5305\u6210\u5f52\u6863\u6587\u4ef6</li> <li>\u6839\u636eMakefile\u6587\u4ef6<code>abstract-machine/scripts/$ISA-nemu.mk</code>\u4e2d\u7684\u6307\u793a, \u8ba9ld\u6839\u636e\u94fe\u63a5\u811a\u672c<code>abstract-machine/scripts/linker.ld</code>, \u5c06\u4e0a\u8ff0\u76ee\u6807\u6587\u4ef6\u548c\u5f52\u6863\u6587\u4ef6\u94fe\u63a5\u6210\u53ef\u6267\u884c\u6587\u4ef6</li> </ul> <p>\u6839\u636e\u4e0a\u8ff0\u94fe\u63a5\u811a\u672c\u7684\u6307\u793a, \u53ef\u6267\u884c\u7a0b\u5e8f\u91cd\u5b9a\u4f4d\u540e\u7684\u8282\u4ece<code>0x100000</code>\u6216<code>0x80000000</code>\u5f00\u59cb (\u53d6\u51b3\u4e8e<code>_pmem_start</code>\u548c<code>_entry_offset</code>\u7684\u503c), \u9996\u5148\u662f<code>.text</code>\u8282, \u5176\u4e2d\u53c8\u4ee5<code>abstract-machine/am/src/$ISA/nemu/start.S</code>\u4e2d\u81ea\u5b9a\u4e49\u7684<code>entry</code>\u8282\u5f00\u59cb, \u7136\u540e\u63a5\u4e0b\u6765\u662f\u5176\u5b83\u76ee\u6807\u6587\u4ef6\u7684<code>.text</code>\u8282. \u8fd9\u6837, \u53ef\u6267\u884c\u7a0b\u5e8f\u8d77\u59cb\u5904\u603b\u662f\u653e\u7f6e<code>start.S</code>\u7684\u4ee3\u7801, \u800c\u4e0d\u662f\u5176\u5b83\u4ee3\u7801, \u4fdd\u8bc1\u5ba2\u6237\u7a0b\u5e8f\u603b\u80fd\u4ece<code>start.S</code>\u5f00\u59cb\u6b63\u786e\u6267\u884c. \u94fe\u63a5\u811a\u672c\u4e5f\u5b9a\u4e49\u4e86\u5176\u5b83\u8282(\u5305\u62ec<code>.rodata</code>, <code>.data</code>, <code>.bss</code>)\u7684\u94fe\u63a5\u987a\u5e8f, \u8fd8\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5173\u4e8e\u4f4d\u7f6e\u4fe1\u606f\u7684\u7b26\u53f7, \u5305\u62ec\u6bcf\u4e2a\u8282\u7684\u672b\u5c3e, \u6808\u9876\u4f4d\u7f6e, \u5806\u533a\u7684\u8d77\u59cb\u548c\u672b\u5c3e.</p> <p>\u6211\u4eec\u5bf9\u7f16\u8bd1\u5f97\u5230\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u884c\u4e3a\u8fdb\u884c\u7b80\u5355\u7684\u68b3\u7406:</p> <ol> <li>\u7b2c\u4e00\u6761\u6307\u4ee4\u4ece<code>abstract-machine/am/src/$ISA/nemu/start.S</code>\u5f00\u59cb, \u8bbe\u7f6e\u597d\u6808\u9876\u4e4b\u540e\u5c31\u8df3\u8f6c\u5230<code>abstract-machine/am/src/platform/nemu/trm.c</code>\u7684<code>_trm_init()</code>\u51fd\u6570\u5904\u6267\u884c.</li> <li>\u5728<code>_trm_init()</code>\u4e2d\u8c03\u7528<code>main()</code>\u51fd\u6570\u6267\u884c\u7a0b\u5e8f\u7684\u4e3b\u4f53\u529f\u80fd, <code>main()</code>\u51fd\u6570\u8fd8\u5e26\u4e00\u4e2a\u53c2\u6570, \u76ee\u524d\u6211\u4eec\u6682\u65f6\u4e0d\u4f1a\u7528\u5230, \u540e\u9762\u6211\u4eec\u518d\u4ecb\u7ecd\u5b83.</li> <li>\u4ece<code>main()</code>\u51fd\u6570\u8fd4\u56de\u540e, \u8c03\u7528<code>halt()</code>\u7ed3\u675f\u8fd0\u884c.</li> </ol> <p>\u6709\u4e86TRM\u8fd9\u4e2a\u7b80\u5355\u7684\u8fd0\u884c\u65f6\u73af\u5883, \u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5728\u4e0a\u9762\u8fd0\u884c\u5404\u79cd\"\u7b80\u5355\"\u7684\u7a0b\u5e8f\u4e86. \u5f53\u7136, \u6211\u4eec\u4e5f\u53ef\u4ee5\u8fd0\u884c\"\u4e0d\u7b80\u5355\"\u7684\u7a0b\u5e8f: \u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4efb\u610f\u590d\u6742\u7684\u7b97\u6cd5, \u751a\u81f3\u662f\u5404\u79cd\u7406\u8bba\u4e0a\u53ef\u8ba1\u7b97\u7684\u95ee\u9898, \u90fd\u53ef\u4ee5\u5728TRM\u4e0a\u89e3\u51b3.</p> <p>\u7a0b\u5e8f, \u8fd0\u884c\u65f6\u73af\u5883\u4e0eAM  RTFSC(3)</p>"},{"location":"ysyx/pa/summary/summary.html#makefile","title":"\u9047\u5230\u7684\u4e00\u4e9bMakefile","text":""},{"location":"ysyx/pa/summary/summary.html#q1","title":"Q1","text":"<p>\u5bf9\u4e8e\u8fd9\u90e8\u5206\u7684makefile\uff0c\u6211\u5e38\u5e38\u770b\u5230OBJS      = $(addprefix $(DST_DIR)/, $(addsuffix .o, $(basename $(SRCS)))) \u8fd9\u79cd\u76f4\u63a5\u5c06.c\u6587\u4ef6\u8f6c\u4e3a.o\u6587\u4ef6\u4e0d\u7528\u7ecf\u8fc7\u7f16\u8bd1\u7684\u5417\uff1f\u4e0d\u7528\u8c03\u7528gcc\u7f16\u8bd1\u7684\u5417\uff1f \u6211\u6709\u70b9\u8ff7\u7cca</p> <ol> <li> <p>\u5173\u4e8e <code>%</code> \u7684\u95ee\u9898\uff1a</p> <p>\u5728 Makefile \u4e2d\uff0c<code>%</code> \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u81ea\u52a8\u53d8\u91cf\uff0c\u5b83\u4ee3\u8868\u89c4\u5219\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\uff08<code>$@</code>\uff09\u7684\u540d\u79f0\u90e8\u5206\u3002\u5f53\u4f60\u5728\u89c4\u5219\u4e2d\u4f7f\u7528 <code>%</code> \u65f6\uff0cMake \u4f1a\u81ea\u52a8\u5c06\u5176\u66ff\u6362\u4e3a\u5339\u914d\u6a21\u5f0f\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\u540d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u89c4\u5219\uff1a</p> <pre><code>$(DST_DIR)/%.o: %.c\n</code></pre> <p>\u8fd9\u4e2a\u89c4\u5219\u53ef\u4ee5\u5339\u914d\u4efb\u4f55\u4ee5 <code>.c</code> \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u540c\u540d\u4f46\u4ee5 <code>.o</code> \u7ed3\u5c3e\u7684\u76ee\u6807\u6587\u4ef6\u3002\u5982\u679c\u76ee\u6807\u6587\u4ef6\u662f <code>obj/main.o</code>\uff0c\u90a3\u4e48 <code>%</code> \u5c06\u88ab\u66ff\u6362\u4e3a <code>main</code>\uff0c<code>%.c</code> \u5c06\u88ab\u66ff\u6362\u4e3a <code>main.c</code>\u3002</p> <p>\u8fd9\u91cc\u7684 <code>%</code> \u76f8\u5f53\u4e8e\u4e00\u4e2a\u901a\u914d\u7b26\uff0c\u53ef\u4ee5\u5339\u914d\u4efb\u4f55\u5b57\u7b26\u4e32\u3002\u5728\u89c4\u5219\u4e2d\uff0c<code>%</code> \u7528\u4e8e\u8868\u793a\u76ee\u6807\u6587\u4ef6\u548c\u4f9d\u8d56\u6587\u4ef6\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> </li> <li> <p>\u5982\u679c\u6ca1\u6709\u5199\u5177\u4f53\u7684\u7f16\u8bd1\u52a8\u4f5c\uff0c\u4f1a\u51fa\u9519\u5417\uff1f</p> <p>\u5982\u679c\u4f60\u5b9a\u4e49\u4e86 <code>OBJS</code> \u6216\u5176\u4ed6\u7c7b\u4f3c\u7684\u53d8\u91cf\uff0c\u4f46\u6ca1\u6709\u63d0\u4f9b\u76f8\u5e94\u7684\u7f16\u8bd1\u89c4\u5219\u6765\u751f\u6210\u8fd9\u4e9b\u6587\u4ef6\uff0c\u90a3\u4e48\u5f53\u4f60\u8fd0\u884c <code>make</code> \u547d\u4ee4\u65f6\uff0cMake \u4f1a\u5c1d\u8bd5\u627e\u5230\u751f\u6210\u8fd9\u4e9b\u76ee\u6807\u6587\u4ef6\u7684\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u5408\u9002\u7684\u89c4\u5219\uff0cMake \u4f1a\u62a5\u9519\uff0c\u63d0\u793a\u65e0\u6cd5\u751f\u6210\u8fd9\u4e9b\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6709\uff1a</p> <pre><code>OBJS = foo.o bar.o\n</code></pre> <p>\u4f46\u6ca1\u6709\u63d0\u4f9b\u5982\u4f55\u4ece <code>.c</code> \u6587\u4ef6\u751f\u6210 <code>foo.o</code> \u548c <code>bar.o</code> \u7684\u89c4\u5219\uff0c\u5f53\u4f60\u8fd0\u884c <code>make</code> \u65f6\uff0cMake \u4f1a\u5c1d\u8bd5\u7f16\u8bd1 <code>foo.o</code> \u548c <code>bar.o</code>\uff0c\u4f46\u7531\u4e8e\u6ca1\u6709\u89c4\u5219\u544a\u8bc9\u5b83\u5982\u4f55\u4ece <code>.c</code> \u6587\u4ef6\u751f\u6210 <code>.o</code> \u6587\u4ef6\uff0c\u5b83\u5c06\u65e0\u6cd5\u627e\u5230\u751f\u6210\u8fd9\u4e9b\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u5e76\u62a5\u9519\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u9519\u8bef\uff0c\u4f60\u9700\u8981\u4e3a\u6bcf\u4e2a\u76ee\u6807\u6587\u4ef6\u63d0\u4f9b\u76f8\u5e94\u7684\u7f16\u8bd1\u89c4\u5219\uff0c\u544a\u8bc9 Make \u5982\u4f55\u4ece\u6e90\u6587\u4ef6\u751f\u6210\u76ee\u6807\u6587\u4ef6\u3002\u8fd9\u4e9b\u89c4\u5219\u901a\u5e38\u5305\u62ec\u5982\u4f55\u8c03\u7528\u7f16\u8bd1\u5668\uff08\u5982 <code>gcc</code> \u6216 <code>g++</code>\uff09\uff0c\u4ee5\u53ca\u9700\u8981\u54ea\u4e9b\u7f16\u8bd1\u9009\u9879\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u4ec5\u4ec5\u5b9a\u4e49\u76ee\u6807\u6587\u4ef6\u5217\u8868\uff08\u5982 <code>OBJS</code>\uff09\u662f\u4e0d\u591f\u7684\uff0c\u4f60\u8fd8\u9700\u8981\u63d0\u4f9b\u751f\u6210\u8fd9\u4e9b\u6587\u4ef6\u7684\u5177\u4f53\u89c4\u5219\u3002\u8fd9\u4e9b\u89c4\u5219\u5b9a\u4e49\u4e86\u5982\u4f55\u4ece\u6e90\u6587\u4ef6\uff08\u5982 <code>.c</code>\u3001<code>.cpp</code> \u7b49\uff09\u7f16\u8bd1\u751f\u6210\u76ee\u6807\u6587\u4ef6\uff08<code>.o</code> \u6587\u4ef6\uff09\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e9b\u89c4\u5219\uff0cMake \u5c06\u4e0d\u77e5\u9053\u5982\u4f55\u6784\u5efa\u76ee\u6807\u6587\u4ef6\uff0c\u4ece\u800c\u5bfc\u81f4\u6784\u5efa\u5931\u8d25\u3002</p> </li> </ol>"},{"location":"ysyx/pa/summary/summary.html#make","title":"$(MAKE)","text":"<p>MAKE Variable (GNU make)</p> <p>build - What is the variable $(MAKE) in a makefile? - Stack Overflow</p>"},{"location":"ysyx/pa/summary/summary.html#_3","title":"\u5173\u4e8e\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe","text":"<p>\u7531\u4e8e\u662f\u5728\u81ea\u5df1\u865a\u62df\u673a\uff08x64\uff09\u4e0a\u6a21\u62dfriscv\u7684\u7a0b\u5e8f\uff0c\u81ea\u7136\u5c31\u4f1a\u60f3\u5230\u53bb\u4e86\u89e3\u4ea4\u53c9\u7f16\u8bd1\u7684\u5185\u5bb9 Cross compiler\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#_4","title":"\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898","text":"<p>\u6709\u95ee\u9898\uff0c\u5728\u505a os lab\u7684\u540c\u65f6\u597d\u50cf\u4e0d\u80fd\u540c\u4e8b\u53bb\u505a pa\u7684\u5185\u5bb9\uff1f \u4e0d\u7136\u7f16\u8bd1\u5de5\u5177\u4f1a\u6709\u95ee\u9898\uff1f</p> <pre><code>The following additional packages will be installed:\n  g++-11-riscv64-linux-gnu\nThe following NEW packages will be installed:\n  g++-11-riscv64-linux-gnu g++-riscv64-linux-gnu\n0 upgraded, 2 newly installed, 0 to remove and 74 not upgraded.\nNeed to get 9,142 kB of archives.\nAfter this operation, 24.8 MB of additional disk space will be used.\n</code></pre> <p>\u8fd9\u4e2a\u662f\u5c5e\u4e8e\u5305\u7ba1\u7406\u7684\u95ee\u9898\u5417\uff1f</p> <p>\u6211\u660e\u660e\u662f\u5df2\u7ecf\u81ea\u5df1\u7528\u7f16\u8bd1\u5b89\u88c5\u7684\u4e86\uff0c\u6211\u5e94\u8be5\u662f\u6ca1\u6709\u6dfb\u52a0\u8fdb\u73af\u5883\u53d8\u91cf\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#getopt_long","title":"<code>getopt_long</code>","text":"<pre><code>while ( (o = getopt_long(argc, argv, \"-bhl:d:p:e:\", table, NULL)) != -1) {\n  switch (o) {\n    case 'b': sdb_set_batch_mode();                   break;\n    case 'p': sscanf(optarg, \"%d\", &amp;difftest_port);   break;\n    case 'l': log_file = optarg;                      break;\n    case 'd': diff_so_file = optarg;                  break;\n    case  1 : img_file = optarg;                      return 0;\n    case 'e': elf_file = optarg;                      break;\n    default:\n      printf(\"Usage: %s [OPTION...] IMAGE [args]\\n\\n\", argv[0]);\n      printf(\"\\t-b,--batch              run with batch mode\\n\");\n      printf(\"\\t-l,--log=FILE           output log to FILE\\n\");\n      printf(\"\\t-d,--diff=REF_SO        run DiffTest with reference REF_SO\\n\");\n      printf(\"\\t-p,--port=PORT          run DiffTest with port PORT\\n\");\n      printf(\"\\t-e,--elf=elf_file       parse elf_file\");\n      printf(\"\\n\");\n      exit(0);\n  }                                                                                                                       \n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>img_file</code> \u4e3a\u4ec0\u4e48\u548c <code>case 1</code> \u5339\u914d\u4e0a\u4e86\uff1f</p> <p>\u5173\u952e\u662f <code>\"-bhl:d:p:e:\"</code> \u5f00\u5934\u662f <code>-</code> \u3002</p> <p></p> <p>\u5982\u679c<code>optstring</code>\u53c2\u6570\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f<code>-</code>\uff0c\u90a3\u4e48\u975e\u9009\u9879\u53c2\u6570\u4f1a\u88ab\u5f53\u4f5c\u9009\u9879\u5b57\u7b26<code>1</code>\u7684\u53c2\u6570\u5904\u7406\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c<code>getopt_long()</code>\u5728\u5904\u7406\u5b8c\u6240\u6709\u9009\u9879\u540e\uff0c\u9047\u5230\u975e\u9009\u9879\u53c2\u6570\uff0c\u5b83\u4f1a\u5c06\u8be5\u53c2\u6570\u89c6\u4e3a\u9009\u9879<code>1</code>\u7684\u53c2\u6570\uff0c\u5e76\u8fd4\u56de<code>1</code>\u3002\u8fd9\u5c31\u662f<code>case 1</code>\u88ab\u89e6\u53d1\u7684\u60c5\u51b5\u3002</p> <p>\u8fd8\u53ef\u4ee5\u518d\u770b\u770b <code>mini-rv32ima</code> \u7684\u5b9e\u73b0\u3002</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u53c2\u6570\u89e3\u6790\u7684\u5faa\u73af\uff0c\u5b83\u5904\u7406\u4e86\u4e00\u7cfb\u5217\u4ee5 <code>-</code> \u5f00\u5934\u7684\u53c2\u6570\uff08\u901a\u5e38\u79f0\u4e3a\u9009\u9879\u6216\u5f00\u5173\uff09\uff0c\u5e76\u6839\u636e\u53c2\u6570\u7684\u4e0d\u540c\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002\u4ee5\u4e0b\u662f\u6bcf\u4e2a\u53c2\u6570\u7684\u529f\u80fd\u603b\u7ed3\uff1a</p> <ol> <li> <p><code>-m</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u5185\u5b58\u91cf\uff08<code>ram_amt</code>\uff09\u3002\u5982\u679c\u7528\u6237\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u503c\uff0c<code>SimpleReadNumberInt</code> \u51fd\u6570\u4f1a\u4f7f\u7528 <code>ram_amt</code> \u7684\u5f53\u524d\u503c\u4f5c\u4e3a\u9ed8\u8ba4\u503c\u3002</p> </li> <li> <p><code>-c</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u6307\u4ee4\u8ba1\u6570\uff08<code>instct</code>\uff09\u3002\u5982\u679c\u7528\u6237\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u503c\uff0c<code>SimpleReadNumberInt</code> \u51fd\u6570\u4f1a\u4f7f\u7528 <code>-1</code> \u4f5c\u4e3a\u9ed8\u8ba4\u503c\u3002</p> </li> <li> <p><code>-k</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u5185\u6838\u547d\u4ee4\u884c\uff08<code>kernel_command_line</code>\uff09\u3002</p> </li> <li> <p><code>-f</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u6620\u50cf\u6587\u4ef6\u540d\uff08<code>image_file_name</code>\uff09\u3002</p> </li> <li> <p><code>-b</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u8bbe\u5907\u6811\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d\uff08<code>dtb_file_name</code>\uff09\u3002</p> </li> <li> <p><code>-l</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u4e0d\u9700\u8981\u8ddf\u968f\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e <code>fixed_update</code> \u6807\u5fd7\u4e3a 1\uff0c\u5e76\u4f7f <code>param_continue</code> \u4e3a 1\uff0c\u8868\u793a\u540e\u7eed\u7684\u53c2\u6570\u5e94\u8be5\u7ee7\u7eed\u5904\u7406\u3002</p> </li> <li> <p><code>-p</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u4e0d\u9700\u8981\u8ddf\u968f\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e <code>do_sleep</code> \u6807\u5fd7\u4e3a 0\uff0c\u5e76\u4f7f <code>param_continue</code> \u4e3a 1\u3002</p> </li> <li> <p><code>-s</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u4e0d\u9700\u8981\u8ddf\u968f\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e <code>single_step</code> \u6807\u5fd7\u4e3a 1\uff0c\u5e76\u4f7f <code>param_continue</code> \u4e3a 1\u3002</p> </li> <li> <p><code>-d</code>\uff1a\u8fd9\u4e2a\u53c2\u6570\u4e0d\u9700\u8981\u8ddf\u968f\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e <code>fail_on_all_faults</code> \u6807\u5fd7\u4e3a 1\uff0c\u5e76\u4f7f <code>param_continue</code> \u4e3a 1\u3002</p> </li> <li> <p><code>-t</code>\uff1a\u540e\u9762\u8ddf\u968f\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u4e8e\u8bbe\u7f6e\u65f6\u95f4\u9664\u6570\uff08<code>time_divisor</code>\uff09\u3002\u5982\u679c\u7528\u6237\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u503c\uff0c<code>SimpleReadNumberInt</code> \u51fd\u6570\u4f1a\u4f7f\u7528 <code>1</code> \u4f5c\u4e3a\u9ed8\u8ba4\u503c\u3002</p> </li> </ol> <p>\u5982\u679c\u53c2\u6570\u4e0d\u662f\u4ee5 <code>-</code> \u5f00\u5934\u7684\uff08\u5373\u4e0d\u662f\u9009\u9879\uff09\uff0c\u6216\u8005\u5728\u5904\u7406\u53c2\u6570\u65f6\u9047\u5230\u4e0d\u8bc6\u522b\u7684\u9009\u9879\uff0c<code>show_help</code> \u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u901a\u5e38\u4f1a\u89e6\u53d1\u7a0b\u5e8f\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\u3002</p> <p><code>param_continue</code> \u53d8\u91cf\u7528\u4e8e\u6307\u793a\u5f53\u524d\u53c2\u6570\u662f\u5426\u9700\u8981\u7ee7\u7eed\u5904\u7406\u540e\u7eed\u7684\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a\u53c2\u6570\u540e\u9762\u9700\u8981\u8ddf\u968f\u4e00\u4e2a\u503c\uff0c\u90a3\u4e48 <code>param_continue</code> \u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\uff0c\u76f4\u5230\u5904\u7406\u5b8c\u8fd9\u4e2a\u503c\u3002</p> <p><code>SimpleReadNumberInt</code> \u51fd\u6570\u53ef\u80fd\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6574\u6570\uff0c\u5e76\u53ef\u80fd\u63d0\u4f9b\u9ed8\u8ba4\u503c\u3002\u5982\u679c <code>argv[i]</code> \u662f\u4e00\u4e2a\u6709\u6548\u7684\u53c2\u6570\uff0c\u90a3\u4e48 <code>SimpleReadNumberInt</code> \u4f1a\u8bfb\u53d6 <code>argv[i]</code> \u7684\u503c\uff1b\u5426\u5219\uff0c\u5b83\u4f1a\u4f7f\u7528\u63d0\u4f9b\u7684\u9ed8\u8ba4\u503c\u3002</p>"},{"location":"ysyx/pa/summary/summary.html#c","title":"C \u5e93\u7684\u5b9e\u73b0","text":""},{"location":"ysyx/pa/summary/summary.html#reference","title":"Reference","text":"<p>\u4ecemov\u6307\u4ee4\u5230\u4ed9\u5251\uff1a\u901a\u8fc7NEMU \u6784\u5efa\u7b80\u5355\u5b8c\u6574\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf</p> <p>\u3010\u4f59\u5b50\u6fe0\u3011NEMU\uff1a\u4e00\u4e2a\u6548\u7387\u63a5\u8fd1QEMU\u7684\u9ad8\u6027\u80fd\u89e3\u91ca\u5668 - \u7b2c\u4e00\u5c4a RISC-V \u4e2d\u56fd\u5cf0\u4f1a</p>"}]}