
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jailuo.github.io/notes/interview/own-Interview-questions/cvte26%E5%AE%9E%E4%B9%A0/cvte26.html">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>Cvte26 - Messy Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../index.html" title="Messy Notes" class="md-header__button md-logo" aria-label="Messy Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Messy Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cvte26
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/JAILuo/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Messy Notes" class="md-nav__button md-logo" aria-label="Messy Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Messy Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/JAILuo/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    é¦–é¡µ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    University Course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            University Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    jyy OS2024
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            jyy OS2024
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1_1" id="__nav_2_1_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    course note
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            course note
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/cousre%20note/2.%20concurrency/concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/cousre%20note/3.%20virtualization/virtualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/cousre%20note/4.%20kernel/kernel.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kernel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/cousre%20note/5.%20persistence/persistence.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    persistence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1_2" id="__nav_2_1_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mini Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            Mini Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/Mini%20Labs/M1/M1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/Mini%20Labs/M2/M2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/Mini%20Labs/M3/M3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M3
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1_3" id="__nav_2_1_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OS Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_3">
            <span class="md-nav__icon md-icon"></span>
            OS Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/OS%20Labs/L0/L0.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/University%20Course/jyy%20OS2024/OS%20Labs/L1/L1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    GeekTime
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            GeekTime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    æ·±å…¥ç†è§£è®¡ç®—æœºç»„æˆåŸç†
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            æ·±å…¥ç†è§£è®¡ç®—æœºç»„æˆåŸç†
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. æŒ‡ä»¤ä¸è¿ç®—
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. å¤„ç†å™¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. å­˜å‚¨ä¸IOç³»ç»Ÿ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. åº”ç”¨
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    è®¡ç®—åŸºç¡€å®æˆ˜è¯¾
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            è®¡ç®—åŸºç¡€å®æˆ˜è¯¾
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. MiniCPUè®¾è®¡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/2.%20%E8%AF%AD%E8%A8%80%E5%92%8C%E6%8C%87%E4%BB%A4/%E8%AF%AD%E8%A8%80%E5%92%8C%E6%8C%87%E4%BB%A4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. è¯­è¨€å’ŒæŒ‡ä»¤
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. åº”ç”¨å’Œå†…å­˜
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. IOä¸æ–‡ä»¶
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/5.%20%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8/synthesis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. ç»¼åˆåº”ç”¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Course/GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ç¯å¢ƒé…ç½®å’Œå·¥å…·é“¾
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ysyx
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            ysyx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NJU-ICS2023-PA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            NJU-ICS2023-PA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/pa1/pa1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/pa2/pa2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/pa3/pa3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/pa4/pa4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/c_marco/macro.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C Macro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/summary/summary.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/pa/Linux_porting/porting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Porting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ysyx/digital-circuit/digital%20circuit.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Digital Circuit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/GDB/GDB.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vim
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Vim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/vim/usage/usage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/vim/vim-plugin/vim.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vim-plugin
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/doxygen/doxygen.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    doxygen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/gcc/gcc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gcc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/Git/Git.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/md2slider/md2slider.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    md2slider
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tools/tmux/tmux.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tmux
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Todo%20List/todo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TODO List
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      ç¬”è¯•
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¬”è¯•">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      é€‰æ‹©
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      è§†é¢‘é¢è¯•é¢˜
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€é¢æŠ€æœ¯é¢
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ä¸€é¢æŠ€æœ¯é¢">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      é—®ç­”
    </span>
  </a>
  
    <nav class="md-nav" aria-label="é—®ç­”">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ ¸å¿ƒå®šä¹‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. å…³é”®å·®å¼‚
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. è®¾è®¡æ„ä¹‰ä¸åœºæ™¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-linux" class="md-nav__link">
    <span class="md-ellipsis">
      4. åº•å±‚å®ç°ï¼ˆä»¥Linuxä¸ºä¾‹ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. é«˜çº§æ‰©å±•
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“å›ç­”ï¼ˆ30ç§’ç²¾ç®€ç‰ˆï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”’ æ ¸å¿ƒè§£å†³æ€è·¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ› ï¸ å…·ä½“æ–¹æ¡ˆåŠä»£ç ç¤ºä¾‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ› ï¸ å…·ä½“æ–¹æ¡ˆåŠä»£ç ç¤ºä¾‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. å…³é—­ä¸­æ–­ï¼ˆæœ€å¸¸ç”¨ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      2. åŸå­æ“ä½œï¼ˆä¾èµ– CPU æ”¯æŒï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. æ— é”è®¾è®¡ï¼ˆé¿å…å…±äº«ï¼‰
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸŒŸ æ€»ç»“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ™ºèƒ½æŒ‡é’ˆçš„æ ¸å¿ƒç›®çš„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-c" class="md-nav__link">
    <span class="md-ellipsis">
      2. C++æ ‡å‡†åº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. C++æ ‡å‡†åº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-stdunique_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      (1) std::unique_ptr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-stdshared_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      (2) std::shared_ptr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stdweak_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      (3) std::weak_ptr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-stdauto_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      (4) std::auto_ptrï¼ˆå·²å¼ƒç”¨ï¼‰
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. ç¤ºä¾‹ï¼šå¾ªç¯å¼•ç”¨ä¸è§£å†³æ–¹æ¡ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      5. æ€»ç»“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ ¸å¿ƒæ€æƒ³ï¼šè‡ªåŠ¨ç®¡å®¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unique_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      2. æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼šunique_ptr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼šunique_ptr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      å®ç°åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-shared_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      3. å…±äº«å‹æ™ºèƒ½æŒ‡é’ˆï¼šshared_ptr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. å…±äº«å‹æ™ºèƒ½æŒ‡é’ˆï¼šshared_ptr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      å®ç°åŸç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-weak_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      4. è¾…åŠ©å‹æ™ºèƒ½æŒ‡é’ˆï¼šweak_ptr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. è¾…åŠ©å‹æ™ºèƒ½æŒ‡é’ˆï¼šweak_ptr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      å®ç°åŸç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5. æ™ºèƒ½æŒ‡é’ˆçš„â€œé«˜æ•ˆç§˜è¯€â€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“ï¼šæ™ºèƒ½æŒ‡é’ˆå¦‚ä½•å¸®ä½ çœå¿ƒï¼Ÿ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1. æœ¬è´¨å®šä¹‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. æ ¸å¿ƒå·®å¼‚
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      3. åº•å±‚å®ç°å¯¹æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. å…¸å‹ä½¿ç”¨åœºæ™¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5. å…³é”®ä»£ç ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. é«˜çº§æ³¨æ„äº‹é¡¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. è®¾è®¡å“²å­¦
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1. è¯­è¨€å½’å±ä¸åº•å±‚æœºåˆ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2. æ ¸å¿ƒå·®å¼‚
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. æ ¸å¿ƒå·®å¼‚">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 åˆå§‹åŒ–ä¸å¯¹è±¡æ„é€ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 å¤±è´¥å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 å†…å­˜å¤§å°è®¡ç®—
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    <span class="md-ellipsis">
      3. ç±»å‹å®‰å…¨æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      4. æ„é€ /ææ„å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_4" class="md-nav__link">
    <span class="md-ellipsis">
      5. é‡è½½æœºåˆ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      6. å†…å­˜æ¥æº
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    <span class="md-ellipsis">
      7. å¤šæ€æ”¯æŒ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. ä½¿ç”¨åœºæ™¯å¯¹æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. å…³é”®ä»£ç ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-c" class="md-nav__link">
    <span class="md-ellipsis">
      10. ç°ä»£C++æ¼”è¿›
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“é€‰æ‹©åŸåˆ™
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. äº§ç”ŸåŸå› ä¸å…¸å‹åœºæ™¯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. äº§ç”ŸåŸå› ä¸å…¸å‹åœºæ™¯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 é‡æŒ‡é’ˆæˆå› 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 å†…å­˜æ³„æ¼æˆå› 
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_5" class="md-nav__link">
    <span class="md-ellipsis">
      3. å±å®³æ€§å¯¹æ¯”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4. ä»£ç ç¤ºä¾‹ä¸è°ƒè¯•åˆ†æ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. ä»£ç ç¤ºä¾‹ä¸è°ƒè¯•åˆ†æ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 é‡æŒ‡é’ˆå´©æºƒæ¡ˆä¾‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 å†…å­˜æ³„æ¼å¢é•¿ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_5" class="md-nav__link">
    <span class="md-ellipsis">
      5. æ£€æµ‹ä¸é¢„é˜²æ–¹æ¡ˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. æ£€æµ‹ä¸é¢„é˜²æ–¹æ¡ˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 é‡æŒ‡é’ˆé˜²æŠ¤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 å†…å­˜æ³„æ¼æ²»ç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-c" class="md-nav__link">
    <span class="md-ellipsis">
      6. ç°ä»£C++æœ€ä½³å®è·µ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_2" class="md-nav__link">
    <span class="md-ellipsis">
      7. æ€»ç»“ï¼šå…³é”®åŒºåˆ«ä¸é€‰æ‹©
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-uartuniversal-asynchronous-receivertransmitter" class="md-nav__link">
    <span class="md-ellipsis">
      1. UARTï¼ˆUniversal Asynchronous Receiver/Transmitterï¼‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. UARTï¼ˆUniversal Asynchronous Receiver/Transmitterï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 æ ¸å¿ƒç‰¹æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 æ—¶åºç‰¹å¾
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 ç¡¬ä»¶å±‚ç»†èŠ‚
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-i2cinter-integrated-circuit" class="md-nav__link">
    <span class="md-ellipsis">
      2. I2Cï¼ˆInter-Integrated Circuitï¼‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. I2Cï¼ˆInter-Integrated Circuitï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 æ ¸å¿ƒç‰¹æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 æ—¶åºç‰¹å¾
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 ç¡¬ä»¶å±‚ç»†èŠ‚
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-spiserial-peripheral-interface" class="md-nav__link">
    <span class="md-ellipsis">
      3. SPIï¼ˆSerial Peripheral Interfaceï¼‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. SPIï¼ˆSerial Peripheral Interfaceï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 æ ¸å¿ƒç‰¹æ€§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 æ—¶åºç‰¹å¾
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 ç¡¬ä»¶å±‚ç»†èŠ‚
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      4. ä¸‰åè®®å¯¹æ¯”æ€»ç»“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_6" class="md-nav__link">
    <span class="md-ellipsis">
      5. é€‰å‹å»ºè®®
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6. é«˜çº§è®¾è®¡æ³¨æ„äº‹é¡¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-spi" class="md-nav__link">
    <span class="md-ellipsis">
      7. ä»£ç ç¤ºä¾‹ï¼ˆSPI æ¨¡å¼é…ç½®ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi" class="md-nav__link">
    <span class="md-ellipsis">
      SPI åè®®ä»é›¶è¯¦è§£ï¼ˆè¶…è¯¦ç»†ä¿å§†çº§æ•™ç¨‹ï¼‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SPI åè®®ä»é›¶è¯¦è§£ï¼ˆè¶…è¯¦ç»†ä¿å§†çº§æ•™ç¨‹ï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spi_1" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€ã€SPI æ˜¯ä»€ä¹ˆï¼Ÿ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_2" class="md-nav__link">
    <span class="md-ellipsis">
      äºŒã€SPI çš„ç‰©ç†è¿æ¥
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_3" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸‰ã€SPI æ—¶åºæ·±åº¦è§£æ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ä¸‰ã€SPI æ—¶åºæ·±åº¦è§£æ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ—¶é’Ÿæ¨¡å¼ï¼ˆå…³é”®éš¾ç‚¹ï¼ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mode-0" class="md-nav__link">
    <span class="md-ellipsis">
      2. å®Œæ•´é€šä¿¡æµç¨‹ï¼ˆä»¥ Mode 0 ä¸ºä¾‹ï¼‰
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_4" class="md-nav__link">
    <span class="md-ellipsis">
      å››ã€SPI çš„ç¡¬ä»¶å®ç°ç»†èŠ‚
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å››ã€SPI çš„ç¡¬ä»¶å®ç°ç»†èŠ‚">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      1. ç”µè·¯è®¾è®¡è¦ç‚¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. é€Ÿåº¦ä¼˜åŒ–æŠ€å·§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi-arduino" class="md-nav__link">
    <span class="md-ellipsis">
      äº”ã€SPI æ¨¡å¼é…ç½®å®æˆ˜ï¼ˆä»¥ Arduino ä¸ºä¾‹ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spi_5" class="md-nav__link">
    <span class="md-ellipsis">
      å…­ã€SPI çš„ä¼˜ç¼ºç‚¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸ƒã€ç»å…¸åº”ç”¨åœºæ™¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      å…«ã€å­¦ä¹ è·¯çº¿å»ºè®®
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”¥ å¤šæ ¸ç¯å¢ƒä¸‹çš„å¹¶å‘å®‰å…¨æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§  å¤šæ ¸åŒæ­¥æ ¸å¿ƒåŸç†
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ§  å¤šæ ¸åŒæ­¥æ ¸å¿ƒåŸç†">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-memory-order" class="md-nav__link">
    <span class="md-ellipsis">
      1. åŸå­æ“ä½œä¸å†…å­˜åºï¼ˆMemory Orderï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2. ç¼“å­˜ä¸€è‡´æ€§åè®®
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ› ï¸ å¤šæ ¸åŒæ­¥æ–¹æ¡ˆå®ç°
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ› ï¸ å¤šæ ¸åŒæ­¥æ–¹æ¡ˆå®ç°">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-spinlock" class="md-nav__link">
    <span class="md-ellipsis">
      1. è‡ªæ—‹é”ï¼ˆSpinlockï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-read-write-lock" class="md-nav__link">
    <span class="md-ellipsis">
      2. è¯»å†™é”ï¼ˆRead-Write Lockï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-rcuread-copy-update" class="md-nav__link">
    <span class="md-ellipsis">
      3. RCUï¼ˆRead-Copy-Updateï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-lock-free-queue" class="md-nav__link">
    <span class="md-ellipsis">
      4. æ— é”æ•°æ®ç»“æ„ï¼ˆLock-Free Queueï¼‰
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      âš¡ å¤šæ ¸åŒæ­¥æ€§èƒ½ä¼˜åŒ–æŠ€å·§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ›‘ å¤šæ ¸è°ƒè¯•ä¸éªŒè¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“Š å¤šæ ¸åŒæ­¥æ–¹æ¡ˆé€‰å‹è¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… å¤šæ ¸åŒæ­¥é»„é‡‘æ³•åˆ™
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æ³•
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      å¤§æ•°åŠ æ³•ç®—æ³•è¯¦è§£ï¼ˆå­—ç¬¦ä¸²å®ç°æ³•ï¼‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¤§æ•°åŠ æ³•ç®—æ³•è¯¦è§£ï¼ˆå­—ç¬¦ä¸²å®ç°æ³•ï¼‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å¤§æ•°åŠ æ³•ï¼Ÿ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      äºŒã€æ‰‹å·¥åŠ æ³•åŸç†å›é¡¾
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸‰ã€ç®—æ³•å®ç°æ­¥éª¤åˆ†è§£
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ä¸‰ã€ç®—æ³•å®ç°æ­¥éª¤åˆ†è§£">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      æ­¥éª¤ 1ï¼šå­—ç¬¦ä¸²åè½¬
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    <span class="md-ellipsis">
      æ­¥éª¤ 2ï¼šé€ä½ç›¸åŠ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_6" class="md-nav__link">
    <span class="md-ellipsis">
      æ­¥éª¤ 3ï¼šå¤„ç†æœ€é«˜ä½è¿›ä½
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      æ­¥éª¤ 4ï¼šåè½¬ç»“æœæ¢å¤é¡ºåº
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      å››ã€å®Œæ•´ä»£ç æ³¨é‡Šè§£æ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      äº”ã€å…³é”®é—®é¢˜ä¸ä¼˜åŒ–
    </span>
  </a>
  
    <nav class="md-nav" aria-label="äº”ã€å…³é”®é—®é¢˜ä¸ä¼˜åŒ–">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ—¶é—´å¤æ‚åº¦åˆ†æ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    <span class="md-ellipsis">
      2. å†…å­˜ç®¡ç†è¦ç‚¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_7" class="md-nav__link">
    <span class="md-ellipsis">
      3. è¾¹ç•Œæµ‹è¯•æ¡ˆä¾‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4. æ‰©å±•ä¼˜åŒ–æ–¹å‘
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      å¤§æ•°åŠ æ³•çš„ä¼˜åŒ–å®ç°æ–¹æ¡ˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¤§æ•°åŠ æ³•çš„ä¼˜åŒ–å®ç°æ–¹æ¡ˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€ã€æ›¿ä»£ç®—æ³•åˆ†æ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    <span class="md-ellipsis">
      äºŒã€ä¼˜åŒ–æ–¹æ¡ˆ 1ï¼šå…åè½¬ç›´æ¥è®¡ç®—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸‰ã€ä¼˜åŒ–æ–¹æ¡ˆ 2ï¼šé¢„è®¡ç®—é•¿åº¦
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_8" class="md-nav__link">
    <span class="md-ellipsis">
      å››ã€ä¼˜åŒ–æ–¹æ¡ˆ 3ï¼šåŸåœ°ä¿®æ”¹ï¼ˆè¾“å…¥å¯å†™æ—¶ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      äº”ã€å¤æ‚åº¦å¯¹æ¯”ä¸é€‰å‹å»ºè®®
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simd" class="md-nav__link">
    <span class="md-ellipsis">
      å…­ã€ç»ˆæä¼˜åŒ–ï¼šSIMD å¹¶è¡Œè®¡ç®—
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Cvte26</h1>

<h2 id="_1">ç¬”è¯•</h2>
<h3 id="_2">ç®—æ³•</h3>
<ul>
<li>
<p>200ä»¥å†…çš„ç´ æ•°æ±‚å’Œ</p>
</li>
<li>
<p>ä¸€ä¸ªæŠ•è‰²å­æ¸¸æˆï¼Œ6ä¸ªäººè¡¨ç¤º6ä¸ªç‚¹ï¼Œæ¯ä¸ªäººæ‰‹ä¸Š10å…ƒï¼ŒæŠ•åˆ°å“ªä¸ªç‚¹ï¼Œé™¤äº†è¿™ä¸ªç‚¹çš„äººä»¥å¤–ï¼Œéƒ½è¦ç»™è¿™ä¸ªç‚¹çš„äºº1å…ƒï¼Œå¦‚æœä¸‹æ¬¡è¿˜æ˜¯è¿™ä¸ªäººï¼Œé‚£å°±ç¿»å€ç»™1â†’2â†’4....å¦‚æœæœ‰äººçš„é’±å°äºç­‰äº0ï¼Œè®°å½•ä¸ºå‡ºå±€ï¼Œè®°å½•ç¬¬ä¸€ä¸ªå‡ºå±€çš„ã€‚ã€‚ã€‚</p>
</li>
</ul>
<h3 id="_3">é€‰æ‹©</h3>
<ul>
<li>
<p>Cè¯­è¨€å¤æ‚æŒ‡é’ˆ</p>
<p>å‡½æ•°æŒ‡é’ˆã€æ•°ç»„æŒ‡é’ˆã€æ··èµ·æ¥è€ƒã€‚</p>
<p>å¥½åƒæ”¶åˆ°æ˜¯ä¸€ä¸ªæŒ‡å‘å«æœ‰10ä¸ªå…ƒç´ çš„æ•°ç»„çš„æŒ‡é’ˆï¼Œè¿˜æœ‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä¸è®°å¾—äº†ã€‚</p>
</li>
<li>
<p>å¾ªç¯é“¾è¡¨</p>
<ul>
<li>çŸ¥é“ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥å‘ä¸¤è¾¹éå†ï¼Ÿ</li>
<li>å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ˜¯å¤´èŠ‚ç‚¹ï¼Ÿ</li>
<li>é“¾è¡¨éå†çš„ï¼Œæ‰¾èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p><code>strlen</code> å’Œ <code>sizeof</code></p>
<p>è®°å¾—<code>strlen</code> è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä¸åŒ…æ‹¬æœ«å°¾çš„ç©ºå­—ç¬¦ <code>\0</code>ã€‚</p>
<p><code>sizeof</code> è®¡ç®—ç©ºé—´å¤§å°ã€‚</p>
</li>
<li>
<p>Linux æ–‡ä»¶/ç›®å½•ï¼Ÿ</p>
<p><code>chmod</code>ã€<code>chown</code>ï¼Ÿ</p>
<p>ä»€ä¹ˆæƒé™çš„çš„ rwxï¼Œç”¨æˆ·ã€ç¾¤ç»„ç”¨æˆ·ã€å…¶ä»–ï¼Ÿuï¼ˆuserï¼‰ã€gï¼ˆgroupï¼‰ã€oï¼ˆothersï¼‰</p>
<p>rï¼š4ï¼Œwï¼š2ï¼Œxï¼š1 <code>bitsï¼š0x100ã€0x010ã€0x001</code></p>
<p>æ¯”å¦‚ï¼š<code>drwxrwxr-x</code>ï¼Œé—®é—® deepseek</p>
<p>ä»å·¦åˆ°å³ï¼šugoï¼Œå„å 3ä¸ªbitï¼Œç¬¬ä¸€ä¸ªdï¼ˆdirectoryï¼‰ä¸çœ‹ã€‚</p>
</li>
<li>
<p><code>bootcmd</code> çš„ä½œç”¨ï¼Ÿ</p>
<p>ä¸å¤ªè®°å¾—æ–‡é—®çš„ä»€ä¹ˆäº†ï¼ŒæŒ‰è‡ªå·±çš„æ¥ï¼šå¯åŠ¨å†…æ ¸ã€åˆå§‹åŒ–memory controllerï¼Ÿä¼ é€’å‚æ•°ã€ä¸‹è½½å†…æ ¸åˆ° memoryä¸­ã€‚ã€‚ã€‚</p>
</li>
<li>
<p>æ–‡ä»¶å¤åˆ¶çš„å‘½ä»¤</p>
<p><code>cd</code>ã€<code>dd</code>ã€<code>&gt;</code> é‡å®šå‘çš„ã€‚</p>
</li>
</ul>
<h2 id="_4">è§†é¢‘é¢è¯•é¢˜</h2>
<blockquote>
<p>é—®å¯¹ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜åœ°å€ä¹‹é—´çš„äº†è§£ï¼Œè¿˜æœ‰äºŒè€…ä¹‹é—´å¦‚ä½•æ˜ å°„çš„ã€‚</p>
</blockquote>
<p>è‡ªå·±çš„å›ç­”ï¼š</p>
<p>é¦–å…ˆå¯¹äºç‰©ç†å†…å­˜ï¼Œæ˜¯è®¡ç®—æœºç³»ç»Ÿçš„å®é™…ç¡¬ä»¶å†…å­˜ï¼ˆDDRï¼ˆDRAMï¼‰ã€SRAMï¼‰ï¼Œå†…å­˜èŠ¯ç‰‡ï¼Œå®é™…ç”¨æ¥å­˜å‚¨ç¨‹åºå’Œæ•°æ®ã€‚</p>
<p>å¯¹äºç°ä»£çš„è®¡ç®—æœºç³»ç»Ÿæ¥è¯´ï¼Œç‰©ç†å†…å­˜åœ°å€ç©ºé—´éƒ½æ˜¯ç»Ÿä¸€ç¼–å€çš„ï¼Œæ¯”å¦‚ä»0åˆ°4GiBã€‚</p>
<p>å¦å¤–ï¼Œè®¡ç®—æœºç³»ç»Ÿä¸€èˆ¬éƒ½ä¸ä¼šç›´æ¥è®¿é—®ç‰©ç†åœ°å€çš„ï¼Œä¸ºäº†å®‰å…¨å’Œä¸€äº›å¤šé“ç¨‹åºåŠ è½½ï¼ˆé˜²æ­¢å„ä¸ªè¿›ç¨‹äº’ç›¸å½±å“ï¼‰çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨è™šæ‹Ÿå†…å­˜åœ°å€ã€‚</p>
<p>å…¶é€šè¿‡ä¸€ä¸ªæ˜ å°„æœºåˆ¶æˆ–è€…è¯´æ•°æ®ç»“æ„æ¥å°†ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€è”ç³»èµ·æ¥ã€‚</p>
<p>ç°ä»£çš„ arch å‡ ä¹éƒ½é€‰æ‹©çš„æ˜¯ <strong>åˆ†é¡µæœºåˆ¶</strong>ï¼Œå®é™…å°±æ˜¯ radix treeï¼ˆåŸºæ•°æ ‘ï¼‰ï¼Œç»´æŠ¤ä¸€ä¸ªé¡µè¡¨ã€‚</p>
<p>ä½†å®é™…è¿™ä¸ªé¡µè¡¨ç»´æŠ¤çš„å°±æ˜¯ä¸€ä¸ªæ•°å­¦å‡½æ•° <em>f(n)</em> ä¸€ä¸ªåœ°å€æ˜ å°„åˆ°å¦ä¸€ä¸ªåœ°å€ã€‚</p>
<p>å…·ä½“æ€ä¹ˆå®ç°çš„ï¼Œä¸åŒ arch æœ‰ä¸åŒçš„å¯„å­˜å™¨ï¼Œä½†å¤§åŒå°å¼‚ã€‚</p>
<p>æ¯”å¦‚ RISC-V çš„ <code>satp(Supervisor Address Translation and Protection)</code> å¯„å­˜å™¨ã€x86 çš„ <code>cr3</code> å¯„å­˜å™¨ ARM çš„ <code>TTBR0(Translation Table Base Register)</code> å¯„å­˜å™¨ã€‚ã€‚ã€‚</p>
<p>æ˜ å°„åˆ°æ ¸å¿ƒæœºåˆ¶å°±åœ¨äº MMUï¼Œä¸€ä¸ªç¡¬ä»¶æ¨¡å—ï¼Œåšåœ¨äº† CPU å†…éƒ¨ï¼Œå½“ç„¶ç°ä»£çš„ MMU ä¸ºäº†åŠ é€Ÿï¼Œé‡Œé¢å…¶å®è¿˜æœ‰ä¸ªå« TLB<code>(Translation Lookaside Buffer</code>) çš„å¯„å­˜å™¨ï¼Œå½“æˆMMU çš„ç¼“å­˜ï¼Œç”±æ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§åŸç†ï¼Œå­˜å‚¨å¸¸ç”¨çš„é¡µè¡¨ï¼Œå°±æ˜¯è™šæ‹Ÿå†…å­˜å¦‚ä½•æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„ã€‚</p>
<p>å…·ä½“è¿‡å°±æ˜¯ï¼š</p>
<ol>
<li>
<p>è™šæ‹Ÿåœ°å€æ‹†åˆ†ä¸ºé¡µå·ï¼ˆVPNï¼‰å’Œé¡µå†…åç§»é‡ï¼ˆOffsetï¼‰ã€‚</p>
</li>
<li>
<p>ç„¶åMMUé€šè¿‡VPNæŸ¥æ‰¾é¡µè¡¨ï¼Œè·å–å¯¹åº”PFNã€‚</p>
<blockquote>
<p>ä¸€äº›ç»†èŠ‚ä¸å±•å¼€ï¼ˆè‡ªå·±ç†è§£ï¼‰</p>
<ol>
<li>
<p>é¡µè¡¨ç”±å¤šä¸ªç‰©ç†é¡µï¼ˆç§°ä¸º<strong>é¡µè¡¨é¡µ</strong>ï¼‰ç»„æˆï¼Œæ¯ä¸ªé¡µè¡¨é¡µå­˜å‚¨å›ºå®šæ•°é‡çš„é¡µè¡¨é¡¹ï¼ˆPTEï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¡µè¡¨é¡µçš„ç‰©ç†å­˜å‚¨ä¸å®¹é‡</strong></p>
<ul>
<li><strong>é¡µè¡¨é¡µå¤§å°</strong>ï¼šé€šå¸¸ä¸ç‰©ç†å†…å­˜é¡µå¤§å°ä¸€è‡´ï¼ˆå¦‚4KBï¼‰ã€‚</li>
<li><strong>é¡µè¡¨é¡¹å¤§å°</strong>ï¼šåœ¨RISC-Vä¸­ï¼Œæ¯ä¸ªPTEå ç”¨<strong>8å­—èŠ‚</strong>ã€‚</li>
<li><strong>æ¯é¡µè¡¨é¡µçš„PTEæ•°é‡</strong>ï¼šå³æ¯ä¸ªé¡µè¡¨é¡µå¯å­˜å‚¨512ä¸ªPTEã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤šçº§é¡µè¡¨çš„å±‚çº§ç»“æ„</strong></p>
<p>åœ¨RISC-V Sv39ä¸­ï¼Œè™šæ‹Ÿåœ°å€è¢«åˆ’åˆ†ä¸ºä¸‰çº§é¡µå·ï¼ˆVPN[2], VPN[1], VPN[0]ï¼‰å’Œ12ä½é¡µå†…åç§»ï¼ˆOffsetï¼‰ã€‚</p>
<ul>
<li><strong>é¡µè¡¨å±‚çº§</strong>ï¼š<ul>
<li><strong>ç¬¬ä¸€çº§é¡µè¡¨</strong>ï¼šç”±<code>satp</code>å¯„å­˜å™¨æŒ‡å‘æ ¹é¡µè¡¨é¡µï¼Œé€šè¿‡VPN[2]ç´¢å¼•åˆ°ç¬¬äºŒçº§é¡µè¡¨é¡µçš„åŸºå€ã€‚</li>
<li><strong>ç¬¬äºŒçº§é¡µè¡¨</strong>ï¼šé€šè¿‡VPN[1]ç´¢å¼•åˆ°ç¬¬ä¸‰çº§é¡µè¡¨é¡µçš„åŸºå€ã€‚</li>
<li><strong>ç¬¬ä¸‰çº§é¡µè¡¨ï¼ˆå¶å­é¡µè¡¨ï¼‰</strong>ï¼šé€šè¿‡VPN[0]ç´¢å¼•åˆ°æœ€ç»ˆçš„PTEï¼Œè¯¥PTEæŒ‡å‘ç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ¯ä¸ªå±‚çº§çš„é¡µè¡¨å‡ä¸ºç‹¬ç«‹çš„ç‰©ç†é¡µ</strong>ï¼Œå› æ­¤ä¸‰çº§é¡µè¡¨å¯èƒ½å ç”¨3ä¸ªç‰©ç†é¡µï¼ˆæœ€ç®€æƒ…å†µï¼‰ã€‚</li>
<li><strong>å®é™…åœºæ™¯</strong>ï¼šè‹¥è™šæ‹Ÿåœ°å€ç©ºé—´ç¨€ç–ï¼Œé«˜å±‚é¡µè¡¨å¯èƒ½å…±äº«éƒ¨åˆ†é¡µè¡¨é¡µä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</li>
</ul>
</li>
</ol>
<hr />
<ol>
<li><strong>é¡µè¡¨é¡¹ï¼ˆPTEï¼‰çš„ç»“æ„</strong></li>
</ol>
<p>æ¯ä¸ªPTEåŒ…å«ä»¥ä¸‹å…³é”®å­—æ®µï¼ˆä»¥RISC-Vä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li><strong>ç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰</strong>ï¼šå æ®é«˜ä½ï¼ŒæŒ‡å‘ç›®æ ‡ç‰©ç†é¡µçš„åŸºå€ã€‚</li>
<li><strong>æ§åˆ¶ä½ä¸æƒé™ä½</strong>ï¼šå æ®ä½ä½ï¼ŒåŒ…æ‹¬ï¼š<ul>
<li><strong>Valid</strong>ï¼ˆæœ‰æ•ˆä½ï¼‰ï¼š1è¡¨ç¤ºè¯¥PTEå·²æ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚</li>
<li><strong>Read/Write/eXecute</strong>ï¼ˆR/W/Xï¼‰ï¼šæƒé™æ§åˆ¶ä½ã€‚</li>
<li><strong>User</strong>ï¼ˆUä½ï¼‰ï¼š1è¡¨ç¤ºç”¨æˆ·æ€è¿›ç¨‹å¯è®¿é—®ã€‚</li>
<li><strong>å…¶ä»–æ ‡å¿—</strong>ï¼šå¦‚Accessedï¼ˆè®¿é—®ä½ï¼‰ã€Dirtyï¼ˆè„ä½ï¼‰ç­‰ã€‚</li>
</ul>
</li>
</ul>
<hr />
<ol>
<li>
<p><strong>å¶å­PTEä¸éå¶å­PTE</strong></p>
<ul>
<li><strong>å¶å­PTE</strong>ï¼šä½äºæœ€åº•å±‚ï¼ˆç¬¬ä¸‰çº§ï¼‰çš„PTEï¼Œå…¶PFNç›´æ¥æŒ‡å‘ç‰©ç†é¡µå¸§ï¼Œ<strong>æƒé™ä½æ§åˆ¶è¯¥é¡µçš„è®¿é—®è§„åˆ™</strong>ã€‚</li>
<li><strong>éå¶å­PTE</strong>ï¼šä½äºé«˜å±‚ï¼ˆç¬¬ä¸€ã€äºŒçº§ï¼‰çš„PTEï¼Œå…¶PFNæŒ‡å‘ä¸‹ä¸€çº§é¡µè¡¨é¡µçš„åŸºå€ï¼Œ<strong>æƒé™ä½é€šå¸¸æ— æ•ˆï¼ˆä»…Validä½æœ‰æ„ä¹‰ï¼‰ã€‚</strong></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>è‹¥ç¬¬ä¸‰çº§PTEçš„R/W/Xä½ä¸º<code>R=1, W=0, X=0</code>ï¼Œåˆ™è¯¥é¡µå¯è¯»ä½†ä¸å¯å†™ã€ä¸å¯æ‰§è¡Œã€‚</li>
<li>è‹¥ç”¨æˆ·æ€è¿›ç¨‹å°è¯•å†™å…¥è¯¥é¡µï¼ŒMMUä¼šè§¦å‘æƒé™é”™è¯¯å¼‚å¸¸ï¼ˆå¦‚Store/AMO Access Faultï¼‰ã€‚</li>
</ul>
</li>
</ol>
</blockquote>
</li>
<li>
<p>PFN + Offset = ç‰©ç†åœ°å€ã€‚</p>
</li>
<li>
<p><strong>ç¼ºé¡µå¤„ç†</strong>ï¼šè‹¥é¡µè¡¨é¡¹æ— æ•ˆï¼ˆæœªåŠ è½½æˆ–æƒé™ä¸è¶³ï¼‰ï¼Œè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿå°†æ•°æ®ä»ç£ç›˜åŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œæ›´æ–°é¡µè¡¨ã€‚</p>
</li>
</ol>
<p>å¦å¤–ï¼Œç°ä»£çš„è¿›ç¨‹ä¹Ÿæ˜¯å»ºç«‹åœ¨åˆ†é¡µæœºåˆ¶ä¸Šçš„ï¼Œos ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›æŠ½è±¡å†…å­˜ç©ºé—´ï¼Œä¸»è¦æ˜¯éš”ç¦»ä¸åŒçš„è¿›ç¨‹ã€æœ‰ä¿æŠ¤æ€§ã€‚å…·ä½“å°±æ˜¯é€šè¿‡é¡µè¡¨æƒé™ä½å®ç°å†…å­˜éš”ç¦»ï¼ˆå¦‚ç”¨æˆ·æ€ä¸å†…æ ¸æ€éš”ç¦»ï¼‰ï¼ŒåŒæ—¶æ”¯æŒå…±äº«å†…å­˜ï¼ˆå¦‚å¤šä¸ªè¿›ç¨‹å…±äº«ä»£ç æ®µï¼‰ã€‚</p>
<p>ä¸€äº›æé«˜æ€§èƒ½çš„è®¾è®¡ï¼š</p>
<ul>
<li><strong>é›¶æ‹·è´ä¼˜åŒ–</strong>ï¼šå†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰æŠ€æœ¯å‡å°‘å†…å­˜å†—ä½™ï¼ˆå¦‚forkè¿›ç¨‹ï¼‰ã€‚</li>
<li><strong>é«˜æ€§èƒ½åœºæ™¯</strong>ï¼šé€šè¿‡å¤§é¡µï¼ˆHuge Pagesï¼‰å‡å°‘TLB Missï¼Œæå‡æ•°æ®åº“æ€§èƒ½ã€‚</li>
</ul>
<h2 id="_5">ä¸€é¢æŠ€æœ¯é¢</h2>
<p>éƒ¨åˆ† AI æ€»ç»“ã€‚</p>
<h3 id="_6">é—®ç­”</h3>
<ul>
<li>
<p><strong>è¿›ç¨‹ã€çº¿ç¨‹åŒºåˆ«</strong></p>
<p>è¿›ç¨‹å’Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå¹¶å‘è®¾è®¡çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸»è¦åŒºåˆ«ä½“ç°åœ¨ <strong>èµ„æºéš”ç¦»æ€§ã€æ‰§è¡Œç²’åº¦ã€é€šä¿¡æœºåˆ¶</strong> ç­‰æ–¹é¢ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š</p>
<hr />
<h4 id="1"><strong>1. æ ¸å¿ƒå®šä¹‰</strong></h4>
<ul>
<li>
<p><strong>è¿›ç¨‹</strong>ï¼š 
  æ“ä½œç³»ç»Ÿ<strong>èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½</strong>ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†å™¨ç­‰èµ„æºã€‚ 
  <strong>ç¤ºä¾‹</strong>ï¼šæµè§ˆå™¨ä¸­æ¯ä¸ªæ ‡ç­¾é¡µé€šå¸¸ä½œä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œï¼Œé˜²æ­¢å•é¡µé¢å´©æºƒå½±å“æ•´ä¸ªæµè§ˆå™¨ã€‚</p>
</li>
<li>
<p><strong>çº¿ç¨‹</strong>ï¼š 
  æ“ä½œç³»ç»Ÿ<strong>è°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œå…±äº«è¿›ç¨‹çš„èµ„æºï¼ˆå¦‚å†…å­˜ã€æ–‡ä»¶ï¼‰ï¼Œä½†æ‹¥æœ‰ç‹¬ç«‹çš„æ ˆã€å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ã€‚
  <strong>ç¤ºä¾‹</strong>ï¼šWebæœåŠ¡å™¨ï¼ˆå¦‚Nginxï¼‰ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†å¹¶å‘è¯·æ±‚ï¼Œå…±äº«ç›‘å¬ç«¯å£å’Œç¼“å­˜æ•°æ®ã€‚</p>
</li>
</ul>
<hr />
<h4 id="2"><strong>2. å…³é”®å·®å¼‚</strong></h4>
<table>
<thead>
<tr>
<th><strong>ç»´åº¦</strong></th>
<th><strong>è¿›ç¨‹</strong></th>
<th><strong>çº¿ç¨‹</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åœ°å€ç©ºé—´</strong></td>
<td>ç‹¬ç«‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆéœ€åˆ‡æ¢é¡µè¡¨ï¼‰</td>
<td>å…±äº«è¿›ç¨‹åœ°å€ç©ºé—´ï¼ˆæ— éœ€åˆ‡æ¢é¡µè¡¨ï¼‰</td>
</tr>
<tr>
<td><strong>èµ„æºéš”ç¦»æ€§</strong></td>
<td>å®Œå…¨éš”ç¦»ï¼ˆå†…å­˜ã€æ–‡ä»¶ã€CPUæ—¶é—´ç‰‡ç­‰ï¼‰</td>
<td>å…±äº«è¿›ç¨‹èµ„æºï¼ˆå†…å­˜ã€æ–‡ä»¶ï¼‰ï¼Œéš”ç¦»æ ˆ/å¯„å­˜å™¨</td>
</tr>
<tr>
<td><strong>åˆ›å»º/åˆ‡æ¢å¼€é”€</strong></td>
<td>é«˜ï¼ˆå¤åˆ¶é¡µè¡¨ã€åˆ·æ–°TLBã€å†…æ ¸æ•°æ®ç»“æ„ï¼‰</td>
<td>ä½ï¼ˆä»…éœ€åˆ†é…æ ˆå’Œå¯„å­˜å™¨ä¸Šä¸‹æ–‡ï¼‰</td>
</tr>
<tr>
<td><strong>é€šä¿¡æœºåˆ¶</strong></td>
<td>å¤æ‚ï¼ˆç®¡é“ã€å…±äº«å†…å­˜ã€Socketç­‰IPCæœºåˆ¶ï¼‰</td>
<td>ç›´æ¥è¯»å†™å…±äº«å†…å­˜ï¼ˆéœ€åŒæ­¥æœºåˆ¶å¦‚é”/ä¿¡å·é‡ï¼‰</td>
</tr>
<tr>
<td><strong>å®¹é”™æ€§</strong></td>
<td>é«˜ï¼ˆè¿›ç¨‹å´©æºƒä¸å½±å“å…¶ä»–è¿›ç¨‹ï¼‰</td>
<td>ä½ï¼ˆçº¿ç¨‹å´©æºƒå¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹ç»ˆæ­¢ï¼‰</td>
</tr>
<tr>
<td><strong>ç³»ç»Ÿè°ƒç”¨</strong></td>
<td><code>fork()</code>, <code>exec()</code>, <code>wait()</code></td>
<td><code>pthread_create()</code>, <code>clone(CLONE_VM)</code></td>
</tr>
</tbody>
</table>
<hr />
<h4 id="3"><strong>3. è®¾è®¡æ„ä¹‰ä¸åœºæ™¯</strong></h4>
<ul>
<li><strong>é€‰æ‹©è¿›ç¨‹çš„åœºæ™¯</strong>ï¼š</li>
<li>éœ€è¦å¼ºéš”ç¦»æ€§ï¼ˆå¦‚å®‰å…¨æ•æ„Ÿçš„æ²™ç›’ç¯å¢ƒï¼‰ã€‚</li>
<li>
<p>å¤šä»»åŠ¡éœ€ç‹¬ç«‹è¿è¡Œï¼ˆå¦‚åŒæ—¶è¿è¡Œæµè§ˆå™¨å’Œç¼–è¯‘å™¨ï¼‰ã€‚
  <strong>ä»£ä»·</strong>ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ï¼Œé€šä¿¡æˆæœ¬é«˜ã€‚</p>
</li>
<li>
<p><strong>é€‰æ‹©çº¿ç¨‹çš„åœºæ™¯</strong>ï¼š </p>
</li>
<li>é«˜å¹¶å‘ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ± ã€å®æ—¶æ•°æ®å¤„ç†ï¼‰ã€‚ </li>
<li>éœ€è¦é«˜æ•ˆå…±äº«æ•°æ®ï¼ˆå¦‚GUIåº”ç”¨çš„äº‹ä»¶å¤„ç†çº¿ç¨‹ï¼‰ã€‚ 
  <strong>é£é™©</strong>ï¼šéœ€è°¨æ…å¤„ç†ç«æ€æ¡ä»¶ï¼ˆRace Conditionsï¼‰å’Œæ­»é”ã€‚</li>
</ul>
<hr />
<h4 id="4-linux"><strong>4. åº•å±‚å®ç°ï¼ˆä»¥Linuxä¸ºä¾‹ï¼‰</strong></h4>
<ul>
<li><strong>è¿›ç¨‹</strong>ï¼šé€šè¿‡<code>fork()</code>ç³»ç»Ÿè°ƒç”¨åˆ›å»ºï¼Œå†…æ ¸å¤åˆ¶çˆ¶è¿›ç¨‹çš„<code>task_struct</code>å’Œ<code>mm_struct</code>ï¼ˆåœ°å€ç©ºé—´æè¿°ç¬¦ï¼‰ï¼Œé‡‡ç”¨<strong>å†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰</strong> ä¼˜åŒ–å†…å­˜å¤åˆ¶å¼€é”€ã€‚</li>
<li><strong>çº¿ç¨‹</strong>ï¼šé€šè¿‡<code>clone()</code>ç³»ç»Ÿè°ƒç”¨åˆ›å»ºï¼ŒæŒ‡å®š<code>CLONE_VM</code>æ ‡å¿—å…±äº«åœ°å€ç©ºé—´ï¼Œçº¿ç¨‹çš„<code>task_struct</code>å¤ç”¨è¿›ç¨‹çš„<code>mm_struct</code>ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Linuxä¸­åˆ›å»ºçº¿ç¨‹çš„ç®€åŒ–é€»è¾‘</span>
<span class="n">clone</span><span class="p">(</span><span class="n">CLONE_VM</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CLONE_FS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CLONE_FILES</span><span class="p">,</span><span class="w"> </span><span class="n">stack_ptr</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</code></pre></div>
<hr />
<h4 id="5"><strong>5. é«˜çº§æ‰©å±•</strong></h4>
<ul>
<li><strong>åç¨‹ï¼ˆCoroutineï¼‰</strong>ï¼šç”¨æˆ·çº§çº¿ç¨‹ï¼Œç”±ç¨‹åºè‡ªè¡Œè°ƒåº¦ï¼ˆå¦‚Goçš„Goroutineï¼‰ï¼Œåˆ‡æ¢å¼€é”€æä½ï¼ˆçº³ç§’çº§ï¼‰ï¼Œé€‚ç”¨äºç™¾ä¸‡çº§å¹¶å‘ã€‚</li>
<li><strong>å®¹å™¨æŠ€æœ¯</strong>ï¼šç°ä»£å®¹å™¨ï¼ˆå¦‚Dockerï¼‰æœ¬è´¨æ˜¯è½»é‡çº§è¿›ç¨‹ç»„ï¼Œé€šè¿‡å‘½åç©ºé—´ï¼ˆNamespaceï¼‰å’Œæ§åˆ¶ç»„ï¼ˆCGroupï¼‰å®ç°èµ„æºéš”ç¦»ã€‚</li>
</ul>
<hr />
<h3 id="30"><strong>æ€»ç»“å›ç­”ï¼ˆ30ç§’ç²¾ç®€ç‰ˆï¼‰</strong></h3>
<p>â€œè¿›ç¨‹æ˜¯èµ„æºéš”ç¦»çš„å•ä½ï¼Œæ‹¥æœ‰ç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œé€‚åˆéœ€è¦é«˜å®‰å…¨æ€§çš„åœºæ™¯ï¼›çº¿ç¨‹æ˜¯æ‰§è¡Œè°ƒåº¦çš„å•ä½ï¼Œå…±äº«è¿›ç¨‹èµ„æºï¼Œé€‚åˆé«˜å¹¶å‘ä»»åŠ¡ã€‚è¿›ç¨‹åˆ‡æ¢å¼€é”€å¤§ä½†éš”ç¦»æ€§å¼ºï¼Œçº¿ç¨‹å¼€é”€å°ä½†éœ€å¤„ç†åŒæ­¥é—®é¢˜ã€‚ç°ä»£ç³»ç»Ÿå¸¸æ··åˆä½¿ç”¨äºŒè€…ï¼Œå¦‚Chromeç”¨å¤šè¿›ç¨‹éš”ç¦»æ ‡ç­¾é¡µï¼Œç”¨å¤šçº¿ç¨‹åŠ é€Ÿæ¸²æŸ“ã€‚â€</p>
</li>
<li>
<p><strong>è¿›ç¨‹é—´é€šä¿¡</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">é€šä¿¡æ–¹å¼</th>
<th style="text-align: left;">å®šä¹‰ä¸æè¿°</th>
<th style="text-align: left;">ç‰¹ç‚¹</th>
<th style="text-align: left;">ä¼˜ç‚¹</th>
<th style="text-align: left;">ç¼ºç‚¹</th>
<th style="text-align: left;">é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ç®¡é“ï¼ˆPipeï¼‰</td>
<td style="text-align: left;">ä¸€ç§åŸºäºæ–‡ä»¶æè¿°ç¬¦çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ã€‚æ•°æ®åœ¨ç®¡é“ä¸­ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ–¹å¼ä¼ è¾“ã€‚</td>
<td style="text-align: left;">åŠåŒå·¥é€šä¿¡ï¼ˆé»˜è®¤ï¼‰ï¼Œåªèƒ½å•å‘ä¼ è¾“ï¼›éœ€è¦äº²ç¼˜å…³ç³»ã€‚</td>
<td style="text-align: left;">ç®€å•æ˜“ç”¨ï¼Œç³»ç»Ÿå¼€é”€å°ã€‚</td>
<td style="text-align: left;">é€šä¿¡èƒ½åŠ›æœ‰é™ï¼Œåªèƒ½åœ¨æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ã€‚</td>
<td style="text-align: left;">çˆ¶å­è¿›ç¨‹é—´çš„ç®€å•æ•°æ®ä¼ è¾“ï¼Œå¦‚å‘½ä»¤è¡Œå·¥å…·é“¾ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰</td>
<td style="text-align: left;">ä¸€ç§åŸºäºæ¶ˆæ¯çš„é€šä¿¡æœºåˆ¶ï¼Œæ¶ˆæ¯è¢«é¡ºåºæ”¾ç½®åœ¨é˜Ÿåˆ—ä¸­ï¼Œè¿›ç¨‹å¯ä»¥å‘é˜Ÿåˆ—å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</td>
<td style="text-align: left;">å…¨åŒå·¥é€šä¿¡ï¼ŒåŸºäºæ¶ˆæ¯çš„é€šä¿¡ã€‚</td>
<td style="text-align: left;">è§£è€¦å‘é€å’Œæ¥æ”¶è¿›ç¨‹ï¼Œçµæ´»æ€§é«˜ã€‚</td>
<td style="text-align: left;">éœ€è¦ç³»ç»Ÿæ”¯æŒï¼Œé…ç½®ç›¸å¯¹å¤æ‚ã€‚</td>
<td style="text-align: left;">éœ€è¦å¯é æ¶ˆæ¯ä¼ é€’çš„åœºæ™¯ï¼Œå¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰</td>
<td style="text-align: left;">å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œè¿›ç¨‹é€šè¿‡è¯»å†™å…±äº«å†…å­˜æ¥äº¤æ¢æ•°æ®ã€‚</td>
<td style="text-align: left;">é«˜æ•ˆï¼Œç›´æ¥å†…å­˜è®¿é—®ã€‚</td>
<td style="text-align: left;">é€šä¿¡é€Ÿåº¦å¿«ï¼Œé€‚åˆå¤§æ•°æ®é‡ä¼ è¾“ã€‚</td>
<td style="text-align: left;">åŒæ­¥å’Œäº’æ–¥é—®é¢˜éœ€è¦é¢å¤–å¤„ç†ã€‚</td>
<td style="text-align: left;">é«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ï¼Œå¦‚å®æ—¶æ•°æ®å¤„ç†ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">ä¿¡å·é‡ï¼ˆSemaphoreï¼‰</td>
<td style="text-align: left;">ä¸€ç§ç”¨äºè¿›ç¨‹åŒæ­¥å’Œäº’æ–¥çš„æœºåˆ¶ï¼Œé€šè¿‡ä¿¡å·é‡å˜é‡æ¥æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ã€‚</td>
<td style="text-align: left;">ç”¨äºåŒæ­¥å’Œäº’æ–¥ï¼Œä¸ç›´æ¥ç”¨äºæ•°æ®ä¼ è¾“ã€‚</td>
<td style="text-align: left;">ç¡®ä¿èµ„æºçš„æ­£ç¡®è®¿é—®ã€‚</td>
<td style="text-align: left;">ä»…ç”¨äºæ§åˆ¶ï¼Œä¸èƒ½ç›´æ¥ä¼ è¾“æ•°æ®ã€‚</td>
<td style="text-align: left;">å¤šè¿›ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶çš„åŒæ­¥æ§åˆ¶ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">ä¿¡å·ï¼ˆSignalï¼‰</td>
<td style="text-align: left;">ä¸€ç§è½¯ä»¶ä¸­æ–­æœºåˆ¶ï¼Œç”¨äºé€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†å¼‚æ­¥äº‹ä»¶ã€‚</td>
<td style="text-align: left;">å¼‚æ­¥é€šçŸ¥ï¼Œç®€å•å¿«é€Ÿã€‚</td>
<td style="text-align: left;">å®ç°ç®€å•ï¼Œé€‚ç”¨äºç®€å•çš„å¼‚æ­¥é€šçŸ¥ã€‚</td>
<td style="text-align: left;">ä¼ è¾“ä¿¡æ¯é‡å°‘ï¼Œå¤„ç†å‡½æ•°ç®€å•ã€‚</td>
<td style="text-align: left;">å¼‚æ­¥äº‹ä»¶é€šçŸ¥ï¼Œå¦‚é”®ç›˜ä¸­æ–­ã€å­è¿›ç¨‹ç»ˆæ­¢é€šçŸ¥ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">å¥—æ¥å­—ï¼ˆSocketï¼‰</td>
<td style="text-align: left;">ä¸€ç§ç½‘ç»œé€šä¿¡æ¥å£ï¼Œå…è®¸ä¸åŒä¸»æœºä¸Šçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</td>
<td style="text-align: left;">å¯ä»¥è·¨ç½‘ç»œé€šä¿¡ï¼Œçµæ´»ã€‚</td>
<td style="text-align: left;">é€šç”¨æ€§å¼ºï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</td>
<td style="text-align: left;">æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œé…ç½®å¤æ‚ã€‚</td>
<td style="text-align: left;">åˆ†å¸ƒå¼ç³»ç»Ÿã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">æ–‡ä»¶/è®°å½•é”å®šï¼ˆFile/Record Lockingï¼‰</td>
<td style="text-align: left;">é€šè¿‡é”å®šæ–‡ä»¶æˆ–è®°å½•æ¥é˜²æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®åŒä¸€æ–‡ä»¶æˆ–è®°å½•ã€‚</td>
<td style="text-align: left;">ç”¨äºæ–‡ä»¶å…±äº«åœºæ™¯ã€‚</td>
<td style="text-align: left;">é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ã€‚</td>
<td style="text-align: left;">æ€§èƒ½å½±å“ï¼Œé”å®šç®¡ç†å¤æ‚ã€‚</td>
<td style="text-align: left;">å¤šè¿›ç¨‹è®¿é—®åŒä¸€æ–‡ä»¶çš„åœºæ™¯ã€‚</td>
</tr>
<tr>
<td style="text-align: left;">å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMemory-Mapped Filesï¼‰</td>
<td style="text-align: left;">å°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡æ˜ å°„çš„å†…å­˜åŒºåŸŸå…±äº«æ–‡ä»¶æ•°æ®ã€‚</td>
<td style="text-align: left;">ç»“åˆæ–‡ä»¶I/Oå’Œå…±äº«å†…å­˜çš„ä¼˜ç‚¹ã€‚</td>
<td style="text-align: left;">é«˜æ•ˆå¤„ç†å¤§æ–‡ä»¶ã€‚</td>
<td style="text-align: left;">å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦ç®¡ç†æ–‡ä»¶æ˜ å°„ã€‚</td>
<td style="text-align: left;">å¤§æ–‡ä»¶å…±äº«å’Œå¤„ç†ï¼Œå¦‚æ•°æ®åº“ç³»ç»Ÿã€‚</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>ä¸­æ–­çš„æ¦‚å¿µæµç¨‹å’Œç†è§£</strong></p>
<p>æµç¨‹ï¼šä¿å­˜ç°åœºï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ¢å¤ç°åœºã€‚ï¼ˆè¿™ä¸ªä¸è¯´äº†ä¹‹å‰çš„ç¬”è®°æœ‰ï¼‰</p>
<p>æˆ‘ç­”çš„é‡ç‚¹ä¸»è¦åœ¨å•æ ¸ä¸Šçš„å¹¶å‘ï¼š</p>
<p>åœ¨å•æ ¸è£¸æœºç¯å¢ƒä¸‹ï¼Œè™½ç„¶ä¸å­˜åœ¨çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œï¼Œä½†<strong>ä¸­æ–­ä¸ä¸»ç¨‹åºä¹‹é—´çš„æŠ¢å ä¼šå¯¼è‡´å…±äº«å˜é‡çš„ç«æ€æ¡ä»¶</strong>ã€‚ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ¡ˆçš„æ¸…æ™°æ€»ç»“ï¼š</p>
<hr />
<h3 id="_7">ğŸ”’ æ ¸å¿ƒè§£å†³æ€è·¯</h3>
<p>å•æ ¸ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜æºäº<strong>ä¸­æ–­æŠ¢å ä¸»ç¨‹åºæ‰§è¡Œæµ</strong>ï¼ˆæˆ–ç›¸åï¼‰ã€‚è¦ä¿è¯äº’æ–¥ï¼Œæ ¸å¿ƒæ˜¯<strong>ç¡®ä¿è®¿é—®å…±äº«èµ„æºçš„ä»£ç æ®µï¼ˆä¸´ç•ŒåŒºï¼‰ä¸å¯è¢«ä¸­æ–­æ‰“æ–­</strong>ã€‚å¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<hr />
<h3 id="_8">ğŸ› ï¸ å…·ä½“æ–¹æ¡ˆåŠä»£ç ç¤ºä¾‹</h3>
<h4 id="1_1">1. <strong>å…³é—­ä¸­æ–­ï¼ˆæœ€å¸¸ç”¨ï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šåœ¨æ“ä½œå…±äº«å˜é‡å‰å…³é—­å…¨å±€ä¸­æ–­ï¼Œæ“ä½œå®Œæˆåç«‹å³æ¢å¤ï¼Œé˜²æ­¢ä¸­æ–­æŠ¢å ã€‚</li>
<li><strong>å®ç°</strong>ï¼š
     <div class="highlight"><pre><span></span><code><span class="c1">// ä»¥ ARM Cortex-M ä¸ºä¾‹ï¼š</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">enter_critical</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">__disable_irq</span><span class="p">();</span><span class="w">      </span><span class="c1">// å…³é—­å…¨å±€ä¸­æ–­</span>
<span class="w">    </span><span class="n">__enable_irq</span><span class="p">();</span><span class="w">       </span><span class="c1">// æ¢å¤ä¸­æ–­ï¼ˆä»…ç¤ºä¾‹ï¼Œå®é™…éœ€ä¿å­˜çŠ¶æ€ï¼‰</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹ï¼š</span>
<span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shared_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update_shared_var</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">__disable_irq</span><span class="p">();</span><span class="w">       </span><span class="c1">// è¿›å…¥ä¸´ç•ŒåŒº</span>
<span class="w">    </span><span class="n">shared_var</span><span class="o">++</span><span class="p">;</span><span class="w">          </span><span class="c1">// å®‰å…¨æ“ä½œå…±äº«å˜é‡</span>
<span class="w">    </span><span class="n">__enable_irq</span><span class="p">();</span><span class="w">       </span><span class="c1">// é€€å‡ºä¸´ç•ŒåŒº</span>
<span class="p">}</span>
</code></pre></div></li>
<li><strong>æ³¨æ„</strong>ï¼šéœ€ç¡®ä¿ä¸´ç•ŒåŒºæçŸ­ï¼ˆå¾®ç§’çº§ï¼‰ï¼Œé¿å…å½±å“ä¸­æ–­å“åº”ã€‚</li>
</ul>
<h4 id="2-cpu">2. <strong>åŸå­æ“ä½œï¼ˆä¾èµ– CPU æ”¯æŒï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šåˆ©ç”¨ CPU æä¾›çš„åŸå­æŒ‡ä»¤ï¼ˆå¦‚ LDREX/STREXã€CASï¼‰ï¼Œç¡®ä¿è¯»-æ”¹-å†™æ“ä½œä¸å¯åˆ†å‰²ã€‚</li>
<li>
<p><strong>å®ç°</strong>ï¼ˆARM Cortex-M åŸå­è‡ªå¢ï¼‰ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">atomic_inc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__LDREXW</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// åŸå­åŠ è½½å¹¶ä¿®æ”¹</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">__STREXW</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">));</span><span class="w"> </span><span class="c1">// åŸå­å­˜å‚¨ï¼Œå¤±è´¥åˆ™é‡è¯•</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="3_1">3. <strong>æ— é”è®¾è®¡ï¼ˆé¿å…å…±äº«ï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡ FIFO é˜Ÿåˆ—æˆ–åŒç¼“å†²ä¼ é€’æ•°æ®ï¼Œå‡å°‘ç›´æ¥å…±äº«å˜é‡ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
     <div class="highlight"><pre><span></span><code><span class="cp">#define BUFFER_SIZE 32</span>
<span class="k">volatile</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">BUFFER_SIZE</span><span class="p">];</span>
<span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// ä¸»ç¨‹åºå†™å…¥</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">push_data</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">head</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ISR è¯»å–</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ISR</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tail</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">head</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">process_data</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">tail</span><span class="p">]);</span>
<span class="w">        </span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tail</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<hr />
<h3 id="_9">âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>volatile å…³é”®å­—</strong>ï¼šé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–å°†å˜é‡ç¼“å­˜åˆ°å¯„å­˜å™¨ï¼Œç¡®ä¿æ¯æ¬¡è®¿é—®å†…å­˜ã€‚
   <div class="highlight"><pre><span></span><code><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shared_var</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¿…é¡»æ·»åŠ ï¼</span>
</code></pre></div></li>
<li><strong>ä¸´ç•ŒåŒºé•¿åº¦</strong>ï¼šå…³é—­ä¸­æ–­çš„æ—¶é—´å¿…é¡»æçŸ­ï¼Œå¦‚æ‰§è¡Œç®€å•ç®—æœ¯æˆ–ä½æ“ä½œã€‚</li>
<li><strong>åµŒå¥—ä¸­æ–­å¤„ç†</strong>ï¼šè‹¥å…è®¸ä¸­æ–­åµŒå¥—ï¼Œéœ€åœ¨ ISR å†…ä¹Ÿä¿æŠ¤å…±äº«èµ„æºã€‚</li>
</ol>
<hr />
<h3 id="_10">ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…³é—­ä¸­æ–­</td>
<td>ç®€å•å¯é ï¼Œé€šç”¨æ€§å¼º</td>
<td>å½±å“ä¸­æ–­å“åº”å»¶è¿Ÿ</td>
<td>çŸ­ä¸´ç•ŒåŒºæ“ä½œ</td>
</tr>
<tr>
<td>åŸå­æ“ä½œ</td>
<td>æ— é”ï¼Œä¸å½±å“ä¸­æ–­å“åº”</td>
<td>ä¾èµ–ç‰¹å®š CPU æŒ‡ä»¤</td>
<td>ç®€å•è¯»-æ”¹-å†™æ“ä½œ</td>
</tr>
<tr>
<td>æ— é”è®¾è®¡</td>
<td>é¿å…ç«äº‰ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§</td>
<td>è®¾è®¡å¤æ‚åº¦é«˜ï¼Œå†…å­˜å ç”¨å¤§</td>
<td>é«˜é¢‘æ•°æ®ä¼ é€’åœºæ™¯</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="_11">ğŸŒŸ æ€»ç»“</h3>
<p>åœ¨å•æ ¸è£¸æœºç³»ç»Ÿä¸­ï¼Œ<strong>å…³é—­ä¸­æ–­æ˜¯æœ€ç›´æ¥æœ‰æ•ˆçš„äº’æ–¥æ‰‹æ®µ</strong>ï¼Œä½†éœ€ä¸¥æ ¼é™åˆ¶ä¸´ç•ŒåŒºé•¿åº¦ã€‚ç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©åŸå­æ“ä½œæˆ–æ— é”è®¾è®¡ï¼Œå¯è¿›ä¸€æ­¥æå‡ç³»ç»Ÿæ•ˆç‡å’Œå¯é æ€§ã€‚</p>
</li>
<li>
<p><strong>æ™ºèƒ½æŒ‡é’ˆç®€è¿°</strong></p>
<p>åœ¨C++ä¸­ï¼Œæ™ºèƒ½æŒ‡é’ˆæ˜¯ç”¨äºè‡ªåŠ¨åŒ–èµ„æºç®¡ç†ï¼ˆç‰¹åˆ«æ˜¯åŠ¨æ€å†…å­˜ï¼‰çš„å·¥å…·ï¼ŒåŸºäº<strong>RAIIï¼ˆResource Acquisition Is Initializationï¼‰</strong>åŸåˆ™ï¼Œç¡®ä¿èµ„æºåœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼å’Œèµ„æºæ³„éœ²ã€‚</p>
<hr />
<h3 id="1_2"><strong>1. æ™ºèƒ½æŒ‡é’ˆçš„æ ¸å¿ƒç›®çš„</strong></h3>
<p>â€¢ <strong>è‡ªåŠ¨åŒ–ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šé€šè¿‡å¯¹è±¡çš„ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œå‡å°‘æ‰‹åŠ¨<code>delete</code>å¯¼è‡´çš„æ³„æ¼é£é™©ã€‚
â€¢ <strong>æ‰€æœ‰æƒè¯­ä¹‰æ˜ç¡®åŒ–</strong>ï¼šæ¸…æ™°è¡¨è¾¾èµ„æºçš„æ‰€æœ‰æƒå½’å±ï¼ˆç‹¬å ã€å…±äº«ã€æ— æ‰€æœ‰æƒç­‰ï¼‰ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚
â€¢ <strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šå³ä½¿åœ¨å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œæ™ºèƒ½æŒ‡é’ˆä»èƒ½æ­£ç¡®é‡Šæ”¾èµ„æºï¼Œé¿å…ä¼ ç»ŸæŒ‡é’ˆçš„èµ„æºæ³„æ¼é—®é¢˜ã€‚</p>
<hr />
<h3 id="2-c"><strong>2. C++æ ‡å‡†åº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹</strong></h3>
<h4 id="1-stdunique_ptr"><strong>(1) <code>std::unique_ptr</code></strong></h4>
<p>â€¢ <strong>æ‰€æœ‰æƒæ¨¡å‹</strong>ï¼šç‹¬å æ‰€æœ‰æƒï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ª<code>unique_ptr</code>æŒ‡å‘èµ„æºï¼Œç¦æ­¢æ‹·è´ï¼ˆå…è®¸ç§»åŠ¨è¯­ä¹‰è½¬ç§»æ‰€æœ‰æƒï¼‰ã€‚
â€¢ <strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š
  â€¢ ç®¡ç†å±€éƒ¨åŠ¨æ€å¯¹è±¡ï¼ˆæ›¿ä»£<code>auto_ptr</code>ï¼ŒC++11èµ·æ›´å®‰å…¨ï¼‰ã€‚
  â€¢ ä½œä¸ºå·¥å‚å‡½æ•°çš„è¿”å›å€¼ï¼Œæ˜ç¡®ä¼ é€’æ‰€æœ‰æƒã€‚
â€¢ <strong>ç¤ºä¾‹ä¸ç‰¹æ€§</strong>ï¼š</p>
<p><div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä¼˜å…ˆä½¿ç”¨make_uniqueï¼ˆC++14èµ·ï¼‰</span>
<span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span><span class="w"> </span><span class="c1">// æ‰€æœ‰æƒè½¬ç§»</span>
</code></pre></div>
â€¢ <strong>æ€§èƒ½</strong>ï¼šå‡ ä¹æ— é¢å¤–å¼€é”€ï¼Œä¸è£¸æŒ‡é’ˆç›¸å½“ã€‚</p>
<h4 id="2-stdshared_ptr"><strong>(2) <code>std::shared_ptr</code></strong></h4>
<p>â€¢ <strong>æ‰€æœ‰æƒæ¨¡å‹</strong>ï¼šå…±äº«æ‰€æœ‰æƒï¼Œé€šè¿‡å¼•ç”¨è®¡æ•°ç®¡ç†èµ„æºï¼Œå½“æœ€åä¸€ä¸ª<code>shared_ptr</code>ç¦»å¼€ä½œç”¨åŸŸæ—¶é‡Šæ”¾èµ„æºã€‚
â€¢ <strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š
  â€¢ å¤šä¸ªå¯¹è±¡éœ€å…±äº«åŒä¸€èµ„æºçš„æ‰€æœ‰æƒã€‚
  â€¢ éœ€è¦å°†æŒ‡é’ˆå­˜å…¥å®¹å™¨ä¸”æ— æ³•ç¡®å®šç”Ÿå‘½å‘¨æœŸæ—¶ã€‚
â€¢ <strong>æ½œåœ¨é—®é¢˜</strong>ï¼š
  â€¢ <strong>å¾ªç¯å¼•ç”¨</strong>ï¼šè‹¥ä¸¤ä¸ª<code>shared_ptr</code>äº’ç›¸å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°æ— æ³•å½’é›¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆéœ€ç»“åˆ<code>weak_ptr</code>è§£å†³ï¼‰ã€‚
â€¢ <strong>ç¤ºä¾‹ä¸ä¼˜åŒ–</strong>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="c1">// ä¸€æ¬¡åˆ†é…å¯¹è±¡å’Œå¼•ç”¨è®¡æ•°å—ï¼ˆæ›´é«˜æ•ˆï¼‰</span>
<span class="k">auto</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// å¼•ç”¨è®¡æ•°+1</span>
</code></pre></div>
<h4 id="3-stdweak_ptr"><strong>(3) <code>std::weak_ptr</code></strong></h4>
<p>â€¢ <strong>æ‰€æœ‰æƒæ¨¡å‹</strong>ï¼šæ— æ‰€æœ‰æƒï¼Œä½œä¸º<code>shared_ptr</code>çš„è§‚å¯Ÿè€…ï¼Œä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚
â€¢ <strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š
  â€¢ æ‰“ç ´<code>shared_ptr</code>çš„å¾ªç¯å¼•ç”¨ï¼ˆå¦‚åŒå‘é“¾è¡¨ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼‰ã€‚
  â€¢ ä¸´æ—¶æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ï¼ˆé€šè¿‡<code>lock()</code>è·å–ä¸´æ—¶<code>shared_ptr</code>ï¼‰ã€‚
â€¢ <strong>ç¤ºä¾‹</strong>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">w_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shared_ptr</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">s_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_ptr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// å®‰å…¨è®¿é—®èµ„æº</span>
<span class="w">    </span><span class="c1">// ä½¿ç”¨s_ptr</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="4-stdauto_ptr"><strong>(4) <code>std::auto_ptr</code>ï¼ˆå·²å¼ƒç”¨ï¼‰</strong></h4>
<p>â€¢ <strong>å†å²èƒŒæ™¯</strong>ï¼šC++98å¼•å…¥ï¼Œå°è¯•å®ç°ç‹¬å æ‰€æœ‰æƒï¼Œä½†å­˜åœ¨æ‹·è´è¯­ä¹‰ä¸æ˜ç¡®ï¼ˆéšå¼æ‰€æœ‰æƒè½¬ç§»ï¼‰ç­‰é—®é¢˜ï¼ŒC++11èµ·è¢«<code>unique_ptr</code>æ›¿ä»£ã€‚</p>
<hr />
<h3 id="3_2"><strong>3. æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</strong></h3>
<p>â€¢ <strong>ä¼˜å…ˆé€‰æ‹©<code>unique_ptr</code></strong>ï¼šé»˜è®¤ä½¿ç”¨ç‹¬å æ‰€æœ‰æƒï¼Œå‡å°‘å¼•ç”¨è®¡æ•°å¼€é”€å’Œé€»è¾‘å¤æ‚åº¦ã€‚
â€¢ <strong>æ…ç”¨<code>shared_ptr</code></strong>ï¼šä»…åœ¨æ˜ç¡®éœ€è¦å…±äº«æ‰€æœ‰æƒæ—¶ä½¿ç”¨ï¼Œé¿å…æ— è°“çš„æ€§èƒ½æŸè€—ã€‚
â€¢ <strong>ç»“åˆ<code>weak_ptr</code>è§£å†³å¾ªç¯å¼•ç”¨</strong>ï¼šåœ¨è®¾è®¡åŒå‘ä¾èµ–æˆ–ç¼“å­˜ç­‰åœºæ™¯æ—¶é¢„å…ˆè§„é¿é—®é¢˜ã€‚
â€¢ <strong>ä½¿ç”¨<code>make_shared</code>å’Œ<code>make_unique</code></strong>ï¼š
  â€¢ æå‡æ€§èƒ½ï¼ˆå‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°ï¼‰ã€‚
  â€¢ ä¿è¯å¼‚å¸¸å®‰å…¨ï¼ˆä¾‹å¦‚ï¼Œé¿å…å› æ„é€ å‡½æ•°å¼‚å¸¸å¯¼è‡´æ³„æ¼ï¼‰ã€‚
â€¢ <strong>é¿å…è£¸æŒ‡é’ˆå’Œ<code>delete</code></strong>ï¼šä»…åœ¨ä¸é—ç•™ä»£ç äº¤äº’æ—¶ä½¿ç”¨<code>.get()</code>æˆ–<code>.release()</code>ï¼Œå¹¶ç¡®ä¿ç«‹å³ä¼ é€’æ‰€æœ‰æƒã€‚</p>
<hr />
<h3 id="4"><strong>4. ç¤ºä¾‹ï¼šå¾ªç¯å¼•ç”¨ä¸è§£å†³æ–¹æ¡ˆ</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span><span class="w"> </span><span class="c1">// ä½¿ç”¨weak_ptræ‰“ç ´å¾ªç¯</span>
<span class="p">};</span>

<span class="k">auto</span><span class="w"> </span><span class="n">node1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">node1</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node2</span><span class="p">;</span>
<span class="n">node2</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node1</span><span class="p">;</span><span class="w"> </span><span class="c1">// ä¸ä¼šå¢åŠ node1çš„å¼•ç”¨è®¡æ•°</span>
</code></pre></div>
<hr />
<h3 id="5_1"><strong>5. æ€»ç»“</strong></h3>
<p>æ™ºèƒ½æŒ‡é’ˆé€šè¿‡æ˜ç¡®çš„è¯­ä¹‰å’Œè‡ªåŠ¨åŒ–ç®¡ç†ï¼Œæ˜¾è‘—æå‡äº†C++ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ç†è§£æ¯ç§æŒ‡é’ˆçš„æ‰€æœ‰æƒæ¨¡å‹åŠé€‚ç”¨åœºæ™¯ï¼Œç»“åˆæœ€ä½³å®è·µï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…å¸¸è§é™·é˜±ï¼ˆå¦‚æ³„æ¼ã€å¾ªç¯å¼•ç”¨ï¼‰ï¼Œç¼–å†™å‡ºé«˜æ•ˆå¯é çš„èµ„æºç®¡ç†ä»£ç ã€‚</p>
<hr />
<p><strong>è¿™æ ·å›ç­”çš„ä¼˜åŠ¿</strong>ï¼š
â€¢ è¦†ç›–äº†æ ¸å¿ƒæ¦‚å¿µï¼ˆRAIIã€æ‰€æœ‰æƒæ¨¡å‹ï¼‰ã€å…·ä½“ç±»å‹ã€ä½¿ç”¨åœºæ™¯åŠé™·é˜±ã€‚
â€¢ ç»“åˆä»£ç ç¤ºä¾‹å’Œæ€§èƒ½è€ƒé‡ï¼Œå±•ç°å®è·µç»éªŒã€‚
â€¢ å¼ºè°ƒæœ€ä½³å®è·µï¼Œä½“ç°å¯¹é«˜è´¨é‡ä»£ç çš„è¿½æ±‚ã€‚
â€¢ å¯¹æ¯”æ–°æ—§ç‰¹æ€§ï¼ˆå¦‚<code>auto_ptr</code> vs <code>unique_ptr</code>ï¼‰ï¼Œå±•ç¤ºå¯¹è¯­è¨€æ¼”è¿›çš„äº†è§£ã€‚</p>
</li>
<li>
<p><strong>æ™ºèƒ½æŒ‡é’ˆå®ç°åŸç†</strong></p>
<p>æ™ºèƒ½æŒ‡é’ˆçš„å®ç°åŸºäºRAIIåŸåˆ™ï¼Œé€šè¿‡æ„é€ å‡½æ•°å’Œææ„å‡½æ•°è‡ªåŠ¨ç®¡ç†èµ„æºã€‚ä»¥ä¸‹æ˜¯C++æ ‡å‡†åº“ä¸­ä¸»è¦æ™ºèƒ½æŒ‡é’ˆçš„å®ç°åŸç†ï¼š</p>
<ol>
<li><code>std::unique_ptr</code> çš„å®ç°åŸç†<ul>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘èµ„æºçš„è£¸æŒ‡é’ˆã€‚</li>
<li><strong>æ„é€ ä¸ææ„</strong>ï¼š<ul>
<li>æ„é€ å‡½æ•°åˆå§‹åŒ–è£¸æŒ‡é’ˆï¼ŒæŒ‡å‘åŠ¨æ€åˆ†é…çš„èµ„æºã€‚</li>
<li>ææ„å‡½æ•°è°ƒç”¨<code>delete</code>é‡Šæ”¾èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ul>
</li>
<li><strong>ç§»åŠ¨è¯­ä¹‰</strong>ï¼šé€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦è½¬ç§»æ‰€æœ‰æƒï¼Œå…è®¸èµ„æºåœ¨ä¸åŒ<code>unique_ptr</code>é—´è½¬ç§»ï¼Œä½†æºæŒ‡é’ˆä¸å†æ‹¥æœ‰èµ„æºã€‚</li>
<li><strong>ç¦æ­¢æ‹·è´</strong>ï¼šæ— æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç¡®ä¿ç‹¬å æ‰€æœ‰æƒã€‚</li>
</ul>
</li>
<li><code>std::shared_ptr</code> çš„å®ç°åŸç†<ul>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šé™¤ç»´æŠ¤èµ„æºæŒ‡é’ˆå¤–ï¼Œè¿˜ç»´æŠ¤ä¸€ä¸ªæ§åˆ¶å—ï¼Œå­˜å‚¨å¼•ç”¨è®¡æ•°ï¼ˆå…±äº«å’Œå¼±å¼•ç”¨è®¡æ•°ï¼‰åŠèµ„æºåˆ é™¤å‡½æ•°ç­‰ä¿¡æ¯ã€‚</li>
<li><strong>æ„é€ ä¸ææ„</strong>ï¼š<ul>
<li>æ„é€ å‡½æ•°åˆå§‹åŒ–èµ„æºæŒ‡é’ˆå’Œæ§åˆ¶å—ï¼Œå¼•ç”¨è®¡æ•°ç½®ä¸º1ã€‚</li>
<li>ææ„å‡½æ•°å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œè®¡æ•°å½’é›¶æ—¶é‡Šæ”¾èµ„æºã€‚</li>
</ul>
</li>
<li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šæ‹·è´æ„é€ å’Œèµ‹å€¼è¿ç®—ç¬¦å¢åŠ è®¡æ•°ï¼Œææ„å’Œé‡ç½®å‡å°‘è®¡æ•°ï¼Œå®ç°å…±äº«æ‰€æœ‰æƒã€‚</li>
<li><strong>è‡ªå®šä¹‰åˆ é™¤å™¨</strong>ï¼šæ”¯æŒç»‘å®šè‡ªå®šä¹‰å‡½æ•°æˆ– Lambda è¡¨è¾¾å¼ä½œä¸ºåˆ é™¤å™¨ï¼Œçµæ´»ç®¡ç†èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><code>std::weak_ptr</code> çš„å®ç°åŸç†<ul>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘<code>shared_ptr</code>æ§åˆ¶å—çš„æŒ‡é’ˆï¼Œä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚</li>
<li><strong>æ„é€ ä¸ææ„</strong>ï¼š<ul>
<li>æ„é€ å‡½æ•°å…³è”<code>shared_ptr</code>çš„æ§åˆ¶å—ã€‚</li>
<li>ææ„å‡½æ•°æ— ç‰¹æ®Šæ“ä½œï¼Œä»…é‡Šæ”¾å†…éƒ¨æŒ‡é’ˆã€‚</li>
</ul>
</li>
<li><strong><code>lock()</code> æ–¹æ³•</strong>ï¼šç”Ÿæˆä¸´æ—¶<code>shared_ptr</code>ï¼Œå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå®‰å…¨è®¿é—®èµ„æºï¼›è‹¥èµ„æºå·²é‡Šæ”¾ï¼Œè¿”å›ç©º<code>shared_ptr</code>ã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šä½œä¸ºè§‚å¯Ÿè€…ï¼Œé¿å…å¾ªç¯å¼•ç”¨ï¼Œå»¶è¿Ÿèµ„æºè®¿é—®ï¼Œç®¡ç†ç¼“å­˜æ•°æ®ç­‰ã€‚</li>
</ul>
</li>
</ol>
<blockquote>
<hr />
<h3 id="1_3"><strong>1. æ ¸å¿ƒæ€æƒ³ï¼šè‡ªåŠ¨ç®¡å®¶</strong></h3>
<p>æƒ³è±¡ä½ å…»äº†ä¸€åªå® ç‰©ç‹—ï¼Œæ¯æ¬¡å¸¦å®ƒå‡ºé—¨éƒ½è¦ç‰µç»³ï¼Œå›å®¶åè¦è®°å¾—å…³é—¨ï¼Œå¦åˆ™å®ƒä¼šè·‘ä¸¢ã€‚ä¼ ç»ŸæŒ‡é’ˆå°±åƒä½ æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨å…³é—¨ï¼Œä¸€æ—¦å¿˜è®°ï¼ˆå¿˜è®°<code>delete</code>ï¼‰ï¼Œç‹—å°±ä¼šè·‘ä¸¢ï¼ˆå†…å­˜æ³„æ¼ï¼‰ã€‚è€Œæ™ºèƒ½æŒ‡é’ˆå°±åƒä¸€ä¸ªè‡ªåŠ¨ç®¡å®¶ï¼Œåªè¦ç‹—ç‹—è¿›äº†å®¶é—¨ï¼ˆåˆ›å»ºå¯¹è±¡ï¼‰ï¼Œç®¡å®¶å°±ä¼šè®°ä½ï¼Œå¹¶åœ¨ä½ ä¸éœ€è¦å®ƒæ—¶ï¼ˆç¦»å¼€ä½œç”¨åŸŸï¼‰<strong>è‡ªåŠ¨å…³é—¨</strong>ï¼ˆé‡Šæ”¾å†…å­˜ï¼‰ã€‚</p>
<hr />
<h3 id="2-unique_ptr"><strong>2. æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼š<code>unique_ptr</code></strong></h3>
<h4 id="_12"><strong>å®ç°åŸç†</strong></h4>
<ul>
<li><strong>ç»“æ„</strong>ï¼šå®ƒå†…éƒ¨æœ‰ä¸€ä¸ªâ€œå°ç›’å­â€ï¼ˆæˆå‘˜å˜é‡ï¼‰ä¿å­˜åŸå§‹æŒ‡é’ˆã€‚</li>
<li><strong>ç‹¬å æ€§</strong>ï¼šè¿™ä¸ªç›’å­åªèƒ½æœ‰ä¸€ä¸ªä¸»äººï¼Œä¸å…è®¸å¤åˆ¶ï¼ˆæ‹·è´æ„é€ å‡½æ•°è¢«åˆ é™¤ï¼‰ã€‚</li>
<li><strong>ç§»åŠ¨</strong>ï¼šä½†ä½ å¯ä»¥æŠŠç›’å­æ•´ä¸ªâ€œæ¬â€ç»™å¦ä¸€ä¸ªä¸»äººï¼ˆç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚</li>
<li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šå½“ä¸»äººæ¶ˆå¤±ï¼ˆä½œç”¨åŸŸç»“æŸï¼‰æ—¶ï¼Œç®¡å®¶è‡ªåŠ¨æ‰“å¼€ç›’å­ï¼Œæ¸…ç†é‡Œé¢çš„æŒ‡é’ˆï¼ˆè°ƒç”¨<code>delete</code>ï¼‰ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleUniquePtr</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// å°ç›’å­é‡Œå­˜ç€åŸå§‹æŒ‡é’ˆ</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SimpleUniquePtr</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// åˆ›å»ºæ—¶æ¥ç®¡æŒ‡é’ˆ</span>
<span class="w">    </span><span class="o">~</span><span class="n">SimpleUniquePtr</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">     </span><span class="c1">// ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾</span>

<span class="w">    </span><span class="c1">// ç¦æ­¢æ‹·è´ï¼ˆå…³é”®ï¼ï¼‰</span>
<span class="w">    </span><span class="n">SimpleUniquePtr</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SimpleUniquePtr</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<span class="w">    </span><span class="n">SimpleUniquePtr</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SimpleUniquePtr</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// å…è®¸ç§»åŠ¨ï¼ˆæ¬åŠ¨ç›’å­ï¼‰</span>
<span class="w">    </span><span class="n">SimpleUniquePtr</span><span class="p">(</span><span class="n">SimpleUniquePtr</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">raw_ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">other</span><span class="p">.</span><span class="n">raw_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// åŸä¸»äººä¸å†æ‹¥æœ‰æŒ‡é’ˆ</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="_13"><strong>ä½¿ç”¨ç¤ºä¾‹</strong></h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">SimpleUniquePtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span><span class="w"> </span><span class="c1">// åˆ›å»ºï¼Œç®¡å®¶è®°ä½æŒ‡é’ˆ</span>
<span class="w">    </span><span class="c1">// ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œdeleteé‡Šæ”¾å†…å­˜</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="3-shared_ptr"><strong>3. å…±äº«å‹æ™ºèƒ½æŒ‡é’ˆï¼š<code>shared_ptr</code></strong></h3>
<h4 id="_14"><strong>å®ç°åŸç†</strong></h4>
<ul>
<li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šç®¡å®¶å‡†å¤‡äº†ä¸€ä¸ªâ€œè®¡æ•°å™¨â€ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ï¼Œè®°å½•æœ‰å¤šå°‘äººåœ¨ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚</li>
<li><strong>å…±äº«æ‰€æœ‰æƒ</strong>ï¼šæ¯æ¬¡å¤åˆ¶<code>shared_ptr</code>æ—¶ï¼Œè®¡æ•°å™¨+1ï¼›æ¯æ¬¡é”€æ¯æ—¶ï¼Œè®¡æ•°å™¨-1ã€‚</li>
<li><strong>è‡ªåŠ¨é‡Šæ”¾</strong>ï¼šå½“è®¡æ•°å™¨å½’é›¶æ—¶ï¼Œç®¡å®¶æ¸…ç†æŒ‡é’ˆã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleSharedPtr</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ref_count</span><span class="p">;</span><span class="w"> </span><span class="c1">// å¼•ç”¨è®¡æ•°å™¨ï¼ˆæŒ‡é’ˆå½¢å¼ï¼Œå¤šä¸ªshared_ptrå…±äº«ï¼‰</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SimpleSharedPtr</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">),</span><span class="w"> </span><span class="n">ref_count</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// æ‹·è´æ„é€ å‡½æ•°ï¼šè®¡æ•°å™¨+1</span>
<span class="w">    </span><span class="n">SimpleSharedPtr</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SimpleSharedPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">raw_ptr</span><span class="p">),</span><span class="w"> </span><span class="n">ref_count</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">ref_count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="o">*</span><span class="n">ref_count</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ææ„å‡½æ•°ï¼šè®¡æ•°å™¨-1ï¼Œå½’é›¶æ—¶é‡Šæ”¾</span>
<span class="w">    </span><span class="o">~</span><span class="n">SimpleSharedPtr</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="o">*</span><span class="n">ref_count</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ref_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">delete</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">;</span>
<span class="w">            </span><span class="k">delete</span><span class="w"> </span><span class="n">ref_count</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="_15"><strong>ä½¿ç”¨ç¤ºä¾‹</strong></h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">SimpleSharedPtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span><span class="w"> </span><span class="c1">// è®¡æ•°å™¨=1</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">SimpleSharedPtr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr1</span><span class="p">;</span><span class="w"> </span><span class="c1">// è®¡æ•°å™¨=2</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// ptr2ææ„ï¼Œè®¡æ•°å™¨=1</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// ptr1ææ„ï¼Œè®¡æ•°å™¨=0ï¼Œè‡ªåŠ¨é‡Šæ”¾å†…å­˜</span>
</code></pre></div>
<hr />
<h3 id="4-weak_ptr"><strong>4. è¾…åŠ©å‹æ™ºèƒ½æŒ‡é’ˆï¼š<code>weak_ptr</code></strong></h3>
<h4 id="_16"><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong></h4>
<ul>
<li><strong>å¾ªç¯å¼•ç”¨é—®é¢˜</strong>ï¼šæ¯”å¦‚ä¸¤äººäº’ç›¸è¯´â€œä½ å…ˆæŒ‚ç”µè¯ï¼Œæˆ‘å†æŒ‚â€ï¼Œç»“æœæ°¸è¿œæŒ‚ä¸æ–­ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<code>weak_ptr</code>åƒæ˜¯ä¸€ä¸ªâ€œè§‚å¯Ÿå‘˜â€ï¼Œä¸å‚ä¸è®¡æ•°ï¼Œåªè§‚å¯Ÿèµ„æºæ˜¯å¦å­˜åœ¨ã€‚</li>
</ul>
<h4 id="_17"><strong>å®ç°åŸç†</strong></h4>
<ul>
<li><strong>ä¸æŒæœ‰è®¡æ•°å™¨</strong>ï¼š<code>weak_ptr</code>å†…éƒ¨ä¿å­˜æŒ‡é’ˆï¼Œä½†ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚</li>
<li><strong>æ£€æŸ¥æœ‰æ•ˆæ€§</strong>ï¼šé€šè¿‡<code>lock()</code>æ–¹æ³•ï¼Œå¯ä»¥ä¸´æ—¶è·å–ä¸€ä¸ª<code>shared_ptr</code>æ¥ä½¿ç”¨èµ„æºï¼ˆå¦‚æœèµ„æºè¿˜å­˜åœ¨ï¼‰ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleWeakPtr</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ref_count</span><span class="p">;</span><span class="w"> </span><span class="c1">// æŒ‡å‘shared_ptrçš„è®¡æ•°å™¨</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SimpleWeakPtr</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SimpleSharedPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">shared</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">raw_ptr</span><span class="p">(</span><span class="n">shared</span><span class="p">.</span><span class="n">raw_ptr</span><span class="p">),</span><span class="w"> </span><span class="n">ref_count</span><span class="p">(</span><span class="n">shared</span><span class="p">.</span><span class="n">ref_count</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// å°è¯•è·å–ä¸´æ—¶shared_ptr</span>
<span class="w">    </span><span class="n">SimpleSharedPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">ref_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">SimpleSharedPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">raw_ptr</span><span class="p">);</span><span class="w"> </span><span class="c1">// è¿™é‡Œéœ€è¦æ›´å¤æ‚çš„å®ç°</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<hr />
<h3 id="5_2"><strong>5. æ™ºèƒ½æŒ‡é’ˆçš„â€œé«˜æ•ˆç§˜è¯€â€</strong></h3>
<ul>
<li><strong><code>make_shared</code>å’Œ<code>make_unique</code></strong>ï¼šç›´æ¥ç”³è¯·ä¸€å—å¤§å†…å­˜ï¼ŒåŒæ—¶å­˜æ”¾å¯¹è±¡å’Œå¼•ç”¨è®¡æ•°ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ï¼Œæé«˜é€Ÿåº¦ã€‚</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šå¦‚æœä½¿ç”¨<code>new</code>åå†ä¼ ç»™æ™ºèƒ½æŒ‡é’ˆï¼Œä¸­é—´å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚è€Œ<code>make_</code>ç³»åˆ—å‡½æ•°ä¸€æ­¥åˆ°ä½ï¼Œæœç»è¿™ä¸ªé—®é¢˜ã€‚</li>
</ul>
<hr />
<h3 id="_18"><strong>æ€»ç»“ï¼šæ™ºèƒ½æŒ‡é’ˆå¦‚ä½•å¸®ä½ çœå¿ƒï¼Ÿ</strong></h3>
<ul>
<li><strong><code>unique_ptr</code></strong>ï¼šç‹¬å±…ç®¡å®¶ï¼ŒåªæœåŠ¡ä¸€ä¸ªä¸»äººï¼Œæ¬å®¶æ—¶å½»åº•äº¤æ¥ã€‚</li>
<li><strong><code>shared_ptr</code></strong>ï¼šåˆç§Ÿç®¡å®¶ï¼Œè®°å½•æ‰€æœ‰ç§Ÿå®¢æ•°é‡ï¼Œæœ€åä¸€ä¸ªç¦»å¼€æ—¶æ‰“æ‰«æˆ¿é—´ã€‚</li>
<li><strong><code>weak_ptr</code></strong>ï¼šä¸ç§Ÿæˆ¿åªæ•²é—¨ï¼Œç¡®è®¤æœ‰äººä½æ‰ä¸´æ—¶è®¿é—®ã€‚</li>
</ul>
<p>ç†è§£äº†è¿™äº›ï¼Œä½ å°±æŒæ¡äº†æ™ºèƒ½æŒ‡é’ˆçš„æ ¸å¿ƒï¼å®é™…ä½¿ç”¨ä¸­ï¼Œ99%çš„æƒ…å†µåªéœ€è®°ä½ï¼š
- é»˜è®¤ç”¨<code>unique_ptr</code>ï¼Œç®€å•é«˜æ•ˆã€‚
- éœ€è¦å…±äº«æ—¶ç”¨<code>shared_ptr</code>ï¼Œä½†è¦å°å¿ƒå¾ªç¯å¼•ç”¨ã€‚
- é‡åˆ°å¾ªç¯å¼•ç”¨æ—¶ï¼Œç”¨<code>weak_ptr</code>ç ´å±€ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>æŒ‡é’ˆå’Œå¼•ç”¨</strong></p>
<p>åœ¨C++ä¸­ï¼ŒæŒ‡é’ˆï¼ˆPointerï¼‰å’Œå¼•ç”¨ï¼ˆReferenceï¼‰éƒ½æ˜¯ç”¨äºé—´æ¥è®¿é—®å†…å­˜å¯¹è±¡çš„æœºåˆ¶ï¼Œä½†å®ƒä»¬åœ¨è¯­æ³•ã€è¯­ä¹‰å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰æœ¬è´¨åŒºåˆ«ã€‚</p>
<hr />
<h3 id="1_4"><strong>1. æœ¬è´¨å®šä¹‰</strong></h3>
<ul>
<li><strong>æŒ‡é’ˆ</strong>ï¼šå­˜å‚¨å†…å­˜åœ°å€çš„å˜é‡ç±»å‹ï¼ˆ32ä½ç³»ç»Ÿå 4å­—èŠ‚ï¼Œ64ä½å 8å­—èŠ‚ï¼‰</li>
<li><strong>å¼•ç”¨</strong>ï¼šå·²å­˜åœ¨å¯¹è±¡çš„åˆ«åï¼ˆç¼–è¯‘å™¨ç¬¦å·è¡¨å®ç°ï¼Œæ— ç‹¬ç«‹å†…å­˜ç©ºé—´ï¼‰</li>
</ul>
<hr />
<h3 id="2_1"><strong>2. æ ¸å¿ƒå·®å¼‚</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æŒ‡é’ˆ</th>
<th>å¼•ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç©ºå€¼</strong></td>
<td>å¯ä»¥èµ‹å€¼ä¸º<code>nullptr</code></td>
<td>å¿…é¡»ç»‘å®šæœ‰æ•ˆå¯¹è±¡ï¼ˆä¸å¯ä¸ºç©ºï¼‰</td>
</tr>
<tr>
<td><strong>é‡æ–°ç»‘å®š</strong></td>
<td>å¯ä¿®æ”¹æŒ‡å‘ä¸åŒå¯¹è±¡</td>
<td>åˆå§‹åŒ–åç»ˆèº«ç»‘å®šå›ºå®šå¯¹è±¡</td>
</tr>
<tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td>ç‹¬ç«‹å­˜å‚¨åœ°å€çš„å˜é‡</td>
<td>ç¼–è¯‘å™¨å®ç°çš„è¯­æ³•åˆ«åï¼ˆé›¶å¼€é”€ï¼‰</td>
</tr>
<tr>
<td><strong>å¤šçº§é—´æ¥è®¿é—®</strong></td>
<td>æ”¯æŒå¤šçº§æŒ‡é’ˆï¼ˆ<code>int** p</code>ï¼‰</td>
<td>ä»…ä¸€çº§å¼•ç”¨</td>
</tr>
<tr>
<td><strong>æ“ä½œæ–¹å¼</strong></td>
<td><code>-&gt;</code>å’Œ<code>*</code>æ“ä½œç¬¦è®¿é—®å¯¹è±¡</td>
<td>ç›´æ¥ä½¿ç”¨åŸå¯¹è±¡è¯­æ³•</td>
</tr>
<tr>
<td><strong>å‚æ•°ä¼ é€’è¯­ä¹‰</strong></td>
<td>å€¼ä¼ é€’ï¼ˆéœ€è§£å¼•ç”¨ä¿®æ”¹åŸå¯¹è±¡ï¼‰</td>
<td>ç›´æ¥ä¼ é€’åŸå¯¹è±¡åˆ«å</td>
</tr>
<tr>
<td><strong>æ•°ç»„æ”¯æŒ</strong></td>
<td>æ”¯æŒæŒ‡é’ˆç®—æœ¯è¿ç®—</td>
<td>ä¸å¯ç›´æ¥è¡¨ç¤ºå¼•ç”¨æ•°ç»„</td>
</tr>
<tr>
<td><strong>sizeofç»“æœ</strong></td>
<td>è¿”å›æŒ‡é’ˆå¤§å°</td>
<td>è¿”å›è¢«å¼•ç”¨å¯¹è±¡å¤§å°</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="3_3"><strong>3. åº•å±‚å®ç°å¯¹æ¯”</strong></h3>
<ul>
<li><strong>æŒ‡é’ˆ</strong>ï¼šæ˜¾å¼å­˜å‚¨ç›®æ ‡åœ°å€ï¼Œè®¿é—®éœ€è¦æ˜¾å¼è§£å¼•ç”¨
  <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w">  </span><span class="c1">// å†…å­˜ä¸­å­˜å‚¨0x7ffd34a2bc1cä¹‹ç±»çš„åœ°å€</span>
</code></pre></div></li>
<li><strong>å¼•ç”¨</strong>ï¼šç¼–è¯‘å™¨ç»´æŠ¤çš„ç¬¦å·æ˜ å°„ï¼ˆæ±‡ç¼–çº§ä¸æŒ‡é’ˆç›¸ä¼¼ï¼Œä½†è¯­æ³•å±‚ä¸åŒï¼‰</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">   </span><span class="c1">// rç›´æ¥æ˜ å°„åˆ°xçš„å†…å­˜ä½ç½®</span>
</code></pre></div>
<hr />
<h3 id="4_1"><strong>4. å…¸å‹ä½¿ç”¨åœºæ™¯</strong></h3>
<ul>
<li><strong>æŒ‡é’ˆé€‚ç”¨åœºæ™¯</strong>ï¼š</li>
<li>åŠ¨æ€å†…å­˜ç®¡ç†ï¼ˆnew/deleteï¼‰</li>
<li>éœ€è¦é‡æ–°æŒ‡å‘ä¸åŒå¯¹è±¡</li>
<li>å¤„ç†å¤šæ€å¯¹è±¡ï¼ˆåŸºç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»ï¼‰</li>
<li>
<p>éœ€è¦è¡¨ç¤º"æ— å¯¹è±¡"çš„ç‰¹æ®ŠçŠ¶æ€ï¼ˆnullptrï¼‰</p>
</li>
<li>
<p><strong>å¼•ç”¨é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
</li>
<li>å‡½æ•°å‚æ•°ä¼ é€’ï¼ˆé¿å…æ‹·è´ï¼Œå¼ºåˆ¶éç©ºï¼‰</li>
<li>è¿ç®—ç¬¦é‡è½½ï¼ˆå¦‚<code>operator=</code>ï¼‰</li>
<li>å‡½æ•°è¿”å›å€¼ï¼ˆè¿”å›å·¦å€¼ï¼‰</li>
<li>å®ç°å®Œç¾è½¬å‘ï¼ˆforwarding referenceï¼‰</li>
</ul>
<hr />
<h3 id="5_3"><strong>5. å…³é”®ä»£ç ç¤ºä¾‹</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// æŒ‡é’ˆç‰¹æ€§æ¼”ç¤º</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">  </span><span class="c1">// æŒ‡å‘a</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">;</span><span class="w">       </span><span class="c1">// åˆæ³•ï¼šæ”¹å˜æŒ‡å‘</span>
<span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w">      </span><span class="c1">// ä¿®æ”¹bçš„å€¼</span>

<span class="c1">// å¼•ç”¨ç‰¹æ€§æ¼”ç¤º</span>
<span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">   </span><span class="c1">// ræ˜¯açš„åˆ«å</span>
<span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span><span class="w">       </span><span class="c1">// ç›´æ¥ä¿®æ”¹açš„å€¼</span>
<span class="c1">// int&amp; null_ref;  // ç¼–è¯‘é”™è¯¯ï¼šå¿…é¡»åˆå§‹åŒ–</span>
<span class="c1">// r = b;         // ä¸æ˜¯æ”¹å˜å¼•ç”¨ç›®æ ‡ï¼Œè€Œæ˜¯å°†bçš„å€¼èµ‹ç»™a</span>
</code></pre></div>
<hr />
<h3 id="6"><strong>6. é«˜çº§æ³¨æ„äº‹é¡¹</strong></h3>
<ol>
<li><strong>å¸¸é‡é™å®š</strong>ï¼š</li>
<li><code>const int*</code> vs <code>int* const</code></li>
<li>
<p><code>const int&amp;</code>å¯ç»‘å®šå­—é¢é‡ï¼ˆ<code>const int&amp; r = 5;</code>åˆæ³•ï¼‰</p>
</li>
<li>
<p><strong>ç±»å‹è½¬æ¢</strong>ï¼š</p>
</li>
<li>æŒ‡é’ˆæ”¯æŒæ˜¾å¼ç±»å‹è½¬æ¢ï¼ˆ<code>reinterpret_cast</code>ç­‰ï¼‰</li>
<li>
<p>å¼•ç”¨è½¬æ¢éœ€è¦<code>static_cast</code>æ˜¾å¼å¤„ç†</p>
</li>
<li>
<p><strong>æ¨¡æ¿å…ƒç¼–ç¨‹</strong>ï¼š</p>
</li>
<li>å¼•ç”¨ç±»å‹ä¼šä¿ç•™ç±»å‹ä¿¡æ¯ï¼ˆå¼•ç”¨æŠ˜å è§„åˆ™ï¼‰</li>
<li>
<p>æŒ‡é’ˆç±»å‹åœ¨æ¨¡æ¿æ¨å¯¼ä¸­è§†ä¸ºæ™®é€šæŒ‡é’ˆç±»å‹</p>
</li>
<li>
<p><strong>å†…å­˜å®‰å…¨</strong>ï¼š</p>
</li>
<li>é‡æŒ‡é’ˆï¼ˆdangling pointerï¼‰æ˜¯å¸¸è§é”™è¯¯ç±»å‹</li>
<li>æ‚¬ç©ºå¼•ç”¨ï¼ˆdangling referenceï¼‰åŒæ ·å±é™©ä½†æ›´éš¾æ£€æµ‹</li>
</ol>
<hr />
<h3 id="7"><strong>7. è®¾è®¡å“²å­¦</strong></h3>
<ul>
<li><strong>æŒ‡é’ˆ</strong>ï¼šæä¾›å¯¹å†…å­˜çš„ç›´æ¥æ“ä½œèƒ½åŠ›ï¼Œä½“ç°C++çš„åº•å±‚æ§åˆ¶ç‰¹æ€§</li>
<li><strong>å¼•ç”¨</strong>ï¼šä½œä¸ºæ›´å®‰å…¨çš„åˆ«åæœºåˆ¶ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼</li>
</ul>
<p>é€‰æ‹©åŸåˆ™ï¼šä¼˜å…ˆä½¿ç”¨å¼•ç”¨ä¿è¯å®‰å…¨æ€§ï¼Œå¿…é¡»éœ€è¦æŒ‡é’ˆç‰¹æ€§æ—¶å†ä½¿ç”¨æŒ‡é’ˆã€‚ç°ä»£C++ä¸­ï¼Œå¼•ç”¨åœ¨å‚æ•°ä¼ é€’ã€è¿”å›å€¼ç­‰åœºæ™¯å·²å–ä»£å¤§éƒ¨åˆ†æŒ‡é’ˆçš„ä¼ ç»Ÿç”¨æ³•ã€‚</p>
</li>
<li>
<p><strong>malloc å’Œ newåŒºåˆ«</strong></p>
<p>åœ¨C++ä¸­ï¼Œ<code>malloc</code>ï¼ˆCåº“å‡½æ•°ï¼‰å’Œ<code>new</code>ï¼ˆC++è¿ç®—ç¬¦ï¼‰éƒ½æ˜¯åŠ¨æ€å†…å­˜åˆ†é…å·¥å…·ï¼Œä½†å®ƒä»¬çš„åº•å±‚æœºåˆ¶ã€è¯­ä¹‰å’Œé€‚ç”¨åœºæ™¯æœ‰æœ¬è´¨åŒºåˆ«ã€‚</p>
<hr />
<h3 id="1_5"><strong>1. è¯­è¨€å½’å±ä¸åº•å±‚æœºåˆ¶</strong></h3>
<table>
<thead>
<tr>
<th><strong>ç‰¹æ€§</strong></th>
<th><code>malloc</code> / <code>free</code></th>
<th><code>new</code> / <code>delete</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¯­è¨€æ ‡å‡†</strong></td>
<td>Cæ ‡å‡†åº“å‡½æ•°</td>
<td>C++è¿ç®—ç¬¦ï¼ˆè¯­è¨€æ ¸å¿ƒç‰¹æ€§ï¼‰</td>
</tr>
<tr>
<td><strong>å†…å­˜åˆ†é…æ–¹å¼</strong></td>
<td>æ˜¾å¼åˆ†é…åŸå§‹å†…å­˜å—</td>
<td>åˆ†é…å†…å­˜å¹¶è°ƒç”¨æ„é€ å‡½æ•°</td>
</tr>
<tr>
<td><strong>å†…å­˜é‡Šæ”¾æ–¹å¼</strong></td>
<td>ç›´æ¥é‡Šæ”¾å†…å­˜</td>
<td>è°ƒç”¨ææ„å‡½æ•°åé‡Šæ”¾å†…å­˜</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2_2"><strong>2. æ ¸å¿ƒå·®å¼‚</strong></h3>
<h4 id="21"><strong>2.1 åˆå§‹åŒ–ä¸å¯¹è±¡æ„é€ </strong></h4>
<ul>
<li><strong><code>malloc</code></strong>ï¼š</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span><span class="w">  </span><span class="c1">// åˆ†é…æœªåˆå§‹åŒ–çš„å†…å­˜</span>
<span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">  </span><span class="c1">// éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–</span>
</code></pre></div>
  - ä»…åˆ†é…åŸå§‹å†…å­˜ï¼Œä¸æ‰§è¡Œå¯¹è±¡æ„é€ 
  - å¯¹éPODï¼ˆPlain Old Dataï¼‰ç±»å‹å¯èƒ½å¼•å‘æœªå®šä¹‰è¡Œä¸º</p>
<ul>
<li><strong><code>new</code></strong>ï¼š
  <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">        </span><span class="c1">// åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–</span>
<span class="n">MyClass</span><span class="o">*</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyClass</span><span class="p">;</span><span class="w">  </span><span class="c1">// è°ƒç”¨æ„é€ å‡½æ•°</span>
</code></pre></div></li>
<li>åˆ†é…å†…å­˜åè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°</li>
<li>ä¿è¯ç±»å‹å®‰å…¨çš„å¯¹è±¡åˆå§‹åŒ–</li>
</ul>
<h4 id="22"><strong>2.2 å¤±è´¥å¤„ç†</strong></h4>
<ul>
<li><strong><code>malloc</code></strong>ï¼šè¿”å›<code>NULL</code>ï¼ˆéœ€æ‰‹åŠ¨æ£€æŸ¥ï¼‰
  <div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* å¤„ç†é”™è¯¯ */</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></li>
<li><strong><code>new</code></strong>ï¼šæŠ›å‡º<code>std::bad_alloc</code>å¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰
  <div class="highlight"><pre><span></span><code><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">10000000000</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">bad_alloc</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¤„ç†å†…å­˜ä¸è¶³</span>
<span class="p">}</span>
</code></pre></div></li>
<li>å¯é€šè¿‡<code>nothrow</code>ç‰ˆæœ¬è¿”å›<code>nullptr</code>ï¼š
    <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nothrow</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</code></pre></div></li>
</ul>
<h4 id="23"><strong>2.3 å†…å­˜å¤§å°è®¡ç®—</strong></h4>
<ul>
<li><strong><code>malloc</code></strong>ï¼šéœ€æ‰‹åŠ¨è®¡ç®—å­—èŠ‚æ•°</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="n">Data</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Data</span><span class="p">));</span>
</code></pre></div>
- <strong><code>new</code></strong>ï¼šè‡ªåŠ¨è®¡ç®—ç±»å‹å¤§å°
  <div class="highlight"><pre><span></span><code><span class="n">Data</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç¼–è¯‘å™¨è‡ªåŠ¨è®¡ç®—sizeof(Data)</span>
</code></pre></div></p>
<hr />
<h3 id="3_4"><strong>3. ç±»å‹å®‰å…¨æ€§</strong></h3>
<table>
<thead>
<tr>
<th><strong>ç‰¹æ€§</strong></th>
<th><code>malloc</code></th>
<th><code>new</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç±»å‹è½¬æ¢</strong></td>
<td>éœ€è¦æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢</td>
<td>è‡ªåŠ¨ç±»å‹æ¨å¯¼</td>
</tr>
<tr>
<td><strong>ç±»å‹æ£€æŸ¥</strong></td>
<td>æ— ï¼ˆå¯èƒ½å› ç±»å‹ä¸åŒ¹é…å¯¼è‡´UBï¼‰</td>
<td>ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1">// mallocéœ€è¦æ˜¾å¼è½¬æ¢</span>
<span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

<span class="c1">// newè‡ªåŠ¨åŒ¹é…ç±»å‹</span>
<span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">;</span>
</code></pre></div>
<hr />
<h3 id="4_2"><strong>4. æ„é€ /ææ„å‡½æ•°</strong></h3>
<table>
<thead>
<tr>
<th><strong>æ“ä½œ</strong></th>
<th><code>malloc</code>/<code>free</code></th>
<th><code>new</code>/<code>delete</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ„é€ å‡½æ•°è°ƒç”¨</strong></td>
<td>âŒ ä¸è°ƒç”¨</td>
<td>âœ… è°ƒç”¨</td>
</tr>
<tr>
<td><strong>ææ„å‡½æ•°è°ƒç”¨</strong></td>
<td>âŒ ä¸è°ƒç”¨</td>
<td>âœ… è°ƒç”¨</td>
</tr>
</tbody>
</table>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Constructor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">~</span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Destructor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// malloc + free</span>
<span class="n">MyClass</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MyClass</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">MyClass</span><span class="p">));</span><span class="w">  </span><span class="c1">// æ— æ„é€ </span>
<span class="n">free</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ— ææ„</span>

<span class="c1">// new + delete</span>
<span class="n">MyClass</span><span class="o">*</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyClass</span><span class="p">;</span><span class="w">  </span><span class="c1">// è°ƒç”¨æ„é€ å‡½æ•°</span>
<span class="k">delete</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w">                  </span><span class="c1">// è°ƒç”¨ææ„å‡½æ•°</span>
</code></pre></div>
<hr />
<h3 id="5_4"><strong>5. é‡è½½æœºåˆ¶</strong></h3>
<ul>
<li><strong><code>malloc</code></strong>ï¼šä¸å¯é‡è½½</li>
<li><strong><code>new</code></strong>ï¼šæ”¯æŒå…¨å±€æˆ–ç±»ç‰¹å®šçš„è¿ç®—ç¬¦é‡è½½
  <div class="highlight"><pre><span></span><code><span class="c1">// å…¨å±€operator newé‡è½½</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="k">new</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Allocating &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<hr />
<h3 id="6_1"><strong>6. å†…å­˜æ¥æº</strong></h3>
<table>
<thead>
<tr>
<th><strong>åˆ†é…æ–¹å¼</strong></th>
<th><code>malloc</code></th>
<th><code>new</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å†…å­˜æ± </strong></td>
<td>ä»Cè¿è¡Œæ—¶åº“çš„å †åˆ†é…</td>
<td>é»˜è®¤é€šè¿‡<code>operator new</code>åˆ†é…</td>
</tr>
<tr>
<td><strong>å¯æ‰©å±•æ€§</strong></td>
<td>å›ºå®šå®ç°</td>
<td>å¯é€šè¿‡é‡è½½æ”¹å˜åˆ†é…ç­–ç•¥</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="7_1"><strong>7. å¤šæ€æ”¯æŒ</strong></h3>
<ul>
<li><strong><code>malloc</code></strong>ï¼šæ— æ³•ç›´æ¥åˆ›å»ºå¤šæ€å¯¹è±¡</li>
<li><strong><code>new</code></strong>ï¼šæ”¯æŒå¤šæ€å¯¹è±¡åˆ›å»º
  <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">};</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{};</span>

<span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ­£ç¡®åˆ›å»ºæ´¾ç”Ÿç±»å¯¹è±¡</span>
</code></pre></div></li>
</ul>
<hr />
<h3 id="8"><strong>8. ä½¿ç”¨åœºæ™¯å¯¹æ¯”</strong></h3>
<table>
<thead>
<tr>
<th><strong>åœºæ™¯</strong></th>
<th><code>malloc</code>/<code>free</code></th>
<th><code>new</code>/<code>delete</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cå…¼å®¹ä»£ç </strong></td>
<td>âœ… å¿…é¡»ä½¿ç”¨</td>
<td>âŒ æ— æ³•æ··åˆä½¿ç”¨</td>
</tr>
<tr>
<td><strong>PODæ•°æ®ç±»å‹</strong></td>
<td>âœ… é€‚ç”¨</td>
<td>âœ… æ›´å®‰å…¨</td>
</tr>
<tr>
<td><strong>éPODå¯¹è±¡</strong></td>
<td>âŒ å±é™©ï¼ˆä¸è°ƒç”¨æ„é€ /ææ„ï¼‰</td>
<td>âœ… å¿…é¡»ä½¿ç”¨</td>
</tr>
<tr>
<td><strong>å†…å­˜æ± å®šåˆ¶</strong></td>
<td>âŒ ä¸å¯æ§</td>
<td>âœ… å¯é€šè¿‡é‡è½½å®šåˆ¶</td>
</tr>
<tr>
<td><strong>ä½å±‚å†…å­˜æ“ä½œ</strong></td>
<td>âœ… ç›´æ¥æ§åˆ¶å­—èŠ‚</td>
<td>âŒ æŠ½è±¡å±‚æ¬¡é«˜</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="9"><strong>9. å…³é”®ä»£ç ç¤ºä¾‹</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// malloc/freeç¤ºä¾‹</span>
<span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">arr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="n">free</span><span class="p">(</span><span class="n">arr1</span><span class="p">);</span>

<span class="c1">// new/deleteç¤ºä¾‹</span>
<span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">arr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">]{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span><span class="w">  </span><span class="c1">// åˆå§‹åŒ–åˆ—è¡¨</span>
<span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">arr2</span><span class="p">;</span>

<span class="c1">// å¯¹è±¡ç¤ºä¾‹</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Student</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>

<span class="n">Student</span><span class="o">*</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Student</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Student</span><span class="p">));</span><span class="w">  </span><span class="c1">// å±é™©ï¼æœªæ„é€ å¯¹è±¡</span>
<span class="c1">// s1-&gt;name = &quot;Alice&quot;;  // å¯èƒ½å´©æºƒ</span>

<span class="n">Student</span><span class="o">*</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Student</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ­£ç¡®æ„é€ </span>
<span class="k">delete</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span>
</code></pre></div>
<hr />
<h3 id="10-c"><strong>10. ç°ä»£C++æ¼”è¿›</strong></h3>
<ul>
<li><strong><code>new</code>çš„æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š</li>
<li><code>std::make_unique</code> / <code>std::make_shared</code>ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰</li>
<li>å®¹å™¨ç±»ï¼ˆ<code>std::vector</code>ç­‰ï¼‰</li>
<li><strong><code>malloc</code>çš„ç°ä»£ç”¨æ³•</strong>ï¼š</li>
<li>ä»…åœ¨ä¸Cåº“äº¤äº’æ—¶ä½¿ç”¨ï¼ˆå¦‚ï¼š<code>FILE*</code>æ“ä½œï¼‰</li>
<li>å®ç°è‡ªå®šä¹‰å†…å­˜ç®¡ç†å™¨æ—¶ä½œä¸ºåº•å±‚åˆ†é…å™¨</li>
</ul>
<hr />
<h3 id="_19"><strong>æ€»ç»“é€‰æ‹©åŸåˆ™</strong></h3>
<table>
<thead>
<tr>
<th><strong>æƒ…å†µ</strong></th>
<th><strong>æ¨èæ–¹å¼</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>C++å¯¹è±¡ï¼ˆå°¤å…¶éPODï¼‰</td>
<td><code>new</code>/<code>delete</code></td>
</tr>
<tr>
<td>éœ€è¦æ„é€ /ææ„çš„ç±»</td>
<td>å¿…é¡»ç”¨<code>new</code></td>
</tr>
<tr>
<td>åŸå§‹å­—èŠ‚æ“ä½œï¼ˆå¦‚ç½‘ç»œç¼“å†²åŒºï¼‰</td>
<td><code>malloc</code>+<code>free</code></td>
</tr>
<tr>
<td>å…¼å®¹Cä»£ç çš„æ¥å£</td>
<td><code>malloc</code>+<code>free</code></td>
</tr>
<tr>
<td>ç°ä»£C++å¼€å‘</td>
<td>ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>é‡æŒ‡é’ˆå’Œå†…å­˜æ³„éœ²</p>
<p>åœ¨C++å†…å­˜ç®¡ç†ä¸­ï¼Œ<strong>é‡æŒ‡é’ˆï¼ˆDangling Pointerï¼‰</strong>å’Œ<strong>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</strong>æ˜¯ä¸¤ç±»æˆªç„¶ä¸åŒä½†éƒ½å¯èƒ½å¯¼è‡´ä¸¥é‡é—®é¢˜çš„ç¼ºé™·ã€‚ä»¥ä¸‹æ˜¯ä¸“ä¸šçº§çš„å¯¹æ¯”åˆ†æä¸è§£å†³æ–¹æ¡ˆï¼š</p>
<hr />
<h3 id="1_6"><strong>1. æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”</strong></h3>
<table>
<thead>
<tr>
<th><strong>ç‰¹æ€§</strong></th>
<th>é‡æŒ‡é’ˆ (Dangling Pointer)</th>
<th>å†…å­˜æ³„æ¼ (Memory Leak)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æœ¬è´¨</strong></td>
<td>æŒ‡å‘æ— æ•ˆå†…å­˜åœ°å€çš„æŒ‡é’ˆ</td>
<td>å·²åˆ†é…çš„å†…å­˜æ— æ³•è¢«é‡Šæ”¾æˆ–å›æ”¶</td>
</tr>
<tr>
<td><strong>ç›´æ¥å±å®³</strong></td>
<td>ç¨‹åºå´©æºƒã€æ•°æ®æŸåã€å®‰å…¨æ¼æ´</td>
<td>ç¨‹åºå†…å­˜å ç”¨æŒç»­å¢é•¿ï¼Œæœ€ç»ˆå¯¼è‡´OOM</td>
</tr>
<tr>
<td><strong>è§¦å‘æ—¶æœº</strong></td>
<td>è®¿é—®å·²é‡Šæ”¾å†…å­˜æ—¶</td>
<td>ç¨‹åºè¿è¡ŒæœŸé—´é€æ¸ç§¯ç´¯</td>
</tr>
<tr>
<td><strong>æ£€æµ‹éš¾åº¦</strong></td>
<td>é«˜ï¼ˆéšæœºå´©æºƒï¼Œéš¾ä»¥å¤ç°ï¼‰</td>
<td>ä¸­ï¼ˆå¯é€šè¿‡å·¥å…·ç›‘æ§å†…å­˜å¢é•¿ï¼‰</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2_3"><strong>2. äº§ç”ŸåŸå› ä¸å…¸å‹åœºæ™¯</strong></h3>
<h4 id="21_1"><strong>2.1 é‡æŒ‡é’ˆæˆå› </strong></h4>
<ol>
<li>
<p><strong>é‡Šæ”¾åæœªç½®ç©º</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w">     </span><span class="c1">// å†…å­˜é‡Šæ”¾</span>
<span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">      </span><span class="c1">// é‡æŒ‡é’ˆè®¿é—®ï¼è¡Œä¸ºæœªå®šä¹‰</span>
</code></pre></div></p>
</li>
<li>
<p><strong>è¿”å›å±€éƒ¨å˜é‡åœ°å€</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="nf">createInt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w">  </span><span class="c1">// è¿”å›æ ˆå†…å­˜æŒ‡é’ˆï¼Œå‡½æ•°è¿”å›åxè¢«é”€æ¯</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å¤šæŒ‡é’ˆå…±äº«èµ„æº</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
<span class="k">delete</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span><span class="w">     </span><span class="c1">// p2ç°åœ¨æˆä¸ºé‡æŒ‡é’ˆ</span>
</code></pre></div></p>
</li>
<li>
<p><strong>è¿­ä»£å™¨å¤±æ•ˆåä½¿ç”¨</strong><br />
   <div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">};</span>
<span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// å¯èƒ½å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆ</span>
<span class="o">*</span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">           </span><span class="c1">// é‡æŒ‡é’ˆè¡Œä¸º</span>
</code></pre></div></p>
</li>
</ol>
<h4 id="22_1"><strong>2.2 å†…å­˜æ³„æ¼æˆå› </strong></h4>
<ol>
<li>
<p><strong>ç›´æ¥æœªé‡Šæ”¾åŠ¨æ€å†…å­˜</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">leak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span><span class="w">  </span><span class="c1">// æœªè°ƒç”¨delete[]</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å¼‚å¸¸å¯¼è‡´é‡Šæ”¾ä»£ç æœªæ‰§è¡Œ</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">unsafe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">;</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="p">();</span><span class="w">  </span><span class="c1">// å¼‚å¸¸è·³è¿‡delete</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å¾ªç¯å¼•ç”¨ï¼ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ—¶ï¼‰</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">auto</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">n1</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="p">;</span>
<span class="n">n2</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n1</span><span class="p">;</span><span class="w">  </span><span class="c1">// å¾ªç¯å¼•ç”¨å¯¼è‡´æ— æ³•é‡Šæ”¾</span>
</code></pre></div></p>
</li>
<li>
<p><strong>é™æ€å¯¹è±¡æŒæœ‰åŠ¨æ€èµ„æº</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">globalVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span><span class="w">  </span><span class="c1">// ç¨‹åºç»“æŸå‰æœªé‡Šæ”¾</span>
</code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="3_5"><strong>3. å±å®³æ€§å¯¹æ¯”</strong></h3>
<table>
<thead>
<tr>
<th><strong>å±å®³ç±»å‹</strong></th>
<th>é‡æŒ‡é’ˆ</th>
<th>å†…å­˜æ³„æ¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>çŸ­æœŸå½±å“</strong></td>
<td>éšæœºå´©æºƒã€æ•°æ®è¦†ç›–</td>
<td>æ— æ˜æ˜¾ç—‡çŠ¶</td>
</tr>
<tr>
<td><strong>é•¿æœŸå½±å“</strong></td>
<td>å®‰å…¨æ¼æ´ï¼ˆå¦‚ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼‰</td>
<td>å†…å­˜è€—å°½ã€ç¨‹åºè¢«ç³»ç»Ÿç»ˆæ­¢</td>
</tr>
<tr>
<td><strong>è°ƒè¯•éš¾åº¦</strong></td>
<td>éš¾ä»¥å®šä½ï¼ˆå´©æºƒç‚¹éçœŸå®é”™è¯¯ä½ç½®ï¼‰</td>
<td>å¯é€šè¿‡å†…å­˜åˆ†æå·¥å…·å®šä½</td>
</tr>
<tr>
<td><strong>å¹³å°ç›¸å…³æ€§</strong></td>
<td>æ‰€æœ‰æ”¯æŒæŒ‡é’ˆçš„è¯­è¨€</td>
<td>æ‰€æœ‰æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„è¯­è¨€</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="4_3"><strong>4. ä»£ç ç¤ºä¾‹ä¸è°ƒè¯•åˆ†æ</strong></h3>
<h4 id="41"><strong>4.1 é‡æŒ‡é’ˆå´©æºƒæ¡ˆä¾‹</strong></h4>
<p><div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// æœªç½®ç©ºæŒ‡é’ˆ</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w">  </span><span class="c1">// è®¿é—®å·²é‡Šæ”¾å†…å­˜ï¼ˆå¯èƒ½è¾“å‡ºä¹±ç æˆ–å´©æºƒï¼‰</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<strong>è°ƒè¯•ç°è±¡</strong>ï¼šåœ¨Releaseæ¨¡å¼ä¸‹å¯èƒ½â€œæ­£å¸¸â€è¾“å‡º10ï¼ˆå†…å­˜æœªè¢«è¦†ç›–ï¼‰ï¼ŒDebugæ¨¡å¼ä¸‹è§¦å‘è®¿é—®å†²çªã€‚</p>
<h4 id="42"><strong>4.2 å†…å­˜æ³„æ¼å¢é•¿ç¤ºä¾‹</strong></h4>
<p><div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">leaky_func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span><span class="w">  </span><span class="c1">// æ¯æ¬¡è°ƒç”¨æ³„æ¼4KB</span>
<span class="w">    </span><span class="o">++</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">leaky_func</span><span class="p">();</span><span class="w">  </span><span class="c1">// å†…å­˜æŒç»­å¢é•¿</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<strong>ç›‘æ§æ•°æ®</strong>ï¼šä»»åŠ¡ç®¡ç†å™¨å¯è§è¿›ç¨‹å†…å­˜å ç”¨æŒç»­ä¸Šå‡ï¼Œç›´è‡³å´©æºƒã€‚</p>
<hr />
<h3 id="5_5"><strong>5. æ£€æµ‹ä¸é¢„é˜²æ–¹æ¡ˆ</strong></h3>
<h4 id="51"><strong>5.1 é‡æŒ‡é’ˆé˜²æŠ¤</strong></h4>
<ol>
<li>
<p><strong>ç«‹å³ç½®ç©ºç­–ç•¥</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">  </span><span class="c1">// åç»­è®¿é—®ä¼šè§¦å‘æ®µé”™è¯¯è€ŒéUB</span>
</code></pre></div></p>
</li>
<li>
<p><strong>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</strong><br />
   <div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span>
</code></pre></div></p>
</li>
<li>
<p><strong>é™åˆ¶æŒ‡é’ˆä½œç”¨åŸŸ</strong><br />
   <div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾</span>
</code></pre></div></p>
</li>
<li>
<p><strong>é™æ€ä»£ç åˆ†æå·¥å…·</strong>  </p>
</li>
<li>Clang-Tidy (<code>bugprone-use-after-move</code>)</li>
<li>PVS-Studio (<code>V774</code>æ£€æµ‹è§„åˆ™)</li>
</ol>
<h4 id="52"><strong>5.2 å†…å­˜æ³„æ¼æ²»ç†</strong></h4>
<ol>
<li>
<p><strong>RAIIåŸåˆ™</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResourceHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">ResourceHolder</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">])</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="o">~</span><span class="n">ResourceHolder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div></p>
</li>
<li>
<p><strong>æ™ºèƒ½æŒ‡é’ˆå…¨è¦†ç›–</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span><span class="p">();</span><span class="w">  </span><span class="c1">// å¼•ç”¨è®¡æ•°è‡ªåŠ¨é‡Šæ”¾</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å¼‚å¸¸å®‰å…¨è®¾è®¡</strong><br />
   <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">safe_func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ</span>
<span class="w">    </span><span class="n">res</span><span class="o">-&gt;</span><span class="n">do_something</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// æ— éœ€æ‰‹åŠ¨é‡Šæ”¾ï¼Œunique_pträ¿è¯å¼‚å¸¸å®‰å…¨</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong>æ£€æµ‹å·¥å…·é“¾</strong>  </p>
</li>
<li>Valgrind Memcheckï¼š<br />
<code>valgrind --leak-check=full ./your_program</code></li>
<li>AddressSanitizerï¼ˆASanï¼‰ï¼š<br />
<code>g++ -fsanitize=address -g your_code.cpp</code></li>
</ol>
<hr />
<h3 id="6-c"><strong>6. ç°ä»£C++æœ€ä½³å®è·µ</strong></h3>
<ol>
<li>
<p><strong>ç¦ç”¨è£¸æŒ‡é’ˆ</strong>ï¼ˆé¡¹ç›®çº§è§„èŒƒï¼‰
   <div class="highlight"><pre><span></span><code><span class="c1">// ä»£ç å®¡æŸ¥ç¦æ­¢å‡ºç°new/delete</span>
<span class="cp">#define new DELIBERATELY_DISABLED</span>
</code></pre></div></p>
</li>
<li>
<p><strong>ä½¿ç”¨å®¹å™¨æ›¿ä»£åŠ¨æ€æ•°ç»„</strong><br />
   <div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w">  </span><span class="c1">// è‡ªåŠ¨ç®¡ç†å†…å­˜</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å¾ªç¯å¼•ç”¨è§£å†³æ–¹æ¡ˆ</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">next</span><span class="p">;</span><span class="w">  </span><span class="c1">// æ‰“ç ´å¾ªç¯å¼•ç”¨</span>
<span class="p">};</span>
</code></pre></div></p>
</li>
<li>
<p><strong>å†…å­˜æ± å®šåˆ¶</strong><br />
   <div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ObjectPool</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// ç»Ÿä¸€ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">pool</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></p>
</li>
</ol>
<hr />
<h3 id="7_2"><strong>7. æ€»ç»“ï¼šå…³é”®åŒºåˆ«ä¸é€‰æ‹©</strong></h3>
<table>
<thead>
<tr>
<th><strong>å†³ç­–ç‚¹</strong></th>
<th>é‡æŒ‡é’ˆ</th>
<th>å†…å­˜æ³„æ¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é˜²å¾¡æ ¸å¿ƒ</strong></td>
<td>ç”Ÿå‘½å‘¨æœŸç®¡ç† + æŒ‡é’ˆç½®ç©º</td>
<td>èµ„æºæ‰€æœ‰æƒæ¸…æ™°åŒ– + RAII</td>
</tr>
<tr>
<td><strong>è°ƒè¯•ä¼˜å…ˆçº§</strong></td>
<td>é«˜ï¼ˆå¯èƒ½å¯¼è‡´å³æ—¶å´©æºƒï¼‰</td>
<td>ä¸­ï¼ˆéœ€é•¿æœŸè¿è¡Œæš´éœ²é—®é¢˜ï¼‰</td>
</tr>
<tr>
<td><strong>ç°ä»£C++æ–¹æ¡ˆ</strong></td>
<td><code>unique_ptr</code>/<code>scope guard</code></td>
<td><code>make_shared</code>/å®¹å™¨ç±»</td>
</tr>
<tr>
<td><strong>æ¶æ„çº§é˜²å¾¡</strong></td>
<td>é™æ€åˆ†æ + ä»£ç è§„èŒƒ</td>
<td>æ™ºèƒ½æŒ‡é’ˆå…¨è¦†ç›– + æ³„æ¼æ£€æµ‹å·¥å…·é“¾</td>
</tr>
</tbody>
</table>
<p><strong>ç»ˆæåŸåˆ™</strong>ï¼š<br />
- é€šè¿‡ç±»å‹ç³»ç»Ÿï¼ˆå¦‚æ™ºèƒ½æŒ‡é’ˆï¼‰å°†å†…å­˜ç®¡ç†é—®é¢˜è½¬åŒ–ä¸ºç¼–è¯‘æœŸé”™è¯¯<br />
- ä½¿ç”¨ASan/Valgrindåœ¨CI/CDæµæ°´çº¿ä¸­å¼ºåˆ¶æ£€æµ‹<br />
- éµå¾ªC++ Core Guidelinesçš„Rè§„åˆ™ï¼ˆèµ„æºç®¡ç†ï¼‰</p>
</li>
<li>
<p><strong>UARTã€I2Cã€SPI é€šä¿¡åè®®å¯¹æ¯”åˆ†æ</strong></p>
<h3 id="1-uartuniversal-asynchronous-receivertransmitter"><strong>1. UARTï¼ˆUniversal Asynchronous Receiver/Transmitterï¼‰</strong></h3>
<h4 id="11"><strong>1.1 æ ¸å¿ƒç‰¹æ€§</strong></h4>
<ul>
<li><strong>é€šä¿¡ç±»å‹</strong>ï¼šå¼‚æ­¥ä¸²è¡Œé€šä¿¡ï¼ˆæ— å…±äº«æ—¶é’Ÿï¼‰</li>
<li><strong>çº¿æ•°</strong>ï¼š2 æ ¹ï¼ˆTXï¼šå‘é€ï¼ŒRXï¼šæ¥æ”¶ï¼‰</li>
<li><strong>æ‹“æ‰‘ç»“æ„</strong>ï¼šç‚¹å¯¹ç‚¹ï¼ˆ1:1 é€šä¿¡ï¼‰</li>
<li><strong>ä¼ è¾“æ–¹å‘</strong>ï¼šå…¨åŒå·¥ï¼ˆåŒæ—¶æ”¶å‘ï¼‰</li>
<li><strong>ç”µå¹³æ ‡å‡†</strong>ï¼šTTLï¼ˆ3.3V/5Vï¼‰ã€RS-232ï¼ˆÂ±12Vï¼‰</li>
</ul>
<h4 id="12"><strong>1.2 æ—¶åºç‰¹å¾</strong></h4>
<ul>
<li><strong>å¸§ç»“æ„</strong>ï¼š 
  <strong>èµ·å§‹ä½ï¼ˆ1bitï¼‰ + æ•°æ®ä½ï¼ˆ5-9bitï¼‰ + æ ¡éªŒä½ï¼ˆå¯é€‰ï¼‰ + åœæ­¢ä½ï¼ˆ1-2bitï¼‰</strong> 
  <img alt="undefined" src="pic/UART-signal.png" /></li>
<li><strong>å…³é”®å‚æ•°</strong>ï¼š  </li>
<li><strong>æ³¢ç‰¹ç‡ï¼ˆBaud Rateï¼‰</strong>ï¼šåŒæ–¹éœ€ä¸¥æ ¼ä¸€è‡´ï¼ˆå¦‚ 9600ã€115200ï¼‰  </li>
<li><strong>æ—¶é’Ÿè¯¯å·®å®¹å¿åº¦</strong>ï¼šé€šå¸¸è¦æ±‚è¯¯å·® &lt; 3%ï¼ˆä¾èµ–æ•°æ®å¸§é•¿åº¦ï¼‰</li>
</ul>
<h4 id="13"><strong>1.3 ç¡¬ä»¶å±‚ç»†èŠ‚</strong></h4>
<ul>
<li><strong>çº¿ç¼†è¦æ±‚</strong>ï¼š  </li>
<li>æ— éœ€æ—¶é’Ÿçº¿ï¼Œä½†éœ€å…±åœ°ï¼ˆGNDï¼‰  </li>
<li>é•¿è·ç¦»éœ€ç”µå¹³è½¬æ¢ï¼ˆå¦‚ MAX232 èŠ¯ç‰‡è½¬ RS-232ï¼‰  </li>
<li><strong>å†²çªæ£€æµ‹</strong>ï¼šæ— ç¡¬ä»¶ä»²è£æœºåˆ¶  </li>
<li><strong>å…¸å‹åº”ç”¨</strong>ï¼š  </li>
<li>è°ƒè¯•ä¸²å£ï¼ˆConsoleï¼‰  </li>
<li>GPS æ¨¡å—ã€è“ç‰™æ¨¡å—é€šä¿¡  </li>
</ul>
<hr />
<h3 id="2-i2cinter-integrated-circuit"><strong>2. I2Cï¼ˆInter-Integrated Circuitï¼‰</strong></h3>
<h4 id="21_2"><strong>2.1 æ ¸å¿ƒç‰¹æ€§</strong></h4>
<ul>
<li><strong>é€šä¿¡ç±»å‹</strong>ï¼šåŒæ­¥åŠåŒå·¥ï¼ˆå…±äº«æ—¶é’Ÿï¼‰</li>
<li><strong>çº¿æ•°</strong>ï¼š2 æ ¹ï¼ˆSDAï¼šæ•°æ®çº¿ï¼ŒSCLï¼šæ—¶é’Ÿçº¿ï¼‰</li>
<li><strong>æ‹“æ‰‘ç»“æ„</strong>ï¼šå¤šä¸»å¤šä»ï¼ˆæ€»çº¿å‹ï¼Œéœ€è®¾å¤‡åœ°å€ï¼‰</li>
<li><strong>ä¼ è¾“é€Ÿåº¦</strong>ï¼š  </li>
<li>æ ‡å‡†æ¨¡å¼ï¼ˆ100 kbpsï¼‰  </li>
<li>å¿«é€Ÿæ¨¡å¼ï¼ˆ400 kbpsï¼‰  </li>
<li>é«˜é€Ÿæ¨¡å¼ï¼ˆ3.4 Mbpsï¼‰</li>
<li><strong>ç”µå¹³æ ‡å‡†</strong>ï¼šå¼€æ¼è¾“å‡ºï¼ˆéœ€å¤–æ¥ä¸Šæ‹‰ç”µé˜»ï¼‰</li>
</ul>
<h4 id="22_2"><strong>2.2 æ—¶åºç‰¹å¾</strong></h4>
<ul>
<li><strong>å¸§ç»“æ„</strong>ï¼š<br />
<strong>èµ·å§‹æ¡ä»¶ + åœ°å€å¸§ï¼ˆ7/10bitï¼‰ + è¯»å†™ä½ + ACK/NACK + æ•°æ®å¸§ + åœæ­¢æ¡ä»¶</strong>  </li>
</ul>
<p><img alt="image-20250308224926100" src="pic/image-20250308224926100.png" /></p>
<ul>
<li>
<p><strong>å…³é”®æ“ä½œ</strong>ï¼š  </p>
</li>
<li>
<p><strong>èµ·å§‹æ¡ä»¶ï¼ˆStartï¼‰</strong>ï¼šSCL é«˜ç”µå¹³æ—¶ SDA ä»é«˜â†’ä½  </p>
</li>
<li><strong>åœæ­¢æ¡ä»¶ï¼ˆStopï¼‰</strong>ï¼šSCL é«˜ç”µå¹³æ—¶ SDA ä»ä½â†’é«˜  </li>
<li><strong>ACK/NACK</strong>ï¼šç¬¬9ä¸ªæ—¶é’Ÿå‘¨æœŸç¡®è®¤  </li>
</ul>
<h4 id="23_1"><strong>2.3 ç¡¬ä»¶å±‚ç»†èŠ‚</strong></h4>
<ul>
<li><strong>ç¡¬ä»¶è®¾è®¡</strong>ï¼š  </li>
<li>æ€»çº¿éœ€æ¥ä¸Šæ‹‰ç”µé˜»ï¼ˆé€šå¸¸ 4.7kÎ©ï¼‰  </li>
<li>æ”¯æŒå¤šè®¾å¤‡ï¼ˆåœ°å€å†²çªéœ€ç¡¬ä»¶è·³çº¿ï¼‰  </li>
<li><strong>ä»²è£æœºåˆ¶</strong>ï¼šåŸºäº SDA çº¿â€œçº¿ä¸â€ç‰¹æ€§ï¼ˆä½ç”µå¹³ä¼˜å…ˆï¼‰  </li>
<li><strong>æ—¶é’ŸåŒæ­¥</strong>ï¼šæ”¯æŒæ—¶é’Ÿæ‹‰ä¼¸ï¼ˆSlave å¯æ‹‰ä½ SCLï¼‰  </li>
<li><strong>å…¸å‹åº”ç”¨</strong>ï¼š  </li>
<li>ä¼ æ„Ÿå™¨ï¼ˆå¦‚ BME280 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ï¼‰  </li>
<li>EEPROMï¼ˆå¦‚ AT24C02ï¼‰  </li>
</ul>
<hr />
<h3 id="3-spiserial-peripheral-interface"><strong>3. SPIï¼ˆSerial Peripheral Interfaceï¼‰</strong></h3>
<h4 id="31"><strong>3.1 æ ¸å¿ƒç‰¹æ€§</strong></h4>
<ul>
<li><strong>é€šä¿¡ç±»å‹</strong>ï¼šåŒæ­¥å…¨åŒå·¥ï¼ˆå…±äº«æ—¶é’Ÿï¼‰</li>
<li><strong>çº¿æ•°</strong>ï¼š4 æ ¹ï¼ˆSCLKã€MOSIã€MISOã€CSï¼‰  </li>
<li><strong>SCLK</strong>ï¼šæ—¶é’Ÿä¿¡å·ï¼ˆä¸»è®¾å¤‡æ§åˆ¶ï¼‰  </li>
<li><strong>MOSI</strong>ï¼šä¸»è®¾å¤‡å‘é€ï¼Œä»è®¾å¤‡æ¥æ”¶  </li>
<li><strong>MISO</strong>ï¼šä¸»è®¾å¤‡æ¥æ”¶ï¼Œä»è®¾å¤‡å‘é€  </li>
<li><strong>CSï¼ˆSSï¼‰</strong>ï¼šç‰‡é€‰ä¿¡å·ï¼ˆæ¯ä¸ªä»è®¾å¤‡ç‹¬ç«‹ï¼‰  </li>
<li><strong>æ‹“æ‰‘ç»“æ„</strong>ï¼šä¸€ä¸»å¤šä»ï¼ˆæ˜Ÿå‹æ‹“æ‰‘ï¼‰  </li>
<li><strong>ä¼ è¾“é€Ÿåº¦</strong>ï¼šå¯è¾¾ 100+ Mbpsï¼ˆä¾èµ–ç¡¬ä»¶ï¼‰  </li>
<li><strong>ç”µå¹³æ ‡å‡†</strong>ï¼šæ¨æŒ½è¾“å‡ºï¼ˆæ— éœ€ä¸Šæ‹‰ç”µé˜»ï¼‰</li>
</ul>
<h4 id="32"><strong>3.2 æ—¶åºç‰¹å¾</strong></h4>
<ul>
<li><strong>æ—¶é’Ÿæ¨¡å¼</strong>ï¼š  </li>
<li><strong>CPOLï¼ˆæ—¶é’Ÿææ€§ï¼‰</strong>ï¼šç©ºé—²æ—¶ SCLK ç”µå¹³ï¼ˆ0=ä½ï¼Œ1=é«˜ï¼‰  </li>
<li><strong>CPHAï¼ˆæ—¶é’Ÿç›¸ä½ï¼‰</strong>ï¼šæ•°æ®é‡‡æ ·è¾¹æ²¿ï¼ˆ0=ç¬¬ä¸€ä¸ªè¾¹æ²¿ï¼Œ1=ç¬¬äºŒä¸ªè¾¹æ²¿ï¼‰  </li>
<li>ç»„åˆå½¢æˆ 4 ç§æ¨¡å¼ï¼ˆMode 0-3ï¼‰ </li>
</ul>
<p><img alt="image-20250308230052728" src="pic/image-20250308230052728.png" /></p>
<ul>
<li>
<p><strong>æ•°æ®ä¼ è¾“</strong>ï¼š  </p>
</li>
<li>
<p>ä¸»è®¾å¤‡é€šè¿‡ SCLK è¾¹æ²¿è§¦å‘æ•°æ®ç§»ä½  </p>
</li>
<li>å…¨åŒå·¥ä¼ è¾“ï¼ˆMOSI å’Œ MISO åŒæ—¶å·¥ä½œï¼‰</li>
</ul>
<h4 id="33"><strong>3.3 ç¡¬ä»¶å±‚ç»†èŠ‚</strong></h4>
<ul>
<li><strong>ç¡¬ä»¶è®¾è®¡</strong>ï¼š  </li>
<li>æ¯ä¸ªä»è®¾å¤‡éœ€ç‹¬ç«‹ CS çº¿ï¼ˆN ä¸ªä»è®¾å¤‡éœ€ N+3 æ ¹çº¿ï¼‰  </li>
<li>çŸ­è·ç¦»é€šä¿¡ï¼ˆé€šå¸¸ &lt; 1mï¼‰  </li>
<li><strong>æ— å¯»å€æœºåˆ¶</strong>ï¼šé€šè¿‡ CS ä¿¡å·é€‰æ‹©ä»è®¾å¤‡  </li>
<li><strong>é«˜é€Ÿä¼˜åŒ–</strong>ï¼šæ”¯æŒ DMA ä¼ è¾“ï¼ˆå‡å°‘ CPU å¼€é”€ï¼‰  </li>
<li><strong>å…¸å‹åº”ç”¨</strong>ï¼š  </li>
<li>é«˜é€Ÿ ADC/DACï¼ˆå¦‚ ADS131M08ï¼‰  </li>
<li>æ˜¾ç¤ºå±ï¼ˆå¦‚ OLED SSD1306ï¼‰  </li>
<li>Flash å­˜å‚¨å™¨ï¼ˆå¦‚ W25Q128ï¼‰  </li>
</ul>
<hr />
<h3 id="4_4"><strong>4. ä¸‰åè®®å¯¹æ¯”æ€»ç»“</strong></h3>
<table>
<thead>
<tr>
<th><strong>ç‰¹æ€§</strong></th>
<th><strong>UART</strong></th>
<th><strong>I2C</strong></th>
<th><strong>SPI</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>çº¿æ•°</strong></td>
<td>2ï¼ˆTX+RXï¼‰</td>
<td>2ï¼ˆSDA+SCLï¼‰</td>
<td>4ï¼ˆSCLK+MOSI+MISO+CSï¼‰</td>
</tr>
<tr>
<td><strong>ä¼ è¾“æ–¹å‘</strong></td>
<td>å…¨åŒå·¥</td>
<td>åŠåŒå·¥</td>
<td>å…¨åŒå·¥</td>
</tr>
<tr>
<td><strong>æ‹“æ‰‘ç»“æ„</strong></td>
<td>ç‚¹å¯¹ç‚¹</td>
<td>æ€»çº¿å‹ï¼ˆå¤šä¸»å¤šä»ï¼‰</td>
<td>æ˜Ÿå‹ï¼ˆä¸€ä¸»å¤šä»ï¼‰</td>
</tr>
<tr>
<td><strong>æ—¶é’Ÿä¿¡å·</strong></td>
<td>æ— ï¼ˆå¼‚æ­¥ï¼‰</td>
<td>åŒæ­¥ï¼ˆSCLï¼‰</td>
<td>åŒæ­¥ï¼ˆSCLKï¼‰</td>
</tr>
<tr>
<td><strong>å¯»å€æ–¹å¼</strong></td>
<td>æ— ï¼ˆä»…ç‚¹å¯¹ç‚¹ï¼‰</td>
<td>7/10 ä½è®¾å¤‡åœ°å€</td>
<td>ç¡¬ä»¶ç‰‡é€‰ï¼ˆCSï¼‰</td>
</tr>
<tr>
<td><strong>é€Ÿåº¦</strong></td>
<td>ä½ï¼ˆé€šå¸¸ &lt; 1 Mbpsï¼‰</td>
<td>ä¸­ï¼ˆæœ€é«˜ 3.4 Mbpsï¼‰</td>
<td>é«˜ï¼ˆå¯è¾¾ 100+ Mbpsï¼‰</td>
</tr>
<tr>
<td><strong>ç¡¬ä»¶å¤æ‚åº¦</strong></td>
<td>ä½</td>
<td>ä¸­ï¼ˆéœ€ä¸Šæ‹‰ç”µé˜»ï¼‰</td>
<td>é«˜ï¼ˆå¤šç‰‡é€‰çº¿ï¼‰</td>
</tr>
<tr>
<td><strong>æŠ—å¹²æ‰°èƒ½åŠ›</strong></td>
<td>å¼±ï¼ˆä¾èµ–æ³¢ç‰¹ç‡åŒ¹é…ï¼‰</td>
<td>ä¸­ï¼ˆæ€»çº¿ç”µå®¹å½±å“ï¼‰</td>
<td>å¼ºï¼ˆæ¨æŒ½è¾“å‡ºï¼‰</td>
</tr>
<tr>
<td><strong>å…¸å‹åœºæ™¯</strong></td>
<td>è°ƒè¯•æ¥å£ã€æ¨¡å—é—´é€šä¿¡</td>
<td>ä¼ æ„Ÿå™¨ã€ä½é€Ÿè®¾å¤‡</td>
<td>é«˜é€Ÿå¤–è®¾ã€å­˜å‚¨å™¨</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="5_6"><strong>5. é€‰å‹å»ºè®®</strong></h3>
<ul>
<li><strong>é€‰æ‹© UART</strong>ï¼š  </li>
<li>ç®€å•åŒå‘é€šä¿¡ï¼Œæ— éœ€å®æ—¶æ€§  </li>
<li>
<p>è·¨å¹³å°å…¼å®¹æ€§è¦æ±‚é«˜ï¼ˆå¦‚ä¸ PC é€šä¿¡ï¼‰  </p>
</li>
<li>
<p><strong>é€‰æ‹© I2C</strong>ï¼š  </p>
</li>
<li>å¤šè®¾å¤‡å…±äº«æ€»çº¿ï¼ŒèŠ‚çœå¼•è„šèµ„æº  </li>
<li>
<p>ä¸­ä½é€Ÿä¼ æ„Ÿå™¨ç½‘ç»œï¼ˆå¦‚æ¸©æ¹¿åº¦+æ°”å‹ä¼ æ„Ÿå™¨ç»„åˆï¼‰  </p>
</li>
<li>
<p><strong>é€‰æ‹© SPI</strong>ï¼š  </p>
</li>
<li>é«˜é€Ÿæ•°æ®ä¼ è¾“ï¼ˆå¦‚æ‘„åƒå¤´å›¾åƒä¼ è¾“ï¼‰  </li>
<li>å…¨åŒå·¥å®æ—¶æ§åˆ¶ï¼ˆå¦‚ç”µæœºé©±åŠ¨+åé¦ˆï¼‰  </li>
</ul>
<hr />
<h3 id="6_2"><strong>6. é«˜çº§è®¾è®¡æ³¨æ„äº‹é¡¹</strong></h3>
<ol>
<li><strong>UART çš„æ³¢ç‰¹ç‡è¯¯å·®</strong>ï¼š  </li>
<li>ä½¿ç”¨é«˜ç²¾åº¦æ™¶æŒ¯ï¼ˆè¯¯å·® &lt; 0.1%ï¼‰  </li>
<li>
<p>é¿å…é•¿è·ç¦»ä¼ è¾“ï¼ˆå»ºè®® &lt; 1mï¼Œæˆ–ä½¿ç”¨ RS-485ï¼‰  </p>
</li>
<li>
<p><strong>I2C çš„æ€»çº¿ç”µå®¹</strong>ï¼š  </p>
</li>
<li>æ€»ç”µå®¹éœ€ &lt; 400pFï¼ˆè¿‡é•¿çº¿ç¼†éœ€åˆ†æ®µç¼“å†²ï¼‰  </li>
<li>
<p>ä½¿ç”¨ I2C ç”µå¹³è½¬æ¢å™¨ï¼ˆå¦‚ PCA9306ï¼‰å®ç° 3.3V/5V æ··æ¥  </p>
</li>
<li>
<p><strong>SPI çš„æ—¶é’Ÿåç§»</strong>ï¼š  </p>
</li>
<li>ç­‰é•¿å¸ƒçº¿ï¼ˆSCLK ä¸æ•°æ®çº¿é•¿åº¦å·® &lt; 5mmï¼‰  </li>
<li>
<p>é«˜é€Ÿæ¨¡å¼ä¸‹ä½¿ç”¨é˜»æŠ—åŒ¹é…ï¼ˆå¦‚ 50Î© ç«¯æ¥ç”µé˜»ï¼‰  </p>
</li>
<li>
<p><strong>æŠ—å¹²æ‰°è®¾è®¡</strong>ï¼š  </p>
</li>
<li>UART/I2Cï¼šä½¿ç”¨åŒç»çº¿ + å±è”½å±‚  </li>
<li>SPIï¼šå·®åˆ†ä¿¡å·ï¼ˆå¦‚ SPI è½¬ LVDSï¼‰  </li>
</ol>
<hr />
<h3 id="7-spi"><strong>7. ä»£ç ç¤ºä¾‹ï¼ˆSPI æ¨¡å¼é…ç½®ï¼‰</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// SPI Mode 0 (CPOL=0, CPHA=0)</span>
<span class="n">SPI_InitTypeDef</span><span class="w"> </span><span class="n">spi</span><span class="p">;</span>
<span class="n">spi</span><span class="p">.</span><span class="n">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_MODE_MASTER</span><span class="p">;</span>
<span class="n">spi</span><span class="p">.</span><span class="n">Direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_DIRECTION_2LINES</span><span class="p">;</span><span class="w"> </span><span class="c1">// å…¨åŒå·¥</span>
<span class="n">spi</span><span class="p">.</span><span class="n">DataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_DATASIZE_8BIT</span><span class="p">;</span>
<span class="n">spi</span><span class="p">.</span><span class="n">CLKPolarity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_POLARITY_LOW</span><span class="p">;</span><span class="w">   </span><span class="c1">// CPOL=0</span>
<span class="n">spi</span><span class="p">.</span><span class="n">CLKPhase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_PHASE_1EDGE</span><span class="p">;</span><span class="w">       </span><span class="c1">// CPHA=0</span>
<span class="n">spi</span><span class="p">.</span><span class="n">NSS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI_NSS_SOFT</span><span class="p">;</span><span class="w">               </span><span class="c1">// è½¯ä»¶æ§åˆ¶CS</span>
<span class="n">HAL_SPI_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spi</span><span class="p">);</span>
</code></pre></div>
<hr />
<h3 id="_20"><strong>æ€»ç»“</strong></h3>
<ul>
<li><strong>UART</strong>ï¼šç®€å•çµæ´»ï¼Œé€‚åˆæ¾æ•£è€¦åˆçš„å¼‚æ­¥é€šä¿¡  </li>
<li><strong>I2C</strong>ï¼šå¼•è„šé«˜æ•ˆï¼Œé€‚åˆä¸­ä½é€Ÿå¤šè®¾å¤‡åœºæ™¯  </li>
<li><strong>SPI</strong>ï¼šæ€§èƒ½ç‹è€…ï¼Œä¸“ä¸ºé«˜é€Ÿå…¨åŒå·¥è®¾è®¡ 
æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åè®®ï¼Œå¹¶ç»“åˆç¡¬ä»¶è®¾è®¡ä¸ä¿¡å·å®Œæ•´æ€§ä¼˜åŒ–ï¼Œå¯æ„å»ºç¨³å®šå¯é çš„åµŒå…¥å¼é€šä¿¡ç³»ç»Ÿã€‚</li>
</ul>
<hr />
<blockquote>
<p>è¡¥å……ï¼ŒSPI å¯èƒ½æ¯”è¾ƒå¤æ‚ã€‚å¿«é€Ÿè¿‡ä¸€éï¼š</p>
<h3 id="spi"><strong>SPI åè®®ä»é›¶è¯¦è§£ï¼ˆè¶…è¯¦ç»†ä¿å§†çº§æ•™ç¨‹ï¼‰</strong></h3>
<hr />
<h4 id="spi_1"><strong>ä¸€ã€SPI æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h4>
<p>SPIï¼ˆSerial Peripheral Interfaceï¼‰æ˜¯ä¸€ç§<strong>åŒæ­¥ã€å…¨åŒå·¥ã€ä¸»ä»å¼</strong>çš„ä¸²è¡Œé€šä¿¡åè®®ï¼Œä¸“é—¨ç”¨äºçŸ­è·ç¦»é«˜é€Ÿé€šä¿¡ï¼ˆé€šå¸¸èŠ¯ç‰‡é—´è·ç¦» &lt; 1ç±³ï¼‰ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š
- <strong>åŒæ­¥</strong>ï¼šé€šä¿¡åŒæ–¹å…±ç”¨æ—¶é’Ÿä¿¡å·ï¼ˆSCLKï¼‰
- <strong>å…¨åŒå·¥</strong>ï¼šå¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®
- <strong>ä¸»ä»æ¶æ„</strong>ï¼š1ä¸ªä¸»è®¾å¤‡æ§åˆ¶æ€»çº¿ï¼Œå¤šä¸ªä»è®¾å¤‡é€šè¿‡ç‰‡é€‰ä¿¡å·ï¼ˆCSï¼‰è¿æ¥</p>
<p>ç±»æ¯”ç†è§£ï¼šæƒ³è±¡ä¸»è®¾å¤‡æ˜¯è€å¸ˆï¼Œä»è®¾å¤‡æ˜¯å­¦ç”Ÿã€‚è€å¸ˆé€šè¿‡ç‚¹åï¼ˆCSä¿¡å·ï¼‰é€‰æ‹©è¦æé—®çš„å­¦ç”Ÿï¼Œç„¶åç”¨ç»Ÿä¸€çš„é“ƒå£°ï¼ˆSCLKï¼‰æ§åˆ¶é—®ç­”èŠ‚å¥ï¼Œå­¦ç”Ÿå’Œè€å¸ˆå¯ä»¥åŒæ—¶è¯´è¯å’Œå¬è®²ã€‚</p>
<hr />
<h4 id="spi_2"><strong>äºŒã€SPI çš„ç‰©ç†è¿æ¥</strong></h4>
<p>SPI éœ€è¦è‡³å°‘ <strong>4 æ ¹ç‰©ç†çº¿è·¯</strong>ï¼š
| çº¿å      | å…¨ç§°                     | æ–¹å‘                | ä½œç”¨                                           |
| --------- | ------------------------ | ------------------- | ---------------------------------------------- |
| <strong>SCLK</strong>  | Serial Clock             | ä¸»â†’ä»               | ä¸»è®¾å¤‡äº§ç”Ÿçš„åŒæ­¥æ—¶é’Ÿä¿¡å·                       |
| <strong>MOSI</strong>  | Master Out Slave In      | ä¸»â†’ä»               | ä¸»è®¾å¤‡å‘é€æ•°æ®ï¼Œä»è®¾å¤‡æ¥æ”¶æ•°æ®                 |
| <strong>MISO</strong>  | Master In Slave Out      | ä»â†’ä¸»               | ä»è®¾å¤‡å‘é€æ•°æ®ï¼Œä¸»è®¾å¤‡æ¥æ”¶æ•°æ®                 |
| <strong>CS/SS</strong> | Chip Select/Slave Select | ä¸»â†’ä»ï¼ˆæ¯ä¸ªä»ç‹¬ç«‹ï¼‰ | ä¸»è®¾å¤‡é€šè¿‡æ‹‰ä½æ­¤çº¿é€‰ä¸­ç‰¹å®šä»è®¾å¤‡ï¼ˆç±»ä¼¼"ç‚¹å"ï¼‰ |</p>
<p><strong>ç¡¬ä»¶è¿æ¥ç¤ºæ„å›¾</strong>ï¼š</p>
<div class="highlight"><pre><span></span><code>ä¸»è®¾å¤‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚     CS1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SCLK â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€SCLK         â”‚
â”‚   MOSI â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€MOSI         â”‚
â”‚   MISO â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€MISO         â”‚
â”‚              â”‚     CS2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                ä»è®¾å¤‡1 ä»è®¾å¤‡2
                                â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
                                â”‚     â”‚ â”‚     â”‚
                                â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<hr />
<h4 id="spi_3"><strong>ä¸‰ã€SPI æ—¶åºæ·±åº¦è§£æ</strong></h4>
<h5 id="1_7"><strong>1. æ—¶é’Ÿæ¨¡å¼ï¼ˆå…³é”®éš¾ç‚¹ï¼ï¼‰</strong></h5>
<p>SPI æœ‰ <strong>4 ç§å·¥ä½œæ¨¡å¼</strong>ï¼Œç”±ä¸¤ä¸ªå‚æ•°å†³å®šï¼š
- <strong>CPOLï¼ˆClock Polarityï¼‰</strong>ï¼šæ—¶é’Ÿç©ºé—²æ—¶çš„ç”µå¹³
  - 0ï¼šç©ºé—²æ—¶ SCLK ä¸ºä½ç”µå¹³
  - 1ï¼šç©ºé—²æ—¶ SCLK ä¸ºé«˜ç”µå¹³
- <strong>CPHAï¼ˆClock Phaseï¼‰</strong>ï¼šæ•°æ®é‡‡æ ·æ—¶åˆ»
  - 0ï¼šåœ¨æ—¶é’Ÿçš„<strong>ç¬¬ä¸€ä¸ªè¾¹æ²¿</strong>ï¼ˆä¸Šå‡æ²¿æˆ–ä¸‹é™æ²¿ï¼‰é‡‡æ ·æ•°æ®
  - 1ï¼šåœ¨æ—¶é’Ÿçš„<strong>ç¬¬äºŒä¸ªè¾¹æ²¿</strong>é‡‡æ ·æ•°æ®</p>
<p><strong>å››ç§æ¨¡å¼å¯¹ç…§è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>CPOL</th>
<th>CPHA</th>
<th>é‡‡æ ·æ—¶åˆ»</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>ä¸Šå‡æ²¿é‡‡æ ·ï¼ˆæ—¶é’Ÿä»ä½â†’é«˜ï¼‰</td>
<td>å¤§å¤šæ•°ä¼ æ„Ÿå™¨</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
<td>ä¸‹é™æ²¿é‡‡æ ·ï¼ˆæ—¶é’Ÿä»é«˜â†’ä½ï¼‰</td>
<td>æŸäº›å­˜å‚¨å™¨</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>0</td>
<td>ä¸‹é™æ²¿é‡‡æ ·ï¼ˆæ—¶é’Ÿä»é«˜â†’ä½ï¼‰</td>
<td>é«˜é€Ÿ ADC/DAC</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>1</td>
<td>ä¸Šå‡æ²¿é‡‡æ ·ï¼ˆæ—¶é’Ÿä»ä½â†’é«˜ï¼‰</td>
<td>ç‰¹æ®Šåè®®è®¾å¤‡</td>
</tr>
</tbody>
</table>
<p><strong>Mode 0 æ—¶åºå›¾è¯¦è§£</strong>ï¼š</p>
<p><div class="highlight"><pre><span></span><code>SCLK   ___     ÍÌ„ ÍÌ„ ÍÌ„ ÍÌ„ ÍÌ„ ÍÌ„ ÍÌ„ ÍÌ„     ___ 
       Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯
       | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |  &lt;- æ—¶é’Ÿå‘¨æœŸ
MOSI   ----[D7]---[D6]---[D5]---[D4]---...
       ___                     ___
MISO   Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯Í Â¯
</code></pre></div>
- æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸä¼ è¾“ 1 bit æ•°æ®ï¼ˆ8 ä¸ªå‘¨æœŸä¼  1 å­—èŠ‚ï¼‰
- æ•°æ®åœ¨ SCLK çš„<strong>ä¸Šå‡æ²¿è¢«é‡‡æ ·</strong>
- ä¸»ä»è®¾å¤‡åœ¨ SCLK çš„<strong>ä¸‹é™æ²¿åˆ‡æ¢æ•°æ®</strong></p>
<hr />
<h5 id="2-mode-0"><strong>2. å®Œæ•´é€šä¿¡æµç¨‹ï¼ˆä»¥ Mode 0 ä¸ºä¾‹ï¼‰</strong></h5>
<ol>
<li><strong>ç‰‡é€‰æ¿€æ´»</strong>ï¼šä¸»è®¾å¤‡æ‹‰ä½ç›®æ ‡ä»è®¾å¤‡çš„ CS çº¿</li>
<li><strong>æ—¶é’Ÿå¯åŠ¨</strong>ï¼šä¸»è®¾å¤‡å¼€å§‹äº§ç”Ÿ SCLK ä¿¡å·</li>
<li><strong>æ•°æ®ä¼ è¾“</strong>ï¼š</li>
<li><strong>ä¸»â†’ä»</strong>ï¼šä¸»è®¾å¤‡åœ¨ SCLK ä¸‹é™æ²¿å°†æ•°æ®æ”¾åˆ° MOSI çº¿ä¸Š</li>
<li><strong>ä»â†’ä¸»</strong>ï¼šä»è®¾å¤‡åœ¨ SCLK ä¸‹é™æ²¿å°†æ•°æ®æ”¾åˆ° MISO çº¿ä¸Š</li>
<li><strong>æ•°æ®é‡‡æ ·</strong>ï¼šåŒæ–¹åœ¨ SCLK ä¸Šå‡æ²¿è¯»å–å¯¹æ–¹çš„æ•°æ®</li>
<li><strong>ä¼ è¾“ç»“æŸ</strong>ï¼šä¸»è®¾å¤‡æ‹‰é«˜ CS çº¿</li>
</ol>
<p><strong>å…³é”®ç‰¹ç‚¹</strong>ï¼š
- <strong>å…¨åŒå·¥ä¼˜åŠ¿</strong>ï¼šæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸåŒæ—¶æ”¶å‘ 1 bit æ•°æ®
- <strong>æ— åœ°å€å­—æ®µ</strong>ï¼šå®Œå…¨ä¾èµ–ç¡¬ä»¶ç‰‡é€‰ï¼ˆCSï¼‰
- <strong>æ— ç¡®è®¤æœºåˆ¶</strong>ï¼šå‡è®¾ç‰©ç†è¿æ¥å¯é </p>
<hr />
<h4 id="spi_4"><strong>å››ã€SPI çš„ç¡¬ä»¶å®ç°ç»†èŠ‚</strong></h4>
<h5 id="1_8"><strong>1. ç”µè·¯è®¾è®¡è¦ç‚¹</strong></h5>
<ul>
<li><strong>æ¨æŒ½è¾“å‡º</strong>ï¼šSPI é€šå¸¸é‡‡ç”¨æ¨æŒ½é©±åŠ¨ï¼Œæ— éœ€ä¸Šæ‹‰ç”µé˜»</li>
<li><strong>ç‰‡é€‰ç®¡ç†</strong>ï¼šæ¯ä¸ªä»è®¾å¤‡éœ€è¦ç‹¬ç«‹çš„ CS çº¿ï¼ˆN ä¸ªä»è®¾å¤‡éœ€è¦ N+3 æ ¹çº¿ï¼‰</li>
<li><strong>ç”µå¹³åŒ¹é…</strong>ï¼šç¡®ä¿ä¸»ä»è®¾å¤‡ç”µå‹ä¸€è‡´ï¼ˆ3.3V ä¸ 5V è®¾å¤‡éœ€ç”µå¹³è½¬æ¢ï¼‰</li>
</ul>
<h5 id="2_4"><strong>2. é€Ÿåº¦ä¼˜åŒ–æŠ€å·§</strong></h5>
<ul>
<li><strong>æ—¶é’Ÿé¢‘ç‡</strong>ï¼šå¯è¾¾ 50MHz+ï¼ˆSTM32H7 ç³»åˆ—æ”¯æŒ 133MHzï¼‰</li>
<li><strong>DMA ä¼ è¾“</strong>ï¼šå‡å°‘ CPU å‚ä¸ï¼ˆé€‚åˆå¤§æ•°æ®å—ä¼ è¾“ï¼‰</li>
<li><strong>åŒçº¿æ¨¡å¼</strong>ï¼šå…³é—­ MISO æˆ– MOSI å®ç°åŠåŒå·¥ï¼ˆèŠ‚çœå¼•è„šï¼‰</li>
</ul>
<hr />
<h4 id="spi-arduino"><strong>äº”ã€SPI æ¨¡å¼é…ç½®å®æˆ˜ï¼ˆä»¥ Arduino ä¸ºä¾‹ï¼‰</strong></h4>
<p><div class="highlight"><pre><span></span><code><span class="c1">// é…ç½® SPI ä¸º Mode 0ï¼Œé¢‘ç‡ 1MHz</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;SPI.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="n">MSBFIRST</span><span class="p">,</span><span class="w"> </span><span class="n">SPI_MODE0</span><span class="p">));</span>
<span class="w">  </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">SS</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span><span class="w">  </span><span class="c1">// é€‰ä¸­ä»è®¾å¤‡</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">// å‘é€æ•°æ® 0x55 å¹¶æ¥æ”¶è¿”å›æ•°æ®</span>
<span class="w">  </span><span class="n">byte</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x55</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span>
<span class="w">  </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">SS</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="w">  </span><span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<strong>å‚æ•°è¯´æ˜</strong>ï¼š
- <code>1000000</code>ï¼šSCLK é¢‘ç‡ï¼ˆ1MHzï¼‰
- <code>MSBFIRST</code>ï¼šæ•°æ®ä¼ è¾“ä»æœ€é«˜ä½å¼€å§‹
- <code>SPI_MODE0</code>ï¼šé€‰æ‹©æ¨¡å¼ 0</p>
<hr />
<h4 id="spi_5"><strong>å…­ã€SPI çš„ä¼˜ç¼ºç‚¹</strong></h4>
<table>
<thead>
<tr>
<th><strong>ä¼˜ç‚¹</strong></th>
<th><strong>ç¼ºç‚¹</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>å…¨åŒå·¥é«˜é€Ÿä¼ è¾“ï¼ˆç†è®ºæ— é™é€Ÿï¼‰</td>
<td>éœ€è¦è¾ƒå¤šç‰©ç†çº¿è·¯ï¼ˆN+3ï¼‰</td>
</tr>
<tr>
<td>æ— å¤æ‚åè®®æ ˆï¼ˆå®ç°ç®€å•ï¼‰</td>
<td>æ— ç¡¬ä»¶çº§é”™è¯¯æ£€æµ‹</td>
</tr>
<tr>
<td>æ”¯æŒå¤šä»è®¾å¤‡æ‰©å±•</td>
<td>ä¼ è¾“è·ç¦»çŸ­ï¼ˆé€šå¸¸ &lt; 1mï¼‰</td>
</tr>
<tr>
<td>çµæ´»çš„æ—¶é’Ÿæ¨¡å¼é…ç½®</td>
<td>éœ€è¦ä¸¥æ ¼åŒæ­¥æ—¶é’Ÿ</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="_21"><strong>ä¸ƒã€ç»å…¸åº”ç”¨åœºæ™¯</strong></h4>
<ol>
<li><strong>å­˜å‚¨å™¨èŠ¯ç‰‡</strong>  </li>
<li>Flash èŠ¯ç‰‡ï¼ˆå¦‚ W25Q128ï¼‰ï¼šåˆ©ç”¨ SPI é«˜é€Ÿè¯»å–å›ºä»¶</li>
<li>
<p>SD å¡ï¼ˆSPI æ¨¡å¼ï¼‰ï¼šå…¼å®¹ä½å¼•è„šæ•°å¾®æ§åˆ¶å™¨</p>
</li>
<li>
<p><strong>æ˜¾ç¤ºè®¾å¤‡</strong>  </p>
</li>
<li>OLED å±å¹•ï¼ˆSSD1306ï¼‰ï¼šé€šè¿‡ SPI å¿«é€Ÿåˆ·æ–°åƒç´ </li>
<li>
<p>TFT æ¶²æ™¶å±ï¼šä¼ è¾“å›¾åƒæ•°æ®</p>
</li>
<li>
<p><strong>ä¼ æ„Ÿå™¨</strong>  </p>
</li>
<li>åŠ é€Ÿåº¦è®¡ï¼ˆMPU6050ï¼‰ï¼šå®æ—¶è¯»å–è¿åŠ¨æ•°æ®</li>
<li>
<p>æ•°å­—éº¦å…‹é£ï¼ˆMP34DT01ï¼‰ï¼šä¼ è¾“éŸ³é¢‘æµ</p>
</li>
<li>
<p><strong>æ— çº¿æ¨¡å—</strong>  </p>
</li>
<li>WiFi æ¨¡å—ï¼ˆESP8266ï¼‰ï¼šé«˜é€Ÿä¼ è¾“ç½‘ç»œæ•°æ®</li>
<li>è“ç‰™æ¨¡å—ï¼ˆHC-05ï¼‰ï¼šé…ç½®å‚æ•°å’Œä¼ è¾“æ•°æ®</li>
</ol>
<hr />
<h4 id="_22"><strong>å…«ã€å­¦ä¹ è·¯çº¿å»ºè®®</strong></h4>
<ol>
<li><strong>åŸºç¡€å®éªŒ</strong>ï¼šç”¨ Arduino æ§åˆ¶ SPI Flash èŠ¯ç‰‡ï¼ˆè¯»å†™æµ‹è¯•ï¼‰</li>
<li><strong>ç¤ºæ³¢å™¨è§‚æµ‹</strong>ï¼šæ•è· SCLK/MOSI/MISO æ³¢å½¢ï¼ˆç†è§£æ—¶åºï¼‰</li>
<li><strong>åè®®åˆ†æ</strong>ï¼šä½¿ç”¨é€»è¾‘åˆ†æä»ªè§£ç  SPI æ•°æ®</li>
<li><strong>è¿›é˜¶åº”ç”¨</strong>ï¼šå®ç° DMA ä¼ è¾“ä¼˜åŒ–ï¼ˆå¦‚ STM32 CubeMXï¼‰</li>
<li><strong>æ•…éšœæ’æŸ¥</strong>ï¼š</li>
<li><strong>æ— å“åº”</strong>ï¼šæ£€æŸ¥ CS ä¿¡å·æ˜¯å¦æ¿€æ´»</li>
<li><strong>æ•°æ®é”™è¯¯</strong>ï¼šç¡®è®¤æ—¶é’Ÿæ¨¡å¼æ˜¯å¦åŒ¹é…</li>
<li><strong>ä¿¡å·å¤±çœŸ</strong>ï¼šç¼©çŸ­çº¿é•¿æˆ–é™ä½æ—¶é’Ÿé¢‘ç‡</li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šç³»ç»Ÿå­¦ä¹ ï¼Œæ‚¨å°†èƒ½ç†Ÿç»ƒæŒæ¡ SPI åè®®çš„è®¾è®¡ä¸è°ƒè¯•ï¼</p>
</blockquote>
</li>
<li>
<p>å®ç°çº¿ç¨‹å®‰å…¨</p>
<hr />
<h3 id="_23">ğŸ”¥ <strong>å¤šæ ¸ç¯å¢ƒä¸‹çš„å¹¶å‘å®‰å…¨æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</strong></h3>
<p>å¤šæ ¸ç³»ç»Ÿçš„å¹¶å‘é—®é¢˜æ¯”å•æ ¸å¤æ‚æ•°ä¸ªæ•°é‡çº§ï¼Œå…¶æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºï¼š<br />
1. <strong>ç¡¬ä»¶å¹¶è¡Œæ€§</strong>ï¼šå¤šä¸ªç‰©ç†æ ¸å¿ƒ<strong>åŒæ—¶æ‰§è¡ŒæŒ‡ä»¤</strong>ï¼Œå¯¹å…±äº«èµ„æºçš„è®¿é—®å¯èƒ½çœŸæ­£å¹¶è¡Œã€‚<br />
2. <strong>ç¼“å­˜ä¸€è‡´æ€§</strong>ï¼šå„æ ¸å¿ƒç¼“å­˜ä¸­çš„å…±äº«æ•°æ®å‰¯æœ¬éœ€é€šè¿‡åè®®ï¼ˆå¦‚MESIï¼‰åŒæ­¥ï¼Œä½†ä»éœ€è½¯ä»¶ä»‹å…¥ä¿è¯å¯è§æ€§ã€‚<br />
3. <strong>å†…å­˜ä¹±åº</strong>ï¼šCPU/ç¼–è¯‘å™¨å¯èƒ½å¯¹æŒ‡ä»¤é‡æ’ï¼Œå¯¼è‡´æ„å¤–è¡Œä¸ºã€‚  </p>
<p>ä»¥ä¸‹ä¸ºå¤šæ ¸è£¸æœºç³»ç»Ÿçš„ä¸“ä¸šçº§è§£å†³æ–¹æ¡ˆï¼š</p>
<hr />
<h3 id="_24">ğŸ§  <strong>å¤šæ ¸åŒæ­¥æ ¸å¿ƒåŸç†</strong></h3>
<h4 id="1-memory-order"><strong>1. åŸå­æ“ä½œä¸å†…å­˜åºï¼ˆMemory Orderï¼‰</strong></h4>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼šç¡®ä¿æ“ä½œä¸å¯åˆ†å‰²ï¼ˆå¦‚ <code>atomic_add</code>ï¼‰ã€‚  </li>
<li><strong>å¯è§æ€§</strong>ï¼šä¿®æ”¹åçš„å€¼å¯¹å…¶ä»–æ ¸å¿ƒç«‹å³å¯è§ï¼ˆé€šè¿‡å†…å­˜å±éšœå¼ºåˆ¶åˆ·æ–°ç¼“å­˜ï¼‰ã€‚  </li>
<li><strong>é¡ºåºæ€§</strong>ï¼šé˜²æ­¢æŒ‡ä»¤é‡æ’ç ´åé€»è¾‘ï¼ˆä½¿ç”¨ <code>acquire</code>/<code>release</code> è¯­ä¹‰ï¼‰ã€‚  </li>
</ul>
<h4 id="2_5"><strong>2. ç¼“å­˜ä¸€è‡´æ€§åè®®</strong></h4>
<ul>
<li><strong>MESIåè®®</strong>ï¼šç¼“å­˜è¡ŒçŠ¶æ€åˆ†ä¸º Modified/Exclusive/Shared/Invalidï¼Œç¡¬ä»¶è‡ªåŠ¨ç»´æŠ¤ä¸€è‡´æ€§ã€‚  </li>
<li><strong>ä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰</strong>ï¼šä¸åŒæ ¸å¿ƒé¢‘ç¹ä¿®æ”¹åŒä¸€ç¼“å­˜è¡Œçš„ä¸åŒå˜é‡ï¼Œå¯¼è‡´æ€§èƒ½æš´è·Œã€‚éœ€å¯¹é½æ•°æ®ç»“æ„è‡³ç¼“å­˜è¡Œå¤§å°ï¼ˆé€šå¸¸64å­—èŠ‚ï¼‰ã€‚  </li>
</ul>
<hr />
<h3 id="_25">ğŸ› ï¸ <strong>å¤šæ ¸åŒæ­¥æ–¹æ¡ˆå®ç°</strong></h3>
<h4 id="1-spinlock"><strong>1. è‡ªæ—‹é”ï¼ˆSpinlockï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡åŸå­æŒ‡ä»¤å®ç°å¿™ç­‰å¾…é”ï¼Œé€‚ç”¨äº<strong>çŸ­æœŸä¸´ç•ŒåŒº</strong>ã€‚  </li>
<li><strong>ä»£ç å®ç°</strong>ï¼ˆARMv8æ±‡ç¼–+Cå°è£…ï¼‰ï¼š<br />
  <div class="highlight"><pre><span></span><code><span class="c1">// è‡ªæ—‹é”ç»“æ„ä½“ï¼ˆå¯¹é½åˆ°ç¼“å­˜è¡Œé¿å…ä¼ªå…±äº«ï¼‰</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">64</span><span class="p">)));</span><span class="w">  </span>
<span class="p">}</span><span class="w"> </span><span class="n">spinlock_t</span><span class="p">;</span><span class="w">  </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">spinlock_lock</span><span class="p">(</span><span class="n">spinlock_t</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="c1">// ä½¿ç”¨LDREX/STREXå®ç°åŸå­CAS  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">__LDREXW</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="c1">// æ£€æŸ¥æ˜¯å¦æœªé”å®š  </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">__STREXW</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// å°è¯•åŠ é”  </span>
<span class="w">                </span><span class="n">__DMB</span><span class="p">();</span><span class="w">                     </span><span class="c1">// å†…å­˜å±éšœä¿è¯åç»­æ“ä½œå¯è§æ€§  </span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
<span class="w">        </span><span class="p">}</span><span class="w">  </span>
<span class="w">        </span><span class="n">__WFE</span><span class="p">();</span><span class="w">                            </span><span class="c1">// è¿›å…¥ä½åŠŸè€—ç­‰å¾…çŠ¶æ€ï¼ˆARMæŒ‡ä»¤ï¼‰  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">spinlock_unlock</span><span class="p">(</span><span class="n">spinlock_t</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">__DMB</span><span class="p">();</span><span class="w">                                </span><span class="c1">// ä¿è¯ä¸´ç•ŒåŒºæ“ä½œå®Œæˆ  </span>
<span class="w">    </span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="n">__SEV</span><span class="p">();</span><span class="w">                                </span><span class="c1">// å”¤é†’å…¶ä»–æ ¸å¿ƒï¼ˆARMæŒ‡ä»¤ï¼‰  </span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div></li>
<li><strong>å…³é”®ä¼˜åŒ–</strong>ï¼š  </li>
<li>ä½¿ç”¨ <code>__WFE()</code>/<code>__SEV()</code> å‡å°‘å¿™ç­‰å¾…åŠŸè€—ã€‚  </li>
<li>å¯¹é½é”ç»“æ„ä½“åˆ°ç¼“å­˜è¡Œï¼Œé¿å…ä¼ªå…±äº«ã€‚  </li>
</ul>
<hr />
<h4 id="2-read-write-lock"><strong>2. è¯»å†™é”ï¼ˆRead-Write Lockï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šåŒºåˆ†è¯»é”ï¼ˆå…±äº«ï¼‰å’Œå†™é”ï¼ˆç‹¬å ï¼‰ï¼Œæå‡è¯»å¤šå†™å°‘åœºæ™¯æ€§èƒ½ã€‚  </li>
<li><strong>å®ç°</strong>ï¼ˆåŸºäºåŸå­è®¡æ•°å™¨ï¼‰ï¼š<br />
  <div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_t</span><span class="w"> </span><span class="n">guard</span><span class="p">;</span><span class="w">      </span><span class="c1">// ä¿æŠ¤å†…éƒ¨çŠ¶æ€  </span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">readers</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">writer</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0=æ— å†™è€…ï¼Œ1=æœ‰å†™è€…  </span>
<span class="p">}</span><span class="w"> </span><span class="n">rwlock_t</span><span class="p">;</span><span class="w">  </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">read_lock</span><span class="p">(</span><span class="n">rwlock_t</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">writer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// ç­‰å¾…å†™è€…é‡Šæ”¾  </span>
<span class="w">        </span><span class="n">spinlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">        </span><span class="n">spinlock_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">readers</span><span class="o">++</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">write_lock</span><span class="p">(</span><span class="n">rwlock_t</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">writer</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">readers</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="n">spinlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">        </span><span class="n">spinlock_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="o">-&gt;</span><span class="n">guard</span><span class="p">);</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div></li>
</ul>
<hr />
<h4 id="3-rcuread-copy-update"><strong>3. RCUï¼ˆRead-Copy-Updateï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œå¤åˆ¶æ•°æ®ååŸå­æ›¿æ¢æŒ‡é’ˆï¼Œå»¶è¿Ÿé‡Šæ”¾æ—§æ•°æ®ã€‚  </li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¯»æå¤šå†™æå°‘ï¼ˆå¦‚è·¯ç”±è¡¨ã€é…ç½®æ•°æ®ï¼‰ã€‚  </li>
<li><strong>å®ç°æ­¥éª¤</strong>ï¼š  </li>
<li><strong>å†™è€…</strong>ï¼š  <ul>
<li>å¤åˆ¶å¾…ä¿®æ”¹æ•°æ®ç”Ÿæˆæ–°ç‰ˆæœ¬ã€‚  </li>
<li>åŸå­æ›¿æ¢å…¨å±€æŒ‡é’ˆæŒ‡å‘æ–°æ•°æ®ã€‚  </li>
<li>å»¶è¿Ÿé‡Šæ”¾æ—§æ•°æ®ï¼ˆç¡®ä¿æ‰€æœ‰è¯»è€…å·²é€€å‡ºä¸´ç•ŒåŒºï¼‰ã€‚  </li>
</ul>
</li>
<li><strong>è¯»è€…</strong>ï¼š  <ul>
<li>ç›´æ¥è¯»å–å…¨å±€æŒ‡é’ˆï¼Œæ— éœ€åŠ é”ã€‚  </li>
</ul>
</li>
</ul>
<hr />
<h4 id="4-lock-free-queue"><strong>4. æ— é”æ•°æ®ç»“æ„ï¼ˆLock-Free Queueï¼‰</strong></h4>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡CASåŸå­æŒ‡ä»¤å®ç°æ— é”é˜Ÿåˆ—ï¼Œé¿å…çº¿ç¨‹é˜»å¡ã€‚  </li>
<li><strong>å®ç°</strong>ï¼ˆå¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…MPMCé˜Ÿåˆ—ï¼‰ï¼š<br />
  <div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">head</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">tail</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="p">];</span><span class="w">  </span>
<span class="p">}</span><span class="w"> </span><span class="n">lockfree_queue_t</span><span class="p">;</span><span class="w">  </span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">enqueue</span><span class="p">(</span><span class="n">lockfree_queue_t</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">curr_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__atomic_load_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELAXED</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">next_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">curr_tail</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_tail</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">__atomic_load_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_ACQUIRE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// é˜Ÿåˆ—æ»¡  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">curr_tail</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="n">__atomic_store_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">,</span><span class="w"> </span><span class="n">next_tail</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELEASE</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">dequeue</span><span class="p">(</span><span class="n">lockfree_queue_t</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">curr_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__atomic_load_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELAXED</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">curr_head</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">__atomic_load_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_ACQUIRE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// é˜Ÿåˆ—ç©º  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="o">*</span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">curr_head</span><span class="p">];</span><span class="w">  </span>
<span class="w">    </span><span class="n">__atomic_store_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">curr_head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">QUEUE_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELEASE</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div></li>
<li><strong>å†…å­˜åºè¯´æ˜</strong>ï¼š  </li>
<li><code>__ATOMIC_ACQUIRE</code>ï¼šä¿è¯åç»­è¯»å†™ä¸ä¼šé‡æ’åˆ°è¯¥æ“ä½œä¹‹å‰ã€‚  </li>
<li><code>__ATOMIC_RELEASE</code>ï¼šä¿è¯ä¹‹å‰è¯»å†™ä¸ä¼šé‡æ’åˆ°è¯¥æ“ä½œä¹‹åã€‚  </li>
</ul>
<hr />
<h3 id="_26">âš¡ <strong>å¤šæ ¸åŒæ­¥æ€§èƒ½ä¼˜åŒ–æŠ€å·§</strong></h3>
<ol>
<li><strong>æ•°æ®å±€éƒ¨æ€§è®¾è®¡</strong>ï¼š  </li>
<li>
<p>æ¯ä¸ªæ ¸å¿ƒç»´æŠ¤ç‹¬ç«‹æ•°æ®ç»“æ„ï¼ˆå¦‚Per-CPUå˜é‡ï¼‰ï¼Œå‡å°‘å…±äº«å†²çªã€‚<br />
   <div class="highlight"><pre><span></span><code><span class="c1">// Per-CPUè®¡æ•°å™¨ï¼ˆARMv8è·å–CPU IDï¼‰  </span>
<span class="cp">#define get_cpu_id() (__builtin_arm_rsr64(&quot;MPIDR_EL1&quot;) &amp; 0xFF)  </span>
<span class="kt">uint64_t</span><span class="w"> </span><span class="n">counters</span><span class="p">[</span><span class="n">NR_CPUS</span><span class="p">]</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">64</span><span class="p">)));</span><span class="w">  </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">increment_counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">counters</span><span class="p">[</span><span class="n">get_cpu_id</span><span class="p">()]</span><span class="o">++</span><span class="p">;</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div></p>
</li>
<li>
<p><strong>åˆ†å±‚é”ï¼ˆHierarchical Lockingï¼‰</strong>ï¼š  </p>
</li>
<li>
<p>ç²—ç²’åº¦é”ä¿æŠ¤å¤§èŒƒå›´æ•°æ®ï¼Œç»†ç²’åº¦é”ä¿æŠ¤å­ç»“æ„ï¼Œé™ä½é”äº‰ç”¨ã€‚  </p>
</li>
<li>
<p><strong>é¿å…é” convoy æ•ˆåº”</strong>ï¼š  </p>
</li>
<li>ä½¿ç”¨ try_lock è€Œéé˜»å¡é”ï¼Œå¤±è´¥åæ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚  </li>
</ol>
<hr />
<h3 id="_27">ğŸ›‘ <strong>å¤šæ ¸è°ƒè¯•ä¸éªŒè¯</strong></h3>
<ol>
<li><strong>ç¡¬ä»¶è§‚å¯Ÿç‚¹</strong>ï¼š  </li>
<li>
<p>ä½¿ç”¨è°ƒè¯•å™¨ï¼ˆå¦‚JTAGï¼‰è®¾ç½®å†…å­˜ç›‘è§†ç‚¹ï¼Œæ•è·éæ³•è®¿é—®ã€‚  </p>
</li>
<li>
<p><strong>å½¢å¼åŒ–éªŒè¯å·¥å…·</strong>ï¼š  </p>
</li>
<li>
<p>ä½¿ç”¨SPINã€TLA+ç­‰å·¥å…·å¯¹åŒæ­¥åè®®å»ºæ¨¡éªŒè¯ã€‚  </p>
</li>
<li>
<p><strong>å‹åŠ›æµ‹è¯•</strong>ï¼š  </p>
</li>
<li>å¯åŠ¨å¤šä¸ªæ ¸å¿ƒåŒæ—¶é«˜é¢‘æ“ä½œå…±äº«èµ„æºï¼Œæ³¨å…¥éšæœºå»¶è¿Ÿï¼š<br />
   <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">test_spinlock</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="n">spinlock_t</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="w">  </span>
<span class="w">    </span><span class="n">parallel_run_on_all_cores</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mf">1e6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">            </span><span class="n">spinlock_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span><span class="w">  </span>
<span class="w">            </span><span class="n">shared_data</span><span class="o">++</span><span class="p">;</span><span class="w">  </span>
<span class="w">            </span><span class="n">spinlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span><span class="w">  </span>
<span class="w">            </span><span class="n">random_delay</span><span class="p">();</span><span class="w">  </span>
<span class="w">        </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="p">});</span><span class="w">  </span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div></li>
</ol>
<hr />
<h3 id="_28">ğŸ“Š <strong>å¤šæ ¸åŒæ­¥æ–¹æ¡ˆé€‰å‹è¡¨</strong></h3>
<table>
<thead>
<tr>
<th><strong>åœºæ™¯</strong></th>
<th><strong>æ¨èæ–¹æ¡ˆ</strong></th>
<th><strong>æ€§èƒ½</strong></th>
<th><strong>å¤æ‚åº¦</strong></th>
<th><strong>é€‚ç”¨æ ¸æ•°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>çŸ­ä¸´ç•ŒåŒº</td>
<td>è‡ªæ—‹é”</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>2-64</td>
</tr>
<tr>
<td>è¯»å¤šå†™å°‘</td>
<td>è¯»å†™é”/RCU</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>2-1024</td>
</tr>
<tr>
<td>æ— é˜»å¡æ•°æ®ä¼ é€’</td>
<td>æ— é”é˜Ÿåˆ—</td>
<td>â˜…â˜…â˜…â˜…â˜†</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>2-256</td>
</tr>
<tr>
<td>æé«˜é¢‘è®¡æ•°å™¨</td>
<td>Per-CPUå˜é‡+æ±‡æ€»</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜†â˜†â˜†</td>
<td>ä»»æ„</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="_29">âœ… <strong>å¤šæ ¸åŒæ­¥é»„é‡‘æ³•åˆ™</strong></h3>
<ol>
<li><strong>èƒ½ä¸å…±äº«å°±ä¸å…±äº«</strong>ï¼šé€šè¿‡æ¶æ„è®¾è®¡ï¼ˆå¦‚æ•°æ®åˆ†åŒºï¼‰å‡å°‘å…±äº«éœ€æ±‚ã€‚  </li>
<li><strong>èƒ½æ— é”å°±ä¸åŠ é”</strong>ï¼šä¼˜å…ˆä½¿ç”¨åŸå­æ“ä½œæˆ–æ— é”æ•°æ®ç»“æ„ã€‚  </li>
<li><strong>èƒ½ç»†ç²’åº¦å°±ä¸ç²—ç²’åº¦</strong>ï¼šå‡å°é”ç²’åº¦ï¼Œé™ä½äº‰ç”¨æ¦‚ç‡ã€‚  </li>
<li><strong>æ°¸è¿œå‡è®¾ä»£ç ä¼šè¢«ä¹±åºæ‰§è¡Œ</strong>ï¼šæ­£ç¡®ä½¿ç”¨å†…å­˜å±éšœï¼  </li>
</ol>
<p>å¤šæ ¸å¹¶å‘ç¼–ç¨‹æ˜¯è½¯ä»¶å·¥ç¨‹çš„å·…å³°æŒ‘æˆ˜ä¹‹ä¸€ï¼Œéœ€ç»“åˆç¡¬ä»¶ç‰¹æ€§ã€ç®—æ³•è®¾è®¡ã€éªŒè¯æ‰‹æ®µä¸‰ä½ä¸€ä½“æ–¹èƒ½æ„å»ºå¯é ç³»ç»Ÿã€‚</p>
</li>
</ul>
<h3 id="_30">ç®—æ³•</h3>
<p>ä¸¤å­—ç¬¦ä¸²è®¡ç®—å’Œï¼šâ€123â€œ + â€œ321â€  = 444 </p>
<p>ä¸€å¼€å§‹çš„ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="cp">#define MAX_LEN 1000</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">str1</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">],</span><span class="w"> </span><span class="n">str2</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">;</span>

<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">str1</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>
<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">str2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">str2</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>

<span class="w">    </span><span class="n">str1</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">str2</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">str2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">endptr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">endptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">num1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtoll</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endptr1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">num2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strtoll</span><span class="p">(</span><span class="n">str2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endptr2</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num2</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ä½†ä¹‹ååˆè¯´ï¼Œå­—ç¬¦ä¸²å¾ˆé•¿æ€ä¹ˆåŠã€‚</p>
<p>ç›´æ¥æ”¹æˆå¤§æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>

<span class="cp">#define MAX_LEN 1000</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">add_strings</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">len1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">len2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// åˆ›å»ºå¯ä¿®æ”¹çš„å‰¯æœ¬å¹¶åè½¬</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">n1</span><span class="p">);</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ç»“æœç¼“å†²åŒºï¼ˆå¤šä¸€ä½ç”¨äºè¿›ä½ï¼‰</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">max_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">n1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>

<span class="w">        </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å¤„ç†æœ€é«˜ä½è¿›ä½</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w">  </span><span class="c1">// æ¢å¤æ­£ç¡®é¡ºåº</span>

<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">n1</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">],</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// è¯»å–è¾“å…¥ï¼ˆå‡è®¾æ— å‰å¯¼ç©ºæ ¼å’Œéæ³•å­—ç¬¦ï¼‰</span>
<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num1</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>
<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num2</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>

<span class="w">    </span><span class="n">num1</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">num2</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_strings</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>æ¯”è¾ƒç®€å•ï¼ŒAIè§£æå³å¯ã€‚</p>
<blockquote>
<h3 id="_31"><strong>å¤§æ•°åŠ æ³•ç®—æ³•è¯¦è§£ï¼ˆå­—ç¬¦ä¸²å®ç°æ³•ï¼‰</strong></h3>
<hr />
<h4 id="_32"><strong>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å¤§æ•°åŠ æ³•ï¼Ÿ</strong></h4>
<p>å¸¸è§„çš„æ•´æ•°ç±»å‹ï¼ˆå¦‚ <code>int</code>ã€<code>long</code>ï¼‰æœ‰å­˜å‚¨ä¸Šé™ï¼š
- <code>int</code> æœ€å¤§çº¦ 21äº¿ï¼ˆ32ä½ï¼‰
- <code>unsigned long long</code> æœ€å¤§çº¦ 18è‰¾ï¼ˆ64ä½ï¼‰</p>
<p>å½“å¤„ç† <strong>è¶…è¿‡ 10^100 ä½</strong> çš„æ•°å­—ï¼ˆå¦‚å¯†ç å­¦ã€å¤©ä½“ç‰©ç†è®¡ç®—ï¼‰æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿæ‰‹å·¥è®¡ç®—ã€‚</p>
<hr />
<h4 id="_33"><strong>äºŒã€æ‰‹å·¥åŠ æ³•åŸç†å›é¡¾</strong></h4>
<p>ä»¥ <code>123 + 4567</code> ä¸ºä¾‹ï¼š
<div class="highlight"><pre><span></span><code>  0123
+ 4567
-------
  4690
</code></pre></div>
<strong>æ‰‹å·¥æ­¥éª¤</strong>ï¼š
1. ä¸ªä½å¯¹é½ï¼ˆ3+7=10ï¼Œå†™0è¿›1ï¼‰
2. åä½ç›¸åŠ ï¼ˆ2+6+1=9ï¼‰
3. ç™¾ä½ç›¸åŠ ï¼ˆ1+5=6ï¼‰
4. åƒä½è¡¥4</p>
<p><strong>æ ¸å¿ƒè§„å¾‹</strong>ï¼š
- <strong>ä»å³å‘å·¦</strong> é€ä½ç›¸åŠ 
- <strong>è¿›ä½</strong> éœ€è¦ä¼ é€’åˆ°é«˜ä½</p>
<hr />
<h4 id="_34"><strong>ä¸‰ã€ç®—æ³•å®ç°æ­¥éª¤åˆ†è§£</strong></h4>
<h5 id="1_9"><strong>æ­¥éª¤ 1ï¼šå­—ç¬¦ä¸²åè½¬</strong></h5>
<p><strong>ä¸ºä»€ä¹ˆåè½¬ï¼Ÿ</strong><br />
è®¡ç®—æœºæ— æ³•ç›´æ¥ä»å­—ç¬¦ä¸²æœ«å°¾å¼€å§‹å¤„ç†ï¼Œåè½¬åï¼š
- ä¸ªä½å­˜å‚¨åœ¨ç´¢å¼•0ä½ç½®
- é«˜ä½ç´¢å¼•é€’å¢
<div class="highlight"><pre><span></span><code>åŸæ•°å­—ï¼š&quot;123&quot;   â†’ åè½¬åï¼š&quot;321&quot;
åŸæ•°å­—ï¼š&quot;4567&quot;  â†’ åè½¬åï¼š&quot;7654&quot;
</code></pre></div></p>
<p><strong>ä»£ç å®ç°</strong>ï¼š
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<hr />
<h5 id="2_6"><strong>æ­¥éª¤ 2ï¼šé€ä½ç›¸åŠ </strong></h5>
<p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">æ¯ä¸€ä½</span><span class="w"> </span><span class="n">i</span><span class="o">:</span>
<span class="w">    </span><span class="n">å½“å‰ä½å’Œ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">è¿›ä½</span>
<span class="w">    </span><span class="n">å½“å‰ä½ç»“æœ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">å’Œ</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">æ–°è¿›ä½</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">å’Œ</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div></p>
<p><strong>è¾¹ç•Œå¤„ç†</strong>ï¼š</p>
<ul>
<li>ä¸¤æ•°å­—é•¿åº¦ä¸åŒæ—¶ï¼ŒçŸ­çš„æ•°å­—é«˜ä½è¡¥0</li>
<li>æœ€é«˜ä½è®¡ç®—åä»æœ‰è¿›ä½è¦å¤„ç†</li>
</ul>
<p><strong>ä»£ç ç‰‡æ®µ</strong>ï¼š
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">len1</span><span class="p">,</span><span class="w"> </span><span class="n">len2</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<blockquote>
<p>è¿™é‡Œå¤šè§£é‡Šä¸€ç‚¹ï¼š</p>
<ul>
<li>è¿™è¡Œä»£ç ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ã€‚ å¦‚æœ <code>i</code> å°äº <code>len1</code>ï¼Œåˆ™ <code>digit1</code> è¢«èµ‹å€¼ä¸º <code>num1[i] - '0'</code> çš„å€¼ï¼›å¦åˆ™ï¼Œ <code>digit1</code> è¢«èµ‹å€¼ä¸º 0ã€‚</li>
<li><code>num1[i]</code> è®¿é—®å­—ç¬¦ä¸² <code>num1</code> çš„ç¬¬ <code>i</code> ä¸ªå­—ç¬¦ã€‚</li>
<li><code>'0'</code> æ˜¯å­—ç¬¦ '0' çš„ ASCII å€¼ã€‚ ä»å­—ç¬¦æ•°å­—ä¸­å‡å» '0' å¯ä»¥å°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„æ•´æ•°å€¼ã€‚ ä¾‹å¦‚ï¼Œ<code>'5' - '0'</code> çš„ç»“æœæ˜¯æ•´æ•° <code>5</code>ã€‚</li>
<li>æœ¬è´¨ä¸Šï¼Œå¦‚æœ <code>i</code> è¿˜åœ¨ <code>num1</code> çš„é•¿åº¦èŒƒå›´å†…ï¼Œè¿™è¡Œä»£ç ä» <code>num1</code> ä¸­æå–ç¬¬ <code>i</code> ä½æ•°å­—ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•´æ•°ã€‚ å¦‚æœ <code>i</code> è¶…å‡ºäº† <code>num1</code> çš„é•¿åº¦èŒƒå›´ï¼Œåˆ™ <code>digit1</code> è¢«èµ‹å€¼ä¸º 0ï¼Œè¿™ç›¸å½“äºåœ¨è¾ƒçŸ­çš„æ•°å­—å­—ç¬¦ä¸²å‰è¡¥ 0ã€‚</li>
</ul>
</blockquote>
<hr />
<h5 id="3_6"><strong>æ­¥éª¤ 3ï¼šå¤„ç†æœ€é«˜ä½è¿›ä½</strong></h5>
<p>ç¤ºä¾‹ï¼š<code>999 + 1 = 1000</code>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<hr />
<h5 id="4_5"><strong>æ­¥éª¤ 4ï¼šåè½¬ç»“æœæ¢å¤é¡ºåº</strong></h5>
<p>ä¹‹å‰çš„è®¡ç®—æ˜¯ä»ä½ä½åˆ°é«˜ä½ï¼Œæœ€ç»ˆç»“æœéœ€è¦åè½¬ï¼š
<div class="highlight"><pre><span></span><code>è®¡ç®—ç»“æœç¼“å†²åŒºï¼š&quot;0001&quot; â†’ åè½¬å â†’ &quot;1000&quot;
</code></pre></div></p>
<hr />
<h4 id="_35"><strong>å››ã€å®Œæ•´ä»£ç æ³¨é‡Šè§£æ</strong></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>

<span class="cp">#define MAX_LEN 1000</span>

<span class="c1">// åè½¬å­—ç¬¦ä¸²å‡½æ•°</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">str</span><span class="p">[</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// å¤§æ•°åŠ æ³•æ ¸å¿ƒå‡½æ•°</span>
<span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">add_strings</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">len1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">len2</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// åˆ›å»ºå¯ä¿®æ”¹å‰¯æœ¬å¹¶åè½¬</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span><span class="w">  </span><span class="c1">// å¤åˆ¶num1</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span><span class="w">  </span><span class="c1">// å¤åˆ¶num2</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">n1</span><span class="p">);</span><span class="w">              </span><span class="c1">// åè½¬åä¸ªä½åœ¨ç´¢å¼•0</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// ç»“æœç¼“å†²åŒºï¼šå¤šç”³è¯·2å­—èŠ‚ï¼ˆè¿›ä½å’Œç»“æŸç¬¦ï¼‰</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">max_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// è¿›ä½å€¼</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç»“æœå†™å…¥ä½ç½®</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// è·å–å½“å‰ä½çš„æ•°å­—ï¼Œè¶…å‡ºé•¿åº¦è¡¥0</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">n1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>

<span class="w">        </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">             </span><span class="c1">// è®¡ç®—è¿›ä½</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// å½“å‰ä½ç»“æœ</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// å¤„ç†æœ€é«˜ä½è¿›ä½ï¼ˆå¦‚999+1=1000ï¼‰</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// å­—ç¬¦ä¸²ç»“æŸç¬¦</span>
<span class="w">    </span><span class="n">reverse</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w">        </span><span class="c1">// åè½¬æ¢å¤æ­£ç¡®é¡ºåº</span>

<span class="w">    </span><span class="c1">// é‡Šæ”¾ä¸´æ—¶å†…å­˜</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">n1</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">],</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// è¯»å–è¾“å…¥ï¼ˆå‡è®¾è¾“å…¥åˆæ³•ï¼‰</span>
<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num1</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>
<span class="w">    </span><span class="n">fgets</span><span class="p">(</span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num2</span><span class="p">),</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// å»é™¤æ¢è¡Œç¬¦</span>
<span class="w">    </span><span class="n">num1</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">num2</span><span class="p">[</span><span class="n">strcspn</span><span class="p">(</span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_strings</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w">  </span><span class="c1">// é‡Šæ”¾ç»“æœå†…å­˜</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h4 id="_36"><strong>äº”ã€å…³é”®é—®é¢˜ä¸ä¼˜åŒ–</strong></h4>
<h5 id="1_10"><strong>1. æ—¶é—´å¤æ‚åº¦åˆ†æ</strong></h5>
<ul>
<li><strong>åè½¬æ“ä½œ</strong>ï¼šO(n)</li>
<li><strong>é€ä½ç›¸åŠ </strong>ï¼šO(max(m,n))</li>
<li><strong>æ€»ä½“å¤æ‚åº¦</strong>ï¼šO(n) ï¼Œçº¿æ€§æ—¶é—´æ•ˆç‡</li>
</ul>
<h5 id="2_7"><strong>2. å†…å­˜ç®¡ç†è¦ç‚¹</strong></h5>
<ul>
<li>ä½¿ç”¨ <code>strdup()</code> å¤åˆ¶å­—ç¬¦ä¸²åå¿…é¡» <code>free()</code></li>
<li>ç»“æœå­—ç¬¦ä¸²éœ€è¦æ‰‹åŠ¨ <code>malloc()</code> å’Œ <code>free()</code></li>
</ul>
<h5 id="3_7"><strong>3. è¾¹ç•Œæµ‹è¯•æ¡ˆä¾‹</strong></h5>
<table>
<thead>
<tr>
<th>æµ‹è¯•ç”¨ä¾‹</th>
<th>é¢„æœŸç»“æœ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>"0" + "0"</td>
<td>"0"</td>
<td>é›¶å€¼å¤„ç†</td>
</tr>
<tr>
<td>"999" + "1"</td>
<td>"1000"</td>
<td>æœ€é«˜ä½è¿›ä½</td>
</tr>
<tr>
<td>"123456" + "789"</td>
<td>"124245"</td>
<td>ä¸åŒé•¿åº¦æ•°å­—ç›¸åŠ </td>
</tr>
</tbody>
</table>
<h5 id="4_6"><strong>4. æ‰©å±•ä¼˜åŒ–æ–¹å‘</strong></h5>
<ul>
<li><strong>å‰å¯¼é›¶å¤„ç†</strong>ï¼šç»“æœä¸­å»é™¤å‰å¯¼é›¶ï¼ˆå¦‚ "000123" â†’ "123"ï¼‰</li>
<li><strong>è´Ÿæ•°æ”¯æŒ</strong>ï¼šå¢åŠ ç¬¦å·ä½åˆ¤æ–­å’Œå‡æ³•é€»è¾‘</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé¢„è®¡ç®—é•¿åº¦ï¼Œé¿å…å¤šæ¬¡ <code>strlen()</code>
</li>
</ul>
<h3 id="_37"><strong>å¤§æ•°åŠ æ³•çš„ä¼˜åŒ–å®ç°æ–¹æ¡ˆ</strong></h3>
<hr />
<h4 id="_38"><strong>ä¸€ã€æ›¿ä»£ç®—æ³•åˆ†æ</strong></h4>
<p>åŸºç¡€çš„å­—ç¬¦ä¸²åè½¬æ³•ï¼ˆæ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(n)ï¼‰å·²æ˜¯æœ€ä¼˜ç†è®ºå¤æ‚åº¦ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹æ³•ä¼˜åŒ– <strong>å¸¸æ•°å› å­</strong> å’Œ <strong>å®é™…å†…å­˜å ç”¨</strong>ï¼š</p>
<hr />
<h4 id="1_11"><strong>äºŒã€ä¼˜åŒ–æ–¹æ¡ˆ 1ï¼šå…åè½¬ç›´æ¥è®¡ç®—</strong></h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç›´æ¥ä»å­—ç¬¦ä¸²æœ«å°¾å¼€å§‹è®¡ç®—ï¼Œé¿å…åè½¬æ“ä½œ<br />
<strong>ä¼˜åŠ¿</strong>ï¼šå‡å°‘ä¸¤æ¬¡åè½¬æ“ä½œçš„æ—¶é—´ï¼ŒèŠ‚çœä¸´æ—¶å†…å­˜</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">add_strings_optimized</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">max_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// +1è¿›ä½ +1ç»“æŸç¬¦</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ä»æœ«ä½å¼€å§‹é€ä½ç›¸åŠ </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">i</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">j</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// åè½¬ç»“æœï¼ˆå› ä¸ºå­˜å‚¨é¡ºåºæ˜¯ä½ä½åœ¨å‰ï¼‰</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">index</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š<br />
| æ“ä½œ           | åŸæ–¹æ¡ˆ          | ä¼˜åŒ–æ–¹æ¡ˆ  |
| -------------- | --------------- | --------- |
| å†…å­˜åˆ†é…æ¬¡æ•°   | 3æ¬¡ (n1,n2,res) | 1æ¬¡ (res) |
| å­—ç¬¦ä¸²åè½¬æ¬¡æ•° | 3æ¬¡             | 1æ¬¡       |
| ä»£ç è¡Œæ•°       | çº¦ 30 è¡Œ        | çº¦ 20 è¡Œ  |</p>
<hr />
<h4 id="2_8"><strong>ä¸‰ã€ä¼˜åŒ–æ–¹æ¡ˆ 2ï¼šé¢„è®¡ç®—é•¿åº¦</strong></h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæå‰ç¡®å®šç»“æœæœ€å¤§é•¿åº¦ï¼Œä¸€æ¬¡æ€§åˆ†é…å†…å­˜<br />
<strong>ä¼˜åŠ¿</strong>ï¼šé¿å…åŠ¨æ€æ•°ç»„æ‰©å®¹å¼€é”€</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">add_strings_prealloc</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">len1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">len2</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// é¢„åˆ†é…å†…å­˜ï¼ˆæœ€å¤§å¯èƒ½é•¿åº¦ï¼‰</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">max_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// +1è¿›ä½ +1ç»“æŸç¬¦</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// ä»æœ«å°¾å‘å‰å¡«å……</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len1</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len2</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// è¿”å›æœ‰æ•ˆèµ·å§‹ä½ç½®ï¼ˆè·³è¿‡æœªä½¿ç”¨çš„é¢„åˆ†é…ç©ºé—´ï¼‰</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>å†…å­˜ä¼˜åŒ–æ•ˆæœ</strong>ï¼š<br />
- åŸæ–¹æ¡ˆï¼š<code>2*N + M</code>ï¼ˆNä¸ºè¾“å…¥é•¿åº¦ï¼ŒMä¸ºç»“æœé•¿åº¦ï¼‰<br />
- æœ¬æ–¹æ¡ˆï¼š<code>M + 2</code>ï¼ˆç²¾ç¡®æ§åˆ¶å†…å­˜å ç”¨ï¼‰</p>
<hr />
<h4 id="3_8"><strong>å››ã€ä¼˜åŒ–æ–¹æ¡ˆ 3ï¼šåŸåœ°ä¿®æ”¹ï¼ˆè¾“å…¥å¯å†™æ—¶ï¼‰</strong></h4>
<p><strong>å‰ææ¡ä»¶</strong>ï¼šå…è®¸ä¿®æ”¹è¾“å…¥å­—ç¬¦ä¸²<br />
<strong>ä¼˜åŠ¿</strong>ï¼šé›¶é¢å¤–å†…å­˜åˆ†é…ï¼ˆæç«¯ä¼˜åŒ–ï¼‰</p>
<div class="highlight"><pre><span></span><code><span class="c1">// å‡è®¾ num1 æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾ç»“æœï¼ˆéœ€æå‰æ‰©å®¹ï¼‰</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">add_in_place</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">len1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">len2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">len2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_len</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ä»æœ«å°¾å‘å‰è®¡ç®—</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">carry</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num1</span><span class="p">[</span><span class="n">i</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">num2</span><span class="p">[</span><span class="n">j</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digit1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">digit2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">carry</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">        </span><span class="n">num1</span><span class="p">[</span><span class="n">k</span><span class="o">--</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ç§»åŠ¨ç»“æœåˆ°èµ·å§‹ä½ç½®</span>
<span class="w">    </span><span class="n">memmove</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num1</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">max_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="n">num1</span><span class="p">[</span><span class="n">max_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<br />
- åµŒå…¥å¼ç³»ç»Ÿï¼ˆå†…å­˜ä¸¥æ ¼å—é™ï¼‰<br />
- é«˜é¢‘è°ƒç”¨åœºæ™¯ï¼ˆé¿å…é¢‘ç¹å†…å­˜åˆ†é…ï¼‰</p>
<hr />
<h4 id="_39"><strong>äº”ã€å¤æ‚åº¦å¯¹æ¯”ä¸é€‰å‹å»ºè®®</strong></h4>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŸºç¡€åè½¬æ³•</td>
<td>O(n)</td>
<td>O(2n + m)</td>
<td>æ•™å­¦æ¼”ç¤ºã€å¿«é€Ÿå®ç°</td>
</tr>
<tr>
<td>å…åè½¬ç›´æ¥è®¡ç®—</td>
<td>O(n)</td>
<td>O(m)</td>
<td>é€šç”¨åœºæ™¯ï¼ˆæ¨èé¦–é€‰ï¼‰</td>
</tr>
<tr>
<td>é¢„è®¡ç®—é•¿åº¦</td>
<td>O(n)</td>
<td>O(m)</td>
<td>ç²¾ç¡®å†…å­˜æ§åˆ¶</td>
</tr>
<tr>
<td>åŸåœ°ä¿®æ”¹</td>
<td>O(n)</td>
<td>O(1)</td>
<td>å†…å­˜æç«¯å—é™ç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<p><strong>å·¥ç¨‹å®è·µå»ºè®®</strong>ï¼š<br />
1. <strong>å¸¸è§„å¼€å‘</strong>ï¼šé€‰æ‹© <strong>å…åè½¬ç›´æ¥è®¡ç®—</strong>ï¼ˆä»£ç ç®€æ´ã€å†…å­˜é«˜æ•ˆï¼‰<br />
2. <strong>é«˜é¢‘è°ƒç”¨</strong>ï¼šä½¿ç”¨ <strong>é¢„è®¡ç®—é•¿åº¦</strong> + å†…å­˜æ± ï¼ˆé¿å…é¢‘ç¹ mallocï¼‰<br />
3. <strong>åµŒå…¥å¼ç¯å¢ƒ</strong>ï¼šä¼˜å…ˆ <strong>åŸåœ°ä¿®æ”¹</strong>ï¼ˆéœ€ç¡®ä¿è¾“å…¥ç¼“å†²åŒºè¶³å¤Ÿå¤§ï¼‰  </p>
<hr />
<h4 id="simd"><strong>å…­ã€ç»ˆæä¼˜åŒ–ï¼šSIMD å¹¶è¡Œè®¡ç®—</strong></h4>
<p><strong>åŸç†</strong>ï¼šåˆ©ç”¨ CPU çš„ SIMD æŒ‡ä»¤é›†ï¼ˆå¦‚ AVX-512ï¼‰å¹¶è¡Œå¤„ç†å¤šä½<br />
<strong>ç¤ºä¾‹ä»£ç </strong>ï¼ˆæ¦‚å¿µæ¼”ç¤ºï¼Œéœ€ç‰¹å®šç¡¬ä»¶æ”¯æŒï¼‰ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;immintrin.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">simd_add</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå‘é‡å¯„å­˜å™¨</span>
<span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_epi8</span><span class="p">(</span><span class="n">num1</span><span class="p">);</span>
<span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_epi8</span><span class="p">(</span><span class="n">num2</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// SIMD å¹¶è¡ŒåŠ æ³•</span>
<span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi8</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">);</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">// å¤„ç†è¿›ä½ï¼ˆéœ€è¦é¢å¤–ç®—æ³•ï¼‰</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">_mm512_storeu_epi8</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>æ€§èƒ½æå‡</strong>ï¼š<br />
- ç†è®ºåŠ é€Ÿæ¯”ï¼š16 å€ï¼ˆ512ä½å¯„å­˜å™¨ / 32ä½ç³»ç»Ÿï¼‰<br />
- å®ç°éš¾åº¦ï¼šæé«˜ï¼ˆéœ€æ‰‹åŠ¨å¤„ç†è·¨å­—èŠ‚è¿›ä½é“¾ï¼‰  </p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<br />
- è¶…å¤§è§„æ¨¡æ•°å€¼è®¡ç®—ï¼ˆå¦‚ç™¾ä¸‡ä½åŠ æ³•ï¼‰<br />
- é«˜æ€§èƒ½è®¡ç®—ä¸“ç”¨é¢†åŸŸ  </p>
<hr />
<h3 id="_40"><strong>æ€»ç»“</strong></h3>
<p>å¤§æ•°åŠ æ³•çš„ä¼˜åŒ–æ ¸å¿ƒåœ¨äº <strong>å‡å°‘å†…å­˜æ“ä½œ</strong> å’Œ <strong>åˆ©ç”¨ç¡¬ä»¶ç‰¹æ€§</strong>ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œ<strong>å…åè½¬ç›´æ¥è®¡ç®—æ³•</strong> æ˜¯æœ€ä½³é€‰æ‹©ï¼Œåœ¨ä¿æŒä»£ç ç®€æ´æ€§çš„åŒæ—¶è¾¾åˆ°æœ€ä¼˜æ€§èƒ½ã€‚ç‰¹æ®Šåœºæ™¯ä¸‹å¯ç»“åˆ SIMD æˆ–åŸåœ°ä¿®æ”¹æŠ€æœ¯å®ç°æè‡´ä¼˜åŒ–ã€‚</p>
</blockquote>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-03-10T16:40:39+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-10</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-03-10T16:40:39+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-10</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/JAILuo" target="_blank" rel="noopener" title="JAILuo" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.footer"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>