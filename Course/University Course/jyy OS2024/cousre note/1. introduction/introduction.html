
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jailuo.github.io/notes/Course/University%20Course/jyy%20OS2024/cousre%20note/1.%20introduction/introduction.html">
      
      
        <link rel="prev" href="../../../../../index.html">
      
      
        <link rel="next" href="../2.%20concurrency/concurrency.html">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>introduction - Messy Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/timeago.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../index.html" title="Messy Notes" class="md-header__button md-logo" aria-label="Messy Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Messy Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              introduction
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/JAILuo/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../index.html" title="Messy Notes" class="md-nav__button md-logo" aria-label="Messy Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Messy Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/JAILuo/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    University Course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            University Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    jyy OS2024
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            jyy OS2024
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_1_1" id="__nav_2_1_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    course note
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            course note
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    introduction
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="introduction.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    introduction
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      应用视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      构建最小可执行文件 （程序 = 状态机）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toybox-010-strace" class="md-nav__link">
    <span class="md-ellipsis">
      操作系统上的应用程序(toybox-0.1.0 / strace)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      C 语言与汇编
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C 语言与汇编">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c_1" class="md-nav__link">
    <span class="md-ellipsis">
      C 解释器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hanoi" class="md-nav__link">
    <span class="md-ellipsis">
      递归和非递归(Hanoi)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      编译器与编译优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="编译器与编译优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      编译器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      编译优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      硬件视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="硬件视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      计算机系统的状态机模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      固件：接管计算机系统的第一个程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#legacy-bios" class="md-nav__link">
    <span class="md-ellipsis">
      观察和调试 legacy BIOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile 方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Makefile 方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      数学视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数学视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      程序的本质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30" class="md-nav__link">
    <span class="md-ellipsis">
      30 行建模操作系统
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      枚举法理解操作系统
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20concurrency/concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.%20virtualization/virtualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.%20persistence/persistence.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    persistence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1_2" id="__nav_2_1_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mini Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            Mini Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mini%20Labs/M1/M1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mini%20Labs/M2/M2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mini%20Labs/M3/M3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M3
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1_3" id="__nav_2_1_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OS Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_3">
            <span class="md-nav__icon md-icon"></span>
            OS Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS%20Labs/L0/L0.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OS%20Labs/L1/L1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    GeekTime
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            GeekTime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    深入理解计算机组成原理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            深入理解计算机组成原理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/1.%20%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97/%E6%8C%87%E4%BB%A4%E4%B8%8E%E8%BF%90%E7%AE%97.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. 指令与运算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/2.%20%E5%A4%84%E7%90%86%E5%99%A8/%E5%A4%84%E7%90%86%E5%99%A8.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. 处理器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/3.%20%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F/%E5%AD%98%E5%82%A8%E4%B8%8EIO%E7%B3%BB%E7%BB%9F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 存储与IO系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E4%B8%80%E5%91%A8%E7%9B%AE/4.%20%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. 应用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算基础实战课
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            计算基础实战课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/1.%20MiniCPU%E8%AE%BE%E8%AE%A1/MiniCPU%E8%AE%BE%E8%AE%A1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. MiniCPU设计
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/2.%20%E8%AF%AD%E8%A8%80%E5%92%8C%E6%8C%87%E4%BB%A4/%E8%AF%AD%E8%A8%80%E5%92%8C%E6%8C%87%E4%BB%A4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. 语言和指令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/3.%20%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98/%E5%BA%94%E7%94%A8%E5%92%8C%E5%86%85%E5%AD%98.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 应用和内存
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/4.%20IO%E4%B8%8E%E6%96%87%E4%BB%B6/IO%E5%92%8C%E6%96%87%E4%BB%B6.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. IO与文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/5.%20%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8/synthesis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. 综合应用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../GeekTime/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%92%8C%E5%B7%A5%E5%85%B7%E9%93%BE/%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    环境配置和工具链
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ysyx
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            ysyx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NJU-ICS2023-PA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            NJU-ICS2023-PA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/pa1/pa1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/pa2/pa2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/pa3/pa3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/pa4/pa4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PA4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/c_marco/macro.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C Macro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/summary/summary.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/pa/Linux_porting/porting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Porting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ysyx/digital-circuit/digital%20circuit.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Digital Circuit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      应用视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      构建最小可执行文件 （程序 = 状态机）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#toybox-010-strace" class="md-nav__link">
    <span class="md-ellipsis">
      操作系统上的应用程序(toybox-0.1.0 / strace)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      C 语言与汇编
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C 语言与汇编">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c_1" class="md-nav__link">
    <span class="md-ellipsis">
      C 解释器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hanoi" class="md-nav__link">
    <span class="md-ellipsis">
      递归和非递归(Hanoi)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      编译器与编译优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="编译器与编译优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      编译器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      编译优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      硬件视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="硬件视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      计算机系统的状态机模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      固件：接管计算机系统的第一个程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#legacy-bios" class="md-nav__link">
    <span class="md-ellipsis">
      观察和调试 legacy BIOS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile 方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Makefile 方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      数学视角的操作系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数学视角的操作系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      程序的本质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30" class="md-nav__link">
    <span class="md-ellipsis">
      30 行建模操作系统
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      枚举法理解操作系统
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>introduction</h1>

<p><strong>2024 Nanjing University, Operating System: Design and Implementation</strong></p>
<p>Mini Labs &amp; OS Labs</p>
<p>The individual learning implementation version, without Online Judge, only local test</p>
<ul>
<li>Course Homepage: https://jyywiki.cn/OS/2024/</li>
<li>Lesson Video: https://www.bilibili.com/video/BV1Xm411f7CM</li>
</ul>
<h2 id="_1">概述</h2>
<p><strong>本讲内容</strong>：个人/课程简介、操作系统的发展历史，回答三个问题：</p>
<ul>
<li>(Why): 为什么要学操作系统？</li>
<li>(What): 到底什么是操作系统？</li>
<li>(How): 怎么学操作系统？</li>
</ul>
<p><img src="pic/image-20240810161138980.png" alt="image-20240810161138980" style="zoom:80%;" /></p>
<p>学习的目的是为了什么？革命？</p>
<p><img src="pic/image-20240810161840469.png" alt="image-20240810161840469" style="zoom: 50%;" /></p>
<p>为了更快更好地服务应用程序？</p>
<p>这学期刚开学的时候看第一节课很吃力，做了berkeley 的lab和project再看这个，瞬间理解了不少。cs61c的第一个proj是用c语言写一个贪吃蛇小游戏，包括使用gdb，valgrind等各种工具调试。第二个proj是在venus上用risc-v写汇编代码，实现一个简单的神经网络，中间调试的时候也用到了os，把值打印出来调试。第三个proj是用logisim搭一个cpu。从数字逻辑到汇编语言到稍微高级一点的c语言三层抽象都涵盖了。第四个proj是写数据级别和线程级别的并行程序，也涉及到了race condition,同步，死锁，活锁等一些在os里会出现的概念，不过这个需要他们学校的hive machine，没太深入做。</p>
<p><img src="pic/image-20240810195345197.png" alt="image-20240810195345197" style="zoom:67%;" /></p>
<h2 id="_2">应用视角的操作系统</h2>
<p>怎么问出问题？</p>
<p>学习最重要的内容就是 提问</p>
<p>一切都是状态机。</p>
<h3 id="_3">构建最小可执行文件 （程序 = 状态机）</h3>
<blockquote>
<p><strong><mark>DEMO</mark></strong></p>
<p><strong>最小可执行文件</strong>：为了理解操作系统上的程序，我们的目标是构造一个能直接被操作系统加载且打印 Hello World 的指令序列。如果你能想到写一段汇编代码实现一个功能，那么大语言模型就能帮你做到：</p>
<blockquote>
<p>如何仅用 x86-64 汇编调用 Linux 系统调用，输出 Hello World 并退出？</p>
</blockquote>
<p>AI 不仅能给出代码，而且还能帮助你解决遇到的疑惑和困难。在你熟悉这些概念之后，syscall(2) 和 syscalls(2) 就成为了非常棒 (而且真正 friendly) 的参考。</p>
<p>能不能快速地写出这个promot？确实是很重要。指明环境 <code>x86-64</code> 汇编 Linux 系统调用？</p>
</blockquote>
<p>程序自己是无法退出的，必须借助操作系统。（系统调用）</p>
<p><img src="pic/image-20240811141717605.png" alt="image-20240811141717605" style="zoom: 67%;" /></p>
<p><img src="pic/image-20240810204909236.png" alt="image-20240810204909236" style="zoom: 50%;" /></p>
<div class="highlight"><pre><span></span><code>#include &lt;sys/syscall.h&gt;

// The x86-64 system call Application Binary Interface (ABI):
//     System call number: RAX
//     Arguments: RDI, RSI, RDX, RCX, R8, R9
//     Return value: RAX
// See also: syscall(2) syscalls(2)

#define syscall3(id, a1, a2, a3) \
    movq $SYS_##id, %rax; \
    movq $a1, %rdi; \
    movq $a2, %rsi; \
    movq $a3, %rdx; \
    syscall

#define syscall2(id, a1, a2)  syscall3(id, a1, a2, 0)
#define syscall1(id, a1)  syscall2(id, a1, 0)

.globl _start
_start:
    syscall3(write, 1, addr1, addr2 - addr1)
    syscall1(exit, 99)

addr1:
    .ascii &quot;\033[01;31mHello, OS World\033[0m\n&quot;
addr2:

//minimal.S
</code></pre></div>
<h3 id="toybox-010-strace">操作系统上的应用程序(toybox-0.1.0 / strace)</h3>
<p><code>vscode</code>、浏览器、编译器...</p>
<blockquote>
<p><mark><strong>DEMO</strong></mark></p>
<p><strong>toybox-0.1.0</strong>：这是早前版本的 toybox，包含一些 “最小” 系统所需的工具。现在，Android 内置了 toybox。当你打开手机的 “开发者模式” 后，通过 adb shell 连接到手机，其中的命令行工具就是 toybox。</p>
</blockquote>
<p><img src="pic/image-20240811143118269.png" alt="image-20240811143118269" style="zoom: 67%;" /></p>
<p>所以我能像改 <code>minimal.S</code> 编译出的二进制文件一样去改它们的二进制文件，所以方向 --&gt; 逆向工程。</p>
<p>关键在于有一个良好的工具：<code>hexedit</code>、<code>trace</code>...</p>
<p><img src="pic/image-20240811145004968.png" alt="image-20240811145004968" style="zoom: 50%;" /></p>
<blockquote>
<p>打开程序的执行：Trace (追踪)</p>
<blockquote>
<p>In general, trace refers to the process of following <em>anything</em> from the beginning to the end. For example, the <code>traceroute</code> command follows each of the network hops as your computer connects to another computer.</p>
</blockquote>
<p><strong><mark>DEMO</mark></strong></p>
<p><strong>strace</strong> (system call trace) 是《操作系统》课程中一个非常重要的命令行工具，帮助我们 “观测” 应用程序和操作系统的边界。</p>
<p>实际上，<strong>任何程序的执行就是状态机在计算机上的运行</strong>，因此 “用合适的方式观测状态机执行” 就是我们理解程序的根本方法。调试器、trace、profiler 提供了不同侧面的理解手段，这三个工具将会在课程中反复出现。</p>
<p>如果你感到 strace 的结果不那么友善，用适当的工具处理它就非常重要了。课堂上我们展示了用命令行工具进行处理的 “传统方法”：</p>
<div class="highlight"><pre><span></span><code>$ strace ls |&amp; grep -e read -e write
</code></pre></div>
<p><strong>对新手来说，感到困惑是非常正常的——但我们总是可以把不熟悉的东西用熟悉的东西类比 (正是 AI 擅长的)。今天你只要学会提问，就几乎总是能得到满意的答案。</strong></p>
</blockquote>
<p><img src="pic/image-20240811145100652.png" alt="image-20240811145100652" style="zoom: 50%;" /></p>
<p><code>eg.</code></p>
<ol>
<li>
<p>所有的窗口把自己想要画什么（数据），发送给一个窗口管理器的进程（NWM）。</p>
</li>
<li>
<p>窗口管理器作为操作系统的一部分，直接管理屏幕设备。</p>
<blockquote>
<p>像 PA 中的 <code>fb_write</code> 功能（<code>framebuffer</code>）。</p>
<p>然后进一步使用硬件资源（VGA），最终画出图案，这就让我们体会到了软件和硬件，还有操作系统中是怎么相互配合来实现想要的功能。</p>
</blockquote>
</li>
</ol>
<h3 id="c">C 语言与汇编</h3>
<h4 id="c_1">C 解释器</h4>
<p>C 语言也是一个状态机。</p>
<p>像 GDB 一样，调汇编一样。</p>
<p>c source code ------&gt; C 语言单步解释</p>
<p>理解高级语言程序</p>
<blockquote>
<ul>
<li>成每条语句至多一次运算 (函数调用也是运算)</li>
<li>条件语句中不包含运算<ul>
<li><a href="https://cil-project.github.io/cil/">真的有这种工具</a> (C Intermediate Language) 和<a href="https://gitlab.com/zsaleeba/picoc">解释器</a></li>
</ul>
</li>
<li>(暂时假设没有指针和内存分配)</li>
</ul>
</blockquote>
<p>Simple C 项目确实可以试试。</p>
<p><img src="pic/image-20241005223336685.png" alt="image-20241005223336685" style="zoom:50%;" /></p>
<p>这里，我通过汇编理解状态机。在汇编层面，状态机的当前状态看作是程序的当前状态或环境，状态迁移则对应于执行一条指令，导致状态（即程序的当前状态：寄存器、memory）发生变化。</p>
<p>而一条指令基本能做到的功能（这里暂时不讨论更加复杂的那些atom、SIMD等东西）：</p>
<ol>
<li><strong>数据传输</strong>：在寄存器之间或寄存器和内存之间移动数据。</li>
<li><strong>算术运算</strong>：对数值进行加、减、乘、除等操作。</li>
<li><strong>逻辑运算</strong>：执行逻辑AND、OR、NOT、XOR等操作。</li>
<li><strong>比较</strong>：比较两个值，并根据比较结果设置处理器的状态标志（如零标志、进位标志等）。</li>
<li><strong>跳转</strong>：根据条件跳转到程序的不同部分执行，这在状态机中相当于根据事件切换到不同的状态。</li>
<li><strong>调用和返回</strong>：执行函数调用和从函数返回，这在状态机中可以看作是进入一个子状态机和从子状态机返回。</li>
<li><strong>输入/输出</strong>：与外部设备进行交互。</li>
</ol>
<p>但是漏了 PC ？！他也是寄存器！还是没理解。</p>
<p><img src="pic/image-20241004215138436.png" alt="image-20241004215138436" style="zoom: 50%;" /></p>
<h4 id="hanoi">递归和非递归(Hanoi)</h4>
<p>不知道啥是汉诺塔，GPT：</p>
<blockquote>
<p>汉诺塔问题是一个经典的递归问题。问题描述如下：</p>
<p>有三根柱子（通常称为“起始柱子”、“目标柱子”和“辅助柱子”）和一组不同大小的盘子，这些盘子最初都叠放在起始柱子上，并且盘子是按照大小顺序叠放的，即最大的盘子在最下面，最小的盘子在最上面。目标是将所有的盘子移动到目标柱子上，同时在移动过程中遵守以下规则：</p>
<ol>
<li>每次只能移动一个盘子。</li>
<li>盘子只能从顶部移动到另一根柱子的顶部。</li>
<li>在三根柱子中的任意时刻，任何盘子下面都不能有比它小的盘子。</li>
</ol>
<p>汉诺塔问题的解决方案是递归的。递归的基本思想是：</p>
<ol>
<li>先解决较小的问题：首先，将上面的<code>n-1</code>个盘子从起始柱子借助目标柱子移动到辅助柱子。</li>
<li>解决当前问题：然后，将最大的盘子直接从起始柱子移动到目标柱子。</li>
<li>最后再解决剩余的问题：最后，将那<code>n-1</code>个盘子从辅助柱子借助起始柱子移动到目标柱子。</li>
</ol>
<p><mark><strong>DEMO</strong></mark></p>
<p><strong>汉诺塔</strong>：汉诺塔是递归和分治的经典问题，而同学们也曾经在理解这个程序的时候遇到困难。遇到困难是正常的：C/C++ 中的 “函数” 和数学的函数很不一样，例如我们可以把 Fibonacci 数列的递归写成：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 也可以 return f(n - 2) + f(n - 1);</span>
<span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</code></pre></div>
<p>或是任意调换函数调用的次序，但汉诺塔不行。</p>
<p><strong>不行的根本原因在于汉诺塔中的 <code>printf</code> 会带来全局的副作用。但 C/C++ 遵循 “顺序执行” 的原则，函数的执行有 “先后” (不像数学的函数，先后是无关的)，按照不同顺序调用会导致程序输出不同的结果。而在具体实现时，每个栈帧中存放的 “当前执行的位置” (PC) 实现了顺序执行。</strong></p>
<p>一些思考的问题：函数调用为什么会导致栈溢出？为什么要叫这个名字？</p>
<p>每次函数调用都会创建一个新的栈帧，并且每个栈帧都占用一定的栈空间。</p>
<p>如果是递归调用，并且递归调用的次数太多，那么这些栈帧会累积在栈上，消耗越来越多的空间。</p>
<p>当递归调用层次深到耗尽了所有可用的栈空间时，如果还想要继续使用栈来存储数据就会造成<strong>栈溢出</strong>。这通常发生在没有足够的空间来创建新的栈帧时。</p>
<p>所以，这里递归指的是整个系统分配的栈空间不够用，而不是一个栈桢的空间不够用了。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;assert.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">hanoi</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">via</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;B&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;C&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">step_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hanoi</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Hanoi(%d, %c, %c, %c) = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">,</span><span class="w"> </span><span class="n">step_count</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;assert.h&gt;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Frame</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Each frame has a program counter to keep track its next</span>
<span class="w">    </span><span class="c1">// to-be-executed statement.</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pc</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// The internal state of the frame. This state includes</span>
<span class="w">    </span><span class="c1">// both arguments and local variables (if any).</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Arguments:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Local variables:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Frame</span><span class="w"> </span><span class="n">Frame</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">hanoi</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">via</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Frame</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;stk[%d] addr: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Frame</span><span class="w"> </span><span class="o">*</span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stk</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// stk[-1]</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;stk[-1]: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stk</span><span class="p">[</span><span class="mi">-1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;top point addr: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Function call: push a new frame (PC=0) onto the stack</span>
<span class="w">    </span><span class="cp">#define call(...) ({ *(++top) = (Frame){.pc = 0, __VA_ARGS__}; })</span>

<span class="w">    </span><span class="c1">// Function return: pop the top-most frame</span>
<span class="w">    </span><span class="cp">#define ret(val) ({ top--; retval = (val); })</span>


<span class="w">    </span><span class="c1">// The last function-return&#39;s value. It is not obvious</span>
<span class="w">    </span><span class="c1">// that we only need one retval.</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// The initial call to the recursive function</span>
<span class="w">    </span><span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Fetch the top-most frame.</span>
<span class="w">        </span><span class="n">Frame</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">top</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// No top-most frame any more; we&#39;re done.</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Jumps may change this default next pc.</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next_pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Single step execution.</span>

<span class="w">        </span><span class="c1">// Extract the parameters from the current frame. (It&#39;s</span>
<span class="w">        </span><span class="c1">// generally a bad idea to reuse variable names in</span>
<span class="w">        </span><span class="c1">// practice; but we did it here for readability.)</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">via</span><span class="p">;</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;f-&gt;pc:%d  n:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c -&gt; %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">);</span>
<span class="w">                    </span><span class="n">ret</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">);</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">);</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">call</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">);</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_pc</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// after gcc -E:</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">hanoi</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">via</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Frame</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="w">    </span><span class="n">Frame</span><span class="w"> </span><span class="o">*</span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stk</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cp"># 35 &quot;hanoi-nr.c&quot;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>


<span class="w">    </span><span class="p">({</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">++</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Frame</span><span class="p">){.</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">};</span><span class="w"> </span><span class="p">});</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">Frame</span><span class="w"> </span><span class="o">*</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">top</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next_pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">via</span><span class="p">;</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c -&gt; %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">);</span>
<span class="w">                    </span><span class="p">({</span><span class="w"> </span><span class="n">top</span><span class="o">--</span><span class="p">;</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">++</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Frame</span><span class="p">){.</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">};</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">++</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Frame</span><span class="p">){.</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">};</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">++</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Frame</span><span class="p">){.</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">via</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">};</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="n">top</span><span class="o">--</span><span class="p">;</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">c2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span><span class="w"> </span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot; 3 4</span>
<span class="w">                    </span><span class="p">((</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="p">((</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot;</span>
<span class="w">                    </span><span class="mi">0</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot; 3 4</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">__extension__</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot;</span>
<span class="w">                    </span><span class="mi">0</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot; 3 4</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">__assert_fail</span><span class="w"> </span><span class="p">(</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot;</span>
<span class="w">                    </span><span class="s">&quot;0&quot;</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot; 3 4</span>
<span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hanoi-nr.c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">71</span><span class="p">,</span><span class="w"> </span><span class="n">__extension__</span><span class="w"> </span><span class="n">__PRETTY_FUNCTION__</span><span class="p">);</span><span class="w"> </span><span class="p">}))</span>
<span class="cp"># 71 &quot;hanoi-nr.c&quot;</span>
<span class="w">                             </span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_pc</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//result:</span>
<span class="n">stk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250a720</span>
<span class="n">stk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250a734</span>
<span class="p">......</span>
<span class="n">stk</span><span class="p">[</span><span class="mi">62</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250abf8</span>
<span class="n">stk</span><span class="p">[</span><span class="mi">63</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250ac0c</span>
<span class="n">stk</span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250a70c</span>
<span class="n">top</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="w"> </span><span class="mh">0x7ffed250a70c</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">1</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">1</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">2</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">3</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">4</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">5</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">6</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">2</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">3</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">4</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">1</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">C</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">A</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">2</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">3</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">C</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">4</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">0</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">1</span>
<span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">5</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">6</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">2</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">5</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>
<span class="n">f</span><span class="o">-&gt;</span><span class="n">pc</span><span class="o">:</span><span class="mi">6</span><span class="w">  </span><span class="n">n</span><span class="o">:</span><span class="mi">3</span>

<span class="n">Hanoi</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
</code></pre></div>
<p>上述通过栈帧模拟的函数调用，每一次函数调用模拟为：创建新栈帧，PC 刷新为 0，去到要执行下一个函数的地方(注意每次循环都会重新获取top，即本次栈帧，然后获取栈帧中的数据)。</p>
<p><code>call</code> 和 <code>ret</code> 跳转到新栈帧、返回到旧栈帧。</p>
<p>这里通过一些变量的地址，可以初步构建出定义的 <code>Frame stk[64]</code>、 <code>top</code> 在实际的栈中的位置。如下图（借助上面的结果）：</p>
<div class="highlight"><pre><span></span><code><span class="o">+----------------+</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">rbp</span><span class="w">  </span><span class="p">(</span><span class="n">high</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">63</span><span class="p">]</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">62</span><span class="p">]</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">fun1的栈帧起始地址</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">61</span><span class="p">]</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="p">...</span><span class="w">        </span><span class="n">stk</span><span class="p">[..]</span>
<span class="w">        </span><span class="p">...</span>
<span class="o">+----------------+</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">fun3的栈帧起始地址</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span>
<span class="o">|</span><span class="w">     </span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">via</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stk</span><span class="p">[</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="n">pointed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">beginning</span>
<span class="o">|</span><span class="w">       </span><span class="n">pc</span><span class="w">       </span><span class="o">|</span>
<span class="o">+----------------+</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="p">...</span><span class="w">        </span><span class="n">other</span><span class="w"> </span><span class="n">variables</span><span class="p">(</span><span class="n">next_pc</span><span class="p">,</span><span class="w"> </span><span class="n">retval</span><span class="p">...)</span>
<span class="w">        </span><span class="p">...</span>
<span class="o">+----------------+</span>
<span class="o">|</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="n">variable</span>
<span class="o">+----------------+</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">rsp</span><span class="w">  </span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
</code></pre></div>
<h3 id="_4">编译器与编译优化</h3>
<h4 id="_5">编译器</h4>
<p><strong>将一种状态机（由栈帧组成）变成另一种状态机（由指令、寄存器、内存（栈帧依旧是有的，存在内存上）），编译器的工作就是做这个工作的。</strong>（这真是一个很奇特的视角！！）</p>
<p><img src="pic/image-20241006214313454.png" alt="image-20241006214313454" style="zoom: 67%;" /></p>
<p>也就是我之前的那种理解：将C状态机和汇编状态机连接起来。这个时候，那对于 Simple C 怎么实现：</p>
<p><img src="pic/image-20241006214354196.png" alt="image-20241006214354196" style="zoom:50%;" /></p>
<ul>
<li>
<p>运算</p>
<div class="highlight"><pre><span></span><code>x = y + z; --&gt;

rax = load(y)
rbx = load(z)
rax += rbx
store(x, rax)
</code></pre></div>
<p>将一条高级语言翻译成汇编指令</p>
</li>
<li>
<p>分支/循环</p>
<p>跳转指令，很熟悉了，可以再看 PA4 那部分实现 <code>trap.S</code> 的汇编代码，跳转指令为真，跳到label 那里，还是继续执行接着跳转指令后面的的部分。</p>
</li>
<li>
<p>函数调用</p>
<p>关键在于<strong>栈帧的实现</strong>，需要有一个寄存器存放当前栈帧的位置，那就专门留一个寄存器（SP）给栈。</p>
</li>
</ul>
<blockquote>
<p>这里老师的提醒了：PA 和 Simple C 分别从两个视角学习计算机。</p>
<p>PA：硬件一步步到上层应用。即：计算机系统/硬件</p>
<p>Simple C 编译器： (C -&gt; Simple C) -&gt; assembly。即语言层面：高级语言到汇编语言（可以直接理解为机器能看懂的语言）</p>
</blockquote>
<h4 id="_6">编译优化</h4>
<p><img src="pic/image-20241006203409114.png" alt="image-20241006203409114" style="zoom:50%;" /></p>
<p><img src="pic/image-20241006220645186.png" alt="image-20241006220645186" style="zoom: 50%;" /></p>
<p><img src="pic/image-20241006220815305.png" alt="image-20241006220815305" style="zoom:67%;" /></p>
<h2 id="_7">硬件视角的操作系统</h2>
<h3 id="_8">计算机系统的状态机模型</h3>
<p>这里还可以看看 <a href="https://www.bilibili.com/video/BV1oN411Y7FK/?spm_id_from=333.788&amp;vd_source=ecc99d78ae961113010161a48a475a35">计算机系统的状态机模型 - 第六期“一生一芯”计划</a></p>
<h3 id="_9">固件：接管计算机系统的第一个程序</h3>
<ul>
<li>
<p>程序员如何控制计算机系统？</p>
<ul>
<li>仅有 RESET 状态是不够的</li>
<li>答案：计算机系统会和 System Programmers 达成约定</li>
</ul>
</li>
<li>
<p>还是那个思想：把程序放在memory的合适的位置，CPU 就会执行它</p>
<p>人与计算机的第一个约定：固定好 reset 后 PC 指向的地址。</p>
<p>reset 后一小段运行的程序代码，固件。</p>
</li>
</ul>
<p><img src="pic/image-20241021212250539.png" alt="image-20241021212250539" style="zoom:50%;" /></p>
<ul>
<li>
<p>究竟是谁将硬盘上的代码搬到内存上的？又是通过什么指令做到的？</p>
<p>firmware（看看 CBIOS的源码，怎么搬？）</p>
<p><code>rep insl (%dx)</code></p>
<p>repeat insl/outl，自循环，每次搬两个byte。</p>
<p>PA 中应该很熟悉了，port io，通过in/out与外界设备进行IO口通信。</p>
</li>
<li>
<p>为什么硬盘会有分区这个东西？</p>
<p><a href="https://en.wikipedia.org/wiki/Disk_partitioning">Disk partitioning - Wikipedia</a></p>
<p>一种技术，类似分段、分页。</p>
<blockquote>
<p>Partitioning allows the use of different filesystems to be installed for different kinds of files. Separating user data from system data can prevent the system partition from becoming full and rendering the system unusable. Partitioning can also make backing up easier. A disadvantage is that it can be difficult to properly size partitions, resulting in having one partition with too much free space and another nearly totally allocated.</p>
<p>更多探索：</p>
<p><a href="https://www.cnblogs.com/jiangzhaowei/p/11843026.html">挂载（mount）深入理解 - 江召伟 - 博客园 (cnblogs.com)</a></p>
<p><a href="https://www.cnblogs.com/hester/p/12385990.html">Linux磁盘管理详解-mount挂载 - “人生苦短” - 博客园 (cnblogs.com)</a></p>
</blockquote>
</li>
</ul>
<p>早期固件还有个名字叫 BIOS（legacy BIOS）？</p>
<p>BIOS 甚至于运行之后还能再被调用？（像系统调用？）</p>
<blockquote>
<p>如果能用汇编重写BIOS的行为，那就能造自己的计算机？虽然驱动得自己写？</p>
</blockquote>
<p>为什么现在进化成 <a href="https://www.zhihu.com/question/21672895">UEFI (Unified Extensible Firmware Interface)</a></p>
<ul>
<li>
<p>就是硬件变多了</p>
<p>提供更丰富的支持 (例如设备驱动程序)：指纹锁、山寨网卡上的 PXE 网络启动、USB 蓝牙转接器连接的蓝牙键盘……</p>
</li>
</ul>
<h3 id="legacy-bios">观察和调试 legacy BIOS</h3>
<p>自己构建一个启动区（硬盘中的0盘0道1扇区，第一个扇区的 512 字节的末尾两个字节为 0x55AA，BIOS 即认为其就是一个启动区）</p>
<div class="highlight"><pre><span></span><code><span class="nf">minimal.img</span><span class="o">:</span><span class="w"> </span><span class="n">Makefile</span>
<span class="w">    </span><span class="o">(</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;eb fe 11 22 33 44&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-r<span class="w"> </span>-p<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>cat<span class="w"> </span>/dev/zero<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">504</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;55 aa&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-r<span class="w"> </span>-p<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>minimal.img
</code></pre></div>
<blockquote>
<p><code>eb fe: jmp</code></p>
<div class="highlight"><pre><span></span><code>(qemu) x $eip
0000000000007c00: 0x2211feeb
(qemu) x/i $eip
0x0000000000007c00:  jmp    0x7c00
</code></pre></div>
</blockquote>
<p><strong>当我们按下开机键的时候，在主板上提前写死的固件程序 BIOS 会将硬件启动区中的 512 byte 的数据，复制到内存中 0x7c00 的位置上，并跳到那个位置上。</strong></p>
<p>另外，作为一份程序，我们还是能调试的：</p>
<p><img alt="image-20241021221536663" src="pic/image-20241021221536663.png" /></p>
<blockquote>
<p><strong><mark>DEMO</mark></strong></p>
<p><strong>调试固件</strong>：课程和互联网上的文档都声称是 Firmware 代码将具有 55 aa Magic Number 磁盘的前 512 字节载入内存。经过一些尝试 (例如修改 Magic Number)，我们确认了这一行为；更进一步地，我们能否调试固件的代码，<strong>看看到底是什么指令实现了磁盘到内存的搬运？这就用到了《计算机系统基础》实验中的 Watch Point。</strong></p>
<p>在这里，我们还用到了 init.gdb，它可以帮我们省去每次运行时的重复输入命令，也可以设置 hook (钩子)，每当程序暂停时显示一些我们关心的信息——我们<strong>定制和扩展</strong>了 gdb，使它在调试专属于我们的任务时更加强大。</p>
<p><strong><mark>调试技巧</mark></strong></p>
</blockquote>
<p><strong>回过头来，认识完启动盘后，那这样就 CPU 就要实际执行固件的代码了，这就是我们可以掌控的那 446 byte ：那我们就可以写一个小的 C 程序，来作为boot/loader</strong></p>
<p><img src="pic/image-20241021222108829.png" alt="image-20241021222108829" style="zoom:50%;" /></p>
<blockquote>
<p>之前学习的 NEMU RISC-V 启动 Linux 的内容，再回去看看就应该有不一样的理解</p>
</blockquote>
<p>看看实验框架的启动加载器：</p>
<p><img alt="img" src="pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-21%20223022.png" /></p>
<blockquote>
<p><strong><mark>DEMO</mark></strong></p>
<p><strong>调试 MBR 中的加载器</strong>：我们使用实验框架在 bare-metal 上运行了 Hello World，这也是 “最小” 操作系统的雏形——你可以在此基础上实现任何操作系统内核。通过适当的 gdb 指令 (这次是更好用的 Python，取代了历史遗留的 gdb scripts)，我们完成配置的同时指定正确的二进制文件，调试硬件上的代码，与调试普通的程序完全没有区别。</p>
<p>如果希望深入了解编译的全过程，遵循 “一切都是状态机” 的原理，我们可以观察 Makefile (程序)，也可以观察它的执行，而它的执行就是一个个的命令。<code>make log</code> 对输出的日志做了一些简化处理，已经足够人类可读，稍加整理就能看到磁盘镜像的编译过程。你也许会感到有些吃惊：世界上所有操作系统的构建过程 (例如 Linux)，都和这个简化版类似，只是多了更多实用的特性：支持分区表、支持压缩/解压缩等。</p>
</blockquote>
<p>RTFSC <code>abstract-machine/am/src/x86/qemu/boot/main.c</code></p>
<div class="highlight"><pre><span></span><code><span class="cp">include $(AM_HOME)/Makefile</span>

<span class="nf">debug</span><span class="o">:</span>
<span class="w">    </span>qemu-system-i386<span class="w"> </span>-s<span class="w"> </span>-S<span class="w"> </span>-machine<span class="w"> </span><span class="nv">accel</span><span class="o">=</span>tcg<span class="w"> </span>-smp<span class="w"> </span><span class="s2">&quot;1,sockets=1&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-drive<span class="w"> </span><span class="nv">format</span><span class="o">=</span>raw,file<span class="o">=</span>build/hello-x86-qemu<span class="w"> </span><span class="p">&amp;</span>
<span class="w">    </span>gdb<span class="w"> </span>-x<span class="w"> </span>debug.py

<span class="nf">log</span><span class="o">:</span>
<span class="w">    </span>make<span class="w"> </span>-nB<span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-ve<span class="w"> </span><span class="s1">&#39;^\(\#\|echo\|mkdir\|make\)&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s#</span><span class="k">$(</span>AM_HOME<span class="k">)</span><span class="s2">#\AM#g&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s#</span><span class="k">$(</span>PWD<span class="k">)</span><span class="s2">#.#g&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>&gt;<span class="w"> </span>compile.log
</code></pre></div>
<p>学习 Python 的 import gdb，就不用那个gdb script脚本了。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gdb</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Register the quit hook</span>
<span class="k">def</span> <span class="nf">on_quit</span><span class="p">():</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;kill&#39;</span><span class="p">)</span>

<span class="n">gdb</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">exited</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">on_quit</span><span class="p">)</span>

<span class="c1"># Connect to the remote target</span>
<span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;target remote localhost:1234&#39;</span><span class="p">)</span>

<span class="c1"># Load the debug symbols</span>
<span class="n">am_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AM_HOME&#39;</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">am_home</span><span class="si">}</span><span class="s1">/am/src/x86/qemu/boot/boot.o&#39;</span>
<span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;file </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># This is the 0x7c00</span>
<span class="n">gdb</span><span class="o">.</span><span class="n">Breakpoint</span><span class="p">(</span><span class="s1">&#39;_start&#39;</span><span class="p">)</span>

<span class="c1"># This is where 32-bit code starts</span>
<span class="n">gdb</span><span class="o">.</span><span class="n">Breakpoint</span><span class="p">(</span><span class="s1">&#39;start32&#39;</span><span class="p">)</span>

<span class="c1"># Continue execution</span>
<span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;continue&#39;</span><span class="p">)</span>
</code></pre></div>
<p>直接获取环境变量 $(AM_HOME) 的内容，gdb直接在这里装载要调试的文件，这操作确实什么nb。</p>
<h3 id="makefile">Makefile 方法</h3>
<p>Makefile 看起来确实是很复杂，但是当它本质上在一行行地执行命令，进一步也就是程序，程序执行起来，它就变成了 trace。怎么处理trace ?</p>
<p>想想自己在 <code>The Missing Semester of Your CS Education</code> 学会的数据处理。</p>
<div class="highlight"><pre><span></span><code><span class="nf">log</span><span class="o">:</span>
<span class="w">    </span>make<span class="w"> </span>-nB<span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-ve<span class="w"> </span><span class="s1">&#39;^\(\#\|echo\|mkdir\|make\)&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s#</span><span class="k">$(</span>AM_HOME<span class="k">)</span><span class="s2">#\AM#g&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s#</span><span class="k">$(</span>PWD<span class="k">)</span><span class="s2">#.#g&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>&gt;<span class="w"> </span>compile.log
</code></pre></div>
<p>"在你感到劝退，想要放弃的那一刻，先不要着急。任何时候你感到劝退的时候，这是一个绝佳的机会，如果有一个好的工具解决问题了，那你就解决问题了；如果世界上没有一个好的工具解决这个问题，那你就能创造一个好的工具"</p>
<p>“感到困难的时候，做减法，simplify”</p>
<p>先分解出一个个小的简单的问题，慢慢组合起来。</p>
<h4 id="example">Example</h4>
<p>怎么创建一个可启动的x86系统镜像文件？试试？</p>
<p><img src="pic/image-20241022151638897.png" alt="image-20241022151638897" style="zoom:50%;" /></p>
<p>啰嗦的解释...</p>
<div class="highlight"><pre><span></span><code><span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">build</span>-<span class="n">arg</span>

<span class="nv">LDFLAGS</span><span class="w">    </span><span class="o">+=</span><span class="w"> </span>-N<span class="w"> </span>-Ttext-segment<span class="o">=</span>0x00100000
<span class="nv">QEMU_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-serial<span class="w"> </span>mon:stdio<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-machine<span class="w"> </span><span class="nv">accel</span><span class="o">=</span>tcg<span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-smp<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>smp<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">              </span>-drive<span class="w"> </span><span class="nv">format</span><span class="o">=</span>raw,file<span class="o">=</span><span class="k">$(</span>IMAGE<span class="k">)</span>

<span class="nf">build-arg</span><span class="o">:</span><span class="w"> </span><span class="n">image</span>
<span class="w">    </span>@<span class="o">(</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="k">$(</span>mainargs<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/stdin<span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="k">$(</span>IMAGE<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">bs</span><span class="o">=</span><span class="m">512</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">seek</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>notrunc<span class="w"> </span><span class="nv">status</span><span class="o">=</span>none

<span class="nv">BOOT_HOME</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>AM_HOME<span class="k">)</span>/am/src/x86/qemu/boot

<span class="nf">image</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">IMAGE</span><span class="k">)</span>.<span class="n">elf</span>
<span class="w">    </span>@<span class="k">$(</span>MAKE<span class="k">)</span><span class="w"> </span>-s<span class="w"> </span>-C<span class="w"> </span><span class="k">$(</span>BOOT_HOME<span class="k">)</span>
<span class="w">    </span>@echo<span class="w"> </span>+<span class="w"> </span>CREATE<span class="w"> </span><span class="s2">&quot;-&gt;&quot;</span><span class="w"> </span><span class="k">$(</span>IMAGE_REL<span class="k">)</span>
<span class="w">    </span>@<span class="o">(</span><span class="w"> </span>cat<span class="w"> </span><span class="k">$(</span>BOOT_HOME<span class="k">)</span>/bootblock.o<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">1024</span><span class="w"> </span>/dev/zero<span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cat<span class="w"> </span><span class="k">$(</span>IMAGE<span class="k">)</span>.elf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="k">$(</span>IMAGE<span class="k">)</span>

<span class="err">//</span><span class="w"> </span><span class="err">abstract-machine/scripts/platform/qemu.mk</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c">### Compilation targets (a binary image or archive)</span>
<span class="nv">IMAGE_REL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>build/<span class="k">$(</span>NAME<span class="k">)</span>-<span class="k">$(</span>ARCH<span class="k">)</span>
<span class="nv">IMAGE</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>abspath<span class="w"> </span><span class="k">$(</span>IMAGE_REL<span class="k">))</span>
</code></pre></div>
<blockquote>
<p>qemu 相关配置</p>
<p>这段Makefile代码是用于构建和运行QEMU虚拟机的操作系统镜像。它定义了编译参数、QEMU运行参数以及构建镜像的步骤。下面是对这些部分的详细解释：</p>
<ul>
<li>
<p>变量定义</p>
<ol>
<li>
<p><code>LDFLAGS</code>：链接器标志，用于指定链接时的选项。</p>
<ul>
<li><code>-N</code>：告诉链接器不要自动生成符号表。</li>
<li><code>-Ttext-segment=0x00100000</code>：设置文本段的起始地址为0x00100000。这是操作系统内核加载的地址。</li>
</ul>
</li>
<li>
<p><code>QEMU_FLAGS</code>：QEMU模拟器运行时的参数。</p>
<ul>
<li>
<p><code>_serial mon:stdio</code>：</p>
<p>将QEMU的串行输出重定向到标准输入输出，方便在控制台查看。</p>
</li>
<li>
<p><code>-machine accel=tcg</code>：</p>
<p>使用TCG（Tiny Code Generator）作为QEMU的加速器，提高模拟速度。</p>
</li>
<li>
<p><code>-smp "$(smp)"</code>：</p>
<p>设置虚拟CPU的核心数，<code>$(smp)</code>是一个变量，表示要模拟的CPU核心数。</p>
</li>
<li>
<p><code>-drive format=raw,file=$(IMAGE)</code>：</p>
<p>定义一个虚拟硬盘驱动器，使用原始格式，文件名为<code>$(IMAGE)</code>。</p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>构建目标</p>
<ol>
<li>
<p><code>build-arg</code>：这是一个伪目标，用于将启动参数写入镜像文件。</p>
<ul>
<li>
<p><code>@( echo -n $(mainargs); ) | dd if=/dev/stdin of=$(IMAGE) bs=512 count=2 seek=1 conv=notrunc status=none</code>：</p>
<p>这条命令使用<code>dd</code>工具将启动参数<code>$(mainargs)</code>写入到<code>$(IMAGE)</code>文件的第二个扇区（因为<code>seek=1</code>，所以从第二个扇区开始写入）。<code>bs=512</code>指定块大小为512字节，<code>count=2</code>表示写入2个块。</p>
</li>
</ul>
</li>
<li>
<p><code>image</code>：这是另一个伪目标，用于创建操作系统镜像。</p>
<ul>
<li>
<p><code>@$(MAKE) -s -C $(BOOT_HOME)</code>：</p>
<p>在<code>$(BOOT_HOME)</code>目录下执行<code>make</code>命令，编译启动代码。<code>-s</code>表示静默模式，不显示命令本身，<code>-C</code>指定目录。</p>
</li>
<li>
<p><code>@echo + CREATE "-&gt;" $(IMAGE_REL)</code>：打印创建镜像的信息。</p>
</li>
<li>
<p><code>@( cat $(BOOT_HOME)/bootblock.o; \ head -c 1024 /dev/zero; \ cat $(IMAGE).elf ) &gt; $(IMAGE)</code>：</p>
<p>这条命令将启动块对象文件 <code>bootblock.o</code>、1024字节的零填充 和 ELF格式的内核文件<code>$(IMAGE).elf</code>合并成一个单一的镜像文件<code>$(IMAGE)</code>。</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>这段Makefile代码定义了如何构建一个QEMU虚拟机的操作系统镜像，包括设置链接器参数、QEMU运行参数，以及如何将启动代码、内核代码和启动参数合并成一个可启动的镜像文件。这些步骤对于在QEMU上模拟运行操作系统至关重要。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nv">SRCS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>start.S<span class="w"> </span>main.c
<span class="nf">bootblock.o</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">SRCS</span><span class="k">)</span> <span class="n">Makefile</span>
<span class="w">    </span>@echo<span class="w"> </span>+<span class="w"> </span>CC<span class="w"> </span><span class="k">$(</span>SRCS<span class="k">)</span>
<span class="w">    </span>@<span class="k">$(</span>CROSS_COMPILE<span class="k">)</span>gcc<span class="w"> </span>-static<span class="w"> </span>-m32<span class="w"> </span>-fno-pic<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-Os<span class="w"> </span>-nostdlib<span class="w"> </span>-Ttext<span class="w"> </span>0x7c00<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-I<span class="k">$(</span>AM_HOME<span class="k">)</span>/am/src<span class="w"> </span>-o<span class="w"> </span>bootblock.o<span class="w"> </span><span class="k">$(</span>SRCS<span class="k">)</span>
<span class="w">    </span>@python3<span class="w"> </span>genboot.py<span class="w"> </span>bootblock.o

<span class="nf">clean</span><span class="o">:</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>*.o

<span class="err">//</span><span class="w"> </span><span class="err">abstract-machine/am/src/x86/qemu/boot/Makefile</span>
</code></pre></div>
<blockquote>
<ul>
<li><code>-static</code>：生成一个静态链接的可执行文件，不依赖共享库。</li>
<li><code>-m32</code>：生成32位代码，即使在64位系统上编译。</li>
<li><code>-fno-pic</code>：禁止生成位置无关代码（Position Independent Code），这对于某些嵌入式系统或特定启动代码是必要的。</li>
<li><code>-Os</code>：优化大小，尝试减小生成的代码大小。</li>
<li><code>-nostdlib</code>：不使用标准库，这对于启动代码通常是必要的，因为它们在操作系统加载标准库之前运行。</li>
<li><code>-Ttext 0x7c00</code>：设置代码段的起始地址为0x7c00，这是BIOS启动扇区的标准位置。</li>
<li><code>-I$(AM_HOME)/am/src</code>：添加一个头文件搜索路径，<code>$(AM_HOME)</code>是一个变量，指向存放源代码的目录。</li>
<li><code>-o bootblock.o</code>：指定输出文件名为<code>bootblock.o</code>。</li>
<li><code>$(SRCS)</code>：源文件列表，用于编译。</li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">export </span><span class="nv">CROSS_COMPILE</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>x86_64-linux-gnu-
<span class="nv">CFLAGS</span><span class="w">  </span><span class="o">+=</span><span class="w"> </span>-m32<span class="w"> </span>-fno-pic<span class="w"> </span>-fno-omit-frame-pointer<span class="w"> </span>-march<span class="o">=</span>i386
<span class="nv">CFLAGS</span><span class="w">  </span><span class="o">+=</span><span class="w"> </span>-fcf-protection<span class="o">=</span>none<span class="w"> </span><span class="c1"># remove endbr32 in Ubuntu 20.04 with a CPU newer than Comet Lake</span>
<span class="nv">ASFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-m32<span class="w"> </span>-fno-pic
<span class="nv">LDFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-melf_i386

<span class="err">//</span><span class="w"> </span><span class="err">abstract-machine/scripts/isa/x86.mk</span>
</code></pre></div>
<blockquote>
<ol>
<li><code>CFLAGS</code>：这是编译器标志的集合，用于指定编译时的选项。<ul>
<li><code>-m32</code>：生成32位代码，即使在64位系统上编译。</li>
<li><code>-fno-pic</code>：禁止生成位置无关代码（Position Independent Code），这对于某些嵌入式系统或特定启动代码是必要的。</li>
<li><code>-fno-omit-frame-pointer</code>：禁止省略帧指针，这有助于调试和某些优化。</li>
<li><code>-march=i386</code>：指定编译器生成的代码应该兼容<code>i386</code>架构，即使编译器是在更新的CPU上运行。</li>
<li><code>-fcf-protection=none</code>：禁用控制流保护（Control Flow Protection），这是GCC的一个安全特性，用于防止某些类型的缓冲区溢出攻击。在这里禁用它是为了兼容旧的CPU架构，如在Ubuntu 20.04上使用较新的CPU时。</li>
</ul>
</li>
<li><code>ASFLAGS</code>：这是汇编器标志的集合，用于指定汇编时的选项。<ul>
<li><code>-m32</code>：生成32位代码。</li>
<li><code>-fno-pic</code>：禁止生成位置无关代码。</li>
</ul>
</li>
<li><code>LDFLAGS</code>：这是链接器标志的集合，用于指定链接时的选项。<ul>
<li><code>-melf_i386</code>：指定生成的可执行文件格式为ELF格式，且目标架构为<code>i386</code>。</li>
</ul>
</li>
</ol>
</blockquote>
<p>那调用 <code>run</code> 目标呢？</p>
<div class="highlight"><pre><span></span><code><span class="cp">include $(AM_HOME)/scripts/isa/x86.mk</span>
<span class="cp">include $(AM_HOME)/scripts/platform/qemu.mk</span>

<span class="nv">AM_SRCS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>x86/qemu/start32.S<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/trap32.S<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/trm.c<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/cte.c<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/ioe.c<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/vme.c<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>x86/qemu/mpe.c

<span class="nf">run</span><span class="o">:</span><span class="w"> </span><span class="n">build</span>-<span class="n">arg</span>
<span class="w">    </span>@qemu-system-i386<span class="w"> </span><span class="k">$(</span>QEMU_FLAGS<span class="k">)</span>

<span class="err">//</span><span class="w"> </span><span class="err">abstract-machine/scripts/x86-qemu.mk</span>
</code></pre></div>
<p>而最开始的 <code>$AM_HOME/Makefile</code> 的一句：</p>
<div class="highlight"><pre><span></span><code><span class="c">### Paste in arch-specific configurations (e.g., from `scripts/x86_64-qemu.mk`)</span>
<span class="cp">-include $(AM_HOME)/scripts/$(ARCH).mk</span>
</code></pre></div>
<p>一切都合理了。</p>
<ol>
<li>boot</li>
<li>ISA、platform(qemu、硬件...)、isa-platform</li>
</ol>
<p>各一个 <code>Makefile</code>，然后通过 <code>-include</code> 技巧组合起来。又有种回到之前做 PA 的感觉了。</p>
<p>一些问题：</p>
<ul>
<li>
<p>两个链接地址？ <code>-Ttext 0x7c00</code>、<code>-Ttext-segment=0x00100000</code></p>
<p>最开始的是固件 <code>-Ttext 0x7c00</code>，也就是 <code>$BOOT_HOME</code> 里的 <code>main.c</code>。加载完固件后，才到操作系统的内核 <code>-Ttext-segment=0x00100000</code>。</p>
<blockquote>
<ol>
<li><strong>固件（bootloader）</strong>：这部分代码通常在系统启动时最先运行。它的任务是初始化硬件，设置必要的系统状态，并加载操作系统内核到内存中。固件的代码段起始地址通常被设置为<code>0x7c00</code>，这是因为在BIOS引导阶段，系统会从硬盘读取启动扇区（通常为512字节）到这个地址。你的固件代码（<code>bootblock.o</code>）就是在这个地址开始执行的，这也是为什么在编译固件时使用<code>-Ttext 0x7c00</code>选项的原因。</li>
<li><strong>操作系统内核</strong>：一旦固件完成了它的任务(硬件自检, load kernel...)，它会将控制权交给操作系统内核。内核是操作系统的主要部分，负责管理系统资源、调度进程等。内核的代码段起始地址通常在更高的地址，例如<code>0x00100000</code>，这是因为固件已经加载了内核到这个地址。在链接内核时使用<code>-Ttext-segment=0x00100000</code>选项，确保内核代码在这个地址开始。</li>
</ol>
</blockquote>
<p>要验证的话，具体<code>objdump</code> 看看 MBR 中的加载器。</p>
<ol>
<li>
<p>boot：<code>abstract-machine/am/src/x86/qemu/boot</code></p>
<p>该目录用于构建启动镜像。</p>
<p>该目录下的 <code>start.S</code> -&gt; <code>load_kernel</code> （固件最开始的PC：<code>0x7c00</code>）</p>
<p>生成 <code>bootblock.o</code></p>
</li>
<li>
<p>kernel：<code>abstract-machine/am/src/x86/qemu/ (除boot)</code> </p>
<p>用于构建 <code>bare-metal</code> 向上第一层抽象 <code>am-x86-qemu.a</code>（<code>trm + ioe + cte + vme + mpe</code>）</p>
<div class="highlight"><pre><span></span><code>x86_64-linux-gnu-ar<span class="w"> </span>rcs<span class="w"> </span>AM/am/build/am-x86-qemu.a<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/start32.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/trap32.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/trm.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/cte.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/ioe.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/vme.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/am/build/x86-qemu/src/x86/qemu/mpe.o
</code></pre></div>
<p>再构建 <code>klib</code>：<code>am-x86-qemu.a</code></p>
<div class="highlight"><pre><span></span><code>x86_64-linux-gnu-ar<span class="w"> </span>rcs<span class="w"> </span>AM/klib/build/klib-x86-qemu.a<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/klib/build/x86-qemu/src/int64.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/klib/build/x86-qemu/src/stdlib.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/klib/build/x86-qemu/src/cpp.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/<span class="w"> </span>klib/build/x86-qemu/src/string.o<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>AM/klib/build/x86-qemu/src/stdio.o
</code></pre></div>
<p>再 <code>bare-metal</code> 应用：<code>debug-bootloader/hello.c</code></p>
<p>然后链接器：</p>
<div class="highlight"><pre><span></span><code>x86_64-linux-gnu-ld<span class="w"> </span>-z<span class="w"> </span>noexecstack<span class="w"> </span>-melf_i386<span class="w"> </span>-N<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-Ttext-segment<span class="o">=</span>0x00100000<span class="w"> </span>-o<span class="w"> </span>./build/hello-x86-qemu.elf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--start-group<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>./build/x86-qemu/hello.o<span class="w"> </span>AM/am/build/am-x86-qemu.a<span class="w"> </span>AM/klib/build/klib-x86-qemu.a<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--end-group
</code></pre></div>
<p>最终生成 .elf 文件。</p>
<p>最后：</p>
<div class="highlight"><pre><span></span><code><span class="err">(</span><span class="w"> </span><span class="err">cat</span><span class="w"> </span><span class="err">AM/am/src/x86/qemu/boot/bootblock.o;</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="err">head</span><span class="w"> </span><span class="err">-c</span><span class="w"> </span><span class="err">1024</span><span class="w"> </span><span class="err">/dev/zero;</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="err">cat</span><span class="w"> </span><span class="err">./build/hello-x86-qemu.elf</span><span class="w"> </span><span class="err">\</span>
<span class="err">)</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">./build/hello-x86-qemu</span>
</code></pre></div>
</li>
<li>
<p>自己敲一遍</p>
<div class="highlight"><pre><span></span><code>qemu-system-i386<span class="w"> </span>-serial<span class="w"> </span>mon:stdio<span class="w"> </span>-drive<span class="w"> </span><span class="nv">format</span><span class="o">=</span>raw,file<span class="o">=</span>./build/hello-x86-qemu
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
Hello,<span class="w"> </span>OS<span class="w"> </span>World
CPU<span class="w"> </span><span class="c1">#0 Halt (00).</span>
</code></pre></div>
</li>
</ol>
</li>
</ul>
<p>行了。</p>
<p>最后再看看 QEMU 的基本操作、再看看 QEMU 的论文，ppt里的链接。</p>
<h2 id="_10">数学视角的操作系统</h2>
<h3 id="_11">程序的本质</h3>
<h3 id="30">30 行建模操作系统</h3>
<h3 id="_12">枚举法理解操作系统</h3>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-01-05T17:02:30+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-01-05</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-01-05T17:02:30+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-01-05</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../../../index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 首页">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                首页
              </div>
            </div>
          </a>
        
        
          
          <a href="../2.%20concurrency/concurrency.html" class="md-footer__link md-footer__link--next" aria-label="Next: concurrency">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                concurrency
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/JAILuo" target="_blank" rel="noopener" title="JAILuo" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.footer"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../../../js/timeago.min.js"></script>
      
        <script src="../../../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>